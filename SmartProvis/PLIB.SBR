 CALL main()



 
FUNCTION CopyRecord%(source$,dest$)
    MOUSE OFF 
    cfile$ = FILE 
    'Kopiert alle gemeinsamen Felder von Datei _source$ nach Datei _dest$    
    oldErrorLabel$ = Superbase.ErrorTrapLabel
    ON ERROR GOTO CopyRecordError
    CopyRecord% = 0
  
    'Feldnamen der Quelldatei ermitteln  
    FILE source$
    fieldno% = FILEINFO (source$,1)
    DIM sourceNames$(fieldno%)
    FILLARRAY sourceNames$,1
    FOR i%% = 0 TO fieldno% - 1
      sourceNames$(i%%) = UCASE$ (sourceNames$(i%%))
    NEXT i%%
    DIM sourceSet AS Set 
    REDIM sourceNames$(fieldno% - 1)
    sourceSet.AddArray("sourceNames$")
    
    
    'Feldnamen der Zieldatei ermitteln  
    FILE dest$
    fieldno% = FILEINFO (dest$,1)
    DIM destNames$(fieldno%)
    FILLARRAY destNames$,1
    FOR i%% = 0 TO fieldno% - 1
      destNames$(i%%) = UCASE$ (destNames$(i%%))
    NEXT i%%

    DIM destSet AS Set
    REDIM destNames$(fieldno% - 1)
    destSet.AddArray("destNames$")
    
    destSet.Intersect(sourceSet)
 
    fieldno% = destSet.Elements.Count'Grî·e der Schnittmenge der Felder
    DIM copyNames$(fieldno% - 1)
    FOR i%% = 1 TO fieldno%
        copyNames$(i%% - 1) = destSet.Elements(i%%)
    NEXT i%%
     
    'das Zeug reinklatschen ...    
    FOR j% = 0 TO fieldno% - 1
        ON ERROR GOTO CopyRecordErr1 
        destfield$ = copyNames$(j%) + "." + dest$
        sourcefield$ = copyNames$(j%) + "." + source$
        destfield$$ = sourcefield$$
 
        'alles io
        GOTO CopyRecordNext
        
CopyRecordErr1: 
        IF jaDebug% = - 1 THEN CALL Fehler("Fehler in CopyRecord()","Ziel = " + destfield$ + "  Quelle = " + sourcefield$)
        GOTO CopyRecordNext
 
CopyRecordNext: 
        ON ERROR GOTO CopyRecordError
    NEXT j%
    
    'alles io
    CopyRecord% = - 1
    GOTO CopyRecordEnde
     
CopyRecordError: 
 'irgend etwas ist grundsÑtzlich schief gelaufen
  CALL Fehler("Fehler in CopyRecord: " + datei$, STR$ ( ERRNO ,"z") + ": " + ERR$ ( ERRNO ))
  GOTO CopyRecordEnde
 
CopyRecordEnde: 
    Superbase.ErrorTrapLabel = oldErrorLabel$
    FILE cfile$
    MOUSE ON 
 END FUNCTION 
 '***********************************************************************************************
 

FUNCTION GETDirektion%()
 REM DIM Sparten$( RECCOUNT ("SPARTEN") + 1)
 REDIM vprodukt$( RECCOUNT ("AGDIR") + 5)
 zz% = RECCOUNT ("VPRODUKT") + 2
 
 cfile$ = FILE 
 FILE "AGDIR"
 INDEX Direktion.AGDIR
 SELECT FIRST 
 IF RECCOUNT ("AGDIR") < 1 THEN 
   CALL Fehler("Es wurden noch keine Direktionen definiert!","Bitte erst die Direktionen Åber Stammdaten definieren!")
   lfdnr% = 0
   REM GOTO END Dir300820001
 END IF 
 a% = 0
 
 MOUSE OFF 
 REM IF vprodukt$( RECCOUNT ("AGDIR") + 5) <> "Ende der Liste" THEN 
 IF vprodukt$( RECCOUNT ("AGDIR") + 5) <> "Ende der ListeAGDIR1" THEN 
   WHILE NOT EOF ("AGDIR")
       IF direktion.AGDIR <> "" THEN 
         REM vprodukt$(a%) = kurzname.VPRODUKT + "/" + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
         vprodukt$(a%) = direktion.AGDIR + SPACE$ (160) + STR$ (CodeAGDIR.AGDIR,"000000")
       END IF 
       a% = a% + 1
       SET STATUS STR$ (a%,"99999") + " Direktionen geladen"
     SELECT NEXT 
   WEND 
   vprodukt$(a%) = ""
   vprodukt$( RECCOUNT ("AGDIR") + 5) = "Ende der ListeAGDIR"
 END IF 
 Auswahl$ = vprodukt$(0)
 prompt$ = vprodukt$(0)
 MOUSE ON 
 CREATE DIALOG "VTNEU",0,0,330,348,"Direktion","MS Sans Serif",8
 ADD DIALOG "VTNEU",9,2,6,24,24,2
 ADD DIALOG "VTNEU",5,44,8,245,11,0,"Bitte wÑhlen Sie die Direktion, zu der der Vermittler gehîrt:"
 ADD DIALOG "VTNEU",7,7,27,320,300,2,2,vprodukt$,Auswahl$,prompt$
 ADD DIALOG "VTNEU",1,94,330,56,14,1,"&OK",1,1
 ADD DIALOG "VTNEU",1,152,330,54,14,0,"&Abbrechen",0,0
 DIALOG "VTNEU",req%
 REMOVE DIALOG "VTNEU"
 IF req% = 1 THEN 
   nsp% = VAL ( RIGHT$ (Auswahl$(0),6))
   SELECT KEY nsp% FILE "AGDIR" INDEX codeAGDIR.AGDIR
   GETDirektion% = nsp%
 ELSE 
   GETDirektion% = - 1
 END IF 
 END FUNCTION 
  








 '***********************************************************************************
 'Versicherungsprodukte
 '*********************************************************************************** 

SUB VProd()
 CALL VProdukt1()
 END SUB 


SUB VProdukt1()
 DIM tmpgek%(10000)
 IF disabled%("PRODUKTMASKE") THEN END SUB 
 CALL DFile(3,"VProdukt" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"GEKOND" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"GEKONDM" + _fpw$)
 CALL DFile(3,"Sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"VPSPEZKO" + _fpw$)
 CALL DFile(3,"VPGEKOND" + _fpw$)
 CALL DFile(3,"FOERKOND" + _fpw$)
 CALL DFile(3,"statukey" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 MOUSE OFF 
 MOUSE ON 
 FILE "VProdukt"
 INDEX GesSpa.VPRODUKT
 SELECT WHERE FILE "vprodukt"
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT WHERE inhaus.vprodukt <> 1
 END IF 
 GInhaus% = - 1
 SELECT FIRST 
 _formend% = 0
 pagefrom% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "VPRODUKT" THEN 
     SET HEADING title$ + " - PRODUKT Formeln"
     OPEN FORM GPrjForm$ + "VPRODUKT"
     IF pagefrom% = 0 AND GCodeVP% = 0 THEN 
       FORM 6
     ELSE 
       IF Gcodevp% > 0 THEN 
         SELECT FIRST FILE "Vprodukt" INDEX codevp.vprodukt
         SELECT KEY Gcodevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
         SELECT FORM KEY Gcodevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
         Gesellschaft$ = Gesellschaft.vprodukt
         sparte$ = Sparte.vprodukt
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
           IF EXISTS (Gcodevp%,codevp.vpgekond) THEN 
             kond$ = "Sollstellungs-Konditionen Æ"
             prov$ = "Provisionen Æ"
           ELSE 
             kond$ = "Sollstellungs-Konditionen"
             prov$ = "Provisionen"
           END IF 
         END IF 
       END IF 
       IF EXISTS (codevp.vprodukt,codevp.vpspezko) THEN 
         spezko$ = "Spezialkonditionen Æ"
       ELSE 
         spezko$ = "Spezialkonditionen"
       END IF 
     END IF 
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\vprodukt.pdf"
     SET fc = Form.Controls(1)
     IF GCodevp% <> 0 THEN CALL VProdIntro()
     REM CALL MNVProd()
     SET STATUS "PRODUKT Formeln"
   END IF 
   MENU ON 
   MOUSE ON 

   IF pagefrom% = 0 THEN 
     KUVorgsub% = 0
   END IF 
   IF ag$ = "j" THEN 
    f.neu.visible = 0
    f.neu.enabled = 0
   ELSE 
    f.neu.visible = - 1
    f.neu.enabled = - 1
   END IF 
   CALL ClearKBDBuffer()
   IF PAGE <> 1 THEN 
     IF workstation% = 0 THEN SET STATUS "Anzahl Produkte: " + STR$ ( RECCOUNT ("vprodukt"),",999999")
   END IF 
   FORM 
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     f.spezialkond.enabled = 0
     f.spezialkond.visible = 0
   ELSE 
     f.spezialkond.enabled = - 1
     f.spezialkond.visible = - 1
   END IF 
   ON ERROR GOTO weit200220051
   IF gasp% = - 1
     IF workstation% > 0 THEN 
       f.noanzaspbuero.visible = 0
       f.noanzaspbuero.enabled = 0
     ELSE 
       f.noanzaspbuero.visible = - 1
       f.noanzaspbuero.enabled = - 1
     END IF 
   ELSE 
     f.noanzaspbuero.visible = 0
     f.noanzaspbuero.enabled = 0
   END IF 
weit200220051: 
   ON ERROR GOTO ErrorHandler
   MENU ON 
   FORM 
   IF PAGE = 1 THEN 
     MENU OFF 
     CALL MNVProd1()
     MENU ON 
   ELSE 
     MENU OFF 
     CALL MNVProd()
     MENU ON 
   END IF 
   IF MNdisabled%("VERTRINHAUSSEE") THEN 
     inhausfi$ = "Inhouse-Filter: keine Inhouse-Produkte"
     f.inhausfi.enabled = 0
     GInhaus% = 0
   ELSE 
     f.inhausfi.enabled = - 1
   END IF 
   IF MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") OR MNdisabled%("VERTRINHAUSSEE") THEN 
     f.inhaus.enabled = 0
     f.inhaus.readonly = - 1
   ELSE 
     f.inhaus.enabled = - 1
     f.inhaus.readonly = 0
   END IF 
   FORM 
   WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN 
     w% = PAGE 
     IF PAGE >= 2 AND PAGE <= 5 THEN 
       FORM 1
     ELSE 
       IF PAGE = 1 THEN 
         FORM 6
       ELSE 
         _formend% = 1
       END IF 
     END IF 
   END IF 
   vst% = mwst.vprodukt
   vbewert% = Bewertungsbasis.vprodukt
   SELECT CASE KUVorgsub%
     CASE 1
       IF ag$ <> "j" THEN 
         CodeVP% = CodeVP.Vprodukt
         f.vpkond.visible = - 1
         IF EXISTS (codevp%,codevp.vpspezko) THEN 
           spezko$ = "Spezialkonditionen Æ"
         ELSE 
           spezko$ = "Spezialkonditionen"
         END IF 
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
           IF EXISTS (codevp%,codevp.vpgekond) THEN 
             kond$ = "Sollstellungs-Konditionen Æ"
             prov$ = "Provisionen Æ"
           ELSE 
             kond$ = "Sollstellungs-Konditionen"
             prov$ = "Provisionen"
           END IF 
         ELSE 
           f.vpkond.visible = 0
         END IF 
         SELECT KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
         SELECT KEY codeva.vprodukt FILE "Sparten" INDEX codeva.sparten
         SELECT KEY codege.vprodukt FILE "GEADR" INDEX codege.geadr
         SELECT FORM KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
         Gesellschaft$ = Gesellschaft.vprodukt
         sparte$ = Sparte.vprodukt
         sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.vprodukt,",9999.0000"))
         st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.vprodukt,",9999.0000"))
         SET STATUS sq$ + st$
         FORM 1
         FORM 
       ELSE 
         CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
       END IF 
     CASE 2
       IF disabled%("PRODUKTNEU") THEN 
       ELSE 
         FILE "VProdukt"
         BLANK FILE "VProdukt"
         codevp% = SER ("VPRODUKT",1)
         codevp.vprodukt = codevp%
         codege.vprodukt = 0
         codeva.vprodukt = 0
         AutomNetBer.vprodukt = "j"
         gesellschaft.vprodukt = "<ohne Zuordnung>"
         sparte.vprodukt = "<ohne Zuordnung>"
         CALL QuickStore("VPRODUKT")
         INDEX gesspa.vprodukt
         SELECT FORM LAST 
         SELECT FIRST 
         SELECT FORM FIRST 
       END IF 
       REM SELECT KEY codevp% LOCK FILE "VPRODUKT" INDEX codevp.vprodukt
       FORM 
     CASE 3
       FORM 1
       pagefrom% = 0
     CASE 4
       FILE "VProdukt"
       INDEX GesSpa.VPRODUKT
       codevp% = 0
       Gcodevp% = 0
       FORM 6
       SELECT FORM FIRST 
       REM SELECT KEY codevp% FILE "Vprodukt" INDEX codevp.vprodukt
       FORM 
     CASE 5
       CALL GesFiltVP()
     CASE 6
       CALL SparteFiltVP()
     CASE 7
       REM drucken
       IF NOT disabled%("PRODUKTPRINT") THEN 
         CREATE DIALOG "ADRLIST",0,0,292,110,"Welche Liste mîchten Sie drucken?","MS Sans Serif",8
         ADD DIALOG "ADRLIST",4,0,0,290,90,0,""
         ADD DIALOG "ADRLIST",9,4,5,15,21,2
         ADD DIALOG "ADRLIST",5,10,25,238,14,0,"WÑhlen Sie eine Option aus!"
         ADD DIALOG "ADRLIST",3,10,38,234,10,0,"ProduktÅbersicht mit Berechnungsformeln",1,opt%
         ADD DIALOG "ADRLIST",3,10,71,236,10,0,"ProduktÅbersicht mit Spezialistenkonditionen",2,opt%
         ADD DIALOG "ADRLIST",1,79,91,51,14,1,"&Weiter",1,1
         ADD DIALOG "ADRLIST",1,131,91,51,14,0,"&Abbruch",0,0
         DIALOG "ADRLIST",req%
         REMOVE DIALOG "ADRLIST"
         IF req% = 1 THEN 
           IF opt% = 1 THEN 
             CALL VPRODREP()
           ELSE 
             CALL VPRODSEP()
           END IF 
         END IF 
       END IF 
       KUVorgsub% = 0
     CASE 8
       REM lîschen
       IF NOT disabled%("PRODUKTDELETE") THEN 
         ok% = - 1
         codevp% = codevp.vprodukt
         IF codevp% <> 999999 THEN 
           REQUEST "Wollen Sie das Produkt und die zugehîrigen Konditionen wirklich lîschen?","",130,req1%
         ELSE 
           req% = 0
           CALL Fehler("Dieses Produkt darf nicht gelîscht werden!","Es wird fÅr interne Programmfunktionen genutzt!")
         END IF 
         IF req1% = 1 THEN 
           MOUSE OFF 
           codevp% = Codevp.vprodukt
anf270420061: 
           IF EXISTS (Codevp.vprodukt,Codevp.kvertrag) THEN 
             IF codege.vprodukt = 0 AND codeva.vprodukt = 0 THEN 
               FILE "kvertrag"
               REQUEST "Moment bitte, Vertragsdatenbank mu· geprÅft werden...","",2
               MOUSE OFF 
               REMOVE FROM FILE "Kvertrag" WHERE codege.kvertrag = 0 AND codeva.kvertrag = 0
               FILE "Vprodukt"
               GOTO anf270420061
             ELSE 
               ok% = 0
               CALL Fehler("Das Produkt kann nicht gelîscht werden,","da VerknÅpfungen zur Vertragsdatei existieren!")
             END IF 
           END IF 
           IF ok% = - 1 THEN 
             SELECT KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
             codege% = codege.vprodukt
             codeva% = codeva.vprodukt
             SELECT REMOVE FILE "Vprodukt"
             REQUEST "Datensatz wurde in Produktdatei gelîscht!"
             IF EXISTS (codevp%,codevp.gekond) THEN 
               MOUSE OFF 
               REMOVE FROM FILE "gekond" WHERE codevp.gekond = codevp%
               REQUEST "Konditionen wurden in der Konditionsdatei gelîscht!"
             END IF 
             IF EXISTS (codevp%,codevp.gekondm) THEN 
               MOUSE OFF 
               REMOVE FROM FILE "gekondm" WHERE codevp.gekondm = codevp%
               REQUEST "Konditionen wurden in der Muster-Konditionsdatei gelîscht!"
             END IF 
             IF EXISTS (codevp%,codevp.vpgekond) THEN 
               MOUSE OFF 
               REMOVE FROM FILE "vpgekond" WHERE codevp.vpgekond = codevp%
               REQUEST "Konditionen wurden in der VP-Konditionsdatei gelîscht!"
             END IF 
           END IF 
           FILE "VProdukt"
           INDEX GesSpa.VPRODUKT
           SELECT FIRST 
           FORM 6
           SELECT FORM FIRST 
         END IF 
       END IF 
       MOUSE ON 
     CASE 9
       REM Gesellschaft zuweisen
       IF NOT disabled%("PRODUKTEDIT") THEN 
         ok% = - 1
         IF EXISTS (CodeVP.vprodukt,CodeVP.kvertrag) AND CodeVP.vprodukt > 0 THEN 
anf270420062: 
           IF EXISTS (Codevp.vprodukt,Codevp.kvertrag) THEN 
             IF codege.vprodukt = 0 AND codeva.vprodukt = 0 THEN 
               FILE "kvertrag"
               REQUEST "Moment bitte, Vertragsdatenbank mu· geprÅft werden...","",2
               MOUSE OFF 
               REMOVE FROM FILE "Kvertrag" WHERE codege.kvertrag = 0 AND codeva.kvertrag = 0
               FILE "Vprodukt"
               GOTO anf270420062
             ELSE 
               ok% = 0
               CALL Fehler("Dem Produkt kann keine Gesellschaft zugewiesen werden,","da VerknÅpfungen zur Vertragsdatei existieren!")
             END IF 
           END IF 
         ELSE 
           IF EXISTS (QCodeGEVA.vprodukt,QCodeGEVA.gekond) AND codege.vprodukt > 0 AND codeva.vprodukt > 0 THEN 
             ok% = 0
             CALL Fehler("Dem Produkt kann keine andere Gesellschaft zugewiesen werden,","da VerknÅpfungen zur Konditionsdatei existieren!")
           ELSE 
             IF codevp.vprodukt = 999999 THEN 
               ok% = 0
               CALL Fehler("Dieses Produkt darf nicht geÑndert werden!","Es wird fÅr interne Programmfunktionen genutzt!")
             END IF 
           END IF 
         END IF 
         IF ok% = - 1 THEN 
           CALL VPGeadr()
         END IF 
       END IF 
     CASE 10
       REM Sparte zuweisen
       IF NOT disabled%("PRODUKTEDIT") THEN 
         ok% = - 1
         IF EXISTS (CodeVP.vprodukt,CodeVP.kvertrag) THEN 
anf270420063: 
           IF EXISTS (Codevp.vprodukt,Codevp.kvertrag) THEN 
             IF codege.vprodukt = 0 AND codeva.vprodukt = 0 THEN 
               FILE "kvertrag"
               REQUEST "Moment bitte, Vertragsdatenbank mu· geprÅft werden...","",2
               MOUSE OFF 
               REMOVE FROM FILE "Kvertrag" WHERE codege.kvertrag = 0 AND codeva.kvertrag = 0
               FILE "Vprodukt"
               GOTO anf27042006 3
             ELSE 
               ok% = 0
               CALL Fehler("Dem Produkt kann keine andere Sparte zugewiesen werden,","da VerknÅpfungen zur Vertragsdatei existieren!")
             END IF 
           END IF 
         ELSE 
           IF EXISTS (QCodeGEVA.vprodukt,QCodeGEVA.gekond) AND codege.vprodukt > 0 AND codeva.vprodukt > 0 THEN 
             ok% = 0
             CALL Fehler("Dem Produkt kann keine andere Sparte zugewiesen werden,","da VerknÅpfungen zur Konditionsdatei existieren!")
           ELSE 
             IF codevp.vprodukt = 999999 THEN 
               ok% = 0
               CALL Fehler("Dieses Produkt darf nicht geÑndert werden!","Es wird fÅr interne Programmfunktionen genutzt!")
             END IF 
           END IF 
         END IF 
         IF ok% = - 1 THEN 
           CALL VPCodeva()
         END IF 
       END IF 
     CASE 11
       codevp% = codevp.vprodukt
       IF NOT OPEN ("kvertrag") THEN CALL DFile(3,"kvertrag" + _fpw$)
       IF EXISTS (codevp%,codevp.kvertrag) THEN 
         IF NOT disabled%("PRODUKTPRINTV") THEN 
           CALL VertrUniRep(0,0,codeva.vprodukt,codege.vprodukt,0,0,0,0,1, - 1,0)
         END IF 
       ELSE 
         CALL Fehler("Es kann leider keine VertragsÅbersicht angezeigt werden, da fÅr diese Produkt keine VertrÑge existieren!","")
       END IF 
       IF EXISTS (codevp%,codevp.vpspezko) THEN 
         spezko$ = "Spezialkonditionen Æ"
       ELSE 
         spezko$ = "Spezialkonditionen"
       END IF 
       IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         f.vpkond.visible = - 1
         IF EXISTS (codevp%,codevp.vpgekond) THEN 
           kond$ = "Sollstellungs-Konditionen Æ"
         ELSE 
           kond$ = "Sollstellungs-Konditionen"
         END IF 
       ELSE 
         f.vpkond.visible = 0
       END IF 
       SELECT KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
       SELECT FORM KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
       Gesellschaft$ = Gesellschaft.vprodukt
       sparte$ = Sparte.vprodukt
     CASE 12
       vst% = mwst.vprodukt
       REM Formel Bewertungssumme bearbeiten
       f.FoSich1.visible = - 1
       f.FoSich1.enabled = - 1
       f.FoLoe1.visible = - 1
       f.FoLoe1.enabled = - 1
       f.FoBZur1.visible = 0
       f.FoBZur1.enabled = 0
       f.FoHinzu1.visible = - 1
       f.FoHinzu1.enabled = - 1
       f.WzuFo1.visible = - 1
       f.WzuFo1.enabled = - 1
       f.WWLoe1.visible = - 1
       f.WWLoe1.enabled = - 1
       f.LoeLatZ1.visible = - 1
       f.LoeLatZ1.enabled = - 1
       f.FoBearb1.enabled = 0
       f.FoBearb1.visible = 0
       GFormBew$ = FormelBewertung.vprodukt
       ENTER 48,0
       ENTER END 
       IF KUVorgsub% = 13 THEN 
         IF GFormBew$ <> FormelBewertung.vprodukt THEN 
           FormelBewertOld.vprodukt = GFormBew$
           FBWénd.vprodukt = TODAY 
         END IF 
         CALL QuickStore("vprodukt")
         f.FoSich1.visible = 0
         f.FoSich1.enabled = 0
         f.FoLoe1.visible = 0
         f.FoLoe1.enabled = 0
         f.FoBZur1.visible = - 1
         f.FoBZur1.enabled = - 1
         f.FoHinzu1.visible = 0
         f.FoHinzu1.enabled = 0
         f.WzuFo1.visible = 0
         f.WzuFo1.enabled = 0
         f.WWLoe1.visible = 0
         f.WWLoe1.enabled = 0
         f.LoeLatZ1.visible = 0
         f.LoeLatZ1.enabled = 0
         f.FoBearb1.enabled = - 1
         f.FoBearb1.visible = - 1
       END IF 
       IF KUVorgsub% = 14 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelBewertung = ""
           IF GFormBew$ <> FormelBewertung.vprodukt THEN 
             FormelBewertOld.vprodukt = GFormBew$
             FBWénd.vprodukt = TODAY 
           END IF 
           CALL QuickStore("vprodukt")
           f.FoSich1.visible = 0
           f.FoSich1.enabled = 0
           f.FoLoe1.visible = 0
           f.FoLoe1.enabled = 0
           f.FoBZur1.visible = - 1
           f.FoBZur1.enabled = - 1
           f.FoHinzu1.visible = 0
           f.FoHinzu1.enabled = 0
           f.WzuFo1.visible = 0
           f.WzuFo1.enabled = 0
           f.WWLoe1.visible = 0
           f.WWLoe1.enabled = 0
           f.LoeLatZ1.visible = 0
           f.LoeLatZ1.enabled = 0
           f.FoBearb1.enabled = - 1
           f.FoBearb1.visible = - 1
         END IF 
       END IF 
     CASE 13
       vst% = mwst.vprodukt
       REM Formel Bewertungssumme speichern
       CALL QuickStore("vprodukt")
       f.FoSich1.visible = 0
       f.FoSich1.enabled = 0
       f.FoLoe1.visible = 0
       f.FoLoe1.enabled = 0
       f.FoBZur1.visible = - 1
       f.FoBZur1.enabled = - 1
       f.FoHinzu1.visible = 0
       f.FoHinzu1.enabled = 0
       f.WzuFo1.visible = 0
       f.WzuFo1.enabled = 0
       f.WWLoe1.visible = 0
       f.WWLoe1.enabled = 0
       f.LoeLatZ1.visible = 0
       f.LoeLatZ1.enabled = 0
     CASE 14
       vst% = mwst.vprodukt
       REM Formel Bewertungssumme lîschen
       REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         FormelBewertung = ""
         CALL QuickStore("vprodukt")
         f.FoSich1.visible = 0
         f.FoSich1.enabled = 0
         f.FoLoe1.visible = 0
         f.FoLoe1.enabled = 0
         f.FoBZur1.visible = - 1
         f.FoBZur1.enabled = - 1
         f.FoHinzu1.visible = 0
         f.FoHinzu1.enabled = 0
         f.WzuFo1.visible = 0
         f.WzuFo1.enabled = 0
         f.WWLoe1.visible = 0
         f.WWLoe1.enabled = 0
         f.LoeLatZ1.visible = 0
         f.LoeLatZ1.enabled = 0
       END IF 
       MOUSE ON 
     CASE 15
       REM Bearbeiten Formel Volumen
       f.FoSich2.visible = - 1
       f.FoSich2.enabled = - 1
       f.FoLoe2.visible = - 1
       f.FoLoe2.enabled = - 1
       f.FoBZur2.visible = 0
       f.FoBZur2.enabled = 0
       f.FoHinzu2.visible = - 1
       f.FoHinzu2.enabled = - 1
       f.WzuFo2.visible = - 1
       f.WzuFo2.enabled = - 1
       f.WWLoe2.visible = - 1
       f.WWLoe2.enabled = - 1
       f.LoeLatZ2.visible = - 1
       f.LoeLatZ2.enabled = - 1
       f.FoBearb2.enabled = 0
       f.FoBearb2.visible = 0
       ENTER 91,0
       ENTER END 
       IF KUVorgsub% = 16 THEN 
         CALL QuickStore("vprodukt")
         f.FoSich2.visible = 0
         f.FoSich2.enabled = 0
         f.FoLoe2.visible = 0
         f.FoLoe2.enabled = 0
         f.FoBZur2.visible = - 1
         f.FoBZur2.enabled = - 1
         f.FoHinzu2.visible = 0
         f.FoHinzu2.enabled = 0
         f.WzuFo2.visible = 0
         f.WzuFo2.enabled = 0
         f.WWLoe2.visible = 0
         f.WWLoe2.enabled = 0
         f.LoeLatZ2.visible = 0
         f.LoeLatZ2.enabled = 0
         f.FoBearb2.enabled = - 1
         f.FoBearb2.visible = - 1
       END IF 
       IF KUVorgsub% = 17 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelVolumen = ""
           CALL QuickStore("vprodukt")
           f.FoSich2.visible = 0
           f.FoSich2.enabled = 0
           f.FoLoe2.visible = 0
           f.FoLoe2.enabled = 0
           f.FoBZur2.visible = - 1
           f.FoBZur2.enabled = - 1
           f.FoHinzu2.visible = 0
           f.FoHinzu2.enabled = 0
           f.WzuFo2.visible = 0
           f.WzuFo2.enabled = 0
           f.WWLoe2.visible = 0
           f.WWLoe2.enabled = 0
           f.LoeLatZ2.visible = 0
           f.LoeLatZ2.enabled = 0
           f.FoBearb2.enabled = - 1
           f.FoBearb2.visible = - 1
         END IF 
       END IF 
     CASE 16
         REM Sichern Formel Volumen
         CALL QuickStore("vprodukt")
         f.FoSich2.visible = 0
         f.FoSich2.enabled = 0
         f.FoLoe2.visible = 0
         f.FoLoe2.enabled = 0
         f.FoBZur2.visible = - 1
         f.FoBZur2.enabled = - 1
         f.FoHinzu2.visible = 0
         f.FoHinzu2.enabled = 0
         f.WzuFo2.visible = 0
         f.WzuFo2.enabled = 0
         f.WWLoe2.visible = 0
         f.WWLoe2.enabled = 0
         f.LoeLatZ2.visible = 0
         f.LoeLatZ2.enabled = 0
         f.FoBearb2.enabled = - 1
         f.FoBearb2.visible = - 1
     CASE 17
         REM Lîschen Formel Volumen
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelVolumen = ""
           CALL QuickStore("vprodukt")
           f.FoSich2.visible = 0
           f.FoSich2.enabled = 0
           f.FoLoe2.visible = 0
           f.FoLoe2.enabled = 0
           f.FoBZur2.visible = - 1
           f.FoBZur2.enabled = - 1
           f.FoHinzu2.visible = 0
           f.FoHinzu2.enabled = 0
           f.WzuFo2.visible = 0
           f.WzuFo2.enabled = 0
           f.WWLoe2.visible = 0
           f.WWLoe2.enabled = 0
           f.LoeLatZ2.visible = 0
           f.LoeLatZ2.enabled = 0
           f.FoBearb2.enabled = - 1
           f.FoBearb2.visible = - 1
         END IF 
     CASE 18
       REM Bearbeiten Formel Dauer SR
       f.FoSich3.visible = - 1
       f.FoSich3.enabled = - 1
       f.FoLoe3.visible = - 1
       f.FoLoe3.enabled = - 1
       f.FoBZur3.visible = 0
       f.FoBZur3.enabled = 0
       f.FoHinzu3.visible = - 1
       f.FoHinzu3.enabled = - 1
       f.WzuFo3.visible = - 1
       f.WzuFo3.enabled = - 1
       f.WWLoe3.visible = - 1
       f.WWLoe3.enabled = - 1
       f.LoeLatZ3.visible = - 1
       f.LoeLatZ3.enabled = - 1
       f.FoBearb3.enabled = 0
       f.FoBearb3.visible = 0
       ENTER 132,0
       ENTER END 
       IF KUVorgsub% = 19 THEN 
         CALL QuickStore("vprodukt")
         f.FoSich3.visible = 0
         f.FoSich3.enabled = 0
         f.FoLoe3.visible = 0
         f.FoLoe3.enabled = 0
         f.FoBZur3.visible = - 1
         f.FoBZur3.enabled = - 1
         f.FoHinzu3.visible = 0
         f.FoHinzu3.enabled = 0
         f.WzuFo3.visible = 0
         f.WzuFo3.enabled = 0
         f.WWLoe3.visible = 0
         f.WWLoe3.enabled = 0
         f.LoeLatZ3.visible = 0
         f.LoeLatZ3.enabled = 0
         f.FoBearb3.enabled = - 1
         f.FoBearb3.visible = - 1
       END IF 
       IF KUVorgsub% = 20 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelSRDauer = ""
           CALL QuickStore("vprodukt")
           f.FoSich3.visible = 0
           f.FoSich3.enabled = 0
           f.FoLoe3.visible = 0
           f.FoLoe3.enabled = 0
           f.FoBZur3.visible = - 1
           f.FoBZur3.enabled = - 1
           f.FoHinzu3.visible = 0
           f.FoHinzu3.enabled = 0
           f.WzuFo3.visible = 0
           f.WzuFo3.enabled = 0
           f.WWLoe3.visible = 0
           f.WWLoe3.enabled = 0
           f.LoeLatZ3.visible = 0
           f.LoeLatZ3.enabled = 0
           f.FoBearb3.enabled = - 1
           f.FoBearb3.visible = - 1
         END IF 
       END IF 
     CASE 19
         CALL QuickStore("vprodukt")
         f.FoSich3.visible = 0
         f.FoSich3.enabled = 0
         f.FoLoe3.visible = 0
         f.FoLoe3.enabled = 0
         f.FoBZur3.visible = - 1
         f.FoBZur3.enabled = - 1
         f.FoHinzu3.visible = 0
         f.FoHinzu3.enabled = 0
         f.WzuFo3.visible = 0
         f.WzuFo3.enabled = 0
         f.WWLoe3.visible = 0
         f.WWLoe3.enabled = 0
         f.LoeLatZ3.visible = 0
         f.LoeLatZ3.enabled = 0
         f.FoBearb3.enabled = - 1
         f.FoBearb3.visible = - 1
     CASE 20
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelSRDauer = ""
           CALL QuickStore("vprodukt")
           f.FoSich3.visible = 0
           f.FoSich3.enabled = 0
           f.FoLoe3.visible = 0
           f.FoLoe3.enabled = 0
           f.FoBZur3.visible = - 1
           f.FoBZur3.enabled = - 1
           f.FoHinzu3.visible = 0
           f.FoHinzu3.enabled = 0
           f.WzuFo3.visible = 0
           f.WzuFo3.enabled = 0
           f.WWLoe3.visible = 0
           f.WWLoe3.enabled = 0
           f.LoeLatZ3.visible = 0
           f.LoeLatZ3.enabled = 0
           f.FoBearb3.enabled = - 1
           f.FoBearb3.visible = - 1
         END IF 
     CASE 21
       REM Bearbeiten Formel Tarif
       f.FoSich4.visible = - 1
       f.FoSich4.enabled = - 1
       f.FoLoe4.visible = - 1
       f.FoLoe4.enabled = - 1
       f.FoBZur4.visible = 0
       f.FoBZur4.enabled = 0
       f.FoHinzu4.visible = - 1
       f.FoHinzu4.enabled = - 1
       f.WzuFo4.visible = - 1
       f.WzuFo4.enabled = - 1
       f.WWLoe4.visible = - 1
       f.WWLoe4.enabled = - 1
       f.LoeLatZ4.visible = - 1
       f.LoeLatZ4.enabled = - 1
       f.FoBearb4.enabled = 0
       f.FoBearb4.visible = 0
       ENTER 173,0
       ENTER END 
       IF KUVorgsub% = 22 THEN 
         CALL QuickStore("vprodukt")
         f.FoSich4.visible = 0
         f.FoSich4.enabled = 0
         f.FoLoe4.visible = 0
         f.FoLoe4.enabled = 0
         f.FoBZur4.visible = - 1
         f.FoBZur4.enabled = - 1
         f.FoHinzu4.visible = 0
         f.FoHinzu4.enabled = 0
         f.WzuFo4.visible = 0
         f.WzuFo4.enabled = 0
         f.WWLoe4.visible = 0
         f.WWLoe4.enabled = 0
         f.LoeLatZ4.visible = 0
         f.LoeLatZ4.enabled = 0
         f.FoBearb4.enabled = - 1
         f.FoBearb4.visible = - 1
       END IF 
       IF KUVorgsub% = 23 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelTarif = ""
           CALL QuickStore("vprodukt")
           f.FoSich4.visible = 0
           f.FoSich4.enabled = 0
           f.FoLoe4.visible = 0
           f.FoLoe4.enabled = 0
           f.FoBZur4.visible = - 1
           f.FoBZur4.enabled = - 1
           f.FoHinzu4.visible = 0
           f.FoHinzu4.enabled = 0
           f.WzuFo4.visible = 0
           f.WzuFo4.enabled = 0
           f.WWLoe4.visible = 0
           f.WWLoe4.enabled = 0
           f.LoeLatZ4.visible = 0
           f.LoeLatZ4.enabled = 0
           f.FoBearb4.enabled = - 1
           f.FoBearb4.visible = - 1
         END IF 
       END IF 
     CASE 22
         CALL QuickStore("vprodukt")
         f.FoSich4.visible = 0
         f.FoSich4.enabled = 0
         f.FoLoe4.visible = 0
         f.FoLoe4.enabled = 0
         f.FoBZur4.visible = - 1
         f.FoBZur4.enabled = - 1
         f.FoHinzu4.visible = 0
         f.FoHinzu4.enabled = 0
         f.WzuFo4.visible = 0
         f.WzuFo4.enabled = 0
         f.WWLoe4.visible = 0
         f.WWLoe4.enabled = 0
         f.LoeLatZ4.visible = 0
         f.LoeLatZ4.enabled = 0
         f.FoBearb4.enabled = - 1
         f.FoBearb4.visible = - 1
     CASE 23
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelTarif = ""
           CALL QuickStore("vprodukt")
           f.FoSich4.visible = 0
           f.FoSich4.enabled = 0
           f.FoLoe4.visible = 0
           f.FoLoe4.enabled = 0
           f.FoBZur4.visible = - 1
           f.FoBZur4.enabled = - 1
           f.FoHinzu4.visible = 0
           f.FoHinzu4.enabled = 0
           f.WzuFo4.visible = 0
           f.WzuFo4.enabled = 0
           f.WWLoe4.visible = 0
           f.WWLoe4.enabled = 0
           f.LoeLatZ4.visible = 0
           f.LoeLatZ4.enabled = 0
           f.FoBearb4.enabled = - 1
           f.FoBearb4.visible = - 1
         END IF 
     CASE 24
       IF inhaus.vprodukt <> 1 THEN 
         codevp% = codevp.vprodukt
         IF NOT disabled%("PRODUKTEDIT") THEN 
           IF NOT disabled%("PRODUKTPROVI") THEN 
             FORM 7
             f.vpkond.enabled = - 1
             f.vpkond.visible = - 1
             IF EXISTS (codevp%,codevp.vpspezko) THEN 
               spezko$ = "Spezialkonditionen Æ"
             ELSE 
               spezko$ = "Spezialkonditionen"
             END IF 
             IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
               IF EXISTS (codevp%,codevp.vpgekond) THEN 
                 kond$ = "Sollstellungs-Konditionen Æ"
                 prov$ = "Provisionen Æ"
               ELSE 
                 kond$ = "Sollstellungs-Konditionen"
                 prov$ = "Provisionen"
               END IF 
               IF GAFSK$ LIKE "TRUE" THEN 
                 f.vpkond.enabled = - 1
                 f.vpkond.visible = - 1
               END IF 
             ELSE 
               REM f.kond.visible = 0
               f.vpkond.enabled = 0
               f.vpkond.visible = 0
             END IF 
             Gesellschaft$ = Gesellschaft.vprodukt
             sparte$ = Sparte.vprodukt
           END IF 
         END IF 
       ELSE 
         CALL Fehler("FÅr Inhouse-Produkte kînnen keine Konditionen erfa·t werden","")
       END IF 
       REM KUVorgsub% = 0
     CASE 25
       REM Produkt Spezialkonditionen hinterlegen
       IF inhaus.vprodukt <> 1 THEN 
         codevp1% = codevp.vprodukt
         Gcodevp% = codevp1%
         IF NOT disabled%("PRODUKTSPEZIALKOND") THEN 
           IF codege.vprodukt > 0 AND codeva.vprodukt > 0 THEN 
             IF NOT EXISTS (codevp%,codevp.vpspezko) THEN 
               REQUEST "Keine Spezialistenkonditionen zu diesem Produkt vorhanden!","Mîchten Sie welche erfassen?",130,req%
               IF req% = 1 THEN 
                 CALL VPSPEZKONeu()
               END IF 
             ELSE 
               req% = 1
             END IF 
             IF req% = 1 THEN CALL VPSpezialProv()
           ELSE 
             CALL Fehler("Sie mÅssen dem Produkt erst eine Gesellschaft und ein Sparte zuweisen,","bevor Sie Spezialkonditionen fÅr das Produkt festlegen kînnen!")
           END IF 
         END IF 
         SELECT FIRST FILE "vprodukt" INDEX codevp.vprodukt
         SELECT KEY codevp1% FILE "vprodukt" INDEX codevp.vprodukt
         pagefrom% = 1
         KUVorgsub% = 3
       ELSE 
         CALL Fehler("FÅr Inhouse-Produkte kînnen keine Konditionen erfasst werden!","")
       END IF 
     CASE 26
        REM Konditionen fÅr Produkte 12.08.2001
        codevp% = codevp.vprodukt
        IF codevp% = 999999 THEN 
          CALL Fehler("Dieses Produkt darf nicht geÑndert werden!","Es wird fÅr interne Programmfunktionen genutzt!")
          GOTO w020720051
        END IF 
        IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
          IF EXISTS (codevp%,codevp.vpgekond) THEN 
            CALL VPGekond(codevp%)
          ELSE 
            REQUEST "Es existieren noch keine Konditionen fÅr dieses Produkt!","Neue Kondition anlegen?",130,req%
            IF req% = 1 THEN 
              CALL VPGekondNeu(codevp%)
              CALL VPGekond(codevp%)
            END IF 
          END IF 
        END IF 
        SELECT KEY codevp% FILE "VPRODUKT" INDEX codevp.vprodukt
        KUVorgsub% = 0
        OPEN FORM GPrjForm$ + "VPRODUKT"
        SET f = Superbase.Form
        SET fc = Form.Controls(1)
        CALL MNVProd()
        SELECT FORM KEY codevp% FILE "VPRODUKT" INDEX codevp.vprodukt
         IF EXISTS (codevp%,codevp.vpspezko) THEN 
           spezko$ = "Spezialkonditionen Æ"
         ELSE 
           spezko$ = "Spezialkonditionen"
         END IF 
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
           IF EXISTS (codevp%,codevp.vpgekond) THEN 
             kond$ = "Sollstellungs-Konditionen Æ"
             prov$ = "Provisionen Æ"
           ELSE 
             kond$ = "Sollstellungs-Konditionen"
             prov$ = "Provisionen"
           END IF 
         ELSE 
           f.kond.visible = 0
         END IF 
         Gesellschaft$ = Gesellschaft.vprodukt
         sparte$ = Sparte.vprodukt
         REM ******************************************************************
         IF ag$ = "j" THEN 
          f.neu.visible = 0
          f.neu.enabled = 0
         ELSE 
          f.neu.visible = - 1
          f.neu.enabled = - 1
         END IF 
         IF PAGE <> 1 THEN 
           IF workstation% = 0 THEN SET STATUS "Anzahl Produkte: " + STR$ ( RECCOUNT ("vprodukt"),",999999")
         END IF 
         FORM 
         IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
           f.spezialkond.enabled = 0
           f.spezialkond.visible = 0
         ELSE 
           f.spezialkond.enabled = - 1
           f.spezialkond.visible = - 1
           f.vpkond.visible = - 1
           f.vpkond.enabled = - 1
 
         END IF 
         ON ERROR GOTO weit200504281
         IF gasp% = - 1
           IF workstation% > 0 THEN 
             f.noanzaspbuero.visible = 0
             f.noanzaspbuero.enabled = 0
           ELSE 
             f.noanzaspbuero.visible = - 1
             f.noanzaspbuero.enabled = - 1
           END IF 
         ELSE 
           f.noanzaspbuero.visible = 0
           f.noanzaspbuero.enabled = 0
         END IF 
weit200504281: 
         ON ERROR GOTO ErrorHandler 
         REM ******************************************************************

        FORM 7
w020720051: 
     CASE 27
       REM Bearbeiten BW2
       vst% = mwst.vprodukt
       REM Formel Bewertungssumme bearbeiten
       f.FoSich5.visible = - 1
       f.FoSich5.enabled = - 1
       f.FoLoe5.visible = - 1
       f.FoLoe5.enabled = - 1
       f.FoBZur5.visible = 0
       f.FoBZur5.enabled = 0
       f.FoHinzu5.visible = - 1
       f.FoHinzu5.enabled = - 1
       f.WzuFo5.visible = - 1
       f.WzuFo5.enabled = - 1
       f.WWLoe5.visible = - 1
       f.WWLoe5.enabled = - 1
       f.LoeLatZ5.visible = - 1
       f.LoeLatZ5.enabled = - 1
       f.FoBearb5.enabled = 0
       f.FoBearb5.visible = 0
       ENTER 540,0
       ENTER END 
       IF KUVorgsub% = 28 THEN 
         CALL QuickStore("vprodukt")
         f.FoSich5.visible = 0
         f.FoSich5.enabled = 0
         f.FoLoe5.visible = 0
         f.FoLoe5.enabled = 0
         f.FoBZur5.visible = - 1
         f.FoBZur5.enabled = - 1
         f.FoHinzu5.visible = 0
         f.FoHinzu5.enabled = 0
         f.WzuFo5.visible = 0
         f.WzuFo5.enabled = 0
         f.WWLoe5.visible = 0
         f.WWLoe5.enabled = 0
         f.LoeLatZ5.visible = 0
         f.LoeLatZ5.enabled = 0
         f.FoBearb5.enabled = - 1
         f.FoBearb5.visible = - 1
       END IF 
       IF KUVorgsub% = 29 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelBewertun2 = ""
           CALL QuickStore("vprodukt")
           f.FoSich5.visible = 0
           f.FoSich5.enabled = 0
           f.FoLoe5.visible = 0
           f.FoLoe5.enabled = 0
           f.FoBZur5.visible = - 1
           f.FoBZur5.enabled = - 1
           f.FoHinzu5.visible = 0
           f.FoHinzu5.enabled = 0
           f.WzuFo5.visible = 0
           f.WzuFo5.enabled = 0
           f.WWLoe5.visible = 0
           f.WWLoe5.enabled = 0
           f.LoeLatZ5.visible = 0
           f.LoeLatZ5.enabled = 0
           f.FoBearb5.enabled = - 1
           f.FoBearb5.visible = - 1
         END IF 
       END IF 
     CASE 28
       REM Speichern BW2
       vst% = mwst.vprodukt
       REM Formel Bewertungssumme speichern
       CALL QuickStore("vprodukt")
       f.FoSich5.visible = 0
       f.FoSich5.enabled = 0
       f.FoLoe5.visible = 0
       f.FoLoe5.enabled = 0
       f.FoBZur5.visible = - 1
       f.FoBZur5.enabled = - 1
       f.FoHinzu5.visible = 0
       f.FoHinzu5.enabled = 0
       f.WzuFo5.visible = 0
       f.WzuFo5.enabled = 0
       f.WWLoe5.visible = 0
       f.WWLoe5.enabled = 0
       f.LoeLatZ5.visible = 0
       f.LoeLatZ5.enabled = 0
     CASE 29
       REM Lîschen BW2
       vst% = mwst.vprodukt
       REM Formel Bewertungssumme lîschen
       REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         FormelBewertun2 = ""
         CALL QuickStore("vprodukt")
         f.FoSich5.visible = 0
         f.FoSich5.enabled = 0
         f.FoLoe5.visible = 0
         f.FoLoe5.enabled = 0
         f.FoBZur5.visible = - 1
         f.FoBZur5.enabled = - 1
         f.FoHinzu5.visible = 0
         f.FoHinzu5.enabled = 0
         f.WzuFo5.visible = 0
         f.WzuFo5.enabled = 0
         f.WWLoe5.visible = 0
         f.WWLoe5.enabled = 0
         f.LoeLatZ5.visible = 0
         f.LoeLatZ5.enabled = 0
       END IF 
       MOUSE ON 
     CASE 99
       IF NOT disabled%("PRODUKTEDIT") THEN 
         IF codevp.vprodukt = 999999 THEN 
           CALL Fehler("Dieses Produkt darf nicht geÑndert werden!","Es wird fÅr interne Programmfunktionen genutzt!")
         ELSE 
           MOUSE ON 
           KUVorgsubold% = KUVorgsub%
           KUVorgsub% = 0
           ENTER Kurzname.VPRODUKT,0
           IF KUVorgsubold% = 104 OR KUVorgsubold% = 99 THEN 
             CALL QuickStore("vprodukt")
           END IF 
         END IF 
         KUVorgsub% = 0
       END IF 
     CASE 100
       f.FoSich1.visible = 0
       f.FoSich1.enabled = 0
       f.FoLoe1.visible = 0
       f.FoLoe1.enabled = 0
       f.FoBZur1.visible = - 1
       f.FoBZur1.enabled = - 1
       f.FoHinzu1.visible = 0
       f.FoHinzu1.enabled = 0
       f.WzuFo1.visible = 0
       f.WzuFo1.enabled = 0
       f.WWLoe1.visible = 0
       f.WWLoe1.enabled = 0
       f.LoeLatZ1.visible = 0
       f.LoeLatZ1.enabled = 0
       f.FoBearb1.enabled = - 1
       f.FoBearb1.visible = - 1
       IF NOT disabled%("PRODUKTEDIT") THEN FORM 2
     CASE 101
       f.FoSich2.visible = 0
       f.FoSich2.enabled = 0
       f.FoLoe2.visible = 0
       f.FoLoe2.enabled = 0
       f.FoBZur2.visible = - 1
       f.FoBZur2.enabled = - 1
       f.FoHinzu2.visible = 0
       f.FoHinzu2.enabled = 0
       f.WzuFo2.visible = 0
       f.WzuFo2.enabled = 0
       f.WWLoe2.visible = 0
       f.WWLoe2.enabled = 0
       f.LoeLatZ2.visible = 0
       f.LoeLatZ2.enabled = 0
       f.FoBearb2.enabled = - 1
       f.FoBearb2.visible = - 1
       IF NOT disabled%("PRODUKTEDIT") THEN FORM 3
     CASE 102
       f.FoSich3.visible = 0
       f.FoSich3.enabled = 0
       f.FoLoe3.visible = 0
       f.FoLoe3.enabled = 0
       f.FoBZur3.visible = - 1
       f.FoBZur3.enabled = - 1
       f.FoHinzu3.visible = 0
       f.FoHinzu3.enabled = 0
       f.WzuFo3.visible = 0
       f.WzuFo3.enabled = 0
       f.WWLoe3.visible = 0
       f.WWLoe3.enabled = 0
       f.LoeLatZ3.visible = 0
       f.LoeLatZ3.enabled = 0
       f.FoBearb3.enabled = - 1
       f.FoBearb3.visible = - 1
       IF NOT disabled%("PRODUKTEDIT") THEN FORM 4
     CASE 103
       f.FoSich4.visible = 0
       f.FoSich4.enabled = 0
       f.FoLoe4.visible = 0
       f.FoLoe4.enabled = 0
       f.FoBZur4.visible = - 1
       f.FoBZur4.enabled = - 1
       f.FoHinzu4.visible = 0
       f.FoHinzu4.enabled = 0
       f.WzuFo4.visible = 0
       f.WzuFo4.enabled = 0
       f.WWLoe4.visible = 0
       f.WWLoe4.enabled = 0
       f.LoeLatZ4.visible = 0
       f.LoeLatZ4.enabled = 0
       f.FoBearb4.enabled = - 1
       f.FoBearb4.visible = - 1
       IF NOT disabled%("PRODUKTEDIT") THEN FORM 5
     CASE 104
       CALL QuickStore("Vprodukt")
     CASE 105
      IF inhaus.vprodukt <> 1 THEN 
       codevpab% = codevp.vprodukt
       ok% = - 1
       IF disabled%("PRODUKTERZKOND") THEN ok% = 0
       IF inhaus.vprodukt = - 1 THEN 
         CALL Fehler("FÅr ein Inhouse-Produkt kînnen keine Konditionen hinterlegt werden!","")
         ok% = 0
       END IF 
       REM Konditionen fÅr neues Produkt erzeugen
       IF NOT disabled%("PRODUKTEDIT") AND ok% = - 1 THEN 
         t1$ = "Sie erhalten aber nachfolgend noch die Mîglichkeit ein Beispielprodukt auszuwÑhlen, an Hand dessen die Konditionen fÅr das neue Produkt angelegt werden (mit ZeitrÑumen, Provisionsart und Prozenten)!"
         CALL Fehler("Es wird jetzt fÅr dieses Produkt bei jedem Mitarbeiter eine neue Kondition angelegt, falls fÅr dieses Produkt noch keine Konditionen existieren! ",t1$)
         REQUEST "Wollen Sie wirklich die Konditionen fÅr dieses Produkt","bei allen Agenturen anlegen lassen?",135,req%
         IF req% = 1 THEN 
           CALL DFile(3,"MAADR" + _fpw$)
           CALL DFile(3,"GEKOND" + _fpw$)
           codege1% = codege.vprodukt
           codeva1% = codeva.vprodukt
           codevp1% = codevp.vprodukt
           SELECT WHERE FILE "VPRODUKT"
           
           nsp% = GetVprodukt%(0,0, - 1)
           IF nsp% > 0 THEN 
             FILE "gekond"
             INDEX QCodeGEVA.gekond
             SELECT FIRST FILE "gekond" INDEX QCodeGEVA.gekond
             SELECT FIRST FILE "vprodukt" INDEX CodeVP.vprodukt
             SELECT KEY nsp% FILE "vprodukt" INDEX CodeVP.vprodukt
             tQCodeGEVA$ = STR$ (Codege.vprodukt,"000000") + STR$ (Codeva.vprodukt,"000000")
             IF NOT EXISTS (tQCodeGEVA$,QCodeGEVA.gekond) THEN 
               CALL Fehler("FÅr die gewÑhlte Vorlage wurden keine Konditionen definiert!","Bitte wÑhlen Sie als Vorlage ein Produkt, zu dem Konditionen definiert wurden!")
               GOTO endcopykond22042001
             END IF 
             tQCodeGEVATst$ = STR$ (Codege1%,"000000") + STR$ (Codeva1%,"000000")
             reqab% = 0
             von$ = ""
             IF EXISTS (tQCodeGEVATst$,QCodeGEVA.gekond) THEN 
               REM 03012006
               REM CALL Fehler("Es wurden schon Konditionen fÅr diese Produkt erfa·t!","Sie kînnen deshalb keine AutomatikÅbernahme durchfÅhren!")
               t1$ = "die noch nicht abgeschlossen wurden!"
               CALL Fehler("Es wurden schon Konditionen fÅr diese Produkt erfa·t!","Sie kînnen deshalb nur dann eine AutomatikÅbernahme durchfÅhren, wenn die schon vorhandenen Konditionen abgeschlossen werden (<Bewertungszeitraum bis> setzen), " + t1$)
               REQUEST "Wollen Sie die bereits vorhandenen Konditionen abschlie·en lassen?","",130,reqab%
               IF reqab% <> 1 THEN 
                 GOTO kondueb2811200201
               END IF 
               REM hier jetzt Dialog fÅr Datumseingabe Abschluss alter Kondition und Datum Beginn neue Kondition
               REM danach alle Konditionen mit QCodeGEVA.gekond=tQCodeGEVATst$ auf bwbis updaten
ad030120061: 
               CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
               ADD DIALOG "Konto1",9,6,7,24,22,2
               ADD DIALOG "Konto1",5,34,8,170,9,0,"Konditionserzeugung:"
               ADD DIALOG "Konto1",4,34,14,176,5,0,""
               ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, zu wann die vorhandenen Konditionen abgeschlossen werden sollen,"
               ADD DIALOG "Konto1",5,34,40,175,32,0,"die noch nicht abgeschlossen wurden und zu wann die neuen Konditionen beginnen sollen!"
               ADD DIALOG "Konto1",5,5,80,118,10,0,"Abschluss vorhandene Konditionen"
               ADD DIALOG "Konto1",6,133,79,45,11,0,0,bis$,10
               ADD DIALOG "Konto1",5,5,95,118,10,0,"Beginn neue Konditionen"
               ADD DIALOG "Konto1",6,133,95,45,11,0,0,von$,10
               ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
               ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
               DIALOG "Konto1",req%
               REMOVE DIALOG "Konto1"
               IF req% <> 1 THEN GOTO kondueb2811200201
               IF NOT DateOK%(von$) OR von$ = "" THEN 
                 CALL Fehler ("Das Datum <Beginn neue Kondition> ist nicht korrekt!","Bitte korrigieren!")
                 GOTO ad030120061
               END IF 
               IF NOT DateOK%(bis$) OR bis$ = "" THEN 
                 CALL Fehler ("Das Datum <Abschluss vorhandene Konditionen> ist nicht korrekt!","Bitte korrigieren!")
                 GOTO ad030120061
               END IF 
               FILE "gekond"
               INDEX QCodeGEVA.gekond
               SELECT FIRST FILE "gekond" INDEX QCodeGEVA.gekond
               SELECT KEY tQCodeGEVATst$ LOCK FILE "gekond" INDEX QCodeGEVA.gekond
               i% = 0
               MOUSE OFF 
               WHILE NOT EOF ("gekond") AND QCodeGEVA.gekond = tQCodeGEVATst$
                 IF QCodeGEVA.gekond = tQCodeGEVATst$ THEN 
                   IF bwbis.gekond < 1 THEN 
                     i% = i% + 1
                     bwbis.gekond = DAYS (bis$)
                     STORE FILE "gekond"
                   END IF 
                 END IF 
                 SET STATUS STR$ (i%,"9999999") + " Konditionen geschlossen"
                 SELECT NEXT LOCK FILE "gekond" INDEX QCodeGEVA.gekond
               WEND 
             END IF 
             SELECT FIRST FILE "gekond" INDEX QCodeGEVA.gekond
             SELECT KEY tQCodeGEVA$ FILE "gekond" INDEX QCodeGEVA.gekond
             REDIM tmpgek%(10000,1)
             REDIM tmpgek%(10000)
             MOUSE OFF 
             i% = 0
             IF reqab% = 1 AND von$ <> "" THEN 
               CALL Fehler("Da die Konditionen bereits existierten und abgeschlossen wurden, werden jetzt von den Vorlagekonditionen nur die NICHTABGESCHLOSSENEN Konditionen Åbernommen.","Als Beginndatum wird " + von$ + " eingetragen!")
             END IF 
             WHILE NOT EOF ("gekond") AND QCodeGEVA.gekond = tQCodeGEVA$
               IF reqab% = 1 AND von$ <> "" THEN 
                 IF bwbis.gekond < 1 THEN 
                   tmpgek%(i%) = lfdnr.gekond
                   i% = i% + 1
                 END IF 
               ELSE 
                 tmpgek%(i%) = lfdnr.gekond
                 i% = i% + 1
               END IF 
               SELECT NEXT FILE "gekond" INDEX QCodeGEVA.gekond
               SET STATUS STR$ (i%,"999999") + "  Konditionen gefunden"
             WEND 
             a% = i%
             REQUEST "Wollen Sie jetzt wirklich die Konditionen fÅr dieses Produkt","bei allen Agenturen anlegen lassen?",135,req%
             IF req% = 1 THEN 
               FOR i% = 0 TO a% - 1
                 SELECT FIRST FILE "gekond" INDEX lfdnr.gekond
                 SELECT KEY tmpgek%(i%) FILE "gekond" INDEX lfdnr.gekond
                 BLANK DUPLICATE 
                 lfdnr.gekond = SER ("gekond",1)
                 Codege.gekond = codege1%
                 codeva.gekond = codeva1%
                 codevp.gekond = codevp1%
                 IF reqab% = 1 AND von$ <> "" THEN 
                   bwvon.gekond = DAYS (von$)
                 END IF 
                 CALL MATimeStamp("gekond")
                 CALL QuickStore("gekond")
                 SET STATUS STR$ (i%,"999999") + "  Konditionen neu angelegt von " + STR$ (a% - 1,"999999")
               NEXT i%
             END IF 
             SET STATUS ""
             MOUSE ON 
             SET STATUS ""
             REQUEST "Verarbeitung beendet!"
           END IF 
kondueb2811200201: 
         END IF 

       END IF 
endcopykond22042001: 
       codevp% = codevpab%
       SELECT KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
       SELECT FORM KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
       Gesellschaft$ = Gesellschaft.vprodukt
       sparte$ = Sparte.vprodukt
      ELSE 
        CALL Fehler("FÅr Inhouse-Produkte kînnen keine Konditionen erfasst werden!","")
      END IF 
     CASE 106
      IF inhaus.vprodukt <> 1 THEN 
       codevp% = codevp.vprodukt
       REM SR fÅr Produkt zuweisen
       ok% = - 1
       IF disabled%("PRODUKTSR") THEN ok% = 0
       IF NOT disabled%("PRODUKTEDIT") AND ok% = - 1 THEN 
         CALL Fehler("Sie erhalten jetzt die Mîglichkeit, fÅr dieses Produkt die Stornoreserve und die Dauer der Stornoreserve fÅr alle Agenturen in allen Konditionen dieses Produktes auf einen einheitlichen Wert zu setzen!","")
         REQUEST "Wollen Sie wirklich die SR fÅr dieses Produkt","bei allen Agenturen anlegen lassen?",135,req%
         IF req% = 1 THEN 
           CALL DFile(3,"MAADR" + _fpw$)
           CALL DFile(3,"GEKOND" + _fpw$)
           codege1% = codege.vprodukt
           codeva1% = codeva.vprodukt
           nsp% = Codevp.vprodukt
           REM 01032001
           GOTO srmanuell010320012:
srmanuell010320011: 
           CALL Fehler("Eine Ihrer Eingaben war falsch!,"Bitte wiederholen Sie die Eingabe,beachten Sie,da· Sie nur Zahlen eintragen dÅrfen!")
srmanuell010320012: 
           CREATE DIALOG "Konto1",0,0,221,120,"SR zuweisen","MS Sans Serif",8
           ADD DIALOG "Konto1",9,6,7,24,22,2
           ADD DIALOG "Konto1",5,34,8,170,9,0,"SRzuweisen"
           ADD DIALOG "Konto1",4,34,14,176,5,0,""
           ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie die gewÅnschte SR und die Dauer der SR ein (-1 = unbegrenzte Dauer)"
           ADD DIALOG "Konto1",5,25,55,25,8,0,"SR in%"
           ADD DIALOG "Konto1",6,53,54,45,11,0,0,sr%,10
           ADD DIALOG "Konto1",5,109,55,20,8,0,"Dauer"
           ADD DIALOG "Konto1",6,136,54,45,11,0,0,haftung%,4
           ADD DIALOG "Konto1",2,34,80,148,11,0,"Stornoreserve aktivieren","j","n",SRjn$
           ADD DIALOG "Konto1",1,50,100,55,15,1,"&Weiter",1,1
           ADD DIALOG "Konto1",1,110,100,55,15,0,"&Abbruch",0,0
           DIALOG "Konto1",req%
           REMOVE DIALOG "Konto1"
           ON ERROR GOTO srmanuell010320011
           IF req% = 1 THEN 
             v1$ = "Stornoreserve aktivieren: " + srjn$ + "     Stornoreserve in %: " + STR$ (sr%,"999.0000") + "   Haftungszeitraum in Monaten: " + STR$ (haftung%,"999")
             CALL Fehler("Sie haben folgende Werte gewÑhlt:",v1$)
             REQUEST "Wollen Sie diese Werte jetzt eintragen lassen?","",135,req%
           END IF 
           ON ERROR GOTO ErrorHandler
           IF nsp% > 0 AND req% > 0 THEN 
             FILE "gekond"
             INDEX QCodeGEVA.gekond
             SELECT FIRST FILE "gekond" INDEX QCodeGEVA.gekond
             tQCodeGEVA$ = STR$ (Codege.vprodukt,"000000") + STR$ (Codeva.vprodukt,"000000")
             SELECT KEY tQCodeGEVA$ LOCK FILE "gekond" INDEX QCodeGEVA.gekond
             MOUSE OFF 
             
             WHILE NOT EOF ("gekond") AND QCodeGEVA.gekond = tQCodeGEVA$
               i% = i% + 1
               SRjn.gekond = srjn$
               sr.gekond = sr%
               haftung.gekond = Haftung%
               STORE FILE "gekond"
               UNLOCK CURRENT FILE "gekond"
               SELECT NEXT LOCK FILE "gekond" INDEX QCodeGEVA.gekond
               SET STATUS STR$ (i%,"999999") + "  Konditionen gefunden und SR eingetragen"
             WEND 
           END IF 
           ON ERROR GOTO ErrorHandler
         END IF 
       END IF 
       IF EXISTS (codevp%,codevp.vpspezko) THEN 
         spezko$ = "Spezialkonditionen Æ"
       ELSE 
         spezko$ = "Spezialkonditionen"
       END IF 
       IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         f.vpkond.visible = - 1
         IF EXISTS (codevp%,codevp.vpgekond) THEN 
           kond$ = "Sollstellungs-Konditionen Æ"
         ELSE 
           kond$ = "Sollstellungs-Konditionen"
         END IF 
       ELSE 
         f.vpkond.visible = 0
       END IF 
       SELECT KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
       SELECT FORM KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
       Gesellschaft$ = Gesellschaft.vprodukt
       sparte$ = Sparte.vprodukt
      ELSE 
       CALL Fehler("FÅr Inhouse-Produkte kînnen keine SR erfasst werden!","")
      END IF 
     CASE 107
       REM Anzeige der Statistikseite
       IF NOT disabled%("PRODSTATISTIK") THEN 
         REM FORM 5
         codevp% = codevp.vprodukt
         OPEN FORM GPrjForm$ + "STVPROD"
         CALL MNProgramm()
         SELECT KEY codevp% FILE "vprodukt" INDEX codevp.vprodukt
         REM SELECT FORM KEY codevp% FILE "vprodukt" INDEX codevp.vprodukt
         REM SELECT FORM KEY codevp% FILE "prodstik" INDEX lfdnr.prodstik
         nam1$ = Gesellschaft.VPRODUKT + "/" + Sparte.VPRODUKT
         FORM 
         _formend% = 0
         CALL ClearKBDBuffer()
         MENU ON 
         WHILE _formend% = 0
           ON ERROR GOTO ErrorHandler
           WAIT MOUSE OR KEY 
           IF k$ = CHR$ (27) THEN _formend% = 1
         WEND 
         _formend% = 0
       END IF 
     CASE 108
       REM wechseln zur Seite BW2
       f.FoSich5.visible = 0
       f.FoSich5.enabled = 0
       f.FoLoe5.visible = 0
       f.FoLoe5.enabled = 0
       f.FoBZur5.visible = - 1
       f.FoBZur5.enabled = - 1
       f.FoHinzu5.visible = 0
       f.FoHinzu5.enabled = 0
       f.WzuFo5.visible = 0
       f.WzuFo5.enabled = 0
       f.WWLoe5.visible = 0
       f.WWLoe5.enabled = 0
       f.LoeLatZ5.visible = 0
       f.LoeLatZ5.enabled = 0
       f.FoBearb5.enabled = - 1
       f.FoBearb5.visible = - 1
       IF NOT disabled%("PRODUKTEDIT") THEN FORM 8
     CASE 109
         gesfi1$ = gesfi$
         sparfi1$ = sparfi$
         gruppefi1$ = gruppefi$
         inhausfi1$ = inhausfi$
         codevaProbe% = codeva.vprodukt
         codevp% = codevp.vprodukt
         CALL CODEVA()

        SELECT KEY codevp% FILE "VPRODUKT" INDEX codevp.vprodukt
        KUVorgsub% = 0
        OPEN FORM GPrjForm$ + "VPRODUKT"
        SET f = Superbase.Form
        SET fc = Form.Controls(1)
        CALL MNVProd()
        SELECT FORM KEY codevp% FILE "VPRODUKT" INDEX codevp.vprodukt
         IF EXISTS (codevp%,codevp.vpspezko) THEN 
           spezko$ = "Spezialkonditionen Æ"
         ELSE 
           spezko$ = "Spezialkonditionen"
         END IF 
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
           IF EXISTS (codevp%,codevp.vpgekond) THEN 
             kond$ = "Sollstellungs-Konditionen Æ"
             prov$ = "Provisionen Æ"
           ELSE 
             kond$ = "Sollstellungs-Konditionen"
             prov$ = "Provisionen"
           END IF 
         ELSE 
           f.kond.visible = 0
         END IF 
         gesfi$ = gesfi1$
         sparfi$ = sparfi1$
         gruppefi$ = gruppefi1$
         inhausfi$ = inhausfi1$
         Gesellschaft$ = Gesellschaft.vprodukt
         sparte$ = Sparte.vprodukt
         REM ******************************************************************
         IF ag$ = "j" THEN 
          f.neu.visible = 0
          f.neu.enabled = 0
         ELSE 
          f.neu.visible = - 1
          f.neu.enabled = - 1
         END IF 
         IF PAGE <> 1 THEN 
           IF workstation% = 0 THEN SET STATUS "Anzahl Produkte: " + STR$ ( RECCOUNT ("vprodukt"),",999999")
         END IF 
         FORM 
         IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
           f.spezialkond.enabled = 0
           f.spezialkond.visible = 0
         ELSE 
           f.spezialkond.enabled = - 1
           f.spezialkond.visible = - 1
           f.vpkond.visible = - 1
           f.vpkond.enabled = - 1
 
         END IF 
         ON ERROR GOTO weit050820051
         IF gasp% = - 1
           IF workstation% > 0 THEN 
             f.noanzaspbuero.visible = 0
             f.noanzaspbuero.enabled = 0
           ELSE 
             f.noanzaspbuero.visible = - 1
             f.noanzaspbuero.enabled = - 1
           END IF 
         ELSE 
           f.noanzaspbuero.visible = 0
           f.noanzaspbuero.enabled = 0
         END IF 
weit050820051: 
         ON ERROR GOTO ErrorHandler 
         REM ******************************************************************
        FORM 1
     CASE 110
         gesfi1$ = gesfi$
         sparfi1$ = sparfi$
         gruppefi1$ = gruppefi$
         inhausfi1$ = inhausfi$
         cuge% = codege.vprodukt
         codevp% = codevp.vprodukt
         CALL GEADR()
        SELECT KEY codevp% FILE "VPRODUKT" INDEX codevp.vprodukt
        KUVorgsub% = 0
        OPEN FORM GPrjForm$ + "VPRODUKT"
        SET f = Superbase.Form
        SET fc = Form.Controls(1)
        CALL MNVProd()
        SELECT FORM KEY codevp% FILE "VPRODUKT" INDEX codevp.vprodukt
         IF EXISTS (codevp%,codevp.vpspezko) THEN 
           spezko$ = "Spezialkonditionen Æ"
         ELSE 
           spezko$ = "Spezialkonditionen"
         END IF 
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
           IF EXISTS (codevp%,codevp.vpgekond) THEN 
             kond$ = "Sollstellungs-Konditionen Æ"
             prov$ = "Provisionen Æ"
           ELSE 
             kond$ = "Sollstellungs-Konditionen"
             prov$ = "Provisionen"
           END IF 
         ELSE 
           f.kond.visible = 0
         END IF 
         gesfi$ = gesfi1$
         sparfi$ = sparfi1$
         gruppefi$ = gruppefi1$
         inhausfi$ = inhausfi1$
         Gesellschaft$ = Gesellschaft.vprodukt
         sparte$ = Sparte.vprodukt
         REM ******************************************************************
         IF ag$ = "j" THEN 
          f.neu.visible = 0
          f.neu.enabled = 0
         ELSE 
          f.neu.visible = - 1
          f.neu.enabled = - 1
         END IF 
         IF PAGE <> 1 THEN 
           IF workstation% = 0 THEN SET STATUS "Anzahl Produkte: " + STR$ ( RECCOUNT ("vprodukt"),",999999")
         END IF 
         FORM 
         IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
           f.spezialkond.enabled = 0
           f.spezialkond.visible = 0
         ELSE 
           f.spezialkond.enabled = - 1
           f.spezialkond.visible = - 1
           f.vpkond.visible = - 1
           f.vpkond.enabled = - 1
 
         END IF 
         ON ERROR GOTO weit050820052
         IF gasp% = - 1
           IF workstation% > 0 THEN 
             f.noanzaspbuero.visible = 0
             f.noanzaspbuero.enabled = 0
           ELSE 
             f.noanzaspbuero.visible = - 1
             f.noanzaspbuero.enabled = - 1
           END IF 
         ELSE 
           f.noanzaspbuero.visible = 0
           f.noanzaspbuero.enabled = 0
         END IF 
weit050820052: 
         ON ERROR GOTO ErrorHandler 
         REM ******************************************************************
        FORM 1
     CASE 111
       REM Filter fÅr Spartengruppen
       CALL SparteGFiltVP()
     CASE 112
       REM Produkt suchen
       IF ag$ <> "j" THEN 
         REM GetVprodukt%(0,0)
         IF GOldProdSu$ LIKE "TRUE" THEN 
           CodeVP% = GetVprodukt%(0,0,0)
         ELSE 
           CodeVP% = NewGetCodeVP%()
         END IF 
         REM CodeVP% = NewGetCodeVP%()
         IF codevp% > 0 THEN 
           f.vpkond.visible = - 1
           IF EXISTS (codevp%,codevp.vpspezko) THEN 
             spezko$ = "Spezialkonditionen Æ"
           ELSE 
             spezko$ = "Spezialkonditionen"
           END IF 
           IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
             IF EXISTS (codevp%,codevp.vpgekond) THEN 
               kond$ = "Sollstellungs-Konditionen Æ"
               prov$ = "Provisionen Æ"
             ELSE 
               kond$ = "Sollstellungs-Konditionen"
               prov$ = "Provisionen"
             END IF 
           ELSE 
             f.vpkond.visible = 0
           END IF 
           SELECT KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
           SELECT KEY codeva.vprodukt FILE "Sparten" INDEX codeva.sparten
           SELECT KEY codege.vprodukt FILE "GEADR" INDEX codege.geadr
           SELECT FORM KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
           Gesellschaft$ = Gesellschaft.vprodukt
           sparte$ = Sparte.vprodukt
           sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.vprodukt,",9999.0000"))
           st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.vprodukt,",9999.0000"))
           SET STATUS sq$ + st$
           FORM 1
           FORM 
         END IF 
       ELSE 
         CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
       END IF 
   CASE 113
     REM Vertragssuche
     codevp% = codevp.vprodukt
     CALL UnisuKv(codevp%,"codevp")
        IF FORM <> "VPRODUKT" THEN 
          OPEN FORM GPrjForm$ + "VPRODUKT"
          SET f = Superbase.Form
          SET fc = Form.Controls(1)
          CALL MNVProd()
         END IF 
         MENU ON 
         f.vpkond.visible = - 1
         IF EXISTS (codevp%,codevp.vpspezko) THEN 
           spezko$ = "Spezialkonditionen Æ"
         ELSE 
           spezko$ = "Spezialkonditionen"
         END IF 
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
           IF EXISTS (codevp%,codevp.vpgekond) THEN 
             kond$ = "Sollstellungs-Konditionen Æ"
             prov$ = "Provisionen Æ"
           ELSE 
             kond$ = "Sollstellungs-Konditionen"
             prov$ = "Provisionen"
           END IF 
         ELSE 
           f.vpkond.visible = 0
         END IF 
         SELECT KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
         SELECT KEY codeva.vprodukt FILE "Sparten" INDEX codeva.sparten
         SELECT KEY codege.vprodukt FILE "GEADR" INDEX codege.geadr
         SELECT FORM KEY codevp% LOCK FILE "Vprodukt" INDEX codevp.vprodukt
         Gesellschaft$ = Gesellschaft.vprodukt
         sparte$ = Sparte.vprodukt
         sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.vprodukt,",9999.0000"))
         st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.vprodukt,",9999.0000"))
         SET STATUS sq$ + st$
         FORM 1
         FORM 
   CASE 114
     REM Filter Inhaus
     IF NOT disabled%("VERTRINHAUSSEE") THEN 
       CALL InhausFiltVP()
     END IF 
   END SELECT 

   MOUSE ON 
   MENU OFF 
 WEND 
 REM IF ( MOD ("vprodukt") OR NEW ("vprodukt")) THEN CALL QuickStore("vprodukt")
 _formend% = 0
 VQCodeGEVA$ = ""
 Gcodevp% = 0
 GInhaus% = - 1
 GCodeGE% = 0
 GCodeVA% = 0
 GCodeGRSP% = 0
 GCodeEingGE% = 0
 SELECT WHERE FILE "vprodukt"
 END SUB 
  

SUB VPRODClick()
 ENTER END 
 FORM 1
 MOUSE ON 
 END SUB 

SUB VPRODREP()
 CALL PRep("VPRODREP")
 REM REPORT USING "VPRODREP"
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO ErrVPRODREP
 SET FIRST PAGE HEADING OFF 
 SET FIRST PAGE FOOTING OFF 
 SELECT ;
     ORDER REPORT GesSpa.VPRODUKT
     TO ASK 
 END SELECT 
ErrVPRODREP: 
 ON ERROR GOTO ErrorHandler
 END SUB 
  

SUB VPRODSEP()
 CALL PRep("VPRODSEP")
 REM REPORT USING "VPRODSEP"
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 
 
 GROUP GesSpa.VPRODUKT
 BEFORE GROUP GesSpa.VPRODUKT
     SET REPORT PAGE "H_GesSpa.VPR002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO ErrVPRODSEP
 SET FIRST PAGE HEADING OFF 
 SET FIRST PAGE FOOTING OFF 
 SELECT ;
     WHERE CodeVP.VPRODUKT = CodeVP.VPSPEZKO
     ORDER REPORT GesSpa.VPRODUKT,Agentur.VPSPEZKO
     TO ASK 
 END SELECT 
ErrVPRODSEP: 
 ON ERROR GOTO ErrorHandler
 END SUB 


SUB VProdIntro()
 MOUSE OFF 
 FILE "vprodukt"
 INDEX GesSpa.vprodukt
 SELECT FIRST 
 IF GCodevP% <> 0 THEN 
   SELECT FIRST FILE "vprodukt" INDEX CodevP.vprodukt
   SELECT FORM KEY GCodevP% FILE "vprodukt" INDEX CodevP.vprodukt

 END IF 
 FORM 
 END SUB 
 
SUB MNVProd1()
 MENU CLEAR 
 CALL MNProgramm()
 IF ag$ = "j" OR workstation% > 0 OR MNdisabled%("PRODUKTEDIT") OR MNdisabled%("VERTRBEARB") OR MNdisabled%("VERTRBEARBPOL") OR MNdisabled%("KVERTRAG") THEN 
   CALL MNHilfe(2)
 ELSE 
   MENU 2,0,1,"&Anpassungen","",""
   MENU 2,1,1,"Einheiten der betroffenen VertrÑge neu ausrechnen","ProdberEinh",""
   MENU 2,2,1,"Nettobeitrag-Bruttobeitrag der betroffenen VertrÑge neu ausrechnen","ProdberMwst",""
   CALL MNHilfe(3)
 END IF 
 END SUB 

SUB MNVProd()
 MENU CLEAR 
 CALL MNProgramm()
   CALL MNHilfe(2)
 END SUB 
 

 ' Auswahl Gesellschaft (Produkt)
 ' =======================================================================
 ' 31.07.94  - in Prozedur geÑndert
 
SUB VPGeadr()
 IF NEW ("vprodukt") OR MOD ("vprodukt") THEN CALL FStore("vprodukt")
 codevp% = codevp.vprodukt
 cuge% = CodeGE.vprodukt
 cuma% = codema.vprodukt
 IF UCASE$ ( FORM ) = "VPRODUKT" THEN 
   CALL DFile(3,"vkond" + _fpw$)
   Dateien$ = ""
   ok% = 1
   IF EXISTS (cuko%,CodeKO.VKOND) AND ok% = 0 THEN 
     ok% = 0
     Dateien$ = Dateien$ + ", VertrÑge"
     CALL Fehler("Es kann keine andere Gesellschaft zugewiesen werden,","da bereits VertrÑge, die diese Kondition benutzen an die Provisionsabrechnung Åbergeben wurden!")
   ELSE 
     IF GNeuSuGeadr$ = "j" THEN GCodieRuf1% = 0
     _cuge% = GetCodeGE%(cuge%)
     IF GNeuSuGeadr$ = "j" THEN GCODieRuf% = - 1
     IF _cuge% > 0 THEN SELECT KEY _cuge% FILE "GEADR" INDEX codege.geadr
   END IF 
 END IF 
 IF _cuge% > 0 THEN 
   qco$ = STR$ (_cuge%,"000000") + STR$ (codeva.vprodukt,"000000")
   IF EXISTS (qco$,QCodeGEVA.vprodukt) AND codege.vprodukt <> _cuge% THEN 
     CALL Fehler("Diese Produkt existiert bereits! Sie kînnen es nicht nocheinmal definieren!","Bitte wÑhlen Sie eine andere Gesellschaft!")
     _cuge% = 0
   END IF 
 END IF 
 IF _cuge% <> 0 THEN 
   MOUSE OFF 
 
   SELECT KEY codevp% LOCK FILE "vprodukt" INDEX codevp.vprodukt
   CodeGE.vprodukt = _cuge%
   Gesellschaft.vprodukt = LEFT$ (Gesellschaft.geadr,30)
   QCodeGEVA.vprodukt = STR$ (CodeGE.vprodukt,"000000") + STR$ (Codeva.vprodukt,"000000")
   GesSpa.Vprodukt = Gesellschaft.vprodukt + Sparte.vprodukt
   CALL QuickStore("vprodukt")
   FILE "vprodukt"
   INDEX gesspa.vprodukt
   SELECT FORM LAST 
   SELECT FORM FIRST 
   FORM 
   SELECT KEY codevp% FILE "vprodukt" INDEX codevp.vprodukt
   Gesellschaft$ = Gesellschaft.vprodukt
   Sparte$ = Sparte.vprodukt
   FORM 
 END IF 
 MOUSE ON 
 END SUB 
 

FUNCTION GetVprodukt%(codege%,codeva%,noinhaus%)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 REM DIM Sparten$( RECCOUNT ("SPARTEN") + 1)
 REDIM vprodukt$( RECCOUNT ("VPRODUKT") + 5)
 zz% = RECCOUNT ("VPRODUKT") + 2
 alle$ = "n"
 inhouse% = 0
AnfAlleProd200220021: 
 GetVprodukt% = 0
 cfile$ = FILE 
 FILE "Waehrung"
 INDEX codew.waehrung
 SELECT FIRST 
 REM FILE "SPARTEN"
 REM INDEX CodeVA.SPARTEN
 FILE "VPRODUKT"
 INDEX gesspa.VPRODUKT
 SELECT WHERE FILE "vprodukt"
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT WHERE inhaus.vprodukt <> 1
 END IF 
 SELECT FIRST 
 IF RECCOUNT ("vprodukt") < 1 THEN 
   CALL Fehler("Es wurden noch keine Produkte definiert!","Bitte erst die Produkte Åber Stammdaten definieren!")
   lfdnr% = 0
   GOTO lf300820001ab
 END IF 
 a% = 1
 
 MOUSE OFF 
 REM IF vprodukt$( RECCOUNT ("VPRODUKT") + 5) <> "Ende der Liste" THEN 
 IF vprodukt$( RECCOUNT ("VPRODUKT") + 5) <> "AEnde der ListeVPRODUKT" THEN 
   vprodukt$(0) = "<keine Zuordnung>" + SPACE$ (80) + "000000"
   WHILE NOT EOF ("VPRODUKT")
     IF codege.vprodukt > 0 AND codeva.vprodukt > 0 THEN 
       ok% = - 1
       IF alle$ = "n" THEN 
         IF NoAnzeige.vprodukt LIKE "j" THEN ok% = 0
       END IF 
       IF noinhaus% THEN 
         IF inhaus.vprodukt = 1 THEN ok% = 0
       END IF 
       IF inhouse% = 1 THEN 
         IF inhaus.vprodukt <> 1 THEN ok% = 0
       END IF 
       IF gasp% = - 1 AND workstation% > 0 THEN 
         IF noanzaspbuero.vprodukt LIKE "j" THEN ok% = 0
       END IF 
       IF ok% = - 1 THEN 
         IF alle$ <> "j" THEN 
           IF kurzname.vprodukt <> "" THEN 
             REM Sparten$(a%) = kurzname.VPRODUKT + "/" + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
             vprodukt$(a%) = Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + "/" + kurzname.VPRODUKT
             IF inhaus.vprodukt = 1 THEN vprodukt$(a%) = vprodukt$(a%) + " ++++INHOUSE++++ "
             vprodukt$(a%) = vprodukt$(a%) + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
           ELSE 
             vprodukt$(a%) = Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt
             IF inhaus.vprodukt = 1 THEN vprodukt$(a%) = vprodukt$(a%) + " ++++INHOUSE++++ "
             vprodukt$(a%) = vprodukt$(a%) + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
           END IF 
         ELSE 
           IF NoAnzeige.vprodukt LIKE "j" THEN 
             IF kurzname.vprodukt <> "" THEN 
               REM Sparten$(a%) = kurzname.VPRODUKT + "/" + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
               vprodukt$(a%) = "*  " + Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt + " / " + kurzname.VPRODUKT
               IF inhaus.vprodukt = 1 THEN vprodukt$(a%) = vprodukt$(a%) + " ++++INHOUSE++++ "
               vprodukt$(a%) = vprodukt$(a%) + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
             ELSE 
               vprodukt$(a%) = "*  " + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt
               IF inhaus.vprodukt = 1 THEN vprodukt$(a%) = vprodukt$(a%) + " ++++INHOUSE++++ "
               vprodukt$(a%) = vprodukt$(a%) + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
             END IF 
           ELSE 
             IF kurzname.vprodukt <> "" THEN 
               REM Sparten$(a%) = kurzname.VPRODUKT + "/" + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
               vprodukt$(a%) = "   " + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + "/" + kurzname.VPRODUKT
               IF inhaus.vprodukt = 1 THEN vprodukt$(a%) = vprodukt$(a%) + " ++++INHOUSE++++ "
               vprodukt$(a%) = vprodukt$(a%) + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
             ELSE 
               vprodukt$(a%) = "   " + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt
               IF inhaus.vprodukt = 1 THEN vprodukt$(a%) = vprodukt$(a%) + " ++++INHOUSE++++ "
               vprodukt$(a%) = vprodukt$(a%) + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
             END IF 
           END IF 
         END IF 
         a% = a% + 1
       END IF 
     END IF 
     SELECT NEXT FILE "vprodukt"
   WEND 
   vprodukt$(a%) = ""
   vprodukt$( RECCOUNT ("VPRODUKT") + 5) = "Ende der ListeVPRODUKT"
 END IF 
 Auswahl$ = vprodukt$(0)
 prompt$ = vprodukt$(0)
 IF codege% > 0 AND codeva% > 0 THEN 
   QCodeGEVA$ = STR$ (codege%,"000000") + STR$ (codeva%,"000000")
   SELECT KEY QCodeGEVA$ FILE "Vprodukt" INDEX QCodegeVA.vprodukt
   prompt$ = gesspa.vprodukt
 END IF 
 MOUSE ON 
 CREATE DIALOG "VTNEU",0,0,400,428,"Produkte","MS Sans Serif",8
 ADD DIALOG "VTNEU",9,2,6,24,24,2
 ADD DIALOG "VTNEU",5,44,8,245,11,0,"Bitte wÑhlen Sie ein Produkt:"
 ADD DIALOG "VTNEU",7,7,27,390,380,2,2,vprodukt$,Auswahl$,prompt$
 ADD DIALOG "VTNEU",1,44,410,56,14,1,"&OK",1,1
 ADD DIALOG "VTNEU",1,102,410,54,14,0,"&Abbrechen",0,0
 IF inhouse% <> 1 AND NOT noinhaus% THEN 
   IF NOT MNdisabled%("VERTRINHAUSSEE") THEN 
     ADD DIALOG "VTNEU",1,159,410,94,14,0,"Inhouse-Produkte",3,0
   END IF 
 END IF 
 ADD DIALOG "VTNEU",1,255,410,94,14,0,"Alle Produkte anzeigen",2,0
 DIALOG "VTNEU",req%
 REMOVE DIALOG "VTNEU"
 IF req% = 3 THEN 
   REDIM vprodukt$( RECCOUNT ("VPRODUKT") + 5,1)
   REDIM vprodukt$( RECCOUNT ("VPRODUKT") + 5)
   alle$ = "n"
   inhouse% = 1
   GOTO AnfAlleProd200220021
 END IF 
 IF req% = 2 THEN 
   REDIM vprodukt$( RECCOUNT ("VPRODUKT") + 5,1)
   REDIM vprodukt$( RECCOUNT ("VPRODUKT") + 5)
   alle$ = "j"
   inhouse% = 0
   GOTO AnfAlleProd200220021
 END IF 
 IF req% = 1 THEN 
   GCodieRuf% = 0
   nsp% = VAL ( RIGHT$ (Auswahl$(0),6))
   SELECT KEY nsp% FILE "vprodukt" INDEX codevp.vprodukt
   SELECT KEY codeva.vprodukt FILE "sparten" INDEX codeva.sparten
   codeva% = codeva.sparten
   SELECT KEY codege.vprodukt FILE "geadr" INDEX codege.geadr
   sparte$ = LEFT$ (sparte.sparten,60)
   ges$ = LEFT$ (Gesellschaft.geadr,30)
   codege% = codege.geadr
   codegrsp% = codegrsp.sparten
   IF codegrsp% > 0 THEN 
     SELECT KEY codegrsp% FILE "Spgruppe" INDEX codegrsp.spgruppe
     gruppe$ = Gruppe.spgruppe
   ELSE 
     gruppe$ = ""
   END IF 
   GetVprodukt% = nsp%
 ELSE 
   GetVprodukt% = 0
 END IF 
lf300820001ab: 
 END FUNCTION 
 
 

 
 








SUB VertrVPWahl()
  codevt% = lfdnr.kvertrag
  nsp% = GetVprodukt%(codege.kvertrag,codeva.kvertrag,0)
  IF nsp% > 0 THEN 
    SELECT KEY nsp% FILE "vprodukt" INDEX codevp.vprodukt
    SELECT KEY codeva.vprodukt FILE "sparten" INDEX codeva.sparten
    codeva% = codeva.sparten
    
    SELECT KEY codege.vprodukt FILE "geadr" INDEX codege.geadr
    sparte$ = sparte.sparten
    ges$ = Gesellschaft.geadr
    codege% = codege.geadr
    codegrsp% = codegrsp.sparten
    IF codegrsp% > 0 THEN 
      SELECT KEY codegrsp% FILE "Spgruppe" INDEX codegrsp.spgruppe
      gruppe$ = Gruppe.spgruppe
    ELSE 
      gruppe$ = ""
    END IF 
    SELECT KEY codevt% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
    codevp.kvertrag = nsp%
    codege.kvertrag = codege%
    codeva.kvertrag = codeva%
    codegrsp.kvertrag = codegrsp%
    SpezProvAktiv.kvertrag = "n"
    IF EXISTS (nsp%,codevp.vpspezko) THEN SpezProvAktiv.kvertrag = "j"
    CALL MATimeStamp("KVERTRAG")
    CALL QuickStore("Kvertrag")
    IF EXISTS (codevt%,codevt.spezkond) THEN 
      REMOVE FROM FILE "spezkond" WHERE codevt.spezkond = codevt%
    END IF 
   REM Einkopieren der Spezialkonditionen
   IF EXISTS (nsp%,codevp.vpspezko) THEN 
     FILE "vpspezko"
     SELECT FIRST FILE "vpspezko" INDEX codevp.vpspezko
     SELECT KEY nsp% FILE "vpspezko" INDEX codevp.vpspezko
     WHILE NOT EOF ("vpspezko") AND codevp.vpspezko = nsp%
        IF codevp.vpspezko = nsp% THEN 
          BLANK FILE "spezkond"
          a% = CopyRecord%("VPSPEZKO","SPEZKOND")
          codekey.spezkond = SER ("spezkond",1)
          codevt.spezkond = codevt%
          QCodeVTMA.SPEZKOND = STR$ (codevt.SPEZKOND,"000000") + STR$ (codema.SPEZKOND,"000000")
          STORE FILE "SPEZKOND"
          UNLOCK CURRENT FILE "spezkond"
        ELSE 
          SELECT LAST FILE "vpspezko" INDEX codevp.vpspezko
        END IF 
       SELECT NEXT FILE "vpspezko" INDEX codevp.vpspezko
     WEND 
   END IF 
   REM Ende Einkopieren der Spezialkonditionen 
  END IF 
 END SUB 

 
 
  
 
 ' Auswahl Sparte (Produkt)
 ' =======================================================================
 ' 31.07.94  - in Prozedur geÑndert
 
SUB VPCodeva()
 cuva% = CodeVA.vprodukt
 codevp% = codevp.vprodukt
 cuge% = CodeGE.vprodukt
 cuma% = codema.vprodukt
 IF NEW ("vprodukt") OR MOD ("vprodukt") THEN CALL FStore("vprodukt")
 IF UCASE$ ( FORM ) = "VPRODUKT" THEN 
   CALL DFile(3,"vkond" + _fpw$)
   Dateien$ = ""
   ok% = 1
   IF EXISTS (cuko%,CodeKO.VKOND) AND ok% = 0 THEN 
     ok% = 0
     Dateien$ = Dateien$ + ", VertrÑge"
     CALL Fehler("Es kann keine andere Sparte zugewiesen werden,","da bereits VertrÑge, die diese Kondition benutzen an die Provisionsabrechnung Åbergeben wurden!")
   ELSE 
     IF GNeuSuGeadr$ = "j" THEN GCodieRuf1% = 0
     _cuva% = GetCodeVA%(cuva%)
     IF GNeuSuGeadr$ = "j" THEN GCODieRuf% = - 1
     FILE "vprodukt"
     IF _cuva% > 0 THEN 
       SELECT KEY _cuva% FILE "Sparten" INDEX codeva.sparten
       SELECT FIRST FILE "spgruppe" INDEX codegrsp.spgruppe
       SELECT KEY codegrsp.sparten FILE "spgruppe" INDEX codegrsp.spgruppe
     END IF 
   END IF 
 END IF 
 FILE "vprodukt"
 IF _cuva% > 0 THEN 
   qco$ = STR$ (codege.vprodukt,"000000") + STR$ (_cuva%,"000000")
   IF EXISTS (qco$,QCodeGEVA.vprodukt) AND _cuva% <> codeva.vprodukt THEN 
     CALL Fehler("Diese Produkt existiert bereits! Sie kînnen es nicht nocheinmal definieren!","Bitte wÑhlen Sie eine andere Sparte!")
      _cuva% = 0
   END IF 
 END IF 
 IF _cuva% <> 0 THEN 
   MOUSE ON 
   SELECT KEY codevp% LOCK FILE "vprodukt" INDEX codevp.vprodukt
   codeva.vprodukt = _cuva%
   sparte.vprodukt = LEFT$ (Sparte.sparten,60)
   codegrsp.vprodukt = codegrsp.sparten
   Gruppe.vprodukt = Gruppe.spgruppe
   wknr.vprodukt = wknr.sparten
   mwst.vprodukt = vst.sparten
   QCodeGEVA.vprodukt = STR$ (CodeGE.vprodukt,"000000") + STR$ (Codeva.vprodukt,"000000")
   GesSpa.Vprodukt = Gesellschaft.vprodukt + Sparte.vprodukt
   CALL QuickStore("vprodukt")
   INDEX gesspa.vprodukt
   SELECT FORM LAST 
   SELECT FORM FIRST 
   FORM 
  
   SELECT KEY codevp% FILE "vprodukt" INDEX codevp.vprodukt
   Gesellschaft$ = Gesellschaft.vprodukt
   Sparte$ = Sparte.vprodukt
   FORM 
 END IF 
 MOUSE ON 
 END SUB 
 
SUB VFormelAusw()
 REM CALL Fehler("Formelauswertung","")
 fb$ = TRIM$ ( LTRIM$ (FormelBewertung.vprodukt))
 fb2$ = TRIM$ ( LTRIM$ (FormelBewertun2.vprodukt))
 fv$ = TRIM$ ( LTRIM$ (FormelVolumen.vprodukt))
 fs$ = TRIM$ ( LTRIM$ (FormelSRDauer.vprodukt))
 ft$ = TRIM$ ( LTRIM$ (FormelTarif.vprodukt))
 FOR i% = 1 TO LEN (fb$)
   IF MID$ (fb$,i%,1) <> "" THEN fb1$ = fb1$ + MID$ (fb$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (fb2$)
   IF MID$ (fb2$,i%,1) <> "" THEN fb1a$ = fb1a$ + MID$ (fb2$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (fv$)
   IF MID$ (fv$,i%,1) <> "" THEN fv1$ = fv1$ + MID$ (fv$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (fs$)
   IF MID$ (fs$,i%,1) <> "" THEN fs1$ = fs1$ + MID$ (fs$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (ft$)
   IF MID$ (ft$,i%,1) <> "" THEN ft1$ = ft1$ + MID$ (ft$,i%,1)
 NEXT i%
 REM CALL Fehler("Formelauswertung1","")
 fbew.vprodukt = ""
 start% = 0
 ende% = 0
 IF fb1$ <> "" THEN 
   pos% = 1
fbanf: 
   FOR i% = pos% TO LEN (fb1$)
     SELECT CASE MID$ (fb1$,i%,1)
     CASE "("
       kl% = kl% + 1
       fbew.vprodukt = fbew.vprodukt + MID$ (fb1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fbew.vprodukt = fbew.vprodukt + MID$ (fb1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fb1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fbew.vprodukt = fbew.vprodukt + MID$ (fb1$,i%,1)
       pos% = i%
     CASE ","
       fbew.vprodukt = fbew.vprodukt + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
     mmm$ = fbew.vprodukt
   NEXT i%
   

FBewCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fb1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fbew.vprodukt = fbew.vprodukt + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fbew.vprodukt = fbew.vprodukt + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fbew.vprodukt = fbew.vprodukt + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fbew.vprodukt = fbew.vprodukt + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fbew.vprodukt = fbew.vprodukt + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fbew.vprodukt = fbew.vprodukt + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fbew.vprodukt = fbew.vprodukt + "nettobeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fbew.vprodukt = fbew.vprodukt + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fbew.vprodukt = fbew.vprodukt + MID$ (fb1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fb1$) THEN GOTO fbanf 
   ff$ = fbew.vprodukt
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("Bewertungssumme:  PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
FBewEnde: 
 END IF 


 fbew2.vprodukt = ""
 start% = 0
 ende% = 0
 IF fb1a$ <> "" THEN 
   pos% = 1
fbanfa: 
   FOR i% = pos% TO LEN (fb1a$)
     SELECT CASE MID$ (fb1a$,i%,1)
     CASE "("
       kl% = kl% + 1
       fbew2.vprodukt = fbew2.vprodukt + MID$ (fb1a$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fbew2.vprodukt = fbew2.vprodukt + MID$ (fb1a$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fb1a$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fbew2.vprodukt = fbew2.vprodukt + MID$ (fb1a$,i%,1)
       pos% = i%
     CASE ","
       fbew2.vprodukt = fbew2.vprodukt + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
FBew2Create: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fb1a$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fbew2.vprodukt = fbew2.vprodukt + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fbew2.vprodukt = fbew2.vprodukt + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fbew2.vprodukt = fbew2.vprodukt + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fbew2.vprodukt = fbew2.vprodukt + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fbew2.vprodukt = fbew2.vprodukt + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fbew2.vprodukt = fbew2.vprodukt + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fbew2.vprodukt = fbew2.vprodukt + "nettobeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fbew2.vprodukt = fbew2.vprodukt + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fbew.vprodukt = fbew.vprodukt + MID$ (fb1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fb1a$) THEN GOTO fbanfa 
   ff$ = fbew2.vprodukt
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel Bewertung 2! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
FBew2Ende: 
 END IF 
 



 REM CALL Fehler("Fo3","")
 fvol.vprodukt = ""
 start% = 0
 ende% = 0
 IF fv1$ <> "" THEN 
   pos% = 1
fvol: 
   FOR i% = pos% TO LEN (fv1$)
     SELECT CASE MID$ (fv1$,i%,1)
     CASE "("
       kl% = kl% + 1
       fvol.vprodukt = fvol.vprodukt + MID$ (fv1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fvol.vprodukt = fvol.vprodukt + MID$ (fv1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fv1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fvol.vprodukt = fvol.vprodukt + MID$ (fv1$,i%,1)
       pos% = i%
     CASE ","
       fvol.vprodukt = fvol.vprodukt + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
FVolCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fv1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fvol.vprodukt = fvol.vprodukt + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fvol.vprodukt = fvol.vprodukt + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fvol.vprodukt = fvol.vprodukt + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fvol.vprodukt = fvol.vprodukt + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fvol.vprodukt = fvol.vprodukt + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fvol.vprodukt = fvol.vprodukt + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fvol.vprodukt = fvol.vprodukt + "NettoBeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fvol.vprodukt = fvol.vprodukt + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fvol.vprodukt = fvol.vprodukt + MID$ (fv1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fv1$) THEN GOTO fvol 
   ff$ = fvol.vprodukt
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
FVolEnde: 
 END IF 

 fsrd.vprodukt = ""
 start% = 0
 ende% = 0
 IF fs1$ <> "" THEN 
   pos% = 1
fsranf: 
   FOR i% = pos% TO LEN (fs1$)
     SELECT CASE MID$ (fs1$,i%,1)
     CASE "("
       kl% = kl% + 1
       fsrd.vprodukt = fsrd.vprodukt + MID$ (fs1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fsrd.vprodukt = fsrd.vprodukt + MID$ (fs1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fs1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fsrd.vprodukt = fsrd.vprodukt + MID$ (fs1$,i%,1)
       pos% = i%
     CASE ","
       fsrd.vprodukt = fsrd.vprodukt + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
FsrCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fs1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fsrd.vprodukt = fsrd.vprodukt + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fsrd.vprodukt = fsrd.vprodukt + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fsrd.vprodukt = fsrd.vprodukt + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fsrd.vprodukt = fsrd.vprodukt + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fsrd.vprodukt = fsrd.vprodukt + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fsrd.vprodukt = fsrd.vprodukt + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fsrd.vprodukt = fsrd.vprodukt + "NettoBeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fsrd.vprodukt = fsrd.vprodukt + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fsrd.vprodukt = fsrd.vprodukt + MID$ (fs1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fs1$) THEN GOTO fsranf 
   ff$ = fsrd.vprodukt
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
FsrEnde: 
 END IF 

 ftar.vprodukt = ""
 start% = 0
 ende% = 0
 IF ft1$ <> "" THEN 
   pos% = 1
ftanf: 
   FOR i% = pos% TO LEN (ft1$)
     SELECT CASE MID$ (ft1$,i%,1)
     CASE "("
       kl% = kl% + 1
       ftar.vprodukt = ftar.vprodukt + MID$ (ft1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       ftar.vprodukt = ftar.vprodukt + MID$ (ft1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (ft1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       ftar.vprodukt = ftar.vprodukt + MID$ (ft1$,i%,1)
       pos% = i%
     CASE ","
       ftar.vprodukt = ftar.vprodukt + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
FtCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (ft1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       ftar.vprodukt = ftar.vprodukt + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       ftar.vprodukt = ftar.vprodukt + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       ftar.vprodukt = ftar.vprodukt + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       ftar.vprodukt = ftar.vprodukt + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       ftar.vprodukt = ftar.vprodukt + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       ftar.vprodukt = ftar.vprodukt + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       ftar.vprodukt = ftar.vprodukt + "NettoBeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       ftar.vprodukt = ftar.vprodukt + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM ftar.vprodukt = ftar.vprodukt + MID$ (ft1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (ft1$) THEN GOTO ftanf 
   ff$ = ftar.vprodukt
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
FtEnde: 
 END IF 
 

 END SUB 
 

SUB GesFiltVP()
   a% = RECCOUNT ("Vprodukt")
   REDIM vprodukt$( RECCOUNT ("Vprodukt") + 5)
   vprodukt$( RECCOUNT ("Vprodukt") + 5) = ""
   IF a% < 1 THEN END SUB 
   DIM Waehrung$(a%)
   DIM Waehrung%(a%)
   FOR i% = 1 TO a%
     Waehrung$(i%) = ""
     Waehrung%(i%) = 0
   NEXT i%
   FILE "Vprodukt"
   INDEX codege.Vprodukt
   REM SELECT WHERE 
   SELECT FIRST 
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   codegeold% = - 1
   WHILE NOT EOF ("Vprodukt")
     IF codege.vprodukt > 0 AND codege.vprodukt <> codegeold% THEN 
       codege% = codege.Vprodukt
       codegeold% = codege.Vprodukt
       j% = - 1
       REM FOR i% = 0 TO a%
         REM IF Waehrung%(i%) = codege% THEN i% = a% + 5000
       REM NEXT i%
       REM b% = a% + 5000
       REM IF i% < b% THEN 
         a% = a% + 1
         Waehrung%(a%) = codege%
         REM SELECT FIRST FILE "Vprodukt" INDEX codege.Vprodukt
         REM SELECT KEY codege% FILE "Vprodukt" INDEX codege.Vprodukt
         REM IF gesellschaft.geadr LIKE "Colo*" THEN CALL Fehler(gesellschaft.geadr, STR$ (codege.geadr,"000000"))
         Waehrung$(a%) = Gesellschaft.Vprodukt + SPACE$ (90) + STR$ (codege%,"000000")
       REM END IF 
     END IF 
     SELECT NEXT FILE "Vprodukt" INDEX codege.Vprodukt
   WEND 
   
   DIM Auswahl1$(1)
     FILE "Vprodukt"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,204,"Gesellschaft","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,183,0," Auswahl Gesellschaft"
      ADD DIALOG "PREISLIS",7,5,12,169,175,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,185,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,185,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "vprodukt"
        GCodeGE% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeGE% = 999999 THEN GCodeGE% = 0
        IF (GCodeGE% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          
          gesfi$ = "Ges: " + ausw1$
        ELSE 
          gesfi$ = "Gesellschaft Filter: "
        END IF 
      END IF 
      bef$ = "Select where CodeVP.Vprodukt > 0 "
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.Vprodukt = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.Vprodukt = GCodeGE%"
      END IF 
      IF GCodeGRSP% > 0 THEN 
        bef$ = bef$ + " AND CodeGRSP.vprodukt = GCodeGRSP%"
      END IF 
      IF GInhaus% >= 0 THEN 
        bef$ = bef$ + " and inhaus.vprodukt=GInhaus%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 REM SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 SELECT FORM FIRST 
 FORM 
 
 END SUB 


SUB InhausFiltVP()
   a% = RECCOUNT ("Vprodukt")
   REDIM vprodukt$( RECCOUNT ("Vprodukt") + 5)
   vprodukt$( RECCOUNT ("Vprodukt") + 5) = ""
   IF a% < 1 THEN END SUB 
   DIM Waehrung$(a%,1)
   DIM Waehrung%(a%,1)
   REDIM Waehrung$(a%)
   REDIM Waehrung%(a%)
   FILE "Vprodukt"
   INDEX codege.Vprodukt
   REM SELECT WHERE 
   SELECT FIRST 
   a% = 0
   Waehrung%(0) = 999999
   Waehrung$(0) = " kein Filter"
   Waehrung$(1) = " keine Inhouse-Produkte"
   Waehrung$(2) = " nur Inhouse-Produkte"
 
   DIM Auswahl1$(1)
     FILE "Vprodukt"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,204,"Inhouse-Produkte","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,183,0," Auswahl Gesellschaft"
      ADD DIALOG "PREISLIS",7,5,12,169,175,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,185,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,185,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT CASE Auswahl1$(0)
        CASE " kein Filter"
          GInhaus% = - 1
          inhausfi$ = "Inhouse-Filter:"
        CASE " keine Inhouse-Produkte"
          GInhaus% = 0
          inhausfi$ = "Inhouse-Filter: keine Inhouse-Produkte"
        CASE " nur Inhouse-Produkte"
          GInhaus% = 1
          inhausfi$ = "Inhouse-Filter: nur Inhouse-Produkte"
        END SELECT 
      END IF 
      bef$ = "Select where CodeVP.Vprodukt > 0 "
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.Vprodukt = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.Vprodukt = GCodeGE%"
      END IF 
      IF GCodeGRSP% > 0 THEN 
        bef$ = bef$ + " AND CodeGRSP.vprodukt = GCodeGRSP%"
      END IF 
      IF GInhaus% >= 0 THEN 
        bef$ = bef$ + " and inhaus.vprodukt=GInhaus%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 REM SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 SELECT FORM FIRST 
 FORM 
 
 END SUB 


 
SUB SparteFiltVP()
   REDIM vprodukt$( RECCOUNT ("Vprodukt") + 5)
   vprodukt$( RECCOUNT ("Vprodukt") + 5) = ""
   a% = RECCOUNT ("vprodukt")
   IF a% < 1 THEN END SUB 
   DIM Waehrung$(a%)
   DIM Waehrung%(a%)
   FOR i% = 1 TO a%
     Waehrung$(i%) = ""
     Waehrung%(i%) = 0
   NEXT i%
   FILE "vprodukt"
   INDEX codeva.vprodukt
   REM SELECT WHERE 
   SELECT FIRST 
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   codevaold% = - 1
   WHILE NOT EOF ("vprodukt")
     IF codeva.vprodukt > 0 AND codeva.vprodukt <> codevaold% THEN 
       codeva% = codeva.vprodukt
       codevaold% = codeva.vprodukt
       a% = a% + 1
       Waehrung%(a%) = codeva%
       Waehrung$(a%) = sparte.vprodukt + SPACE$ (90) + STR$ (codeva%,"000000")
     END IF 
     SELECT NEXT FILE "vprodukt" INDEX codeva.vprodukt
   WEND 
   
   DIM Auswahl1$(1)
     FILE "vprodukt"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,284,"Sparte","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,257,0," Auswahl Sparte"
      ADD DIALOG "PREISLIS",7,5,14,169,245,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,265,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,265,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "vprodukt"
        GCodeVA% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeVA% = 999999 THEN GCodeVA% = 0
        IF (GCodeVA% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          sparfi$ = "Sparte: " + ausw1$
        ELSE 
          sparfi$ = "Sparte-Filter: "
        END IF 
      END IF 
      bef$ = "Select where codevp.vprodukt > 0"
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.vprodukt = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.vprodukt = GCodeGE%"
      END IF 
      IF GCodeGRSP% > 0 THEN 
        bef$ = bef$ + " AND CodeGRSP.vprodukt = GCodeGRSP%"
      END IF 
      IF GInhaus% >= 0 THEN 
        bef$ = bef$ + " and inhaus.vprodukt=GInhaus%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM FIRST 
 FORM 
 
 END SUB 
 
SUB SparteGFiltVP()
   REDIM vprodukt$( RECCOUNT ("Vprodukt"),1)
   REDIM vprodukt$( RECCOUNT ("Vprodukt") + 5)
   vprodukt$( RECCOUNT ("Vprodukt") + 5) = ""
   a% = RECCOUNT ("vprodukt")
   IF a% < 1 THEN END SUB 
   DIM Waehrung$(a%,1)
   DIM Waehrung%(a%,1)
   REDIM Waehrung$(a%)
   REDIM Waehrung%(a%)
   REM FOR i% = 1 TO a%
     REM Waehrung$(i%) = ""
     REM Waehrung%(i%) = 0
   REM NEXT i%
   FILE "vprodukt"
   INDEX codegrsp.vprodukt
   REM SELECT WHERE 
   SELECT FIRST 
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   codegrspold% = - 1
   WHILE NOT EOF ("vprodukt")
     IF codegrsp.vprodukt <> codegrspold% THEN 
       codegrsp% = codegrsp.vprodukt
       codegrspold% = codegrsp.vprodukt
       a% = a% + 1
       Waehrung%(a%) = codegrsp%
       Waehrung$(a%) = gruppe.vprodukt + SPACE$ (90) + STR$ (codegrsp%,"000000")
     END IF 
     SELECT NEXT FILE "vprodukt" INDEX codegrsp.vprodukt
   WEND 
   
   DIM Auswahl1$(1)
     FILE "vprodukt"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,184,"Spartengruppen","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,157,0," Auswahl Sparte"
      ADD DIALOG "PREISLIS",7,5,14,169,145,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,165,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,165,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "vprodukt"
        GCodeGRSP% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeGRSP% = 999999 THEN GCodeGRSP% = 0
        IF (GCodeGRSP% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          gruppefi$ = "SP-Gruppe: " + ausw1$
        ELSE 
          gruppefi$ = "SP-Gruppe-Filter: "
        END IF 
      END IF 
      bef$ = "Select where codevp.vprodukt > 0"
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.vprodukt = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.vprodukt = GCodeGE%"
      END IF 
      bef$ = "Select where codevp.vprodukt > 0"
      IF GCodeGRSP% > 0 THEN 
        bef$ = bef$ + " AND CodeGRSP.vprodukt = GCodeGRSP%"
      END IF 
      IF GInhaus% >= 0 THEN 
        bef$ = bef$ + " and inhaus.vprodukt=GInhaus%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM FIRST 
 FORM 
 
 END SUB 
 
 


 
 REM **********************************************************
 REM ******       Suche ZahlungsempfÑnger              ********
 REM **********************************************************
 
SUB VermZEmpf()
   codeverm% = CodeVerm.vermoeg
   knr% = Codeku.GAdrDat$
   ze% = ADRSuche%(0)
   IF ze% <> 0 THEN 
     SELECT KEY codeverm% LOCK FILE "Vermoeg" INDEX codeverm.vermoeg
     SELECT KEY ze% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     coderku.vermoeg = ze%
     RNachname.vermoeg = Nachname.GAdrDat$
     RGeburtsname.vermoeg = Geburtsname.GAdrDat$
     RVorname.vermoeg = Vorname.GAdrDat$
     RStra·e.vermoeg = Stra·e.GAdrDat$
     RTitel.vermoeg = Titel.GAdrDat$
     RAnrede.vermoeg = Anrede.GAdrDat$
     RPLZ.vermoeg = PLZ.GAdrDat$
     ROrt.vermoeg = Ort.GAdrDat$
     RBank.vermoeg = K1Bank.GAdrDat$
     RBLZ.vermoeg = K1BLZ.GAdrDat$
     RKonto.vermoeg = K1Konto.GAdrDat$
     CALL QuickStore("VERMOEG")
     f.rn.visible = - 1
     f.rv.visible = - 1
     f.rg.visible = - 1
     f.rs.visible = - 1
     f.rp.visible = - 1
     f.ro.visible = - 1
     f.rb.visible = - 1
     f.rblz.visible = - 1
     f.rk.visible = - 1
 
       f.rn.enabled = - 1
       f.rv.enabled = - 1
       f.rg.enabled = - 1
       f.rs.enabled = - 1
       f.rp.enabled = - 1
       f.ro.enabled = - 1
       f.rb.enabled = - 1
       f.rblz.enabled = - 1
       f.rk.enabled = - 1
 
   END IF 
   SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 END SUB 
 
SUB VermNeu(codeku%)
  SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
  FILE "Vermoeg"
     REQUEST "Zahlungseingang (Haben)-Buchung erfassen?","",130,req%
     BLANK FILE "VERMOEG"
     codeverm% = SER ("VERMOEG",1)
     codeverm.vermoeg = CodeVerm%
     codeku.vermoeg = codeku%
     Nachname.vermoeg = Nachname.GAdrDat$
     Geburtsname.vermoeg = Geburtsname.GAdrDat$
     Vorname.vermoeg = Vorname.GAdrDat$
     Stra·e.vermoeg = Stra·e.GAdrDat$
     Titel.vermoeg = Titel.GAdrDat$
     Anrede.vermoeg = Anrede.GAdrDat$
     PLZ.vermoeg = PLZ.GAdrDat$
     Ort.vermoeg = Ort.GAdrDat$
     K1Bank.vermoeg = K1Bank.GAdrDat$
     K1BLZ.vermoeg = K1BLZ.GAdrDat$
     K1Konto.vermoeg = K1Konto.GAdrDat$
     zero.vermoeg = 0
     IF req% = 1 THEN 
       sh.vermoeg = "H"
     ELSE 
       sh.vermoeg = "S"
     END IF 
     gezahltam.vermoeg = TODAY 
     CALL QuickStore("VERMOEG")
     IF req% <> 1 THEN 
       CALL Fehler("Sie mÅssen jetzt der Sollbuchung einen ZahlungsempfÑnger zuweisen!","")
       SELECT FIRST FILE "VERMOEG" INDEX codeverm.vermoeg
       SELECT KEY codeverm% LOCK FILE "VERMOEG" INDEX codeverm.vermoeg
       CALL VermZEmpf()
     END IF 
     REM f.rn.visible = 0
     REM f.rv.visible = 0
     REM f.rg.visible = 0
     REM f.rs.visible = 0
     REM f.rp.visible = 0
     REM f.ro.visible = 0
     REM f.rb.visible = 0
     REM f.rblz.visible = 0
     REM f.rk.visible = 0
    REM FORM 2
 END SUB 
 
 
SUB VermoegLoe(codeverm%)
  knr% = codeku.vermoeg
  REMOVE FROM FILE "vermoeg" WHERE codeverm.vermoeg = codeverm%
  IF EXISTS (knr%,codeku.vermoeg) THEN 
    SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
    FORM 1
  ELSE 
    CALL Fehler("Keine weiteren Zahlungsein-/ausgÑnge zur Vermîgensverwaltung vorhanden!","")
    FORM 1
  END IF 
 END SUB 
 
 
SUB VermDruckALL()
 codeku% = codeku.GAdrDat$
 path1$ = DIRECTORY 
 
 opt% = 1
 CREATE DIALOG "ADRLIST",0,0,281,123,"WÑhlen Sie den Ausdruck","MS Sans Serif",8
 ADD DIALOG "ADRLIST",4,0,0,272,102,0,""
 ADD DIALOG "ADRLIST",9,4,9,20,21,2
 ADD DIALOG "ADRLIST",5,30,22,238,14,0,"WÑhlen Sie eine Option aus!"
 ADD DIALOG "ADRLIST",3,30,37,236,10,0,"ZahlungseingÑnge",1,opt%
 ADD DIALOG "ADRLIST",3,30,48,234,11,0,"Auszahlungen",2,opt%
 ADD DIALOG "ADRLIST",1,77,105,51,15,1,"&Weiter",1,1
 ADD DIALOG "ADRLIST",1,129,105,51,15,0,"&Abbruch",0,0
 DIALOG "ADRLIST",req%
 REMOVE DIALOG "ADRLIST"
 
 IF req% = 1 THEN 
   REM DIRECTORY _ppath$
   IF opt% = 1 THEN 
     CALL PRep("VERME")
     BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
     END FOOTING 
 
     GROUP CodeKU.ADRESSEN,Betrag.VERMOEG AS "summe%",CodeVerm.VERMOEG AS "anzahl%"
     BEFORE GROUP CodeKU.ADRESSEN
     SET REPORT PAGE "H_CodeKU.ADR003"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP CodeKU.ADRESSEN
     SET REPORT PAGE "F_CodeKU.ADR003"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
     ON ERROR GOTO vermdruend1503001
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     SET FIRST PAGE HEADING OFF 
     SELECT ;
     WHERE CodeKU.ADRESSEN = CodeKU.VERMOEG AND codeku.vermoeg = codeku% AND sh.vermoeg = "H"
     ORDER REPORT gezahltam.VERMOEG
     TO ASK 
     END SELECT 
   ELSE 
     CALL PRep("VERMA")
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
     END FOOTING 
 
     GROUP CodeKU.ADRESSEN,Betrag.VERMOEG AS "summe%",CodeVerm.VERMOEG AS "anzahl%"
     BEFORE GROUP CodeKU.ADRESSEN
     SET REPORT PAGE "H_CodeKU.ADR003"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP CodeKU.ADRESSEN
     SET REPORT PAGE "F_CodeKU.ADR003"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
     ON ERROR GOTO vermdruend1503001
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     SELECT ;
     WHERE CodeKU.ADRESSEN = CodeKU.VERMOEG AND codeku.adressen = codeku% AND sh.vermoeg = "S"
     ORDER REPORT gezahltam.VERMOEG
     TO ASK 
     END SELECT 
   END IF 
 END IF 
vermdruend1503001: 
 ON ERROR GOTO ErrorHandler
 DIRECTORY path1$
 SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
 SELECT FORM KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
 SELECT KEY codeku% FILE "VERMOEG" INDEX codeku.VERMOEG
 SELECT FORM KEY codeku% FILE "VERMOEG" INDEX codeku.VERMOEG
 FORM 
 END SUB 
 
 
SUB SpartFoTest()
  formel$ = FormelBewert.sparten
  l% = LEN (formel$)
  FOR i% = 1 TO l%
 
  NEXT i%
 END SUB 
 
 
SUB FeldzuFo()
  FormelBewert.sparten = FormelBewert.sparten + Felder$
  f.felder.enabled = 0
  f.tfeld.enabled = 0
  f.null.enabled = 0
  f.eins.enabled = 0
  f.zwei.enabled = 0
  f.drei.enabled = 0
  f.vier.enabled = 0
  f.fÅnf.enabled = 0
  f.sechs.enabled = 0
  f.sieben.enabled = 0
  f.acht.enabled = 0
  f.neun.enabled = 0
  f.twert.enabled = 0
  f.twertloe.enabled = 0
  f.plmin.enabled = 0
  f.komma.enabled = 0
  f.durch.enabled = - 1
  f.mal.enabled = - 1
  f.minus.enabled = - 1
  f.plus.enabled = - 1
  FORM 
 END SUB 
 
SUB PressOpera(operator$)
  FormelBewert.sparten = FormelBewert.sparten + operator$
  f.felder.enabled = - 1
  f.tfeld.enabled = - 1
  f.null.enabled = - 1
  f.eins.enabled = - 1
  f.zwei.enabled = - 1
  f.drei.enabled = - 1
  f.vier.enabled = - 1
  f.fÅnf.enabled = - 1
  f.sechs.enabled = - 1
  f.sieben.enabled = - 1
  f.acht.enabled = - 1
  f.neun.enabled = - 1
  f.twert.enabled = - 1
  f.twertloe.enabled = - 1
  f.plmin.enabled = - 1
  f.komma.enabled = - 1
  f.durch.enabled = 0
  f.mal.enabled = 0
  f.minus.enabled = 0
  f.plus.enabled = 0
  FORM 
 END SUB 
 
 
SUB WertzuFo()
 FormelBewert = FormelBewert + "<" + wert1$ + ">":wert1$ = ""
  f.felder.enabled = 0
  f.tfeld.enabled = 0
  f.null.enabled = 0
  f.eins.enabled = 0
  f.zwei.enabled = 0
  f.drei.enabled = 0
  f.vier.enabled = 0
  f.fÅnf.enabled = 0
  f.sechs.enabled = 0
  f.sieben.enabled = 0
  f.acht.enabled = 0
  f.neun.enabled = 0
  f.twert.enabled = 0
  f.twertloe.enabled = 0
  f.plmin.enabled = 0
  f.komma.enabled = 0
  f.durch.enabled = - 1
  f.mal.enabled = - 1
  f.minus.enabled = - 1
  f.plus.enabled = - 1
  FORM 
 END SUB 
 
SUB PSelectNextVA()
 MOUSE OFF 
 SET STATUS "NÑchster Datensatz wird gesucht..."
 codevaold% = codeva.sparten
 SELECT FORM NEXT 
 IF codevaold% <> codeva.sparten THEN cuva% = codeva.sparten
 IF EOF ("sparten") THEN REQUEST "Letzter Datensatz","",2
 SET STATUS "Bereit"
 MOUSE ON 
 FORM 
 END SUB 
 
SUB PSelectPrevVA()
 MOUSE OFF 
 ON ERROR GOTO ErrorHandler
 SET STATUS "Vorheriger Datensatz wird gesucht..."
 codevaold% = codeva.sparten
 SELECT FORM PREVIOUS 
 IF codevaold% <> codeva.sparten THEN cuva% = codeva.sparten
 IF EOF ("sparten") THEN REQUEST "Erster Datensatz","",2
 SET STATUS "Bereit"
 MOUSE ON 
 FORM 
 END SUB 
 
 
 '***********************************************************************************
 'VorgÑnge des aktuellen Kunden anzeigen
 '***********************************************************************************
 
SUB KUVorgang()
 REM IF disabled%("EINGANG") THEN END SUB 
 REM CALL DFile(3,"ZEINGAN1" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 FILE "Vorgang"
 INDEX codeku.vorgang
 SELECT FIRST 
 knr% = codeku.GAdrDat$
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL FStore(GAdrDat$)
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "KU-VORG" THEN 
     SET HEADING title$ + " - VorgÑnge"
     OPEN FORM GPrjForm$ + "KU-VORG"
     SET f = Superbase.Form
     CALL KUVorgIntro1()
     CALL MNKUVorg1()
     SET STATUS "NachbearbeitungsvorgÑnge"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   ffil$ = FILE 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     codevg1% = codevg.vorgang
     Gcuvg% = codevg.vorgang
     CALL KUVorgangAdr(codevg1%)
   CASE 2
     CALL VORGDruckALL()
   CASE 3
     CALL VorgangSichern()
   CASE 99
     ENTER Datum.VORGANG,0
   MENU OFF 
   END SELECT 
   MENU ON 
   UNLOCK FILE "vorgang"
 WEND 
 IF ( MOD ("VORGANG") OR NEW ("VORGANG")) THEN CALL FStore("VORGANG")
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
  
 
SUB KUVorgIntro1()
 MOUSE OFF 
 FILE "Vorgang"
 INDEX CodeKU.Vorgang
    SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
    SELECT FIRST FILE "vorgang" INDEX codeku.vorgang
   SELECT FORM KEY knr% FILE "Vorgang" INDEX CodeKU.Vorgang
 FORM 
 END SUB 
 
SUB MNKUVorg1()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 '***********************************************************************************
 'Vermîgen des aktuellen Kunden anzeigen
 '***********************************************************************************
 
SUB KUVermoeg()
 REM IF disabled%("EINGANG") THEN END SUB 
 REM CALL DFile(3,"ZEINGAN1" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 FILE "Vermoeg"
 INDEX codeku.Vermoeg
 SELECT FIRST 
 knr% = codeku.GAdrDat$
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL FStore(GAdrDat$)
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "KU-VERM" THEN 
     SET HEADING title$ + " - Vermîgen"
     OPEN FORM GPrjForm$ + "KU-VERM"
     SET f = Superbase.Form
     CALL KUVermIntro1()
     CALL MNKUVerm1()
     SET STATUS "Vermîgensverwaltung"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     codeverm% = codeverm.vermoeg
     SELECT FORM KEY codeverm% FILE "Vermoeg" INDEX codeverm.vermoeg
     IF coderku.vermoeg > 0 THEN 
       f.rn.visible = - 1
       f.rv.visible = - 1
       f.rg.visible = - 1
       f.rs.visible = - 1
       f.rp.visible = - 1
       f.ro.visible = - 1
       f.rb.visible = - 1
       f.rblz.visible = - 1
       f.rk.visible = - 1
 
       f.rn.enabled = - 1
       f.rv.enabled = - 1
       f.rg.enabled = - 1
       f.rs.enabled = - 1
       f.rp.enabled = - 1
       f.ro.enabled = - 1
       f.rb.enabled = - 1
       f.rblz.enabled = - 1
       f.rk.enabled = - 1
     ELSE 
       f.rn.visible = 0
       f.rv.visible = 0
       f.rg.visible = 0
       f.rs.visible = 0
       f.rp.visible = 0
       f.ro.visible = 0
       f.rb.visible = 0
       f.rblz.visible = 0
       f.rk.visible = 0
 
       f.rn.enabled = 0
       f.rv.enabled = 0
       f.rg.enabled = 0
       f.rs.enabled = 0
       f.rp.enabled = 0
       f.ro.enabled = 0
       f.rb.enabled = 0
       f.rblz.enabled = 0
       f.rk.enabled = 0
     END IF 
     FORM 2
   CASE 2
     CALL VermDruckALL()
   CASE 3
     CALL VermNeu(knr%)
     CALL KUVermIntro1()
     KUVorgsub% = 99
   CASE 4
     REQUEST "Wollen Sie den Datensatz wirklich lîschen?","",130,req%
     IF req% = 1 THEN 
       CALL VermoegLoe(CodeVerm.VERMOEG)
       CALL KUVermIntro1()
     END IF 
   CASE 5
     REM ZahlungsempfÑnger zuweisen
     CALL VermZEmpf()
   CASE 99
     ENTER gezahltam.VERMOEG,0
   MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("VERMOEG") OR NEW ("VERMOEG")) THEN CALL FStore("VERMOEG")
 REM CALL ZEINbuchung1( - 1)
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
  
 
SUB KUVermIntro1()
 MOUSE OFF 
 FILE "Vorgang"
 INDEX CodeKU.Vorgang
    SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   SELECT FORM KEY knr% FILE "Vermoeg" INDEX CodeKU.Vermoeg
 FORM 
 END SUB 
 
SUB MNKUVerm1()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
 '***********************************************************************************
 'Kundenkonto des aktuellen Kunden anzeigen
 '***********************************************************************************
 
SUB KUKundkonto()
 REM IF disabled%("EINGANG") THEN END SUB 
 REM CALL DFile(3,"ZEINGAN1" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 FILE "kukto"
 INDEX codeku.kukto
 SELECT FIRST 
 knr% = codeku.GAdrDat$
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL FStore(GAdrDat$)
 _formend% = 0
 maske$ = "KU-KUKO"
 IF GLundWrigg$ LIKE "TRUE" THEN 
   maske$ = "RKU-KUKO"
 END IF 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Kundenkonto"
     OPEN FORM GPrjForm$ + maske$
     SET f = Superbase.Form
     CALL KUKundkoIntro()
     CALL MNKundko()
     SET STATUS "Kundenkonto"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     codekuko% = codekuko.kukto
     SELECT FORM KEY codekuko% FILE "kukto" INDEX codekuko.kukto
     cuvt% = codevt.kukto
     SELECT KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
     FORM 2
   CASE 2
     CALL KuKtoDruckALL()
     CALL KUKundkoIntro()
   CASE 3
     CALL KuKtoLoe()
     CALL KUKundkoIntro()
   CASE 4
     CALL CreateRech(Codekuko.kukto)
     CALL KUKundkoIntro()
   CASE 5
     CALL CreateMahn(Codekuko.kukto)
     CALL KUKundkoIntro()
   CASE 99
     ENTER FÑlligkeit.KUKTO,0
   MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("kukto") OR NEW ("kukto")) THEN CALL FStore("kukto")
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
  
 
SUB KUKundkoIntro()
 MOUSE OFF 
 FILE "kukto"
 INDEX CodeKU.kukto
    SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   SELECT FORM KEY knr% FILE "kukto" INDEX CodeKU.kukto
 FORM 
 END SUB 
 
SUB MNKundko()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
SUB FondBewPruef()
      t$ = "Soll der Wert aus dem Feld Bewertungssumme(Fondsmaske): " + LTRIM$ (p$)
      REQUEST t$,"in das Feld Bewertung(Vertragsmaske) Åbernehmen?",130,req%
      IF req% = 1 THEN 
        SELECT KEY codevt.fonds LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
        Bewertungssumme.kvertrag = Bewertungssumme.fonds
        RecStatus.Kvertrag = "c"
        STORE FILE "Kvertrag"
      END IF 
 
 END SUB 
 
 REM Liste der nichtgebuchten ZahlungseingÑnge 

SUB ZLIREP()
 CALL PRep("ZLIREP")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO ZLirepEnd
 SELECT ;
     WHERE UCASE$ (gebuchtJN.ZEINGAN1) <> "J"
     ORDER REPORT VS_Nr.ZEINGAN1,BuchungsDatum.ZEINGAN1
     TO ASK 
 END SELECT 
ZLirepEnd: 
 ON ERROR GOTO ErrorHandler
 END SUB 
  
 'Provisionsliste mit Volumen in Euro
SUB LISTPRZX(vondat$,bisdat$,allprov$,ma%,repname$)
 von$ = vondat$
 bis$ = bisdat$
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
   cdir$ = DIRECTORY 
   
 CALL PRep("LISTPRZX")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%",SumVol% AS "SGesVol%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
     Header$ = "Provisionsliste " + " in Euro"
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",EinheitenEU.BUCHUNG1 AS "SumEinh%",(Volumen.BUCHUNG1 / Umrechnung.BUCHUNG1) AS "SumVol%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO LISTPRZxend
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
 IF ma% = 0 THEN 
   SELECT ;
   WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
   ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
   TO ASK 
   END SELECT 
 ELSE 
   SELECT ;
   WHERE CodeMA.buchung1 = CodeMA.MAADR AND codema.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
   ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
   TO ASK 
   END SELECT 
 END IF 
LISTPRZxend: 
 ON ERROR GOTO ErrorHandler
  END SUB 

 'Provisionsliste mit Volumen
SUB LISTPRZV(vondat$,bisdat$,allprov$)
 von$ = vondat$
 bis$ = bisdat$
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$

 CALL PRep("LISTPRZV")
 REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%",SumVol% AS "SGesVol%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
     Header$ = "Provisionsliste " + " in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%",Volumen.BUCHUNG1 AS "SumVol%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO LISTPRZVend
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
 SELECT ;
 WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
 ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
 TO ASK 
 END SELECT 
LISTPRZVend: 
 ON ERROR GOTO ErrorHandler
  END SUB 

 
SUB LISTPRZV1(vondat$,bisdat$,allprov$,codema%)
 von$ = vondat$
 bis$ = bisdat$
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
 CALL PRep("LISTPRZV")
 REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%",SumVol% AS "SGesVol%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
     Header$ = "Provisionsliste " + " in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%",Volumen.BUCHUNG1 AS "SumVol%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO LISTPRZVend1
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
 SELECT ;
 WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = CodeMA% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
 ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
 TO ASK 
 END SELECT 
LISTPRZVend1: 
 ON ERROR GOTO ErrorHandler
  END SUB 
 

 '***********************************************************************************
 'Adressnotizen des aktuellen Kunden anzeigen
 '***********************************************************************************
 
SUB ADRNotiz(codeku%)
 REM IF disabled%("EINGANG") THEN END SUB 
 REM CALL DFile(3,"ZEINGAN1" + _fpw$)
 MOUSE OFF 
 MOUSE ON 
 IF NOT EXISTS (codeku%,codeku.adrnotiz) THEN 
   BLANK FILE "ADRNOTIZ"
   codeku.ADRNOTIZ = codeku%
   STORE FILE "ADRNOTIZ"
 END IF 
 FILE "ADRNotiz"
 INDEX codeku.ADRNotiz
 SELECT FIRST 
 SELECT KEY codeku% FILE "adrnotiz" INDEX codeku.adrnotiz
 IF codeku% <> 0 THEN knr% = codeku.adrnotiz
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL QuickStore(GAdrDat$)
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "ADRNOTIZ" THEN 
     SET HEADING title$ + " - Adressnotiz"
     REM OPEN FORM "ADRNOTIZ"
     IF EXISTS (GPrjForm$ + "ADRNOTIZ.sbv") THEN 
       OPEN FORM GPrjForm$ + "ADRNOTIZ"
     ELSE 
       OPEN FORM GPrjForm$ + "ADRNOTIZ"
     END IF 
     SET f = Superbase.Form
     REM CALL KUKundkoIntro()
     REM CALL MNKundko()
     SET STATUS "Adressnotiz"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   CALL ClearKBDBuffer()
   IF EXISTS (codeku%,codeku.adrfin) THEN finanz$ = "Finanzen Æ" ELSE finanz$ = "Finanzen"
   SELECT FORM KEY codeku% FILE "adrnotiz" INDEX codeku.adrnotiz
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     CALL ADRFin(codeku%)
   MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("ADRNOTIZ") OR NEW ("ADRNOTIZ")) THEN CALL QuickStore("ADRNOTIZ")
 _formend% = 0
 END SUB 
  
 
 
 '***********************************************************************************
 'Adressfinanzen des aktuellen Kunden anzeigen
 '***********************************************************************************
 
SUB ADRFin(codeku%)
 REM IF disabled%("EINGANG") THEN END SUB 
 CALL DFile(3,"vermoeg" + _fpw$)
 MOUSE OFF 
 MOUSE ON 
 IF NOT EXISTS (codeku%,codeku.ADRFin) THEN 
   BLANK FILE "ADRFin"
   codeku.ADRFin = codeku%
   STORE FILE "ADRFin"
 END IF 
 FILE "ADRFin"
 INDEX codeku.ADRFin
 SELECT FIRST 
 SELECT KEY codeku% FILE "ADRFin" INDEX codeku.ADRFin
 IF codeku% <> 0 THEN knr% = codeku.ADRFin
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL QuickStore(GAdrDat$)
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "ADRFIN" THEN 
     SET HEADING title$ + " - Adressfinanzen"
     REM OPEN FORM "ADRFIN"
     IF EXISTS (GPrjForm$ + "ADRFIN.sbv") THEN 
       OPEN FORM GPrjForm$ + "ADRFIN"
     ELSE 
       OPEN FORM GPrjForm$ + "ADRFIN"
     END IF 
     SET f = Superbase.Form
     REM CALL KUKundkoIntro()
     REM CALL MNKundko()
     SET STATUS "Adressfinanzen"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   CALL ClearKBDBuffer()
   IF EXISTS (codeku%,codeku.vermoeg) THEN verm$ = "Zahlungsein-/ausgÑnge zur Vermîgensverwaltung Æ" ELSE verm$ = "Zahlungsein-/ausgÑnge zur Vermîgensverwaltung"
   SELECT FORM KEY codeku% FILE "ADRFin" INDEX codeku.ADRFin
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     CALL ADRNotiz(codeku%)
   CASE 2
     IF EXISTS (knr%,codeku.VERMOEG) THEN 
       FILE "VERMOEG"
       CALL KUVermoeg()
       FILE GAdrDat$
     ELSE 
       REQUEST "Es sind keine Zahlungsein-/ausgÑnge der Vermîgensverwaltung","zu dieser Adresse vorhanden! Zahlung erfassen?",130,req%
       IF req% = 1 THEN 
         knr% = codeku.GAdrDat$
         CALL VermNeu(knr%)
         FILE "VERMOEG"
         CALL KUVermoeg()
         FILE GAdrDat$
       END IF 
     END IF 
   MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("ADRFin") OR NEW ("ADRFin")) THEN CALL QuickStore("ADRFin")
 _formend% = 0
 END SUB 
  
 
 '***********************************************************************************
 'AdressEheGatten des aktuellen Kunden anzeigen
 '***********************************************************************************
 
SUB ADREG(codeku%)
 REM IF disabled%("EINGANG") THEN END SUB 
 REM CALL DFile(3,"ZEINGAN1" + _fpw$)
 MOUSE OFF 
 MOUSE ON 
 IF NOT EXISTS (codeku%,codeku.ADREG) THEN 
   BLANK FILE "ADREG"
   codeku.ADREG = codeku%
   STORE FILE "ADREG"
 END IF 
 FILE "ADREG"
 INDEX codeku.ADREG
 SELECT FIRST 
 SELECT KEY codeku% FILE "ADREG" INDEX codeku.ADREG
 IF codeku% <> 0 THEN knr% = codeku.ADREG
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL QuickStore(GAdrDat$)
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "ADREG" THEN 
     SET HEADING title$ + " - Adressfinanzen"
     REM OPEN FORM "ADREG"
     IF EXISTS (GPrjForm$ + "ADREG.sbv") THEN 
       OPEN FORM GPrjForm$ + "ADREG"
     ELSE 
       OPEN FORM GPrjForm$ + "ADREG"
     END IF 
     SET f = Superbase.Form
     REM CALL KUKundkoIntro()
     REM CALL MNKundko()
     SET STATUS "Adressfinanzen"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   CALL ClearKBDBuffer()
   REM IF EXISTS (codeku%,codeku.vermoeg) THEN verm$ = "Zahlungsein-/ausgÑnge zur Vermîgensverwaltung Æ" ELSE verm$ = "Zahlungsein-/ausgÑnge zur Vermîgensverwaltung"
   SELECT FORM KEY codeku% FILE "ADREG" INDEX codeku.ADREG
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     CALL ADRNotiz(codeku%)
   CASE 2
     IF EXISTS (knr%,codeku.VERMOEG) THEN 
       FILE "VERMOEG"
       CALL KUVermoeg()
       FILE GAdrDat$
     ELSE 
       REQUEST "Es sind keine Zahlungsein-/ausgÑnge der Vermîgensverwaltung","zu dieser Adresse vorhanden! Zahlung erfassen?",130,req%
       IF req% = 1 THEN 
         knr% = codeku.GAdrDat$
         CALL VermNeu(knr%)
         FILE "VERMOEG"
         CALL KUVermoeg()
         FILE GAdrDat$
       END IF 
     END IF 
   MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("ADREG") OR NEW ("ADREG")) THEN CALL QuickStore("ADREG")
 _formend% = 0
 END SUB 
  
 
SUB KINVGesBer()
  Gesamtbeitrag.KINVE = F_Beitrag.KINVE + FKBU_Beitrag.KINVE + LW_Beitrag.KINVE + LWKBU_Beitrag.KINVE + ST_Beitrag.KINVE + STKBU_Beitrag.KINVE + ED_Beitrag.KINVE + EDVANDA_Beitrag.KINVE + EDKBU_Beitrag.KINVE
 END SUB 
 
SUB KINVGesBer2()
 ZWS% = IVBeitrag.KINVE + KBUBeitrag.KINVE + GLEBeitrag.KINVE + GLPBeitrag.KINVE + ELBeitrag.KINVE + BEWBeitrag.KINVE
 IVPSumme.KINVE = ZWS% - (ZWS% * IVPRabatt.KINVE / 100)
 CALL QuickStore("KINVE"):ENTER END 
 END SUB 
 

 
 '***********************************************************************************
 'Kontakte der Adresse
 '***********************************************************************************
 
SUB ADRKontakt()
 codeku% = codeku.GAdrDat$
 REM IF disabled%("EINGANG") THEN END SUB 
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\kontgr" + _fpw$)
 CALL DFile(2,"OFFICE\loeprot" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 FILE GConDat$
 INDEX codeku.GConDat$
 SELECT FIRST 
 SELECT WHERE FILE GConDat$
 knr% = codeku.GAdrDat$
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL FStore(GAdrDat$)
 _formend% = 0
 SELECT CASE GConDat$
   CASE "CONNECT"
     maske$ = "KONTAKT"
   CASE "CONBCK"
     maske$ = "KONTBC"
   CASE "CONADR1"
     maske$ = "KONTADR1"
 END SELECT 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Kontakte"
     REM OPEN FORM "KONTAKT"
     IF EXISTS (GOFFForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GOFFForm$ + maske$
     ELSE 
       OPEN FORM GOFFForm$ + maske$
     END IF 
     SET f = Superbase.Form
     CALL ADRKontIntro()
     CALL MNADRKont()
     SET STATUS "Kontakte"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 12
     
     cfile$ = FILE 
     CALL KontXLS(knr%)
     FILE cfile$
     CALL ADRKontIntro()
   CASE 10
     REM Button Kontaktgruppe wird gedrÅckt
     maske$ = "KONTAKT1"
   CASE 11
     REM Button Nachname wird gedrÅckt
     maske$ = "KONTAKT"

   CASE 1
     'zur Adresse wechseln
     knrold% = codeku.Gadrdat$
     locktest% = MNdisabled%("DATALOCK")
     IF UCASE$ (typ.GConDat$) = "V" THEN 
       knr% = VAL ( RIGHT$ (codeconku.GConDat$,6))
       IF EXISTS (knr%,codeku.GADRDat$) THEN 
         SELECT FIRST FILE GADRDat$ INDEX codeku.Gadrdat$
         SELECT KEY knr% FILE GADRDat$ INDEX codeku.Gadrdat$
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(CodeMA.GADRDat$) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF gasp% AND workstation% <> 0 AND sok% THEN 
           IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN sok% = 0
         END IF 
         IF locktest% THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
         END IF 
         IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
         IF sok% <> - 1 THEN 
           CALL Fehler("Sie haben nicht die Berechtigung diese Adresse einzusehen!","")
           knr% = knrold%
           SELECT FIRST FILE GADRDat$ INDEX codeku.Gadrdat$
           SELECT KEY knr% FILE GADRDat$ INDEX codeku.Gadrdat$
         END IF 
       ELSE 
         IF EXISTS (knr%,codeku.loeprot) THEN 
           SELECT FIRST FILE "loeprot" INDEX codeku.loeprot
           SELECT KEY knr% FILE "loeprot" INDEX codeku.loeprot
           CALL Fehler("Die Adresse wurde am " + DATE$ (Datum.loeprot,"0d.mm.yyyy") + " von " + mitarbeiter.loeprot + " gelîscht!","")
         ELSE 
           CALL Fehler("Sorry, die Adresse existiert nicht!","Wahrscheinlich wurde sie gelîscht!")
         END IF 
       END IF 
     ELSE 
       knr% = VAL ( RIGHT$ (codekucon.GConDat$,6))
       IF EXISTS (knr%,codeku.GADRDat$) THEN 
         SELECT FIRST FILE GADRDat$ INDEX codeku.Gadrdat$
         SELECT KEY knr% FILE GADRDat$ INDEX codeku.Gadrdat$
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(CodeMA.GADRDat$) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF gasp% AND workstation% <> 0 AND sok% THEN 
           IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN sok% = 0
         END IF 
         IF locktest% THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
         END IF 
         IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
         IF sok% <> - 1 THEN 
           CALL Fehler("Sie haben nicht die Berechtigung diese Adresse einzusehen!","")
           knr% = knrold%
           SELECT FIRST FILE GADRDat$ INDEX codeku.Gadrdat$
           SELECT KEY knr% FILE GADRDat$ INDEX codeku.Gadrdat$
         END IF 
       ELSE 
        IF EXISTS (knr%,codeku.loeprot) THEN 
           SELECT FIRST FILE "loeprot" INDEX codeku.loeprot
           SELECT KEY knr% FILE "loeprot" INDEX codeku.loeprot
           CALL Fehler("Die Adresse wurde am " + DATE$ (Datum.loeprot,"0d.mm.yyyy") + " von " + mitarbeiter.loeprot + " gelîscht!","")
         ELSE 
           CALL Fehler("Sorry, die Adresse existiert nicht!","Wahrscheinlich wurde sie gelîscht!")
         END IF 
       END IF 
     END IF 
     _formend% = 1
   CASE 2
     ' in die Daten des Kontaktes wechseln
     IF NOT disabled%("KONTAKTDETAIL") THEN 
       codekey% = codekey.GConDat$
       IF UCASE$ (typ.GConDat$) = "V" THEN 
         nr% = VAL ( RIGHT$ (codeconku.GConDat$,6))
       ELSE 
         nr% = VAL ( RIGHT$ (codekucon.GConDat$,6))
       END IF 
       SELECT KEY nr% FILE GAdrDat$ INDEX codeku.GAdrDat$
       adrtext$ = Kundennummer.GAdrDat$ + CHR$ (13) + CHR$ (10) + nachname.GAdrDat$ + CHR$ (10) + CHR$ (13) + vorname.GAdrDat$ + CHR$ (10) + CHR$ (13)
       adrtext$ = adrtext$ + stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + ort.GAdrDat$
       SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
       SELECT KEY codekey% FILE GConDat$ INDEX codekey.GConDat$
       kontaktfi$ = "Kontakt-Gruppe: " + Kontaktgruppe.GConDat$
       FORM 2
     END IF 
   CASE 3
     ' neuer Kontakt
     IF NOT disabled%("KONTAKTNEW") THEN 
       codeku1% = knr%
       nachfolger% = ADRSuche%(0)
       knr% = codeku1%
       IF nachfolger% <> 0 THEN 
         SELECT FIRST FILE GAdrDat$ INDEX CodeKU.GAdrDat$
         SELECT KEY nachfolger% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
         BLANK FILE GConDat$
         codekey.GConDat$ = SER (GConDat$,1)
         codekey% = codekey.GConDat$
         codeku.GConDat$ = knr%
         codecon.GConDat$ = nachfolger%
         CodeKUCon.GConDat$ = STR$ (knr%,"000000") + STR$ (nachfolger%,"000000")
         Nachname.GConDat$ = Nachname.GAdrDat$
         vorname.GConDat$ = Vorname.GAdrDat$
         Ort.GConDat$ = Ort.GAdrDat$
         Strasse.GConDat$ = Stra·e.GAdrDat$
         Typ.GConDat$ = "N"
         CodeKGR.GConDat$ = 0
         Kontaktgruppe.GConDat$ = "<ohne Zuordnung>"
         Erstellt_am.GConDat$ = TODAY 
         CALL QuickStore(GConDat$)
         SELECT FIRST FILE GAdrDat$ INDEX CodeKU.GAdrDat$
         SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
         BLANK FILE GConDat$
         codekey.GConDat$ = SER (GConDat$,1)
         codeku.GConDat$ = nachfolger%
         codecon.GConDat$ = knr%
         CodeConKU.GConDat$ = STR$ (nachfolger%,"000000") + STR$ (knr%,"000000")
         Nachname.GConDat$ = Nachname.GAdrDat$
         vorname.GConDat$ = Vorname.GAdrDat$
         Ort.GConDat$ = Ort.GAdrDat$
         Strasse.GConDat$ = Stra·e.GAdrDat$
         Typ.GConDat$ = "V"
         CodeKGR.GConDat$ = 0
         Kontaktgruppe = "<ohne Zuordnung>"
         Erstellt_am.GConDat$ = TODAY 
         CALL QuickStore(GConDat$)
         FILE GConDat$
         INDEX CodeKU.GConDat$
         SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
         SELECT FORM KEY knr% FILE GConDat$ INDEX CodeKU.GConDat$
         kontaktfi$ = "Kontaktgruppe: "
         FORM 
         SELECT FIRST FILE GConDat$ INDEX CodeKU.GConDat$
         SELECT FORM KEY knr% FILE GConDat$ INDEX CodeKU.GConDat$
         SELECT KEY codekey% FILE GConDat$ INDEX codekey.GConDat$
         kontaktfi$ = "Kontakt-Gruppe:<ohne Zuordnung>"
         FORM 2
       END IF 
     END IF 
   CASE 4
     ' zurÅck Knopf Seite 2
     FORM 1
   CASE 5
     CALL KontaktFilt()
   CASE 6
     IF NOT disabled%("KONTAKTGROUP") THEN 
       CALL KontGrNeu()
     END IF 
   CASE 7
     REM Kontakt Lîschen
     IF NOT disabled%("KONTAKTDEL") THEN 
       REQUEST "Wollen Sie den Kontakt wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         IF Typ.GConDat$ LIKE "V" THEN 
           codekuvonADR% = codecon.GConDat$
           codekuzuadr% = codeku.GConDat$
         ELSE 
           codekuvonADR% = codeku.GConDat$
           codekuzuadr% = codecon.GConDat$
         END IF 
         CodeKUCon$ = STR$ (codekuvonADR%,"000000") + STR$ (codekuzuadr%,"000000")
         SELECT KEY CodeKUCon$ LOCK FILE GConDat$ INDEX CodeKUCon.GConDat$
         SELECT REMOVE FILE GConDat$
         codekoncu$ = STR$ (codekuzuadr%,"000000") + STR$ (codekuvonADR%,"000000")
         IF EXISTS (codekoncu$,CodeConKU.GConDat$) THEN 
           SELECT KEY codekoncu$ LOCK FILE GConDat$ INDEX CodeConKU.GConDat$
           SELECT REMOVE FILE GConDat$
         END IF 
         FORM 1
         CALL ADRKontIntro()
       END IF 
     END IF 
   CASE 8
     'Kontakte drucken
     IF NOT disabled%("KONTAKTPRINT") THEN 
       codeku% = codeku.GAdrDat$
       knr% = codeku%
       CALL KONTADRU()
       SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
       CALL ADRKontIntro()
     END IF 
   CASE 99
     MOUSE ON 
     'Kontakt bearbeiten
     IF NOT disabled%("KONTAKTEDIT") THEN 
       MOUSE ON 
       ENTER Nachname.GConDat$,0
     END IF 
   MENU OFF 
   END SELECT 
   MENU ON 
   MOUSE ON 
 WEND 
 IF ( MOD ("kukto") OR NEW ("kukto")) THEN CALL FStore("kukto")
 REM 110397 CALL ZEINbuchung1(0)
 SELECT WHERE FILE GConDat$
 _formend% = 0
 END SUB 

SUB KONTADRU()
 kunr$ = STR$ (codeku.GAdrDat$,"000000") + "*"
 ueb$ = nachname.GAdrDat$ + ", " + vorname.GAdrDat$ + "  " + DATE$ ( TODAY ,"0d.mm.yyyy")
 codeku% = codeku.GADRDat$
 SELECT CASE GConDat$
   CASE "CONNECT"
     CALL ORep("KONTADRU")
   CASE "CONBCK"
     CALL ORep("KONTDRBC")
   CASE "CONADR1"
     CALL ORep("KONTDRAD")
 END SELECT 
 REM REPORT USING "KONTADRU"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO EndKontADru
 ueb$ = nachname.GAdrDat$ + ", " + vorname.GAdrDat$ + "  " + DATE$ ( TODAY ,"0d.mm.yyyy")
 REM WHERE CodeCON.GConDat$ = CodeKU.GAdrDat$ AND CodeKUCon.GConDat$ LIKE kunr$
 SELECT ;
     WHERE Codeku.GConDat$ = codeku% AND CodeCon.GConDat$ = CodeKU.GAdrDat$
     ORDER REPORT Nachname.GConDat$
     TO ASK 
 END SELECT 
EndKontADru: 
 ON ERROR GOTO ErrorHandler
 END SUB 
  

 
SUB ADRKontIntro()
 MOUSE OFF 
 FILE GConDat$
 INDEX CodeKU.GConDat$
   SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   SELECT FORM KEY knr% FILE GConDat$ INDEX CodeKU.GConDat$
   kontaktfi$ = "Kontaktgruppe: "
 FORM 
 END SUB 
 
SUB MNADRKont()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 2,0,1,"&Optionen","",""
 MENU 2,1,1,"&Adresstexte in Kontakte aktualisieren","KontAktual","Adresstexte in Kontakte aktualisieren"
 CALL MNHilfe(3)
 END SUB 
 
SUB KontAktual()
 FILE GConDat$
 INDEX codecon.GConDat$
 IF RECCOUNT (GConDat$) > 0 THEN 
   SELECT FIRST LOCK 
 ELSE 
   SELECT LAST 
 END IF 
 i% = 0
 MOUSE OFF 
 WHILE NOT EOF (GConDat$)
   i% = i% + 1
   IF EXISTS (codecon.GConDat$,codeku.GADRDat$) THEN 
     SELECT KEY codecon.GConDat$ FILE GADRDat$ INDEX codeku.GADRDat$
     Nachname.GConDat$ = Nachname.GADRDat$
     Vorname.GConDat$ = Vorname.GADRDat$
     Strasse.GConDat$ = Stra·e.GADRDat$
     Ort.GConDat$ = Ort.GADRDat$
     STORE FILE GConDat$
     UNLOCK CURRENT FILE GConDat$
   END IF 
   SET STATUS STR$ (i%,"999999") + " DatensÑtze angepa·t"
   SELECT NEXT LOCK FILE GConDat$
 WEND 
 SET STATUS ""
 MOUSE ON 
 CALL ADRKontIntro()
 REQUEST "Anpassung beendet!"
 END SUB 


SUB KontaktFilt()
   a% = RECCOUNT ("kontgr")
   IF a% < 1 THEN END SUB 
   DIM Waehrung$(a%)
   DIM Waehrung%(a%)
   FOR i% = 1 TO a%
     Waehrung$(i%) = ""
     Waehrung%(i%) = 0
   NEXT i%
   FILE "kontgr"
   INDEX KontaktGruppe.kontgr
   SELECT WHERE 
   SELECT FIRST 
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter" + SPACE$ (90) + "999999"
   WHILE NOT EOF ("kontgr")
     a% = a% + 1
     Waehrung%(a%) = codekgr%
     Waehrung$(a%) = KontaktGruppe.kontgr + SPACE$ (90) + STR$ (codekgr.kontgr,"000000")
     SELECT NEXT FILE "kontgr" INDEX KontaktGruppe.kontgr
   WEND 
   
   DIM Auswahl1$(1)
     FILE "kontgr"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,184,"Kontaktgruppe","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,157,0," Auswahl Gesellschaft"
      ADD DIALOG "PREISLIS",7,5,14,169,145,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,165,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,165,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "kontgr"
        SELECT WHERE FILE GConDat$
        CodeKGr% = VAL ( RIGHT$ (Auswahl1$(0),6))
        REM IF CodeKGR% = 999999 THEN CodeKGr% = 0
        IF (CodeKGR% <> 999999) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          
          geskontfi$ = "Filter fÅr Kontakt-Gruppe: " + ausw1$
        ELSE 
          geskontfi$ = "Filter fÅr Kontakt-Gruppe: "
        END IF 
      END IF 
      bef$ = "Select where Codeku.GConDat$ = knr%"
      IF (CodeKGR% <> 999999) THEN 
        bef$ = bef$ + " AND CodeKGR.GConDat$ = CodeKGR%"
      END IF 
      FILE GConDat$
      EXECUTE bef$
 MOUSE ON 
 REM SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 SELECT FORM FIRST 
 FORM 
 
 END SUB 
 
SUB KontGrNeu()
 codekey% = codekey.GConDat$
 IF NEW (GConDat$) OR MOD (GConDat$) THEN CALL QuickStore(GConDat$)
   a% = RECCOUNT ("kontgr")
   DIM Keyword$(a% + 1)
   DIM Auswahl1$(1)
   FILE "kontgr"
   INDEX KontaktGruppe.kontgr
   SELECT WHERE 
   SELECT FIRST 
   a% = 0
   WHILE NOT EOF ("kontgr")
     Keyword$(a%) = KontaktGruppe.kontgr + SPACE$ (100) + STR$ (codekgr.kontgr,"000000")
     a% = a% + 1
     SELECT NEXT FILE "kontgr" INDEX KontaktGruppe.kontgr
   WEND 
   Keyword$(a%) = ""
 MOUSE ON 
 laenge% = 50
 CREATE DIALOG "KEYWORD",0,0,233,200,title$,"MS Sans Serif",8
 ADD DIALOG "KEYWORD",4,0,1,233,176,0,""
 ADD DIALOG "KEYWORD",9,4,12,21,24,2
 ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie den Eintrag aus, der in den aktuellen Kontakt aufgenommen werden soll:"
 ADD DIALOG "KEYWORD",7,31,38,188,122,2,2,Keyword$,Auswahl1$,prompt$
 IF NOT disabled1%("KONTAKTGROUPNEW") THEN ADD DIALOG "KEYWORD",6,31,158,188,12,0,0,KW$,laenge%
 IF disabled1%("KONTAKTGROUPDEL") THEN 
   ADD DIALOG "KEYWORD",1,57,182,55,15,1,"&OK",1,1
   ADD DIALOG "KEYWORD",1,113,182,55,15,0,"&Abbrechen",0,0
 ELSE 
   ADD DIALOG "KEYWORD",1,12,182,45,15,1,"&OK",1,1
   ADD DIALOG "KEYWORD",1,68,182,45,15,0,"&Abbrechen",0,0
   ADD DIALOG "KEYWORD",1,124,182,45,15,0,"&Lîschen",2,1
 END IF 
 DIALOG "KEYWORD",req%
 REMOVE DIALOG "KEYWORD"
 IF req% <> 0 THEN 
   IF req% = 1 THEN 
     IF kw$ = "" THEN 
       CodeKGr% = VAL ( RIGHT$ (Auswahl1$(0),6))
       IF codeKGr% = 0 THEN 
         kw$ = "<ohne Zuordnung>"
       ELSE 
         SELECT FIRST FILE "kontgr" INDEX codekgr.kontgr
         SELECT KEY codekgr% FILE "kontgr" INDEX codekgr.kontgr
         kw$ = KontaktGruppe.kontgr
       END IF 
     ELSE 
       kw$ = UCASE$ (kw$)
       kw$ = TRIM$ ( LTRIM$ (kw$))
       IF NOT EXISTS (kw$,KontaktGruppe.kontgr) THEN 
         BLANK FILE "kontgr"
         codekgr.kontgr = SER ("kontgr",1)
         codekgr% = codekgr.kontgr
         KontaktGruppe.kontgr = kw$
         CALL QuickStore("Kontgr")
       ELSE 
         SELECT KEY kw$ FILE "kontgr" INDEX KontaktGruppe.kontgr
         codekgr% = codekgr.kontgr
       END IF 
     END IF 
     SELECT KEY codekey% LOCK FILE GConDat$ INDEX codekey.GConDat$
     codeKGR.GConDat$ = codekgr%
     KontaktGruppe.GConDat$ = kw$
     CALL QuickStore(GConDat$)
     IF _projekt$ LIKE "IMMAK" THEN 
       REM CALL Fehler("Kontaktgruppenzuweisung","")
       REQUEST "Soll die Kontaktgruppe der verknÅpften Adresse auch geÑndert werden?","",130,req%
       IF req% = 1 THEN 
         codekey% = codekey.GConDat$
         IF LTRIM$ (CodeKUCon.GConDat$) = "" OR Typ.GConDat$ LIKE "V" THEN 
           codekucon$ = STR$ (Codecon.GConDat$,6) + STR$ (codeku.GConDat$,6)
           SELECT FIRST FILE GConDat$ INDEX codekucon.GConDat$
           SELECT KEY codekucon$ LOCK FILE GConDat$ INDEX codekucon.GConDat$
           codeKGR.GConDat$ = codekgr%
           KontaktGruppe.GConDat$ = kw$
           CALL QuickStore(GConDat$)
         ELSE 
           codeconku$ = STR$ (Codecon.GConDat$,6) + STR$ (codeku.GConDat$,6)
           SELECT FIRST FILE GConDat$ INDEX codeconku.GConDat$
           SELECT KEY codeconku$ LOCK FILE GConDat$ INDEX codeconku.GConDat$
           codeKGR.GConDat$ = codekgr%
           KontaktGruppe.GConDat$ = kw$
           CALL QuickStore(GConDat$)
         END IF 
         SELECT FIRST FILE GConDat$ INDEX codekey.GConDat$
         SELECT KEY codekey% FILE GConDat$ INDEX codekey.GConDat$
       END IF 
     END IF 
   END IF 
   IF req% = 2 THEN 
     CodeKGr% = VAL ( RIGHT$ (Auswahl1$(0),6))
     SELECT KEY codekgr% LOCK FILE "kontgr" INDEX codekgr.kontgr
     SELECT REMOVE FILE "kontgr"
   END IF 
 END IF 
 SELECT FORM KEY codekey% LOCK FILE GConDat$ INDEX codekey.GConDat$
 kontaktfi$ = "Kontakt-Gruppe: " + Kontaktgruppe.GConDat$
 FORM 
 END SUB 
 
SUB GesFiltGK()
   MOUSE OFF 
   codema% = Codema.gekond
    cv% = lfdnr.gekond
   a% = RECCOUNT ("geadr")
   DIM Waehrung$(a%)
   DIM Waehrung%(a%)
   FOR i% = 1 TO a%
     Waehrung$(i%) = ""
     Waehrung%(i%) = 0
   NEXT i%
   FILE "gekond"
   INDEX codema.gekond
   codema$ = STR$ (codema%,"000000")
   SELECT WHERE 
   SELECT FIRST 
   SELECT KEY codema% FILE "gekond" INDEX codema.gekond
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   WHILE NOT EOF ("gekond") AND codema.gekond = codema%
     IF codege.gekond > 0 THEN 
       codege% = codege.gekond
       j% = - 1
       FOR i% = 0 TO a%
         IF Waehrung%(i%) = codege% THEN i% = a% + 5000
       NEXT i%
       b% = a% + 5000
       IF i% < b% THEN 
         a% = a% + 1
         Waehrung%(a%) = codege%
         SELECT FIRST FILE "geadr" INDEX codege.geadr
         SELECT KEY codege% FILE "geadr" INDEX codege.geadr
         REM IF gesellschaft.geadr LIKE "Colo*" THEN CALL Fehler(gesellschaft.geadr, STR$ (codege.geadr,"000000"))
         Waehrung$(a%) = Gesellschaft.geadr + SPACE$ (90) + STR$ (codege%,"000000")
       END IF 
     END IF 
     SELECT NEXT FILE "gekond" INDEX codema.gekond
   WEND 
   
   DIM Auswahl1$(1)
     FILE "gekond"
     prompt$ = Waehrung$(0)
     MOUSE ON 
     CREATE DIALOG "PREISLIS",0,0,190,264,"Gesellschaft","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,2,189,240,0," Auswahl Gesellschaft"
      ADD DIALOG "PREISLIS",7,5,14,169,230,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,245,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,245,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "gekond"
        GCodeGE% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeGE% = 999999 THEN GCodeGE% = 0
        IF (GCodeGE% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          
          gesfi$ = "Ges: " + ausw1$
        ELSE 
          gesfi$ = "Gesellschaft Filter: "
        END IF 
      END IF 
      bef$ = "Select where Codema.gekond = cuma%"
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.gekond = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.gekond = GCodeGE%"
      END IF 
      IF GCodegrsp% > 0 THEN 
        bef$ = bef$ + " AND Codegrsp.gekond = GCodegrsp%"
      END IF 
      IF GCodeEingGE% > 0 THEN 
        bef$ = bef$ + " AND  CodeEingGE.gekond = GCodeEingGE%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM KEY codema% FILE "gekond" INDEX codema.gekond
 FORM 
 
 END SUB 


SUB GesFiltGKE()
   MOUSE OFF 
   codema% = Codema.gekond
   cv% = lfdnr.gekond
   a% = RECCOUNT ("geadr")
   DIM Waehrung$(a%)
   DIM Waehrung%(a%)
   FOR i% = 1 TO a%
     Waehrung$(i%) = ""
     Waehrung%(i%) = 0
   NEXT i%
   FILE "gekond"
   INDEX codema.gekond
   codema$ = STR$ (codema%,"000000")
   SELECT WHERE 
   SELECT FIRST 
   SELECT KEY codema% FILE "gekond" INDEX codema.gekond
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   WHILE NOT EOF ("gekond") AND codema.gekond = codema%
     IF CodeEingGE.gekond > 0 THEN 
       codege% = CodeEingGE.gekond
       j% = - 1
       FOR i% = 0 TO a%
         IF Waehrung%(i%) = codege% THEN i% = a% + 5000
       NEXT i%
       b% = a% + 5000
       IF i% < b% THEN 
         a% = a% + 1
         Waehrung%(a%) = codege%
         SELECT FIRST FILE "geadr" INDEX codege.geadr
         SELECT KEY codege% FILE "geadr" INDEX codege.geadr
         REM IF gesellschaft.geadr LIKE "Colo*" THEN CALL Fehler(gesellschaft.geadr, STR$ (codege.geadr,"000000"))
         Waehrung$(a%) = Gesellschaft.geadr + SPACE$ (90) + STR$ (codege%,"000000")
       END IF 
     END IF 
     SELECT NEXT FILE "gekond" INDEX codema.gekond
   WEND 
   
   DIM Auswahl1$(1)
     FILE "gekond"
     prompt$ = Waehrung$(0)
     MOUSE ON 
     CREATE DIALOG "PREISLIS",0,0,190,264,"eingereicht Åber - Gesellschaft","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,2,189,240,0," Auswahl Gesellschaft"
      ADD DIALOG "PREISLIS",7,5,14,169,230,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,245,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,245,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "gekond"
        GCodeEingGE% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeEingGE% = 999999 THEN GCodeEingGE% = 0
        IF (GCodeEingGE% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          
          eingfil$ = "eingereicht Åber: " + ausw1$
        ELSE 
          eingfil$ = "eingereicht Åber Filter: "
        END IF 
      END IF 
      bef$ = "Select where Codema.gekond = cuma%"
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.gekond = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.gekond = GCodeGE%"
      END IF 
      IF GCodegrsp% > 0 THEN 
        bef$ = bef$ + " AND Codegrsp.gekond = GCodegrsp%"
      END IF 
      IF GCodeEingGE% > 0 THEN 
        bef$ = bef$ + " AND  CodeEingGE.gekond = GCodeEingGE%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM KEY codema% FILE "gekond" INDEX codema.gekond
 FORM 
 
 END SUB 


 
SUB SparteFiltGK()
   MOUSE OFF 
   codema% = codema.gekond
   cv% = lfdnr.gekond
   a% = RECCOUNT ("sparten")
   DIM Waehrung$(a%)
   DIM Waehrung%(a%)
   FOR i% = 1 TO a%
     Waehrung$(i%) = ""
     Waehrung%(i%) = 0
   NEXT i%
   FILE "gekond"
   INDEX codema.gekond
   SELECT WHERE 
   SELECT FIRST 
   SELECT KEY codema% FILE "gekond" INDEX codema.gekond
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   WHILE NOT EOF ("gekond") AND codema.gekond = codema%
     codeva% = codeva.gekond
     j% = - 1
     FOR i% = 0 TO a%
       IF Waehrung%(i%) = codeva% THEN i% = a% + 5
     NEXT i%
     b% = a% + 5
     IF i% < b% THEN 
       a% = a% + 1
       Waehrung%(a%) = codeva%
       SELECT FIRST FILE "sparten" INDEX codeva.sparten
       SELECT KEY codeva% FILE "sparten" INDEX codeva.sparten
       Waehrung$(a%) = sparte.sparten + SPACE$ (90) + STR$ (codeva%,"000000")
     END IF 
     SELECT NEXT FILE "gekond" INDEX codema.gekond
   WEND 
   MOUSE ON 
   DIM Auswahl1$(1)
     FILE "gekond"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,264,"Sparte","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,2,189,240,0," Auswahl Sparte"
      ADD DIALOG "PREISLIS",7,5,14,169,230,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,245,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,245,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "gekond"
        GCodeVA% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeVA% = 999999 THEN GCodeVA% = 0
        IF (GCodeVA% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          sparfi$ = "Sparte: " + ausw1$
        ELSE 
          sparfi$ = "Sparte Filter: "
        END IF 
      END IF 
      bef$ = "Select where codema.gekond = cuma%"
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.gekond = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.gekond = GCodeGE%"
      END IF 
      IF GCodegrsp% > 0 THEN 
        bef$ = bef$ + " AND Codegrsp.gekond = GCodegrsp%"
      END IF 
      IF GCodeEingGE% > 0 THEN 
        bef$ = bef$ + " AND  CodeEingGE.gekond = GCodeEingGE%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM KEY codema% FILE "gekond" INDEX codema.gekond
 FORM 
 END SUB 
 



SUB SPGFiltGK()
   MOUSE OFF 
   codema% = codema.gekond
   cv% = lfdnr.gekond
   a% = 10000
   DIM Waehrung$(a%,1)
   DIM Waehrung%(a%,1)
   REDIM Waehrung$(a%)
   REDIM Waehrung%(a%)
   FILE "gekond"
   INDEX codema.gekond
   SELECT WHERE 
   SELECT FIRST 
   SELECT KEY codema% FILE "gekond" INDEX codema.gekond
   INDEX codegrsp.gekond
   SELECT FIRST 
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   codegrspold% = 0
   WHILE NOT EOF ("gekond")
     codegrsp% = codegrsp.gekond
     IF codegrsp% <> codegrspold% THEN 
       codegrspold% = codegrsp%
       Waehrung%(a%) = codegrsp%
       Waehrung$(a%) = gruppe.gekond + SPACE$ (90) + STR$ (codegrsp%,"000000")
       a% = a% + 1
     END IF 
     SELECT NEXT FILE "gekond" INDEX codegrsp.gekond
   WEND 
   MOUSE ON 
   DIM Auswahl1$(1)
     FILE "gekond"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,264,"Spartengruppe","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,2,189,240,0," Auswahl Spartengruppe"
      ADD DIALOG "PREISLIS",7,5,14,169,230,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,245,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,245,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "gekond"
        GCodegrsp% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodegrsp% = 999999 THEN GCodeVA% = 0
        IF (GCodegrsp% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          spgfi$ = "SPG: " + ausw1$
        ELSE 
          spgfi$ = "SPG Filter: "
        END IF 
      END IF 
      bef$ = "Select where codema.gekond = cuma%"
      IF GCodegrsp% > 0 THEN 
        bef$ = bef$ + " AND Codegrsp.gekond = GCodegrsp%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.gekond = GCodeGE%"
      END IF 
      IF GCodeva% > 0 THEN 
        bef$ = bef$ + " AND Codeva.gekond = GCodeva%"
      END IF 
      IF GCodeEingGE% > 0 THEN 
        bef$ = bef$ + " AND  CodeEingGE.gekond = GCodeEingGE%"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM KEY codema% FILE "gekond" INDEX codema.gekond
 FORM 
 END SUB 





 '      ************************************************
 '      ** Routinen fÅr Formular "GEKOND" Konditionen **
 '      ************************************************
 
SUB GEKONDA()
 IF disabled%("GEKOND") THEN END SUB 
 MOUSE OFF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 MOUSE OFF 
 FILE "gekond"
 INDEX QuickCodeGes.GEKOND
 SELECT WHERE 
 SELECT FIRST 
 gesfilt$ = "Gesellschaft-Filter"
 sparfilt$ = "Sparten-Filter"
 codema% = cuma%
 SELECT KEY codema% FILE "gekond" INDEX Codema.GEKOND
 SELECT KEY codema% FILE "maadr" INDEX Codema.maadr
 _continue% = 1
 IF CodeMA.GEKOND <> cuma% THEN 
   _continue% = 0
   REQUEST "Es wurden noch keine Konditionen fÅr " + LEFT$ (nachname.maadr,20) + " erfa·t!","Konditionen erfassen?",130,req%
   IF req% = 1 THEN 
     _continue% = 1
   END IF 
 END IF 
 IF _continue% = 1 THEN 
   _formend% = 0
   maske$ = "GEKONDA"
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     maske$ = "GEKONDAC"
   END IF 
   IF GEinh% AND PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     maske$ = "GEKONDAE"
   END IF 
   IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
     maske$ = "GEKONDBE"
   END IF 
   IF GAFSK$ LIKE "TRUE" THEN 
     maske$ = "GEKONDAF"
   END IF 
   WHILE _formend% = 0
     ON ERROR GOTO ErrorHandler
     GEKONDsub% = 0
     IF UCASE$ ( FORM ) <> maske$ THEN 
       SET HEADING title$ + " - Konditionen"
       OPEN FORM GPrjForm$ + maske$
       SET f = Superbase.Form
       CALL GEKONDIntroA()
       CALL MNGEKONDA()
       gesfi$ = gesfilt$
       sparfi$ = sparfilt$
       MENU ON 
       SET STATUS "Konditionsverwaltung"
     END IF 
     MOUSE ON 
     CALL ClearKBDBuffer()
     CALL GEKONDUpdA()
     IF GKODAT$ = "TRUE" THEN 
       f.kodat.visible = - 1
       f.kodat.enabled = - 1
     ELSE 
       f.kodat.visible = 0
       f.kodat.enabled = 0
     END IF 
     REM f.abbruch.visible = 0
     REM f.abbruch.enabled = 0
     REM f.suchen.enabled = - 1
     REM f.suchen.visible = - 1
     CALL ClearKBDBuffer()
     IF GEKONDsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
     REM ** Tastaturabfrage
     GET k$
     SELECT CASE ASC (k$)
     CASE CrsLeft%,PgUp%
       CALL GEKONDPrevA()
     CASE CrsRight%,PgDn%
       CALL GEKONDNextA()
     END SELECT 
     IF k$ = CHR$ (27) THEN _formend% = 1
     SELECT CASE GEKONDsub%
     CASE 1
       CALL GEKONDSuchen()
     CASE 2
       gesfilt$ = gesfi$
       sparfilt$ = sparfi$
       cuma% = codema.gekond
       codemaab1% = cuma%
       IF EXISTS (cuma%,codema.gekond) THEN 
         Glfdnr% = lfdnr.gekond
         SELECT KEY Glfdnr% FILE "Gekond" INDEX lfdnr.gekond
         CALL GEKOND()
         IF NOT EXISTS (codemaab1%,codema.gekond) THEN _formend% = 1
       ELSE 
         CALL Fehler("Es wurden keine Konditionen angeleigt!","")
       END IF 
     CASE 99
       MENU OFF 
       REM CALL ButDesabled()
       REM f.fehlgek.enabled = 0
       REM IF PAGE = 1 THEN ENTER BWvon.gekond,0
       REM f.fehlgek.enabled = - 1
       REM CALL ButEnabled()
       REM IF PAGE = 2 THEN ENTER TZ0.gekond,0
     CASE 100
       CALL MASGeadr()
     CASE 101
       CALL GesFiltGK()
     CASE 102
       CALL SparteFiltGK()
     CASE 103
       codema% = codema.gekond
       CALL MAKonDatAen(codema%)
     CASE 104
       CALL SPGFiltGK()
     CASE 105
       CALL GesFiltGKE()
     END SELECT 
     MENU ON 
     GEKONDsub% = 0
   WEND 
 END IF 
 MOUSE OFF 
 _formend% = 0
 FILE "gekond"
 SELECT WHERE FILE "gekond"
 SELECT KEY cuma% FILE "maadr" INDEX codema.maadr
 GCodeVA% = 0
 GCodeGE% = 0
 GCodeEingGE% = 0
 FILE "maadr"
 cuko% = 0
 END SUB 
 

SUB MAKonDatAen(codema%)

 END SUB 
 
 ' GEKOND Intro
 ' =======================================================================
 
SUB GEKONDIntroA()
 MOUSE OFF 
 FILE "gekond"
 REM INDEX CodeMA.GEKOND
 MOUSE ON 
 INDEX Codema.GEKOND
      bef$ = "Select where Codema.gekond = cuma%"
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.gekond = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.gekond = GCodeGE%"
      END IF 
      IF GCodeEingGE% > 0 THEN 
        bef$ = bef$ + " AND CodeEingGE.gekond = GCodeEingGE%"
      END IF 
      EXECUTE bef$
      MOUSE OFF 
 SELECT FORM KEY cuma% FILE "maadr" INDEX CodeMA.maadr
 SELECT FORM KEY cuma% FILE "GEKOND" INDEX CodeMA.GEKOND
 
 IF cuma% <> CodeMA.gekond THEN 
   CALL GEKONDNeuA()
 ELSE 
 END IF 
 IF EXISTS (QCodeGEVA.gekond,QCodeGEVA.vprodukt) THEN 
   SELECT KEY QCodeGEVA.gekond FILE "Vprodukt" INDEX QCodegeVA.vprodukt
   IF kurzname.vprodukt <> "" THEN 
     vgessparte$ = kurzname.VPRODUKT + " / " + Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt
   ELSE 
     vgessparte$ = Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt
   END IF 
 ELSE 
   vgessparte$ = "Bitte wÑhlen Sie hier ein Produkt aus!"
 END IF 
 IF EXISTS (lfdnr.gekond,CodeKO.VKOND) THEN 
   REM f.combosparte.BackColor = 0
 ELSE 
   REM f.combosparte.BackColor = 8
 END IF 
 FORM 
 END SUB 
 

SUB GEKONDNeuA()
 IF NEW ("gekond") OR MOD ("gekond") THEN CALL FStore("gekond")
 IF Geinh% = 0 THEN 
   IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
     REM++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
     CALL DFile(3,"vprodukt" + _fpw$)
     CALL DFile(3,"sparten" + _fpw$)
     SELECT WHERE FILE "Sparten"
     CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
     SELECT WHERE FILE "geadr"
     CALL DFile(3,"spgruppe" + _fpw$)
     SELECT WHERE FILE "spgruppe"
     SELECT WHERE FILE "vprodukt"
     SELECT FIRST FILE "Vprodukt" INDEX codevp.vprodukt
     MOUSE OFF 
     i% = 0
     j% = RECCOUNT ("vprodukt")
     REM  CALL Fehler("Es werden fÅr alle noch fehlenden Produkte die Konditionen angelegt!","Ausnahme: Es werden nur Produkte berÅcksichtigt, die fÅr die Anzeige freigegeben wurden!")
     REM *********************************************************************************************************************************************************************************
anfsu200820061:    
     a% = 0
     ok% = - 1
     ge% = 0
     spa% = 0
     spgr% = 0
     cvp% = 0
     WHILE ok%
 
       IF spa% = 0 THEN 
         vSparte$ = "alle"
       ELSE 
         SELECT FIRST FILE "SPARTEN" INDEX CodeVA.SPARTEN
         SELECT KEY spa% FILE "SPARTEN" INDEX CodeVA.SPARTEN
         vsparte$ = Sparte.SPARTEN
       END IF 
       IF spgr% < 1 THEN 
         vSpGR$ = "alle"
       ELSE 
         SELECT FIRST FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
         SELECT KEY spgr% FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
         vspGr$ = Gruppe.SPGRUPPE
       END IF 
       IF ge% = 0 THEN 
         Gesellschaft$ = "alle"
       ELSE 
         SELECT FIRST FILE "GEADR" INDEX CodeGE.GEADR
         SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
         Gesellschaft$ = Gesellschaft.GEADR
         REM ** Gesellschaft auswÑhlen
       END IF 
       IF cvp% = 0 THEN 
         vprodukt$ = "alle"
       ELSE 
         SELECT KEY cvp% FILE "Vprodukt" INDEX codevp.vprodukt
         vprodukt$ = gesellschaft.vprodukt + "/" + sparte.vprodukt
       END IF 
   
       CREATE DIALOG "BVERTRAG",0,0,446,120,"Filter","MS Sans Serif",8
       ADD DIALOG "BVERTRAG",4,5,6,431,97,0,"setzen Sie Filter Åber Sparten Gesellschaften oder/und Spartengruppen,"
       ADD DIALOG "BVERTRAG",5,238,14,190,40,0,"wenn Sie nur ausgewÑhlte Konditionen erzeugen mîchten"
       ADD DIALOG "BVERTRAG",5,8,26,28,10,0,"Produkt"
       ADD DIALOG "BVERTRAG",5,57,26,167,10,0,vProdukt$
       ADD DIALOG "BVERTRAG",1,218,26,14,10,0,"...",9,1
       ADD DIALOG "BVERTRAG",5,8,37,43,10,0,"Gesellschaft"
       ADD DIALOG "BVERTRAG",5,57,37,167,10,0,Gesellschaft$
       ADD DIALOG "BVERTRAG",1,218,37,14,10,0,"...",4,1
       ADD DIALOG "BVERTRAG",5,8,48,24,10,0,"Sparte"
       ADD DIALOG "BVERTRAG",5,57,48,167,10,0,vSparte$
       ADD DIALOG "BVERTRAG",1,218,48,14,10,0,"...",5,1
       ADD DIALOG "BVERTRAG",5,8,59,49,9,0,"Spartengruppe"
       ADD DIALOG "BVERTRAG",5,57,59,167,9,0,vSpGr$
       ADD DIALOG "BVERTRAG",1,218,59,14,9,0,"...",6,1
       ADD DIALOG "BVERTRAG",1,126,104,55,14,1,"&OK",1,1
       REM ADD DIALOG "BVERTRAG",1,184,104,55,14,0,"&Abbrechen",0,0
       DIALOG "BVERTRAG",dreq%
       SELECT CASE dreq%
       CASE 4
         ge% = GetCodeGE%(ge%)
       CASE 5
         spa% = GetCodeVA%(spa%)
       CASE 6
         spgr% = GetCodeGR%(spgr%)
       CASE 9
         REM Produkt auswÑhlen
         IF GOldProdSu$ LIKE "TRUE" THEN 
           cvp% = GetVprodukt%(0,0, - 1)
         ELSE 
           cvp% = NewGetCodeVP%()
         END IF 
       END SELECT 
       REMOVE DIALOG "BVERTRAG"
       IF dreq% = 1 THEN ok% = 0
     WEND 
     REM *********************************************************************************************************************************************************************************
     REQUEST "Sollen die Konditionen jetzt jetzt erzeugt werden?","",130,req%
     SELECT FIRST FILE "Vprodukt" INDEX codevp.vprodukt
     WHILE NOT EOF ("vprodukt") AND req% = 1
       i% = i% + 1
       SET STATUS STR$ (i%) + " von " + STR$ (j%) + " Konditionen erzeugt"
       QuickCode$ = STR$ (Cuma%,"000000") + STR$ (CodeGE.vprodukt,"000000") + STR$ (CodeVA.vprodukt,"000000")
       ok% = - 1
       REM IF EXISTS (QuickCode$,QuickCode.gekond) THEN ok% = 0
       IF NoAnzeige.vprodukt = "j" THEN ok% = 0
       IF ge% > 0 THEN 
         IF codege.vprodukt <> ge% THEN ok% = 0
       END IF 
       IF spa% > 0 THEN 
         IF codeva.vprodukt <> spa% THEN ok% = 0
       END IF 
       IF spgr% > 0 THEN 
         IF codegrsp.vprodukt <> spgr% THEN ok% = 0
       END IF 
       IF cvp% > 0 THEN 
         IF codevp.vprodukt <> cvp% THEN ok% = 0
       END IF 
       IF ok% = - 1 THEN 
         BLANK FILE "gekond"
         lfdnr.gekond = SER ("gekond",1)
         codema.gekond = cuma%
         BWvon.gekond = "1.1.1990"
         CourtageZWjn.gekond = "n"
         PflegeNachZahlw.gekond = "n"
         codege.gekond = codege.vprodukt
         codeva.gekond = codeva.vprodukt
         codevp.gekond = codevp.vprodukt
         SELECT FIRST FILE "sparten" INDEX codeva.sparten
         SELECT KEY codeva.vprodukt FILE "sparten" INDEX codeva.sparten
         REM Sach
         codegrsp.gekond = codegrsp.sparten
         gruppe.gekond = gruppe.vprodukt
         nurEinh.gekond = "j"
         APjn.gekond = "j"
         CourtageJN.gekond = "j"
         PflegeJN.gekond = "j"
         codege.gekond = codege.vprodukt
         codeva.gekond = codeva.vprodukt
         codevp.gekond = codevp.vprodukt
         codegrsp.gekond = codegrsp.vprodukt
         gruppe.gekond = gruppe.vprodukt
         CALL MATimeStamp("gekond")
         CALL QuickStore("gekond")
       END IF 
       SELECT NEXT FILE "Vprodukt" INDEX codevp.vprodukt
     WEND 
     IF req% = 1 THEN 
       t1$ = "Haben Sie nur eine einzelne Kondition erzeugt, so wechseln Sie in diese einezelne Kondition und tragen dort den Wert fÅr Euro pro Einheit ein. Haben Sie mehrere Konditionen "
       t2$ = " erzeugt, so stellen Sie die Filter Optionen so ein, da· Ihnen nur noch diese neuen Konditionen angezeigt werden und betÑtigen Sie dann den Button <Eur/Einh>, um diesen Konditionen einen Wert zuzuweisen."
       CALL Fehler("Es wurden die Konditionen fÅr diesen Mitarbeiter erzeugt!","Sie haben jetzt die Mîglichkeit anzugeben, wieviel Euro pro Einheit in die Konditionen dieses Mitarbeiters eingetragen werden sollen! " + t1$ + t2$)
     END IF 
     SELECT FORM KEY cuma% FILE "gekond" INDEX codema.gekond
     CALL GEKONDUpdA()
    REM++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
   ELSE 
     nsp% = GetVprodukt%(codege.gekond,codeva.gekond, - 1)
     IF nsp% < 1 THEN END SUB 
     SELECT KEY nsp% FILE "Vprodukt" INDEX codevp.vprodukt
     FILE "GEKOND"
     BLANK FORM 
     SET STATUS "Datensatz neu angelegt..."
     lfdnr.gekond = SER ("gekond",1)
     codema.gekond = cuma%
     CourtageZWjn.gekond = "n"
     IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       nurEinh.gekond = "j"
       APjn.gekond = "j"
       CourtageJN.gekond = "j"
       PflegeJN.gekond = "j"
     END IF 
     bwvon.gekond = "01.01.1990"
     PflegeNachZahlw.gekond = "n"
     codege.gekond = codege.vprodukt
     codeva.gekond = codeva.vprodukt
     codevp.gekond = codevp.vprodukt
     codegrsp.gekond = codegrsp.vprodukt
     gruppe.gekond = gruppe.vprodukt
     CALL MATimeStamp("gekond")
     CALL QuickStore("gekond")
     CALL GEKONDUpdate()
     SELECT FORM KEY cuma% FILE "maadr" INDEX codema.maadr
     GEKONDsub% = 99
   END IF 
   FORM 
 ELSE 
   REM Einheitensystem, jetzt fÅr alle Produkte eine Konditionen erzeugen, 
   REM CALL Fehler("Einheitensystem","")
   CALL DFile(3,"vprodukt" + _fpw$)
   CALL DFile(3,"sparten" + _fpw$)
   CALL DFile(3,"kvertrag" + _fpw$)
   SELECT WHERE FILE "Sparten"
   CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
   SELECT WHERE FILE "geadr"
   CALL DFile(3,"spgruppe" + _fpw$)
   SELECT WHERE FILE "spgruppe"
   SELECT WHERE FILE "vprodukt"
   SELECT FIRST FILE "Vprodukt" INDEX codevp.vprodukt
   MOUSE OFF 
   i% = 0
   j% = RECCOUNT ("vprodukt")
   REM  CALL Fehler("Es werden fÅr alle noch fehlenden Produkte die Konditionen angelegt!","Ausnahme: Es werden nur Produkte berÅcksichtigt, die fÅr die Anzeige freigegeben wurden!")
   REM *********************************************************************************************************************************************************************************
   ON ERROR GOTO err291120061
   DIM Vertraege$(1)
err291120061: 
   ON ERROR GOTO ErrorHandler
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     REDIM Vertraege$(20000,1)
     REDIM Vertraege$(20000)
   ELSE 
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"),1)
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
anfsu200820062:    
 a% = 0
 ok% = - 1
 anzv% = 0
 SELECT WHERE FILE "KVERTRAG"
 SELECT FIRST 
 WHILE ok%
 
   IF spa% = 0 THEN 
     vSparte$ = "alle"
   ELSE 
     SELECT FIRST FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY spa% FILE "SPARTEN" INDEX CodeVA.SPARTEN
     vsparte$ = Sparte.SPARTEN
   END IF 
   IF spgr% < 1 THEN 
     vSpGR$ = "alle"
   ELSE 
     SELECT FIRST FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
     SELECT KEY spgr% FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
     vspGr$ = Gruppe.SPGRUPPE
   END IF 
   IF ge% = 0 THEN 
     Gesellschaft$ = "alle"
   ELSE 
     SELECT FIRST FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
     Gesellschaft$ = Gesellschaft.GEADR
     REM ** Gesellschaft auswÑhlen
   END IF 
   IF cvp% = 0 THEN 
     vprodukt$ = "alle"
   ELSE 
     SELECT KEY cvp% FILE "Vprodukt" INDEX codevp.vprodukt
     vprodukt$ = gesellschaft.vprodukt + "/" + sparte.vprodukt
   END IF 
   
     CREATE DIALOG "BVERTRAG",0,0,446,120,"Filter","MS Sans Serif",8
     ADD DIALOG "BVERTRAG",4,5,6,431,97,0,"setzen Sie Filter Åber Sparten Gesellschaften oder/und Spartengruppen,"
     ADD DIALOG "BVERTRAG",5,238,14,190,40,0,"wenn Sie nur ausgewÑhlte Konditionen erzeugen mîchten"
     ADD DIALOG "BVERTRAG",5,8,26,28,10,0,"Produkt"
     ADD DIALOG "BVERTRAG",5,57,26,167,10,0,vProdukt$
     ADD DIALOG "BVERTRAG",1,218,26,14,10,0,"...",9,1
     ADD DIALOG "BVERTRAG",5,8,37,43,10,0,"Gesellschaft"
     ADD DIALOG "BVERTRAG",5,57,37,167,10,0,Gesellschaft$
     ADD DIALOG "BVERTRAG",1,218,37,14,10,0,"...",4,1
     ADD DIALOG "BVERTRAG",5,8,48,24,10,0,"Sparte"
     ADD DIALOG "BVERTRAG",5,57,48,167,10,0,vSparte$
     ADD DIALOG "BVERTRAG",1,218,48,14,10,0,"...",5,1
     ADD DIALOG "BVERTRAG",5,8,59,49,9,0,"Spartengruppe"
     ADD DIALOG "BVERTRAG",5,57,59,167,9,0,vSpGr$
     ADD DIALOG "BVERTRAG",1,218,59,14,9,0,"...",6,1
     ADD DIALOG "BVERTRAG",1,126,104,55,14,1,"&OK",1,1
     REM ADD DIALOG "BVERTRAG",1,184,104,55,14,0,"&Abbrechen",0,0
     DIALOG "BVERTRAG",dreq%
     negativsu% = 0
     SELECT CASE dreq%
     CASE 4
       ge% = GetCodeGE%(ge%)
     CASE 5
       spa% = GetCodeVA%(spa%)
     CASE 6
       spgr% = GetCodeGR%(spgr%)
     CASE 9
       REM Produkt auswÑhlen
       IF GOldProdSu$ LIKE "TRUE" THEN 
         cvp% = GetVprodukt%(0,0, - 1)
       ELSE 
         cvp% = NewGetCodeVP%()
       END IF 
     END SELECT 
     REMOVE DIALOG "BVERTRAG"
     IF dreq% = 1 THEN ok% = 0
   WEND 
   REM *********************************************************************************************************************************************************************************
   REQUEST "Soll diese Aktion jetzt ausgefÅhrt werden?","",130,req%
   SELECT FIRST FILE "Vprodukt" INDEX codevp.vprodukt
   WHILE NOT EOF ("vprodukt") AND req% = 1
     i% = i% + 1
     SET STATUS STR$ (i%) + " von " + STR$ (j%) + " Konditionen erzeugt"
     QuickCode$ = STR$ (Cuma%,"000000") + STR$ (CodeGE.vprodukt,"000000") + STR$ (CodeVA.vprodukt,"000000")
     ok% = - 1
     IF EXISTS (QuickCode$,QuickCode.gekond) THEN ok% = 0
     IF NoAnzeige.vprodukt = "j" THEN ok% = 0
     IF ge% > 0 THEN 
       IF codege.vprodukt <> ge% THEN ok% = 0
     END IF 
     IF spa% > 0 THEN 
       IF codeva.vprodukt <> spa% THEN ok% = 0
     END IF 
     IF spgr% > 0 THEN 
       IF codegrsp.vprodukt <> spgr% THEN ok% = 0
     END IF 
     IF cvp% > 0 THEN 
       IF codevp.vprodukt <> cvp% THEN ok% = 0
     END IF 
     IF ok% = - 1 THEN 
       BLANK FILE "gekond"
       lfdnr.gekond = SER ("gekond",1)
       codema.gekond = cuma%
       BWvon.gekond = "1.1.1990"
       CourtageZWjn.gekond = "n"
       PflegeNachZahlw.gekond = "n"
       codege.gekond = codege.vprodukt
       codeva.gekond = codeva.vprodukt
       codevp.gekond = codevp.vprodukt
       codegrsp.gekond = codegrsp.vprodukt
       gruppe.gekond = gruppe.vprodukt
       SELECT FIRST FILE "sparten" INDEX codeva.sparten
       SELECT KEY codeva.vprodukt FILE "sparten" INDEX codeva.sparten
       REM Sach
       codegrsp.gekond = codegrsp.sparten
       courtagejn.gekond = "j"
       apjn.gekond = "n"
       REM Leben
       IF SparteIstSach.sparten = 1 THEN 
         courtagejn.gekond = "n"
         apjn.gekond = "j"
       END IF 
 
       nureinh.gekond = "j"
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
     SELECT NEXT FILE "Vprodukt" INDEX codevp.vprodukt
   WEND 
   IF req% = 1 THEN CALL Fehler("Es wurden die Konditionen fÅr diesen Mitarbeiter erzeugt!","Sie haben jetzt die Mîglichkeit anzugeben, wieviel Euro pro Einheit in die Konditionen dieses Mitarbeiters eingetragen werden sollen!")
   IF req% = 1 THEN CALL EintragEinh()
   IF req% <> 1 THEN 
     _formend% = 1
   END IF 
   SELECT FORM KEY cuma% FILE "maadr" INDEX codema.maadr
   FORM 
 END IF 
 END SUB 
 
 
 
 
SUB GEKONDEinhLoe()
 IF disabled%("GEKONDLOESCHEN") THEN END SUB 
 FILE "GEKOND"
 MOUSE OFF 
 REQUEST "Wollen Sie alle zur Zeit nicht verwendeten Konditionen lîschen?","",130,req%
 IF req% = 0 THEN END SUB 
 CALL DFile(3,"vkond" + _fpw$)
 cuko% = lfdnr.GEKOND
 REM cuma% = codema.gekond
 FILE "GEKOND"
 SELECT FIRST FILE "gekond" INDEX codema.gekond
 SELECT KEY cuma% LOCK FILE "gekond" INDEX codema.gekond
 WHILE NOT EOF ("gekond") AND codema.gekond = cuma%
   IF NOT EXISTS (lfdnr.GEKOND,CodeKO.VKOND) THEN 
     SELECT REMOVE FILE "gekond"
     SELECT FIRST FILE "gekond" INDEX codema.gekond
     SELECT KEY cuma% LOCK FILE "gekond" INDEX codema.gekond
   ELSE 
     SELECT NEXT LOCK FILE "gekond" INDEX codema.gekond
   END IF 
 WEND 
 IF EXISTS (cuma%,codema.gekond) THEN 
   SELECT KEY cuma% FILE "gekond" INDEX codema.gekond
 ELSE 
   _formend% = 1
 END IF 
 SELECT FORM KEY cuma% FILE "maadr" INDEX codema.maadr
 FORM 
 MOUSE ON 
 END SUB 
 
 

SUB EintragEinhSto()

     DIM dlg1 AS Dialog
     DIM control AS DialogControl 
     optemail% = 1
     akt% = 1
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,134,129)
    dlg.Caption = "Anpassung Konditionen"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,7,133,60)
    control.Caption = "Anpassung bei Konditionen mit:"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(12,25,106,18)
    control.Caption = "AP"
    control.Bind("optemail%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(12,44,106,18)
    control.Caption = "Courtage"
    control.Bind("optemail%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
    control.Move(10,70,99,19)
    control.Caption = "aktivieren/deaktivieren"
    control.Bind("akt%")
    control.ValueOn = 1
    control.ValueOff = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(8,102,56,16)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(65,102,56,16)
    control.Caption = "Abbruch"
    control.ReturnValue = 0
  
    DIALOG "Dialogname",reqemail%
    REMOVE DIALOG "Dialogname"

    IF reqemail% = 0 THEN END SUB 


 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Eintrag Storno","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Storno:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, welcher Wert bei"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Storno eingetragen werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Prozent:"
 REM ADD DIALOG "ANPASSUNG",5,86,60,7,8,0,"%"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 THEN 
   MOUSE OFF 
   FILE "gekond"
   INDEX codema.gekond
   SELECT FIRST FILE "gekond" INDEX codema.gekond
   SELECT KEY cuma% LOCK FILE "gekond" INDEX codema.gekond
   WHILE NOT EOF ("gekond") AND codema.gekond = cuma%
     IF codema.gekond = cuma% THEN 
       IF optemail% = 1 THEN 
         IF apjn.gekond = "j" THEN 
           IF akt% = 1 THEN 
             srjn.gekond = "j"
             sr.gekond = anp%
           ELSE 
             srjn.gekond = "n"
             sr.gekond = anp%
           END IF 
         END IF 
       END IF 
       IF optemail% = 2 THEN 
         IF courtagejn.gekond = "j" THEN 
           IF akt% = 1 THEN 
             srjn.gekond = "j"
             sr.gekond = anp%
           ELSE 
             srjn.gekond = "n"
             sr.gekond = anp%
           END IF 
         END IF 
       END IF 
       STORE FILE "gekond"
     END IF 
     SELECT NEXT LOCK FILE "gekond" INDEX codema.gekond
   WEND 
 END IF 
   SELECT FORM KEY cuma% FILE "maadr" INDEX codema.maadr
   FORM 
   MOUSE ON 
 END SUB 
 
SUB EintragEinhPfle()
     DIM dlg1 AS Dialog
     DIM control AS DialogControl 
     optemail% = 1
     akt% = 1
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,134,129)
    dlg.Caption = "Anpassung Konditionen"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,7,133,60)
    control.Caption = "Anpassung bei Konditionen mit:"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(12,25,106,18)
    control.Caption = "AP"
    control.Bind("optemail%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(12,44,106,18)
    control.Caption = "Courtage"
    control.Bind("optemail%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
    control.Move(10,70,99,19)
    control.Caption = "aktivieren/deaktivieren"
    control.Bind("akt%")
    control.ValueOn = 1
    control.ValueOff = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(8,102,56,16)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(65,102,56,16)
    control.Caption = "Abbruch"
    control.ReturnValue = 0
  
    DIALOG "Dialogname",reqemail%
    REMOVE DIALOG "Dialogname"
 
    IF reqemail% = 0 THEN END SUB 
 
 CREATE DIALOG "ANPASSUNG",0,0,177,110,"Eintrag Pflege","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Pflege:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, wieviel Prozent bei"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Pflege eingetragen werden soll."
 ADD DIALOG "ANPASSUNG",6,47,43,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,43,38,11,0,"Prozent:"
 ADD DIALOG "ANPASSUNG",6,47,62,29,13,0,0,anp1$,2
 ADD DIALOG "ANPASSUNG",5,6,62,38,11,0,"Start nach:"
 ADD DIALOG "ANPASSUNG",5,106,62,38,11,0,"Monaten"
 REM ADD DIALOG "ANPASSUNG",5,86,60,7,8,0,"%"
 ADD DIALOG "ANPASSUNG",1,34,85,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,85,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 anp1% = VAL (anp1$)
 anp1$ = STR$ (anp1%)
 IF req% = 1 THEN 
   MOUSE OFF 
   FILE "gekond"
   INDEX codema.gekond
   SELECT FIRST FILE "gekond" INDEX codema.gekond
   SELECT KEY cuma% LOCK FILE "gekond" INDEX codema.gekond
   WHILE NOT EOF ("gekond") AND codema.gekond = cuma%
     IF codema.gekond = cuma% THEN 
       IF optemail% = 1 THEN 
         IF apjn.gekond = "j" THEN 
           IF akt% = 1 THEN 
             pflegejn.gekond = "j"
           ELSE 
             pflegejn.gekond = "n"
           END IF 
           pflegeprovi.gekond = anp%
           pflegezeit.gekond = anp1%
           pflegenachzahlw.gekond = "n"
           STORE FILE "gekond"
         END IF 
       END IF 
       IF optemail% = 2 THEN 
         IF courtagejn.gekond = "j" THEN 
           IF akt% = 1 THEN 
             pflegejn.gekond = "j"
           ELSE 
             pflegejn.gekond = "n"
           END IF 
           pflegeprovi.gekond = anp%
           pflegezeit.gekond = anp1%
           pflegenachzahlw.gekond = "n"
           STORE FILE "gekond"
         END IF 
       END IF 
     END IF 
     SELECT NEXT LOCK FILE "gekond" INDEX codema.gekond
   WEND 
 END IF 
   SELECT FORM KEY cuma% FILE "maadr" INDEX codema.maadr
   FORM 
   MOUSE ON 
 END SUB 
 
 
 
 
 
SUB EintragEinh()
 CREATE DIALOG "ANPASSUNG",0,0,177,144,"Eintrag eines Wertes Euro/Einheit","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,10,159,8,0,"Bitte beachen Sie die Filtereinstellungen"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,gesfi$
 ADD DIALOG "ANPASSUNG",5,6,30,159,8,0,sparfi$
 ADD DIALOG "ANPASSUNG",5,6,40,159,8,0,spgfi$

 REM ADD DIALOG "ANPASSUNG",5,6,56,116,10,0,"Euro pro Einheit:"
 ADD DIALOG "ANPASSUNG",5,6,70,159,8,0,"Bitte geben Sie ein, welcher Wert bei"
 ADD DIALOG "ANPASSUNG",5,6,80,150,8,0,"Euro pro Einheit eingetragen werden soll."
 ADD DIALOG "ANPASSUNG",6,46,99,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,99,38,11,0,"Wert:"
 REM ADD DIALOG "ANPASSUNG",5,86,60,7,8,0,"%"
 ADD DIALOG "ANPASSUNG",1,34,120,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,120,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 THEN 
   REQUEST "Wollen Sie wirklich diese Konditionen Ñndern?","Die énderung kann nicht rÅckgÑngig gemacht werde!",135,req%
   IF req% <> 1 THEN GOTO e210920061
   IF anp% = 0 THEN 
     REQUEST "Wollen Sie wirklich diese Konditionen auf NULL setzen?","Die énderung kann nicht rÅckgÑngig gemacht werde!",135,req%
     IF req% <> 1 THEN GOTO e210920061
   END IF 
   MOUSE OFF 
   FILE "gekond"
   INDEX codema.gekond
   SELECT FIRST FILE "gekond" INDEX codema.gekond
   SELECT KEY cuma% LOCK FILE "gekond" INDEX codema.gekond
   WHILE NOT EOF ("gekond") AND codema.gekond = cuma%
     IF codema.gekond = cuma% THEN 
       EuroproEinh.gekond = anp%
       STORE FILE "gekond"
     END IF 
     SELECT NEXT LOCK FILE "gekond" INDEX codema.gekond
   WEND 
 END IF 
e210920061: 
 SELECT FORM KEY cuma% FILE "maadr" INDEX codema.maadr
 FORM 
 MOUSE ON 
 END SUB 
  
 



SUB GEKONDUpdA()
 SELECT KEY CodeGE.GEKOND FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY CodeVA.GEKOND FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY CodeMA.GEKOND FILE "MAADR" INDEX CodeMA.MAADR
 Gesellschaft$ = IF ( FOUND ("GEADR"),Gesellschaft.GEADR,"<keine Zuordnung>")
 Sparte$ = IF ( FOUND ("SPARTEN"),Sparte.SPARTEN,"<keine Zuordnung>")
 Agentur$ = Nachname.MAADR + ", " + Vorname.MAADR
 IF EXISTS (QCodeGEVA.gekond,QCodeGEVA.vprodukt) THEN 
   SELECT KEY QCodeGEVA.gekond FILE "Vprodukt" INDEX QCodegeVA.vprodukt
   IF kurzname.vprodukt <> "" THEN 
     vgessparte$ = kurzname.VPRODUKT + " / " + Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt
   ELSE 
     vgessparte$ = Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt
   END IF 
 ELSE 
   vgessparte$ = "Bitte wÑhlen Sie hier ein Produkt aus!"
 END IF 
 IF EXISTS (lfdnr.gekond,CodeKO.VKOND) THEN 
   REM f.combosparte.BackColor = 0
 ELSE 
   REM f.combosparte.BackColor = 8
 END IF 
 FORM 
 END SUB 
 
 ' GEKOND Eintrag zurÅck
 ' =======================================================================
 
SUB GEKONDPrevA()
 FILE "GEKOND"
 IF MOD ("GEKOND") OR NEW ("GEKOND") THEN CALL FStore("GEKOND")
 cuko% = lfdnr.gekond
 SET INDEX QuickCodeGes.GEKOND
 SELECT FORM PREVIOUS INDEX QuickCodeGes.gekond
 IF (codema.gekond <> cuma%) AND gekondtr% = 0 THEN 
   REQUEST "Keine weiteren Konditionen!","",2
   SELECT FORM KEY cuko% INDEX lfdnr.gekond
 END IF 
 FORM 
 END SUB 
 
 
 ' GEKOND Eintrag vor
 ' =======================================================================
 
SUB GEKONDNextA()
 FILE "GEKOND"
 IF MOD ("GEKOND") OR NEW ("GEKOND") THEN CALL FStore("GEKOND")
 cuko% = lfdnr.gekond
 SET INDEX QuickCodeGes.GEKOND
 SELECT FORM NEXT INDEX QuickCodeGes.GEKOND
 IF (codema.gekond <> cuma%) AND gekondtr% = 0 THEN 
   REQUEST "Keine weiteren Konditionen!","",2
   SELECT FORM KEY cuko% INDEX lfdnr.gekond
 END IF 
 FORM 
 END SUB 
 
SUB MNGEKONDA()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
  
 ' Vertrag in Verprovisionierung aufnehmen
 ' ========================================================================
 
SUB AutProvUeb()
 IF disabled%("FIRMENSTAMMEDIT") THEN END SUB 
 REQUEST "Wollen Sie wirklich die VertrÑge automatisch","an die Abrechnung Åbergeben?",130,req%
 IF req% <> 1 THEN END SUB 
 t1$ = "Diese Funktion versucht soviele VertrÑge (deren Policenr. ausgefÅllt ist) wie mîglich an die Provisionsabrechnung zu Åbergeben! Alle anderen User mÅssen die Anwendung beendet haben!!"
 t2$ = "Die besten Chancen bestehen wenn Sie bei den Konditionen der Mitarbeiter nur eine Kondition pro Mitarbeiter und Produkt definiert haben!"
 CALL Fehler(t1$,t2$)
 REQUEST "Wollen Sie wirklich die VertrÑge automatisch an die","Abrechnung Åbergeben?",130,req%
 IF req% <> 1 THEN END SUB 
 REQUEST "Haben alle anderen User die Anwendung beendet?","",130,req%
 IF req% <> 1 THEN END SUB 
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"Sparten" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
 ELSE 
   CALL DFile(3,"zeingan1" + _fpw$)
 END IF 
 i% = 0
 j% = RECCOUNT ("kvertrag")
 f% = 0
 io% = 0
 FILE "kvertrag"
 INDEX lfdnr.kvertrag
 SELECT FIRST LOCK 
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
   ZahlungJN$ = "n"
 ELSE 
   ZahlungJN$ = "j"
 END IF 
 
 CALL CreateLog()
 CALL WriteLog("")
 CALL WriteLog("=================================")
 CALL WriteLog("automatische öbernahme der VertrÑge an die Provisionsabrechnung " + DATE$ ( TODAY ,"0d.mm.yyyy"))
 CALL WriteLog("=================================")
 CALL WriteLog("Kunde                            Vertrag             Produkt               Mitarbeiter              Fehler/Warnung")

 cfile$ = FILE 
 REQUEST "Sollen die VertrÑge mit Datum Vertragsbeginn Åbergeben werden -> JA","oder mit Datum Antrag/énderung->NEIN",130,req%
 IF req% = 1 THEN 
   vb% = 1
 ELSE 
   vb% = 0
 END IF 
 IF PrvVerfahr$ LIKE "ZAHLUNGSEINGANG" THEN 
   REQUEST "oder sollen die VertrÑge mit Datum des 1. Zahlungseinganges","an die Provisionsabrechnung Åbergeben werden?",130,req%
   IF req% = 1 THEN 
     vb% = 2
   END IF 
   REM Andi spezial
   REM vb% = 3
   REM OPEN FILE SHARE ,0_ppath$ + "A11111.SBF"
 END IF 


 WHILE NOT EOF ("kvertrag")
   MOUSE OFF 
   i% = i% + 1
   cuvt% = lfdnr.KVERTRAG
   codeku% = codeku.kvertrag
   codema% = codema.kvertrag
   codege% = codege.kvertrag
   codeva% = codeva.kvertrag
   ok% = 2
   REM CALL WriteLog("")
   Haftvertrag% = SRHaftung.kvertrag
   REM IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
   IF ProviAb.kvertrag > 0 OR Fremdvertrag.KVERTRAG LIKE "j" OR Altvertrag.KVERTRAG LIKE "j" THEN 
     REM SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     REM IF CodeVStatus.kvertrag = 1 OR CodeVStatus.kvertrag = 2 THEN vstatus% = 0
     REM CALL VStat()
     
   ELSE 
     ok% = 1
     IF vs_nr.kvertrag = "" THEN ok% = 0
     IF codeku% < 1 OR NOT EXISTS (codeku%,codeku.GADRDat$) THEN 
       ok% = 0
       CALL WriteLog("Kein Kunde zu Vertrag " + VS_NR.kvertrag + " gefunden")
     END IF 
     IF codema% < 1 OR NOT EXISTS (codema%,codema.maadr) THEN 
       ok% = 0
       CALL WriteLog("Kein Mitarbeiter zu Vertrag " + VS_NR.kvertrag + " angegeben")
     END IF 
     IF ok% = 0 THEN GOTO endw131000001
     SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     a$ = TRIM$ ( LTRIM$ (Kundennummer.GAdrDat$ + "," + Nachname.GAdrDat$ + "," + Vorname.GAdrDat$ + "," + VS_NR.Kvertrag + "," + Produkt.kvertrag + ", Agentur: " + Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr)) + CHR$ (13) + CHR$ (10)
     IF Bewertungssumme.KVERTRAG = 0 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         REM ok% = 0
         IF Gfsc% <> - 1 THEN CALL WriteLog(a$ + "WARNUNG: Bewertungssumme=0")
       ELSE 
         IF Gfsc% <> - 1 THEN CALL WriteLog(a$ + "WARNUNG: Bewertungssumme=0")
       END IF 
       REM CALL Fehler("WARNUNG!","Bitte prÅfen Sie die Bewertungssumme. Sie ist zur Zeit 0! Der Vertrag kann aber trotzdem abgerechnet werden!")
     END IF 
     REM 030697
     IF zw.kvertrag = 55 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: keine Zahlweise vorhanden")
       ELSE 
         IF Gfsc% <> - 1 THEN CALL WriteLog(a$ + "WARNUNG: keine Zahlweise vorhanden")
       END IF 
       REM CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie erst die Zahlweise ein.")
     END IF 
 
     END IF 
     IF Beitrag.KVERTRAG = 0 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         REM ok% = 0
         IF Gfsc% <> - 1 THEN CALL WriteLog(a$ + "WARNUNG: kein Beitrag vorhanden")
       ELSE 
         IF Gfsc% <> - 1 THEN CALL WriteLog(a$ + "WARNUNG: kein Beitrag vorhanden")
       END IF 
       REM CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie den Beitrag ein.")
     END IF 
     IF CodeGE.KVERTRAG = 0 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein PRODUKT vorhanden")
       ELSE 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein PRODUKT vorhanden")
       END IF 
       REM CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Gesellschaft aus.")
     END IF 
     IF CodeMA.KVERTRAG = 0 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein MITARBEITER vorhanden")
       ELSE 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein MITARBEITER vorhanden")
       END IF 
       REM CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Agentur aus.")
     END IF 
     IF CodeVA.KVERTRAG = 0 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein PRODUKT vorhanden")
       ELSE 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein PRODUKT vorhanden")
       END IF 
       REM CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Sparte aus.")
     END IF 
     IF DAYS (VS_Beginn.KVERTRAG) = 0 AND vb% = 1 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein VERSICHERUNGSBEGINN vorhanden")
       ELSE 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein VERSICHERUNGSBEGINN vorhanden")
       END IF 
       REM CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie den Vertragsbeginn an.")
     END IF 
     IF DAYS (Antragsdatum.KVERTRAG) = 0 AND vb% = 0 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein Antragsdatum/énderungsdatum vorhanden")
       ELSE 
         ok% = 0
         CALL WriteLog(a$ + "FEHLER: kein Antragsdatum/énderungsdatum vorhanden")
       END IF 
       REM CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie den Vertragsbeginn an.")
     END IF 
     IF vb% = 2 THEN 

           IF EXISTS (lfdnr.kvertrag,codevt.zeingan1) THEN 
             REM CALL Fehler("ist da","")
             codevt% = lfdnr.kvertrag
             cfile$ = FILE 
             FILE "zeingan1"
             INDEX codevt.zeingan1
             SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
             SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
             d0512% = Buchungsdatum.zeingan1
             WHILE NOT EOF ("zeingan1") AND codevt.zeingan1 = codevt%
               IF Buchungsdatum.zeingan1 < d0512% THEN 
                 d0512% = Buchungsdatum.zeingan1
               END IF 
               SELECT NEXT FILE "zeingan1" INDEX codevt.zeingan1
             WEND 
             FILE cfile$
           ELSE 
             ok% = 0
             CALL WriteLog(a$ + "FEHLER: Zahlungseingang (Datum) vorhanden")
           END IF 
     END IF 
     IF vb% = 3 THEN 
       IF EXISTS (lfdnr.kvertrag,lfdnr.a11111) THEN 
         SELECT FIRST FILE "a11111" INDEX lfdnr.a11111
         SELECT KEY lfdnr.kvertrag FILE "a11111" INDEX lfdnr.a11111
         d0512% = proviab.a11111
       ELSE 
         ok% = 0
       END IF 
     END IF 
a0512200101: 
     IF ok% = 0 THEN f% = f% + 1
     IF ok% = 1 THEN 
       erg% = 1
       REM REQUEST "Vertrag in monatliche Abrechnung Åbernehmen?","",130,erg%
       IF erg% = 1 THEN 
         REM 160996 ProviAb$ = DATE$ ( TODAY ,"dd.mm.yy")
         IF vb% = 1 THEN ProviAb$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF vb% = 0 THEN ProviAb$ = DATE$ (Antragsdatum.KVERTRAG,"0d.mm.yyyy")
         IF vb% = 2 THEN ProviAb$ = DATE$ (d0512%,"0d.mm.yyyy")
         IF vb% = 3 THEN ProviAb$ = DATE$ (d0512%,"0d.mm.yyyy")
           
         ZahlungJN$ = "n"
wied131000001: 
         req% = 1
         IF req% = 1 THEN 
           bwbezug$ = ReadConfig$("PROVIS","Bewertungszeitraum")
           tt$ = LEFT$ (ProviAb$,2)
           tt% = VAL (tt$)
           IF tt% > 28 THEN 
             tt% = 28
           END IF 
           IF vb% = 1 THEN BWStart$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF vb% = 0 THEN BWStart$ = DATE$ (Antragsdatum.KVERTRAG,"0d.mm.yyyy")
           IF vb% = 2 THEN BWStart$ = DATE$ (d0512%,"0d.mm.yyyy")
           IF vb% = 3 THEN BWStart$ = DATE$ (d0512%,"0d.mm.yyyy")
           IF DateOK%(BWStart$) THEN 
             GFehl$ = ""
             IF EXISTS (codema%,codema.gekond) THEN 
               kond% = GetKond%(cuvt%, DAYS (BWStart$),0)
             ELSE 
               kond% = 0
             END IF 
             IF kond% = 0 THEN 
               IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
               REM CALL Fehler(fehlnach$,"")
               SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
               ProviAb.kvertrag = 0
               CodeKO.KVERTRAG = 0
               REM kondition.KVERTRAG = SelKond%
               CALL FStore("KVERTRAG")
               IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
                 ok% = 0
                 CALL WriteLog(a$ + "FEHLER: keine KONDITION vorhanden")
               ELSE 
                 ok% = 0
                 CALL WriteLog(a$ + "FEHLER: keine KONDITION vorhanden")
               END IF 
               IF GFehl$ <> "" THEN CALL WriteLog(GFehl$)
               GFehl$ = ""
               f% = f% + 1
               REM ### ToDo: Fehlerliste anzeigen
             ELSE 
               REM doprov% = EditKond%(kond%)
               doprov% = 1
               IF doprov% = 1 THEN 
                 SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
                 ProviAb.kvertrag = DAYS (ProviAb$)
                 Check.KVERTRAG = ZahlungJN$
                 CodeKO.KVERTRAG = kond%
                 REM kondition.KVERTRAG = SelKond%
                 REM 201299
                 CodeVStatus.kvertrag = 1
                 VStatusTxT.kvertrag = "lebend"
                 io% = io% + 1
                 IF ProviAb.kvertrag > 0 AND ProviAb.kvertrag <= TODAY THEN 
                   IF KÅndigung.kvertrag > 0 THEN 
                     IF KÅndigung.kvertrag >= TODAY THEN 
                       VertragAktiv.kvertrag = "j"
                     ELSE 
                         VertragAktiv.kvertrag = "n"
                     END IF 
                   ELSE 
                     VertragAktiv.kvertrag = "j"
                   END IF 
                 ELSE 
                   VertragAktiv.kvertrag = "n"
                 END IF 
                 IF TatsKuenDat.kvertrag > 0 THEN 
                   IF TatsKuenDat.kvertrag >= TODAY THEN 
                     VertragAktiv.kvertrag = "j"
                   ELSE 
                     VertragAktiv.kvertrag = "n"
                   END IF 
                 END IF 
                 REM REQUEST "Vertrag wird ab sofort in die Provisionierung","mit einbezogen!",2
                 CALL FStore("KVERTRAG")
                 REM 07102000 weder Agentur noch Verwaltung
               END IF 
             END IF 
           ELSE 
               IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
                 ok% = 0
                 CALL WriteLog(a$ + "FEHLER: ungÅltiges Datum VERSICHERUNGSBEGINN  ->" + BWStart$)
               ELSE 
                 ok% = 0
                 CALL WriteLog(a$ + "FEHLER: ungÅltiges Datum VERSICHERUNGSBEGINN  ->" + BWStart$)
               END IF 
              CALL Fehler("Datum im falschen Format!","Bitte geben Sie das Datum in der Form 'tt.mm.jj' ein.")
           END IF 
         END IF 
       ELSE 
         ok% = 0
       END IF 
     ELSE 
       ok% = 0
     END IF 
   END IF 
endw131000001: 
   FILE "kvertrag"
   SELECT NEXT LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
   SET STATUS "VertrÑge bearbeitet " + STR$ (i%,"999999") + "  Åbergeben: " + STR$ (io%,"999999") + "  fehl: " + STR$ (f%,"999999") + " von gesamt: " + STR$ (j%,"999999")
   textaa$ = "VertrÑge bearbeitet " + STR$ (i%,"999999") + "  Åbergeben: " + STR$ (io%,"999999") + "  fehl: " + STR$ (f%,"999999") + " von gesamt: " + STR$ (j%,"999999")
   FORM 
 WEND 
 MOUSE ON 
 CALL WriteLog(textaa$)
 CALL CloseLog()
 FILE cfile$
 REM CALL VERTRUpdate()
 CALL Fehler("öbergabe der VertrÑge an die Provisionsabrechnung wurde beendet!","")
 MOUSE ON 
 END SUB 
 
  
SUB AutProvRew()
 IF disabled%("FIRMENSTAMMEDIT") THEN END SUB 
 REQUEST "Wollen Sie wirklich die automatische VertragsÅbergabe?","an die Abrechnung rÅckgÑngig machen?",130,req%
 IF req% <> 1 THEN END SUB 
 REQUEST "Haben alle anderen User die Anwendung beendet?","",130,req%
 IF req% <> 1 THEN END SUB 
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"Sparten" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 REMOVE FROM FILE "vkond"
 i% = 0
 j% = RECCOUNT ("kvertrag")
 f% = 0
 io% = 0
 FILE "kvertrag"
 INDEX lfdnr.kvertrag
 SELECT FIRST LOCK 
 WHILE NOT EOF ("Kvertrag")
   MOUSE OFF 
   i% = i% + 1
   REM IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
   ProviAb.kvertrag = 0
   CodeKO.KVERTRAG = 0
   REM kondition.KVERTRAG = SelKond%
   CALL QuickStore ("KVERTRAG")
   FILE "kvertrag"
   SELECT NEXT LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
   SET STATUS "VertrÑge bearbeitet " + STR$ (i%,"999999") + " von gesamt: " + STR$ (j%,"999999")
   textaa$ = "VertrÑge bearbeitet " + STR$ (i%,"999999") + " von gesamt: " + STR$ (j%,"999999")
   FORM 
 WEND 
 MOUSE ON 
 CALL Fehler("RÅckgÑngig machen der öbergabe der VertrÑge an die Provisionsabrechnung wurde beendet!","")
 END SUB 



SUB SpezialProvi()

 cuvt% = lfdnr.kvertrag
 knr% = codeku.kvertrag
 codema% = codema.kvertrag
 codeva% = codeva.kvertrag
 codege% = codege.kvertrag
 ges$ = Gesellschaft.kvertrag
 spa$ = Sparte.kvertrag
 
 BGEADRsub% = 0
 FILE "SPEZKOND"
 maske$ = "SPEZKOND"
 IF FirmaEinhTab.stamm LIKE "j" THEN 
   maske$ = "SPEZKON1"
   IF SpezProvNormal.stamm LIKE "j" THEN 
     maske$ = "SPEZKOND"
   END IF 
 END IF 
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " -Beteiligte Spezialvermittler"
     OPEN FORM GPrjForm$ + maske$
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\spezprov.pdf"
     CALL SPEZKONDIntro()
     CALL MNSPEZKOND()
     SET STATUS "Beteiligte Spezialvermittler"
   END IF 
   MENU ON 
   MOUSE ON 
   BGEADRsub% = 0
   CALL ClearKBDBuffer()
   
   IF proviab.kvertrag < 1 THEN 
     f.sich.visible = 0
     f.abbruch.visible = 0
     f.loe.visible = - 1
     f.neu.visible = - 1
     f.bearb.visible = - 1
     f.zur.visible = - 1
   ELSE 
     f.sich.visible = 0
     f.abbruch.visible = 0
      f.loe.visible = - 1
     f.neu.visible = - 1
     f.bearb.visible = - 1
     f.zur.visible = - 1
   END IF 
   FORM 
   FILE "SPEZKOND"
   IF BGEADRsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE BGEADRsub%
   CASE 1
     codekey% = codekey.spezkond
     REM IF proviab.kvertrag < 1 THEN 
     IF codekey% > 0 THEN 
       REM Agentur auswÑhlen
       codekey% = codekey.spezkond
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       SELECT KEY codekey% LOCK FILE "spezkond" INDEX codekey.spezkond
       IF ma% <> 0 THEN 
         IF ma% <> voncodema.spezkond THEN 
           codema.spezkond = ma%
           Agentur.SPEZKOND = Nachname.maadr + "," + Vorname.maadr
           CALL QuickStore("SPEZKOND")
           vagents$ = Agentur.spezkond
           a1$ = vonFirmaAgentur.spezkond
           f1$ = FirmaEinhTab.stamm
           IF (vonFirmaAgentur.spezkond = "n" AND FirmaEinhTab.stamm = "j") THEN 
           ELSE 
             IF (vorgÑnger.maadr <> codema.maadr) THEN 
               a1$ = "Es wird davon ausgegangen, das dieser Vermittler einer separaten Struktur angehîrt, die auf der hîchsten Ebene NICHT die eigentliche Firma als VorgÑnger besitzt, sondern eine in sich selbst geschlossene Struktur darstellt."
               a2$ = "Es wird weiterhin versucht Konditionen bei diesen Vermittlern zu finden!"
               CALL Fehler("Sie erhalten jetzt die Mîglichkeit zu bestimmen, ob die gesamte Struktur diese Vermittlers Spezialprovision erhalten soll.",a1$ + " " + a2$)
               REQUEST "Soll die Struktur eingetragen werden?","",135,reqstru%
               IF reqstru% = 1 THEN 
                 IF FirmaEinhTab.stamm LIKE "j" THEN 
                   CALL SpezStruEinh(ma%)
                 ELSE 
                   CALL SpezStruUeb(ma%)
                 END IF 
                 REMOVE FROM FILE "VKOND1"
                 CALL SPEZKONDIntro()
                 FORM 1
               END IF 
             END IF 
           END IF 
         ELSE 
           CALL Fehler ("Sie kînnen nicht die Spezialprovision von dem Mitarbeiter abziehen,der die Spezialprovision erhalten soll!","Bitte wÑhlen Sie einen anderen Mitarbeiter aus!")
         END IF 
       END IF 
       FORM 
     ELSE 
       CALL Fehler("Sie mÅssen erst den Vertrag Åber den Button <Status> deaktivieren, um énderungen an den","Spezialkonditionen durchfÅhren zu kînnen!")
     END IF 
   CASE 2
     CALL SPEZKONDSich()
   CASE 3
     IF NOT disabled%("SPEZKONDLOE") THEN 
       codevt1% = lfdnr.kvertrag
       CALL SPEZKONDLoe()
       IF NOT EXISTS (codevt1%,codevt.spezkond) THEN 
         SELECT KEY codevt1% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
         STORE FILE "KVERTRAG"
         SpezProvAktiv.kvertrag = "n"
         UNLOCK FILE "KVERTRAG"
         CALL Fehler("Keine weiteren Spezialistenkonditionen vorhanden!","")
         _formend% = 1
       END IF 
     END IF 
   CASE 4
      codekey% = codekey.spezkond
      SELECT KEY codekey% LOCK FILE "spezkond" INDEX codekey.spezkond
      IF codema.spezkond > 0 THEN 
        vagents$ = Agentur.spezkond
      ELSE 
        vagents$ = "WÑhlen Sie hier eine Agentur aus!"
      END IF 
      IF voncodema.spezkond > 0 THEN 
        vagents1$ = vonAgentur.spezkond
      ELSE 
        vagents1$ = "Die Spezialprovision wird der folgenden Agentur abgezogen!"
      END IF 
      FORM 2
   CASE 5
     CALL SPEZKONDNeu()
   CASE 6
     REM EmpfÑngeragentur festlegen
     IF proviab.kvertrag < 1 THEN 
       REM Agentur auswÑhlen
       codekey% = codekey.spezkond
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       SELECT KEY codekey% LOCK FILE "spezkond" INDEX codekey.spezkond
       
       IF ma% <> codema.spezkond THEN 
         SELECT KEY ma% FILE "maadr" INDEX codema.maadr
         voncodema.spezkond = ma%
         vonAgentur.SPEZKOND = Nachname.maadr + "," + Vorname.maadr
         IF ma% = 0 THEN vonAgentur.SPEZKOND = ""
         CALL QuickStore("SPEZKOND")
         vagents1$ = vonAgentur.spezkond
         IF ma% = 0 THEN vagents1$ = "Die Spezialprovision wird der folgenden Agentur abgezogen!"
       ELSE 
         CALL Fehler (Sie kînnen nicht die Spezialprovision von dem Mitarbeiter abziehen,der die Spezialprovision erhalten soll!","Bitte wÑhlen Sie einen anderen Mitarbeiter aus!")
       END IF 
       FORM 
     ELSE 
       CALL Fehler("Sie mÅssen erst den Vertrag Åber den Button <Status> deaktivieren, um énderungen an den","Spezialkonditionen durchfÅhren zu kînnen!")
     END IF 
   CASE 99
     REM 110197
     IF NOT disabled%("SPEZKONDBEARB") THEN 
       MOUSE ON 
       MENU OFF 
       REM IF RECCOUNT ("geadr") = 0 THEN CALL GEADRNeu()
         
         REM 101296
         REM _gesold$ = Gesellschaft.geadr
         REM CALL ButDesabled()
         REM f.notiz.enabled = 0
         REM f.vertragsuebersicht.enabled = 0
         f.sich.visible = - 1
         f.abbruch.visible = - 1
         f.loe.visible = 0
         f.bearb.visible = 0
         f.zur.visible = 0
         ENTER Prozente.SPEZKOND,0
         f.sich.visible = 0
         f.abbruch.visible = 0
         f.loe.visible = - 1
         f.bearb.visible = - 1
         f.zur.visible = - 1
         REM CALL ButEnabled()
         REM f.notiz.enabled = - 1
         REM f.vertragsuebersicht.enabled = - 1
     
     END IF 
   END SELECT 
   IF abbruch% = - 1 THEN 
     SELECT KEY codebge.kgeadr FILE "kgeadr" INDEX codebge.kgeadr
     FORM 
     abbruch% = 0
   END IF 
   MENU ON 
 WEND 
 _formend% = 0
 IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" AND SpezProvNormal.stamm <> "j" THEN 
   FILE "spezkond"
   INDEX codevt.spezkond
   SELECT FIRST FILE "spezkond" INDEX codevt.spezkond
   SELECT KEY cuvt% FILE "spezkond" INDEX codevt.spezkond
   ok% = - 1
   proz% = 0
   pausch% = 0
   tstr% = 0
   uproz% = 0
   vprozold% = Prozente.spezkond
   WHILE NOT EOF ("spezkond") AND ok% = - 1
     IF codevt.spezkond = cuvt% THEN 
       IF vonFirmaAgentur.spezkond = "j" THEN 
         proz% = proz% + 1
         IF vprozold% <> Prozente.spezkond THEN uproz% = 1
       ELSE 
         pausch% = pausch% + 1
       END IF 
       IF TStruk.spezkond = 1 THEN 
         tstr% = tstr% + 1
       END IF 
     ELSE 
       ok% = 0
     END IF 
     SELECT NEXT FILE "spezkond" INDEX codevt.spezkond
   WEND 
   IF proz% > 0 AND pausch% > 0 THEN 
     tt2$ = "oder Prozente, die der vertragsabschlie·enden Agentur abgezogen werden!"
     CALL Fehler("Sie dÅrfen bei einem Vertrag nur eine Art von Spezialistenkondition definieren, also entweder Pauschale die durch die Firma gezahlt wird, ",tt2$)
   END IF 
   IF uproz% > 0 THEN 
     CALL Fehler("Wenn mehr als ein Spezialist sich die Provision mit der vertragsabschlie·enden Agentur teilt, so mÅssen alle den gleichen Prozentwert haben!","")
   END IF 
   IF proz% = 0 AND pausch% > 1 THEN 
     REM CALL Fehler("Es darf bei der Pauschalzahlung nur ein Vermittler definiert werden, der diese bezieht!","")
   END IF 
   IF pausch% > 0 AND tstr% > 0 THEN 
     tt2$ = "oder Prozente, die der vertragsabschlie·enden Agentur abgezogen werden! Bei Pauschalzahlungen ist keine Strukturangabe zulÑssig!"
     CALL Fehler("Sie dÅrfen bei einem Vertrag nur eine Art von Spezialistenkondition definieren, also entweder Pauschale die durch die Firma gezahlt wird",tt2$)
   END IF 
 END IF 
 FILE "KVERTRAG"
 CALL VERTRIntro(1)
 END SUB 
 
  REM öbernahme aller zur Strukturgehîrenden, angefangen bei codema%
SUB SpezStruUeb(codema%)
 DIM macount$( RECCOUNT ("maadr"))
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond1" + _fpw$)
 FILE "maadr"
 INDEX codema.maadr
 SELECT KEY cuvt% FILE "kvertrag" INDEX lfdnr.kvertrag
 codege% = codege.kvertrag
 codeva% = codeva.kvertrag
 codevp% = codevp.kvertrag
 codekey% = codekey.spezkond
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr


 IF Gvueb$ = "TRUE" THEN 
   ProviAb$ = DATE$ (Antragsdatum.KVERTRAG,"0d.mm.yyyy")
 ELSE 
   ProviAb$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
 END IF 
 
 a% = i%
         CREATE DIALOG "SETPROVI",0,0,201,132,title$ + " RealCash","MS Sans Serif",8
         ADD DIALOG "SETPROVI",4,0,0,201,109,0,""
         ADD DIALOG "SETPROVI",9,7,10,20,20,2
         ADD DIALOG "SETPROVI",5,30,11,162,26,0,"Bitte geben Sie an, ab wann der Vertrag innerhalb der monatlichen Provisionsberechnung berÅcksichtigt werden soll."
         ADD DIALOG "SETPROVI",6,90,40,52,12,0,0,ProviAb$,10
         ADD DIALOG "SETPROVI",5,30,42,56,8,0,"Berechnung ab:"
         ADD DIALOG "SETPROVI",1,70,113,55,15,1,"&OK",1,1
         DIALOG "SETPROVI",req%
         REMOVE DIALOG ALL 

         BWStart$ = ProviAb$
         IF DateOK%(BWStart$) THEN 
           kond% = GetKondSpez%(cuvt%, DAYS (BWStart$),0,codema%)
           IF kond% = 0 THEN 
             IF EXISTS (cuvt%,CodeVT.VKOND1) THEN 
               REMOVE FROM FILE "VKOND1" WHERE CodeVT.VKOND1 = cuvt%
             END IF 
           ELSE 
             doprov% = EditKondSpez%(kond%,0)
             IF doprov% = 1 THEN 
               prozente% = 0
               prozenteold% = 0
               REM hier jetzt die DatensÑtze fÅr Spezkond erzeugen und die Prozente eintragen
               codevk% = VAL ( RIGHT$ (GKondlist$(0),6))
               IF codevk% > 0 THEN 
                 SELECT FIRST FILE "vkond1" INDEX codevk.vkond1
                 SELECT KEY codevk% FILE "vkond1" INDEX codevk.vkond1
                 codeko% = codeko.vkond1
                 SELECT FIRST FILE "gekond" INDEX lfdnr.gekond
                 SELECT KEY codeko% FILE "gekond" INDEX lfdnr.gekond
                 IF apjn.gekond LIKE "j" AND ap.gekond > 0 THEN 
                   prozente% = ap.gekond
                 END IF 
                 IF courtagejn.gekond LIKE "j" AND courtage.gekond > 0 THEN 
                   prozente% = courtage.gekond
                 END IF 
                 prozenteold% = prozente%
                 codema% = codema.gekond
                 SELECT FIRST FILE "spezkond" INDEX codekey.spezkond
                 SELECT KEY codekey% LOCK FILE "spezkond" INDEX codekey.spezkond
                 IF GFPB% <> - 1 THEN 
                   Prozente.spezkond = prozente%
                 END IF 
                 TStruk.spezkond = 1
                 CALL QuickStore("spezkond")
                 SELECT KEY codekey% FILE "spezkond" INDEX codekey.spezkond
               END IF 
               i% = 1
               WHILE GKondlist$(i%) <> ""
                 codevk% = VAL ( RIGHT$ (GKondlist$(i%),6))
                 IF codevk% > 0 THEN 
                   SELECT FIRST FILE "vkond1" INDEX codevk.vkond1
                   SELECT KEY codevk% FILE "vkond1" INDEX codevk.vkond1
                   codeko% = codeko.vkond1
                   SELECT FIRST FILE "gekond" INDEX lfdnr.gekond
                   SELECT KEY codeko% FILE "gekond" INDEX lfdnr.gekond
                   codema% = codema.gekond
                   SELECT FIRST FILE "maadr" INDEX codema.maadr
                   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
                   IF apjn.gekond LIKE "j" AND ap.gekond > 0 THEN 
                     prozente% = ap.gekond
                   END IF 
                   IF courtagejn.gekond LIKE "j" AND courtage.gekond > 0 THEN 
                     prozente% = courtage.gekond
                   END IF 

                   prozenteneu% = prozente% - prozenteold%
                   prozenteold% = prozente%
                   codema% = codema.gekond
                   BLANK DUPLICATE FILE "spezkond"
                   codekey% = SER ("spezkond",1)
                   codekey.spezkond = codekey%
                   codema.spezkond = codema%
                   Prozente.spezkond = prozenteneu%
                   Agentur.SPEZKOND = Nachname.maadr + "," + Vorname.maadr
                   CALL QuickStore("SPEZKOND")
                   SELECT KEY codekey% FILE "spezkond" INDEX codekey.spezkond
                 END IF 
                 i% = i% + 1
               WEND 
             END IF 
          END IF 
        END IF 
 END SUB 



  REM öbernahme aller zur Strukturgehîrenden fÅr RealCash Einheiten, angefangen bei codema%
SUB SpezStruEinh(codema%)
 DIM macount$( RECCOUNT ("maadr"))
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond1" + _fpw$)
 FILE "maadr"
 INDEX codema.maadr
 SELECT KEY cuvt% FILE "kvertrag" INDEX lfdnr.kvertrag
 codege% = codege.kvertrag
 codeva% = codeva.kvertrag
 codevp% = codevp.kvertrag
 codekey% = codekey.spezkond
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 
 REM EinhBuchJN
 EinhBuchJN$ = "j"
 IF Gvueb$ = "TRUE" THEN 
   ProviAb$ = DATE$ (Antragsdatum.KVERTRAG,"0d.mm.yyyy")
 ELSE 
   ProviAb$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
 END IF 
 
proz040920051: 
 CREATE DIALOG "SETPROVI",0,0,201,132,title$ + " RealCash-Prozente","MS Sans Serif",8
 ADD DIALOG "SETPROVI",4,0,0,201,109,0,""
 ADD DIALOG "SETPROVI",9,7,10,20,20,2
 ADD DIALOG "SETPROVI",5,30,11,162,26,0,"Bitte geben Sie an, ab mit wieviel Prozent die Spezialisten beteiligt werden sollen."
 ADD DIALOG "SETPROVI",6,90,40,52,12,0,0,Prozente%,10
 ADD DIALOG "SETPROVI",5,30,42,56,8,0,"Prozente:"
 ADD DIALOG "SETPROVI",1,10,113,55,15,1,"&OK",1,1
 ADD DIALOG "SETPROVI",1,70,113,55,15,0,"Abbruch",0,0
 DIALOG "SETPROVI",req%
 REMOVE DIALOG ALL 
 IF req% = 0 THEN GOTO end040920051
 IF prozente% <= 0 THEN 
   CALL Fehler("Es mu· ein Wert > NULL eingetragen werden!","")
   GOTO proz040920051
 END IF 

 a% = i%
anf040920052: 
         CREATE DIALOG "SETPROVI",0,0,201,132,title$ + " RealCash","MS Sans Serif",8
         ADD DIALOG "SETPROVI",4,0,0,201,109,0,""
         ADD DIALOG "SETPROVI",9,7,10,20,20,2
         ADD DIALOG "SETPROVI",5,30,11,162,26,0,"Bitte geben Sie an, ab wann der Vertrag innerhalb der monatlichen Provisionsberechnung berÅcksichtigt werden soll."
         ADD DIALOG "SETPROVI",6,90,40,52,12,0,0,ProviAb$,10
         ADD DIALOG "SETPROVI",5,30,42,56,8,0,"Berechnung ab:"
         ADD DIALOG "SETPROVI",1,10,113,55,15,1,"&OK",1,1
         ADD DIALOG "SETPROVI",1,70,113,55,15,0,"Abbruch",0,0
         DIALOG "SETPROVI",req%
         REMOVE DIALOG ALL 
         IF req% = 0 THEN GOTO end040920051
         IF NOT DateOK%(ProviAb$) THEN 
           CALL Fehler("Das eingegebene Datum ist ungÅltig!","")
           GOTO anf040920052
         END IF 
         BWStart$ = ProviAb$
         IF DateOK%(BWStart$) THEN 
           kond% = GetKondSpez%(cuvt%, DAYS (BWStart$),0,codema%)
           IF kond% = 0 THEN 
             IF EXISTS (cuvt%,CodeVT.VKOND1) THEN 
               REMOVE FROM FILE "VKOND1" WHERE CodeVT.VKOND1 = cuvt%
             END IF 
           ELSE 
             doprov% = EditKondSpez%(kond%,0)
             IF doprov% = 1 THEN 
               REM hier jetzt die DatensÑtze fÅr Spezkond erzeugen und die Prozente eintragen
               codevk% = VAL ( RIGHT$ (GKondlist$(0),6))
               IF codevk% > 0 THEN 
                 SELECT FIRST FILE "vkond1" INDEX codevk.vkond1
                 SELECT KEY codevk% FILE "vkond1" INDEX codevk.vkond1
                 codeko% = codeko.vkond1
                 SELECT FIRST FILE "gekond" INDEX lfdnr.gekond
                 SELECT KEY codeko% FILE "gekond" INDEX lfdnr.gekond
                 codema% = codema.gekond
                 SELECT FIRST FILE "spezkond" INDEX codekey.spezkond
                 SELECT KEY codekey% LOCK FILE "spezkond" INDEX codekey.spezkond
                   Prozente.spezkond = prozente%
                   EinhBuchJN.spezkond = EinhBuchJN$
                   EinhBuchJN$ = "n"
                   vonFirmaAgentur.spezkond = "j"
                   EuroproEinh.spezkond = EuroproEinh.gekond
                   APEurEinh.spezkond = APEurEinh.gekond
                   CourtEurEinh.spezkond = CourtEurEinh.gekond
                   PflEurEinh.spezkond = PflEurEinh.gekond
                   DynEurEinh.spezkond = DynEurEinh.gekond
                   FolgEurEinh.spezkond = FolgEurEinh.gekond
                   codekogekond.spezkond = lfdnr.gekond
                   APjn.spezkond = APjn.gekond
                   Courtagejn.spezkond = Courtagejn.gekond
                   Pflegejn.spezkond = Pflegejn.gekond
                   DynamikPJN.spezkond = DynamikPjn.gekond
                   Betreujn.spezkond = Betreujn.gekond
                 TStruk.spezkond = 1
                 sortKond.spezkond = 0
                 CALL QuickStore("spezkond")
                 SELECT KEY codekey% FILE "spezkond" INDEX codekey.spezkond
               END IF 
               i% = 1
               WHILE GKondlist$(i%) <> ""
                 codevk% = VAL ( RIGHT$ (GKondlist$(i%),6))
                 IF codevk% > 0 THEN 
                   SELECT FIRST FILE "vkond1" INDEX codevk.vkond1
                   SELECT KEY codevk% FILE "vkond1" INDEX codevk.vkond1
                   codeko% = codeko.vkond1
                   SELECT FIRST FILE "gekond" INDEX lfdnr.gekond
                   SELECT KEY codeko% FILE "gekond" INDEX lfdnr.gekond
                   codema% = codema.gekond
                   SELECT FIRST FILE "maadr" INDEX codema.maadr
                   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
                   codema% = codema.gekond
                   BLANK DUPLICATE FILE "spezkond"
                   codekey% = SER ("spezkond",1)
                   codekey.spezkond = codekey%
                   codema.spezkond = codema%
                   Prozente.spezkond = prozente%
                   EuroproEinh.spezkond = EuroproEinh.gekond
                   APEurEinh.spezkond = APEurEinh.gekond
                   CourtEurEinh.spezkond = CourtEurEinh.gekond
                   PflEurEinh.spezkond = PflEurEinh.gekond
                   DynEurEinh.spezkond = DynEurEinh.gekond
                   FolgEurEinh.spezkond = FolgEurEinh.gekond
                   codekogekond.spezkond = lfdnr.gekond
                   APjn.spezkond = APjn.gekond
                   Courtagejn.spezkond = Courtagejn.gekond
                   Pflegejn.spezkond = Pflegejn.gekond
                   DynamikPJN.spezkond = DynamikPjn.gekond
                   Betreujn.spezkond = Betreujn.gekond
                   EinhBuchJN.spezkond = EinhBuchJN$
                   EinhBuchJN$ = "n"
                   vonFirmaAgentur.spezkond = "j"
                   Agentur.SPEZKOND = Nachname.maadr + "," + Vorname.maadr
                   sortKond.spezkond = i%
                   CALL QuickStore("SPEZKOND")
                   SELECT KEY codekey% FILE "spezkond" INDEX codekey.spezkond
                 END IF 
                 i% = i% + 1
               WEND 
             END IF 
          END IF 
        END IF 
end040920051: 
 
 END SUB 
 

 
SUB SPEZKONDNeu()
 IF disabled%("SPEZKONDNEU") THEN END SUB 
 FILE "SPEZKOND"
 REM IF gesellschaft.Kgeadr <> "" THEN CALL FStore( FILE )
 REM SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
 SELECT KEY codeva.kvertrag FILE "sparten" INDEX codeva.sparten
 SELECT KEY codege.kvertrag FILE "geadr" INDEX codege.geadr

 BLANK FILE "SPEZKOND"
 SET STATUS "Datensatz neu angelegt..."
 CodeKey% = SER ("SPEZKOND",1)
 CodeKey.SPEZKOND = CodeKey%
 codevt.SPEZKOND = cuvt%
 codege.SPEZKOND = codege.kvertrag
 codeva.SPEZKOND = codeva.kvertrag
 Gesellschaft.SPEZKOND = LEFT$ (Gesellschaft.geadr,30)
 Sparte.SPEZKOND = LEFT$ (Sparte.sparten,60)
 vonFirmaAgentur.spezkond = "n"
 vonAP.spezkond = "n"
 vonCourtage.spezkond = "n"
 vonPflege.spezkond = "n"
 einmaligerfolgt.spezkond = "n"
 einmalig.spezkond = "n"
 REM Agentur.SPEZKOND = Nachname.maadr + "," + Vorname.maadr
 REM QVTGE.KGeadr = STR$ (lfdnr.kvertrag,"000000") + STR$ (codege.kgeadr,"000000")
 REM gesellschaft.kgeadr = "NEU"
 Agentur.spezkond = "<ohne Zuordnung>"
 CALL QuickStore("SPEZKOND")
 FORM 2
 SELECT FORM KEY codeKey% FILE "SPEZKOND" INDEX codeKey.SPEZKOND
 vagents$ = "WÑhlen Sie hier eine Agentur aus!"
 FORM 
 BGEADRsub% = 99
 MOUSE ON 
 END SUB 
 
SUB SPEZKONDSich()
   QCodeVTMA.SPEZKOND = STR$ (codevt.SPEZKOND,"000000") + STR$ (codema.SPEZKOND,"000000")
   QCodeGEVAMA.SPEZKOND = STR$ (codege.SPEZKOND,"000000") + STR$ (codeva.SPEZKOND,"000000") + STR$ (codema.SPEZKOND,"000000")
   Gesellschaft.SPEZKOND = LEFT$ (Gesellschaft.geadr,30)
   Sparte.SPEZKOND = LEFT$ (Sparte.sparten,60)
   REM Agentur.SPEZKOND = Nachname.maadr + "," + Vorname.maadr
   CALL QuickStore("SPEZKOND")
   SELECT KEY codevt.spezkond LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
   SpezProvAktiv.kvertrag = "j"
   STORE FILE "Kvertrag"
 END SUB 
 
SUB SPEZKONDIntro()
   
   FILE "SPEZKOND"
   INDEX Agentur.SPEZKOND
   
   SELECT FORM KEY cuvt% FILE "SPEZKOND" INDEX CodeVT.spezkond
   SELECT FORM KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
   REM SELECT FIRST 
 
 FORM 
 REM INDEX gesellschaft.Kgeadr
 END SUB 
 
 
SUB MNSPEZKOND()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 IF MNdisabled%("SPEZKONDLOE") OR ag$ = "j" THEN 
   MENU 2,4,0,"&Lîschen,Del","SPEZKONDLoe",""
 ELSE 
   MENU 2,4,1,"&Lîschen,Del","SPEZKONDLoe",""
 END IF 
 CALL MNHilfe(3)
 END SUB 
 
SUB SPEZKONDLoe()
 cuvt% = Codevt.SPEZKOND
 codekey% = codekey.SPEZKOND
 REM IF disabled%("GEADRLOESCHEN") THEN END SUB 
 MOUSE OFF 
 REQUEST "Spezialkondition wirklich lîschen?","",130,req%
 IF req% <> 1 THEN END SUB 
     SELECT KEY codekey% LOCK FILE "SPEZKOND" INDEX Codekey.SPEZKOND
     SELECT REMOVE FILE "SPEZKOND"
 SELECT FORM KEY cuvt% FILE "SPEZKOND" INDEX codevt.SPEZKOND
 FORM 1
 FORM 
 MOUSE ON 
 END SUB 
 
 
 REM **********************************************************************************************************
 REM              Spezialkonditionen VPRDUKT
 REM **********************************************************************************************************

SUB VPSpezialProv()
 CALL DFile(3,"maadr" + _fpw$)
 cuvt% = codevp.vprodukt
 REM knr% = codeku.kvertrag
 REM codema% = codema.kvertrag
 codeva% = codeva.vprodukt
 codege% = codege.vprodukt
 ges$ = Gesellschaft.vprodukt
 spa$ = Sparte.vprodukt
 
 BGEADRsub% = 0
 FILE "VPSPEZKO"
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "VPSPEZKO" THEN 
     SET HEADING title$ + " -Beteiligte Spezialvermittler"
     OPEN FORM GPrjForm$ + "VPSPEZKO"
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\spezprov.pdf"
     CALL VPSPEZKOIntro()
     CALL MNVPSPEZKO()
     SET STATUS "Beteiligte Spezialvermittler"
   END IF 
   MENU ON 
   MOUSE ON 
   BGEADRsub% = 0
   CALL ClearKBDBuffer()
   FORM 
   f.sich.visible = 0
   f.abbruch.visible = 0
   f.loe.visible = - 1
   f.neu.visible = - 1
   f.bearb.visible = - 1
   f.zur.visible = - 1
   END IF 
   FILE "VPSPEZKO"
   IF BGEADRsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE BGEADRsub%
   CASE 1
       REM Agentur auswÑhlen
       codekey% = codekey.vpspezko
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       IF ma% > 0 THEN 
         IF ma% <> voncodema.vpspezko THEN 
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY ma% FILE "maadr" INDEX codema.maadr
           SELECT FIRST FILE "vpspezko" INDEX codekey.vpspezko
           SELECT KEY codekey% LOCK FILE "vpspezko" INDEX codekey.vpspezko
           codema.vpspezko = ma%
           Agentur.vpspezko = Nachname.maadr + "," + Vorname.maadr
           CALL QuickStore("vpspezko")
           vagents$ = Agentur.vpspezko
         ELSE 
           CALL Fehler (Sie kînnen nicht die Spezialprovision von dem Mitarbeiter abziehen,der die Spezialprovision erhalten soll!","Bitte wÑhlen Sie einen anderen Mitarbeiter aus!")
         END IF 
       END IF 
       FORM 
   CASE 2
     CALL VPSPEZKOSich()
   CASE 3
     codevp% = codevp.vpspezko
     IF NOT disabled%("SPEZKONDLOE") THEN 
       CALL VPSPEZKOLoe()
       IF NOT EXISTS (codevp%,codevp.vpspezko) THEN END SUB 
     END IF 
   CASE 4
      codekey% = codekey.vpspezko
      SELECT KEY codekey% LOCK FILE "vpspezko" INDEX codekey.vpspezko
      IF codema.vpspezko > 0 THEN 
        vagents$ = Agentur.vpspezko
      ELSE 
        vagents$ = "WÑhlen Sie hier eine Agentur aus!"
      END IF 
      IF voncodema.vpspezko > 0 THEN 
        vagents1$ = vonAgentur.vpspezko
      ELSE 
        vagents1$ = "Die Spezialprovision wird der folgenden Agentur abgezogen!"
      END IF 
      FORM 2
   CASE 5
     CALL VPSPEZKONeu()
 CASE 6
     REM EmpfÑngeragentur festlegen
       REM Agentur auswÑhlen
       codekey% = codekey.vpspezko
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       SELECT KEY codekey% LOCK FILE "vpspezko" INDEX codekey.vpspezko
       IF ma% <> codema.vpspezko THEN 
         SELECT KEY ma% FILE "maadr" INDEX codema.maadr
         voncodema.vpspezko = ma%
         vonAgentur.vpspezko = Nachname.maadr + "," + Vorname.maadr
         IF ma% = 0 THEN vonAgentur.vpspezko = ""
         CALL QuickStore("vpspezko")
         vagents1$ = vonAgentur.vpspezko
         IF ma% = 0 THEN vagents1$ = "Die Spezialprovision wird der folgenden Agentur abgezogen!"
       ELSE 
         CALL Fehler (Sie kînnen nicht die Spezialprovision von dem Mitarbeiter abziehen,der die Spezialprovision erhalten soll!","Bitte wÑhlen Sie einen anderen Mitarbeiter aus!")
       END IF 
       FORM 
   CASE 99
     REM 110197
     IF NOT disabled%("SPEZKONDBEARB") THEN 
       MOUSE ON 
       MENU OFF 
       REM IF RECCOUNT ("geadr") = 0 THEN CALL GEADRNeu()
         
         REM 101296
         REM _gesold$ = Gesellschaft.geadr
         REM CALL ButDesabled()
         REM f.notiz.enabled = 0
         REM f.vertragsuebersicht.enabled = 0
         f.sich.visible = - 1
         f.abbruch.visible = - 1
         f.loe.visible = 0
         f.bearb.visible = 0
         f.zur.visible = 0
         ENTER Prozente.vpspezko,0
         f.sich.visible = 0
         f.abbruch.visible = 0
         f.loe.visible = - 1
         f.bearb.visible = - 1
         f.zur.visible = - 1
         REM CALL ButEnabled()
         REM f.notiz.enabled = - 1
         REM f.vertragsuebersicht.enabled = - 1
     
     END IF 
   END SELECT 
   IF abbruch% = - 1 THEN 
     FORM 
     abbruch% = 0
   END IF 
   MENU ON 
 WEND 
 _formend% = 0
 FILE "VPRODUKT"
 REM CALL VERTRIntro(1)
 END SUB 
 
 
SUB VPSPEZKONeu()
 IF disabled%("SPEZKONDNEU") THEN END SUB 
 FILE "vpspezko"
 REM IF gesellschaft.Kgeadr <> "" THEN CALL FStore( FILE )
 REM SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
 SELECT KEY codeva.vprodukt FILE "sparten" INDEX codeva.sparten
 SELECT KEY codege.vprodukt FILE "geadr" INDEX codege.geadr
 
 BLANK FILE "vpspezko"
 SET STATUS "Datensatz neu angelegt..."
 CodeKey% = SER ("vpspezko",1)
 CodeKey.vpspezko = CodeKey%
 codevp.vpspezko = codevp.vprodukt
 codege.vpspezko = codege.vprodukt
 codeva.vpspezko = codeva.vprodukt
 Gesellschaft.vpspezko = LEFT$ (Gesellschaft.geadr,30)
 Sparte.vpspezko = LEFT$ (Sparte.sparten,60)
 vonFirmaAgentur.vpspezko = "j"
 vonAP.vpspezko = "n"
 vonCourtage.vpspezko = "n"
 vonPflege.vpspezko = "n"
 einmaligerfolgt.vpspezko = "n"
 einmalig.vpspezko = "n"
 Agentur.vpspezko = "<ohne Zuordnung>"
 codema.vpspezko = 0
 REM Agentur.SPEZKOND = Nachname.maadr + "," + Vorname.maadr
 REM QVTGE.KGeadr = STR$ (lfdnr.kvertrag,"000000") + STR$ (codege.kgeadr,"000000")
 REM gesellschaft.kgeadr = "NEU"
 CALL QuickStore("vpspezko")
 FORM 2
 SELECT FORM KEY codeKey% FILE "vpspezko" INDEX codeKey.vpspezko
 vagents$ = "WÑhlen Sie hier eine Agentur aus!"
 FORM 
 BGEADRsub% = 99
 MOUSE ON 
 END SUB 
 
SUB VPSPEZKOSich()
   QCodeVTMA.vpspezko = STR$ (codevt.vpspezko,"000000") + STR$ (codema.vpspezko,"000000")
   QCodeGEVAMA.vpspezko = STR$ (codege.vpspezko,"000000") + STR$ (codeva.vpspezko,"000000") + STR$ (codema.vpspezko,"000000")
   Gesellschaft.vpspezko = Gesellschaft.geadr
   Sparte.vpspezko = Sparte.sparten
   SELECT FIRST FILE "MAADR" INDEX codema.maadr
   SELECT KEY codema.vpspezko FILE "MAADR" INDEX codema.maadr
   Agentur.vpspezko = Nachname.maadr + "," + Vorname.maadr
   vagents$ = Agentur.vpspezko
   CALL QuickStore("vpspezko")
   FORM 
 END SUB 
 
SUB VPSPEZKOIntro()
   
   FILE "vpspezko"
   INDEX Agentur.vpspezko
   
   SELECT FORM KEY cuvt% FILE "vpspezko" INDEX CodeVP.vpspezko
   SELECT FORM KEY cuvt% FILE "vprodukt" INDEX CodeVP.vprodukt
   REM SELECT FIRST 
 
 FORM 
 REM INDEX gesellschaft.Kgeadr
 END SUB 
 
 
SUB MNVPSPEZKO()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 IF MNdisabled%("SPEZKONDLOE") OR ag$ = "j" THEN 
   MENU 2,4,0,"&Lîschen,Del","SPEZKONDLoe",""
 ELSE 
   MENU 2,4,1,"&Lîschen,Del","SPEZKONDLoe",""
 END IF 
 CALL MNHilfe(3)
 END SUB 
 
SUB VPSPEZKOLoe()
 cuvt% = Codevp.vprodukt
 codekey% = codekey.VPSPEZKO
 REM IF disabled%("GEADRLOESCHEN") THEN END SUB 
 MOUSE OFF 
 REQUEST "Spezialkondition wirklich lîschen?","",130,req%
 IF req% <> 1 THEN END SUB 
     SELECT KEY codekey% LOCK FILE "VPSPEZKO" INDEX Codekey.VPSPEZKO
     SELECT REMOVE FILE "VPSPEZKO"
 SELECT FORM KEY cuvt% FILE "VPSPEZKO" INDEX codevp.VPSPEZKO
 FORM 1
 FORM 
 MOUSE ON 
 END SUB 
 

 REM **********************************************************************************************************
 REM               ENDE Spezialkonditionen VPRODUKT
 REM **********************************************************************************************************












SUB FeldBerKV()
 REM ***********************************************************
 REM *               Feldberechnungen                          *
 REM ***********************************************************
 NUMBASE "9999999999.0000"
 IF codege.kvertrag > 0 AND codeva.kvertrag > 0 THEN 
   qcodeGEVA$ = Quickgeva.kvertrag
   SELECT FIRST FILE "vprodukt" INDEX QCodeGEVA.vprodukt
   SELECT KEY qcodeGEVA$ FILE "vprodukt" INDEX QCodeGEVA.vprodukt
   sr60$ = sr60.vprodukt
   qtest$ = QCodeGEVA.vprodukt
   mwst.kvertrag = mwst.vprodukt
   IF einheiten.kvertrag = 0 THEN 
     einheiten.kvertrag = 0
   END IF 
   ein% = einheiten.kvertrag
   bb% = 0

   IF bewertungsbasis.vprodukt <> 0 THEN 
     bb% = bewertungsbasis.vprodukt
   END IF 
   IF AutomNetBer.vprodukt LIKE "j" THEN 
     Netto$ = STR$ ((Beitrag.kvertrag * 100) / (100 + mwst.kvertrag),"9999999999.00")
     IF KVBrutto.kvertrag = 0 THEN Nettobeitrag.kvertrag = VAL (netto$)
   ELSE 
     netto% = nettobeitrag.kvertrag
   END IF 
   IF DBeitrZahlung.kvertrag = 0 THEN DBeitrZahlung.kvertrag = VS_Dauer.kvertrag
   vd% = VS_Dauer.kvertrag
   netto% = nettobeitrag.kvertrag
   brutto% = Beitrag.kvertrag
   dbeitr% = DBeitrZahlung.kvertrag
   vsumme% = Vsumme.kvertrag
   IF codetarif.kvertrag > 0 THEN GOTO TarifFo2310001
   fbew$ = Fbew.vprodukt
   bsu% = Bewertungssumme.kvertrag
   pab% = Proviab.kvertrag
   REM CALL Fehler(qcodeGEVA$,qtest$)
   IF Fbew.vprodukt <> "" AND Bewertungssumme.kvertrag < 0.01 AND Proviab.kvertrag < 1 THEN 
     IF MinBew.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.vprodukt THEN VS_Dauer.kvertrag = MinBew.vprodukt
     END IF 
     IF MaxBew.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew.vprodukt THEN VS_Dauer.kvertrag = MaxBew.vprodukt
     END IF 
     IF MinBewBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinBewBzD.vprodukt
     END IF 
     IF MaxBewBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxBewBzD.vprodukt
     END IF 
     IF MinBewBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei.vprodukt THEN Beitrag.kvertrag = MinBewBBei.vprodukt
     END IF 
     IF MaxBewBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei.vprodukt THEN Beitrag.kvertrag = MaxBewBBei.vprodukt
     END IF 
     IF MinBewNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei.vprodukt THEN nettobeitrag.kvertrag = MinBewNBei.vprodukt
     END IF 
     IF MaxBewNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei.vprodukt THEN nettobeitrag.kvertrag = MaxBewNBei.vprodukt
     END IF 
     IF MinBewVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS.vprodukt THEN vsumme.kvertrag = MinBewVS.vprodukt
     END IF 
     IF MaxBewVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS.vprodukt THEN vsumme.kvertrag = MaxBewVS.vprodukt
     END IF 
     IF fbew.vprodukt LIKE "zw.kvertrag*" OR fbew.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + Fbew.vprodukt
       EXECUTE fo$
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + Fbew.vprodukt
       EXECUTE fo$
     END IF 
     Bewertungssumme.kvertrag = wert%
   END IF 
   fbew2$ = Fbew2.vprodukt
   fo$ = ""
   IF Fbew2.vprodukt <> "" AND Bewertung2.kvertrag < 0.01 AND Proviab.kvertrag < 1 THEN 
     IF MinBew2.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew2.vprodukt THEN VS_Dauer.kvertrag = MinBew2.vprodukt
     END IF 
     IF MaxBew2.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew2.vprodukt THEN VS_Dauer.kvertrag = MaxBew2.vprodukt
     END IF 
     IF MinBewBzD2.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD2.vprodukt THEN DBeitrZahlung.kvertrag = MinBewBzD2.vprodukt
     END IF 
     IF MaxBewBzD2.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD2.vprodukt THEN DBeitrZahlung.kvertrag = MaxBewBzD2.vprodukt
     END IF 
     IF MinBewBBei2.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei2.vprodukt THEN Beitrag.kvertrag = MinBewBBei2.vprodukt
     END IF 
     IF MaxBewBBei2.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei2.vprodukt THEN Beitrag.kvertrag = MaxBewBBei2.vprodukt
     END IF 
     IF MinBewNBei2.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei2.vprodukt THEN nettobeitrag.kvertrag = MinBewNBei2.vprodukt
     END IF 
     IF MaxBewNBei2.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei2.vprodukt THEN nettobeitrag.kvertrag = MaxBewNBei2.vprodukt
     END IF 
     IF MinBewVS2.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS2.vprodukt THEN vsumme.kvertrag = MinBewVS2.vprodukt
     END IF 
     IF MaxBewVS2.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS2.vprodukt THEN vsumme.kvertrag = MaxBewVS2.vprodukt
     END IF 
     IF fbew2.vprodukt LIKE "zw.kvertrag*" OR fbew2.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + Fbew2.vprodukt
       EXECUTE fo$
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + Fbew2.vprodukt
       EXECUTE fo$
     END IF 
     Bewertung2.kvertrag = wert%
   END IF 


   IF FSRD.vprodukt <> "" AND SRHaftung.kvertrag = 0 AND Proviab.kvertrag < 1 THEN 
     IF MINSRD.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.vprodukt THEN VS_Dauer.kvertrag = MinSRD.vprodukt
     END IF 
     IF MaxSRD.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxSRD.vprodukt THEN VS_Dauer.kvertrag = MaxSRD.vprodukt
     END IF 
     IF MinSRDBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinSRDBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinSRDBzD.vprodukt
     END IF 
     IF MaxSRDBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxSRDBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxSRDBzD.vprodukt
     END IF 
     IF MinSRDBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinSRDBBei.vprodukt THEN Beitrag.kvertrag = MinSRDBBei.vprodukt
     END IF 
     IF MaxSRDBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxSRDBBei.vprodukt THEN Beitrag.kvertrag = MaxSRDBBei.vprodukt
     END IF 
     IF MinSRDNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinSRDNBei.vprodukt THEN nettobeitrag.kvertrag = MinSRDNBei.vprodukt
     END IF 
     IF MaxSRDNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxSRDNBei.vprodukt THEN nettobeitrag.kvertrag = MaxSRDNBei.vprodukt
     END IF 
     IF MinSRDVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinSRDVS.vprodukt THEN vsumme.kvertrag = MinSRDVS.vprodukt
     END IF 
     IF MaxSRDVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxSRDVS.vprodukt THEN vsumme.kvertrag = MaxSRDVS.vprodukt
     END IF 
     av1% = VS_Dauer.kvertrag
     adb1% = DBeitrZahlung.kvertrag
     abei% = Beitrag.kvertrag
     anbei1% = nettobeitrag.kvertrag
     avs1% = vsumme.kvertrag
     REM CALL Fehler("","")
     IF FSRD.vprodukt LIKE "zw.kvertrag*" OR FSRD.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FSRD.vprodukt
       EXECUTE fo$
       IF wert% < 100 THEN 
         SRHaftung.kvertrag = wert%
       ELSE 
         CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Produkt-Berechnungsformel!")
       END IF 
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FSRD.vprodukt
       EXECUTE fo$
       IF wert% < 100 THEN 
         SRHaftung.kvertrag = wert%
       ELSE 
         CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Produkt-Berechnungsformel!")
       END IF 
     END IF 
   END IF 
   IF vs_beginn.kvertrag >= "01.01.2008" AND sr60.vprodukt = "j" THEN 
     SRHaftung.kvertrag = 60
   END IF 
   IF FVol.vprodukt <> "" AND Volumen.kvertrag < 1 AND Proviab.kvertrag < 1 THEN 
     fvol$ = FVol.vprodukt
     IF MinVol.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minVol.vprodukt THEN VS_Dauer.kvertrag = MinVol.vprodukt
     END IF 
     IF MaxVol.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxVol.vprodukt THEN VS_Dauer.kvertrag = MaxVol.vprodukt
     END IF 
     IF MinVolBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinVolBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinVolBzD.vprodukt
     END IF 
     IF MaxVolBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxVolBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxVolBzD.vprodukt
     END IF 
     IF MinVolBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinVolBBei.vprodukt THEN Beitrag.kvertrag = MinVolBBei.vprodukt
     END IF 
     IF MaxVolBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxVolBBei.vprodukt THEN Beitrag.kvertrag = MaxVolBBei.vprodukt
     END IF 
     IF MinVolNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinVolNBei.vprodukt THEN nettobeitrag.kvertrag = MinVolNBei.vprodukt
     END IF 
     IF MaxVolNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxVolNBei.vprodukt THEN nettobeitrag.kvertrag = MaxVolNBei.vprodukt
     END IF 
     IF MinVolVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinVolVS.vprodukt THEN vsumme.kvertrag = MinVolVS.vprodukt
     END IF 
     IF MaxVolVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxVolVS.vprodukt THEN vsumme.kvertrag = MaxVolVS.vprodukt
     END IF 
     IF FVol.vprodukt LIKE "zw.kvertrag*" OR FVol.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FVol.vprodukt
       EXECUTE fo$
       Volumen.kvertrag = wert%
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FVol.vprodukt
       EXECUTE fo$
       Volumen.kvertrag = wert%
     END IF 
   END IF 
   IF FTar.vprodukt <> "" AND Tarif.kvertrag = "" AND Proviab.kvertrag < 1 THEN 
     IF MinTar.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minTar.vprodukt THEN VS_Dauer.kvertrag = MinTar.vprodukt
     END IF 
     IF MaxTar.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxTar.vprodukt THEN VS_Dauer.kvertrag = MaxTar.vprodukt
     END IF 
     IF MinTarBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinTarBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinTarBzD.vprodukt
     END IF 
     IF MaxTarBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxTarBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxTarBzD.vprodukt
     END IF 
     IF MinTarBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinTarBBei.vprodukt THEN Beitrag.kvertrag = MinTarBBei.vprodukt
     END IF 
     IF MaxTarBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxTarBBei.vprodukt THEN Beitrag.kvertrag = MaxTarBBei.vprodukt
     END IF 
     IF MinTarNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinTarNBei.vprodukt THEN nettobeitrag.kvertrag = MinTarNBei.vprodukt
     END IF 
     IF MaxTarNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxTarNBei.vprodukt THEN nettobeitrag.kvertrag = MaxTarNBei.vprodukt
     END IF 
     IF MinTarVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinTarVS.vprodukt THEN vsumme.kvertrag = MinTarVS.vprodukt
     END IF 
     IF MaxTarVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxTarVS.vprodukt THEN vsumme.kvertrag = MaxTarVS.vprodukt
     END IF 
     IF FTar.vprodukt LIKE "zw.kvertrag*" OR FTar.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FTar.vprodukt
       EXECUTE fo$
       Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FTar.vprodukt
       EXECUTE fo$
       Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
     END IF 
   END IF 
TarifFo2310001: 
   IF CodeTarif.kvertrag > 0 THEN 
     SELECT KEY codetarif.kvertrag FILE "Tarif" INDEX codetarif.tarif
     IF Fbew.tarif <> "" AND Bewertungssumme.kvertrag < 0.01 AND Proviab.kvertrag < 1 THEN 
       IF MinBew.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.tarif THEN VS_Dauer.kvertrag = MinBew.tarif
       END IF 
       IF MaxBew.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew.tarif THEN VS_Dauer.kvertrag = MaxBew.tarif
       END IF 
       IF MinBewBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD.Tarif THEN DBeitrZahlung.kvertrag = MinBewBzD.Tarif
       END IF 
       IF MaxBewBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxBewBzD.Tarif
       END IF 
       IF MinBewBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei.Tarif THEN Beitrag.kvertrag = MinBewBBei.Tarif
       END IF 
       IF MaxBewBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei.Tarif THEN Beitrag.kvertrag = MaxBewBBei.Tarif
       END IF 
       IF MinBewNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei.Tarif THEN nettobeitrag.kvertrag = MinBewNBei.Tarif
       END IF 
       IF MaxBewNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei.Tarif THEN nettobeitrag.kvertrag = MaxBewNBei.Tarif
       END IF 
       IF MinBewVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS.Tarif THEN vsumme.kvertrag = MinBewVS.Tarif
       END IF 
       IF MaxBewVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS.Tarif THEN vsumme.kvertrag = MaxBewVS.Tarif
       END IF 
       IF fbew.tarif LIKE "zw.kvertrag*" OR fbew.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + Fbew.tarif
         EXECUTE fo$
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + Fbew.tarif
         EXECUTE fo$
       END IF 
       wert$ = STR$ (wert%,"999999999999")
       wert1% = VS_Dauer.kvertrag
       wert1a% = nettobeitrag.kvertrag
       wert2% = wert1% * wert1a%
       wert3% = 1 * wert2%
       wert4% = 0.95 * wert3%
       wert5% = wert4%
       Bewertungssumme.kvertrag = wert%
     END IF 


     IF Fbew2.tarif <> "" AND Bewertung2.kvertrag < 0.01 THEN 
       IF MinBew2.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew2.tarif THEN VS_Dauer.kvertrag = MinBew2.tarif
       END IF 
       IF MaxBew2.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew2.tarif THEN VS_Dauer.kvertrag = MaxBew2.tarif
       END IF 
       IF MinBewBzD2.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD2.Tarif THEN DBeitrZahlung.kvertrag = MinBewBzD2.Tarif
       END IF 
       IF MaxBewBzD2.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD2.Tarif THEN DBeitrZahlung.kvertrag = MaxBewBzD2.Tarif
       END IF 
       IF MinBewBBei2.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei2.Tarif THEN Beitrag.kvertrag = MinBewBBei2.Tarif
       END IF 
       IF MaxBewBBei2.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei2.Tarif THEN Beitrag.kvertrag = MaxBewBBei2.Tarif
       END IF 
       IF MinBewNBei2.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei2.Tarif THEN nettobeitrag.kvertrag = MinBewNBei2.Tarif
       END IF 
       IF MaxBewNBei2.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei2.Tarif THEN nettobeitrag.kvertrag = MaxBewNBei2.Tarif
       END IF 
       IF MinBewVS2.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS2.Tarif THEN vsumme.kvertrag = MinBewVS2.Tarif
       END IF 
       IF MaxBewVS2.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS2.Tarif THEN vsumme.kvertrag = MaxBewVS2.Tarif
       END IF 
       IF fbew2.tarif LIKE "zw.kvertrag*" OR fbew2.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + Fbew2.tarif
         EXECUTE fo$
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + Fbew2.tarif
         EXECUTE fo$
       END IF 
       wert$ = STR$ (wert%,"999999999999")
       wert1% = VS_Dauer.kvertrag
       wert1a% = nettobeitrag.kvertrag
       wert2% = wert1% * wert1a%
       wert3% = 1 * wert2%
       wert4% = 0.95 * wert3%
       wert5% = wert4%
       Bewertung2.kvertrag = wert%
     END IF 



     IF FSRD.tarif <> "" AND SRHaftung.kvertrag < 1 AND Proviab.kvertrag < 1 THEN 
       IF MINSRD.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.tarif THEN VS_Dauer.kvertrag = MinSRD.tarif
       END IF 
       IF MaxSRD.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxSRD.tarif THEN VS_Dauer.kvertrag = MaxSRD.tarif
       END IF 
       IF MinSRDBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinSRDBzD.Tarif THEN DBeitrZahlung.kvertrag = MinSRDBzD.Tarif
       END IF 
       IF MaxSRDBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxSRDBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxSRDBzD.Tarif
       END IF 
       IF MinSRDBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinSRDBBei.Tarif THEN Beitrag.kvertrag = MinSRDBBei.Tarif
       END IF 
       IF MaxSRDBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxSRDBBei.Tarif THEN Beitrag.kvertrag = MaxSRDBBei.Tarif
       END IF 
       IF MinSRDNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinSRDNBei.Tarif THEN nettobeitrag.kvertrag = MinSRDNBei.Tarif
       END IF 
       IF MaxSRDNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxSRDNBei.Tarif THEN nettobeitrag.kvertrag = MaxSRDNBei.Tarif
       END IF 
       IF MinSRDVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinSRDVS.Tarif THEN vsumme.kvertrag = MinSRDVS.Tarif
       END IF 
       IF MaxSRDVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxSRDVS.Tarif THEN vsumme.kvertrag = MaxSRDVS.Tarif
       END IF 
       IF FSRD.tarif LIKE "zw.kvertrag*" OR FSRD.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FSRD.tarif
         EXECUTE fo$
         IF wert% < 100 THEN 
           SRHaftung.kvertrag = wert%
         ELSE 
           CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Tarif-Berechnungsformel!")
         END IF 
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FSRD.tarif
         EXECUTE fo$
         IF wert% < 100 THEN 
           SRHaftung.kvertrag = wert%
         ELSE 
           CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Tarif-Berechnungsformel!")
         END IF 
       END IF 
     END IF 
     IF vs_beginn.kvertrag >= "01.01.2008" AND sr60.tarif = "j" THEN 
       SRHaftung.kvertrag = 60
     END IF 
     IF FVol.tarif <> "" AND Volumen.kvertrag < 1 AND Proviab.kvertrag < 1 THEN 
       IF MinVol.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minVol.tarif THEN VS_Dauer.kvertrag = MinVol.tarif
       END IF 
       IF MaxVol.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxVol.tarif THEN VS_Dauer.kvertrag = MaxVol.tarif
       END IF 
       IF MinVolBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinVolBzD.Tarif THEN DBeitrZahlung.kvertrag = MinVolBzD.Tarif
       END IF 
       IF MaxVolBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxVolBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxVolBzD.Tarif
       END IF 
       IF MinVolBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinVolBBei.Tarif THEN Beitrag.kvertrag = MinVolBBei.Tarif
       END IF 
       IF MaxVolBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxVolBBei.Tarif THEN Beitrag.kvertrag = MaxVolBBei.Tarif
       END IF 
       IF MinVolNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinVolNBei.Tarif THEN nettobeitrag.kvertrag = MinVolNBei.Tarif
       END IF 
       IF MaxVolNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxVolNBei.Tarif THEN nettobeitrag.kvertrag = MaxVolNBei.Tarif
       END IF 
       IF MinVolVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinVolVS.Tarif THEN vsumme.kvertrag = MinVolVS.Tarif
       END IF 
       IF MaxVolVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxVolVS.Tarif THEN vsumme.kvertrag = MaxVolVS.Tarif
       END IF 
       IF FVol.tarif LIKE "zw.kvertrag*" OR FVol.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FVol.tarif
         EXECUTE fo$
         Volumen.kvertrag = wert%
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FVol.tarif
         EXECUTE fo$
         Volumen.kvertrag = wert%
       END IF 
     END IF 
     IF FTar.tarif <> "" AND Tarif.kvertrag = "" AND Proviab.kvertrag < 1 THEN 
       IF MinTar.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minTar.tarif THEN VS_Dauer.kvertrag = MinTar.tarif
       END IF 
       IF MaxTar.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxTar.tarif THEN VS_Dauer.kvertrag = MaxTar.tarif
       END IF 
       IF MinTarBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinTarBzD.Tarif THEN DBeitrZahlung.kvertrag = MinTarBzD.Tarif
       END IF 
       IF MaxTarBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxTarBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxTarBzD.Tarif
       END IF 
       IF MinTarBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinTarBBei.Tarif THEN Beitrag.kvertrag = MinTarBBei.Tarif
       END IF 
       IF MaxTarBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxTarBBei.Tarif THEN Beitrag.kvertrag = MaxTarBBei.Tarif
       END IF 
       IF MinTarNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinTarNBei.Tarif THEN nettobeitrag.kvertrag = MinTarNBei.Tarif
       END IF 
       IF MaxTarNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxTarNBei.Tarif THEN nettobeitrag.kvertrag = MaxTarNBei.Tarif
       END IF 
       IF MinTarVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinTarVS.Tarif THEN vsumme.kvertrag = MinTarVS.Tarif
       END IF 
       IF MaxTarVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxTarVS.Tarif THEN vsumme.kvertrag = MaxTarVS.Tarif
       END IF 
       IF FTar.tarif LIKE "zw.kvertrag*" OR FTar.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FTar.tarif
         EXECUTE fo$
         Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FTar.tarif
         EXECUTE fo$
         Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
       END IF 
     END IF 
   END IF 
   IF sofortBereEinh.stamm = "j" THEN 
     IF bb% <> 0 AND Bewertungssumme.kvertrag <> 0 THEN 
       einh$ = STR$ (Bewertungssumme.kvertrag / bb%,",9999999999.0000")
       Einheiten.kvertrag = VAL (einh$)
     END IF 
   ELSE 
     IF bb% <> 0 AND Bewertungssumme.kvertrag <> 0 AND einheiten.kvertrag = 0 THEN 
       einh$ = STR$ (Bewertungssumme.kvertrag / bb%,",9999999999.0000")
       Einheiten.kvertrag = VAL (einh$)
     END IF 
   END IF 
   IF Bewertungsbasis.vprodukt = - 1 THEN 
     Einheiten.kvertrag = 0
   END IF 
   VS_Dauer.kvertrag = vd%
   nettobeitrag.kvertrag = netto%
   Beitrag.kvertrag = brutto%
   DBeitrZahlung.kvertrag = dbeitr%
   Vsumme.kvertrag = vsumme%
 END IF 
 END SUB 


SUB AutBWUeb()
 IF disabled%("FIRMENSTAMMEDIT") THEN END SUB 
 REQUEST "Wollen Sie diese Anpassungen wirklich ausfÅhren lassen?","",130,req%
 IF req% <> 1 THEN END SUB 
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"tarif" + _fpw$)
 REQUEST "Soll die Anpassung fÅr ein Produkt (JA)?","oder fÅr alle Produkte (NEIN) durchgefÅhrt werden?",130,req%
 IF req% = 1 THEN 
   cvp% = 0
   cvp% = GetVprodukt%(0,0,0)
   IF cvp% = 0 THEN GOTO end200220091
 ELSE 
   cvp% = 0
 END IF 
 FILE "vprodukt"
 INDEX QCodeGEVA.vprodukt
 FILE "Kvertrag"
 INDEX lfdnr.kvertrag
 IF cvp% > 0 THEN 
   FILE "KVERTRAG"
   INDEX CodeVP.kvertrag
 END IF 
 IF RECCOUNT ("kvertrag") > 0 THEN 
   SELECT FIRST LOCK 
   IF cvp% > 0 THEN 
     SELECT FIRST FILE "KVERTRAG" INDEX codevp.kvertrag
     SELECT KEY cvp% LOCK FILE "Kvertrag" INDEX codevp.kvertrag
   END IF 
 ELSE 
   SELECT LAST 
 END IF 
 i% = 0
 j% = RECCOUNT ("kvertrag")
 MOUSE OFF 
 REM SELECT KEY 6000 LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
 IF cvp% = 0 THEN WHILE NOT EOF ("kvertrag")
 IF cvp% > 0 THEN WHILE NOT EOF ("kvertrag") AND codevp.kvertrag = cvp%
   IF cvp% = 0 THEN 
     i% = i% + 1
     IF lfdnr.kvertrag = 6002 THEN 
       REM CALL Fehler("","")
     END IF 
     IF codege.kvertrag > 0 AND codeva.kvertrag > 0 THEN 
       CALL FeldBerKV1a()
       CALL QuickStore("kvertrag")
     END IF 
   ELSE 
     IF codevp.kvertrag = cvp% THEN 
       i% = i% + 1
       CALL FeldBerKV1a()
       CALL QuickStore("kvertrag")
     END IF 
   END IF 
   SELECT NEXT LOCK FILE "KVERTRAG"
 SET STATUS STR$ (i%,"999999") + " von " + STR$ (j%,"999999") + " DatensÑtze bearbeitet"
 WEND 
end200220091: 
 REQUEST "Verarbeitung beendet!"
 MOUSE ON 
 END SUB 


SUB AutBWUeb2()
 IF disabled%("FIRMENSTAMMEDIT") THEN END SUB 
 a$ = "Diese Funktion prÅft fÅr ALLE VertrÑge(auch fÅr VertrÑge, die schon an die Provisionsabrechnung Åbergeben wurden), ob Berechnungsformeln bei Produkte oder Tarife"
 CALL Fehler(a$,"hinterlegt wurden und fÅhrt diese Berechnungsformeln dann aus, UNABHéNGIG davon, ob in den betroffenen Feldern schon Werte stehen! ")
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"tarif" + _fpw$)
 REM REQUEST "Soll die Anpassung fÅr ein Produkt (JA)?","oder fÅr alle Produkte (NEIN) durchgefÅhrt werden?",130,req%
 REM IF req% = 1 THEN 
   REM cvp% = GetVprodukt%(0,0)
 REM ELSE 
   REM cvp% = 0
 REM END IF 
 REM REQUEST "Wollen Sie diese Anpassungen wirklich ausfÅhren lassen?","",130,req%
 REM IF req% <> 1 THEN END SUB 

 REM **********************************************************************************************************************
 DIM Vertraege$(20000)
anfsu100220051:    
 a% = 0
 ok% = - 1
 SELECT WHERE FILE "KVERTRAG"
 SELECT FIRST 
 WHILE ok%
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     REDIM Vertraege$(20000,1)
     REDIM Vertraege$(20000)
   ELSE 
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"),1)
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   provab% = 0
 
   REM Positivblock
   IF spa% = 0 THEN 
     vSparte$ = "alle"
   ELSE 
     SELECT FIRST FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY spa% FILE "SPARTEN" INDEX CodeVA.SPARTEN
     vsparte$ = Sparte.SPARTEN
   END IF 
   IF spgr% < 1 THEN 
     vSpGR$ = "alle"
   ELSE 
     SELECT FIRST FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
     SELECT KEY spgr% FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
     vspGr$ = Gruppe.SPGRUPPE
   END IF 
   IF ge% = 0 THEN 
     Gesellschaft$ = "alle"
   ELSE 
     SELECT FIRST FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
     Gesellschaft$ = Gesellschaft.GEADR
     REM ** Gesellschaft auswÑhlen
   END IF 
   IF cvp% = 0 THEN 
     vprodukt$ = "alle"
   ELSE 
     SELECT KEY cvp% FILE "Vprodukt" INDEX codevp.vprodukt
     vprodukt$ = gesellschaft.vprodukt + "/" + sparte.vprodukt
   END IF 
 
 
   bart% = 0
   st$ = "VertragsÅbersicht"
   
   REMOVE DIALOG ALL 
   so% = 1
   so1% = 1
   inc% = 1
   REM 191099/5
 
     CREATE DIALOG "BVERTRAG",0,0,446,120,"Anpassung fÅr VertrÑge, die den folgenden Kriterien entsprechen","MS Sans Serif",8
 
     ADD DIALOG "BVERTRAG",4,5,6,431,97,0,"es werden nur nicht stornierte, nicht FremdvertrÑge und nicht AltvertrÑge berÅcksichtigt"
 
     ADD DIALOG "BVERTRAG",5,8,26,28,10,0,"Produkt"
     ADD DIALOG "BVERTRAG",5,57,26,167,10,0,vProdukt$
     ADD DIALOG "BVERTRAG",1,218,26,14,10,0,"...",9,1
 
 
     ADD DIALOG "BVERTRAG",5,8,37,43,10,0,"Gesellschaft"
     ADD DIALOG "BVERTRAG",5,57,37,167,10,0,Gesellschaft$
     ADD DIALOG "BVERTRAG",1,218,37,14,10,0,"...",4,1
 
     ADD DIALOG "BVERTRAG",5,8,48,24,10,0,"Sparte"
     ADD DIALOG "BVERTRAG",5,57,48,167,10,0,vSparte$
     ADD DIALOG "BVERTRAG",1,218,48,14,10,0,"...",5,1
 
     ADD DIALOG "BVERTRAG",5,8,59,49,9,0,"Spartengruppe"
     ADD DIALOG "BVERTRAG",5,57,59,167,9,0,vSpGr$
     ADD DIALOG "BVERTRAG",1,218,59,14,9,0,"...",6,1
 
 
 
  
 
     ADD DIALOG "BVERTRAG",1,126,104,55,14,1,"&OK",1,1
     ADD DIALOG "BVERTRAG",1,184,104,55,14,0,"&Abbrechen",0,0
   DIALOG "BVERTRAG",dreq%
   negativsu% = 0
   SELECT CASE dreq%
   CASE 4
     ge% = GetCodeGE%(ge%)
   CASE 5
     spa% = GetCodeVA%(spa%)
   CASE 6
     spgr% = GetCodeGR%(spgr%)
   CASE 9
     REM Produkt auswÑhlen
     IF GOldProdSu$ LIKE "TRUE" THEN 
       cvp% = GetVprodukt%(0,0,0)
     ELSE 
       cvp% = NewGetCodeVP%()
     END IF 
   CASE 0
     ok% = 0
     doit% = 0
   END SELECT 
   REMOVE DIALOG "BVERTRAG"
   IF dreq% = 1 THEN ok% = 0
 WEND 
 IF dreq% = 0 THEN GOTO endsu100206 

 REM **********************************************************************************************************************


 FILE "vprodukt"
 INDEX codevp.vprodukt
 FILE "sparten"
 INDEX codeva.sparten
 FILE "spgruppe"
 INDEX codegrsp.spgruppe
 FILE "Kvertrag"
 INDEX lfdnr.kvertrag
 IF cvp% > 0 THEN 
   FILE "KVERTRAG"
   INDEX CodeVP.kvertrag
 END IF 
 IF RECCOUNT ("kvertrag") > 0 THEN 
   SELECT FIRST LOCK 
   IF cvp% > 0 THEN 
     SELECT FIRST FILE "KVERTRAG" INDEX codevp.kvertrag
     SELECT KEY cvp% LOCK FILE "Kvertrag" INDEX codevp.kvertrag
   END IF 
 ELSE 
   SELECT LAST 
 END IF 
 i% = 0
 j% = RECCOUNT ("kvertrag")
 gefunden% = 0
 anzleb% = 0
 MOUSE OFF 
 REM SELECT KEY 6000 LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
 WHILE NOT EOF ("kvertrag")
   sok% = - 1
   i% = i% + 1
   REM *********anzahl lebender VertrÑge*************************
   REM "alle nicht stornierten,nicht Fremdvertr.,nicht Altvertr."
   IF codevstatus.kvertrag = 4 OR codevstatus.kvertrag = 10 OR codevstatus.kvertrag = 11 OR codevstatus.kvertrag = 13 OR codevstatus.kvertrag = 15 OR codevstatus.kvertrag = 16 THEN 
     GOTO nextvt100220051
   ELSE 
     anzleb% = anzleb% + 1
   END IF 
   REM **********************************************************


   IF cvp% > 0 THEN 
     
   END IF 
 
   IF sok% = - 1 THEN 
     gefunden% = gefunden% + 1
     CALL FeldBerKVoP()
     CALL QuickStore("kvertrag")
   END IF 

nextvt100220051: 
   SELECT NEXT LOCK FILE "KVERTRAG"
 SET STATUS STR$ (i%,"999999") + " von " + STR$ (j%,"999999") + " DatensÑtze bearbeitet"
 WEND 
endsu100206: 
 REQUEST "Verarbeitung beendet!"
 MOUSE ON 
 END SUB 

SUB FeldBerKVoP()
 REM ***********************************************************
 REM *               Feldberechnungen ohne PrÅfung, ob Inhalte=0                         *
 REM ***********************************************************
 NUMBASE "9999999999.00"
 IF codege.kvertrag > 0 AND codeva.kvertrag > 0 THEN 
   qcodeGEVA$ = Quickgeva.kvertrag
   SELECT KEY qcodeGEVA$ FILE "vprodukt" INDEX QCodeGEVA.vprodukt
   IF AutomNetBer.vprodukt LIKE "j" THEN mwst.kvertrag = mwst.vprodukt
   einheiten.kvertrag = 0
   bb% = 0
   IF bewertungsbasis.vprodukt <> 0 THEN 
     bb% = bewertungsbasis.vprodukt
   END IF 
   IF AutomNetBer.vprodukt LIKE "j" THEN 
     Netto$ = STR$ ((Beitrag.kvertrag * 100) / (100 + mwst.kvertrag),"9999999999.00")
     Nettobeitrag.kvertrag = VAL (netto$)
   END IF 
   IF DBeitrZahlung.kvertrag = 0 THEN DBeitrZahlung.kvertrag = VS_Dauer.kvertrag
   vd% = VS_Dauer.kvertrag
   netto% = nettobeitrag.kvertrag
   brutto% = Beitrag.kvertrag
   dbeitr% = DBeitrZahlung.kvertrag
   vsumme% = Vsumme.kvertrag
   IF codetarif.kvertrag > 0 THEN GOTO TarifFoOP2310001
 
   IF Fbew.vprodukt <> "" THEN 
     IF MinBew.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.vprodukt THEN VS_Dauer.kvertrag = MinBew.vprodukt
     END IF 
     IF MaxBew.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew.vprodukt THEN VS_Dauer.kvertrag = MaxBew.vprodukt
     END IF 
     IF MinBewBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinBewBzD.vprodukt
     END IF 
     IF MaxBewBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxBewBzD.vprodukt
     END IF 
     IF MinBewBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei.vprodukt THEN Beitrag.kvertrag = MinBewBBei.vprodukt
     END IF 
     IF MaxBewBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei.vprodukt THEN Beitrag.kvertrag = MaxBewBBei.vprodukt
     END IF 
     IF MinBewNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei.vprodukt THEN nettobeitrag.kvertrag = MinBewNBei.vprodukt
     END IF 
     IF MaxBewNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei.vprodukt THEN nettobeitrag.kvertrag = MaxBewNBei.vprodukt
     END IF 
     IF MinBewVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS.vprodukt THEN vsumme.kvertrag = MinBewVS.vprodukt
     END IF 
     IF MaxBewVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS.vprodukt THEN vsumme.kvertrag = MaxBewVS.vprodukt
     END IF 
     IF fbew.vprodukt LIKE "zw.kvertrag*" OR fbew.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + Fbew.vprodukt
       EXECUTE fo$
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + Fbew.vprodukt
       EXECUTE fo$
     END IF 
     Bewertungssumme.kvertrag = wert%
   END IF 




   IF Fbew2.vprodukt <> "" THEN 
     IF MinBew2.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew2.vprodukt THEN VS_Dauer.kvertrag = MinBew2.vprodukt
     END IF 
     IF MaxBew2.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew2.vprodukt THEN VS_Dauer.kvertrag = MaxBew2.vprodukt
     END IF 
     IF MinBewBzD2.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD2.vprodukt THEN DBeitrZahlung.kvertrag = MinBewBzD2.vprodukt
     END IF 
     IF MaxBewBzD2.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD2.vprodukt THEN DBeitrZahlung.kvertrag = MaxBewBzD2.vprodukt
     END IF 
     IF MinBewBBei2.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei2.vprodukt THEN Beitrag2.kvertrag = MinBewBBei2.vprodukt
     END IF 
     IF MaxBewBBei2.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei2.vprodukt THEN Beitrag.kvertrag = MaxBewBBei2.vprodukt
     END IF 
     IF MinBewNBei2.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei2.vprodukt THEN nettobeitrag.kvertrag = MinBewNBei2.vprodukt
     END IF 
     IF MaxBewNBei2.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei2.vprodukt THEN nettobeitrag.kvertrag = MaxBewNBei2.vprodukt
     END IF 
     IF MinBewVS2.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS2.vprodukt THEN vsumme.kvertrag = MinBewVS2.vprodukt
     END IF 
     IF MaxBewVS2.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS2.vprodukt THEN vsumme.kvertrag = MaxBewVS2.vprodukt
     END IF 
     IF fbew2.vprodukt LIKE "zw.kvertrag*" OR fbew2.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + Fbew2.vprodukt
       EXECUTE fo$
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + Fbew2.vprodukt
       EXECUTE fo$
     END IF 
     Bewertung2.kvertrag = wert%
   END IF 




   IF FSRD.vprodukt <> "" THEN 
     IF MINSRD.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.vprodukt THEN VS_Dauer.kvertrag = MinSRD.vprodukt
     END IF 
     IF MaxSRD.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxSRD.vprodukt THEN VS_Dauer.kvertrag = MaxSRD.vprodukt
     END IF 
     IF MinSRDBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinSRDBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinSRDBzD.vprodukt
     END IF 
     IF MaxSRDBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxSRDBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxSRDBzD.vprodukt
     END IF 
     IF MinSRDBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinSRDBBei.vprodukt THEN Beitrag.kvertrag = MinSRDBBei.vprodukt
     END IF 
     IF MaxSRDBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxSRDBBei.vprodukt THEN Beitrag.kvertrag = MaxSRDBBei.vprodukt
     END IF 
     IF MinSRDNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinSRDNBei.vprodukt THEN nettobeitrag.kvertrag = MinSRDNBei.vprodukt
     END IF 
     IF MaxSRDNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxSRDNBei.vprodukt THEN nettobeitrag.kvertrag = MaxSRDNBei.vprodukt
     END IF 
     IF MinSRDVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinSRDVS.vprodukt THEN vsumme.kvertrag = MinSRDVS.vprodukt
     END IF 
     IF MaxSRDVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxSRDVS.vprodukt THEN vsumme.kvertrag = MaxSRDVS.vprodukt
     END IF 
     av1% = VS_Dauer.kvertrag
     adb1% = DBeitrZahlung.kvertrag
     abei% = Beitrag.kvertrag
     anbei1% = nettobeitrag.kvertrag
     avs1% = vsumme.kvertrag
     REM CALL Fehler("","")
     IF FSRD.vprodukt LIKE "zw.kvertrag*" OR FSRD.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FSRD.vprodukt
       EXECUTE fo$
       IF wert% < 100 THEN 
         SRHaftung.kvertrag = wert%
       ELSE 
         CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Produkt-Berechnungsformel!")
       END IF 
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FSRD.vprodukt
       EXECUTE fo$
       IF wert% < 100 THEN 
         SRHaftung.kvertrag = wert%
       ELSE 
         CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Produkt-Berechnungsformel!")
       END IF 
     END IF 
   END IF 
   IF vs_beginn.kvertrag >= "01.01.2008" AND sr60.vprodukt = "j" THEN 
     SRHaftung.kvertrag = 60
   END IF 
   IF FVol.vprodukt <> "" THEN 
     IF MinVol.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minVol.vprodukt THEN VS_Dauer.kvertrag = MinVol.vprodukt
     END IF 
     IF MaxVol.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxVol.vprodukt THEN VS_Dauer.kvertrag = MaxVol.vprodukt
     END IF 
     IF MinVolBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinVolBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinVolBzD.vprodukt
     END IF 
     IF MaxVolBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxVolBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxVolBzD.vprodukt
     END IF 
     IF MinVolBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinVolBBei.vprodukt THEN Beitrag.kvertrag = MinVolBBei.vprodukt
     END IF 
     IF MaxVolBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxVolBBei.vprodukt THEN Beitrag.kvertrag = MaxVolBBei.vprodukt
     END IF 
     IF MinVolNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinVolNBei.vprodukt THEN nettobeitrag.kvertrag = MinVolNBei.vprodukt
     END IF 
     IF MaxVolNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxVolNBei.vprodukt THEN nettobeitrag.kvertrag = MaxVolNBei.vprodukt
     END IF 
     IF MinVolVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinVolVS.vprodukt THEN vsumme.kvertrag = MinVolVS.vprodukt
     END IF 
     IF MaxVolVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxVolVS.vprodukt THEN vsumme.kvertrag = MaxVolVS.vprodukt
     END IF 
     IF FVol.vprodukt LIKE "zw.kvertrag*" OR FVol.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FVol.vprodukt
       EXECUTE fo$
       Volumen.kvertrag = wert%
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FVol.vprodukt
       EXECUTE fo$
       Volumen.kvertrag = wert%
     END IF 
   END IF 
   IF FTar.vprodukt <> "" THEN 
     IF MinTar.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minTar.vprodukt THEN VS_Dauer.kvertrag = MinTar.vprodukt
     END IF 
     IF MaxTar.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxTar.vprodukt THEN VS_Dauer.kvertrag = MaxTar.vprodukt
     END IF 
     IF MinTarBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinTarBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinTarBzD.vprodukt
     END IF 
     IF MaxTarBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxTarBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxTarBzD.vprodukt
     END IF 
     IF MinTarBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinTarBBei.vprodukt THEN Beitrag.kvertrag = MinTarBBei.vprodukt
     END IF 
     IF MaxTarBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxTarBBei.vprodukt THEN Beitrag.kvertrag = MaxTarBBei.vprodukt
     END IF 
     IF MinTarNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinTarNBei.vprodukt THEN nettobeitrag.kvertrag = MinTarNBei.vprodukt
     END IF 
     IF MaxTarNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxTarNBei.vprodukt THEN nettobeitrag.kvertrag = MaxTarNBei.vprodukt
     END IF 
     IF MinTarVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinTarVS.vprodukt THEN vsumme.kvertrag = MinTarVS.vprodukt
     END IF 
     IF MaxTarVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxTarVS.vprodukt THEN vsumme.kvertrag = MaxTarVS.vprodukt
     END IF 
     IF FTar.vprodukt LIKE "zw.kvertrag*" OR FTar.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FTar.vprodukt
       EXECUTE fo$
       Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FTar.vprodukt
       EXECUTE fo$
       Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
     END IF 
   END IF 
TarifFoOP2310001: 
   IF CodeTarif.kvertrag > 0 THEN 
     SELECT KEY codetarif.kvertrag FILE "Tarif" INDEX codetarif.tarif
     IF Fbew.tarif <> "" THEN 
       IF MinBew.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.tarif THEN VS_Dauer.kvertrag = MinBew.tarif
       END IF 
       IF MaxBew.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew.tarif THEN VS_Dauer.kvertrag = MaxBew.tarif
       END IF 
       IF MinBewBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD.Tarif THEN DBeitrZahlung.kvertrag = MinBewBzD.Tarif
       END IF 
       IF MaxBewBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxBewBzD.Tarif
       END IF 
       IF MinBewBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei.Tarif THEN Beitrag.kvertrag = MinBewBBei.Tarif
       END IF 
       IF MaxBewBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei.Tarif THEN Beitrag.kvertrag = MaxBewBBei.Tarif
       END IF 
       IF MinBewNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei.Tarif THEN nettobeitrag.kvertrag = MinBewNBei.Tarif
       END IF 
       IF MaxBewNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei.Tarif THEN nettobeitrag.kvertrag = MaxBewNBei.Tarif
       END IF 
       IF MinBewVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS.Tarif THEN vsumme.kvertrag = MinBewVS.Tarif
       END IF 
       IF MaxBewVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS.Tarif THEN vsumme.kvertrag = MaxBewVS.Tarif
       END IF 
       IF fbew.tarif LIKE "zw.kvertrag*" OR fbew.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + Fbew.tarif
         EXECUTE fo$
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + Fbew.tarif
         EXECUTE fo$
       END IF 
       wert$ = STR$ (wert%,"999999999999")
       wert1% = VS_Dauer.kvertrag
       wert1a% = nettobeitrag.kvertrag
       wert2% = wert1% * wert1a%
       wert3% = 1 * wert2%
       wert4% = 0.95 * wert3%
       wert5% = wert4%
       Bewertungssumme.kvertrag = wert%
     END IF 

     IF Fbew2.tarif <> "" THEN 
       IF MinBew2.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew2.tarif THEN VS_Dauer.kvertrag = MinBew2.tarif
       END IF 
       IF MaxBew2.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew2.tarif THEN VS_Dauer.kvertrag = MaxBew2.tarif
       END IF 
       IF MinBewBzD2.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD2.Tarif THEN DBeitrZahlung.kvertrag = MinBewBzD2.Tarif
       END IF 
       IF MaxBewBzD2.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD2.Tarif THEN DBeitrZahlung.kvertrag = MaxBewBzD2.Tarif
       END IF 
       IF MinBewBBei2.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei2.Tarif THEN Beitrag.kvertrag = MinBewBBei2.Tarif
       END IF 
       IF MaxBewBBei2.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei2.Tarif THEN Beitrag.kvertrag = MaxBewBBei2.Tarif
       END IF 
       IF MinBewNBei2.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei2.Tarif THEN nettobeitrag.kvertrag = MinBewNBei2.Tarif
       END IF 
       IF MaxBewNBei2.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei2.Tarif THEN nettobeitrag.kvertrag = MaxBewNBei2.Tarif
       END IF 
       IF MinBewVS2.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS2.Tarif THEN vsumme.kvertrag = MinBewVS2.Tarif
       END IF 
       IF MaxBewVS2.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS2.Tarif THEN vsumme.kvertrag = MaxBewVS2.Tarif
       END IF 
       IF fbew2.tarif LIKE "zw.kvertrag*" OR fbew2.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + Fbew2.tarif
         EXECUTE fo$
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + Fbew2.tarif
         EXECUTE fo$
       END IF 
       wert$ = STR$ (wert%,"999999999999")
       wert1% = VS_Dauer.kvertrag
       wert1a% = nettobeitrag.kvertrag
       wert2% = wert1% * wert1a%
       wert3% = 1 * wert2%
       wert4% = 0.95 * wert3%
       wert5% = wert4%
       Bewertung2.kvertrag = wert%
     END IF 

     IF FSRD.tarif <> "" THEN 
       IF MINSRD.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.tarif THEN VS_Dauer.kvertrag = MinSRD.tarif
       END IF 
       IF MaxSRD.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxSRD.tarif THEN VS_Dauer.kvertrag = MaxSRD.tarif
       END IF 
       IF MinSRDBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinSRDBzD.Tarif THEN DBeitrZahlung.kvertrag = MinSRDBzD.Tarif
       END IF 
       IF MaxSRDBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxSRDBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxSRDBzD.Tarif
       END IF 
       IF MinSRDBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinSRDBBei.Tarif THEN Beitrag.kvertrag = MinSRDBBei.Tarif
       END IF 
       IF MaxSRDBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxSRDBBei.Tarif THEN Beitrag.kvertrag = MaxSRDBBei.Tarif
       END IF 
       IF MinSRDNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinSRDNBei.Tarif THEN nettobeitrag.kvertrag = MinSRDNBei.Tarif
       END IF 
       IF MaxSRDNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxSRDNBei.Tarif THEN nettobeitrag.kvertrag = MaxSRDNBei.Tarif
       END IF 
       IF MinSRDVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinSRDVS.Tarif THEN vsumme.kvertrag = MinSRDVS.Tarif
       END IF 
       IF MaxSRDVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxSRDVS.Tarif THEN vsumme.kvertrag = MaxSRDVS.Tarif
       END IF 
       IF FSRD.tarif LIKE "zw.kvertrag*" OR FSRD.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FSRD.tarif
         EXECUTE fo$
         IF wert% < 100 THEN 
           SRHaftung.kvertrag = wert%
         ELSE 
           CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Tarif-Berechnungsformel!")
         END IF 
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FSRD.tarif
         EXECUTE fo$
         IF wert% < 100 THEN 
           SRHaftung.kvertrag = wert%
         ELSE 
           CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Tarif-Berechnungsformel!")
         END IF 
       END IF 
     END IF 
     IF vs_beginn.kvertrag >= "01.01.2008" AND sr60.tarif = "j" THEN 
       SRHaftung.kvertrag = 60
     END IF 
     IF FVol.tarif <> "" THEN 
       IF MinVol.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minVol.tarif THEN VS_Dauer.kvertrag = MinVol.tarif
       END IF 
       IF MaxVol.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxVol.tarif THEN VS_Dauer.kvertrag = MaxVol.tarif
       END IF 
       IF MinVolBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinVolBzD.Tarif THEN DBeitrZahlung.kvertrag = MinVolBzD.Tarif
       END IF 
       IF MaxVolBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxVolBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxVolBzD.Tarif
       END IF 
       IF MinVolBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinVolBBei.Tarif THEN Beitrag.kvertrag = MinVolBBei.Tarif
       END IF 
       IF MaxVolBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxVolBBei.Tarif THEN Beitrag.kvertrag = MaxVolBBei.Tarif
       END IF 
       IF MinVolNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinVolNBei.Tarif THEN nettobeitrag.kvertrag = MinVolNBei.Tarif
       END IF 
       IF MaxVolNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxVolNBei.Tarif THEN nettobeitrag.kvertrag = MaxVolNBei.Tarif
       END IF 
       IF MinVolVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinVolVS.Tarif THEN vsumme.kvertrag = MinVolVS.Tarif
       END IF 
       IF MaxVolVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxVolVS.Tarif THEN vsumme.kvertrag = MaxVolVS.Tarif
       END IF 
       IF FVol.tarif LIKE "zw.kvertrag*" OR FVol.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FVol.tarif
         EXECUTE fo$
         Volumen.kvertrag = wert%
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FVol.tarif
         EXECUTE fo$
         Volumen.kvertrag = wert%
       END IF 
     END IF 
     IF FTar.tarif <> "" THEN 
       IF MinTar.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minTar.tarif THEN VS_Dauer.kvertrag = MinTar.tarif
       END IF 
       IF MaxTar.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxTar.tarif THEN VS_Dauer.kvertrag = MaxTar.tarif
       END IF 
       IF MinTarBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinTarBzD.Tarif THEN DBeitrZahlung.kvertrag = MinTarBzD.Tarif
       END IF 
       IF MaxTarBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxTarBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxTarBzD.Tarif
       END IF 
       IF MinTarBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinTarBBei.Tarif THEN Beitrag.kvertrag = MinTarBBei.Tarif
       END IF 
       IF MaxTarBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxTarBBei.Tarif THEN Beitrag.kvertrag = MaxTarBBei.Tarif
       END IF 
       IF MinTarNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinTarNBei.Tarif THEN nettobeitrag.kvertrag = MinTarNBei.Tarif
       END IF 
       IF MaxTarNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxTarNBei.Tarif THEN nettobeitrag.kvertrag = MaxTarNBei.Tarif
       END IF 
       IF MinTarVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinTarVS.Tarif THEN vsumme.kvertrag = MinTarVS.Tarif
       END IF 
       IF MaxTarVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxTarVS.Tarif THEN vsumme.kvertrag = MaxTarVS.Tarif
       END IF 
       IF FTar.tarif LIKE "zw.kvertrag*" OR FTar.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FTar.tarif
         EXECUTE fo$
         Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FTar.tarif
         EXECUTE fo$
         Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
       END IF 
     END IF 
   END IF 
   IF bb% <> 0 AND Bewertungssumme.kvertrag <> 0 THEN 
     einh$ = STR$ (Bewertungssumme.kvertrag / bb%,",9999999999.0000")
     Einheiten.kvertrag = VAL (einh$)
   END IF 
   IF Bewertungsbasis.vprodukt = - 1 THEN 
     Einheiten.kvertrag = 0
   END IF 
   VS_Dauer.kvertrag = vd%
   nettobeitrag.kvertrag = netto%
   Beitrag.kvertrag = brutto%
   DBeitrZahlung.kvertrag = dbeitr%
   Vsumme.kvertrag = vsumme%
   IF Bewertungsbasis.vprodukt <> 0 AND Bewertungssumme.kvertrag <> 0 THEN 
     einh$ = STR$ (Bewertungssumme.kvertrag / Bewertungsbasis.vprodukt,",9999999999.0000")
     Einheiten.kvertrag = VAL (einh$)
   END IF 
   IF Bewertungsbasis.vprodukt = - 1 THEN 
     Einheiten.kvertrag = 0
   END IF 
 END SUB 
 


 REM Tarifformeln

SUB TARI()
 CALL Tarife()
 END SUB 

SUB Tarife()
 IF disabled%("TARIFMASKE") THEN END SUB 
 CALL DFile(3,"TARIF" + _fpw$)
 CALL DFile(3,"VProdukt" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"GEKOND" + _fpw$)
 CALL DFile(3,"Sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"KURSHIST" + _fpw$)
 CALL DFile(3,"FONDS" + _fpw$)
 MOUSE OFF 
 MOUSE ON 
 FILE "Tarif"
 INDEX Tarif.Tarif
 SELECT WHERE FILE "Tarif"
 SELECT FIRST 
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "TARIF" THEN 
     SET HEADING title$ + " - TARIF Formeln"
     OPEN FORM GPrjForm$ + "TARIF"
     FORM 6
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\tarif.pdf"
     SET fc = Form.Controls(1)
     REM CALL VProdIntro()
     CALL MNVTarif()
     SET STATUS "TARIF Formeln"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   CALL ClearKBDBuffer()
   IF workstation% = 0 THEN SET STATUS "Anzahl Tarife: " + STR$ ( RECCOUNT ("tarif"),",999999")
   IF GCodeTarif% > 0 THEN 
       SELECT KEY GcodeTARIF% LOCK FILE "TARIF" INDEX codeTARIF.TARIF
       waehr$ = "WÑhrung: " + waehrung.tarif
       FORM 1
   END IF 
   

   IF ag$ = "j" THEN 
     f.neu.visible = 0
     f.neu.enabled = 0
   ELSE 
     f.neu.visible = - 1
     f.neu.enabled = - 1
   END IF 
   FORM 
   
   WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN 
     w% = PAGE 
     IF PAGE >= 2 AND PAGE <= 5 THEN 
       FORM 1
     ELSE 
       IF PAGE = 1 THEN 
         FORM 6
       ELSE 
         _formend% = 1
       END IF 
     END IF 
   END IF 
   SELECT CASE KUVorgsub%
     CASE 1
       IF ag$ <> "j" THEN 
         CodeTARIF% = CodeTARIF.TARIF
         SELECT KEY codeTARIF% LOCK FILE "TARIF" INDEX codeTARIF.TARIF
         waehr$ = "WÑhrung: " + waehrung.tarif
         IF EXISTS (CodeTARIF.TARIF,CodeTARIF.KURSHIST) THEN 
           kurshist$ = "Kurshistorie Æ"
         ELSE 
           kurshist$ = "Kurshistorie"
         END IF 
         IF codevp.tarif > 0 THEN 
           SELECT KEY codevp.tarif FILE "VPRODUKT" INDEX codevp.vprodukt
           prod$ = Gesellschaft.vprodukt + " / " + Sparte.vprodukt
         ELSE 
           prod$ = "Bitte weisen Sie dem Tarif ein Produkt zu!"
         END IF 
         FORM 1
       ELSE 
         CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
       END IF 
     CASE 2
       IF NOT disabled%("TARIFNEW") THEN 
         codevp% = GetVprodukt%(codege%,codeva%, - 1)
         FILE "TARIF"
         BLANK FILE "TARIF"
         codeTARIF% = SER ("TARIF",1)
         codeTARIF.TARIF = codeTARIF%
         TARIF.TARIF = " NEU"
         codevp.tarif = codevp%
         CALL QuickStore("TARIF")
         
         INDEX TARIF.TARIF
         SELECT FIRST 
         SELECT KEY codeTARIF% LOCK FILE "TARIF" INDEX codeTARIF.TARIF
         IF codevp.tarif > 0 THEN 
           SELECT KEY codevp.tarif FILE "VPRODUKT" INDEX codevp.vprodukt
           prod$ = Gesellschaft.vprodukt + " / " + Sparte.vprodukt
         ELSE 
           prod$ = "Bitte weisen Sie dem Tarif ein Produkt zu!"
         END IF 
         FORM 1
       END IF 
     CASE 3
       FORM 1
     CASE 4
       IF GCodeTarif% > 0 THEN 
         GCodeTarif% = 0
         _formend% = 1
       ELSE 
         FILE "TARIF"
         INDEX TARIF.TARIF
         FORM 6
         SELECT FORM FIRST 
         FORM 
       END IF 
     CASE 5
       REM Produkt zuweisen
       codetarif% = CodeTarif.tarif
       codevp% = GetVprodukt%(codege%,codeva%, - 1)
       IF codevp% > 0 THEN 
         SELECT KEY codevp% FILE "VPRODUKT" INDEX codevp.vprodukt
         prod$ = Gesellschaft.vprodukt + " / " + Sparte.vprodukt
         SELECT KEY codeTARIF% LOCK FILE "TARIF" INDEX codeTARIF.TARIF
         codevp.tarif = codevp%
         CALL QuickStore("TARIF")

       END IF 
     CASE 7
       REM drucken
       IF NOT disabled%("TARIFPRINT") THEN 
         REM REQUEST "Wollen Sie die TarifÅbersicht drucken (JA) oder ?","wollen Sie die FondsÅbersicht drucken (NEIN)?",130,req1%
         REM IF req1% = 1 THEN 
           CALL TARIFREP(0)
         REM ELSE 
           REM CALL TARIFREP(1)
         REM END IF 
 
       END IF 
     CASE 8
       REM lîschen
       IF NOT disabled%("TARIFDEL") THEN 
         ok% = - 1
         codeTARIF% = codeTARIF.TARIF
         REQUEST "Wollen Sie den Tarif wirklich lîschen?","",130,req1%
         IF req1% = 1 THEN 
           MOUSE OFF 
           IF EXISTS (CodeTARIF.TARIF,CodeTARIF.kvertrag) THEN 
             ok% = 0
             CALL Fehler("Der Tarif kann nicht gelîscht werden,","da VerknÅpfungen zur Vertragsdatei existieren!")
           END IF 
           IF ok% = - 1 THEN 
             SELECT KEY codeTARIF% LOCK FILE "TARIF" INDEX codeTARIF.TARIF
             SELECT REMOVE FILE "TARIF"
             REQUEST "Datensatz wurde gelîscht!"
           END IF 
           FILE "TARIF"
           INDEX TARIF.TARIF
           SELECT FIRST 
           FORM 6
           SELECT FORM FIRST 
         END IF 
       END IF 
       MOUSE ON 
     CASE 10
       CALL Kurshistorie()
     CASE 11
       IF NOT disabled%("TARIFPRINTV") THEN 

         CALL VertrUniRep(0,0,0,0,0,0,0,0,1, - 1,codetarif.tarif)
       END IF 
     CASE 12
       REM Formel Bewertungssumme bearbeiten
       f.FoSich1.visible = - 1
       f.FoSich1.enabled = - 1
       f.FoLoe1.visible = - 1
       f.FoLoe1.enabled = - 1
       f.FoBZur1.visible = 0
       f.FoBZur1.enabled = 0
       f.FoHinzu1.visible = - 1
       f.FoHinzu1.enabled = - 1
       f.WzuFo1.visible = - 1
       f.WzuFo1.enabled = - 1
       f.WWLoe1.visible = - 1
       f.WWLoe1.enabled = - 1
       f.LoeLatZ1.visible = - 1
       f.LoeLatZ1.enabled = - 1
       f.FoBearb1.enabled = 0
       f.FoBearb1.visible = 0
       GFormBew$ = FormelBewertung.tarif
       ENTER 29,0
       ENTER END 
       IF KUVorgsub% = 13 THEN 
         IF GFormBew$ <> FormelBewertung.tarif THEN 
           FormelBewertOld.tarif = GFormBew$
           FBWénd.tarif = TODAY 
         END IF 
         CALL QuickStore("TARIF")
         f.FoSich1.visible = 0
         f.FoSich1.enabled = 0
         f.FoLoe1.visible = 0
         f.FoLoe1.enabled = 0
         f.FoBZur1.visible = - 1
         f.FoBZur1.enabled = - 1
         f.FoHinzu1.visible = 0
         f.FoHinzu1.enabled = 0
         f.WzuFo1.visible = 0
         f.WzuFo1.enabled = 0
         f.WWLoe1.visible = 0
         f.WWLoe1.enabled = 0
         f.LoeLatZ1.visible = 0
         f.LoeLatZ1.enabled = 0
         f.FoBearb1.enabled = - 1
         f.FoBearb1.visible = - 1
       END IF 
       IF KUVorgsub% = 14 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           IF GFormBew$ <> FormelBewertung.tarif THEN 
             FormelBewertOld.tarif = GFormBew$
             FBWénd.tarif = TODAY 
           END IF 
           FormelBewertung = ""
           CALL QuickStore("TARIF")
           f.FoSich1.visible = 0
           f.FoSich1.enabled = 0
           f.FoLoe1.visible = 0
           f.FoLoe1.enabled = 0
           f.FoBZur1.visible = - 1
           f.FoBZur1.enabled = - 1
           f.FoHinzu1.visible = 0
           f.FoHinzu1.enabled = 0
           f.WzuFo1.visible = 0
           f.WzuFo1.enabled = 0
           f.WWLoe1.visible = 0
           f.WWLoe1.enabled = 0
           f.LoeLatZ1.visible = 0
           f.LoeLatZ1.enabled = 0
           f.FoBearb1.enabled = - 1
           f.FoBearb1.visible = - 1
         END IF 
       END IF 
     CASE 13
       REM Formel Bewertungssumme speichern
       CALL QuickStore("TARIF")
       f.FoSich1.visible = 0
       f.FoSich1.enabled = 0
       f.FoLoe1.visible = 0
       f.FoLoe1.enabled = 0
       f.FoBZur1.visible = - 1
       f.FoBZur1.enabled = - 1
       f.FoHinzu1.visible = 0
       f.FoHinzu1.enabled = 0
       f.WzuFo1.visible = 0
       f.WzuFo1.enabled = 0
       f.WWLoe1.visible = 0
       f.WWLoe1.enabled = 0
       f.LoeLatZ1.visible = 0
       f.LoeLatZ1.enabled = 0
     CASE 14
       REM Formel Bewertungssumme lîschen
       REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         FormelBewertung = ""
         CALL QuickStore("TARIF")
         f.FoSich1.visible = 0
         f.FoSich1.enabled = 0
         f.FoLoe1.visible = 0
         f.FoLoe1.enabled = 0
         f.FoBZur1.visible = - 1
         f.FoBZur1.enabled = - 1
         f.FoHinzu1.visible = 0
         f.FoHinzu1.enabled = 0
         f.WzuFo1.visible = 0
         f.WzuFo1.enabled = 0
         f.WWLoe1.visible = 0
         f.WWLoe1.enabled = 0
         f.LoeLatZ1.visible = 0
         f.LoeLatZ1.enabled = 0
       END IF 
       MOUSE ON 
     CASE 15
       REM Bearbeiten Formel Volumen
       f.FoSich2.visible = - 1
       f.FoSich2.enabled = - 1
       f.FoLoe2.visible = - 1
       f.FoLoe2.enabled = - 1
       f.FoBZur2.visible = 0
       f.FoBZur2.enabled = 0
       f.FoHinzu2.visible = - 1
       f.FoHinzu2.enabled = - 1
       f.WzuFo2.visible = - 1
       f.WzuFo2.enabled = - 1
       f.WWLoe2.visible = - 1
       f.WWLoe2.enabled = - 1
       f.LoeLatZ2.visible = - 1
       f.LoeLatZ2.enabled = - 1
       f.FoBearb2.enabled = 0
       f.FoBearb2.visible = 0
       ENTER 69,0
       ENTER END 
       IF KUVorgsub% = 16 THEN 
         CALL QuickStore("TARIF")
         f.FoSich2.visible = 0
         f.FoSich2.enabled = 0
         f.FoLoe2.visible = 0
         f.FoLoe2.enabled = 0
         f.FoBZur2.visible = - 1
         f.FoBZur2.enabled = - 1
         f.FoHinzu2.visible = 0
         f.FoHinzu2.enabled = 0
         f.WzuFo2.visible = 0
         f.WzuFo2.enabled = 0
         f.WWLoe2.visible = 0
         f.WWLoe2.enabled = 0
         f.LoeLatZ2.visible = 0
         f.LoeLatZ2.enabled = 0
         f.FoBearb2.enabled = - 1
         f.FoBearb2.visible = - 1
       END IF 
       IF KUVorgsub% = 17 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelVolumen = ""
           CALL QuickStore("TARIF")
           f.FoSich2.visible = 0
           f.FoSich2.enabled = 0
           f.FoLoe2.visible = 0
           f.FoLoe2.enabled = 0
           f.FoBZur2.visible = - 1
           f.FoBZur2.enabled = - 1
           f.FoHinzu2.visible = 0
           f.FoHinzu2.enabled = 0
           f.WzuFo2.visible = 0
           f.WzuFo2.enabled = 0
           f.WWLoe2.visible = 0
           f.WWLoe2.enabled = 0
           f.LoeLatZ2.visible = 0
           f.LoeLatZ2.enabled = 0
           f.FoBearb2.enabled = - 1
           f.FoBearb2.visible = - 1
         END IF 
       END IF 
     CASE 16
         REM Sichern Formel Volumen
         CALL QuickStore("TARIF")
         f.FoSich2.visible = 0
         f.FoSich2.enabled = 0
         f.FoLoe2.visible = 0
         f.FoLoe2.enabled = 0
         f.FoBZur2.visible = - 1
         f.FoBZur2.enabled = - 1
         f.FoHinzu2.visible = 0
         f.FoHinzu2.enabled = 0
         f.WzuFo2.visible = 0
         f.WzuFo2.enabled = 0
         f.WWLoe2.visible = 0
         f.WWLoe2.enabled = 0
         f.LoeLatZ2.visible = 0
         f.LoeLatZ2.enabled = 0
         f.FoBearb2.enabled = - 1
         f.FoBearb2.visible = - 1
     CASE 17
         REM Lîschen Formel Volumen
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelVolumen = ""
           CALL QuickStore("TARIF")
           f.FoSich2.visible = 0
           f.FoSich2.enabled = 0
           f.FoLoe2.visible = 0
           f.FoLoe2.enabled = 0
           f.FoBZur2.visible = - 1
           f.FoBZur2.enabled = - 1
           f.FoHinzu2.visible = 0
           f.FoHinzu2.enabled = 0
           f.WzuFo2.visible = 0
           f.WzuFo2.enabled = 0
           f.WWLoe2.visible = 0
           f.WWLoe2.enabled = 0
           f.LoeLatZ2.visible = 0
           f.LoeLatZ2.enabled = 0
           f.FoBearb2.enabled = - 1
           f.FoBearb2.visible = - 1
         END IF 
     CASE 18
       REM Bearbeiten Formel Dauer SR
       f.FoSich3.visible = - 1
       f.FoSich3.enabled = - 1
       f.FoLoe3.visible = - 1
       f.FoLoe3.enabled = - 1
       f.FoBZur3.visible = 0
       f.FoBZur3.enabled = 0
       f.FoHinzu3.visible = - 1
       f.FoHinzu3.enabled = - 1
       f.WzuFo3.visible = - 1
       f.WzuFo3.enabled = - 1
       f.WWLoe3.visible = - 1
       f.WWLoe3.enabled = - 1
       f.LoeLatZ3.visible = - 1
       f.LoeLatZ3.enabled = - 1
       f.FoBearb3.enabled = 0
       f.FoBearb3.visible = 0
       ENTER 109,0
       ENTER END 
       IF KUVorgsub% = 19 THEN 
         CALL QuickStore("TARIF")
         f.FoSich3.visible = 0
         f.FoSich3.enabled = 0
         f.FoLoe3.visible = 0
         f.FoLoe3.enabled = 0
         f.FoBZur3.visible = - 1
         f.FoBZur3.enabled = - 1
         f.FoHinzu3.visible = 0
         f.FoHinzu3.enabled = 0
         f.WzuFo3.visible = 0
         f.WzuFo3.enabled = 0
         f.WWLoe3.visible = 0
         f.WWLoe3.enabled = 0
         f.LoeLatZ3.visible = 0
         f.LoeLatZ3.enabled = 0
         f.FoBearb3.enabled = - 1
         f.FoBearb3.visible = - 1
       END IF 
       IF KUVorgsub% = 20 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelSRDauer = ""
           CALL QuickStore("TARIF")
           f.FoSich3.visible = 0
           f.FoSich3.enabled = 0
           f.FoLoe3.visible = 0
           f.FoLoe3.enabled = 0
           f.FoBZur3.visible = - 1
           f.FoBZur3.enabled = - 1
           f.FoHinzu3.visible = 0
           f.FoHinzu3.enabled = 0
           f.WzuFo3.visible = 0
           f.WzuFo3.enabled = 0
           f.WWLoe3.visible = 0
           f.WWLoe3.enabled = 0
           f.LoeLatZ3.visible = 0
           f.LoeLatZ3.enabled = 0
           f.FoBearb3.enabled = - 1
           f.FoBearb3.visible = - 1
         END IF 
       END IF 
     CASE 19
         CALL QuickStore("TARIF")
         f.FoSich3.visible = 0
         f.FoSich3.enabled = 0
         f.FoLoe3.visible = 0
         f.FoLoe3.enabled = 0
         f.FoBZur3.visible = - 1
         f.FoBZur3.enabled = - 1
         f.FoHinzu3.visible = 0
         f.FoHinzu3.enabled = 0
         f.WzuFo3.visible = 0
         f.WzuFo3.enabled = 0
         f.WWLoe3.visible = 0
         f.WWLoe3.enabled = 0
         f.LoeLatZ3.visible = 0
         f.LoeLatZ3.enabled = 0
         f.FoBearb3.enabled = - 1
         f.FoBearb3.visible = - 1
     CASE 20
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelSRDauer = ""
           CALL QuickStore("TARIF")
           f.FoSich3.visible = 0
           f.FoSich3.enabled = 0
           f.FoLoe3.visible = 0
           f.FoLoe3.enabled = 0
           f.FoBZur3.visible = - 1
           f.FoBZur3.enabled = - 1
           f.FoHinzu3.visible = 0
           f.FoHinzu3.enabled = 0
           f.WzuFo3.visible = 0
           f.WzuFo3.enabled = 0
           f.WWLoe3.visible = 0
           f.WWLoe3.enabled = 0
           f.LoeLatZ3.visible = 0
           f.LoeLatZ3.enabled = 0
           f.FoBearb3.enabled = - 1
           f.FoBearb3.visible = - 1
         END IF 
     CASE 21
       REM Bearbeiten Formel Tarif
       f.FoSich4.visible = - 1
       f.FoSich4.enabled = - 1
       f.FoLoe4.visible = - 1
       f.FoLoe4.enabled = - 1
       f.FoBZur4.visible = 0
       f.FoBZur4.enabled = 0
       f.FoHinzu4.visible = - 1
       f.FoHinzu4.enabled = - 1
       f.WzuFo4.visible = - 1
       f.WzuFo4.enabled = - 1
       f.WWLoe4.visible = - 1
       f.WWLoe4.enabled = - 1
       f.LoeLatZ4.visible = - 1
       f.LoeLatZ4.enabled = - 1
       f.FoBearb4.enabled = 0
       f.FoBearb4.visible = 0
       ENTER 149,0
       ENTER END 
       IF KUVorgsub% = 22 THEN 
         CALL QuickStore("TARIF")
         f.FoSich4.visible = 0
         f.FoSich4.enabled = 0
         f.FoLoe4.visible = 0
         f.FoLoe4.enabled = 0
         f.FoBZur4.visible = - 1
         f.FoBZur4.enabled = - 1
         f.FoHinzu4.visible = 0
         f.FoHinzu4.enabled = 0
         f.WzuFo4.visible = 0
         f.WzuFo4.enabled = 0
         f.WWLoe4.visible = 0
         f.WWLoe4.enabled = 0
         f.LoeLatZ4.visible = 0
         f.LoeLatZ4.enabled = 0
         f.FoBearb4.enabled = - 1
         f.FoBearb4.visible = - 1
       END IF 
       IF KUVorgsub% = 23 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelTarif = ""
           CALL QuickStore("TARIF")
           f.FoSich4.visible = 0
           f.FoSich4.enabled = 0
           f.FoLoe4.visible = 0
           f.FoLoe4.enabled = 0
           f.FoBZur4.visible = - 1
           f.FoBZur4.enabled = - 1
           f.FoHinzu4.visible = 0
           f.FoHinzu4.enabled = 0
           f.WzuFo4.visible = 0
           f.WzuFo4.enabled = 0
           f.WWLoe4.visible = 0
           f.WWLoe4.enabled = 0
           f.LoeLatZ4.visible = 0
           f.LoeLatZ4.enabled = 0
           f.FoBearb4.enabled = - 1
           f.FoBearb4.visible = - 1
         END IF 
       END IF 
     CASE 22
         CALL QuickStore("TARIF")
         f.FoSich4.visible = 0
         f.FoSich4.enabled = 0
         f.FoLoe4.visible = 0
         f.FoLoe4.enabled = 0
         f.FoBZur4.visible = - 1
         f.FoBZur4.enabled = - 1
         f.FoHinzu4.visible = 0
         f.FoHinzu4.enabled = 0
         f.WzuFo4.visible = 0
         f.WzuFo4.enabled = 0
         f.WWLoe4.visible = 0
         f.WWLoe4.enabled = 0
         f.LoeLatZ4.visible = 0
         f.LoeLatZ4.enabled = 0
         f.FoBearb4.enabled = - 1
         f.FoBearb4.visible = - 1
     CASE 23
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelTarif = ""
           CALL QuickStore("tarif")
           f.FoSich4.visible = 0
           f.FoSich4.enabled = 0
           f.FoLoe4.visible = 0
           f.FoLoe4.enabled = 0
           f.FoBZur4.visible = - 1
           f.FoBZur4.enabled = - 1
           f.FoHinzu4.visible = 0
           f.FoHinzu4.enabled = 0
           f.WzuFo4.visible = 0
           f.WzuFo4.enabled = 0
           f.WWLoe4.visible = 0
           f.WWLoe4.enabled = 0
           f.LoeLatZ4.visible = 0
           f.LoeLatZ4.enabled = 0
           f.FoBearb4.enabled = - 1
           f.FoBearb4.visible = - 1
         END IF 
     CASE 99
       IF NOT disabled%("TARIFEDIT") THEN 
         MOUSE ON 
         f.be1.enabled = 0
         f.sich1.enabled = - 1
         f.loe1.enabled = 0
         f.zur1.enabled = 0
         f.vue.enabled = 0
         f.kurshist.enabled = 0
         f.prod.enabled = 0
         GTarifname$ = Tarif.Tarif
         ENTER tarif.tarif,0
         IF KUVorgsub% = 104 THEN 
           CALL QuickStore("tarif")
         END IF 
         f.be1.enabled = - 1
         f.sich1.enabled = 0
         f.loe1.enabled = - 1
         f.zur1.enabled = - 1
         f.vue.enabled = - 1
         f.kurshist.enabled = - 1
         f.prod.enabled = - 1
         KUVorgsub% = 0
       END IF 
     CASE 100
       f.FoSich1.visible = 0
       f.FoSich1.enabled = 0
       f.FoLoe1.visible = 0
       f.FoLoe1.enabled = 0
       f.FoBZur1.visible = - 1
       f.FoBZur1.enabled = - 1
       f.FoHinzu1.visible = 0
       f.FoHinzu1.enabled = 0
       f.WzuFo1.visible = 0
       f.WzuFo1.enabled = 0
       f.WWLoe1.visible = 0
       f.WWLoe1.enabled = 0
       f.LoeLatZ1.visible = 0
       f.LoeLatZ1.enabled = 0
       f.FoBearb1.enabled = - 1
       f.FoBearb1.visible = - 1
       IF NOT disabled%("TARIFEDIT") THEN FORM 2
     CASE 101
       f.FoSich2.visible = 0
       f.FoSich2.enabled = 0
       f.FoLoe2.visible = 0
       f.FoLoe2.enabled = 0
       f.FoBZur2.visible = - 1
       f.FoBZur2.enabled = - 1
       f.FoHinzu2.visible = 0
       f.FoHinzu2.enabled = 0
       f.WzuFo2.visible = 0
       f.WzuFo2.enabled = 0
       f.WWLoe2.visible = 0
       f.WWLoe2.enabled = 0
       f.LoeLatZ2.visible = 0
       f.LoeLatZ2.enabled = 0
       f.FoBearb2.enabled = - 1
       f.FoBearb2.visible = - 1
       IF NOT disabled%("TARIFEDIT") THEN FORM 3
     CASE 102
       f.FoSich3.visible = 0
       f.FoSich3.enabled = 0
       f.FoLoe3.visible = 0
       f.FoLoe3.enabled = 0
       f.FoBZur3.visible = - 1
       f.FoBZur3.enabled = - 1
       f.FoHinzu3.visible = 0
       f.FoHinzu3.enabled = 0
       f.WzuFo3.visible = 0
       f.WzuFo3.enabled = 0
       f.WWLoe3.visible = 0
       f.WWLoe3.enabled = 0
       f.LoeLatZ3.visible = 0
       f.LoeLatZ3.enabled = 0
       f.FoBearb3.enabled = - 1
       f.FoBearb3.visible = - 1
       IF NOT disabled%("TARIFEDIT") THEN FORM 4
     CASE 103
       f.FoSich4.visible = 0
       f.FoSich4.enabled = 0
       f.FoLoe4.visible = 0
       f.FoLoe4.enabled = 0
       f.FoBZur4.visible = - 1
       f.FoBZur4.enabled = - 1
       f.FoHinzu4.visible = 0
       f.FoHinzu4.enabled = 0
       f.WzuFo4.visible = 0
       f.WzuFo4.enabled = 0
       f.WWLoe4.visible = 0
       f.WWLoe4.enabled = 0
       f.LoeLatZ4.visible = 0
       f.LoeLatZ4.enabled = 0
       f.FoBearb4.enabled = - 1
       f.FoBearb4.visible = - 1
       IF NOT disabled%("TARIFEDIT") THEN FORM 5
     CASE 104
       CALL QuickStore("TARIF")
       REM CALL TarifStore(CodeTarif.TARIF)
     CASE 105
       REM Formel Bewertungssumme2 lîschen
       REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         FormelBewertun2 = ""
         CALL QuickStore("TARIF")
         f.FoSich5.visible = 0
         f.FoSich5.enabled = 0
         f.FoLoe5.visible = 0
         f.FoLoe5.enabled = 0
         f.FoBZur5.visible = - 1
         f.FoBZur5.enabled = - 1
         f.FoHinzu5.visible = 0
         f.FoHinzu5.enabled = 0
         f.WzuFo5.visible = 0
         f.WzuFo5.enabled = 0
         f.WWLoe5.visible = 0
         f.WWLoe5.enabled = 0
         f.LoeLaZ5.visible = 0
         f.LoeLatZ5.enabled = 0
       END IF 
       MOUSE ON 
     CASE 106
       f.FoSich5.visible = 0
       f.FoSich5.enabled = 0
       f.FoLoe5.visible = 0
       f.FoLoe5.enabled = 0
       f.FoBZur5.visible = - 1
       f.FoBZur5.enabled = - 1
       f.FoHinzu5.visible = 0
       f.FoHinzu5.enabled = 0
       f.WzuFo5.visible = 0
       f.WzuFo5.enabled = 0
       f.WWLoe5.visible = 0
       f.WWLoe5.enabled = 0
       f.LoeLatZ5.visible = 0
       f.LoeLatZ5.enabled = 0
       f.FoBearb5.enabled = - 1
       f.FoBearb5.visible = - 1
       IF NOT disabled%("TARIFEDIT") THEN FORM 7
       MOUSE ON 
     CASE 107
       REM Formel Bewertungssumme speichern
       CALL QuickStore("TARIF")
       f.FoSich5.visible = 0
       f.FoSich5.enabled = 0
       f.FoLoe5.visible = 0
       f.FoLoe5.enabled = 0
       f.FoBZur5.visible = - 1
       f.FoBZur5.enabled = - 1
       f.FoHinzu5.visible = 0
       f.FoHinzu5.enabled = 0
       f.WzuFo5.visible = 0
       f.WzuFo5.enabled = 0
       f.WWLoe5.visible = 0
       f.WWLoe5.enabled = 0
       f.LoeLatZ5.visible = 0
       f.LoeLatZ5.enabled = 0
     CASE 108
       REM Formel Bewertungssumme bearbeiten
       f.FoSich5.visible = - 1
       f.FoSich5.enabled = - 1
       f.FoLoe5.visible = - 1
       f.FoLoe5.enabled = - 1
       f.FoBZur5.visible = 0
       f.FoBZur5.enabled = 0
       f.FoHinzu5.visible = - 1
       f.FoHinzu5.enabled = - 1
       f.WzuFo5.visible = - 1
       f.WzuFo5.enabled = - 1
       f.WWLoe5.visible = - 1
       f.WWLoe5.enabled = - 1
       f.LoeLatZ5.visible = - 1
       f.LoeLatZ5.enabled = - 1
       f.FoBearb5.enabled = 0
       f.FoBearb5.visible = 0
       GFormBew$ = FormelBewertun2.tarif
       ENTER 436,0
       ENTER END 
       IF KUVorgsub% = 107 THEN 
         CALL QuickStore("TARIF")
         f.FoSich5.visible = 0
         f.FoSich5.enabled = 0
         f.FoLoe5.visible = 0
         f.FoLoe5.enabled = 0
         f.FoBZur5.visible = - 1
         f.FoBZur5.enabled = - 1
         f.FoHinzu5.visible = 0
         f.FoHinzu5.enabled = 0
         f.WzuFo5.visible = 0
         f.WzuFo5.enabled = 0
         f.WWLoe5.visible = 0
         f.WWLoe5.enabled = 0
         f.LoeLatZ5.visible = 0
         f.LoeLatZ5.enabled = 0
         f.FoBearb5.enabled = - 1
         f.FoBearb5.visible = - 1
       END IF 
       IF KUVorgsub% = 105 THEN 
         REQUEST "Wollen Sie die Formel wirklich lîschen?","",130,req%
         IF req% = 1 THEN 
           FormelBewertun2 = ""
           CALL QuickStore("TARIF")
           f.FoSich5.visible = 0
           f.FoSich5.enabled = 0
           f.FoLoe5.visible = 0
           f.FoLoe5.enabled = 0
           f.FoBZur5.visible = - 1
           f.FoBZur5.enabled = - 1
           f.FoHinzu5.visible = 0
           f.FoHinzu5.enabled = 0
           f.WzuFo5.visible = 0
           f.WzuFo5.enabled = 0
           f.WWLoe5.visible = 0
           f.WWLoe5.enabled = 0
           f.LoeLatZ5.visible = 0
           f.LoeLatZ5.enabled = 0
           f.FoBearb5.enabled = - 1
           f.FoBearb5.visible = - 1
         END IF 
       END IF 

   END SELECT 
   MOUSE ON 
   MENU OFF 
 WEND 
 REM IF ( MOD ("vprodukt") OR NEW ("vprodukt")) THEN CALL QuickStore("vprodukt")
 _formend% = 0
 VQCodeGEVA$ = ""
 GCodeGE% = 0
 GCodeVA% = 0
 GCodeEingGE% = 0
 SELECT WHERE FILE "tarif"
 REQUEST "Sie haben énderungen vorgenommen!","Mîchten Sie die Kurs-énderungen verarbeiten lassen?",130,req%
 
 IF req% = 1 THEN 
   MOUSE OFF 
   FILE "TARIF"
   INDEX codetarif.tarif
   SELECT FIRST 
   FILE "KVERTRAG"
   INDEX codetarif.kvertrag
   FILE "fonds"
   INDEX codevt.fonds
   FILE "tarif"
   WHILE NOT EOF ("TARIF")
      FILE "KVERTRAG"
      SELECT FIRST FILE "KVERTRAG"
      IF EXISTS (codetarif.tarif,codetarif.kvertrag) AND FondsKZ.tarif LIKE "j" THEN 
        SELECT KEY codetarif.tarif LOCK FILE "KVERTRAG" INDEX codetarif.kvertrag
        WHILE NOT EOF ("KVERTRAG") AND codetarif.kvertrag = codetarif.tarif
          SET STATUS "verarbeite Vertrag: " + VS_NR.kvertrag
          TarifFo.kvertrag = Tarif.Tarif
          STORE FILE "KVERTRAG"
          UNLOCK CURRENT FILE "KVERTRAG"
          IF EXISTS (lfdnr.kvertrag,codevt.fonds) THEN 
            FILE "fonds"
            SELECT FIRST FILE "fonds" INDEX codevt.fonds
            SELECT KEY lfdnr.kvertrag LOCK FILE "fonds" INDEX codevt.fonds
            REM CALL Fehler("","")
            CALL RechKvertrag(lfdnr.kvertrag)
          END IF 
          FILE "kvertrag"
          SELECT NEXT LOCK FILE "KVERTRAG" INDEX codetarif.kvertrag
        WEND 
      END IF 
   FILE "tarif"
   SELECT NEXT FILE "TARIF" INDEX codetarif.tarif
   WEND 
 END IF 
 MOUSE ON 
 SET STATUS ""
 END SUB 
  
SUB TarifStore(codetarif%)
 IF ( NEW ("TARIF") OR MOD ("TARIF")) AND codetarif% > 0 THEN 
   BKursZeit.TARIF = NOW 
   QuickVTBerDat.TARIF = DATE$ (BKursTag.TARIF,"yyyymm0d") + LEFT$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),2) + MID$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),4,2) + RIGHT$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),2)
   STORE FILE "Tarif"
   UNLOCK CURRENT FILE "Tarif"
   ixkuktoz% = FILEINFO ("Tarif",1)
   DIM ixkukto$(ixkuktoz%)
   FILLARRAY ixkukto$,1
   BLANK FILE "KURSHIST"
   FOR j% = 0 TO ixkuktoz% - 1
     feld1$ = ixkukto$(j%) + ".KURSHIST"
     feld2$ = ixkukto$(j%) + ".TARIF"
     feld1$$ = feld2$$
   NEXT j%
   codetarifhist.kurshist = SER ("KURSHIST",1)
   STORE FILE "KURSHIST"
 END IF 
 END SUB 
 
SUB TarifWaehrung()
   _cuwaehr% = CodeW.tarif
   cv% = codetarif.tarif
   DIM Waehrung$( RECCOUNT ("waehrung"))
   IF NEW ("tarif") OR MOD ("tarif") THEN CALL FStore("tarif")
     FILE "waehrung"
     DIM Auswahl1$(1)
     INDEX Codew.waehrung
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("waehrung")
       Waehrung$(a%) = waehrung.waehrung + " (1Euro = " + STR$ (umrechnung.waehrung,",999999.000000") + " " + waehrung.waehrung + ")" + SPACE$ (120) + STR$ (CodeW.waehrung,"000000")
       a% = a% + 1
       SELECT NEXT 
     WEND 
     FILE "tarif"
     CREATE DIALOG "PREISLIS",0,0,190,164,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl WÑhrung"
      ADD DIALOG "PREISLIS",7,5,14,139,125,2,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        _cuwaehr% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY _cuwaehr% FILE "waehrung" INDEX codew.waehrung
        _cuwaehr% = CodeW.waehrung
        IF _cuwaehr% > 0 THEN cuwaehr% = _cuwaehr%
        
        SELECT KEY cv% LOCK FILE "tarif" INDEX codetarif.tarif
        CodeW.tarif = _cuwaehr%
        NUMBASE "z99999999.000000"
        euro% = umrechnung.waehrung
        Waehrung.tarif = waehrung.waehrung
        umrechnung.tarif = euro%
        CALL FStore("tarif")
        SELECT FORM KEY cv% FILE "tarif" INDEX codetarif.tarif
        waehr$ = "WÑhrung: " + waehrung.tarif
      END IF 
 
 MOUSE ON 
 FORM 
 
 END SUB 
 
SUB Kurshistorie()
   
   cv% = codetarif.tarif
   DIM Waehrung$( RECCOUNT ("kurshist"))
   IF NEW ("tarif") OR MOD ("tarif") THEN CALL FStore("tarif")
     FILE "kurshist"
     DIM Auswahl1$(1)
     INDEX Codetarif.kurshist
     SELECT FIRST 
     a% = 0
     IF EXISTS (cv%,codetarif.kurshist) THEN 
       SELECT KEY cv% FILE "kurshist" INDEX codetarif.kurshist
     ELSE 
       CALL Fehler("Es existieren keine EintrÑge in der Kurshistoriendatei","")
       END SUB 
     END IF 
     REM BRÅckkaufWaehr
     WHILE NOT EOF ("kurshist") AND codetarif.kurshist = cv%
       datezeit$ = DATE$ (BKursTag.kurshist,"yyyymm0d") + " " + TIME$ (BKursZeit.kurshist,"hh:mm:ss")
       ab$ = PAD$ ( STR$ (BRÅckkaufWaehr.kurshist,",9999999999.0000"),20) + "       " + PAD$ ( STR$ (BAntPreisinWaeh.kurshist,",9999999999.0000"),20) + "       "
       Waehrung$(a%) = datezeit$ + ab$ + PAD$ ( STR$ (BKursEuro.kurshist,",9999999999.0000"),20) + "       " + PAD$ ( STR$ (BKursUS.kurshist,",9999999999.0000"),20)
       a% = a% + 1
       SELECT NEXT 
     WEND 
     CREATE DIALOG "PREISLIS",0,0,390,264,title$,"MS Sans Serif",7
      ADD DIALOG "PREISLIS",4,0,0,389,243,0,"KursDatum   Zeit           RÅckkaufwert            Anlagewert                 KursEuro                    KursUS$  "
      ADD DIALOG "PREISLIS",7,5,14,369,225,2,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,167,245,55,16,1,"&OK",1,1
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
 
 MOUSE ON 
 FORM 
 
 END SUB 
  



SUB VPRODClick()
 ENTER END 
 FORM 1
 MOUSE ON 
 END SUB 
 
SUB VPRODREP()
 CALL PRep("VPRODREP")
 REM REPORT USING "VPRODREP"
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO ErrVPRODREP
 SET FIRST PAGE HEADING OFF 
 SET FIRST PAGE FOOTING OFF 
 SELECT ;
     ORDER REPORT GesSpa.VPRODUKT
     TO ASK 
 END SELECT 
ErrVPRODREP: 
 ON ERROR GOTO ErrorHandler
 END SUB 
  



SUB TARIFREP(a%)
 IF a% = 0 THEN CALL PRep("TARIFREP")
 IF a% = 1 THEN CALL PRep("TARIFREF")
 REM REPORT USING "VPRODREP"
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO ErrTARIFREP
 SET FIRST PAGE HEADING OFF 
 SET FIRST PAGE FOOTING OFF 
 IF a% = 0 THEN 
   SELECT ;
     WHERE FondsKZ.TARIF <> "j"
     ORDER REPORT TARIF.TARIF
     TO ASK 
   END SELECT 
 ELSE 
   SELECT ;
     WHERE FondsKZ.TARIF = "j"
     ORDER REPORT TARIF.TARIF
     TO ASK 
   END SELECT 
 END IF 
ErrTARIFREP: 
 ON ERROR GOTO ErrorHandler
 END SUB 


SUB VTarifIntro()
 MOUSE OFF 
 FILE "tarif"
 INDEX Tarif.tarif
 SELECT FIRST 
 FORM 
 END SUB 
 
SUB MNVTarif()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
FUNCTION GetCodeTarif%(prompt%,codevp%)
 DIM TARIF$( RECCOUNT ("TARIF") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 _pos% = CodeTARIF.TARIF
 FILE "TARIF"
 INDEX TARIF.TARIF
 SELECT FIRST 
 TARIF$(0) = "<keine Zuordnung>" + SPACE$ (150) + "000000"
 a% = 1
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("TARIF")
   IF codevp% > 0 THEN 
     IF codevp.tarif = codevp% THEN 
       TARIF$(a%) = TARIF.TARIF + SPACE$ (150) + STR$ (CodeTARIF.TARIF,"000000")
       IF CodeTARIF.TARIF = prompt% THEN prompt$ = TARIF$(a%)
       a% = a% + 1
     END IF 
   ELSE 
     TARIF$(a%) = TARIF.TARIF + SPACE$ (150) + STR$ (CodeTARIF.TARIF,"000000")
     IF CodeTARIF.TARIF = prompt% THEN prompt$ = TARIF$(a%)
     a% = a% + 1
   END IF 
   SELECT NEXT 
 WEND 
TarAusw1: 
 CREATE DIALOG "MASUCH",0,0,390,264,"TarifÅbersicht","MS Sans Serif",8
 ADD DIALOG "MASUCH",4,0,0,390,237,0,""
 ADD DIALOG "MASUCH",9,9,11,21,21,2
 ADD DIALOG "MASUCH",5,37,11,151,9,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
 ADD DIALOG "MASUCH",7,27,27,345,201,2,2,TARIF$,Auswahl$,prompt$
 ADD DIALOG "MASUCH",1,40,245,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,97,245,55,15,0,"&Abbrechen",0,0
 ADD DIALOG "MASUCH",1,155,245,135,15,0,"&zum ausgewÑhlten Tarif springen",2,2
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 IF req% > 0 THEN 
   GetCodeTarif% = VAL ( RIGHT$ (Auswahl$(0),6))
   _pos% = GetCodeTarif%
   IF req% = 2 AND GetCodeTarif% > 0 THEN 
     GCodeTarif% = GetCodeTarif%
     prompt$ = Auswahl$(0)
     CALL Tarife()
     GCodeTarif% = 0
     GOTO TarAusw1
   END IF 
 ELSE 
   GetCodeTarif% = 0
 END IF 
 SELECT KEY _pos% FILE "TARIF" INDEX CodeTARIF.TARIF
 FILE cfile$
 GCodeTarif% = 0
 END FUNCTION 
 
SUB TFormelAusw()
 fb$ = TRIM$ ( LTRIM$ (FormelBewertung.tarif))
 fb2$ = TRIM$ ( LTRIM$ (FormelBewertun2.tarif))
 fv$ = TRIM$ ( LTRIM$ (FormelVolumen.tarif))
 fs$ = TRIM$ ( LTRIM$ (FormelSRDauer.tarif))
 ft$ = TRIM$ ( LTRIM$ (FormelTarif.tarif))
 FOR i% = 1 TO LEN (fb$)
   IF MID$ (fb$,i%,1) <> "" THEN fb1$ = fb1$ + MID$ (fb$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (fb2$)
   IF MID$ (fb2$,i%,1) <> "" THEN fb1a$ = fb1a$ + MID$ (fb2$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (fv$)
   IF MID$ (fv$,i%,1) <> "" THEN fv1$ = fv1$ + MID$ (fv$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (fs$)
   IF MID$ (fs$,i%,1) <> "" THEN fs1$ = fs1$ + MID$ (fs$,i%,1)
 NEXT i%
 FOR i% = 1 TO LEN (ft$)
   IF MID$ (ft$,i%,1) <> "" THEN ft1$ = ft1$ + MID$ (ft$,i%,1)
 NEXT i%
 
 fbew.tarif = ""
 start% = 0
 ende% = 0
 IF fb1$ <> "" THEN 
   pos% = 1
tfbanf: 
   FOR i% = pos% TO LEN (fb1$)
     SELECT CASE MID$ (fb1$,i%,1)
     CASE "("
       kl% = kl% + 1
       fbew.tarif = fbew.tarif + MID$ (fb1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fbew.tarif = fbew.tarif + MID$ (fb1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fb1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fbew.tarif = fbew.tarif + MID$ (fb1$,i%,1)
       pos% = i%
     CASE ","
       fbew.tarif = fbew.tarif + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
TFBewCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fb1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fbew.tarif = fbew.tarif + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fbew.tarif = fbew.tarif + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fbew.tarif = fbew.tarif + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fbew.tarif = fbew.tarif + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fbew.tarif = fbew.tarif + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fbew.tarif = fbew.tarif + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fbew.tarif = fbew.tarif + "nettobeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fbew.tarif = fbew.tarif + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fbew.tarif = fbew.tarif + MID$ (fb1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fb1$) THEN GOTO tfbanf 
   ff$ = fbew.tarif
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
TFBewEnde: 
 END IF 
 





 fbew2.tarif = ""
 start% = 0
 ende% = 0
 IF fb1a$ <> "" THEN 
   pos% = 1
tfbanf2: 
   FOR i% = pos% TO LEN (fb1a$)
     SELECT CASE MID$ (fb1a$,i%,1)
     CASE "("
       kl% = kl% + 1
       fbew2.tarif = fbew2.tarif + MID$ (fb1a$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fbew2.tarif = fbew2.tarif + MID$ (fb1a$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fb1a$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fbew2.tarif = fbew2.tarif + MID$ (fb1a$,i%,1)
       pos% = i%
     CASE ","
       fbew2.tarif = fbew2.tarif + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
 
TFBewCreate2: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fb1a$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fbew2.tarif = fbew2.tarif + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fbew2.tarif = fbew2.tarif + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fbew2.tarif = fbew2.tarif + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fbew2.tarif = fbew2.tarif + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fbew2.tarif = fbew2.tarif + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fbew2.tarif = fbew2.tarif + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fbew2.tarif = fbew2.tarif + "nettobeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fbew2.tarif = fbew2.tarif + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fbew.tarif = fbew.tarif + MID$ (fb1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fb1a$) THEN GOTO tfbanf2 
   ff$ = fbew2.tarif
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
TFBewEnde2: 
 END IF 





 fvol.tarif = ""
 start% = 0
 ende% = 0
 IF fv1$ <> "" THEN 
   pos% = 1
Tfvol: 
   FOR i% = pos% TO LEN (fv1$)
     SELECT CASE MID$ (fv1$,i%,1)
     CASE "("
       kl% = kl% + 1
       fvol.tarif = fvol.tarif + MID$ (fv1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fvol.tarif = fvol.tarif + MID$ (fv1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fv1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fvol.tarif = fvol.tarif + MID$ (fv1$,i%,1)
       pos% = i%
     CASE ","
       fvol.tarif = fvol.tarif + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
TFVolCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fv1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fvol.tarif = fvol.tarif + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fvol.tarif = fvol.tarif + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fvol.tarif = fvol.tarif + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fvol.tarif = fvol.tarif + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fvol.tarif = fvol.tarif + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fvol.tarif = fvol.tarif + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fvol.tarif = fvol.tarif + "NettoBeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fvol.tarif = fvol.tarif + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fvol.tarif = fvol.tarif + MID$ (fv1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fv1$) THEN GOTO Tfvol 
   ff$ = fvol.tarif
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
TFVolEnde: 
 END IF 
 
 fsrd.tarif = ""
 start% = 0
 ende% = 0
 IF fs1$ <> "" THEN 
   pos% = 1
Tfsranf: 
   FOR i% = pos% TO LEN (fs1$)
     SELECT CASE MID$ (fs1$,i%,1)
     CASE "("
       kl% = kl% + 1
       fsrd.tarif = fsrd.tarif + MID$ (fs1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       fsrd.tarif = fsrd.tarif + MID$ (fs1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (fs1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       fsrd.tarif = fsrd.tarif + MID$ (fs1$,i%,1)
       pos% = i%
     CASE ","
       fsrd.tarif = fsrd.tarif + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
TFsrCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (fs1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       fsrd.tarif = fsrd.tarif + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       fsrd.tarif = fsrd.tarif + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       fsrd.tarif = fsrd.tarif + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       fsrd.tarif = fsrd.tarif + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       fsrd.tarif = fsrd.tarif + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       fsrd.tarif = fsrd.tarif + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       fsrd.tarif = fsrd.tarif + "NettoBeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       fsrd.tarif = fsrd.tarif + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM fsrd.tarif = fsrd.tarif + MID$ (fs1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (fs1$) THEN GOTO Tfsranf 
   ff$ = fsrd.tarif
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
TFsrEnde: 
 END IF 
 
 ftar.tarif = ""
 start% = 0
 ende% = 0
 IF ft1$ <> "" THEN 
   pos% = 1
Tftanf: 
   FOR i% = pos% TO LEN (ft1$)
     SELECT CASE MID$ (ft1$,i%,1)
     CASE "("
       kl% = kl% + 1
       ftar.tarif = ftar.tarif + MID$ (ft1$,i%,1)
       pos% = i%
     CASE ")"
       kl% = kl% - 1
       ftar.tarif = ftar.tarif + MID$ (ft1$,i%,1)
       pos% = i%
     CASE "<"
       start% = i%
     CASE ">"
       ende% = i%
       pos% = i% + 1
       i% = LEN (ft1$) + 1
     CASE "+","-","*","/","0","1","2","3","4","5","6","7","8","9"
       ftar.tarif = ftar.tarif + MID$ (ft1$,i%,1)
       pos% = i%
     CASE ","
       ftar.tarif = ftar.tarif + "."
       pos% = i% + 1
     CASE ELSE 
       pos% = i%
     END SELECT 
   NEXT i%
   
 
TFtCreate: 
   IF start% > 0 THEN 
     test$ = UCASE$ ( MID$ (ft1$,start%,ende% - start% + 1))
     SELECT CASE UCASE$ (test$)
     CASE "<BEITRAG>"
       ftar.tarif = ftar.tarif + "Beitrag.kvertrag "
     CASE "<BEITRAG*LAUFZEIT>"
       ftar.tarif = ftar.tarif + "Beitrag.kvertrag * VS_Dauer.kvertrag "
     CASE "<LAUFZEIT>"
       ftar.tarif = ftar.tarif + "VS_Dauer.kvertrag "
     CASE "<VERTRAGSSUMME>"
       ftar.tarif = ftar.tarif + "VSumme.kvertrag "
     CASE "<JAHRESBEITRAG>"
       ftar.tarif = ftar.tarif + "Beitrag.kvertrag * ZW.kvertrag "
     CASE "<ZAHLWEISE>"
       ftar.tarif = ftar.tarif + "zw.kvertrag "
     CASE "<NETTOBEITRAG>"
       ftar.tarif = ftar.tarif + "NettoBeitrag.kvertrag "
     CASE "<BEITRAGZAHLUNGSDAUER>"
       ftar.tarif = ftar.tarif + "DBeitrZahlung.kvertrag "
   END SELECT 
   REM ftar.tarif = ftar.tarif + MID$ (ft1$,start%,ende% - start%)
   start% = 0
   ende% = 0
   END IF 
   IF pos% < LEN (ft1$) THEN GOTO Tftanf 
   ff$ = ftar.tarif
   REM CALL Fehler(ff$,"")
   IF kl% <> 0 THEN 
     CALL Fehler("PrÅfen Sie die Formel! Die Anzahl der geîffneten Klammer ist ungleich der Anzahl","der schlie·enden Klammern!")
   END IF 
TFtEnde: 
 END IF 
 
 
 END SUB 
 




 ' Rechnungen erzeugen - Maklerversion
 ' 30.10.2000
 ' codeink%=0 -> alle VertrÑge, codeink%=wert -> nur diesen Vertrag

SUB CreateRech(Codekuko%)
     DIM dlg1 AS Dialog
     DIM control AS DialogControl 
          REM Rechnungen drucken
         REM erledigtJaNein.KUKTO <> "j" AND gedruckt.KUKTO <> "j" AND dtaus.KUKTO <> "j"
         IF Codekuko% < 1 THEN 
           aa$ = " Nachdem der Rechnungsserienbrief erstellt wurde, erhalten Sie die Mîglichkeit zu entscheiden, ob die Checkbox -Als Rechnung gedruckt?- automatisch angekreuzt werden soll!"
           bb$ = "Es werden jetzt fÅr alle DatensÑtze, fÅr die die Checkboxen -Als Rechnung gedruckt?- /  -DTAUS erstellt- noch nicht angekreuzt sind, ein Rechnungsserienbrief " + GMACodeDir$ + "RECHDRU1.DBF bzw. Rechdru1.XLS) erstellt!"
           CALL Fehler(bb$,aa$)
         ELSE 
           CALL Fehler("Es wird jetzt eine Rechnung erstellt unter zur Hilfenahme der Serienbrieffunktion!","")
         END IF 
         SELECT WHERE FILE "kukto"
         FORM 
         REQUEST "Mîchten Sie den Rechnungsdruck jetzt fortsetzen?","",130,req%
         IF req% = 1 THEN 
rechanf230520021: 
           CREATE DIALOG "SETPROVI",0,0,201,132,title$,"MS Sans Serif",8
           ADD DIALOG "SETPROVI",4,0,0,201,109,0,""
           ADD DIALOG "SETPROVI",9,7,10,20,20,2
           ADD DIALOG "SETPROVI",5,30,11,162,26,0,"Bitte geben Sie an, fÅr welchen Zeitraum die Rechnungen erzeugt werden sollen werden soll."
           ADD DIALOG "SETPROVI",5,30,42,56,8,0,"Zeitraum von:"
           ADD DIALOG "SETPROVI",5,30,57,56,8,0,"Zeitraum bis:"
           ADD DIALOG "SETPROVI",6,90,40,52,12,0,0,vondat$,10
           ADD DIALOG "SETPROVI",6,90,55,52,12,0,0,bisdat$,10
           ADD DIALOG "SETPROVI",1,70,113,55,15,1,"&OK",1,1
           REM ADD DIALOG "SETPROVI",1,100,113,55,15,0,"&Abbrechen",0,0
           DIALOG "SETPROVI",req%
           REMOVE DIALOG ALL 
           IF req% = 1 THEN 
             IF VAL (vondat$) < 1 THEN 
               vondat$ = "01.01.1990"
             END IF 
             IF VAL (bisdat$) < 1 THEN 
               bisdat$ = "31.12.2199"
             END IF 
             IF DateOK%(vondat$) THEN 
             ELSE 
               GOTO rechanf230520021
             END IF 
             IF DateOK%(bisdat$) THEN 
             ELSE 
               GOTO rechanf230520021
             END IF 
           ELSE 
             vondat$ = "01.01.1990"
             bisdat$ = "31.12.2199"
           END IF 
 
           MOUSE OFF 
           CALL DFile(3,"redru" + _fpw$)
           REMOVE FROM FILE "redru"
           FILE "KUKTO"
           IF Codekuko% < 1 THEN 
             INDEX nachname.kukto
             SELECT FIRST 
             t11$ = "ob Sie nur diejenigen drucken, bei denen Soll<>Haben   UND   erledigt<>j   UND   Rechnung wurde noch nicht gedruckt   gekennzeichnet ist"
             CALL Fehler("Sie erhalten jetzt die Mîglichkeit zu entscheiden, ob Sie alle DatensÑtze drucken zu denen noch keine Rechnung gedruckt wurde oder",t11$)
             optemail% = 2
             Superbase.Dialogs.Add("Dialogname")
             SET dlg1 = Superbase.Dialogs.Dialogname
             dlg1.Move(0,0,300,75)
             dlg1.Caption = "Rechnungsdruck"
             dlg1.FontName = "MS Sans Serif"
             dlg1.FontSize = 8
 
             SET control = dlg1.Add("DialogFrame1","DialogFrame")
             control.Move(2,8,300,44)
             control.Caption = " WÑhlen Sie eine Option "
 
             SET control = dlg1.Add("DialogOptionButton1","DialogOptionButton")
             control.Move(6,20,264,10)
             control.Caption = "alle zu denen keine Rechnung gedruckt wurde"
             control.Bind("optemail%")
             control.ValueOn = 1
 
             SET control = dlg1.Add("DialogOptionButton2","DialogOptionButton")
             control.Move(6,32,264,10)
             control.Caption = "nur die mit Soll<>Haben und erledigt <>j und Rechnung noch nicht gedruckt"
             control.Bind("optemail%")
             control.ValueOn = 2
 
 
 
             SET control = dlg1.Add("DialogCommandButton1","DialogCommandButton")
             control.Move(59,54,43,16)
             control.Default = 1
             control.Caption = "OK"
             control.ReturnValue = 1
 
             SET control = dlg1.Add("DialogCommandButton2","DialogCommandButton")
             control.Move(105,54,42,16)
             control.Caption = "Abbruch"
             control.ReturnValue = 0
 
             DIALOG "Dialogname",reqemail%
             REMOVE DIALOG "Dialogname"


             WHILE NOT EOF ("kukto")
               IF optemail% = 1 AND gedruckt.KUKTO <> "j" AND FÑlligkeit.kukto >= vondat$ AND FÑlligkeit.kukto <= bisdat$ THEN 
                 IF EXISTS (codeku.kukto,Codeku.GAdrDat$) THEN 
                   SELECT KEY codeku.kukto FILE GADRDat$ INDEX Codeku.GAdrDat$
                   BLANK FILE "redru"
                   Anrede.redru = Anrede.KUKTO
                   Titel.redru = Titel.KUKTO
                   nachname.redru = nachname.KUKTO
                   vorname.redru = Vorname.KUKTO
                   plz.redru = PLZ.KUKTO
                   ort.redru = Ort.KUKTO
                   stra·e.redru = Stra·e.KUKTO
                   k1Bank.redru = K1Bank.KUKTO
                   k1Konto.redru = K1Konto.KUKTO
                   k1blz.redru = K1BLZ.KUKTO
                   vs_nr.redru = VS_NR.KUKTO
                   gesellschaft.redru = Gesellschaft.KUKTO
                   sparte.redru = Sparte.KUKTO
                   beitrag.redru = Beitrag.KUKTO
                   fÑlligkeit.redru = FÑlligkeit.KUKTO
                   zw.redru = ZW.KUKTO
                   zahlart.redru = Zahlart.KUKTO
                   Postanschrift.redru = Postanschrift.GAdrDat$
                   STORE FILE "redru"
                   UNLOCK CURRENT FILE "redru"
                 END IF 
               END IF 
               IF optemail% = 2 AND gedruckt.KUKTO <> "j" AND beitrag.kukto <> gezBetrag.kukto AND erledigtJaNein.KUKTO <> "j" AND FÑlligkeit.kukto >= vondat$ AND FÑlligkeit.kukto <= bisdat$ THEN 
                 IF EXISTS (codeku.kukto,Codeku.GAdrDat$) THEN 
                   SELECT KEY codeku.kukto FILE GADRDat$ INDEX Codeku.GAdrDat$
                   BLANK FILE "redru"
                   Anrede.redru = Anrede.KUKTO
                   Titel.redru = Titel.KUKTO
                   nachname.redru = nachname.KUKTO
                   vorname.redru = Vorname.KUKTO
                   plz.redru = PLZ.KUKTO
                   ort.redru = Ort.KUKTO
                   stra·e.redru = Stra·e.KUKTO
                   k1Bank.redru = K1Bank.KUKTO
                   k1Konto.redru = K1Konto.KUKTO
                   k1blz.redru = K1BLZ.KUKTO
                   vs_nr.redru = VS_NR.KUKTO
                   gesellschaft.redru = Gesellschaft.KUKTO
                   sparte.redru = Sparte.KUKTO
                   beitrag.redru = Beitrag.KUKTO
                   fÑlligkeit.redru = FÑlligkeit.KUKTO
                   zw.redru = ZW.KUKTO
                   zahlart.redru = Zahlart.KUKTO
                   Postanschrift.redru = Postanschrift.GAdrDat$
                   STORE FILE "redru"
                   UNLOCK CURRENT FILE "redru"
                 END IF 
               END IF 
               SELECT NEXT FILE "KUKTO" INDEX nachname.kukto
             WEND 
             'SELECT Anrede.KUKTO,Titel.KUKTO,nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO,K1Bank.KUKTO,K1Konto.KUKTO,
             'K1BLZ.KUKTO,VS_NR.KUKTO,Gesellschaft.KUKTO,Sparte.KUKTO,Beitrag.KUKTO,FÑlligkeit.KUKTO,ZW.KUKTO,Zahlart.KUKTO,Postanschrift.GAdrDat$
             'REPORT 
             'WHERE gedruckt.KUKTO = "j" AND beitrag.kukto <> gezBetrag.kukto AND codeku.kukto = Codeku.GAdrDat$ AND erledigtJaNein.KUKTO <> "j" AND FÑlligkeit.kukto >= vondat$ AND FÑlligkeit.kukto <= bisdat$
             'ORDER REPORT nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO
             'TO FILE _ppath$ + "\REDRU"
           ELSE 
             'einzelne ZE
             'SELECT Anrede.KUKTO,Titel.KUKTO,nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO,K1Bank.KUKTO,K1Konto.KUKTO,
             'K1BLZ.KUKTO,VS_NR.KUKTO,Gesellschaft.KUKTO,Sparte.KUKTO,Beitrag.KUKTO,FÑlligkeit.KUKTO,ZW.KUKTO,Zahlart.KUKTO,Postanschrift.GAdrDat$
             'REPORT 
             'WHERE Codekuko.kukto = Codekuko%
             'ORDER REPORT nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO
             'TO FILE _ppath$ + "\REDRU"
             SELECT FIRST FILE "KUKTO" INDEX Codekuko.kukto
             SELECT KEY Codekuko% FILE "KUKTO" INDEX Codekuko.kukto
             BLANK FILE "redru"
             Anrede.redru = Anrede.KUKTO
             Titel.redru = Titel.KUKTO
             nachname.redru = nachname.KUKTO
             vorname.redru = Vorname.KUKTO
             plz.redru = PLZ.KUKTO
             ort.redru = Ort.KUKTO
             stra·e.redru = Stra·e.KUKTO
             k1Bank.redru = K1Bank.KUKTO
             k1Konto.redru = K1Konto.KUKTO
             k1blz.redru = K1BLZ.KUKTO
             vs_nr.redru = VS_NR.KUKTO
             gesellschaft.redru = Gesellschaft.KUKTO
             sparte.redru = Sparte.KUKTO
             beitrag.redru = Beitrag.KUKTO
             fÑlligkeit.redru = FÑlligkeit.KUKTO
             zw.redru = ZW.KUKTO
             zahlart.redru = Zahlart.KUKTO
             Postanschrift.redru = Postanschrift.GAdrDat$
             STORE FILE "redru"
             UNLOCK CURRENT FILE "redru"
         END IF 
           CALL FldUpdate22("Beitrag","NUM;,999999999.00")
           FILE "REDRU"
           IF EXISTS (GMACodeDir$ + "rechdru1.dbf") THEN DELETE GMACodeDir$ + "rechdru1.dbf"
           Superbase.Converters.SBF.SourceFormat = "Superbase"
           Superbase.Converters.SBF.SourceFile = "REDRU"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.DBF.DestFormat = "dBase III+ / IV"
           Superbase.Converters.DBF.DestFile = GMACodeDir$ + "RECHDRU1.DBF"
           Superbase.Converters.DBF.Convert(Superbase.Converters.SBF)
 
           IF EXISTS (GMACodeDir$ + "rechdru1.xls") THEN DELETE GMACodeDir$ + "rechdru1.xls"
           Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
           Superbase.Converters.SBF.SourceFile = "REDRU"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = GMACodeDir$ + "rechdru1.xls"
           Superbase.Converters.XLS.StartRow = 2
           Superbase.Converters.XLS.StartCol = 1
           Superbase.Converters.XLS.EndRow = - 1
           Superbase.Converters.XLS.EndCol = - 1
           Superbase.Converters.XLS.UseLabels = - 1
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
           CALL Fehler("Rechnugsseriendruckdateien " + GMACodeDir$ + "RECHDRU1.DBF und " + GMACodeDir$ + "rechdru1.xls","wurden erfolgreich erstellt!")
           reser% = 1
           MOUSE ON 
           CALL DOKUMENT("allgemeine Schreiben",0)
           reser% = 0
           REQUEST "Mîchten Sie jetzt bei den DatensÑtzen der gedruckten Rechnungen","das Feld -Als Rechnung gedruckt- automatisch ankreuzen lassen?",130,req1%
           IF req1% = 1 THEN 
             MOUSE OFF 
             IF Codekuko% < 1 THEN 
               FILE "kukto"
               INDEX gedruckt.kukto
               SELECT FIRST LOCK 
               SELECT KEY "n" LOCK FILE "Kukto" INDEX gedruckt.kukto
               i% = 0
               j% = 0
               d% = RECCOUNT ("kukto")
               WHILE NOT EOF ("kukto")
                 i% = i% + 1
                 IF gedruckt.KUKTO <> "j" AND dtaus.KUKTO <> "j" THEN 
                   gedruckt.kukto = "j"
                   DatumDruck.kukto = TODAY 
                   j% = j% + 1
                   CALL QuickStore("Kukto")
                 END IF 
                 SELECT NEXT LOCK 
                 SET STATUS "DatensÑtze berabeitet: " + STR$ (i%,",9999999.") + " davon gestzt: " + STR$ (j%,",9999999.") + " von insgesamt: " + STR$ (d%,",9999999.")
               WEND 
             ELSE 
               'einzelne Rechnung drucken
               FILE "kukto"
               INDEX Codekuko.kukto
               SELECT FIRST 
               SELECT KEY Codekuko% LOCK FILE "Kukto" INDEX Codekuko.kukto
               gedruckt.kukto = "j"
               DatumDruck.kukto = TODAY 
               CALL QuickStore("Kukto")
             END IF 
             MOUSE ON 
           END IF 
         END IF 
         resu% = 0
 END SUB 


 ' Mahnungen erzeugen - Maklerversion
 ' 30.10.2000
 ' Codekuko%=0 -> alle VertrÑge/Rechnungen
 ' Codekuko%<> 0 -> nur aktuellen Vertrag/Rechnung

SUB CreateMahn(Codekuko%)
         REM mAHNUNGEN drucken
         REM erledigtJaNein.KUKTO <> "j" AND gedruckt.KUKTO = "j" AND dtaus.KUKTO <> "j"
         IF Codekuko% < 1 THEN 
         aa$ = " Nachdem der Mahnungsserienbrief erstellt wurde, erhalten Sie die Mîglichkeit zu entscheiden, ob die Checkbox -Als Mahnung gedruckt?- automatisch angekreuzt werden soll!"
         t0$ = "ein Mahnungsserienbrief " + GMACodeDir$ + "MahnSer.DBF bzw. MahnSerX.XLS)erstellt !"
         bb$ = "Es werden jetzt fÅr alle DatensÑtze, fÅr die die Checkboxen <Rechnung gedruckt> angekreuzt sind und <Vorgang erledigt> nicht angekreuzt sind und die Differenz<>0 ist," + t0$
 
         CALL Fehler(bb$,aa$)
 
           CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
           ADD DIALOG "Konto1",9,6,7,24,22,2
           ADD DIALOG "Konto1",5,34,8,170,9,0,"Zeitraum:"
           ADD DIALOG "Konto1",4,34,14,176,5,0,""
           ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen FÑlligkeitszeitraum Sie die Mahnungen erzeugen mîchten."
           ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum FÑlligkeitszeitraum eintragen, werden alle DatensÑtze zwischen dem 01.01.1980 und heute berÅcksichtigt."
           ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
           ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
           ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
           ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
           ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
           REM ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
           DIALOG "Konto1",req%
           REMOVE DIALOG "Konto1"
           MOUSE ON 
           IF von$ = "" THEN vondat$ = "01.01.1990" ELSE vondat$ = von$
           IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
           SELECT WHERE FILE "kukto"
           FORM 
         ELSE 
           CALL Fehler("Es wird jetzt eine Mahnung erstellt unter zu Hilfenahme der Serienbrieffunktion!","")
           SELECT KEY Codekuko% LOCK FILE "Kukto" INDEX Codekuko.kukto
           mahnung.kukto = "n"
           MahnDruck.kukto = 0
           STORE FILE "Kukto"
         END IF 
         REQUEST "Mîchten Sie den Mahnungsdruck jetzt fortsetzen?","",130,req%
         IF req% = 1 THEN 
           CALL DFile(3,"redru" + _fpw$)
           REMOVE FROM FILE "redru"
           MOUSE OFF 
           FILE "KUKTO"
           REM  AND FÑlligkeit.kukto >= vondat$ AND FÑlligkeit.kukto <= bisdat$
           REM SET QUERY HEADING "",0,0
           IF Codekuko% < 1 THEN 
             INDEX nachname.kukto
             SELECT FIRST 
             WHILE NOT EOF ("kukto")
               IF gedruckt.KUKTO = "j" AND beitrag.kukto <> gezBetrag.kukto AND erledigtJaNein.KUKTO <> "j" AND FÑlligkeit.kukto >= vondat$ AND FÑlligkeit.kukto <= bisdat$ THEN 
                 IF EXISTS (codeku.kukto,Codeku.GAdrDat$) THEN 
                   SELECT KEY codeku.kukto FILE GADRDat$ INDEX Codeku.GAdrDat$
                   BLANK FILE "redru"
                   Anrede.redru = Anrede.KUKTO
                   Titel.redru = Titel.KUKTO
                   nachname.redru = nachname.KUKTO
                   vorname.redru = Vorname.KUKTO
                   plz.redru = PLZ.KUKTO
                   ort.redru = Ort.KUKTO
                   stra·e.redru = Stra·e.KUKTO
                   k1Bank.redru = K1Bank.KUKTO
                   k1Konto.redru = K1Konto.KUKTO
                   k1blz.redru = K1BLZ.KUKTO
                   vs_nr.redru = VS_NR.KUKTO
                   gesellschaft.redru = Gesellschaft.KUKTO
                   sparte.redru = Sparte.KUKTO
                   beitrag.redru = Beitrag.KUKTO
                   fÑlligkeit.redru = FÑlligkeit.KUKTO
                   zw.redru = ZW.KUKTO
                   zahlart.redru = Zahlart.KUKTO
                   Postanschrift.redru = Postanschrift.GAdrDat$
                   STORE FILE "redru"
                   UNLOCK CURRENT FILE "redru"
                 END IF 
               END IF 
               SELECT NEXT FILE "KUKTO" INDEX nachname.kukto
             WEND 
             'SELECT Anrede.KUKTO,Titel.KUKTO,nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO,K1Bank.KUKTO,K1Konto.KUKTO,
             'K1BLZ.KUKTO,VS_NR.KUKTO,Gesellschaft.KUKTO,Sparte.KUKTO,Beitrag.KUKTO,FÑlligkeit.KUKTO,ZW.KUKTO,Zahlart.KUKTO,Postanschrift.GAdrDat$
             'REPORT 
             'WHERE gedruckt.KUKTO = "j" AND beitrag.kukto <> gezBetrag.kukto AND codeku.kukto = Codeku.GAdrDat$ AND erledigtJaNein.KUKTO <> "j" AND FÑlligkeit.kukto >= vondat$ AND FÑlligkeit.kukto <= bisdat$
             'ORDER REPORT nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO
             'TO FILE _ppath$ + "\REDRU"
           ELSE 
             'einzelne ZE
             'SELECT Anrede.KUKTO,Titel.KUKTO,nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO,K1Bank.KUKTO,K1Konto.KUKTO,
             'K1BLZ.KUKTO,VS_NR.KUKTO,Gesellschaft.KUKTO,Sparte.KUKTO,Beitrag.KUKTO,FÑlligkeit.KUKTO,ZW.KUKTO,Zahlart.KUKTO,Postanschrift.GAdrDat$
             'REPORT 
             'WHERE Codekuko.kukto = Codekuko%
             'ORDER REPORT nachname.KUKTO,Vorname.KUKTO,PLZ.KUKTO,Ort.KUKTO,Stra·e.KUKTO
             'TO FILE _ppath$ + "\REDRU"
             SELECT FIRST FILE "KUKTO" INDEX Codekuko.kukto
             SELECT KEY Codekuko% FILE "KUKTO" INDEX Codekuko.kukto
             BLANK FILE "redru"
             Anrede.redru = Anrede.KUKTO
             Titel.redru = Titel.KUKTO
             nachname.redru = nachname.KUKTO
             vorname.redru = Vorname.KUKTO
             plz.redru = PLZ.KUKTO
             ort.redru = Ort.KUKTO
             stra·e.redru = Stra·e.KUKTO
             k1Bank.redru = K1Bank.KUKTO
             k1Konto.redru = K1Konto.KUKTO
             k1blz.redru = K1BLZ.KUKTO
             vs_nr.redru = VS_NR.KUKTO
             gesellschaft.redru = Gesellschaft.KUKTO
             sparte.redru = Sparte.KUKTO
             beitrag.redru = Beitrag.KUKTO
             fÑlligkeit.redru = FÑlligkeit.KUKTO
             zw.redru = ZW.KUKTO
             zahlart.redru = Zahlart.KUKTO
             Postanschrift.redru = Postanschrift.GAdrDat$
             STORE FILE "redru"
             UNLOCK CURRENT FILE "redru"
           END IF 
           CALL FldUpdate22("Beitrag","NUM;,999999999.00")
           FILE "REDRU"
           IF EXISTS (GMACodeDir$ + "Mahnser.dbf") THEN DELETE GMACodeDir$ + "Mahnser.dbf"
           Superbase.Converters.SBF.SourceFormat = "Superbase"
           Superbase.Converters.SBF.SourceFile = "REDRU"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.DBF.DestFormat = "dBase III+ / IV"
           Superbase.Converters.DBF.DestFile = GMACodeDir$ + "Mahnser.DBF"
           Superbase.Converters.DBF.Convert(Superbase.Converters.SBF)
 
           IF EXISTS (GMACodeDir$ + "MahnserX.xls") THEN DELETE GMACodeDir$ + "MahnserX.xls"
           Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
           Superbase.Converters.SBF.SourceFile = "REDRU"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = GMACodeDir$ + "MahnserX.xls"
           Superbase.Converters.XLS.StartRow = 2
           Superbase.Converters.XLS.StartCol = 1
           Superbase.Converters.XLS.EndRow = - 1
           Superbase.Converters.XLS.EndCol = - 1
           Superbase.Converters.XLS.UseLabels = - 1
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
           CALL Fehler("Mahnungsseriendruckdateien " + GMACodeDir$ + "Mahnser.DBF und " + GMACodeDir$ + "MahnserX.xls","wurden erfolgreich erstellt!")
           mahnSER% = 1
           MOUSE ON 
           CALL DOKUMENT("allgemeine Schreiben",0)
           mahnSer% = 0
           IF Codekuko% < 1 THEN REQUEST "Mîchten Sie jetzt bei den DatensÑtzen der gedruckten Mahnungen","das Feld -Als Mahnung gedruckt- automatisch ankreuzen lassen?",130,req1%
           IF Codekuko% > 0 THEN REQUEST "Mîchten Sie jetzt bei dem Datensatz der gedruckten Mahnungen","das Feld -Als Mahnung gedruckt- automatisch ankreuzen lassen?",130,req1%
           IF req1% = 1 THEN 
             IF Codekuko% < 1 THEN 
               FILE "kukto"
               INDEX gedruckt.kukto
               SELECT FIRST 
               SELECT KEY "j" LOCK FILE "Kukto" INDEX gedruckt.kukto
               i% = 0
               j% = 0
               MOUSE OFF 
               d% = RECCOUNT ("kukto")
               WHILE NOT EOF ("kukto")
                 i% = i% + 1
                 IF gedruckt.KUKTO = "j" AND erledigtJaNein.KUKTO <> "j" AND FÑlligkeit.kukto >= vondat$ AND FÑlligkeit.kukto <= bisdat$ THEN 
                   mahnung.kukto = "j"
                   MahnDruck.kukto = TODAY 
                   j% = j% + 1
                   CALL QuickStore("Kukto")
                 END IF 
                 SELECT NEXT LOCK 
                 SET STATUS "DatensÑtze berabeitet: " + STR$ (i%,",9999999.") + " davon gestzt: " + STR$ (j%,",9999999.") + " von insgesamt: " + STR$ (d%,",9999999.")
               WEND 
             ELSE 
               FILE "kukto"
               INDEX Codekuko.kukto
               SELECT FIRST 
               SELECT KEY Codekuko% LOCK FILE "Kukto" INDEX Codekuko.kukto
               mahnung.kukto = "j"
               MahnDruck.kukto = TODAY 
               CALL QuickStore("Kukto")
             END IF 
             MOUSE ON 
           END IF 
         END IF 
         mahnser% = 0
         resu% = 0
         CALL KuKtoSuch()
 END SUB 


 REM Maklerbuchungen, d.h. ausrechnen wieviel Gelder an die einzelnen Gesellschaften
 REM auf Grund des Kundeninkasso abgefÅhrt werden mÅssen

SUB MaklerInk()
 IF disabled%("BUCHUNG") THEN END SUB 
 IF title$ LIKE "*Agentur*" THEN 
   CALL Fehler("Diese Funktion kann in der Agenturvariante nicht genutzt werden!","")
   END SUB 
 END IF 
 SET STATUS "Inkasso"
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF OPEN ("adrtemp") THEN 
   REM CLOSE FILE "ADRTEMP"
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"KGEADR" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"GEADRUMS" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"DTAUS" + _fpw$)
 CALL DFile(3,"INKSTAMM" + _fpw$)
 CALL DFile(3,"VPRODUKT" + _fpw$)
 CALL DFile(3,"BUCHGES" + _fpw$)
 CALL DFile(3,"BUCHGEAD" + _fpw$)

 REM CALL Fehler("MAKLERBUCHUNGEN","")


 FILE "BUCHGEAD"
 INDEX InkDatum.BUCHGEAD
 SELECT LAST 
 codeink1% = codeink.BUCHGEAD
 datlastink$ = DATE$ (inkDatum,"0d.mm.yyyy")
 IF LTRIM$ (datlastink$) = "" THEN datlastink$ = "keine Angaben"
 
 REDIM AdrFound$( RECCOUNT ("BUCHGEAD"),1)
 REDIM AdrFound$( RECCOUNT ("BUCHGEAD"))
 b% = RECCOUNT ("BUCHGEAD")
 a% = 0
 SELECT LAST 
 WHILE NOT EOF ("BUCHGEAD")
 d1$ = DATE$ (inkDatum,"0d.mm.yyyy")
 AdrFound$(a%) = "Datum: " + d1$ + " HF: " + STR$ (HauptfÑlligkeit,"00") + " Anzahl:" + STR$ (Anzahl,"00") + " - erstellt am: " + DATE$ (wannerstellt,"0d.mm.yyyy") + SPACE$ (120) + STR$ (codeink,"000000")
   a% = a% + 1
   SELECT PREVIOUS 
 WEND 
 
 LAuswahl$ = AdrFound$(0)
 REM LAuswahl1$(0) = LAuswahl$
 
 REM 041199
 CREATE DIALOG "INK",0,0,390,192,"Inkasso","MS Sans Serif",8
 ADD DIALOG "INK",4,0,0,389,53,0,""
 ADD DIALOG "INK",9,9,12,21,23,2
 var1$ = "Wollen Sie eine bereits durchgefÅhrte Gesellschaftberechnung zurÅcksetzen und nochmals NEU generieren lassen? Wenn JA wÑhlen Sie das Inkasso aus der nachstehenden Liste aus und betÑtigen Sie den Button JA!"
 var2$ = " Wenn Sie eine NEUE Gesellschaftberechnung durchfÅhren wollen dann NEIN drÅcken!"
 var3$ = var1$ + var2$
 ADD DIALOG "INK",5,38,12,344,40,0,var3$
 
 ADD DIALOG "INK",5,38,37,113,10,0,"letzte Gesellschaftberechnung war:"
 ADD DIALOG "INK",5,143,37,51,11,0,datlastink$
 ADD DIALOG "INK",7,5,55,380,120,0,2,AdrFound$,Lauswahl1$,AdrFound$(0)
 ADD DIALOG "INK",1,34,177,25,14,0,"&NEIN",1,1
 ADD DIALOG "INK",1,63,177,25,14,0,"&JA",2,2
 ADD DIALOG "INK",1,92,177,75,14,1,"&Abbrechen",0,0
 
 DIALOG "INK",req%
 REMOVE DIALOG "INK"
 
 
 LAuswahl$ = LAuswahl1$(0)
 codeinkgead% = VAL ( RIGHT$ (LAuswahl$,6))
 SELECT KEY codeinkgead% FILE "buchgead" INDEX codeink.buchgead
 Jahr1$ = STR$ ( YEAR (InkDatum.buchgead),"0000")
 Monat1$ = STR$ (HauptfÑlligkeit.buchgead,"00")

 IF req% = 0 THEN 
   REQUEST "Gesellschaftberechnung wurde abgebrochen!"
   END SUB 
 END IF 

 REM *** ein vîllig neues Inkasso durchfÅhren, ohnen die Kukto zurÅckzusetzen ***
 IF req% = 1 THEN 
   CalcDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
Mak1DIALOG: 
   CREATE DIALOG "INK1",0,0,191,122,"Gesellschaftsabrechnung","MS Sans Serif",8
   ADD DIALOG "INK1",4,0,0,191,98,0,""
   ADD DIALOG "INK1",9,9,12,21,23,2
   ADD DIALOG "INK1",5,38,12,144,30,0,"Bitte geben Sie ein, fÅr welchen Monat die Maklerbuchung durchgefÅhrt werden soll:"
   ADD DIALOG "INK1",5,38,45,80,10,0,"Monat:"
   ADD DIALOG "INK1",6,93,44,20,11,0,0,m%,2
   ADD DIALOG "INK1",5,35,63,55,10,0,"Abrechnungstag:"
   ADD DIALOG "INK1",6,93,63,51,11,0,0,CalcDate$,10
   ADD DIALOG "INK1",1,34,99,55,14,1,"&OK",1,1
   ADD DIALOG "INK1",1,92,99,95,14,0,"&Abrechnung Abbrechen",0,0
   DIALOG "INK1",req1%
   REMOVE DIALOG "INK1"
   IF req1% > 0 THEN 
     IF DateOK%(CalcDate$) THEN 
       
       IF m% < 0 OR m% > 12 THEN 
         CALL Fehler("Der Wertebereich fÅr den Monat mu· grî·er01 und kleiner 13 sein!","Bitte Eingabe wiederholen!")
         GOTO Mak1DIALOG 
       END IF 
     ELSE 
       GOTO Mak1DIALOG 
     END IF 
     m$ = STR$ (m%,"00")
     tt$ = "Gesellschaften abgerechnet wurden und bei denen die Checkbox <erledigt> gekennzeichnet ist!!!"
     CALL Fehler ("Jetzt wird die Buchung durchgefÅhrt, es gehen alle KundeninkassodatensÑtze ein, die noch nicht fÅr die ",tt$)
     REQUEST "BUCHUNG DURCHFöHREN?","",130,req140%
     IF req140% = 0 THEN END SUB 
     FILE "BUCHGEAD"
     INDEX codeink.BUCHGEAD
     SELECT LAST 
     mvorher% = HauptfÑlligkeit.BUCHGEAD
     IF mvorher% = m% THEN 
       b$ = "Wenn Sie jetzt eine NEUE Gesellschaftsabrechnung fÅr diesen Monat erstellen, wird die vorhergehende unwiederbringlich abgeschlossen und in NEUE Abrechnung gehen nur die Inkassodaten ein, die zwischenzeitlich neu eingegeben wurden!"
       CALL Fehler("Sie haben die Gesellschaftsabrechnung fÅr diesen Monat bereits durchgefÅhrt!",b$)
       REQUEST "ABRECHNUNG TROTZDEM DURCHFöHREN?","",130,req150%
       IF req150% = 0 THEN END SUB 
     END IF 
     
     BLANK FILE "BUCHGEAD"
     codeinkgead% = SER ("BUCHGEAD",1)
     codeink.BUCHGEAD = codeinkgead%
     InkDatum.BUCHGEAD = CalcDate$
     wannerstellt.BUCHGEAD = TODAY 
     Anzahl.BUCHGEAD = 1
     zero.BUCHGEAD = 0
     HauptfÑlligkeit.BUCHGEAD = m%
     Workstation.BUCHGEAD = Workstation%
     QWoNo.BUCHGEAD = STR$ (Workstation%,"000000") + STR$ (codeink.BUCHGEAD,"000000")
     RecStatus.BUCHGEAD = "c"
     STORE FILE "BUCHGEAD"
     CALL CreateLog()
     CALL WriteLog("")
     CALL WriteLog("=================================")
     CALL WriteLog("Erzeugung Inkassodaten vom " + DATE$ ( TODAY ,"0d.mm.yyyy") + " fÅr HauptfÑlligkeit: " + m$ + " / Inkasso vom: " + CalcDate$)
     CALL WriteLog("=================================")
     CALL WriteLog("")
MakBerech:   

     FILE "KUKTO"
     INDEX erlverr.kukto
     ixkuktoz% = FILEINFO ("KUKTO",1)
     DIM ixkukto$(ixkuktoz%)
     FILLARRAY ixkukto$,1


     IF RECCOUNT ("Kukto") > 0 THEN 
       SELECT KEY "jn" LOCK FILE "kukto" INDEX erlverr.kukto
     ELSE 
       SELECT LAST 
     END IF 
     i% = 0
     SumFirma% = 0
     SumGes% = 0
     WHILE NOT EOF ("kukto") AND erlverr.kukto = "jn"
       IF erlverr.kukto = "jn" THEN 
         SELECT KEY codevp.kukto FILE "Vprodukt" INDEX codevp.vprodukt
         IF provision.vprodukt > 0 THEN 
           i% = i% + 1
           SET STATUS STR$ (i%,"999999") + " DatensÑtze verarbeitet"
           BLANK FILE "Buchges"
           a% = CopyRecord%("KUKTO","BUCHGES")
           REM FOR j% = 0 TO ixkuktoz% - 1
             REM feld1$ = ixkukto$(j%) + ".buchges"
             REM feld2$ = ixkukto$(j%) + ".kukto"
             REM feld1$$ = feld2$$
           REM NEXT j%
           codebu% = SER ("Buchges",1)
           Codebu.buchges = codebu%
           codeinkgead.buchges = codeinkgead%
           SELECT KEY codevp.kukto FILE "Vprodukt" INDEX codevp.vprodukt
           IF ProvVonBrutto.vprodukt = "j" THEN 
             provanfirma$ = STR$ ((Beitrag.kukto * Provision.vprodukt / 100),"99999999.00")
             provanges$ = STR$ (Beitrag.kukto - VAL (provanfirma$),"999999999.00")
           ELSE 
             netto$ = STR$ ((Beitrag.kukto * 100) / (100 + mwst.vprodukt),"999999999.00")
             netto% = VAL (netto$)
             provanfirma$ = STR$ ((netto% * Provision.vprodukt / 100),"999999999.00")
             provanges$ = STR$ (Beitrag.kukto - VAL (provanfirma$),"999999999.00")
           END IF 
           mwst.buchges = mwst.vprodukt
           provision.buchges = Provision.vprodukt
           ProvAnGesellsch.buchges = VAL (provanges$)
           ProvAnGesEU.buchges = VAL ( STR$ (ProvAnGesellsch.buchges / umrechnung.buchges,"999999999.00"))
           ProvAnFirma.buchges = VAL (provanfirma$)
           SumFirma% = SumFirma% + VAL (provanfirma$)
           SumGes% = SumGes% + VAL (provanges$)
           GesBuDat.buchges = CalcDate$
           hochgerechnet.buchges = "n"
           QGEBUHoch.buchges = STR$ (codege.kukto,"000000") + "n"
           STORE FILE "Buchges"
           Jahr$ = STR$ ( YEAR (CalcDate$),"0000")
           REM Monat$ = STR$ ( MONTH (CalcDate$),"00")
           Monat$ = m$
           codegejahr$ = STR$ (codege.buchges,"000000") + jahr$
           feldgg$ = "u" + Monat$ + ".geadrums"
           feldggeu$ = "u" + Monat$ + "eu.geadrums"
           feldgf$ = "f" + Monat$ + ".geadrums"
           feldgfeu$ = "f" + Monat$ + "eu.geadrums"
           FILE "geadrums"
           SELECT KEY codege.buchges FILE "geadr" INDEX codege.geadr
           IF NOT EXISTS (codegejahr$,codegejahr.geadrums) THEN 
             BLANK FILE "geadrums"
             codekey.geadrums = SER ("geadrums",1)
             codege.geadrums = codege.buchges
             Gesellschaft.geadrums = gesellschaft.geadr
             codew.geadrums = 1
             waehrung.geadrums = "DM"
             umrechnung.geadrums = umrechnung.buchges
             codegejahr.geadrums = codegejahr$
             STORE FILE "geadrums"
             UNLOCK CURRENT 
           END IF 
           SELECT FIRST FILE "geadrums" INDEX codegejahr.geadrums
           SELECT KEY codegejahr$ LOCK FILE "geadrums" INDEX codegejahr.geadrums
           feldgg$$ = feldgg$$ + ProvAnGesellsch.buchges
           feldggeu$$ = VAL ( STR$ (feldgg$$ / umrechnung.geadrums,"999999999.00"))
           feldgf$$ = feldgf$$ + ProvAnFirma.buchges
           feldgfeu$$ = VAL ( STR$ (feldgf$$ / umrechnung.geadrums,"999999999.00"))
           Jahr.geadrums = YEAR (CalcDate$)
           STORE FILE "geadrums"
           UNLOCK CURRENT 
           FILE "kukto"
           verrechnet.kukto = "j"
           erlverr.kukto = "jj"
           Codebu.kukto = codebu%
           CodeInkGead.kukto = CodeInkGead%
           GesBuDat.kukto = CalcDate$
           STORE FILE "kukto"
           UNLOCK CURRENT 
         ELSE 
           erlverr.kukto = "ja"
           STORE FILE "kukto"
           UNLOCK CURRENT 
           CALL WriteLog("In Produkte wurde keine Provision fÅr " + LTRIM$ (gesellschaft.kukto) + "/" + Sparte.kukto + " definiert, deshalb konnte Vertrag " + VS_NR.kukto + " nocht verrechnet werden")
         END IF 
       END IF 
       SELECT FIRST 
       SELECT KEY "jn" LOCK FILE "kukto" INDEX erlverr.kukto
     WEND 
     UPDATE erlverr.kukto = "jn" WHERE erlverr.kukto = "ja"
     END UPDATE 
     CLOSE FILE "Kukto"
     CALL DFile(3,"Kukto" + _fpw$)
   END IF 
   REM req%>0
   CALL WriteLog("*******************************************************")
   CALL WriteLog("Anzahl der erzeugten BuchungssÑtze:" + LTRIM$ ( STR$ (i%,"99999999")) + " Summe Firma: " + provanfirma$ + " Summe Gesellschaften: " + provanges$)
   CALL WriteLog("*******************************************************")
   CALL CloseLog()
 END IF 
 REM req%=1

 REM *** Eine bereits durchgefÅhrte Inkassoma·nahme zurÅcksetzen und neu generieren ***
 IF req% = 2 THEN 
   CREATE DIALOG "INK1",0,0,191,122,"Gesellschaftsabrechnung","MS Sans Serif",8
   ADD DIALOG "INK1",4,0,0,191,98,0,""
   ADD DIALOG "INK1",9,9,12,21,23,2
   ADD DIALOG "INK1",5,38,12,144,30,0,"Bitte geben Sie ein, welches Datum die Abrechnung erhalten soll:"
   ADD DIALOG "INK1",5,35,63,55,10,0,"Abrechnungstag:"
   ADD DIALOG "INK1",6,93,63,51,11,0,0,CalcDate$,10
   ADD DIALOG "INK1",1,34,105,55,14,1,"&OK",1,1
   ADD DIALOG "INK1",1,92,105,95,14,0,"&Abrechnung Abbrechen",0,0
   DIALOG "INK1",req2%
   REMOVE DIALOG "INK1"
   IF req2% > 0 THEN 
     IF DateOK%(CalcDate$) THEN 
     ELSE 
       GOTO Mak1DIALOG 
     END IF 
   ELSE 
     GOTO MakInkassoEnd
   END IF 
   CALL Fehler("Es werden jetzt zunÑchst alle betroffenen DatensÑtze von der Gesellschaftsabrechnungsdatei gelîscht!","Danach werden die AbrechnungsdatensÑtze neu generiert")
   REQUEST "ABRECHNUNGSKORREKTUR DURCHFöHREN?","",130,req150%
   IF req150% = 0 THEN END SUB 
   FILE "Buchges"
   INDEX codeinkgead.buchges
   SELECT FIRST 
   ok% = 1
   IF RECCOUNT ("buchges") > 0 THEN 
     SELECT KEY codeinkgead% LOCK FILE "buchges" INDEX codeinkgead.buchges
   ELSE 
     SELECT LAST 
     ok% = 0
   END IF 
   
   WHILE NOT EOF ("buchges") AND ok% = 1 AND codeinkgead.buchges = codeinkgead%
     IF codeinkgead.buchges = codeinkgead% THEN 
       codegejahr$ = STR$ (codege.buchges,"000000") + jahr1$
       SELECT KEY codegejahr$ LOCK FILE "geadrums" INDEX codegejahr.geadrums
       feldgg$ = "u" + Monat1$ + ".geadrums"
       feldggeu$ = "u" + Monat1$ + "eu.geadrums"
       feldgf$ = "f" + Monat1$ + ".geadrums"
       feldgfeu$ = "f" + Monat1$ + "eu.geadrums"
       feldgg$$ = feldgg$$ - ProvAnGesellsch.buchges
       feldggeu$$ = VAL ( STR$ (feldgg$$ / umrechnung.geadrums,"999999999.00"))
       feldgf$$ = feldgf$$ - ProvAnFirma.buchges
       feldgfeu$$ = VAL ( STR$ (feldgf$$ / umrechnung.geadrums,"999999999.00"))
       STORE FILE "geadrums"
       IF EXISTS (codekuko.buchges,Codekuko.kukto) THEN 
         FILE "kukto"
         SELECT FIRST FILE "kukto"
         SELECT KEY codekuko.buchges LOCK FILE "kukto" INDEX codekuko.kukto
         SET STATUS "Korrigiere Inkassodatensatz: " + VS_Nr.kukto
         erlverr.kukto = "jn"
         verrechnet.kukto = "j"
         GesBuDat.kukto = 0
         Workstation.kukto = Workstation%
         QWoNo.kukto = STR$ (Workstation%,"000000") + STR$ (codekuko.kukto,"000000")
         RecStatus.kukto = "c"
         STORE FILE "Kukto"
         FILE "buchges"
       END IF 
     ELSE 
       ok% = 0
     END IF 
     SELECT NEXT FILE "buchges" INDEX codeinkgead.buchges
   WEND 
   SET STATUS "Lîsche Buchungen aus Buchungsdatei Gesellschaft"
   REMOVE FROM FILE "BUCHGES" WHERE codeinkgead.BUCHGES = codeinkgead%
   codeink% = codeinkgead%
   SET STATUS ""
 
   req% = 1
   FILE "BUCHGEAD"
   IF NOT EXISTS (codeinkgead%,codeink.BUCHGEAD) OR codeinkgead% < 1 THEN 
     CALL Fehler("Die zu korrigierende Abrechnung wurde nicht gefunden","Bitte wÑhlen Sie die Option zur Abrechnungs-Neuerstellung!")
     GOTO MakInkassoEnd
   END IF 
   SELECT KEY codeinkgead% LOCK FILE "BUCHGEAD" INDEX codeink.BUCHGEAD
   m$ = STR$ (HauptfÑlligkeit.BUCHGEAD,"00")
   m% = VAL (m$)
   InkDatum.BUCHGEAD = CalcDate$
   Anzahl.BUCHGEAD = Anzahl.inkstamm + 1
   wannerstellt.BUCHGEAD = TODAY 
   dtausdatei.BUCHGEAD = ""
   zero.BUCHGEAD = 0
   Workstation.BUCHGEAD = Workstation%
   QWoNo.BUCHGEAD = STR$ (Workstation%,"000000") + STR$ (codeink.BUCHGEAD,"000000")
   RecStatus.BUCHGEAD = "c"
   STORE FILE "BUCHGEAD"
   CALL CreateLog()
     CALL WriteLog("")
     CALL WriteLog("**********************************************************************")
     REM CALL WriteLog( STR$ (Anzahl.inkstamm,"999999") + ". Korrektur Inkassodaten vom " + DATE$ ( TODAY ,"0d.mm.yyyy") + " fÅr Inkasso vom: " + DATE$ (CalcDate$,"0d.mm.yyyy"))
     CALL WriteLog( STR$ (Anzahl.inkstamm,"999999") + ". Korrektur Gesellschaftsabrechnung vom " + DATE$ ( TODAY ,"0d.mm.yyyy") + " fÅr Abrechnung vom: " + CalcDate$)
     CALL WriteLog("***********************************************************************")
     CALL WriteLog("")
 
   GOTO MakBerech
 END IF 
MakInkassoEnd: 
 SET STATUS ""
 REM REQUEST "Buchungslauf beendet!"
 END SUB 



 
 '***********************************************************************************
 'Gesellschaftskonto der aktuellen Gesellschaft anzeigen
 '***********************************************************************************
 
SUB GESUMS()
 REM IF disabled%("EINGANG") THEN END SUB 
 CALL DFile(3,"geadrums" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 GCodeGE% = codege.geadr
 IF ( MOD ("geadr") OR NEW ("geadr")) THEN CALL FStore("geadr")
 FILE "geadrums"
 INDEX codege.geadrums
 SELECT FIRST 
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "GEADRUMS" THEN 
     SET HEADING title$ + " - Gesellschaftskonto"
     OPEN FORM GPrjForm$ + "GEADRUMS"
     SET f = Superbase.Form
     CALL GESUMSIntro()
     CALL MNGESUMS()
     SET STATUS "Gesellschaftskonto"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     codekey% = codekey.geadrums
     SELECT FORM KEY codekey% FILE "geadrums" INDEX codekey.geadrums
     FORM 2
   CASE 2
     REM CALL KuKtoDruckALL()
     CALL Fehler("Diese Funktion wird in der Demoversion nicht unterstÅtzt!","")
   CASE 3
     REM Einzelbuchungen
     CALL GESEinzel()
   MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("geadrums") OR NEW ("geadrums")) THEN CALL FStore("geadrums")
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
  
 
SUB GESUMSIntro()
 MOUSE OFF 
 FILE "geadrums"
 INDEX Codege.geadrums
   SELECT FORM KEY GCodeGE% FILE "Geadr" INDEX Codege.geadr
   SELECT FORM KEY GCodeGE% FILE "geadrums" INDEX Codege.geadrums
 FORM 
 END SUB 
 
SUB MNGESUMS()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
 '***********************************************************************************
 'Gesellschaftseinzelbuchungen der aktuellen Gesellschaft anzeigen
 '***********************************************************************************
 
SUB GESEinzel()
 REM IF disabled%("EINGANG") THEN END SUB 
 CALL DFile(3,"buchges" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 GCodeGE% = codege.geadr
 IF ( MOD ("geadr") OR NEW ("geadr")) THEN CALL FStore("geadr")
 FILE "buchges"
 INDEX codege.buchges
 SELECT FIRST 
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "BUCHGES" THEN 
     SET HEADING title$ + " - Gesellschaftseinzelbuchungen"
     OPEN FORM GPrjForm$ + "BUCHGES"
     SET f = Superbase.Form
     CALL GESEINZIntro()
     CALL MNGESEINZ()
     SET STATUS "Gesellschaftseinzelbuchungen"
   END IF 
   MENU ON 
   MOUSE ON 
   KUVorgsub% = 0
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF KUVorgsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE KUVorgsub%
   CASE 1
     codebu% = codebu.BUCHGES
     SELECT FORM KEY codebu% FILE "BUCHGES" INDEX codebu.BUCHGES
     FORM 2
   CASE 2
     REM CALL KuKtoDruckALL()
     CALL Fehler("Diese Funktion wird in der Demoversion nicht unterstÅtzt!","")
   CASE 3
     REM Einzelbuchungen
   MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("buchges") OR NEW ("buchges")) THEN CALL FStore("buchges")
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
  
 
SUB GESEINZIntro()
 MOUSE OFF 
 FILE "BUCHGES"
 INDEX Codege.BUCHGES
   SELECT FORM KEY GCodeGE% FILE "Geadr" INDEX Codege.geadr
   SELECT FORM KEY GCodeGE% FILE "BUCHGES" INDEX Codege.BUCHGES
 FORM 
 END SUB 
 
SUB MNGESEINZ()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
 
 REM BVF Provisionsliste
 REM ohne EURO
SUB LISTBVF1(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LISTBVF1")
 REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste " + " in " + Waehrung.stamm
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetnDiff% AS "ProdSum%",Einheiten.BUCHUNG1 AS "ProdEinh%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO LBVFEND20110001
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
 END IF 
 END SELECT 
LBVFEND20110001: 
 ON ERROR GOTO ErrorHandler
 END SUB 


SUB LISTBVF3(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LISTBVF3")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetnDiff% AS "ProdSum%",Einheiten.BUCHUNG1 AS "ProdEinh%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO LBVFEND2011000x1
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$,Datum.buchung1
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$,Datum.Buchung1
     TO ASK 
     END SELECT 
 END IF 
LBVFEND2011000x1: 
 ON ERROR GOTO ErrorHandler
 END SUB 

SUB LISTBVF2(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LISTBVF2")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetnDiff% AS "ProdSum%",Einheiten.BUCHUNG1 AS "ProdEinh%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO LBVFEND2011000x
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 END IF 
LBVFEND2011000x: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
SUB LIBVF3A(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LIBVF3A")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnDiff% AS "GesSum%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetnDiff% AS "ProdSum%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO LBVFEND2011000x1
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$,Datum.buchung1
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$,Datum.Buchung1
     TO ASK 
     END SELECT 
 END IF 
LBVFEND2011000x1: 
 ON ERROR GOTO ErrorHandler
 END SUB 



SUB LIBVF3A1(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LIBVF3A1")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnDiff% AS "GesSum%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetnDiff% AS "ProdSum%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO LBVFEND2011000x1
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Datum.buchung1
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Datum.Buchung1
     TO ASK 
     END SELECT 
 END IF 
LBVFEND2011000x1: 
 ON ERROR GOTO ErrorHandler
 END SUB 

 
SUB LISTBVF2(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LISTBVF2")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetnDiff% AS "ProdSum%",Einheiten.BUCHUNG1 AS "ProdEinh%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO LBVFEND2011000x
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 END IF 
LBVFEND2011000x: 
 ON ERROR GOTO ErrorHandler
 END SUB 
  


SUB LIBVF3A(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LIBVF3A")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste " + " in Euro"
 IF vondat$ = "" AND bisdat$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF vondat$ <> "" AND bisdat$ = "" THEN Header$ = Header$ + " (ab " + vondat$ + ")"
 IF vondat$ <> "" AND bisdat$ <> "" THEN Header$ = Header$ + " (vom " + vondat$ + " bis " + bisdat$ + ")"
 IF vondat$ = "" AND bisdat$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnDiff% AS "GesSum%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetnDiff% AS "ProdSum%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO LBVFEND2011000x1
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$,Datum.buchung1
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$,Datum.Buchung1
     TO ASK 
     END SELECT 
 END IF 
LBVFEND2011000x1: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
SUB LISTUF1(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("LISTUF1")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 

 von$ = vondat$
 bis$ = bisdat$
 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"

 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnDiff% AS "GesSum%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Sparte.BUCHUNG1,BetnDiff% AS "ProdSum%"
 BEFORE GROUP Sparte.BUCHUNG1
     SET REPORT PAGE "H_Sparte.BUC004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Sparte.BUCHUNG1
     SET REPORT PAGE "F_Sparte.BUC004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
  



 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO LBVFEND170206x
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Sparte.BUCHUNG1,Datum.BUCHUNG1,Kunde$
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Sparte.BUCHUNG1,Datum.BUCHUNG1,Kunde$
     TO ASK 
     END SELECT 
 END IF 
LBVFEND170206x: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 





SUB L9STBVF2(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("L9STBVF2")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",MWSTBetragEU.BUCHUNG1 AS "SSumAgenturM%",NettoEU.BUCHUNG1 AS "SSumAgenturN%",Einheiten.BUCHUNG1 AS "SumEinh%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 

 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",Einheiten.BUCHUNG1 AS "SumEinh%",MWSTBetragEU.BUCHUNG1 AS "SumAgenturM%",NettoEU.BUCHUNG1 AS "SumAgenturN%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetragEU.BUCHUNG1 AS "SumAgent1%",SREU.BUCHUNG1 AS "SumStorno1%",Einheiten.BUCHUNG1 AS "SumEinh1%",MWSTBetragEU.BUCHUNG1 AS "SumAgent1M%",NettoEU.BUCHUNG1 AS "SumAgent1N%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO LBVFEND2609043
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 END IF 
LBVFEND2609043: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 



SUB L9STBVF3(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL PRep("L9STBVF3")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",MWSTBetragEu.BUCHUNG1 AS "SSumAgenturM%",NettoEU.BUCHUNG1 AS "SSumAgenturN%",VSV.BUCHUNG1 AS "SumEinh%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
  
 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"

 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
  

 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",VSV.BUCHUNG1 AS "SumEinh%",MWSTBetragEu.BUCHUNG1 AS "SumAgenturM%",NettoEU.BUCHUNG1 AS "SumAgenturN%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP QCodeMAPROD.BUCHUNG1,BetragEU.BUCHUNG1 AS "SumAgent1%",SREU.BUCHUNG1 AS "SumStorno1%",VSV.BUCHUNG1 AS "SumEinh1%",MWSTBetragEu.BUCHUNG1 AS "SumAgent1M%",NettoEU.BUCHUNG1 AS "SumAgent1N%"
 BEFORE GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "H_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QCodeMAPROD.BUCHUNG1
     SET REPORT PAGE "F_QCodeMAPRO003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 

 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO L3BVFEND2609043
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 END IF 
L3BVFEND2609043: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
 
SUB L9ERFT1(euro%,codema%,vondat$,bisdat$)
 von$ = vondat$
 bis$ = bisdat$
 CALL Fehler("Achtung diese Liste bitte im A4 quer Format ausgeben!","")
 REM SET PRINTER 
 CALL PRep("L9ERFT1")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",MWSTBetragEu.BUCHUNG1 AS "SSumAgenturM%",NettoEU.BUCHUNG1 AS "SSumAgenturN%",VSV.BUCHUNG1 AS "SumVSV3%",Bewertung2EU.BUCHUNG1 AS "SumBW3%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 

 Header$ = "Provisionsliste " + " in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",VSV.BUCHUNG1 AS "SumVSV2%",MWSTBetragEu.BUCHUNG1 AS "SumAgenturM%",NettoEU.BUCHUNG1 AS "SumAgenturN%",Bewertung2EU.BUCHUNG1 AS "SumBW2%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Sparte.BUCHUNG1,BetragEU.BUCHUNG1 AS "SumAgent1%",SREU.BUCHUNG1 AS "SumStorno1%",VSV.BUCHUNG1 AS "SumVSV1%",MWSTBetragEu.BUCHUNG1 AS "SumAgent1M%",NettoEU.BUCHUNG1 AS "SumAgent1N%",Bewertung2EU.BUCHUNG1 AS "SumBW1%"
 BEFORE GROUP Sparte.BUCHUNG1
     SET REPORT PAGE "H_Sparte.BUC003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Sparte.BUCHUNG1
     SET REPORT PAGE "F_Sparte.BUC003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 

 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO L3BVFEND2609043
 IF codema% < 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 ELSE 
   SELECT ;
     WHERE CodeMA.MAADR = CodeMA.BUCHUNG1 AND codema.buchung1 = codema% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
     END SELECT 
 END IF 
L3BVFEND2609043: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
  







 REM ***************************************************************************************************
 REM FÅhrung der zentralen Konto-datei aumskto
 REM ***************************************************************************************************
SUB ZentrKTO(ma%,datum%,betrag%,sr%,codew%,umr%,waehr1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,einheit%)
 REM CALL Fehler("ZentrKTO","")
 mfile$ = FILE 
 IF NOT OPEN ("AUmskto") THEN CALL DFile(3,"AUmskto" + _fpw$)
 REM CALL Fehler("","")
 ON ERROR GOTO ZentrKTOEnd
 codema% = ma%
 monat$ = LEFT$ ( DATE$ (datum%,"mm0dyyyy"),2)
 jahr$ = LEFT$ ( DATE$ (datum%,"yyyymm0d"),4)
   qcodemajahr$ = STR$ (codema%,"000000") + jahr$
   REM CALL Fehler( DATE$ (datum%,"yyyymm0d"),qcodemajahr$)
   IF NOT EXISTS (qcodemajahr$,qcodemajahr.aumskto) THEN 
     BLANK FILE "AUMSKTO"
     codema.AUMSkto = codema%
     Jahr.aumskto = VAL (jahr$)
     QCodemaJahr.AUMSkto = qcodemajahr$
     codew.aumskto = codew%
     umrechnung.aumskto = umr%
     waehrung.aumskto = waehr1$
     STORE FILE "AUMSkto"
     UNLOCK CURRENT FILE "AUMSkto"
   END IF 
   FILE "AUMSkto"
   SELECT FIRST FILE "AUMSkto" INDEX QCodemaJahr.AUMSkto
   SELECT KEY Qcodemajahr$ LOCK FILE "AUMSkto" INDEX QCodemaJahr.AUMSkto
   feldK$ = "Konto" + monat$ + ".aumskto"
   feldKges$ = "KontoGes" + ".aumskto"
   feldKEU$ = "Konto" + monat$ + "EU.aumskto"
   feldKEUges$ = "KontoGes" + "EU.aumskto"

   feldS$ = "Storno" + monat$ + ".aumskto"
   feldSges$ = "StornoGes" + ".aumskto"
   feldSEU$ = "Storno" + monat$ + "EU.aumskto"
   feldSEUges$ = "StornoGes" + "EU.aumskto"

   feldSK$ = "SKonto" + monat$ + ".aumskto"
   feldSKges$ = "SKontoGes" + ".aumskto"
   feldSKEU$ = "SKonto" + monat$ + "EU.aumskto"
   feldSKEUges$ = "SKontoGes" + "EU.aumskto"

   feldeK$ = "eKonto" + monat$ + ".aumskto"
   feldeKges$ = "eKontoGes" + ".aumskto"
   feldeKEU$ = "eKonto" + monat$ + "EU.aumskto"
   feldeKEUges$ = "eKontoGes" + "EU.aumskto"

   felddK$ = "dKonto" + monat$ + ".aumskto"
   felddKges$ = "dKontoGes" + ".aumskto"
   felddKEU$ = "dKonto" + monat$ + "EU.aumskto"
   felddKEUges$ = "dKontoGes" + "EU.aumskto"


   feldzK$ = "zKonto" + monat$ + ".aumskto"
   feldzKges$ = "zKontoGes" + ".aumskto"
   feldzKEU$ = "zKonto" + monat$ + "EU.aumskto"
   feldzKEUges$ = "zKontoGes" + "EU.aumskto"

   feldeinh$ = "Einheit" + monat$ + ".aumskto"
   feldEinhges$ = "EinheitGes" + ".aumskto"
   
   feldseinh$ = "sEinheit" + monat$ + ".aumskto"
   feldsEinhges$ = "sEinheitGes" + ".aumskto"
   
   IF eigen% = 1 THEN 
     feldeinh$$ = feldeinh$$ + einheit%
     feldEinhges$$ = feldEinhges$$ + einheit%
   ELSE 
     feldseinh$$ = feldseinh$$ + einheit%
     feldsEinhges$$ = feldsEinhges$$ + einheit%
   END IF 

   IF PSpAll$ <> "j" THEN 
     IF PROVSpEig$ <> "j" THEN 
       IF zusatz% <> 1 THEN 
         feldK$$ = feldK$$ + betrag%
         feldKges$$ = feldKGes$$ + betrag%
         feldS$$ = feldS$$ + sr%
         feldSges$$ = feldSges$$ + sr%
         feldKEU$$ = VAL ( STR$ (feldK$$ / umrechnung.aumskto,"999999999.00"))
         feldKEUges$$ = VAL ( STR$ (feldKges$$ / umrechnung.aumskto,"999999999.00"))
         feldSEU$$ = VAL ( STR$ (feldS$$ / umrechnung.aumskto,"999999999.00"))
         feldSEUges$$ = VAL ( STR$ (feldSges$$ / umrechnung.aumskto,"999999999.00"))
         IF eigen% = 1 THEN 
           feldeK$$ = feldeK$$ + betrag%
           feldeKges$$ = feldeKGes$$ + betrag%
           feldeKEU$$ = VAL ( STR$ (feldeK$$ / umrechnung.aumskto,"999999999.00"))
           feldeKEUges$$ = VAL ( STR$ (feldeKges$$ / umrechnung.aumskto,"999999999.00"))
         ELSE 
           felddK$$ = felddK$$ + betrag%
           felddKges$$ = felddKGes$$ + betrag%
           felddKEU$$ = VAL ( STR$ (felddK$$ / umrechnung.aumskto,"999999999.00"))
           felddKEUges$$ = VAL ( STR$ (felddKges$$ / umrechnung.aumskto,"999999999.00"))
         END IF 
       ELSE 
         feldzK$$ = feldzK$$ + betrag%
         feldzKges$$ = feldzKGes$$ + betrag%
         feldzKEU$$ = VAL ( STR$ (feldzK$$ / umrechnung.aumskto,"999999999.00"))
         feldzKEUges$$ = VAL ( STR$ (feldzKges$$ / umrechnung.aumskto,"999999999.00"))
         IF sr% <> 0 THEN 
           feldS$$ = feldS$$ + sr%
           feldSges$$ = feldSges$$ + sr%
           feldSEU$$ = VAL ( STR$ (feldS$$ / umrechnung.aumskto,"999999999.00"))
           feldSEUges$$ = VAL ( STR$ (feldSges$$ / umrechnung.aumskto,"999999999.00"))
         END IF 
       END IF 
     ELSE 
       IF PSpESeit% <= datum% AND eigen% = 1 THEN 
         feldSK$$ = feldSK$$ + betrag%
         feldSKges$$ = feldSKGes$$ + betrag%
         feldSKEU$$ = VAL ( STR$ (feldSK$$ / umrechnung.aumskto,"999999999.00"))
         feldSKEUges$$ = VAL ( STR$ (feldSKges$$ / umrechnung.aumskto,"999999999.00"))
         feldS$$ = feldS$$ + sr%
         feldSges$$ = feldSges$$ + sr%
         feldSEU$$ = VAL ( STR$ (feldS$$ / umrechnung.aumskto,"999999999.00"))
         feldSEUges$$ = VAL ( STR$ (feldSges$$ / umrechnung.aumskto,"999999999.00"))
       ELSE 
         feldK$$ = feldK$$ + betrag%
         feldKges$$ = feldKGes$$ + betrag%
         feldS$$ = feldS$$ + sr%
         feldSges$$ = feldSges$$ + sr%
         feldKEU$$ = VAL ( STR$ (feldK$$ / umrechnung.aumskto,"999999999.00"))
         feldKEUges$$ = VAL ( STR$ (feldKges$$ / umrechnung.aumskto,"999999999.00"))
         feldSEU$$ = VAL ( STR$ (feldS$$ / umrechnung.aumskto,"999999999.00"))
         feldSEUges$$ = VAL ( STR$ (feldSges$$ / umrechnung.aumskto,"999999999.00"))
         IF eigen% = 1 THEN 
           feldeK$$ = feldeK$$ + betrag%
           feldeKges$$ = feldeKGes$$ + betrag%
           feldeKEU$$ = VAL ( STR$ (feldeK$$ / umrechnung.aumskto,"999999999.00"))
           feldeKEUges$$ = VAL ( STR$ (feldeKges$$ / umrechnung.aumskto,"999999999.00"))
         ELSE 
           felddK$$ = felddK$$ + betrag%
           felddKges$$ = felddKGes$$ + betrag%
           felddKEU$$ = VAL ( STR$ (felddK$$ / umrechnung.aumskto,"999999999.00"))
           felddKEUges$$ = VAL ( STR$ (felddKges$$ / umrechnung.aumskto,"999999999.00"))
         END IF 
       END IF 
     END IF 
   ELSE 
     IF PSpAllSeit% <= datum% THEN 
       feldSK$$ = feldSK$$ + betrag%
       feldSKges$$ = feldSKGes$$ + betrag%
       feldSKEU$$ = VAL ( STR$ (feldSK$$ / umrechnung.aumskto,"999999999.00"))
       feldSKEUges$$ = VAL ( STR$ (feldSKges$$ / umrechnung.aumskto,"999999999.00"))
       feldS$$ = feldS$$ + sr%
       feldSges$$ = feldSges$$ + sr%
       feldSEU$$ = VAL ( STR$ (feldS$$ / umrechnung.aumskto,"999999999.00"))
       feldSEUges$$ = VAL ( STR$ (feldSges$$ / umrechnung.aumskto,"999999999.00"))
     ELSE 
       feldK$$ = feldK$$ + betrag%
       feldKges$$ = feldKGes$$ + betrag%
       feldS$$ = feldS$$ + sr%
       feldSges$$ = feldSges$$ + sr%
       feldKEU$$ = VAL ( STR$ (feldk$$ / umrechnung.aumskto,"999999999.00"))
       feldKEUges$$ = VAL ( STR$ (feldKges$$ / umrechnung.aumskto,"999999999.00"))
       feldSEU$$ = VAL ( STR$ (feldS$$ / umrechnung.aumskto,"999999999.00"))
       feldSEUges$$ = VAL ( STR$ (feldSges$$ / umrechnung.aumskto,"999999999.00"))
       IF eigen% = 1 THEN 
         feldeK$$ = feldeK$$ + betrag%
         feldeKges$$ = feldeKGes$$ + betrag%
         feldeKEU$$ = VAL ( STR$ (feldeK$$ / umrechnung.aumskto,"999999999.00"))
         feldeKEUges$$ = VAL ( STR$ (feldeKges$$ / umrechnung.aumskto,"999999999.00"))
       ELSE 
         felddK$$ = felddK$$ + betrag%
         felddKges$$ = felddKGes$$ + betrag%
         felddKEU$$ = VAL ( STR$ (felddK$$ / umrechnung.aumskto,"999999999.00"))
         felddKEUges$$ = VAL ( STR$ (felddKges$$ / umrechnung.aumskto,"999999999.00"))
       END IF 
     END IF 
   END IF 
   STORE FILE "AUMSkto"
   UNLOCK CURRENT FILE "AUMSkto"
ZentrKTOEnd: 
 ON ERROR GOTO ErrorHandler
 FILE mfile$
 END SUB 


 '**********************************************************************************************************************
 '                      ZENTRALER ZéHLER
 '
 ' wenn Antrag erfa·t wird AntragszÑhler erhîhen
 ' wenn Antrag zum Vertrag wird, dann VertragszÑhler erhîhen
 ' ma%          - Agentur, der der Vertrag gutgeschrieben wird
 ' zaehlart$    - welcher Zaehler soll erhîht werden
 ' Bws%         - Wert Bewertungssumme
 ' Vol%         - Wert Volumen
 ' Einh%        - Wert Einheiten
 ' datum%       - Datum des Monats/JahreszÑhler der erhîht werden soll             
 ' art%         - 0 zuaddieren
 '                1 subtrahieren
 '**********************************************************************************************************************
SUB ZentrAGZaehl(ma%,zaehlart$,bws%,vol%,einh%,datum%,art%)
 REM CALL Fehler("","")
 ON ERROR GOTO ZentrAGZaehlEnd
 codema% = codema.kvertrag
 codemanr% = codema.maadr
 CodeVstatus% = CodeVStatus.kvertrag
 monat$ = LEFT$ ( DATE$ (datum%,"mm0dyyyy"),2)
 jahr$ = LEFT$ ( DATE$ (datum%,"yyyymm0d"),4)
 FILE "maadr"
 INDEX codema.maadr
 SELECT FIRST 
 SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
 ok% = - 1
 WHILE NOT EOF ("maadr") AND ok%
   qcodemajahr$ = STR$ (codema.maadr,"000000") + jahr$
   IF NOT EXISTS (qcodemajahr$,qcodemajahr.aumsatz) THEN 
     BLANK FILE "AUMSATZ"
     codema.AUMSATZ = codema.maadr
     Jahr.aumsatz = VAL (jahr$)
     QCodemaJahr.AUMSATZ = qcodemajahr$
     STORE FILE "AUMSATZ"
     UNLOCK CURRENT FILE "AUMSATZ"
   END IF 
   FILE "AUMSATZ"
   SELECT FIRST FILE "AUMSATZ" INDEX QCodemaJahr.AUMSATZ
   SELECT KEY Qcodemajahr$ LOCK FILE "AUMSATZ" INDEX QCodemaJahr.AUMSATZ
   SELECT CASE UCASE$ (zaehlart$)
     CASE "ANALYSE"
       IF codema.maadr = ma% THEN 
         feld$ = "Analyse" + monat$ + ".aumsatz"
         feldges$ = "AnalyseGes" + ".aumsatz"
       END IF 
       IF codema.maadr <> ma% THEN 
         feld$ = "SAnalyse" + monat$ + ".aumsatz"
         feldges$ = "SAnalyseGes" + ".aumsatz"
       END IF 
     CASE "ANTRAG"
         IF codema.maadr = ma% THEN 
           feld$ = "Antr" + monat$ + ".aumsatz"
           feldges$ = "AntrGes" + ".aumsatz"
           feldma$ = "AntrGes" + ".maadr"
         END IF 
         IF codema.maadr <> ma% THEN 
           feld$ = "SAntr" + monat$ + ".aumsatz"
           feldges$ = "SAntrGes" + ".aumsatz"
           feldma$ = "SAntrGes" + ".maadr"
         END IF 
     CASE "VERTRAG"
       IF codema.maadr = ma% THEN 
         feld$ = "Vert" + monat$ + ".aumsatz"
         feldges$ = "VertGes" + ".aumsatz"
         feldma$ = "VertGes" + ".maadr"
         feldBWS$ = "BWS" + monat$ + ".aumsatz"
         IF art% = 0 THEN 
           feldBWS$$ = feldBWS$$ + bws%
           BWSGes.aumsatz = BWSGes.aumsatz + bws%
           BWSGes.maadr = BWSGes.maadr + bws%
           feldVol$ = "Vol" + monat$ + ".aumsatz"
           feldVol$$ = feldVol$$ + Vol%
           VolGes.aumsatz = VolGes.aumsatz + Vol%
           VolGes.maadr = VolGes.maadr + Vol%
         ELSE 
           feldBWS$$ = feldBWS$$ - Bws%
           BWSGes.aumsatz = BWSGes.aumsatz - Bws%
           BWSGes.maadr = BWSGes.maadr - Bws%
           feldVol$ = "Vol" + monat$ + ".aumsatz"
           feldVol$$ = feldVol$$ - Vol%
           VolGes.aumsatz = VolGes.aumsatz - Vol%
           VolGes.maadr = VolGes.maadr - Vol%
         END IF 
       END IF 
       IF codema.maadr <> ma% THEN 
         feld$ = "SVert" + monat$ + ".aumsatz"
         feldges$ = "SVertGes" + ".aumsatz"
         feldBWS$ = "SBWS" + monat$ + ".aumsatz"
         feldma$ = "SVertGes" + ".maadr"
         IF art% = 0 THEN 
           feldBWS$$ = feldBWS$$ + Bws%
           SBWSGes.aumsatz = SBWSGes.aumsatz + Bws%
           SBWSGes.maadr = SBWSGes.maadr + Bws%
           feldVol$ = "SVol" + monat$ + ".aumsatz"
           feldVol$$ = feldVol$$ + Vol%
           SVolGes.aumsatz = SVolGes.aumsatz + Vol%
           SVolGes.maadr = SVolGes.maadr + Vol%
         ELSE 
           feldBWS$$ = feldBWS$$ - Bws%
           SBWSGes.aumsatz = SBWSGes.aumsatz - Bws%
           SBWSGes.maadr = SBWSGes.maadr - Bws%
           feldVol$ = "SVol" + monat$ + ".aumsatz"
           feldVol$$ = feldVol$$ - Vol%
           SVolGes.aumsatz = SVolGes.aumsatz - Vol%
           SVolGes.maadr = SVolGes.maadr - Vol%
         END IF 
       END IF 
     CASE "MSTORNO"
       IF codema.maadr = ma% THEN 
         feld$ = "Storno" + monat$ + ".aumsatz"
         feldges$ = "StornoGes" + ".aumsatz"
         feldma$ = "StornoGes" + ".maadr"
         feldBWS$ = "MBWS" + monat$ + ".aumsatz"
         feldMSt$ = "MStorno" + monat$ + ".aumsatz"
         feldMStges$ = "MStornoGes" + ".aumsatz"
         IF art% = 0 THEN 
           feldBWS$$ = feldBWS$$ + bws%
           feldMst$$ = feldMSt$$ + 1
           feldMStges$$ = feldMStges$$ + 1
           MBWSGes.aumsatz = MBWSGes.aumsatz + bws%
           MBWSGes.maadr = MBWSGes.maadr + bws%
         ELSE 
           feldBWS$$ = feldBWS$$ - Bws%
           MBWSGes.aumsatz = MBWSGes.aumsatz - Bws%
           MBWSGes.maadr = MBWSGes.maadr - Bws%
           feldMst$$ = feldMSt$$ - 1
           feldMStges$$ = feldMStges$$ - 1
           StatusZOK.kvertrag = "VERTRAG"
         END IF 
       END IF 
       IF codema.maadr <> ma% THEN 
         feld$ = "SStorno" + monat$ + ".aumsatz"
         feldges$ = "SStornoGes" + ".aumsatz"
         feldBWS$ = "SMBWS" + monat$ + ".aumsatz"
         feldma$ = "SStornoGes" + ".maadr"
         feldMSt$ = "SMStorno" + monat$ + ".aumsatz"
         feldMStges$ = "SMStornoGes" + ".aumsatz"
         IF art% = 0 THEN 
           feldBWS$$ = feldBWS$$ + Bws%
           SMBWSGes.aumsatz = SMBWSGes.aumsatz + Bws%
           SMBWSGes.maadr = SMBWSGes.maadr + Bws%
           feldMst$$ = feldMSt$$ + 1
           feldMStges$$ = feldMStges$$ + 1
         ELSE 
           feldBWS$$ = feldBWS$$ - Bws%
           SMBWSGes.aumsatz = SMBWSGes.aumsatz - Bws%
           SMBWSGes.maadr = SMBWSGes.maadr - Bws%
           feldMst$$ = feldMSt$$ - 1
           feldMStges$$ = feldMStges$$ - 1
         END IF 
       END IF 
     CASE "ESTORNO"
       IF codema.maadr = ma% THEN 
         feld$ = "Storno" + monat$ + ".aumsatz"
         feldges$ = "StornoGes" + ".aumsatz"
         feldma$ = "StornoGes" + ".maadr"
         feldBWS$ = "EBWS" + monat$ + ".aumsatz"
         feldMSt$ = "EStorno" + monat$ + ".aumsatz"
         feldMStges$ = "EStornoGes" + ".aumsatz"
         IF art% = 0 THEN 
           feldBWS$$ = feldBWS$$ + bws%
           feldMst$$ = feldMSt$$ + 1
           feldMStges$$ = feldMStges$$ + 1
           EBWSGes.aumsatz = EBWSGes.aumsatz + bws%
           EBWSGes.maadr = EBWSGes.maadr + bws%
         ELSE 
           feldBWS$$ = feldBWS$$ - Bws%
           EBWSGes.aumsatz = EBWSGes.aumsatz - Bws%
           EBWSGes.maadr = EBWSGes.maadr - Bws%
           feldMst$$ = feldMSt$$ - 1
           feldMStges$$ = feldMStges$$ - 1
           StatusZOK.kvertrag = "VERTRAG"
         END IF 
       END IF 
       IF codema.maadr <> ma% THEN 
         feld$ = "SStorno" + monat$ + ".aumsatz"
         feldges$ = "SStornoGes" + ".aumsatz"
         feldBWS$ = "SEBWS" + monat$ + ".aumsatz"
         feldma$ = "SStornoGes" + ".maadr"
         feldMSt$ = "SEStorno" + monat$ + ".aumsatz"
         feldMStges$ = "SEStornoGes" + ".aumsatz"
         IF art% = 0 THEN 
           feldBWS$$ = feldBWS$$ + Bws%
           SEBWSGes.aumsatz = SEBWSGes.aumsatz + Bws%
           SEBWSGes.maadr = SEBWSGes.maadr + Bws%
           feldMst$$ = feldMSt$$ + 1
           feldMStges$$ = feldMStges$$ + 1
         ELSE 
           feldBWS$$ = feldBWS$$ - Bws%
           SEBWSGes.aumsatz = SEBWSGes.aumsatz - Bws%
           SEBWSGes.maadr = SEBWSGes.maadr - Bws%
           feldMst$$ = feldMSt$$ - 1
           feldMStges$$ = feldMStges$$ - 1
         END IF 
       END IF 
     CASE "STORNO"
       IF codema.maadr = ma% THEN 
         feld$ = "Storno" + monat$ + ".aumsatz"
         feldges$ = "StornoGes" + ".aumsatz"
         feldma$ = "StornoGes" + ".maadr"
       END IF 
       IF codema.maadr <> ma% THEN 
         feld$ = "SStorno" + monat$ + ".aumsatz"
         feldges$ = "SStornoGes" + ".aumsatz"
         feldma$ = "SStornoGes" + ".maadr"
       END IF 
     CASE "EINHEIT"
       IF codema.maadr = ma% THEN 
         feld$ = "Einheit" + monat$ + ".aumsatz"
         feldges$ = "EinheitGes" + ".aumsatz"
         feldma$ = "EinheitGes" + ".maadr"
       END IF 
       IF codema.maadr <> ma% THEN 
         feld$ = "SEinheit" + monat$ + ".aumsatz"
         feldges$ = "SEinheitGes" + ".aumsatz"
         feldma$ = "SEinheitGes" + ".maadr"
       END IF 
   END SELECT 
   IF art% = 0 THEN 
     feld$$ = feld$$ + 1
     feldges$$ = feldges$$ + 1
     feldma$$ = feldma$$ + 1
   ELSE 
     feld$$ = feld$$ - 1
     feldges$$ = feldges$$ - 1
     feldma$$ = feldma$$ - 1
   END IF 
   STORE FILE "AUMSATZ"
   UNLOCK CURRENT FILE "AUMSATZ"
   FILE "MAADR"
   STORE FILE "MAADR"
   UNLOCK CURRENT FILE "MAADR"
   'Abbruchbedingung wenn oberste Ebene erreicht
   IF vorgÑnger.maadr > 0 THEN 
     IF EXISTS (vorgÑnger.maadr,codema.maadr) THEN 
       IF vorgÑnger.maadr <> codema.maadr THEN 
         SELECT KEY vorgÑnger.maadr LOCK FILE "maadr" INDEX codema.maadr
       ELSE 
         ok% = 0
       END IF 
     ELSE 
       IF ag$ <> "j" THEN 
         b$ = "Er wurde wahrscheinlich gelîscht! Wechseln Sie in die Vermittlermaske und betÑtigen Sie dort den Button <Test auf GÅltigkeit>"
         CALL Fehler("Der bei dem Mitarbeiter " + nachname.maadr + "," + vorname.maadr + " definierte VorgÑnger existiert nicht mehr",b$)
       END IF 
       ok% = 0

     END IF 
   ELSE 
     ok% = 0
   END IF 
 WEND 
ZentrAGZaehlEnd: 
 ON ERROR GOTO ErrorHandler
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 SELECT KEY codemanr% FILE "maadr" INDEX codema.maadr
 END SUB 

 ' *********************************************************************************
 ' ZÑhler testen
 ' ********************************************************************************* 
SUB ZokTest()
       REM IF G_Volume% <> Volumen.kvertrag THEN zok% = - 1
       REM IF G_Bewert% <> Bewertungssumme.kvertrag THEN zok% = - 1
       REM IF G_MonAntrag$ <> LEFT$ ( DATE$ (Antragsdatum.kvertrag,"mm0dyyyy"),2) THEN zok% = - 2
       REM IF G_JahrAntrag$ <> LEFT$ ( DATE$ (Antragsdatum.kvertrag,"yyyymm0d"),4) THEN zok% = - 2
       REM IF G_MonVertr$ <> LEFT$ ( DATE$ (VS_Beginn.kvertrag,"mm0dyyyy"),2) THEN zok% = - 2
       REM IF G_JahrVertr$ <> LEFT$ ( DATE$ (VS_Beginn.kvertrag,"yyyymm0d"),4) THEN zok% = - 2
       REM IF G_VStatus% <> CodeVstatus.kvertrag THEN zok% = - 3
       REM G_Antrag%
       REM G_Vertrag%
     zok% = 0
     StatusZOK$ = StatusZOK.kvertrag
     REM IF VS_NR.kvertrag LIKE "0915*" THEN CALL Fehler(VS_NR.kvertrag,"")
     IF StatusZOK$ = "" THEN 
       ' neuer Datensatz, da braucht nichts zurÅckgerechnet werden
       SELECT CASE codevstatus.kvertrag
         CASE 12
            'Antrag
            antrd$ = DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy")
            IF codema.kvertrag > 0 AND Antragsdatum.kvertrag > 0 AND DateOK%(antrd$) THEN 
              StatusZOK.kvertrag = "ANTRAG"
              CALL ZentrAGZaehl(codema.kvertrag,"ANTRAG",Bewertungssumme.kvertrag,Volumen.kvertrag,0,Antragsdatum.kvertrag,0)
            END IF 
          CASE ELSE 
            'zunÑchst als Antrag zÑhlen, da noch nichts eingetragen war
            antrd$ = DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy")
            IF codema.kvertrag > 0 AND Antragsdatum.kvertrag > 0 AND DateOK%(Antrd$) THEN 
              StatusZOK.kvertrag = "ANTRAG"
              CALL ZentrAGZaehl(codema.kvertrag,"ANTRAG",Bewertungssumme.kvertrag,Volumen.kvertrag,0,Antragsdatum.kvertrag,0)
            END IF 
            'Vertrag
            vertrd$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
            IF codevstatus.kvertrag <> 12 AND codevstatus.kvertrag <> 4 AND codevstatus.kvertrag <> 10 AND codevstatus.kvertrag <> 11 AND codevstatus.kvertrag <> 13 THEN 
              IF codema.kvertrag > 0 AND VS_Beginn.kvertrag > 0 AND DateOK%(vertrd$) THEN 
                StatusZOK.kvertrag = "VERTRAG"
                CALL ZentrAGZaehl(codema.kvertrag,"VERTRAG",Bewertungssumme.kvertrag,Volumen.kvertrag,0,VS_Beginn.kvertrag,0)
              END IF 
            END IF 
       END SELECT 
       
     ELSE 
        ' bereits vorhandener DS, der bereits gezÑhlt wurde
      SELECT CASE StatusZOK$
        CASE "ANTRAG"
          IF G_Ma% <> CodeMA.kvertrag AND G_Ma% > 0 AND CodeMA.kvertrag > 0 THEN 
            'Mitarbeiter wurde geÑndert
            zok% = - 1
          END IF 
          antrd$ = DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy")
          IF G_Antrag% <> Antragsdatum.kvertrag AND G_Antrag% > 0 AND Antragsdatum.kvertrag > 0 AND DateOK%(Antrd$) THEN 
            'Antragsdatum wurde geÑndert
            zok% = - 1
          END IF 
          IF zok% = - 1 THEN 
            ' erst rÅckrechnen
            CALL ZentrAGZaehl(G_ma%,StatusZOK$,G_Bewert%,G_volume%,0,G_Antrag%,1)
            ' dann neu berechnen
            CALL ZentrAGZaehl(codema.kvertrag,"ANTRAG",Bewertungssumme.kvertrag,Volumen.kvertrag,0,Antragsdatum.kvertrag,0)
          END IF 
          IF G_VStatus% <> CodeVstatus.kvertrag THEN 
            'der Status hat sich geÑndert, deshalb mu· der Datensatz in einer anderen Kategorie hocgezÑhlt werden
            IF codevstatus.kvertrag <> 12 AND codevstatus.kvertrag <> 4 AND codevstatus.kvertrag <> 10 AND codevstatus.kvertrag <> 11 AND codevstatus.kvertrag <> 13 THEN 
              vertrd$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
              IF codema.kvertrag > 0 AND VS_Beginn.kvertrag > 0 AND DateOK%(vertrd$) THEN 
                StatusZOK.kvertrag = "VERTRAG"
                CALL ZentrAGZaehl(codema.kvertrag,"VERTRAG",Bewertungssumme.kvertrag,Volumen.kvertrag,0,VS_Beginn.kvertrag,0)
              END IF 
            END IF 
            ' oder er wurde storniert
            IF codevstatus.kvertrag = 4 THEN 
              vertrd$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
              IF codema.kvertrag > 0 AND VS_Beginn.kvertrag > 0 AND DateOK%(vertrd$) THEN 
                StatusZOK.kvertrag = "STORNO"
                CALL ZentrAGZaehl(codema.kvertrag,"STORNO",Bewertungssumme.kvertrag,Volumen.kvertrag,0,VS_Beginn.kvertrag,0)
              END IF 
            END IF 
          END IF 
        CASE "VERTRAG"
          IF G_Ma% <> CodeMA.kvertrag AND G_Ma% > 0 AND CodeMA.kvertrag > 0 THEN 
            'Mitarbeiter wurde geÑndert
            zok% = - 1
          END IF 
          vertrd$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
          IF G_Vertrag% <> VS_Beginn.kvertrag AND G_Vertrag% > 0 AND VS_Beginn.kvertrag > 0 AND DateOK%(vertrd$) THEN 
            'Vertragsdatum wurde geÑndert
            zok% = - 1
          END IF 
          IF zok% = - 1 THEN 
            ' erst rÅckrechnen
            CALL ZentrAGZaehl(G_ma%,StatusZOK$,G_Bewert%,G_volume%,0,G_Antrag%,1)
            ' dann neu berechnen
            CALL ZentrAGZaehl(codema.kvertrag,"VERTRAG",Bewertungssumme.kvertrag,Volumen.kvertrag,0,VS_Beginn.kvertrag,0)
          END IF 
          ' hier berÅcksichtigen, wenn es Storno geworden ist  
          IF G_VStatus% <> CodeVStatus.kvertrag THEN 
            ' Vertrag wurde storniert
            IF codevstatus.kvertrag = 4 THEN 
              IF codema.kvertrag > 0 AND VS_Beginn.kvertrag > 0 THEN 
                REM mu· durch extra Aufrufe beim Storno realisiert werden
                REM StatusZOK.kvertrag = "STORNO"
                REM CALL ZentrAGZaehl(codema.kvertrag,"STORNO",Bewertungssumme.kvertrag,Volumen.kvertrag,0,VS_Beginn.kvertrag,0)
              END IF 
            END IF 
            'Vertrag wurde zum Antrag oder Fremdvertrag
            IF codevstatus.kvertrag = 11 OR codevstatus.kvertrag = 12 THEN 
              vertrd$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
              IF codema.kvertrag > 0 AND VS_Beginn.kvertrag > 0 AND DateOK%(vertrd$) THEN 
                REM StatusZOK.kvertrag = "STORNO"
                CALL ZentrAGZaehl(codema.kvertrag,"VERTRAG",Bewertungssumme.kvertrag,Volumen.kvertrag,0,VS_Beginn.kvertrag,1)
                StatusZOK.kvertrag = "ANTRAG"
              END IF 
            END IF 
          END IF 
        CASE "ESTORNO"
          REM CALL ZentrAGZaehl(codema.kvertrag,StatusZOK.kvertrag,Bewertungssumme.kvertrag,Volumen.kvertrag,0,KÅndigung.KVERTRAG,1)
        CASE "MSTORNO"
          REM CALL ZentrAGZaehl(codema.kvertrag,StatusZOK.kvertrag,Bewertungssumme.kvertrag,Volumen.kvertrag,0,KÅndigung.KVERTRAG,1)
        CASE "ANALYSE"
       END SELECT 
     END IF 
     IF MOD ("KVERTRAG") THEN STORE FILE "KVERTRAG"
 END SUB 


SUB KZeingang(lfdnr%)
   CALL EINGANG1(lfdnr%)
 END SUB 


SUB KNZeingang(lfdnr%)
   CALL EINGANG(lfdnr%)
 END SUB 

SUB KBuchung(lfdnr%,datei$)
 IF disabled%("BUCHUNG") THEN END SUB 
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,datei$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 _formend% = 0
 IF datei$ LIKE "BUCHUNG1" THEN 
   formname$ = "KBUCH"
 ELSE 
   formname$ = "KBUCHS"
 END IF 
 IF NOT EXISTS (lfdnr%,Codevt.datei$) THEN 
   IF GAgentDetail$ LIKE "true" THEN 
     CALL Fehler("Es existieren noch keine BuchungssÑtze zu diesem Vertrag!","Die BuchungssÑtze werden durch die Provisionsrechnung erzeugt!")
     GOTO foend291020071
   ELSE 
     REQUEST "Es sind noch keine Buchungen vorhanden!","Mîchten Sie ein Buchung erfassen?",130,req%
     IF req% = 1 THEN 
       CALL KBUNeu1(datei$)
       SELECT FORM KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
       SELECT FIRST FILE datei$ INDEX codevt.datei$
       SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
       FORM 
     ELSE 
       GOTO foend291020071
     END IF 
   END IF 
 ELSE 
 END IF 
 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   ZBsub% = 0
   IF UCASE$ ( FORM ) <> formname$ THEN 
     SET HEADING title$ + " - Buchungsdatei"
     OPEN FORM GPrjForm$ + formname$
     SET f = Superbase.Form
     FILE datei$
     INDEX Codevt.datei$
     SELECT FIRST 
     IF EXISTS (lfdnr%,Codevt.datei$) THEN 
       SELECT FORM KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
       SELECT FIRST FILE datei$ INDEX codevt.datei$
       SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
       FORM 
     ELSE 
        IF GAgentDetail$ LIKE "true" THEN 
          CALL Fehler("Es existieren noch keine BuchungssÑtze zu diesem Vertrag!","Die BuchungssÑtze werden durch die Provisionsrechnung erzeugt!")
          END SUB 
        ELSE 
          REM REQUEST "Es sind noch keine Buchungen vorhanden!","Mîchten Sie ein Buchung erfassen?",130,req%
          IF GAgentDetail$ LIKE "TRUE" THEN 
            CALL Fehler("Es sind noch keine Buchungen vorhanden!","")
            req% = 0
          ELSE 
            REQUEST "Es sind noch keine Buchungen vorhanden!","Mîchten Sie ein Buchung erfassen?",130,req%
          END IF 
          IF req% = 1 THEN 
            CALL KBUNeu1(datei$)
            SELECT FORM KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
            SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
          ELSE 
            END SUB 
          END IF 
        END IF 
     END IF 
     
     CALL MNZBUCHUNG1()
     REM CALL MNProgramm()
     MENU ON 
     SET STATUS "Buchungsdatei"
   END IF 
   REM CALL ZBUpdate()
   MOUSE ON 
   
   IF agentur.datei$ <> "" THEN maadr$ = Agentur.datei$ ELSE maadr$ = "<keine Zuordnung>"
   REM IF GAgentDetail$ LIKE "TRUE" THEN 
   IF GASP% = - 1 AND workstation% > 0 THEN 
     f.bearb.visible = 0
     f.neu.visible = 0
     f.saveit.visible = 0
     f.bbloe.visible = 0
     f.bmaadr.visible = 0
   ELSE 
     f.bearb.visible = - 1
     f.neu.visible = - 1
     f.saveit.visible = - 1
     f.bbloe.visible = - 1
     f.bmaadr.visible = - 1
   END IF 
   IF MNdisabled%("BUCHUNGLOESCHEN") THEN 
     f.bbloe.visible = 0
   END IF 
   IF MNdisabled%("BUCHUNGBEARB") THEN 
     f.bearb.visible = 0
     f.neu.visible = 0
     f.saveit.visible = 0
     f.bbloe.visible = 0
     f.bmaadr.visible = 0
   END IF 
 
   IF datei$ LIKE "BUCHUNG1" THEN 
     IF GFSC% = - 1 THEN 
       f.vorschuss.visible = - 1
       f.vorschuss.enabled = - 1
     ELSE 
       f.vorschuss.visible = 0
       f.vorschuss.enabled = 0
     END IF 
   END IF 
   FORM 
   CALL ClearKBDBuffer()
   IF ZBsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL BUPrev()
   CASE CrsRight%,PgDn%
     CALL BUNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZBsub%
   CASE 1
     codebu% = codebu.datei$
     SELECT FORM KEY codebu% FILE datei$ INDEX codebu.datei$
     IF agentur.datei$ <> "" THEN maadr$ = Agentur.datei$ ELSE maadr$ = "<keine Zuordnung>"
     FORM 
   CASE 2
     REQUEST "Wollen Sie diesen Datensatz wirklich lîschen?","",130,req%
     IF req% = 1 THEN CALL KBULoesch1(datei$)
   CASE 3
     REM Neuerfassung
     CALL KBUNeu1(datei$)
     SELECT FORM KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   CASE 4
     IF datei$ LIKE "BUCHUNG1" THEN 
       CALL BAMASuchen()
     ELSE 
       CALL BAMASuchS()
     END IF 
   CASE 5
     REM die ausgewÑhlte Buchung duplizieren und einen negativen Buchungssatz machen
     codebu% = codebu.datei$
     IF disabled%("BUCHUNGBEARB") THEN 
     ELSE 
       CALL Fehler("Sie erhalten jetzt die Mîglichkeit diese Buchung aufzuheben, dazu wird der Buchungsdatensatz dupliziert und es werden die Eurofelder und das Feld Einheiten mit -1 multipliziert!","")
       REQUEST "Wollen Sie diese Buchung gegenbuchen(aufheben)?","",130,req%
       IF req% = 1 THEN 
         dat1$ = FILE 
         FILE datei$
         ind$ = INDEX 
         INDEX codebu.datei$
         SELECT FIRST FILE datei$ INDEX codebu.datei$
         SELECT KEY codebu% FILE datei$ INDEX codebu.datei$
         FILE datei$
         INDEX codebu.datei$
         BLANK DUPLICATE 
         REM 25112004
         codebu.datei$ = SER (datei$,1)
         Betrag.datei$ = Betrag.datei$ * - 1
         MWSTBetragEU.datei$ = MWSTBetragEU.datei$ * - 1
         NettoEU.datei$ = NettoEU.datei$ * - 1
         vsv.datei$ = vsv.datei$ * - 1
         sr.datei$ = sr.datei$ * - 1
         sreu.datei$ = SR.datei$ * - 1
         Volumen.datei$ = Volumen.datei$ * - 1
         Einheiten.datei$ = einheiten.datei$ * - 1
         provision.datei$ = "j"
         buchungstext.datei$ = LEFT$ (buchungstext.datei$ + " NEG",100)
         CALL QuickStore(datei$)
         FILE dat1$
         INDEX ind$$
         SELECT FIRST FILE datei$ INDEX codevt.datei$
         SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
         SELECT FORM KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY codema.datei$ LOCK FILE "maadr" INDEX codema.maadr
         REM hier dafÅr sorgen, das Dialog zur Berechnung von SR und Einheiten kommt
         sr% = sr.datei$
         einheit% = Einheiten.datei$
         volumen% = Volumen.datei$
         CREATE DIALOG "ANPASSUNG",0,0,400,94,"manuelle Buchung","MS Sans Serif",8
         ADD DIALOG "ANPASSUNG",5,6,6,156,10,0,"manuelle Buchung"
         ADD DIALOG "ANPASSUNG",5,6,20,230,8,0,"Bitte geben Sie die SR, Einheiten und Volumen an,"
         ADD DIALOG "ANPASSUNG",5,6,30,230,8,0,"die dem Vermittler gutgeschrieben oder abgezogen werden"
         ADD DIALOG "ANPASSUNG",6,46,49,69,13,0,0,SR%,14
         ADD DIALOG "ANPASSUNG",6,169,49,69,13,0,0,einheit%,14
         ADD DIALOG "ANPASSUNG",6,292,49,69,13,0,0,volumen%,14
         ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"SR:"
         ADD DIALOG "ANPASSUNG",5,129,49,38,11,0,"Einheiten:"
         ADD DIALOG "ANPASSUNG",5,249,49,38,11,0,"Volumen:"
         REM ADD DIALOG "ANPASSUNG",5,86,52,7,8,0,""
         ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
         ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
         DIALOG "ANPASSUNG",req%
         REMOVE DIALOG "ANPASSUNG"
         IF req% = 1 THEN 
           StornoreserveEU.maadr = StornoreserveEU.maadr + sr%
           Stornoreserve.maadr = Stornoreserve.maadr + sr%
           Einheiten.maadr = Einheiten.maadr + einheit%
           IF codema.datei$ = codema.kvertrag THEN 
             EigEinheiten.maadr = EigEinheiten.maadr + einheit%
           END IF 
           IF volumen% <> 0 THEN 
             gesvolumen.maadr = Gesvolumen.maadr + volumen%
             IF codema.datei$ = codema.kvertrag THEN 
               eigvolumen.maadr = eigvolumen.maadr + volumen%
             END IF 
           END IF 

           GMaAnrede$ = Anrede.maadr
           GMaAnrede2$ = Anrede2.maadr
           GMaVorname$ = Vorname.maadr
           GMaVorname2$ = Vorname2.maadr
           GMaNachname$ = Nachname.maadr
           GMaNachname2$ = Nachname2.maadr
           GMaFirmaName$ = FirmaName.maadr
           GMaFirmaName2$ = FirmaName2.maadr
           GMaOrt$ = Ort.maadr
           GMaOrt2$ = Ort2.maadr
           GMaStrasse$ = Stra·e.maadr
           GMaStrasse2$ = Strasse2.maadr
           GMaPLZ$ = plz.maadr
           GMaPLZ2$ = plz2.maadr
           CALL QuickStore("maadr")
         END IF 
         REM ***********************************************************************
         FILE dat1$
         INDEX ind$$
         SELECT FIRST FILE datei$ INDEX codevt.datei$
         SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
       END IF 
     END IF 
   CASE 6
      formname$ = "KBUCH1"
   CASE 7
      formname$ = "KBUCH"
   CASE 8
      formname$ = "KBUCH2"
   CASE 9
     REM manuelle Erzeugung eines SR-Auszahlungssatzes
     codebu% = codebu.datei$
     IF disabled%("BUCHUNGBEARB") THEN 
     ELSE 
       CALL Fehler("Sie erhalten jetzt die Mîglichkeit zu dieser Buchung einen manullen SR-Auszahlungssatz zu erzeugen!","Die SR beim Vermittler werden entsprechend verrechnet!")
       REQUEST "Wollen Sie die SR-Zahlungs-Buchung erzeugen?","",130,req%
       IF req% = 1 THEN 
         dat1$ = FILE 
         FILE datei$
         ind$ = INDEX 
         INDEX codebu.datei$
         SELECT FIRST FILE datei$ INDEX codebu.datei$
         SELECT KEY codebu% FILE datei$ INDEX codebu.datei$
         FILE datei$
         INDEX codebu.datei$
         BLANK DUPLICATE 
         REM 25112004
         datum.datei$ = TODAY 
         FÑlligkeit.datei$ = TODAY 
         provision.datei$ = "j"
         codebu.datei$ = SER (datei$,1)
         codebu% = codebu.datei$
         Betrag.datei$ = SR.datei$
         MWSTBetragEU.datei$ = 0
         NettoEU.datei$ = SREU.datei$
         sr.datei$ = SR.datei$ * - 1
         sreu.datei$ = SR.datei$ * - 1
         Einheiten.datei$ = 0
         Volumen.datei$ = 0
         provision.datei$ = "j"
         buchungstext.datei$ = LEFT$ (buchungstext.datei$ + " SR Zahlung",100)
         CALL QuickStore(datei$)
         FILE dat1$
         INDEX ind$$
         SELECT FIRST FILE datei$ INDEX codevt.datei$
         SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
         SELECT FORM KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY codema.datei$ LOCK FILE "maadr" INDEX codema.maadr
         ma% = codema.datei$
         betr% = Betrag.datei$
         codew1% = codew.datei$
         euro1% = umrechnung.datei$
         waehrung1$ = waehrung.datei$
         REM hier dafÅr sorgen, das Dialog zur Berechnung von SR und Einheiten kommt
         sr% = betrag.datei$ * - 1
         einheit% = Einheiten.datei$
         CREATE DIALOG "ANPASSUNG",0,0,250,94,"manuelle Buchung","MS Sans Serif",8
         ADD DIALOG "ANPASSUNG",5,6,6,156,10,0,"manuelle Buchung"
         ADD DIALOG "ANPASSUNG",5,6,20,230,8,0,"Bitte geben Sie die SR,"
         ADD DIALOG "ANPASSUNG",5,6,30,230,8,0,"die dem Vermittler gutgeschrieben oder abgezogen wird"
         ADD DIALOG "ANPASSUNG",6,46,49,69,13,0,0,SR%,14
         REM ADD DIALOG "ANPASSUNG",6,169,49,69,13,0,0,einheit%,14
         ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"SR:"
         REM ADD DIALOG "ANPASSUNG",5,129,49,38,11,0,"Einheiten:"
         REM ADD DIALOG "ANPASSUNG",5,86,52,7,8,0,""
         ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
         ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
         DIALOG "ANPASSUNG",req%
         REMOVE DIALOG "ANPASSUNG"
         IF req% = 1 THEN 
           GMaAnrede$ = Anrede.maadr
           GMaAnrede2$ = Anrede2.maadr
           GMaVorname$ = Vorname.maadr
           GMaVorname2$ = Vorname2.maadr
           GMaNachname$ = Nachname.maadr
           GMaNachname2$ = Nachname2.maadr
           GMaFirmaName$ = FirmaName.maadr
           GMaFirmaName2$ = FirmaName2.maadr
           GMaOrt$ = Ort.maadr
           GMaOrt2$ = Ort2.maadr
           GMaStrasse$ = Stra·e.maadr
           GMaStrasse2$ = Strasse2.maadr
           GMaPLZ$ = plz.maadr
           GMaPLZ2$ = plz2.maadr
           StornoreserveEU.maadr = StornoreserveEU.maadr + sr%
           Stornoreserve.maadr = Stornoreserve.maadr + sr%
           zusatz% = 1
           eigen% = 1
           PSpAll$ = ""
           PSpAllSeit% = 0
           PROVSpEig$ = ""
           PSpESeit% = 0
           datumz% = TODAY 
           AuszahlAB.maadr = AuszahlAB.maadr + betr%
           AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
           zusAuszahl.maadr = zusAuszahl.maadr + betr%
           zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
           aktZusB.maadr = aktZusB.maadr + betr%
           aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
           CALL QuickStore("maadr")
           CALL ZentrKTO(ma%,datumz%,betr%,0,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
           SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
         END IF 
         REM ***********************************************************************
         FILE dat1$
         INDEX ind$$
         SELECT FIRST FILE datei$ INDEX codevt.datei$
         SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
       END IF 
     END IF 
   CASE 99
     MENU OFF 
     ENTER Datum.datei$,0
     MENU ON 
   END SELECT 
   ZBsub% = 0
 WEND 
foend291020071: 
 _formend% = 0
 END SUB 
 



SUB KBUNeu1(datei$)
 FILE datei$
 DIM LAgenturen$( RECCOUNT ("MAADR"))
 FILE "MAADR"
 INDEX CodeMA.MAADR
 SELECT FIRST 
 a% = 0
 fprompt$ = "ZZZZZZZZZZZZZZ"
 aprompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   LAgenturen$(a%) = Nachname.MAADR + ", " + Vorname.MAADR + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
   IF CodeMA.MAADR = _ma% THEN aprompt$ = LAgenturen$(a%)
   IF LAgenturen$(a%) < fprompt$ THEN fprompt$ = LAgenturen$(a%)
   a% = a% + 1
   SELECT NEXT FILE "MAADR" INDEX CodeMA.MAADR
 WEND 
 IF aprompt$ = "" THEN Auswahl$ = fprompt$ ELSE Auswahl$ = aprompt$
   FILE "Waehrung"
   INDEX waehrung.waehrung
   SELECT FIRST 
   WHILE NOT EOF ("WAEHRUNG")
     IF UCASE$ (waehrung.waehrung) = zweitwaehr$ THEN 
       euro1% = umrechnung.waehrung
       codew1% = codew.waehrung
       waehrung1$ = waehrung.waehrung
       wbez1$ = WaehrungBezeich.waehrung
     END IF 
   SELECT NEXT 
   WEND 
   SET STATUS "Zusatzbuchungen"
   MOUSE ON 
   BLANK FILE datei$
   SET STATUS "Datensatz neu angelegt..."
   Datum.datei$ = TODAY 
   Buchungstext.datei$ = "Zusatzbuchung:"
   CREATE DIALOG "ZBUCHUNG",0,0,225,179,"Zusatzbuchung fÅr den aktuellen Vertrag","MS Sans Serif",8
   ADD DIALOG "ZBUCHUNG",4,0,0,225,152,0,""
   ADD DIALOG "ZBUCHUNG",9,6,12,20,23,2
   ADD DIALOG "ZBUCHUNG",5,40,15,176,21,0,"Bitte wÑhlen Sie eine Agentur und fÅllen Sie die Felder Buchungstext und Betrag aus:"
   ADD DIALOG "ZBUCHUNG",5,40,41,29,10,0,"Agentur:"
   ADD DIALOG "ZBUCHUNG",8,40,52,175,95,259,2,Auswahl$,LAgenturen$
   ADD DIALOG "ZBUCHUNG",6,83,72,41,12,0,0,Datum.datei$,10
   ADD DIALOG "ZBUCHUNG",5,40,74,25,12,0,"Datum"
   ADD DIALOG "ZBUCHUNG",6,83,86,60,12,0,0,Betrag.datei$,20
   ADD DIALOG "ZBUCHUNG",5,40,88,37,9,0,"Betrag"
   ADD DIALOG "ZBUCHUNG",6,83,101,132,39,4,2,Buchungstext.datei$,4000
   ADD DIALOG "ZBUCHUNG",5,40,103,37,18,0,"Buchungs- text"
   ADD DIALOG "ZBUCHUNG",1,50,156,55,15,0,"&Buchen",1,1
   ADD DIALOG "ZBUCHUNG",1,108,156,55,15,0,"&Abbrechen",0,0
   DIALOG "ZBUCHUNG",req%
   REMOVE DIALOG "ZBUCHUNG"
   MOUSE OFF 
   REM 211299
   IF req% = 1 THEN 
     SET STATUS "Buchung wird gespeichert"
     CodeBU.datei$ = SER (datei$,1)
     CodeMA.datei$ = VAL ( RIGHT$ (Auswahl$,6))
     VTCodema.datei$ = codema.kvertrag
     ma% = CodeMA.datei$
     SELECT KEY ma% FILE "maadr" INDEX codema.maadr
     agentur.datei$ = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
     SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
     VTAgentur.datei$ = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
     Gesellschaft.datei$ = Gesellschaft.kvertrag
     Sparte.datei$ = Sparte.kvertrag
     codeku.datei$ = codeku.kvertrag
     SELECT KEY codeku.kvertrag FILE GAdrDat$ INDEX codeku.GAdrDat$
     nachname.datei$ = nachname.GAdrDat$
     vorname.datei$ = vorname.GAdrDat$
     datumz% = Datum.datei$
     betr% = Betrag.datei$
     codevt.datei$ = lfdnr.kvertrag
     Codew.datei$ = codew.kvertrag
     umrechnung.datei$ = umrechnung.kvertrag
     waehrung.datei$ = waehrung.kvertrag
     CALL FStore(datei$)
     codew1% = codew.datei$
     waehrung1$ = waehrung.datei$
     euro1% = umrechnung.datei$
     zusatz% = 1
     eigen% = 1
     PSpAll$ = ""
     PSpAllSeit% = 0
     PROVSpEig$ = ""
     PSpESeit% = 0
     CALL ZentrKTO(ma%,datumz%,betr%,0,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
     SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
     AuszahlAB.maadr = AuszahlAB.maadr + betr%
     AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
     zusAuszahl.maadr = zusAuszahl.maadr + betr%
     zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
     aktZusB.maadr = aktZusB.maadr + betr%
     aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
     STORE FILE "maadr"
     UNLOCK CURRENT FILE "maadr"
   ELSE 
     ok% = 0
   END IF 
   MOUSE ON 

 END SUB 


SUB KBUNeu2(datei$)
 FILE datei$
 _cma% = CodeMA.datei$
 IF Buchungstext.datei$ <> "" THEN 
   IF NEW (datei$) OR MOD (datei$) THEN CALL FStore(datei$)
 END IF 
 _cma% = GetCodeMA%(_cma%,Workstation%)
 IF _cma% <> 0 THEN 
   SELECT KEY _cma% FILE "maadr" INDEX codema.maadr
   BLANK FILE datei$
   SET STATUS "Datensatz neu angelegt..."
   agentur.datei$ = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
   codevt.datei$ = lfdnr.kvertrag
   Buchungstext.datei$ = "Zusatzbuchung:"
   CodeMA.datei$ = _cma%
   CodeBU.datei$ = SER (datei$,1)
   datum.datei$ = TODAY 
   codew.datei$ = codew.kvertrag
   waehrung.datei$ = waehrung.kvertrag
   umrechnung.datei$ = umrechnung.kvertrag
   CALL FStore(datei$)
   ma% = _cma%
   datumz% = datum.datei$
   betr% = Betrag.datei$
   zusatz% = 1
   eigen% = 1
   PSpAll$ = ""
   PSpAllSeit% = 0
   PROVSpEig$ = ""
   PSpESeit% = 0
   codew1% = codew.datei$
   waehrung1$ = waehrung.datei$
   euro1% = umrechnung.datei$
   CALL ZentrKTO(ma%,datumz%,betr%,0,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
   SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
   AuszahlAB.maadr = AuszahlAB.maadr + betr%
   AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
   zusAuszahl.maadr = zusAuszahl.maadr + betr%
   zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
   aktZusB.maadr = aktZusB.maadr + betr%
   aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
   STORE FILE "maadr"
   UNLOCK CURRENT FILE "maadr"
   ZBsub% = 99
 END IF 
 FORM 
 END SUB 
  
  
SUB KBUSichern1(datei$)
 CALL FStore(datei$)
 END SUB 
 
SUB KBULoesch1(datei$)
 lfdnr% = codevt.datei$
 IF disabled%("BUCHUNGLOESCHEN") THEN END SUB 
 cubu% = CodeBU.datei$
 REQUEST "Buchungssatz wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   SELECT KEY cubu% LOCK FILE datei$ INDEX CodeBU.datei$
   SELECT REMOVE FILE datei$
   SELECT NEXT FILE datei$
   FORM 
 END IF 
 SELECT FORM KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 SELECT KEY lfdnr% FILE datei$ INDEX codevt.datei$
 IF agentur.datei$ <> "" THEN maadr$ = Agentur.datei$ ELSE maadr$ = "<keine Zuordnung>"
 FORM 
 END SUB 
 
  
 
  

SUB VFonds(lfdnr%)
 _formend% = 0
       DIM dlg AS Dialog
       DIM control AS DialogControl 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   VERTRsub% = 0
   IF UCASE$ ( FORM ) <> "VERT023F" THEN 
     SET HEADING title$ + " - Fonds"
     OPEN FORM GPrjForm$ + "VERT023F"
     SET f = Superbase.Form
     FILE "Fonds"
     INDEX codevt.fonds
     SELECT FIRST FILE "fonds" INDEX codevt.fonds
     f.abfo.visible = 0:f.abfo.enabled = 0:f.befo.visible = - 1:f.befo.enabled = - 1:f.LOfo.visible = - 1:f.lofo.enabled = - 1
     IF NOT EXISTS (lfdnr%,codevt.fonds) THEN 
       REM 18042000
       CALL DFile(3,"stamm" + _fpw$)
       FILE "stamm"
       SELECT FIRST 
       FILE "fonds"
       BLANK FILE "fonds"
       zero.fonds = 0
       codefo% = SER ("Fonds",1)
       codefo.fonds = codefo%
       codevt.fonds = lfdnr%
       datum.fonds = TODAY 
       BKursTag.fonds = TODAY 
       WÑhrung.Fonds = waehrung.stamm
       KursEuro.Fonds = umrechnung.stamm
       CALL QuickStore("Fonds")
     END IF 
     SELECT FORM KEY lfdnr% FILE "Kvertrag" INDEX lfdnr.kvertrag
     SELECT KEY lfdnr% FILE "fonds" INDEX codevt.fonds
     FORM 
     CALL MNFo()
     MENU ON 
     SET STATUS "Fonds"
   END IF 
   REM CALL ZBUpdate()
   MOUSE ON 
   FORM 
   CALL ClearKBDBuffer()
   IF VERTRsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     REM CALL BUPrev()
   CASE CrsRight%,PgDn%
     REM CALL BUNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE VERTRsub%
   CASE 1
     codebu% = codebu.buchung1
     SELECT FORM KEY codebu% FILE "buchung1" INDEX codebu.buchung1
     IF agentur.buchung1 <> "" THEN maadr$ = Agentur.buchung1 ELSE maadr$ = "<keine Zuordnung>"
     FORM 
   CASE 3
     CALL RechKvertrag(codevt.fonds)
   CASE 2
     REQUEST "Wollen Sie diesen Datensatz wirklich lîschen?","",130,req%
     IF req% = 1 THEN CALL KBULoesch1()
   CASE 12
     f.abfo.visible = 0:f.abfo.enabled = 0:f.befo.visible = - 1:f.befo.enabled = - 1:f.LOfo.visible = - 1:f.lofo.enabled = - 1
     vform$ = FORM 
     IF vform$ LIKE "VERT023F*" THEN 
       f.berech.visible = - 1:f.foueber.visible = - 1:f.s1.visible = - 1
       GBkursTag% = Bkurstag.fonds
       GBAntPreisinW% = BAntPreisinWaeh.fonds
       GBKursEuro% = BKursEuro.fonds
       GBKursUS% = BKursUS.fonds
     END IF 
     codefo% = codefo.fonds
     SELECT FORM KEY codefo% FILE "fonds" INDEX codefo.fonds
     waehr1$ = wÑhrung.fonds
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       provberech% = PreisEuro.fonds * euro% * Ausgabenaufschl.fonds / 100
       prozFirma% = ProzFirma.fonds
       IF ProzFirma.fonds = 0 THEN ProzFirma% = 90
       prov1% = provberech% * ProzFirma% / 100
       ZEUeben$ = "Provision fÅr die Firma in DM: " + LTRIM$ ( STR$ (prov1%,",9999999999.00"))
       IF EXISTS (codeaz.fonds,codeaz.zeingan1) THEN 
         ZEUeben$ = ZEUeben$ + " -> bereits als Zahlungseingang Åbergeben"
       ELSE 
         ZEUeben$ = ZEUeben$ + " -> NOCH NICHT als Zahlungseingang Åbergeben"
       END IF 
     END IF 
     FORM 3
     REM 17042001
     IF kauf.fonds = "" THEN 
       SELECT KEY codefo% LOCK FILE "fonds" INDEX codefo.fonds
       kauf$ = kauf.fonds
 
       Superbase.Dialogs.Add("Dialogname")
       SET dlg = Superbase.Dialogs.Dialogname
       dlg.Move(0,0,113,96)
       dlg.Caption = "Auswahl"
       dlg.FontName = "MS Sans Serif"
       dlg.FontSize = 8
 
       SET control = dlg.Add("DialogFrame1","DialogFrame")
       control.Move(2,8,108,64)
       control.Caption = "Bitte wÑhlen Sie eine Option"
 
       SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
       control.Move(12,22,41,11)
       control.Caption = "Kauf"
       control.Bind("Kauf$")
       control.ValueOn = "j"
 
       SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
       control.Move(12,36,62,12)
       control.Caption = "Verkauf"
       control.Bind("Kauf$")
       control.ValueOn = "n"
 
       SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
       control.Move(12,50,76,11)
       control.Caption = "Kontoinformation"
       control.Bind("Kauf$")
       control.ValueOn = "k"
 
       SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
       control.Move(29,76,41,13)
       control.Default = 1
       control.Caption = "OK"
       control.ReturnValue = 0
       DIALOG "Dialogname",req310898%
       REMOVE DIALOG ALL 
       kauf.fonds = kauf$
       STORE FILE "fonds"
       UNLOCK CURRENT FILE "fonds"
       SELECT FORM KEY codefo% FILE "fonds" INDEX codefo.fonds
     END IF 
   CASE 13
     f.abfo.visible = - 1:f.abfo.enabled = - 1:f.befo.visible = 0:f.befo.enabled = 0:f.LOfo.visible = 0:f.lofo.enabled = 0
     IF vform$ = "VERTR023" THEN f.berech.visible = 0:f.foueber.visible = 0:f.s1.visible = 0
     BLANK FILE "fonds"
     zero.fonds = 0
     codefo% = SER ("Fonds",1)
     codefo.fonds = codefo%
     cuvt% = lfdnr.kvertrag
     codevt.fonds = lfdnr.kvertrag
     datum.fonds = TODAY 
 
       Superbase.Dialogs.Add("Dialogname")
       SET dlg = Superbase.Dialogs.Dialogname
       dlg.Move(0,0,113,96)
       dlg.Caption = "Auswahl"
       dlg.FontName = "MS Sans Serif"
       dlg.FontSize = 8
 
       SET control = dlg.Add("DialogFrame1","DialogFrame")
       control.Move(2,8,108,64)
       control.Caption = "Bitte wÑhlen Sie eine Option"
 
       SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
       control.Move(12,22,41,11)
       control.Caption = "Kauf"
       control.Bind("Kauf$")
       control.ValueOn = "j"
 
       SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
       control.Move(12,36,62,12)
       control.Caption = "Verkauf"
       control.Bind("Kauf$")
       control.ValueOn = "n"
 
       SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
       control.Move(12,50,76,11)
       control.Caption = "Kontoinformation"
       control.Bind("Kauf$")
       control.ValueOn = "k"
 
       SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
       control.Move(29,76,41,13)
       control.Default = 1
       control.Caption = "OK"
       control.ReturnValue = 0
       DIALOG "Dialogname",req310898%
       REMOVE DIALOG ALL 
       kauf.fonds = kauf$
     CALL QuickStore("Fonds")
     SELECT FORM KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
     SELECT KEY codefo% FILE "fonds" INDEX codefo.fonds
     FORM 3
     CALL FondsWaehrung()
     SELECT FORM KEY codefo% LOCK FILE "fonds" INDEX codefo.fonds
     ENTER datum.fonds,0
   CASE 14
     codefo% = codefo.fonds
     cuvt% = codevt.fonds
     REQUEST "Datensatz wirklich lîschen?","",130,req%
     IF req% = 1 THEN 
       REMOVE FROM FILE "Fonds" WHERE codefo.fonds = codefo%
       IF NOT EXISTS (cuvt%,codevt.fonds) THEN 
         _formend% = 1
         SELECT FORM KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
       ELSE 
         SELECT FORM KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
         SELECT KEY cuvt% FILE "fonds" INDEX codevt.fonds
       END IF 
       FORM 
     END IF 
   CASE 99
     MENU OFF 
     ENTER Datum.BUCHUNG1,0
     MENU ON 
   CASE 100
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       CALL FondSich()
     ELSE 
       CALL FStore("Fonds")
     END IF 
   END SELECT 
   ZBsub% = 0
 WEND 
 _formend% = 0
 FILE "Kvertrag"
 END SUB 

SUB RueckUebern(codevt%)
 codefo% = codefo.fonds
 BRÅckWaehr% = BRÅckkaufWaehr.fonds
 BKursTag% = BKursTag.fonds
 BKursZeit% = NOW 
 test$ = STR$ (codevt.fonds,"000000") + DATE$ (BKursTag.fonds,"yyyymm0d") + LEFT$ ( TIME$ (BKursZeit%,"hh:mm:ss"),2) + MID$ ( TIME$ (BKursZeit%,"hh:mm:ss"),4,2) + RIGHT$ ( TIME$ (BKursZeit%,"hh:mm:ss"),2)
 MOUSE OFF 
 UPDATE BRÅckkaufWaehr.fonds = BRÅckWaehr%:BKursTag.fonds = BKursTag:BKursZeit.fonds = BKursZeit%:QuickVTBerDat.fonds = test$ WHERE codevt.fonds = codevt%
 END UPDATE 

 CLOSE FILE "fonds"
 CALL DFile(3,"fonds" + _fpw$)
 MOUSE ON 
 SELECT KEY codefo% FILE "fonds" INDEX codefo.fonds
 f.abfo.visible = 0:f.abfo.enabled = 0:f.befo.visible = - 1:f.befo.enabled = - 1:f.LOfo.visible = - 1:f.lofo.enabled = - 1:f.berech.visible = - 1:f.foueber.visible = - 1:f.s1.visible = - 1
 FORM 3
 END SUB 


SUB FondSich()
 FILE "fonds"
 codefo% = codefo.fonds
 cuvt% = codevt.fonds
 aend% = 0
 SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
 IF MOD ("Fonds") OR NEW ("fonds") THEN 
   CALL FStore("Fonds")
   aend% = 0
 END IF 
 SELECT KEY codefo% LOCK FILE "Fonds" INDEX codefo.fonds
 testab% = PreisEuro.fonds
 umr% = kurseuro.fonds
 provberech% = PreisEuro.fonds * kurseuro.fonds * Ausgabenaufschl.fonds / 100
 prov1% = provberech% * ProzFirma.fonds / 100
 ProviDM.fonds = prov1%
 ZEUeben$ = "Provision fÅr die Firma in DM: " + LTRIM$ ( STR$ (prov1%,",9999999999.00"))
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   IF EXISTS (codeaz.fonds,codeaz.zeingan1) THEN 
     ZEUeben$ = ZEUeben$ + " -> bereits als Zahlungseingang Åbergeben"
   ELSE 
     ZEUeben$ = ZEUeben$ + " -> NOCH NICHT als Zahlungseingang Åbergeben"
   END IF 
 END IF 
 CALL FStore("Fonds")
 IF kauf.fonds <> "k" THEN 
  SELECT KEY cuvt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
  SELECT KEY codefo% FILE "Fonds" INDEX codefo.fonds
  IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   IF NOT EXISTS (codeaz.fonds,codeaz.zeingan1) THEN 
     IF Preis.fonds <> 0 AND prov1% <> 0 THEN 
       FILE "zeingan1"
       BLANK FILE "zeingan1"
       SET STATUS "Datensatz neu angelegt..."
       CodeAZ% = SER ("zeingan1",1)
       CodeAZ.zeingan1 = CodeAZ%
       vs_nr.zeingan1 = vs_nr.kvertrag
       gebuchtJN.zeingan1 = "N"
       gebuchtJNT.zeingan1 = "N"
       BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
       FÑlligkeit.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
       codevt.zeingan1 = cuvt%
       codema.zeingan1 = codema.kvertrag
       codege.zeingan1 = codege.kvertrag
         
       providmfo% = ProviDM.fonds
       REM CALL Fehler( STR$ (providmfo%,"99999.99"),"")
       IF ProviDM.fonds <> 0 THEN 
         IF kauf.fonds = "j" THEN 
           Buchungstext.zeingan1 = LEFT$ ("Courtage:" + vs_nr.kvertrag,70)
         ELSE 
           Buchungstext.zeingan1 = LEFT$ ("Courtage:" + vs_nr.kvertrag + "(Storno/Verkauf)",70)
         END IF 
       END IF 
       Ausgabeauf.zeingan1 = Ausgabenaufschl.fonds
       kondart.zeingan1 = 1
       waehrung.zeingan1 = wÑhrung.fonds
       SELECT KEY wÑhrung.fonds FILE "Waehrung" INDEX waehrung.waehrung
       codew.zeingan1 = codew.waehrung
       umrechnung.zeingan1 = kurseuro.fonds
       KundEinzahlung.zeingan1 = Preis.fonds
       KundEinzahluEU.zeingan1 = Preis.fonds / KursEuro.fonds
       AnlageDatum.zeingan1 = Datum.fonds
     
       REM provberech% = PreisEuro.fonds * euro% * Ausgabenaufschl.fonds / 100
       REM prov1% = provberech% * ProzFirma.fonds / 100
       bewertung.zeingan1 = prov1%
       bewertungEU.zeingan1 = prov1% / kurseuro.fonds
       CALL QuickStore("zeingan1")
       SELECT KEY codefo% LOCK FILE "Fonds" INDEX codefo.fonds
       codeaz.fonds = codeaz%
       STORE FILE "fonds"
     END IF 
   ELSE 
     FILE "zeingan1"
     SELECT KEY codeaz.fonds LOCK FILE "zeingan1" INDEX codeaz.zeingan1
     ok% = 0

     IF gebuchtJN.zeingan1 LIKE "j" THEN 
       a$ = "Es wurden mîglicherweise énderungen vorgenommen,die sich auf den zugehîrigen Zahlungseingang auswirken sollen! "
       CALL Fehler(a$ + "Der zugehîrige Zahlungseingang kann nicht automatisch geÑndert werden, da er schon gebucht wurde!!!","Bitte Ñndern Sie Ihn gegebenenfalls per Hand!")
     ELSE 
       ok% = 1
     END IF 
     IF ok% <> 0 THEN 
       gebuchtJN.zeingan1 = "N"
       gebuchtJNT.zeingan1 = "N"
       BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
       FÑlligkeit.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
       codevt.zeingan1 = cuvt%
       codema.zeingan1 = codema.kvertrag
       codege.zeingan1 = codege.kvertrag
         
       providmfo% = ProviDM.fonds
       REM CALL Fehler( STR$ (providmfo%,"99999.99"),"")
       IF ProviDM.fonds <> 0 THEN 
         IF kauf.fonds = "j" THEN 
           Buchungstext.zeingan1 = LEFT$ ("Courtage:" + vs_nr.kvertrag,70)
         ELSE 
           Buchungstext.zeingan1 = LEFT$ ("Courtage:" + vs_nr.kvertrag + "(Storno/Verkauf)",70)
         END IF 
       END IF 
       Ausgabeauf.zeingan1 = Ausgabenaufschl.fonds
       kondart.zeingan1 = 1
       waehrung.zeingan1 = wÑhrung.fonds
       umrechnung.zeingan1 = kurseuro.fonds
       SELECT KEY wÑhrung.fonds FILE "Waehrung" INDEX waehrung.waehrung
       codew.zeingan1 = codew.waehrung
       KundEinzahlung.zeingan1 = Preis.fonds
       KundEinzahluEU.zeingan1 = Preis.fonds / KursEuro.fonds
       AnlageDatum.zeingan1 = Datum.fonds
       REM provberech% = PreisEuro.fonds * euro% * Ausgabenaufschl.fonds / 100
       REM prov1% = provberech% * ProzFirma.fonds / 100
       bewertung.zeingan1 = prov1%
       bewertungEU.zeingan1 = prov1% / kurseuro.fonds
       CALL QuickStore("zeingan1")
     END IF 
   END IF 
  END IF 
   UNLOCK CURRENT FILE "fonds"
 END IF 
 FORM 
 END SUB 



SUB MNFo()
 CALL MNProgramm()
 MENU 1,1,0,"D&rucken","AKDrucken","AktionsÅbersicht drucken"
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,1,"&Neu,F2","AKNeu","neue Aktion hinzufÅgen"
 REM MENU 2,2,1,"S&ichern,F4","MStore","Daten der aktuellen Aktion speichern"
 MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO","letzte énderungen verwerfen"
 IF NOT MNdisabled%("AKTIONLoeschen") THEN 
   MENU 2,3,1,"&Lîschen","AKLoeschen","aktuelle Aktion lîschen"
 ELSE 
   MENU 2,3,0,"&Lîschen"
 END IF 
 MENU 3,0,1,"Be&wegen","",""
 MENU 3,1,1,"&NÑchster,BildAb","AKNext","nÑchster Datensatz"
 MENU 3,2,1,"&Vorheriger,BildAuf","AKPrev","vorheriger Datensatz"
 MENU 4,0,1,"&Optionen","",""
 MENU 4,1,1,"&Termine","AKQUISE3","Termine der aktuellen Aktion bearbeiten"
 CALL MNHilfe(5)
 END SUB 



SUB ReorgZOK()
   REQUEST "Wollen Sie wirklich alle ZÑhler und Summen neu erzeugen lassen?","",135,req%
   IF req% <> 1 THEN END SUB 
   MOUSE OFF 
   CALL DFile(3,"AUMSATZ" + _fpw$)
   CALL DFile(3,"AUMSKTO" + _fpw$)
   CALL DFile(3,"maadr" + _fpw$)
   CALL DFile(3,"kvertrag" + _fpw$)
   CALL DFile(3,"sparten" + _fpw$)
   CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
   CALL DFile(3,"maadrgru" + _fpw$)
   CALL DFile(3,"vorgang" + _fpw$)
   CALL DFile(3,"vkond" + _fpw$)
   CALL DFile(3,"formular" + _fpw$)
   CALL DFile(3,"spgruppe" + _fpw$)
   CALL DFile(3,"vpspezko" + _fpw$)
   CALL DFile(3,"spezkond" + _fpw$)
   CALL DFile(3,"vprodukt" + _fpw$)
   IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
     CALL DFile(3,"buchung1" + _fpw$)
     datbu$ = "BUCHUNG1"
   ELSE 
     CALL DFile(3,"buchung" + _fpw$)
     datbu$ = "BUCHUNG"
   END IF 
   MOUSE OFF 
   SET STATUS "AUMSATZ leeren"
   REMOVE FROM FILE "AUMSATZ"
   REMOVE FROM FILE "AUMSKTO"
   SET STATUS "KVERTRAG prÅfen"
r260520041: 
   FILE "kvertrag"
   INDEX lfdnr.kvertrag
   SELECT FIRST LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
   IF lfdnr.kvertrag < 1 THEN 
     SELECT REMOVE FILE "kvertrag"
     GOTO r260520041
   END IF 
   SET STATUS "KVERTRAG zurÅcksetzen"
   UPDATE StatusZOK.kvertrag = ""
   END UPDATE 
     CLOSE FILE "KVERTRAG"
     CALL DFile(3,"KVERTRAG" + _fpw$)
   FILE "maadr"
   INDEX codema.maadr
   SELECT FIRST LOCK 
   i% = 0
   j% = RECCOUNT ("maadr")
   WHILE NOT EOF ("maadr")
     i% = i% + 1
     SET STATUS "Mitarbeiter: " + STR$ (i%,"999999") + " von " + STR$ (j%,"999999")
     GesVolumen.maadr = 0
     EigVolumen.maadr = 0
     EigEinheiten.maadr = 0
     Einheiten.maadr = 0
     StornoreservV.maadr = 0
     EinheitenV.maadr = 0
     GesVolumenV.maadr = 0
     EigVolumenV.maadr = 0
     EigEinheitenV.maadr = 0
     AntrGes.maadr = 0
     VertGes.maadr = 0
     StornoGes.maadr = 0
     EStornoGes.maadr = 0
     MStornoGes.maadr = 0
     BWSGes.maadr = 0
     EBWSGes.maadr = 0
     MBWSGes.maadr = 0
     VolGes.maadr = 0
     KontoGes.maadr = 0
     EinheitGes.maadr = 0
     SAntrGes.maadr = 0
     SVertGes.maadr = 0
     SStornoGes.maadr = 0
     SEStornoGes.maadr = 0
     SMStornoGes.maadr = 0
     SBWSGes.maadr = 0
     SEBWSGes.maadr = 0
     SMBWSGes.maadr = 0
     SVolGes.maadr = 0
     SKontoGes.maadr = 0
     SEinheitGes.maadr = 0
     STORE FILE "maadr"
     SELECT NEXT LOCK FILE "maadr"
   WEND 
   CALL Fehler("Alles zurÅckgesetzt","")
   REQUEST "Alles zurÅckgesetzt","",2
   FILE "kvertrag"
   INDEX lfdnr.kvertrag
   SELECT FIRST LOCK 
   i% = 0
   j% = RECCOUNT ("kvertrag")
   WHILE NOT EOF ("KVERTRAG")
     i% = i% + 1
     SET STATUS STR$ (i%,"999999") + " von " + STR$ (j%,"999999")
     CALL ZokTest()
     IF MOD ("kvertrag") THEN STORE FILE "kvertrag"
     SELECT NEXT LOCK FILE "kvertrag"
   WEND 
   FILE datbu$
   INDEX codebu.datbu$
   SELECT FIRST FILE datbu$ INDEX codebu.datbu$
   i% = 0
   j% = RECCOUNT (datbu$)
   WHILE NOT EOF (datbu$)
     MOUSE OFF 
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,",9999999")) + " BuchungsdatensÑtze von " + LTRIM$ ( STR$ (j%,",9999999")) + " verarbeitet"
     codema% = codema.datbu$
     vtcodema% = vtcodema.datbu$
     cdate% = Datum.datbu$
     betr% = Betrag.datbu$
     srbetrag% = sr.datbu$
     codew% = codew.datbu$
     waehr1$ = Waehrung.datbu$
     euro1% = 1
     eigen% = 0
     zusatz% = 0
     IF Provision.datbu$ = "j" THEN 
       zusatz% = 0
     ELSE 
       zusatz% = 1
     END IF 
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
     PSpAll$ = PROVSperreAll.maadr
     PSpAllSeit% = PSperreAllSeit.maadr
     PROVSpEig$ = PROVSperreEig.maadr
     PSpESeit% = PSperreESeit.maadr
     IF codema% = vtcodema% THEN 
       eigen% = 1
     END IF 
     IF PspAll$ = "j" THEN 
       IF PSpAllSeit% <= cdate% THEN 
         AuszahlSperKo.maadr = AuszahlSperKo.maadr + betr%
         AuszahlSperKoEU.maadr = VAL ( STR$ (AuszahlSperKo.maadr / euro1%,"999999999.00"))
       END IF 
     ELSE 
       IF eigen% = 1 AND PROVSpEig$ = "j" THEN 
         IF PSpESeit% <= cdate% THEN 
           AuszahlSperKo.maadr = AuszahlSperKo.maadr + betr%
           AuszahlSperKoEU.maadr = VAL ( STR$ (AuszahlSperKo.maadr / euro1%,"999999999.00"))
         END IF 
       END IF 
     END IF 
     REM ****************************AUSZAHLUNGSSPERRE Ende**********************************  
     IF betr% >= 0 THEN 
       einheit% = Einheiten.datbu$
     ELSE 
       IF Einheiten.datbu$ > 0 THEN einheit% = Einheiten.datbu$ * - 1
     END IF 
     IF betr% >= 0 THEN 
       GesVolumen.maadr = GesVolumen.maadr + Volumen.KVERTRAG
       IF codema% = vtcodema% THEN 
         EigVolumen.maadr = EigVolumen.maadr + Volumen.KVERTRAG
       END IF 
     ELSE 
       GesVolumen.maadr = GesVolumen.maadr + (Volumen.KVERTRAG * - 1)
       IF codema% = vtcodema% THEN 
         EigVolumen.maadr = EigVolumen.maadr + (Volumen.KVERTRAG * - 1)
       END IF 
     END IF 
     IF codema% = vtcodema% THEN 
       EigEinheiten.maadr = EigEinheiten.maadr + Einheit%
       EinheitGes.maadr = EinheitGes.maadr + einheit%
     ELSE 
       sEinheitGes.maadr = sEinheitGes.maadr + einheit%
     END IF 
     Einheiten.maadr = Einheiten.maadr + Einheit%
     STORE FILE "maadr"
     UNLOCK CURRENT FILE "maadr"
     REM *****************************************************************************************************
     REM Zentralberechnung des Kontostandes
     
     CALL ZentrKTO(codema%,cdate%,betr%,SRBetrag%,codew%,euro1%,waehr1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,Einheit%)
     REM *****************************************************************************************************  
     FILE datbu$
     SELECT NEXT FILE datbu$ INDEX codebu.datbu$
   WEND 
   REQUEST "ZÑhler gesetzt","",2
   MOUSE OFF 
   CALL StruAll()
   REQUEST "Downlines ermittelt","",2
   MOUSE ON 
   CALL Fehler("Das Programm mu· jetzt beendet werden, um die neuen Werte beim Neustart laden zu kînnen!","")
   CALL EXIT()
 END SUB 



SUB ADRSich()
 IF OPEN ("gesinfo") THEN 
   IF RECCOUNT ("gesinfo") > 0 THEN REMOVE FROM FILE "gesinfo"
   REM CLOSE FILE "ADRTEMP"
 ELSE 
   CALL DFile(2,"OFFICE\gesinfo" + _fpw$)
   IF RECCOUNT ("gesinfo") > 0 THEN REMOVE FROM FILE "gesinfo"
 END IF 
     geand% = 0
     IF MOD (GTelDat$) OR NEW (GTelDat$) THEN 
       IF art.Gteldat$ <> "" OR nummer.gteldat$ <> "" THEN CALL QuickStore(GTeldat$)

       REM SELECT CURRENT LOCK FILE GTelDat$
     END IF 
     ON ERROR GOTO ErrorHandler
     REM GNachnameADR$,GVornameADR$,GGebname$,GPLZADR$,GOrtADR$,GStrasseADR$
     IF GBerlimex% = - 1 THEN 
       ffehl$ = ""
       IF LTRIM$ (Anrede.GADRDat$) = "" THEN 
         ffehl$ = "Feld Anrede wurde nicht ausgefÅllt!"
         CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
         feld$ = "Anrede." + GADRDat$
         ENTER feld$$,0
         GOTO end110520041
       END IF 
       IF LTRIM$ (Vorname.GADRDat$) = "" THEN 
         ffehl$ = ffehl$ + "Feld Vorname/z.H. wurde nicht ausgefÅllt!"
         CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
         feld$ = "Vorname." + GADRDat$
         ENTER feld$$,0
         GOTO end110520041 
       END IF 
       IF LTRIM$ (Nachname.GADRDat$) = "" THEN 
         ffehl$ = ffehl$ + "Feld Nachname/Firma wurde nicht ausgefÅllt!"
         CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
         feld$ = "Nachname." + GADRDat$
         ENTER feld$$,0
         GOTO end110520041 
       END IF 
       IF LTRIM$ (PLZ.GADRDat$) = "" THEN 
         ffehl$ = ffehl$ + "Feld PLZ wurde nicht ausgefÅllt!"
         CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
         feld$ = "PLZ." + GADRDat$
         ENTER feld$$,0
         GOTO end110520041 
       END IF 
       IF LTRIM$ (Ort.GADRDat$) = "" THEN 
         ffehl$ = ffehl$ + "Feld Ort wurde nicht ausgefÅllt!"
         CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
         feld$ = "Ort." + GADRDat$
         ENTER feld$$,0
         GOTO end110520041 
       END IF 
       IF LTRIM$ (Stra·e.GADRDat$) = "" THEN 
         ffehl$ = ffehl$ + "Feld Stra·e wurde nicht ausgefÅllt!"
         CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
         feld$ = "Stra·e." + GADRDat$
         ENTER feld$$,0
         GOTO end110520041 
       END IF 
       IF Geburtstag.GADRDat$ < 1 THEN 
         ffehl$ = ffehl$ + "Feld (Geburtstag/FirmengrÅndung wurde nicht korrekt ausgefÅllt!"
         CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
         feld$ = "Geburtstag." + GADRDat$
         ENTER feld$$,0
         GOTO end110520041 
       END IF 
       REM CALL ProtAll(codeku.GADRDat$,GADRDAT$ + " wurde geÑndert-Fehler:" + ffehl$,Nachname.GADRDAt$,0,"",0,"")
       REM IF LTRIM$ (ffehl$) <> "" THEN CALL Fehler(ffehl$,"Bitte korrigieren Sie diese/n Fehler!")
     END IF 
     IF GVornameADR$ = "" AND Vorname.GAdrDat$ <> "" THEN geand% = - 1
     IF GNachnameADR$ = "" AND Nachname.GAdrDat$ <> "" THEN geand% = - 1
     IF GGebname$ = "" AND Geburtsname.GAdrDat$ <> "" THEN geand% = - 1
     IF GOrtADR$ = "" AND Ort.GAdrDat$ <> "" THEN geand% = - 1
     IF GPLZADR$ = "" AND plz.GAdrDat$ <> "" THEN geand% = - 1
     IF GStrasseADR$ = "" AND Stra·e.GAdrDat$ <> "" THEN geand% = - 1
     IF GLandADR$ = "" AND Land.GAdrDat$ <> "" THEN geand% = - 1
     IF GVornameADR$ <> "" AND GVornameADR$ <> Vorname.GAdrDat$ THEN geand% = - 2
     IF GNachnameADR$ <> "" AND GName$ <> "NEU" AND GNachnameADR$ <> Nachname.GAdrDat$ THEN geand% = - 2
     IF GGebname$ <> "" AND GGebname$ <> Geburtsname.GAdrDat$ THEN geand% = - 2
     IF GOrtADR$ <> "" AND GOrtADR$ <> Ort.GAdrDat$ THEN geand% = - 2
     IF GLandADR$ <> "" AND GLandADR$ <> land.GADRDat$ THEN geand% = - 2
     IF GPLZADR$ <> "" AND plz.GAdrDat$ <> GPLZADR$ THEN geand% = - 2
     IF GStrasseADR$ <> "" AND Stra·e.GAdrDat$ <> GStrasseADR$ THEN geand% = - 2

     egand% = 0
     IF GOrtADR$ <> "" AND GOrtADR$ = EGASOrt.GAdrDat$ AND ort.GADRDat$ <> EGASOrt.GAdrDat$ THEN egAND% = - 1
     IF GPLZADR$ <> "" AND EGASplz.GAdrDat$ = GPLZADR$ AND EGASplz.GAdrDat$ <> plz.GADRDat$ THEN egand% = - 1
     IF GStrasseADR$ <> "" AND EGASStra·e.GAdrDat$ = GStrasseADR$ AND EGASStra·e.GAdrDat$ <> Stra·e.GADRDat$ THEN egand% = - 1
     IF geand% = - 1 THEN 
       REQUEST "PLZ,Ort oder Stra·e wurden geÑndert?","Wollen Sie diese énderung auch fÅr den Lebenspartner Åbernehmen?",130,req%
       IF req% = 1 THEN 
         EGASStra·e.GAdrDat$ = Stra·e.GADRDat$
         EGASplz.GAdrDat$ = plz.GADRDat$
         EGASOrt.GAdrDat$ = ort.GADRDat$
       END IF 
     END IF 


           IF GBlz1$ <> K1blz.GADRDat$ THEN geand% = - 3
           IF GBLZ2$ <> K2blz.GADRDat$ THEN geand% = - 3
           IF GBLZ3$ <> K3blz.GADRDat$ THEN geand% = - 3
           IF GBank1$ <> K1bank.GADRDat$ THEN geand% = - 3
           IF GBank2$ <> K2bank.GADRDat$ THEN geand% = - 3
           IF GBank3$ <> K3bank.GADRDat$ THEN geand% = - 3
           IF GKonto1$ <> K1Konto.GADRDat$ THEN geand% = - 3
           IF GKonto2$ <> K2Konto.GADRDat$ THEN geand% = - 3
           IF GKonto3$ <> K3Konto.GADRDat$ THEN geand% = - 3
           IF GKontoinh1$ <> Kontoinh1.GADRDat$ THEN geand% = - 3
           IF GKontoinh2$ <> Kontoinh2.GADRDat$ THEN geand% = - 3
           IF GKontoinh3$ <> Kontoinh3.GADRDat$ THEN geand% = - 3

     telaend% = 0
     IF GTelefon1$ <> Telefon1.GADRDat$ THEN 
       telaend% = - 1
     END IF 


     IF geand% = - 2 THEN 
       REQUEST "Ein oder mehrere Felder, die zur Anschrift gehîren, wurden geÑndert?","Wollen Sie das Postanschriftsfeld neu erzeugen lassen?",130,req%
       IF req% = 1 THEN 
         geand% = - 1
       ELSE 
         geand% = 0
         IF GZP% = - 1 THEN 
           IF GBerlimex% = - 1 THEN 
             IF ffehl$ = "" THEN 
               CALL ProtAll(codeku.GADRDat$,GADRDAT$ + " wurde geÑndert",Kundennummer.GADRDat$ + "," + Nachname.GADRDAt$,0,"",0,"")
             ELSE 
               CALL ProtAll(codeku.GADRDat$,GADRDAT$ + " wurde geÑndert-Fehler: " + ffehl$,Kundennummer.GADRDat$ + "," + Nachname.GADRDAt$,0,"",0,"")
             END IF 
           ELSE 
             CALL ProtAll(codeku.GADRDat$,GADRDAT$ + " wurde geÑndert",Kundennummer.GADRDat$ + "," + Nachname.GADRDAt$,0,"",0,"")
           END IF 
         END IF 
       END IF 
     END IF 
     IF Postanschrift.GAdrDat$ = "" OR geand% = - 1 THEN 
       p$ = ""
       IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
         p$ = Anrede.GAdrDat$ + CHR$ (13) + CHR$ (10)
         IF LTRIM$ (Titel.GAdrDat$) <> "" THEN 
           p$ = p$ + LTRIM$ (Titel.GAdrDat$) + " "
         END IF 
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (Vorname.GAdrDat$) + " " + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10) + land.GADRDat$ + CHR$ (13) + CHR$ (10)
         REM p$ = p$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
       ELSE 
         IF LTRIM$ (Anrede.GAdrDat$) <> "" THEN 
         p$ = LTRIM$ (Anrede.GAdrDat$) + " "
         END IF 
         IF LTRIM$ (titel.GAdrDat$) <> "" THEN 
           p$ = p$ + LTRIM$ (titel.GAdrDat$)
         END IF 
         IF LTRIM$ (Anrede.GAdrDat$) <> "" OR LTRIM$ (titel.GAdrDat$) <> "" THEN 
           p$ = p$ + CHR$ (13) + CHR$ (10)
         END IF 
         IF geburtsname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (nachname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (geburtsname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (Vorname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (Vorname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10) + land.GADRDat$ + CHR$ (13) + CHR$ (10)
         REM IF land.GAdrDat$ <> "" THEN p$ = p$ + CHR$ (13) + CHR$ (10) + Land.GAdrDat$
         
       END IF 
       Adrtemp$ = p$
       lauf1% = 0
       CREATE DIALOG "MakeAdr",0,0,273,206,"Postanschriftsfeld","MS Sans Serif",8
       ADD DIALOG "MakeAdr",4,0,0,272,155,0,""
       ADD DIALOG "MakeAdr",9,3,10,21,22,2
       ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse im Postanschriftsfeld gespeichert werden soll:"
       ADD DIALOG "MakeAdr",6,30,33,236,106,68,2,Adrtemp$,1800
       ADD DIALOG "MakeAdr",2,30,160,160,10,0,"Land mit aufnehmen","j","n",Kontrollland$
       ADD DIALOG "MakeAdr",2,30,170,160,10,0,"Briefanrede mit aufnehmen","j","n",Kontrollfeld$
       ADD DIALOG "MakeAdr",1,73,185,55,15,1,"&Weiter",1,1
       ADD DIALOG "MakeAdr",1,129,185,55,15,0,"&Abbrechen",0,0
       DIALOG "MakeAdr",req%
       REMOVE DIALOG "MakeAdr"
       IF req% = 1 THEN 
         IF Kontrollland$ = "j" THEN 
           IF land.GAdrDat$ <> "" THEN 
             Adrtemp$ = Adrtemp$ + CHR$ (13) + CHR$ (10) + Land.GAdrDat$
             lauf1% = 1
           END IF 
         END IF 
         IF Kontrollfeld$ = "j" THEN 
           IF briefanrede.GAdrDat$ <> "" THEN 
             Adrtemp$ = Adrtemp$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
             lauf1% = 1
           END IF 
         END IF 
         IF lauf1% = 1 THEN 
           CREATE DIALOG "MakeAdr",0,0,273,206,"Postanschriftsfeld","MS Sans Serif",8
           ADD DIALOG "MakeAdr",4,0,0,272,155,0,""
           ADD DIALOG "MakeAdr",9,3,10,21,22,2
           ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse im Postanschriftsfeld gespeichert werden soll:"
           ADD DIALOG "MakeAdr",6,30,33,236,106,68,2,Adrtemp$,1800
           ADD DIALOG "MakeAdr",2,30,160,160,10,0,"Land mit aufnehmen","j","n",Kontrollland$
           ADD DIALOG "MakeAdr",2,30,170,160,10,0,"Briefanrede mit aufnehmen","j","n",Kontrollfeld$
           ADD DIALOG "MakeAdr",1,73,185,55,15,1,"&Weiter",1,1
           ADD DIALOG "MakeAdr",1,129,185,55,15,0,"&Abbrechen",0,0
           DIALOG "MakeAdr",req%
           REMOVE DIALOG "MakeAdr"
         END IF 
         IF req% = 1 THEN 
           
           PostanschrAlt.GAdrDat$ = Postanschrift.GAdrDat$
           Postanschrift.GAdrDat$ = Adrtemp$
           Postanschrift$ = Adrtemp$
           PostanschrAlt$ = PostanschrAlt.GAdrDat$
         END IF 
       END IF 
     END IF 
     CALL MATimeStamp(GAdrDat$)
     CALL QuickStore(GAdrDat$)
     IF GZP% = - 1 AND geand% <> 0 THEN 
       IF GBerlimex% = - 1 THEN 
         IF ffehl$ = "" THEN 
           CALL ProtAll(codeku.GADRDat$,GADRDAT$ + " wurde geÑndert",Nachname.GADRDAt$,0,"",0,"")
         ELSE 
           CALL ProtAll(codeku.GADRDat$,GADRDAT$ + " wurde geÑndert-Fehler: " + ffehl$,Nachname.GADRDAt$,0,"",0,"")
         END IF 
       ELSE 
         CALL ProtAll(codeku.GADRDat$,GADRDAT$ + " wurde geÑndert",Nachname.GADRDAt$,0,"",0,"")
       END IF 
     END IF 
     REM CALL Fehler("Hier fragen, ob die Gesellschaften informiert werden sollen, bei denen AntrÑge oder lebende VertrÑge vorliegen","")
     IF geand% <> 0 AND geand% <> - 3 THEN 
       REM VNehmer in Vertragsdatei Ñndern?
       IF EXISTS (codeku.GAdrDat$,codeku.kvertrag) AND GAdrDat$ LIKE "ADRESSEN" THEN 
         CALL DFile(3,"geadr" + _fpw$)

         DIM SerieGes%( RECCOUNT ("GEADR"))
         REQUEST "Sollen die geÑnderten Adressangaben bei allen AntrÑgen und","lebenden VertrÑgen in das Feld <VNehmer> eingetragen werden?",130,req1%
         IF req1% = 1 THEN 
           SELECT FIRST FILE "Kvertrag" INDEX codeku.kvertrag
           SELECT KEY codeku.adressen LOCK FILE "KVERTRAG" INDEX codeku.kvertrag
           WHILE NOT EOF ("KVERTRAG") AND codeku.kvertrag = codeku.adressen
             codege% = codege.kvertrag
             REM nur lebend, antrag, ruhend, beitragsfrei
             SELECT CASE codevstatus.kvertrag
               CASE 1,2,3,5,6,7,8,9,11,12,14
                 REM *****************************************************************************
                 gef% = 0
                 REM fÅr Serienbrief an Gesellschaften
                 FOR i% = 0 TO RECCOUNT ("GEADR")
                   REM wenn nur die Gesellschaft einmal angeschrieben werden soll
                   REM IF SerieGes%(i%) > 0 THEN 
                   REM   IF SerieGes%(i%) = codege% THEN 
                   REM     i% = RECCOUNT ("GEADR") + 1
                   REM     gef% = - 1
                   REM   END IF 
                   REM ELSE 
                     SerieGes%(i%) = codege%
                     CALL GesInfo(codege%,Postanschrift$,PostanschrAlt$,vs_nr.kvertrag)
                     i% = RECCOUNT ("GEADR") + 1
                   REM END IF 
                 NEXT i%
                 REM *****************************************************************************

                 ANachname.kvertrag = nachname.GAdrDat$
                 AVorname.kvertrag = vorname.GAdrDat$
                 AStrasse.kvertrag = Stra·e.GAdrDat$
                 AOrt.kvertrag = Ort.GAdrDat$
                 APLZ.kvertrag = Plz.GAdrDat$
                 VNehmer.kvertrag = LEFT$ ( LTRIM$ ( TRIM$ (Nachname.adressen)) + "," + LTRIM$ ( TRIM$ (vorname.adressen)) + "," + LTRIM$ ( TRIM$ (Stra·e.adressen)) + "," + LTRIM$ ( TRIM$ (PLZ.adressen + " " + Ort.adressen + "," + land.adressen)),210)
                 STORE FILE "KVERTRAG"
                 UNLOCK CURRENT FILE "KVERTRAG"
             END SELECT 
             SELECT NEXT LOCK FILE "KVERTRAG" INDEX codeku.kvertrag
           WEND 
           req1% = 0
           REQUEST "Sollen die involvierten Gesellschaften"," Åber die AdressÑnderung informiert werden?",130,req1%
           IF req1% = 1 THEN 
             REM gesinfo nach xls ausgeben
             IF EXISTS (GMACodeDir$ + "GESINFO.XLS") THEN DELETE GMACodeDir$ + "GESINFO.XLS"
             Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
             Superbase.Converters.SBF.SourceFile = "GESINFO"
             Superbase.Converters.SBF.Descending = 0
             Superbase.Converters.SBF.Merge = 0
             Superbase.Converters.SBF.LogErrors = 0
             Superbase.Converters.SBF.MultiResponse = 0
             Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
             Superbase.Converters.XLS.DestFile = GMACodeDir$ + "GESINFO.XLS"
             Superbase.Converters.XLS.StartRow = 2
             Superbase.Converters.XLS.StartCol = 1
             Superbase.Converters.XLS.EndRow = - 1
             Superbase.Converters.XLS.EndCol = - 1
             Superbase.Converters.XLS.UseLabels = - 1
             Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
             WAIT FOR 1
             CALL TextAnz(GMACodeDir$ + "GESINFO.XLS")
           END IF 
         END IF 
       END IF 
     END IF 
     REM KontoÑnderung
     IF geand% = - 3 THEN 
       IF EXISTS (codeku.GAdrDat$,codeku.kvertrag) AND GAdrDat$ LIKE "ADRESSEN" THEN 
         CALL Fehler("geÑnderte Bankverbindung","")
         REQUEST "Sollen die geÑnderten Kontoangaben bei allen","hiervon betroffenen lebenden VertrÑgen/AntrÑgen geÑndert werden?",130,req1%
         IF req1% = 1 THEN 
           SELECT WHERE FILE "kvertrag"
           SELECT FIRST FILE "Kvertrag" INDEX codeku.kvertrag
           SELECT KEY codeku.adressen LOCK FILE "KVERTRAG" INDEX codeku.kvertrag
           WHILE NOT EOF ("KVERTRAG") AND codeku.kvertrag = codeku.adressen
             f1$ = "CodeVStatus.kvertrag"
             IF f1$$ = 01 OR f1$$ = 02 OR f1$$ = 03 OR f1$$ = 05 OR f1$$ = 06 OR f1$$ = 07 OR f1$$ = 08 OR f1$$ = 12 OR f1$$ = 14 THEN 
               IF k1blz.kvertrag <> "" AND GBlz1$ = k1blz.kvertrag AND GBank1$ = k1bank.kvertrag AND GKonto1$ = K1konto.kvertrag AND GKontoinh1$ = Kontoinh.kvertrag THEN 
                 k1blz.kvertrag = K1blz.GADRDat$
                 k1Bank.kvertrag = K1bank.GADRDat$
                 K1Konto.kvertrag = K1Konto.GADRDat$
                 Kontoinh.kvertrag = Kontoinh1.GADRDat$
                 STORE FILE "KVERTRAG"
                 CALL GesInfo(codege.kvertrag,Postanschrift.GADRDat$,"",vs_nr.kvertrag)
               END IF 
               IF k1blz.kvertrag <> "" AND GBlz2$ = k1blz.kvertrag AND GBank2$ = k1bank.kvertrag AND GKonto2$ = K1konto.kvertrag AND GKontoinh2$ = Kontoinh.kvertrag THEN 
                 k1blz.kvertrag = K2blz.GADRDat$
                 k1Bank.kvertrag = K2bank.GADRDat$
                 K1Konto.kvertrag = K2Konto.GADRDat$
                 Kontoinh.kvertrag = Kontoinh2.GADRDat$
                 STORE FILE "KVERTRAG"
                 CALL GesInfo(codege.kvertrag,Postanschrift.GADRDat$,"",vs_nr.kvertrag)
               END IF 
               IF k1blz.kvertrag <> "" AND GBlz3$ = k1blz.kvertrag AND GBank3$ = k1bank.kvertrag AND GKonto3$ = K1konto.kvertrag AND GKontoinh3$ = Kontoinh.kvertrag THEN 
                 k1blz.kvertrag = K3blz.GADRDat$
                 k1Bank.kvertrag = K3bank.GADRDat$
                 K1Konto.kvertrag = K3Konto.GADRDat$
                 Kontoinh.kvertrag = Kontoinh3.GADRDat$
                 STORE FILE "KVERTRAG"
                 CALL GesInfo(codege.kvertrag,Postanschrift.GADRDat$,"",vs_nr.kvertrag)
               END IF 
             END IF 
             UNLOCK CURRENT FILE "KVERTRAG"
             SELECT NEXT LOCK FILE "KVERTRAG" INDEX codeku.kvertrag
           WEND 
         END IF 
 REM**************************************************
           REQUEST "Sollen die involvierten Gesellschaften"," Åber die BankÑnderung informiert werden?",130,req1%
           IF req% = 1 THEN 
             REM gesinfo nach xls ausgeben
             IF EXISTS (GMACodeDir$ + "GESINFO.XLS") THEN DELETE GMACodeDir$ + "GESINFO.XLS"
             Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
             Superbase.Converters.SBF.SourceFile = "GESINFO"
             Superbase.Converters.SBF.Descending = 0
             Superbase.Converters.SBF.Merge = 0
             Superbase.Converters.SBF.LogErrors = 0
             Superbase.Converters.SBF.MultiResponse = 0
             Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
             Superbase.Converters.XLS.DestFile = GMACodeDir$ + "GESINFO.XLS"
             Superbase.Converters.XLS.StartRow = 2
             Superbase.Converters.XLS.StartCol = 1
             Superbase.Converters.XLS.EndRow = - 1
             Superbase.Converters.XLS.EndCol = - 1
             Superbase.Converters.XLS.UseLabels = - 1
             Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
             WAIT FOR 1
             CALL TextAnz(GMACodeDir$ + "GESINFO.XLS")
           END IF 
 REM**************************************************
       END IF 
     END IF 

     IF telaend% = - 1 THEN 
       SELECT FIRST FILE GTeldat$ INDEX codeku.GTElDat$
       SELECT KEY codeku.GADRDat$ LOCK FILE GTeldat$ INDEX codeku.GTElDat$
       codeku% = codeku.GADRDat$
       WHILE NOT EOF (GTeldat$) AND codeku.Gteldat$ = codeku%
         IF nummer.Gteldat$ LIKE GTelefon1$ THEN 
           codetel% = Codetel.GTELDAT$
           nummer.Gteldat$ = Telefon1.GADRDat$
           CALL QuickStore(GTeldat$)
         END IF 
         SELECT NEXT LOCK FILE GTeldat$ INDEX codeku.GTElDat$
       WEND 
     END IF 
     GVornameADR$ = Vorname.GAdrDat$
     GNachnameADR$ = Nachname.GAdrDat$
     GGebname$ = Geburtsname.GAdrDat$
     GOrtADR$ = Ort.GAdrDat$
     GPLZADR$ = plz.GAdrDat$
     GStrasseADR$ = Stra·e.GAdrDat$
     GLandADR$ = Land.Gadrdat$
           GGeburtstag% = Geburtstag.GADRDat$
           GBlz1$ = K1blz.GADRDat$
           GBLZ2$ = K2blz.GADRDat$
           GBLZ3$ = K3blz.GADRDat$
           GBank1$ = K1bank.GADRDat$
           GBank2$ = K2bank.GADRDat$
           GBank3$ = K3bank.GADRDat$
           GKonto1$ = K1Konto.GADRDat$
           GKonto2$ = K2Konto.GADRDat$
           GKonto3$ = K3Konto.GADRDat$
           GKontoinh1$ = Kontoinh1.GADRDat$
           GKontoinh2$ = Kontoinh2.GADRDat$
           GKontoinh3$ = Kontoinh3.GADRDat$
           GTelefon1$ = Telefon1.GADRDat$
     REM SELECT FORM CURRENT LOCK FILE GADRDat$
     REM SELECT FORM CURRENT LOCK FILE GTelDat$
     REM ENTER art.GTelDat$,0
     knr% = codeku.GADRDat$
     geand% = 0
 REM CALL ADRIntro()
 REM CALL ADRFeldnamen()
 REM SELECT FORM KEY knr% FILE GTELDat$ INDEX codeku.GTeldat$
 REM FORM 
end110520041: 
 MOUSE ON 
 END SUB 
 



SUB GesInfo(codege%,PostNeu$,PostAlt$,vs_nr$)
 CALL DFile(3,"geadr" + _fpw$)
 SELECT FIRST FILE "geadr" INDEX codege.geadr
 SELECT KEY codege% FILE "geadr" INDEX codege.geadr
 BLANK FILE "gesinfo"
 anGesellschaft.gesinfo = Postanschrift.geadr
 KundeAlt.gesinfo = PostAlt$
 KundeNeu.gesinfo = PostNeu$
 Policenummer.gesinfo = vs_nr$
 bank.gesinfo = K1bank.kvertrag
 blz.gesinfo = k1blz.kvertrag
 konto.gesinfo = k1konto.kvertrag
 STORE FILE "gesinfo"
 END SUB 

 REM *****************************************************************************************************************
 REM *                  AUSDRUCK der Mitarbeiterstruktur                                                             *
 REM *****************************************************************************************************************

SUB StruDruck(codema%)
    REM SET ANSICONVERT OFF 
    REDIM GHilfstru$(20000)
    REDIM GHilfstru%(20000)
    FILE "maadr"
    macount% = 0
    REDIM Nachfolger%(1,1)
    REDIM VorgÑnger%(1,1)
    SELECT KEY codema% FILE "maadr" INDEX codema.maadr
    adr$ = "Die StrukturÅbersicht wird ab dem Vermittler " + nachname.maadr + "," + vorname.maadr + "erstellt"
    CALL Fehler(adr$,"Wenn Sie die öbersicht Åber die gesamte Struktur wÅnschen, dann suchen Sie die Firma und betÑtigen dann den Button <Ausdruck der Struktur>")
    adr$ = nachname.maadr + "," + vorname.maadr
    MOUSE OFF 
    SELECT FIRST FILE "maadr" INDEX codema.maadr
    WHILE NOT EOF ("maadr")
        IF (codema.maadr <> vorgÑnger.maadr) AND (vorgÑnger.maadr > 0) AND (codema.maadr > 0) THEN 
           SET STATUS nachname.maadr + " gefunden"
            macount% = macount% + 1
            REDIM Nachfolger%(macount%)
            REDIM VorgÑnger%(macount%)
            Nachfolger%(macount%) = codema.maadr
            VorgÑnger%(macount%) = vorgÑnger.maadr
        END IF 
        SELECT NEXT FILE "maadr" INDEX codema.maadr
   WEND 
   IF EXISTS (GMACodeDir$ + "mastruk.ini") THEN DELETE GMACodeDir$ + "mastruk.ini"
   OPEN GMACodeDir$ + "mastruk.ini" FOR OUTPUT 

   ? FN ansi("StrukturÅbersicht ab Vermittler ") + FN ansi(adr$) + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy")
   REM ? ""
   REM ? LTRIM$ ( STR$ (macount%,"999999")) + FN ansi(" Mitarbeiter der Struktur")
   ? ""
   ? ""
   Ganzdown% = 0
   REM CALL Fehler(adr$,"")
   CALL MAStrDruck(codema%,"")
   REM CALL Fehler( STR$ (Ganzdown%),"")
   ? ""
   ? ""
   ? ""
   ? FN ansi("Ende der StrukturÅbersicht") + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy")
   ? FN ansi("Anzahl Vermittler in der Downline: ") + LTRIM$ ( STR$ (Ganzdown% - 1,"999999"))
   CLOSE OUTPUT 
     ww% = 1
     i% = 0
     MOUSE OFF 
     WHILE NOT EXISTS (GMACodeDir$ + "mastruk.ini") AND i% < 9990000
       i% = i% + 1
       IF i% = 10000 THEN 
         REQUEST "Die zu erstellende Datei " + GMACodeDir$ + "mastruk.ini wurde nicht gefunden!","Soll der Versuch Sie zu îffnen abgebrochen werden?",130,req%
         IF req% = 1 THEN 
           i% = 9991000
           ww% = 0
         END IF 
       END IF 
     WEND 
     MOUSE ON 
   IF EXISTS (GMACodeDir$ + "mastruk.ini") AND ww% > 0 THEN a% = CALL ("ShellExecute",0,"open",GMACodeDir$ + "mastruk.ini","","",1)
   REM CALL "notepad.exe c:\mastruk.ini"
 END SUB 


SUB MAStrDruck(codema%,lines$)
    Ganzdown% = Ganzdown% + 1
    horz$ = "-"
    vert$ = "|"
    einstieg$ = vert$ + horz$
    codema2% = codema%
    atest$ = ""
 
    'fÅrs Baum-Zeichnen: die Anzahl der direkten Nachfolger bestimmen
    pos% = 0
    FOR pos% = 1 TO macount%
        'den nÑchsten Nachfolger von codema2% bestimmen
        IF (VorgÑnger%(pos%) = codema2%) THEN 
            maxNachfolger% = Nachfolger%(pos%)
        END IF 
    NEXT pos%
    
    'Ausgabe des (aktuellen) VorgÑngers
    SELECT FIRST FILE "maadr" INDEX codema.maadr
    SELECT KEY codema% FILE "maadr" INDEX codema.maadr
    IF LTRIM$ (agenturnr.maadr) <> "" THEN 
      adr$ = LTRIM$ (agenturnr.maadr) + ", " + LTRIM$ (Nachname.maadr)
    ELSE 
      adr$ = LTRIM$ (Nachname.maadr)
    END IF 
    IF LTRIM$ (vorname.maadr) <> "" THEN adr$ = adr$ + ", " + LTRIM$ (vorname.maadr)
    IF LTRIM$ (plz.maadr) <> "" THEN adr$ = adr$ + ", " + LTRIM$ (plz.maadr)
    IF LTRIM$ (ort.maadr) <> "" THEN adr$ = adr$ + " " + LTRIM$ (ort.maadr)
    IF LTRIM$ (stra·e.maadr) <> "" THEN adr$ = adr$ + ", " + LTRIM$ (stra·e.maadr)

    adr$ = adr$ + " (" + STR$ (stufe.maadr,"000.") + ")"
    IF nichtaktiv.maadr = "j" THEN 
      adr$ = adr$ + "  nicht mehr aktiv"
    END IF 
    IF KÅndigung.maadr > 0 THEN 
      adr$ = adr$ + " KÅndigung zum: " + DATE$ (KÅndigung.maadr,"0d.mm.yyyy")
    END IF 
    IF AusgeschAm.maadr > 0 THEN 
      adr$ = adr$ + " Ausgeschieden am: " + DATE$ (AusgeschAm.maadr,"0d.mm.yyyy")
    END IF 
    SET STATUS adr$ + " gedruckt"
    ? FN ansi(adr$)
    GHilfstru$(GhstruI%) = GHilfstru$(GhstruI%) + adr$
    GHilfstru%(GhstruI%) = codema.maadr
    GhstruI% = GhstruI% + 1
    REM CALL Fehler(adr$,"1")
    tempstufe% = stufe.maadr
 
    pos% = 0
     REM atest$ = atest$ + adr$
     REM CALL Fehler(atest$,"1")
     WHILE pos% < macount% + 1
        'den nÑchsten Nachfolger von codema2% bestimmen
        IF (VorgÑnger%(pos%) = codema2%) THEN 
            IF (Nachfolger%(pos%) = maxNachfolger%) THEN 
                sublines$ = lines$ + "  "
            ELSE 
                sublines$ = lines$ + vert$ + " "
            END IF 
            ? lines$ + einstieg$;'die Einstiegs-Linie fÅr den Nachfolger   
            GHilfstru$(GhstruI%) = GHilfstru$(GhstruI%) + lines$ + einstieg$
            atest$ = lines$ + einstieg$ + adr$
            REM CALL Fehler(atest$,"2")
            CALL MAStrDruck(Nachfolger%(pos%),sublines$)
        END IF 
 
        pos% = pos% + 1
    WEND 
    
    IF tempstufe% = 2 THEN ? lines$'sieht besser aus
 
 END SUB 
  



 REM *****************************************************************************************************************
 REM *                  Ermittlung der Mitarbeiterdownline-Anzahl                                                         *
 REM *****************************************************************************************************************
SUB StruAll()
 FILE "maadr"
 INDEX codema.maadr
 SELECT FIRST LOCK 
 MOUSE OFF 
 jjj% = 0
 abc% = RECCOUNT ("maadr")
 WHILE NOT EOF ("maadr")
   IF stufe.maadr < 1 OR nachname.maadr LIKE "ohne Zuord*" OR nichtaktiv.maadr = "j" THEN 
   ELSE 
    jjj% = jjj% + 1
     SET STATUS "Ermittlung der Downline-Mitglieder " + STR$ (jjj%) + " von " + STR$ (abc%)
     Ganzdown% = 0
     jcodema% = codema.maadr
     CALL StruEinzel(codema.maadr)
     FILE "maadr"
     INDEX codema.maadr
     SELECT KEY jcodema% LOCK FILE "maadr" INDEX codema.maadr
     IstMAAnz.maadr = Ganzdown% - 1
     STORE FILE "maadr"
     UNLOCK CURRENT FILE "maadr"
   END IF 
   SELECT NEXT LOCK FILE "maadr"
 WEND 
 MOUSE ON 
 SET STATUS ""
 END SUB 


SUB StruEinzel(codema%)
    REM SET ANSICONVERT OFF 
    
    
    FILE "maadr"
    macount% = 0
    SELECT KEY codema% FILE "maadr" INDEX codema.maadr
    adr$ = "Die StrukturÅbersicht wird ab dem Vermittler " + nachname.maadr + "," + vorname.maadr + "erstellt"
    REM CALL Fehler(adr$,"Wenn Sie die öbersicht Åber die gesamte Struktur wÅnschen, dann suchen Sie die Firma und betÑtigen dann den Button <Ausdruck der Struktur>")
    adr$ = nachname.maadr + "," + vorname.maadr
    MOUSE OFF 
    SELECT FIRST FILE "maadr" INDEX codema.maadr
    WHILE NOT EOF ("maadr")
        IF (codema.maadr <> vorgÑnger.maadr) AND (vorgÑnger.maadr > 0) AND (codema.maadr > 0) AND nichtaktiv.maadr <> "j" THEN 
           SET STATUS nachname.maadr + " gefunden"
            macount% = macount% + 1
            REDIM Nachfolger%(macount%)
            REDIM VorgÑnger%(macount%)
            Nachfolger%(macount%) = codema.maadr
            VorgÑnger%(macount%) = vorgÑnger.maadr
        END IF 
        SELECT NEXT FILE "maadr" INDEX codema.maadr
   WEND 
   REM Ganzdown% = 0
   CALL MAStrCreate(codema%,"")
   REDIM Nachfolger%( RECCOUNT ("maadr"))
   REDIM VorgÑnger%( RECCOUNT ("maadr"))
 END SUB 
 
 
SUB MAStrCreate(codema%,lines$)
    Ganzdown% = Ganzdown% + 1
    horz$ = "-"
    vert$ = "|"
    einstieg$ = vert$ + horz$
    codema2% = codema%
 
 
    'fÅrs Baum-Zeichnen: die Anzahl der direkten Nachfolger bestimmen
    pos% = 0
    FOR pos% = 1 TO macount%
        'den nÑchsten Nachfolger von codema2% bestimmen
        IF (VorgÑnger%(pos%) = codema2%) THEN 
            maxNachfolger% = Nachfolger%(pos%)
        END IF 
    NEXT pos%
    
    'Ausgabe des (aktuellen) VorgÑngers
    SELECT FIRST FILE "maadr" INDEX codema.maadr
    SELECT KEY codema% FILE "maadr" INDEX codema.maadr
    IF LTRIM$ (agenturnr.maadr) <> "" THEN 
      adr$ = LTRIM$ (agenturnr.maadr) + ", " + LTRIM$ (Nachname.maadr)
    ELSE 
      adr$ = LTRIM$ (Nachname.maadr)
    END IF 
    IF LTRIM$ (vorname.maadr) <> "" THEN adr$ = adr$ + ", " + LTRIM$ (vorname.maadr)
    IF LTRIM$ (plz.maadr) <> "" THEN adr$ = adr$ + ", " + LTRIM$ (plz.maadr)
    IF LTRIM$ (ort.maadr) <> "" THEN adr$ = adr$ + " " + LTRIM$ (ort.maadr)
    IF LTRIM$ (stra·e.maadr) <> "" THEN adr$ = adr$ + ", " + LTRIM$ (stra·e.maadr)
    adr$ = adr$ + " (" + STR$ (stufe.maadr,"000.") + ")"
    REM SET STATUS adr$ + " gedruckt"
    REM ? FN ansi(adr$)
    tempstufe% = stufe.maadr
 
    pos% = 0
    
    WHILE pos% < macount% + 1
        'den nÑchsten Nachfolger von codema2% bestimmen
        IF (VorgÑnger%(pos%) = codema2%) THEN 
            IF (Nachfolger%(pos%) = maxNachfolger%) THEN 
                sublines$ = lines$ + "  "
            ELSE 
                sublines$ = lines$ + vert$ + " "
            END IF 
            REM ? lines$ + einstieg$;'die Einstiegs-Linie fÅr den Nachfolger   
            CALL MAStrCreate(Nachfolger%(pos%),sublines$)
        END IF 
 
        pos% = pos% + 1
    WEND 
        
    REM IF tempstufe% = 2 THEN ? lines$'sieht besser aus
 
 END SUB 





 REM *****************************************************************************************************************
 REM *                  AUSDRUCK der KontostÑnde                                                                     *
 REM *****************************************************************************************************************
  
SUB ProvMADruck(codema%)
  REM KontostÑnde der MA drucken
  a$ = "Es werden jetzt die KontostÑnde der Vermittler gedruckt. Folgende Bedingung muss erfÅllt sein:"
  b$ = "Checkbox -Provisionssperre generell- darf nicht gesetzt sein"
  CALL Fehler(a$,b$)
  REQUEST "Mîchten Sie die KontostÑnde jetzt drucken lassen?","",135,req%
  IF req% <> 1 THEN END SUB 
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,286,91)
    dlg.Caption = "Art des Ausdruckes"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(5,12,183,16)
    control.Caption = "KontostÑnde aller Vermittler drucken"
    control.Bind("a%")
    control.ValueOn = 0
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(5,30,279,16)
    control.Caption = "KontostÑnde aller Vermittler drucken, die >= der Auszahlungsschwelle sind"
    control.Bind("a%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
    control.Move(5,48,279,16)
    control.Caption = "KontostÑnde <> 0 aller Vermittler drucken, die < der Auszahlungsschwelle sind"
    control.Bind("a%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(116,70,40,14)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 0
    DIALOG "Dialogname",req310898%
    REMOVE DIALOG ALL 
    CALL MAZAKT(a%)
 END SUB 


SUB MAZAKT(a%)
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,420,91)
    dlg.Caption = "Spezifizerung des Ausdruckes"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(5,12,400,16)
    control.Caption = "KontostÑnde mit Summe Zusatzbuchungen, mit Summe der bisherigen Auszahlungen, mit Stornoreservekontostand"
    control.Bind("b%")
    control.ValueOn = 0
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(5,30,400,16)
    control.Caption = "KontostÑnde ohne Zusatzbuchungen, ohne bisherigen Auszahlungen, mit Stornoreservekontostand (Briefform)"
    control.Bind("b%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
    control.Move(5,48,400,16)
    control.Caption = "KontostÑnde ohne Zusatzbuchungen, ohne bisherigen Auszahlungen und ohne Stornoreservekontostand(Briefform)"
    control.Bind("b%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(180,70,40,14)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 0
    DIALOG "Dialogname",req310898%
    REMOVE DIALOG ALL 
 IF b% = 0 THEN 
   CALL PRep("MAZAKT")
 END IF 
 IF b% = 1 THEN 
   CALL PRep("MAZAKT1")
 END IF 
 IF b% = 2 THEN 
   CALL PRep("MAZAKT2")
 END IF 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY ON 
 SET QUERY LOCK OFF 
 IF a% = 1 THEN 
   SELECT ;
     WHERE CodeMA.MAADR > 0 AND PROVSperreAll.maadr <> "j" AND AuszahlSchw.maadr <= AuszahlAB.maadr AND AuszahlAB.maadr <> 0
     ORDER REPORT Nachname.MAADR
     TO ASK 
 END IF 
 IF a% = 0 THEN 
   SELECT ;
     WHERE CodeMA.MAADR > 0 AND PROVSperreAll.maadr <> "j"
     ORDER REPORT Nachname.MAADR
     TO ASK 
  END IF 
 IF a% = 2 THEN 
   SELECT ;
     WHERE CodeMA.MAADR > 0 AND PROVSperreAll.maadr <> "j" AND AuszahlAB.maadr <> 0 AND AuszahlAB.maadr < AuszahlSchw.maadr
     ORDER REPORT Nachname.MAADR
     TO ASK 
 END IF 
 
 END SELECT 
 END SUB 
 

 REM *****************************************************************************************************************
 REM *                  Ende-AUSDRUCK der KontostÑnde                                                                *
 REM *****************************************************************************************************************
 


 REM *****************************************************************************************************************
 REM *                  Verrechnung der KontostÑnde                                                                  *
 REM *****************************************************************************************************************
SUB MAKtoVerrech()
  CALL DFile(3,"MAAUSZ" + _fpw$)
  a$ = "Es werden jetzt die ~KontostÑnde der zur VerfÅgung stehenden AuszahlungsbetrÑge~ mit den ~KontostÑnden der erolgten Auszahlungen~ verrechnet!"
  b$ = "der Vermittler verrechnet. Folgende Bedingungen mÅssen erfÅllt sein: Checkbox -Provisionssperre generell- darf nicht gesetzt sein, der Kontostand des zur VerfÅgung stehenden Auszahlungsbetrages mu· > der Auszahlungsschwelle sein"
  CALL Fehler(a$,b$)
  REQUEST "Mîchten Sie die KontostÑnde jetzt verechnen lassen?","",135,req%
  IF req% <> 1 THEN END SUB 
  REQUEST "Sind Sie sich vîllig sicher, da· alle KontostÑnde korrekt sind?","Das Verrechnen kann nicht rÅckgÑngig gemacht werden!",135,req%
  IF req% <> 1 THEN END SUB 
  FILE "maadr"
  INDEX codema.maadr
  SELECT FIRST LOCK 
  i% = 0
  MOUSE OFF 
  FILE "maausz"
  ixkuktoz% = FILEINFO ("MAAUSZ",1)
  DIM ixkukto$(ixkuktoz%)
  FILLARRAY ixkukto$,1
  FILE "maadr"
  WHILE NOT EOF ("Maadr")
    i% = i% + 1
    SET STATUS STR$ (i%,"999999") + " " + nachname.maadr + " wird verarbeitet"
    IF CodeMA.MAADR > 0 AND PROVSperreAll.maadr <> "j" AND AuszahlSchw.maadr <= AuszahlAB.maadr AND AuszahlAB.maadr > 0 THEN 
      BLANK FILE "MAAUSZ"
      FOR j% = 0 TO ixkuktoz% - 1
        ON ERROR GOTO kto23120101
        ff$ = UCASE$ (ixkukto$(j%))
        IF ff$ LIKE "CODEAUSZ" OR ff$ LIKE "BETRAG*" OR ff$ LIKE "DATUM" OR ff$ LIKE "CODEW" OR ff$ LIKE "WAEHR*" OR ff$ LIKE "QM*" OR ff$ LIKE "QA*" OR ff$ LIKE "AGSP*" THEN 
        ELSE 
          feld1$ = ixkukto$(j%) + ".MAAUSZ"
          feld2$ = ixkukto$(j%) + ".MAADR"
          feld1$$ = feld2$$
        END IF 
kto23120101: 
      NEXT j%
      ON ERROR GOTO ErrorHandler
      CodeAusz.maausz = SER ("maausz",1)
      Betrag.maausz = AuszahlAB.maadr
      BetragEU.maausz = AuszahlEUAB.maadr
      Datum.maausz = TODAY 
      QMADate.MAAUSZ = STR$ (Codema.maausz,"000000") + DATE$ (Datum.maausz,"yyyymm0d")
      QMAGRDate.maausz = STR$ (CodeMAGR.maausz,"000000") + DATE$ (Datum.maausz,"yyyymm0d")
      QAGDIRDate.maausz = STR$ (CodeAGDIR.maausz,"000000") + DATE$ (Datum.maausz,"yyyymm0d")
      STORE FILE "maausz"
      UNLOCK CURRENT FILE "maausz"
      FILE "maadr"
      erfAuszahlAB.maadr = erfAuszahlAB.maadr + AuszahlAB.maadr
      erfAuszahlEUAB.maadr = erfAuszahlEUAB.maadr + AuszahlEUAB.maadr
      AuszahlAB.maadr = 0
      AuszahlEUAB.maadr = 0
      AuszProvABGes.maadr = 0
      AuszProvABGesEU.maadr = 0
      aktZusB.maadr = 0
      aktZusBEU.maadr = 0
      letzteVerrech.maadr = TODAY 
      STORE FILE "maadr"
      UNLOCK CURRENT FILE "maadr"
    END IF 
    FILE "maadr"
    SELECT NEXT LOCK FILE "maadr" INDEX codema.maadr
  WEND 
  MOUSE ON 
  REQUEST "Verarbeitung beendet!","",2
 END SUB 
 REM *****************************************************************************************************************
 REM *                  Ende-Verrechnung der KontostÑnde                                                             *
 REM *****************************************************************************************************************
 




SUB DokFilt()
 cfile$ = FILE 
 FILE GDokDat$
 cudok% = CodeDOK.GDokDat$
 codeku% = codeku.GAdrDat$
 caption$ = "Auswahl: Dokumentengruppe"
 CREATE DIALOG "AUSWDok",0,0,202,227,title$,"MS Sans Serif",8
 ADD DIALOG "AUSWDok",5,28,6,174,8,0,"Bitte geben Sie an, Åber welche "
 ADD DIALOG "AUSWDok",9,4,9,20,21,2
 ADD DIALOG "AUSWDok",5,28,16,174,9,0,"Dokumentengruppe der Filter gesetzt werden soll:"
 ADD DIALOG "AUSWDok",5,28,27,174,8,0,""
 ADD DIALOG "AUSWDok",7,5,37,169,159,2,0,DOKGruppen$,Auswahl$,Gruppe.GDokDat$
 ADD DIALOG "AUSWDok",1,86,201,55,16,1,"&OK",1,1
 ADD DIALOG "AUSWDok",1,142,201,55,16,0,"&Abbruch",0,0
 DIALOG "AUSWDok",req%
 REMOVE DIALOG "AUSWDok"
 IF req% = 1 THEN 
   Gruppe$ = UCASE$ (Auswahl$(0))
   SELECT WHERE FILE GDokDat$
   SELECT FIRST FILE GDokDat$
   GCodeDok$ = Gruppe$
   IF GCodeDok$ <> "kein Filter" THEN 
     dokfi$ = "Dokumentengruppen-Filter: " + Gruppe$
   ELSE 
     dokfi$ = "Dokumentengruppen-Filter: kein Filter"
   END IF 
   REM bef$ = "Select where codeku.GDokDat$ = codeku% AND ucase$(Gruppe.GDokDat$) like Gruppe$ file ~dokument~"
   bef$ = "Select where FILE ~dokument~ codeku.GDokDat$ = codeku% "
   IF GCodeDok$ <> "kein Filter" THEN 
     EXECUTE bef$
   ELSE 
     SELECT WHERE FILE GDokDat$
   END IF 

 END IF 
 MOUSE ON 
 REM SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 FILE cfile$
 REM SELECT FORM FIRST 
 REM FORM 
 
 END SUB 




 ' Dokument importieren
 ' ======================================================================
 
SUB DOKMAImport(dat$,dateiname$,code%)
 cudok% = CodeDOK.dat$
 cdir$ = DIRECTORY 
 cfile$ = FILE 
 FILE dat$
 opt% = 1
   IF dat$ LIKE "DOKMA" OR dat$ LIKE "DOKGE" OR dat$ LIKE "DOKKV" THEN 
     opt% = 2
     IF GSofortFile$ LIKE "j" THEN 
       IF dat$ LIKE "DOKKV" THEN 
         req% = 1
         GOTO w230120051 
       END IF 
     END IF 
   ELSE 
     opt% = 2
     IF GSofortFile$ LIKE "j" THEN 
       req% = 1
       GOTO w230120051
     END IF 
   END IF 
  
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("DOKNEU")
    SET dlg = Superbase.Dialogs.DOKNEU
    dlg.Move(0,0,270,111)
    dlg.Caption = "Dokument anlegen"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(6,8,172,29)
    control.Caption = "Sie haben jetzt die folgenden Mîglichkeiten"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(21,48,234,12)
    control.Caption = "leeres Word-Dokument anlegen (z.B. um von dort aus einzuscannen)"
    control.Bind("opt%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(21,62,234,13)
    control.Caption = "eine vorhandene Datei importieren (z.B. Bilder, Dokumente usw.)"
    control.Bind("opt%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(37,84,50,15)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1

    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(90,84,50,15)
    REM control.Default = 1
    control.Caption = "Abbruch"
    control.ReturnValue = 0

     DIALOG "DOKNEU",req%
     REMOVE DIALOG "DOKNEU"
 IF req% <> 1 THEN END SUB 
w230120051: 
 ON ERROR GOTO w230120052
 neudir$ = GScandir$
 IF GScandir$ = "" OR GScandir$ LIKE "leer" THEN 
   GScanDir$ = "C:\"
   IF gasp% = - 1 THEN 
     neudir$ = "P:\"
     GScanDir$ = "P:\"
   END IF 
 ELSE 
   neudir$ = ""
 END IF 
  IF GCodie% = - 1 AND GoldScanVerf$ <> "TRUE" AND GScanDir$ <> neudir$ THEN 
   REGISTER _netpath$ + "CODieLIB.dll","_SBCreateDir","IF"
   a% = CALL ("_SBCreateDir",GScanDir$)
   REGISTER CLEAR "_SBCreateDir"
   REGISTER _netpath$ + "CODieLIB.dll","_SBSetCurrentDir","IF"
   a% = CALL ("_SBSetCurrentDir",GScanDir$)
   REGISTER CLEAR "_SBSetCurrentDir"
 ELSE 
   DIRECTORY GScanDir$
 END IF 
 GOTO f141020054
w230120052: 
 ON ERROR GOTO ErrorHandler
 CALL Fehler("Das definierte Importverzeichnis: " + GScanDir$ + " ist ungÅltig, es wird deshalb jetzt erstmal auf C:\ gesetzt, um eine Weiterarbeit zu ermîglichen!","")
 REM GScanDir$ = "C:\"
f141020054: 
 IF opt% = 1 THEN 
   textvorlage$ = _netpath$ + "OFFICE\text\0w97." + _WPSuffix$
   req% = 1
 ELSE 
   textvorlage$ = "*.*"
   REM REQUEST "Dokument importieren","",26,req%,textvorlage$
   IF Gcodie% = - 1 AND GoldScanVerf$ <> "TRUE" THEN 
     iniPath$ = GScanDir$
     IF inipath$ LIKE "" THEN iniPath$ = "C:\"
     REM REGISTER _netpath$ + "CODieLIB.dll","_SelectFile","IFFF"
     REM a% = CALL ("_SelectFile",texttitel$,iniPath$,textvorlage$)
     REM REGISTER CLEAR "_SelectFile"

     inifile$ = GMACodeDir$ + "codiesf0.ini"
     exefile$ = GMACodeDir$ + "codiesf0.exe"
     a% = CALL ("_SBFileExists",inifile$)
     IF a% = - 1 THEN 
       a% = CALL ("_SBFileDelete1",inifile$)
     END IF 
 
     a% = 1
     CALL WriteINIDes("DATA","ScanDir",GScanDir$,inifile$)
     CALL WriteINIDes("DATA","Titel","Auswahl der zu importierenden Datei",inifile$)
     CALL WriteINIDes("DATA","Filter","*.*",inifile$)
     IF EXISTS (GMACodeDir$ + "sready.ini") THEN 
       DELETE GMACodeDir$ + "sready.ini"
     END IF 
     i% = CALL ("ShellExecute",0,"open",exefile$,"","",1)
     zz% = 0
     WHILE NOT EXISTS (GMACodeDir$ + "sready.ini")
       zz% = zz% + 1
       MOUSE OFF 
       WAIT FOR 1
       IF zz% = 60 THEN 
         CALL Fehler("Irgendwas ist beim ôffnendialog schiefgegangen!","")
         GOTO w230120055
       END IF 
     WEND 
     inipath$ = ReadINIDes$("DATA","Importfile",inifile$)
     IF inipath$ = "" OR inipath$ = "leer" THEN 
       CALL Fehler("Es wurde keine zu importierende Datei ausgewÑhlt!","Der Import abgebrochen!")
       REM GOTO end130620051
       a% = 0
     ELSE 
       a% = CALL ("_SBFileExists",iniPath$)
     END IF 
     DIRECTORY cdir$
     IF a% = - 1 THEN 
       req% = 1
       REM ziel$ = GMACodeDir$ + "tt.doc"
       endung$ = GetDateiendung$(iniPath$)
       ziel$ = GMACodeDir$ + "tt." + endung$
       REM CALL Fehler(ziel$,"")
       REM IF EXISTS (ziel$) THEN DELETE ziel$
       a% = CALL ("_SBFileExists",ziel$)
       IF a% = - 1 THEN 
         a% = CALL ("_SBFileDelete1",ziel$)
       END IF 
       a% = CALL ("_SBFileCopy",iniPath$,ziel$)
       IF a% = - 1 THEN 
         REM CALL Fehler(ziel$,"Kopieren hat geklappt")
         textvorlage$ = ziel$
       ELSE 
         textvorlage$ = iniPath$
       END IF 
     END IF 
   ELSE 
     REQUEST "Dokument importieren","",26,req%,textvorlage$
     DIRECTORY cdir$
     IF req% = 1 AND EXISTS (textvorlage$) THEN 
       a% = - 1
     END IF 
   END IF 
 END IF 
 IF req% = 1 THEN 
    a% = CALL ("_SBFileExists",textvorlage$)
    IF a% = - 1 THEN 
     REM IF EXISTS (textvorlage$) THEN 
     IF FORM LIKE "*MA*" THEN 
       Gruppe$ = "Mitarbeiterdokument"
     END IF 
     vdokf% = 0
     fo$ = FORM 
     IF FORM LIKE "Ver*" OR FORM LIKE "Ker*" OR FORM LIKE "Rer*" OR FORM LIKE "Wer*" OR FORM LIKE "DOKGESKV*" OR FORM LIKE "DOKKV*" THEN vdokf% = 1
     IF FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN vdokf% = 1
     IF vdokf% = 1 THEN 
       Gruppe$ = "VertrÑge"
       dokname$ = VS_NR.kvertrag
     END IF 
     IF FORM LIKE "DOKGEGE*" THEN 
       Gruppe$ = "Gesellschaftsdokument"
     END IF 
     CREATE DIALOG "DOKNEU",0,0,250,147,title$,"MS Sans Serif",8
     ADD DIALOG "DOKNEU",5,28,10,205,9,0,"Bitte geben Sie fÅr das Dokument eine Bezeichnung ein."
     ADD DIALOG "DOKNEU",9,4,12,20,21,2
     ADD DIALOG "DOKNEU",5,28,19,134,9,0,"(diese kann bis zu 60 Zeichen enthalten)"
     REM ADD DIALOG "DOKNEU",5,28,34,214,10,0,"Bei Bedarf kînnen Sie auch die Zuordnung zu einer Dokumenten-"
     REM ADD DIALOG "DOKNEU",5,28,44,53,10,0,"gruppe Ñndern."
     ADD DIALOG "DOKNEU",5,28,93,79,9,0,"&Bezeichnung"
     ADD DIALOG "DOKNEU",6,28,103,208,12,0,0,dokname$,60
     REM ADD DIALOG "DOKNEU",5,28,62,65,8,0,"&Gruppe"
     REM ADD DIALOG "DOKNEU",8,28,72,140,48,259,2,Gruppe$,DOKGruppen$
     ADD DIALOG "DOKNEU",1,80,126,49,15,1,"&OK",1,1
     ADD DIALOG "DOKNEU",1,130,126,50,14,0,"&Abbrechen",0,0
     DIALOG "DOKNEU",req%
     REMOVE DIALOG "DOKNEU"
     jamo$ = LEFT$ ( DATE$ ( TODAY ,"yyyymm0d"),6)
     IF req% = 1 THEN 
       IF FORM LIKE "*MA*" THEN 
         docpath0$ = _netpath$ + "PROVIS\MAADR.DOK"
         docpath$ = "PROVIS\MAADR.DOK\" + jamo$
         docpath1$ = _netpath$ + docpath$
         IF GCodie% = - 1 THEN 
           ON ERROR GOTO w090120061
           REGISTER _netpath$ + "CODieLIB.dll","_SBCreateDir","IF"
           a% = CALL ("_SBCreateDir",docpath0$)
           a% = CALL ("_SBCreateDir",docpath1$)
           REGISTER CLEAR "_SBCreateDir"
         ELSE 
           ON ERROR GOTO w090120061a
           MAKE DIRECTORY docpath0$
           MAKE DIRECTORY docpath1$
w090120061a: 
           ON ERROR GOTO w090120061
           MAKE DIRECTORY docpath1$
         END IF 
w090120061: 
         ON ERROR GOTO ErrorHandler
       END IF 
       dokp% = 0
       IF FORM LIKE "Ver*" OR FORM LIKE "Ker*" OR FORM LIKE "Rer*" OR FORM LIKE "Wer*" OR FORM LIKE "DOKGESKV*" OR FORM LIKE "DOKKV*" THEN dokp% = 1
       IF FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN dokp% = 1
       IF dokp% = 1 THEN 
         docpath0$ = _netpath$ + "PROVIS\VERTR.DOK"
         docpath$ = "PROVIS\VERTR.DOK\" + jamo$
         docpath1$ = _netpath$ + docpath$
         IF GCodie% = - 1 THEN 
           ON ERROR GOTO w090120062
           REGISTER _netpath$ + "CODieLIB.dll","_SBCreateDir","IF"
           a% = CALL ("_SBCreateDir",docpath0$)
           a% = CALL ("_SBCreateDir",docpath1$)
           REGISTER CLEAR "_SBCreateDir"
         ELSE 
           ON ERROR GOTO w090120062
           MAKE DIRECTORY docpath0$
           MAKE DIRECTORY docpath1$
         END IF 
w090120062: 
         ON ERROR GOTO w090120062a
         MAKE DIRECTORY docpath1$
w090120062a: 
         ON ERROR GOTO ErrorHandler 
       END IF 
       IF FORM LIKE "DOKGEGE*" THEN 
         docpath0$ = _netpath$ + "PROVIS\GEADR.DOK"
         docpath$ = "PROVIS\GEADR.DOK\" + jamo$
         docpath1$ = _netpath$ + docpath$
         IF GCodie% = - 1 THEN 
           ON ERROR GOTO w090120063
           REGISTER _netpath$ + "CODieLIB.dll","_SBCreateDir","IF"
           a% = CALL ("_SBCreateDir",docpath0$)
           a% = CALL ("_SBCreateDir",docpath1$)
           REGISTER CLEAR "_SBCreateDir"
         ELSE 
           ON ERROR GOTO w090120063
           MAKE DIRECTORY docpath0$
           MAKE DIRECTORY docpath1$
         END IF 
w090120063: 
         ON ERROR GOTO w090120063a
         MAKE DIRECTORY docpath1$
w090120063a: 
         ON ERROR GOTO ErrorHandler 
       END IF 
       ON ERROR GOTO mpath15052001
       MAKE DIRECTORY _netpath$ + docpath$
mpath15052001: 
       ON ERROR GOTO ErrorHandler
       IF RIGHT$ (docpath$,1) <> "\" THEN docpath$ = docpath$ + "\"

       MOUSE OFF 
       SET STATUS "Dokument in Arbeit..."
       BLANK FILE dat$
       CodeDOK.dat$ = SER (dat$,1)
       cudok% = CodeDOK.dat$
       IF dokname$ <> "" THEN 
         dokument.dat$ = dokname$
       ELSE 
         dokument.dat$ = textvorlage$
       END IF 
       erstellt_am.dat$ = TODAY 
       letzte_Bearbeit.dat$ = TODAY 
       CodeMA.dat$ = GMAcodema%
       codeku.dat$ = code%
       IF dat$ LIKE "DOKKV" THEN codevg.dat$ = Gcuvg%
       SELECT KEY codema.dat$ FILE "supervis" INDEX codema.supervis
       Bearbeiter.dat$ = nachname.supervis
       Creator.dat$ = nachname.supervis
       endung$ = GetDateiendung$(textvorlage$)
       textdatei$ = docpath$ + LTRIM$ ( STR$ (CodeDOK.dat$,"99999999")) + "." + endung$
       REM Dateiname.dat$ = MID$ (textdatei$,3, LEN (textdatei$) - 2)
       Dateiname.dat$ = textdatei$
       dateiname$ = Dateiname.dat$
       Gruppe.dat$ = Gruppe$
       link.dat$ = 0
       CALL QuickStore(dat$)
       REM COPY textvorlage$,_netpath$ + textdatei$
       ziel$ = _netpath$ + textdatei$
       a% = CALL ("_SBFileCopy",textvorlage$,ziel$)
       REM **************************************************
       REM in originale Dokumentendatei eine Kopie ablegen
       dokvf% = 0
       IF FORM LIKE "Ver*" OR FORM LIKE "Ker*" OR FORM LIKE "Rer*" OR FORM LIKE "Wer*" OR FORM LIKE "DOKGESKV*" OR FORM LIKE "DOKKV*" THEN dokvf% = 1
       IF FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN dokvf% = 1
       IF dokvf% = 1 THEN 
         FILE "Dokument"
         BLANK 
         CodeDOK.Dokument = SER ("Dokument",1)
         dokument.Dokument = dokument.dat$
         erstellt_am.Dokument = TODAY 
         letzte_Bearbeit.Dokument = TODAY 
         CodeMA.Dokument = GMAcodema%
         REM cc% = codeku.kvertrag
         CodeKU.Dokument = codeku.kvertrag
         Bearbeiter.Dokument = Bearbeiter.dat$
         Creator.Dokument = Creator.dat$
         Dateiname.Dokument = Dateiname.dat$
         Gruppe.Dokument = Gruppe.dat$
         link.Dokument = 0
         CALL QuickStore("Dokument")
         SELECT KEY knr% FILE GADRDat$ INDEX codeku.GadrDat$
         REQUEST "Eintrag in Termindatei vornehmen?","",130,raa%
         IF raa% = 1 THEN CALL ADRDokRegister(CodeDOK.Dokument)
         ddtest$ = Dateiname.dat$
       END IF 
       REM ***********************************************
       FILE dat$
     END IF 
   ELSE 
     ON ERROR GOTO ErrorHandler
     IF textvorlage$ = "*.*" THEN 
     ELSE 
       CALL Fehler("Dokument konnte nicht gefunden werden!","")
     END IF 
   END IF 
 END IF 
 SELECT KEY cudok% FILE dat$ INDEX CodeDOK.dat$
 FORM 
 MOUSE ON 
 FILE cfile$
 DIRECTORY cdir$
 END SUB 
 



SUB MADRDok(codema%,feld$)
madrdo1206200101: 
     IF LTRIM$ (feld$$) = "" THEN 
       dateiname$ = feld$$
       CALL DOKMAImport("DOKMA",dateiname$,codema%)
       IF dateiname$ = "" THEN GOTO emadrdok1206200101
       SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
       feld$$ = dateiname$
       STORE FILE "maadr"
       UNLOCK CURRENT FILE "maadr"
       GOTO madrdo1206200101
     ELSE 
       textdatei$ = _netpath$ + feld$$
       REM IF EXISTS (textdatei$) THEN 
       a% = CALL ("_SBFileExists",textdatei$)
       IF a% = - 1 THEN 
         
         REM i% = CALL ("ShellExecute",0,"open",textdatei$,"","",1)
         i% = 0
         CALL TextAnz(textdatei$)
         REM CALL Fehler("Serie","")
         IF i% <= 32 THEN 
           IF (i% = 31) OR (i% = 2) THEN 
             CALL Fehler("Das benîtigte Bearbeitungsprogramm konnte nicht gefunden werden!","Bitte wÑhlen Sie das Bearbeitungsprogramm aus.")
             WordProc$ = "*.EXE"
             REQUEST "Programm fÅr " + UCASE$ ( RIGHT$ (textdatei$,3)) + "-Dateien...","",26,req%,WordProc$
             IF req% = 1 THEN 
               CALL WordProc$ + " " + textdatei$
             END IF 
           END IF 
         END IF 
       ELSE 
         CALL Fehler("Das Dokument " + textdatei$ + " konnte nicht gefunden werden!","")
         REQUEST "Mîchten Sie das Dokument erneut importieren?","",130,req%
         IF req% = 1 THEN 
           dateiname$ = ""
           CALL DOKMAImport("DOKMA",dateiname$,codema%)
           SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
           feld$$ = dateiname$
           STORE FILE "maadr"
           UNLOCK CURRENT FILE "maadr"
         END IF 
       END IF 
     END IF 
emadrdok1206200101: 
   IF dschufa.maadr <> "" THEN dschufa$ = "ÆÆÆ"
   IF dpsa.maadr <> "" THEN dpsa$ = "ÆÆÆ"
   IF davad.maadr <> "" THEN davad$ = "ÆÆÆ"
   IF dpol.maadr <> "" THEN dpol$ = "ÆÆÆ"
   IF dgew.maadr <> "" THEN dgew$ = "ÆÆÆ"
   IF dgwa.maadr <> "" THEN dgwa$ = "ÆÆÆ"
   IF dhauptber.maadr <> "" THEN dhauptber$ = "ÆÆÆ"
   IF dhnot.maadr <> "" THEN dhnot$ = "ÆÆÆ"
   IF dbernot.maadr <> "" THEN dbernot$ = "ÆÆÆ"
   IF dbwb.maadr <> "" THEN dbwb$ = "ÆÆÆ"
   IF d34c.maadr <> "" THEN d34c$ = "ÆÆÆ"
 END SUB 




 REM Dokument neu
SUB MADRDokNeu(codema%,feld$)
madrdoneu1206200101: 
     IF LTRIM$ (feld$) = "" THEN 
       dateiname$ = feld$
       CALL DOKMAImport("DOKMA",dateiname$,codema%)
       IF dateiname$ = "" THEN GOTO emadrdoneuend
       SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
       feld$ = dateiname$
       REM STORE FILE "maadr"
       REM UNLOCK CURRENT FILE "maadr"
       GOTO madrdoneu1206200101
     ELSE 
       textdatei$ = _netpath$ + feld$
       a% = CALL ("_SBFileExists",textdatei$)
       IF a% = - 1 THEN 
       REM IF EXISTS (textdatei$) THEN 
         REM i% = CALL ("ShellExecute",0,"open",textdatei$,"","",1)
         CALL TextAnz(textdatei$)
         REM CALL Fehler("Serie","")
         IF i% <= 32 THEN 
           IF (i% = 31) OR (i% = 2) THEN 
             CALL Fehler("Das benîtigte Bearbeitungsprogramm konnte nicht gefunden werden!","Bitte wÑhlen Sie das Bearbeitungsprogramm aus.")
             WordProc$ = "*.EXE"
             REQUEST "Programm fÅr " + UCASE$ ( RIGHT$ (textdatei$,3)) + "-Dateien...","",26,req%,WordProc$
             IF req% = 1 THEN 
               CALL WordProc$ + " " + textdatei$
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
emadrdoneuend: 
 END SUB 
 
 REM Dokument Gesellschaft
SUB GEDokNeu(codege%,feld$)
gedoneu1206200101: 
     IF LTRIM$ (feld$) = "" THEN 
       dateiname$ = feld$
       CALL DOKMAImport("DOKGE",dateiname$,codege%)
       IF dateiname$ = "" THEN GOTO egedoneuend
       SELECT KEY codege% LOCK FILE "geadr" INDEX codege.geadr
       feld$ = dateiname$
       REM STORE FILE "maadr"
       REM UNLOCK CURRENT FILE "maadr"
       GOTO gedoneu1206200101
     ELSE 
       textdatei$ = _netpath$ + feld$
       a% = CALL ("_SBFileExists",textdatei$)
       IF a% = - 1 THEN 
         REM IF EXISTS (textdatei$) THEN 
         REM i% = CALL ("ShellExecute",0,"open",textdatei$,"","",1)
         CALL TextAnz(textdatei$)
         REM CALL Fehler("Serie","")
         IF i% <= 32 THEN 
           IF (i% = 31) OR (i% = 2) THEN 
             CALL Fehler("Das benîtigte Bearbeitungsprogramm konnte nicht gefunden werden!","Bitte wÑhlen Sie das Bearbeitungsprogramm aus.")
             WordProc$ = "*.EXE"
             REQUEST "Programm fÅr " + UCASE$ ( RIGHT$ (textdatei$,3)) + "-Dateien...","",26,req%,WordProc$
             IF req% = 1 THEN 
               CALL WordProc$ + " " + textdatei$
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
egedoneuend: 
 END SUB 
 

 REM Dokumentenverwaltung fÅr VertrÑge
SUB KVerDok(lfdnr%)
     feld$ = "WinDok.KVERTRAG"
     feld$$ = ""
KVerDok2105200101: 
     feld$ = "WinDok.KVERTRAG"
     IF LTRIM$ (feld$$) = "" THEN 
       dateiname$ = feld$$
       CALL DOKMAImport("DOKKV",dateiname$,lfdnr%)
       IF dateiname$ = "" THEN GOTO kverdoc1206200101
       SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
       SELECT KEY lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
       feld$$ = dateiname$
       STORE FILE "KVERTRAG"
       UNLOCK CURRENT FILE "KVERTRAG"
       GOTO KVerDok2105200101
     ELSE 
       textdatei$ = _netpath$ + feld$$
       a% = CALL ("_SBFileExists",textdatei$)
       IF a% = - 1 THEN 
       REM IF EXISTS (textdatei$) THEN 
         REM i% = CALL ("ShellExecute",0,"open",textdatei$,"","",1)
         CALL TextAnz(textdatei$)
         REM CALL Fehler("Serie","")
         IF i% <= 32 THEN 
           IF (i% = 31) OR (i% = 2) THEN 
             CALL Fehler("Das benîtigte Bearbeitungsprogramm konnte nicht gefunden werden!","Bitte wÑhlen Sie das Bearbeitungsprogramm aus.")
             WordProc$ = "*.EXE"
             REQUEST "Programm fÅr " + UCASE$ ( RIGHT$ (textdatei$,3)) + "-Dateien...","",26,req%,WordProc$
             IF req% = 1 THEN 
               CALL WordProc$ + " " + textdatei$
             END IF 
           END IF 
         END IF 
       ELSE 
         CALL Fehler("Das Dokument " + textdatei$ + " konnte nicht gefunden werden!","")
         REQUEST "Mîchten Sie das Dokument erneut importieren?","",130,req%
         IF req% = 1 THEN 
           dateiname$ = ""
           CALL DOKMAImport("DOKKV",dateiname$,lfdnr%)
           SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
           SELECT KEY lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
           feld$$ = dateiname$
           STORE FILE "kvertrag"
           UNLOCK CURRENT FILE "kvertrag"
         END IF 
       END IF 
     END IF 
   IF feld$$ <> "" THEN WinDok$ = "DokumentÆ"
kverdoc1206200101: 
   SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
 END SUB 
 

  
 '*********************************************************************************************************
 '*             Universelle Dokumentenverwaltung fÅr Gesellschaften und MA
 '*********************************************************************************************************

SUB ADRDokUni(feldAdrDat$)
 code% = feldAdrDat$$
 IF disabled%("DOKUMENT") THEN END SUB 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 cudo% = CodeDOK.GDokDat$
 _formend% = 0
 SET STATUS "Bereit"
 REM maske$ = "DOKGES"
 SELECT CASE GADRUni$
   CASE "MAADR"
     maske$ = "DOKGE3MA"
     nr% = codema.maadr
     zeilstat$ = "-Vermittler"
   CASE "GEADR"
     maske$ = "DOKGEGE3"
     nr% = codege.geadr
     zeilstat$ = "-Gesellschaften"
   CASE "KVERTRAG"
     maske$ = "DOKGE3KV"
     nr% = lfdnr.kvertrag
     zeilstat$ = "-VertrÑge"
   CASE "ADRESSEN"
     maske$ = "DOKGESKV"
     nr% = codeku.adressen
     zeilstat$ = "-Kunden"
 END SELECT 
 
 FILE GDokDat$
 INDEX codeku.GDokDat$
 SELECT FIRST 
 DIM dlg AS Dialog
 DIM control AS DialogControl
 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   DOKsub% = 0
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Dokumentenverwaltung" + zeilstat$
     IF EXISTS (GOFFForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GOFFForm$ + maske$
     ELSE 
       OPEN FORM GOFFForm$ + maske$
     END IF 
     SET STATUS "Dokumentenverwaltung" + zeilstat$
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\Dokument.pdf"
     CALL MNDOKSRV1()
     SELECT WHERE FILE GDokDat$
     IF Gcuvg% > 0 AND GDokDat$ LIKE "DOKKV" THEN 
       MOUSE OFF 
       FILE "dokkv"
       SELECT WHERE codevg.dokkv = Gcuvg%
     END IF 
     CALL ADRDokNewUni(code%,feldAdrDat$)
     IF GADRUni$ LIKE "KVERTRAG" THEN 
       SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
       SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     END IF 
     IF GADRUni$ LIKE "GEADR" THEN 
       SELECT FIRST FILE "GEADR" INDEX codege.geadr
       SELECT KEY code% FILE "GEADR" INDEX codege.geadr
     END IF 
     FORM 
     SET DISPLAY ON 
   END IF 
   MENU ON 
   FORM 
   MOUSE ON 
   dokgrup$ = Gruppe.GDokDat$
   FORM 
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE DOKsub%
   CASE 62
     REM Vermittler Dokument scannen-06.09.2008
     GDokDat$ = "DOKKV"
     code% = lfdnr.kvertrag
     knr% = codeku.kvertrag
     CALL DOKMAScan("DOKKV",code%)
     CALL ADRDokNewUni(code%,feldAdrDat$)
   CASE 61
     REM Vermittler Dokument scannen-06.09.2008
     GDokDat$ = "DOKGE"
     code% = codege.geadr
     CALL DOKMAScan("DOKGE",code%)
     CALL ADRDokNewUni(code%,feldAdrDat$)
   CASE 60
     REM Vermittler Dokument scannen-06.09.2008
     GDokDat$ = "DOKMA"
     code% = codema.maadr
     CALL DOKMAScan("DOKMA",code%)
     CALL ADRDokNewUni(code%,feldAdrDat$)
   CASE 1
     GDokDat$ = "DOKMA"
     Adresse$ = MakeMAAdr$(codema.maadr,mode%,opt1%,opt2%)
     COPY FROM Adresse$
     CALL MADRDokNeu(code%,"")
     CALL ADRDokNewUni(code%,feldAdrDat$)
   CASE 2
     GDokDat$ = "DOKMA"
     CALL DOKSRVUni()
   CASE 3
     GDokDat$ = "DOKMA"
     knr% = codeku.GDokDat$
     CALL DokSuchen1(nr%,"")
     IF adrfound% <> 0 AND codeku.GDokDat$ = knr% AND cudo% <> 0 THEN 
       cudo% = CodeDOK.GDokDat$
       SELECT KEY cudo% FILE GDokDat$ INDEX codedok.GDokDat$
       CALL DOKSRVUni()
     END IF 
   CASE 4
     CALL DokFilt()
     CALL ADRDokNewUni(code%,feldAdrDat$)
     FORM 
   CASE 5
     REM Dokverw. von VertrÑge
     GDokDat$ = "DOKKV"
     SELECT FIRST FILE "MAADR" INDEX codema.maadr
     SELECT KEY codema.kvertrag FILE "MAADR" INDEX codema.maadr
     SELECT FIRST FILE "GEADR" INDEX codege.geadr
     SELECT KEY codege.kvertrag FILE "GEADR" INDEX codege.geadr
     opt% = 1
     Superbase.Dialogs.Add("Dialogname")
     SET dlg = Superbase.Dialogs.Dialogname
     dlg.Move(0,0,222,83)
     dlg.Caption = "Art der Adresse"
     dlg.FontName = "MS Sans Serif"
     dlg.FontSize = 8
 
     SET control = dlg.Add("DialogFrame1","DialogFrame")
     control.Move(2,8,219,54)
     control.Caption = " WÑhlen Sie eine Option "
 
     SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
     control.Move(6,20,159,10)
     control.Caption = "Adresse der Kunden verwenden"
     control.Bind("opt%")
     control.ValueOn = 1
 
     SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
     control.Move(6,32,214,9)
     control.Caption = "Adresse der Gesellschaft verwenden"
     control.Bind("opt%")
     control.ValueOn = 2
 
     SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
     control.Move(6,44,200,10)
     control.Caption = "Adresse des Vermittlers verwenden"
     control.Bind("opt%")
     control.ValueOn = 3
 
 
     SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(59,64,43,16)
     control.Default = 1
     control.Caption = "OK"
     control.ReturnValue = 1
 
     SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(105,64,42,16)
     control.Caption = "Abbruch"
     control.ReturnValue = 0
 
     DIALOG "Dialogname",req%
     REMOVE DIALOG "Dialogname"
     IF req% = 1 THEN 
       IF opt% = 1 THEN 
         GBanMA% = 0:GBanGE% = 0
         Adresse$ = MakeAdr$(CodeKU.GAdrDat$, - 1,0,0)
         COPY FROM Adresse$
         CALL DOKUMENT("Dokumente an Kunden",cuvt%)
       END IF 
       IF opt% = 2 THEN 
         GBanMA% = 0:GBanGE% = 1
         opt% = 1
         REM *****************************************************************************************************************************************
         Superbase.Dialogs.Add("Dialogname")
         SET dlg = Superbase.Dialogs.Dialogname
         dlg.Move(0,0,222,83)
         dlg.Caption = "Art der Adresse"
         dlg.FontName = "MS Sans Serif"
         dlg.FontSize = 8
 
         SET control = dlg.Add("DialogFrame1","DialogFrame")
         control.Move(2,8,219,54)
         control.Caption = " WÑhlen Sie eine Option "
 
         SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
         control.Move(6,20,159,10)
         control.Caption = "Adresse der Hauptgesellschaft verwenden"
         control.Bind("opt%")
         control.ValueOn = 1
 
         SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
         control.Move(6,32,214,9)
         control.Caption = "Adresse einer Gesellschafts-Filiale verwenden"
         control.Bind("opt%")
         control.ValueOn = 2
 
 
         SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
         control.Move(59,64,43,16)
         control.Default = 1
         control.Caption = "OK"
         control.ReturnValue = 1
 
         SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
         control.Move(105,64,42,16)
         control.Caption = "Abbruch"
         control.ReturnValue = 0
 
         DIALOG "Dialogname",req%
         REMOVE DIALOG "Dialogname"
         REM *****************************************************************************************************************************************  
         GBanGesFil% = 0
         GCodeGE2% = 0
         IF req% = 1 THEN 
           IF opt% = 1 THEN 
             Adresse$ = MakeGesAdr$(Codege.geadr,0,0,0)
           ELSE 
             voncodege% = codege.geadr
             codege2% = GetCodeGE2%(voncodege%,prompt%)
             IF codege2% < 1 THEN GOTO eausw090320032
             Adresse$ = MakeGesAdr2$(Codege2%,0,0,0)
             GBanGesFil% = - 1
             GCodeGE2% = codege2%
           END IF 
           COPY FROM Adresse$
           CALL DOKUMENT("Dokumente an Gesellschaften",cuvt%)
         END IF 
       END IF 
       IF opt% = 3 THEN 
         GBanMA% = 1:GBanGE% = 0
         Adresse$ = MakeMAAdr$(codema.maadr,mode%,opt1%,opt2%)
         COPY FROM Adresse$
         CALL DOKUMENT("Dokumente an Mitarbeiter",cuvt%)
       END IF 
       REM COPY FROM Adresse$
     END IF 

     REM CALL KVerDok(code%)
     REM CALL ADRDokNewUni(code%,feldAdrDat$)
eausw090320032: 
     cuvt% = lfdnr.KVERTRAG
     CALL VERTRSync()
     REM CALL DOKUMENT("Dokumente an Gesellschaften",cuvt%)
     _formend% = - 1
   CASE 6
     GDokDat$ = "DOKKV"
     CALL DOKSRVUni()
   CASE 7
     GDokDat$ = "DOKKV"
     knr% = codeku.GDokDat$
     knrorig% = codeku.Adressen
     CALL DokSuchen1(nr%,"")
     adrfound% = GDokSu1%
     IF adrfound% <> 0 AND codeku.GDokDat$ = knr% AND cudo% <> 0 THEN 
       cudo% = CodeDOK.GDokDat$
       SELECT KEY cudo% FILE GDokDat$ INDEX codedok.GDokDat$
       CALL DOKSRVUni()
     END IF 
     knr% = knrorig%
   CASE 8
     GDokDat$ = "DOKGE"

         opt% = 1
         REM *****************************************************************************************************************************************
         Superbase.Dialogs.Add("Dialogname")
         SET dlg = Superbase.Dialogs.Dialogname
         dlg.Move(0,0,222,83)
         dlg.Caption = "Art der Adresse"
         dlg.FontName = "MS Sans Serif"
         dlg.FontSize = 8
 
         SET control = dlg.Add("DialogFrame1","DialogFrame")
         control.Move(2,8,219,54)
         control.Caption = " WÑhlen Sie eine Option "
 
         SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
         control.Move(6,20,159,10)
         control.Caption = "Adresse der Hauptgesellschaft verwenden"
         control.Bind("opt%")
         control.ValueOn = 1
 
         SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
         control.Move(6,32,214,9)
         control.Caption = "Adresse einer Gesellschafts-Filiale verwenden"
         control.Bind("opt%")
         control.ValueOn = 2
 
 
         SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
         control.Move(59,64,43,16)
         control.Default = 1
         control.Caption = "OK"
         control.ReturnValue = 1
 
         SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
         control.Move(105,64,42,16)
         control.Caption = "Abbruch"
         control.ReturnValue = 0
 
         DIALOG "Dialogname",req%
         REMOVE DIALOG "Dialogname"
         REM *****************************************************************************************************************************************   
         IF req% = 1 THEN 
           IF opt% = 1 THEN 
             Adresse$ = MakeGesAdr$(Codege.geadr,0,0,0)
           ELSE 
             voncodege% = codege.geadr
             codege2% = GetCodeGE2%(voncodege%,prompt%)
             IF codege2% < 1 THEN GOTO eausw090320031
             Adresse$ = MakeGesAdr2$(Codege2%,0,0,0)
           END IF 
           COPY FROM Adresse$
           CALL GEDokNeu(code%,"")
           CALL ADRDokNewUni(code%,feldAdrDat$)
         END IF 
eausw090320031: 
   CASE 9
     GDokDat$ = "DOKGE"
     CALL DOKSRVUni()
   CASE 10
     GDokDat$ = "DOKGE"
     knr% = codeku.GDokDat$
     CALL DokSuchen1(nr%,"")
     IF adrfound% <> 0 AND codeku.GDokDat$ = knr% AND cudo% <> 0 THEN 
       cudo% = CodeDOK.GDokDat$
       SELECT FIRST FILE GDokDat$ INDEX codedok.GDokDat$
       SELECT KEY cudo% FILE GDokDat$ INDEX codedok.GDokDat$
       CALL DOKSRVUni()
     END IF 
   CASE 11
     CALL DokFilt()
     CALL ADRDokNewUni(code%,feldAdrDat$)
     FORM 
   CASE 12
     lfdnr1% = lfdnr.kvertrag
     CALL KVerDok(code%)
     CALL ADRDokNewUni(code%,feldAdrDat$)
     SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
     SELECT KEY lfdnr1% FILE "kvertrag" INDEX lfdnr.kvertrag
     cuvt% = lfdnr1%
     CALL VERTRIntro(0)
     _formend% = 1
     REM FORM 
   CASE 22
      SELECT CASE GADRUni$
        CASE "ADRESSEN"
          maske$ = "DOKGES"
        CASE "BCKONTAK"
          maske$ = "DOKBC"
      END SELECT 
   CASE 23
      SELECT CASE GADRUni$
        CASE "ADRESSEN"
          maske$ = "DOKGESPR"
        CASE "BCKONTAK"
          maske$ = "DOKGESBC"
      END SELECT 
   CASE 24
      SELECT CASE GADRUni$
        CASE "ADRESSEN"
          maske$ = "DOKGES1"
        CASE "BCKONTAK"
          maske$ = "DOKGES1B"
      END SELECT 
   CASE 25
      SELECT CASE GADRUni$
        CASE "ADRESSEN"
          maske$ = "DOKGES2"
        CASE "BCKONTAK"
          maske$ = "DOKGES2B"
      END SELECT 
   CASE 26
      SELECT CASE GADRUni$
        CASE "ADRESSEN"
          maske$ = "DOKGES3"
        CASE "BCKONTAK"
          maske$ = "DOKGES3B"
      END SELECT 
   CASE 27
      SELECT CASE GADRUni$
        CASE "ADRESSEN"
          maske$ = "DOKGESPR"
        CASE "BCKONTAK"
          maske$ = "DOKGESBC"
      END SELECT 
   CASE 30
     REM Dok sortiert nach Dokument
     maske$ = "DOKGESMA"
   CASE 31
     REM Dok sortiert nach Ersteller
     maske$ = "DOKGE1MA"
   CASE 32
     REM Dok sortiert nach Bearbeiter
     maske$ = "DOKGE2MA"
   CASE 33
     REM Dok sortiert nach Erstellt am
     maske$ = "DOKGE3MA"
   CASE 34
     REM Dok sortiert nach letzte Bearb
     maske$ = "DOKGE4MA"

   CASE 40
     REM Dok sortiert nach Dokument
     maske$ = "DOKGEGE"
   CASE 41
     REM Dok sortiert nach Ersteller
     maske$ = "DOKGEGE1"
   CASE 42
     REM Dok sortiert nach Bearbeiter
     maske$ = "DOKGEGE2"
   CASE 43
     REM Dok sortiert nach Erstellt am
     maske$ = "DOKGEGE3"
   CASE 44
     REM Dok sortiert nach letzte Bearb
     maske$ = "DOKGEGE4"

   CASE 50
     REM Dok sortiert nach Dokument
     maske$ = "DOKGESKV"
   CASE 51
     REM Dok sortiert nach Ersteller
     maske$ = "DOKGE1KV"
   CASE 52
     REM Dok sortiert nach Bearbeiter
     maske$ = "DOKGE2KV"
   CASE 53
     REM Dok sortiert nach Erstellt am
     maske$ = "DOKGE3KV"
   CASE 54
     REM Dok sortiert nach letzte Bearb
     maske$ = "DOKGE4KV"

   END SELECT 
   END SELECT 
 WEND 
 _formend% = 0
 SELECT WHERE FILE GDokDat$
 REM IF FileChanged%(GDokDat$) = 1 THEN CALL FStore(GDokDat$)
 END SUB 
 
 
SUB MNDOKSRVUni()
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
SUB ADRDokNewUni(code%,feldAdrDat$)
 SELECT FIRST FILE GADRUni$ INDEX feldAdrDat$$
 SELECT FORM KEY code% FILE GADRUni$ INDEX feldAdrDat$$
 SELECT FIRST FILE GDokDat$ INDEX codeku.GDokDat$
 SELECT FORM KEY code% FILE GDokDat$ INDEX codeku.GDokDat$
 END SUB 
 
 
SUB DOKSRVUni()
 IF disabled%("DOKUMENT") THEN END SUB 
 cudo% = CodeDOK.GDokDat$
 _formend% = 0
 SET STATUS "Bereit"
 maske$ = GDokDat$
 IF ProjectJN$ = "TRUE" THEN maske$ = "DOKEPRJ"
 xpwvers% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   DOKsub% = 0
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Dokumentenverwaltung"
     IF EXISTS (GOFFForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GOFFForm$ + maske$
     ELSE 
       OPEN FORM GOFFForm$ + maske$
     END IF 
     SET f = superbase.form
     GAppName$ = _netpath$ + "DOC\Dokument.pdf"
     SET STATUS "Dokumentenverwaltung"
     CALL MNDOKSRV()
     FILE GDokDat$
     INDEX Dokument.GDokDat$
     SELECT FORM FIRST 
     FORM 
     SET DISPLAY ON 
   END IF 
   IF FORM LIKE "DOKKV" THEN 
     vsnr$ = VS_NR.kvertrag
     vnehm$ = VNehmer.kvertrag
   END IF 
   MENU ON 
   MOUSE ON 
   REM dokgrup$ = Gruppe.GDokDat$
   SELECT FORM KEY cudo% FILE GDokDat$ INDEX codedok.GDokDat$
   dokgrup$ = Gruppe.GDokDat$
   IF ProjectJN$ = "TRUE" THEN 
     IF projekt.GDokDat$ <> "" THEN 
       proj$ = Projekt.GDokDat$
     ELSE 
       proj$ = "<ohne Zuordnung>"
     END IF 
     IF gruppe.GDokDat$ <> "" THEN 
       dokgrup$ = gruppe.GDokDat$
     ELSE 
       dokgrup$ = "<ohne Zuordnung>"
     END IF 
   END IF 
   IF dokpass.GDokDat$ = "" THEN 
     f.dokschu.Backcolor = 3
     dokschutz$ = "Dokument gegen énderungen schÅtzen"
     f.dateiname.readonly = 0
     f.dateiname.enabled = - 1
     f.dateiname.visible = - 1
     f.textschu.visible = 0
   ELSE 
     f.dokschu.Backcolor = 2
     dokschutz$ = "Dokument wurde erfolgreich geschÅtzt"
     f.dateiname.readonly = - 1
     f.dateiname.enabled = 0
     f.dateiname.visible = 0
     f.textschu.visible = - 1
   END IF 
   f.imp.visible = 0
   f.such.visible = 0
   f.left.visible = 0
   f.right.visible = 0
   REM f.doksuchen.visible = 0
   FORM 
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE DOKsub%
   CASE 1
     codeku% = codeku.GDokDat$
     CALL DokSuchen1(codeku%,"")
     cudo% = codedok.GDokDat$
   CASE 2
     REM dokument lîschen
     codeku% = codeku.GDokDat$
     IF dokpass.gdokdat$ = "" THEN 
       CALL DOKVLoeschen()
     ELSE 
       CALL Fehler("Das Dokument ist geschÅtzt und kann deshalb nicht gelîscht werden!","")
     END IF 
     IF EXISTS (codeku%,codeku.GDokDat$) THEN 
       SELECT FORM KEY codeku% FILE GDokDat$ INDEX codeku.GDokDat$
       FORM 
     ELSE 
       _formend% = 1
       CALL Fehler("Es sind keine weiteren Dokumente fÅr diesen Kunden vorhanden!","")
     END IF 
   CASE 3
     IF NOT disabled%("DOKUMENTBEARB") THEN 
       MENU OFF 
       CALL DOKAuswGrup()
       MENU ON 
     END IF 
   CASE 5
     IF GDokDat$ LIKE "DOKKV" THEN 
       REM Export nach ELO
       cudo% = Codedok.DOKKV
       codedok% = cudo%
       codevt% = codeku.DOKKV
       SELECT KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
       codeku% = codeku.kvertrag
       SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
       IF ELOTrans.DOKKV <> 1 THEN 
         REM CALL ADRDokSendELO(codedok%,codema%)
         CALL KVDokSendELO(codedok%,codevt%,codeku%)
       ELSE 
         REQUEST "Das Dokument wurde bereits an ELO Åbergeben?","Soll es nochmal Åbergeben werden?",135,req%
         IF req% = 1 THEN 
           REM CALL ADRDokSendELO(codedok%,codeku%)
           CALL KVDokSendELO(codedok%,codevt%,codeku%)
         END IF 
       END IF 
       SELECT KEY cudo% FILE "DOKKV" INDEX codedok.DOKKV
     END IF 
     IF GDokDat$ LIKE "DOKMA" THEN 
       REM Export nach ELO
       cudo% = Codedok.DOKMA
       codedok% = cudo%
       codema% = codeku.DOKMA
       SELECT KEY codema% FILE "MAADR" INDEX codema.maadr
       IF ELOTrans.DOKMA <> 1 THEN 
         REM CALL ADRDokSendELO(codedok%,codema%)
         CALL MADokSendELO(codedok%,codema%)
       ELSE 
         REQUEST "Das Dokument wurde bereits an ELO Åbergeben?","Soll es nochmal Åbergeben werden?",135,req%
         IF req% = 1 THEN 
           REM CALL ADRDokSendELO(codedok%,codeku%)
           CALL MADokSendELO(codedok%,codema%)
         END IF 
       END IF 
       SELECT KEY cudo% FILE "DOKMA" INDEX codedok.DOKMA
     END IF 
     IF GDokDat$ LIKE "DOKGE" THEN 
       REM Export nach ELO
       cudo% = Codedok.DOKGE
       codedok% = cudo%
       codege% = codeku.DOKGE
       SELECT KEY codege% FILE "GEADR" INDEX codege.geadr
       IF ELOTrans.DOKGE <> 1 THEN 
         REM CALL ADRDokSendELO(codedok%,codema%)
         CALL GEDokSendELO(codedok%,codege%)
       ELSE 
         REQUEST "Das Dokument wurde bereits an ELO Åbergeben?","Soll es nochmal Åbergeben werden?",135,req%
         IF req% = 1 THEN 
           REM CALL ADRDokSendELO(codedok%,codeku%)
           CALL GEDokSendELO(codedok%,codege%)
         END IF 
       END IF 
       SELECT KEY cudo% FILE "DOKGE" INDEX codedok.DOKGE
     END IF 
   CASE 6
     codedok% = codedok.GDokDat$
     IF dokpass.GDokDat$ = "" THEN 
       SELECT FIRST FILE "Stamm"
       passw$ = DokPass.stamm
       IF passw$ = "" THEN 
         CALL Fehler("Es wurde kein Passwort hinterlegt!","Bitte tragen Sie in Einstellungen->Firmenstammdaten->Dokumentenpasswort ein Passwort ein!")
         GOTO endkpw230120061
       END IF 
       REQUEST "Soll das Dokument jetzt geschÅtzt werden?","",135,req%
       IF req% = 1 THEN 
         CALL EncryptDoks(codedok%,0,passw$,passwpers$)
       END IF 
     ELSE 
       IF GDisDokSchu$ = "j" THEN 
         REQUEST "Soll der Dokumentenschutz jetzt aufgehoben werden?","",135,req%
         IF req% = 1 THEN 
            SELECT FIRST FILE "Stamm"
           passw1$ = DokPass.stamm
           REM passdenc$ = ""
           REM encpw$ = "london8474"
 
           CREATE DIALOG "LOGIN",0,0,193,79,title$,"MS Sans Serif",8
           ADD DIALOG "LOGIN",4,0,0,193,58,0,""
           ADD DIALOG "LOGIN",9,5,11,20,22,2
           ADD DIALOG "LOGIN",5,33,11,139,9,0,"Das EntschlÅsseln ist durch "
           ADD DIALOG "LOGIN",5,33,20,68,10,0,"Passwort geschÅtzt."
           ADD DIALOG "LOGIN",5,33,31,32,12,0,"&Passwort:"
           ADD DIALOG "LOGIN",6,33,41,149,11,32,0,pw$,10
           ADD DIALOG "LOGIN",1,38,61,50,15,1,"&OK",1,1
           ADD DIALOG "LOGIN",1,89,61,50,15,0,"&Abbruch",0,0
           DIALOG "LOGIN",req%
           REMOVE DIALOG ALL 
           IF req% = 1 THEN 
             IF pw$ = passw1$ THEN 
               req% = 1
             ELSE 
               req% = 0
               xpwvers% = xpwvers% + 1
               IF xpwvers% < 3 THEN 
                 CALL Fehler("Passwort ist falsch!","")
               END IF 
               IF xpwvers% > 2 THEN 
                 REQUEST "Passwort ist falsch!","Programm wird beendet!",2
                 CALL EXIT()
               END IF 
             END IF 
           END IF 
           IF req% = 1 THEN CALL DecryptDoks(codedok%,"",0)
         END IF 
       ELSE 
         CALL Fehler("Das Dokument wurde bereits geschÅtzt","")
       END IF 
     END IF 
endkpw230120061: 
     DOKsub% = 0
   CASE 99
     IF NOT disabled%("DOKUMENTBEARB") THEN 
       MENU OFF 
       ENTER Dokument.GDokDat$,0
       MENU ON 
       CALL MATimeStamp(GDokDat$)
     END IF 
   END SELECT 
 WEND 
 _formend% = 0
 IF FileChanged%(GDokDat$) = 1 THEN CALL FStore(GDokDat$)
 
 END SUB 

SUB DOKMAGEAdr()
 _ku% = CodeKU.GDokDat$
 _dok% = CodeDOK.GDokDat$
 cindex$ = INDEX 
 IF NEW (GDokDat$) OR MOD (GDokDat$) THEN CALL FStore(GDokDat$)
 SET STATUS "Adresse zuordnen"
 IF GDokDat$ LIKE "DOKMA" THEN 
   adr% = GetCodeMA%(codema.maadr,Workstation%)
 END IF 
 IF GDokDat$ LIKE "DOKGE" THEN 
   adr% = GetCodeGE%(codege.geadr)
 END IF 
 IF adr% <> 0 THEN 
   SELECT KEY _dok% LOCK FILE GDokDat$ INDEX CodeDOK.GDokDat$
   CodeKU.GDokDat$ = adr%
   REM IF link.GDokDat$ = 0 THEN link.GDokDat$ = CodeKU.GDokDat$
   link.GDokDat$ = CodeKU.GDokDat$
   CALL FStore(GDokDat$)
 END IF 
 SELECT FORM KEY _dok% FILE GDokDat$ INDEX CodeDOK.GDokDat$
 SET INDEX cindex$$
 INDEX cindex$$
 FORM 
 MOUSE ON 
 END SUB 
 

SUB ADRDOKUni()
 IF GDOKDat$ LIKE "DOKMA" THEN 
   Gruppe$ = "Mitarbeiterdokument"
 END IF 
 IF GDOKDat$ LIKE "DOKGE" THEN 
   Gruppe$ = "Gesellschaftsdokument"
 END IF 
 Doksub% = 0
 nr% = CodeKU.GAdrDat$
 CALL DOKUMENT(Gruppe$,nr%)
 END SUB 
 



 REM *********************************************************************************************** 
 REM         neue VorgÑngerfestlegung
 REM *********************************************************************************************** 
SUB VorgNeu(codema%)
 IF disabled%("BUCHUNG") THEN END SUB 
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,datei$ + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 _formend% = 0
   formname$ = "MAVORG"
   datei$ = "MAVORG"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   ZBsub% = 0
   IF UCASE$ ( FORM ) <> formname$ THEN 
     SET HEADING title$ + " - VorgÑngerdatei"
     OPEN FORM GPrjForm$ + formname$
     SET f = Superbase.Form
     FILE datei$
     INDEX Codema.datei$
     SELECT FIRST 
     IF EXISTS (codema%,Codema.datei$) THEN 
       SELECT FORM KEY codema% FILE "maadr" INDEX codema.maadr
       SELECT KEY codema% FILE datei$ INDEX codema.datei$
     ELSE 
        REQUEST "Es sind noch keine VorgÑnger vorhanden!","Mîchten Sie einen VorgÑnger erfassen?",130,req%
        IF req% = 1 THEN 
          CALL Vorgaenger(codema%)
          IF gfsc% <> - 1 THEN 
            t1$ = "Dies dauert je nach Anzahl der Vermittler einige Minuten. Wenn Sie noch mehr Vermittler erfassen wollen, lassen Sie diesen Schritt erst beim letzten Vermittler durchfÅhren!"
             CALL Fehler("Das Programm kann jetzt fÅr alle Vermittler die Anzahl der Mitarbeiter in der jeweiligen Downline ermitteln!",t1$)
            REQUEST "Mîchten Sie jetzt die Downlineanzahl der Vermittler ermitteln lassen?","",135,req%
            IF req% = 1 THEN 
              CALL StruAll()
            END IF 
          END IF 
          SELECT FORM KEY codema% FILE "maadr" INDEX codema.maadr
          SELECT KEY codema% FILE datei$ INDEX codema.datei$
        ELSE 
          END SUB 
        END IF 
     END IF 
     SET f = Superbase.Form
     CALL MNProgramm()
     MENU ON 
     SET STATUS "VorgÑngerdatei"
   END IF 
   REM CALL ZBUpdate()
   MOUSE ON 
   IF aktiviert.mavorg = "j" THEN 
     aktiv$ = "aktiviert !"
     f.aktiv.ForeColor = 2
     f.avorg.enabled = 0
   ELSE 
     aktiv$ = "aktivieren"
     f.aktiv.ForeColor = 4
     f.avorg.enabled = - 1
   END IF 
   f.bearb.enabled = - 1
   f.neu.enabled = - 1
   f.sichern.enabled = 0
   f.loe.enabled = - 1
   f.zurueck.enabled = - 1
   f.cmd.enabled = - 1
   f.abbruch.enabled = 0
   f.abbruch.visible = 0
   FORM 
   CALL ClearKBDBuffer()
   IF ZBsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL BUPrev()
   CASE CrsRight%,PgDn%
     CALL BUNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZBsub%
   CASE 1
     codekey% = codekey.datei$
     SELECT FORM KEY codekey% FILE datei$ INDEX codekey.datei$
     FORM 
   CASE 2
     codekey% = Codekey.MAvorg
     SELECT KEY codekey% FILE "mavorg" INDEX codekey.mavorg
     IF aktiviert.mavorg <> "k" THEN 
       REQUEST "Wollen Sie diesen Datensatz wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         REMOVE FROM FILE "mavorg" WHERE codekey.mavorg = codekey%
         REQUEST "Datensatz wurde gelîscht!","",2
         SELECT FORM KEY codema% FILE "maadr" INDEX codema.maadr
         SELECT KEY codema% FILE datei$ INDEX codema.datei$
         FORM 
       END IF 
     ELSE 
       CALL Fehler("Dieser VorgÑnger ist bereits aktiviert und kann somit nicht gelîscht werden!","")
     END IF 
   CASE 3
     REM Neuerfassung
     CALL Vorgaenger(codema%)
     IF Gfsc% <> - 1 THEN 
       t1$ = "Dies dauert je nach Anzahl der Vermittler einige Minuten. Wenn Sie noch mehr Vermittler erfassen wollen, lassen Sie diesen Schritt erst beim letzten Vermittler durchfÅhren!"
       CALL Fehler("Das Programm kann jetzt fÅr alle Vermittler die Anzahl der Mitarbeiter in der jeweiligen Downline ermitteln!",t1$)
       REQUEST "Mîchten Sie jetzt die Downlineanzahl der Vermittler ermitteln lassen?","",135,req%
       IF req% = 1 THEN 
         CALL StruAll()
       END IF 
     END IF 
   CASE 4
     codekey% = codekey.mavorg
     
     vorgÑnger% = CodeVMA.mavorg
     _cuma% = codema.mavorg
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY vorgÑnger% FILE "maadr" INDEX CodeMA.maadr
     stufe% = stufe.maadr
     NameVorg$ = LTRIM$ (nachname.maadr) + "," + LTRIM$ (vorname.maadr) + "," + agenturnr.maadr
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY _cuma% LOCK FILE "maadr" INDEX CodeMA.maadr
     NameVorg.maadr = NameVorg$
     VorgÑnger.maadr = vorgÑnger%
     IF vorgÑnger% <> _cuma% THEN 
       stufe.maadr = stufe% + 1
     ELSE 
       stufe.maadr = 1
     END IF 
     REQUEST "Sollen die Felder Stufe und Titel automatisch ausgefÅllt werden?","",135,req%
     s$ = STR$ (stufe.maadr,"00")
     IF req% = 1 THEN 
       feld$ = "Titel" + s$ + ".stamm"
       IstTitel.maadr = feld$$
     END IF 
     feld$ = "BWS" + s$ + ".stamm"
     SollBWS.maadr = feld$$
     feld$ = "Squote" + s$ + ".stamm"
     SollQuote.maadr = feld$$
     feld$ = "MAAnz" + s$ + ".stamm"
     SollMAAnz.maadr = feld$$
     IstBWS.maadr = BWSGes.maadr + SBwsges.maadr
     istbwseu.maadr = VAL ( STR$ (IstBWS.maadr / umrechnung.stamm,"999999999.00"))
     CALL FStore("maadr")
     SELECT KEY codekey% LOCK FILE "mavorg" INDEX codekey.mavorg
     aktiviert.mavorg = "j"
     STORE FILE "mavorg"
     cfile$ = FILE 
     IF KonTest$ <> "FALSE" THEN CALL KondTestKo()
     FILE cfile$
     SELECT FORM KEY _cuma% FILE "maadr" INDEX CodeMA.maadr
     SELECT KEY codekey% FILE "mavorg" INDEX codekey.mavorg
     
     IF aktiviert.mavorg = "j" THEN 
       aktiv$ = "aktiviert !"
       f.aktiv.ForeColor = 2
       f.avorg.enabled = 0
     ELSE 
       aktiv$ = "aktivieren"
       f.aktiv.ForeColor = 4
       f.avorg.enabled = - 1
     END IF 
     FORM 
   CASE 5
      CALL Vorgaend(codema.mavorg)
   CASE 99
     MENU OFF 
     f.bearb.enabled = 0
     f.neu.enabled = 0
     f.sichern.enabled = - 1
     f.loe.enabled = 0
     f.zurueck.enabled = 0
     f.aktiv.enabled = 0
     f.avorg.enabled = 0
     f.cmd.enabled = 0
     f.abbruch.enabled = - 1
     f.abbruch.visible = - 1
     ENTER von.datei$,0
     f.bearb.enabled = - 1
     f.neu.enabled = - 1
     f.sichern.enabled = 0
     f.loe.enabled = - 1
     f.zurueck.enabled = - 1
     f.aktiv.enabled = - 1
     f.avorg.enabled = - 1
     f.cmd.enabled = - 1
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     MENU ON 
   END SELECT 
   ZBsub% = 0
 WEND 
 _formend% = 0
 END SUB 
 
 

 ' Strukturaufbau VorgÑnger
 ' =======================================================================
SUB Vorgaenger(codema%)
 CALL DFile(3,"vkond" + _fpw$)
 IF disabled%("VORGAENGER") THEN END SUB 
 IF ag$ = "j" THEN 
   CALL Fehler("Diese Funktion ist fÅr SmartPROVIS Agentur gesperrt!","")
   END SUB 
 END IF 
 _cuma% = CodeMA%
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 VorgÑnger1% = VorgÑnger.MAADR
 ok% = - 1
 IF EXISTS (_cuma%,CodeMA.VKOND) AND VorgÑnger1% > 0 THEN 
   REM 250198 ok% = 0
   a$ = "Zuweisung eines neuen VorgÑngers!"
   b$ = "Auswirkungen:" + CHR$ (13) + CHR$ (10)
   b$ = b$ + "1. Alle VertrÑge, die bereits an die Provisionsabrechnung Åbergeben wurden, werden zu den Konditionen des öbergabezeitpunktes weiterhin berechnet (also mit den Konditionen des alten VorgÑngers)."
   b$ = b$ + CHR$ (13) + CHR$ (10) + "2. Alle VertrÑge, die nach der Wahl des neuen VorgÑngers an die Provisionsabrechnung Åbergeben werden, werden mit den daraus resultierenden Konditionen berechnet"
   REM b$ = b$ + CHR$ (10) + CHR$ (13) + "ACHTUNG beachten Sie, da· die neue VorgÑngeragentur (und ihre VorgÑnger) auch mindestens die Konditionen zu Produkten mit einem entsprechenden ~Bewertungszeitraum von~ besitzen mu·, wie die aktuelle Agentur!!!"
   CALL Fehler(a$,b$)
   a$ = "Zu Beachten bei den Konditionen:"
   b$ = "ACHTUNG beachten Sie, da· die neue VorgÑngeragentur (und ihre VorgÑnger) auch mindestens die Konditionen zu Produkten mit einem entsprechenden ~Bewertungszeitraum von~ besitzen mu·, wie die aktuelle Agentur!!!"
   CALL Fehler(a$,b$)
   REQUEST "Neuen VorgÑnger wirklich erfassen?","",130,reqv%
   IF reqv% = 0 THEN ok% = 0
 ELSE 
   REM IF EXISTS (_cuma%,CodeMA.gekond) AND VorgÑnger% > 0 THEN 
     REM ok% = 0
     REM a$ = "Sie versuchen dieser Agentur einen anderen VorgÑnger zuzuweisen! Dies ist nicht mîglich, da fÅr diese Agentur bereits  Konditionen definiert wurden,"
     REM b$ = "die in AbhÑngigkeit zum VorgÑnger stehen! Sie mÅssen zuerst die Konditionen dieser Agentur lîschen, dann Åbernehmen Sie die Konditionen der neuen VorgÑngeragentur und passen diese entsprechend an!"
     REM CALL Fehler(a$,b$)
   END IF 
 END IF 
 IF ok% = 0 THEN GOTO vend130199
 
 
 DIM Agenturen1$( RECCOUNT ("MAADR"))
 DIM Auswahl$(1)
 FILE "MAADR"
 INDEX Nachname.MAADR
 SELECT FIRST 
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR,50)
   IF gfsc% <> - 1 THEN 
     Agenturen1$(a%) = test$ + "   " + PAD$ (Agenturnr.maadr,20) + STR$ (stufe.maadr,"000") + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
     IF CodeMA.MAADR = VorgÑnger1% THEN prompt$ = Agenturen1$(a%)
   ELSE 
     Agenturen1$(a%) = PAD$ (Agenturnr.maadr,20) + "            " + test$ + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
     IF CodeMA.MAADR = VorgÑnger1% THEN prompt$ = Agenturen1$(a%)
   END IF 
   SELECT NEXT FILE "maadr"
   a% = a% + 1
 WEND 
   REM CREATE DIALOG "MASUCH",0,0,308,288,"Strukturaufbau","MS Sans Serif",8
   CREATE DIALOG "MASUCH",0,0,315,288,"Strukturaufbau","MS Sans Serif",7
   ADD DIALOG "MASUCH",4,0,0,308,263,0,""
   ADD DIALOG "MASUCH",9,5,5,21,21,2
   ADD DIALOG "MASUCH",5,37,5,151,10,0,"Bitte wÑhlen Sie einen VorgÑnger aus:"
   ADD DIALOG "MASUCH",5,37,15,300,10,0,"Vermittler                        Agenturnummer       Stufe"
   ADD DIALOG "MASUCH",7,7,27,298,229,2,2,Agenturen1$,Auswahl$,prompt$
   ADD DIALOG "MASUCH",1,86,268,55,15,1,"&OK",1,1
   ADD DIALOG "MASUCH",1,143,268,55,15,0,"&Abbrechen",0,0
   MOUSE ON 
   DIALOG "MASUCH",req%
   REMOVE DIALOG "MASUCH"
   IF req% = 1 THEN 
     codekey% = codekey.mavorg
     vorgÑnger1% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     IF vorgÑnger1% > 0 THEN 
       REM IF vorgÑnger% <> vorgÑnger.maadr THEN 
       SELECT FIRST FILE "maadr" INDEX codema.maadr
       SELECT KEY vorgÑnger1% FILE "maadr" INDEX CodeMA.maadr
       maname$ = nachname.maadr
       mavorname$ = vorname.maadr
       maagnr$ = Agenturnr.maadr
 
       BLANK FILE "mavorg"
     
       codekey% = SER ("mavorg",1)
       codekey.mavorg = codekey%
       codema.mavorg = codema%
       codevma.mavorg = vorgÑnger1%
       NameVMA.mavorg = maname$
       VornameMA.mavorg = mavorname$
       AgenturnrVMA.mavorg = maagnr$
       von.mavorg = "01.01.1990"
       aktiviert.mavorg = "n"
       
     REM ELSE 
       von$ = "01.01.1990"
       bis$ = ""
       aktiv$ = "j"
nochm071220041: 
       CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
       ADD DIALOG "Konto1",9,6,7,24,22,2
       ADD DIALOG "Konto1",5,34,8,170,9,0,"VorgÑnger:"
       ADD DIALOG "Konto1",4,34,14,176,5,0,""
       ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie den Zeitraum von bis ein."
       REM ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
       ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
       ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
       ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
       ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
       ADD DIALOG "Konto1",2,34,97,148,11,0,"VorgÑnger aktivieren","j","n",aktiv$
       REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
       ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
       ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
       DIALOG "Konto1",req%
       IF req% = 1 THEN 
         IF DateOK%(von$) THEN 
           von.mavorg = von$
         ELSE 
           GOTO nochm071220041 
         END IF 
         IF LTRIM$ (bis$) <> "" THEN 
           IF DateOK%(bis$) THEN 
             bis.mavorg = bis$
           ELSE 
             GOTO nochm071220041 
           END IF 
         END IF 
         aktiviert.mavorg = aktiv$
         STORE FILE "mavorg"
         IF aktiv$ = "j" THEN 
           REM************************************************
           codekey% = codekey.mavorg
     
           vorgÑnger% = CodeVMA.mavorg
           _cuma% = codema.mavorg
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY vorgÑnger% FILE "maadr" INDEX CodeMA.maadr
           stufe% = stufe.maadr
           NameVorg$ = LTRIM$ (nachname.maadr) + "," + LTRIM$ (vorname.maadr) + "," + agenturnr.maadr
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY _cuma% LOCK FILE "maadr" INDEX CodeMA.maadr
           NameVorg.maadr = NameVorg$
           VorgÑnger.maadr = vorgÑnger%
           IF vorgÑnger% <> _cuma% THEN 
             stufe.maadr = stufe% + 1
           ELSE 
             stufe.maadr = 1
           END IF 
           req% = 0
           IF gfsc% <> - 1 THEN 
             REQUEST "Sollen die Felder Stufe und Titel automatisch ausgefÅllt werden?","",135,req%
           END IF 
           s$ = STR$ (stufe.maadr,"00")
           IF req% = 1 THEN 
             feld$ = "Titel" + s$ + ".stamm"
             IstTitel.maadr = feld$$
           END IF 
           feld$ = "BWS" + s$ + ".stamm"
           SollBWS.maadr = feld$$
           feld$ = "Squote" + s$ + ".stamm"
           SollQuote.maadr = feld$$
           feld$ = "MAAnz" + s$ + ".stamm"
           SollMAAnz.maadr = feld$$
           IstBWS.maadr = BWSGes.maadr + SBwsges.maadr
           istbwseu.maadr = VAL ( STR$ (IstBWS.maadr / umrechnung.stamm,"999999999.00"))
           CALL FStore("maadr")
           SELECT KEY codekey% LOCK FILE "mavorg" INDEX codekey.mavorg
           aktiviert.mavorg = "j"
           STORE FILE "mavorg"
           cfile$ = FILE 
           IF KonTest$ <> "FALSE" AND Gfsc% <> - 1 THEN CALL KondTestKo()
           FILE cfile$
           SELECT FORM KEY _cuma% FILE "maadr" INDEX CodeMA.maadr
           SELECT KEY codekey% FILE "mavorg" INDEX codekey.mavorg
     
           IF aktiviert.mavorg = "j" THEN 
             aktiv$ = "aktiviert !"
             f.aktiv.ForeColor = 2
             f.avorg.enabled = 0
           ELSE 
             aktiv$ = "aktivieren"
             f.aktiv.ForeColor = 4
             f.avorg.enabled = - 1
           END IF 
           FORM 
           REM ***********************************************
         END IF 
 
       END IF 
 
 REMOVE DIALOG "Konto1"
       REM CALL Fehler("Der gewÑhlte VorgÑnger ist der bereits aktive VorgÑnger,","deshalb kann er nicht Åbernommen werden!")
     REM END IF 
   END IF 
   REM IF KonTest$ <> "FALSE" THEN CALL KondTestKo()
 END IF 
vend130199: 
 FILE "MAADR"
 SELECT FORM KEY _cuma% FILE "MAADR" INDEX CodeMA.MAADR
 SELECT KEY _cuma% FILE "MAVORG" INDEX CodeMA.MAVORG
 SET INDEX Nachname.MAADR
 INDEX Nachname.MAADR
 FORM 
 END SUB 
 
  

 
SUB Vorgaend(codema%)
 CALL DFile(3,"vkond" + _fpw$)
 IF disabled%("VORGAENGER") THEN END SUB 
 IF ag$ = "j" THEN 
   CALL Fehler("Diese Funktion ist fÅr SmartPROVIS Agentur gesperrt!","")
   END SUB 
 END IF 
 _cuma% = CodeMA%
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 VorgÑnger% = VorgÑnger.MAADR
 ok% = - 1
 codekey% = codekey.mavorg
 
 DIM Agenturen$( RECCOUNT ("MAADR"))
 DIM Auswahl$(1)
 FILE "MAADR"
 INDEX Nachname.MAADR
 SELECT FIRST 
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR,40)
   Agenturen$(a%) = test$ + "   " + PAD$ (Agenturnr.maadr,20) + STR$ (stufe.maadr,"000") + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
   IF CodeMA.MAADR = VorgÑnger% THEN prompt$ = Agenturen$(a%)
   SELECT NEXT 
   a% = a% + 1
 WEND 
 REM CREATE DIALOG "MASUCH",0,0,308,288,"Strukturaufbau","MS Sans Serif",8
 CREATE DIALOG "MASUCH",0,0,308,288,"Strukturaufbau","MS Sans Serif",7
 ADD DIALOG "MASUCH",4,0,0,308,263,0,""
 ADD DIALOG "MASUCH",9,5,5,21,21,2
 ADD DIALOG "MASUCH",5,37,5,151,10,0,"Bitte wÑhlen Sie einen VorgÑnger aus:"
 ADD DIALOG "MASUCH",5,37,15,300,10,0,"Vermittler                        Agenturnummer       Stufe"
 ADD DIALOG "MASUCH",7,7,27,298,229,2,2,Agenturen$,Auswahl$,prompt$
 ADD DIALOG "MASUCH",1,86,268,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,143,268,55,15,0,"&Abbrechen",0,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 IF req% = 1 THEN 
   vorgÑnger% = VAL ( RIGHT$ (Auswahl$(0),6))
   IF vorgÑnger% > 0 THEN 
     IF vorgÑnger% <> vorgÑnger.maadr THEN 
       SELECT KEY vorgÑnger% FILE "maadr" INDEX CodeMA.maadr
       maname$ = nachname.maadr
       mavorname$ = vorname.maadr
       maagnr$ = Agenturnr.maadr
 
     REM BLANK FILE "mavorg"
     
     REM codekey% = SER ("mavorg",1)
     REM codekey.mavorg = codekey%
       SELECT KEY codekey% LOCK FILE "mavorg" INDEX codekey.mavorg
       codema.mavorg = codema%
       codevma.mavorg = vorgÑnger%
       NameVMA.mavorg = maname$
       VornameMA.mavorg = mavorname$
       AgenturnrVMA.mavorg = maagnr$
       von.mavorg = TODAY 
       aktiviert.mavorg = "n"
       STORE FILE "mavorg"
     ELSE 
       CALL Fehler("Der gewÑhlte VorgÑnger ist der bereits aktive VorgÑnger,","deshalb kann er nicht Åbernommen werden!")
     END IF 
   END IF 
   REM IF KonTest$ <> "FALSE" THEN CALL KondTestKo()
 END IF 
 FILE "MAADR"
 SELECT KEY _cuma% FILE "MAADR" INDEX CodeMA.MAADR
 SET INDEX Nachname.MAADR
 INDEX Nachname.MAADR
 FORM 
 END SUB 
 
 




 
SUB ExpOutlook()
 dir$ = DIRECTORY 
 Adressen$ = "ADRESSEN"
 adrtemp$ = "OUTLADR1"
 CALL DFile(2,"OFFICE\OUTLADR1" + _fpw$)
 CALL DFile(2,"OFFICE\OUTKAL" + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 REMOVE FROM FILE "OUTLADR1"
 REMOVE FROM FILE "OUTKAL"
 REM adressen$ = GAdrDat$
 ansionoff$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))


         a% = 0
         WHILE AdrFound$(a%) <> ""
           FILE Adressen$
           SELECT FIRST 
          
           IF adressen$ = GAdrDat$ THEN 
             codeku% = VAL ( RIGHT$ (AdrFound$(a%),6))
             SELECT KEY codeku% FILE Adressen$ INDEX codeku.Adressen$
           END IF 
           
           abz% = abz% + 1
           SET STATUS "Anzahl der verarbeiteten Adressen: " + STR$ (abz%,"99999999")
           REM codeku% = codeku.GAdrDat$
           REM 200999
         IF ASerJN = "j" AND req% = 1 THEN 
         ELSE 
           BLANK FILE adrtemp$
           Anrede.adrtemp$ = VSNRPack3$(Anrede.Adressen$)
           REM CALL Fehler("SER","")
           IF anrede.Adressen$ LIKE "Herr*" OR anrede.Adressen$ LIKE "Fr*" OR anrede.Adressen$ LIKE "Fam*" OR anrede.Adressen$ LIKE "Ehe*" OR anrede.Adressen$ LIKE "Kind*" THEN 
             Nachname.adrtemp$ = LEFT$ (VSNRPack3$(Nachname.Adressen$),50)
             Vorname.adrtemp$ = LEFT$ (VSNRPack3$(Vorname.Adressen$),50)
             adr$ = "Adresse: " + VSNRPack3$(Vorname.Adressen$) + ", " + VSNRPack3$(Nachname.Adressen$) + CHR$ (13) + CHR$ (10)
           ELSE 
             Nachname.adrtemp$ = LEFT$ (VSNRPack3$(Nachname.Adressen$),50)
             Vorname.adrtemp$ = LEFT$ (VSNRPack3$(Vorname.Adressen$),50)
             WeitereVornamen.adrtemp$ = LEFT$ (VSNRPack3$(Geburtsname.Adressen$),50)
             adr$ = "Adresse: " + VSNRPack3$(Vorname.Adressen$) + ", " + VSNRPack3$(Nachname.Adressen$) + ", " + VSNRPack3$(Geburtsname.adressen$) + CHR$ (13) + CHR$ (10)
 
           END IF 
           Strassegesch.adrtemp$ = LEFT$ (VSNRPack3$(Stra·e.Adressen$),50)
           Postleitzahlges.adrtemp$ = LEFT$ (VSNRPack3$(PLZ.Adressen$),8)
           Ortgesch.adrtemp$ = LEFT$ (VSNRPack3$(Ort.Adressen$),50)
           adr$ = adr$ + VSNRPack3$(Stra·e.Adressen$) + ", " + VSNRPack3$(PLZ.Adressen$) + " " + VSNRPack3$(Ort.Adressen$)
           Landgesch.adrtemp$ = VSNRPack3$(Land.Adressen$)
           Geburtstag.adrtemp$ = DATE$ (Geburtstag.Adressen$,"0d.mm.yyyy")
           Konto.adrtemp$ = VSNRPack3$(K1Konto.Adressen$)
           Notizen.adrtemp$ = VSNRPack3$(Notiz.Adressen$)
           Stichworter.adrtemp$ = VSNRPack3$(Stichwort.Adressen$)
           Beruf.adrtemp$ = VSNRPack3$(Beruf.Adressen$)
           Hobby.adrtemp$ = VSNRPack3$(Hobbys.Adressen$)
           Geschlecht.adrtemp$ = VSNRPack3$(Geschlecht.Adressen$)
           Kinder.adrtemp$ = VSNRPack3$(K1Name.Adressen$ + ", " + K2Name.Adressen$ + ", " + K3Name.adressen$ + ", " + k4name.adressen$)
           codema% = Codema.Adressen$
           REM 061196
           IF EXISTS (codeku%,codeku.GTelDat$) THEN 
             FILE GTelDat$
             INDEX codeku.GTelDat$
             SELECT FIRST 
             SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
             abi% = 0
             note$ = ""
             WHILE codeku.GTelDat$ = codeku% AND abi% < 20 AND NOT EOF (GTelDat$)
               abi% = abi% + 1
                   
               IF fonoderfax.GTelDat$ <> "j" THEN 
                 IF Mobiltelefon.adrtemp$ = "" AND (art.GTelDat$ LIKE "mobi*" OR art.GTelDat$ LIKE "Funk*") THEN 
                   Mobiltelefon.adrtemp$ = VSNRPack3$(nummer.GTelDat$)
                 END IF 
                 IF Webseite.adrtemp$ = "" AND (art.GTelDat$ LIKE "www*" OR nummer.GTelDat$ LIKE "www*" OR art.GTelDat$ LIKE "*www*" OR nummer.GTelDat$ LIKE "*www*") THEN 
                   Webseite.adrtemp$ = VSNRPack3$(nummer.GTelDat$)
                 END IF 
                 IF emailadresse.adrtemp$ = "" AND (art.GTelDat$ LIKE "*@*" OR nummer.GTelDat$ LIKE "*@*") THEN 
                   emailadresse.adrtemp$ = VSNRPack3$(nummer.GTelDat$)
                   emailangezeigte.adrtemp$ = VSNRPack3$(nummer.GTelDat$)
                 END IF 
                 IF Telefongesch.adrtemp$ = "" THEN 
                   Telefongesch.adrtemp$ = VSNRPack3$(nummer.GTelDat$)
                 END IF 
               ELSE 
                 IF faxgesch.adrtemp$ = "" THEN 
                   faxgesch.adrtemp$ = VSNRPack3$(nummer.GTelDat$)
                 END IF 

               END IF 

               note$ = note$ + VSNRPack3$(art.GTelDat$ + "  " + nummer.GTelDat$) + CHR$ (13) + CHR$ (10)
             SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
             WEND 
             notizen.adrtemp$ = note$ + CHR$ (13) + CHR$ (10) + notizen.adrtemp$
             adr$ = adr$ + CHR$ (13) + CHR$ (10) + note$ + CHR$ (13) + CHR$ (10)
           END IF 
           FILE adrtemp$
           STORE FILE adrtemp$
         END IF 
         FILE adressen$
         REM SELECT NEXT FILE GAdrDat$
         REM IF nachname.adressen LIKE "klam*" THEN CALL Fehler("","")
         IF EXISTS (codeku%,codeku.GAkquiDat$) THEN 
           cfile$ = FILE 
           FILE GAkquiDat$
           INDEX codeku.GAkquiDat$
           SELECT FIRST 
           SELECT KEY codeku% FILE GAkquiDat$ INDEX codeku.GAkquiDat$
           WHILE NOT EOF (GAkquiDat$) AND codeku.GAkquiDat$ = codeku%
             IF erledigt_Termin.GAkquiDat$ <> "j" THEN 
               SELECT KEY codeak.GAkquiDat$ FILE "Aktionen" INDEX codeak.aktionen
               BLANK FILE "outkal"
               Betreff.outkal = VSNRPack3$(notiz.GAkquiDat$)
               Beschreibung.outkal = adr$ + CHR$ (13) + CHR$ (10) + VSNRPack3$(ergebnis.GAkquiDat$)
               Beginntam.outkal = DATE$ (termin.GAkquiDat$,"0d.mm.yyyy")
               IF uhrzeit.GAkquiDat$ < 1 THEN 
                 Beginntum.outkal = "09:00"
               ELSE 
                 Beginntum.outkal = TIME$ (uhrzeit.GAkquiDat$,"hh:mm")
               END IF 
               IF erdatum.GAkquiDat$ > 0 THEN 
                 Erinnerungam.outkal = DATE$ (erdatum.GAkquiDat$,"0d.mm.yyyy")
                 Erinnerungum.outkal = TIME$ (erzeit.GAkquiDat$,"hh:mm")
               ELSE 
                 Erinnerungam.outkal = Beginntam.outkal
                 Erinnerungum.outkal = Beginntum.outkal
               END IF 
               Kategorien.outkal = VSNRPack3$(Bezeichnung.aktionen)
               STORE FILE "outkal"
             END IF 
             SELECT NEXT FILE GAkquiDat$ INDEX codeku.GAkquiDat$
           WEND 
           FILE cfile$
         END IF 
         a% = a% + 1
         WEND 

 DIRECTORY GMACodeDir$
 tf$ = FILE 
 FILE "OUTLADR1"
 Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
 Superbase.Converters.SBF.SourceFile = "OUTLADR1"
 Superbase.Converters.SBF.Descending = 0
 Superbase.Converters.SBF.Merge = 0
 Superbase.Converters.SBF.LogErrors = 0
 Superbase.Converters.SBF.MultiResponse = 0
 Superbase.Converters.CSV.DestFormat = "Comma-separated values"
 Superbase.Converters.CSV.DestFile = "outadr.CSV"
 Superbase.Converters.CSV.UseLabels = - 1
 Superbase.Converters.CSV.ANSIConvert = - 1
 Superbase.Converters.CSV.Convert(Superbase.Converters.SBF)


 FILE "OUTKAL"
 Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
 Superbase.Converters.SBF.SourceFile = "OUTKAL"
 Superbase.Converters.SBF.Descending = 0
 Superbase.Converters.SBF.Merge = 0
 Superbase.Converters.SBF.LogErrors = 0
 Superbase.Converters.SBF.MultiResponse = 0
 Superbase.Converters.CSV.DestFormat = "Comma-separated values"
 Superbase.Converters.CSV.DestFile = "outkal.CSV"
 Superbase.Converters.CSV.UseLabels = - 1
 Superbase.Converters.CSV.ANSIConvert = - 1
 Superbase.Converters.CSV.Convert(Superbase.Converters.SBF)

 FILE tf$
 DIRECTORY dir$
 REQUEST "Export nach MS Outlook beendet!","",0
 tt0$ = "Sie kînnen die Dateien in Outlook importieren,in dem Sie in MS Outlook im MenÅ "
 t1$ = "Es wurden 2 Exportdateien erstellt. Die erstellten Dateien hei·en " + GMACodeDir$ + "outadr.csv (Adressen) und " + GMACodeDir$ + "outkal.csv (Termine)." + tt0$
 t2$ = "Datei/Importieren-Exportieren/Import aus anderen Programmen/Kommagetrennte Werte (Window) / Kontakte (fÅr die Adressen) oder Kalender (fÅr die Termine) wÑhlen und dort dann per Feldzuortnung die Felder verbinden!"
 CALL Fehler(t1$,t2$)
 END SUB 

FUNCTION VSNRPack3$(VSNR$)
 tVSNR$ = ""
 FOR a% = 1 TO LEN (VSNR$)
   tC$ = MID$ (VSNR$,a%,1)
   tC1$ = UCASE$ ( MID$ (VSNR$,a%,1))
         x% = ASC ( LEFT$ ( UCASE$ (tC$),1))
         SELECT CASE x%
           CASE 142
             tC$ = "ae"
           CASE 153
             tC$ = "oe"
           CASE 154
             tC$ = "ue"
         END SELECT 
         IF tc$ LIKE "·" THEN tc$ = "ss"
   tVSNR$ = tVSNR$ + tC$
 NEXT a%
 VSNRPack3$ = tVSNR$
 END FUNCTION 
 
FUNCTION VSNRPackFS$(VSNR$)
 tVSNR$ = ""
 FOR a% = 1 TO LEN (VSNR$)
   tC$ = MID$ (VSNR$,a%,1)
   tC1$ = UCASE$ ( MID$ (VSNR$,a%,1))
         x% = ASC ( LEFT$ ( UCASE$ (tC$),1))
         SELECT CASE x%
           CASE 142
             tC$ = "ae"
           CASE 153
             tC$ = "oe"
           CASE 154
             tC$ = "ue"
         END SELECT 
         IF tc$ LIKE "·" THEN tc$ = "ss"
         IF tc$ LIKE " " THEN tc$ = ""
   tVSNR$ = tVSNR$ + tC$
 NEXT a%
 VSNRPackFS$ = tVSNR$
 END FUNCTION 

SUB LISTPROYNeu(vondat$,bisdat$,allprov$,ma%)
 REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
     Header$ = "Provisionsliste in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 GROUP QNameCodema.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1,Betrag.BUCHUNG1 AS "BAgentur%",SR.BUCHUNG1 AS "SumBStorno%",BetnGezahlt% AS "SumBNBez%",BetnDiff% AS "BGesSum%",Einheiten.BUCHUNG1 AS "BSumEinh%"
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Datum.BUCHUNG1
     SET REPORT PAGE "F_Datum.BUCH003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO LYNeu1206200101
 IF ma% = 0 THEN 
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     
   END IF 
 END IF 
 IF ma% > 0 THEN 
   IF Gdruvonma% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$)
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$) AND mahnung.buchung1 <> "j"
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
     END IF 
   ELSE 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$) AND VTCodeMA.buchung1 = Gdruvonma%
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$) AND mahnung.buchung1 <> "j" AND VTCodeMA.buchung1 = Gdruvonma%
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
     END IF 
   END IF 
 END IF 
 END SELECT 
LYNeu1206200101: 
   ON ERROR GOTO ErrorHandler 
 END SUB 


SUB LISTPROYNN(vondat$,bisdat$,allprov$,ma%)
 REM REPORT USING "LISTPROY"
 REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
     Header$ = "Provisionsliste in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 GROUP CodeMA.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1,Betrag.BUCHUNG1 AS "BAgentur%",SR.BUCHUNG1 AS "SumBStorno%",BetnGezahlt% AS "SumBNBez%",BetnDiff% AS "BGesSum%",Einheiten.BUCHUNG1 AS "BSumEinh%"
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Datum.BUCHUNG1
     SET REPORT PAGE "F_Datum.BUCH003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO LYNeu1206200101
 IF ma% = 0 THEN 
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     
   END IF 
 END IF 
 IF ma% > 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$)
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$) AND mahnung.buchung1 <> "j"
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
     END IF 
 END IF 
 END SELECT 
LYNeu1206200101: 
   ON ERROR GOTO ErrorHandler 
 
 END SUB 
 



SUB LISTPROD()
 CALL PRep("LISTPROD")
 REPORT ON BetragEU.BUCHUNG AS "SSumAgentur%",SREU.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG AS "SumAgentur%",SREU.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG
 BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SELECT ;
     WHERE CodeMA.BUCHUNG = CodeMA.MAADR
     ORDER REPORT Nachname.MAADR,Kunde$
     TO ASK 
 END SELECT 
 END SUB 
 

 REM öbernahme der Bankverbindung von der Adresse
SUB KVertBank(codeku%,lfdnr%)
 SELECT KEY codeku% FILE "Adressen" INDEX codeku.adressen
 DIM Keyword$(4)
 i% = 0
 IF k1blz.adressen <> "" THEN 
   Keyword$(i%) = "Bank01: BLZ: " + k1blz.adressen + "   Bank: " + k1bank.adressen + "   Konto: " + k1Konto.adressen + "   Inhaber " + Kontoinh1.adressen
   i% = i% + 1
 END IF 
 IF k2blz.adressen <> "" THEN 
   Keyword$(i%) = "Bank02: BLZ: " + k2blz.adressen + "   Bank: " + k2bank.adressen + "   Konto: " + k2Konto.adressen + "   Inhaber " + Kontoinh2.adressen
   i% = i% + 1
 END IF 
 IF k3blz.adressen <> "" THEN 
   Keyword$(i%) = "Bank03: BLZ: " + k3blz.adressen + "   Bank: " + k3bank.adressen + "   Konto: " + k3Konto.adressen + "   Inhaber " + Kontoinh3.adressen
   i% = i% + 1
 END IF 
 Keyword$(i%) = ""
 i% = i% + 1
 prompt$ = Keyword$(0)
     CREATE DIALOG "KEYWORD",0,0,433,100,"Wahl der Bankverbindung","MS Sans Serif",8
     ADD DIALOG "KEYWORD",4,0,1,433,76,0,""
     ADD DIALOG "KEYWORD",9,4,5,21,24,2
     ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie die Bankverbindung aus:"
     ADD DIALOG "KEYWORD",7,4,25,425,52,2,2,Keyword$,Auswahl$,prompt$
     ADD DIALOG "KEYWORD",1,170,82,55,15,1,"&OK",1,1
     ADD DIALOG "KEYWORD",1,226,82,55,15,0,"&Abbrechen",0,0
     DIALOG "KEYWORD",req%
     REMOVE DIALOG "KEYWORD"
     IF req% = 0 THEN END SUB 
     IF req% = 1 THEN 
       a$ = LEFT$ (Auswahl$(0),6)
       SELECT KEY lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
       SELECT CASE UCASE$ (a$)
         CASE "BANK01"
           k1BLZ.kvertrag = k1blz.adressen
           k1Bank.kvertrag = k1bank.adressen
           k1konto.kvertrag = k1konto.adressen
           kontoinh.kvertrag = Kontoinh1.adressen
           CALL MATimeStamp("KVERTRAG")
           STORE FILE "KVERTRAG"
           UNLOCK CURRENT FILE "KVERTRAG"
         CASE "BANK02"
           k1BLZ.kvertrag = k2blz.adressen
           k1Bank.kvertrag = k2bank.adressen
           k1konto.kvertrag = k2konto.adressen
           kontoinh.kvertrag = Kontoinh2.adressen
           CALL MATimeStamp("KVERTRAG")
           STORE FILE "KVERTRAG"
           UNLOCK CURRENT FILE "KVERTRAG"
         CASE "BANK03"
           k1BLZ.kvertrag = k3blz.adressen
           k1Bank.kvertrag = k3bank.adressen
           k1konto.kvertrag = k3konto.adressen
           kontoinh.kvertrag = Kontoinh3.adressen
           CALL MATimeStamp("KVERTRAG")
           STORE FILE "KVERTRAG"
           UNLOCK CURRENT FILE "KVERTRAG"
       END SELECT 
     END IF 
 END SUB 


 REM einzelne Adresse in Terminen aktualisieren

SUB ADRAkquiAkt()
  MOUSE OFF 
  codeku% = codeku.GAdrDat$
  nachname$ = LEFT$ ( TRIM$ (nachname.GAdrDat$) + "," + TRIM$ (vorname.GadrDat$),100)
  ort$ = Ort.GAdrDat$
  FILE GAkquiDat$
  INDEX codeku.GAkquiDat$
  IF EXISTS (codeku%,codeku.GAkquiDat$) THEN 
    SELECT FIRST 
    SELECT KEY codeku% LOCK FILE GAkquiDat$ INDEX codeku.GAkquiDat$
    i% = 0
    WHILE NOT EOF (GAkquiDat$) AND codeku.GAkquiDat$ = codeku%
      i% = i% + 1
      SET STATUS STR$ (i%) + " Termine geÑndert"
      Nachname.GAkquiDat$ = nachname$
      Ort.GAkquiDat$ = ort$
      STORE FILE GAkquiDat$
      UNLOCK CURRENT FILE GAkquiDat$
      SELECT NEXT LOCK FILE GAkquiDat$ INDEX codeku.GAkquiDat$
    WEND 
  END IF 
  FILE GAdrDat$
  MOUSE ON 
 END SUB 

 REM alle Adressen in Terminen aktualisieren
SUB ADRAkquiAktG()
  MOUSE OFF 
  FILE GAkquiDat$
  INDEX codeku.GAkquiDat$
  SELECT FIRST LOCK 
  MOUSE OFF 
    
    i% = 0
    WHILE NOT EOF (GAkquiDat$)
      codeku% = codeku.GAkquiDat$
      IF EXISTS (codeku%,codeku.GAdrDat$) THEN 
        SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
        i% = i% + 1
        SET STATUS STR$ (i%) + " Termine geÑndert"
        Nachname.GAkquiDat$ = LEFT$ ( TRIM$ (nachname.GAdrDat$) + "," + TRIM$ (vorname.GadrDat$),100)
        Ort.GAkquiDat$ = ort.GAdrDat$
        STORE FILE GAkquiDat$
        UNLOCK CURRENT FILE GAkquiDat$
      END IF 
      SELECT NEXT LOCK FILE GAkquiDat$ INDEX codeku.GAkquiDat$
    WEND 
  MOUSE ON 
  FILE GAdrDat$
  MOUSE ON 
 END SUB 

 REM ************************************************************************************************************
 REM *    zu versichernde Person in dem Vertrag eintragen                                                       *
 REM *    AB 11.08.2001                                                                                         *
 REM *    nr% - Feldnr der zu versichernden Person 1-6                                                          *
 REM *    lfdnr% - laufende Nr des Vertrages                                                                    *
 REM *    codeku% - codeku der Adresse                                                                          *
 REM ************************************************************************************************************

SUB VertrZVP(nr%,lfdnr%,codeku%)
       SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
       REDIM AdrFound$(6,1)
       REDIM AdrFound$(6)
       a% = 0
       AdrFound$(0) = Nachname.adressen + ", " + Vorname.adressen + ", " + DATE$ (Geburtstag.adressen,"0d.mm.yyyy") + SPACE$ (200) + "0"
       a% = a% + 1
       IF K1Name.adressen <> "" THEN 
         AdrFound$(a%) = K1NName.adressen + ", " + K1Name.adressen + ", " + DATE$ (K1Geburtstag.adressen,"0d.mm.yyyy") + SPACE$ (200) + "1"
         a% = a% + 1
       END IF 
       IF K2Name.adressen <> "" THEN 
         AdrFound$(a%) = K2NName.adressen + ", " + K2Name.adressen + ", " + DATE$ (K2Geburtstag.adressen,"0d.mm.yyyy") + SPACE$ (200) + "2"
         a% = a% + 1
       END IF 
       IF K3Name.adressen <> "" THEN 
         AdrFound$(a%) = K3NName.adressen + ", " + K3Name.adressen + ", " + DATE$ (K3Geburtstag.adressen,"0d.mm.yyyy") + SPACE$ (200) + "3"
         a% = a% + 1
       END IF 
       IF K4Name.adressen <> "" THEN 
         AdrFound$(a%) = K4NName.adressen + ", " + K4Name.adressen + ", " + DATE$ (K4Geburtstag.adressen,"0d.mm.yyyy") + SPACE$ (200) + "4"
         a% = a% + 1
       END IF 
       IF EGNachname.adressen <> "" OR EGVorname.adressen <> "" THEN 
         AdrFound$(a%) = EGNachname.adressen + ", " + EGVorname.adressen + ", " + DATE$ (EGGeburtstag.adressen,"0d.mm.yyyy") + SPACE$ (200) + "5"
         a% = a% + 1
       END IF 
       CREATE DIALOG "ADRLISTE",0,0,300,120,"zu versichernde Person","MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,2,8,388,90,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,110,100,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,174,100,56,16,0,"&Abbrechen",0,0
       DIALOG "ADRLISTE",req3%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req3% = 1 THEN 
         SELECT CASE nr%
           CASE 1
             feldName$ = "zvP1Name.kvertrag"
             feldVName$ = "zvP1VName.kvertrag"
             feldort$ = "zvP1ort.kvertrag"
             feldplz$ = "zvP1plz.kvertrag"
             feldstrasse$ = "zvP1strasse.kvertrag"
             feldGeb$ = "zvP1Geb.kvertrag"
             feldGeschl$ = "zvP1Geschlecht.kvertrag"
             REM feldGebort$ = "GebortP1.kvertrag"
           CASE 2
             feldName$ = "zvP2Name.kvertrag"
             feldVName$ = "zvP2VName.kvertrag"
             feldort$ = "zvP2ort.kvertrag"
             feldplz$ = "zvP2plz.kvertrag"
             feldstrasse$ = "zvP2strasse.kvertrag"
             feldGeb$ = "zvP2Geb.kvertrag"
             feldGeschl$ = "zvP2Geschlecht.kvertrag"
             REM feldGebort$ = "GebortP2.kvertrag"
           CASE 3
             feldName$ = "zvP3Name.kvertrag"
             feldVName$ = "zvP3VName.kvertrag"
             feldort$ = "zvP3ort.kvertrag"
             feldplz$ = "zvP3plz.kvertrag"
             feldstrasse$ = "zvP3strasse.kvertrag"
             feldGeb$ = "zvP3Geb.kvertrag"
             feldGeschl$ = "zvP3Geschlecht.kvertrag"
             REM feldGebort$ = "GebortP3.kvertrag"
           CASE 4
             feldName$ = "zvP4Name.kvertrag"
             feldVName$ = "zvP4VName.kvertrag"
             feldort$ = "zvP4ort.kvertrag"
             feldplz$ = "zvP4plz.kvertrag"
             feldstrasse$ = "zvP4strasse.kvertrag"
             feldGeb$ = "zvP4Geb.kvertrag"
             feldGeschl$ = "zvP4Geschlecht.kvertrag"
             REM feldGebort$ = "GebortP4.kvertrag"
           CASE 5
             feldName$ = "zvP5Name.kvertrag"
             feldVName$ = "zvP5VName.kvertrag"
             feldort$ = "zvP5ort.kvertrag"
             feldplz$ = "zvP5plz.kvertrag"
             feldstrasse$ = "zvP5strasse.kvertrag"
             feldGeb$ = "zvP5Geb.kvertrag"
             feldGeschl$ = "zvP5Geschlecht.kvertrag"
             REM feldGebort$ = "GebortP5.kvertrag"
           CASE 6
             feldName$ = "zvP6Name.kvertrag"
             feldVName$ = "zvP6VName.kvertrag"
             feldort$ = "zvP6ort.kvertrag"
             feldplz$ = "zvP6plz.kvertrag"
             feldstrasse$ = "zvP6strasse.kvertrag"
             feldGeb$ = "zvP6Geb.kvertrag"
             feldGeschl$ = "zvP6Geschlecht.kvertrag"
             REM feldGebort$ = "GebortP6.kvertrag"
         END SELECT 
         LAuswahl$ = LAuswahl1$(0)
         ausw% = VAL ( RIGHT$ (LAuswahl$,1))
         SELECT KEY lfdnr% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
         IF ausw% = 0 THEN 
           feldVName$$ = Vorname.adressen
           feldName$$ = Nachname.adressen
           feldort$$ = ort.adressen
           feldplz$$ = plz.adressen
           feldstrasse$$ = stra·e.adressen
           feldGeb$$ = Geburtstag.adressen
           feldGeschl$$ = Geschlecht.adressen
           REM feldGebort$$ = Gebort.adressen
         END IF 
         IF ausw% = 1 THEN 
           feldvName$$ = K1Name.adressen
           IF k1NName.adressen <> "" THEN 
             feldName$$ = K1Nname.adressen
           ELSE 
             feldName$$ = Nachname.adressen
           END IF 
           IF k1ort.adressen <> "" THEN 
             feldort$$ = k1ort.adressen
           ELSE 
             feldort$$ = ort.adressen
           END IF 
           IF k1plz.adressen <> "" THEN 
             feldplz$$ = k1plz.adressen
           ELSE 
             feldplz$$ = plz.adressen
           END IF 
           IF k1strasse.adressen <> "" THEN 
             feldstrasse$$ = k1strasse.adressen
           ELSE 
             feldstrasse$$ = stra·e.adressen
           END IF 
           IF GebortK1.adressen <> "" THEN 
             REM feldGebort$$ = GebortK1.adressen
           ELSE 
             REM feldGebort$$ = Gebort.adressen
           END IF 
           feldGeschl$$ = K1Geschlecht.adressen
           feldGeb$$ = K1Geburtstag.adressen
         END IF 
         IF ausw% = 2 THEN 
           feldvName$$ = K2Name.adressen
           IF k2NName.adressen <> "" THEN 
             feldName$$ = K2Nname.adressen
           ELSE 
             feldName$$ = Nachname.adressen
           END IF 
           IF k2ort.adressen <> "" THEN 
             feldort$$ = k2ort.adressen
           ELSE 
             feldort$$ = ort.adressen
           END IF 
           IF k2plz.adressen <> "" THEN 
             feldplz$$ = k2plz.adressen
           ELSE 
             feldplz$$ = plz.adressen
           END IF 
           IF k2strasse.adressen <> "" THEN 
             feldstrasse$$ = k2strasse.adressen
           ELSE 
             feldstrasse$$ = stra·e.adressen
           END IF 
           IF GebortK2.adressen <> "" THEN 
             REM feldGebort$$ = GebortK2.adressen
           ELSE 
             REM feldGebort$$ = Gebort.adressen
           END IF 
           feldvName$$ = K2Name.adressen
           feldGeschl$$ = K2Geschlecht.adressen
           feldGeb$$ = K2Geburtstag.adressen
         END IF 
         IF ausw% = 3 THEN 
           feldvName$$ = K3Name.adressen
           IF k3NName.adressen <> "" THEN 
             feldName$$ = K3nname.adressen
           ELSE 
             feldName$$ = Nachname.adressen
           END IF 
           IF k3ort.adressen <> "" THEN 
             feldort$$ = k3ort.adressen
           ELSE 
             feldort$$ = ort.adressen
           END IF 
           IF k3plz.adressen <> "" THEN 
             feldplz$$ = k3plz.adressen
           ELSE 
             feldplz$$ = plz.adressen
           END IF 
           IF k3strasse.adressen <> "" THEN 
             feldstrasse$$ = k3strasse.adressen
           ELSE 
             feldstrasse$$ = stra·e.adressen
           END IF 
           IF GebortK3.adressen <> "" THEN 
             REM feldGebort$$ = GebortK3.adressen
           ELSE 
             REM feldGebort$$ = Gebort.adressen
           END IF 
           feldGeschl$$ = K3Geschlecht.adressen
           feldGeb$$ = K3Geburtstag.adressen
         END IF 
         IF ausw% = 4 THEN 
           feldvName$$ = K4Name.adressen
           IF k4NName.adressen <> "" THEN 
             feldName$$ = K4Nname.adressen
           ELSE 
             feldName$$ = Nachname.adressen
           END IF 
           IF k4ort.adressen <> "" THEN 
             feldort$$ = k4ort.adressen
           ELSE 
             feldort$$ = ort.adressen
           END IF 
           IF k4plz.adressen <> "" THEN 
             feldplz$$ = k4plz.adressen
           ELSE 
             feldplz$$ = plz.adressen
           END IF 
           IF k4strasse.adressen <> "" THEN 
             feldstrasse$$ = k4strasse.adressen
           ELSE 
             feldstrasse$$ = stra·e.adressen
           END IF 
           IF GebortK4.adressen <> "" THEN 
             REM feldGebort$$ = GebortK4.adressen
           ELSE 
             REM feldGebort$$ = Gebort.adressen
           END IF 
           feldGeschl$$ = K4Geschlecht.adressen
           feldGeb$$ = K4Geburtstag.adressen
         END IF 
         IF ausw% = 5 THEN 
           feldvName$$ = EGVorname.adressen
           feldName$$ = EGNachname.adressen
           IF egasort.adressen <> "" THEN 
             feldort$$ = egasort.adressen
           ELSE 
             feldort$$ = ort.adressen
           END IF 
           IF egasplz.adressen <> "" THEN 
             feldplz$$ = egasplz.adressen
           ELSE 
             feldplz$$ = plz.adressen
           END IF 
           IF egasstra·e.adressen <> "" THEN 
             feldstrasse$$ = egasstra·e.adressen
           ELSE 
             feldstrasse$$ = stra·e.adressen
           END IF 
           IF EGGebort.adressen <> "" THEN 
             REM feldGebort$$ = EGGebort.adressen
           ELSE 
             REM feldGebort$$ = Gebort.adressen
           END IF 
           feldGeschl$$ = EGGeschlecht.adressen
           feldGeb$$ = EGGeburtstag.adressen
         END IF 
         CALL MATimeStamp("KVERTRAG")
         CALL QuickStore("KVERTRAG")
       END IF 
 END SUB 


 REM *********************************************************************************************************
 REM *           Konditionsverwaltung fÅr Produkte (um eine Sollstellung erzeugen zu kînnen)                 *
 REM *           SUB VPGekond(codevp%)                                                                       *
 REM *                        codevp% - interne Nummer des Produktes                                         *
 REM *           Erstellung:      12.08.2001                                                                 *
 REM *           letzte énderung: 12.08.2001                                                                 *
 REM *********************************************************************************************************
 
SUB VPGekond(codevp%)
 FILE "vpgekond"
 _formend% = 0
 DIRECTORY _ppath$
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   GEKONDMsub% = 0
   IF LEFT$ ( UCASE$ ( FORM ),6) <> "VPGEKO" THEN 
     SET HEADING title$ + " - Produktkonditionen"
     REM OPEN FORM "gekondm"
     IF GAFSK$ LIKE "TRUE" THEN 
       IF EXISTS (GPrjForm$ + "VPGEKOAF.sbv") THEN 
         OPEN FORM GPrjForm$ + "VPGEKOAF"
       ELSE 
         OPEN FORM GPrjForm$ + "VPGEKOAF"
       END IF 
     ELSE 
       IF EXISTS (GPrjForm$ + "VPGEKON1.sbv") THEN 
         OPEN FORM GPrjForm$ + "VPGEKON1"
       ELSE 
         OPEN FORM GPrjForm$ + "VPGEKON1"
       END IF 
     END IF 
     SET f = Superbase.Form
     CALL VPGekondIntro(codevp%)
     CALL MNVPGekond()
     SET STATUS "Produktkonditionen"
     CALL VPGekondUPDATE(codevp%)
   END IF 
   MOUSE ON 
   
   CALL ClearKBDBuffer()
     f.sichern.enabled = 0
     f.abbruch.visible = 0
     f.zurueck.enabled = - 1
     f.bearb.enabled = - 1
     f.neu.enabled = - 1
     f.loe.enabled = - 1
     f.loe.visible = - 1
 
   IF RECCOUNT ("VPGekond") < 1 THEN 
     CALL ButDesabled()
     f.abbruch.visible = 0
     f.abbruch.enabled = 0
     REM f.sparte.enabled = 0
     f.zurueck.enabled = - 1
     f.sichern.enabled = 0
     f.loe.enabled = 0
     f.loe.visible = 0
   END IF 
   IF GAFSK$ LIKE "TRUE" THEN 
     f.afsv.enabled = - 1
     f.afsv.visible = - 1
   ELSE 
     REM f.afsv.enabled = 0
     REM f.afsv.visible = 0
   END IF 
   CALL ClearKBDBuffer()
   GAppName$ = _netpath$ + "DOC\provis.pdf"
   eingbei$ = EingereichtBei.vpgekond
   f.eingbei.enabled = - 1
   IF eingbei$ = "" THEN 
     eingbei$ = "eingereicht Åber"
   END IF 
   IF MNdisabled%("SEEEINGBEI") THEN 
     eingbei$ = "wurde ausgeblendet"
     f.eingbei.enabled = 0
   END IF 
   IF GEKONDMsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL GEKONDPrev()
   CASE CrsRight%,PgDn%
     CALL GEKONDNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE GEKONDMsub%
   CASE 100
     codekey% = codekey.vpgekond
     IF ag$ <> "j" THEN 
       IF NOT disabled%("SOLLSTELLUNGKONDED") AND NOT disabled%("EDITEINGBEI") AND NOT disabled%("SEEEINGBEI") THEN 
         geold% = CodeEingGE.vpgekond
         ge% = GetCodeGEE%(CodeEingGE.vpgekond)
         IF ge% = - 1 THEN GOTO abr300920072
         IF ge% = 0 THEN 
           IF ge% <> geold% THEN 
             MOUSE OFF 
             SELECT FIRST FILE "vpgekond" INDEX codekey.vpgekond
             SELECT KEY codekey% LOCK FILE "vpgekond" INDEX codekey.vpgekond
             CodeEingGE.vpgekond = 0
             EingereichtBei.vpgekond = ""
             eingbei$ = ""
             STORE FILE "vpgekond"
           END IF 
         ELSE 
           MOUSE OFF 
           SELECT FIRST FILE "vpgekond" INDEX codekey.vpgekond
           SELECT KEY codekey% LOCK FILE "vpgekond" INDEX codekey.vpgekond
           REM codevt% = lfdnr.kvertrag
           CodeEingGE.vpgekond = ge%
           EingereichtBei.vpgekond = gesellschaft.geadr
           eingbei$ = gesellschaft.geadr
           STORE FILE "vpgekond"
         END IF 
         FILE "vpgekond"
         FORM 
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion wird in der Agentuvariante nicht unterstÅtzt!","")
     END IF 
abr300920072: 
   CASE 1
     REM in eine einzelne Kondition wechseln
     codekey% = codekey.vpgekond
     SELECT KEY codekey% FILE "VPGEKOND" INDEX codekey.VPGEKOND
     eingbei$ = EingereichtBei.vpgekond
     f.eingbei.enabled = - 1
     IF eingbei$ = "" THEN 
       eingbei$ = "eingereicht Åber"
     END IF 
     IF MNdisabled%("SEEEINGBEI") THEN 
       eingbei$ = "wurde ausgeblendet"
       f.eingbei.enabled = 0
     END IF 
     FORM 2
   CASE 2
     REM neue Kondition erfassen
     IF NOT disabled%("SOLLSTELLUNGKONDNEW") THEN 
       CALL VPGekondNeu(codevp%)
       eingbei$ = EingereichtBei.vpgekond
       f.eingbei.enabled = - 1
       IF eingbei$ = "" THEN 
         eingbei$ = "eingereicht Åber"
       END IF 
       IF MNdisabled%("SEEEINGBEI") THEN 
         eingbei$ = "wurde ausgeblendet"
         f.eingbei.enabled = 0
       END IF 
       f.sichern.enabled = - 1
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       f.zurueck.enabled = 0
       f.bearb.enabled = 0
       f.neu.enabled = 0
       f.loe.enabled = 0
       ENTER BWVON.vpgekond,0
       ENTER END 
       f.sichern.enabled = 0
       f.abbruch.visible = 0
       f.zurueck.enabled = - 1
       f.bearb.enabled = - 1
       f.neu.enabled = - 1
       f.loe.enabled = - 1
     END IF 
   CASE 3
     REM Speichern
     MAName.VPGEKOND = GMANAME$
     MACodeMA.VPGEKOND = GCodeMA%
     STORE FILE "VPGEKOND"
     UNLOCK CURRENT FILE "VPGEKOND"
     ENTER END 
     f.sichern.enabled = 0
     f.abbruch.visible = 0
     f.zurueck.enabled = - 1
     f.bearb.enabled = - 1
     f.neu.enabled = - 1
     f.loe.enabled = - 1
   CASE 4
     REM Lîschen
     codekey% = codekey.vpgekond
     codevp% = codevp.vpgekond
     REQUEST "Kondition wirklich lîschen?","",130,req%
     IF req% = 1 THEN 
       SELECT KEY codekey% LOCK FILE "VPGEKOND" INDEX codekey.vpgekond
       SELECT REMOVE FILE "VPGEKOND"
       CALL VPGekondIntro(codevp%)
       FORM 1
     END IF 
   CASE 99
     IF NOT disabled%("SOLLSTELLUNGKONDED") THEN 
       MENU OFF 
       IF RECCOUNT ("VPGekond") = 0 THEN CALL VPGekondNeu(codevp%)
       MOUSE ON 
       REM 140596
       f.sichern.enabled = - 1
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       f.zurueck.enabled = 0
       f.bearb.enabled = 0
       f.neu.enabled = 0
       f.loe.enabled = 0
       ENTER BWVON.vpgekond,0
       MAName.VPGEKOND = GMANAME$
       MACodeMA.VPGEKOND = GCodeMA%
       REM STORE FILE "VPGEKOND"
       REM UNLOCK CURRENT FILE "VPGEKOND"
       REM ENTER END 
       f.sichern.enabled = 0
       f.abbruch.visible = 0
       f.zurueck.enabled = - 1
       f.bearb.enabled = - 1
       f.neu.enabled = - 1
       f.loe.enabled = - 1
     END IF 
   END SELECT 
   MENU ON 
   GEKONDMsub% = 0
   IF abbruch% = - 1 THEN 
     SELECT KEY codevp% FILE "VPGekond" INDEX codevp.VPGekond
     FORM 
     abbruch% = 0
   END IF 
 WEND 
 _formend% = 0
 cuko% = 0
 END SUB 
 
 ' GEKONDM Intro
 ' =======================================================================
 
SUB VPGekondIntro(codevp%)
 FILE "VPGekond"
 INDEX codevp.VPGekond
 SELECT FORM KEY codevp% FILE "VPRODUKT" INDEX codevp.VPRODUKT
 SELECT KEY codevp% FILE "VPGekond" INDEX codevp.VPGekond
 Gesellschaft$ = gesellschaft.vprodukt + "/" + sparte.vprodukt
 FORM 
 END SUB 
 
SUB VPGekondUPDATE(codevp%)
 SELECT FORM KEY codevp% FILE "VPRODUKT" INDEX codevp.VPRODUKT
 SELECT KEY codevp% FILE "VPGekond" INDEX codevp.VPGekond
 Gesellschaft$ = gesellschaft.vprodukt + "/" + sparte.vprodukt
 FORM 
 END SUB 
    
 
 ' GEKOND Neu
 ' =======================================================================
 
SUB VPGekondNeu(codevp%)
 BLANK FILE "VPGekond"
 SET STATUS "Datensatz neu angelegt..."
 CodeKey.VPGekond = SER ("VPGEKOND",1)
 codevp.VPGekond = codevp%
 bwvon.vpgekond = "01.01.1990"
 ap.vpgekond = 100
 CourtageZWjn.VPGekond = "n"
 PflegeNachZahlw.VPGekond = "n"
 MAName.VPGEKOND = GMANAME$
 MACodeMA.VPGEKOND = GCodeMA%
 REM 140596
 STORE FILE "VPGekond"
 UNLOCK CURRENT FILE "VPGekond"
 SELECT KEY codevp% FILE "VPGekond" INDEX codevp.VPGekond
 GEKONDMsub% = 99
 CALL VPGekondUPDATE(codevp%)
 FORM 
 END SUB 
 
 
 ' GEKONDM Musterkonditionen
 ' =======================================================================
 
SUB MNVPGekond()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
  

 REM **********************************************************************************************************
 REM              Fîrderkonditionen MAADR
 REM **********************************************************************************************************
 
SUB FoerdKond(codema%)
 CALL DFile(3,"maadr" + _fpw$)
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 codema% = codema.maadr
 voncodema% = codema.maadr
 vonAgentur$ = Nachname.maadr + ", " + Vorname.maadr
 BGEADRsub% = 0
 FILE "FOERKOND"
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "FOERKOND" THEN 
     SET HEADING title$ + " - Fîrderkonditionen"
     OPEN FORM GPrjForm$ + "FOERKOND"
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\spezprov.pdf"
     CALL FoerdKondIntro(codema%)
     CALL MNFoerdKond()
     SET STATUS "Fîrderkonditionen"
   END IF 
   MENU ON 
   MOUSE ON 
   BGEADRsub% = 0
   CALL ClearKBDBuffer()
   FORM 
   f.sich.visible = 0
   f.abbruch.visible = 0
   f.loe.visible = - 1
   f.neu.visible = - 1
   f.bearb.visible = - 1
   f.zur.visible = - 1
   END IF 
   FILE "FOERKOND"
   IF BGEADRsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE BGEADRsub%
   CASE 1
       REM Agentur auswÑhlen
       codekey% = codekey.FOERKOND
       voncodema% = voncodema.foerkond
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       IF ma% > 0 THEN 
         IF ma% <> voncodema.FOERKOND THEN 
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY ma% FILE "maadr" INDEX codema.maadr
           SELECT KEY codekey% LOCK FILE "FOERKOND" INDEX codekey.FOERKOND
           codema.FOERKOND = ma%
           Agentur.FOERKOND = LEFT$ ( LTRIM$ (Nachname.maadr) + "," + LTRIM$ (Vorname.maadr),70)
           CALL QuickStore("FOERKOND")
           vagents$ = Agentur.FOERKOND
         ELSE 
           CALL Fehler ("Sie kînnen nicht die Fîrderprovision von dem Mitarbeiter abziehen,der die Fîrderprovision erhalten soll!","Bitte wÑhlen Sie einen anderen Mitarbeiter aus!")
         END IF 
       END IF 
       SELECT KEY voncodema% FILE "maadr" INDEX codema.maadr
       FORM 
   CASE 2
     CALL FOERKONDSich()
   CASE 3
     voncodema% = voncodema.FOERKOND
     IF NOT disabled%("FOERKONDLOE") THEN 
       REM CALL FOERKONDLoe()
       codekey% = codekey.FOERKOND
       REMOVE FROM FILE "FOERKOND" WHERE codekey.FOERKOND = codekey%
       IF NOT EXISTS (voncodema%,voncodema.FOERKOND) THEN END SUB 
     END IF 
   CASE 4
      codekey% = codekey.FOERKOND
      SELECT KEY codekey% LOCK FILE "FOERKOND" INDEX codekey.FOERKOND
      IF codema.FOERKOND > 0 THEN 
        vagents$ = Agentur.FOERKOND
      ELSE 
        vagents$ = "WÑhlen Sie hier eine Agentur aus!"
      END IF 
      IF Vvoncodema.FOERKOND > 0 THEN 
        pfuervv$ = VvonAgentur.FOERKOND
      ELSE 
        pfuervv$ = "<Fîrderprovision auf alle VertrÑge >"
      END IF 
      FORM 2
   CASE 5
     CALL FOERKONDNeu(codema%)
   CASE 6
     REM bestimmen, auf welche VertrÑge die Fîrderprovision gezahlt werden soll
       codekey% = codekey.FOERKOND
       voncodema% = voncodema.foerkond
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       IF ma% > 0 THEN 
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY ma% FILE "maadr" INDEX codema.maadr
         SELECT KEY codekey% LOCK FILE "FOERKOND" INDEX codekey.FOERKOND
         VvonCodema.FOERKOND = ma%
         VvonAgentur.FOERKOND = LEFT$ ( LTRIM$ (Nachname.maadr) + "," + LTRIM$ (Vorname.maadr),70)
         CALL QuickStore("FOERKOND")
         pfuervv$ = VvonAgentur.FOERKOND
       ELSE 
         SELECT KEY codekey% LOCK FILE "FOERKOND" INDEX codekey.FOERKOND
         VvonCodema.FOERKOND = 0
         VvonAgentur.FOERKOND = "auf alle VertrÑge"
         CALL QuickStore("FOERKOND")
       END IF 
       IF Vvoncodema.FOERKOND > 0 THEN 
         pfuervv$ = VvonAgentur.FOERKOND
       ELSE 
         pfuervv$ = "<Fîrderprovision auf alle VertrÑge >"
       END IF 
       SELECT KEY voncodema% FILE "maadr" INDEX codema.maadr
       FORM 
   CASE 99
     REM 110197
     IF NOT disabled%("FOERKONDBEARB") THEN 
       MOUSE ON 
       MENU OFF 
       REM IF RECCOUNT ("geadr") = 0 THEN CALL GEADRNeu()
         
         REM 101296
         REM _gesold$ = Gesellschaft.geadr
         REM CALL ButDesabled()
         REM f.notiz.enabled = 0
         REM f.vertragsuebersicht.enabled = 0
         f.sich.visible = - 1
         f.abbruch.visible = - 1
         f.loe.visible = 0
         f.bearb.visible = 0
         f.zur.visible = 0
         ENTER Prozente.FOERKOND,0
         f.sich.visible = 0
         f.abbruch.visible = 0
         f.loe.visible = - 1
         f.bearb.visible = - 1
         f.zur.visible = - 1
         REM CALL ButEnabled()
         REM f.notiz.enabled = - 1
         REM f.vertragsuebersicht.enabled = - 1
     
     END IF 
   END SELECT 
   IF abbruch% = - 1 THEN 
     FORM 
     abbruch% = 0
   END IF 
   MENU ON 
 WEND 
 _formend% = 0
 FILE "FOERKOND"
 REM CALL VERTRIntro(1)
 END SUB 
 
 
SUB FOERKONDNeu(codema%)

 IF disabled%("FOERKONDNEU") THEN END SUB 
 FILE "FOERKOND"
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 voncodema% = codema.maadr
 vonAgentur$ = Nachname.maadr + ", " + Vorname.maadr
 BLANK FILE "FOERKOND"
 SET STATUS "Datensatz neu angelegt..."
 CodeKey% = SER ("FOERKOND",1)
 CodeKey.FOERKOND = CodeKey%
 Agentur.FOERKOND = "<ohne Zuordnung>"
 codema.FOERKOND = 0
 voncodema.FOERKOND = voncodema%
 vonAgentur.FOERKOND = vonAgentur$
 CALL QuickStore("FOERKOND")
 FORM 2
 SELECT FORM KEY codeKey% FILE "FOERKOND" INDEX codeKey.FOERKOND
 vagents$ = "WÑhlen Sie hier eine Agentur aus!"
 FORM 
 BGEADRsub% = 99
 MOUSE ON 
 END SUB 
 
SUB FOERKONDSich()
   CALL QuickStore("FOERKOND")
 END SUB 
 
SUB FoerdKondIntro(codema%)
   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
   voncodema% = codema%
   FILE "FOERKOND"
   INDEX Agentur.FOERKOND
   
   SELECT FORM KEY voncodema% FILE "FOERKOND" INDEX voncodema.FOERKOND
   SELECT FORM KEY voncodema% FILE "MAADR" INDEX CodeMA.MAADR
   REM SELECT FIRST 
   FORM 
 REM INDEX gesellschaft.Kgeadr
 END SUB 
 
 
SUB MNFoerdKond()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
SUB FoerdKondLoe()
 voncodema% = voncodema.foerkond
 codekey% = codekey.FOERKOND
 REM IF disabled%("GEADRLOESCHEN") THEN END SUB 
 MOUSE OFF 
 REQUEST "Fîrderkondition wirklich lîschen?","",130,req%
 IF req% <> 1 THEN END SUB 
     SELECT KEY codekey% LOCK FILE "FOERKOND" INDEX Codekey.FOERKOND
     SELECT REMOVE FILE "FOERKOND"
 SELECT FORM KEY voncodema% FILE "FOERKOND" INDEX voncodema.FOERKOND
 FORM 1
 FORM 
 MOUSE ON 
 END SUB 
 
 
 REM **********************************************************************************************************
 REM               ENDE Fîrderkonditionen
 REM **********************************************************************************************************
 



SUB Faelvorsch()
 CALL DFile(3,"KVFAEL" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"Tarif" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(30,"KVERTRAG" + _fpw$)
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(30,"FONDS" + _fpw$)
 CALL DFile(3,"KGEADR" + _fpw$)
 CALL DFile(3,"WAEHRUNG" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 CALL DFile(20,"OFFICE\" + GADRDat$ + _fpw$)
 
   CREATE DIALOG "BUCHUNG1",0,0,289,158,"FÑlligkeitsvorschau","MS Sans Serif",8
   ADD DIALOG "BUCHUNG1",9,8,8,22,22,2
   ADD DIALOG "BUCHUNG1",5,35,9,124,10,0,"Bitte wÑhlen Sie die Funktion, die Sie"
   ADD DIALOG "BUCHUNG1",5,35,19,73,9,0,"durchfÅhren mîchten:"
   ADD DIALOG "BUCHUNG1",4,35,29,168,62,0,""
   ADD DIALOG "BUCHUNG1",5,39,39,70,9,0,"Buchungsfunktionen:"
   ADD DIALOG "BUCHUNG1",4,35,89,168,52,0,""
   ADD DIALOG "BUCHUNG1",5,39,99,67,10,0,"Listen/öbersichten:"
   ADD DIALOG "BUCHUNG1",3,39,49,153,10,0,"monatliche Berechnung",1,opt%
   ADD DIALOG "BUCHUNG1",3,39,59,153,10,0,"Abgleich der Liste",2,opt%
   ADD DIALOG "BUCHUNG1",3,39,99,153,10,0,"Export der Liste nach MS EXCEL",3,opt%
   ADD DIALOG "BUCHUNG1",3,39,109,153,10,0,"Ausgabe der Liste",4,opt%
   ADD DIALOG "BUCHUNG1",1,208,105,75,16,1,"&OK",1,1
   ADD DIALOG "BUCHUNG1",1,208,125,74,15,0,"&Abbrechen",0,0
   DIALOG "BUCHUNG1",req%
   REMOVE DIALOG ALL 
   IF opt% = 1 THEN 
     REM FÑlligkeitsvorausschau produzieren
     FILE "KVFAEL"
     INDEX codevt.KVFAEL
     IF RECCOUNT ("KVFAEL") > 0 THEN 
       SELECT FIRST LOCK 
     ELSE 
       SELECT LAST 
     END IF 
     WHILE NOT EOF ("KVFAEL")
       IF EXISTS (codevt.kvfael,lfdnr.kvertrag) AND erledigt.kvfael <> "j" THEN 
         SELECT KEY codevt.kvfael FILE "KVERTRAG" INDEX lfdnr.kvertrag
 
         IF CodeVStatus.kvertrag = 4 THEN 
           REM storniert
           erledigt.kvfael = "j"
         ELSE 
           IF provisionsart.kvfael = 1 THEN 
             REM Abschlu·provision
             IF gezahltam.kvfael > 0 THEN erledigt.kvfael = "j"
             IF fÑlligam.kvfael < 1 THEN fÑlligam.kvfael = VS_Beginn.kvertrag
              
           ELSE 
             REM Folgeprovision
             IF fÑlligam.kvfael < 1 THEN 
               fÑlligam.kvfael = VS_Beginn.kvertrag
             END IF 
             IF gezahltam.kvfael >= fÑlligam.kvfael AND fÑlligam.kvfael > 0 THEN 
               tag% = DAY (fÑlligam.kvfael)
               monat% = MONTH (fÑlligam.kvfael)
               jahr% = YEAR (fÑlligam.kvfael)
               monat% = monat% + ProvAlleMon.kvfael
               IF monat% > 12 THEN 
                 monat% = monat% - 12
                 jahr% = jahr% + 1
                 IF tag% > 27 THEN tag% = 27
               END IF 
               dd$ = STR$ (tag%,"00") + "." + STR$ (monat%,"00") + "." + STR$ (jahr%,"0000")
               fÑlligam.kvfael = DAYS (dd$)
             END IF 
           END IF 
         END IF 
         IF MOD ("KVFAEL") THEN STORE FILE "kvfael"
         UNLOCK CURRENT FILE "kvfael"
         REM fÑlligam.kvertrag = fÑlligam.kvfael
         REM STORE FILE "kvertrag"
         REM UNLOCK CURRENT FILE "KVERTRAG"
       END IF 
       SELECT NEXT LOCK FILE "kvfael"
     WEND 
     opt% = 2
   END IF 
   IF opt% = 2 THEN 
     REM Abgleich der Liste
dstart1308200103: 
     CREATE DIALOG "Konto1",0,0,221,165,"FÑlligkeitsliste","MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"FÑlligkeitsliste:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
     ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Zeitraum eintragen, werden alle FÑlligkeiten  aufgelistet."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     REM ADD DIALOG "Konto1",2,34,97,148,11,0,"Liste mit Volumen ausgeben","j","n",volumen$
     REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
     ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     MOUSE ON 
     IF req% <> 1 THEN END SUB 
     IF von$ = "" THEN von$ = "01.01.1960"
     IF bis$ = "" THEN bis$ = "31.12.2199"
     IF DateOK%(von$) THEN 
       IF DateOK%(bis$) THEN 
       ELSE 
         CALL Fehler ("Das Datum, das Sie unter BIS eingegeben haben ist ungÅltig (dd.mm.yyyy)!","")
         GOTO dstart1308200103
       END IF 
     ELSE 
       CALL Fehler ("Das Datum, das Sie unter VON eingegeben haben ist ungÅltig (dd.mm.yyyy)!","")
       GOTO dstart1308200103
     END IF 
     von% = DAYS (von$)
     bis% = DAYS (bis$)
     FILE "KVFAEL"
     INDEX codevt.kvfael
     SELECT FIRST 
     DIM Vertraege$( RECCOUNT ("kvfael"))
     WHILE NOT EOF ("kvfael")
       IF erledigt.kvfael <> "j" AND gezahltam.kvfael < fÑlligam.kvfael AND fÑlligam.kvfael >= von% AND fÑlligam.kvfael <= bis% THEN 
         SELECT KEY codevt.kvfael FILE "KVERTRAG" INDEX lfdnr.kvertrag
         SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
         nachn$ = nachname.adressen
         vs$ = TRIM$ ( PAD$ (VS_Nr.KVERTRAG,38))
         IF LEN (vs$) > 7 AND LEN (vs$) < 16 THEN vs$ = vs$ + CHR$ (9)
         IF LEN (vs$) < 7 THEN vs$ = vs$ + CHR$ (9) + CHR$ (9)
         zw$ = CHR$ (9) + CHR$ (9) + CHR$ (9) + CHR$ (9) + SPACE$ (30)
         x% = 1
         IF x% = 1 THEN 
           daten1$ = vs$ + CHR$ (9) + LEFT$ (nachn$,20) + CHR$ (9) + "/" + LEFT$ (Gesellschaft.kvertrag) + "/" + LEFT$ (Sparte.kvertrag) + "/" + LEFT$ (Agentur.kvertrag)
         END IF 
         IF LEN (daten1$) < 58 THEN daten1$ = daten1$ + CHR$ (9)
         IF LEN (daten1$) < 47 THEN daten1$ = daten1$ + CHR$ (9)
         IF LEN (daten1$) < 44 THEN daten1$ = daten1$ + CHR$ (9)
         IF LEN (daten1$) < 38 THEN daten1$ = daten1$ + CHR$ (9)
         IF LEN (daten1$) < 30 THEN daten1$ = daten1$ + CHR$ (9)
         IF LEN (daten1$) < 20 THEN daten1$ = daten1$ + CHR$ (9)
         Laenge% = LEN (daten1$)
         REM daten1$ = daten1$ + 
         Vertraege$(a%) = "fÑllig: " + DATE$ (fÑlligam.kvfael,"0d.mm.yyyy") + " Provision: " + STR$ (Provbetrag.kvfael,",999999.00") + "  " + daten1$ + zw$ + STR$ (lfdnr.KVERTRAG,"00000000")
         IF a% = 0 THEN prompt$ = Vertraege$(0)
         a% = a% + 1
       END IF 
       SELECT NEXT FILE "KVFAEL"
     WEND 
     lok% = - 1
     WHILE lok%
       CREATE DIALOG "ZEINLIST",0,0,440,330,"Vertrag suchen...","MS Sans Serif",8
       ADD DIALOG "ZEINLIST",4,0,0,438,300,0,""
       ADD DIALOG "ZEINLIST",9,8,11,25,24,2
       ADD DIALOG "ZEINLIST",5,35,15,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus."
       REM ADD DIALOG "ZEINLIST",5,6,28,398,10,0,"Vertrags-/Policennummer                         Kunde/Gesellschaft/Sparte/Agentur            von      bis"
       ADD DIALOG "ZEINLIST",7,6,38,425,255,2 + 128,2,Vertraege$,Auswahl$,prompt$
       ADD DIALOG "ZEINLIST",1,126,310,55,15,1,"&OK",1,1
       ADD DIALOG "ZEINLIST",1,186,310,55,15,0,"&Abbrechen",0,0
       IF MNdisabled%("VERTRDRUCK") THEN 
       ELSE 
         REM ADD DIALOG "ZEINLIST",1,246,310,55,15,0,"&Drucken",2,0
         REM ADD DIALOG "ZEINLIST",1,306,310,55,15,0,"&Summenliste",3,0
       END IF 
       DIALOG "ZEINLIST",req%
       REMOVE DIALOG "ZEINLIST"
       SELECT CASE req%
       CASE 1
         GetVertrag% = VAL ( RIGHT$ (Auswahl$(0),8))
         prompt$ = Auswahl$(0)
         SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
         cuvt% = GetVertrag%
         knr% = Codeku.kvertrag
         SELECT KEY knr% FILE GADRDat$ INDEX codeku.GADRDat$
         REM CALL KVERTRAG()
         lfdnr% = lfdnr.kvertrag
         REM SELECT WHERE FILE "kvertrag"
         CALL KVERTRAGneu(lfdnr%)
         REM mit Abfrage gestalten CALL VertrKond()
       CASE 0
         lok% = 0
       END SELECT 
     WEND 
 
   END IF 
   IF opt% = 3 THEN 
     IF EXISTS (GMACodeDir$ + "ff.sbf") THEN 
       IF OPEN ("FF") THEN CLOSE FILE "FF"
       DELETE GMACodeDir$ + "ff.*"
     END IF 
     IF EXISTS (GMACodeDir$ + "faelig.XLS") THEN DELETE GMACodeDir$ + "faelig.XLS"
     REM export zu excel
 
dstart1308200102: 
     CREATE DIALOG "Konto1",0,0,221,165,"FÑlligkeitsliste","MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"FÑlligkeitsliste:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
     ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Zeitraum eintragen, werden alle FÑlligkeiten  aufgelistet."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     REM ADD DIALOG "Konto1",2,34,97,148,11,0,"Liste mit Volumen ausgeben","j","n",volumen$
     REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
     ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     MOUSE ON 
     IF req% <> 1 THEN END SUB 
     IF von$ = "" THEN von$ = "01.01.1960"
     IF bis$ = "" THEN bis$ = "31.12.2199"
     IF DateOK%(von$) THEN 
       IF DateOK%(bis$) THEN 
       ELSE 
         CALL Fehler ("Das Datum, das Sie unter BIS eingegeben haben ist ungÅltig (dd.mm.yyyy)!","")
         GOTO dstart1308200102
       END IF 
     ELSE 
       CALL Fehler ("Das Datum, das Sie unter VON eingegeben haben ist ungÅltig (dd.mm.yyyy)!","")
       GOTO dstart1308200102
     END IF 
     von% = DAYS (von$)
     bis% = DAYS (bis$)
 
 
     SET QUERY HEADING "",0,0
     SELECT &10Kundennummer.ADRESSEN WRAP ;&20Nachname.ADRESSEN WRAP ;&10Vorname.ADRESSEN WRAP ;&20VS_Nr.KVERTRAG
     WRAP ;VS_Beginn.KVERTRAG;KÅndigung.KVERTRAG;Beitrag.KVERTRAG;ZW.KVERTRAG,&20Gesellschaft.KVERTRAG WRAP ;&15Sparte.KVERTRAG
     WRAP ;fÑlligam.KVFAEL;ProvBetrag.KVFAEL;UE.KVFAEL
     REPORT 
     WHERE CodeKU.KVERTRAG = codeku.ADRESSEN AND lfdnr.kvertrag = codevt.kvfael AND gezahltam.KVFAEL < fÑlligam.KVFAEL AND fÑlligam.KVFAEL >= von% AND fÑlligam.KVFAEL <= bis%
     ORDER REPORT Nachname.ADRESSEN
     TO FILE GMACodeDir$ + "FF"
     END SELECT 
     FILE "FF":REM                                          Combo: Current File
     Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
     Superbase.Converters.SBF.SourceFile = "FF"
     Superbase.Converters.SBF.Descending = 0
     Superbase.Converters.SBF.Merge = 0
     Superbase.Converters.SBF.LogErrors = 0
     Superbase.Converters.SBF.MultiResponse = 0
     Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
     Superbase.Converters.XLS.DestFile = GMACodeDir$ + "faelig.XLS"
     Superbase.Converters.XLS.StartRow = 2
     Superbase.Converters.XLS.StartCol = 1
     Superbase.Converters.XLS.EndRow = - 1
     Superbase.Converters.XLS.EndCol = - 1
     Superbase.Converters.XLS.UseLabels = - 1
     Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
     CALL Fehler("FÑlligkeitsdatei  " + GMACodeDir$ + "faelig.XLS wurde erstellt","")
     a% = CALL ("ShellExecute",0,"open",GMACodeDir$ + "faelig.XLS","","",1)
   END IF 
 
   IF opt% = 4 THEN 
     REM Ausgabe der Liste
dstart1308200101: 
     CREATE DIALOG "Konto1",0,0,221,165,"FÑlligkeitsliste","MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"FÑlligkeitsliste:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
     ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Zeitraum eintragen, werden alle FÑlligkeiten  aufgelistet."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     opt% = 1
     ADD DIALOG "Konto1",3,34,100,100,10,0,"Bildschirmausgabe",1,opt%
     ADD DIALOG "Konto1",3,34,110,100,10,0,"Druckerausgabe",2,opt%
     ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     MOUSE ON 
     IF req% <> 1 THEN END SUB 
     IF von$ = "" THEN von$ = "01.01.1960"
     IF bis$ = "" THEN bis$ = "31.12.2199"
     IF DateOK%(von$) THEN 
       IF DateOK%(bis$) THEN 
       ELSE 
         CALL Fehler ("Das Datum, das Sie unter BIS eingegeben haben ist ungÅltig (dd.mm.yyyy)!","")
         GOTO dstart1308200101
       END IF 
     ELSE 
       CALL Fehler ("Das Datum, das Sie unter VON eingegeben haben ist ungÅltig (dd.mm.yyyy)!","")
       GOTO dstart1308200101
     END IF 
     von% = DAYS (von$)
     bis% = DAYS (bis$)
     IF opt% = 1 THEN 
       SET QUERY HEADING "",0,0
       SELECT &10Kundennummer.ADRESSEN WRAP ;&20Nachname.ADRESSEN WRAP ;&10Vorname.ADRESSEN WRAP ;&20VS_Nr.KVERTRAG
       WRAP ;VS_Beginn.KVERTRAG;KÅndigung.KVERTRAG;Beitrag.KVERTRAG;ZW.KVERTRAG,&20Gesellschaft.KVERTRAG WRAP ;&15Sparte.KVERTRAG
       WRAP ;fÑlligam.KVFAEL;ProvBetrag.KVFAEL;UE.KVFAEL
       REPORT 
       WHERE CodeKU.KVERTRAG = codeku.ADRESSEN AND lfdnr.kvertrag = codevt.kvfael AND gezahltam.KVFAEL < fÑlligam.KVFAEL AND fÑlligam.KVFAEL >= von% AND fÑlligam.KVFAEL <= bis%
       ORDER REPORT Nachname.ADRESSEN
       TO WINDOW 
     ELSE 
       SET PRINTER REQUEST 
       SET QUERY HEADING "",0,0
       SELECT &10Kundennummer.ADRESSEN WRAP ;&20Nachname.ADRESSEN WRAP ;&10Vorname.ADRESSEN WRAP ;&20VS_Nr.KVERTRAG
       WRAP ;VS_Beginn.KVERTRAG;KÅndigung.KVERTRAG;Beitrag.KVERTRAG;ZW.KVERTRAG,&20Gesellschaft.KVERTRAG WRAP ;&15Sparte.KVERTRAG
       WRAP ;fÑlligam.KVFAEL;ProvBetrag.KVFAEL;UE.KVFAEL
       REPORT 
       WHERE CodeKU.KVERTRAG = codeku.ADRESSEN AND lfdnr.kvertrag = codevt.kvfael AND gezahltam.KVFAEL < fÑlligam.KVFAEL AND fÑlligam.KVFAEL >= von% AND fÑlligam.KVFAEL <= bis%
       ORDER REPORT Nachname.ADRESSEN
       TO PRINTER 
     END IF 
     END SELECT 
   END IF 
 END SUB 
 
SUB NotizOpenKv()
   REQUEST "RightClick"
 END SUB 





 '****************************************************************************************************
 '*                   Kundeninkasso fÅr Lund & Wriggers an Hand der Courtagedaten, die in KVFAEL     *
 '*                   Vertrag eingegeben wurden                                                      *
 '****************************************************************************************************
SUB LundInkasso(codege%)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"KGEADR" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"DTAUS" + _fpw$)
 CALL DFile(3,"BUCHGES" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"INKSTAMM" + _fpw$)
 CALL DFile(3,"KVFAEL" + _fpw$)
 IF codege% > 0 THEN 
   SELECT KEY codege% FILE "geadr" INDEX codege.geadr
 ELSE 
   
 END IF 
 REM FÑlligkeitsliste
 REM alle mit Inkart=1 und Abruf "egal" und HauptfÑlligkeit akt.Monat
LInk1Dia311001: 
   CREATE DIALOG "INK1",0,0,191,122,"FÑlligkeitsliste","MS Sans Serif",8
   ADD DIALOG "INK1",4,0,0,191,98,0,""
   ADD DIALOG "INK1",9,9,12,21,23,2
   ADD DIALOG "INK1",5,38,12,144,30,0,"FÑlligkeitsliste fÅr:"
   ADD DIALOG "INK1",5,38,45,80,10,0,"HauptfÑlligkeit:"
   ADD DIALOG "INK1",6,93,44,20,11,0,0,m%,2
   REM ADD DIALOG "INK1",5,38,63,35,10,0,"Inkassotag:"
   REM ADD DIALOG "INK1",6,93,63,51,11,0,0,CalcDate$,10
   ADD DIALOG "INK1",1,34,99,55,14,1,"&OK",1,1
   ADD DIALOG "INK1",1,92,99,75,14,0,"&Liste Abbrechen",0,0
   DIALOG "INK1",req1%
   REMOVE DIALOG "INK1"
   IF req1% > 0 THEN 
     IF m% < 0 OR m% > 12 THEN 
       CALL Fehler("Der Wertebereich fÅr die HauptfÑlligkeit mu· grî·er 01 und kleiner 13 sein!","Bitte Eingabe wiederholen!")
       GOTO LInk1Dia311001
     END IF 
     m$ = STR$ (m%,"00")
     lok% = - 1
     opt% = 1
     REDIM AuswahlG$( RECCOUNT ("GEADR"),1)
     REDIM AuswahlG$( RECCOUNT ("GEADR"))
    WHILE lok% = - 1
     CREATE DIALOG "ADRLIST",0,0,292,98,"Optionen zur FÑlligkeitsliste?","MS Sans Serif",8
     ADD DIALOG "ADRLIST",4,0,0,290,78,0,""
     ADD DIALOG "ADRLIST",9,4,5,15,21,2
     ADD DIALOG "ADRLIST",5,10,25,238,14,0,"WÑhlen Sie eine Option aus!"
     ADD DIALOG "ADRLIST",3,10,38,236,10,0,"FÑlligkeitsliste erstellen und drucken",1,opt%
     REM ADD DIALOG "ADRLIST",3,10,49,234,10,0,"Fehler der FÑlligkeitsliste drucken",2,opt%
     ADD DIALOG "ADRLIST",1,79,80,51,14,1,"&Weiter",1,1
     ADD DIALOG "ADRLIST",1,131,80,51,14,0,"&Abbruch",0,0
     DIALOG "ADRLIST",req%
     REMOVE DIALOG "ADRLIST"
     IF req% <> 1 THEN 
       lok% = 0
       END SUB 
     END IF 
     REQUEST "Nur die Liste fÅr einige auszuwÑhlende Gesellschaften drucken?","",130,req1%
     IF req1% = 1 THEN 
       codege% = GetCodeGEM%(0)
       IF codege% > 0 THEN 
         FOR i% = 0 TO RECCOUNT ("GEADR")
           GetCodeGE% = VAL ( RIGHT$ (AuswahlG$(i%),6))
           IF GetCodeGE% > 0 THEN 
             CALL DruFael(m%,GetCodeGE%,opt%)
           ELSE 
             i% = RECCOUNT ("GEADR") + 1
           END IF 
         NEXT i%
       END IF 
     ELSE 
       codege% = 0
       CALL DruFael(m%,0,opt%)
     END IF 
 END SUB 

SUB DruFael(m%,codege%,opt%)
     ON ERROR GOTO LInk1Dia311001e
     CALL PRep("RFAELIG1")
     IF codege% <> 0 THEN 
       drutitel$ = gesell$
     END IF 
     drutitel$ = " HauptfÑlligkeit " + m$
     REPORT ON Beitrag.KVFAEL AS "sumbeitr%",Courtage.KVFAEL AS "sumcourt%",VS_NR.KVFAEL AS "anzges%",sumabrbe% AS "sumabrbes%",sumabrcu% AS "sumabrcus%"
     BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
 
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP Gesellschaft.KVFAEL,Beitrag.KVFAEL AS "sumbeitrg%",Courtage.KVFAEL AS "sumcourtg%",VS_NR.KVFAEL AS "anzgesg%",sumabrbe% AS "sumabrbesg%",sumabrcu% AS "sumabrcusg%"
     BEFORE GROUP Gesellschaft.KVFAEL
     SET REPORT PAGE "H_Gesellscha002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP Gesellschaft.KVFAEL
     SET REPORT PAGE "F_Gesellscha002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
 
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     SET FIRST PAGE HEADING OFF 
     IF opt% = 1 THEN 
       IF codege% < 1 THEN 
         SELECT ;
         WHERE INKART.KVFAEL = 1 AND nexthauptf.kvfael = m%
         ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
         TO ASK 

         REM SELECT ;
         REM WHERE INKART.KVFAEL = 1 AND Abruf.KVFAEL = "j" AND nexthauptf.kvfael = m%
         REM ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
         REM TO ASK 
       ELSE 
         SELECT ;
         WHERE INKART.KVFAEL = 1 AND nexthauptf.kvfael = m% AND codege.kvfael = codege%
         ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
         TO ASK 

         REM SELECT ;
         REM WHERE INKART.KVFAEL = 1 AND Abruf.KVFAEL = "j" AND nexthauptf.kvfael = m% AND codege.kvfael = codege%
         REM ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
         REM TO ASK 
       END IF 
     ELSE 
       IF codege% < 1 THEN 
         SELECT ;
         WHERE INKART.KVFAEL <> 1 AND nexthauptf.kvfael = m%
         ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
         TO ASK 

       ELSE 
         SELECT ;
         WHERE INKART.KVFAEL <> 1 AND nexthauptf.kvfael = m% AND codege.kvfael = codege%
         ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
         TO ASK 

       END IF 
     END IF 
     END SELECT 
    WEND 
   END IF 
LInk1Dia311001e: 
 ON ERROR GOTO ErrorHandler
 END SUB 




 REM Maklerbuchungen, d.h. Abrechnungsliste alle mit Einzelabruf="j" unter BerÅcksichtigung des Einzelabrufdatums
 REM und alle mit Abruf="j" (die mit Abruf="j" fÅr DTAUS verwenden, wenn Bankeinzug und Kontodaten komplett)
 REM DTAUS - Summenliste fÅr Gesellschaften, und Einzelpositionsliste pro Gesellschaft
 REM auf Grund des Kundeninkasso abgefÅhrt werden mÅssen
 
SUB LundMaklerInk(codege%)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"KGEADR" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"DTAUS" + _fpw$)
 CALL DFile(3,"BUCHGES" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"INKSTAMM" + _fpw$)
 CALL DFile(3,"KVFAEL" + _fpw$)
 IF codege% > 0 THEN 
   SELECT KEY codege% FILE "geadr" INDEX codege.geadr
 END IF 
LAbr1Dia311001: 
   CREATE DIALOG "INK1",0,0,191,122,"Abrechnungsliste","MS Sans Serif",8
   ADD DIALOG "INK1",4,0,0,191,98,0,""
   ADD DIALOG "INK1",9,9,12,21,23,2
   ADD DIALOG "INK1",5,38,12,144,30,0,"Abrechnungsliste fÅr:"
   ADD DIALOG "INK1",5,38,45,80,10,0,"HauptfÑlligkeit:"
   ADD DIALOG "INK1",6,93,44,20,11,0,0,m%,2
   REM ADD DIALOG "INK1",5,38,63,35,10,0,"Inkassotag:"
   REM ADD DIALOG "INK1",6,93,63,51,11,0,0,CalcDate$,10
   ADD DIALOG "INK1",1,34,99,55,14,1,"&OK",1,1
   ADD DIALOG "INK1",1,92,99,75,14,0,"&Liste Abbrechen",0,0
   DIALOG "INK1",req1%
   REMOVE DIALOG "INK1"
   IF req1% > 0 THEN 
     IF m% < 1 OR m% > 12 THEN 
       CALL Fehler("Der Wertebereich fÅr die HauptfÑlligkeit mu· im Bereich 01 bis 12 liegen!","Bitte Eingabe wiederholen!")
       GOTO LAbr1Dia311001
     END IF 
     m$ = STR$ (m%,"00")
     ON ERROR GOTO ErrorHandler 
     opt% = 2
abr041101001: 
     abrok% = - 1
      REDIM AuswahlG$( RECCOUNT ("GEADR"),1)
      REDIM AuswahlG$( RECCOUNT ("GEADR"))
    WHILE abrok% = - 1
     CREATE DIALOG "ADRLIST",0,0,292,110,"Was soll in der Abrechnung gemacht werden?","MS Sans Serif",8
     ADD DIALOG "ADRLIST",4,0,0,290,90,0,""
     ADD DIALOG "ADRLIST",9,4,5,15,21,2
     ADD DIALOG "ADRLIST",5,10,25,238,14,0,"WÑhlen Sie eine Option aus!"
     ADD DIALOG "ADRLIST",3,10,38,234,10,0,"Abruf-Listen drucken und DTAUS-DatentrÑger erstellen",2,opt%
     ADD DIALOG "ADRLIST",3,10,49,234,10,0,"Abruf-Listen drucken (geht nur wenn sie schon erzeugt wurde)",4,opt%
     ADD DIALOG "ADRLIST",3,10,60,276,10,0,"Abrufliste verrechnen lassen (kann nicht rÅckgÑngig gemacht werden)",3,opt%
     ADD DIALOG "ADRLIST",3,10,71,236,10,0,"Abrechnungsliste erstellen und drucken",1,opt%
     ADD DIALOG "ADRLIST",1,79,91,51,14,1,"&Weiter",1,1
     ADD DIALOG "ADRLIST",1,131,91,51,14,0,"&Abbruch",0,0
     DIALOG "ADRLIST",req%
     REMOVE DIALOG "ADRLIST"
     IF req% = 1 THEN 
       IF opt% = 1 THEN 
         REM Abrechnungsliste erstellen
         REQUEST "Wollen Sie wirklich die Abrechnngsliste erstellen lassen?","",130,req%
         IF req% = 1 THEN 
           REQUEST "Nur die Liste fÅr einige auszuwÑhlende Gesellschaft drucken?","",130,req1%
           IF req1% = 1 THEN 
             codege% = GetCodeGEM%(0,)
             FOR i% = 0 TO RECCOUNT ("GEADR")
               GetCodeGE% = VAL ( RIGHT$ (AuswahlG$(i%),6))
               IF GetCodeGE% > 0 THEN 
                 CALL LundAbrList(m%,GetCodeGE%)
                 REM i% = i% + 1
               ELSE 
                 i% = RECCOUNT ("GEADR") + 1
               END IF 
             NEXT i%
           ELSE 
             codege% = 0
             CALL LundAbrList(m%,codege%)
           END IF 
           
         END IF 
       END IF 
       IF opt% = 2 THEN 
         REM DTAUS-DatentrÑger und Listen erstellen
         REQUEST "Wollen Sie wirklich die DTAUS erstellen lassen?","",130,req%
         IF req% = 1 THEN 
           CALL DFile(3,"KVFTMP" + _fpw$)
           CALL LundDTAUS(m%,codege%)
         END IF 
       END IF 
       IF opt% = 3 THEN 
         codege% = 0
         REM Abrechnungsliste verrechnen
         a% = VAL (ReadConfig$("PROVIS","LUNDWRIGGERSABRMONAT"))
         IF a% = m% + 1 THEN 
           CALL Fehler("Sie haben schon verrechnen lassen, der nÑchste Abrechnungsmonat " + STR$ (a%,"00"),"aktueller Verrechnungsmonat " + STR$ (m%,"00"))
         ELSE 
           REQUEST "Wollen Sie wirklich die Abrechnngsliste verrechnen lassen?","",130,req%
           IF req% = 1 THEN 
             CALL LundAbrVerr(m%,codege%)
           END IF 
         END IF 
       END IF 
       IF opt% = 4 THEN 
         CALL GesAbrufLi(m%)
       END IF 
     ELSE 
       abrok% = 0
     END IF 
    WEND 
   END IF 
LAbr1Dia311001e: 
 ON ERROR GOTO ErrorHandler
 MOUSE ON 
 END SUB 



 REM Lund Wriggers Verrechnung

SUB LundAbrVerr(m%,codege%)
 FILE "KVFAEL"
 INDEX codevt.kvfael
 SELECT FIRST LOCK 
 CALL Fehler ("Die Abrechnung darf nur gefahren werden, wenn Sie die gesamte Abrechnung fÅr alle Gesellschaften erstellt haben und fÅr alle die DTAUS erstellt haben!!!!","")
 REQUEST "Wollen Sie wirklich die Abrechnung verrechnen lassen?","Achtung dies kann nicht rÅckgÑngig gemacht werden!",135,req%
 IF req% = 1 THEN 
   i% = 0
   j% = RECCOUNT ("KVFAEL")
   k% = 0
   WHILE NOT EOF ("KVFAEL")
       
        i% = i% + 1
        tt$ = "27"
        mm$ = STR$ (m%,"00")
        yy$ = LEFT$ ( DATE$ ( TODAY ,"yyyymm0d"),4)
        lz% = DAYS (tt$ + mm$ + yy$)
        b% = VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"mmyyyy0d"),2))
        IF EinzAbruf.kvfael = "j" AND b% = m% THEN 
          EinzAbruf.kvfael = "n"
          letzteZahlung.kvfael = lz%
          Abgerufenam.kvfael = lz%
        END IF 
        IF nextHauptf.kvfael = m% THEN 
          letzteZahlung.kvfael = lz%
        END IF 
        IF nextHauptf.kvfael = m% THEN 
          k% = K% + 1
          IF zw.kvertrag = 1 THEN 
            REM jÑhrlich, bleibt die Hauptf
            REM nextHauptf.kvfael = HauptfÑlligkeit.kvertrag
          END IF 
          IF zw.kvertrag = 2 THEN 
            nextHauptf.kvfael = nextHauptf.kvfael + 6
          END IF 
          IF zw.kvertrag = 4 THEN 
            nextHauptf.kvfael = nextHauptf.kvfael + 3
          END IF 
          IF zw.kvertrag = 6 THEN 
            nextHauptf.kvfael = nextHauptf.kvfael + 2
          END IF 
          IF zw.kvertrag = 12 THEN 
            nextHauptf.kvfael = nextHauptf.kvfael + 1
          END IF 
        END IF 
     STORE FILE "KVFAEL"
     SET STATUS LTRIM$ ( STR$ (i%,"999999")) + " von " + LTRIM$ ( STR$ (j%,"999999")) + " verarbeitet!, davon geÑndert " + LTRIM$ ( STR$ (k%,"999999"))
     SELECT NEXT LOCK FILE "KVFAEL"
     WEND 
     CALL Fehler( LTRIM$ ( STR$ (i%,"999999")) + " von " + LTRIM$ ( STR$ (j%,"999999")) + " verarbeitet!, davon geÑndert " + LTRIM$ ( STR$ (k%,"999999")),"")
     CALL WriteConfig("PROVIS","LUNDWRIGGERSABRMONAT", STR$ (m% + 1,"000000"))
  END IF 
 END SUB 


 REM Lund Wriggers DTAUS Erstellung fÅr alle mit Abruf="j" Inkart=1 Zahlart=1, d.h.
 REM QIAZAAbr.kvFAEL = STR$ (Inkart.kvfael,"0") + STR$ (Zahlart.kvfael,"0") + Abruf.kvfael
 REM = "11j" und dann nur die, wo Kontoverbindung in Ordnung

SUB LundDTAUS(m%,codege%)
   opt% = 1
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   CALL DFile(3,"Buchung1" + _fpw$)
   SELECT WHERE FILE "Buchung1"
 ELSE 
   CALL DFile(3,"Buchung" + _fpw$)
   SELECT WHERE FILE "Buchung"
 END IF 
 CALL DFile(3,"Kgeadr" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 SELECT WHERE FILE "Sparten"
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 SELECT WHERE FILE "geadr"
 CALL DFile(3,"tarif" + _fpw$)
 SELECT WHERE FILE "tarif"
 CALL DFile(3,"maadr" + _fpw$)
 SELECT WHERE FILE "maadr"
 CALL DFile(3,"maadrgru" + _fpw$)
 SELECT WHERE FILE "maadrgru"
 CALL DFile(3,"kvertrag" + _fpw$)
 SELECT WHERE FILE "kvertrag"
 CALL DFile(3,"vprodukt" + _fpw$)
 SELECT WHERE FILE "vprodukt"
 CALL DFile(3,"tarif" + _fpw$)
 SELECT WHERE FILE "tarif"
 CALL DFile(3,"vorgang" + _fpw$)
 SELECT WHERE FILE "vorgang"
 CALL DFile(3,"vkond" + _fpw$)
 SELECT WHERE FILE "vkond"
 CALL DFile(3,"formular" + _fpw$)
 SELECT WHERE FILE "formular"
 CALL DFile(3,"spgruppe" + _fpw$)
 SELECT WHERE FILE "spgruppe"
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SELECT WHERE FILE GAdrDat$
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 SELECT WHERE FILE GAkquiDat$
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 SELECT WHERE FILE "aktionen"
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 SELECT WHERE FILE GTelDat$
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 i% = 0
 j% = 0
 k% = 0
 f% = 0
 g% = RECCOUNT ("KVFAEL")
 DIM Fehler1$(g%)
 zok% = - 1
 WHILE zok% = - 1
   CREATE DIALOG "ADRLIST",0,0,292,110,"Was soll fÅr die DTAUS gemacht werden?","MS Sans Serif",8
   ADD DIALOG "ADRLIST",4,0,0,290,90,0,""
   ADD DIALOG "ADRLIST",9,4,5,15,21,2
   ADD DIALOG "ADRLIST",5,10,25,238,14,0,"WÑhlen Sie eine Option aus!"
   ADD DIALOG "ADRLIST",3,10,38,276,10,0,"Die DatensÑtze die in die DTAUS eingehen auf Fehler prÅfen und drucken",1,opt%
   ADD DIALOG "ADRLIST",3,10,49,274,10,0,"Abruf-Liste und DTAUS-DatentrÑger erstellen",2,opt%
   ADD DIALOG "ADRLIST",3,10,60,274,10,0,"Abruf-Liste drucken",4,opt%
   ADD DIALOG "ADRLIST",3,10,71,276,10,0,"DTAUS-Listen drucken",3,opt%
   ADD DIALOG "ADRLIST",1,79,92,51,14,1,"&Weiter",1,1
   ADD DIALOG "ADRLIST",1,131,92,51,14,0,"&Abbruch",0,0
   DIALOG "ADRLIST",req%
   REMOVE DIALOG "ADRLIST"
   IF req% = 1 THEN 
     IF opt% = 1 THEN 
      IF i% < 1 THEN 
       FILE "KVFAEL"
       INDEX QIAZAAbr.kvFAEL
       SELECT FIRST 
       test$ = "11j"
       SELECT KEY test$ FILE "KVFAEL" INDEX QIAZAAbr.kvFAEL
       WHILE NOT EOF ("KVFAEL") AND QIAZAAbr.kvFAEL = test$
         i% = i% + 1
         vd% = 0
         IF Abgerufenam.kvfael > 0 THEN 
           vd% = VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"mmyyyy0d"),2))
           aaaaabg$ = DATE$ (Abgerufenam.kvfael,"mmyyyy0d")
         END IF 
         IF QIAZAAbr.kvFAEL = test$ AND (nexthauptf.kvfael = m% OR (Einzabruf.kvfael = "j" AND vd% = m%)) THEN 
         REM IF QIAZAAbr.kvFAEL = test$ AND nexthauptf.kvfael = m% AND Einzabruf.kvfael <> "j" THEN 
           j% = j% + 1
           IF LTRIM$ (K1Konto.kvfael) <> "" AND LTRIM$ (K1Bank.kvfael) <> "" AND K1BLZ.kvfael <> "" AND (Beitrag.kvfael > 0 OR EinzBeitrag.kvfael > 0) THEN 
             k% = k% + 1
             BLANK FILE "KVFTMP"
             a% = CopyRecord%("KVFAEL","KVFTMP")
             STORE FILE "KVFTMP"
           ELSE 
             BLANK FILE "KVFTMP"
             a% = CopyRecord%("KVFAEL","KVFTMP")
             dtausfehl.KVFTMP = 1
             IF Beitrag.kvfael <= 0 THEN 
               Fehlertext.kvftmp = "Beitrag<=0"
             ELSE 
               IF EinzBeitrag.kvfael <= 0 AND Einzabruf.kvfael = "j" THEN 
                 Fehlertext.kvftmp = "Einz.Betrag<=0"
               ELSE 
                 Fehlertext.kvftmp = "Kontoinformation unvollstÑndig"
               END IF 
             END IF 
             STORE FILE "KVFTMP"
             IF Beitrag.kvfael <= 0 THEN 
               Fehler1$(f%) = PAD$ (VS_NR.kvfael,30) + " Beitrag<=0 -> " + Kunde.kvfael + SPACE$ (150) + STR$ (codevt.kvfael,"000000")
             ELSE 
               IF EinzBeitrag.kvfael <= 0 AND Einzabruf.kvfael = "j" THEN 
                 Fehler1$(f%) = PAD$ (VS_NR.kvfael,30) + " Einz.Betrag<=0 -> " + Kunde.kvfael + SPACE$ (150) + STR$ (codevt.kvfael,"000000")
               ELSE 
                 Fehler1$(f%) = PAD$ (VS_NR.kvfael,30) + " Kontofehler -> " + Kunde.kvfael + SPACE$ (150) + STR$ (codevt.kvfael,"000000")
               END IF 
             END IF 
             f% = f% + 1
           END IF 
         END IF 
         SET STATUS "DatensÑtze gesamt: " + LTRIM$ ( STR$ (g%,"999999")) + " verarbeitet: " + LTRIM$ ( STR$ (i%,"999999")) + " im Abruf: " + LTRIM$ ( STR$ (j%,"999999")) + " Fehler: " + LTRIM$ ( STR$ (f%,"9999")) + " OK: " + LTRIM$ ( STR$ (k%,"99999"))
         FILE "KVFAEL"
         SELECT NEXT FILE "KVFAEL" INDEX QIAZAAbr.kvFAEL
       WEND 
      END IF 
       CALL Fehler("DatensÑtze gesamt: " + LTRIM$ ( STR$ (g%,"999999")) + " verarbeitet: " + LTRIM$ ( STR$ (i%,"999999")) + " im Abruf: " + LTRIM$ ( STR$ (j%,"999999")) + " Fehler: " + LTRIM$ ( STR$ (f%,"9999")) + " OK: " + LTRIM$ ( STR$ (k%,"99999")),"")
       IF f% > 0 THEN 
         lok% = - 1
         WHILE lok%
           CREATE DIALOG "ZEINLIST",0,0,440,330,"Vertrag suchen...","MS Sans Serif",8
           ADD DIALOG "ZEINLIST",4,0,0,438,300,0,""
           ADD DIALOG "ZEINLIST",9,8,11,25,24,2
           ADD DIALOG "ZEINLIST",5,35,15,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus."
           REM ADD DIALOG "ZEINLIST",5,6,28,398,10,0,"Vertrags-/Policennummer                         Kunde/Gesellschaft/Sparte/Agentur            von      bis"
           ADD DIALOG "ZEINLIST",7,6,38,425,255,2 + 128,2,Fehler1$,Auswahl$,prompt$
           ADD DIALOG "ZEINLIST",1,126,310,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,186,310,55,15,0,"&Abbrechen",0,0
           ADD DIALOG "ZEINLIST",1,246,310,55,15,0,"&Drucken",2,0
           DIALOG "ZEINLIST",req%
           REMOVE DIALOG "ZEINLIST"
           IF req% = 1 THEN 
             GetVertrag% = VAL ( RIGHT$ (Auswahl$(0),6))
             prompt$ = Auswahl$(0)
             SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
             cuvt% = GetVertrag%
             knr% = Codeku.kvertrag
             SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
             lfdnr% = lfdnr.kvertrag
             SELECT WHERE FILE "kvertrag"
             CALL KVERTRAGneu(lfdnr%)
           END IF 
           IF req% = 0 THEN 
             lok% = 0
           END IF 
           IF req% = 2 THEN 
             MOUSE OFF 
             REM Drucken 
             FILE "KVFTMP"
             CALL PRep("RABRECH2")
             IF codege% <> 0 THEN 
               drutitel$ = gesell$
             END IF 
             m$ = STR$ (m%,"00")
             drutitel$ = drutitel$ + " HauptfÑlligkeit " + m$

             BEFORE REPORT 
                 SET REPORT PAGE "H_REPORT"
                 OUTPUT REPORT PAGE 
             END REPORT 
 
             AFTER REPORT 
                 SET REPORT PAGE "F_REPORT"
                 OUTPUT REPORT PAGE 
             END REPORT 
 
             HEADING 
                 SET REPORT PAGE "H_PAGE"
                 OUTPUT REPORT PAGE 
             END HEADING 
 
             GROUP Gesellschaft.KVFTMP
             BEFORE GROUP Gesellschaft.KVFTMP
                 SET REPORT PAGE "Page8"
                 OUTPUT REPORT PAGE 
             END GROUP 
 
             AFTER GROUP Gesellschaft.KVFTMP
                 SET REPORT PAGE "Page9"
                 OUTPUT REPORT PAGE 
                 EJECT REPORT 
             END GROUP 
 
             AFTER SELECT 
                 SET REPORT PAGE "F_SELECT"
                 OUTPUT REPORT PAGE 
             END SELECT 
  
 
             SET QUERY OFF 
             SET QUERY LOCK OFF 
             SET FIRST PAGE HEADING OFF 
             IF codege% < 1 THEN 
               SELECT ;
               WHERE dtausfehl.kvftmp = 1
               ORDER REPORT Gesellschaft.KVFtmp,Kunde.KVFtmp
               TO ASK 
               END SELECT 
             ELSE 
               SELECT ;
               WHERE codege.kvftmp = codege% AND dtausfehl.kvftmp = 1
               ORDER REPORT Gesellschaft.KVFtmp,Kunde.KVFtmp
               TO ASK 
               END SELECT 
             END IF 
           END IF 
         WEND 
       END IF 
     END IF 
     IF opt% = 2 THEN 
       REM DTAUS - Diskette erstellen
       CALL DFile(3,"dtaus" + _fpw$)
       REMOVE FROM FILE "DTAUS"
       REQUEST "Mîchten Sie die Bankeinzug - Diskette erstellen?","",130,req4%
       IF req4% = 1 THEN 
         
         IF i% < 1 THEN 
           FILE "KVFAEL"
           INDEX QIAZAAbr.kvFAEL
           SELECT FIRST 
           test$ = "11j"
           SELECT KEY test$ FILE "KVFAEL" INDEX QIAZAAbr.kvFAEL
           REM CALL Fehler("DTAUS erstellen","")
           FILE "Geadr"
           INDEX codege.geadr
           SELECT FIRST LOCK 
           feld$ = "Abruf" + STR$ (m%,"00") + ".geadr"
           MOUSE OFF 
           WHILE NOT EOF ("GEADR")
             SET STATUS "Lîschen der Summenfelder in " + gesellschaft.geadr
             feld$$ = 0
             STORE FILE "geadr"
             SELECT NEXT LOCK FILE "Geadr" INDEX codege.geadr
           WEND 
           REM CALL Fehler("Gesellschafts-Summenfelder gelîscht","")
           WHILE NOT EOF ("KVFAEL") AND QIAZAAbr.kvFAEL = test$
             i% = i% + 1
             REM 16042002
             REM IF QIAZAAbr.kvFAEL = test$ AND nexthauptf.kvfael = m% AND Einzabruf.kvfael <> "j" THEN 
             vd% = 0
             IF Abgerufenam.kvfael > 0 THEN 
               vd% = VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"mmyyyy0d"),2))
               aaaaabg$ = DATE$ (Abgerufenam.kvfael,"mmyyyy0d")
             END IF 
             IF QIAZAAbr.kvFAEL = test$ AND (nexthauptf.kvfael = m% OR (Einzabruf.kvfael = "j" AND vd% = m%)) THEN 
               j% = j% + 1
               IF LTRIM$ (K1Konto.kvfael) <> "" AND LTRIM$ (K1Bank.kvfael) <> "" AND K1BLZ.kvfael <> "" AND (Beitrag.kvfael > 0 OR EinzBeitrag.kvfael > 0) THEN 
                 k% = k% + 1
                 BLANK FILE "KVFTMP"
                 a% = CopyRecord%("KVFAEL","KVFTMP")
                 STORE FILE "KVFTMP"
               ELSE 
                 BLANK FILE "KVFTMP"
                 a% = CopyRecord%("KVFAEL","KVFTMP")
                 dtausfehl.KVFTMP = 1
                 IF Beitrag.kvfael <= 0 THEN 
                   Fehlertext.kvftmp = "Beitrag<=0"
                 ELSE 
                   IF EinzBeitrag.kvfael <= 0 AND Einzabruf.kvfael = "j" THEN 
                     Fehlertext.kvftmp = "Einz.Betrag<=0"
                   ELSE 
                     Fehlertext.kvftmp = "Kontoinformation unvollstÑndig"
                   END IF 
                 END IF 
                 STORE FILE "KVFTMP"
                 IF Beitrag.kvfael <= 0 THEN 
                   Fehler1$(f%) = PAD$ (VS_NR.kvfael,30) + " Beitrag<=0 -> " + Kunde.kvfael + SPACE$ (150) + STR$ (codevt.kvfael,"000000")
                 ELSE 
                   IF EinzBeitrag.kvfael <= 0 AND Einzabruf.kvfael = "j" THEN 
                     Fehler1$(f%) = PAD$ (VS_NR.kvfael,30) + " Einz.Betrag<=0 -> " + Kunde.kvfael + SPACE$ (150) + STR$ (codevt.kvfael,"000000")
                   ELSE 
                     Fehler1$(f%) = PAD$ (VS_NR.kvfael,30) + " Kontofehler -> " + Kunde.kvfael + SPACE$ (150) + STR$ (codevt.kvfael,"000000")
                   END IF 
                 END IF 
                 f% = f% + 1
               END IF 
             END IF 
        SET STATUS "DatensÑtze gesamt: " + LTRIM$ ( STR$ (g%,"999999")) + " verarbeitet: " + LTRIM$ ( STR$ (i%,"999999")) + " im Abruf: " + LTRIM$ ( STR$ (j%,"999999")) + " Fehler: " + LTRIM$ ( STR$ (f%,"9999")) + " OK: " + LTRIM$ ( STR$ (k%,"99999"))
             FILE "KVFAEL"
             SELECT NEXT FILE "KVFAEL" INDEX QIAZAAbr.kvFAEL
           WEND 
         END IF 
    CALL Fehler("DatensÑtze gesamt: " + LTRIM$ ( STR$ (g%,"999999")) + " verarbeitet: " + LTRIM$ ( STR$ (i%,"999999")) + " im Abruf: " + LTRIM$ ( STR$ (j%,"999999")) + " Fehler: " + LTRIM$ ( STR$ (f%,"9999")) + " OK: " + LTRIM$ ( STR$ (k%,"99999")),"")
         REMOVE FROM FILE "dtaus"
         a% = 0
         BLANK FILE "DTAUS"
         satzlaenge.DTAUS = 128
         satzart.DTAUS = "A"
         A_Kennzeichen.DTAUS = "LK"
         A_Bankleitzahl = VAL (blz.stamm)
         A_Kundenname.DTAUS = UCASE$ ( LEFT$ (Firma1.stamm,27))
         A_Datum.DTAUS = TODAY 
         A_Kontonummer = VAL (Konto.stamm)
         A_Waehrungknz.DTAUS = "1"
         STORE FILE "DTAUS"
         FILE "KVFTMP"
         INDEX dtausfehl.kvftmp
         SELECT FIRST 
         SELECT KEY 0 FILE "KVFTMP" INDEX dtausfehl.KVFTMP
         MOUSE OFF 
         WHILE NOT EOF ("KVFTMP") AND dtausfehl.KVFTMP < 1
           SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
           SELECT KEY codevt.KVFTMP FILE "KVERTRAG" INDEX lfdnr.kvertrag
           IF waehrung.kvertrag LIKE "EUR*" THEN 
             ok% = - 1
           ELSE 
             ok% = 0
             a$ = "Die WÑhrung des Betrages zum Vertrag " + VS_nr.KVFTMP + " lautet nicht EUR sondern " + waehrung.kvertrag
             b$ = "PrÅfen Sie, ob der Vertrag auf EURO umgestellt wurde und erfassen Sie ggf. den Betrag in der erforderlichen WÑhrung neu!"
           END IF 
           IF ok% = - 1 THEN 
             
             IF Beitrag.KVFTMP > 0 THEN 
               a% = a% + 1
               SET STATUS STR$ (a%,"999999") + " DatensÑtze Åbernommen!"
               BLANK FILE "DTAUS"
               satzart.DTAUS = "C"
               C_Bankleitzahl1.DTAUS = VAL (blz.stamm)
               C_Bankleitzahl2.DTAUS = VAL (k1blz .KVFTMP)
               C_Kontonummer1.DTAUS = VAL (k1Konto.KVFTMP)
               Gesellschaft.dtaus = gesellschaft.KVFTMP
               codege.dtaus = codege.kvftmp
               C_Textkey.DTAUS = 05
               REM C_BetragDM = Beitrag.KVFTMP * 100
               C_BetragEuro.dtaus = Beitrag.KVFTMP * 100
               C_Waehrungknz.dtaus = "1"
               C_Bankleitzahl3.DTAUS = VAL (blz.stamm)
               C_Kontonummer2.DTAUS = VAL (Konto.stamm)
               C_Name1.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(Kunde.KVFTMP),27))
               C_Name2.DTAUS = LEFT$ ( UCASE$ (VSNRPack1$( MID$ (Kunde.KVFTMP,28,27))),27)
               C_VerwZweck.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(sparte.KVFTMP),27))
          
               C_ErwKnz.DTAUS = 03
               C_ErwTeilKnz1.DTAUS = 02
               C_Inhalt1.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(VS_NR.KVFTMP),27))
               C_ErwTeilKnz2.DTAUS = 02
               C_Inhalt2.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(UEBERWTXT.KVFTMP),27))
               C_ErwTeilKnz3.DTAUS = 02
               C_Inhalt3.DTAUS = "XX"
               STORE FILE "DTAUS"
               SELECT FIRST FILE "geadr" INDEX codege.geadr
               SELECT KEY codege.kvftmp LOCK FILE "geadr" INDEX codege.geadr
               feld$$ = feld$$ + Beitrag.KVFTMP
               STORE FILE "geadr"
             END IF 
             IF EinzBeitrag.kvftmp > 0 AND Einzabruf.kvftmp = "j" THEN 
               a% = a% + 1
               SET STATUS STR$ (a%,"999999") + " DatensÑtze Åbernommen!"
               BLANK FILE "DTAUS"
               satzart.DTAUS = "C"
               C_Bankleitzahl1.DTAUS = VAL (blz.stamm)
               C_Bankleitzahl2.DTAUS = VAL (k1blz .KVFTMP)
               C_Kontonummer1.DTAUS = VAL (k1Konto.KVFTMP)
               Gesellschaft.dtaus = gesellschaft.KVFTMP
               codege.dtaus = codege.kvftmp
               C_Textkey.DTAUS = 05
               REM C_BetragDM = Beitrag.KVFTMP * 100
               C_BetragEuro.dtaus = EinzBeitrag * 100
               C_Waehrungknz.dtaus = "1"
               C_Bankleitzahl3.DTAUS = VAL (blz.stamm)
               C_Kontonummer2.DTAUS = VAL (Konto.stamm)
               C_Name1.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(Kunde.KVFTMP),27))
               C_Name2.DTAUS = LEFT$ ( UCASE$ (VSNRPack1$( MID$ (Kunde.KVFTMP,28,27))),27)
               C_VerwZweck.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(sparte.KVFTMP),27))
          
               C_ErwKnz.DTAUS = 03
               C_ErwTeilKnz1.DTAUS = 02
               C_Inhalt1.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(VS_NR.KVFTMP),27))
               C_ErwTeilKnz2.DTAUS = 02
               C_Inhalt2.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(UEBERWTXT.KVFTMP),27))
               C_ErwTeilKnz3.DTAUS = 02
               C_Inhalt3.DTAUS = "XX"
               STORE FILE "DTAUS"
               SELECT FIRST FILE "geadr" INDEX codege.geadr
               SELECT KEY codege.kvftmp LOCK FILE "geadr" INDEX codege.geadr
               feld$$ = feld$$ + EinzBeitrag.KVFTMP
               STORE FILE "geadr"
             END IF 
           ELSE 
             CALL Fehler(a$,b$)
           END IF 
           FILE "KVFTMP"
           SELECT NEXT LOCK FILE "KVFTMP" INDEX dtausfehl.kvftmp
         WEND 
         MOUSE ON 
         IF EXISTS (GMACodeDir$ + "dtaus1.txt") THEN DELETE GMACodeDir$ + "dtaus1.txt"
         CALL dtaus()
         REQUEST "Wollen Sie jetzt die Abruf-Liste drucken?","",130,req1%
         REM abrufliste drucken
         IF req1% = 1 THEN 
           FILE "geadr"
           INDEX gesellschaft.geadr
           SELECT FIRST LOCK 
           feld$ = "Abruf" + STR$ (m%,"00") + ".geadr"
           MOUSE OFF 
           WHILE NOT EOF ("GEADR")
              Abrufakt.geadr = feld$$
              STORE FILE "geadr"
              SELECT NEXT LOCK FILE "geadr"
           WEND 
           CALL PRep("ABRUFLI")
           BEFORE REPORT 
           SET REPORT PAGE "H_REPORT"
           OUTPUT REPORT PAGE 
           END REPORT 
 
           HEADING 
           SET REPORT PAGE "H_PAGE"
           OUTPUT REPORT PAGE 
           END HEADING 
 
           FOOTING 1
           SET REPORT PAGE "F_PAGE"
           OUTPUT REPORT PAGE 
           END FOOTING 
 
           AFTER SELECT 
           SET REPORT PAGE "F_SELECT"
           OUTPUT REPORT PAGE 
           END SELECT 
 
           SET QUERY OFF 
           SET QUERY LOCK OFF 
           SET FIRST PAGE HEADING OFF 
           SET FIRST PAGE FOOTING OFF 
           SELECT ;
             WHERE Abrufakt.geadr <> 0
             ORDER REPORT Gesellschaft.GEADR
           TO ASK 
           END SELECT 
           MOUSE ON 
         END IF 
         REQUEST "Wollen Sie die Diskette erzeugen?","Andernfalls wird nur die Liste erzeugt!",130,req%
         IF req% = 1 THEN 
           CALL Info("Bitte legen Sie eine leere Diskette in Laufwerk A:","Zur Sicherheit wir eine Kopie der Datei unter " + GMACodeDir$ + "dtaus1.txt gespeichert (falls Ihre Diskette kaputt ist)")
           MOUSE OFF 
           COPY GMACodeDir$ + "dtaus1.txt" TO "a:\dtaus1.txt"
           d2$ = DATE$ ( TODAY ,"yyyymm0d")
           IF dtcount% > 999 THEN dtcount% = 1
           CALL WriteConfig("PROVIS","DTAUS", STR$ (dtcount%,"000"))
         
           d2$ = d2$ + "." + STR$ (dtcount%,"000")
           ON ERROR GOTO errcrdir021101
           dir$ = DIRECTORY 
           MAKE DIRECTORY _netpath$ + "\dtaus.bak"
errcrdir021101: 
           DIRECTORY dir$
           ON ERROR GOTO ErrorHandler
           COPY GMACodeDir$ + "dtaus1.txt" TO _netpath$ + "\dtaus.bak\" + d2$
           MOUSE ON 
           CALL Fehler("Die DTAUS-Diskette wurde erstellt!","Es wurden " + STR$ (a%,"999999") + " DatensÑtze Åbernommen!")
         ELSE 
           opt% = 3
         END IF 
       END IF 
     END IF 
     IF opt% = 3 THEN 
      IF RECCOUNT ("dtaus") > 0 THEN 
        REQUEST "Mîchten Sie die den DTAUS-Ausdruck fÅr eine","einzelne Gesellschaft erzeugen?",135,req4%
        IF req4% = 1 THEN 
          codege% = GetCodeGE%(0)
        ELSE 
          codege% = 0
          REQUEST "Mîchten Sie einen DTAUS-Gesamtsummenausdruck erzeugen?","",135,req%
          IF req% = 1 THEN 
            
            FILE "dtaus"
            CALL FldAdd1("CODEGE","NUM;000000.",1)
            INDEX codege.dtaus
            SELECT FIRST 

          END IF 
        END IF 
       
       CALL PRep("RABRECH4")
       REPORT ON sumabrbe% AS "sumbeitr%",C_BetragEuro.DTAUS AS "anzges%"
       BEFORE REPORT 
       SET REPORT PAGE "H_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
 
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
 
       HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
       END HEADING 
 
       GROUP Gesellschaft.DTAUS,sumabrbe% AS "sumbeitr%",C_BetragEuro.DTAUS AS "anzges%"
       BEFORE GROUP Gesellschaft.DTAUS
       SET REPORT PAGE "H_Gesellscha002"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       AFTER GROUP Gesellschaft.DTAUS
       SET REPORT PAGE "F_Gesellscha002"
       OUTPUT REPORT PAGE 
       EJECT REPORT 
       END GROUP 
 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
       ON ERROR GOTO LundDTAUSend
       SET QUERY OFF 
       SET QUERY LOCK OFF 
       SET FIRST PAGE HEADING OFF 
       IF codege% = 0 THEN 
         SELECT ;
         WHERE Satzart.DTAUS <> "A"
         TO ASK 
         END SELECT 
       ELSE 
         SELECT ;
         WHERE Satzart.DTAUS <> "A" AND codege.dtaus = codege%
         TO ASK 
         END SELECT 
       END IF 
      ELSE 
        CALL Fehler("Sie mÅssen erst die DTAUS - Diskette erstellen lassen, bevor Sie den Inhalt drucken kînnen!","")
      END IF 
     END IF 
     IF opt% = 4 THEN 
       CALL GesAbrufLi(m%)
     END IF 
   ELSE 
     zok% = 0
   END IF 
 WEND 
LundDTAUSend: 
 ON ERROR GOTO ErrorHandler
 END SUB 


SUB GesAbrufLi(m%)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
           FILE "geadr"
           INDEX gesellschaft.geadr
           SELECT FIRST LOCK 
           feld$ = "Abruf" + STR$ (m%,"00") + ".geadr"
           MOUSE OFF 
           WHILE NOT EOF ("GEADR")
              Abrufakt.geadr = feld$$
              STORE FILE "geadr"
              SELECT NEXT LOCK FILE "geadr"
           WEND 
           UNLOCK CURRENT FILE "geadr"
           UNLOCK FILE "geadr" ALL 
           CALL PRep("ABRUFLI")
           BEFORE REPORT 
           SET REPORT PAGE "H_REPORT"
           OUTPUT REPORT PAGE 
           END REPORT 
 
           HEADING 
           SET REPORT PAGE "H_PAGE"
           OUTPUT REPORT PAGE 
           END HEADING 
 
           FOOTING 1
           SET REPORT PAGE "F_PAGE"
           OUTPUT REPORT PAGE 
           END FOOTING 
 
           AFTER SELECT 
           SET REPORT PAGE "F_SELECT"
           OUTPUT REPORT PAGE 
           END SELECT 
 
           SET QUERY OFF 
           SET QUERY LOCK OFF 
           SET FIRST PAGE HEADING OFF 
           SET FIRST PAGE FOOTING OFF 
           SELECT ;
             WHERE Abrufakt.geadr <> 0
             ORDER REPORT Gesellschaft.GEADR
           TO ASK 
           END SELECT 
           MOUSE ON 
 END SUB 



 REM Lund Wriggers Abrechnngsliste erstellen
 REM m%=Monat

SUB LundAbrList(m%,codege%)
 jahr% = VAL ( LEFT$ ( DATE$ ( TODAY ,"yyyymm0d"),4))
  IF codege% <> 0 THEN 
    drutitel$ = gesell$
  END IF 
  m$ = STR$ (m%,"00")
  jm$ = m$ + "." + STR$ (jahr%,"0000")
  IF codege% > 0 AND NOT EXISTS (codege%,codege.KVFAEL) THEN 
    SELECT KEY codege% FILE "Geadr" INDEX codege.geadr
    CALL Fehler("FÅr die gewÑhlte Gesellschaft " + Gesellschaft.geadr,"existieren keine zu druckenden Daten")
    GOTO LundAbrListEnd
  END IF 
  CALL PRep("RABRECH1")
  
 REPORT ON VS_NR.KVFAEL AS "anzges%",tdif1% AS "sumdiff2%"
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP Gesellschaft.KVFAEL,VS_NR.KVFAEL AS "anzgesg%",tdif1% AS "sumdiff1%",(einzbeitrag% + beitrag%) AS "sumebeitrg%",(einzcourtage% + courtage%) AS "sumecourt%"
 BEFORE GROUP Gesellschaft.KVFAEL
     SET REPORT PAGE "H_Gesellscha002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Gesellschaft.KVFAEL
     SET REPORT PAGE "F_Gesellscha002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 
  drutitel$ = " per " + jm$
  jm1$ = m$ + STR$ (jahr%,"0000")
  SET QUERY OFF 
  SET QUERY LOCK OFF 
  SET FIRST PAGE HEADING OFF 
  IF codege% < 1 THEN 
    REM SELECT ;
    REM WHERE CodeGE.KVFAEL = CodeGE.GEADR AND (INKART.KVFAEL = 1 AND Abruf.KVFAEL = "j" AND nexthauptf.kvfael = m%) OR (INKART.KVFAEL = 1 AND EinzAbruf.KVFAEL = "j" AND VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"mm0dyyyy"),2)) = m%)
    REM Abgerufenam.kvfael
    REM SELECT ;
    REM WHERE CodeGE.KVFAEL = CodeGE.GEADR AND (( VAL ( LEFT$ ( DATE$ (letzteZahlung.kvfael,"mm0dyyyy"),2)) = m% AND VAL ( LEFT$ ( DATE$ (letzteZahlung.kvfael,"yyyymm0d"),4)) = jahr%) OR 
    REM (EinzAbruf.kvfael = "j"))
    SELECT ;
    WHERE CodeGE.KVFAEL = CodeGE.GEADR AND (( VAL ( LEFT$ ( DATE$ (letzteZahlung.kvfael,"mm0dyyyy"),2)) = m% AND VAL ( LEFT$ ( DATE$ (letzteZahlung.kvfael,"yyyymm0d"),4)) = jahr%) OR 
    ( VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"mm0dyyyy"),2)) = m% AND VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"yyyymm0d"),4)) = jahr%)) AND 
    (Beitrag.kvfael <> 0 OR Courtage.kvfael <> 0 OR EinzBeitrag.kvfael <> 0 OR EinzCourtage.kvfael <> 0)
    ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
    TO ASK 
  ELSE 
    REM SELECT ;
    REM WHERE CodeGE.KVFAEL = CodeGE.GEADR AND 
    REM (codege.kvfael = codege% AND INKART.KVFAEL = 1 AND Abruf.KVFAEL = "j" AND nexthauptf.kvfael = m%) OR (INKART.KVFAEL = 1 AND EinzAbruf.KVFAEL = "j" AND VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"mm0dyyyy"),2)) = m%)
    SELECT ;
    WHERE CodeGE.KVFAEL = CodeGE.GEADR AND codege.kvfael = codege% AND (( VAL ( LEFT$ ( DATE$ (letzteZahlung.kvfael,"mm0dyyyy"),2)) = m% AND VAL ( RIGHT$ ( DATE$ (letzteZahlung.kvfael,"0dmmyyyy"),4)) = jahr%) OR 
    ( VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"mm0dyyyy"),2)) = m% AND VAL ( LEFT$ ( DATE$ (Abgerufenam.kvfael,"yyyymm0d"),4)) = jahr%)) AND 
    (Beitrag.kvfael <> 0 OR Courtage.kvfael <> 0 OR EinzBeitrag.kvfael <> 0 OR EinzCourtage.kvfael <> 0)
    ORDER REPORT Gesellschaft.KVFAEL,Kunde.KVFAEL
    TO ASK 
  END IF 
  END SELECT 
LundAbrListEnd: 
 ON ERROR GOTO ErrorHandler
 END IF 
 END SUB 
  
 '***********************************************************************************************
 '*    Totales RÅcksetzen der KontostÑnde alle Mitarbeiter                                      *
 '***********************************************************************************************
 
 
SUB RÅcksetzMAADR()
 CALL DFile(3,"Kgeadr" + _fpw$)
 CALL DFile(2,"OFFICE\dokma" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"AGDIR" + _fpw$)
 CALL DFile(3,"AUMSKTO" + _fpw$)
 CALL DFile(3,"AUMSATZ" + _fpw$)
 CALL DFile(3,"MAAUSZ" + _fpw$)
 CALL DFile(3,"FOERKOND" + _fpw$)
 REQUEST "Wirklich alle Kontowerte auf NULL setzen?","",135,req%
 IF req% <> 1 THEN END SUB 
 REQUEST "Wollen Sie wirklich alle Kontowerte auf NULL setzen?","Dies kann nicht rÅckgÑngig gemacht werden!",135,req%
 IF req% <> 1 THEN END SUB 
 MOUSE OFF 
 FILE "maadr"
 UPDATE Auszahlab.maadr = 0:AuszahlEUab.maadr = 0:AuszProvABGes.maadr = 0:AuszProvABGesEU.maadr = 0:aktzusb.maadr = 0:aktzusbeu.maadr = 0:erfauszahlab.maadr = 0:erfauszahleuab.maadr = 0:Einheiten.maadr = 0:EigEinheiten.maadr = 0
 END UPDATE 
     CLOSE FILE "maadr"
     CALL DFile(3,"maadr" + _fpw$)
 REMOVE FROM FILE "AUMSKTO"
 REMOVE FROM FILE "MAAUSZ"
 MOUSE ON 
 CALL Fehler("Es wurden die KontostÑnde aller Mitarbeiter gelîscht!","")
 END SUB 
 




 ' Vertrag suchen (Info)
 ' =======================================================================
 ' 10.05.95 
  
FUNCTION GetAntrag%(lfdnr%)
 MOUSE OFF 
 cfile$ = FILE 
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 IF lfdnr% = 0 THEN 
   VSNR$ = ""
 ELSE 
   SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF FOUND ("KVERTRAG") THEN VSNR$ = VS_Nr.KVERTRAG ELSE VSNR$ = ""
 END IF 
 IF eingab$ = "" AND viab% <> 1 THEN 
   CREATE DIALOG "DZ2",0,0,191,87,"Vertrag suchen...","MS Sans Serif",8
   ADD DIALOG "DZ2",4,0,0,191,63,0,""
   ADD DIALOG "DZ2",9,5,10,21,22,2
   ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Antragsnummer des gesuchten Vertrages ein:"
   ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
   ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
   ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
   ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
   DIALOG "DZ2",req%
   REMOVE DIALOG "DZ2"
 ELSE 
   VSNR$ = eingab$
   req% = 1
   a% = 0
   IF eingab$ = "" AND eingab2$ <> "" THEN vsnr$ = eingab2$
 END IF 
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM 030699
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM G1Vertraege$(20000)
   ELSE 
     DIM G1Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   INDEX QAntragsNr.KVERTRAG
   SELECT FIRST 
   tVSNR$ = VSNRPack$(VSNR$)
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
   a% = 0
   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Vertragsdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   ii% = 0
   zz% = RECCOUNT ("KVERTRAG")
   _prozt% = 0
   _proz2% = 0
   _anz% = zz%
   locktest% = MNdisabled%("DATALOCK")
   WHILE QAntragsNr.KVERTRAG LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
       IF locktest% THEN 
         SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
         SELECT KEY codeku.KVERTRAG FILE "ADRESSEN" INDEX codeku.adressen
         IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN GOTO endvsu120220042
       END IF 
     IF GASP% THEN 
       IF workstation% = 0 THEN 
         ok% = - 1
         IF GSuFromAdr% = - 1 THEN 
           IF GDatumVON% > 0 AND Erfasdatum.Kvertrag < GDatumVON% THEN ok% = 0
           IF GDatumBis% > 0 AND Erfasdatum.Kvertrag > GDatumBis% THEN ok% = 0
           IF GCodeMA% > 0 AND codema.kvertrag <> GCodema% THEN ok% = 0
           IF GCodeGE% > 0 AND codeGE.kvertrag <> GCodeGE% THEN ok% = 0
           IF GCodeVA% > 0 AND codeVA.kvertrag <> GCodeVA% THEN ok% = 0
           IF GCodeVP% > 0 AND codevp.kvertrag <> GCodeVA% THEN ok% = 0
           IF GCodeEingGE% > 0 AND CodeEingGE.kvertrag <> GCodeEingGE% THEN ok% = 0
         END IF 
         IF ok% = - 1 THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           G1Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           ok% = - 1
           IF GSuFromAdr% = - 1 THEN 
             IF GDatumVON% > 0 AND Erfasdatum.Kvertrag < GDatumVON% THEN ok% = 0
             IF GDatumBis% > 0 AND Erfasdatum.Kvertrag > GDatumBis% THEN ok% = 0
             IF GCodeMA% > 0 AND codema.kvertrag <> GCodema% THEN ok% = 0
             IF GCodeGE% > 0 AND codeGE.kvertrag <> GCodeGE% THEN ok% = 0
             IF GCodeVA% > 0 AND codeVA.kvertrag <> GCodeVA% THEN ok% = 0
             IF GCodeVP% > 0 AND codevp.kvertrag <> GCodeVA% THEN ok% = 0
             IF GCodeEingGE% > 0 AND CodeEingGE.kvertrag <> GCodeEingGE% THEN ok% = 0
           END IF 
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN ok% = 0
           IF ok% = - 1 THEN 
             name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
             IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
             IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
             IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
             G1Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
       ok% = - 1
       IF GSuFromAdr% = - 1 THEN 
         IF GDatumVON% > 0 AND Erfasdatum.Kvertrag < GDatumVON% THEN ok% = 0
         IF GDatumBis% > 0 AND Erfasdatum.Kvertrag > GDatumBis% THEN ok% = 0
         IF GCodeMA% > 0 AND codema.kvertrag <> GCodema% THEN ok% = 0
         IF GCodeGE% > 0 AND codeGE.kvertrag <> GCodeGE% THEN ok% = 0
         IF GCodeVA% > 0 AND codeVA.kvertrag <> GCodeVA% THEN ok% = 0
         IF GCodeVP% > 0 AND codevp.kvertrag <> GCodeVA% THEN ok% = 0
         IF GCodeEingGE% > 0 AND CodeEingGE.kvertrag <> GCodeEingGE% THEN ok% = 0
       END IF 
       IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN ok% = 0
       IF ok% = - 1 THEN 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         G1Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$
         IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
           G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
         END IF 
         G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
         IF a% = 0 THEN prompt$ = G1Vertraege$(0)
         tmpZeile$ = G1Vertraege$(a%)
         a% = a% + 1
       END IF 
     END IF 
endvsu120220042: 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     SELECT NEXT FILE "KVERTRAG"
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
   CALL Gauge(0,"")
   IF a% = 0 THEN 
     GetAntrag% = 0
   ELSE 
     IF a% > 1 OR (a% = 1 AND viab% = 1) THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,441,298,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,441,272,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Antragsnummer                              von              bis"
         ADD DIALOG "ZEINLIST",7,3,68,430,205,2 + 128,2,G1Vertraege$,Auswahl$,prompt$
         IF MAKLER$ <> "TRUE" THEN 
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Abbrechen",0,0
         ELSE 
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&Kontoinfo",3,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,315,278,55,15,0,"&Abbrechen",0,0
         END IF 
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1,3
           GetAntrag% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
           IF req% = 3 THEN 
             kontoinf% = GetVertrag%
           ELSE 
             kontoinf% = 0
           END IF 
         CASE 0
           GetAntrag% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GetAntrag% = VAL ( RIGHT$ (G1Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GetAntrag% = 0
 END IF 
 END FUNCTION 



 ' Vertrag suchen (Info)
 ' =======================================================================
 ' 10.05.95 
  
FUNCTION GetVertrag%(lfdnr%)
 MOUSE OFF 
 cfile$ = FILE 
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 IF lfdnr% = 0 THEN 
   VSNR$ = ""
 ELSE 
   SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF FOUND ("KVERTRAG") THEN VSNR$ = VS_Nr.KVERTRAG ELSE VSNR$ = ""
 END IF 
 IF eingab$ = "" AND viab% <> 1 THEN 
   CREATE DIALOG "DZ2",0,0,191,87,"Vertrag suchen...","MS Sans Serif",8
   ADD DIALOG "DZ2",4,0,0,191,63,0,""
   ADD DIALOG "DZ2",9,5,10,21,22,2
   ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer des gesuchten Vertrages ein:"
   ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
   ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
   ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
   ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
   DIALOG "DZ2",req%
   REMOVE DIALOG "DZ2"
 ELSE 
   VSNR$ = eingab$
   req% = 1
   REM a% = 0
   REM IF eingab$ = "" AND eingab2$ <> "" THEN GOTO w220420051
 END IF 
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM 030699
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
     DIM Vertraege%(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
     DIM Vertraege%( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   suchanzahl% = 0
   IF VAL ( LEFT$ (VSNR$,1)) > 0 THEN 
     INDEX QNumVSNR.kvertrag
     KVIndexName$ = "QNumVSNR.kvertrag"
     tVSNR$ = VSNRPackNum$(VSNR$)
   ELSE 
     INDEX QuickVSNR.kvertrag
     KVIndexName$ = "QuickVSNR.kvertrag"
     tVSNR$ = VSNRPack$(VSNR$)
   END IF 
   KVIndex$ = INDEX + ".kvertrag"
   
vsuch031120021: 
   FILE "KVERTRAG"
   INDEX KVIndex$$
   REM INDEX QuickVSNR.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX KVIndex$$
   REM tVSNR$ = VSNRPackNum$(VSNR$)
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX KVIndex$$
   a% = 0
   WHILE KVIndexName$$ LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND tVSNR$ <> ""
     MOUSE OFF 
     IF GASP% THEN 
       IF Workstation% = 0 THEN 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             Vertraege%(x%) = lfdnr.KVERTRAG
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           Vertraege%(x%) = lfdnr.KVERTRAG
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG" INDEX KVIndex$$
   WEND 
   GOTO vsuweit031120021

vsuch0311200211:  
   a% = 0
vsuch0311200212: 
   y% = 0
   z% = RECCOUNT ("KVERTRAG")
   WHILE NOT EOF ("kvertrag") AND tVSNR$ <> ""
     MOUSE OFF 
     y% = y% + 1
     IF GASP% THEN 
       IF Workstation% = 0 THEN 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF KVIndexName$$ LIKE tVSNR$ OR KVIndexName$$ LIKE "*" + tVSNR$ THEN 
           sok% = - 1
         ELSE 
           sok% = 0
         END IF 
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           FOR x% = 0 TO a%
             IF Vertraege%(x%) = lfdnr.KVERTRAG THEN 
               sok% = 0
             END IF 
           NEXT x%
         END IF 
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           Vertraege%(a%) = lfdnr.KVERTRAG
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF KVIndexName$$ LIKE tVSNR$ OR KVIndexName$$ LIKE "*" + tVSNR$ THEN 
             sok% = - 1
           ELSE 
             sok% = 0
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             FOR x% = 0 TO a%
               IF Vertraege%(x%) = lfdnr.KVERTRAG THEN 
                 sok% = 0
               END IF 
             NEXT x%
           END IF 
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             Vertraege%(x%) = lfdnr.KVERTRAG
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF KVIndexName$$ LIKE tVSNR$ OR KVIndexName$$ LIKE "*" + tVSNR$ THEN 
           sok% = - 1
         ELSE 
           sok% = 0
         END IF 
         IF GMASuperCount% > 0 AND sok% THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           FOR x% = 0 TO a%
             IF Vertraege%(x%) = lfdnr.KVERTRAG THEN 
               sok% = 0
             END IF 
           NEXT x%
         END IF 
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           Vertraege%(x%) = lfdnr.KVERTRAG
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG" INDEX KVIndex$$
     SET STATUS STR$ (y%,",99999999") + " von " + STR$ (z%,",99999999") + " durchsucht, gefunden: " + STR$ (a%,",99999999") + " (Durchlauf:" + durchlauf$ + ")"
   WEND 

vsuweit031120021: 
   IF a% = 0 AND suchanzahl% = 0 THEN 
     suchanzahl% = 1
     IF KVIndex$ LIKE "QNumVSNR.kvertrag" THEN 
       KVIndexName$ = "QuickVSNR.kvertrag"
       tVSNR$ = VSNRPack$(VSNR$) + "*"
     ELSE 
       KVIndexName$ = "QNumVSNR.kvertrag"
       tVSNR$ = VSNRPackNum$(VSNR$) + "*"
     END IF 
     KVIndex$ = KVIndexName$
     GOTO vsuch031120021
   END IF 
   IF a% = 0 AND suchanzahl% = 1 THEN 
     suchanzahl% = 2
     abf$ = FORM 
     IF FORM LIKE "AFSKIMPF" OR FORM LIKE "AFSPSPF" THEN 
       req% = 0
     ELSE 
       REQUEST "Kein Vertrag gefunden!","Erweiterte Suche durchfÅhren (Durchlauf 1)?",135,req%
     END IF 
     IF req% = 1 THEN 
       durchlauf$ = "1"
       IF KVIndex$ LIKE "QNumVSNR.kvertrag" THEN 
         KVIndexName$ = "QuickVSNR.kvertrag"
         tVSNR$ = VSNRPack$(VSNR$) + "*"
       ELSE 
         KVIndexName$ = "QNumVSNR.kvertrag"
         tVSNR$ = VSNRPackNum$(VSNR$) + "*"
       END IF 
       KVIndex$ = KVIndexName$
       SELECT FIRST FILE "KVERTRAG" INDEX KVIndex$$
       GOTO vsuch0311200211
     ELSE 
       suchanzahl% = 3
     END IF 
   END IF 
   IF suchanzahl% = 2 THEN 
     REM CALL Fehler("","")
     suchanzahl% = 3
     REM REQUEST "Kein Vertrag gefunden!","Erweiterte Suche durchfÅhren (Durchlauf 2)?",130,req%
     req% = 1
     IF req% = 1 THEN 
       durchlauf$ = "2"
       IF KVIndex$ LIKE "QNumVSNR.kvertrag" THEN 
         KVIndexName$ = "QuickVSNR.kvertrag"
         tVSNR$ = VSNRPack$(VSNR$) + "*"
       ELSE 
         KVIndexName$ = "QNumVSNR.kvertrag"
         tVSNR$ = VSNRPackNum$(VSNR$) + "*"
       END IF 
       KVIndex$ = KVIndexName$
       SELECT FIRST FILE "KVERTRAG" INDEX KVIndex$$
       GOTO vsuch0311200212
     END IF 
   END IF 
   REM CALL Fehler(nachname.afskimp, STR$ (a%))
w220420051: 
   IF a% = 0 THEN 
     VSNR$ = eingab2$
     tVSNR$ = VSNRPack$(VSNR$)
     IF LEN (tVSNR$) > 1 THEN 
       INDEX QAntragsNr.KVERTRAG
       SELECT FIRST FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
       SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
     ELSE 
       SELECT LAST FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
     END IF 
     q$ = QAntragsNr.KVERTRAG
     leng% = LEN (tVSNR$)
     WHILE QAntragsNr.KVERTRAG = tVSNR$ AND NOT EOF ("kvertrag") AND tVSNR$ <> ""
       MOUSE OFF 
       IF GASP% THEN 
         IF Workstation% = 0 THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
             IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
             IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
             IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF sok% THEN 
               Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
       SELECT NEXT FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
     WEND 
   END IF 
   IF GAFSK$ LIKE "TRUE" THEN 
     IF GIgnoreMultiVT% = - 1 THEN 
       IF a% > 1 THEN a% = 0
     END IF 
   END IF 
   IF a% = 0 THEN 
     GetVertrag% = 0
     cuvt% = 0
   ELSE 
     
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,441,298,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,441,272,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Vertrags-/Policennummer                       von              bis"
         ADD DIALOG "ZEINLIST",7,3,68,430,205,2 + 128,2,Vertraege$,Auswahl$,prompt$
         IF MAKLER$ <> "TRUE" THEN 
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Abbrechen",0,0
         ELSE 
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&Kontoinfo",3,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,315,278,55,15,0,"&Abbrechen",0,0
         END IF 
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1,3
           GetVertrag% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
           IF req% = 3 THEN 
             kontoinf% = GetVertrag%
           ELSE 
             kontoinf% = 0
           END IF 
         CASE 0
           GetVertrag% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GetVertrag% = VAL ( RIGHT$ (Vertraege$(0),6))
       cuvt% = GetVertrag%
     END IF 
   END IF 
   FILE "KVERTRAG"
   IF cuvt% > 0 THEN SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GetVertrag% = 0
 END IF 
 END FUNCTION 
 

 REM ****************************************************************************

FUNCTION GetVertrADR%(lfdnr%,ma%,ge%,spa%,cvp%,vone$,bise$,eingbei%)
 MOUSE OFF 
 cfile$ = FILE 
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 IF lfdnr% = 0 THEN 
   VSNR$ = ""
 ELSE 
   SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF FOUND ("KVERTRAG") THEN VSNR$ = VS_Nr.KVERTRAG ELSE VSNR$ = ""
 END IF 
 IF eingab$ = "" AND viab% <> 1 THEN 
   CREATE DIALOG "DZ2",0,0,191,87,"Vertrag suchen...","MS Sans Serif",8
   ADD DIALOG "DZ2",4,0,0,191,63,0,""
   ADD DIALOG "DZ2",9,5,10,21,22,2
   ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer des gesuchten Vertrages ein:"
   ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
   ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
   ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
   ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
   DIALOG "DZ2",req%
   REMOVE DIALOG "DZ2"
 ELSE 
   VSNR$ = eingab$
   req% = 1
 END IF 
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM 030699
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     REDIM G1Vertraege$(20000,1)
     REDIM G1Vertraege$(20000)
     DIM Vertraege%(20000)
   ELSE 
     REDIM G1Vertraege$( RECCOUNT ("KVERTRAG"),1)
     REDIM G1Vertraege$( RECCOUNT ("KVERTRAG"))
     DIM Vertraege%( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   suchanzahl% = 0
   IF VSNR$ = "*" THEN 
     INDEX ErfasDatum.kvertrag
     KVIndexName$ = "VS_NR.kvertrag"
   ELSE 
     IF VAL ( LEFT$ (VSNR$,1)) > 0 THEN 
       INDEX QNumVSNR.kvertrag
       KVIndexName$ = "QNumVSNR.kvertrag"
       tVSNR$ = VSNRPackNum$(VSNR$)
     ELSE 
       INDEX QuickVSNR.kvertrag
       KVIndexName$ = "QuickVSNR.kvertrag"
       tVSNR$ = VSNRPack$(VSNR$)
     END IF 
   END IF 
   REM GVSupersuch% wird gesetzt bei der Vertragssuche aus der Sparten-/Produkt- oder Mitarbeitermaske
   IF GVSupersuch% = - 1 THEN 
     sueingueb% = 0
     IF GCodema% > 0 THEN 
       sueingueb% = - 1
       code% = GCodema%
       KVIndexName$ = "Codema.KVERTRAG"
       INDEX codema.kvertrag
       SELECT FIRST FILE "kvertrag" INDEX codema.kvertrag
       SELECT KEY GCodema% FILE "kvertrag" INDEX codema.kvertrag
     END IF 
     IF GCodeva% > 0 THEN 
       sueingueb% = - 1
       code% = GCodeva%
       KVIndexName$ = "Codeva.KVERTRAG"
       INDEX codeva.kvertrag
       SELECT FIRST FILE "kvertrag" INDEX codeva.kvertrag
       SELECT KEY GCodeva% FILE "kvertrag" INDEX codeva.kvertrag
     END IF 
     IF GCodevp% > 0 THEN 
       sueingueb% = - 1
       code% = GCodevp%
       KVIndexName$ = "Codevp.KVERTRAG"
       INDEX codevp.kvertrag
       SELECT FIRST FILE "kvertrag" INDEX codevp.kvertrag
       SELECT KEY GCodevp% FILE "kvertrag" INDEX codevp.kvertrag
     END IF 
     IF GCodege% > 0 THEN 
       sueingueb% = - 1
       code% = GCodege%
       KVIndexName$ = "Codege.KVERTRAG"
       INDEX codege.kvertrag
       SELECT FIRST FILE "kvertrag" INDEX codege.kvertrag
       SELECT KEY GCodege% FILE "kvertrag" INDEX codege.kvertrag
     END IF 
     IF sueingueb% = 0 THEN 
       code% = eingbei%
       KVIndexName$ = "CodeEingGE.KVERTRAG"
       INDEX CodeEingGE.kvertrag
       SELECT FIRST FILE "kvertrag" INDEX CodeEingGE.kvertrag
       SELECT KEY GCodege% FILE "kvertrag" INDEX CodeEingGE.kvertrag
     END IF 
     KVIndex$ = KVIndexName$
   END IF 
   KVIndex$ = INDEX + ".kvertrag"
vsuch230420031: 
   FILE "KVERTRAG"
   IF GVSupersuch% <> - 1 THEN 
     INDEX KVIndex$$
     REM INDEX QuickVSNR.KVERTRAG
     SELECT FIRST FILE "KVERTRAG" INDEX KVIndex$$
     REM tVSNR$ = VSNRPackNum$(VSNR$)
     SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX KVIndex$$
   END IF 
   a% = 0
   zz% = RECCOUNT ("KVERTRAG")
   ii% = 0

   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Vertragsdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   _prozt% = 0
   _proz2% = 0
   _anz% = zz%
   locktest% = MNdisabled%("DATALOCK")
   REM CALL Fehler(kvindex$,"")
   IF tVSNR$ <> "*" THEN tVSNR$ = tVSNR$ + "*"
   IF tVSNR$ <> "*" AND GVSupersuch% = 0 THEN WHILE KVIndexName$$ LIKE tVSNR$ AND NOT EOF ("kvertrag") AND tVSNR$ <> "" AND ServerReply$() <> "CANCEL"
   IF tVSNR$ <> "*" AND GVSupersuch% = - 1 AND code% < 1 THEN WHILE KVIndexName$$ LIKE tVSNR$ AND NOT EOF ("kvertrag") AND tVSNR$ <> "" AND ServerReply$() <> "CANCEL"
   IF tVSNR$ = "*" AND GVSupersuch% = 0 THEN WHILE NOT EOF ("kvertrag") AND ErfasDatum.kvertrag <= DAYS (bise$) AND ServerReply$() <> "CANCEL"
   IF GVSupersuch% = - 1 AND code% > 0 THEN WHILE NOT EOF ("kvertrag") AND kvindex$$ = code%
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1

     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF GASP% THEN 
       IF Workstation% = 0 THEN 

         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF locktest% THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 

         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF sok% THEN 
           erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
           G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           a% = a% + 1
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           sok% = - 1
           REM locktest% = MNdisabled%("DATALOCK")
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF ma% > 0 THEN 
             IF codema.kvertrag <> ma% THEN sok% = 0
           END IF 
           IF ge% > 0 THEN 
             IF codege.kvertrag <> ge% THEN sok% = 0
           END IF 
           IF spa% > 0 THEN 
             IF codeva.kvertrag <> spa% THEN sok% = 0
           END IF 
           IF cvp% > 0 THEN 
             IF codevp.kvertrag <> cvp% THEN sok% = 0
           END IF 
           IF eingbei% > 0 THEN 
             IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
           END IF 
           IF vone$ = "01.01.0001" THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           ELSE 
             IF DAYS (vone$) > 0 THEN 
               IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
             END IF 
             IF DAYS (bise$) > 0 THEN 
               IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
             END IF 
           END IF 
           IF (tVSNR$ = "*" AND GVSupersuch% = 0) OR (GVSupersuch% = - 1 AND code% > 0) THEN 
             IF tVSNR$ <> "*" THEN 
               IF QuickVSNR.kvertrag LIKE tvsnr$ THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           ELSE 
             IF QuickVSNR.kvertrag LIKE tvsnr$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
             G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             Vertraege%(x%) = lfdnr.KVERTRAG
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         sok% = - 1
         REM locktest% = MNdisabled%("DATALOCK")
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF locktest% THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
         END IF 
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 

         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF vone$ = "01.01.0001" THEN 
           IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
         ELSE 
           IF DAYS (vone$) > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
           IF DAYS (bise$) > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF (tVSNR$ = "*" AND GVSupersuch% = 0) OR (GVSupersuch% = - 1 AND code% > 0) THEN 
           IF tVSNR$ <> "*" THEN 
             IF QuickVSNR.kvertrag LIKE tvsnr$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         ELSE 
           IF QuickVSNR.kvertrag LIKE tvsnr$ THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
           G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           tmpZeile$ = G1Vertraege$(a%)
           Vertraege%(x%) = lfdnr.KVERTRAG
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           a% = a% + 1
         END IF 
     END IF 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)

     SELECT NEXT FILE "KVERTRAG" INDEX KVIndex$$
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
   CALL Gauge(0,"")
   GOTO vsuweit230420031
 
vsuch2304200311:  
   a% = 0
vsuch2304200312: 
   y% = 0
   z% = RECCOUNT ("KVERTRAG")

   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Adre·datei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   _prozt% = 0
   _proz2% = 0
   _anz% = z%
   REM locktest% = MNdisabled%("DATALOCK")
   WHILE NOT EOF ("kvertrag") AND tVSNR$ <> "" AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
     y% = y% + 1

       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1

     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF GASP% THEN 
       IF Workstation% = 0 THEN 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF KVIndexName$$ LIKE tVSNR$ OR KVIndexName$$ LIKE "*" + tVSNR$ THEN 
           sok% = - 1
         ELSE 
           sok% = 0
         END IF 
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF locktest% THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
         END IF 
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF vone$ = "01.01.0001" THEN 
           IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
         ELSE 
           IF DAYS (vone$) > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
           IF DAYS (bise$) > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           FOR x% = 0 TO a%
             IF Vertraege%(x%) = lfdnr.KVERTRAG THEN 
               sok% = 0
             END IF 
           NEXT x%
         END IF 
         IF sok% THEN 
           erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
           G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           Vertraege%(a%) = lfdnr.KVERTRAG
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           a% = a% + 1
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF KVIndexName$$ LIKE tVSNR$ OR KVIndexName$$ LIKE "*" + tVSNR$ THEN 
             sok% = - 1
           ELSE 
             sok% = 0
           END IF 
           REM locktest% = MNdisabled%("DATALOCK")
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF ma% > 0 THEN 
             IF codema.kvertrag <> ma% THEN sok% = 0
           END IF 
           IF ge% > 0 THEN 
             IF codege.kvertrag <> ge% THEN sok% = 0
           END IF 
           IF spa% > 0 THEN 
             IF codeva.kvertrag <> spa% THEN sok% = 0
           END IF 
           IF cvp% > 0 THEN 
             IF codevp.kvertrag <> cvp% THEN sok% = 0
           END IF 
 
           IF eingbei% > 0 THEN 
             IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
           END IF 
 
           IF vone$ = "01.01.0001" THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           ELSE 
             IF DAYS (vone$) > 0 THEN 
               IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
             END IF 
             IF DAYS (bise$) > 0 THEN 
               IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             FOR x% = 0 TO a%
               IF Vertraege%(x%) = lfdnr.KVERTRAG THEN 
                 sok% = 0
               END IF 
             NEXT x%
           END IF 
           IF sok% THEN 
             erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
             G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             Vertraege%(x%) = lfdnr.KVERTRAG
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF KVIndexName$$ LIKE tVSNR$ OR KVIndexName$$ LIKE "*" + tVSNR$ THEN 
           sok% = - 1
         ELSE 
           sok% = 0
         END IF 
         REM locktest% = MNdisabled%("DATALOCK")
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF locktest% THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
         END IF 
         IF GMASuperCount% > 0 AND sok% THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF vone$ = "01.01.0001" THEN 
           IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
         ELSE 
           IF DAYS (vone$) > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
           IF DAYS (bise$) > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           FOR x% = 0 TO a%
             IF Vertraege%(x%) = lfdnr.KVERTRAG THEN 
               sok% = 0
             END IF 
           NEXT x%
         END IF 
         IF sok% THEN 
           erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
           G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           tmpZeile$ = G1Vertraege$(a%)
           Vertraege%(x%) = lfdnr.KVERTRAG
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           a% = a% + 1
         END IF 
     END IF 
     
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
 
     SELECT NEXT FILE "KVERTRAG" INDEX KVIndex$$
     SET STATUS STR$ (y%,",99999999") + " von " + STR$ (z%,",99999999") + " durchsucht, gefunden: " + STR$ (a%,",99999999") + " (Durchlauf:" + durchlauf$ + ")"
   WEND 
   CALL Gauge(0,"")
vsuweit230420031: 
   IF a% = 0 AND suchanzahl% = 0 AND tVSNR$ <> "*" THEN 
     suchanzahl% = 1
     IF KVIndex$ LIKE "QNumVSNR.kvertrag" THEN 
       KVIndexName$ = "QuickVSNR.kvertrag"
       tVSNR$ = VSNRPack$(VSNR$) + "*"
     ELSE 
       KVIndexName$ = "QNumVSNR.kvertrag"
       tVSNR$ = VSNRPackNum$(VSNR$) + "*"
     END IF 
     GVSupersuch% = 0
     KVIndex$ = KVIndexName$
     GOTO vsuch230420031
   END IF 
   IF a% = 0 AND suchanzahl% = 1 AND tVSNR$ <> "*" THEN 
     suchanzahl% = 2
     abf$ = FORM 
     IF FORM LIKE "AFSKIMPF" THEN 
       req% = 0
     ELSE 
       IF tVSNR$ <> "*" THEN REQUEST "Kein Vertrag gefunden!","Erweiterte Suche durchfÅhren (Durchlauf 1)?",135,req%
     END IF 
     IF req% = 1 THEN 
       durchlauf$ = "1"
       IF KVIndex$ LIKE "QNumVSNR.kvertrag" THEN 
         KVIndexName$ = "QuickVSNR.kvertrag"
         tVSNR$ = VSNRPack$(VSNR$) + "*"
       ELSE 
         KVIndexName$ = "QNumVSNR.kvertrag"
         tVSNR$ = VSNRPackNum$(VSNR$) + "*"
       END IF 
       KVIndex$ = KVIndexName$
       SELECT FIRST FILE "KVERTRAG" INDEX KVIndex$$
       GOTO vsuch2304200311
     ELSE 
       suchanzahl% = 3
     END IF 
   END IF 
   IF suchanzahl% = 2 AND tVSNR$ <> "*" THEN 
     REM CALL Fehler("","")
     suchanzahl% = 3
     REM REQUEST "Kein Vertrag gefunden!","Erweiterte Suche durchfÅhren (Durchlauf 2)?",130,req%
     req% = 1
     IF req% = 1 THEN 
       durchlauf$ = "2"
       IF KVIndex$ LIKE "QNumVSNR.kvertrag" THEN 
         KVIndexName$ = "QuickVSNR.kvertrag"
         tVSNR$ = VSNRPack$(VSNR$) + "*"
       ELSE 
         KVIndexName$ = "QNumVSNR.kvertrag"
         tVSNR$ = VSNRPackNum$(VSNR$) + "*"
       END IF 
       KVIndex$ = KVIndexName$
       SELECT FIRST FILE "KVERTRAG" INDEX KVIndex$$
       GOTO vsuch2304200312
     END IF 
   END IF 
   REM CALL Fehler(nachname.afskimp, STR$ (a%))
   IF a% = 0 AND tVSNR$ <> "*" THEN 
     VSNR$ = eingab2$
     tVSNR$ = VSNRPack$(VSNR$)
     IF LEN (tVSNR$) > 1 THEN 
       INDEX QAntragsNr.KVERTRAG
       SELECT FIRST FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
       SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
     ELSE 
       SELECT LAST FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
     END IF 
     q$ = QAntragsNr.KVERTRAG
     leng% = LEN (tVSNR$)

    CALL Server("LISTBOXINIT","Vertragsauswahl")
    CALL Gauge(1,"Adre·datei wird durchsucht...")
    CALL Server("GAUGEENABLECANCEL","")
    _prozt% = 0
    _proz2% = 0
    _anz% = z%
 
     locktest% = MNdisabled%("DATALOCK")
     WHILE QAntragsNr.KVERTRAG = tVSNR$ AND NOT EOF ("kvertrag") AND tVSNR$ <> "" AND ServerReply$() <> "CANCEL"

       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
 
       SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
       SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
       MOUSE OFF 
       IF GASP% THEN 
         IF Workstation% = 0 THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           REM locktest% = MNdisabled%("DATALOCK")
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
           END IF 
           IF ma% > 0 THEN 
             IF codema.kvertrag <> ma% THEN sok% = 0
           END IF 
           IF ge% > 0 THEN 
             IF codege.kvertrag <> ge% THEN sok% = 0
           END IF 
           IF spa% > 0 THEN 
             IF codeva.kvertrag <> spa% THEN sok% = 0
           END IF 
           IF cvp% > 0 THEN 
             IF codevp.kvertrag <> cvp% THEN sok% = 0
           END IF 
           IF eingbei% > 0 THEN 
             IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
           END IF 
           IF vone$ = "01.01.0001" THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           ELSE 
             IF DAYS (vone$) > 0 THEN 
               IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
             END IF 
             IF DAYS (bise$) > 0 THEN 
               IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
             G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
             IF NOT MNdisabled%("SEEEINGBEI") THEN 
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
             IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
             IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
             IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             REM locktest% = MNdisabled%("DATALOCK")
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF locktest% THEN 
               IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             END IF 
             IF ma% > 0 THEN 
               IF codema.kvertrag <> ma% THEN sok% = 0
             END IF 
             IF ge% > 0 THEN 
               IF codege.kvertrag <> ge% THEN sok% = 0
             END IF 
             IF spa% > 0 THEN 
               IF codeva.kvertrag <> spa% THEN sok% = 0
             END IF 
             IF cvp% > 0 THEN 
               IF codevp.kvertrag <> cvp% THEN sok% = 0
             END IF 
 
             IF eingbei% > 0 THEN 
               IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
             END IF 
             IF vone$ = "01.01.0001" THEN 
               IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
             ELSE 
               IF DAYS (vone$) > 0 THEN 
                 IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
               END IF 
               IF DAYS (bise$) > 0 THEN 
                 IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
               END IF 
             END IF 
             IF sok% THEN 
               erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
               G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
 
               IF NOT MNdisabled%("SEEEINGBEI") THEN 
                 IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                   G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
                 END IF 
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         REM locktest% = MNdisabled%("DATALOCK")
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF locktest% THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF vone$ = "01.01.0001" THEN 
           IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
         ELSE 
           IF DAYS (vone$) > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
           IF DAYS (bise$) > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           erfd$ = DATE$ (erfasdatum.kvertrag,"0d.mm.yyyy")
           G1Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,30) + CHR$ (9) + "  " + von$ + " - " + bis$ + " - " + erfd$ + SPACE$ (6) + name$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           tmpZeile$ = G1Vertraege$(a%)
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
       CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
       CALL Server("LISTBOXADD",tmpZeile$)
       SELECT NEXT FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
     WEND 
     CALL Gauge(0,"")
   END IF 
   IF GAFSK$ LIKE "TRUE" THEN 
     IF GIgnoreMultiVT% = - 1 THEN 
       IF a% > 1 THEN a% = 0
     END IF 
   END IF 
   IF a% = 0 THEN 
     GetVertrADR% = 0
     cuvt% = 0
   ELSE 
     
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%

         CREATE DIALOG "ZEINLIST",0,0,570,348,title$,"Courier New",9
         ADD DIALOG "ZEINLIST",4,0,0,570,332,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,168,20,0,"Bitte wÑhlen Sie den Vertrag aus, fÅr den diese Zahlung gilt."
         ADD DIALOG "ZEINLIST",5,35,58,400,10,0,"Vertrags-/Policennummer      von         bis       erfasst              Kunde"
         ADD DIALOG "ZEINLIST",7,5,68,555,255,2 + 128,1,G1Vertraege$,Auswahl$,prompt$
         
         ADD DIALOG "ZEINLIST",1,228,332,55,15,1,"Info",2,1
         ADD DIALOG "ZEINLIST",1,173,332,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,283,332,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"


         GOTO w050820061

         CREATE DIALOG "ZEINLIST",0,0,441,298,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,441,272,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,3,58,230,10,0,"Vertrags-/Policennummer              von              bis            erfasst"
         ADD DIALOG "ZEINLIST",7,3,68,430,205,2 + 128,2,G1Vertraege$,Auswahl$,prompt$
         IF MAKLER$ <> "TRUE" THEN 
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Abbrechen",0,0
         ELSE 
           REM ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&Kontoinfo",3,1
           REM ADD DIALOG "ZEINLIST",1,205,278,55,15,1,"&OK",1,1
           REM ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Info",2,1
           REM ADD DIALOG "ZEINLIST",1,315,278,55,15,0,"&Abbrechen",0,0
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Abbrechen",0,0
         END IF 
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"

w050820061: 

         SELECT CASE req%
         CASE 1,3
           GetVertrADR% = VAL ( RIGHT$ (Auswahl$(0),6))
           GPrompt$ = Auswahl$(0)
           lok% = 0
           IF req% = 3 THEN 
             kontoinf% = GetVertrADR%
           ELSE 
             kontoinf% = 0
           END IF 
         CASE 0
           GetVertrADR% = 0
           cuvt% = GetVertrADR%
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GetVertrADR% = VAL ( RIGHT$ (G1Vertraege$(0),6))
       cuvt% = GetVertrADR%
     END IF 
   END IF 
   FILE "KVERTRAG"
   IF cuvt% > 0 THEN SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GetVertrADR% = 0
 END IF 
 END FUNCTION 


 REM ******************************************************************************








 
 REM andi 26.10.95
FUNCTION GetVerab%(lfdnr%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   INDEX QuickVSNR.KVERTRAG
   SELECT FIRST 
   tVSNR$ = VSNRPack$(VSNR$)
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QuickVSNR.KVERTRAG
   a% = 0
   WHILE QuickVSNR.KVERTRAG LIKE tVSNR$ + "*"
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF codeku.kvertrag = codeku% THEN 
       sok% = - 1
       IF GMASuperCount% > 0 THEN 
         IF IsMASuper%(codema.KVERTRAG) THEN 
         ELSE 
           sok% = 0
         END IF 
       END IF 
       IF sok% THEN 
         Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + STR$ (lfdnr.KVERTRAG,"000000")
         IF a% = 0 THEN prompt$ = Vertraege$(0)
         a% = a% + 1
       END IF 
     END IF 
     SELECT NEXT 
   WEND 
   IF a% = 0 THEN 
     GetVerab% = 0
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,251,198,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,251,172,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Vertrags-/Policennummer                       von          bis"
         ADD DIALOG "ZEINLIST",7,36,68,205,105,2 + 128,2,Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,36,178,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,96,178,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,156,178,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GetVerab% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GetVerab% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GetVerab% = VAL ( RIGHT$ (Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GetVerab% = 0
 END IF 
 END FUNCTION 
 
FUNCTION GETKFZKe%(lfdnr%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 locktest% = MNdisabled%("DATALOCK")
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   IF viab% = 0 THEN 
     INDEX codeku.KVERTRAG
     SELECT FIRST 
     tVSNR$ = VSNRPack$(VSNR$)
     SELECT KEY codeku% FILE "KVERTRAG" INDEX codeku.KVERTRAG
     a% = 0
     WHILE codeku.KVERTRAG = codeku% AND NOT EOF ("kvertrag")
       MOUSE OFF 
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF locktest% THEN 
               SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
               SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
               IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
               IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
             END IF 
             IF sok% THEN 
               Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (20) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
             IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
             IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
               sok% = - 1
               IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.KVERTRAG) THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF locktest% THEN 
                 SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
                 SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
                 IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
                 IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
               END IF 
               IF sok% THEN 
                 Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (20) + STR$ (lfdnr.KVERTRAG,"000000")
                 IF a% = 0 THEN prompt$ = Vertraege$(0)
                 a% = a% + 1
               END IF 
             END IF 
           END IF 
         END IF 
       ELSE 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
             SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (20) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
       SELECT NEXT FILE "KVERTRAG"
     WEND 
   ELSE 
     INDEX QuickKennz.KVERTRAG
     SELECT FIRST 
     tVSNR$ = VSNRPack$(VSNR$)
     SELECT KEY tvsnr$ FILE "KVERTRAG" INDEX QuickKennz.KVERTRAG
     a% = 0
     WHILE QuickKennz.KVERTRAG LIKE tvsnr$ + "*" AND NOT EOF ("kvertrag")
       MOUSE OFF 
       SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
       SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
       IF GASP% THEN 
         IF workstation% = 0 THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             REM locktest% = MNdisabled%("DATALOCK")
             IF locktest% THEN 
               SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
               SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
               IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
               IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
             END IF 
             IF sok% THEN 
               Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (20) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
            END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
             IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
             IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
               sok% = - 1
               IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.KVERTRAG) THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               REM locktest% = MNdisabled%("DATALOCK")
               IF locktest% THEN 
                 SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
                 SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
                 IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
                 IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
               END IF 
               IF sok% THEN 
                 Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (20) + STR$ (lfdnr.KVERTRAG,"000000")
                 IF a% = 0 THEN prompt$ = Vertraege$(0)
                 a% = a% + 1
               END IF 
              END IF 
           END IF 
         END IF 
       ELSE 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
             SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (20) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
       SELECT NEXT FILE "KVERTRAG"
     WEND 
   END IF 
   IF a% = 0 THEN 
     GETKFZKe% = 0
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,251,198,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,251,172,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem oder Ñhnlichem Kennzeichen gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Kennzeichen/Fabrikat                       von          bis"
         ADD DIALOG "ZEINLIST",7,36,68,205,105,2 + 128,2,Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,36,178,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,96,178,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,156,178,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETKFZKe% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETKFZKe% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETKFZKe% = VAL ( RIGHT$ (Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETKFZKe% = 0
 END IF 
 END FUNCTION 
 
 
FUNCTION GETKFZTyp%(lfdnr%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 locktest% = MNdisabled%("DATALOCK")
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   INDEX CodeKU.KVERTRAG
   SELECT FIRST 
   tVSNR$ = VSNRPack$(VSNR$)
   IF viab% = 0 THEN SELECT KEY codeku% FILE "KVERTRAG" INDEX codeku.KVERTRAG
   a% = 0
   WHILE codeku.KVERTRAG = codeku% AND NOT EOF ("kvertrag") AND viab% = 0
     MOUSE OFF 
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF Fabrikat.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
             SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (120) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF Fabrikat.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF locktest% THEN 
               SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
               SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
               IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
               IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
             END IF 
             IF sok% THEN 
               Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (120) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF Fabrikat.kvertrag LIKE tvsnr$ + "*" THEN 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF locktest% THEN 
           SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
           SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
           IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
         END IF 
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (120) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END SUB 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
   WHILE NOT EOF ("kvertrag") AND viab% <> 0
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     MOUSE OFF 
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF Fabrikat.kvertrag LIKE tvsnr$ + "*" OR Fabrikat.kvertrag LIKE "*" + tvsnr$ + "*" THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (120) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF Fabrikat.kvertrag LIKE tvsnr$ + "*" OR Fabrikat.kvertrag LIKE "*" + tvsnr$ + "*" THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
               IF locktest% THEN 
                 IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
                 IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
               END IF 
             IF sok% THEN 
               Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (120) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF Fabrikat.kvertrag LIKE tvsnr$ + "*" OR Fabrikat.kvertrag LIKE "*" + tvsnr$ + "*" THEN 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
               locktest% = MNdisabled%("DATALOCK")
               IF locktest% THEN 
                 IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
                 IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
               END IF 
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$ + SPACE$ (120) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
   IF a% = 0 THEN 
     GETKFZTyp% = 0
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,351,298,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,351,272,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem oder Ñhnlichen Namen gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Kennzeichen/Fabrikat                       von          bis"
         ADD DIALOG "ZEINLIST",7,36,68,305,205,2 + 128,2,Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,86,278,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,146,278,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,206,278,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETKFZTyp% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETKFZTyp% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETKFZTyp% = VAL ( RIGHT$ (Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETKFZTyp% = 0
 END IF 
 END FUNCTION 
 
 
 
 
 
FUNCTION GETTarifInfo%(lfdnr%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 locktest% = MNdisabled%("DATALOCK")
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 4000 THEN 
     DIM Vertraege$(24000)
   ELSE 
     c% = RECCOUNT ("KVERTRAG")
     DIM Vertraege$(c%)
   END IF 
   a% = 0
   DIM Auswahl$(1)
   tVSNR$ = VSNRPack$(VSNR$)
   INDEX QTarif.KVERTRAG
   SELECT FIRST 
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX Qtarif.KVERTRAG
   WHILE QTarif.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF Qtarif.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (tarif.kvertrag) + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF Qtarif.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (tarif.kvertrag) + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF Qtarif.kvertrag LIKE tvsnr$ + "*" THEN 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (tarif.kvertrag) + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 
  
   IF a% = 0 THEN 
     GETRisiko% = 0
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,291,198,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,291,172,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem Risiko/Person gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,""
         ADD DIALOG "ZEINLIST",7,6,55,280,115,2 + 128,2,Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,56,178,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,116,178,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,156,178,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETTarifInfo% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETTarifInfo% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETTarifInfo% = VAL ( RIGHT$ (Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETTarifInfo% = 0
 END IF 
 END FUNCTION 
  
 
 
 
 
 
 
 
 
 
FUNCTION GETRisiko%(lfdnr%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 locktest% = MNdisabled%("DATALOCK")
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 4000 THEN 
     DIM Vertraege$(24000)
   ELSE 
     c% = RECCOUNT ("KVERTRAG") * 6
     DIM Vertraege$(c%)
   END IF 
   a% = 0
   DIM Auswahl$(1)
   tVSNR$ = VSNRPack$(VSNR$)
   INDEX QzvP1Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP1Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP1Name.KVERTRAG
   WHILE QzvP1Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QzvP1Name.kvertrag LIKE tvsnr$ + "*" THEN 
           g$ = ""
           IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QzvP1Name.kvertrag LIKE tvsnr$ + "*" THEN 
             g$ = ""
             IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
             ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF QzvP1Name.kvertrag LIKE tvsnr$ + "*" THEN 
         g$ = ""
         IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
         ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 
   INDEX QzvP2Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP2Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP2Name.KVERTRAG
   WHILE QzvP2Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF gasp% THEN 
       IF Workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QzvP2Name.kvertrag LIKE tvsnr$ + "*" THEN 
           g$ = ""
           IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QzvP2Name.kvertrag LIKE tvsnr$ + "*" THEN 
             g$ = ""
             IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
             ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF QzvP2Name.kvertrag LIKE tvsnr$ + "*" THEN 
         g$ = ""
         IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
         ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 
   INDEX QzvP3Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP3Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP3Name.KVERTRAG
   WHILE QzvP3Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP3Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP3Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP3Geb.kvertrag,"0d.mm.yyyy")
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 
   INDEX QzvP4Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP4Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP4Name.KVERTRAG
   WHILE QzvP4Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP4Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP4Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP4Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 
   INDEX QzvP5Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP5Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP5Name.KVERTRAG
   WHILE QzvP5Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP5Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP5Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP5Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
          IF workstation% = 0 THEN 
            sok% = - 1
            IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
            IF GMASuperCount% > 0 THEN 
              IF IsMASuper%(codema.KVERTRAG) THEN 
              ELSE 
                sok% = 0
              END IF 
            END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
            IF sok% THEN 
              Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
              IF a% = 0 THEN prompt$ = Vertraege$(0)
              a% = a% + 1
            END IF 
          ELSE 
            IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
              sok% = - 1
              IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
              IF GMASuperCount% > 0 THEN 
                IF IsMASuper%(codema.KVERTRAG) THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
              IF sok% THEN 
                Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
                IF a% = 0 THEN prompt$ = Vertraege$(0)
                a% = a% + 1
              END IF 
            END IF 
          END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 
   INDEX QzvP6Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP6Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP6Name.KVERTRAG
   WHILE QzvP6Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP6Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP6Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP6Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 



   INDEX QzvP1vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP1vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP1vName.KVERTRAG
   WHILE QzvP1vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
          SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP1vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
 
   INDEX QzvP2vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP2vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP2vName.KVERTRAG
   WHILE QzvP2vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP2vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
   WEND 
 
   INDEX QzvP3vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP3vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP3vName.KVERTRAG
   WHILE QzvP3vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP3vName.kvertrag LIKE tvsnr$ + "*" THEN 
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       g$ = ""
       IF zvP3Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP3Geb.kvertrag,"0d.mm.yyyy")
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
   WEND 
 
   INDEX QzvP4vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP4vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP4vName.KVERTRAG
   WHILE QzvP4vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP4vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP4Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP4Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
   WEND 
 
   INDEX QzvP5vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP5vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP5vName.KVERTRAG
   WHILE QzvP5vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP5vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP5Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP5Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
   WEND 
 
   INDEX QzvP6vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP6vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP6vName.KVERTRAG
   WHILE QzvP6vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP6vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP6Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP6Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF sok% THEN 
             Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
         IF sok% THEN 
           Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
   WEND 
 




anfsu220920021: 
   IF a% = 0 THEN 
     GETRisiko% = 0
     REQUEST "Es wurde kein Vertrag gefunden?","Wollen Sie die ausfÅhrliche Suche starten?",130,reqsu%
     IF reqsu% = 1 THEN 
       INDEX QzvP1Name.KVERTRAG
       SELECT FIRST FILE "KVERTRAG" INDEX QzvP1Name.KVERTRAG
       WHILE NOT EOF ("KVERTRAG")
         MOUSE OFF 
         SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
         SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
         ok% = 0
         IF QzvP1Name.kvertrag LIKE tVSNR$ + "*" OR QzvP1Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP1vName.kvertrag LIKE tVSNR$ + "*" OR QzvP1vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwSu220920021
         END IF 
         IF QzvP2Name.kvertrag LIKE tVSNR$ + "*" OR QzvP2Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP2vName.kvertrag LIKE tVSNR$ + "*" OR QzvP2vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           ok% = - 1
           IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
            IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwSu220920021
         END IF 
         IF QzvP3Name.kvertrag LIKE tVSNR$ + "*" OR QzvP3Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP3vName.kvertrag LIKE tVSNR$ + "*" OR QzvP3vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP3Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP3Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwSu220920021
         END IF 
         IF QzvP4Name.kvertrag LIKE tVSNR$ + "*" OR QzvP4Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP4vName.kvertrag LIKE tVSNR$ + "*" OR QzvP4vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP4Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP4Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwSu220920021
         END IF 
         IF QzvP5Name.kvertrag LIKE tVSNR$ + "*" OR QzvP5Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP5vName.kvertrag LIKE tVSNR$ + "*" OR QzvP5vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP5Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP5Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwSu220920021
         END IF 
         IF QzvP6Name.kvertrag LIKE tVSNR$ + "*" OR QzvP6Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP6vName.kvertrag LIKE tVSNR$ + "*" OR QzvP6vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP6Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP6Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwSu220920021
         END IF 
erwSu220920021: 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           locktest% = MNdisabled%("DATALOCK")
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             IF FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           END IF 
           IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
         IF ok% = - 1 THEN 
           IF sok% THEN a% = a% + 1
         END IF 
         SELECT NEXT FILE "KVERTRAG"
       WEND 
       IF a% > 0 THEN GOTO anfsu220920021
     END IF 
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,391,198,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,391,172,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem Risiko/Person gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,""
         ADD DIALOG "ZEINLIST",7,6,55,380,115,2 + 128,2,Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,56,178,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,156,178,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,216,178,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETRisiko% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETRisiko% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETRisiko% = VAL ( RIGHT$ (Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETRisiko% = 0
 END IF 
 END FUNCTION 
 


FUNCTION GetGesKukto%()
   MOUSE OFF 
   a% = RECCOUNT ("kukto")
   REDIM GKukto$( RECCOUNT ("kukto") + 5)
   GKukto$( RECCOUNT ("kukto") + 5) = ""
   IF a% < 1 THEN END SUB 
   DIM Waehrung$(a%,1)
   DIM Waehrung%(a%,1)
   REDIM Waehrung$(a%)
   REDIM Waehrung%(a%)
   FILE "kukto"
   INDEX codege.kukto
   SELECT WHERE 
   SELECT FIRST 
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   codegeold% = - 1
   GetGesKukto% = 0
   WHILE NOT EOF ("kukto")
     IF codege.kukto > 0 AND codege.kukto <> codegeold% THEN 
       codege% = codege.kukto
       codegeold% = codege.kukto
       j% = - 1
         a% = a% + 1
         Waehrung%(a%) = codege%
         Waehrung$(a%) = Gesellschaft.kukto + SPACE$ (90) + STR$ (codege%,"000000")
       REM END IF 
     END IF 
     SELECT NEXT FILE "kukto" INDEX codege.kukto
   WEND 
   
   DIM Auswahl1$(1)
     FILE "kukto"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,204,"Gesellschaft","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,183,0," Auswahl Gesellschaft"
      ADD DIALOG "PREISLIS",7,5,12,169,175,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,185,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,185,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "kukto"
        GetGesKukto% = VAL ( RIGHT$ (Auswahl1$(0),6))
      END IF 
 MOUSE ON 
 REM SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 SELECT FORM FIRST 
 FORM 
 
 END FUNCTION 
 
 
  

  



 REM Zu versichernde Person-Daten
SUB ZVersPer(i%)
       opt% = 2
       CREATE DIALOG "ADRLIST",0,0,192,98,"WÑhlen Sie eine Option","MS Sans Serif",8
       ADD DIALOG "ADRLIST",9,4,9,20,21,2
       ADD DIALOG "ADRLIST",5,30,22,238,14,0,"WÑhlen Sie eine Option aus!"
       IF ag$ <> "j" THEN 
         ADD DIALOG "ADRLIST",3,30,40,234,10,0,"Neue Person zuweisen",1,opt%
       END IF 
       ADD DIALOG "ADRLIST",3,30,60,234,10,0,"Daten anzeigen",2,opt%
       ADD DIALOG "ADRLIST",1,49,80,51,14,1,"&Weiter",1,1
       ADD DIALOG "ADRLIST",1,102,80,51,14,0,"&Abbruch",0,0
       DIALOG "ADRLIST",req%
       REMOVE DIALOG "ADRLIST"
       IF req% = 1 THEN 
         IF opt% = 1 THEN 
           CALL VertrZVP(i%,lfdnr.kvertrag,codeku.kvertrag)
         ELSE 
           CALL ZVPBerarb(i%,lfdnr.kvertrag,codeku.kvertrag)
         END IF 
       END IF 
 END SUB 
 
 
 REM ************************************************************************************************************
 REM *    zu versichernde Person in dem Vertrag eintragen                                                       *
 REM *    AB 11.08.2001                                                                                         *
 REM *    nr% - Feldnr der zu versichernden Person 1-6                                                          *
 REM *    lfdnr% - laufende Nr des Vertrages                                                                    *
 REM *    codeku% - codeku der Adresse                                                                          *
 REM ************************************************************************************************************
 
SUB ZVPBerarb(nr%,lfdnr%,codeku%)
         SELECT CASE nr%
           CASE 1
             feldName$ = zvP1Name.kvertrag
             feldvorName$ = zvP1vName.kvertrag
             feldort$ = zvP1ort.kvertrag
             feldplz$ = zvP1plz.kvertrag
             feldstrasse$ = zvP1strasse.kvertrag
             IF zvP1Geb.kvertrag > 0 THEN feldGeb$ = DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
             REM feldgebo$ = GebortP1.kvertrag
           CASE 2
             feldName$ = zvP2Name.kvertrag
             feldName$ = zvP2Name.kvertrag
             feldvorName$ = zvP2vName.kvertrag
             feldort$ = zvP2ort.kvertrag
             feldplz$ = zvP2plz.kvertrag
             feldstrasse$ = zvP2strasse.kvertrag
             IF zvP2Geb.kvertrag > 0 THEN feldGeb$ = DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
             REM feldgebo$ = GebortP2.kvertrag
           CASE 3
             feldName$ = zvP3Name.kvertrag
             feldName$ = zvP3Name.kvertrag
             feldvorName$ = zvP3vName.kvertrag
             feldort$ = zvP3ort.kvertrag
             feldplz$ = zvP3plz.kvertrag
             feldstrasse$ = zvP3strasse.kvertrag
             IF zvP3Geb.kvertrag > 0 THEN feldGeb$ = DATE$ (zvP3Geb.kvertrag,"0d.mm.yyyy")
             REM feldgebo$ = GebortP3.kvertrag
           CASE 4
             feldName$ = zvP4Name.kvertrag
             feldName$ = zvP4Name.kvertrag
             feldvorName$ = zvP4vName.kvertrag
             feldort$ = zvP4ort.kvertrag
             feldplz$ = zvP4plz.kvertrag
             feldstrasse$ = zvP4strasse.kvertrag
             IF zvP4Geb.kvertrag > 0 THEN feldGeb$ = DATE$ (zvP4Geb.kvertrag,"0d.mm.yyyy")
             REM feldgebo$ = GebortP4.kvertrag
           CASE 5
             feldName$ = zvP5Name.kvertrag
             feldName$ = zvP5Name.kvertrag
             feldvorName$ = zvP5vName.kvertrag
             feldort$ = zvP5ort.kvertrag
             feldplz$ = zvP5plz.kvertrag
             feldstrasse$ = zvP5strasse.kvertrag
             IF zvP5Geb.kvertrag > 0 THEN feldGeb$ = DATE$ (zvP5Geb.kvertrag,"0d.mm.yyyy")
             REM feldgebo$ = GebortP5.kvertrag
           CASE 6
             feldName$ = zvP6Name.kvertrag
             feldName$ = zvP6Name.kvertrag
             feldvorName$ = zvP6vName.kvertrag
             feldort$ = zvP6ort.kvertrag
             feldplz$ = zvP6plz.kvertrag
             feldstrasse$ = zvP6strasse.kvertrag
             IF zvP6Geb.kvertrag > 0 THEN feldGeb$ = DATE$ (zvP6Geb.kvertrag,"0d.mm.yyyy")
             REM feldgebo$ = GebortP6.kvertrag
         END SELECT 
         nr$ = LTRIM$ ( STR$ (nr%,"9"))
        DIM dlg AS Dialog
        DIM control AS DialogControl
        GOTO ZVPBerarb190120022
ZVPBerarb190120021: 
        CALL Fehler("Bei der Speicherung Ihrer Daten ist ein Fehler aufgetreten!","Bitte prÅfen Sie das Geburtstagsfeld auf korrekte Eingabe!")
ZVPBerarb190120022: 
        Superbase.Dialogs.Add("Dialogname")
        SET dlg = Superbase.Dialogs.Dialogname
        dlg.Move(0,0,255,159)
        dlg.Caption = "Bearbeitung zu versichernde Person " + nr$
        dlg.FontName = "MS Sans Serif"
        dlg.FontSize = 8
 
        SET control = dlg.Add("DialogFrame1","DialogFrame")
        control.Move(0,0,255,138)
        control.Caption = ""
 
        SET control = dlg.Add("DialogLabel1","DialogLabel")
        control.Move(33,14,186,22)
        control.Caption = "Bitte fÅllen Sie die nachfolgenden Felder zur versicherten Person " + nr$ + " aus:"
 
        SET control = dlg.Add("DialogLabel2","DialogLabel")
        control.Move(33,40,29,9)
        control.Caption = "Vorname"
 
        SET control = dlg.Add("DialogTextBox1","DialogTextBox")
        control.Move(74,40,158,11)
        control.MaxLength = 50
        control.TextBinding = "feldvorname$"
 
        SET control = dlg.Add("DialogTextBox2","DialogTextBox")
        control.Move(74,52,158,11)
        control.MaxLength = 50
        control.TextBinding = "feldname$"
 
        SET control = dlg.Add("DialogLabel7","DialogLabel")
        control.Move(33,53,36,10)
        control.Caption = "Nachname"
 
        SET control = dlg.Add("DialogTextBox3","DialogTextBox")
        control.Move(74,65,44,11)
        control.MaxLength = 10
        control.TextBinding = "feldplz$"
 
        SET control = dlg.Add("DialogLabel9","DialogLabel")
        control.Move(33,67,36,10)
        control.Caption = "PLZ"
 
        SET control = dlg.Add("DialogTextBox4","DialogTextBox")
        control.Move(74,80,158,11)
        control.MaxLength = 50
        control.TextBinding = "feldort$"
 
        SET control = dlg.Add("DialogLabel11","DialogLabel")
        control.Move(33,82,36,10)
        control.Caption = "Ort"
 
        SET control = dlg.Add("DialogLabel13","DialogLabel")
        control.Move(33,97,36,10)
        control.Caption = "Strasse"
 
        SET control = dlg.Add("DialogTextBox5","DialogTextBox")
        control.Move(74,97,158,11)
        control.MaxLength = 50
        control.TextBinding = "feldstrasse$"
 
        SET control = dlg.Add("DialogTextBox6","DialogTextBox")
        control.Move(74,110,44,11)
        control.MaxLength = 10
        control.TextBinding = "feldgeb$"
 
        SET control = dlg.Add("DialogLabel15","DialogLabel")
        control.Move(33,112,36,9)
        control.Caption = "Geburtstag"

 
        REM SET control = dlg.Add("DialogTextBox7","DialogTextBox")
        REM control.Move(74,120,158,11)
        REM control.MaxLength = 50
        REM control.TextBinding = "feldgebo$"
 
        REM SET control = dlg.Add("DialogLabel16","DialogLabel")
        REM control.Move(33,122,36,9)
        REM control.Caption = "Geb.-Ort"
 



        SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
        control.Move(69,140,55,15)
        control.Default = 1
        control.Caption = "&OK"
        control.ReturnValue = 1
 
        SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
        control.Move(127,140,54,15)
        control.Caption = "&Abbrechen"
        control.ReturnValue = 0
        control.Cancel = 1
  
        DIALOG "Dialogname",req3%
        MOUSE ON 
        REMOVE DIALOG "Dialogname"
 
 
       IF req3% = 1 THEN 
         ON ERROR GOTO ZVPBerarb190120021
         IF DateOK%(feldGeb$) THEN 
         ELSE 
           GOTO ZVPBerarb190120021
         END IF 
         SELECT KEY lfdnr% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
         SELECT CASE nr%
           CASE 1
             zvP1Name.kvertrag = feldName$
             zvP1vName.kvertrag = feldVorName$
             zvP1ort.kvertrag = feldort$
             zvP1plz.kvertrag = feldplz$
             zvP1strasse.kvertrag = feldstrasse$
             zvP1Geb.kvertrag = feldGeb$
             REM GebortP1.kvertrag = feldgebo$
           CASE 2
             zvP2Name.kvertrag = feldName$
             zvP2vName.kvertrag = feldVorName$
             zvP2ort.kvertrag = feldort$
             zvP2plz.kvertrag = feldplz$
             zvP2strasse.kvertrag = feldstrasse$
             zvP2Geb.kvertrag = feldGeb$
             REM GebortP2.kvertrag = feldgebo$
           CASE 3
             zvP3Name.kvertrag = feldName$
             zvP3vName.kvertrag = feldVorName$
             zvP3ort.kvertrag = feldort$
             zvP3plz.kvertrag = feldplz$
             zvP3strasse.kvertrag = feldstrasse$
             zvP3Geb.kvertrag = feldGeb$
             REM GebortP3.kvertrag = feldgebo$
           CASE 4
             zvP4Name.kvertrag = feldName$
             zvP4vName.kvertrag = feldVorName$
             zvP4ort.kvertrag = feldort$
             zvP4plz.kvertrag = feldplz$
             zvP4strasse.kvertrag = feldstrasse$
             zvP4Geb.kvertrag = feldGeb$
             REM GebortP4.kvertrag = feldgebo$
           CASE 5
             zvP5Name.kvertrag = feldName$
             zvP5vName.kvertrag = feldVorName$
             zvP5ort.kvertrag = feldort$
             zvP5plz.kvertrag = feldplz$
             zvP5strasse.kvertrag = feldstrasse$
             zvP5Geb.kvertrag = feldGeb$
             REM GebortP5.kvertrag = feldgebo$
           CASE 6
             zvP6Name.kvertrag = feldName$
             zvP6vName.kvertrag = feldVorName$
             zvP6ort.kvertrag = feldort$
             zvP6plz.kvertrag = feldplz$
             zvP6strasse.kvertrag = feldstrasse$
             zvP6Geb.kvertrag = feldGeb$
             REM GebortP6.kvertrag = feldgebo$
         END SELECT 
         CALL QuickStore("KVERTRAG")
       END IF 
       ON ERROR GOTO ErrorHandler
 END SUB 
 
 
 
 
 
  REM *******************************************************
  REM ***** Berechnung Fonds fÅr Kvertrag *******************
  REM *******************************************************
SUB RechKvertrag(lf%)
 
  MOUSE OFF 
  SET STATUS "Aktualisierung der Fondsberechnungen"
  FILE "Fonds"
  IF NOT EXISTS (lf%,codevt.fonds) THEN GOTO endfober270320011
  REM INDEX codevt.fonds
  INDEX QuickvtBerDat.fonds
 
  SELECT FIRST FILE "Fonds" INDEX QuickvtBerDat.fonds
  lfsuch$ = STR$ (lf%,"000000")
  SELECT KEY lfsuch$ FILE "Fonds" INDEX QuickvtBerDat.fonds
  aerster$ = QuickvtBerDat.fonds
  REM CALL Fehler(aerster$,lfsuch$)
  WHILE NOT EOF ("Fonds") AND codevt.fonds = lf%
    berdat% = BKursTag.fonds
    berzeit% = BkursZeit.fonds
    bantw% = BAntPreisinWaeh.fonds
    bantdm% = BAntPreisinDM.fonds
    bantUS% = BAntPreisinUS.fonds
    bantEuro% = BAntPreisinEuro.fonds
    bkursus% = BKursUS.fonds
    BKursEuro% = Bkurseuro.fonds
    brÅckwaehr% = BRÅckkaufWaehr.fonds
    brÅckDM% = BRÅckkaufDM.fonds
    brÅckUS% = BRÅckkaufUS.fonds
    brÅckEuro% = BRÅckkaufEuro.fonds
    testlf$ = STR$ (lf%,"000000") + DATE$ (berdat%,"yyyymm0d")
    QuickVTBerDat% = VAL ( DATE$ (BKursTag.fonds,"yyyymm0d") + LEFT$ ( TIME$ (BKursZeit.fonds,"hh:mm:ss"),2) + MID$ ( TIME$ (BKursZeit.fonds,"hh:mm:ss"),4,2) + RIGHT$ ( TIME$ (BKursZeit.fonds,"hh:mm:ss"),2))
    SELECT NEXT FILE "Fonds" INDEX QuickvtBerDat.fonds
 WEND 
 IF CodeTarif.kvertrag > 0 THEN 
   SELECT FIRST FILE "tarif" INDEX codetarif.tarif
   SELECT KEY CodeTarif.kvertrag FILE "tarif" INDEX codetarif.tarif
   d1$ = DATE$ (BKursTag.TARIF,"yyyymm0d") + LTRIM$ ( LEFT$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),2) + MID$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),4,2) + RIGHT$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),2))
   IF BKursTag.TARIF >= berdat% THEN 
     IF BKursTag.TARIF = berdat% THEN 
       IF BkursZeit.tarif >= berzeit% THEN 
         ok% = 1
       ELSE 
         ok% = 0
       END IF 
     ELSE 
       ok% = 1
     END IF 
   END IF 
   IF ok% = 0 THEN 
     ok% = 0
     FILE "TARIF"
     SELECT FIRST FILE "tarif" INDEX codetarif.tarif
     SELECT KEY CodeTarif.kvertrag LOCK FILE "tarif" INDEX codetarif.tarif
     BKursTag.tarif = berdat%
     BkursZeit.tarif = berzeit%
     BAntPreisinWaeh.tarif = bantw%
     BKursEuro.tarif = BKursEuro%
     BKursUS.tarif = BKursUS%
     BRÅckkaufWaehr.tarif = brÅckwaehr%
     QuickVTBerDat.tarif = DATE$ (BKursTag.TARIF,"yyyymm0d") + LTRIM$ ( LEFT$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),2) + MID$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),4,2) + RIGHT$ ( TIME$ (BKursZeit.TARIF,"hh:mm:ss"),2))
     STORE FILE "TARIF"
     UNLOCK CURRENT FILE "TARIF"
     ixkuktoz% = FILEINFO ("Tarif",1)
     DIM ixkukto$(ixkuktoz%)
     FILLARRAY ixkukto$,1
     BLANK FILE "KURSHIST"
     REM FOR j% = 0 TO ixkuktoz% - 1
       REM feld1$ = ixkukto$(j%) + ".KURSHIST"
       REM feld2$ = ixkukto$(j%) + ".TARIF"
       REM IF feld1$ LIKE "AGSperre*" OR feld2$ LIKE "AGSperre*" OR feld1$ LIKE "codevp" THEN 
       REM ELSE 
         REM feld1$$ = feld2$$
       REM END IF 
     REM NEXT j%
     a% = CopyRecord%("TARIF","KURSHIST")
     codetarifhist.kurshist = SER ("KURSHIST",1)
     STORE FILE "KURSHIST"
     UNLOCK CURRENT FILE "KURSHIST"
     FILE "fonds"
   END IF 
   IF ok% = 1 THEN 
     berdat% = BKursTag.tarif
     berzeit% = BkursZeit.tarif
     bantw% = BAntPreisinWaeh.tarif
     bkursus% = BKursUS.tarif
     BKursEuro% = Bkurseuro.tarif
     brÅckwaehr% = BRÅckkaufWaehr.tarif
     IF BKursEuro.tarif <> 0 THEN 
       banteuro% = BAntPreisinWaeh.tarif / BKursEuro.tarif
       BAntDM% = banteuro% * euro%
       brÅckeuro% = BRÅckkaufWaehr.tarif / BKursEuro.tarif
       brÅckDM% = brÅckeuro% * euro%
     END IF 
     IF BKursUS.tarif <> 0 THEN 
       BAntUS% = banteuro% * BKursUS.tarif
       brÅckus% = brÅckeuro% * BKursUS.tarif
     END IF 
   END IF 
  END IF 
  SELECT FIRST FILE "Fonds" INDEX QuickvtBerDat.fonds
  SELECT KEY lfsuch$ LOCK FILE "Fonds" INDEX QuickvtBerDat.fonds
  WHILE NOT EOF ("Fonds") AND codevt.fonds = lf%
      GBkursTag% = Bkurstag.fonds
      GBAntPreisinW% = BAntPreisinWaeh.fonds
      GBKursEuro% = BKursEuro.fonds
      GBKursUS% = BKursUS.fonds
      BKursTag.fonds = berdat%
      BAntPreisinWaeh.fonds = bantw%
      BAntPreisinDM.fonds = bantdm%
      BAntPreisinUS.fonds = bantus%
      BAntPreisinEuro.fonds = bantEuro%
      BKursUS.fonds = bkursus%
      Bkurseuro.fonds = bkurseuro%
      BkursZeit.fonds = berzeit%
      BRÅckkaufWaehr.fonds = brÅckwaehr%
      BRÅckkaufDM.fonds = brÅckDM%
      BRÅckkaufUS.fonds = brÅckUS%
      BRÅckkaufEuro.fonds = brÅckEuro%
      REM CALL Fehler("Berechnung","")
      fon% = codefo.fonds
      IF kauf.fonds <> "" THEN CALL AftAnteileFonds(1)
      SELECT NEXT LOCK FILE "Fonds" INDEX QuickvtBerDat.fonds
      REM IF EOF ("FONDS") THEN CALL Fehler("EOF","")
  WEND 
  summeEinzDM% = 0
  summeEinzUS% = 0
  summeEinzEur% = 0
  summeEinzWaehr% = 0
  summeAnteile% = 0
  summePreis% = 0
  INDEX codevt.fonds
  SELECT FIRST FILE "Fonds" INDEX codevt.fonds
  SELECT KEY lf% FILE "Fonds" INDEX codevt.fonds
  WHILE NOT EOF ("Fonds") AND codevt.fonds = lf%
    IF kauf.fonds <> "k" THEN 
      REM summeAnteile% = summeAnteile% + Anteile.fonds
      REM summeEinzDM% = summeEinzDM% + Preis.fonds
      REM summeEinzUS% = summeEinzUS% + PreisDollar.fonds
      REM summeEinzEur% = summeEinzEur% + PreisEuro.fonds
        summePreis% = summePreis% + Preis.fonds
        summeAnteile% = summeAnteile% + Anteile.fonds
        summeEinzWaehr% = summeEinzWaehr% + BAnlageWaehr.fonds
        summeEinzDM% = summeEinzDM% + BAnlageDM.fonds
        summeEinzUS% = summeEinzUS% + BAnlageUS.fonds
        summeEinzEur% = summeEinzEur% + BAnlageEuro.fonds
      END IF 
      REM CALL Fehler("Summe DM:" + STR$ (summeEinzDM%,",999999.00"),"BetragDM:" + STR$ (BAnlageDM.fonds,",999999.00"))
    END IF 
    SELECT NEXT FILE "Fonds" INDEX codevt.fonds
  WEND 
  FILE "kvertrag"
  SELECT KEY lf% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
  SummeAnteile.kvertrag = summeAnteile%
  summeEinzDM.kvertrag = summeEinzDM%
  summeEinzWaehr.kvertrag = summePreis%
  summeEinzUS.kvertrag = summeEinzUS%
  summeEinzEur.kvertrag = summeEinzEur%
  BDatumBerech.kvertrag = berdat%
  BAnteilsprWaehr.kvertrag = bantw%
  BAnteilsprUS.kvertrag = bantus%
  BAnteilsprdm.kvertrag = bantdm%
  BAnteilsprEuro.kvertrag = banteuro%
  BRÅckkaufWaehr.kvertrag = brÅckwaehr%
  BRÅckkaufDM.kvertrag = brÅckDM%
  BRÅckkaufUS.kvertrag = brÅckUS%
  BRÅckkaufEuro.kvertrag = brÅckEuro%
  BBestandWaehr.kvertrag = summeAnteile% * brÅckwaehr%
  BBestandUS.kvertrag = summeAnteile% * brÅckUS%
  BBestandDM.kvertrag = summeAnteile% * brÅckDM%
  BBestandEuro.kvertrag = summeAnteile% * brÅckEuro%
  REM CALL Fehler("","")
  CALL QuickStore("Kvertrag")
endfober270320011: 
  MOUSE ON 
  SET STATUS ""
 END SUB 
 




 REM *****************************************************************************************
 REM *                                                                                       *
 REM *              Erzeugung Inkasso/KuKto                                                  *
 REM *                                                                                       *
 REM****************************************************************************************** 
 
SUB Inkasso()
 IF disabled%("BUCHUNG") THEN END SUB 
 IF title$ LIKE "*Agentur*" THEN 
   CALL Fehler("Diese Funktion kann in der Agenturvariante nicht genutzt werden!","")
   END SUB 
 END IF 
 SET STATUS "Inkasso"
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF OPEN ("adrtemp") THEN 
   REM CLOSE FILE "ADRTEMP"
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"KGEADR" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"DTAUS" + _fpw$)
 CALL DFile(3,"BUCHGES" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"INKSTAMM" + _fpw$)
 
 FILE "INKSTAMM"
 INDEX InkDatum.inkstamm
 SELECT LAST 
 codeink1% = codeink.inkstamm
 datlastink$ = DATE$ (inkDatum,"0d.mm.yyyy")
 IF LTRIM$ (datlastink$) = "" THEN datlastink$ = "keine Angaben"
 
 REDIM AdrFound$( RECCOUNT ("inkstamm"),1)
 REDIM AdrFound$( RECCOUNT ("inkstamm"))
 b% = RECCOUNT ("inkstamm")
 REM FOR i% = 0 TO b%
    REM AdrFound$(i%) = ""
 REM NEXT i%
 a% = 0
 SELECT LAST 
 WHILE NOT EOF ("inkstamm")
 d1$ = DATE$ (inkDatum,"0d.mm.yyyy")
 AdrFound$(a%) = "Datum: " + d1$ + " HF: " + STR$ (HauptfÑlligkeit,"00") + " Anzahl:" + STR$ (Anzahl,"00") + " - erstellt am: " + DATE$ (wannerstellt,"0d.mm.yyyy") + " /DTAUS-Datei: " + TRIM$ (DTausDatei) + SPACE$ (120) + STR$ (codeink,"000000")
   a% = a% + 1
   SELECT PREVIOUS 
 WEND 
 
 LAuswahl$ = AdrFound$(0)
 REM LAuswahl1$(0) = LAuswahl$
 
 REM 041199
 CREATE DIALOG "INK",0,0,390,192,"Inkasso","MS Sans Serif",8
 ADD DIALOG "INK",4,0,0,389,53,0,""
 ADD DIALOG "INK",9,9,12,21,23,2
 var1$ = "Wollen Sie ein bereits durchgefÅhrtes Inkasso zurÅcksetzen und nochmals NEU generieren lassen? Wenn JA wÑhlen Sie das Inkasso aus der nachstehenden Liste aus und betÑtigen Sie den Button JA!"
 var2$ = " Wenn Sie ein NEUES Inkasso durchfÅhren wollen dann NEIN drÅcken!"
 var3$ = var1$ + var2$
 ADD DIALOG "INK",5,38,12,344,40,0,var3$
 
 ADD DIALOG "INK",5,38,37,53,10,0,"letztes Inkasso war:"
 ADD DIALOG "INK",5,93,36,51,11,0,datlastink$
 ADD DIALOG "INK",7,5,55,380,120,0,2,AdrFound$,Lauswahl1$,AdrFound$(0)
 ADD DIALOG "INK",1,34,177,25,14,0,"&NEIN",1,1
 ADD DIALOG "INK",1,63,177,25,14,0,"&JA",2,2
 ADD DIALOG "INK",1,92,177,75,14,1,"&Inkasso Abbrechen",0,0
 
 DIALOG "INK",req%
 REMOVE DIALOG "INK"
 
 
 LAuswahl$ = LAuswahl1$(0)
 codeink1% = VAL ( RIGHT$ (LAuswahl$,6))
 
 IF req% = 0 THEN 
   REQUEST "Inkasso wurde abgebrochen!"
   END SUB 
 END IF 
 IF codeink1% = 0 AND req% = 2 THEN 
   CALL Fehler("Es wurde kein Inkasso ausgewÑhlt, das rÅckgÑngig gemacht werden soll!","Inkasso abgebrochen!")
   END SUB 
 END IF 
 REM *** ein vîllig neues Inkasso durchfÅhren, ohnen die Kukto zurÅckzusetzen ***
 IF req% = 1 THEN 
   CalcDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
Ink1Dialog: 
   CREATE DIALOG "INK1",0,0,191,122,"Inkasso","MS Sans Serif",8
   ADD DIALOG "INK1",4,0,0,191,98,0,""
   ADD DIALOG "INK1",9,9,12,21,23,2
   ADD DIALOG "INK1",5,38,12,144,30,0,"Bitte geben Sie ein, welches Rechnungsdatum das Inkasso erhalten soll (Datum der Rechnung/Inkasso):"
   ADD DIALOG "INK1",5,38,45,80,10,0,"HauptfÑlligkeit:"
   ADD DIALOG "INK1",6,93,44,20,11,0,0,m%,2
   ADD DIALOG "INK1",5,38,63,35,10,0,"Inkassotag:"
   ADD DIALOG "INK1",6,93,63,51,11,0,0,CalcDate$,10
   ADD DIALOG "INK1",1,34,99,55,14,1,"&OK",1,1
   ADD DIALOG "INK1",1,92,99,75,14,0,"&Inkasso Abbrechen",0,0
   DIALOG "INK1",req1%
   REMOVE DIALOG "INK1"
   IF req1% > 0 THEN 
     IF DateOK%(CalcDate$) THEN 
       
       IF m% < 0 OR m% > 12 THEN 
         CALL Fehler("Der Wertebereich fÅr die HauptfÑlligkeit mu· grî·er01 und kleiner 13 sein!","Bitte Eingabe wiederholen!")
         GOTO Ink1Dialog
       END IF 
     ELSE 
       GOTO Ink1Dialog
     END IF 
     m$ = STR$ (m%,"00")
     tt$ = "und die eine Gesellschaft und eine Sparte besitzen und als <lebend> gekennzeichnet sind und deren HauptfÑlligkeit im Monat " + m$ + " liegt!"
 CALL Fehler ("Jetzt wird das Inkasso ausgefÅhrt! Es gehen alle DatensÑtze der Vertragsdatei ein, bei denen das Feld Vermittlerinkasso gesetzt ist",tt$)
     REQUEST "INKASSO DURCHFöHREN?","",130,req140%
     IF req140% = 0 THEN END SUB 
     FILE "InkStamm"
     INDEX codeink.inkstamm
     SELECT LAST 
     mvorher% = HauptfÑlligkeit.inkstamm
     IF mvorher% = m% THEN 
       b$ = "Wenn Sie jetzt ein NEUES Inkasso fÅr diesen Monat erstellen, wird das vorhergehende unwiederbringlich abgeschlossen und in das NEUE Inkasso gehen nur die VertrÑge ein, die zwischenzeitlich neu eingegeben wurden!"
       CALL Fehler("Sie hatten das Inkasso fÅr diesen Monat bereits durchgefÅhrt!",b$)
       REQUEST "INKASSO TROTZDEM DURCHFöHREN?","",130,req150%
       IF req150% = 0 THEN END SUB 
     END IF 
     
     BLANK FILE "InkStamm"
     codeink% = SER ("InkStamm",1)
     codeink.inkstamm = codeink%
     InkDatum.inkstamm = CalcDate$
     wannerstellt.inkstamm = TODAY 
     Anzahl.InkStamm = 1
     zero.inkstamm = 0
     HauptfÑlligkeit.inkstamm = m%
     Workstation.inkstamm = Workstation%
     QWoNo.inkstamm = STR$ (Workstation%,"000000") + STR$ (codeink.inkstamm,"000000")
     RecStatus.inkstamm = "c"
     STORE FILE "InkStamm"
     CALL CreateLog()
     CALL WriteLog("")
     CALL WriteLog("=================================")
     CALL WriteLog("Erzeugung Inkassodaten vom " + DATE$ ( TODAY ,"0d.mm.yyyy") + " fÅr HauptfÑlligkeit: " + m$ + " / Inkasso vom: " + CalcDate$)
     CALL WriteLog("=================================")
     CALL WriteLog("")
InkBerech: 
     FILE "KVERTRAG"
     INDEX QuickVIK.kvertrag
     SELECT WHERE FILE "KVERTRAG"
     SELECT FIRST 
     REM QuickVIH=CodeVStatus+Vermittlerink+HauptfÑlligkeit
     REM 091299
     REM testwert$ = "011" + m$
     testwert$ = "011"
 
 
     REM IF (ZW% = 1,"jÑhrlich", IF (ZW% = 2,"halbjÑhrlich", IF (ZW% = 4,"vierteljÑhrlich", IF (ZW% = 12,"monatlich", IF (ZW% = 0,"einmalig"
     IF NOT EXISTS (testwert$,QuickVIK.kvertrag) THEN 
       CALL Fehler("Es wurden keine InkassodatensÑtze generiert,da keine < lebenden > VertrÑge,mit dem Kennzeichen < Vermittlerinkasso > existieren!","")
       GOTO InkassoEnd
     END IF 
     SELECT KEY testwert$ LOCK FILE "Kvertrag" INDEX QuickVIK.kvertrag
     i% = 0
     SUM1% = 0
     fehl% = 0
     Calcmon$ = STR$ ( MONTH (CalcDate$),"00")
     CalcYear$ = STR$ ( YEAR (CalcDate$),"0000")
     CalcDatum$ = "01." + Calcmon$ + "." + CalcYear$
     MOUSE OFF 
     WHILE NOT EOF ("Kvertrag") AND QuickVIK.kvertrag = testwert$
       FILE "kvertrag"
       IF vs_Beginn.kvertrag <= DAYS (CalcDate$) THEN 
        IF codeva.kvertrag > 0 AND codege.kvertrag > 0 THEN 
         REM einmalig
         IF zw.kvertrag = 0 THEN 
           IF HauptfÑlligkeit.kvertrag = m% AND letzteRechleg.kvertrag < DAYS ("1.1.1980") THEN 
             lRlegOld.kvertrag = letzteRechleg.kvertrag
             letzteRechleg.kvertrag = CalcDatum$
             SUM1% = SUM1% + Beitrag.kvertrag
             CALL QuickStore("Kvertrag")
             MOUSE OFF 
             i% = i% + 1
             IF Beitrag.kvertrag > 0 THEN 
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             ELSE 
               fehl% = fehl% + 1
               i% = i% + 1
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               CALL WriteLog("      ! Vertrag " + VS_NR.kvertrag + " Achtung BEITRAG = 0!")
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             END IF 
           END IF 
         END IF 
 
         REM jÑhrlich
         calcdate% = DAYS (Calcdate$)
         datdifferenz% = calcdate% - letzteRechleg.kvertrag
         IF zw.kvertrag = 1 THEN 
           IF HauptfÑlligkeit.kvertrag = m% AND datdifferenz% > 300 THEN 
             lRlegOld.kvertrag = letzteRechleg.kvertrag
             letzteRechleg.kvertrag = CalcDatum$
             SUM1% = SUM1% + Beitrag.kvertrag
             CALL QuickStore("Kvertrag")
             MOUSE OFF 
             i% = i% + 1
             IF Beitrag.kvertrag > 0 THEN 
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             ELSE 
               fehl% = fehl% + 1
               i% = i% + 1
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               CALL WriteLog("      ! Vertrag " + VS_NR.kvertrag + " Achtung BEITRAG = 0 !")
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             END IF 
           END IF 
         END IF 
         
         REM halbjÑhrlich
         IF zw.kvertrag = 2 THEN 
           mtest% = HauptfÑlligkeit.kvertrag + 6
           IF mtest% > 12 THEN mtest% = mtest% - 12
           IF (HauptfÑlligkeit.kvertrag = m% OR mtest% = m%) AND datdifferenz% > 170 THEN 
             lRlegOld.kvertrag = letzteRechleg.kvertrag
             letzteRechleg.kvertrag = CalcDatum$
             SUM1% = SUM1% + Beitrag.kvertrag
             CALL QuickStore("Kvertrag")
             MOUSE OFF 
             i% = i% + 1
             IF Beitrag.kvertrag > 0 THEN 
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             ELSE 
               fehl% = fehl% + 1
               i% = i% + 1
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               CALL WriteLog("      ! Vertrag " + VS_NR.kvertrag + " Achtung BEITRAG = 0 !")
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             END IF 
           END IF 
         END IF 
 
         REM vierteljÑhrlich
         IF zw.kvertrag = 4 THEN 
           mtest0% = HauptfÑlligkeit.kvertrag
           mtest2% = HauptfÑlligkeit.kvertrag + 3
           IF mtest2% > 12 THEN mtest2% = mtest2% - 12
           mtest3% = mtest2% + 3
           IF mtest3% > 12 THEN mtest3% = mtest3% - 12
           mtest4% = mtest3% + 3
           IF mtest4% > 12 THEN mtest4% = mtest4% - 12
           REM CALL Fehler("vierteljÑhrlich","")
           IF (HauptfÑlligkeit.kvertrag = m% OR mtest2% = m% OR mtest3% = m% OR mtest4% = m%) AND datdifferenz% > 70 THEN 
             lRlegOld.kvertrag = letzteRechleg.kvertrag
             letzteRechleg.kvertrag = CalcDatum$
             SUM1% = SUM1% + Beitrag.kvertrag
             CALL QuickStore("Kvertrag")
             MOUSE OFF 
             i% = i% + 1
             IF Beitrag.kvertrag > 0 THEN 
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             ELSE 
               i% = i% + 1
               fehl% = fehl% + 1
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               CALL WriteLog("      ! Vertrag " + VS_NR.kvertrag + " Achtung BEITRAG = 0 !")
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             END IF 
           END IF 
         END IF 
 
         REM monatlich
         IF zw.kvertrag = 12 AND datdifferenz% > 20 THEN 
             IF lfdnr.kvertrag = 36712 THEN 
               REM 31082005
               REM CALL Fehler("Inkasso","78910/Darlehnsvertrag")
             END IF 
             lRlegOld.kvertrag = letzteRechleg.kvertrag
             letzteRechleg.kvertrag = CalcDatum$
             SUM1% = SUM1% + Beitrag.kvertrag
             CALL QuickStore("Kvertrag")
             MOUSE OFF 
             i% = i% + 1
             IF Beitrag.kvertrag > 0 THEN 
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             ELSE 
               fehl% = fehl% + 1
               i% = i% + 1
               CALL GenerateInk(lfdnr.kvertrag,CalcDate$,codeink%)
               CALL WriteLog("      ! Vertrag " + VS_NR.kvertrag + " ACHTUNG BEITRAG = 0 !")
               IF K1Konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "" THEN 
                 IF zahlart.kvertrag = 1 THEN CALL WriteLog("      WARNUNG Vertrag " + VS_NR.kvertrag + " Feld Bank, Kontonr oder BLZ nicht ausgefÅllt!")
               END IF 
             END IF 
         END IF 
         
         SET STATUS "Anz.InkassodatensÑtze gesamt: " + STR$ (i%,"99999999") + "   Vertrag: " + VS_NR.kvertrag + " - davon Fehler (Beitrag=0): " + STR$ (fehl%,"9999999")
         MOUSE OFF 
        ELSE 
         fehl% = fehl% + 1
         CALL WriteLog("# Vertrag " + VS_NR.kvertrag + " nicht berÅcksichtigt, da entweder Sparte oder Gesellschaft fehlt!")
        END IF 
       END IF 
endInk09129901: 
       FILE "Kvertrag"
       SELECT NEXT LOCK FILE "Kvertrag"
     WEND 
   END IF 
   CALL WriteLog("*******************************************************")
   CALL WriteLog("Anzahl der erzeugten InkassodatensÑtze:" + LTRIM$ ( STR$ (i%,"99999999")) + " ******Gesamtsumme BeitrÑge: " + LTRIM$ ( STR$ (SUM1%,"9999999999.00")))
   CALL WriteLog("*******************************************************")
   CALL CloseLog()
   
 END IF 
 
 REM *** Eine bereits durchgefÅhrte Inkassoma·nahme zurÅcksetzen und neu generieren ***
 IF req% = 2 THEN 
   SELECT FIRST FILE "inkstamm" INDEX codeink.inkstamm
   SELECT KEY codeink1% LOCK FILE "inkstamm" INDEX codeink.inkstamm
   m$ = STR$ (HauptfÑlligkeit.inkstamm,"00")
   m% = VAL (m$)
   IF ma% = 0 THEN 
Ink2Dialog: 
     CREATE DIALOG "INK1",0,0,191,122,"Inkasso","MS Sans Serif",8
     ADD DIALOG "INK1",4,0,0,191,98,0,""
     ADD DIALOG "INK1",9,9,12,21,23,2
     ADD DIALOG "INK1",5,38,12,144,30,0,"Bitte geben Sie ein, welches Rechnungsdatum das Inkasso erhalten soll (Datum der Rechnung/Inkasso):"
     ADD DIALOG "INK1",5,38,45,80,10,0,"HauptfÑlligkeit:"
     ADD DIALOG "INK1",6,93,44,20,11,0,0,m%,2
     ADD DIALOG "INK1",5,38,63,35,10,0,"Inkassotag:"
     ADD DIALOG "INK1",6,93,63,51,11,0,0,CalcDate$,10
     ADD DIALOG "INK1",1,34,99,55,14,1,"&OK",1,1
     ADD DIALOG "INK1",1,92,99,75,14,0,"&Inkasso Abbrechen",0,0
     DIALOG "INK1",req1%
     REMOVE DIALOG "INK1"
     IF req1% > 0 THEN 
       IF DateOK%(CalcDate$) THEN 
       
         IF m% < 0 OR m% > 12 THEN 
           CALL Fehler("Der Wertebereich fÅr die HauptfÑlligkeit mu· grî·er01 und kleiner 13 sein!","Bitte Eingabe wiederholen!")
           GOTO Ink2Dialog
         END IF 
       ELSE 
         GOTO Ink2Dialog
       END IF 
       m$ = STR$ (m%,"00")
       HauptfÑlligkeit.inkstamm = m%
       STORE FILE "INKSTAMM"
     END IF 
   ELSE 
     CREATE DIALOG "INK1",0,0,191,122,"Inkasso","MS Sans Serif",8
     ADD DIALOG "INK1",4,0,0,191,98,0,""
     ADD DIALOG "INK1",9,9,12,21,23,2
     ADD DIALOG "INK1",5,38,12,144,30,0,"Bitte geben Sie ein, welches Rechnungsdatum das Inkasso erhalten soll (Datum der Rechnung/Inkasso):"
     ADD DIALOG "INK1",5,38,63,35,10,0,"Inkassotag:"
     ADD DIALOG "INK1",6,93,63,51,11,0,0,CalcDate$,10
     ADD DIALOG "INK1",1,34,105,55,14,1,"&OK",1,1
     ADD DIALOG "INK1",1,92,105,75,14,0,"&Inkasso Abbrechen",0,0
     DIALOG "INK1",req2%
     REMOVE DIALOG "INK1"
     IF req2% > 0 THEN 
       IF DateOK%(CalcDate$) THEN 
       ELSE 
         GOTO Ink1Dialog
       END IF 
     ELSE 
       GOTO InkassoEnd
     END IF 
   END IF 
   CALL Fehler("Es werden jetzt zunÑchst alle betroffenen DatensÑtze von den Kundenkonten gelîscht!","Danach werden die InkassodatensÑtze neu generiert")
   REQUEST "INKASSOKORREKTUR DURCHFöHREN?","",130,req150%
   IF req150% = 0 THEN END SUB 
   FILE "KUKTO"
   INDEX codeink.kukto
   SELECT FIRST 
   ok% = 1
   IF RECCOUNT ("KUKTO") > 0 THEN 
     SELECT KEY codeink1% LOCK FILE "Kukto" INDEX codeink.kukto
   ELSE 
     SELECT LAST 
     ok% = 0
   END IF 
   
   
   WHILE NOT EOF ("kukto") AND ok% = 1
     IF codeink.kukto = codeink1% THEN 
       IF EXISTS (codevt.kukto,lfdnr.kvertrag) THEN 
         FILE "kvertrag"
         SELECT FIRST FILE "Kvertrag"
         SELECT KEY codevt.kukto LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
         SET STATUS "Korrigiere Vertrag: " + VS_Nr.kvertrag
         letzteRechleg.kvertrag = lRlegOld.kvertrag
         RecStatus.kvertrag = "c"
         STORE FILE "Kvertrag"
         FILE "kukto"
       END IF 
       
     ELSE 
       ok% = 0
     END IF 
     SELECT NEXT LOCK FILE "Kukto" INDEX codeink.kukto
   WEND 
   SET STATUS "Lîsche Kontobewegungen"
   REMOVE FROM FILE "Kukto" WHERE codeink.kukto = codeink1%
   SET STATUS "Lîsche Buchungen aus Buchungsdatei Gesellschaft"
   REMOVE FROM FILE "BUCHGES" WHERE codeink.BUCHGES = codeink1%
   codeink% = codeink1%
   CALL Fehler("ZurÅcksetzen der Vertragsdatei beendet!","")
   SET STATUS ""
 
   req% = 1
   FILE "InkStamm"
   IF NOT EXISTS (codeink1%,codeink.inkstamm) OR codeink1% < 1 THEN 
     CALL Fehler("Das zu korrigierende Inkasso wurde nicht gefunden","Bitte wÑhlen Sie die Option zur Inkassoneuerstellung!")
     GOTO InkassoEnd
   END IF 
   SELECT KEY codeink1% LOCK FILE "InkStamm" INDEX codeink.inkstamm
   m$ = STR$ (HauptfÑlligkeit.inkstamm,"00")
   m% = VAL (m$)
   InkDatum.inkstamm = CalcDate$
   Anzahl.InkStamm = Anzahl.inkstamm + 1
   wannerstellt.inkstamm = TODAY 
   dtausdatei.inkstamm = ""
   zero = 0
   Workstation.inkstamm = Workstation%
   QWoNo.inkstamm = STR$ (Workstation%,"000000") + STR$ (codeink.inkstamm,"000000")
   RecStatus.inkstamm = "c"
   STORE FILE "InkStamm"
   CALL CreateLog()
     CALL WriteLog("")
     CALL WriteLog("**********************************************************************")
     REM CALL WriteLog( STR$ (Anzahl.inkstamm,"999999") + ". Korrektur Inkassodaten vom " + DATE$ ( TODAY ,"0d.mm.yyyy") + " fÅr Inkasso vom: " + DATE$ (CalcDate$,"0d.mm.yyyy"))
     CALL WriteLog( STR$ (Anzahl.inkstamm,"999999") + ". Korrektur Inkassodaten vom " + DATE$ ( TODAY ,"0d.mm.yyyy") + " fÅr Inkasso vom: " + CalcDate$)
     CALL WriteLog("***********************************************************************")
     CALL WriteLog("")
 
   GOTO InkBerech
 END IF 
 
InkassoEnd: 
 END SUB 
 
SUB GenerateInk(codevt%,CalcDate$,codeink%)
   codeku% = codeku.kvertrag
   SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
   BLANK FILE "KUKTO"
   
   FÑlligkeit.KuKto = CalcDate$
   Codekuko.KuKto = SER ("KuKto",1)
   zero.kukto = 0
   CodeVT.KuKto = codevt%
   Codeva.KuKto = Codeva.kvertrag
   Codevp.kukto = Codevp.kvertrag
   CodeInk.Kukto = codeink%
   gesellschaft.KuKto = Gesellschaft.kvertrag
   sparte.KuKto = sparte.kvertrag
   CodeMA.KuKto = CodeMA.KVERTRAG
   CodeKU.KuKto = CodeKU.kvertrag
   anrede.kukto = anrede.GAdrDat$
   titel.kukto = titel.GAdrDat$
   nachname.kukto = nachname.GAdrDat$
   vorname.kukto = vorname.GAdrDat$
   geburtsname.kukto = geburtsname.GAdrDat$
   Stra·e.kukto = stra·e.GAdrDat$
   ort.kukto = ort.GAdrDat$
   plz.kukto = plz.GAdrDat$
   codege.kukto = codege.kvertrag
   VS_NR.kukto = VS_NR.kvertrag
   codew.kukto = codew.kvertrag
   umrechnung.kukto = umrechnung.kvertrag
   waehrung.kukto = waehrung.kvertrag
   Beitrag.kukto = Beitrag.kvertrag
   beitrageu.kukto = VAL ( STR$ (beitrag.kukto / umrechnung.kukto,"999999999.00"))
   gezbetrageu.kukto = VAL ( STR$ (gezbetrag.kukto / umrechnung.kukto,"999999999.00"))
   wannerstellt.kukto = TODAY 
   
   K1Bank.kukto = K1Bank.Kvertrag
   K1Konto.Kukto = K1Konto.kvertrag
   K1BLZ.Kukto = K1Blz.kvertrag
   manuell.kukto = "n"
   gedruckt.kukto = "n"
   mahnung.kukto = "n"
   dtaus.kukto = "n"
   
   ZW.kukto = ZW2Str$(ZW.KVERTRAG)
   Zahlart$ = Zahlart2Str$(Zahlart.KVERTRAG)
   Zahlart.kukto = Zahlart$
   IF inkart.kvertrag = 1 THEN 
     Inkart.kukto = "Vermittlerinkasso"
   END IF 
   IF inkart.kvertrag = 2 THEN 
     Inkart.kukto = "Zentralinkasso"
   END IF 
   REM IF (Zahlart$) = "Bankeinzug" THEN 
   IF zahlart.kvertrag = 1 THEN 
     erledigtJaNein.kukto = "j"
     gezBetrag.kukto = Beitrag.kvertrag
     gezahltam.kukto = CalcDate$
     CALL WriteLog( DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy") + " " + VS_NR.kvertrag + " erzeugt -> Bankeinzug -> ok /Beitrag:" + LTRIM$ ( STR$ (beitrag.kvertrag,"999999999.00")))
   ELSE 
     erledigtJaNein.kukto = "n"
     gezBetrag.kukto = 0
     CALL WriteLog( DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy") + " " + VS_NR.kvertrag + " erzeugt - > ZE Åberwachen / Beitrag:" + LTRIM$ ( STR$ (beitrag.kvertrag,"999999999.00")))
   END IF 
   HauptfÑlligkeit.kukto = STR$ (HauptfÑlligkeit.kvertrag,"00")
   verrechnet.kukto = "n"
   CALL QuickStore("KuKto")
 
 END SUB 
 
 REM ************************************************************************************
 REM                Suche nach Kukto ZE
 REM ************************************************************************************
 
SUB KuKtoSuch()
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF OPEN ("adrtemp") THEN 
   REM CLOSE FILE "ADRTEMP"
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"KGEADR" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"INKSTAMM" + _fpw$)
 FILE "kukto"
 SELECT WHERE FILE "kukto"
 opt&% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 IF opt&% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 optm&% = 3
 opte&% = 2
 optd&% = 3
 optb&% = 3
 optr&% = 3
 optm&% = 3
 
SuKuktoBeg: 
 
 CREATE DIALOG "ZEINSUCH",0,0,298,174,"ZahlungseingÑnge","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,297,149,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Inkassosatz suchen mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu durchsuchende Datenmenge durch die wahlfreie Angabe des Inkassodatums einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,54,76,10,0,"Suche Åber..."
 ADD DIALOG "ZEINSUCH",3,38,62,95,12,0,"Vertrags-/Policennummer",1,opt&%
 ADD DIALOG "ZEINSUCH",3,38,72,60,12,0,"Name",2,opt&%
 ADD DIALOG "ZEINSUCH",3,38,82,60,12,0,"Gesellschaft",4,opt&%
 ADD DIALOG "ZEINSUCH",3,38,92,60,12,0,"nur Zeitraum",3,opt&%
 IF GLundWrigg$ = "TRUE" THEN 
   ADD DIALOG "ZEINSUCH",5,150,54,41,10,0,"Abruf?"
   ADD DIALOG "ZEINSUCH",3,208,52,20,12,0,"Ja",1,optab&%
   ADD DIALOG "ZEINSUCH",3,233,52,30,12,0,"Nein",2,optab&%
   ADD DIALOG "ZEINSUCH",3,263,52,30,12,0,"egal",3,optab&%
 END IF 
 ADD DIALOG "ZEINSUCH",5,150,64,41,10,0,"manuell?"
 ADD DIALOG "ZEINSUCH",3,208,62,20,12,0,"Ja",1,optm&%
 ADD DIALOG "ZEINSUCH",3,233,62,30,12,0,"Nein",2,optm&%
 ADD DIALOG "ZEINSUCH",3,263,62,30,12,0,"egal",3,optm&%
 
 ADD DIALOG "ZEINSUCH",5,150,74,67,10,0,"DTAUS erstellt?"
 ADD DIALOG "ZEINSUCH",3,208,72,20,12,0,"Ja",1,optd&%
 ADD DIALOG "ZEINSUCH",3,233,72,30,12,0,"Nein",2,optd&%
 ADD DIALOG "ZEINSUCH",3,263,72,30,12,0,"egal",3,optd&%
 
 ADD DIALOG "ZEINSUCH",5,150,84,41,11,0,"erledigt?"
 ADD DIALOG "ZEINSUCH",3,208,82,20,12,0,"Ja",1,opte&%
 ADD DIALOG "ZEINSUCH",3,233,82,30,12,0,"Nein",2,opte&%
 ADD DIALOG "ZEINSUCH",3,263,82,30,12,0,"egal",3,opte&%
 
 ADD DIALOG "ZEINSUCH",5,150,94,41,11,0,"BEITRAG?"
 ADD DIALOG "ZEINSUCH",3,208,92,20,12,0,"=0",1,optb&%
 ADD DIALOG "ZEINSUCH",3,233,92,30,12,0,">0",2,optb&%
 ADD DIALOG "ZEINSUCH",3,263,92,30,12,0,"egal",3,optb&%
 
 ADD DIALOG "ZEINSUCH",5,150,104,41,11,0,"Rechnung?"
 ADD DIALOG "ZEINSUCH",3,208,102,20,12,0,"Ja",1,optr&%
 ADD DIALOG "ZEINSUCH",3,233,102,30,12,0,"Nein",2,optr&%
 ADD DIALOG "ZEINSUCH",3,263,102,30,12,0,"egal",3,optr&%
 
 ADD DIALOG "ZEINSUCH",5,150,114,41,11,0,"Mahnung?"
 ADD DIALOG "ZEINSUCH",3,208,112,20,12,0,"Ja",1,optma&%
 ADD DIALOG "ZEINSUCH",3,233,112,30,12,0,"Nein",2,optma&%
 ADD DIALOG "ZEINSUCH",3,263,112,30,12,0,"egal",3,optma&%
 
 ADD DIALOG "ZEINSUCH",5,38,117,96,9,0,"Inkassozeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,130,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,129,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,130,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,129,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,79,153,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,137,153,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   REM filt$ = "Select where codekuko>0 and erledigtJaNein=" + CHR$ (34) + erledigt$ + CHR$ (34) + " and dtaus=" + CHR$ (34) + dtaus$ + CHR$ (34) + " and manuell=" + CHR$ (34) + manuell$ + CHR$ (34)
   REM GOTO filtab181199
   filt$ = "Select where codekuko>0 "
   REM filt$ = "Select where codekuko>0 and erledigtJaNein=" + CHR$ (34) + erledigt$ + CHR$ (34) + " and dtaus=" + CHR$ (34) + dtaus$ + CHR$ (34) + " and manuell=" + CHR$ (34) + manuell$ + CHR$ (34)
   IF opte&% = 1 THEN 
     filt$ = filt$ + " AND erledigtJaNein=" + CHR$ (34) + "j" + CHR$ (34)
   END IF 
   IF opte&% = 2 THEN 
     filt$ = filt$ + " AND erledigtJaNein=" + CHR$ (34) + "n" + CHR$ (34)
   END IF 
   IF optm&% = 1 THEN 
     filt$ = filt$ + " AND manuell = " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
   IF optm&% = 2 THEN 
     filt$ = filt$ + " AND manuell = " + CHR$ (34) + "n" + CHR$ (34)
   END IF 
   IF optd&% = 1 THEN 
     filt$ = filt$ + " AND dtaus = " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
   IF optd&% = 2 THEN 
     filt$ = filt$ + " AND dtaus = " + CHR$ (34) + "n" + CHR$ (34)
   END IF 
   IF optb&% = 1 THEN 
     filt$ = filt$ + " AND Beitrag = 0"
   END IF 
   IF optb&% = 2 THEN 
     filt$ = filt$ + " AND Beitrag > 0"
   END IF 
 
   IF optab&% = 1 THEN 
     filt$ = filt$ + " AND Abruf = " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
   IF optab&% = 2 THEN 
     filt$ = filt$ + " AND Abruf <> " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
 
   IF optr&% = 1 THEN 
     filt$ = filt$ + " AND gedruckt = " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
   IF optr&% = 2 THEN 
     filt$ = filt$ + " AND gedruckt <> " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
 
   IF optma&% = 1 THEN 
     filt$ = filt$ + " AND mahnung = " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
   IF optma&% = 2 THEN 
     filt$ = filt$ + " AND mahnung <> " + CHR$ (34) + "j" + CHR$ (34)
   END IF 
filtab181199: 
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
       filt$ = filt$ + " And FÑlligkeit.kukto>=" + CHR$ (34) + von$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  von  ist falsch!","Bitte korrigieren!")
       GOTO SuKuktoBeg
     END IF 
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
       filt$ = filt$ + " And FÑlligkeit.kukto<=" + CHR$ (34) + bis$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  bis  ist falsch!","Bitte korrigieren!")
       GOTO SuKuktoBeg
     END IF 
   END IF 
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"ZahlungseingÑnge","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten BuchungssÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN 
       ok% = 0
     ELSE 
       sVSNR$ = VSNRPack$(VSNR$)
       filt$ = filt$ + " AND QuickVSNR.kukto  like" + CHR$ (34) + sVSNR$ + "*" + CHR$ (34)
     END IF 
 
   END IF 
   IF opt&% = 2 THEN 
     adrser% = 0
     FILE GAdrDat$
     noserie% = 1
     adrglob% = 0
     adr% = 0
     adr% = ADRSuche%(0)
     IF adr% <> 0 THEN cuknr% = adr%
     IF adrglob% <> 0 THEN cuknr% = adrglob%
     knr% = cuknr%
     IF knr% = 0 THEN 
       ok% = 0
     ELSE 
       ku$ = LTRIM$ ( STR$ (knr%,"999999"))
       filt$ = filt$ + " AND codeku.kukto=" + ku$
     END IF 
   END IF 
   
   IF opt&% = 4 THEN 
     GCodeGE% = 0
     ge% = GetGesKukto%()
     IF ge% <> 0 THEN 
       GCodeGE% = ge%
       ge$ = LTRIM$ ( STR$ (ge%,"9999999"))
       filt$ = filt$ + " AND codege.kukto=" + ge$
     END IF 
   END IF 
   FILE "KUKTO"
   EXECUTE filt$
   drfilt$ = filt$
   filtbut$ = "Filter aufheben <<"
   zero% = 0
   SELECT FORM KEY zero% FILE "Kukto" INDEX zero.kukto
 
   FORM 
 ELSE 
   filtbut$ = "kein Filter gesetzt"
 END IF 
 noserie% = 0
 END SUB 
 




 REM Berechnung der Sollstellung
 
SUB Sollstellung(codevttmp%,x%,abdat$)
 ' abdat$, ab Sollstellungsdatum berechnen fÅr codevt%<>0
 ' art% = 1   AP 
 ' art% = 2   Courtage
 ' art% = 3   Pflege
 ' art% = 4   Monatsfaktor
 ' art% = 5   Pauschale
 ' art% = &   AP durch VD
 haftdate% = 0
 IF VAL (abdat$) > 0 THEN 
   abdat% = DAYS (abdat$)
 ELSE 
   abdat% = 0
 END IF 
 MOUSE OFF 
 SELECT FIRST FILE "stamm"
 IF NOT OPEN ("VProdukt") THEN CALL DFile(3,"VProdukt" + _fpw$)
 IF NOT OPEN ("KVERTRAG") THEN CALL DFile(3,"KVERTRAG" + _fpw$)
 IF NOT OPEN ("GEKOND") THEN CALL DFile(3,"GEKOND" + _fpw$)
 IF NOT OPEN ("zeinvor") THEN CALL DFile(3,"zeinvor" + _fpw$)
 IF NOT OPEN ("sparten") THEN CALL DFile(3,"sparten" + _fpw$)
 IF NOT OPEN ("geadr") THEN CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 IF NOT OPEN ("VPGEKOND") THEN CALL DFile(3,"VPGEKOND" + _fpw$)
 IF NOT OPEN ("KVSKOND") THEN CALL DFile(3,"KVSKOND" + _fpw$)
 IF NOT OPEN ("ADRESSEN") THEN CALL DFile(2,"OFFICE\ADRESSEN" + _fpw$)
 REM CALL Fehler("Sollstellung berechnen","")
         monat$ = LEFT$ ( DATE$ ( TODAY ,"mm0dyyyy"),2)
         jahr$ = LEFT$ ( DATE$ ( TODAY ,"yyyymm0d"),4)
         tag$ = "27"
 bisdDATE$ = tag$ + "." + monat$ + "." + jahr$
soll120820022: 
 IF x% > 0 THEN 
   CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsende","MS Sans Serif",8
   ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
   ADD DIALOG "STICHTAG",9,6,9,23,24,2
   ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, BIS WANN die"
   ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellung generiert werden soll:"
   ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,bisdDATE$,10
   ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Enddatum:"
   ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
   ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
   DIALOG "STICHTAG",req54321%
   REMOVE DIALOG "STICHTAG"
   IF req54321% = 1 THEN 
     IF DateOK%(bisdDATE$) THEN 
       GOTO soll120820021
     ELSE 
       GOTO soll120820022
     END IF 
   ELSE 
     CALL Fehler ("Sollstellungserzeugung wurde abgebrochen!","")
     GOTO soll12082002end
   END IF 
 END IF 
soll120820021: 
 FILE "KVSKOND"
 IF codevttmp% = 0 THEN 
   INDEX erledigt.kvskond
 ELSE 
   INDEX codevt.kvskond
 END IF 
 REM ddatum% = TODAY 
 ddatum% = DAYS (bisdDATE$)
 
 IF codevttmp% < 1 THEN 
   SELECT FIRST FILE "kvskond" INDEX erledigt.kvskond
   SELECT KEY "n" FILE "kvskond" INDEX erledigt.kvskond
 ELSE 
   SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
   SELECT KEY codevttmp% FILE "kvskond" INDEX codevt.kvskond
 END IF 
 IF erledigt.kvskond = "n" THEN 
   SELECT CURRENT LOCK FILE "kvskond"
 ELSE 
   SELECT LAST FILE "kvskond"
 END IF 
 REM ZW2Str$ = IF (ZW% = 1,"jÑhrlich", 
 REM IF (ZW% = 2,"halbjÑhrlich",
 REM IF (ZW% = 4,"vierteljÑhrlich",
 REM IF (ZW% = 6,"2monatlich",
 REM IF (ZW% = 12,"monatlich",
 REM IF (ZW% = 0,"einmalig",
 REM IF (ZW% = 55,"<ohne Zuordnung>","FEHLER!")))))))
 i% = 0
 IF codevttmp% < 1 THEN WHILE NOT EOF ("kvskond") AND erledigt.kvskond = "n"
 IF codevttmp% <> 0 THEN WHILE NOT EOF ("kvskond") AND codevt.kvskond = codevttmp%
   IF codevt.kvskond = 000496 THEN 
     REM CALL Fehler("000496","")
   END IF 
   IF NOT EXISTS (codevt.kvskond,lfdnr.kvertrag) THEN 
     codevt% = codevt.kvskond
     SELECT REMOVE FILE "kvskond"
     IF codevttmp% < 1 THEN 
       SELECT FIRST FILE "kvskond" INDEX erledigt.kvskond
       SELECT KEY "n" FILE "kvskond" INDEX erledigt.kvskond
     ELSE 
       SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
       SELECT KEY codevttmp% FILE "kvskond" INDEX codevt.kvskond
     END IF 
     IF erledigt.kvskond = "n" THEN 
       SELECT CURRENT LOCK FILE "kvskond"
     ELSE 
       SELECT LAST FILE "kvskond"
     END IF 
     GOTO end230420065
   END IF 
   i% = i% + 1
   codekey% = codekey.kvskond
   codeko% = codeko.kvskond
   codevt% = codevt.kvskond
   IF EXISTS (codeko%,codekey.vpgekond) THEN 
     SELECT KEY codeko% FILE "vpgekond" INDEX codekey.vpgekond
     SELECT KEY codevt% FILE "kvertrag" INDEX lfdnr.kvertrag
     IF vs_nr.kvertrag LIKE "74327397*" THEN 
         REM CALL Fehler("Pol1","")
     END IF 
     SET STATUS LTRIM$ ( STR$ (i%)) + " " + VS_NR.kvertrag
     AnzCourtZahl% = 0
     AnzCourtZahl% = AnzCourtZahlung.vpgekond
     IF AnzCourtZahlung.kvertrag > 0 THEN AnzCourtZahl% = AnzCourtZahlung.kvertrag
     bewertung% = Bewertungssumme.kvertrag
     REM beginn% = vs_Beginn.kvertrag
     beginn% = VS_Beginn.kvertrag
     IF BewertEinm.kvertrag > 0 AND BewertEinmDat.kvertrag > 0 THEN 
       begin1ab$ = DATE$ (VS_Beginn.kvertrag,"dd.mm.yyyy")
       begin2ab$ = "01" + RIGHT$ (begin1ab$,8)
       beginn% = DAYS (begin2ab$)
       REM CALL Fehler(begin1ab$,begin2ab$)
     END IF 
     sr% = 0
     haftzeit% = 0
     pflegebegin% = 0
     cpflegebegin% = 0
     REM PflegeNachZahlw=n -> nach Zahlweise, =j nach PflegeZW.vpgekond
     IF Pflegejn.vpgekond LIKE "j" THEN 
       REM pflegebegin% = DAYS (VS_Beginn.kvertrag) + (30 * PflegeZeit.vpgekond)
       pflegezeit% = PflegeZeit.vpgekond
       _day% = DAY (vs_Beginn.kvertrag)
       _month% = MONTH (vs_Beginn.kvertrag)
       _year% = YEAR (vs_Beginn.kvertrag)
       _month% = _month% + pflegezeit%
       IF BewertEinm.kvertrag > 0 AND BewertEinmDat.kvertrag > 0 THEN 
         begin1ab$ = DATE$ (VS_Beginn.kvertrag,"dd.mm.yyyy")
         begin2ab$ = "01" + RIGHT$ (begin1ab$,8)
         beginn1ab% = DAYS (begin2ab$)
         _day% = DAY (beginn1ab%)
         _month% = MONTH (beginn1ab%)
         _year% = YEAR (beginn1ab%)
         _month% = _month% + pflegezeit%
         REM CALL Fehler(begin1ab$,begin2ab$)
       END IF 
       WHILE _month% > 0
         _year% = _year% + 1
         _month% = _month% - 12
       WEND 
       IF _month% <= 0 THEN 
         _year% = _year% - 1
         _month% = _month% + 12
       END IF 
       IF _day% < 1 THEN _day% = 1
       IF _day% > 28 THEN 
         IF _month% = 2 THEN _day% = 28
         IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
       END IF 
       pflegebegin% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
       pfegezeit% = PflegeZeit.vpgekond
       cpflegebegin% = pflegebegin%
       pflegebegin$ = DATE$ (pflegebegin%,"0d.mm.yyyy")
       ptestdate% = 0:testdate% = 1
       WHILE ptestdate% <= testdate%
         IF PflegeNachZahlw.vpgekond = "j" THEN 
           IF letztePflege.kvskond > 0 THEN 
             REM nextpflege% = letztePflege.kvskond + (30 * PflegeZW.vpgekond)
             letztePflege$ = DATE$ (letztePflege.kvskond,"0d.mm.yyyy")
             PflegeZW% = PflegeZW.vpgekond
             _day% = DAY (letztePflege.kvskond)
             _month% = MONTH (letztePflege.kvskond)
             _year% = YEAR (letztePflege.kvskond)
             _month% = _month% + PflegeZW%
             jahr% = 0
             WHILE _month% > 0
               _year% = _year% + 1
               _month% = _month% - 12
             WEND 
             IF _month% <= 0 THEN 
               _year% = _year% - 1
               _month% = _month% + 12
             END IF 
             nextpflege% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
             nextpflege$ = DATE$ (nextpflege%,"0d.mm.yyyy")
           ELSE 
             nextpflege% = pflegebegin%
           END IF 
         ELSE 
           IF letztePflege.kvskond > 0 THEN 
             pflegebegin% = letztePflege.kvskond
             pflegebegin1$ = DATE$ (pflegebegin%,"0d.mm.yyyy")
           ELSE 
             pflegezeit% = PflegeZeit.vpgekond
             _day% = DAY (vs_Beginn.kvertrag)
             _month% = MONTH (vs_Beginn.kvertrag)
             _year% = YEAR (vs_Beginn.kvertrag)
             _month% = _month% + pflegezeit%
             IF BewertEinm.kvertrag > 0 AND BewertEinmDat.kvertrag > 0 THEN 
               begin1ab$ = DATE$ (VS_Beginn.kvertrag,"dd.mm.yyyy")
               begin2ab$ = "01" + RIGHT$ (begin1ab$,8)
               beginn1ab% = DAYS (begin2ab$)
               _day% = DAY (beginn1ab%)
               _month% = MONTH (beginn1ab%)
               _year% = YEAR (beginn1ab%)
               _month% = _month% + pflegezeit%
               REM CALL Fehler(begin1ab$,begin2ab$)
             END IF 
             jahr% = 0
             WHILE _month% > 0
               _year% = _year% + 1
               _month% = _month% - 12
             WEND 
             IF _month% <= 0 THEN 
               _year% = _year% - 1
               _month% = _month% + 12
             END IF 
             IF _day% < 1 THEN _day% = 1
               IF _day% > 28 THEN 
               IF _month% = 2 THEN _day% = 28
               IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
             END IF 
             pflegebegin% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
             vsbeg$ = DATE$ (vs_Beginn.kvertrag,"0d.mm.yyyy")
             REM pflegebegin% = vs_Beginn.kvertrag + (30 * PflegeZeit.vpgekond)
             pflegebegin1$ = DATE$ (pflegebegin%,"0d.mm.yyyy")
             REM CALL Fehler(pflegebegin1$,"")
             nextpflege% = pflegebegin%
           END IF 
           IF letztePflege.kvskond > 0 THEN 
             _day% = DAY (pflegebegin%)
             _month% = MONTH (pflegebegin%)
             _year% = YEAR (pflegebegin%)
             SELECT CASE ZW.KVERTRAG
             CASE 1
               _year% = _year% + 1
             CASE 2
               REM halbjahrlich
               _month% = _month% + 6
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 4
               REM viertelÑhrlich
               _month% = _month% + 3
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 6
               REM 2 monatlich
               _month% = _month% + 2
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 12
               REM monatlich
               _month% = _month% + 1
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 0
               REM einmalig
               _year% = 2100
             END SELECT 
 
             IF _day% > 29 THEN _day% = 29
             IF _day% > 27 AND _month% = 2 THEN _day% = 27
             IF _day% < 1 THEN _day% = 1
               IF _day% > 28 THEN 
               IF _month% = 2 THEN _day% = 28
               IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
             END IF 
             nextpflege% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
           END IF 
         END IF 
         nextpflege$ = DATE$ (nextpflege%,"0d.mm.yyyy")
         monat$ = LEFT$ ( DATE$ ( TODAY ,"mm0dyyyy"),2)
         jahr$ = LEFT$ ( DATE$ ( TODAY ,"yyyymm0d"),4)
         tag$ = "27"
         REM testdate$ = tag$ + "." + monat$ + "." + jahr$
         testdate$ = bisdDATE$
         testdate% = DAYS (testdate$)
 
         pmonat$ = LEFT$ ( DATE$ (nextpflege%,"mm0dyyyy"),2)
         pjahr$ = LEFT$ ( DATE$ (nextpflege%,"yyyymm0d"),4)
         ptag$ = "01"
         ptestdate$ = ptag$ + "." + pmonat$ + "." + pjahr$
         ptestdate% = DAYS (ptestdate$)
         jetztverarb% = 0

         IF apjn.vpgekond = "j" OR VDjn.vpgekond = "j" THEN 
           jetztverarb% = - 1
           REM IF gez_Abschlu·.kvskond = "j" THEN 
             IF ptestdate% <= testdate% THEN 
               ' AP gezahlt , Pflege ist ran und mu· gezahlt werden
               art% = 3
               remark$ = "Pflege "
               bdatum% = nextpflege%
               REM 13022003
               IF PflegevomNetto.stamm = "j" OR PflegevomNetto.vpgekond = "j" THEN 
                 IF PflegeNachBei.vpgekond < 1 THEN 
                   prov% = ((NettoBeitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                 ELSE 
                   prov% = ((NettoBeitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                 END IF 
               ELSE 
                 IF PflegeNachBei.vpgekond < 1 THEN 
                   prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                 ELSE 
                   prov% = ((Beitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                 END IF 
               END IF 
               letztePflege.kvskond = bdatum%
               ddatum% = bdatum%
               STORE FILE "KVSKOND"
               UNLOCK CURRENT FILE "KVSKOND"
               SELECT CURRENT LOCK FILE "KVSKOND"
               IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > bdatum% THEN 
                 CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
               END IF 
             END IF 
           REM END IF 
         ELSE 
           IF courtagejn.vpgekond = "j" THEN 
             jetztverarb% = - 1
             IF ptestdate% <= testdate% THEN 
               ' Courtage gezahlt , Pflege ist ran und mu· gezahlt werden
               art% = 3
               remark$ = "Pflege "
               bdatum% = nextpflege%
               bdatum$ = DATE$ (bdatum%,"0d.mm.yyyy")
               ddatum% = bdatum%
               IF PflegevomNetto.stamm = "j" OR PflegevomNetto.vpgekond = "j" THEN 
                 IF PflegeNachBei.vpgekond < 1 THEN 
                   prov% = ((NettoBeitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                 ELSE 
                   prov% = ((NettoBeitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                 END IF 
               ELSE 
                 IF PflegeNachBei.vpgekond < 1 THEN 
                   prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                 ELSE 
                   prov% = ((Beitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                 END IF 
               END IF 
               REM prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
               letztePflege.kvskond = bdatum%
               STORE FILE "KVSKOND"
               UNLOCK CURRENT FILE "KVSKOND"
               SELECT CURRENT LOCK FILE "KVSKOND"
               IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > bdatum% THEN 
                 IF prov% <> 0 OR sr% <> 0 THEN CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
               END IF 
             END IF 
           ELSE 
             IF Monatjn.vpgekond = "j" THEN 
               jetztverarb% = - 1
               REM IF gez_Monat.kvskond = "j" THEN 
                 IF ptestdate% <= testdate% THEN 
                   ' Monat gezahlt , Pflege ist ran und mu· gezahlt werden
                   art% = 3
                   remark$ = "Pflege "
                   bdatum% = nextpflege%
                   ddatum% = bdatum%
                   IF PflegevomNetto.stamm = "j" OR PflegevomNetto.vpgekond = "j" THEN 
                     IF PflegeNachBei.vpgekond < 1 THEN 
                       prov% = ((NettoBeitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                     ELSE 
                       prov% = ((NettoBeitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                     END IF 
                   ELSE 
                     IF PflegeNachBei.vpgekond < 1 THEN 
                       prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                     ELSE 
                       prov% = ((Beitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                     END IF 
                   END IF 
                   REM prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                   letztePflege.kvskond = bdatum%
                   STORE FILE "KVSKOND"
                   UNLOCK CURRENT FILE "KVSKOND"
                   SELECT CURRENT LOCK FILE "KVSKOND"
                   IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > bdatum% THEN 
                     CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
                   END IF 
                 END IF 
               REM END IF 
             ELSE 
               IF PauschaleJN.vpgekond = "j" THEN 
                 jetztverarb% = - 1
                 REM IF gez_Pauschale.kvskond = "j" THEN 
                   IF ptestdate% <= testdate% THEN 
                     ' Pauschale gezahlt , Pflege ist ran und mu· gezahlt werden
                     art% = 3
                     remark$ = "Pflege "
                     bdatum% = nextpflege%
                     ddatum% = bdatum%
                     IF PflegevomNetto.stamm = "j" OR PflegevomNetto.vpgekond = "j" THEN 
                       IF PflegeNachBei.vpgekond < 1 THEN 
                         prov% = ((NettoBeitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                       ELSE 
                         prov% = ((NettoBeitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                       END IF 
                     ELSE 
                       IF PflegeNachBei.vpgekond < 1 THEN 
                         prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                       ELSE 
                         prov% = ((Beitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                       END IF 
                     END IF 

                     REM prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                     letztePflege.kvskond = bdatum%
                     STORE FILE "KVSKOND"
                     UNLOCK CURRENT FILE "KVSKOND"
                     SELECT CURRENT LOCK FILE "KVSKOND"
                     IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > bdatum% THEN 
                       CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
                     END IF 
                   END IF 
                 REM END IF 
               ELSE 
                 REM nix angekreuzt, also nur Pflege
                 IF ptestdate% <= testdate% THEN 
                     ' Pauschale gezahlt , Pflege ist ran und mu· gezahlt werden
                     art% = 3
                     remark$ = "Pflege "
                     bdatum% = nextpflege%
                     ddatum% = bdatum%
                     IF PflegevomNetto.stamm = "j" OR PflegevomNetto.vpgekond = "j" THEN 
                       IF PflegeNachBei.vpgekond < 1 THEN 
                         prov% = ((NettoBeitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                       ELSE 
                         prov% = ((NettoBeitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                       END IF 
                     ELSE 
                       IF PflegeNachBei.vpgekond < 1 THEN 
                         prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                       ELSE 
                         prov% = ((Beitrag.KVERTRAG / 100) * PflegeProvi.vpgekond)
                       END IF 
                     END IF 
                     REM prov% = ((Beitrag.KVERTRAG * zw.kvertrag / 100) * PflegeProvi.vpgekond)
                     letztePflege.kvskond = bdatum%
                     STORE FILE "KVSKOND"
                     UNLOCK CURRENT FILE "KVSKOND"
                     SELECT CURRENT LOCK FILE "KVSKOND"
                     IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > bdatum% THEN 
                       CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
                     END IF 
                 END IF 
 
               END IF 
             END IF 
           END IF 
         END IF 
       WEND 
       prov% = 0
     END IF 
     IF SRjn.vpgekond LIKE "j" AND vdjn.vpgekond <> "j" THEN 
       sr% = sr.vpgekond
       IF SRHaftung.kvertrag > 0 THEN 
         haftzeit% = SRHaftung.kvertrag
       ELSE 
         haftzeit% = Haftung.vpgekond
       END IF 
       IF haftzeit% > 0 AND sr% > 0 THEN 
         haftdate% = DAYS (VS_Beginn.kvertrag) + (30 * haftzeit%)
         haftdat$ = DATE$ (haftdate%,"0d.mm.yyyy")
       ELSE 
         haftdate% = 0
       END IF 
     ELSE 
       sr% = 0
     END IF 
 
     IF apjn.vpgekond LIKE "j" THEN 
       kond% = ap.vpgekond
       kond1$ = STR$ (kond%,"99999999.0000")
       IF BewertEinm.kvertrag > 0 AND BewertEinmDat.kvertrag > 0 AND gez_BWErstz.kvskond <> "j" THEN 
         prov% = ((BewertEinm.kvertrag / 100) * kond%)
         remark$ = "AP Erstz. "
         ddatum% = BewertEinmDat.kvertrag
         art% = 1
         gez_BWErstz.kvskond = "j"
         STORE FILE "KVSKOND"
         UNLOCK CURRENT FILE "KVSKOND"
         SELECT CURRENT LOCK FILE "KVSKOND"
         IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > ddatum% THEN 
           CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
         END IF 
       END IF 
       IF gez_Abschlu·.kvskond <> "j" THEN 
         Bewertung$ = STR$ (Bewertung%,"99999999.00")
         prov% = ((Bewertung% / 100) * kond%)
         provtest$ = STR$ (prov%,"999999.00")
         REM CALL Fehler(provtest$,"Prov")
         art% = 1
         remark$ = "AP "
         gez_Abschlu·.kvskond = "j"
         ddatum% = beginn%
         letzteProvi.kvskond = ddatum%
         IF Pflegejn.vpgekond <> "j" THEN 
           erledigt.kvskond = "j"
         END IF 
         STORE FILE "KVSKOND"
         UNLOCK CURRENT FILE "KVSKOND"
       END IF 
       GOTO ZVor1611200101
     END IF 

     IF vdjn.vpgekond LIKE "j" THEN 
       IF VS_Dauer.kvertrag <= VD5Dauer.VPGEKOND AND VD5Dauer.VPGEKOND > 0 THEN 
         kond% = VD5AP.VPGEKOND
         sr% = VD5SR.VPGEKOND
         IF SRHaftung.kvertrag > 0 THEN 
           haftzeit% = SRHaftung.kvertrag
         ELSE 
           haftzeit% = VD5HZ.VPGEKOND
         END IF 
       END IF 
       IF VS_Dauer.kvertrag <= VD4Dauer.VPGEKOND AND VD4Dauer.VPGEKOND > 0 THEN 
         kond% = VD4AP.VPGEKOND
         sr% = VD4SR.VPGEKOND
         IF SRHaftung.kvertrag > 0 THEN 
           haftzeit% = SRHaftung.kvertrag
         ELSE 
           haftzeit% = VD4HZ.VPGEKOND
         END IF 
       END IF 
       IF VS_Dauer.kvertrag <= VD3Dauer.VPGEKOND AND VD3Dauer.VPGEKOND > 0 THEN 
         kond% = VD3AP.VPGEKOND
         sr% = VD3SR.VPGEKOND
         IF SRHaftung.kvertrag > 0 THEN 
           haftzeit% = SRHaftung.kvertrag
         ELSE 
           haftzeit% = VD3HZ.VPGEKOND
         END IF 
       END IF 
       IF VS_Dauer.kvertrag <= VD2Dauer.VPGEKOND AND VD2Dauer.VPGEKOND > 0 THEN 
         kond% = VD2AP.VPGEKOND
         sr% = VD2SR.VPGEKOND
         IF SRHaftung.kvertrag > 0 THEN 
           haftzeit% = SRHaftung.kvertrag
         ELSE 
           haftzeit% = VD2HZ.VPGEKOND
         END IF 
       END IF 
       IF VS_Dauer.kvertrag <= VD1Dauer.VPGEKOND AND VD1Dauer.VPGEKOND > 0 THEN 
         kond% = VD1AP.VPGEKOND
         sr% = VD1SR.VPGEKOND
         IF SRHaftung.kvertrag > 0 THEN 
           haftzeit% = SRHaftung.kvertrag
         ELSE 
           haftzeit% = VD1HZ.VPGEKOND
         END IF 
       END IF 
       IF haftzeit% > 0 AND sr% > 0 THEN 
         haftdate% = DAYS (VS_Beginn.kvertrag) + (30 * haftzeit%)
         haftdat$ = DATE$ (haftdate%,"0d.mm.yyyy")
       ELSE 
         haftdate% = 0
       END IF 
       
       REM kond% = ap.vpgekond
       IF BewertEinm.kvertrag > 0 AND BewertEinmDat.kvertrag > 0 AND gez_BWErstz.kvskond <> "j" THEN 
         prov% = ((BewertEinm.kvertrag / 100) * kond%)
         remark$ = "AP Erstz. "
         ddatum% = BewertEinmDat.kvertrag
         art% = 1
         gez_BWErstz.kvskond = "j"
         STORE FILE "KVSKOND"
         UNLOCK CURRENT FILE "KVSKOND"
         SELECT CURRENT LOCK FILE "KVSKOND"
         IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > ddatum% THEN 
           CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
         END IF 
       END IF 
       IF gez_Abschlu·.kvskond <> "j" THEN 
         prov% = ((Bewertung% / 100) * kond%)
         art% = 1
         remark$ = "AP "
         gez_Abschlu·.kvskond = "j"
         ddatum% = beginn%
         letzteProvi.kvskond = ddatum%
         IF Pflegejn.vpgekond <> "j" THEN 
           erledigt.kvskond = "j"
         END IF 
         STORE FILE "KVSKOND"
         UNLOCK CURRENT FILE "KVSKOND"
       END IF 
       GOTO ZVor1611200101
     END IF 
     cpflegebegin$ = DATE$ (cpflegebegin%,"0d.mm.yyyy")
     REM CALL Fehler(cpflegebegin$,"")
     IF Courtagejn.vpgekond LIKE "j" THEN 
       ptestdate% = 0:testdate% = 1
       WHILE ptestdate% <= testdate%
         kond% = Courtage.vpgekond
         czw$ = CourtageZWJN.vpgekond
         cbegin% = DAYS (beginn%)
         cbegin$ = DATE$ (cbegin%,"0d.mm.yyyy")
         z$ = CourtageZWJN.vpgekond
         IF CourtageZWJN.vpgekond = "j" THEN 
           IF letzteProvi.kvskond > 0 THEN 
             REM nextProvi% = letzteProvi.kvskond + (30 * CourtageZW.vpgekond)
             CourtageZW% = CourtageZW.vpgekond
             _day% = DAY (letzteProvi.kvskond)
             _month% = MONTH (letzteProvi.kvskond)
             _year% = YEAR (letzteProvi.kvskond)
             REM 12082002
             _month% = _month% + CourtageZW%
             jahr% = 0
             WHILE _month% > 0
               _year% = _year% + 1
               _month% = _month% - 12
             WEND 
             IF _month% <= 0 THEN 
               _year% = _year% - 1
               _month% = _month% + 12
             END IF 
             IF _day% < 1 THEN _day% = 1
               IF _day% > 28 THEN 
               IF _month% = 2 THEN _day% = 28
               IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
             END IF 
             nextProvi% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
           ELSE 
             REM 22052002 ******************************************
             IF BewertEinm.kvertrag > 0 AND BewertEinmDat.kvertrag > 0 AND gez_BWErstz.kvskond <> "j" THEN 
               REM CALL Fehler("Courtage Erstzahl.","alle x Monate")
               prov% = ((BewertEinm.kvertrag / 100) * kond%)
               remark$ = "Courtage Erstz. "
               REM ddatum% = VS_Beginn.kvertrag
               ddatum% = BewertEinmDat.kvertrag
               ddatumab1$ = DATE$ (BewertEinmDat.kvertrag,"0d.mm.yyyy")
               ddatumab2$ = "01" + RIGHT$ (ddatumab1$,8)
               art% = 2
               gez_BWErstz.kvskond = "j"
               REM letzteProvi.kvskond = VS_Beginn.kvertrag
               letzteProvi.kvskond = DAYS (ddatumab2$)
               STORE FILE "KVSKOND"
               UNLOCK CURRENT FILE "KVSKOND"
               SELECT CURRENT LOCK FILE "KVSKOND"
               IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > ddatum% THEN 
                 CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
               END IF 
               ddatumab1$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
               ddatumab2$ = "01" + RIGHT$ (ddatumab1$,8)
               nextProvi% = DAYS (ddatumab2$)
               REM nextProvi% = VS_Beginn.kvertrag
               GOTO courtend220520021
               REM 22052002 Ende *************************************
             ELSE 
               REM nextProvi% = cbegin%
               REM 12082002*********************************************************************************************
               IF letzteProvi.kvskond > 0 THEN 
                 cbegin$ = DATE$ (cbegin%,"0d.mm.yyyy")
                 _day% = DAY (cbegin%)
                 _month% = MONTH (cbegin%)
                 _year% = YEAR (cbegin%)
                 SELECT CASE ZW.KVERTRAG
                 CASE 1
                  _year% = _year% + 1
                 CASE 2
                   REM halbjahrlich
                   _month% = _month% + 6
                   IF _month% > 12 THEN 
                     _year% = _year% + 1
                     _month% = _month% - 12
                   END IF 
                 CASE 4
                   REM viertelÑhrlich
                   _month% = _month% + 3
                   IF _month% > 12 THEN 
                     _year% = _year% + 1
                     _month% = _month% - 12
                   END IF 
                 CASE 6
                   REM 2 monatlich
                   _month% = _month% + 2
                   IF _month% > 12 THEN 
                     _year% = _year% + 1
                     _month% = _month% - 12
                   END IF 
                 CASE 12
                   REM monatlich
                   _month% = _month% + 1
                   IF _month% > 12 THEN 
                     _year% = _year% + 1
                     _month% = _month% - 12
                   END IF 
                 CASE 0
                   REM einmalig
                   _year% = 2100
                 END SELECT 
                 IF _day% > 29 THEN _day% = 29
                 IF _day% > 27 AND _month% = 2 THEN _day% = 27
                 IF _day% < 1 THEN _day% = 1
                   IF _day% > 28 THEN 
                   IF _month% = 2 THEN _day% = 28
                   IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
                 END IF 
                 nextProvi% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
               ELSE 
                 REM Start ist fÅr Courtage der 1. Monat
                 _day% = DAY (cbegin%)
                 _month% = MONTH (cbegin%)
                 _year% = YEAR (cbegin%)
                 IF _day% > 29 THEN _day% = 29
                 IF _day% > 27 AND _month% = 2 THEN _day% = 27
                 IF _day% < 1 THEN _day% = 1
                   IF _day% > 28 THEN 
                   IF _month% = 2 THEN _day% = 28
                   IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
                 END IF 
                 nextProvi% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
               END IF 
               REM 12082002 Ende ***************************************************************************************
             END IF 
           END IF 
         ELSE 
           IF letzteProvi.kvskond > 0 THEN 
             cbegin% = letzteProvi.kvskond
             cbab$ = DATE$ (cbegin%,"0d.mm.yyyy")
             REM 31072003 cbab$ hat das vorausgerechnete Datum, obwohl die SollstellungssÑtze gelîscht wurden
           ELSE 
             REM 22052002 ******************************************
             REM CALL Fehler("Courtage Erstzahl.","nach Zahlweise")
             IF BewertEinm.kvertrag > 0 AND BewertEinmDat.kvertrag > 0 AND gez_BWErstz.kvskond <> "j" THEN 
               prov% = ((BewertEinm.kvertrag / 100) * kond%)
               remark$ = "Courtage Erstz. "
               REM ddatum% = VS_Beginn.kvertrag
               ddatum% = BewertEinmDat.kvertrag
               art% = 2
               gez_BWErstz.kvskond = "j"
               ddatumab1$ = DATE$ (BewertEinmDat.kvertrag,"0d.mm.yyyy")
               ddatumab2$ = "01" + RIGHT$ (ddatumab1$,8)
               letzteProvi.kvskond = DAYS (ddatumab2$)
               REM letzteProvi.kvskond = VS_Beginn.kvertrag
               STORE FILE "KVSKOND"
               UNLOCK CURRENT FILE "KVSKOND"
               SELECT CURRENT LOCK FILE "KVSKOND"
               IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > ddatum% THEN 
                 CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
               END IF 
               ddatumab1$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
               ddatumab2$ = "01" + RIGHT$ (ddatumab1$,8)
               nextProvi% = DAYS (ddatumab2$)
               REM nextProvi% = VS_Beginn.kvertrag
               GOTO courtend220520021
             END IF 
             REM 22052002 Ende ************************************* 
             REM 22052002 beginn$ = DATE$ (beginn%,"0d.mm.yyyy")
             REM 22052002 cbegin% = beginn%
           END IF 
           IF letzteProvi.kvskond > 0 THEN 
             cbegin$ = DATE$ (cbegin%,"0d.mm.yyyy")
             _day% = DAY (cbegin%)
             _month% = MONTH (cbegin%)
             _year% = YEAR (cbegin%)
             SELECT CASE ZW.KVERTRAG
             CASE 1
               _year% = _year% + 1
             CASE 2
               REM halbjahrlich
               _month% = _month% + 6
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 4
               REM viertelÑhrlich
               _month% = _month% + 3
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 6
               REM 2 monatlich
               _month% = _month% + 2
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 12
               REM monatlich
               _month% = _month% + 1
               IF _month% > 12 THEN 
                 _year% = _year% + 1
                 _month% = _month% - 12
               END IF 
             CASE 0
               REM einmalig
               _year% = 2100
             END SELECT 
             IF _day% > 29 THEN _day% = 29
             IF _day% > 27 AND _month% = 2 THEN _day% = 27
             IF _day% < 1 THEN _day% = 1
               IF _day% > 28 THEN 
               IF _month% = 2 THEN _day% = 28
               IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
             END IF 
             nextProvi% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
           ELSE 
             REM Start ist fÅr Courtage der 1. Monat
             _day% = DAY (cbegin%)
             _month% = MONTH (cbegin%)
             _year% = YEAR (cbegin%)
             IF _day% > 29 THEN _day% = 29
             IF _day% > 27 AND _month% = 2 THEN _day% = 27
                 IF _day% < 1 THEN _day% = 1
                   IF _day% > 28 THEN 
                   IF _month% = 2 THEN _day% = 28
                   IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
                 END IF 
             nextProvi% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
           END IF 
           nextprovi$ = DATE$ (nextprovi%,"0d.mm.yyyy")
         END IF 
         nextProvi$ = DATE$ (nextProvi%,"0d.mm.yyyy")
         monat$ = LEFT$ ( DATE$ ( TODAY ,"mm0dyyyy"),2)
         jahr$ = LEFT$ ( DATE$ ( TODAY ,"yyyymm0d"),4)
         tag$ = "27"
         REM testdate$ = tag$ + "." + monat$ + "." + jahr$
         testdate$ = bisdDATE$
         testdate% = DAYS (testdate$)
      
         pmonat$ = LEFT$ ( DATE$ (nextProvi%,"mm0dyyyy"),2)
         pjahr$ = LEFT$ ( DATE$ (nextProvi%,"yyyymm0d"),4)
         ptag$ = "01"
         ptestdate$ = ptag$ + "." + pmonat$ + "." + pjahr$
         ptestdate% = DAYS (ptestdate$)
         mm% = MONTH (letztePflege.kvskond)
         IF ptestdate% <= testdate% THEN 
           cpfleg$ = DATE$ (cpflegebegin%,"0d.mm.yyyy")
           IF cpflegebegin% > 0 THEN 
             mm% = MONTH (cpflegebegin%)
             yy% = YEAR (cpflegebegin%)
             IF _year% < yy% THEN ok% = - 1
             IF _year% > yy% THEN 
               ok% = 0
               ptestdate% = testdate% + 10
             END IF 
             IF _year% = yy% THEN 
               IF _month% < mm% THEN 
                 ok% = - 1
               ELSE 
                 ok% = 0
                 ptestdate% = testdate% + 10
               END IF 
             END IF 
             IF AnzCourtZahl% > 0 AND AnzCourtZahlung.kvskond = AnzCourtZahl% THEN ok% = 0
           ELSE 
             REM 1412200101
             ok% = - 1
             IF AnzCourtZahl% > 0 AND AnzCourtZahlung.kvskond = AnzCourtZahl% THEN ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             REM CALL Fehler(nextprovi$,"")
             art% = 2
             remark$ = "Courtage "
             letzteProvi.kvskond = nextprovi%
             ddatum% = nextprovi%
             kond% = Courtage.vpgekond
             prov% = ((Bewertung% / 100) * kond%)
             AnzCourtZahlung.kvskond = AnzCourtZahlung.kvskond + 1
             STORE FILE "KVSKOND"
             UNLOCK CURRENT FILE "KVSKOND"
             SELECT CURRENT LOCK FILE "KVSKOND"
             IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > nextprovi% THEN 
               CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
             END IF 
           ELSE 
             REM CALL Fehler(nextprovi$,"ok%=0")
             ddatum% = nextprovi%
             letzteProvi.kvskond = nextprovi%
             STORE FILE "KVSKOND"
             UNLOCK CURRENT FILE "KVSKOND"
             SELECT CURRENT LOCK FILE "KVSKOND"
           END IF 
           
         END IF 
courtend220520021: 
       WEND 
       prov% = 0
     END IF 
 
     IF (APKVMonatjn.vpgekond LIKE "j" AND KVMonatFakt.vpgekond > 0) OR (APPfMonatjn.vpgekond LIKE "j" AND PflMonatFakt.vpgekond > 0) THEN 
       IF APKVMonatjn.vpgekond LIKE "j" OR APPfMonatjn.vpgekond LIKE "j" THEN 
         IF gez_Monat.kvskond <> "j" THEN 
           prov% = NettoBeitrag.kvertrag * KVMonatfakt.vpgekond
           IF Pflegejn.vpgekond <> "j" THEN 
             erledigt.kvskond = "j"
           END IF 
           art% = 4
           remark$ = "AP KV "
           gez_Monat.kvskond = "j"
           ddatum% = beginn%
           letzteProvi.kvskond = ddatum%
           STORE FILE "KVSKOND"
           IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > ddatum% THEN 
             CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
           END IF 
           UNLOCK CURRENT FILE "KVSKOND"
           remark$ = "AP PFPF "
           prov% = Pflegepflicht.kvertrag * PflMonatfakt.vpgekond
           GOTO ZVor1611200101
         END IF 
       END IF 
     END IF 




     IF Monatjn.vpgekond LIKE "j" THEN 
       IF gez_Monat.kvskond <> "j" THEN 
         IF MonatBrutto.vpgekond LIKE "j" THEN 
           prov% = Beitrag.kvertrag * Monatfakt.vpgekond
         ELSE 
           prov% = NettoBeitrag.kvertrag * Monatfakt.vpgekond
         END IF 
         art% = 4
         remark$ = "AP "
         gez_Monat.kvskond = "j"
         IF Pflegejn.vpgekond <> "j" THEN 
           erledigt.kvskond = "j"
         END IF 
         
         ddatum% = beginn%
         letzteProvi.kvskond = ddatum%
         STORE FILE "KVSKOND"
         UNLOCK CURRENT FILE "KVSKOND"
         GOTO ZVor1611200101
       END IF 
     END IF 


     IF Pauschalejn.vpgekond LIKE "j" THEN 
       IF gez_Pauschale.kvskond <> "j" THEN 
         prov% = Pauschale.vpgekond
         gez_Pauschale.kvskond = "j"
         ddatum% = beginn%
         art% = 1
         remark$ = "AP Pausch."
         letzteProvi.kvskond = ddatum%
         IF Pflegejn.vpgekond <> "j" THEN 
           erledigt.kvskond = "j"
         END IF 
         STORE FILE "KVSKOND"
         UNLOCK CURRENT FILE "KVSKOND"
         GOTO ZVor1611200101
       END IF 
     END IF 
ZVor1611200101: 
     IF prov% <> 0 THEN 
       IF kÅndigung.kvertrag < 1 OR kÅndigung.kvertrag > ddatum% THEN 
         CALL SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
       END IF 
     END IF 
 
   END IF 

   FILE "KVSKOND"
   IF codevttmp% < 1 THEN SELECT NEXT LOCK FILE "kvskond" INDEX erledigt.kvskond
   IF codevttmp% <> 0 THEN SELECT NEXT LOCK FILE "kvskond" INDEX codevt.kvskond
end230420065: 
 WEND 
 REM Test auf abdat%, sollstellungen ab ein bestimmtes Datum erzeugen, d.h. alle wurden erzeugt 
 REM und jetzt die Lîschen, die mit Datum kleiner sind
 REM CALL Fehler("codevttmp%","")
 IF codevttmp% <> 0 AND abdat% > 0 THEN 
   MOUSE OFF 
   IF EXISTS (codevttmp%,codevt.zeinvor) THEN 
     FILE "zeinvor"
     SELECT FIRST FILE "zeinvor" INDEX codevt.zeinvor
     SELECT KEY codevttmp% LOCK FILE "zeinvor" INDEX codevt.zeinvor
     WHILE NOT EOF ("zeinvor") AND codevt.zeinvor = codevttmp%
       IF FÑlligkeit.zeinvor < abdat% AND codevt.zeinvor = codevttmp% THEN 
         SELECT REMOVE FILE "zeinvor"
         SELECT FIRST FILE "zeinvor" INDEX codevt.zeinvor
         IF EXISTS (codevttmp%,codevt.zeinvor) THEN 
           SELECT KEY codevttmp% LOCK FILE "zeinvor" INDEX codevt.zeinvor
         END IF 
       ELSE 
         SELECT NEXT LOCK FILE "zeinvor" INDEX codevt.zeinvor
       END IF 
     WEND 
     REM REMOVE FROM FILE "zeinvor" WHERE codevt.zeinvor = codevttmp% AND FÑlligkeit.zeinvor < abdat%
   END IF 
 END IF 
 IF x% = 1 THEN REQUEST "Alle Sollstellungen wurden erstellt!","",2
soll12082002end: 
 MOUSE ON 
 END SUB 
 
 
 'generiert einen Zahlungseingangssatz in der Vorschlagsdatei
SUB SollGenerate(remark$,prov%,sr%,art%,bdatum%,ddatum%,haftdate%)
  BLANK FILE "zeinvor"
  codekey% = SER ("ZEINVOR",1)
  codekey.zeinvor = codekey%
  codevt.zeinvor = lfdnr.kvertrag
  codege.zeinvor = codege.kvertrag
  codeva.zeinvor = Codeva.kvertrag
  codevp.zeinvor = codevp.kvertrag
  codeku.zeinvor = codeku.kvertrag
  workstation.zeinvor = workstation.kvertrag
  FÑlligkeit.zeinvor = ddatum%
  FaelSR.zeinvor = haftdate%
  vsnr$ = remark$ + VS_Nr.kvertrag
  Buchungstext.zeinvor = remark$ + VS_Nr.kvertrag
  vs_nr.zeinvor = VS_Nr.kvertrag
  sr.zeinvor = ((prov% / 100) * sr%)
  sreu.zeinvor = VAL ( STR$ (sr.zeinvor / umrechnung.kvertrag,"999999999.00"))
  Bewertung.zeinvor = prov% - sr.zeinvor
  BewertungEu.zeinvor = VAL ( STR$ (Bewertung.zeinvor / umrechnung.kvertrag,"999999999.00"))
  codew.zeinvor = Codew.kvertrag
  Waehrung.zeinvor = Waehrung.kvertrag
  Umrechnung.zeinvor = Umrechnung.kvertrag
  QuickVSNR.zeinvor = VSNRPack$(VS_Nr.zeinvor)
  IF remark$ LIKE "AP*" THEN 
    kondart.zeinvor = 0
  END IF 
  IF remark$ LIKE "Court*" THEN 
    kondart.zeinvor = 1
  END IF 
  IF remark$ LIKE "Pfl*" THEN 
    kondart.zeinvor = 2
  END IF 
  CodeEingGE.zeinvor = CodeEingGE.kvertrag
  EingereichtBei.zeinvor = EingereichtBei.kvertrag
  STORE FILE "zeinvor"
  UNLOCK CURRENT FILE "zeinvor"
 
 
 
 END SUB 
 
 
 
 
 
 '      *************************************************
 '      ** Routinen fÅr Sollstellung KVERTRAG**
 '      *************************************************
 ' wenn codevt%=0 dann so wie immer
 ' wenn codevt%>0 dann Sollstellung von KVERTRAG aus
SUB ZEINVOR(codevt%)
 IF disabled%("ZEINVOR") THEN END SUB 
 REM CALL DFile(3,"zeinvor" + _fpw$)
 FILE "zeinvor"
 ON ERROR GOTO inde101120031
 REM CALL FldAdd1("CodeVP","NUM;000000.",1)
 SAVE FILE "zeinvor"
inde101120031: 
 ON ERROR GOTO ErrorHandler
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "zeinvor" WHERE codevt.zeinvor < 1
 MOUSE ON 
 CALL DFile(30,"KVERTRAG" + _fpw$)
 CALL DFile(20,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(30,"geadr" + _fpw$)
 CALL DFile(30,"sparten" + _fpw$)
 CALL DFile(30,"maadr" + _fpw$)
 CALL DFile(30,"maadrgru" + _fpw$)
 CALL DFile(3,"zeingan1" + _fpw$)
 FILE "zeinvor"
 INDEX codekey.zeinvor
 SELECT FIRST 
 _formend% = 0
 IF codevt% < 1 THEN 
   maske$ = "EINGZVO1"
   GCodeGE% = 0
   GsVSNR$ = ""
 END IF 
 IF codevt% <> 0 THEN maske$ = "EINGZVOR"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - SollstellungsvorschlÑge"
     OPEN FORM GPrjForm$ + maske$
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\Sollstel.pdf"
     REM IF maske$ <> "EINGANGK" THEN SET FORM OFF Uebers$
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     lAussenstand$ = ""
     eingbei$ = ""
     CALL ZVORIntro1(codevt%)
     CALL MNZEIVOR()
     SET STATUS "ZahlungseingÑnge"
     IF RECCOUNT ("zeinvor") > 0 THEN CALL ZEIVUpdate1(codevt%)
   END IF 
   FORM 
   MENU ON 
   MOUSE ON 
   ZEINsub% = 0
   REM IF RECCOUNT ("zeinvor") > 0 THEN CALL ZEIVUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF ZEINsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL ZVorPrev1()
   CASE CrsRight%,PgDn%
     CALL ZVorNext1()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZEINsub%
   CASE 1
     REM öberfÅhrung in Zahlungseingang
     codekey% = codekey.zeinvor
     codevt% = codevt.zeinvor
     SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
     SELECT KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
     bewert% = Bewertungssumme.kvertrag
     bewert$ = LTRIM$ ( STR$ (Bewertungssumme.kvertrag,",999999999.00"))
     IF disabled%("SOLLSTELLUNGUEBE") THEN GOTO sollign270220021
     REQUEST "Wollen Sie diese Sollstellung in den Zahlungseingang ÅberfÅhren?","",130,req%
     IF FirmaEinhTab.stamm = "j" THEN 
       GSollNeu% = 1
     ELSE 
       GSollNeu% = 0
     END IF 
     REM Alte Methode*****************************************************************************************
     IF req% = 1 AND GSollNeu% <> 1 THEN 
       anp$ = LTRIM$ ( STR$ (Bewertung.zeinvor + sr.zeinvor,",999999999.00"))
       anpold% = Bewertung.zeinvor + sr.zeinvor
       CREATE DIALOG "ANPASSUNG",0,0,250,94,"Sollstellung","MS Sans Serif",8
       ADD DIALOG "ANPASSUNG",5,6,6,156,10,0,"öberfÅhrung Soll in den Zahlungseingang:"
       ADD DIALOG "ANPASSUNG",5,6,20,230,8,0,"Bitte geben Sie die Hîhe des ZE-Betrages ein.Wenn der"
       ADD DIALOG "ANPASSUNG",5,6,30,230,8,0,"ZE-Bertrag <> Sollbetrag bleibt, die Differenz in der Sollstellung erhalten"
       ADD DIALOG "ANPASSUNG",6,46,49,69,13,0,0,anp$,14
       ADD DIALOG "ANPASSUNG",6,169,49,69,13,0,0,bewert%,14
       ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Betrag:"
       ADD DIALOG "ANPASSUNG",5,129,49,38,11,0,"Bewertung:"
       REM ADD DIALOG "ANPASSUNG",5,86,52,7,8,0,""
       ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
       ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
       DIALOG "ANPASSUNG",req%
       REMOVE DIALOG "ANPASSUNG"
       anp% = VAL (anp$)
       anp$ = LTRIM$ ( STR$ (anp%,",999999999.00"))
       IF req% = 1 AND anp% <> 0 THEN 
         SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
         SELECT KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
         SELECT FIRST FILE "VPRODUKT" INDEX codevp.vprodukt
         SELECT KEY codevp.kvertrag FILE "VPRODUKT" INDEX codevp.vprodukt
 
         CLOSE FILE "zeingan1"
         CALL DFile(3,"zeingan1" + _fpw$)
         FILE "zeingan1"
         BLANK FILE "ZEINGAN1"
         a% = CopyRecord%("zeinvor","ZEINGAN1")
         IF a% = - 1 THEN 
           codeaz% = SER ("ZEINGAN1",1)
           codeaz.zeingan1 = codeaz%
           BewertKV.zeingan1 = bewert%
           REM STORE FILE "zeingan1"
           REM SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
           Buchungsdatum.zeingan1 = TODAY 
           IF GZEDat% > 0 THEN 
             BuchungsDatum.zeingan1 = DATE$ (GZEDat%,"0d.mm.yyyy")
           ELSE 
             BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
           END IF 
           IF Buchungstext.zeinvor LIKE "AP*" AND kondart.zeinvor <> - 1 THEN 
             kondart.zeingan1 = 0
           END IF 
           IF Buchungstext.zeinvor LIKE "Co*" AND kondart.zeinvor <> - 1 THEN 
             kondart.zeingan1 = 1
           END IF 
           IF Buchungstext.zeinvor LIKE "Pf*" AND kondart.zeinvor <> - 1 THEN 
             kondart.zeingan1 = 2
           END IF 
           IF Buchungstext.zeinvor LIKE "Dyn*" AND kondart.zeinvor <> - 1 THEN 
             kondart.zeingan1 = 4
           END IF 
           IF Buchungstext.zeinvor LIKE "Betreu*" AND kondart.zeinvor <> - 1 THEN 
             kondart.zeingan1 = 5
           END IF 
           bewertung.zeingan1 = VAL (anp$)
           bewertungeu.zeingan1 = VAL ( STR$ (bewertung.zeingan1 / umrechnung.zeingan1,"99999999.00"))
           REM STORE FILE "zeingan1"
 
           mwst.zeingan1 = mwst.vprodukt
           IF ZahlBertrMin.vprodukt <> 0 OR ZahlBertrMax.vprodukt <> 0 THEN 
             zmin% = ZahlBertrMin.vprodukt
             zmax% = ZahlBertrMax.vprodukt
           ELSE 
             SELECT FIRST FILE "sparten" INDEX codeva.sparten
             SELECT KEY codeva.kvertrag FILE "sparten" INDEX codeva.sparten
             zmin% = ZahlBertrMin.sparten
             zmax% = ZahlBertrMax.sparten
           END IF 
           ZahlBertrMin.zeingan1 = zmin%
           ZahlBertrMax.zeingan1 = zmax%
           CALL BetrNett()
           CALL QuickStore("ZEINGAN1")
           FILE "zeinvor"
 
           SELECT KEY codekey% LOCK FILE "zeinvor" INDEX codekey.zeinvor
           anpold$ = STR$ (anpold%,"999999999.00")
           anp$ = STR$ (anp%,"999999999.00")
           anp% = VAL (anp$)
           anpold% = VAL (anpold$)
           IF anpold% = anp% THEN 
             SELECT REMOVE FILE "zeinvor"
             REQUEST "Sollstellung wurde in den ZE ÅberfÅhrt","",2
           ELSE 
             xt% = anpold% - anp%
             IF sr.zeinvor > 0 THEN 
               bw% = Bewertung.zeinvor - anp%
               IF bw% > 0 THEN 
                 Bewertung.zeinvor = bw%
               ELSE 
                 Bewertung.zeinvor = 0
                 sr.zeinvor = sr.zeinvor + bw%
                 REM sreu.zeinvor = sreu.zeinvor + bw%
               END IF 
               REM sr.zeinvor = 0
               REM sreu.zeinvor = 0
               rest$ = " - Rest aus Soll: " + LTRIM$ ( STR$ (Bewertung.zeinvor,",9999999.00")) + "/aus SR: " + LTRIM$ ( STR$ (sr.zeinvor,",9999999.00"))
               IF notiz.zeinvor <> "" THEN 
                 notiz.zeinvor = notiz.zeinvor + CHR$ (13) + CHR$ (10) + DATE$ ( TODAY ,"0d.mm.yyyy") + "  Sollbetrag war: " + LTRIM$ ( STR$ (anpold%,",999999999.00")) + " davon an ZE ÅberfÅhrt: " + LTRIM$ (anp$) + rest$
               ELSE 
                 notiz.zeinvor = DATE$ ( TODAY ,"0d.mm.yyyy") + "  Sollbetrag war: " + LTRIM$ ( STR$ (anpold%,",999999999.00")) + " davon an ZE ÅberfÅhrt: " + LTRIM$ (anp$) + rest$
               END IF 
               REM 05052003
               FÑlligkeit.zeinvor = FÑlligkeit.zeinvor + (SRHaftung.kvertrag * 30)
             ELSE 
               Bewertung.zeinvor = anpold% - anp%
               REM Bewertungeu.zeinvor = VAL ( STR$ (Bewertung.zeinvor / umrechnung.zeinvor,"99999999.00"))
               sr.zeinvor = 0
               REM sreu.zeinvor = 0
               notiz.zeinvor = notiz.zeinvor + "   " + DATE$ ( TODAY ,"0d.mm.yyyy") + "  Sollbetrag war: " + LTRIM$ ( STR$ (anpold%,",999999999.00")) + " davon an ZE ÅberfÅhrt: " + LTRIM$ (anp$)
             END IF 
             CALL MATimeStamp("zeinvor")
             BewertungEU.zeinvor = VAL ( STR$ (Bewertung.zeinvor / Umrechnung.zeinvor,"99999999.00"))
             SREU.zeinvor = VAL ( STR$ (SR.zeinvor / Umrechnung.zeinvor,"99999999.00"))
             STORE FILE "zeinvor"
             UNLOCK CURRENT FILE "zeinvor"
           END IF 
         END IF 
       ELSE 
         CALL Fehler("Der Sollstellungsvorschlag konnte nicht in den Zahlungseingang ÅberfÅhrt werden!","")
       END IF 
       IF maske$ = "EINGZVOR" THEN 
         IF EXISTS (codevt%,codevt.zeinvor) THEN 
           FILE "zeinvor"
           INDEX codekey.zeinvor
           SELECT FIRST 
           REM OPEN FORM maske$
           REM SET f = Superbase.Form
           SELECT FORM FIRST 
           FORM 
           CALL ZVORIntro1(codevt%)
           CALL ZEIVUpdate1(codevt%)
           ZEINsub% = 0
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen zu diesem Vertrag!","")
           _formend% = 1
         END IF 
       ELSE 
         IF RECCOUNT ("zeinvor") > 0 THEN 
           IF EXISTS (codevt%,codevt.zeinvor) THEN 
             SELECT FIRST FILE "zeinvor" INDEX codekey.zeinvor
             SELECT FORM KEY codevt% FILE "zeinvor" INDEX codevt.zeinvor
             FORM 
             CALL ZVORIntro1(codevt%)
             CALL ZEIVUpdate1(codevt%)
             ZEINsub% = 0
           ELSE 
             SELECT FORM FIRST FILE "zeinvor" INDEX codekey.zeinvor
             FORM 
           END IF 
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen!","")
           _formend% = 1
         END IF 
       END IF 
     END IF 
     REM Alte Methode Ende************************************************************************************

     REM Neue Methode Anfang *********************************************************************************
     IF req% = 1 AND GSollNeu% = 1 THEN 
       anp$ = LTRIM$ ( STR$ (Bewertung.zeinvor + sr.zeinvor,",999999999.00"))
       anpold% = Bewertung.zeinvor + sr.zeinvor
       sr$ = LTRIM$ ( STR$ (sr.zeinvor,",9999999.00"))
       srold% = VAL (sr$)
       ze$ = LTRIM$ ( STR$ (Bewertung.zeinvor,",9999999.00"))
       anpold% = VAL (ze$) + VAL (sr$)
       gebetr$ = LTRIM$ ( STR$ (anpold%,",99999999.00"))
       opt% = kondart.zeinvor
       CREATE DIALOG "ANPASSUNG",0,0,450,144,"Sollstellung","MS Sans Serif",8
       ADD DIALOG "ANPASSUNG",5,6,6,156,10,0,"öberfÅhrung Soll in den Zahlungseingang:"
       ADD DIALOG "ANPASSUNG",5,6,20,230,8,0,"Bitte geben Sie die Hîhe des ZE-Betrages ein. Wenn der"
       ADD DIALOG "ANPASSUNG",5,6,30,230,8,0,"ZE-Bertrag <> Sollbetrag ist, bleibt die Differenz in der Sollstellung erhalten"
       ADD DIALOG "ANPASSUNG",6,46,49,69,13,0,0,ze$,14
       ADD DIALOG "ANPASSUNG",6,169,49,69,13,0,0,sr$,14
       ADD DIALOG "ANPASSUNG",6,46,68,69,13,0,0,bewert$,14
       ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"ZE-Betrag:"
       ADD DIALOG "ANPASSUNG",5,6,58,38,11,0,"ohne SR:"
       ADD DIALOG "ANPASSUNG",5,6,70,38,11,0,"Bewertung:"
       ADD DIALOG "ANPASSUNG",5,6,92,108,11,0,"fÑlliger Gesamtbetrag: " + gebetr$
       ADD DIALOG "ANPASSUNG",5,129,49,38,11,0,"SR-Betrag:"
       ADD DIALOG "ANPASSUNG",5,129,61,128,32,0,"der SR-Betrag kann nur als Einmal Bertrag in den ZE ÅberfÅhrt werden, dazu die Checkbox ankreuzen"
       REM ADD DIALOG "ANPASSUNG",5,129,49,38,11,0,"SR-Betrag:"
       ADD DIALOG "ANPASSUNG",2,129,89,160,11,0,"SR-Zahlung (darf nur AP sein)","j","n",srz$


       ADD DIALOG "ANPASSUNG",3,310,49,236,10,0,"AP",0,opt%
       ADD DIALOG "ANPASSUNG",3,310,59,236,10,0,"Courtage",1,opt%
       ADD DIALOG "ANPASSUNG",3,310,69,236,10,0,"Pflege",2,opt%
       ADD DIALOG "ANPASSUNG",3,310,79,236,10,0,"Dynamik",4,opt%
       ADD DIALOG "ANPASSUNG",3,310,89,236,10,0,"Folgeprovision",5,opt%

       ADD DIALOG "ANPASSUNG",1,64,110,50,16,1,"&OK",1,1
       ADD DIALOG "ANPASSUNG",1,116,110,50,16,0,"&Abbruch",0,0
       DIALOG "ANPASSUNG",req%
       REMOVE DIALOG "ANPASSUNG"
       anp% = VAL (ze$)
       anp$ = LTRIM$ ( STR$ (anp%,",999999999.00"))
       sr% = VAL (sr$)
       sr$ = LTRIM$ ( STR$ (sr%,",999999999.00"))
       ze% = VAL (ze$)
       Firmensr% = 0
       IF ze% <> 0 AND srz$ = "j" THEN 
       END IF 
       IF ze% = 0 AND srz$ = "j" THEN 
         ze% = sr%
         IF ze% = srold% THEN 
           anp% = ze%
           anpold% = ze%
         END IF 
       END IF 
       IF req% = 1 AND ze% <> 0 THEN 
         SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
         SELECT KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
         SELECT FIRST FILE "VPRODUKT" INDEX codevp.vprodukt
         SELECT KEY codevp.kvertrag FILE "VPRODUKT" INDEX codevp.vprodukt
 
         CLOSE FILE "zeingan1"
         CALL DFile(3,"zeingan1" + _fpw$)
         FILE "zeingan1"
         BLANK FILE "ZEINGAN1"
         a% = CopyRecord%("zeinvor","ZEINGAN1")
         kondart.zeingan1 = opt%
         SELECT CASE opt%
         CASE 0
           Buchungstext.zeingan1 = "AP: " + VS_Nr.zeingan1
         CASE 1
           Buchungstext.zeingan1 = "Courtage: " + VS_Nr.zeingan1
         CASE 2
           Buchungstext.zeingan1 = "Pflege: " + VS_Nr.zeingan1
         CASE 4
           Buchungstext.zeingan1 = "Dynamik: " + VS_Nr.zeingan1
         CASE 5
           Buchungstext.zeingan1 = "Folge: " + VS_Nr.zeingan1
         END SELECT 
         IF a% = - 1 THEN 
           codeaz% = SER ("ZEINGAN1",1)
           codeaz.zeingan1 = codeaz%
           BewertKV.zeingan1 = bewert%
           bewertung.zeingan1 = VAL (anp$)
           IF ze% = srold% AND srz$ = "j" THEN 
             Bewertung.zeingan1 = ze%
             sr.zeingan1 = ze% * - 1
             Buchungstext.zeingan1 = LEFT$ ((Buchungstext.zeingan1 + " SR-Zahlung"),70)
             EinhNichtBuchJN.zeingan1 = "j"
           ELSE 
             IF notiz.zeinvor <> "" THEN 
               sr.zeingan1 = 0
               EinhNichtBuchJN.zeingan1 = "j"
             END IF 
             IF notiz.zeinvor = "" AND sr.zeingan1 <> 0 THEN 
               Firmensr% = sr%
               sr.zeingan1 = 0
             END IF 
           END IF 
           REM STORE FILE "zeingan1"
           REM SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
           Buchungsdatum.zeingan1 = TODAY 
           IF GZEDat% > 0 THEN 
             BuchungsDatum.zeingan1 = DATE$ (GZEDat%,"0d.mm.yyyy")
           ELSE 
             BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
           END IF 
           REM CALL Fehler("Sollstellung bw und sr auseinandernehmen","")
           
           bewertungeu.zeingan1 = VAL ( STR$ (bewertung.zeingan1 / umrechnung.zeingan1,"99999999.00"))
           REM STORE FILE "zeingan1"
           IF sr% <> 0 THEN 
           END IF 
           mwst.zeingan1 = mwst.vprodukt
           IF ZahlBertrMin.vprodukt <> 0 OR ZahlBertrMax.vprodukt <> 0 THEN 
             zmin% = ZahlBertrMin.vprodukt
             zmax% = ZahlBertrMax.vprodukt
           ELSE 
             SELECT FIRST FILE "sparten" INDEX codeva.sparten
             SELECT KEY codeva.kvertrag FILE "sparten" INDEX codeva.sparten
             zmin% = ZahlBertrMin.sparten
             zmax% = ZahlBertrMax.sparten
           END IF 
           ZahlBertrMin.zeingan1 = zmin%
           ZahlBertrMax.zeingan1 = zmax%
           CALL BetrNett()
           CALL QuickStore("ZEINGAN1")
           IF Firmensr% <> 0 THEN 
             BLANK FILE "ZEINGAN1"
             a% = CopyRecord%("zeinvor","ZEINGAN1")
             kondart.zeingan1 = opt%
             codeaz% = SER ("ZEINGAN1",1)
             codeaz.zeingan1 = codeaz%
             BewertKV.zeingan1 = bewert%
             bewertung.zeingan1 = 0
             sr.zeingan1 = Firmensr%
             bewertungeu.zeingan1 = 0
             Buchungsdatum.zeingan1 = TODAY 
             EinhNichtBuchJN.zeingan1 = "j"
             IF GZEDat% > 0 THEN 
               BuchungsDatum.zeingan1 = DATE$ (GZEDat%,"0d.mm.yyyy")
             ELSE 
               BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
             END IF 
             SELECT CASE opt%
             CASE 0
               Buchungstext.zeingan1 = "AP: " + VS_Nr.zeingan1
             CASE 1
               Buchungstext.zeingan1 = "Courtage: " + VS_Nr.zeingan1
             CASE 2
               Buchungstext.zeingan1 = "Pflege: " + VS_Nr.zeingan1
             CASE 4
               Buchungstext.zeingan1 = "Dynamik: " + VS_Nr.zeingan1
             CASE 5
               Buchungstext.zeingan1 = "Folge: " + VS_Nr.zeingan1
             END SELECT 
             REM ****************ich glaube das mu· AP sein***************
             kondart.zeingan1 = 0
             Buchungstext.zeingan1 = LEFT$ (("AP: " + VS_Nr.zeingan1 + " SRGes."),70)
             CALL BetrNett()
             CALL QuickStore("ZEINGAN1")
             Firmensr% = 0
           END IF 
           FILE "zeinvor"
 
           SELECT KEY codekey% LOCK FILE "zeinvor" INDEX codekey.zeinvor
           anpold$ = STR$ (anpold%,"999999999.00")
           anp$ = STR$ (anp%,"999999999.00")
           anp% = VAL (anp$)
           anpold% = VAL (anpold$)
           IF anpold% = anp% THEN 
             SELECT REMOVE FILE "zeinvor"
             REQUEST "Sollstellung wurde in den ZE ÅberfÅhrt","",2
           ELSE 
             xt% = anpold% - anp%
             IF sr.zeinvor > 0 THEN 
               bw% = Bewertung.zeinvor - anp%
               IF bw% > 0 THEN 
                 Bewertung.zeinvor = bw%
               ELSE 
                 Bewertung.zeinvor = 0
                 sr.zeinvor = sr.zeinvor + bw%
                 REM sreu.zeinvor = sreu.zeinvor + bw%
               END IF 
               REM sr.zeinvor = 0
               REM sreu.zeinvor = 0
               rest$ = " - Rest aus Soll: " + LTRIM$ ( STR$ (Bewertung.zeinvor,",9999999.00")) + "/aus SR: " + LTRIM$ ( STR$ (sr.zeinvor,",9999999.00"))
               IF notiz.zeinvor <> "" THEN 
                 notiz.zeinvor = notiz.zeinvor + CHR$ (13) + CHR$ (10) + DATE$ ( TODAY ,"0d.mm.yyyy") + "  Sollbetrag war: " + LTRIM$ ( STR$ (anpold%,",999999999.00")) + " davon an ZE ÅberfÅhrt: " + LTRIM$ (anp$) + rest$
               ELSE 
                 notiz.zeinvor = DATE$ ( TODAY ,"0d.mm.yyyy") + "  Sollbetrag war: " + LTRIM$ ( STR$ (anpold%,",999999999.00")) + " davon an ZE ÅberfÅhrt: " + LTRIM$ (anp$) + rest$
               END IF 
               REM 05052003
               FÑlligkeit.zeinvor = FÑlligkeit.zeinvor + (SRHaftung.kvertrag * 30)
             ELSE 
               Bewertung.zeinvor = anpold% - anp%
               REM Bewertungeu.zeinvor = VAL ( STR$ (Bewertung.zeinvor / umrechnung.zeinvor,"99999999.00"))
               sr.zeinvor = 0
               REM sreu.zeinvor = 0
               notiz.zeinvor = notiz.zeinvor + "   " + DATE$ ( TODAY ,"0d.mm.yyyy") + "  Sollbetrag war: " + LTRIM$ ( STR$ (anpold%,",999999999.00")) + " davon an ZE ÅberfÅhrt: " + LTRIM$ (anp$)
             END IF 
             CALL MATimeStamp("zeinvor")
             BewertungEU.zeinvor = VAL ( STR$ (Bewertung.zeinvor / Umrechnung.zeinvor,"99999999.00"))
             SREU.zeinvor = VAL ( STR$ (SR.zeinvor / Umrechnung.zeinvor,"99999999.00"))
             STORE FILE "zeinvor"
             UNLOCK CURRENT FILE "zeinvor"
           END IF 
         END IF 
       ELSE 
         CALL Fehler("Der Sollstellungsvorschlag konnte nicht in den Zahlungseingang ÅberfÅhrt werden!","")
       END IF 
       IF maske$ = "EINGZVOR" THEN 
         IF EXISTS (codevt%,codevt.zeinvor) THEN 
           FILE "zeinvor"
           INDEX codekey.zeinvor
           SELECT FIRST 
           REM OPEN FORM maske$
           REM SET f = Superbase.Form
           SELECT FORM FIRST 
           FORM 
           CALL ZVORIntro1(codevt%)
           CALL ZEIVUpdate1(codevt%)
           ZEINsub% = 0
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen zu diesem Vertrag!","")
           _formend% = 1
         END IF 
       ELSE 
         IF RECCOUNT ("zeinvor") > 0 THEN 
           IF EXISTS (codevt%,codevt.zeinvor) THEN 
             SELECT FIRST FILE "zeinvor" INDEX codekey.zeinvor
             SELECT FORM KEY codevt% FILE "zeinvor" INDEX codevt.zeinvor
             FORM 
             CALL ZVORIntro1(codevt%)
             CALL ZEIVUpdate1(codevt%)
             ZEINsub% = 0
           ELSE 
             SELECT FORM FIRST FILE "zeinvor" INDEX codekey.zeinvor
             FORM 
           END IF 
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen!","")
           _formend% = 1
         END IF 
       END IF 
     END IF 
sollign270220021: 
   CASE 2
     REM zum Vertrag springen
     CALL DFile(3,"buchung1" + _fpw$)
     CALL DFile(3,"zeingan1" + _fpw$)
     CALL DFile(30,"KVERTRAG" + _fpw$)
     CALL DFile(3,"VORGANG" + _fpw$)
         codekey% = codekey.zeinvor
         GetVertrag% = codevt.zeinvor
         IF EXISTS (GetVertrag%,lfdnr.kvertrag) THEN 
           SELECT KEY GetVertrag% FILE "Kvertrag" INDEX lfdnr.kvertrag
           cuvt% = GetVertrag%
           knr% = Codeku.kvertrag
           lfdnr% = cuvt%
           SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
           REM CALL KVERTRAG()
           CALL KVERTRAGneu(lfdnr%)
           FILE "zeinvor"
           OPEN FORM GPrjForm$ + "EINGZVO1"
           SET f = Superbase.Form
           SET STATUS "SollstellungsvorschlÑge"
           SELECT FORM FIRST 
           FORM 
           SELECT FORM KEY GetVertrag% FILE "zeinvor" INDEX codevt.zeinvor
           SELECT KEY codekey% LOCK FILE "zeinvor" INDEX codekey.zeinvor
           FORM 
           CALL ZVORIntro1(codevt.zeinvor)
           CALL MNZEIVOR()
           CALL ZEIVUpdate1(codevt.zeinvor)
           ZEINsub% = 0
         ELSE 
           CALL Fehler("Vertrag wurde nicht gefunden!","")
         END IF 
         IF RECCOUNT ("zeinvor") > 0 THEN CALL ZEIVUpdate1(codevt%)
   CASE 3
     IF NOT disabled%("SOLLSTELLUNGDRU") THEN 
       IF maske$ = "EINGZVOR" THEN 
         CALL ZVORDruck(codevt.zeinvor)
       ELSE 
         CALL ZVORDruck(0)
       END IF 
     END IF 
   CASE 4
     REM Lîschen
     codekey% = codekey.zeinvor
     codevt% = codevt.zeinvor
     REQUEST "Wollen Sie wirklich diese Sollstellung lîschen?","",135,req%
     IF req% = 1 THEN 
       SELECT KEY codekey% LOCK FILE "zeinvor" INDEX codekey.zeinvor
       SELECT REMOVE FILE "zeinvor"
       REQUEST "Sollstellung wurde gelîscht!","",2
       IF maske$ = "EINGZVOR" THEN 
         IF EXISTS (codevt%,codevt.zeinvor) THEN 
           FILE "zeinvor"
           INDEX codekey.zeinvor
           SELECT FIRST 
           REM OPEN FORM maske$
           REM SET f = Superbase.Form
           SELECT FORM FIRST 
           FORM 
           CALL ZVORIntro1(codevt%)
           CALL ZEIVUpdate1(codevt%)
           ZEINsub% = 0
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen zu diesem Vertrag!","")
           _formend% = 1
         END IF 
       ELSE 
         IF RECCOUNT ("zeinvor") > 0 THEN 
           IF EXISTS (codevt%,codevt.zeinvor) THEN 
             SELECT FIRST FILE "zeinvor" INDEX codekey.zeinvor
             SELECT FORM KEY codevt% FILE "zeinvor" INDEX codevt.zeinvor
             FORM 
             CALL ZVORIntro1(codevt%)
             CALL ZEIVUpdate1(codevt%)
             ZEINsub% = 0
           ELSE 
             SELECT FORM FIRST FILE "zeinvor" INDEX codekey.zeinvor
             FORM 
           END IF 
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen!","")
           _formend% = 1
         END IF 
       END IF 
     END IF 
   CASE 5
     REM neu
     CALL ZeinvorNeu()
     MOUSE ON 
     codevt% = codevt.zeinvor
     ENTER Bewertung.zeinvor,0
     CALL ZVORIntro1(codevt%)
     FORM 
     REM BewertungEU.zeinvor = VAL ( STR$ (Bewertung.zeinvor / Umrechnung.zeinvor,"99999999.00"))
     REM CALL QuickStore("zeinvor")
     REM ENTER END 
   CASE 6
     REM edit
     codevt% = codevt.zeinvor
     ENTER Bewertung.zeinvor,0
     CALL ZVORIntro1(codevt%)
     FORM 
   CASE 7
     REM Drucken ZE
   CASE 8
     REM letzte Auswahlliste
     IF GCodeGE% <> 0 OR GCodeVP% <> 0 OR LTRIM$ (GsVSNR$) <> "" THEN 
       CALL ZVorSuch1(1)
     ELSE 
       CALL Fehler("Es wurde noch keine Suche durchgefÅhrt!","Bitte fÅhren Sie erst eine Suche durch!!!")
       CALL ZVorSuch1(0)
     END IF 
   CASE 9
     REM Suchen
     CALL ZVorSuch1(0)
   END SELECT 
   MENU ON 
 WEND 
 REM CALL ZEINbuchung1( - 1)
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 

SUB ZVorSuchM()
     IF GCodeGE% <> 0 OR GCodevp% <> 0 OR LTRIM$ (GsVSNR$) <> "" THEN 
       CALL ZVorSuch1(1)
     ELSE 
       CALL Fehler("Es wurde noch keine Suche durchgefÅhrt!","Bitte fÅhren Sie erst eine Suche durch!!!")
       CALL ZVorSuch1(0)
     END IF 
  END SUB 

SUB ZeinvorNeu()
    CREATE DIALOG "ZUGART",0,0,134,76,"Art SOLL","MS Sans Serif",8
    ADD DIALOG "ZUGART",4,23,2,101,52,0,"Angabe der Sollstellungsart"
    ADD DIALOG "ZUGART",3,33,16,77,10,0,"AP",0,kondart%
    ADD DIALOG "ZUGART",3,33,27,77,10,0,"Courtage",1,kondart%
    ADD DIALOG "ZUGART",3,33,38,77,10,0,"Pflege",2,kondart%
    ADD DIALOG "ZUGART",1,48,57,55,15,1,"&OK",1,1
    REM ADD DIALOG "ZUGART",1,70,46,55,15,0,"&Abbrechen",0,0
    DIALOG "ZUGART",req%
    REMOVE DIALOG "ZUGART"
     BLANK FILE "zeinvor"
     codekey% = SER ("ZEINVOR",1)
     codekey.zeinvor = codekey%
     codevt.zeinvor = lfdnr.kvertrag
     codege.zeinvor = codege.kvertrag
     codeva.zeinvor = Codeva.kvertrag
     codevp.zeinvor = codevp.kvertrag
     codeku.zeinvor = codeku.kvertrag
     workstation.zeinvor = workstation.kvertrag
     FÑlligkeit.zeinvor = ddatum%
         CodeEingGE.zeinvor = CodeEingGE.kvertrag
         EingereichtBei.zeinvor = EingereichtBei.kvertrag
     IF kondart% = 0 THEN 
       remark$ = "AP "
     END IF 
     IF kondart% = 1 THEN 
       remark$ = "Courtage "
     END IF 
     IF kondart% = 2 THEN 
       remark$ = "Pflege "
     END IF 
     kondart.zeinvor = kondart%
     vsnr$ = VS_Nr.kvertrag
     Buchungstext.zeinvor = remark$ + VS_Nr.kvertrag
     vs_nr.zeinvor = VS_Nr.kvertrag
     codew.zeinvor = Codew.kvertrag
     Waehrung.zeinvor = Waehrung.kvertrag
     Umrechnung.zeinvor = Umrechnung.kvertrag
     QuickVSNR.zeinvor = VSNRPack$(VS_Nr.zeinvor)
     CALL QuickStore("zeinvor")
     CALL ZVORIntro1(lfdnr.kvertrag)
     FORM 
     SELECT KEY codekey% LOCK FILE "zeinvor" INDEX codekey.zeinvor
 END SUB 


SUB ZEINVTest2()
     IF kondart% = 0 THEN 
       REM AP.zeingan1 = "j"
       Buchungstext.zeinvor = "Abschlu·: " + VS_Nr.zeinvor
       kondart.zeinvor = kondart%
     END IF 
     IF kondart% = 1 THEN 
       REM CP.zeingan1 = "j"
       Buchungstext.zeinvor = "Courtage: " + VS_Nr.zeinvor
       kondart.zeinvor = kondart%
     END IF 
     IF kondart% = 2 THEN 
       REM Pf.zeingan1 = "j"
       Buchungstext.zeinvor = "Pflege: " + VS_Nr.zeinvor
       kondart.zeinvor = kondart%
     END IF 
     IF kondart% = 3 THEN 
       REM Ersatz.zeingan1 = "j"
       Buchungstext.zeinvor = "Ersatz: " + VS_Nr.zeinvor
       kondart.zeinvor = kondart%
     END IF 
 END SUB 
 
SUB ZVORIntro1(codevt%)
 MOUSE OFF 
 FILE "zeinvor"
 IF codevt% < 1 THEN 
   INDEX Codekey.zeinvor
   SELECT FIRST FILE "zeinvor" INDEX codekey.zeinvor
   codevt% = codevt.zeinvor
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "zeinvor" INDEX codevt.zeinvor
   IF codeko.kvertrag <> 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
 ELSE 
   INDEX codevt.zeinvor
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "zeinvor" INDEX codevt.zeinvor
   IF codeko.kvertrag <> 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
 END IF 
 kondart% = kondart.zeinvor
 
 REM 020798 SELECT FORM LAST 
 FORM 
 END SUB 
 
 
SUB ZEIVUpdate1(codevt%)
 REM 25012000
 REM codeaz$ = codeaz.zeinvor
 codevt% = codevt.zeinvor
 IF codekey% <> 0 AND codevt.zeinvor <> 0 THEN 
   SELECT FORM KEY CodeVT.zeinvor FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   REM SELECT FORM KEY codeaz$ LOCK FILE "zeinvor" INDEX codeaz.zeinvor
   SELECT FORM KEY codevt% LOCK FILE "zeinvor" INDEX codevt.zeinvor
 END IF 
 kondart% = kondart.zeinvor
 SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
 SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 lGesellschaft$ = Gesellschaft.GEADR
 lAgentur$ = Nachname.MAADR + ", " + Vorname.MAADR + ", " + Agenturnr.maadr
 lSparte$ = Sparte.SPARTEN
 lKunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 lAussenstand$ = STR$ (pool.kvertrag,"999999999.00")
 IF pool.kvertrag < 0 THEN 
   vausgut$ = "Aussenstand:"
 ELSE 
   vausgut$ = "Guthaben:"
 END IF 
 waehr$ = "WÑhrung: " + waehrung.zeinvor
 Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 eingbei$ = EingereichtBei.kvertrag
 IF eingbei$ = "" THEN 
   eingbei$ = "eingereicht Åber"
 END IF 
 IF MNdisabled%("SEEEINGBEI") THEN 
     eingbei$ = "wurde ausgeblendet"
 END IF 
 FORM 
 END SUB 
 
 
SUB MNZEIVOR()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 2,0,1,"&Optionen","",""
 MENU 2,1,1,"aus Liste wÑhlen,F3","ZVorSuchM",""
 MENU 2,2,1,"ZE Datum setzen","ZEIN1SET","ZE Datum setzen"
 CALL MNHilfe(3)
 END SUB 
 
 
 
 ' zeinvor Eintrag zurÅck
 ' =======================================================================
 
SUB ZVorPrev1()
 IF RECCOUNT ("zeinvor") > 0 THEN 
   IF MOD ("zeinvor") OR NEW ("zeinvor") THEN CALL FStore("zeinvor")
   SELECT FORM PREVIOUS 
   IF EOF ("zeinvor") THEN 
     REQUEST "Dateianfang erreicht!","",2
   END IF 
 END IF 
 IF RECCOUNT ("zeinvor") > 0 THEN CALL ZEIVUpdate1(codevt.zeinvor)
 FORM 
 END SUB 
 
 
 ' zeingan1 vor
 ' =======================================================================
 
SUB ZEINNext1()
 IF RECCOUNT ("zeinvor") > 0 THEN 
   IF MOD ("zeinvor") OR NEW ("zeinvor") THEN CALL FStore("zeinvor")
   SELECT FORM NEXT 
   IF EOF ("zeinvor") THEN 
     REQUEST "Dateiende erreicht!","",2
   END IF 
 END IF 
 IF RECCOUNT ("zeinvor") > 0 THEN ZEIVUpdate1(codevt.zeinvor)
 FORM 
 END SUB 
 
 
 
SUB EinZVor1()
 codekey% = codekey.zeinvor
 SELECT KEY codekey% LOCK FILE "zeinvor" INDEX codekey.zeinvor
 SELECT FORM KEY codekey% FILE "zeinvor" INDEX codekey.zeinvor
 Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 kondart% = kondart.zeinvor
 FORM 
 END SUB 
 
 ' Zahlungseingang suchen
 ' =======================================================================
 ' par% - Parameter,0= total neue Suche, 1= Suchliste

SUB ZVorSuch1(par%)
 FILE "KVERTRAG"
 INDEX lfdnr.kvertrag
 FILE "zeinvor"
 codekey% = CodeKey.zeinvor
 opt&% = VAL (ReadConfig$("PROVIS","ZVoropt"))
 IF opt&% = 0 THEN opt&% = 1
 optsort&% = VAL (ReadConfig$("PROVIS","ZVoroptsort"))
 IF optsort&% = 0 THEN optsort&% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 ok% = - 1
 IF par% = 0 THEN 
   CREATE DIALOG "ZEINSUCH",0,0,228,204,"Sollstellungen","MS Sans Serif",8
   ADD DIALOG "ZEINSUCH",4,0,0,228,179,0,""
   ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
   ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Satz suchen mîchten."
   ADD DIALOG "ZEINSUCH",5,38,27,184,24,0,"Sie kînnen die zu durchsuchende Datenmenge durch die wahlfreie Angabe des FÑlligkeitsdatum einschrÑnken."
   ADD DIALOG "ZEINSUCH",5,38,54,76,10,0,"Suche Åber..."
   ADD DIALOG "ZEINSUCH",3,58,64,149,12,0,"Vertrags-/Policennummer",1,opt&%
   ADD DIALOG "ZEINSUCH",3,58,76,148,12,0,"Gesellschaft",2,opt&%
   ADD DIALOG "ZEINSUCH",3,58,88,148,12,0,"Produkt",3,opt&%


   IF MNdisabled%("SEEEINGBEI") THEN 
   ELSE 
     ADD DIALOG "ZEINSUCH",3,58,100,149,12,0,"eingereicht Åber",4,opt&%
   END IF 

   ADD DIALOG "ZEINSUCH",5,38,112,76,10,0,"Sortierung..."
   ADD DIALOG "ZEINSUCH",3,58,124,149,12,0,"Standard",1,optsort&%
   ADD DIALOG "ZEINSUCH",3,58,136,148,12,0,"Versicherungsnehmer",2,optsort&%
 

   ADD DIALOG "ZEINSUCH",5,38,150,96,9,0,"FÑlligkeit (optional):"
   ADD DIALOG "ZEINSUCH",5,58,162,17,11,0,"vom"
   ADD DIALOG "ZEINSUCH",6,78,161,41,11,0,0,von$,20
   ADD DIALOG "ZEINSUCH",5,130,162,13,10,0,"bis"
   ADD DIALOG "ZEINSUCH",6,144,161,41,11,0,0,bis$,20
   ADD DIALOG "ZEINSUCH",1,54,183,55,15,1,"&OK",1,1
   ADD DIALOG "ZEINSUCH",1,112,183,55,15,0,"&Abbrechen",0,0
   DIALOG "ZEINSUCH",req%
   REMOVE DIALOG "ZEINSUCH"
   IF req% = 1 THEN 
     CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
     CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
     CALL WriteConfig("PROVIS","ZVoropt", LTRIM$ ( STR$ (opt&%)))
     CALL WriteConfig("PROVIS","ZVoroptsort", LTRIM$ ( STR$ (optsort&%)))
     ok% = - 1
     IF opt&% = 1 THEN 
       CREATE DIALOG "DZ2",0,0,191,87,"ZahlungseingÑnge","MS Sans Serif",8
       ADD DIALOG "DZ2",4,0,0,191,63,0,""
       ADD DIALOG "DZ2",9,5,10,21,22,2
       ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten DatensÑtze ein:"
       ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
       ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
       ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
       ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
       DIALOG "DZ2",req2%
       REMOVE DIALOG "DZ2"
       IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
     END IF 
     IF opt&% = 2 THEN 
       GCodeGE% = GetCodeGE%(0)
       IF GCodeGE% = 0 THEN ok% = 0
     END IF 
     IF opt&% = 3 THEN 
       GCodeVP% = GetVprodukt%(0,0, - 1)
       IF GCodeVP% = 0 THEN ok% = 0
     END IF 
     IF opt&% = 4 THEN 
       eingueber% = GetCodeGEE%(0)
       IF eingueber% = 0 THEN ok% = 0
     END IF 
   END IF 
 END IF 
   IF ok% THEN 
     REM -- Suche durchfÅhren
     cfile$ = FILE 
     IF von$ = "" THEN von% = DAYS ("1.1.1901") ELSE von% = DAYS (von$)
     IF bis$ = "" THEN bis% = DAYS ("31.12.2920") ELSE bis% = DAYS (bis$)
     DIM Auswahl$(1)
     IF RECCOUNT ("zeinvor") > 30000 THEN 
       DIM Buchungen$(30000)
     ELSE 
       DIM Buchungen$( RECCOUNT ("zeinvor"))
     END IF 
     FILE "zeinvor"
     MOUSE OFF 
     IF opt&% = 1 THEN 
       INDEX QuickVSNR.zeinvor
       SELECT FIRST 
       IF par% = 0 THEN GsVSNR$ = VSNRPack$(VSNR$)
       SELECT KEY GsVSNR$ FILE "zeinvor" INDEX QuickVSNR.zeinvor
       a% = 0
       xa% = 0
       WHILE QuickVSNR.zeinvor LIKE GsVSNR$ + "*" AND NOT EOF ("zeinvor")
         xa% = xa% + 1
         SET STATUS LTRIM$ ( STR$ (xa%,",999999999")) + " DatensÑtze durchsucht"
         IF GASP% THEN 
           IF workstation% = 0 THEN 
             IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
               x$ = ""
               yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.kvertrag) THEN 
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               ELSE 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
               
             END IF 
             IF a% > 29998 THEN 
               CALL Fehler ("Die Sollstellungsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
               SELECT LAST FILE "zeinvor"
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
             END IF 
           ELSE 
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF (IsWksVisible%(Workstation.kvertrag) = - 1) THEN 
               IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
                 x$ = ""
                 yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
                 SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF GMASuperCount% > 0 THEN 
                   IF IsMASuper%(codema.kvertrag) THEN 
                     REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                     a% = a% + 1
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                   END IF 
                 ELSE 
                   REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               END IF 
               IF a% > 29998 THEN 
                 CALL Fehler ("Die Sollstellungsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
                 SELECT LAST FILE "zeinvor"
               ELSE 
                 SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
               END IF 
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
             END IF 
           END IF 
         ELSE 
           IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
             x$ = ""
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.kvertrag) THEN 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             ELSE 
               REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
               a% = a% + 1
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Sollstellungsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeinvor"
           ELSE 
             SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
           END IF 
         END IF 
       WEND 
     END IF 

     IF opt&% = 2 THEN 
       INDEX CodeGE.zeinvor
       SELECT FIRST 
       SELECT KEY GCodeGE% FILE "zeinvor" INDEX CodeGE.zeinvor
       a% = 0
       xa% = 0
       
       WHILE CodeGE.zeinvor = GCodeGE% AND NOT EOF ("zeinvor")
         xa% = xa% + 1
         SET STATUS LTRIM$ ( STR$ (xa%,",999999999")) + " DatensÑtze durchsucht"
         IF gasp% THEN 
           IF workstation% = 0 THEN 
             IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
               x$ = ""
               yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.kvertrag) THEN 
                   REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               ELSE 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             END IF 
             IF a% > 29998 THEN 
               CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
               SELECT LAST FILE "zeinvor"
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX CodeGE.zeinvor
             END IF 
           ELSE 
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF (IsWksVisible%(Workstation.kvertrag) = - 1) THEN 
               IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
                 x$ = ""
                 yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
                 SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF GMASuperCount% > 0 THEN 
                   IF IsMASuper%(codema.kvertrag) THEN 
                     REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                     a% = a% + 1
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                   END IF 
                 ELSE 
                   REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               END IF 
               IF a% > 29998 THEN 
                 CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
                 SELECT LAST FILE "zeinvor"
               ELSE 
                 SELECT NEXT FILE "zeinvor" INDEX CodeGE.zeinvor
               END IF 
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX CodeGE.zeinvor
             END IF 
           END IF 
         ELSE 
           IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
             x$ = ""
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF GMASuperCount% > 0 THEN 
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF IsMASuper%(codema.kvertrag) THEN 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             ELSE 
               REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
               a% = a% + 1
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeinvor"
           ELSE 
             SELECT NEXT FILE "zeinvor" INDEX CodeGE.zeinvor
           END IF 
         END IF 
       WEND 
     END IF 
     IF opt&% = 3 THEN 
       INDEX CodeVP.zeinvor
       SELECT FIRST 
       SELECT KEY GCodeVP% FILE "zeinvor" INDEX CodeVP.zeinvor
       a% = 0
       xa% = 0
       
       WHILE CodeVP.zeinvor = GCodeVP% AND NOT EOF ("zeinvor")
         xa% = xa% + 1
         SET STATUS LTRIM$ ( STR$ (xa%,",999999999")) + " DatensÑtze durchsucht"
         IF gasp% THEN 
           IF workstation% = 0 THEN 
             IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
               x$ = ""
               yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.kvertrag) THEN 
                   REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               ELSE 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             END IF 
             IF a% > 29998 THEN 
               CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
               SELECT LAST FILE "zeinvor"
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX CodeVP.zeinvor
             END IF 
           ELSE 
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF (IsWksVisible%(Workstation.kvertrag) = - 1) THEN 
               IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
                 x$ = ""
                 yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
                 SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF GMASuperCount% > 0 THEN 
                   IF IsMASuper%(codema.kvertrag) THEN 
                     REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                     a% = a% + 1
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                   END IF 
                 ELSE 
                   REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               END IF 
               IF a% > 29998 THEN 
                 CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
                 SELECT LAST FILE "zeinvor"
               ELSE 
                 SELECT NEXT FILE "zeinvor" INDEX CodeVP.zeinvor
               END IF 
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX CodeVP.zeinvor
             END IF 
           END IF 
         ELSE 
           IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
             x$ = ""
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF GMASuperCount% > 0 THEN 
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF IsMASuper%(codema.kvertrag) THEN 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             ELSE 
               REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
               a% = a% + 1
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeinvor"
           ELSE 
             SELECT NEXT FILE "zeinvor" INDEX CodeVP.zeinvor
           END IF 
         END IF 
       WEND 
     END IF 


     IF opt&% = 4 THEN 
       INDEX CodeEingGE.zeinvor
       SELECT FIRST 
       SELECT KEY eingueber% FILE "zeinvor" INDEX CodeEingGE.zeinvor
       a% = 0
       xa% = 0
       
       WHILE CodeEingGE.zeinvor = eingueber% AND NOT EOF ("zeinvor")
         xa% = xa% + 1
         SET STATUS LTRIM$ ( STR$ (xa%,",999999999")) + " DatensÑtze durchsucht"
         IF gasp% THEN 
           IF workstation% = 0 THEN 
             IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
               x$ = ""
               yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.kvertrag) THEN 
                   REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               ELSE 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             END IF 
             IF a% > 29998 THEN 
               CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
               SELECT LAST FILE "zeinvor"
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX CodeEingGE.zeinvor
             END IF 
           ELSE 
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF (IsWksVisible%(Workstation.kvertrag) = - 1) THEN 
               IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
                 x$ = ""
                 yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
                 SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF GMASuperCount% > 0 THEN 
                   IF IsMASuper%(codema.kvertrag) THEN 
                     REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                     a% = a% + 1
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                   END IF 
                 ELSE 
                   REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               END IF 
               IF a% > 29998 THEN 
                 CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
                 SELECT LAST FILE "zeinvor"
               ELSE 
                 SELECT NEXT FILE "zeinvor" INDEX CodeEingGE.zeinvor
               END IF 
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX CodeEingGE.zeinvor
             END IF 
           END IF 
         ELSE 
           IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
             x$ = ""
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF GMASuperCount% > 0 THEN 
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF IsMASuper%(codema.kvertrag) THEN 
                 REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             ELSE 
               REM Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   IF optsort&% = 1 THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + vnehmer.kvertrag + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   ELSE 
                     Buchungen$(a%) = PAD$ (vnehmer.kvertrag,35) + "      " + PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   END IF 
               a% = a% + 1
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeinvor"
           ELSE 
             SELECT NEXT FILE "zeinvor" INDEX CodeEingGE.zeinvor
           END IF 
         END IF 
       WEND 
     END IF 


     IF a% <> 0 THEN 
       REM -- Prompt ermitteln
       prompt$ = Buchungen$(0)
       FOR b% = 1 TO a% - 1
         IF Buchungen$(b%) < prompt$ THEN prompt$ = Buchungen$(b%)
       NEXT b%
       IF opt&% = 1 THEN 
         caption$ = "Suche Åber Vertrags-/Policennummer..."
       END IF 
       IF opt&% = 2 THEN 
         caption$ = "Suche Åber Gesellschaft..."
       END IF 
       IF opt&% = 3 THEN 
         caption$ = "Suche Åber Produkt..."
       END IF 
       MOUSE ON 
       IF optsort&% = 1 THEN 
         CREATE DIALOG "DZ3",0,0,450,300,caption$,"MS Sans Serif",8
         ADD DIALOG "DZ3",4,0,0,349,27,0,""
         ADD DIALOG "DZ3",5,36,11,179,9,0,"Bitte wÑhlen Sie den gesuchten Sollstellungssatz aus:"
         REM ADD DIALOG "DZ3",9,8,12,21,23,2
         ADD DIALOG "DZ3",5,3,27,360,9,0,"Vertragsnummer                                  Datum               Bewertung     "
         ADD DIALOG "DZ3",7,3,40,445,240,130,2,Buchungen$,Auswahl$,prompt$
         ADD DIALOG "DZ3",1,128,280,55,15,1,"&OK",1,1
         ADD DIALOG "DZ3",1,186,280,55,15,0,"&Abbrechen",0,0
         DIALOG "DZ3",req3%
         REMOVE DIALOG "DZ3"
       ELSE 
         CREATE DIALOG "DZ3",0,0,440,300,caption$,"MS Sans Serif",8
         ADD DIALOG "DZ3",4,0,0,349,27,0,""
         ADD DIALOG "DZ3",5,36,11,179,9,0,"Bitte wÑhlen Sie den gesuchten Sollstellungssatz aus:"
         REM ADD DIALOG "DZ3",9,8,12,21,23,2
         ADD DIALOG "DZ3",5,3,27,360,9,0,"Versicherungsnehmer                             Vertragsnummer                               Datum               Bewertung     "
         ADD DIALOG "DZ3",7,3,40,430,240,130,2,Buchungen$,Auswahl$,prompt$
         ADD DIALOG "DZ3",1,128,280,55,15,1,"&OK",1,1
         ADD DIALOG "DZ3",1,186,280,55,15,0,"&Abbrechen",0,0
         DIALOG "DZ3",req3%
         REMOVE DIALOG "DZ3"
       END IF 
       IF req3% = 1 THEN 
         codekey% = VAL ( RIGHT$ (Auswahl$(0),6))
       END IF 
     ELSE 
       CALL Fehler("Es konnten keine entsprechenden Sollstellungen gefunden werden!","")
     END IF 
     FILE cfile$
   END IF 
 END IF 
 IF codekey% <> 0 THEN 
   SELECT FORM KEY codekey% FILE "zeinvor" INDEX CodeKey.zeinvor
   SELECT KEY codevt.zeinvor FILE "kvertrag" INDEX lfdnr.kvertrag
   CALL ZEIVUpdate1(codekey%)
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' zeinvor Eintrag zurÅck
 ' =======================================================================
 
SUB ZVorPrev1()
 IF RECCOUNT ("zeinvor") > 0 THEN 
   IF MOD ("zeinvor") OR NEW ("zeinvor") THEN CALL FStore("zeinvor")
   codekey% = codekey.zeinvor
   SELECT FORM PREVIOUS 
   IF EOF ("zeinvor") THEN 
     REQUEST "Dateianfang erreicht!","",2
     SELECT FORM KEY codekey% INDEX codekey.zeinvor
   END IF 
 END IF 
 IF RECCOUNT ("zeinvor") > 0 THEN CALL ZEIVUpdate1(0)
 FORM 
 END SUB 
 
 
 ' zeinvor vor
 ' =======================================================================
 
SUB ZVorNext1()
 IF RECCOUNT ("zeinvor") > 0 THEN 
   IF MOD ("zeinvor") OR NEW ("zeinvor") THEN CALL FStore("zeinvor")
   codekey% = codekey.zeinvor
   SELECT FORM NEXT 
   IF EOF ("zeinvor") THEN 
     REQUEST "Dateiende erreicht!","",2
     SELECT FORM KEY codekey% INDEX codekey.zeinvor
   END IF 
 END IF 
 IF RECCOUNT ("zeinvor") > 0 THEN CALL ZEIVUpdate1(0)
 FORM 
 END SUB 
 
 
 REM Sollstellung drucken
SUB ZVORDruck(codevt%)
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
       IF DruInEur.stamm = 1 THEN 
         req1% = 1
       ELSE 
         CALL Fehler(t1$,t2$)
         REQUEST "öbersicht in EURO drucken?","",130,req1%
       END IF 
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
 gesell$ = ""
 suge% = 0
 codekey% = CodeKey.zeinvor
 IF codevt% <> 0 THEN 
   VSNR1$ = VS_Nr.kvertrag
 ELSE 
   VSNR1$ = ""
 END IF 
 opt&% = 0
 incAp$ = "j"
 opt1a&% = - 1
 IF codevt% = 0 THEN opt&% = VAL (ReadConfig$("PROVIS","ZVoropt"))
 IF opt&% = 0 AND codevt% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZVorvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZVorbis")
 IF bis$ = "leer" THEN bis$ = ""
 opt1a&% = - 1
 CREATE DIALOG "ZEINSUCH",0,0,228,200,"Sollstellungen","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,135,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Satz drucken mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des FÑlligkeitsdatum einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,47,76,50,0,"Druck Åber..."
 IF codevt% = 0 THEN 
   ADD DIALOG "ZEINSUCH",3,58,56,149,12,0,"Vertrags-/Policennummer",1,opt&%
   ADD DIALOG "ZEINSUCH",3,58,66,148,12,0,"Gesellschaft",2,opt&%
   IF MNdisabled%("SEEEINGBEI") THEN 
   ELSE 
     ADD DIALOG "ZEINSUCH",3,58,76,148,12,0,"eingereicht Åber",4,opt&%
   END IF 
   ADD DIALOG "ZEINSUCH",3,58,86,148,12,0,"keine EinschrÑnkung",3,opt&%
 END IF 
 ADD DIALOG "ZEINSUCH",5,38,107,96,9,0,"FÑlligkeit (optional):"
 ADD DIALOG "ZEINSUCH",5,58,120,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,119,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,120,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,119,41,11,0,0,bis$,20

 ADD DIALOG "ZEINSUCH",2,10,140,44,11,0,"alle Arten","j","n",incAp$
 ADD DIALOG "ZEINSUCH",3,68,140,149,12,0,"nur AP",0,opt1a&%
 ADD DIALOG "ZEINSUCH",3,68,150,149,12,0,"nur Courtage",1,opt1a&%
 ADD DIALOG "ZEINSUCH",3,68,160,149,12,0,"nur Pflege",2,opt1a&%


 ADD DIALOG "ZEINSUCH",1,54,183,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,183,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF invAp$ <> "j" AND opt1a&% < 1 THEN opt1a&% = 0
 IF req% = 1 THEN 
   CALL Fehler("Stellen Sie bitte bei Ihren Drucker das A4-Querformat ein!","")
   ON ERROR GOTO a4quer170620031
   SET PRINTER PRINTER , PRINTER (0),2,9,0,0,100,1
   GOTO a4quer170620032
a4quer170620031: 
   CALL Fehler("Es wurde versucht den Drucker auf A4-Querformat einzustellen!","Ihr Drucker hat die Automatikeinstellung nicht zugelassen, bitte per Hand Ñndern!")
a4quer170620032:  
   ON ERROR GOTO ErrorHandler
   CALL WriteConfig("PROVIS","ZVorvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZVorbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZVoropt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"Sollstellungen","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten DatensÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
     sVSNR$ = VSNRPack$(VSNR$)
     eingab$ = sVSNR$
     nvt% = 0
     nvt% = GetVertrADR%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,vongen$,bisgen$,0)
     IF nvt% > 0 THEN 
       codevt% = nvt%
       ok% = - 1
       GOTO end300320042
     ELSE 
       ok% = 0
       GOTO end300320042 
     END IF 
     FILE "zeinvor"
     INDEX QuickVSNR.zeinvor
     SELECT FIRST FILE "zeinvor" INDEX QuickVSNR.zeinvor
     SELECT KEY sVSNR$ FILE "zeinvor" INDEX QuickVSNR.zeinvor
     REM ******************************************************************************************************************************************************** 
       DIM Buchungen$( RECCOUNT ("ZEINVOR"))
       a% = 0
       xa% = 0
       WHILE QuickVSNR.zeinvor LIKE sVSNR$ + "*" AND NOT EOF ("zeinvor")
         xa% = xa% + 1
         SET STATUS LTRIM$ ( STR$ (xa%,",999999999")) + " DatensÑtze durchsucht"
         IF GASP% THEN 
           IF workstation% = 0 THEN 
             IF FÑlligkeit.zeinvor >= von% AND FÑlligkeit.zeinvor <= bis% THEN 
               x$ = ""
               yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
               IF GMASuperCount% > 0 THEN 
                 SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF IsMASuper%(codema.kvertrag) THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               ELSE 
                 Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
               
             END IF 
             IF a% > 29998 THEN 
               CALL Fehler ("Die Sollstellungsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
               SELECT LAST FILE "zeinvor"
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
             END IF 
           ELSE 
             SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF (IsWksVisible%(Workstation.kvertrag) = - 1) THEN 
                 x$ = ""
                 yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
                 IF GMASuperCount% > 0 THEN 
                   IF IsMASuper%(codema.kvertrag) THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                     a% = a% + 1
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                   END IF 
                 ELSE 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                   a% = a% + 1
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
                 END IF 
               IF a% > 29998 THEN 
                 CALL Fehler ("Die Sollstellungsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
                 SELECT LAST FILE "zeinvor"
               ELSE 
                 SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
               END IF 
             ELSE 
               SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
             END IF 
           END IF 
         ELSE 
             x$ = ""
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeinvor + sr.zeinvor,",99999999.00")),15) + " " + Buchungstext.zeinvor
             IF GMASuperCount% > 0 THEN 
               SELECT KEY codevt.zeinvor FILE "KVERTRAG" INDEX lfdnr.kvertrag
               IF IsMASuper%(codema.kvertrag) THEN 
                 Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
                 a% = a% + 1
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
               END IF 
             ELSE 
               Buchungen$(a%) = PAD$ (VS_Nr.zeinvor,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeinvor,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (CodeKey.zeinvor,"000000")
               a% = a% + 1
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
             END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Sollstellungsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeinvor"
           ELSE 
             SELECT NEXT FILE "zeinvor" INDEX QuickVSNR.zeinvor
           END IF 
         END IF 
       WEND 
     codevt% = 0
     IF a% <> 0 THEN 
       REM -- Prompt ermitteln
       prompt$ = Buchungen$(0)
       FOR b% = 1 TO a% - 1
         IF Buchungen$(b%) < prompt$ THEN prompt$ = Buchungen$(b%)
       NEXT b%
       IF opt&% = 1 THEN 
         caption$ = "Suche Åber Vertrags-/Policennummer..."
       ELSE 
         caption$ = "Suche Åber Gesellschaft..."
       END IF 
       MOUSE ON 
       CREATE DIALOG "DZ3",0,0,350,300,caption$,"MS Sans Serif",8
       ADD DIALOG "DZ3",4,0,0,349,27,0,""
       ADD DIALOG "DZ3",5,36,11,179,9,0,"Bitte wÑhlen Sie die Policenummer aus:"
       REM ADD DIALOG "DZ3",9,8,12,21,23,2
       ADD DIALOG "DZ3",5,36,27,260,9,0,"Vertragsnummer                       Datum               Bewertung     "
       ADD DIALOG "DZ3",7,36,40,290,240,130,2,Buchungen$,Auswahl$,prompt$
       ADD DIALOG "DZ3",1,88,280,55,15,1,"&OK",1,1
       ADD DIALOG "DZ3",1,146,280,55,15,0,"&Abbrechen",0,0
       DIALOG "DZ3",req3%
       REMOVE DIALOG "DZ3"
       IF req3% = 0 THEN GOTO zeindrend19110101
       IF req3% = 1 THEN 
         codekey% = VAL ( RIGHT$ (Auswahl$(0),6))
         IF codekey% <> 0 THEN 
           SELECT FORM KEY codekey% FILE "zeinvor" INDEX CodeKey.zeinvor
           codevt% = codevt.zeinvor
           SELECT KEY codevt.zeinvor FILE "kvertrag" INDEX lfdnr.kvertrag
           CALL ZEIVUpdate1(codekey%)
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Es konnten keine entsprechenden Sollstellungen gefunden werden!","")
     END IF 
     REM ******************************************************************************************************************************************************** 
     VSNR1$ = VSNR$
     VSNR$ = VSNR$ + "*"

   ELSE 
     IF opt&% = 2 THEN 
       suge% = GetCodeGE%(0)
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY suge% FILE "geadr" INDEX codege.geadr
       gesell$ = gesellschaft.geadr
       IF suge% < 1 THEN ok% = 0
     END IF 
     IF opt&% = 4 THEN 
       eingueber% = GetCodeGEE%(0)
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY eingueber% FILE "geadr" INDEX codege.geadr
       eingueber$ = gesellschaft.geadr
       IF eingueber% < 1 THEN ok% = 0
     END IF 
   END IF 
 END IF 
end300320042: 
 IF ok% = 0 THEN END SUB 
 von0$ = von$
 bis0$ = bis$
 IF von$ = "" THEN von% = 0 ELSE von% = DAYS (von$)
 IF bis$ = "" THEN bis% = DAYS ("31.12.2920") ELSE bis% = DAYS (bis$)
 
 
 IF eu% = 0 THEN 
   CALL PRep("ZVORDR")
   REPORT ON beitrag% AS "BewSum%",BewSum% AS "anz%",beitragsr% AS "BewSumSR%"
   AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
   END REPORT 
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   GROUP Gesellschaft.GEADR,beitrag% AS "BewSum%",BewSum% AS "anz%",beitragsr% AS "BewSumSR%"
 ELSE 
   REQUEST "Arbeiten Sie mit Stornoreserven?","",130,req11%
   IF req11% = 1 THEN 
     CALL PRep("ZVORDRE")
   ELSE 
     IF opt&% = 4 THEN 
       CALL PRep("ZVORDRE2")
     ELSE 
       CALL PRep("ZVORDRE1")
     END IF 
   END IF 
   REPORT ON beitrag% AS "BewSum%",BewSum% AS "anz%",beitragsr% AS "BewSumSR%"
   AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
   END REPORT 
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   GROUP Gesellschaft.GEADR,beitrag% AS "BewSum%",BewSum% AS "anz%",beitragsr% AS "BewSumSR%"
 END IF 
 BEFORE GROUP Gesellschaft.GEADR
     SET REPORT PAGE "H_Gesellscha002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Gesellschaft.GEADR
     SET REPORT PAGE "F_Gesellscha002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO zeindrend19110101
 ueberschr0$ = "Sollstellung " + drwaehr$
 IF eingueber$ <> "" THEN 
   ueberschr0$ = ueberschr0$ + " eingereicht Åber " + eingueber$
 ELSE 
   IF gesell$ <> "" THEN 
     ueberschr0$ = ueberschr0$ + " fÅr Gesellschaft " + gesell$
   ELSE 
     IF codevt% <> 0 THEN 
       ueberschr0$ = ueberschr0$ + " fÅr Vertrag " + VSNR1$
     END IF 
   END IF 
 END IF 

 IF von0$ <> "" THEN 
   ueberschr1$ = "im Zeitraum von " + von0$
   IF bis0$ <> "" THEN 
     ueberschr1$ = ueberschr1$ + " bis " + bis0$
   END IF 
 ELSE 
   IF bis0$ <> "" THEN 
     ueberschr1$ = "im Zeitraum bis " + bis0$
   END IF 
 END IF 
 IF von0$ = "" AND bis0$ = "" THEN 
   ueberschr1$ = "alle Sollstellungen ohne ZeitraumbeschrÑnkung"
 END IF 
 IF incAp$ = "j" THEN 
   ueberschr1$ = ueberschr1$ + " - alle Konditionen"
 ELSE 
   IF opt1a&% = 0 THEN 
      ueberschr1$ = ueberschr1$ + " - nur AP"
   END IF 
   IF opt1a&% = 1 THEN 
     ueberschr1$ = ueberschr1$ + " - nur Courtagen"
   END IF 
   IF opt1a&% = 2 THEN 
     ueberschr1$ = ueberschr1$ + " - nur Pflege"
   END IF 
 END IF 
 SET QUERY ON 
 SET QUERY LOCK OFF 


 REM ADD DIALOG "ZEINSUCH",2,10,140,64,11,0,"alle Arten","j","n",incAp$
 REM ADD DIALOG "ZEINSUCH",3,68,140,149,12,0,"nur AP",0,opt1a&%
 REM ADD DIALOG "ZEINSUCH",3,68,150,149,12,0,"nur Courtage",1,opt1a&%
 REM ADD DIALOG "ZEINSUCH",3,68,160,149,12,0,"nur Pflege",2,opt1a&%
 

 IF codevt% <> 0 THEN 
   a$ = "adressen"
   k$ = "Kvertrag"
   z$ = "zeinvor"
   s$ = "sparten"
   IF incAp$ = "j" THEN 
     SELECT ;
     WHERE codevt.z$ = codevt% AND CodeVT.Z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND CodeVA.K$ = CodeVA.S$ AND 
     ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
     ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
     TO ASK 
     END SELECT 
   ELSE 
     SELECT ;
     WHERE codevt.z$ = codevt% AND CodeVT.Z$ = lfdNr.K$ AND kondart.z$ = opt1a&% AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND CodeVA.K$ = CodeVA.S$ AND 
     ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
     ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
     TO ASK 
     END SELECT 
   END IF 
 ELSE 
   IF opt&% = 3 THEN 

     REM alles drucken
     a$ = "adressen"
     k$ = "Kvertrag"
     z$ = "zeinvor"
     s$ = "sparten"
     IF incAp$ = "j" THEN 
       SELECT ;
       WHERE CodeVT.ZEINVOR = lfdNr.KVERTRAG AND codeku.kvertrag = codeku.adressen AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND 
       ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
       TO ASK 
       END SELECT 
     ELSE 
       SELECT ;
       WHERE CodeVT.ZEINVOR = lfdNr.KVERTRAG AND kondart.z$ = opt1a&% AND codeku.kvertrag = codeku.adressen AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND 
       ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
       TO ASK 
       END SELECT 
     END IF 
   ELSE 
     IF opt&% = 2 THEN 
       a$ = "adressen"
       k$ = "Kvertrag"
       z$ = "zeinvor"
       s$ = "sparten"
       REM nach Gesellschaft suchen
       IF incAp$ = "j" THEN 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND codege.geadr = suge% AND CodeVA.K$ = CodeVA.S$ AND 
         ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
         TO ASK 
         END SELECT 
       ELSE 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND kondart.z$ = opt1a&% AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND codege.geadr = suge% AND CodeVA.K$ = CodeVA.S$ AND 
         ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
         TO ASK 
         END SELECT 
       END IF 
     ELSE 
       REM eingereicht Åber
       a$ = "adressen"
       k$ = "Kvertrag"
       z$ = "zeinvor"
       s$ = "sparten"
       IF incAp$ = "j" THEN 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND codeEingGe.z$ = eingueber% AND CodeVA.K$ = CodeVA.S$ AND 
         ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
         TO ASK 
         END SELECT 
       ELSE 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND kondart.z$ = opt1a&% AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND codeEingge.z$ = eingueber% AND CodeVA.K$ = CodeVA.S$ AND 
         ((FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND Bewertung.z$ <> 0) OR (Faelsr.z$ >= von% AND Faelsr.z$ <= bis% AND sr.z$ <> 0))
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.ZEINVOR,FÑlligkeit.ZEINVOR
         TO ASK 
         END SELECT 
       END IF 
     END IF 
   END IF 
 END IF 
zeindrend19110101: 
 CALL Fehler ("Es wird jetzt versucht das Druckformat auf A4-Hochformat einzustellen!","")
 ON ERROR GOTO a4hoch170620031
 SET PRINTER PRINTER , PRINTER (0),1,9,0,0,100,1
 GOTO a4hoch170620032
a4hoch170620031: 
 CALL Fehler("Es wurde versucht den Drucker auf A4-Hochformat einzustellen!","Ihr Drucker hat die Automatikeinstellung nicht zugelassen, bitte per Hand Ñndern!")
a4hoch170620032: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 



  




SUB AutomatSoll()

 CALL DFile(3,"VProdukt" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"GEKOND" + _fpw$)
 CALL DFile(3,"zeinvor" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"VPGEKOND" + _fpw$)
 CALL DFile(3,"KVSKOND" + _fpw$)
 CALL DFile(2,"OFFICE\ADRESSEN" + _fpw$)



                             dDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
             _day% = DAY ( TODAY )
             _month% = MONTH ( TODAY )
             _year% = YEAR ( TODAY )
             _day% = 1
             dDate% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
             dDate$ = DATE$ (dDate%,"0d.mm.yyyy")
datsoll2702200201: 
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsbeginn","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, ab wann die"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellungen beginnen soll:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,dDATE$,10
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Beginndatum:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               IF DateOK%(dDATE$) THEN 
                               ELSE 
                                 GOTO datsoll2702200201
                               END IF 
 b$ = "und die nicht als storniert gekennzeichnet wurden, die Sollstellungen zu definieren und zu berechnen! BEACHTEN SIE, DASS DIE EUROUMSTELLUNG DURCHGEFöHRT SEIN MUSS, DA KEINE VERTRéGE IN DER WéHRUNG DM IN DIE SOLLSTELLUNG öBERNOMMEN WERDEN KôNNEN!"
 CALL Fehler("Es wird jetzt versucht fÅr alle VertrÑge die bereits an die Provisionsabrechnung Åbergeben wurden",b$)
               REQUEST "Sollstellung jetzt erzeugen?","",135,req1234%
                             END IF 
 
               IF req1234% = 0 THEN GOTO end270220023soll
               REM *******************************************************************************************
               REM *   Einbeziehung der Produktkonditionen                                                   *
               REM *******************************************************************************************
               CALL DeleteLogA("SOLLST.TXT")
               CALL CreateLogA("SOLLST.TXT")
               FILE "KVERTRAG"
               INDEX lfdnr.kvertrag
               SELECT FIRST LOCK 
               DIM KVKond$(1)
               rec% = RECCOUNT ("KVERTRAG")
               ai% = 0
               ag% = 0
               WHILE NOT EOF ("KVERTRAG")
                 cfile$ = FILE 
                 ai% = ai% + 1
                 IF EXISTS (codevp.kvertrag,codevp.VPGEKOND) AND proviab.kvertrag > 0 AND codevstatus.kvertrag <> 5 AND codew.kvertrag <> 1 THEN 
                   REM CALL Fehler("Sie erhalten jetzt die Mîglichkeit eine Produktkondition auszuwÑhlen,","an Hand derer die Sollstellung fÅr den Vertrag berechnet werden kann!")
                   FILE "VPGEKOND"
                   INDEX codevp.VPGEKOND
                   SELECT FIRST 
                   SELECT KEY codevp.kvertrag FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   a% = 0
                   codevp% = codevp.kvertrag
                   WHILE NOT EOF ("VPGEKOND") AND codevp.VPGEKOND = codevp%
                     ok% = - 1
                     IF ProviAB.kvertrag >= BWvon.vpgekond THEN 
                       IF BWBis.vpgekond > 0 THEN 
                         IF ProviAB.kvertrag <= BWBis.vpgekond THEN 
                         ELSE 
                           ok% = 0
                         END IF 
                       END IF 
                     ELSE 
                       ok% = 0
                     END IF 
                     IF ok% = - 1 THEN 
                       KVKond$(a%) = "BWVon:" + DATE$ (bwvon.VPGEKOND,"0d.mm.yyyy") + " "
                       IF bwbis.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "BWBis:" + DATE$ (bwbis.VPGEKOND,"0d.mm.yyyy") + " "
                       END IF 
 
                       IF Monatjn.VPGEKOND = "j" AND MonatFakt.VPGEKOND > 0 THEN 
                         IF MonatBrutto.vpgekond = "j" THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Brutto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         ELSE 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Netto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                       END IF 
 
                       IF Pauschalejn.VPGEKOND = "j" AND Pauschale.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:Pauschale=" + LTRIM$ ( STR$ (Pauschale.VPGEKOND,"9999.0000")) + " " + Waehrung.kvertrag
                       END IF 
 
                       IF apjn.VPGEKOND = "j" AND ap.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:" + LTRIM$ ( STR$ (ap.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       IF courtagejn.VPGEKOND = "j" AND courtage.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "Courtage:" + LTRIM$ ( STR$ (courtage.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       IF pflegejn.VPGEKOND = "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Pflege:" + LTRIM$ ( STR$ (pflegeProvi.VPGEKOND,"99.0000")) + " "
                       END IF 
                       IF srjn.VPGEKOND = "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Storno:" + LTRIM$ ( STR$ (sr.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       KVKond$(a%) = KVKond$(a%) + SPACE$ (100) + STR$ (codekey.VPGEKOND,"000000")
                       REM KVKond$(a%) = STR$ (codekey.VPGEKOND,"000000")
                       a% = a% + 1
                       REM IF VS_NR.kvertrag LIKE "12345678-87654321" THEN CALL Fehler("12345678-87654321", STR$ (codekey.VPGEKOND,"000000"))
                     END IF 
                     IF a% < 1 THEN 
                       SELECT NEXT FILE "VPGEKOND" INDEX codevp.VPGEKOND
                     ELSE 
                       SELECT LAST FILE "VPGEKOND" INDEX codevp.VPGEKOND
                       codevp% = - 1
                     END IF 
                   WEND 
                   req% = a%
                   IF req% > 0 THEN 
                     CodeKey% = VAL ( RIGHT$ (KVKond$(0),6))
                     IF CodeKey% <> 0 THEN 
                       IF NOT EXISTS (lfdnr.kvertrag,codevt.kvskond) THEN 
                         CALL WriteLogA("SOLLST.TXT",VS_NR.kvertrag + " - SOLLKondition: " + KVKond$(0))
                         IF vs_nr.kvertrag LIKE "ALI 001-002-003" THEN 
                           REM CALL Fehler("","")
                         END IF 
                         BLANK FILE "KVSKOND"
                         CodeKey1% = SER ("KVSKOND",1)
                         CodeKey.kvskond = CodeKey1%
                         Codevt.KVSKOND = lfdnr.kvertrag
                         CodeKO.KVSKOND = CodeKey%
                         erledigt.KVSKOND = "n"
                         test1% = ddatum%
                         test1$ = DATE$ (test1%,"0d.mm.yyyy")
                         IF vs_nr.kvertrag LIKE "ALI 001-002-003" THEN 
                           REM CALL Fehler(test1$, DATE$ (Proviab.kvertrag,"0d.mm.yyyy") + " ZW " + STR$ (ZW.KVERTRAG,"00"))
                         END IF 
                         STORE FILE "KVSKOND"
                         UNLOCK CURRENT FILE "KVSKOND"
                         ag% = ag% + 1
                       END IF 
                       sollst.kvertrag = "j"
                       STORE FILE "kvertrag"
                       REM REQUEST "Wollen Sie jetzt gleich die Sollstellung ermitteln lassen?","",130,req1soll%
                       req1soll% = 1
                       IF req1soll% = 1 THEN 
                         CALL Sollstellung(lfdnr.kvertrag,0,dDATE$)
                       END IF 
                     END IF 
                   END IF 
                 END IF 
                 FILE cfile$
                 REM ***********************Ende Produktkonditionen ******************************************** 
                 SELECT NEXT LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
                 SET STATUS "VertrÑge bearbeitet: " + LTRIM$ ( STR$ (ai%,"9999999")) + " Åbergeben: " + LTRIM$ ( STR$ (ag%,"999999")) + " von " + LTRIM$ ( STR$ (rec%,"999999")) + " an die Sollstellung Åbergeben"
               WEND 
end270220023soll: 
 FILE "kvertrag"
 SELECT FIRST 
 CALL Fehler("Die Sollstellungserzeugung ist beendet!!!","Es wurden " + LTRIM$ ( STR$ (ag%,"999999")) + " VertrÑge von " + LTRIM$ ( STR$ (rec%,"999999")) + " an die Sollstellung Åbergeben")
 CALL WriteLogA("SOLLST.TXT","")
 CALL WriteLogA("SOLLST.TXT","Die Sollstellungserzeugung ist beendet!!! Es wurden " + LTRIM$ ( STR$ (ag%,"999999")) + " VertrÑge von " + LTRIM$ ( STR$ (rec%,"999999")) + " an die Sollstellung Åbergeben")
 CALL CloseLogA("SOLLST.TXT")
 SET STATUS ""
 END SUB 


SUB AutomSollEnd()
 CALL DFile(3,"VProdukt" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"GEKOND" + _fpw$)
 CALL DFile(3,"zeinvor" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"VPGEKOND" + _fpw$)
 CALL DFile(3,"KVSKOND" + _fpw$)
 CALL DFile(2,"OFFICE\ADRESSEN" + _fpw$)
   REQUEST "Wollen Sie alle Sollstellungen lîschen?","",135,req1234%
   IF req1234% = 1 THEN 
     MOUSE OFF 
     SET STATUS "RÅcksetzen der Sollkonditionen der VertrÑge"
     REMOVE FROM FILE "kvskond"
     SET STATUS "RÅcksetzen der Sollstellungen der VertrÑge"
     REMOVE FROM FILE "zeinvor"
     FILE "KVERTRAG"
     SET STATUS "RÅcksetzen des Sollkennzeichen der VertrÑge"
     UPDATE sollst.kvertrag = "n"
     END UPDATE 
     CLOSE FILE "KVERTRAG"
     CALL DFile(3,"KVERTRAG" + _fpw$)
     MOUSE ON 
   END IF 
   CALL Fehler("Es wurden alle Sollstellungen gelîscht!","")
 END SUB 




 REM Logdatei fÅr EURO-Umstellung
 '*******************************************************************************************************************
 '*           Logdatei fÅr EURO-Umstellung                                                                          *
 '*                                                                                                                 *
 '******************************************************************************************************************* 
 REM Anzeige Fehlerprotokoll - Konditionen
SUB ShowLogA(tdatei$)
 SET STATUS "Anzeige des Fehlerprotokolls"
 IF EXISTS (_netpath$ + tdatei$) THEN 
   REM LOAD TEXT _netpath$ + "EUUMW.TXT"
   REM EDIT TEXT 
   a% = CALL ("ShellExecute",0,"open",_netpath$ + tdatei$,"","",1)
 ELSE 
   CALL Fehler("Es konnte kein Fehlerprotokoll gefunden werden!","")
 END IF 
 SET STATUS "Bereit"
 END SUB 
 


 REM *************************************************************************************************************************
 REM *                        ALLGEMEINE LOGDATEI                                                                            *
 REM *************************************************************************************************************************
SUB CreateLogA(tdatei$)
 OPEN _netpath$ + tdatei$ FOR OUTPUT 
 ? "Datei " + UCASE$ (_netpath$) + tdatei$ + " erstellt am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " / " + TIME$ ( NOW ,"hh:mm:ss")
 ? "-------------------------------------------------------------------------"
 ? 
 CLOSE OUTPUT 
 END SUB 
 
SUB CloseLogA(tdatei$)
 OPEN _netpath$ + tdatei$ FOR APPEND 
 ? 
 ? "-------------------------------------------------------------------------"
 ? "Eintragung beendet am " + DATE$ ( TODAY ,"0d.mm.yyyy") + "/" + TIME$ ( NOW ,"hh:mm:ss")
 CLOSE OUTPUT 
 CREATE DIALOG "PROT",0,0,244,154,title$,"MS Sans Serif",8
 ADD DIALOG "PROT",4,0,0,244,130,0,""
 ADD DIALOG "PROT",9,6,9,22,22,2
 ADD DIALOG "PROT",5,35,13,194,10,0,"WÑhrend der zuletzt durchgefÅhrten Aktion wurde eine"
 ADD DIALOG "PROT",5,35,23,194,10,0,"Protokolldatei erstellt, in der eventuelle Fehler und Zusatz-"
 ADD DIALOG "PROT",5,35,33,194,10,0,"information gespeichert wurden."
 ADD DIALOG "PROT",5,35,53,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Ja" + CHR$ (34) + ", wenn Sie das Protokoll einsehen und"
 ADD DIALOG "PROT",5,35,63,194,10,0,"eventuell drucken wollen."
 ADD DIALOG "PROT",5,35,83,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Nein" + CHR$ (34) + ", wenn Sie das Protokoll nicht"
 ADD DIALOG "PROT",5,35,93,194,10,0,"einsehen mîchten."
 ADD DIALOG "PROT",5,35,113,194,10,0,"Wollen Sie das Protokoll einsehen?"
 ADD DIALOG "PROT",1,118,134,55,15,0,"&Nein",0,0
 ADD DIALOG "PROT",1,62,134,55,15,1,"&Ja",1,1
 DIALOG "PROT",req%
 REMOVE DIALOG "PROT"
 IF req% = 1 THEN CALL ShowLogA(tdatei$)
 END SUB 
 
SUB WriteLogA(tdatei$,logtext$)
 OPEN _netpath$ + tdatei$ FOR APPEND 
 ? FN ansi(logtext$)
 CLOSE OUTPUT 
 END SUB 
 
SUB DeleteLogA(tdatei$)
 IF EXISTS (_netpath$ + tdatei$) THEN DELETE _netpath$ + tdatei$
 END SUB 
 
 
 REM ***********************************************************************************************************************
SUB GesFiltADR()
   cv% = lfdnr.kvertrag
   kunr% = codeku.GAdrDat$
   codeku% = codeku.GAdrDat$
   a% = RECCOUNT ("geadr")
   DIM Waehrung$(a%,1)
   DIM Waehrung%(a%,1)
   REDIM Waehrung$(a%)
   REDIM Waehrung%(a%)
   REM FOR i% = 1 TO a%
     REM Waehrung$(i%) = ""
     REM Waehrung%(i%) = 0
   REM NEXT i%
   FILE "kvertrag"
   INDEX codeku.kvertrag
   SELECT WHERE 
   SELECT FIRST 
   SELECT KEY codeku% FILE "Kvertrag" INDEX codeku.kvertrag
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   WHILE NOT EOF ("kvertrag") AND codeku.kvertrag = codeku%
     IF codege.kvertrag > 0 THEN 
       codege% = codege.kvertrag
       j% = - 1
       FOR i% = 0 TO a%
         IF Waehrung%(i%) = codege% THEN i% = a% + 5000
       NEXT i%
       b% = a% + 5000
       IF i% < b% THEN 
         a% = a% + 1
         Waehrung%(a%) = codege%
         SELECT FIRST FILE "geadr" INDEX codege.geadr
         SELECT KEY codege% FILE "geadr" INDEX codege.geadr
         REM IF gesellschaft.geadr LIKE "Colo*" THEN CALL Fehler(gesellschaft.geadr, STR$ (codege.geadr,"000000"))
         Waehrung$(a%) = Gesellschaft.geadr + SPACE$ (90) + STR$ (codege%,"000000")
       END IF 
     END IF 
     SELECT NEXT FILE "Kvertrag" INDEX codeku.kvertrag
   WEND 
   REM Wenn Gesellschaften gefunden wurden, dann kann ein Serienbrief an die Gesellschaften erzeugt werden
   IF a% > 0 THEN 
   END IF 
 END SUB 

 REM ************************************************************************************************************************


 
 
 
 
 '      **************************************
 '      ** Routinen fÅr Formular "FILIALE" **
 '      **************************************
 
SUB FILIALE()
 IF disabled%("FILIALE") THEN END SUB 
 cuvc% = filialnr.filiale
 CALL DFile(2,"access" + _fpw$)
 CALL DFile(2,"accode" + _fpw$)
 _formend% = 0
 SET STATUS "Bereit"
 ON ERROR GOTO ErrorHandler
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   SUPERVISsub% = 0
   IF UCASE$ ( FORM ) <> "FILIALE" THEN 
     SET HEADING title$ + " - Filialverwaltung"
     IF EXISTS (GOFFForm$ + "filiale.sbv") THEN 
       OPEN FORM GOFFForm$ + "filiale"
     ELSE 
       OPEN FORM GOFFForm$ + "filiale"
     END IF 
     SET f = Superbase.Form
     SET STATUS "Filialverwaltung"
     FILE "filiale"
     INDEX name.filiale
     SELECT FIRST 
     SELECT FORM KEY name.filiale FILE "filiale" INDEX name.filiale
     fil% = filialnr.filiale
     a% = VorgÑnger.filiale
     SELECT KEY a% FILE "Filiale" INDEX filialnr.filiale
     filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
     SELECT FORM KEY fil% FILE "Filiale" INDEX filialnr.filiale
     CALL MNFiliale()
     FORM 
   END IF 
   MENU ON 
   MOUSE ON 
   FORM 
   CALL FSVUpdate()
   ON ERROR GOTO ErrorHandler
   f.suchen.enabled = - 1
   f.abbruch.enabled = 0
   f.abbruch.visible = 0
   CALL ClearKBDBuffer()
   GAppName$ = _netpath$ + "DOC\Allgemein.pdf"
 sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.Filiale,",9999.0000"))
 st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.Filiale,",9999.0000"))
 SET STATUS sq$ + st$
   WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL FSVPrev()
   CASE CrsRight%,PgDn%
     CALL FSVNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   CALL ClearKBDBuffer()
   SELECT CASE SUPERVISsub%
   CASE 1
     IF NOT disabled%("FILIALCHANGEOFF") THEN 
       fil% = filialnr.filiale
       REM CALL ReadHiera()
       a% = SelectOffice%("BÅro-VorgÑnger-Auswahl","",1,vorgÑnger.filiale)
       IF a% <> - 1 THEN 
         SELECT KEY fil% LOCK FILE "Filiale" INDEX filialnr.filiale
         vorgÑnger.filiale = a%
         STORE FILE "filiale"
         UNLOCK CURRENT FILE "filiale"
         CALL ReadHiera()
         SELECT KEY a% FILE "Filiale" INDEX filialnr.filiale
         filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
         SELECT KEY fil% FILE "Filiale" INDEX filialnr.filiale
       END IF 
     END IF 
     
     FORM 
   CASE 2
     SELECT FORM NEXT 
     fil% = filialnr.filiale
     a% = VorgÑnger.filiale
     SELECT KEY a% FILE "Filiale" INDEX filialnr.filiale
     filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
     SELECT FORM KEY fil% FILE "Filiale" INDEX filialnr.filiale
     FORM 
   CASE 3
     SELECT FORM PREVIOUS 
     REM CALL PSelectPrev()
     fil% = filialnr.filiale
     a% = VorgÑnger.filiale
     SELECT KEY a% FILE "Filiale" INDEX filialnr.filiale
     filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
     SELECT FORM KEY fil% FILE "Filiale" INDEX filialnr.filiale
     FORM 
   CASE 4
      REM suchen
      REM CALL FSVSuchen()
      a% = SelectOffice%("BÅro-Suche","",1,vorgÑnger.filiale)
      IF a% <> - 1 THEN 
        SELECT KEY a% FILE "Filiale" INDEX filialnr.filiale
        fil% = filialnr.filiale
        vorg% = VorgÑnger.filiale
        SELECT KEY vorg% FILE "Filiale" INDEX filialnr.filiale
        filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
        SELECT FORM KEY fil% FILE "Filiale" INDEX filialnr.filiale
        FORM 
      END IF 
   CASE 99
     IF NOT disabled%("FILIALEEDIT") THEN 
       CALL ButDesabled()
       REM filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
       FORM 
       MENU OFF 
       ENTER name.filiale,0
 
       MENU ON 
       CALL ButEnabled()
     
       'Jan: modi ---------------
       IF abbruch% = - 1 THEN 
         SELECT KEY filialnr.filiale FILE "filiale" INDEX filialnr.filiale
         FORM 
         abbruch% = 0
       ELSE 
          'es soll gespeichert werden
          IF jaDebug% = - 1 THEN CALL Fehler("Filiale speichern","")
          CALL MATimeStamp("filiale")
          CALL FStore("filiale")
          fil% = FilialNr.filiale'Position merken
          CALL ReadHiera()'Struktur neu einlesen
          SELECT FIRST FILE "Filiale" INDEX filialnr.filiale
          SELECT KEY fil% FILE "Filiale" INDEX filialnr.filiale
       END IF 
       'Jan ende ----------------    
     
       SELECT KEY filialnr.filiale FILE "filiale" INDEX filialnr.filiale
       fil% = FilialNr.filiale
       SELECT KEY vorgÑnger.filiale FILE "filiale" INDEX filialnr.filiale
       filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
       SELECT FORM KEY fil% FILE "filiale" INDEX filialnr.filiale
     END IF 
     FORM 
     REM CALL ReadHiera()
   END SELECT 
 WEND 
 _formend% = 0
 IF FileChanged%("filiale") = 1 THEN CALL FStore("filiale")
 SELECT KEY cuvc% FILE "filiale" INDEX filialnr.filiale
 END SUB 
 
 
 
 
 
 ' Felder in Maske updaten
 ' ======================================================================
 
SUB FSVUpdate()
 pawo$ = CALL ("crypt",Pa·wort.filiale)
 FORM 
 END SUB 
 
 ' Mitarbeiter neu erfassen
 ' ======================================================================
 
SUB FSVNeu()
 'IF nachname.filiale <> "" THEN CALL FStore("filiale")
 REM BLANK FILE "FILIALE" 
 REM SET STATUS "Datensatz neu angelegt..."
 REM CodeMA.FILIALE = SER ("filiale",1)
 REM filialnr.FILIALE = SER ("filiale",1) 
 
 'Jan: neu -------------------
 a% = AddOffice%("NEU")
 IF a% = - 1 THEN 'Cancel oder Fehler?
     IF NEW ("FILIALE") THEN 
          SELECT REMOVE FILE "FILIALE"
     END IF 
     SUPERVISsub% = 0
     FORM 
     END SUB 
 ELSE 
      IF a% <> - 1 THEN 
        SELECT KEY a% FILE "Filiale" INDEX filialnr.filiale
        fil% = filialnr.filiale
        vorg% = VorgÑnger.filiale
        SELECT KEY vorg% FILE "Filiale" INDEX filialnr.filiale
        filvorg$ = "VorgÑngerbÅro ist: " + name.filiale
        SELECT FORM KEY fil% FILE "Filiale" INDEX filialnr.filiale
        FORM 
        REM SELECT KEY fil% LOCK FILE "Filiale" INDEX filialnr.filiale
      END IF 
     SET STATUS "Datensatz neu angelegt..."
 END IF 
 'Jan ende -------------------
 
 SUPERVISsub% = 99
 FORM 
 END SUB 
 
 
 ' Mitarbeiter suchen
 ' ======================================================================
 
SUB FSVSuchen()
 REQUEST "WÑhlen Sie eine Filiale aus:","",25,req%,filialnr%,72,filialnr.filiale,name.filiale INDEX name.filiale
 IF req% = 1 THEN 
   SELECT FORM KEY filialnr% FILE "filiale" INDEX filialnr.filiale
 END IF 
 FORM 
 END SUB 
 
 
SUB FSVNext()
 FILE "filiale"
 SET INDEX name.filiale
 INDEX name.filiale
 REM CALL PSelectNext()
 SELECT FORM NEXT 
 FORM 
 END SUB 
 
SUB FSVPrev()
 FILE "filiale"
 SET INDEX name.filiale
 INDEX name.filiale
 REM CALL PSelectPrev()
 SELECT FORM PREVIOUS 
 FORM 
 END SUB 
 
 
SUB FSVLoeschen()
 cuma$ = CodeMA.filiale
 REQUEST "Mitarbeiter wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   SELECT KEY cuma$ LOCK FILE "filiale" INDEX CodeMA.filiale
   SELECT REMOVE FILE "filiale"
   SELECT NEXT FILE "filiale"
   FORM 
 END IF 
 FORM 
 END SUB 
 
SUB MNFiliale()
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 'Jan: neu -----------------------  
FUNCTION GetWkscodema$(prompt$,wks%)
 
 'Auswahl eines Mitarbeiters der Workstation _wks%
 '_prompt% kann die die CodeMa des aktuellen Mitarbeiters enthalten --> Init-Auswahl
 'file maadr mu· bereits geîffnet sein
 
 'Jan: neu --------------------
 'Mitarbeiter des BÅros einlesen
 IF jaDebug% = - 1 THEN CALL Fehler("mitarbeiter fÅr bÅro holen ...","")
 DIM Agenturen$(0)
 DIM Codes$(0)
 DIM Auswahl$(0)
 z% = 0
 
 'den Mitarbeiter <ohne Zuordnung> hineintackern
 Agenturen$(z%) = "<ohne Zuordnung>"
   Codes$(z%) = Zweimille$
 z% = 1
 IF workstation% = 0 THEN 
   SELECT FIRST FILE "filiale" INDEX filialnr.filiale
   SELECT KEY wks% FILE "filiale" INDEX filialnr.filiale
   filab$ = Name.filiale
 END IF 
 prompt$ = Agenturen$(0)
 SELECT FIRST FILE "maadr" INDEX CodeMa.Maadr
 WHILE NOT EOF ("maadr")
    aa% = IsWksVisible%(wks%)
    IF aa% = - 1 AND CodeMa.Maadr <> 0 AND workstation.maadr = wks% THEN 
      IF noanzeige.maadr <> "j" THEN 
        REDIM Agenturen$(z%)
        REDIM Codes$(z%)
        IF workstation% = 0 THEN 
          Agenturen$(z%) = Nachname.Maadr + ", " + Vorname.maadr + ", " + Agenturnr.maadr + " BÅro " + filab$
        ELSE 
          Agenturen$(z%) = Nachname.Maadr + ", " + Vorname.maadr + ", " + Agenturnr.maadr
        END IF 
        Codes$(z%) = STR$ (CodeMa.Maadr,"000000")
        z% = z% + 1
        IF prompt$ = STR$ (CodeMa.Maadr,"000000") THEN 
            prompt$ = Nachname.Maadr
        END IF 
      END IF 
    END IF 
 
    SELECT NEXT FILE "maadr" INDEX CodeMa.Maadr
 
 WEND 
 
 CREATE DIALOG "MASUCH",0,0,250,288,"Agentur-/VermittlerÅbersicht","MS Sans Serif",8
 ADD DIALOG "MASUCH",5,7,11,151,10,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
 ADD DIALOG "MASUCH",7,7,27,234,229,2,2,Agenturen$,Auswahl$,prompt$
 
 ADD DIALOG "MASUCH",1,46,268,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,103,268,55,15,0,"&Abbrechen",0,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 
 GetWkscodema$ = ""
 IF req% = 0 THEN 
    END FUNCTION 
 END IF 
 
 'zum Namen passende Codema suchen: 
 FOR i% = 0 TO z% - 1
    IF Auswahl$(0) = Agenturen$(i%) THEN 
        GetWkscodema$ = Codes$(i%)
        i% = z%
    END IF 
 NEXT i%
 
 IF GetWkscodema$ = "" OR VAL (GetWkscodema$) = 0 THEN 
    'Warnung, weil sollte eigentlich nicht vorkommen
    CALL Fehler("Vorgang abgebrochen!","Es wurde kein Mitarbeiter gefunden.")
 END IF 
 
 END FUNCTION 
  'Jan ende -------------------- 
 






 REM Sollstellung drucken
SUB ZEDruck(codevt%)
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der ZE in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
       IF DruInEur.stamm = 1 THEN 
         req1% = 1
       ELSE 
         CALL Fehler(t1$,t2$)
         REQUEST "öbersicht in EURO drucken?","",130,req1%
       END IF 
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
 gesell$ = ""
 suge% = 0
 codeaz% = codeaz.zeingan1
 IF codevt% <> 0 THEN 
   VSNR1$ = VS_Nr.kvertrag
 ELSE 
   VSNR1$ = ""
 END IF 
 opt&% = 0
 IF codevt% = 0 THEN opt&% = VAL (ReadConfig$("PROVIS","ZEIopt"))
 IF opt&% = 0 AND codevt% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZEIvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEIbis")
 IF bis$ = "leer" THEN bis$ = ""
 opt1ab&% = 1
 opt2ab&% = 0
w270120053: 
 CREATE DIALOG "ZEINSUCH",0,0,228,234,"ZahlungseingÑnge","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,169,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Buchungssatz suchen mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu durchsuchende Datenmenge durch die wahlfreie Angabe des Buchungsdatums einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,54,76,10,0,"Suche Åber..."
 ADD DIALOG "ZEINSUCH",3,58,62,149,12,0,"keine EinschrÑnkung",0,opt&%
 ADD DIALOG "ZEINSUCH",3,58,73,149,12,0,"Vertrags-/Policennummer",1,opt&%
 ADD DIALOG "ZEINSUCH",3,58,84,148,12,0,"Gesellschaft",2,opt&%
 ADD DIALOG "ZEINSUCH",3,58,95,148,12,0,"Produkt",3,opt&%
 IF MNdisabled%("SEEEINGBEI") THEN 
 ELSE 
   ADD DIALOG "ZEINSUCH",3,58,106,149,12,0,"eingereicht Åber",4,opt&%
 END IF 
 
 ADD DIALOG "ZEINSUCH",5,38,119,96,9,0,"Buchungszeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,131,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,132,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,131,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,132,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",3,58,141,149,12,0,"Buchungsdatum",1,opt1ab&%
 ADD DIALOG "ZEINSUCH",3,58,151,148,12,0,"FÑlligkeit",2,opt1ab&%
 
 ADD DIALOG "ZEINSUCH",4,0,165,228,45,0,""
 ADD DIALOG "ZEINSUCH",3,58,170,149,12,0,"gebuchte+nichtgebuchte  ZE",0,opt2ab&%
 ADD DIALOG "ZEINSUCH",3,58,182,148,12,0,"gebuchte ZE",1,opt2ab&%
 ADD DIALOG "ZEINSUCH",3,58,194,148,12,0,"nichtgebuchte ZE",2,opt2ab&%
 
 ADD DIALOG "ZEINSUCH",1,54,213,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,213,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
   
 

 IF req% = 1 THEN 
   IF von$ = "" THEN von$ = "1.1.0001"
   IF bis$ = "" THEN bis$ = "31.12.2999"
   IF DateOK%(von$) THEN 
   ELSE 
     CALL Fehler("Datum VOM ist falsch!","")
     GOTO w270120053
   END IF 
   IF DateOK%(bis$) THEN 
   ELSE 
     CALL Fehler("Datum BIS ist falsch!","")
     GOTO w270120053
   END IF 
 
   CALL WriteConfig("PROVIS","ZEIvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEIbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEIopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"ZahlungseingÑnge","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten DatensÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
     IF ok% = - 1 THEN 
       eingab$ = VSNR$
       nvt% = 0
       nvt% = GetVertrADR%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,vongen$,bisgen$)
       VSNR1$ = VSNR$
       VSNR$ = VSNR$ + "*"
       IF nvt% = 0 THEN ok% = 0
     END IF 
 
   ELSE 
     IF opt&% = 2 THEN 
       suge% = GetCodeGE%(0)
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY suge% FILE "geadr" INDEX codege.geadr
       gesell$ = gesellschaft.geadr
       IF suge% < 1 THEN ok% = 0
     END IF 
     IF opt&% = 3 THEN 
       cvp% = GetVprodukt%(0,0, - 1)
       IF cvp% < 1 THEN 
         ok% = 0
       ELSE 
         produkt$ = Gesellschaft.vprodukt + "/" + sparte.vprodukt
       END IF 
     END IF 
     IF opt&% = 4 THEN 
       suge% = GetCodeGEE%(0)
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY suge% FILE "geadr" INDEX codege.geadr
       gesell$ = gesellschaft.geadr
       IF suge% < 1 THEN ok% = 0
     END IF 
   END IF 
 END IF 
 IF ok% = 0 THEN END SUB 
 von0$ = von$
 bis0$ = bis$
 IF von$ = "" THEN von% = 0 ELSE von% = DAYS (von$)
 IF bis$ = "" THEN bis% = DAYS ("31.12.2999") ELSE bis% = DAYS (bis$)
 
 
 IF eu% = 0 THEN 
   CALL PRep("ZEDR")
   REPORT ON beitrag% AS "BewSum%",BewSum% AS "anz%",beitragbr% AS "BewSumbr%"
   AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
   END REPORT 
 
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   GROUP Gesellschaft.GEADR,beitrag% AS "BewSum%",BewSum% AS "anz%",beitragbr% AS "BewSumBr%"
 ELSE 
   CALL PRep("ZEDRE")
   REPORT ON beitrag% AS "BewSum%",BewSum% AS "anz%",beitragbr% AS "BewSumbr%"
   AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
   END REPORT 
 
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   GROUP Gesellschaft.GEADR,beitrag% AS "BewSum%",BewSum% AS "anz%",beitragbr% AS "BewSumBr%"
 END IF 
 BEFORE GROUP Gesellschaft.GEADR
     SET REPORT PAGE "H_Gesellscha002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Gesellschaft.GEADR
     SET REPORT PAGE "F_Gesellscha002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 ON ERROR GOTO ze170320021
 ueberschr0$ = "ZahlungseingÑnge " + drwaehr$
 
 IF gesell$ <> "" THEN 
   IF opt&% = 2 THEN 
     ueberschr0$ = ueberschr0$ + " fÅr Gesellschaft " + gesell$
   ELSE 
     ueberschr0$ = ueberschr0$ + " eingereicht Åber Gesellschaft " + gesell$
   END IF 
 ELSE 
   IF codevt% <> 0 THEN 
     ueberschr0$ = ueberschr0$ + " fÅr Vertrag " + VSNR1$
   END IF 
 END IF 
 IF produkt$ <> "" THEN 
   ueberschr0$ = ueberschr0$ + " fÅr Produkt " + produkt$
 END IF 
 IF von0$ <> "" THEN 
   ueberschr1$ = "im Zeitraum von " + von0$
   IF bis0$ <> "" THEN 
     ueberschr1$ = ueberschr1$ + " bis " + bis0$
   END IF 
 ELSE 
   IF bis0$ <> "" THEN 
     ueberschr1$ = "im Zeitraum bis " + bis0$
   END IF 
 END IF 
 IF von0$ = "" AND bis0$ = "" THEN 
   ueberschr1$ = "alle ZahlungseingÑnge ohne ZeitraumbeschrÑnkung"
 END IF 
 IF opt2ab&% = 0 THEN 
   REM alles
   ueberschr1$ = ueberschr1$ + " gebuchte und nicht gebuchte ZE"
 END IF 
 IF opt2ab&% = 1 THEN 
   ueberschr1$ = ueberschr1$ + " gebuchte ZE"
 END IF 
 IF opt2ab&% = 2 THEN 
   ueberschr1$ = ueberschr1$ + " nicht gebuchte ZE"
 END IF 
 SET QUERY ON 
 SET QUERY LOCK OFF 
     a$ = "adressen"
     k$ = "Kvertrag"
     z$ = "zeingan1"
     g$ = "geadr"
     s$ = "Sparten"
 IF codevt% <> 0 THEN 
   IF opt1ab&% = 2 THEN 
     IF opt2ab&% = 0 THEN 
       REM gebuchte und nicht gebuchte
       SELECT ;
       WHERE codevt.z$ = codevt% AND CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis%
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,Buchungsdatum.zeingan1
       TO ASK 
       END SELECT 
     END IF 
     IF opt2ab&% = 1 THEN 
       REM gebuchte
       SELECT ;
       WHERE codevt.z$ = codevt% AND CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND gebuchtJN.z$ = "J"
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,Buchungsdatum.zeingan1
       TO ASK 
       END SELECT 
     END IF 
     IF opt2ab&% = 2 THEN 
       REM nicht gebuchte
       SELECT ;
       WHERE codevt.z$ = codevt% AND CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND gebuchtJN.z$ <> "J"
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,Buchungsdatum.zeingan1
       TO ASK 
       END SELECT 
     END IF 
   ELSE 
     IF opt2ab&% = 0 THEN 
       REM gebuchte und nicht gebuchte
       SELECT ;
       WHERE codevt.z$ = codevt% AND CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum.z$ >= von% AND BuchungsDatum.z$ <= bis%
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,Buchungsdatum.zeingan1
       TO ASK 
       END SELECT 
     END IF 
     IF opt2ab&% = 1 THEN 
       REM gebuchte 
       SELECT ;
       WHERE codevt.z$ = codevt% AND CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum.z$ >= von% AND BuchungsDatum.z$ <= bis% AND gebuchtJN.z$ = "J"
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,Buchungsdatum.zeingan1
       TO ASK 
       END SELECT 
     END IF 
     IF opt2ab&% = 2 THEN 
       REM nicht gebuchte
       SELECT ;
       WHERE codevt.z$ = codevt% AND CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum.z$ >= von% AND BuchungsDatum.z$ <= bis% AND gebuchtJN.z$ <> "J"
       ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,Buchungsdatum.zeingan1
       TO ASK 
       END SELECT 
     END IF 
   END IF 
 ELSE 
   IF opt&% = 0 THEN 
     REM alles drucken
     a$ = "adressen"
     k$ = "Kvertrag"
     IF opt1ab&% = 2 THEN 
       REM Buchungsdatum
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit.z$ >= von% AND FÑlligkeit.z$ <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     ELSE 
       REM FÑligkeit
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     END IF 
   END IF 
   IF opt&% = 2 THEN 
     a$ = "adressen"
     k$ = "Kvertrag"
     REM nach Gesellschaft suchen
     IF opt1ab&% = 2 THEN 
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte  
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte   
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte  
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     ELSE 
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte   
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte   
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     END IF 
   END IF 
   REM opt&%=4
   IF opt&% = 4 THEN 
     a$ = "adressen"
     k$ = "Kvertrag"
     REM nach Gesellschaft suchen
     IF opt1ab&% = 2 THEN 
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte  
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeEingGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte   
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeEingGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte  
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeEingGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     ELSE 
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte   
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeEingGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeEingGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte   
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeEingGE.K$ = CodeGE.G$ AND codege.g$ = suge% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     END IF 
   END IF 
   REM Ende opt&%=4
   IF opt&% = 3 THEN 
     a$ = "adressen"
     k$ = "Kvertrag"
     REM nach Produkt suchen
     IF opt1ab&% = 2 THEN 
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte    
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codevp.k$ = cvp% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte 
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codevp.k$ = cvp% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte    
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codevp.k$ = cvp% AND CodeVA.K$ = CodeVA.S$ AND FÑlligkeit >= von% AND FÑlligkeit <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     ELSE 
       IF opt2ab&% = 0 THEN 
         REM gebuchte und nicht gebuchte     
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codevp.k$ = cvp% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis%
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 1 THEN 
         REM gebuchte      
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codevp.k$ = cvp% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ = "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
       IF opt2ab&% = 2 THEN 
         REM nicht gebuchte     
         SELECT ;
         WHERE CodeVT.z$ = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.G$ AND codevp.k$ = cvp% AND CodeVA.K$ = CodeVA.S$ AND BuchungsDatum >= von% AND BuchungsDatum <= bis% AND gebuchtJN.z$ <> "J"
         ORDER REPORT Gesellschaft.GEADR,VS_Nr.zeingan1,FÑlligkeit.zeingan1
         TO ASK 
         END SELECT 
       END IF 
     END IF 

   END IF 
 END IF 
ze170320021: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 

  




  
 
  

 REM Dokumentenverwaltung fÅr VERTRéGE

SUB VertrDokNew()
 cuvt% = lfdnr.KVERTRAG
 IF disabled%("DOKUMENT") THEN END SUB 
 REM CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 cudo% = CodeDOK.DOKKV
 _formend% = 0
 SET STATUS "Bereit"
 maske$ = "DOVGES"
 
 FILE "DOKKV"
 INDEX codeku.DOKKV
 SELECT FIRST 
 
 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   DOKsub% = 0
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Vertrags-Dokumentenverwaltung"
     IF EXISTS (GOFFForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GOFFForm$ + maske$
     ELSE 
       OPEN FORM GOFFForm$ + maske$
     END IF 
     SET STATUS "Vertrags-Dokumentenverwaltung"
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\Dokument.pdf"
     CALL MNDOVSRV1()
     CALL ADRDovNewInt()
     FORM 
     SET DISPLAY ON 
   END IF 
   MENU ON 
   FORM 
   MOUSE ON 
   dokgrup$ = Gruppe.DOKKV
   FORM 
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE DOKsub%
   CASE 1
     CALL ADRDOK()
     CALL ADRDovNewInt()
   CASE 2
     CALL DOVSRV1()
   CASE 3
     CALL DokSuchen(knr%,"")
     IF cudo% <> 0 AND codeku.DOKKV = cuvt% THEN 
       cudo% = CodeDOK.DOKKV
       SELECT KEY cudo% FILE "DOKKV" INDEX codedok.DOKKV
       CALL DOVSRV1()
     END IF 
   CASE 4
     CALL DokFilt()
     CALL ADRDovNewInt()
     FORM 
   
   CASE 22
          maske$ = "DOVGES"
   CASE 23
          maske$ = "DOVGESPR"
   CASE 24
          maske$ = "DOVGES1"
   CASE 25
          maske$ = "DOVGES2"
   CASE 26
          maske$ = "DOVGES3"
   CASE 27
          maske$ = "DOVGESPR"
   END SELECT 
 WEND 
 _formend% = 0
 SELECT WHERE FILE "DOKKV"
     IF GCODieRuf% = - 1 THEN 
       ret% = CALL ("_SearchClose"):REM CALL Fehler("","")
       GCODieRuf% = 0
     END IF 
 REM IF FileChanged%(DOKKV) = 1 THEN CALL FStore(DOKKV)
 END SUB 
 

SUB MNDOVSRV1()
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 

SUB ADRDovNewInt()
 SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT FORM KEY cuvt% FILE "DOKKV" INDEX codeku.DOKKV
 END SUB 

SUB DOVSRV1()
 IF disabled%("DOKUMENT") THEN END SUB 
 cudo% = CodeDOK.DOKKV
 _formend% = 0
 SET STATUS "Bereit"
 maske$ = "DOVUMENT"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   DOKsub% = 0
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " Vertrags - Dokumentenverwaltung"
     IF EXISTS (GOFFForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GOFFForm$ + maske$
     ELSE 
       OPEN FORM GOFFForm$ + maske$
     END IF 
     SET f = superbase.form
     GAppName$ = _netpath$ + "DOC\Dokument.pdf"
     SET STATUS "Vertrags-Dokumentenverwaltung"
     CALL MNDOVSRV()
     FILE "DOKKV"
     INDEX Dokument.DOKKV
     SELECT FORM FIRST 
     FORM 
     SET DISPLAY ON 
   END IF 
   MENU ON 
   MOUSE ON 
   REM dokgrup$ = Gruppe.GDokDat$
   SELECT FORM KEY cudo% FILE "DOKKV" INDEX codedok.DOKKV
   dokgrup$ = Gruppe.DOKKV
   f.imp.visible = 0
   f.such.visible = 0
   f.left.visible = 0
   f.right.visible = 0
   REM f.doksuchen.visible = 0
   FORM 
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE DOKsub%
   CASE 1
     codeku% = codeku.DOKKV
     CALL DokSuchen1(codeku%,"")
     cudo% = codedok.DOKKV
   CASE 2
     REM dokument lîschen
     codeku% = codeku.DOKKV
     CALL DOKVLoeschen()
     IF EXISTS (codeku%,codeku.DOKKV) THEN 
       SELECT FORM KEY codeku% FILE "DOKKV" INDEX codeku.DOKKV
       FORM 
     ELSE 
       _formend% = 1
       CALL Fehler("Es sind keine weiteren Dokumente fÅr diesen Vertrag vorhanden!","")
     END IF 
   CASE 3
     IF NOT disabled%("DOKUMENTBEARB") THEN 
       MENU OFF 
       CALL DOKAuswGrup()
       MENU ON 
     END IF 
   CASE 99
     IF NOT disabled%("DOKUMENTBEARB") THEN 
       MENU OFF 
       ENTER Dokument.DOKKV,0
       MENU ON 
     END IF 
   END SELECT 
 WEND 
 _formend% = 0
 IF FileChanged%("DOKKV") = 1 THEN CALL FStore("DOKKV")
 
 END SUB 


SUB MNDOVSRV()
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
 REM vonwo%=0 aus der Vermittlermaske / vonwo%=1 aus dem GDV-Import 
SUB MAGdvAgent(codematmp%,vonwo%,Agenturnummer$)
 MOUSE OFF 
 cfile$ = FILE 
 DIM Telefonliste$(120)
 ok% = - 1
 WHILE ok%
   MOUSE OFF 
   SELECT KEY codematmp% FILE "maadr" INDEX codema.maadr
   FILE "maadrag"
   INDEX codema.maadrag
   SELECT FIRST FILE "maadrag" INDEX codema.maadrag
   SELECT KEY codematmp% FILE "maadrag" INDEX codema.maadrag
   a% = 0
   prompt$ = "ZZZZZZ"
   WHILE codema.maadrag = codematmp% AND NOT EOF ("maadrag")
     Telefonliste$(a%) = AGnummer.maadrag + ", " + Notiz.maadrag + SPACE$ (80) + STR$ (codeag.maadrag,"000000")
     IF Telefonliste$(a%) < prompt$ THEN prompt$ = Telefonliste$(a%)
     a% = a% + 1
     SELECT NEXT 
   WEND 
   TelefonListe$(a%) = ""
   Kunde$ = Nachname.maadr + ", " + Vorname.maadr
   IF vonwo% = 0 THEN 
     CREATE DIALOG "maadrag",0,0,243,179,"GDV Vermittlernr.liste","MS Sans Serif",8
     ADD DIALOG "maadrag",5,5,6,56,10,0,"Liste von:"
     ADD DIALOG "maadrag",5,62,6,174,9,128,Kunde$
     ADD DIALOG "maadrag",5,5,22,65,10,0,"VM-Nummer/Notiz:"
     ADD DIALOG "maadrag",7,5,32,168,137,2,2,Telefonliste$,Auswahl$,prompt$
     ADD DIALOG "maadrag",1,180,32,55,15,1,"&OK",1,1
     ADD DIALOG "maadrag",1,180,50,55,15,0,"&Abbrechen",0,0
     ADD DIALOG "maadrag",1,180,98,55,15,0,"&Neu",3,1
     IF a% <> 0 THEN ADD DIALOG "maadrag",1,180,116,55,15,0,"én&dern",4,1
     ADD DIALOG "maadrag",1,180,134,55,15,0,"&Lîschen",5,1
     MOUSE ON 
     DIALOG "maadrag",req%
     REMOVE DIALOG "maadrag"
   ELSE 
     req% = 3
   END IF 
   SELECT CASE req%
   CASE 1,0
     ok% = 0
   CASE 2
     kn% = codema.maadr
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY telnr% FILE "maadrag" INDEX codeag.maadrag

     GOTO aend2605983
aend2605984: 
     REM CALL Fehler("Das Tedas Telefonprogramm wurde noch nicht aufgerufen!","")
     ON ERROR GOTO ErrorHandler
aend2605983: 
   CASE 3
     Nummer$ = ""
     IF Agenturnummer$ = "" THEN 
       AGnummer$ = ""
     ELSE 
       AGnummer$ = Agenturnummer$
     END IF 
aend26059831:  
     CREATE DIALOG "maadrag",0,0,242,179,"GDV Vermittlernr.liste(neuer Eintrag)","MS Sans Serif",8
     ADD DIALOG "maadrag",5,5,6,56,10,0,"Liste von:"
     ADD DIALOG "maadrag",5,62,6,174,8,128,Kunde$
     ADD DIALOG "maadrag",5,5,22,65,10,0,"VM-Nummer/Notiz:"
     ADD DIALOG "maadrag",7,5,32,168,81,2,2,Telefonliste$,Auswahl$
     ADD DIALOG "maadrag",1,180,32,54,14,1,"&OK",1,1
     ADD DIALOG "maadrag",1,180,49,54,16,0,"&Abbrechen",0,0
     ADD DIALOG "maadrag",5,5,121,156,21,0,"Bitte geben Sie die Daten fÅr den neuen Eintrag ein."
     ADD DIALOG "maadrag",6,54,144,131,10,0,0,AGnummer$,12
     ADD DIALOG "maadrag",5,5,145,48,10,0,"AGNr:"
     ADD DIALOG "maadrag",6,54,156,131,10,0,0,Nummer$,50
     ADD DIALOG "maadrag",5,5,156,47,10,0,"&Notiz:"
     DIALOG "maadrag",req%
     REMOVE DIALOG "maadrag"
     IF req% = 1 THEN 
       IF EXISTS (AGnummer$,AGNummer.maadrag) THEN 
         cma% = codema.maadr
         SELECT FIRST FILE "maadrag" INDEX AGNummer.maadrag
         SELECT KEY AGnummer$ FILE "maadrag" INDEX AGNummer.maadrag
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY codema.maadrag FILE "maadr" INDEX codema.maadr
         nam$ = Vorname.maadr + " " + nachname.maadr
         CALL Fehler ("Diese Vermittlernummer wurde bereits vergeben!(fÅr Vermittler: " + nam$ + ")","Bitte kontrollieren!")
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY cma% FILE "maadr" INDEX codema.maadr
         GOTO aend26059831
       END IF 
       BLANK FILE "maadrag"
       codeag.maadrag = SER ("maadrag",1)
       AGnummer.maadrag = AGnummer$
       Notiz.maadrag = Nummer$
       codema.maadrag = codematmp%
       CALL FStore("maadrag")
       IF vonwo% = 1 THEN GOTO ezu200220033
       SELECT FORM KEY codematmp% FILE "maadr" INDEX codema.maadr
       FORM 
     END IF 
   CASE 4
     prompt$ = Auswahl$(0)
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY telnr% FILE "maadrag" INDEX codeag.maadrag
     AGnummer$ = AGnummer.maadrag
     Nummer$ = Notiz.maadrag
     CREATE DIALOG "maadrag",0,0,242,179,"GDV Vermittlernr.liste(Eintrag Ñndern)","MS Sans Serif",8
     ADD DIALOG "maadrag",5,5,6,56,10,0,"Liste von:"
     ADD DIALOG "maadrag",6,54,144,131,11,0,0,AGnummer$,50
     ADD DIALOG "maadrag",6,54,156,131,10,0,0,Nummer$,35
     ADD DIALOG "maadrag",5,62,6,174,8,128,Kunde$
     ADD DIALOG "maadrag",5,5,22,65,10,0,"VM-Nummer/Notiz:"
     ADD DIALOG "maadrag",7,5,32,168,81,2,2,Telefonliste$,Auswahl$,prompt$
     ADD DIALOG "maadrag",1,180,32,54,14,1,"&OK",1,1
     ADD DIALOG "maadrag",1,180,49,54,16,0,"&Abbrechen",0,0
     ADD DIALOG "maadrag",5,5,121,156,21,0,"Bitte geben Sie die gewÅnschten énderungen fÅr den gewÑhlten Eintrag ein."
     ADD DIALOG "maadrag",5,5,145,45,10,0,"AGNr.:"
     ADD DIALOG "maadrag",5,5,156,45,10,0,"&Notiz:"
     DIALOG "maadrag",req%
     REMOVE DIALOG "maadrag"
     IF req% = 1 THEN 
       SELECT KEY telnr% LOCK FILE "maadrag" INDEX codeag.maadrag
       AGnummer.maadrag = AGnummer$
       Notiz.maadrag = Nummer$
       CALL FStore("maadrag")
       SELECT FORM KEY codematmp% FILE "maadr" INDEX codema.maadr
       FORM 
     END IF 
   CASE 5
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     IF EXISTS (telnr%,codeag.maadrag) THEN 
       SELECT KEY telnr% LOCK FILE "maadrag" INDEX codeag.maadrag
       REQUEST "Soll der Eintrag '" + AGnummer.maadrag + "' wirklich gelîscht werden?","",135,req%
       IF req% = 1 THEN 
         SELECT REMOVE FILE "maadrag"
         SELECT FORM KEY codematmp% FILE "maadr" INDEX codema.maadr
         FORM 
       END IF 
     END IF 
   END SELECT 
 WEND 
ezu200220033: 
 FILE cfile$
 END SUB 



 REM *********************************************************************************************************************
 REM    Lîschen eines Vermittlers in MASUP dessen Daten durch den Mitarbeiter eingesehen werden dÅrfen
 REM *********************************************************************************************************************

SUB MASUPLoeschen()
 cuma% = CodeMA.SUPERVIS
 CALL DFile(3,"MAADR" + _fpw$)
 DIM Auswahl$( RECCOUNT ("MAADR"))
 DIM Rechte$( RECCOUNT ("MAADR"))
 FILE "MASUPER"
 INDEX vonMitarbeiter.masuper
 SELECT FIRST 
 a% = 0
 WHILE NOT EOF ("MASUPER")
   IF CodeMA.MASUPER = cuma% THEN 
     IF GASP% THEN 
       SELECT FIRST FILE "MAADR" INDEX codema.maadr
       SELECT KEY vonCodeMA.MASUPER FILE "MAADR" INDEX codema.maadr
       SELECT FIRST FILE "FILIALE" INDEX filialnr.filiale
       SELECT KEY workstation.maadr FILE "FILIALE" INDEX filialnr.filiale
       Rechte$(a%) = vonMitarbeiter.MASUPER + " BÅro: " + name.filiale + SPACE$ (120) + STR$ (vonCodeMA.MASUPER,"000000")
       a% = a% + 1
     ELSE 
       Rechte$(a%) = vonMitarbeiter.MASUPER + SPACE$ (120) + STR$ (vonCodeMA.MASUPER,"000000")
       a% = a% + 1
     END IF 
   END IF 
   SELECT NEXT 
 WEND 
 FILE "MASUPER"
 INDEX QCodeMAVonCoMA.MASUPER
 CREATE DIALOG "ACCESS",0,0,355,212,title$,"MS Sans Serif",8
 ADD DIALOG "ACCESS",9,6,8,20,20,2
 ADD DIALOG "ACCESS",5,36,9,152,8,0,"Bitte markieren Sie den Vermittler, den Sie fÅr"
 ADD DIALOG "ACCESS",5,36,17,152,10,0,"den aktuellen Mitarbeiter nicht mehr freigeben wollen:"
 ADD DIALOG "ACCESS",7,36,28,256,185,10,2,Rechte$,Auswahl$
 ADD DIALOG "ACCESS",1,296,173,55,15,1,"&OK",1,1
 ADD DIALOG "ACCESS",1,296,191,55,15,0,"&Abbrechen",0,0
 DIALOG "ACCESS",req%
 REMOVE DIALOG "ACCESS"
 IF req% = 1 THEN 
   SET STATUS "Mitarbeiterdatei wird aktualisiert..."
   MOUSE OFF 
   a% = 0
   WHILE Auswahl$(a%) <> ""
     vonCodeMA% = VAL ( RIGHT$ (Auswahl$(a%),6))
     QCodeMAVonCoMA$ = STR$ (cuma%,"000000") + STR$ (vonCodeMA%,"000000")
     REM SELECT KEY codeac% FILE "ACCODE" INDEX CodeAC.ACCODE
     REM scode$ = STR$ (CodePR.ACCODE,"000000") + STR$ (cuma%,"000000") + ACCODE.ACCODE
     REM SELECT KEY scode$ LOCK FILE "ACCESS" INDEX QuickCode.ACCESS
     REMOVE FROM FILE "MASUPER" WHERE QCodeMAVonCoMA.MASUPER = QCodeMAVonCoMA$
     REM SELECT FIRST FILE "MASUPER" INDEX vonCodeMA.MASUPER
     REM SELECT KEY vonCodeMA% LOCK FILE "MASUPER" INDEX vonCodeMA.MASUPER
     REM IF FOUND ("ACCESS") THEN SELECT REMOVE FILE "ACCESS"
     a% = a% + 1
   WEND 
 END IF 
 SET STATUS "Bereit"
 FILE "SUPERVIS"
 SELECT FORM KEY cuma% FILE "SUPERVIS" INDEX CodeMA.SUPERVIS
 SET INDEX Nachname.SUPERVIS
 INDEX Nachname.SUPERVIS
   FILE "MASUPER"
   INDEX codema.masuper
   SELECT FIRST 
   REDIM GMASuper$( RECCOUNT ("maadr") + 100,1)
   REDIM GMASuper%( RECCOUNT ("maadr") + 100,1)
   REDIM GMASuper$( RECCOUNT ("maadr") + 100)
   REDIM GMASuper%( RECCOUNT ("maadr") + 100)
   GMASuperCount% = 0
   IF EXISTS (GMACodeMA%,codema.masuper) THEN 
     SELECT KEY codema.supervis FILE "MASUPER" INDEX codema.masuper
     i% = 0
     WHILE NOT EOF ("MASUPER") AND codema.masuper = codema.supervis
       GMASuper$(i%) = vonMitarbeiter.masuper
       GMASuper%(i%) = voncodema.masuper
       i% = i% + 1
       SELECT NEXT FILE "MASUPER" INDEX codema.masuper
     WEND 
     GMASuperCount% = i%
   END IF 
 FILE "SUPERVIS"
 FORM 
 MOUSE ON 
 END SUB 



 REM *********************************************************************************************************************
 REM    HinzufÅgen eines Vermittlers in MASUP dessen Daten durch den Mitarbeiter eingesehen werden dÅrfen
 REM ********************************************************************************************************************* 

SUB MASUPAdd()
 cuma% = CodeMA.SUPERVIS
 CALL DFile(3,"MAADR" + _fpw$)
 DIM Auswahl$( RECCOUNT ("MAADR") + 100)
 DIM Rechte$( RECCOUNT ("MAADR") + 100)
 FILE "MAADR"
 INDEX nachname.maadr
 SELECT FIRST 
 a% = 0
 WHILE NOT EOF ("MAADR")
   scode$ = STR$ (cuma%,"000000") + STR$ (CodeMA.maadr,"000000")
   SELECT KEY scode$ FILE "MASUPER" INDEX QCodeMAVonCoMA.MASUPER
   IF NOT EXISTS (scode$,QCodeMAVonCoMA.MASUPER) THEN 
     IF GASP% THEN 
       SELECT FIRST FILE "FILIALE" INDEX filialnr.filiale
       SELECT KEY workstation.maadr FILE "FILIALE" INDEX filialnr.filiale
       Rechte$(a%) = Nachname.maadr + "," + Vorname.maadr + " BÅro: " + name.filiale + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
       a% = a% + 1
     ELSE 
       Rechte$(a%) = Nachname.maadr + "," + Vorname.maadr + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
       a% = a% + 1
     END IF 
   END IF 
   SELECT NEXT FILE "MAADR" INDEX nachname.maadr
 WEND 
 CREATE DIALOG "ACCESS",0,0,395,212,title$,"MS Sans Serif",8
 ADD DIALOG "ACCESS",9,6,8,20,20,2
 ADD DIALOG "ACCESS",5,36,9,152,8,0,"Bitte markieren Sie die Vermittler, die Sie fÅr"
 ADD DIALOG "ACCESS",5,36,17,152,10,0,"den aktuellen Mitarbeiter freigeben wollen:"
 ADD DIALOG "ACCESS",7,36,28,296,185,10,2,Rechte$,Auswahl$
 ADD DIALOG "ACCESS",1,336,173,55,15,1,"&OK",1,1
 ADD DIALOG "ACCESS",1,336,191,55,15,0,"&Abbrechen",0,0
 DIALOG "ACCESS",req%
 REMOVE DIALOG "ACCESS"
 FILE "MAADR"
 INDEX codema.maadr
 SELECT FIRST 
 IF req% = 1 THEN 
   SET STATUS "Mitarbeiterdatei wird aktualisiert..."
   MOUSE OFF 
   a% = 0
   WHILE Auswahl$(a%) <> ""
     vonCodeMA% = VAL ( RIGHT$ (Auswahl$(a%),6))
     SELECT FIRST FILE "MAADR" INDEX codema.MAADR
     SELECT KEY vonCodeMA% FILE "MAADR" INDEX codema.MAADR
     IF GASP% THEN 
       SELECT FIRST FILE "FILIALE" INDEX filialnr.filiale
       SELECT KEY workstation.maadr FILE "FILIALE" INDEX filialnr.filiale
     END IF 
     IF EXISTS (vonCodeMA%,codema.maadr) THEN 
       BLANK FILE "MASUPER"
       CodeMA.MASUPER = cuma%
       vonCodeMA.MASUPER = vonCodeMA%
       IF GASP% THEN 
         vonMitarbeiter = LEFT$ (Nachname.maadr + "," + vorname.maadr + "  ,BÅro: " + name.filiale,100)
       ELSE 
         vonMitarbeiter = LEFT$ (Nachname.maadr + "," + vorname.maadr)
       END IF 
       QCodeMAVonCoMA.MASUPER = STR$ (cuma%,"000000") + STR$ (vonCodeMA%,"000000")
       CALL QuickStore("MASUPER")
     END IF 
     a% = a% + 1
   WEND 
 END IF 
 SET STATUS "Bereit"
 FILE "SUPERVIS"
 SELECT FORM KEY cuma% FILE "SUPERVIS" INDEX CodeMA.SUPERVIS
 SET INDEX Nachname.SUPERVIS
 INDEX Nachname.SUPERVIS
 FORM 
 MOUSE ON 
 END SUB 
 


 REM *********************************************************************************************************************
 REM    Sutor Vertragsliste mit Sutorstatus fÅr Agenturen
 REM *********************************************************************************************************************  

SUB SutorVli1(ma1%)
  REM CALL DFile(3,"AFSDRU" + _fpw$)
  REM IF RECCOUNT ("AFSDRU") > 0 THEN REMOVE FROM FILE "AFSDRU"
  FILE "KVERTRAG"
  INDEX lfdnr.kvertrag
  SELECT WHERE FILE "KVERTRAG"
  FILE "maadr"
  INDEX codema.maadr
  SELECT WHERE FILE "maadr"
  FILE "AFSPSP"
  INDEX codevt.afspsp
  SELECT WHERE FILE "afspsp"
  SELECT FIRST LOCK FILE "afspsp"
  FILE "AFSKSUT"
  INDEX codevt.afsksut
  SELECT WHERE FILE "afsksut"
  SELECT FIRST LOCK FILE "afsksut"
  i% = 0
  j% = RECCOUNT ("AFSKSUT")
  CALL Fehler("Sie erhalten jetzt die Mîglichkeit die Sutor-und die PSP-Datei fÅr den Ausdruck vorzubereiten","Wenn Sie das bereits getan haben und nur die Ausgabe wiederholen wollen, kînnen Sie diesen Schritt Åbergehen!")
  REQUEST "Wollen Sie die Aufbereitung durchfÅhren lassen?","",130,req5%
  IF req5% <> 1 THEN 
    REM CALL Fehler("Der Ausdruck kann nicht vorgenommem werden, da erst die Sutor und die PSP Datei zusammengespielt werden mÅssen!","")
    REM GOTO endsutorvli1
    CALL Fehler("Wenn der Ausdruck fehlende Sparten, Gesellschaften und /oder Vermittler aufweist, dann bitte auf jeden Fall die Aufbreitung durchfÅhren lassen!","")
    GOTO anfdrusutorvli1
  END IF 
  MOUSE OFF 
  k% = 0
  WHILE NOT EOF ("AFSKSUT")
    IF EXISTS (codevt.afsksut,lfdnr.kvertrag) AND AGNachname.afsksut = "" THEN 
      SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
      SELECT KEY codevt.afsksut FILE "KVERTRAG" INDEX lfdnr.kvertrag
      IF EXISTS (codema.kvertrag,codema.maadr) THEN 
        i% = i% + 1
        SELECT FIRST FILE "maadr" INDEX codema.maadr
        SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
        sparte.afsksut = Sparte.kvertrag
        codema.afsksut = codema.maadr
        AGNachname.afsksut = Nachname.maadr
        AGVorname.afsksut = Vorname.maadr
        Agenturnr.afsksut = Agenturnr.maadr
        SELECT CASE status_.afsksut
        CASE 1
          statustxt.afsksut = "Erstzahlung"
        CASE 3
          statustxt.afsksut = "KÅndigung Kunde"
        CASE 4
          statustxt.afsksut = "KÅndigung Sutor"
        CASE 5
          statustxt.afsksut = "Widerruf nach Erstzahlung"
        CASE 6
          statustxt.afsksut = "offene Resttilgung"
        CASE 7
          statustxt.afsksut = "Resttilgung Null nach Stornomeldung"
        CASE 8
          statustxt.afsksut = "Resttilgung Null"
        CASE 9
          statustxt.afsksut = "énderung Vermittlernummer"
        CASE 10
          statustxt.afsksut = "énderung Ratenhîhe"
        CASE 11
          statustxt.afsksut = "Storno AGB-Zahlungen"
        CASE 30
          statustxt.afsksut = "Antrag widerrufen"
        CASE 31
          statustxt.afsksut = "Vertrag angenommen"
        CASE 32
          statustxt.afsksut = "Folgezahlung"
        CASE 33
          statustxt.afsksut = "Widerrunf Kunde"
        CASE 34
          statustxt.afsksut = "KÅndigung Kunde"
        CASE 35
          statustxt.afsksut = "KÅndigung Sutor"
        CASE 36
          statustxt.afsksut = "keine Zahlung nach 6 Wochen"
        CASE 37
          statustxt.afsksut = "keine Zahlung nach 12 Wochen"
        END SELECT 
        STORE FILE "AFSKSUT"
        UNLOCK CURRENT FILE "AFSKSUT"
        REM BLANK FILE "AFSDRU"
        REM a% = CopyRecord%("AFSKSUT","AFSDRU")
        REM STORE FILE "AFSDRU"
      END IF 
    ELSE 
      k% = k% + 1
    END IF 
    SET STATUS LTRIM$ ( STR$ (i%,",99999999")) + " Sutor-DatensÑtze von " + LTRIM$ ( STR$ (j%,",99999999")) + " kontrolliert " + LTRIM$ ( STR$ (k%,",99999999")) + " Sutor-fÅr den Ausdruck vorbereitet"
    SELECT NEXT LOCK FILE "AFSKSUT" INDEX codevt.afsksut
  WEND 
  ii% = 0
  jj% = RECCOUNT ("AFSPSP")
  MOUSE OFF 
  WHILE NOT EOF ("AFSPSP")
    IF EXISTS (codevt.afsPSP,lfdnr.kvertrag) AND AGNachname.afspsp = "" THEN 
      SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
      SELECT KEY codevt.afsPSP FILE "KVERTRAG" INDEX lfdnr.kvertrag
      IF EXISTS (codema.kvertrag,codema.maadr) THEN 
        ii% = ii% + 1
        SELECT FIRST FILE "maadr" INDEX codema.maadr
        SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
        sparte.afsPSP = Sparte.kvertrag
        codema.afsPSP = codema.maadr
        AGNachname.afsPSP = Nachname.maadr
        AGVorname.afsPSP = Vorname.maadr
        Agenturnr.afsPSP = Agenturnr.maadr
        STORE FILE "AFSpsp"
        UNLOCK CURRENT FILE "AFSpsp"
        REM BLANK FILE "AFSDRU"
        REM a% = CopyRecord%("AFSPSP","AFSDRU")
        REM STORE FILE "AFSDRU"
      END IF 
    ELSE 
      k% = k% + 1
    END IF 
    SET STATUS LTRIM$ ( STR$ (ii%,",99999999")) + " DatensÑtze von " + LTRIM$ ( STR$ (jj%,",99999999")) + " kontrolliert " + LTRIM$ ( STR$ (k%,",99999999")) + " PSP-fÅr den Ausdruck vorbereitet"
    SELECT NEXT LOCK FILE "AFSpsp" INDEX codevt.afspsp
  WEND 
anfdrusutorvli1: 
 bis$ = TODAY 
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Sutor-Liste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Zeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Zeitraum eintragen, werden alle DatensÑtze aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 MOUSE ON 
 IF req% = 1 THEN 
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
     ELSE 
       GOTO anfdrusutorvli1
     END IF 
   ELSE 
     von$ = "01.01.0001"
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
     ELSE 
       GOTO anfdrusutorvli1
     END IF 
   ELSE 
     bis$ = TODAY 
   END IF 
 ELSE 
   CALL Fehler("Ausgabe wurde durch User abgebrochen!","")
   GOTO endsutorvli1
 END IF 
  von% = DAYS (von$)
  bis% = DAYS (bis$)
  von$ = DATE$ (von%,"0d.mm.yyyy")
  bis$ = DATE$ (bis%,"0d.mm.yyyy")
  FILE "AFSPSP"
  REM PSP-Liste
  CALL PRep("AFSKVLI3")
  gesamt% = 0
  IF von$ = "01.01.0001" AND bis$ = "31.12.2999" THEN 
    Header$ = "PSP-Statusreport Gesamt"
    gesamt% = 1
  ELSE 
    IF von$ = "01.01.0001" AND bis$ <> "31.12.2999" THEN 
      Header$ = "PSP-Statusreport fÅr den gesamten Zeitraum bis zum " + bis$
    ELSE 
      Header$ = "PSP-Statusreport fÅr den Zeitraum vom " + von$ + " bis zum " + bis$
    END IF 
  END IF 
  AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
  END REPORT 
 
  HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
  END HEADING 
  GROUP AGNachname.afspsp
 
  BEFORE GROUP AGNachname.AFSPSP
     SET REPORT PAGE "H_AGNachname002"
     OUTPUT REPORT PAGE 
  END GROUP 
 
  AFTER GROUP AGNachname.AFSPSP
     SET REPORT PAGE "F_AGNachname002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
  END GROUP 
 
  AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
  END SELECT 
  ON ERROR GOTO endsutorvli0
  SET QUERY OFF 
  SET QUERY LOCK OFF 
  IF gesamt% = 1 THEN 
    IF ma1% < 1 THEN 
      SELECT ;
       WHERE AGNachname.afspsp <> "" AND ((status_.afspsp > 2 AND status_.afspsp < 6) OR (status_.afspsp > 9 AND status_.afspsp < 32) OR (status_.afspsp > 32 AND status_.afspsp < 38))
       ORDER REPORT AGNachname.afspsp,AGVorname.afspsp,Nachname.afspsp,VS_NR.afspsp,Datum1.afspsp
       TO ASK 
      END SELECT 
    ELSE 
      SELECT ;
       WHERE Codema.afspsp = ma1% AND ((status_.afspsp > 2 AND status_.afspsp < 6) OR (status_.afspsp > 9 AND status_.afspsp < 32) OR (status_.AFSPSP > 32 AND status_.AFSPSP < 38))
       ORDER REPORT AGNachname.afspsp,AGVorname.afspsp,Nachname.afspsp,VS_NR.afspsp,Datum1.afspsp
       TO ASK 
      END SELECT 
    END IF 
  ELSE 
    IF ma1% < 1 THEN 
      SELECT ;
       WHERE (AGNachname.afspsp <> "" AND Datum1.afspsp >= von% AND Datum1.afspsp <= bis%) AND ((status_.afspsp > 2 AND status_.afspsp < 6) OR (status_.afspsp > 9 AND status_.afspsp < 32) OR (status_.afspsp > 32 AND status_.afspsp < 38))
       ORDER REPORT AGNachname.afspsp,AGVorname.afspsp,Nachname.afspsp,VS_NR.afspsp,Datum1.afspsp
       TO ASK 
      END SELECT 
    ELSE 
      SELECT ;
       WHERE (Codema.afspsp = ma1% AND Datum1.afspsp >= von% AND Datum1.afspsp <= bis%) AND ((status_.afspsp > 2 AND status_.afspsp < 6) OR (status_.afspsp > 9 AND status_.afspsp < 32) OR (status_.afspsp > 32 AND status_.afspsp < 38))
       ORDER REPORT AGNachname.afspsp,AGVorname.afspsp,Nachname.afspsp,VS_NR.afspsp,Datum1.afspsp
       TO ASK 
      END SELECT 
    END IF 
  END IF 



endsutorvli0: 
  REM sutorliste
  FILE "AFSKSUT"
  CALL PRep("AFSKVLI1")
  gesamt% = 0
  IF von$ = "01.01.0001" AND bis$ = "31.12.2999" THEN 
    Header$ = "Sutor-Statusreport Gesamt"
    gesamt% = 1
  ELSE 
    IF von$ = "01.01.0001" AND bis$ <> "31.12.2999" THEN 
      Header$ = "Sutor-Statusreport fÅr den gesamten Zeitraum bis zum " + bis$
    ELSE 
      Header$ = "Sutor-Statusreport fÅr den Zeitraum vom " + von$ + " bis zum " + bis$
    END IF 
  END IF 
  AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
  END REPORT 
 
  HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
  END HEADING 
  GROUP AGNachname.AFSKSUT
  BEFORE GROUP AGNachname.AFSKSUT
     SET REPORT PAGE "H_AGNachname002"
     OUTPUT REPORT PAGE 
  END GROUP 
 
  AFTER GROUP AGNachname.AFSKSUT
     SET REPORT PAGE "F_AGNachname002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
  END GROUP 
 
  AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
  END SELECT 
  ON ERROR GOTO endsutorvli1
  SET QUERY OFF 
  SET QUERY LOCK OFF 
  IF gesamt% = 1 THEN 
    IF ma1% < 1 THEN 
      SELECT ;
       WHERE AGNachname.AFSKSUT <> "" AND ((status_.AFSKSUT > 2 AND status_.AFSKSUT < 6) OR (status_.AFSKSUT > 9 AND status_.AFSKSUT < 32) OR (status_.AFSKSUT > 32 AND status_.AFSKSUT < 38))
       ORDER REPORT AGNachname.AFSKSUT,AGVorname.AFSKSUT,Nachname.AFSKSUT,VS_NR.AFSKSUT,Datum1.AFSKSUT
       TO ASK 
      END SELECT 
    ELSE 
      SELECT ;
       WHERE Codema.AFSKSUT = ma1% AND ((status_.AFSKSUT > 2 AND status_.AFSKSUT < 6) OR (status_.AFSKSUT > 9 AND status_.AFSKSUT < 32) OR (status_.AFSKSUT > 32 AND status_.AFSKSUT < 38))
       ORDER REPORT AGNachname.AFSKSUT,AGVorname.AFSKSUT,Nachname.AFSKSUT,VS_NR.AFSKSUT,Datum1.AFSKSUT
       TO ASK 
      END SELECT 
    END IF 
  ELSE 
    IF ma1% < 1 THEN 
      SELECT ;
       WHERE (AGNachname.AFSKSUT <> "" AND Datum1.AFSKSUT >= von% AND Datum1.AFSKSUT <= bis%) AND ((status_.AFSKSUT > 2 AND status_.AFSKSUT < 6) OR (status_.AFSKSUT > 9 AND status_.AFSKSUT < 32) OR (status_.AFSKSUT > 32 AND status_.AFSKSUT < 38))
       ORDER REPORT AGNachname.AFSKSUT,AGVorname.AFSKSUT,Nachname.AFSKSUT,VS_NR.AFSKSUT,Datum1.AFSKSUT
       TO ASK 
      END SELECT 
    ELSE 
      SELECT ;
       WHERE (Codema.AFSKSUT = ma1% AND Datum1.AFSKSUT >= von% AND Datum1.AFSKSUT <= bis%) AND ((status_.AFSKSUT > 2 AND status_.AFSKSUT < 6) OR (status_.AFSKSUT > 9 AND status_.AFSKSUT < 32) OR (status_.AFSKSUT > 32 AND status_.AFSKSUT < 38))
       ORDER REPORT AGNachname.AFSKSUT,AGVorname.AFSKSUT,Nachname.AFSKSUT,VS_NR.AFSKSUT,Datum1.AFSKSUT
       TO ASK 
      END SELECT 
    END IF 
  END IF 


endsutorvli1: 
 ON ERROR GOTO ErrorHandler
 END SUB 



SUB KVNoteBig(fnam$)
   notizn$ = fnam$ + ".kvertrag"
   LÑnge$ = FIELDINFO$ (notizn$,4)
   lÑnge% = VAL (LÑnge$)
   inh$ = notizn$$
   SET EDIT SELECT OFF 
   SET EDIT SELECT ON 
   nr$ = VS_NR.kvertrag + " " + vnehmer.kvertrag
   CREATE DIALOG GTelDat$,0,0,443,253,"Notiz","MS Sans Serif",8
   ADD DIALOG GTelDat$,5,5,6,56,10,0,"Vertrag:"
   ADD DIALOG GTelDat$,5,62,6,380,9,128,nr$
   ADD DIALOG GTelDat$,5,5,22,165,10,0,"Notiz: zum Zeilenumbruch Strg+Enter drÅcken"
   REM ADD DIALOG GTelDat$,6,5,32,430,200,4,0,inh$
   ADD DIALOG GTelDat$,6,5,32,430,200,68,3,inh$,lÑnge%
   ADD DIALOG GTelDat$,1,170,235,55,15,1,"&OK",1,1
   ADD DIALOG GTelDat$,1,237,235,55,15,0,"&Druck",2,2
   DIALOG GTelDat$,req%
   REMOVE DIALOG ALL 
   IF inh$ <> notizn$$ THEN 
     REM es wurde geÑndert
     IF NOT disabled%("VERTRBEARB") THEN 
       REQUEST "énderungen speichern?","",130,req%
       IF req% = 1 THEN 
         SELECT CURRENT LOCK FILE "KVERTRAG"
         notizn$$ = LEFT$ (inh$,lÑnge%)
         CALL QuickStore("KVERTRAG")
       END IF 
     END IF 
   END IF 
   IF req% = 2 THEN 
     PRINT ;
     ? inh$
     DISPLAY ;
   END IF 
   SET EDIT SELECT ON 
 END SUB 


  





 REM **********************************************************************************************************
 REM              AFSK Maklerbetreuer MAADR
 REM **********************************************************************************************************
 
SUB MABetrKond(codema%)
 CALL DFile(3,"maadr" + _fpw$)
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 codema% = codema.maadr
 voncodema% = codema.maadr
 vonAgentur$ = Nachname.maadr + ", " + Vorname.maadr
 BGEADRsub% = 0
 FILE "MABETREU"
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "MABETREU" THEN 
     SET HEADING title$ + " - Maklerbetreuung"
     OPEN FORM GPrjForm$ + "MABETREU"
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\spezprov.pdf"
     CALL MABetrKondIntro(codema%)
     CALL MNMABetrKond()
     SET STATUS "Fîrderkonditionen"
   END IF 
   MENU ON 
   MOUSE ON 
   BGEADRsub% = 0
   CALL ClearKBDBuffer()
   FORM 
   f.sich.visible = 0
   f.abbruch.visible = 0
   f.loe.visible = - 1
   f.neu.visible = - 1
   f.bearb.visible = - 1
   f.zur.visible = - 1
   REM END IF 
   FILE "MABETREU"
   IF BGEADRsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE BGEADRsub%
   CASE 1
       REM Agentur auswÑhlen
       codekey% = codekey.MABETREU
       voncodema% = voncodema.MABETREU
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       IF ma% > 0 THEN 
         IF ma% <> voncodema.MABETREU THEN 
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY ma% FILE "maadr" INDEX codema.maadr
           SELECT KEY codekey% LOCK FILE "MABETREU" INDEX codekey.MABETREU
           codema.MABETREU = ma%
           Agentur.MABETREU = LEFT$ ( LTRIM$ (Nachname.maadr) + "," + LTRIM$ (Vorname.maadr),70)
           CALL QuickStore("MABETREU")
           vagents$ = Agentur.MABETREU
         ELSE 
           CALL Fehler ("Sie kînnen nicht die Fîrderprovision von dem Mitarbeiter abziehen,der die Fîrderprovision erhalten soll!","Bitte wÑhlen Sie einen anderen Mitarbeiter aus!")
         END IF 
       END IF 
       SELECT KEY voncodema% FILE "maadr" INDEX codema.maadr
       FORM 
   CASE 2
     CALL MABETREUSich()
   CASE 3
     voncodema% = voncodema.MABETREU
     IF NOT disabled%("MABETREULOE") THEN 
       REM CALL MABETREULoe()
       codekey% = codekey.MABETREU
       REMOVE FROM FILE "MABETREU" WHERE codekey.MABETREU = codekey%
       IF NOT EXISTS (voncodema%,voncodema.MABETREU) THEN END SUB 
     END IF 
   CASE 4
      codekey% = codekey.MABETREU
      SELECT KEY codekey% LOCK FILE "MABETREU" INDEX codekey.MABETREU
      IF codema.MABETREU > 0 THEN 
        vagents$ = Agentur.MABETREU
      ELSE 
        vagents$ = "WÑhlen Sie hier eine Agentur aus!"
      END IF 
      IF Vvoncodema.MABETREU > 0 THEN 
        pfuervv$ = VvonAgentur.MABETREU
      ELSE 
        pfuervv$ = "<Fîrderprovision auf alle VertrÑge >"
      END IF 
      FORM 2
   CASE 5
     CALL MABETREUNeu(codema%)
   CASE 6
     REM bestimmen, auf welche VertrÑge die Fîrderprovision gezahlt werden soll
       codekey% = codekey.MABETREU
       voncodema% = voncodema.MABETREU
       ma% = codekma%
       ma% = GetCodeMA%(ma%,Workstation%)
       IF ma% > 0 THEN 
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY ma% FILE "maadr" INDEX codema.maadr
         SELECT KEY codekey% LOCK FILE "MABETREU" INDEX codekey.MABETREU
         VvonCodema.MABETREU = ma%
         VvonAgentur.MABETREU = LEFT$ ( LTRIM$ (Nachname.maadr) + "," + LTRIM$ (Vorname.maadr),70)
         CALL QuickStore("MABETREU")
         pfuervv$ = VvonAgentur.MABETREU
       ELSE 
         SELECT KEY codekey% LOCK FILE "MABETREU" INDEX codekey.MABETREU
         VvonCodema.MABETREU = 0
         VvonAgentur.MABETREU = ""
         CALL QuickStore("MABETREU")
       END IF 
       IF Vvoncodema.MABETREU > 0 THEN 
         pfuervv$ = VvonAgentur.MABETREU
       ELSE 
         pfuervv$ = "<Fîrderprovision auf alle VertrÑge >"
       END IF 
       SELECT KEY voncodema% FILE "maadr" INDEX codema.maadr
       FORM 
   CASE 99
     REM 110197
     IF NOT disabled%("MABETREUBEARB") THEN 
       MOUSE ON 
       MENU OFF 
       REM IF RECCOUNT ("geadr") = 0 THEN CALL GEADRNeu()
         
         REM 101296
         REM _gesold$ = Gesellschaft.geadr
         REM CALL ButDesabled()
         REM f.notiz.enabled = 0
         REM f.vertragsuebersicht.enabled = 0
         f.sich.visible = - 1
         f.abbruch.visible = - 1
         f.loe.visible = 0
         f.bearb.visible = 0
         f.zur.visible = 0
         ENTER Pauschale.MABETREU,0
         f.sich.visible = 0
         f.abbruch.visible = 0
         f.loe.visible = - 1
         f.bearb.visible = - 1
         f.zur.visible = - 1
         REM CALL ButEnabled()
         REM f.notiz.enabled = - 1
         REM f.vertragsuebersicht.enabled = - 1
     
     END IF 
   END SELECT 
   IF abbruch% = - 1 THEN 
     FORM 
     abbruch% = 0
   END IF 
   MENU ON 
 WEND 
 _formend% = 0
 FILE "MABETREU"
 REM CALL VERTRIntro(1)
 END SUB 
 
 
SUB MABETREUNeu(codema%)
 
 IF disabled%("MABETREUNEU") THEN END SUB 
 FILE "MABETREU"
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 voncodema% = codema.maadr
 vonAgentur$ = Nachname.maadr + ", " + Vorname.maadr
 BLANK FILE "MABETREU"
 SET STATUS "Datensatz neu angelegt..."
 CodeKey% = SER ("MABETREU",1)
 CodeKey.MABETREU = CodeKey%
 Agentur.MABETREU = "<ohne Zuordnung>"
 codema.MABETREU = 0
 voncodema.MABETREU = voncodema%
 vonAgentur.MABETREU = vonAgentur$
 CALL QuickStore("MABETREU")
 FORM 2
 SELECT FORM KEY codeKey% FILE "MABETREU" INDEX codeKey.MABETREU
 vagents$ = "WÑhlen Sie hier eine Agentur aus!"
 FORM 
 BGEADRsub% = 99
 MOUSE ON 
 END SUB 
 
SUB MABETREUSich()
   CALL QuickStore("MABETREU")
 END SUB 
 
SUB MABetrKondIntro(codema%)
   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
   voncodema% = codema%
   FILE "MABETREU"
   INDEX Agentur.MABETREU
   
   SELECT FORM KEY voncodema% FILE "MABETREU" INDEX voncodema.MABETREU
   SELECT FORM KEY voncodema% FILE "MAADR" INDEX CodeMA.MAADR
   REM SELECT FIRST 
   FORM 
 REM INDEX gesellschaft.Kgeadr
 END SUB 
 
 
SUB MNMABetrKond()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
SUB MABetrKondLoe()
 voncodema% = voncodema.MABETREU
 codekey% = codekey.MABETREU
 REM IF disabled%("GEADRLOESCHEN") THEN END SUB 
 MOUSE OFF 
 REQUEST "Fîrderkondition wirklich lîschen?","",130,req%
 IF req% <> 1 THEN END SUB 
     SELECT KEY codekey% LOCK FILE "MABETREU" INDEX Codekey.MABETREU
     SELECT REMOVE FILE "MABETREU"
 SELECT FORM KEY voncodema% FILE "MABETREU" INDEX voncodema.MABETREU
 FORM 1
 FORM 
 MOUSE ON 
 END SUB 
 
 
 REM **********************************************************************************************************
 REM               ENDE Fîrderkonditionen
 REM **********************************************************************************************************
 

 REM **********************************************************************************************************
 REM               Anzeige der Ansprechpartner bei GEADR
 REM **********************************************************************************************************
 
SUB AsnprGEADR(no%)
    codege% = codege.geadr
    SELECT KEY codege% LOCK FILE "geadr" INDEX codege.geadr
    b$ = "B" + LTRIM$ ( STR$ (no%,"99")) + ".geadr"
    bereich$ = b$$
    a$ = "A" + LTRIM$ ( STR$ (no%,"99")) + ".geadr"
    ansprechname$ = a$$
    t1$ = "T" + LTRIM$ ( STR$ (no%,"99")) + ".geadr"
    Telefon1$ = t1$$
    t2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Telefon1.geadr"
    Telefon2$ = t2$$
    pl$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "PLZ.geadr"
    plz$ = pl$$
    o$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Ort.geadr"
    ort$ = o$$
    s$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Strasse.geadr"
    Strasse$ = s$$
    f1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Fax1.geadr"
    fax1$ = f1$$
    f2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Fax2.geadr"
    fax2$ = f2$$
    e1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Email1.geadr"
    email1$ = e1$$
    e2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Email2.geadr"
    email2$ = e2$$

    h1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Mobil1.geadr"
    handy1$ = h1$$
    h2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Mobil2.geadr"
    handy2$ = h2$$

    w1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "www1.geadr"
    www1$ = w1$$
    w2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "www2.geadr"
    www2$ = w2$$
    n$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Notiz.geadr"
    Notiz$ = n$$
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,418,298)
    dlg.Caption = "Gesellschaft - Ansprechpartner " + LTRIM$ ( STR$ (no%,"99"))
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(5,6,109,10)
    control.Caption = "Daten zum Ansprechpartner "
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(117,6,225,10)
    control.MaxLength = 35
    control.TextBinding = "ansprechname$"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(5,20,41,10)
    control.Caption = "Bereich"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(62,20,227,10)
    control.MaxLength = 20
    control.TextBinding = "bereich$"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(5,35,41,10)
    control.Caption = "PLZ"
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(62,35,47,10)
    control.MaxLength = 20
    control.TextBinding = "PLZ$"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(112,35,23,10)
    control.Caption = "Ort"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(136,35,206,10)
    control.MaxLength = 50
    control.TextBinding = "Ort$"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(5,48,41,10)
    control.Caption = "Strasse"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(62,48,280,10)
    control.MaxLength = 50
    control.TextBinding = "Strasse$"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(5,62,41,10)
    control.Caption = "Telefon 1"
 
    SET control = dlg.Add("DialogTextBox6","DialogTextBox")
    control.Move(62,62,150,10)
    control.MaxLength = 50
    control.TextBinding = "Telefon1$"
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(214,62,33,10)
    control.Caption = "Telefon 2"
 
    SET control = dlg.Add("DialogTextBox7","DialogTextBox")
    control.Move(250,62,162,10)
    control.MaxLength = 50
    control.TextBinding = "Telefon2$"
 
    SET control = dlg.Add("DialogLabel8","DialogLabel")
    control.Move(5,75,41,10)
    control.Caption = "Fax 1"
 
    SET control = dlg.Add("DialogTextBox8","DialogTextBox")
    control.Move(62,75,150,10)
    control.MaxLength = 50
    control.TextBinding = "Fax1$"
 
    SET control = dlg.Add("DialogLabel9","DialogLabel")
    control.Move(214,75,33,10)
    control.Caption = "Fax 2"
 
    SET control = dlg.Add("DialogTextBox9","DialogTextBox")
    control.Move(250,75,162,10)
    control.MaxLength = 50
    control.TextBinding = "Fax2$"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(5,88,41,10)
    control.Caption = "Handy 1"
 
    SET control = dlg.Add("DialogTextBox10","DialogTextBox")
    control.Move(62,88,150,10)
    control.MaxLength = 50
    control.TextBinding = "Handy1$"
 
    SET control = dlg.Add("DialogLabel11","DialogLabel")
    control.Move(214,88,33,10)
    control.Caption = "Handy 2"
 
    SET control = dlg.Add("DialogTextBox11","DialogTextBox")
    control.Move(250,88,162,10)
    control.MaxLength = 50
    control.TextBinding = "Handy2$"
 
    SET control = dlg.Add("DialogLabel12","DialogLabel")
    control.Move(5,100,41,10)
    control.Caption = "email 1"
 
    SET control = dlg.Add("DialogTextBox12","DialogTextBox")
    control.Move(62,100,150,10)
    control.MaxLength = 50
    control.TextBinding = "email1$"
 
    SET control = dlg.Add("DialogLabel13","DialogLabel")
    control.Move(214,100,33,10)
    control.Caption = "email 2"
 
    SET control = dlg.Add("DialogTextBox13","DialogTextBox")
    control.Move(250,100,162,10)
    control.MaxLength = 50
    control.TextBinding = "email2$"
 
    SET control = dlg.Add("DialogLabel14","DialogLabel")
    control.Move(5,113,41,10)
    control.Caption = "www 1"
 
    SET control = dlg.Add("DialogTextBox14","DialogTextBox")
    control.Move(62,113,150,10)
    control.MaxLength = 50
    control.TextBinding = "www1$"
 
    SET control = dlg.Add("DialogLabel15","DialogLabel")
    control.Move(214,113,34,10)
    control.Caption = "www 2"
 
    SET control = dlg.Add("DialogTextBox15","DialogTextBox")
    control.Move(250,113,162,10)
    control.MaxLength = 50
    control.TextBinding = "www2$"
 
    SET control = dlg.Add("DialogLabel18","DialogLabel")
    control.Move(5,126,41,10)
    control.Caption = "Notizen"
 
    SET control = dlg.Add("DialogTextBox18","DialogTextBox")
    control.Move(5,139,407,126)
    control.MultiLine = 1
    control.WantReturn = 1
    control.ScrollBars = 2
    control.MaxLength = 4000
    control.TextBinding = "Notiz$"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(144,272,63,14)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1

    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(210,272,63,14)
    control.Default = 0
    control.Caption = "Drucken"
    control.ReturnValue = 2


    DIALOG "Dialogname",req%
    REMOVE DIALOG ALL 
    MOUSE ON 


    REM *************************************************************
      ok% = 0
      IF bereich$ <> b$$ THEN ok% = - 1
      IF ansprechname$ <> a$$ THEN ok% = - 1
      IF Telefon1$ <> t1$$ THEN ok% = - 1
      IF Telefon2$ <> t2$$ THEN ok% = - 1
      p$ = pl$$
      IF plz$ <> pl$$ THEN ok% = - 1
      IF ort$ <> o$$ THEN ok% = - 1
      IF Strasse$ <> s$$ THEN ok% = - 1
      IF fax1$ <> f1$$ THEN ok% = - 1
      IF fax2$ <> f2$$ THEN ok% = - 1
      IF email1$ <> e1$$ THEN ok% = - 1
      IF email2$ <> e2$$ THEN ok% = - 1
      IF www1$ <> w1$$ THEN ok% = - 1
      IF www2$ <> w2$$ THEN ok% = - 1
      IF Notiz$ <> n$$ THEN ok% = - 1
      IF handy1$ <> h1$$ THEN ok% = - 1
      IF handy2$ <> h2$$ THEN ok% = - 1
      IF disabled%("GEADRBEARB") OR ag$ = "j" THEN ok% = 0
      IF ok% = - 1 THEN 
        REQUEST "Es wurden Daten geÑndert, wollen Sie die énderungen speichern?","",130,req%
        IF req% = 1 THEN 
          b$$ = bereich$
          a$$ = ansprechname$
          t1$$ = Telefon1$
          t2$$ = Telefon2$
          pl$$ = plz$
          o$$ = Ort$
          s$$ = Strasse$
          f1$$ = Fax1$
          f2$$ = Fax2$
          e1$$ = email1$
          e2$$ = email2$
          w1$$ = www1$
          w2$$ = www2$
          n$$ = Notiz$
          h1$$ = Handy1$
          h2$$ = Handy2$
          STORE FILE "Geadr"
         END IF 
    END IF 
         IF req% = 2 THEN 
           PRINT ;
           ? "Gesellschaft: " + Gesellschaft.geadr + " " + Gesellschaft2.geadr
           ? "Bereich: " + breich$
           ? "Ansprechpartner: " + ansprechname$
           ? "PLZ: " + PLZ$
           ? "Ort: " + Ort$
           ? "Strasse: " + Strasse$
           ? "Telefon1: " + Telefon1$
           ? "Telefon2: " + Telefon2$
           ? "Handy1: " + Handy1$
           ? "Handy2: " + Handy2$
           ? "Fax1: " + Fax1$
           ? "Fax2: " + Fax2$
           ? "email1: " + email1$
           ? "email2: " + email2$
           ? "www1: " + www1$
           ? "www2: " + www2$
           a% = LEN (notiz$)
           ? "Notiz: " + LEFT$ (Notiz$,2000)
           ? "Notiz: " + MID$ (Notiz$,2000)
           DISPLAY ;
           CALL Fehler("Druckausgabe beendet!","")
         END IF 
    REM *************************************************************

 SELECT FORM KEY codege% FILE "geadr" INDEX codege.geadr


 END SUB 



 REM **********************************************************************************************************
 REM               Anzeige der Kinder bei ADRESSEN
 REM **********************************************************************************************************
 
SUB KindGADRDat(no%)

 REM CALL FldAdd("K1Name","TXT;50",0)
 REM CALL FldAdd("K1NName","TXT;50",0)
 REM CALL FldAdd("K1Ort","TXT;50",0)
 REM CALL FldAdd("K1Strasse","TXT;50",0)
 REM CALL FldAdd("K1PLZ","TXT;50",0)
 REM CALL FldAdd("K1Telefon1","TXT;50",0)
 REM CALL FldAdd("K1Fax1","TXT;50",0)
 REM CALL FldAdd("K1Mobil1","TXT;50",0)
 REM CALL FldAdd("K1email1","TXT;50",0)
 REM CALL FldAdd("K1WWW1","TXT;50",0)
 REM CALL FldAdd("K1Telefon2","TXT;50",0)
 REM CALL FldAdd("K1Fax2","TXT;50",0)
 REM CALL FldAdd("K1Mobil2","TXT;50",0)
 REM CALL FldAdd("K1email2","TXT;50",0)
 REM CALL FldAdd("K1WWW2","TXT;50",0)

 REM CALL FldAdd("PANummerK1","TXT;50",0)
 REM CALL FldAdd("K1Geburtstag","DAT;0d.mm.yyyy",0)
 REM CALL FldAdd("K1Geschlecht","TXT;1",0)
 REM CALL FldAdd("K1Notiz","TXT;400 R",0)
 REM CALL FldAdd("PAAustdatK1","DAT;0d.mm.yyyy",0)
 REM CALL FldAdd("PAAustOrtK1","TXT;50",0)
 
  IF no% < 5 THEN 
    codeku% = codeku.GADRDat$
    SELECT KEY codeku% LOCK FILE GADRDat$ INDEX codeku.GADRDat$
    panrf$ = "PANummerK" + LTRIM$ ( STR$ (no%,"99")) + "." + GADRDat$
    panr$ = LTRIM$ (panrf$$)
    padatf$ = "PAAustdatK" + LTRIM$ ( STR$ (no%,"99")) + "." + GADRDat$
    IF padatf$$ > 0 THEN 
      padat$ = LTRIM$ ( DATE$ (padatf$$,"0d.mm.yyyy"))
    ELSE 
      padat$ = ""
    END IF 
    paortf$ = "PAAustOrtK" + LTRIM$ ( STR$ (no%,"99")) + "." + GADRDat$
    paort$ = LTRIM$ (paortf$$)

    a$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Name." + GADRDat$
    avname$ = LTRIM$ (a$$)
    b$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "NName." + GADRDat$
    aname$ = LTRIM$ (b$$)
    gebo$ = "GebortK" + LTRIM$ ( STR$ (no%,"99")) + "." + GADRDat$
    gebort$ = gebo$$
    gebt$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Geburtstag" + "." + GADRDat$
    IF gebt$$ > 0 THEN 
      gebtag$ = LTRIM$ ( DATE$ (gebt$$,"0d.mm.yyyy"))
    ELSE 
      gebtag$ = ""
    END IF 
  
    t1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Telefon1." + GADRDat$
    Telefon1$ = LTRIM$ (t1$$)
    t2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Telefon2." + GADRDat$
    Telefon2$ = LTRIM$ (t2$$)
    pl$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "PLZ." + GADRDat$
    plz$ = LTRIM$ (pl$$)
    o$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Ort." + GADRDat$
    ort$ = LTRIM$ (o$$)
    s$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Strasse." + GADRDat$
    Strasse$ = LTRIM$ (s$$)
    f1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Fax1." + GADRDat$
    fax1$ = LTRIM$ (f1$$)
    f2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Fax2." + GADRDat$
    fax2$ = LTRIM$ (f2$$)
    e1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Email1." + GADRDat$
    email1$ = LTRIM$ (e1$$)
    e2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Email2." + GADRDat$
    email2$ = LTRIM$ (e2$$)
 
    h1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Mobil1." + GADRDat$
    handy1$ = LTRIM$ (h1$$)
    h2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Mobil2." + GADRDat$
    handy2$ = LTRIM$ (h2$$)
 
    w1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "www1." + GADRDat$
    www1$ = LTRIM$ (w1$$)
    w2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "www2." + GADRDat$
    www2$ = LTRIM$ (w2$$)
    n$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Notiz." + GADRDat$
    NotizK$ = LTRIM$ (n$$)
    g$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Geschlecht." + GADRDat$
    geschl$ = LTRIM$ (g$$)
  ELSE 
    REM CALL FldAdd("PANummerEG","TXT;50",0)
    REM CALL FldAdd("PAAustdatEG","DAT;0d.mm.yyyy",0)
    REM CALL FldAdd("PAAustOrtEG","TXT;50",0)
    REM CALL FldAdd("EGTelefon1","TXT;50",0)
    REM CALL FldAdd("EGFax1","TXT;50",0)
    REM CALL FldAdd("EGMobil1","TXT;50",0)
    REM CALL FldAdd("EGemail1","TXT;50",0)
    REM CALL FldAdd("EGWWW1","TXT;50",0)
    REM CALL FldAdd("EGTelefon2","TXT;50",0)
    REM CALL FldAdd("EGFax2","TXT;50",0)
    REM CALL FldAdd("EGMobil2","TXT;50",0)
    REM CALL FldAdd("EGemail2","TXT;50",0)
    REM CALL FldAdd("EGWWW2","TXT;50",0)
    codeku% = codeku.GADRDat$
    SELECT KEY codeku% LOCK FILE GADRDat$ INDEX codeku.GADRDat$
    panrf$ = "PANummerEG." + GADRDat$
    panr$ = LTRIM$ (panrf$$)
    padatf$ = "PAAustdatEG." + GADRDat$
    IF padatf$$ > 0 THEN padat$ = LTRIM$ ( DATE$ (padatf$$,"0d.mm.yyyy"))
    paortf$ = "PAAustOrtEG." + GADRDat$
    paort$ = LTRIM$ (paortf$$)

    b$ = "EGNachName." + GADRDat$
    aname$ = LTRIM$ (b$$)
    a$ = "EGVorName." + GADRDat$
    avname$ = LTRIM$ (a$$)

    gebo$ = "EGGebort." + GADRDat$
    gebort$ = LTRIM$ (gebo$$)
    gebt$ = "EGGeburtstag" + "." + GADRDat$
    IF gebt$$ > 0 THEN 
      gebtag$ = LTRIM$ ( DATE$ (gebt$$,"0d.mm.yyyy"))
    ELSE 
      gebtag$ = ""
    END IF 

    t1$ = "EGTelefon1." + GADRDat$
    Telefon1$ = LTRIM$ (t1$$)
    t2$ = "EGTelefon2." + GADRDat$
    Telefon2$ = LTRIM$ (t2$$)
    pl$ = "EGASPLZ." + GADRDat$
    plz$ = LTRIM$ (pl$$)
    o$ = "EGASOrt." + GADRDat$
    ort$ = o$$
    s$ = "EGASStra·e." + GADRDat$
    Strasse$ = s$$
    f1$ = "EGFax1." + GADRDat$
    fax1$ = f1$$
    f2$ = "EGFax2." + GADRDat$
    fax2$ = f2$$
    e1$ = "EGEmail1." + GADRDat$
    email1$ = e1$$
    e2$ = "EGEmail2." + GADRDat$
    email2$ = e2$$
 
    h1$ = "EGMobil1." + GADRDat$
    handy1$ = h1$$
    h2$ = "EGMobil2." + GADRDat$
    handy2$ = h2$$
 
    w1$ = "EGwww1." + GADRDat$
    www1$ = w1$$
    w2$ = "EGwww2." + GADRDat$
    www2$ = w2$$
    n$ = "EGNotiz." + GADRDat$
    NotizK$ = n$$
    g$ = "EGGeschlecht." + GADRDat$
    geschl$ = LTRIM$ (g$$)
  END IF 
    DIM dlg AS Dialog
    DIM control AS DialogControl
danf201120021:  
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,438,318)
    dlg.Caption = "Dialogfeld-Titel"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(5,2,95,10)
    control.Caption = "Personendaten Vorname"
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(85,2,105,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "avname$"

    SET control = dlg.Add("DialogLabel103","DialogLabel")
    control.Move(194,2,35,10)
    control.Caption = "Nachname"

    SET control = dlg.Add("DialogTextBox16","DialogTextBox")
    control.Move(240,2,190,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "aname$"

    SET control = dlg.Add("DialogLabel99","DialogLabel")
    control.Move(5,14,55,10)
    control.Caption = "Geburtsort/Land"
 
    SET control = dlg.Add("DialogTextBox99","DialogTextBox")
    control.Move(61,14,129,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "gebort$"


    SET control = dlg.Add("DialogLabel100","DialogLabel")
    control.Move(194,14,40,10)
    control.Caption = "Geburtstag"
 
    SET control = dlg.Add("DialogTextBox100","DialogTextBox")
    control.Move(240,14,42,10)
    control.ScrollEnable = 2
    control.MaxLength = 10
    control.TextBinding = "gebtag$"


 REM *************************************************************************
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(282,13,40,15)
    control.Caption = "mÑnnlich"
    control.Bind("geschl$")
    control.ValueOn = "j"
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(325,13,40,15)
    control.Caption = "weiblich"
    control.Bind("geschl$")
    control.ValueOn = "n"
 
 REM *************************************************************************
 

    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(4,35,34,9)
    control.Caption = "PLZ"
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(40,35,46,9)
    control.MaxLength = 20
    control.TextBinding = "PLZ$"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(89,35,23,9)
    control.Caption = "Ort"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(113,35,207,9)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "ort$"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(4,48,34,9)
    control.Caption = "Strasse"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(40,48,280,9)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Strasse$"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(4,62,34,10)
    control.Caption = "Telefon 1"
 
    SET control = dlg.Add("DialogTextBox6","DialogTextBox")
    control.Move(40,62,170,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Telefon1$"
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(214,62,32,10)
    control.Caption = "Telefon 2"
 
    SET control = dlg.Add("DialogTextBox7","DialogTextBox")
    control.Move(250,62,184,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Telefon2$"
 
    SET control = dlg.Add("DialogLabel8","DialogLabel")
    control.Move(4,75,34,9)
    control.Caption = "Fax 1"
 
    SET control = dlg.Add("DialogTextBox8","DialogTextBox")
    control.Move(40,75,170,9)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Fax1$"
 
    SET control = dlg.Add("DialogLabel9","DialogLabel")
    control.Move(214,75,32,9)
    control.Caption = "Fax 2"
 
    SET control = dlg.Add("DialogTextBox9","DialogTextBox")
    control.Move(250,75,184,9)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Fax2$"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(4,88,34,9)
    control.Caption = "Handy 1"
 
    SET control = dlg.Add("DialogTextBox10","DialogTextBox")
    control.Move(40,88,170,9)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Handy1$"
 
    SET control = dlg.Add("DialogLabel11","DialogLabel")
    control.Move(214,88,32,9)
    control.Caption = "Handy 2"
 
    SET control = dlg.Add("DialogTextBox11","DialogTextBox")
    control.Move(250,88,184,9)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Handy2$"
 
    SET control = dlg.Add("DialogLabel12","DialogLabel")
    control.Move(4,100,34,10)
    control.Caption = "email 1"
 
    SET control = dlg.Add("DialogTextBox12","DialogTextBox")
    control.Move(40,100,170,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "email1$"
 
    SET control = dlg.Add("DialogLabel13","DialogLabel")
    control.Move(214,100,32,10)
    control.Caption = "email 2"
 
    SET control = dlg.Add("DialogTextBox13","DialogTextBox")
    control.Move(250,100,184,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "email2$"
 
    SET control = dlg.Add("DialogLabel14","DialogLabel")
    control.Move(4,113,34,10)
    control.Caption = "www 1"
 
    SET control = dlg.Add("DialogTextBox14","DialogTextBox")
    control.Move(40,113,170,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "www1$"
 
    SET control = dlg.Add("DialogLabel15","DialogLabel")
    control.Move(214,113,33,10)
    control.Caption = "www 2"
 
    SET control = dlg.Add("DialogTextBox15","DialogTextBox")
    control.Move(250,113,184,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "www2$"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(4,126,34,10)
    control.Caption = "PA-Nr."
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(40,126,170,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "panr$"
 
    SET control = dlg.Add("DialogLabel16","DialogLabel")
    control.Move(4,140,34,10)
    control.Caption = "PA-Datum"
 
    SET control = dlg.Add("DialogTextBox17","DialogTextBox")
    control.Move(40,140,42,10)
    control.MaxLength = 10
    control.TextBinding = "padat$"
 
    SET control = dlg.Add("DialogLabel17","DialogLabel")
    control.Move(101,140,41,10)
    control.Caption = "PA-Ort"
 
    SET control = dlg.Add("DialogTextBox19","DialogTextBox")
    control.Move(158,140,192,10)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "paort$"
 
    SET control = dlg.Add("DialogLabel18","DialogLabel")
    control.Move(5,164,41,10)
    control.Caption = "Notizen"
 
    SET control = dlg.Add("DialogTextBox18","DialogTextBox")
    control.Move(4,176,426,116)
    control.MultiLine = 1
    control.WantReturn = 1
    control.ScrollBars = 3
    control.MaxLength = 4000
    control.TextBinding = "NotizK$"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(176,299,62,14)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1
  
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(240,299,62,14)
    REM control.Default = 1
    control.Caption = "Abbruch"
    control.ReturnValue = 0
 
    DIALOG "Dialogname",req%
    REMOVE DIALOG ALL 
    MOUSE ON 
 
    IF req% = 0 THEN GOTO end230420061
    REM *************************************************************
      ok% = 0

      IF panr$ <> panrf$$ THEN ok% = - 1
      IF LTRIM$ (padat$) <> "" THEN 
        IF DateOK%(padat$) THEN 
          t1% = DAYS (padat$)
          t2% = padatf$$
          IF t1% <> t2% THEN ok% = - 1
        ELSE 
          CALL Fehler("UngÅltige Datumseingabe - PA Austellunsdatum!!","")
          GOTO danf201120021
        END IF 
      END IF 
      IF LTRIM$ (gebtag$) <> "" THEN 
        IF DateOK%(gebtag$) THEN 
          t1% = DAYS (gebtag$)
          t2% = gebt$$
          IF t1% <> t2% THEN ok% = - 1
        ELSE 
          CALL Fehler("UngÅltige Datumseingabe - Geburtstag!","")
          GOTO danf201120021
        END IF 
      END IF 
      IF paort$ <> paortf$$ THEN ok% = - 1
      IF aname$ <> b$$ THEN ok% = - 1
      IF avname$ <> a$$ THEN ok% = - 1
      IF Telefon1$ <> t1$$ THEN ok% = - 1
      IF Telefon2$ <> t2$$ THEN ok% = - 1
      IF plz$ <> pl$$ THEN ok% = - 1
      IF ort$ <> o$$ THEN ok% = - 1
      IF Strasse$ <> s$$ THEN ok% = - 1
      IF fax1$ <> f1$$ THEN ok% = - 1
      IF fax2$ <> f2$$ THEN ok% = - 1
      IF email1$ <> e1$$ THEN ok% = - 1
      IF email2$ <> e2$$ THEN ok% = - 1
      IF www1$ <> w1$$ THEN ok% = - 1
      IF www2$ <> w2$$ THEN ok% = - 1
      IF NotizK$ <> n$$ THEN ok% = - 1
      IF geschl$ <> g$$ THEN ok% = - 1
      IF handy1$ <> h1$$ THEN ok% = - 1
      IF handy2$ <> h2$$ THEN ok% = - 1
      REM gebo$ = "GebortK" + LTRIM$ ( STR$ (no%,"99")) + "." + GADRDat$
      IF gebort$ <> gebo$$ THEN ok% = - 1



      IF ok% = - 1 THEN 
        REQUEST "Es wurden Daten geÑndert, wollen Sie die énderungen speichern?","",130,req%
        IF req% = 1 THEN 
          panrf$$ = panr$

          IF LTRIM$ (padat$) <> "" THEN 
            IF DateOK%(padat$) THEN 
              padatf$$ = DAYS (padat$)
            ELSE 
              CALL Fehler("UngÅltige Datumseingabe - PA Austellunsdatum!","")
              GOTO danf201120021
            END IF 
          END IF 

          IF LTRIM$ (gebtag$) <> "" THEN 
            IF DateOK%(gebdat$) THEN 
              gebt$$ = DAYS (gebtag$)
            ELSE 
              CALL Fehler("UngÅltige Datumseingabe - Geburtstag!","")
              GOTO danf201120021
            END IF 
          END IF 
          paortf$$ = paort$
          b$$ = aname$
          a$$ = avname$
          t1$$ = Telefon1$
          t2$$ = Telefon2$
          pl$$ = plz$
          o$$ = Ort$
          s$$ = Strasse$
          f1$$ = Fax1$
          f2$$ = Fax2$
          e1$$ = email1$
          e2$$ = email2$
          w1$$ = www1$
          w2$$ = www2$
          n$$ = NotizK$
          g$$ = geschl$
          h1$$ = Handy1$
          h2$$ = Handy2$
          gebo$$ = gebort$
          CALL QuickStore(GADRDat$)
        END IF 
      END IF 
 
    REM *************************************************************
end230420061: 
 SELECT FORM KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
 FORM 
 
 END SUB 
 


 REM **********************************************************************************************************************
 REM     Sicherheitsbackup bei énderung der Stammdaten
 REM **********************************************************************************************************************

SUB SichBackup()
 maske$ = "PROVIS"
 IF IntVerw.stamm LIKE "j" THEN maske$ = "PROVISI"
 CLOSE ALL 
 OPEN FORM GPrjForm$ + maske$
 IF test% = 1 THEN 
   REQUEST "Soll vorher ein komplettes Backup durchgefÅhrt werden?","",130,req%
 ELSE 
   req% = 1
 END IF 
 MOUSE OFF 
 
 IF req% = 1 THEN 
   t0$ = "Sie mÅssen sicherstellen, da· Sie genug Platz auf der Festplatte haben, auf der sich der CODie-Ordner befindet!"
   CALL Fehler("Das Programm fÅhrt jetzt eine komplette Datensicherung des aktuellen CODie-Ordners durch und speichert die gepackte Sicherungsdatei in diesen Ordner!",t0$)
   REQUEST "Soll jetzt ein komplettes Backup durchgefÅhrt werden?","",130,req%
   IF req% <> 1 THEN 
     CALL Fehler("Die Datensicherung wurde abgebrochen!","")
     MOUSE OFF 
     CALL DFile(2,"OPENFILE" + _fpw$)
     CALL DFile(2,"ZERO" + _fpw$)
     CALL DFile(22,"CONFIG" + _fpw$)
     CALL DFile(2,"supervis" + _fpw$)
     CALL DFile(3,"stamm" + _fpw$)
     CALL DFile(3,"stammhis" + _fpw$)
     CALL DFile(3,"VProdukt" + _fpw$)
     CALL DFile(3,"KVERTRAG" + _fpw$)
     CALL DFile(3,"GEKOND" + _fpw$)
     CALL DFile(3,"MAADR" + _fpw$)
     CALL DFile(3,"GEKONDM" + _fpw$)
     CALL DFile(3,"Sparten" + _fpw$)
     CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
     CALL DFile(3,"VPSPEZKO" + _fpw$)
     CALL DFile(3,"VPGEKOND" + _fpw$)
     CALL DFile(3,"VPRODUKT" + _fpw$)
     CALL DFile(3,"FOERKOND" + _fpw$)
     CALL DFile(3,"AUMSKTO" + _fpw$)
     CALL DFile(3,"AUMSATZ" + _fpw$)
     CALL DFile(3,"AGDIR" + _fpw$)
     CALL DFile(3,"MAAUSZ" + _fpw$)
     CALL DFile(3,"SPEZKOND" + _fpw$)
     CALL DFile(3,"geadrums" + _fpw$)
     CALL DFile(3,"buchges" + _fpw$)
     CALL DFile(3,"kvfael" + _fpw$)
     CALL DFile(3,"FONDS" + _fpw$)
     CALL DFile(3,"TARIF" + _fpw$)
     CALL DFile(3,"WAEHRUNG" + _fpw$)
     CALL DFile(3,"BUDAY" + _fpw$)
     CALL DFile(2,"OFFICE\" + "BCKONTAK" + _fpw$)
     CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
     MOUSE ON 
     END SUB 
   END IF 
   a% = CALL ("ShellExecute",0,"open",_netpath$ + "autoback.exe","","",1)
   WAIT FOR 2
   REM WHILE NOT EXISTS (_netpath$ + "autoback.txt")
   REM WAIT FOR 2
   REM WEND 
anf08122200201: 
   MOUSE OFF 
   IF EXISTS (_netpath$ + "autoback.txt") THEN 
     DELETE _netpath$ + "autoback.txt"
   ELSE 
     WAIT FOR 2
     GOTO anf08122200201
   END IF 
 END IF 
 REQUEST "Das Programm wird jetzt beendet!","Die neuen Einstellungen werden beim nÑchsten Programmstart wirksam!",2
 CALL EXIT()
 CALL DFile(2,"access" + _fpw$)
 CALL DFile(2,"accode" + _fpw$)
 CALL DFile(3,"AGDIR" + _fpw$)
 CALL DFile(2,"OPENFILE" + _fpw$)
 CALL DFile(2,"ZERO" + _fpw$)
 CALL DFile(22,"CONFIG" + _fpw$)
 CALL DFile(2,"supervis" + _fpw$)
 CALL DFile(3,"stamm" + _fpw$)
 CALL DFile(3,"VProdukt" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"GEKOND" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"STAMMHIS" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"GEKONDM" + _fpw$)
 CALL DFile(3,"Sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"VPSPEZKO" + _fpw$)
 CALL DFile(3,"VPGEKOND" + _fpw$)
 CALL DFile(3,"VPRODUKT" + _fpw$)
 CALL DFile(3,"FOERKOND" + _fpw$)
 CALL DFile(3,"AUMSKTO" + _fpw$)
 CALL DFile(3,"AUMSATZ" + _fpw$)
 CALL DFile(3,"AGDIR" + _fpw$)
 CALL DFile(3,"MAAUSZ" + _fpw$)
 CALL DFile(3,"SPEZKOND" + _fpw$)
 CALL DFile(3,"geadrums" + _fpw$)
 CALL DFile(3,"buchges" + _fpw$)
 CALL DFile(3,"kvfael" + _fpw$)
 CALL DFile(3,"FONDS" + _fpw$)
 CALL DFile(3,"TARIF" + _fpw$)
 CALL DFile(3,"WAEHRUNG" + _fpw$)
 CALL DFile(3,"BUDAY" + _fpw$)
 CALL DFile(2,"OFFICE\" + "BCKONTAK" + _fpw$)
 CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
   CALL DFile(3,"BUCHUNG" + _fpw$)
   CALL DFile(3,"ZEINGANG" + _fpw$)
 ELSE 
   CALL DFile(3,"BUCHUNG1" + _fpw$)
   CALL DFile(3,"ZEINGAN1" + _fpw$)
 END IF 
 OPEN FORM GPrjForm$ + "STAMM"
 SET f = Superbase.Form
 
 END SUB 






SUB ADRNoteBig(fnam$,dd$)
   ON ERROR GOTO ErrorHandler
   notizn$ = fnam$ + "." + dd$
   LÑnge$ = FIELDINFO$ (notizn$,4)
   lÑnge% = VAL (LÑnge$)
   inh$ = notizn$$
   SET EDIT SELECT OFF 
   SET EDIT SELECT ON 
   IF dd$ LIKE "ADR*" OR dd$ LIKE "BCKO*" THEN 
     nr$ = Nachname.dd$ + "/" + vorname.dd$
     Label$ = "Kunde"
     IF dd$ LIKE "ADRESSEN" AND inh$ = "" AND fnam$ LIKE "EmpfehlTXT" THEN 
       REM CALL Fehler("Es wurde unter Empfehlung noch nicht eingetragen!","")
       REQUEST "Es wurde unter Empfehlung noch nichts eingetragen!","Mîchten Sie einen Eintrag erzeugen lassen?",130,req%
       IF req% = 1 THEN 
         codekuakt% = codeku.adressen
         CALL GenerateEmpf(codekuakt%,0)
         inh$ = notizn$$
       END IF 
     END IF 
   END IF 
   IF dd$ LIKE "Spart*" THEN 
     nr$ = Sparte.sparten
     Label$ = "Sparte"
   END IF 
   IF dd$ LIKE "Vprodukt*" THEN 
     nr$ = Gesspa.vprodukt
     Label$ = "Produkt"
   END IF 
   IF dd$ LIKE "maadr*" THEN 
     nr$ = Nachname.maadr + "," + vorname.maadr
     Label$ = "Vermittler"
   END IF 
anf170920051: 
   CREATE DIALOG GTelDat$,0,0,543,303,"Notiz","Courier New",9
   ADD DIALOG GTelDat$,5,5,6,56,10,0,Label$
   ADD DIALOG GTelDat$,5,62,6,380,9,128,nr$
   ADD DIALOG GTelDat$,5,5,22,165,10,0,"Notiz: zum Zeilenumbruch Strg+Enter drÅcken"
   REM ADD DIALOG GTelDat$,6,5,32,430,200,4,0,inh$
   ADD DIALOG GTelDat$,6,5,32,530,250,4,3,inh$,lÑnge%
   IF dd$ LIKE "ADRESSEN" AND inh$ <> "" AND fnam$ LIKE "EmpfehlTXT" THEN 
     ADD DIALOG GTelDat$,1,10,285,55,15,1,"&OK",1,1
     ADD DIALOG GTelDat$,1,72,285,55,15,0,"A&bbruch",0,0

     ADD DIALOG GTelDat$,1,130,285,55,15,0,"&Drucken",2,2
     

     ADD DIALOG GTelDat$,1,239,285,130,15,0,"&Aktualisierung Empfehlerdaten",3,1
     ADD DIALOG GTelDat$,1,380,285,130,15,0,"&Neuzuweisung der Empfehlung",4,1
   ELSE 
     ADD DIALOG GTelDat$,1,195,285,55,15,1,"&OK",1,1
     ADD DIALOG GTelDat$,1,255,285,55,15,0,"A&bbruch",0,0
     ADD DIALOG GTelDat$,1,315,285,55,15,0,"&Drucken",2,2
   END IF 
   SET EDIT SELECT OFF 
   DIALOG GTelDat$,req%
   SET EDIT SELECT OFF 
   REMOVE DIALOG ALL 

   IF req% = 0 THEN GOTO end230420062

   IF req% = 4 THEN 
     REQUEST "Mîchten Sie den Empfehlungseintrag neu erzeugen lassen?","Achtung eventuell von Hand getÑtigte Eingaben gehen verloren!!",135,reqsperr%
     IF reqsperr% = 1 THEN 
         codekuakt% = codeku.adressen
         CALL GenerateEmpf(codekuakt%,0)
         inh$ = notizn$$
         GOTO anf170920051
     END IF 
   END IF 
   IF req% = 3 THEN 
     REQUEST "Mîchten Sie den Empfehlungseintrag neu erzeugen lassen?","Achtung eventuell von Hand getÑtigte Eingaben gehen verloren!!",135,reqsperr%
     IF reqsperr% = 1 THEN 
         codekuakt% = codeku.adressen
         CALL GenerateEmpf(codekuakt%,1)
         inh$ = notizn$$
         GOTO anf170920051
     END IF 
   END IF 
   IF inh$ <> notizn$$ THEN 
     REM es wurde geÑndert
     IF NOT disabled%("ADRBEARB") AND LABEL$ LIKE "Kunde" THEN 
       REQUEST "énderungen speichern?","",130,req%
       IF req% = 1 THEN 
         SELECT CURRENT LOCK FILE dd$
         notizn$$ = LEFT$ (inh$,lÑnge%)
         STORE FILE dd$
       END IF 
     END IF 
     IF LABEL$ LIKE "Sparte" THEN 
       REQUEST "énderungen speichern?","",130,req%
       IF req% = 1 THEN 
         SELECT CURRENT LOCK FILE dd$
         notizn$$ = LEFT$ (inh$,lÑnge%)
         STORE FILE dd$
       END IF 
     END IF 
     IF LABEL$ LIKE "Produkt" THEN 
       REQUEST "énderungen speichern?","",130,req%
       IF req% = 1 THEN 
         SELECT CURRENT LOCK FILE dd$
         notizn$$ = LEFT$ (inh$,lÑnge%)
         STORE FILE dd$
       END IF 
     END IF 
     IF LABEL$ LIKE "Vermittler*" THEN 
       REQUEST "énderungen speichern?","",130,req%
       IF req% = 1 THEN 
         SELECT CURRENT LOCK FILE dd$
         notizn$$ = LEFT$ (inh$,lÑnge%)
         STORE FILE dd$
       END IF 
     END IF 
   END IF 
   IF req% = 2 THEN 
     PRINT ;
     ? inh$
     DISPLAY ;
   END IF 
   SET EDIT SELECT ON 
end230420062: 
 END SUB 




 REM Vertrags suchen aus der Adressmaske heraus
SUB ADRVertrSu()
  cuvt% = 0
 GCodeGE% = 0
 GCodeVA% = 0
 GCodeVP% = 0
 GCodeMA% = 0
 GDatumVON% = 0
 GDatumBis% = 0
 GSuFromAdr% = 0
  CALL VISuchen1()
  IF cuvt% > 0 THEN 
    CALL VINFBearb()
    IF G1Vertraege$(1) <> "" THEN CALL VAn280403()
  END IF 
 END SUB 






SUB FeldBerKV1a()
 REM ***********************************************************
 REM *               Feldberechnungen                          *
 REM ***********************************************************
 NUMBASE "9999999999.0000"
 IF codege.kvertrag > 0 AND codeva.kvertrag > 0 THEN 
   qcodeGEVA$ = Quickgeva.kvertrag
   SELECT FIRST FILE "vprodukt" INDEX QCodeGEVA.vprodukt
   SELECT KEY qcodeGEVA$ FILE "vprodukt" INDEX QCodeGEVA.vprodukt
   qtest$ = QCodeGEVA.vprodukt
   mwst.kvertrag = mwst.vprodukt
   IF einheiten.kvertrag = 0 THEN 
     einheiten.kvertrag = 0
   END IF 
   ein% = einheiten.kvertrag
   bb% = 0
 
   IF bewertungsbasis.vprodukt <> 0 THEN 
     bb% = bewertungsbasis.vprodukt
   END IF 
   IF AutomNetBer.vprodukt LIKE "j" THEN 
     Netto$ = STR$ ((Beitrag.kvertrag * 100) / (100 + mwst.kvertrag),"9999999999.00")
     IF KVBrutto.kvertrag = 0 THEN Nettobeitrag.kvertrag = VAL (netto$)
   ELSE 
     netto% = nettobeitrag.kvertrag
   END IF 
   IF DBeitrZahlung.kvertrag = 0 THEN DBeitrZahlung.kvertrag = VS_Dauer.kvertrag
   vd% = VS_Dauer.kvertrag
   netto% = nettobeitrag.kvertrag
   brutto% = Beitrag.kvertrag
   dbeitr% = DBeitrZahlung.kvertrag
   vsumme% = Vsumme.kvertrag
   IF codetarif.kvertrag > 0 THEN GOTO TarifFo2002091
   fbew$ = Fbew.vprodukt
   bsu% = Bewertungssumme.kvertrag
   pab% = Proviab.kvertrag
   REM CALL Fehler(qcodeGEVA$,qtest$)
   IF Fbew.vprodukt <> "" AND Bewertungssumme.kvertrag < 0.01 AND Proviab.kvertrag < 1 THEN 
     IF MinBew.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.vprodukt THEN VS_Dauer.kvertrag = MinBew.vprodukt
     END IF 
     IF MaxBew.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew.vprodukt THEN VS_Dauer.kvertrag = MaxBew.vprodukt
     END IF 
     IF MinBewBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinBewBzD.vprodukt
     END IF 
     IF MaxBewBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxBewBzD.vprodukt
     END IF 
     IF MinBewBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei.vprodukt THEN Beitrag.kvertrag = MinBewBBei.vprodukt
     END IF 
     IF MaxBewBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei.vprodukt THEN Beitrag.kvertrag = MaxBewBBei.vprodukt
     END IF 
     IF MinBewNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei.vprodukt THEN nettobeitrag.kvertrag = MinBewNBei.vprodukt
     END IF 
     IF MaxBewNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei.vprodukt THEN nettobeitrag.kvertrag = MaxBewNBei.vprodukt
     END IF 
     IF MinBewVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS.vprodukt THEN vsumme.kvertrag = MinBewVS.vprodukt
     END IF 
     IF MaxBewVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS.vprodukt THEN vsumme.kvertrag = MaxBewVS.vprodukt
     END IF 
     IF fbew.vprodukt LIKE "zw.kvertrag*" OR fbew.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + Fbew.vprodukt
       EXECUTE fo$
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + Fbew.vprodukt
       EXECUTE fo$
     END IF 
     Bewertungssumme.kvertrag = wert%
   END IF 
   fbew2$ = Fbew2.vprodukt
   fo$ = ""
   IF Fbew2.vprodukt <> "" AND Bewertung2.kvertrag < 0.01 AND Proviab.kvertrag < 1 THEN 
     IF MinBew2.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew2.vprodukt THEN VS_Dauer.kvertrag = MinBew2.vprodukt
     END IF 
     IF MaxBew2.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew2.vprodukt THEN VS_Dauer.kvertrag = MaxBew2.vprodukt
     END IF 
     IF MinBewBzD2.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD2.vprodukt THEN DBeitrZahlung.kvertrag = MinBewBzD2.vprodukt
     END IF 
     IF MaxBewBzD2.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD2.vprodukt THEN DBeitrZahlung.kvertrag = MaxBewBzD2.vprodukt
     END IF 
     IF MinBewBBei2.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei2.vprodukt THEN Beitrag.kvertrag = MinBewBBei2.vprodukt
     END IF 
     IF MaxBewBBei2.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei2.vprodukt THEN Beitrag.kvertrag = MaxBewBBei2.vprodukt
     END IF 
     IF MinBewNBei2.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei2.vprodukt THEN nettobeitrag.kvertrag = MinBewNBei2.vprodukt
     END IF 
     IF MaxBewNBei2.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei2.vprodukt THEN nettobeitrag.kvertrag = MaxBewNBei2.vprodukt
     END IF 
     IF MinBewVS2.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS2.vprodukt THEN vsumme.kvertrag = MinBewVS2.vprodukt
     END IF 
     IF MaxBewVS2.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS2.vprodukt THEN vsumme.kvertrag = MaxBewVS2.vprodukt
     END IF 
     IF fbew2.vprodukt LIKE "zw.kvertrag*" OR fbew2.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + Fbew2.vprodukt
       EXECUTE fo$
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + Fbew2.vprodukt
       EXECUTE fo$
     END IF 
     Bewertung2.kvertrag = wert%
   END IF 
 
 
   IF FSRD.vprodukt <> "" AND SRHaftung.kvertrag = 0 THEN 
     IF MINSRD.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.vprodukt THEN VS_Dauer.kvertrag = MinSRD.vprodukt
     END IF 
     IF MaxSRD.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxSRD.vprodukt THEN VS_Dauer.kvertrag = MaxSRD.vprodukt
     END IF 
     IF MinSRDBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinSRDBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinSRDBzD.vprodukt
     END IF 
     IF MaxSRDBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxSRDBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxSRDBzD.vprodukt
     END IF 
     IF MinSRDBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinSRDBBei.vprodukt THEN Beitrag.kvertrag = MinSRDBBei.vprodukt
     END IF 
     IF MaxSRDBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxSRDBBei.vprodukt THEN Beitrag.kvertrag = MaxSRDBBei.vprodukt
     END IF 
     IF MinSRDNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinSRDNBei.vprodukt THEN nettobeitrag.kvertrag = MinSRDNBei.vprodukt
     END IF 
     IF MaxSRDNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxSRDNBei.vprodukt THEN nettobeitrag.kvertrag = MaxSRDNBei.vprodukt
     END IF 
     IF MinSRDVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinSRDVS.vprodukt THEN vsumme.kvertrag = MinSRDVS.vprodukt
     END IF 
     IF MaxSRDVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxSRDVS.vprodukt THEN vsumme.kvertrag = MaxSRDVS.vprodukt
     END IF 
     av1% = VS_Dauer.kvertrag
     adb1% = DBeitrZahlung.kvertrag
     abei% = Beitrag.kvertrag
     anbei1% = nettobeitrag.kvertrag
     avs1% = vsumme.kvertrag
     REM CALL Fehler("","")
     IF FSRD.vprodukt LIKE "zw.kvertrag*" OR FSRD.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FSRD.vprodukt
       EXECUTE fo$
       IF wert% < 100 THEN 
         SRHaftung.kvertrag = wert%
       ELSE 
         CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Produkt-Berechnungsformel!")
       END IF 
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FSRD.vprodukt
       EXECUTE fo$
       IF wert% < 100 THEN 
         SRHaftung.kvertrag = wert%
       ELSE 
         CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Produkt-Berechnungsformel!")
       END IF 
     END IF 
   END IF 
   IF vs_beginn.kvertrag >= "01.01.2008" AND sr60.vprodukt = "j" THEN 
     SRHaftung.kvertrag = 60
   END IF 
   IF FVol.vprodukt <> "" AND Volumen.kvertrag < 1 AND Proviab.kvertrag < 1 THEN 
     fvol$ = FVol.vprodukt
     IF MinVol.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minVol.vprodukt THEN VS_Dauer.kvertrag = MinVol.vprodukt
     END IF 
     IF MaxVol.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxVol.vprodukt THEN VS_Dauer.kvertrag = MaxVol.vprodukt
     END IF 
     IF MinVolBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinVolBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinVolBzD.vprodukt
     END IF 
     IF MaxVolBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxVolBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxVolBzD.vprodukt
     END IF 
     IF MinVolBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinVolBBei.vprodukt THEN Beitrag.kvertrag = MinVolBBei.vprodukt
     END IF 
     IF MaxVolBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxVolBBei.vprodukt THEN Beitrag.kvertrag = MaxVolBBei.vprodukt
     END IF 
     IF MinVolNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinVolNBei.vprodukt THEN nettobeitrag.kvertrag = MinVolNBei.vprodukt
     END IF 
     IF MaxVolNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxVolNBei.vprodukt THEN nettobeitrag.kvertrag = MaxVolNBei.vprodukt
     END IF 
     IF MinVolVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinVolVS.vprodukt THEN vsumme.kvertrag = MinVolVS.vprodukt
     END IF 
     IF MaxVolVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxVolVS.vprodukt THEN vsumme.kvertrag = MaxVolVS.vprodukt
     END IF 
     IF FVol.vprodukt LIKE "zw.kvertrag*" OR FVol.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FVol.vprodukt
       EXECUTE fo$
       Volumen.kvertrag = wert%
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FVol.vprodukt
       EXECUTE fo$
       Volumen.kvertrag = wert%
     END IF 
   END IF 
   IF FTar.vprodukt <> "" AND Tarif.kvertrag = "" AND Proviab.kvertrag < 1 THEN 
     IF MinTar.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minTar.vprodukt THEN VS_Dauer.kvertrag = MinTar.vprodukt
     END IF 
     IF MaxTar.vprodukt <> 0 THEN 
       IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxTar.vprodukt THEN VS_Dauer.kvertrag = MaxTar.vprodukt
     END IF 
     IF MinTarBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinTarBzD.vprodukt THEN DBeitrZahlung.kvertrag = MinTarBzD.vprodukt
     END IF 
     IF MaxTarBzD.vprodukt <> 0 THEN 
       IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxTarBzD.vprodukt THEN DBeitrZahlung.kvertrag = MaxTarBzD.vprodukt
     END IF 
     IF MinTarBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinTarBBei.vprodukt THEN Beitrag.kvertrag = MinTarBBei.vprodukt
     END IF 
     IF MaxTarBBei.vprodukt <> 0 THEN 
       IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxTarBBei.vprodukt THEN Beitrag.kvertrag = MaxTarBBei.vprodukt
     END IF 
     IF MinTarNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinTarNBei.vprodukt THEN nettobeitrag.kvertrag = MinTarNBei.vprodukt
     END IF 
     IF MaxTarNBei.vprodukt <> 0 THEN 
       IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxTarNBei.vprodukt THEN nettobeitrag.kvertrag = MaxTarNBei.vprodukt
     END IF 
     IF MinTarVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinTarVS.vprodukt THEN vsumme.kvertrag = MinTarVS.vprodukt
     END IF 
     IF MaxTarVS.vprodukt <> 0 THEN 
       IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxTarVS.vprodukt THEN vsumme.kvertrag = MaxTarVS.vprodukt
     END IF 
     IF FTar.vprodukt LIKE "zw.kvertrag*" OR FTar.vprodukt LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
       zw.kvertrag = 1
       fo$ = "wert% = " + FTar.vprodukt
       EXECUTE fo$
       Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
       zw.kvertrag = 0
     ELSE 
       fo$ = "wert% = " + FTar.vprodukt
       EXECUTE fo$
       Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
     END IF 
   END IF 
TarifFo2002091: 
   IF CodeTarif.kvertrag > 0 THEN 
     SELECT KEY codetarif.kvertrag FILE "Tarif" INDEX codetarif.tarif
     IF Fbew.tarif <> "" AND Bewertungssumme.kvertrag < 0.01 AND Proviab.kvertrag < 1 THEN 
       IF MinBew.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.tarif THEN VS_Dauer.kvertrag = MinBew.tarif
       END IF 
       IF MaxBew.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew.tarif THEN VS_Dauer.kvertrag = MaxBew.tarif
       END IF 
       IF MinBewBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD.Tarif THEN DBeitrZahlung.kvertrag = MinBewBzD.Tarif
       END IF 
       IF MaxBewBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxBewBzD.Tarif
       END IF 
       IF MinBewBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei.Tarif THEN Beitrag.kvertrag = MinBewBBei.Tarif
       END IF 
       IF MaxBewBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei.Tarif THEN Beitrag.kvertrag = MaxBewBBei.Tarif
       END IF 
       IF MinBewNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei.Tarif THEN nettobeitrag.kvertrag = MinBewNBei.Tarif
       END IF 
       IF MaxBewNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei.Tarif THEN nettobeitrag.kvertrag = MaxBewNBei.Tarif
       END IF 
       IF MinBewVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS.Tarif THEN vsumme.kvertrag = MinBewVS.Tarif
       END IF 
       IF MaxBewVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS.Tarif THEN vsumme.kvertrag = MaxBewVS.Tarif
       END IF 
       IF fbew.tarif LIKE "zw.kvertrag*" OR fbew.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + Fbew.tarif
         EXECUTE fo$
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + Fbew.tarif
         EXECUTE fo$
       END IF 
       wert$ = STR$ (wert%,"999999999999")
       wert1% = VS_Dauer.kvertrag
       wert1a% = nettobeitrag.kvertrag
       wert2% = wert1% * wert1a%
       wert3% = 1 * wert2%
       wert4% = 0.95 * wert3%
       wert5% = wert4%
       Bewertungssumme.kvertrag = wert%
     END IF 
 
 
     IF Fbew2.tarif <> "" AND Bewertung2.kvertrag < 0.01 THEN 
       IF MinBew2.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew2.tarif THEN VS_Dauer.kvertrag = MinBew2.tarif
       END IF 
       IF MaxBew2.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxBew2.tarif THEN VS_Dauer.kvertrag = MaxBew2.tarif
       END IF 
       IF MinBewBzD2.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinBewBzD2.Tarif THEN DBeitrZahlung.kvertrag = MinBewBzD2.Tarif
       END IF 
       IF MaxBewBzD2.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxBewBzD2.Tarif THEN DBeitrZahlung.kvertrag = MaxBewBzD2.Tarif
       END IF 
       IF MinBewBBei2.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinBewBBei2.Tarif THEN Beitrag.kvertrag = MinBewBBei2.Tarif
       END IF 
       IF MaxBewBBei2.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxBewBBei2.Tarif THEN Beitrag.kvertrag = MaxBewBBei2.Tarif
       END IF 
       IF MinBewNBei2.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinBewNBei2.Tarif THEN nettobeitrag.kvertrag = MinBewNBei2.Tarif
       END IF 
       IF MaxBewNBei2.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxBewNBei2.Tarif THEN nettobeitrag.kvertrag = MaxBewNBei2.Tarif
       END IF 
       IF MinBewVS2.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinBewVS2.Tarif THEN vsumme.kvertrag = MinBewVS2.Tarif
       END IF 
       IF MaxBewVS2.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxBewVS2.Tarif THEN vsumme.kvertrag = MaxBewVS2.Tarif
       END IF 
       IF fbew2.tarif LIKE "zw.kvertrag*" OR fbew2.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + Fbew2.tarif
         EXECUTE fo$
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + Fbew2.tarif
         EXECUTE fo$
       END IF 
       wert$ = STR$ (wert%,"999999999999")
       wert1% = VS_Dauer.kvertrag
       wert1a% = nettobeitrag.kvertrag
       wert2% = wert1% * wert1a%
       wert3% = 1 * wert2%
       wert4% = 0.95 * wert3%
       wert5% = wert4%
       Bewertung2.kvertrag = wert%
     END IF 
 
 
 
     IF FSRD.tarif <> "" AND SRHaftung.kvertrag < 1 THEN 
       IF MINSRD.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minBew.tarif THEN VS_Dauer.kvertrag = MinSRD.tarif
       END IF 
       IF MaxSRD.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxSRD.tarif THEN VS_Dauer.kvertrag = MaxSRD.tarif
       END IF 
       IF MinSRDBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinSRDBzD.Tarif THEN DBeitrZahlung.kvertrag = MinSRDBzD.Tarif
       END IF 
       IF MaxSRDBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxSRDBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxSRDBzD.Tarif
       END IF 
       IF MinSRDBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinSRDBBei.Tarif THEN Beitrag.kvertrag = MinSRDBBei.Tarif
       END IF 
       IF MaxSRDBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxSRDBBei.Tarif THEN Beitrag.kvertrag = MaxSRDBBei.Tarif
       END IF 
       IF MinSRDNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinSRDNBei.Tarif THEN nettobeitrag.kvertrag = MinSRDNBei.Tarif
       END IF 
       IF MaxSRDNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxSRDNBei.Tarif THEN nettobeitrag.kvertrag = MaxSRDNBei.Tarif
       END IF 
       IF MinSRDVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinSRDVS.Tarif THEN vsumme.kvertrag = MinSRDVS.Tarif
       END IF 
       IF MaxSRDVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxSRDVS.Tarif THEN vsumme.kvertrag = MaxSRDVS.Tarif
       END IF 
       IF FSRD.tarif LIKE "zw.kvertrag*" OR FSRD.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FSRD.tarif
         EXECUTE fo$
         IF wert% < 100 THEN 
           SRHaftung.kvertrag = wert%
         ELSE 
           CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Tarif-Berechnungsformel!")
         END IF 
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FSRD.tarif
         EXECUTE fo$
         IF wert% < 100 THEN 
           SRHaftung.kvertrag = wert%
         ELSE 
           CALL Fehler("Bei der Berechnung der Dauer der Stornoreserve ist ein Ergebnis > 100 Monate (>83 Jahre) berechnet worden","Bitte prÅfen Sie die Tarif-Berechnungsformel!")
         END IF 
       END IF 
     END IF 
     IF vs_beginn.kvertrag >= "01.01.2008" AND sr60.tarif = "j" THEN 
       SRHaftung.kvertrag = 60
     END IF 
     IF FVol.tarif <> "" AND Volumen.kvertrag < 1 AND Proviab.kvertrag < 1 THEN 
       IF MinVol.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minVol.tarif THEN VS_Dauer.kvertrag = MinVol.tarif
       END IF 
       IF MaxVol.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxVol.tarif THEN VS_Dauer.kvertrag = MaxVol.tarif
       END IF 
       IF MinVolBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinVolBzD.Tarif THEN DBeitrZahlung.kvertrag = MinVolBzD.Tarif
       END IF 
       IF MaxVolBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxVolBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxVolBzD.Tarif
       END IF 
       IF MinVolBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinVolBBei.Tarif THEN Beitrag.kvertrag = MinVolBBei.Tarif
       END IF 
       IF MaxVolBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxVolBBei.Tarif THEN Beitrag.kvertrag = MaxVolBBei.Tarif
       END IF 
       IF MinVolNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinVolNBei.Tarif THEN nettobeitrag.kvertrag = MinVolNBei.Tarif
       END IF 
       IF MaxVolNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxVolNBei.Tarif THEN nettobeitrag.kvertrag = MaxVolNBei.Tarif
       END IF 
       IF MinVolVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinVolVS.Tarif THEN vsumme.kvertrag = MinVolVS.Tarif
       END IF 
       IF MaxVolVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxVolVS.Tarif THEN vsumme.kvertrag = MaxVolVS.Tarif
       END IF 
       IF FVol.tarif LIKE "zw.kvertrag*" OR FVol.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FVol.tarif
         EXECUTE fo$
         Volumen.kvertrag = wert%
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FVol.tarif
         EXECUTE fo$
         Volumen.kvertrag = wert%
       END IF 
     END IF 
     IF FTar.tarif <> "" AND Tarif.kvertrag = "" AND Proviab.kvertrag < 1 THEN 
       IF MinTar.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag < minTar.tarif THEN VS_Dauer.kvertrag = MinTar.tarif
       END IF 
       IF MaxTar.tarif <> 0 THEN 
         IF VS_Dauer.kvertrag <> 0 AND VS_Dauer.kvertrag > maxTar.tarif THEN VS_Dauer.kvertrag = MaxTar.tarif
       END IF 
       IF MinTarBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag < MinTarBzD.Tarif THEN DBeitrZahlung.kvertrag = MinTarBzD.Tarif
       END IF 
       IF MaxTarBzD.Tarif <> 0 THEN 
         IF DBeitrZahlung.kvertrag <> 0 AND DBeitrZahlung.kvertrag > MaxTarBzD.Tarif THEN DBeitrZahlung.kvertrag = MaxTarBzD.Tarif
       END IF 
       IF MinTarBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag < MinTarBBei.Tarif THEN Beitrag.kvertrag = MinTarBBei.Tarif
       END IF 
       IF MaxTarBBei.Tarif <> 0 THEN 
         IF Beitrag.kvertrag <> 0 AND Beitrag.kvertrag > MaxTarBBei.Tarif THEN Beitrag.kvertrag = MaxTarBBei.Tarif
       END IF 
       IF MinTarNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag < MinTarNBei.Tarif THEN nettobeitrag.kvertrag = MinTarNBei.Tarif
       END IF 
       IF MaxTarNBei.Tarif <> 0 THEN 
         IF nettobeitrag.kvertrag <> 0 AND nettobeitrag.kvertrag > MaxTarNBei.Tarif THEN nettobeitrag.kvertrag = MaxTarNBei.Tarif
       END IF 
       IF MinTarVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag < MinTarVS.Tarif THEN vsumme.kvertrag = MinTarVS.Tarif
       END IF 
       IF MaxTarVS.Tarif <> 0 THEN 
         IF vsumme.kvertrag <> 0 AND vsumme.kvertrag > MaxTarVS.Tarif THEN vsumme.kvertrag = MaxTarVS.Tarif
       END IF 
       IF FTar.tarif LIKE "zw.kvertrag*" OR FTar.tarif LIKE "*zw.kvertrag*" AND zw.kvertrag = 0 THEN 
         zw.kvertrag = 1
         fo$ = "wert% = " + FTar.tarif
         EXECUTE fo$
         Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
         zw.kvertrag = 0
       ELSE 
         fo$ = "wert% = " + FTar.tarif
         EXECUTE fo$
         Tarif.kvertrag = LTRIM$ ( STR$ (wert%,",999999999.00"))
       END IF 
     END IF 
   END IF 
   IF sofortBereEinh.stamm = "j" THEN 
     IF bb% <> 0 AND Bewertungssumme.kvertrag <> 0 THEN 
       einh$ = STR$ (Bewertungssumme.kvertrag / bb%,",9999999999.0000")
       Einheiten.kvertrag = VAL (einh$)
     END IF 
   ELSE 
     IF bb% <> 0 AND Bewertungssumme.kvertrag <> 0 AND einheiten.kvertrag = 0 THEN 
       einh$ = STR$ (Bewertungssumme.kvertrag / bb%,",9999999999.0000")
       Einheiten.kvertrag = VAL (einh$)
     END IF 
   END IF 
   IF Bewertungsbasis.vprodukt = - 1 THEN 
     Einheiten.kvertrag = 0
   END IF 
   VS_Dauer.kvertrag = vd%
   nettobeitrag.kvertrag = netto%
   Beitrag.kvertrag = brutto%
   DBeitrZahlung.kvertrag = dbeitr%
   Vsumme.kvertrag = vsumme%
 END IF 
 END SUB 
 




