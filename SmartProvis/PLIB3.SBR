 
 CALL main()'                           ; Library Funktionen
 
 
 '      *********************************************
 '      ** allgemeine Routinen fÅr Adre·verwaltung **
 '      *********************************************
 
SUB ADRESSEN()
 CALL DFile(2,"OFFICE\" + "ADRHIS" + _fpw$)
 CALL DFile(2,"OFFICE\" + "ORT" + _fpw$)
 IF GADRDat$ LIKE "ADRESSEN" THEN 
   IF disabled%("ADRESSEN") THEN END SUB 
 END IF 
 IF GADRDat$ LIKE "ADRE1" THEN 
   IF disabled%("ADRE1") THEN END SUB 
 END IF 
 IF GADRDat$ LIKE "BCKONTAK" THEN 
   IF disabled%("BCKONTAK") THEN END SUB 
 END IF 
 IF GBENE% THEN 
   CALL DFile(2,"OFFICE\" + "ADRE1" + _fpw$)
   CALL DFile(2,"OFFICE\" + "AKQUI1" + _fpw$)
   CALL DFile(2,"OFFICE\" + "TELADR1" + _fpw$)
   CALL DFile(2,"OFFICE\" + "DOKADR1" + _fpw$)
 END IF 
 IF intverw.stamm = "j" OR GADRDat$ LIKE "BCKONTAK" THEN 
   CALL DFile(2,"OFFICE\" + "BCKONTAK" + _fpw$)
   CALL DFile(2,"OFFICE\" + "AKQUIBCK" + _fpw$)
   CALL DFile(2,"OFFICE\" + "TELBCK" + _fpw$)
   CALL DFile(2,"OFFICE\" + "DOKBCK" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKQUISE" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKTIONEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 CALL DFile(2,"OFFICE\adrgrup" + _fpw$)
 IF OPEN ("adrtemp") THEN 
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   REM CLOSE FILE "ADRTEMP"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 IF OPEN ("gesinfo") THEN 
   IF RECCOUNT ("gesinfo") > 0 THEN REMOVE FROM FILE "gesinfo"
   REM CLOSE FILE "ADRTEMP"
 ELSE 
   CALL DFile(2,"OFFICE\gesinfo" + _fpw$)
   IF RECCOUNT ("gesinfo") > 0 THEN REMOVE FROM FILE "gesinfo"
 END IF 
 CALL DFile(2,"color" + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 IF _projekt$ LIKE "PROV*" OR GAufrufproj$ LIKE "PROVIS" THEN 
   IF EXISTS (_netpath$ + "PROVIS\kvertrag.sbf") THEN CALL DFile(3,"KVERTRAG" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\statukey.sbf") THEN CALL DFile(2,"PROVIS\STATUKEY" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\vermoeg.sbf") THEN CALL DFile(3,"VERMOEG" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\vorgang.sbf") THEN CALL DFile(3,"VORGANG" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\maadr.sbf") THEN CALL DFile(3,"MAADR" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\kukto.sbf") THEN CALL DFile(3,"KUKTO" + _fpw$)
   IF EXISTS (_netpath$ + "office\kvhis.sbf") THEN CALL DFile(2,"OFFICE\KVHIS" + _fpw$)
   IF EXISTS (_netpath$ + "office\GEGRUP.sbf") THEN CALL DFile(3,"GEGRUP" + _fpw$)
   IF GAFSK$ LIKE "TRUE" THEN 
     IF EXISTS (_netpath$ + "PROVIS\afsksut.sbf") THEN CALL DFile(3,"AFSKSUT" + _fpw$)
     IF EXISTS (_netpath$ + "PROVIS\afspsp.sbf") THEN CALL DFile(3,"AFSpsp" + _fpw$)
   END IF 
 END IF 
 IF MAKLER$ = "TRUE" AND (_projekt$ LIKE "PROV*" OR GAufrufproj$ LIKE "PROV*") THEN 
   IF EXISTS (_netpath$ + "PROVIS\inkstamm.sbf") THEN CALL DFile(3,"INKSTAMM" + _fpw$)
 END IF 


 IF RECCOUNT (GADRDAT$) > 0 THEN 
   FILE gadrdat$
   INDEX codeku.gadrdat$
   SELECT FIRST LOCK FILE GADRDAT$
   WHILE codeku.GADRDAT$ < 1
     IF codeku.GADRDAT$ < 1 THEN 
       codeku.gadrdat$ = SER (GADRDAT$,1)
       CALL QuickStore(GADRDAT$)
       SELECT FIRST LOCK FILE GADRDAT$
     END IF 
   WEND 
 END IF 



 MOUSE OFF 
    DIM dlg AS Dialog
    DIM control AS DialogControl 
 
 IF knr% = 0 THEN knr% = VAL (ReadINI$(_projekt$,"LastAdress" + GAdrDat$))
 _formend% = 0
 ADRsub% = 0
 
 adrmaske$ = GAdrDat$
 IF GLundWrigg$ = "TRUE" THEN 
   REM adrmaske$ = "RADRESSE"
   adrmaske$ = "ADRESSEN"
 END IF 
 IF GBENE% THEN 
     IF GADRDat$ LIKE "Adres*" THEN 
       adrmaske$ = "ASPADR"
     ELSE 
       IF GADRDat$ LIKE "BCKONTAK" THEN 
         adrmaske$ = "ASPINT"
       ELSE 
         IF GADRDat$ LIKE "ADRE1" THEN 
           adrmaske$ = "ADRE1"
         END IF 
       END IF 
     END IF 
 ELSE 
   IF GASP% THEN 
     f$ = FORM 
     IF GADRDat$ LIKE "Adre*" THEN 
       IF FORM LIKE "IMMAK" THEN 
         REM 15112002
       ELSE 
         adrmaske$ = "ASPADR"
       END IF 
     ELSE 
       adrmaske$ = "ASPINT"
     END IF 
   END IF 
 END IF 
 f$ = FORM 
 IF f$ LIKE "IMMAK" THEN 
   adrmaske$ = "ADRESSEN"
 END IF 
 IF GAleks% = - 1 THEN 
   adrmaske$ = "ADRALEKS"
 END IF 
 CALL BMCheckMail()
 SELECT FIRST FILE "stamm"
 adrmaskeold$ = adrmaske$
 filtbutorg1$ = "Filter: ohne"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF ADRsub% <> 111111 THEN ADRsub% = 0
   REM adrmaske$ = GAdrDat$
   MOUSE OFF 
 
   IF FORM <> adrmaske$ THEN 
     IF adrmaske$ LIKE "ASPADR" OR adrmaske$ LIKE "ADRES*" THEN 
       GAdrDat$ = "ADRESSEN"
       GConDat$ = "CONNECT"
       GTelDat$ = "TELEFON"
       GAkquiDat$ = "AKQUISE"
       GDokDat$ = "DOKUMENT"
     END IF 
 
     SET HEADING title$ + " - Verwaltung der Adressen"
     IF EXISTS (GPrjForm$ + adrmaske$ + ".sbv") THEN 
       OPEN FORM GPrjForm$ + adrmaske$ PAGE 1
     ELSE 
       OPEN FORM GPrjForm$ + adrmaske$ PAGE 1
     END IF 
     SET f = Superbase.Form
     SET STATUS "Adre·verwaltung"
     CALL ADRIntro()
     MOUSE OFF 
     CALL MNADRESSEN()
     CALL ADRFeldnamen()
     filtbutadr1$ = filtbutorg1$
     MOUSE OFF 
     GAppName$ = _netpath$ + "DOC\adressen.pdf"
     IF _projekt$ LIKE "IMMAK" THEN GAppName$ = _netpath$ + "DOC\immak.pdf"
     SET DISPLAY ON 
     REM CALL BMCheckMail()
     IF GAleks% <> - 1 THEN 
       f.shownotiz.enabled = 0
       f.shownotiz.visible = 0
       zeigenotiz$ = "Zeige die Notizen"
     END IF 
     IF _projekt$ LIKE "IMMAK" THEN 
       f.shownotiz.enabled = - 1
       f.shownotiz.visible = - 1
     END IF 
     stprÅf1$ = "maximieren"
     IF GBildschirm% = 1024 THEN 
       f.stichbig.Height = 708
       f.stichbig.Top = 5928
     ELSE 
       f.stichbig.Height = 530
       f.stichbig.Top = 4880
     END IF 
 
 
 
   END IF 
 
   IF _projekt$ LIKE "PROVIS*" AND ag$ = "j" AND GADRDat$ <> "BCKONTAK" THEN 
     f.neu.enabled = 0
     f.neu.visible = 0
     f.bearb.enabled = 0
     f.bearb.visible = 0
     f.sichern.enabled = 0
     f.sichern.visible = 0
     f.abbruch.visible = 0
     f.abbruch.enabled = 0
     f.CommandButton48.enabled = 0
     f.CommandButton48.visible = 0
     f.CommandButton9.enabled = 0
     f.CommandButton9.visible = 0
     REM f.CommandButton167.enabled = 0
     REM f.CommandButton167.visible = 0
    END IF 
   IF _projekt$ LIKE "PROVIS*" AND MAKLER$ = "TRUE" AND GADRDat$ LIKE "ADRESSEN" THEN 
     f.kukonto.enabled = - 1
     f.kukonto.visible = - 1
   ELSE 
     IF _projekt$ LIKE "PROVIS*" THEN 
       f.kukonto.enabled = 0
       f.kukonto.visible = 0
     END IF 
   END IF 
   IF ag$ = "j" THEN 
     f.intzuadr.visible = 0
     f.intzuadr.enabled = 0
   ELSE 
     f.intzuadr.visible = - 1
     f.intzuadr.enabled = - 1
   END IF 
 
   IF intverw.stamm <> "j" THEN 
     f.intzuadr.visible = 0
     f.intzuadr.enabled = 0
   ELSE 
     f.intzuadr.visible = - 1
     f.intzuadr.enabled = - 1
   END IF 
   FILE GAdrDat$
   REM IF adrsub% <> 14 THEN CALL ADRFeldnamen()
   MOUSE ON 
   MENU ON mnadr1%,mnadr2%
   CALL ClearKBDBuffer()
   IF _projekt$ <> "WAWI" THEN 
     f.abbruch.visible = 0
     f.abbruch.enabled = 0
     f.suchen.enabled = - 1
     f.suchen.visible = - 1
     IF _projekt$ <> "IMMAK" AND GADRDat$ LIKE "ADRESSEN" THEN 
       f.vsuch.enabled = - 1
       f.vsuch.visible = - 1
     END IF 
     IF _projekt$ <> "AKTE" THEN 
       f.sperre.enabled = - 1
     END IF 
   END IF 
   IF RECCOUNT (GAdrDat$) < 1 THEN 
     BLANK FILE GAdrDat$
     codeku% = SER (GAdrDat$,1)
     codeku.GAdrDat$ = codeku%
     nachname.GAdrDat$ = "NEU"
     IF Workstation% > 0 THEN Workstation.GAdrDat$ = Workstation%
     IF Workstation% > 0 THEN QWoNo.GAdrDat$ = STR$ (Workstation%,"000000") + STR$ (codeku%,"000000")
     RecStatus.GAdrDat$ = "c"
     STORE FILE GAdrDat$
     UNLOCK CURRENT FILE GAdrDat$
     UNLOCK FILE GAdrDat$
     SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
   END IF 
   IF ADRsub% <> 111111 THEN CALL ADRFeldnamen()
           GAnredADR$ = anrede.GAdrDat$
           GTitelADR$ = Titel.GAdrDat$
           GNachnameADR$ = Nachname.GAdrDat$
           GVornameADR$ = Vorname.GAdrDat$
           GGebname$ = Geburtsname.GAdrDat$
           GPLZADR$ = plz.GAdrDat$
           GStrasseADR$ = Stra·e.GAdrDat$
           GOrtADR$ = Ort.GAdrDat$
           GGeburtstag% = Geburtstag.GADRDat$
           GBlz1$ = K1blz.GADRDat$
           GBLZ2$ = K2blz.GADRDat$
           GBLZ3$ = K3blz.GADRDat$
           GBank1$ = K1bank.GADRDat$
           GBank2$ = K2bank.GADRDat$
           GBank3$ = K3bank.GADRDat$
           GKonto1$ = K1Konto.GADRDat$
           GKonto2$ = K2Konto.GADRDat$
           GKonto3$ = K3Konto.GADRDat$
           GKontoinh1$ = Kontoinh1.GADRDat$
           GKontoinh2$ = Kontoinh2.GADRDat$
           GKontoinh3$ = Kontoinh3.GADRDat$
           GTelefon1$ = Telefon1.GADRDat$
   IF GADRDat$ LIKE "ADRESSEN" THEN 
     IF GFinanzAnalyse% = - 1 THEN 
       f.finanzanalyse.visible = - 1
       f.finanzanalyse.enabled = - 1
     ELSE 
       f.finanzanalyse.visible = 0
       f.finanzanalyse.enabled = 0
     END IF 
   ELSE 
     f.kukonto.visible = 0
     f.vorgang.enabled = 0
     f.vorgang.visible = 0
     f.vertraege.enabled = 0
     f.vertraege.visible = 0
     f.finanzen.enabled = 0
     f.finanzen.visible = 0
     f.finanzanalyse.visible = 0
     f.finanzen2.enabled = 0
     f.finanzen2.visible = 0
     f.vermzahlein.enabled = 0
     f.vermzahlein.visible = 0
   END IF 
   ON ERROR GOTO a200520042
   IF GBerlimex% = - 1 THEN 
     f.anrede.BackColor = 143
     f.vorname.BackColor = 143
     f.nachname.BackColor = 143
     f.strasse.BackColor = 143
     f.plz.BackColor = 143
     f.ort.BackColor = 143
     f.Geburtstag.BackColor = 143
   ELSE 
     f.anrede.BackColor = 190
     f.vorname.BackColor = 190
     f.nachname.BackColor = 190
     f.strasse.BackColor = 190
     f.plz.BackColor = 190
     f.ort.BackColor = 190
     f.Geburtstag.BackColor = 190
   END IF 
a200520042: 
   ON ERROR GOTO a200520043
   IF disabled1%("ADRKUNDCHA") THEN 
     f.Kundennummer.ReadOnly = - 1
     f.Kundennummer.BackColor = 0
   ELSE 
     f.Kundennummer.ReadOnly = 0
     f.Kundennummer.BackColor = 190
   END IF 
a200520043: 
   ON ERROR GOTO a200520044
   IF GMFoAq% = 1 THEN 
     f.terminliste.enabled = 0
     f.termine.enabled = 0
   ELSE 
     f.terminliste.enabled = - 1
     f.termine.enabled = - 1
   END IF 
a200520044: 
   IF MNdisabled%("OUTLOOKEXPORTEIN") OR FIIMMAK.GADRDat$ <> "j" THEN 
     f.outlook.enabled = 0
   ELSE 
     f.outlook.enabled = - 1
   END IF 
   cuaq% = 0
   IF ADRsub% = 111111 THEN ADRsub% = 0
   MENU ON 
   fo$ = FORM 
   ON ERROR GOTO ErrorHandler
   IF ADRsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU OR FOR 600
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL ADRPrev()
   CASE CrsRight%,PgDn%
     CALL ADRNext()
   CASE ASC ("T"), ASC ("t")
     CALL AKQUISE(2)
   END SELECT 
   IF k$ = CHR$ (27) THEN 
     IF PAGE = 1 THEN _formend% = 1
     IF PAGE > 1 THEN FORM 1
   END IF 
   SELECT CASE ADRsub%
   CASE 218
     REM AdressÅbersicht
     knr% = codeku.adressen
     CALL AdrUEB()
   CASE 217
     REM Filter
     IF filtbutadr1$ LIKE "Filter: ohne" THEN 
       CREATE DIALOG "ADRSUCH",0,0,225,100,title$,"MS Sans Serif",8
       ADD DIALOG "ADRSUCH",4,0,0,225,275,0,""
       ADD DIALOG "ADRSUCH",9,6,12,20,23,2
       ADD DIALOG "ADRSUCH",5,32,14,184,19,0,"Nach dem Filterbegriff wird in den Spalten Art und Nummer gesucht."
       ADD DIALOG "ADRSUCH",6,82,45,108,11,128,0,sunaa$,20
       ADD DIALOG "ADRSUCH",1,32,72,64,15,1,"&OK",1,1
       ADD DIALOG "ADRSUCH",1,130,72,64,15,0,"&Abbruch",0,0
       ADD DIALOG "ADRSUCH",5,32,45,50,10,0,"Filterbegriff:"
       DIALOG "ADRSUCH",req%
       REMOVE DIALOG "ADRSUCH"
       IF req% = 1 THEN 
         suna1$ = sunaa$
         IF LEFT$ (sunaa$,1) <> "*" THEN suna1$ = "*" + suna1$
         IF RIGHT$ (sunaa$,1) <> "*" THEN suna1$ = suna1$ + "*"
         FILE GTelDat$
         SELECT WHERE art.GTeldat$ LIKE suna1$ OR nummer.gteldat$ LIKE suna1$
         filtbutadr1$ = "Filter: " + sunaa$
         FILE GADRDat$
       END IF 
       CALL ADRFeldnamen()
       FORM 
     ELSE 
       filtbutadr1$ = "Filter: ohne"
       SELECT WHERE FILE GTelDat$
       CALL ADRFeldnamen()
       FORM 
     END IF 
     filtbutorg1$ = filtbutadr1$
   CASE 216
     IF GASP% THEN 
       adrmaske$ = "ASPADRD"
     ELSE 
       adrmaske$ = "ADRESSED"
     END IF 
     filtbutorg1$ = filtbutadr1$
   CASE 215
     IF GASP% THEN 
       adrmaske$ = "ASPADRC"
     ELSE 
       adrmaske$ = "ADRESSEC"
     END IF 
     filtbutorg1$ = filtbutadr1$
   CASE 214
     IF GASP% THEN 
       adrmaske$ = "ASPADRB"
     ELSE 
       adrmaske$ = "ADRESSEB"
     END IF 
     filtbutorg1$ = filtbutadr1$
   CASE 213
     IF GASP% THEN 
       adrmaske$ = "ASPADRA"
     ELSE 
       adrmaske$ = "ADRESSEA"
     END IF 
     filtbutorg1$ = filtbutadr1$
   CASE 212
     REM Original Adressmaske sortiert nach Reihenfolge
     adrmaske$ = adrmaskeold$
     filtbutorg1$ = filtbutadr1$
   CASE 211
     REM Kundenakte
     knr% = codeku.adressen
     CALL KuAkte(knr%)
   CASE 210
     REM sende Werbeemail
     IF Nummer.GTeldat$ LIKE "*@*" AND GCODie% THEN 
       CALL SendEMAIL2(Nummer.GTeldat$,codeku.adressen)
       GOTO wemail210220073
     END IF 
     IF Nummer.GTeldat$ LIKE "*ww*" OR Nummer.GTeldat$ LIKE "ww*" THEN 
       IF NOT EXISTS (GMACodeDir$ + "openurl.exe") THEN COPY _netpath$ + "local\openurl.exe" TO GMACodeDir$ + "openurl.exe"
       IF LEFT$ (Nummer.GTeldat$,3) LIKE "www" THEN 
         nr$ = "http://" + Nummer.GTeldat$
       END IF 
       IF LEFT$ (Nummer.GTeldat$,4) LIKE "http" THEN 
         nr$ = Nummer.GTeldat$
       END IF 
       prg$ = GMACodeDir$ + "openurl.exe"
       IF EXISTS (GMACodeDir$ + "opurl.bat") THEN DELETE GMACodeDir$ + "opurl.bat"
       OPEN GMACodeDir$ + "opurl.bat" FOR APPEND 
       ? "echo OFF"
       ? prg$ + " " + nr$
       CLOSE OUTPUT 
       CALL (GMACodeDir$ + "opurl.bat")
     END IF 
wemail210220073:  
   CASE 209
     IF land.adressen <> "" THEN 
       IF land.adressen LIKE "deutsch*" OR land.adressen LIKE "brd*" OR land.adressen LIKE "germa*" OR land.adressen LIKE "D" THEN 
         land$ = "Germany"
       ELSE 
         land$ = FN ansi(land.adressen)
       END IF 
     ELSE 
       land$ = "Germany"
     END IF 
     nr$ = "http://maps.google.de/?Land=" + land$ + "&PLZ=" + plz.adressen + "+" + (ort.adressen) + "&Strasse=" + (stra·e.adressen) + "&q=" + (stra·e.adressen) + "%2c+" + plz.adressen + "+" + (ort.adressen)
     nr$ = FN ansi(nr$)
     IF NOT EXISTS (GMACodeDir$ + "openurl.exe") THEN COPY _netpath$ + "local\openurl.exe" TO GMACodeDir$ + "openurl.exe"
     prg$ = GMACodeDir$ + "openurl.exe"
     IF EXISTS (GMACodeDir$ + "opurl.bat") THEN DELETE GMACodeDir$ + "opurl.bat"
     OPEN GMACodeDir$ + "opurl.bat" FOR APPEND 
     ? "echo OFF"
     ? prg$ + " " + CHR$ (34) + FN oem(nr$) + CHR$ (34)
     CLOSE OUTPUT 
     COPY FROM nr$
     CALL Fehler("Bitte im geîffneten Browser in der Adress-Eingabezeile STRG+V und anschlie·end ENTER drÅcken, dann wird Ihnen in Google-Maps die geografische Position der Adresse angezeigt!","")
     CALL (GMACodeDir$ + "opurl.bat"),0
   CASE 208
     REM Stammblatt
     FILE GADRDAT$
     
     codeku% = codeku.GADRDat$
     knr% = codeku%
     SELECT FIRST FILE GADRDat$ INDEX codeku.GADRDat$
     SELECT KEY codeku% LOCK FILE GADRDat$ INDEX codeku.GADRDat$
     CALL ADRIntro()
     CALL ADRFeldnamen()
     SELECT FORM KEY knr% FILE GTELDat$ INDEX CodeKU.GTELDat$
     MOUSE OFF 
     FORM 
     MOUSE ON 
     CALL ADRNoteBig("Stammblatt","ADRESSEN")
     IF MOD (GADRDAT$) OR NEW (GADRDAT$) THEN 
       STORE FILE GADRDAT$
     END IF 
     SELECT FIRST FILE GADRDat$ INDEX codeku.GADRDat$
     SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
   CASE 207
     REM fÅr Aleks - Kontakte
     IF EXISTS (codeku.adressen,codeku.GCondat$) THEN 
       CALL AleksKontAnz(codeku.adressen)
     ELSE 
       CALL Fehler("Es existieren noch keine Kontakte fÅr diese Adresse!","")
     END IF 
   CASE 206
     REM fÅr Aleks - Empfehlung
     CALL ADRNoteBig("EmpfehlTXT","ADRESSEN")
   CASE 205
     REM fÅr Aleks - VertragsÅbersicht 17092005
     IF EXISTS (codeku.adressen,codeku.kvertrag) THEN 
       CALL AleksVertrAnz(codeku.adressen)
     ELSE 
       CALL Fehler("keine VertrÑge vorhanden","")
     END IF 
   CASE 204
     REM Agentur 2 zuweisen
     knr% = codeku.GADRDat$
     CALL AgenturNeu2()
   CASE 203
     CALL VoiceDial1()
   CASE 202
     REM export einzelne Adresse nach outlook
     codeku% = codeku.GADRDat$
     CALL ADRExpOutl(codeku%)
   CASE 201
     REM Postanschriftsfeld neu generieren
     codeku% = codeku.GADRDat$
     SELECT FIRST FILE GADRDAT$ INDEX codeku.GADRDAT$
     SELECT KEY codeku% LOCK FILE GADRDAT$ INDEX codeku.GADRDAT$
     geand% = - 1
     IF Postanschrift.GAdrDat$ = "" OR geand% = - 1 THEN 
       p$ = ""
       IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
         p$ = Anrede.GAdrDat$ + CHR$ (13) + CHR$ (10)
         IF LTRIM$ (Titel.GAdrDat$) <> "" THEN 
           p$ = p$ + LTRIM$ (Titel.GAdrDat$) + " "
         END IF 
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (Vorname.GAdrDat$) + " " + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10) + land.GADRDat$ + CHR$ (13) + CHR$ (10)
         REM p$ = p$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
       ELSE 
         IF LTRIM$ (Anrede.GAdrDat$) <> "" THEN 
         p$ = LTRIM$ (Anrede.GAdrDat$) + " "
         END IF 
         IF LTRIM$ (titel.GAdrDat$) <> "" THEN 
           p$ = p$ + LTRIM$ (titel.GAdrDat$)
         END IF 
         IF LTRIM$ (Anrede.GAdrDat$) <> "" OR LTRIM$ (titel.GAdrDat$) <> "" THEN 
           p$ = p$ + CHR$ (13) + CHR$ (10)
         END IF 
         IF geburtsname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (nachname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (geburtsname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (Vorname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (Vorname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10) + land.GADRDat$ + CHR$ (13) + CHR$ (10)
         REM IF land.GAdrDat$ <> "" THEN p$ = p$ + CHR$ (13) + CHR$ (10) + Land.GAdrDat$
         
       END IF 
       Adrtemp$ = p$
       lauf1% = 0
       CREATE DIALOG "MakeAdr",0,0,273,206,"Postanschriftsfeld","MS Sans Serif",8
       ADD DIALOG "MakeAdr",4,0,0,272,155,0,""
       ADD DIALOG "MakeAdr",9,3,10,21,22,2
       ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse im Postanschriftsfeld gespeichert werden soll:"
       ADD DIALOG "MakeAdr",6,30,33,236,106,68,2,Adrtemp$,1800
       ADD DIALOG "MakeAdr",2,30,160,160,10,0,"Land mit aufnehmen","j","n",Kontrollland$
       ADD DIALOG "MakeAdr",2,30,170,160,10,0,"Briefanrede mit aufnehmen","j","n",Kontrollfeld$
       ADD DIALOG "MakeAdr",1,73,185,55,15,1,"&Weiter",1,1
       ADD DIALOG "MakeAdr",1,129,185,55,15,0,"&Abbrechen",0,0
       DIALOG "MakeAdr",req%
       REMOVE DIALOG "MakeAdr"
       IF req% = 1 THEN 
         IF Kontrollland$ = "j" THEN 
           IF land.GAdrDat$ <> "" THEN 
             Adrtemp$ = Adrtemp$ + CHR$ (13) + CHR$ (10) + Land.GAdrDat$
             lauf1% = 1
           END IF 
         END IF 
         IF Kontrollfeld$ = "j" THEN 
           IF briefanrede.GAdrDat$ <> "" THEN 
             Adrtemp$ = Adrtemp$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
             lauf1% = 1
           END IF 
         END IF 
         IF lauf1% = 1 THEN 
           CREATE DIALOG "MakeAdr",0,0,273,206,"Postanschriftsfeld","MS Sans Serif",8
           ADD DIALOG "MakeAdr",4,0,0,272,155,0,""
           ADD DIALOG "MakeAdr",9,3,10,21,22,2
           ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse im Postanschriftsfeld gespeichert werden soll:"
           ADD DIALOG "MakeAdr",6,30,33,236,106,68,2,Adrtemp$,1800
           ADD DIALOG "MakeAdr",2,30,160,160,10,0,"Land mit aufnehmen","j","n",Kontrollland$
           ADD DIALOG "MakeAdr",2,30,170,160,10,0,"Briefanrede mit aufnehmen","j","n",Kontrollfeld$
           ADD DIALOG "MakeAdr",1,73,185,55,15,1,"&Weiter",1,1
           ADD DIALOG "MakeAdr",1,129,185,55,15,0,"&Abbrechen",0,0
           DIALOG "MakeAdr",req%
           REMOVE DIALOG "MakeAdr"
         END IF 
         IF req% = 1 THEN 
           Postanschrift.GAdrDat$ = Adrtemp$
         END IF 
       END IF 
     END IF 
     CALL MATimeStamp(GAdrDat$)
     CALL QuickStore(GAdrDat$)
   CASE 200
     REM Vertrags-Such-Historie
     knr% = codeku.adressen
     CALL KVHist()
   CASE 196
     REM Adresse bei EG eintragen
     knr% = codeku.GADRDat$
     SELECT KEY knr% LOCK FILE GADRDat$ INDEX codeku.GADRDat$
     EGNachname.GADRDat$ = Nachname.GADRDat$
     EGASStra·e.GADRDat$ = Stra·e.GADRDat$
     EGASPLZ.GADRDat$ = PLZ.GADRDat$
     EGASOrt.GADRDat$ = Ort.GADRDat$
     EGLand.GADRDat$ = Land.GADRDat$
     STORE FILE GADRDat$
     
   CASE 195
     REM Adress-Such-Historie
     knr% = codeku.adressen
     CALL AdrHist()
   CASE 185
     REM Vertragssuche 
     cuvt% = 0
     codeku1% = codeku.adressen
     CALL ADRVertrSu()
     SELECT FIRST FILE "adressen" INDEX codeku.adressen
     SELECT KEY codeku1% FILE "adressen" INDEX codeku.adressen
     REM CALL VAn280403()
   CASE 184
     IF stprÅf1$ LIKE "maxi*" THEN 
       stprÅf1$ = "minimieren"
       IF GBildschirm% = 1024 THEN 
         f.stichbig.Height = 4719
         f.stichbig.Top = 1917
       ELSE 
         f.stichbig.Height = 4343
         f.stichbig.Top = 948
       END IF 
     ELSE 
       stprÅf1$ = "maximieren"
       IF GBildschirm% = 1024 THEN 
         f.stichbig.Height = 708
         f.stichbig.Top = 5928
       ELSE 
         f.stichbig.Height = 530
         f.stichbig.Top = 4880
       END IF 
     END IF 
   CASE 183
     REM Interessent als Kundenadresse umwandeln und umgekehrt
     IF disabled%("INTERESSZUKUND") THEN 
     ELSE 
      IF GADRDat$ LIKE "ADRESS*" THEN 
       REQUEST "Wollen Sie diese Adresse in die Interessentendatei kopieren?","",130,req%
       IF req% = 1 THEN 
         Superbase.Dialogs.Add("COPYADR")
         SET dlg = Superbase.Dialogs.COPYADR
         dlg.Move(0,0,200,100)
         dlg.Caption = "Adresse kopieren"
         dlg.FontName = "MS Sans Serif"
         dlg.FontSize = 8
 
         SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
         control.Move(8,19,176,14)
         control.Caption = "zugehîrigen Termine mitkopieren"
         control.Bind("copytermin$")
         control.ValueOn = "j"
         control.ValueOff = "n"
 
         SET control = dlg.Add("DialogCheckBox3","DialogCheckBox")
         control.Move(8,36,176,13)
         control.Caption = "zugehîrige Dokumente kopieren"
         control.Bind("copydok$")
         control.ValueOn = "j"
         control.ValueOff = "n"
 
         REM SET control = dlg.Add("DialogCheckBox2","DialogCheckBox")
         REM control.Move(8,52,176,13)
         REM control.Caption = "Interessent anschlie·end lîschen"
         REM control.Bind("intloe$")
         REM control.ValueOn = "j"
         REM control.ValueOff = "n"
 
         SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
         control.Move(40,75,48,14)
         control.Default = 1
         control.Caption = "OK"
         control.ReturnValue = 1
 
         SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
         control.Move(93,75,48,14)
         control.Caption = "Abbruch"
         control.ReturnValue = 0
         DIALOG "COPYADR",req%
         REMOVE DIALOG ALL 
         IF req% = 1 THEN 
           codekuold% = codeku.ADRESSEN
           BLANK FILE "BCKONTAK"
           a% = CopyRecord%("ADRESSEN","BCKONTAK")
           codekuneu% = SER ("BCKONTAK",1)
           codeku.bckontak = codekuneu%
           SELECT FIRST LOCK FILE "stamm"
           nnum% = LASTIntnr.stamm + 1
           LastIntnr.stamm = nnum%
           STORE FILE "Stamm"
           UNLOCK CURRENT FILE "stamm"
           SELECT FIRST FILE "Stamm"
           prefix$ = LTRIM$ (IntPREFIX.stamm)
           Kundennummer.BCKONTAK = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
           Uebernahme.bckontak = TODAY 
           GADRDat$ = "BCKONTAK"
           CALL QuickStore("BCKONTAK")
           GADRDat$ = "ADRESSEN"
           SELECT KEY codekuold% LOCK FILE "Adressen" INDEX codeku.adressen
           Uebernahme.adressen = TODAY 
           STORE FILE "Adressen"
           UNLOCK CURRENT FILE "Adressen"
           UNLOCK FILE "Adressen"
           IF EXISTS (codekuold%,codeku.telefon) THEN 
             SELECT FIRST FILE "telefon" INDEX codeku.telefon
             SELECT KEY codekuold% FILE "telefon" INDEX codeku.telefon
             WHILE NOT EOF ("telefon") AND codeku.telefon = codekuold%
               BLANK FILE "TELBCK"
               codetel.telbck = SER ("TELBCK",1)
               codeku.telbck = codekuneu%
               Art.telbck = Art.Telefon
               Nummer.telbck = Nummer.telefon
               FonoderFax.telbck = FonoderFax.telefon
               Qart.telbck = VSNRPack$(art.telbck)
               Qnummer.telbck = VSNRPack$(nummer.telbck)
               QCodeKUTEL.telbck = STR$ (codeku.telbck,"000000") + STR$ (codetel.telbck,"000000")
               STORE FILE "TELBCK"
               UNLOCK CURRENT FILE "TELBCK"
               UNLOCK FILE "TELBCK"
               SELECT NEXT FILE "telefon" INDEX codeku.telefon
             WEND 
             UNLOCK CURRENT FILE "TELBCK"
             UNLOCK FILE "TELBCK"
           END IF 
           REQUEST "Adresse wurde kopiert!"
           IF copytermin$ = "j" THEN 
             quel$ = "AKQUISE"
             dest$ = "AKQUIBCK"
             IF EXISTS (codekuold%,codeku.quel$) THEN 
               GADRDat$ = "BCKONTAK"
               GAKQUIDat$ = "AKQUIBCK"
               SELECT FIRST FILE quel$ INDEX codeku.quel$
               SELECT KEY codekuold% FILE quel$ INDEX codeku.quel$
               WHILE NOT EOF (quel$) AND codeku.quel$ = codekuold%
                 BLANK FILE dest$
                 a% = CopyRecord%(quel$,dest$)
                 codeaq.dest$ = SER (dest$,1)
                 codeku.dest$ = codekuneu%
                 REM CALL Fehler("","")
                 CALL QuickStore(dest$)
                 SELECT NEXT FILE quel$ INDEX codeku.quel$
               WEND 
               GADRDat$ = "ADRESSEN"
               GAKQUIDat$ = "AKQUISE"
               REQUEST "Termine wurden kopiert!"
             END IF 
           END IF 
           IF copydok$ = "j" THEN 
             quel$ = "DOKUMENT"
             dest$ = "DOKBCK"
             IF EXISTS (codekuold%,codeku.quel$) THEN 
               GADRDat$ = "BCKONTAK"
               GAKQUIDat$ = "AKQUIBCK"
               GDOKDat$ = "DOKBCK"
               SELECT FIRST FILE quel$ INDEX codeku.quel$
               SELECT KEY codekuold% FILE quel$ INDEX codeku.quel$
               WHILE NOT EOF (quel$) AND codeku.quel$ = codekuold%
                 BLANK FILE dest$
                 a% = CopyRecord%(quel$,dest$)
                 codeku.dest$ = codekuneu%
                 CALL QuickStore(dest$)
                 SELECT NEXT FILE quel$ INDEX codeku.quel$
               WEND 
               GADRDat$ = "ADRESSEN"
               GAKQUIDat$ = "AKQUISE"
               GDOKDat$ = "DOKUMENT"
               REQUEST "Dokumente wurden kopiert!"
             END IF 
           END IF 
           REM jetzt fragen, ob auch Termine und Dokumente kopiert werden sollen
         END IF 
       END IF 
     ELSE 
       REQUEST "Wollen Sie diesen Interessenten in die Kundenadressdatei kopieren?","",130,req%
       IF req% = 1 THEN 
         Superbase.Dialogs.Add("COPYADR")
         SET dlg = Superbase.Dialogs.COPYADR
         dlg.Move(0,0,200,100)
         dlg.Caption = "Adresse kopieren"
         dlg.FontName = "MS Sans Serif"
         dlg.FontSize = 8
 
         SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
         control.Move(8,19,176,14)
         control.Caption = "zugehîrigen Termine mitkopieren"
         control.Bind("copytermin$")
         control.ValueOn = "j"
         control.ValueOff = "n"
 
         SET control = dlg.Add("DialogCheckBox3","DialogCheckBox")
         control.Move(8,36,176,13)
         control.Caption = "zugehîrige Dokumente kopieren"
         control.Bind("copydok$")
         control.ValueOn = "j"
         control.ValueOff = "n"
 
         SET control = dlg.Add("DialogCheckBox2","DialogCheckBox")
         control.Move(8,52,176,13)
         control.Caption = "Interessent anschlie·end lîschen"
         control.Bind("intloe$")
         control.ValueOn = "j"
         control.ValueOff = "n"
 
         SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
         control.Move(40,75,48,14)
         control.Default = 1
         control.Caption = "OK"
         control.ReturnValue = 1
 
         SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
         control.Move(93,75,48,14)
         control.Caption = "Abbruch"
         control.ReturnValue = 0
         DIALOG "COPYADR",req%
         REMOVE DIALOG ALL 
         IF req% = 1 THEN 
           codekuold% = codeku.bckontak
           BLANK FILE "ADRESSEN"
           a% = CopyRecord%("BCKONTAK","ADRESSEN")
           codekuneu% = SER ("ADRESSEN",1)
           codeku.adressen = codekuneu%
           SELECT FIRST LOCK FILE "stamm"
           nnum% = LastKunr.stamm + 1
           LastKunr.stamm = nnum%
           STORE FILE "Stamm"
           UNLOCK CURRENT FILE "stamm"
           SELECT FIRST FILE "Stamm"
           prefix$ = LTRIM$ (KUNRPREFIX.stamm)
           Kundennummer.ADRESSEN = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
           Uebernahme.ADRESSEN = TODAY 
           GADRDat$ = "ADRESSEN"
           CALL QuickStore("ADRESSEN")
           GADRDat$ = "BCKONTAK"
           SELECT KEY codekuold% LOCK FILE "BCKONTAK" INDEX codeku.BCKONTAK
           Uebernahme.BCKONTAK = TODAY 
           STORE FILE "BCKONTAK"
           UNLOCK CURRENT FILE "BCKONTAK"
           UNLOCK FILE "BCKONTAK"
           IF EXISTS (codekuold%,codeku.telbck) THEN 
             SELECT FIRST FILE "telbck" INDEX codeku.telbck
             SELECT KEY codekuold% FILE "telbck" INDEX codeku.telbck
             WHILE NOT EOF ("telbck") AND codeku.telbck = codekuold%
               BLANK FILE "Telefon"
               codetel.Telefon = SER ("Telefon",1)
               codeku.Telefon = codekuneu%
               Art.Telefon = Art.telbck
               Nummer.Telefon = Nummer.telbck
               FonoderFax.Telefon = FonoderFax.telbck
               KART1.telefon = KART1.telbck
               KART2.telefon = KART2.telbck
               Qart.Telefon = VSNRPack$(art.Telefon)
               Qnummer.Telefon = VSNRPack$(nummer.Telefon)
               STORE FILE "Telefon"
               UNLOCK CURRENT FILE "Telefon"
               UNLOCK FILE "TElefon"
               SELECT NEXT FILE "telbck" INDEX codeku.telbck
             WEND 
             UNLOCK CURRENT FILE "Telefon"
             UNLOCK FILE "TElefon"
           END IF 
           REQUEST "Adresse wurde kopiert!"
           IF copytermin$ = "j" THEN 
             dest$ = "AKQUISE"
             quel$ = "AKQUIBCK"
             IF EXISTS (codekuold%,codeku.quel$) THEN 
               GADRDat$ = "ADRESSEN"
               GAKQUIDat$ = "AKQUISE"
               GDOKDat$ = "DOKUMENT"
               SELECT FIRST FILE quel$ INDEX codeku.quel$
               SELECT KEY codekuold% FILE quel$ INDEX codeku.quel$
               WHILE NOT EOF (quel$) AND codeku.quel$ = codekuold%
                 BLANK FILE dest$
                 a% = CopyRecord%(quel$,dest$)
                 codeaq.dest$ = SER (dest$,1)
                 codeku.dest$ = codekuneu%
                 CALL QuickStore(dest$)
                 SELECT NEXT FILE quel$ INDEX codeku.quel$
               WEND 
               GADRDat$ = "BCKONTAK"
               GAKQUIDat$ = "AKQUIBCK"
               GDOKDat$ = "DOKBCK"
               REQUEST "Termine wurden kopiert!"
             END IF 
           END IF 
           IF copydok$ = "j" THEN 
             dest$ = "DOKUMENT"
             quel$ = "DOKBCK"
             IF EXISTS (codekuold%,codeku.quel$) THEN 
               GADRDat$ = "ADRESSEN"
               GAKQUIDat$ = "AKQUISE"
               GDOKDat$ = "DOKUMENT"
               SELECT FIRST FILE quel$ INDEX codeku.quel$
               SELECT KEY codekuold% FILE quel$ INDEX codeku.quel$
               WHILE NOT EOF (quel$) AND codeku.quel$ = codekuold%
                 BLANK FILE dest$
                 a% = CopyRecord%(quel$,dest$)
                 codeku.dest$ = codekuneu%
                 CALL QuickStore(dest$)
                 SELECT NEXT FILE quel$ INDEX codeku.quel$
               WEND 
               GADRDat$ = "BCKONTAK"
               GAKQUIDat$ = "AKQUIBCK"
               GDOKDat$ = "DOKBCK"
               REQUEST "Dokumente wurden kopiert!"
             END IF 
           END IF 
           IF intloe$ LIKE "j" THEN 
             REQUEST "Wollen Sie diesen Interessenten lîschen?","",130,req%
             IF req% = 1 THEN 
               MOUSE OFF 
               REMOVE FROM FILE "BCKONTAK" WHERE codeku.bckontak = codekuold%
               REMOVE FROM FILE "TELBCK" WHERE codeku.telbck = codekuold%
               REMOVE FROM FILE "AKQUIBCK" WHERE codeku.akquibck = codekuold%
               REMOVE FROM FILE "DOKBCK" WHERE codeku.dokbck = codekuold%
               MOUSE ON 
               REQUEST "Interessent wurde gelîscht!"
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
    END IF 
     FILE GADRDat$
   CASE 182
     CALL FStore(GAdrDat$)
     CALL Fehler("","")
   CASE 181
     IF ProjectJN$ = "TRUE" THEN 
     ELSE 
       IF UCASE$ ( FORM ) = GAdrDat$ THEN 
         adrmaske$ = "ADRESSEE"
       ELSE 
         adrmaske$ = GAdrDat$
       END IF 
     END IF 
   CASE 1
     CALL QuickStore(GAdrDat$)
     REM CALL AKQUISE(2)
     IF GAkquiDat$ LIKE "AKQUISE" THEN 
       CALL ADRAkquiNew()
     ELSE 
       CALL AKQUISE(2)
     END IF 
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 2
     REM CALL ADRTelefon()
     CALL TelefonListe(CodeKU.GAdrDat$)
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 3
     CALL QuickStore (GAdrDat$)
     CALL ADRsub3():REM PROVIS VertrÑge
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 4
     CALL QuickStore(GAdrDat$)
     CALL ADRsub4():REM IMMAK Angebote
     IF FORM = adrmaske$ THEN 
       CALL ADRIntro()
       CALL ADRFeldnamen()
     END IF 
     GIvonAdr% = 0
   CASE 5
     CALL QuickStore(GAdrDat$)
     CALL ADRsub5():REM IMMAK Anfrage
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
     GIvonAdr% = 0
   CASE 6
     CALL QuickStore(GAdrDat$)
     CALL ADRsub6():REM MEDIA Verleih
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
     
   CASE 7
     CALL QuickStore(GAdrDat$)
     CALL ADRAngebot():REM FACTURA Angebotserfassung
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 8
     CALL QuickStore(GAdrDat$)
     CALL ADRRechnung():REM FACTURA Rechnungserfassung
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 9
     CALL QuickStore(GAdrDat$)
     CALL ADRLiefer():REM FACTURA Lieferscheinerfassung
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 10
     CALL QuickStore(GAdrDat$)
     CALL ADRAuftrag():REM FACTURA Auftragserfassung
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 11
     CALL QuickStore(GAdrDat$)
     CALL ADRBestell():REM FACTURA Bestellungserfassung
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 12
     CALL QuickStore(GAdrDat$)
     CALL ADRGutschr():REM FACTURA Gutschrift
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 13
     CALL QuickStore(GAdrDat$)
     GCodieRuf1% = 0
     CALL TerArtSpez()
     CALL AQAdrHist(1):REM TerminÅbersicht aus Adressen heraus 
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 14
     datei$ = GAdrDat$
     REM dindex$ = "nachname."+GAdrDat$"
     dindex$ = UCASE$ ( INDEX )
     SELECT CASE dindex$
       CASE "ANREDE"
         Felder$(0) = "Anrede":Felder$(1) = "5"
         Felder$(2) = "Nachname":Felder$(3) = "19"
         Felder$(4) = "Vorname":Felder$(5) = "13"
         Felder$(6) = "Geburtsname":Felder$(7) = "13"
         Felder$(8) = "Ort":Felder$(9) = "13"
         Felder$(10) = "PLZ":Felder$(11) = "5"
         Felder$(12) = "Stra·e":Felder$(13) = "8"
         Felder$(20) = "Stichwort":Felder$(21) = "8"
         Felder$(22) = "Kundennummer":Felder$(23) = "8"
         Felder$(24) = "AALieferant":Felder$(25) = "2"
         Felder$(26) = "AAKunde":Felder$(27) = "2"
         Felder$(28) = "":Felder$(29) = ""
       CASE "NACHNAME"
         Felder$(0) = "Nachname":Felder$(1) = "19"
         Felder$(2) = "Vorname":Felder$(3) = "13"
         Felder$(4) = "Geburtsname":Felder$(5) = "13"
         Felder$(6) = "Ort":Felder$(7) = "13"
         Felder$(8) = "PLZ":Felder$(9) = "5"
         Felder$(10) = "Stra·e":Felder$(11) = "8"
         Felder$(18) = "Anrede":Felder$(19) = "5"
         Felder$(20) = "Stichwort":Felder$(21) = "8"
         Felder$(22) = "Kundennummer":Felder$(23) = "8"
         Felder$(24) = "AALieferant":Felder$(25) = "2"
         Felder$(26) = "AAKunde":Felder$(27) = "2"
         Felder$(28) = "":Felder$(29) = ""
       CASE "ORT"
         Felder$(0) = "Ort":Felder$(1) = "13"
         Felder$(2) = "PLZ":Felder$(3) = "5"
         Felder$(4) = "Nachname":Felder$(5) = "19"
         Felder$(6) = "Vorname":Felder$(7) = "13"
         Felder$(8) = "Geburtsname":Felder$(9) = "13"
         Felder$(10) = "Stra·e":Felder$(11) = "8"
         Felder$(18) = "Anrede":Felder$(19) = "5"
         Felder$(20) = "Stichwort":Felder$(21) = "8"
         Felder$(22) = "Kundennummer":Felder$(23) = "8"
         Felder$(24) = "AALieferant":Felder$(25) = "2"
         Felder$(26) = "AAKunde":Felder$(27) = "2"
         Felder$(28) = "":Felder$(29) = ""
       CASE "PLZ"
         Felder$(0) = "PLZ":Felder$(1) = "5"
         Felder$(2) = "Ort":Felder$(3) = "13"
         Felder$(4) = "Nachname":Felder$(5) = "19"
         Felder$(6) = "Vorname":Felder$(7) = "13"
         Felder$(8) = "Geburtsname":Felder$(9) = "13"
         Felder$(10) = "Stra·e":Felder$(11) = "8"
         Felder$(18) = "Anrede":Felder$(19) = "5"
         Felder$(20) = "Stichwort":Felder$(21) = "8"
         Felder$(22) = "Kundennummer":Felder$(23) = "8"
         Felder$(24) = "AALieferant":Felder$(25) = "2"
         Felder$(26) = "AAKunde":Felder$(27) = "2"
         Felder$(28) = "":Felder$(29) = ""
       CASE "STRA·E"
         Felder$(0) = "Stra·e":Felder$(1) = "15"
         Felder$(2) = "Ort":Felder$(3) = "13"
         Felder$(4) = "PLZ":Felder$(5) = "5"
         Felder$(6) = "Nachname":Felder$(7) = "19"
         Felder$(8) = "Vorname":Felder$(9) = "13"
         Felder$(10) = "Geburtsname":Felder$(11) = "13"
         Felder$(18) = "Anrede":Felder$(19) = "5"
         Felder$(20) = "Stichwort":Felder$(21) = "8"
         Felder$(22) = "Kundennummer":Felder$(23) = "8"
         Felder$(24) = "AALieferant":Felder$(25) = "2"
         Felder$(26) = "AAKunde":Felder$(27) = "2"
         Felder$(28) = "":Felder$(29) = ""
      CASE "KUNDENNUMMER"
         Felder$(0) = "Kundennummer":Felder$(1) = "10"
         Felder$(2) = "Nachname":Felder$(3) = "19"
         Felder$(4) = "Vorname":Felder$(5) = "13"
         Felder$(6) = "Geburtsname":Felder$(7) = "13"
         Felder$(8) = "Ort":Felder$(9) = "13"
         Felder$(10) = "PLZ":Felder$(11) = "5"
         Felder$(12) = "Stra·e":Felder$(13) = "8"
         Felder$(20) = "Stichwort":Felder$(21) = "8"
         Felder$(22) = "Anrede":Felder$(23) = "5"
         Felder$(24) = "AALieferant":Felder$(25) = "2"
         Felder$(26) = "AAKunde":Felder$(27) = "2"
         Felder$(28) = "":Felder$(29) = ""
       CASE ELSE 
         Felder$(0) = "Nachname":Felder$(1) = "19"
         Felder$(2) = "Vorname":Felder$(3) = "13"
         Felder$(4) = "Geburtsname":Felder$(5) = "13"
         Felder$(6) = "Ort":Felder$(7) = "13"
         Felder$(8) = "PLZ":Felder$(9) = "5"
         Felder$(10) = "Stra·e":Felder$(11) = "8"
         Felder$(18) = "Anrede":Felder$(19) = "5"
         Felder$(20) = "Stichwort":Felder$(21) = "8"
         Felder$(22) = "Kundennummer":Felder$(23) = "8"
         Felder$(24) = "AALieferant":Felder$(25) = "2"
         Felder$(26) = "AAKunde":Felder$(27) = "2"
         Felder$(28) = "":Felder$(29) = ""
     END SELECT 
     i% = 0
     CALL ADRTab(datei$,dindex$)
   CASE 15
     REM Drucken von Adressen
     CALL ADRDrucken()
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 16
     IF NOT disabled%("ADRSPERRE") THEN 
       IF ag$ <> "j" THEN 
         CALL ADRSperre()
         IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
       ELSE 
         CALL Fehler("Diese Funktion steht unter der Agenturvariante nicht zur VerfÅgung","")
       END IF 
     END IF 
   CASE 17
     IF NOT disabled%("VORGANG") THEN 
       knr% = codeku.GAdrDat$
       IF NOT OPEN ("sparten") THEN CALL DFile(3,"sparten" + _fpw$)
       IF NOT OPEN ("geadr") THEN CALL DFile(3,"geadr" + _fpw$)
       IF NOT OPEN ("geadr2") THEN CALL DFile(3,"geadr2" + _fpw$)
       IF NOT OPEN ("maadr") THEN CALL DFile(3,"maadr" + _fpw$)

       IF NOT OPEN ("aumsatz") THEN CALL DFile(3,"AUmsatz" + _fpw$)
       IF NOT OPEN ("fonds") THEN CALL DFile(3,"FONDS" + _fpw$)
       IF NOT OPEN ("kgeadr") THEN CALL DFile(3,"KGEADR" + _fpw$)
       IF NOT OPEN ("kurshist") THEN CALL DFile(3,"KURSHIST" + _fpw$)
       IF NOT OPEN ("maadrgru") THEN CALL DFile(3,"maadrgru" + _fpw$)
       IF NOT OPEN ("vkond") THEN CALL DFile(3,"vkond" + _fpw$)
       IF NOT OPEN ("formular") THEN CALL DFile(3,"formular" + _fpw$)
       IF NOT OPEN ("spgruppe") THEN CALL DFile(3,"spgruppe" + _fpw$)
       IF NOT OPEN ("vpspezko") THEN CALL DFile(3,"vpspezko" + _fpw$)
       IF NOT OPEN ("spezkond") THEN CALL DFile(3,"spezkond" + _fpw$)
       IF NOT OPEN ("vprodukt") THEN CALL DFile(3,"vprodukt" + _fpw$)
       IF NOT OPEN ("maadrag") THEN CALL DFile(3,"maadrag" + _fpw$)
       IF NOT OPEN ("kvfael") THEN CALL DFile(3,"kvfael" + _fpw$)

       IF EXISTS (knr%,codeku.vorgang) THEN 
         FILE "Vorgang"
         CALL KUVorgang()
         SELECT FORM KEY knr% FILE "Vorgang" INDEX codeku.vorgang
       ELSE 
         CALL Fehler("Es sind keine Vertragsnachbearbeitungen/SchÑden zu dieser Adresse vorhanden!","")
       END IF 
     END IF 
   CASE 18
     REM 080498
     knr% = codeku.GAdrDat$
     CALL ADRDokNew()
   CASE 19
     REM 10.11.98 Factura Mahnungen
     CALL QuickStore (GAdrDat$)
     CALL ADRMahnung()
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 20
     CALL KProdukt()
   CASE 21
     CALL Verleih1()
   CASE 22
     MOUSE OFF 
     kunr% = codeku.GADRDat$
     REM Export nach Outlook
     
     IF NOT disabled%("OUTLOOKEXPORTEIN") THEN 
       CALL Fehler("Achtung!: Sie erhalten jetzt die Mîglichkeit die aktuelle Adresse und Ihre Termine nach MS Outlook zu exportieren!","")
       REQUEST "Export starten?","",130,req%
       IF req% = 0 THEN GOTO outlexp180320023
       CALL ADRExpOutl(codeku.GADRDat$,0)
       GOTO outlexp180320023
       t1$ = "Diese beiden Dateien dienen dann als Importdateien fÅr MS Outlook. (In MS Outlook MenÅ Datei/Importieren-Exportieren/Import aus anderen Programmen/Kommagetrennte Werte (Window))"
       t0$ = "Weiterhin werden alle nichterledigten Termine dieser Adressen in die Datei " + GMACodeDir$ + "outkal.csv exportiert."
       
       CALL Fehler("Es werden nachfolgend alle Adressen, die fÅr den Export markiert wurden in die Datei " + GMACodeDir$ + "outadr.csv exportiert.",t0$ + t1$)
       REQUEST "Sollen nur die Adressen und Termine eines","einzelnen Vermittlers exportiert werden?",130,req%
       IF req% = 1 THEN 
         IF GASP% THEN 
           wks1% = Workstation%
           a% = SelectOffice%("BÅro-Auswahl","",1,wks1%)
           MOUSE ON 
           IF a% <> - 1 THEN 
             zzz% = a%
             codema% = GetCodeMA%(cuma%,zzz%)
             IF codema% < 1 THEN 
               GOTO outlexp180320023
             END IF 
           ELSE 
             CALL Fehler("MS Outlook Export abgebrochen!","Sie haben keinen Mitarbeiter ausgewÑhlt")
             GOTO outlexp180320023
           END IF 
 
         ELSE 
           codema% = GetCodeMA%(0,Workstation%)
         END IF 
       ELSE 
         codema% = 0
         IF GASP% THEN 
           IF workstation% = 0 THEN 
             REQUEST "Sollen nur die Adressen und Termine eines","einzelnen BÅros exportiert werden?",130,req%
             wkswahl% = 0
             IF req% = 1 THEN 
               wks1% = Workstation%
               a% = SelectOffice%("BÅro-Auswahl","",1,wks1%)
               wkswahl% = a%
               IF wkswahl% = - 1 THEN 
                 CALL Fehler("MS Outlook Export abgebrochen!","Sie haben kein BÅro ausgewÑhlt")
                 GOTO outlexp180320023
               END IF 
             ELSE 
               codema% = 0
             END IF 
           ELSE 
             wks1% = Workstation%
             a% = SelectOffice%("BÅro-Auswahl","",1,wks1%)
             wkswahl% = a%
             IF wkswahl% = - 1 THEN 
               CALL Fehler("MS Outlook Export abgebrochen!","Sie haben kein BÅro ausgewÑhlt")
               GOTO outlexp180320023
             END IF 
           END IF 
            
         END IF 
       END IF 
       IF RECCOUNT (GAdrDat$) < 30000 THEN 
         REDIM ADRFound$( RECCOUNT (GAdrDat$))
       ELSE 
         REDIM ADRFound$(30000)
       END IF 
       FILE GAdrDat$
       INDEX fiimmak.GAdrDat$
       SELECT FIRST 
       SELECT KEY "j" FILE GAdrDat$ INDEX fiimmak.GAdrDat$
       a% = 0
       WHILE NOT EOF (GAdrDat$) AND fiimmak.GAdrDat$ = "j"
         IF codema% > 0 THEN 
           IF codema.GAdrDat$ = codema% THEN 
             SET STATUS "Exportiere " + nachname.GAdrDat$
 
             ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
             a% = a% + 1
           END IF 
         ELSE 
           IF GASP% THEN 
               IF wkswahl% = 0 THEN 
                 SET STATUS "Exportiere " + nachname.GAdrDat$
                 ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
                 a% = a% + 1
               ELSE 
                 sok% = - 1
                 wks% = wkswahl%
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                    wks% = VisOff%(ii%)
                    aa% = IsWksVisible%(wks%)
                    IF aa% = - 1 AND Workstation.GADRDat$ = wks% THEN 
                      sok% = - 1
                      ii% = VisCount%
                    ELSE 
                      sok% = 0
                    END IF 
                 NEXT ii%
                 IF sok% THEN 
                   SET STATUS "Exportiere " + nachname.GAdrDat$
                   ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
                   a% = a% + 1
                 END IF 
               END IF 
           ELSE 
             SET STATUS "Exportiere " + nachname.GAdrDat$
             ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
             a% = a% + 1
           END IF 
         END IF 
         SET STATUS STR$ (a%) + " Adressen gefunden"
         SELECT NEXT FILE GAdrDat$ INDEX fiimmak.GAdrDat$
       WEND 
       ADRFound$(a%) = ""
       REM CALL Fehler("","")
       CALL ExpOutlook()
     END IF 
outlexp180320023: 
     SELECT KEY kunr% FILE GADRDat$ INDEX codeku.GADRDat$
     MOUSE ON 
     SET STATUS ""
   CASE 23
     REM Kundenkonto
     knr% = codeku.GAdrDat$
     CALL DFile(3,"sparten" + _fpw$)
     CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
     CALL DFile(3,"maadr" + _fpw$)
     
     IF EXISTS (knr%,codeku.KUKTO) THEN 
       Kukn$ = TRIM$ (nachname.GAdrDat$) + ", " + TRIM$ (vorname.GAdrDat$)
       FILE "KUKTO"
       CALL KUKundkonto()
       FILE GAdrDat$
     ELSE 
       CALL Fehler("Es sind keine Kontoinformationen zu dieser Adresse vorhanden!","")
     END IF 
   CASE 24
   CASE 25
     REM Vermoegen-öbersicht
     IF EXISTS (knr%,codeku.VERMOEG) THEN 
       FILE "VERMOEG"
       CALL KUVermoeg()
       FILE GAdrDat$
     ELSE 
       REQUEST "Es sind keine Zahlungsein-/ausgÑnge der Vermîgensverwaltung","zu dieser Adresse vorhanden! Zahlung erfassen?",130,req%
       IF req% = 1 THEN 
         knr% = codeku.GAdrDat$
         CALL VermNeu(knr%)
         FILE "VERMOEG"
         CALL KUVermoeg()
         FILE GAdrDat$
       END IF 
     END IF 
   CASE 26
   CASE 27
   CASE 98
     CALL TelefonListe(CodeKU.GAdrDat$)
     IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
   CASE 99
     MOUSE OFF 
     okbearb% = - 1
     IF GADRDat$ LIKE "BCK*" THEN 
       IF disabled%("INTERESSENTNEW") THEN okbearb% = 0
     ELSE 
       IF disabled%("ADRBEARB") THEN okbearb% = 0
     END IF 
     IF okbearb% = - 1 THEN 
       IF title$ LIKE "*DEMO*" AND RECCOUNT (GAdrDat$) >= 10 THEN 
         CALL DemoInfo()
       ELSE 
         SELECT CASE PAGE 
         CASE 1
           MOUSE ON 
           GAnredADR$ = anrede.GAdrDat$
           GTitelADR$ = Titel.GAdrDat$
           GNachnameADR$ = Nachname.GAdrDat$
           GVornameADR$ = Vorname.GAdrDat$
           GGebname$ = Geburtsname.GAdrDat$
           GPLZADR$ = plz.GAdrDat$
           GStrasseADR$ = Stra·e.GAdrDat$
           GOrtADR$ = Ort.GAdrDat$
           GLandAdr$ = Land.GAdrDat$
           GGeburtstag% = Geburtstag.GADRDat$
           GBlz1$ = K1blz.GADRDat$
           GBLZ2$ = K2blz.GADRDat$
           GBLZ3$ = K3blz.GADRDat$
           GBank1$ = K1bank.GADRDat$
           GBank2$ = K2bank.GADRDat$
           GBank3$ = K3bank.GADRDat$
           GKonto1$ = K1Konto.GADRDat$
           GKonto2$ = K2Konto.GADRDat$
           GKonto3$ = K3Konto.GADRDat$
           GKontoinh1$ = Kontoinh1.GADRDat$
           GKontoinh2$ = Kontoinh2.GADRDat$
           GKontoinh3$ = Kontoinh3.GADRDat$
           GTelefon1$ = Telefon1.GADRDat$
           REM ENTER Kundennummer.GAdrDat$,0 ELSE ENTER anrede.GAdrDat$,0
           CALL ButDesabled()
           MOUSE OFF 
           IF _projekt$ LIKE "PROVIS" THEN 
             f.vsuch.enabled = 0
             REM f.vsuch.visible = 0
             f.statistik.enabled = 0
             f.zweitanschr.enabled = 0
             f.dok1.enabled = 0
             f.kukonto.enabled = 0
             f.vertraege.enabled = 0
             f.finanzen.enabled = 0
             f.finanzanalyse.enabled = 0
             f.sperre.enabled = 0
             f.drucken.enabled = 0
             IF nemany$ <> "TRUE" THEN 
               f.c1.enabled = 0
               f.c2.enabled = 0
               f.c3.enabled = 0
               f.c4.enabled = 0
               f.c5.enabled = 0
               f.c6.enabled = 0
               f.c7.enabled = 0
               f.c8.enabled = 0
               f.c9.enabled = 0
               f.c10.enabled = 0
               f.c11.enabled = 0
               f.c12.enabled = 0
             END IF 
             f.vorgang.enabled = 0
           END IF 
           IF _projekt$ <> "WAWI" THEN f.notiz.enabled = 0
           IF _projekt$ <> "AKTE" AND _projekt$ <> "WAWI" THEN 
             f.terminliste.enabled = 0
             f.termine.enabled = 0
             f.liste.enabled = 0
           REM f.vorgaenger.enabled = 0
           END IF 
           IF _projekt$ <> "AKTE" AND _projekt$ <> "WAWI" THEN f.Telefon.enabled = 0
           IF proserv$ = "TRUE" THEN 
             MENU OFF 
             SET EDIT SELECT ON 
             MOUSE ON 
             ENTER Kundennummer.GAdrDat$,0
             MOUSE OFF 
             SET EDIT SELECT OFF 
             MENU ON 
           ELSE 
             MENU OFF 
             SET EDIT SELECT ON 
               MOUSE ON 
               REM SELECT KEY codeku.GAdrDat$ LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
               IF GBerlimex% = - 1 THEN 
                 IF GADRDat$ LIKE "ADRESSEN" THEN 
                   IF _projekt$ LIKE "IMMAK" THEN 
                   ELSE 
                     f.k1.enabled = 0
                     f.k2.enabled = 0
                     f.k3.enabled = 0
                     f.k4.enabled = 0
                     f.eg.enabled = 0
                   END IF 
                 END IF 
                 IF _projekt$ LIKE "IMMAK" THEN 
                   ENTER Kundennummer.GAdrDat$,0
                 ELSE 
                   ENTER anrede.GAdrDat$,0
                 END IF 
                 IF GADRDat$ LIKE "ADRESSEN" THEN 
                   IF _projekt$ LIKE "IMMAK" THEN 
                   ELSE 
                     f.k1.enabled = - 1
                     f.k2.enabled = - 1
                     f.k3.enabled = - 1
                     f.k4.enabled = - 1
                     f.eg.enabled = - 1
                   END IF 
                 END IF 
               ELSE 
                 ENTER Kundennummer.GAdrDat$,0 ELSE ENTER anrede.GAdrDat$,0
               END IF 
               REM SELECT NEXT 
               REM SELECT PREVIOUS 
               MOUSE OFF 
             SET EDIT SELECT OFF 
             MENU ON 
           END IF 
           IF _projekt$ <> "WAWI" THEN f.notiz.enabled = - 1
           IF _projekt$ <> "AKTE" AND _projekt$ <> "WAWI" THEN 
             f.terminliste.enabled = - 1
             f.termine.enabled = - 1
             f.liste.enabled = - 1
             REM f.vorgaenger.enabled = - 1
           END IF 
           IF _projekt$ <> "AKTE" AND _projekt$ <> "WAWI" THEN f.Telefon.enabled = - 1
           IF _projekt$ LIKE "PROVIS" THEN 
             f.vsuch.enabled = - 1
             REM f.vsuch.visible = - 1
             f.zweitanschr.enabled = - 1
             f.vertraege.enabled = - 1
             f.finanzen.enabled = - 1
             IF GFinanzAnalyse% = - 1 THEN 
               f.finanzanalyse.enabled = - 1
             END IF 
             f.sperre.enabled = - 1
             f.drucken.enabled = - 1
             IF MAKLER$ = "TRUE" THEN 
               f.kukonto.enabled = - 1
             END IF 
             f.dok1.enabled = - 1
             IF nemany$ <> "TRUE" THEN 
               f.c1.enabled = - 1
               f.c2.enabled = - 1
               f.c3.enabled = - 1
               f.c4.enabled = - 1
               f.c5.enabled = - 1
               f.c6.enabled = - 1
               f.c7.enabled = - 1
               f.c8.enabled = - 1
               f.c9.enabled = - 1
               f.c10.enabled = - 1
               f.c11.enabled = - 1
               f.c12.enabled = - 1
             END IF 
             f.vorgang.enabled = - 1
           END IF 
           IF _projekt$ LIKE "FACTURA" THEN 
             f.s1.enabled = - 1
             f.s2.enabled = - 1
             f.s3.enabled = - 1
             f.s4.enabled = - 1
             f.s5.enabled = - 1
             f.s6.enabled = - 1
             f.tabellenansicht.enabled = - 1
             f.sperre.enabled = - 1
             f.drucken.enabled = - 1
             REM 020699 énderungen in reingang und rausgang
 
           END IF 
           REM 020699 énderungen in connect
           IF ProjectJN$ = "TRUE" THEN 
             REM 020699 énderungen in prconadr
           END IF 
           IF _projekt$ LIKE "PROVIS" THEN f.statistik.enabled = - 1
           CALL ButEnabled()
         CASE 2
           MOUSE ON 
           IF _projekt$ LIKE "PROVIS" OR _projekt$ LIKE "OFFICE" THEN 
             MENU OFF 
             GAnredADR$ = anrede.GAdrDat$
             GTitelADR$ = Titel.GAdrDat$
             GNachnameADR$ = Nachname.GAdrDat$
             GGebname$ = Geburtsname.GAdrDat$
             GVornameADR$ = Vorname.GAdrDat$
             GPLZADR$ = plz.GAdrDat$
             GStrasseADR$ = Stra·e.GAdrDat$
             GOrtADR$ = Ort.GAdrDat$
             GLandAdr$ = Land.GADRDat$
             GGeburtstag% = Geburtstag.GADRDat$
             GBlz1$ = K1blz.GADRDat$
             GBLZ2$ = K2blz.GADRDat$
             GBLZ3$ = K3blz.GADRDat$
             GBank1$ = K1bank.GADRDat$
             GBank2$ = K2bank.GADRDat$
             GBank3$ = K3bank.GADRDat$
             GKonto1$ = K1Konto.GADRDat$
             GKonto2$ = K2Konto.GADRDat$
             GKonto3$ = K3Konto.GADRDat$
             GKontoinh1$ = Kontoinh1.GADRDat$
             GKontoinh2$ = Kontoinh2.GADRDat$
             GKontoinh3$ = Kontoinh3.GADRDat$
             GTelefon1$ = Telefon1.GADRDat$
             REM SELECT CURRENT LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
             IF PAGE = 2 THEN 
               IF _projekt$ LIKE "PROVIS" THEN 
                 f.abbruch2.visible = - 1
                 f.abbruch2.enabled = - 1
               END IF 
               REM f.finanzen2.enabled = 0
               REM f.zurueck2.enabled = 0
               SET EDIT SELECT ON 
               MOUSE ON 
               IF stprÅf1$ LIKE "maxi*" THEN 
                 ENTER EGAnrede.GAdrDat$,0
               ELSE 
                 ENTER Stichwort.GAdrDat$
               END IF 
               MOUSE OFF 
               SET EDIT SELECT OFF 
               IF _projekt$ LIKE "PROVIS" THEN 
                 f.abbruch2.visible = 0
                 f.abbruch2.enabled = 0
                 f.finanzen2.enabled = - 1
                 f.zurueck2.enabled = - 1
               END IF 
             END IF 
             IF PAGE = 3 THEN 
               IF _projekt$ LIKE "PROVIS" THEN 
                 f.abbruch3.visible = - 1
                 f.abbruch3.enabled = - 1
               END IF 
               REM f.notiz3.enabled = 0
               REM f.zurueck3.enabled = 0
               SET EDIT SELECT ON 
               MOUSE ON 
               ENTER EinkKunde.GAdrDat$,0
               MOUSE OFF 
               SET EDIT SELECT OFF 
               IF _projekt$ LIKE "PROVIS" THEN 
                 f.abbruch3.visible = 0
                 f.abbruch3.enabled = 0
               END IF 
               f.notiz3.enabled = - 1
               f.zurueck3.enabled = - 1
 
             END IF 
             MENU ON 
           ELSE 
             IF _projekt$ LIKE "IMMAK" THEN 
               ENTER eganrede.adressen,0
             ELSE 
               MENU OFF 
               SET EDIT SELECT OFF 
               MOUSE ON 
               ENTER notiz.GAdrDat$,0
               MOUSE OFF 
               SET EDIT SELECT OFF 
               MENU ON 
             END IF 
           END IF 
         CASE 3
           MOUSE ON 
           IF _projekt$ LIKE "FACTURA" THEN 
             MOUSE ON 
             ENTER produktname.kprodukt,0
             MOUSE OFF 
           END IF 
           IF _projekt$ LIKE "PROVIS" OR _projekt$ LIKE "OFFICE" THEN 
             GAnredADR$ = anrede.GAdrDat$
             GTitelADR$ = Titel.GAdrDat$
             GNachnameADR$ = Nachname.GAdrDat$
             GGebname$ = Geburtsname.GAdrDat$
             GVornameADR$ = Vorname.GAdrDat$
             GPLZADR$ = plz.GAdrDat$
             GStrasseADR$ = Stra·e.GAdrDat$
             GOrtADR$ = Ort.GAdrDat$
             GLandADR$ = Land.Gadrdat$
             GGeburtstag% = Geburtstag.GADRDat$
             GBlz1$ = K1blz.GADRDat$
             GBLZ2$ = K2blz.GADRDat$
             GBLZ3$ = K3blz.GADRDat$
             GBank1$ = K1bank.GADRDat$
             GBank2$ = K2bank.GADRDat$
             GBank3$ = K3bank.GADRDat$
             GKonto1$ = K1Konto.GADRDat$
             GKonto2$ = K2Konto.GADRDat$
             GKonto3$ = K3Konto.GADRDat$
             GKontoinh1$ = Kontoinh1.GADRDat$
             GKontoinh2$ = Kontoinh2.GADRDat$
             GKontoinh3$ = Kontoinh3.GADRDat$
             GTelefon1$ = Telefon1.GADRDat$
             MENU OFF 
             IF _projekt$ LIKE "PROVIS" THEN 
               f.abbruch3.visible = - 1
               f.abbruch3.enabled = - 1
             END IF 
             REM f.notiz3.enabled = 0
             REM f.zurueck3.enabled = 0
             SET EDIT SELECT ON 
             MOUSE ON 
             ENTER EinkKunde.GAdrDat$,0
             MOUSE OFF 
             SET EDIT SELECT OFF 
             IF _projekt$ LIKE "PROVIS" THEN 
               f.abbruch3.visible = 0
               f.abbruch3.enabled = 0
             END IF 
             f.notiz3.enabled = - 1
             f.zurueck3.enabled = - 1
             MENU ON 
           END IF 
           IF _projekt$ LIKE "IMMAK" THEN 
             ENTER EinkKunde.adressen,0
           END IF 
         CASE 4
           GAnredADR$ = anrede.GAdrDat$
           GTitelADR$ = Titel.GAdrDat$
           GNachnameADR$ = Nachname.GAdrDat$
           GGebname$ = Geburtsname.GAdrDat$
           GVornameADR$ = Vorname.GAdrDat$
           GPLZADR$ = plz.GAdrDat$
           GStrasseADR$ = Stra·e.GAdrDat$
           GOrtADR$ = Ort.GAdrDat$
           GLandADR$ = Land.Gadrdat$
           GGeburtstag% = Geburtstag.GADRDat$
           GBlz1$ = K1blz.GADRDat$
           GBLZ2$ = K2blz.GADRDat$
           GBLZ3$ = K3blz.GADRDat$
           GBank1$ = K1bank.GADRDat$
           GBank2$ = K2bank.GADRDat$
           GBank3$ = K3bank.GADRDat$
           GKonto1$ = K1Konto.GADRDat$
           GKonto2$ = K2Konto.GADRDat$
           GKonto3$ = K3Konto.GADRDat$
           GKontoinh1$ = Kontoinh1.GADRDat$
           GKontoinh2$ = Kontoinh2.GADRDat$
           GKontoinh3$ = Kontoinh3.GADRDat$
           GTelefon1$ = Telefon1.GADRDat$
           MENU OFF 
           f.bearb4.visible = 0
           f.sichern4.visible = - 1
           f.zurueck4.visible = 0
           ENTER zweitanschrift.GADRDat$,0
           f.bearb4.visible = - 1
           f.sichern4.visible = 0
           f.zurueck4.visible = - 1
           MENU ON 
         END SELECT 
       END IF 
       IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) AND Nachname.GAdrDat$ <> "" AND abbruch% = 0 THEN 
         CALL QuickStore( FILE )
       ELSE 
         IF abbruch% = - 1 THEN 
           REM SELECT CURRENT LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
           FORM 
         END IF 
       END IF 
     END IF 
   CASE 100
       codeku% = codeku.GADRDat$
       CALL ADRNotiz(codeku.GAdrDat$)
       SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
   CASE 101
       codeku% = codeku.GADRDat$
       CALL ADRFin(codeku.GAdrDat$)
       SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
   CASE 102
       codeku% = codeku.GADRDat$
       CALL ADREG(codeku.GAdrDat$)
       SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
   CASE 103
       codeku% = codeku.GADRDat$
       CALL ADRConnect()
       SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
   CASE 104
       codeku% = codeku.GADRDat$
       CALL AgenturNeu()
       SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
   CASE 105
     IF NOT disabled%("KONTAKT") THEN 
       codeku% = codeku.GADRDat$
       CALL ADRConnect()
       SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
       IF FORM = adrmaske$ THEN CALL ADRFeldnamen()
     END IF 
   CASE 106
     CALL LastKontakt()
   CASE 107
     IF zeigenotiz$ = "Zeige die Notizen" THEN 
       f.shownotiz.visible = - 1
       f.shownotiz.enabled = - 1
       zeigenotiz$ = "Zeige die Adressdetails"
     ELSE 
       zeigenotiz$ = "Zeige die Notizen"
       f.shownotiz.visible = 0
       f.shownotiz.enabled = 0
     END IF 
   CASE 108
     IF NOT disabled%("ADRCHANGEMA") THEN 
       IF GASP% THEN 
         CALL AgenturNeu1()
       ELSE 
         CALL AgenturNeu()
       END IF 
     END IF 
   CASE 109
     CALL ErstKontakt()
   CASE 110
       REM Anzeige der Statistikseite
       co% = codeku.adressen
       REM CALLWriteINI(_projekt$,"LastAdress" + GAdrDat$, STR$ (Co%,"000000"))
       IF NOT disabled%("ADRSTATISTIK") THEN 
         REM FORM 5
         codeku% = codeku.adressen
         OPEN FORM GPrjForm$ + "STVADR"
         CALL MNProgramm()
         SELECT KEY codeku% FILE "adressen" INDEX codeku.adressen
         nam1$ = Nachname.adressen + "," + vorname.adressen
         FORM 
         _formend% = 0
         CALL ClearKBDBuffer()
         MENU ON 
         WHILE _formend% = 0
           ON ERROR GOTO ErrorHandler
           WAIT MOUSE OR KEY 
           IF k$ = CHR$ (27) THEN _formend% = 1
         WEND 
         _formend% = 0
       END IF 
       knr% = co%
   CASE 111
     IF zeigestamm$ = "Zeige das Stammblatt" THEN 
       f.showstamm.visible = - 1
       f.showstamm.enabled = - 1
       zeigestamm$ = "Zeige die Adressdetails"
     ELSE 
       zeigestamm$ = "Zeige das Stammblatt"
       f.showstamm.visible = 0
       f.showstamm.enabled = 0
     END IF 
   END SELECT 
   IF FORM = adrmaske$ THEN 
     
     IF GMFoAq% = 0 THEN CALL BMCheckMail()
     IF ADRSUB% = 0 THEN ADRSub% = 111111
   END IF 
 WEND 
 knr% = 0
 IF ddeadr% = 1 THEN 
   CALL Server("AdrOff","")
   DDETERM 98
 END IF 
 IF FileChanged%(GAdrDat$) = 1 THEN CALL QuickStore (GAdrDat$)
 _formend% = 0
 IF ProjectJN$ = "TRUE" THEN maxproz% = maxproz% - 1
 CALL WriteINI(_projekt$,"LastAdress" + GAdrDat$, STR$ (Codeku.GAdrDat$,"000000"))
 END SUB 
  
SUB AgenturNeu2()
 knr% = codeku.GAdrDat$
 IF MOD (GAdrDat$) OR NEW (GAdrDat$) THEN CALL QuickStore(GAdrDat$)
 prompt% = Codema.GAdrDat$
 codema% = GetCodeMA%(prompt%,Workstation%)
 IF codema% > 0 THEN 
   SELECT KEY knr% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
   codema2.GAdrDat$ = codema%
   Agentur2.GADRDat$ = Nachname.maadr + "," + Vorname.maadr
   Agenturnr2.GADRDat$ = Agenturnr.maadr
   CALL QuickStore(GAdrDat$)
   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
   agent2$ = LTRIM$ (Nachname.maadr) + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   FORM 
 ELSE 
   IF GASP% <> - 1 THEN 
     SELECT KEY knr% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
     codema2.GAdrDat$ = 0
     CALL QuickStore(GAdrDat$)
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     agent2$ = LTRIM$ (Nachname.maadr) + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
     FORM 
   END IF 
 END IF 
 END SUB 



SUB LastKontakt()
 REQUEST "Mîchten Sie das Datum wirklich auf den heutigen Tag setzen?","",130,req%
 IF req% <> 1 THEN END SUB 
 codeku% = codeku.GAdrDat$
 SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
 letzter_kontakt.GAdrDat$ = TODAY 
 STORE FILE GAdrDat$
 UNLOCK CURRENT FILE GAdrDat$
 UNLOCK FILE GAdrDat$
 lastkont$ = DATE$ (letzter_kontakt.GAdrDat$,"0d.mm.yyyy")
 FORM 
 END SUB 
 
 
SUB ErstKontakt()
 REQUEST "Mîchten Sie das Datum wirklich auf den heutigen Tag setzen?","",130,req%
 IF req% <> 1 THEN END SUB 
 codeku% = codeku.GAdrDat$
 SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
 Erstkontakt.GAdrDat$ = TODAY 
 STORE FILE GAdrDat$
 UNLOCK CURRENT FILE GAdrDat$
 UNLOCK FILE GAdrDat$
 REM lastkont$ = DATE$ (letzter_kontakt.GAdrDat$,"0d.mm.yyyy")
 FORM 
 END SUB 
 

 
 ' Routinen fÅr Bewegung durch Datei
 ' ======================================================================
 ' ersetzt durch SB-interne Prozeduraufrufe
 
  
SUB ADRNext()
 SELECT WHERE FILE GTelDat$
 filtbutadr1$ = "Filter: ohne"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY vcodema% FILE "supervis" INDEX codema.supervis
 MOUSE OFF 
 IF GASP% AND Workstation% > 0 THEN 
   MOUSE OFF 
   CALL PSelectNextA()
   MOUSE OFF 
   'Jan: neu ---------------
   SELECT FORM KEY CodeKu.GADRDat$ FILE GTELDat$ INDEX CodeKU.GTELDat$
   SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.GADRDat$) + ")"
   'Jan ende ---------------   
 ELSE 
   MOUSE OFF 
        sok% = 0
        codeku% = codeku.GADRDat$
        SELECT NEXT FILE GADRDat$
        locktest% = MNdisabled%("DATALOCK")
        WHILE NOT EOF (GADRDat$) AND sok% = 0
          MOUSE OFF 
          IF GMASuperCount% > 0 THEN 
            IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN 
              SELECT NEXT FILE GADRDat$
              MOUSE OFF 
              SET STATUS "Suche Ihre nÑchste Adresse"
            ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT NEXT FILE GADRDat$
            END IF 
          ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT NEXT FILE GADRDat$
          END IF 
        WEND 
       IF sok% = 0 THEN 
         CALL ADRFirst()
       END IF 
   MOUSE OFF 
 END IF 
 MOUSE OFF 
 codeku% = codeku.GADRDat$
 knr% = Codeku.GADRDat$
 CALL ADRIntro()
 CALL ADRFeldnamen()
 SELECT FORM KEY knr% FILE GTELDat$ INDEX CodeKU.GTELDat$
 MOUSE OFF 
 FORM 
 MOUSE ON 
 END SUB 
 
SUB ADRPrev()
 SELECT WHERE FILE GTelDat$
 filtbutadr1$ = "Filter: ohne"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY vcodema% FILE "supervis" INDEX codema.supervis
 MOUSE OFF 
 IF GASP% AND Workstation% > 0 THEN 
   MOUSE OFF 
   CALL PSelectPrevA()
   MOUSE OFF 
   'Jan: neu ---------------
   SELECT FORM KEY CodeKu.GADRDat$ FILE GTELDat$ INDEX CodeKU.GTELDat$
   SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.GADRDat$) + ")"
   'Jan ende ---------------   
 ELSE 
   MOUSE OFF 
        sok% = 0
        codeku% = codeku.GADRDat$
        SELECT PREVIOUS FILE GADRDat$
        locktest% = MNdisabled%("DATALOCK")
        WHILE NOT EOF (GADRDat$) AND sok% = 0
          IF GMASuperCount% > 0 THEN 
            IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN 
              SELECT PREVIOUS FILE GADRDat$
            ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT PREVIOUS FILE GADRDat$
            END IF 
          ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT PREVIOUS FILE GADRDat$
          END IF 
        WEND 
        IF sok% = 0 THEN 
          CALL ADRFirst()
        END IF 
 MOUSE OFF 
 END IF 
 MOUSE OFF 
 knr% = Codeku.GADRDat$
 CALL ADRIntro()
 CALL ADRFeldnamen()
 SELECT FORM KEY knr% FILE GTELDat$ INDEX CodeKU.GTELDat$
 MOUSE OFF 
 FORM 
 MOUSE ON 
 END SUB 
 
SUB ADRFirst()
 IF FileChanged%(GAdrDat$) = 1 THEN CALL FStore(GAdrDat$)
 SELECT WHERE FILE GTelDat$
 filtbutadr1$ = "Filter: ohne"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY vcodema% FILE "supervis" INDEX codema.supervis
 IF GASP% AND Workstation% > 0 THEN 
   CALL PSelectFirstA()
   'Jan: neu ---------------
   SELECT FORM KEY CodeKu.GADRDat$ FILE GTELDat$ INDEX CodeKU.GTELDat$
   SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.GADRDat$) + ")"
   'Jan ende ---------------   

 REM ************************************************************************************************************************************************************
 
        sok% = 0
        REM SELECT FIRST FILE GADRDat$
        locktest% = MNdisabled%("DATALOCK")
        WHILE NOT EOF (GADRDat$) AND sok% = 0
          IF GMASuperCount% > 0 THEN 
            IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN 
              SELECT NEXT FILE GADRDat$
            ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT NEXT FILE GADRDat$
            END IF 
          ELSE 
            sok% = - 1
            IF locktest% THEN 
              IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
            END IF 
            IF sok% = 0 THEN SELECT NEXT FILE GADRDat$
          END IF 
        WEND 
        IF sok% = 0 THEN 
          CALL Fehler("Es wurde noch keine Adresse fÅr Sie erfa·t!","Sie haben jetzt die Mîglichkeit eine neue Adresse zu erfassen!")
          REM CALL ADRNeu()
          BLANK FILE GAdrDat$
          SET STATUS "Datensatz neu angelegt..."
          CodeKU% = SER (GAdrDat$,1)
          Nachname.GADRDat$ = "Neu"
          CodeKU.GAdrDat$ = codeku%
          EXPInternet.GADRDat$ = "j"
          Workstation.GADRDat$ = workstation%
          IF GMASuperCount% > 0 THEN 
            codema1% = GMASuper%(0)
          ELSE 
            SELECT FIRST FILE "maadr" INDEX workstation.maadr
            SELECT KEY workstation% FILE "maadr" INDEX workstation.maadr
            codema1% = codema.maadr
          END IF 
          codema.GADRDat$ = codema1%
          Erstkontakt.GADRDat$ = TODAY 
          ADRStatus.GAdrDat$ = "<OHNE ZUORDNUNG>"
          ADRGruppe.GAdrDat$ = "<OHNE ZUORDNUNG>"
          IF GADRDat$ LIKE "ADRESSEN" THEN 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
            REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LastKunr.stamm + 1
            LastKunr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (KUNRPREFIX.stamm)
          ELSE 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LAST" + GADRDAT$)) + 1
            REM CALL WriteConfig("NUMMERN","LAST" + GADRDAT$, LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LASTIntnr.stamm + 1
            LastIntnr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (IntPREFIX.stamm)
          END IF 
          Kundennummer.GAdrDat$ = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
          IF GASP% THEN 
            Kundennummer.ADRESSEN = prefix$ + LTRIM$ ( STR$ (workstation%,"000")) + "-" + LTRIM$ ( STR$ (nnum%,"9999999999"))
          END IF 
          Debitorkto.GAdrDat$ = LTRIM$ ( STR$ (nnum%,"999999"))
          AAKunde.GAdrDat$ = "j"
          AAMakler.GAdrDat$ = "n"
          AAMitarbeiter.GAdrDat$ = "n"
          AAInteressent.GAdrDat$ = "n"
          AALieferant.GAdrDat$ = "n"
          FIPrivat.GAdrDat$ = "n"
          FIATEC.GAdrDat$ = "j"
          FIIMMAK.GAdrDat$ = "n"
          zero.GAdrDat$ = 0
          QNachname.GAdrDat$ = "NEU"
          BerProtok.GADRDat$ = "n"
          STORE FILE GAdrDat$
        END IF 
 REM ************************************************************************************************************************************************************
 


 ELSE 
   REM IF GMASuperCount% > 0 THEN 
        sok% = 0
        SELECT FIRST FILE GADRDat$
        locktest% = MNdisabled%("DATALOCK")
        WHILE NOT EOF (GADRDat$) AND sok% = 0
          IF GMASuperCount% > 0 THEN 
            IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN 
              SELECT NEXT FILE GADRDat$
              MOUSE OFF 
              SET STATUS "Suche Ihre nÑchste Adresse"
            ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT NEXT FILE GADRDat$
            END IF 
          ELSE 
            sok% = - 1
            IF locktest% THEN 
              IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
            END IF 
            IF sok% = 0 THEN SELECT NEXT FILE GADRDat$
          END IF 
        WEND 
        IF sok% = 0 THEN 
          CALL Fehler("Es wurde noch keine Adresse fÅr Sie erfa·t!","Sie haben jetzt die Mîglichkeit eine neue Adresse zu erfassen!")
          REM CALL ADRNeu()
          BLANK FILE GAdrDat$
          SET STATUS "Datensatz neu angelegt..."
          CodeKU% = SER (GAdrDat$,1)
          Nachname.GADRDat$ = "Neu"
          CodeKU.GAdrDat$ = codeku%
          EXPInternet.GADRDat$ = "j"
          Workstation.GADRDat$ = workstation%
          IF GMASuperCount% > 0 THEN 
            codema1% = GMASuper%(0)
          ELSE 
            SELECT FIRST FILE "maadr" INDEX workstation.maadr
            SELECT KEY workstation% FILE "maadr" INDEX workstation.maadr
            codema1% = codema.maadr
          END IF 
          codema.GADRDat$ = codema1%
          Erstkontakt.GADRDat$ = TODAY 
          ADRStatus.GAdrDat$ = "<OHNE ZUORDNUNG>"
          ADRGruppe.GAdrDat$ = "<OHNE ZUORDNUNG>"
          IF GADRDat$ LIKE "ADRESSEN" THEN 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
            REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LastKunr.stamm + 1
            LastKunr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (KUNRPREFIX.stamm)
          ELSE 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LAST" + GADRDAT$)) + 1
            REM CALL WriteConfig("NUMMERN","LAST" + GADRDAT$, LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LASTIntnr.stamm + 1
            LastIntnr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (IntPREFIX.stamm)
          END IF 
          Kundennummer.GAdrDat$ = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
          IF GASP% THEN 
            Kundennummer.ADRESSEN = prefix$ + LTRIM$ ( STR$ (workstation%,"000")) + "-" + LTRIM$ ( STR$ (nnum%,"9999999999"))
          END IF 
          Debitorkto.GAdrDat$ = LTRIM$ ( STR$ (nnum%,"999999"))
          AAKunde.GAdrDat$ = "j"
          AAMakler.GAdrDat$ = "n"
          AAMitarbeiter.GAdrDat$ = "n"
          AAInteressent.GAdrDat$ = "n"
          AALieferant.GAdrDat$ = "n"
          FIPrivat.GAdrDat$ = "n"
          FIATEC.GAdrDat$ = "j"
          FIIMMAK.GAdrDat$ = "n"
          zero.GAdrDat$ = 0
          QNachname.GAdrDat$ = "NEU"
          BerProtok.GADRDat$ = "n"
          STORE FILE GAdrDat$
        END IF 


   REM ELSE 
    REM  CALL PSelectFirst()
   REM END IF 
 END IF 
 knr% = Codeku.GADRDat$
 CALL ADRIntro()
 CALL ADRFeldnamen()
 SELECT FORM KEY knr% FILE GTELDat$ INDEX CodeKU.GTELDat$
 FORM 
 END SUB 
 
SUB ADRLast()
 IF FileChanged%(GAdrDat$) = 1 THEN CALL FStore(GAdrDat$)
 SELECT WHERE FILE GTelDat$
 filtbutadr1$ = "Filter: ohne"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY vcodema% FILE "supervis" INDEX codema.supervis
 IF GASP% AND Workstation% > 0 THEN 
   CALL PSelectLastA()
   'Jan: neu ---------------
   SELECT FORM KEY CodeKu.GADRDat$ FILE GTELDat$ INDEX CodeKU.GTELDat$
   SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.GADRDat$) + ")"
   'Jan ende ---------------   
 ELSE 
   REM CALL PSelectLast()
        locktest% = MNdisabled%("DATALOCK")
        sok% = 0
        WHILE NOT EOF (GADRDat$) AND sok% = 0
          IF GMASuperCount% > 0 THEN 
            IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN 
              SELECT PREVIOUS FILE GADRDat$
            ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT PREVIOUS FILE GADRDat$
            END IF 
          ELSE 
              sok% = - 1
              IF locktest% THEN 
                IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
              END IF 
              IF sok% = 0 THEN SELECT PREVIOUS FILE GADRDat$
          END IF 
        WEND 
        IF sok% = 0 THEN 
          CALL Fehler("Es wurde noch keine Adresse fÅr Sie erfa·t!","Sie haben jetzt die Mîglichkeit eine neue Adresse zu erfassen!")
          REM CALL ADRNeu()
          BLANK FILE GAdrDat$
          SET STATUS "Datensatz neu angelegt..."
          CodeKU% = SER (GAdrDat$,1)
          Nachname.GADRDat$ = "Neu"
          CodeKU.GAdrDat$ = codeku%
          EXPInternet.GADRDat$ = "j"
          Workstation.GADRDat$ = workstation%
          IF GMASuperCount% > 0 THEN 
            codema1% = GMASuper%(0)
          ELSE 
            SELECT FIRST FILE "maadr" INDEX workstation.maadr
            SELECT KEY workstation% FILE "maadr" INDEX workstation.maadr
            codema1% = codema.maadr
          END IF 
          codema.GADRDat$ = codema1%
          Erstkontakt.GADRDat$ = TODAY 
          ADRStatus.GAdrDat$ = "<OHNE ZUORDNUNG>"
          ADRGruppe.GAdrDat$ = "<OHNE ZUORDNUNG>"
          IF GADRDat$ LIKE "ADRESSEN" THEN 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
            REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LastKunr.stamm + 1
            LastKunr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (KUNRPREFIX.stamm)
          ELSE 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LAST" + GADRDAT$)) + 1
            REM CALL WriteConfig("NUMMERN","LAST" + GADRDAT$, LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LASTIntnr.stamm + 1
            LastIntnr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (IntPREFIX.stamm)
          END IF 
          Kundennummer.GAdrDat$ = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
          IF GASP% THEN 
            Kundennummer.ADRESSEN = prefix$ + LTRIM$ ( STR$ (workstation%,"000")) + "-" + LTRIM$ ( STR$ (nnum%,"9999999999"))
          END IF 
          Debitorkto.GAdrDat$ = LTRIM$ ( STR$ (nnum%,"999999"))
          AAKunde.GAdrDat$ = "j"
          AAMakler.GAdrDat$ = "n"
          AAMitarbeiter.GAdrDat$ = "n"
          AAInteressent.GAdrDat$ = "n"
          AALieferant.GAdrDat$ = "n"
          FIPrivat.GAdrDat$ = "n"
          FIATEC.GAdrDat$ = "j"
          FIIMMAK.GAdrDat$ = "n"
          zero.GAdrDat$ = 0
          BerProtok.GADRDat$ = "n"
          QNachname.GAdrDat$ = "NEU"
          STORE FILE GAdrDat$
        END IF 
 
 
   REM ELSE 
    REM  CALL PSelectLast()
   REM END IF 
 END IF 
 knr% = Codeku.GADRDat$
 MOUSE OFF 
 CALL ADRIntro()
 CALL ADRFeldnamen()
 SELECT FORM KEY knr% FILE GTELDat$ INDEX CodeKU.GTELDat$
 FORM 
 END SUB 
 
 
 'Jan: neu ---------------   
SUB PSelectNextA()
    MOUSE OFF 
    SET STATUS "NÑchster Datensatz wird gesucht..."
    cfile$ = FILE 
    typ$ = GetFileTyp$(cfile$)
    tempFilialNr% = ShowOther%
    IF typ$ = "Y" THEN 'nur die eigenen Daten sind sichtbar (z.B. SUPERVIS)
        ShowOther% = Workstation%
    END IF 
 
 'Aktuellen Datensatz merken
    code$ = GetFileCode$(cfile$) + "." + cfile$
    codekey% = code$$
    codemaField$ = "codema." + cfile$
    succ% = 0'initial: keinen nÑchsten Datensatz gefunden
      locktest% = MNdisabled%("DATALOCK")
      WHILE succ% = 0 AND NOT EOF (cfile$)
        MOUSE OFF 
        IF succ% = 0 THEN 
            SELECT NEXT FILE cfile$
        END IF 
 
        REM 25102002 IF (IsWksVisible%(Workstation.cfile$) = - 1 OR codemaField$$ = 0) AND NOT EOF (cfile$) THEN 
        IF (IsWksVisible%(Workstation.cfile$) = - 1) AND NOT EOF (cfile$) THEN 
            
            IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
              succ% = - 1
            ELSE 
                SELECT CASE UCASE$ (cfile$)
                    CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        REM a$ = codemafield$$
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.cfile$ > 0))
                    ELSE CASE 
                        succ% = - 1
                END SELECT 
            END IF 
        END IF 
        IF cfile$ LIKE "ADRESSEN" THEN 
          IF locktest% THEN 
            IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN succ% = 0
          END IF 
          IF GMASuperCount% > 0 THEN 
            IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN succ% = 0
          END IF 
        END IF 
      WEND 
    IF succ% = - 1 THEN 
        FORM 
    ELSE 
        'wieder zurÅckspringen
          SELECT FIRST FILE cfile$ INDEX code$$
          SELECT KEY codekey% FILE cfile$ INDEX code$$
          SET INDEX INDEX 
          REQUEST "Letzter Datensatz","",2
    END IF 
 
    ShowOther% = tempFilialNr%
    SET STATUS "Bereit"
    MOUSE ON 
 
 END SUB 
 'Jan ende --------------- 
 
 'EXECUTE "SELECT FORM NEXT"
 'IF EOF (cfile$) THEN REQUEST "Letzter Datensatz","",2
 'ws% = Workstation.cfile$
 'IF cfile$ LIKE "GEADR*" OR cfile$ LIKE "Spart*" THEN 
 'ELSE 
 '  'IF disabled%("DATALOCK") OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0) THEN 
 '  'Jan: modi -----------------------
 '   IF disabled%("DATALOCK") OR (IsWksVisible%(Workstation.cfile$) <> - 1) THEN 
 '  'Jan ende -----------------------
 '
 '    REM -- öberspringen gesperrter DatensÑtze --
 '    i% = 0
 '    MOUSE OFF 
 '    'WHILE (Sperre.cfile$ <> "" AND Sperre.cfile$ <> vcodema$) AND NOT EOF (cfile$) OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0)
 '    'Jan: modi ----------------------
 '    WHILE (Sperre.cfile$ <> "" AND Sperre.cfile$ <> vcodema$) AND NOT EOF (cfile$) OR (IsWksVisible%(Workstation.cfile$) <> - 1)
 '    'Jan ende -----------------------
 '      EXECUTE "SELECT FORM NEXT "
 '      IF EOF (cfile$) THEN 
 '        SELECT CASE UCASE$ (cfile$)
 '        CASE "MAADR"
 '          SELECT KEY "<ohne Zuordnung>" FILE "maadr" INDEX nachname.maadr
 '        END SELECT 
 '        IF i% = 0 THEN 
 '          IF UCASE$ (cfile$) <> GAkquiDat$ THEN REQUEST "Letzter Datensatz","",2
 '        ELSE 
 '          SELECT KEY Workstation% FILE cfile$ INDEX workstation.cfile$
 '        END IF 
 '      END IF 
 '      i% = i% + 1
 '    WEND 
 '  END IF 
 'END IF 
 'SET STATUS "Bereit"
 'MOUSE ON 
 'FORM 
 'END SUB 
 
 
 'Jan: neu ---------------  
SUB PSelectPrevA()
    
    MOUSE OFF 
    SET STATUS "Vorheriger Datensatz wird gesucht..."
    cfile$ = FILE 
    typ$ = GetFileTyp$(cfile$)
    tempFilialNr% = ShowOther%
    IF typ$ = "Y" THEN 'nur die eigenen Daten sind sichtbar (z.B. SUPERVIS)
        ShowOther% = Workstation%
    END IF 
 'Aktuellen Datensatz merken
    code$ = GetFileCode$(cfile$) + "." + cfile$
    codekey% = code$$
    codemaField$ = "codema." + cfile$
    succ% = 0'initial: keinen nÑchsten Datensatz gefunden
      locktest% = MNdisabled%("DATALOCK")
      WHILE succ% = 0 AND NOT EOF (cfile$)
 
        IF succ% = 0 THEN 
            SELECT PREVIOUS FILE cfile$
        END IF 
 
        REM 25102002 IF (IsWksVisible%(Workstation.cfile$) = - 1 OR codemaField$$ = 0) AND NOT EOF (cfile$) THEN 
        IF (IsWksVisible%(Workstation.cfile$) = - 1) AND NOT EOF (cfile$) THEN 
            
            IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
              succ% = - 1
            ELSE 
                SELECT CASE UCASE$ (cfile$)
                    CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.cfile$ > 0))
                    ELSE CASE 
                        succ% = - 1
                END SELECT 
            END IF 
        END IF 
        IF cfile$ LIKE "ADRESSEN" THEN 
          IF locktest% THEN 
            IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN succ% = 0
          END IF 
          IF GMASuperCount% > 0 THEN 
            IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN succ% = 0
          END IF 
        END IF 
      WEND 
    IF succ% = - 1 THEN 
        FORM 
    ELSE 
        'wieder zurÅckspringen
        SELECT FIRST FILE cfile$ INDEX code$$
        SELECT KEY codekey% FILE cfile$ INDEX code$$
        SET INDEX INDEX 
        REQUEST "Erster Datensatz","",2
    END IF 
 
    ShowOther% = tempFilialNr%
    SET STATUS "Bereit"
    MOUSE ON 
 
 END SUB 
 'Jan ende --------------- 
 
 'SUB PSelectPrev()
 ' MOUSE OFF 
 ' cfile$ = FILE 
 ' ON ERROR GOTO ErrorHandler
 ' SET STATUS "Vorheriger Datensatz wird gesucht..."
 ' EXECUTE "SELECT FORM PREVIOUS"
 ' IF EOF (cfile$) THEN REQUEST "Erster Datensatz","",2
 ' 
 ' 'IF disabled%("DATALOCK") OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0) THEN 
 ' 'Jan: modi -----------------------
 ' IF disabled%("DATALOCK") OR (IsWksVisible%(Workstation.cfile$) <> - 1) THEN 
 ' 'Jan ende ----------------------- 
 '   REM -- öberspringen gesperrter DatensÑtze --
 '   cfile$ = FILE 
 '   i% = 0
 '   'WHILE (Sperre.cfile$ <> 0 AND Sperre.cfile$ <> vcodema$) AND NOT EOF (cfile$) OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0)
 '   'Jan: modi ----------------------
 '   WHILE (Sperre.cfile$ <> "" AND Sperre.cfile$ <> vcodema$) AND NOT EOF (cfile$) OR (IsWksVisible%(Workstation.cfile$) <> - 1)
 '   'Jan ende ----------------------- 
 '     EXECUTE "SELECT FORM PREVIOUS"
 '     IF EOF (cfile$) THEN 
 '       SELECT CASE UCASE$ (cfile$)
 '       CASE "MAADR"
 '         SELECT KEY "<ohne Zuordnung>" FILE "maadr" INDEX nachname.maadr
 '       END SELECT 
 '       IF i% = 0 THEN 
 '         IF UCASE$ (cfile$) <> GAkquiDat$ THEN REQUEST "Erster Datensatz","",2
 '       ELSE 
 '         SELECT KEY Workstation% FILE cfile$ INDEX workstation.cfile$
 '       END IF 
 '       i% = i% + 1
 '     END IF 
 '   WEND 
 '' END IF 
 ' SET STATUS "Bereit"
 ' MOUSE ON 
 ' FORM 
 'END SUB 
 
 
 
 
 'Jan: neu -------------------  
SUB PSelectFirstA()
    REM CALL Fehler("PSelectFirstA","")
    MOUSE OFF 
    SET STATUS "Erster Datensatz wird gesucht..."
    'zum ersten (sichtbaren) Datensatz Åberhaupt gehen
    IF jaDebug% = - 1 THEN CALL Fehler("PSelectFirst: " + FILE ,"")
    cfile$ = FILE 
    typ$ = GetFileTyp$(cfile$)
    tempFilialNr% = ShowOther%
    IF typ$ = "Y" THEN 'nur die eigenen Daten sind sichtbar (z.B. SUPERVIS)
        ShowOther% = Workstation%
    END IF 
    code$ = GetFileCode$(cfile$) + "." + cfile$
    codekey% = code$$
 
    SELECT FIRST FILE FILE INDEX code$$
    MOUSE OFF 
    IF IsWksVisible%(Workstation.cfile$) <> - 1 THEN 
        REM CALL PSelectNext()
        sok% = 0
        WHILE NOT EOF (GADRDat$) AND sok% = 0
          REM IF workstation.cfile$ = 83 THEN CALL Fehler("83","")
          IF IsWksVisible%(Workstation.cfile$) <> - 1 THEN 
            SELECT NEXT FILE FILE INDEX code$$
          ELSE 
            sok% = - 1
          END IF 
        WEND 
        IF sok% = 0 THEN 
          CALL Fehler("Es wurde noch keine Adresse fÅr Sie erfa·t!","Sie haben jetzt die Mîglichkeit eine neue Adresse zu erfassen!")
          REM CALL ADRNeu()
          BLANK FILE GAdrDat$
          SET STATUS "Datensatz neu angelegt..."
          CodeKU% = SER (GAdrDat$,1)
          Nachname.GADRDat$ = "Neu"
          CodeKU.GAdrDat$ = codeku%
          EXPInternet.GADRDat$ = "j"
          Workstation.GADRDat$ = workstation%
          IF GMASuperCount% > 0 THEN 
            codema1% = GMASuper%(0)
          ELSE 
            SELECT FIRST FILE "maadr" INDEX workstation.maadr
            SELECT KEY workstation% FILE "maadr" INDEX workstation.maadr
            codema1% = codema.maadr
          END IF 
          codema.GADRDat$ = codema1%
          Erstkontakt.GADRDat$ = TODAY 
          ADRStatus.GAdrDat$ = "<OHNE ZUORDNUNG>"
          ADRGruppe.GAdrDat$ = "<OHNE ZUORDNUNG>"
          IF GADRDat$ LIKE "ADRESSEN" THEN 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
            REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LastKunr.stamm + 1
            LastKunr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (KUNRPREFIX.stamm)
          ELSE 
            REM nnum% = VAL (ReadConfig$("NUMMERN","LAST" + GADRDAT$)) + 1
            REM CALL WriteConfig("NUMMERN","LAST" + GADRDAT$, LTRIM$ ( STR$ (nnum%,"999999")))
            SELECT FIRST LOCK FILE "stamm"
            nnum% = LASTIntnr.stamm + 1
            LastIntnr.stamm = nnum%
            STORE FILE "Stamm"
            UNLOCK CURRENT FILE "stamm"
            SELECT FIRST FILE "Stamm"
            prefix$ = LTRIM$ (IntPREFIX.stamm)
          END IF 
          Kundennummer.GAdrDat$ = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
          IF GASP% THEN 
            Kundennummer.ADRESSEN = prefix$ + LTRIM$ ( STR$ (workstation%,"000")) + "-" + LTRIM$ ( STR$ (nnum%,"9999999999"))
          END IF 
          Debitorkto.GAdrDat$ = LTRIM$ ( STR$ (nnum%,"999999"))
          AAKunde.GAdrDat$ = "j"
          AAMakler.GAdrDat$ = "n"
          AAMitarbeiter.GAdrDat$ = "n"
          AAInteressent.GAdrDat$ = "n"
          AALieferant.GAdrDat$ = "n"
          FIPrivat.GAdrDat$ = "n"
          FIATEC.GAdrDat$ = "j"
          FIIMMAK.GAdrDat$ = "n"
          zero.GAdrDat$ = 0
          QNachname.GAdrDat$ = "NEU"
          BerProtok.GADRDat$ = "n"
          STORE FILE GAdrDat$
        END IF 
    ELSE 
        FORM 
    END IF 
    MOUSE ON 
    ShowOther% = tempFilialNr%
    SET STATUS "Bereit"
    MOUSE ON 
 END SUB 
 'Jan ende -------------------  
 
 'MOUSE OFF 
 'cfile$ = FILE 
 'EXECUTE "SELECT FORM FIRST "
 'IF disabled%("DATALOCK") OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0) THEN 
 '  REM -- öberspringen gesperrter DatensÑtze --
 '  cfile$ = FILE 
 '  i% = 0
 '  WHILE (Sperre.cfile$ <> 0 AND Sperre.cfile$ <> vcodema$) AND NOT EOF (cfile$) OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0)
 '    EXECUTE "SELECT FORM NEXT "
 '    IF EOF (cfile$) THEN 
 '      SELECT CASE UCASE$ (cfile$)
 '      CASE "MAADR"
 '        SELECT KEY "<ohne Zuordnung>" FILE "maadr" INDEX nachname.maadr
 '      END SELECT 
 '      IF UCASE$ (cfile$) <> GAkquiDat$ AND i% < 1 THEN REQUEST "Erster Datensatz","",2
 '      IF i% > 0 THEN 
 '        SELECT KEY workstation% FILE cfile$ INDEX workstation.cfile$
 '      END IF 
 '      i% = i% + 1
 '    END IF 
 '  WEND 
 'END IF 
 'MOUSE ON  
 
 'Jan: neu ------------------- 
SUB PSelectLastA()
 
    'zum letzten (sichtbaren) Datensatz Åberhaupt gehen
    MOUSE OFF 
    SET STATUS "Letzter Datensatz wird gesucht..."
    IF jaDebug% = - 1 THEN CALL Fehler("PSelectLast: " + FILE ,"")
    cfile$ = FILE 
    typ$ = GetFileTyp$(cfile$)
    tempFilialNr% = ShowOther%
    IF typ$ = "Y" THEN 'nur die eigenen Daten sind sichtbar (z.B. SUPERVIS)
        ShowOther% = Workstation%
    END IF 
    code$ = GetFileCode$(cfile$) + "." + cfile$
    codekey% = code$$
 
    SELECT LAST FILE FILE INDEX code$$
 
    IF IsWksVisible%(Workstation.cfile$) <> - 1 THEN 
        CALL PSelectPrev()
    ELSE 
        FORM 
    END IF 
    ShowOther% = tempFilialNr%
    SET STATUS "Bereit"
    MOUSE ON 
 
 END SUB 
 'Jan ende -------------------   
 
 'MOUSE OFF 
 'cfile$ = FILE 
 'EXECUTE "SELECT FORM LAST"
 'IF disabled%("DATALOCK") OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0) THEN 
 '  REM -- öberspringen gesperrter DatensÑtze --
 '  cfile$ = FILE 
 '  i% = 0
 '  WHILE (Sperre.cfile$ <> 0 AND Sperre.cfile$ <> vcodema$) AND NOT EOF (cfile$) OR (Workstation.cfile$ <> Workstation% AND Workstation% > 0)
 '    EXECUTE "SELECT FORM PREVIOUS "
 '    IF EOF (cfile$) THEN 
 '      SELECT CASE UCASE$ (cfile$)
 '      CASE "MAADR"
 '        SELECT KEY "<ohne Zuordnung>" FILE "maadr" INDEX nachname.maadr
 '      END SELECT 
 '      IF i% < 1 THEN 
 '        IF UCASE$ (cfile$) <> GAkquiDat$ AND i% < 1 THEN REQUEST "Erster Datensatz","",2
 '      ELSE 
 '        SELECT KEY workstation% FILE cfile$ INDEX workstation.cfile$
 '      END IF 
 '      i% = i% + 1
 '    END IF 
 '  WEND 
 'END IF 
 'MOUSE ON   
 
 
 
 ' Intro
 ' ======================================================================
 
SUB ADRIntro()
 MOUSE OFF 
 IF GFinanzAnalyse% = - 1 THEN 
   CALL DFile(2,"ANALYSE\" + "FINVGES" + _fpw$)
 END IF 
 IF RECCOUNT (GAdrDat$) < 1 THEN 
   BLANK FILE GAdrDat$
   codeku% = SER (GAdrDat$,1)
   codeku.GAdrDat$ = codeku%
   nachname.GAdrDat$ = "NEU"
   IF GADRDat$ LIKE "ADRESSEN" THEN 
     REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
     REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LastKunr.stamm + 1
       LastKunr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (KUNRPREFIX.stamm)
   ELSE 
       REM nnum% = VAL (ReadConfig$("NUMMERN","LAST" + GADRDAT$)) + 1
       REM CALL WriteConfig("NUMMERN","LAST" + GADRDAT$, LTRIM$ ( STR$ (nnum%,"999999")))
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LASTIntnr.stamm + 1
       LastIntnr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (IntPREFIX.stamm)
   END IF 
   Kundennummer.GAdrDat$ = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
   REM IF Workstation% > 0 THEN Workstation.GAdrDat$ = Workstation%
   REM IF Workstation% > 0 THEN QWoNo.GAdrDat$ = STR$ (Workstation%,"000000") + STR$ (codeku%,"000000")
   RecStatus.GAdrDat$ = "c"
   STORE FILE GAdrDat$
   UNLOCK CURRENT FILE GAdrDat$
   UNLOCK FILE GAdrDat$
   SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
 END IF 
 FILE GAdrDat$
 SELECT WHERE 
 IF dfart$ = "Makler" OR dfart$ = "Mitarbeiter" THEN 
   SET FORM OFF ausk$
   SET FORM OFF angeb1$
   SET FORM OFF anfr$
 END IF 
 INDEX Nachname.GAdrDat$
 IF knr% <> 0 THEN 
   SELECT FORM KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
   SELECT KEY knr% FILE GTelDat$ INDEX codeku.GTelDat$
   SET INDEX nachname.GAdrDat$
   IF GASP% AND Workstation% > 0 THEN 
     sok% = - 1
     wks% = Workstation.GADRDat$
     FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
       wks% = VisOff%(ii%)
       aa% = IsWksVisible%(wks%)
       IF aa% = - 1 AND Workstation.GADRDat$ = wks% THEN 
         sok% = - 1
         ii% = VisCount%
       ELSE 
         sok% = 0
       END IF 
     NEXT ii%
   ELSE 
     sok% = - 1
   END IF 
   locktest% = MNdisabled%("DATALOCK")
   IF locktest% THEN 
     IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
   END IF 
   joo% = - 1
   IF sok% = - 1 THEN 
     IF GMASuperCount% > 0 AND sok% = - 1 THEN 
       joo% = IsMASuper%(codema.GADRDAT$)
     END IF 
     IF sok% <> - 1 AND joo% = - 1 AND GMASuperCount% > 0 THEN 
       CALL ADRFirst()
     END IF 
     IF sok% = - 1 AND joo% <> - 1 AND GMASuperCount% > 0 THEN 
       CALL ADRFirst()
     END IF 
   ELSE 
     CALL ADRFirst()
   END IF 
   
 ELSE 
   SELECT FIRST 
   IF GASP% THEN 
     CALL ADRFirst()
   END IF 
   knr% = codeku.GAdrDat$
   SELECT FORM KEY knr% FILE GTelDat$ INDEX codeku.GTelDat$
 END IF 
 FORM 
 END SUB 
 
 
 ' Adresse Neu
 ' ======================================================================
 ' Zweck:       erzeugt neuen Datensatz fÅr Adre·erfassung
 ' Nutzung:     CALL ADRNeu()
 ' ======================================================================
 ' 0002/10.01.93    - Vergabe AAxx Åberarbeitet
 
SUB ADRNeu()
 IF GADRDat$ LIKE "BCK*" THEN 
   IF disabled%("INTERESSENTNEW") THEN END SUB 
 ELSE 
   IF disabled%("ADRNeu") THEN END SUB 
 END IF 


 IF ADRSchnell.stamm = 1 THEN 
   ww% = 0
   codema% = 0
   zzz% = 0
   IF GASP% <> - 1 THEN 
     IF _projekt$ <> "IMMAK" THEN 
       codema% = GetCodeMA%(prompt%,Workstation%)
       IF codema% < 1 THEN GOTO end120520041
       miab$ = "Agenturnr.: " + Agenturnr.maadr
       agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
     END IF 
   END IF 
   IF GASP% THEN 
     CALL MADRSuchen()
     codema% = GCodema%
     IF codema% = 0 THEN 
       CALL Fehler("Adresserfassung abgebrochen!","")
       GOTO end120520041
     END IF 
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     REM Codema.GADRDat$ = codema%
     IF workstation.maadr > 0 THEN 
       ww% = Workstation.maadr
       SELECT FIRST FILE "filiale" INDEX filialnr.filiale
       SELECT KEY workstation.maadr FILE "filiale" INDEX filialnr.filiale
       bueronr% = bÅronr.filiale
     ELSE 
       ww% = zzz%
       SELECT FIRST FILE "filiale" INDEX filialnr.filiale
       SELECT KEY zzz% FILE "filiale" INDEX filialnr.filiale
       bueronr% = bÅronr.filiale
     END IF 
   END IF 
   CALL ADRNeuS(codema%,ww%,bueronr%)
 ELSE 
   CALL ADRNeuN()
 END IF 
end120520041: 
 END SUB 


SUB SearchPLZ1()
 Gplz$ = "plz"
 END SUB 

SUB GetOrt1()
 Gort$ = "Ort"
 GOTO danf070520040
 END SUB 




SUB ADRNeuS(codema%,ww%,bueronr%)
    CALL DFile(2,"OFFICE\" + "ANREDE" + _fpw$)
    DIM AnredeA$( RECCOUNT ("Anrede"))
    FILE "Anrede"
    SELECT FIRST FILE "Anrede"
    i% = 0
    AnredeA$(i%) = "<leer>"
    i% = 1
    WHILE NOT EOF ("Anrede")
      AnredeA$(i%) = Anrede.anrede
      i% = i% + 1
      SELECT NEXT FILE "Anrede"
    WEND 

    CALL DFile(2,"OFFICE\" + "Titel" + _fpw$)
    DIM TitelA$( RECCOUNT ("Titel"))
    FILE "Titel"
    SELECT FIRST FILE "Titel"
    i% = 0
    WHILE NOT EOF ("Titel")
      TitelA$(i%) = Titel.Titel
      i% = i% + 1
      SELECT NEXT FILE "Titel"
    WEND 
 
    anrede$ = "Herr"
    DIM dlg AS Dialog
    DIM control AS DialogControl
dia070520041:  
    ffehl$ = ""
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,438,166)
    dlg.Caption = "Dialogfeld-Titel"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
    
    SET control = dlg.Add("DialogComboBox1","DialogComboBox")
    control.Move(38,9,128,75)
    control.Style = 2
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("AnredeA$","anrede$")
 
    SET control = dlg.Add("DialogComboBox3","DialogComboBox")
    control.Move(209,8,128,75)
    control.Style = 0
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("TitelA$","Titel1$")
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(4,9,30,10)
    control.Caption = "Anrede"
 
     
    SET control = dlg.Add("DialogLabel13","DialogLabel")
    control.Move(170,9,31,10)
    control.Caption = "Titel"
 


    SET control = dlg.Add("DialogLabel20","DialogLabel")
    control.Move(2,23,35,10)
    control.Caption = "Nachname/"
    SET control = dlg.Add("DialogLabel202","DialogLabel")
    control.Move(2,31,35,10)
    control.Caption = "Firma"
 
    SET control = dlg.Add("DialogTextBox16","DialogTextBox")
    
    control.Move(39,25,149,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "nachname$"
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(196,25,37,10)
    control.Caption = "Vorname/"
    SET control = dlg.Add("DialogLabel101","DialogLabel")
    control.Move(196,35,37,10)
    control.Caption = "zu HÑnden"

    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(229,25,200,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "vorname$"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(2,44,34,10)
    control.Caption = "Strasse"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(39,43,390,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Strasse$"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(2,58,34,10)
    control.Caption = "PLZ"
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(39,57,46,12)
    control.MaxLength = 20
    control.TextBinding = "PLZ$"
    REM control.OnLostFocus = "SearchPLZ1"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(88,58,13,10)
    control.Caption = "Ort"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(105,57,324,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Ort$"
    REM control.OnGotFocus = "GetOrt1"
 
 
    SET control = dlg.Add("DialogTextBox18","DialogTextBox")
    control.Move(136,74,53,12)
    control.MaxLength = 10
    control.TextBinding = "gebdat$"
 
    SET control = dlg.Add("DialogLabel21","DialogLabel")
    control.Move(83,73,42,10)
    control.Caption = "Geburtstag/"
    SET control = dlg.Add("DialogLabel210","DialogLabel")
    control.Move(83,81,52,10)
    control.Caption = "FirmengrÅndung"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(2,97,34,10)
    control.Caption = "Telefon"
 
    SET control = dlg.Add("DialogTextBox6","DialogTextBox")
    control.Move(39,97,170,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Telefon$"
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(213,97,32,10)
    control.Caption = "Handy"
 
    SET control = dlg.Add("DialogTextBox7","DialogTextBox")
    control.Move(249,97,184,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Handy$"
 
    SET control = dlg.Add("DialogLabel8","DialogLabel")
    control.Move(2,110,34,8)
    control.Caption = "Telefax"
 
    SET control = dlg.Add("DialogTextBox8","DialogTextBox")
    control.Move(39,110,170,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "TeleFax$"
 
    SET control = dlg.Add("DialogLabel9","DialogLabel")
    control.Move(213,110,32,8)
    control.Caption = "email"
 
    SET control = dlg.Add("DialogTextBox9","DialogTextBox")
    control.Move(249,110,184,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "email$"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(2,123,34,8)
    control.Caption = "Internet"
 
    SET control = dlg.Add("DialogTextBox10","DialogTextBox")
    control.Move(39,123,170,12)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "Internet$"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(101,140,61,15)
    control.Caption = "&OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(165,140,63,15)
    control.Caption = "&Abbruch"
    control.ReturnValue = 0

    SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
    control.Move(255,140,63,15)
    control.Caption = "&Suchen"
    control.ReturnValue = 2
  
    DIALOG "Dialogname",req%
    REMOVE DIALOG ALL 
    IF req% = 2 THEN 
       adrser% = 0
       FILE GAdrDat$
       cuknr% = codeku.GAdrDat$
       adrglob% = 0
       adr% = 0
       adrhis% = 0
       sunaold$ = nachname$
       REM adr% = ADRSuche%(0)
       adr% = BerlimexSuch%(nachname$,vorname$,strasse$,plz$,ort$)
       IF adr% <> 0 THEN 
         cuknr% = adr%
         adrhis% = - 1
         req% = 0
       ELSE 
         GOTO dia070520041
       END IF 
       IF adrglob% <> 0 THEN 
         cuknr% = adrglob%
         adrhis% = - 1
       END IF 
       SELECT FORM KEY cuknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       SELECT FORM KEY cuknr% FILE GTelDat$ INDEX CodeKU.GTelDat$
       REM IF UCASE$ (_projekt$) LIKE "FACTURA" THEN SELECT FORM KEY cuknr% FILE "umsatz" INDEX CodeKU.umsatz
       IF adrhis% = - 1 AND GADRDAT$ LIKE "ADRESSEN" THEN 
         REM Suchergebnis in die Datei ADRHIS eintragen
         BLANK FILE "ADRHIS"
         codekey.adrhis = SER ("ADRHIS",1)
         codema.adrhis = GMACodeMA%
         codeku.adrhis = cuknr%
         name.adrhis = LEFT$ (Nachname.adressen + "/" + Vorname.adressen + "/" + Ort.adressen + "/" + Stra·e.adressen,200)
         QCodeMAKey.adrhis = STR$ (GMACodeMA%,"000000") + STR$ (codekey.adrhis,"000000")
         timestamp$ = DATE$ ( TODAY ,"yymmdd") + STR$ ( HRS ( NOW ) * 100 + MINS ( NOW ),"0000")
         timestamp% = VAL (timestamp$)
         Timestamp.adrhis = timestamp%
         STORE FILE "ADRHIS"
       END IF 
       knr% = cuknr%
       IF adr% <> 0 THEN GOTO end190520041
    END IF 
    IF req% = 1 THEN 
      fehl$ = ""
      IF GBerlimex% = - 1 THEN 
        IF LTRIM$ (vorname$) = "" THEN fehl$ = "Vorname wurde nicht ausgefÅllt - "
        IF LTRIM$ (nachname$) = "" THEN fehl$ = fehl$ + "Nachname wurde nicht ausgefÅllt - "
        IF LTRIM$ (plz$) = "" THEN fehl$ = fehl$ + "PLZ wurde nicht ausgefÅllt - "
        IF LTRIM$ (ort$) = "" THEN fehl$ = fehl$ + "Ort wurde nicht ausgefÅllt - "
        IF LTRIM$ (Strasse$) = "" THEN fehl$ = fehl$ + "Stra·e wurde nicht ausgefÅllt - "
        IF LTRIM$ (gebdat$) = "" THEN fehl$ = fehl$ + "Geburtstag wurde nicht ausgefÅllt - "
        IF DateOK%(gebdat$) THEN 
          IF DAYS (gebdat$) > TODAY THEN fehl$ = fehl$ + "Geburtstag kann nicht grî·er heute sein - "
        END IF 
        IF fehl$ <> "" THEN 
          CALL Fehler(fehl$,"Bitte korrigieren Sie diese Fehler!")
          GOTO dia070520041
        END IF 
      END IF 
      IF DateOK%(gebdat$) THEN 
      ELSE 
        CALL Fehler("Das Geburtstagsdatum ist falsch! Es mu· das Format dd.mm.yyyy haben!","Bitte korrigieren Sie diesen Fehler!")
        GOTO dia070520041
      END IF 
knr240520041: 
      SELECT FIRST LOCK FILE "stamm"
      IF GADRDat$ LIKE "ADRESSEN" THEN 
        nnum% = LastKunr.stamm + 1
        LastKunr.stamm = nnum%
        STORE FILE "Stamm"
        UNLOCK CURRENT FILE "stamm"
        SELECT FIRST FILE "Stamm"
        prefix$ = LTRIM$ (KUNRPREFIX.stamm)
      ELSE 
        nnum% = LASTIntnr.stamm + 1
        LastIntnr.stamm = nnum%
        STORE FILE "Stamm"
        UNLOCK CURRENT FILE "stamm"
        SELECT FIRST FILE "Stamm"
        prefix$ = LTRIM$ (IntPREFIX.stamm)
      END IF 
      Kundennr$ = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
      IF GASP% THEN 
        Kundennr$ = prefix$ + LTRIM$ ( STR$ (bueronr%,"000")) + "-" + LTRIM$ ( STR$ (nnum%,"9999999999"))
      END IF 
      IF EXISTS (Kundennr$,Kundennummer.GADRDAT$) THEN GOTO knr240520041
      IF anrede$ = "<leer>" THEN anrede$ = ""
      BLANK FILE GAdrDat$
      SET STATUS "Datensatz neu angelegt..."
      CodeKU% = SER (GAdrDat$,1)
      CodeKU.GAdrDat$ = codeku%
      codema.GADRDat$ = codema%
      Workstation.GADRDat$ = ww%
        AGNachname.gadrdat$ = Nachname.maadr
        AGVorname.gadrdat$ = vorname.maadr
        AGAGNr.gadrdat$ = Agenturnr.maadr
      EXPInternet.GADRDat$ = "j"
      FIIMMAK.GADRDat$ = "j"
      Erstkontakt.GADRDat$ = TODAY 
      ADRStatus.GAdrDat$ = "<OHNE ZUORDNUNG>"
      ADRGruppe.GAdrDat$ = "<OHNE ZUORDNUNG>"
      REM Kunde_seit.GAdrDat$ = TODAY 
      Kundennummer.GAdrDat$ = Kundennr$
      REM IF GASP% THEN 
        REM Kundennummer.GADRDat$ = prefix$ + LTRIM$ ( STR$ (bueronr%,"000")) + "-" + LTRIM$ ( STR$ (nnum%,"9999999999"))
      REM END IF 
      AAKunde.GAdrDat$ = "j"
      AAMakler.GAdrDat$ = "n"
      AAMitarbeiter.GAdrDat$ = "n"
      AAInteressent.GAdrDat$ = "n"
      AALieferant.GAdrDat$ = "n"
      FIPrivat.GAdrDat$ = "n"
      FIATEC.GAdrDat$ = "j"
      FIIMMAK.GAdrDat$ = "n"
      BerProtok.GADRDat$ = "n"
      zero.GAdrDat$ = 0
      IF LTRIM$ (nachname$) = "" THEN nachname$ = "NEU"
      Nachname.GADRDat$ = nachname$
      Matchcode.GADRDat$ = nachname$
      Vorname.Gadrdat$ = Vorname$
      Ort.GADRDat$ = Ort$
      plz.GADRDat$ = plz$
      Stra·e.GADRDat$ = Strasse$
      Anrede.GADRDat$ = Anrede$
      Titel.GADRDat$ = Titel1$
      Geburtstag.GADRDat$ = gebdat$
      Workstation.GADRDat$ = workstation%
      IF Telefon$ <> "" THEN 
        Telefon1.GADRDat$ = Telefon$
      ELSE 
        IF Handy$ <> "" THEN 
          Telefon1.GADRDat$ = Handy$
        END IF 
      END IF 

      IF briefanrede.GADRDat$ = "" THEN 
        SELECT CASE UCASE$ ( LEFT$ (anrede.GADRDat$,3))
        CASE "HER"
          briefanrede.GAdrDat$ = "Sehr geehrter Herr " + nachname.GAdrDat$ + ","
          Geschlecht.GAdrDat$ = "j"
        CASE "FRA","FR."
          briefanrede.GAdrDat$ = "Sehr geehrte Frau " + nachname.GAdrDat$ + ","
          Geschlecht.GAdrDat$ = "n"
        CASE "FRé","FRL"
          briefanrede.GAdrDat$ = "Sehr geehrtes FrÑulein " + nachname.GAdrDat$ + ","
          Geschlecht.GAdrDat$ = "n"
        CASE "FA.","FIR",""
          briefanrede.GAdrDat$ = "Sehr geehrte Damen und Herren,"
          Geschlecht.GAdrDat$ = ""
        CASE "FAM"
          briefanrede.GAdrDat$ = "Sehr geehrte Familie " + nachname.GAdrDat$ + ","
          Geschlecht.GAdrDat$ = ""
        CASE "EHE"
         briefanrede.GAdrDat$ = "Sehr geehrte Eheleute " + nachname.GAdrDat$ + ","
         Geschlecht.GAdrDat$ = ""
        CASE ELSE 
          briefanrede.GAdrDat$ = "Sehr geehrte Damen und Herren,"
          Geschlecht.GAdrDat$ = ""
        END SELECT 
      END IF 
      PostBriefanrede.GAdrDat$ = Briefanrede.GAdrDat$
       p$ = ""
       IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" THEN 
         p$ = Anrede.GAdrDat$ + " "
         IF LTRIM$ (Titel.GAdrDat$) <> "" THEN 
           p$ = p$ + " " + LTRIM$ (Titel.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + CHR$ (13) + CHR$ (10)
         END IF 
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (Vorname.GAdrDat$) + " " + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10)
       ELSE 
         p$ = LTRIM$ (Anrede.GAdrDat$) + " " + LTRIM$ (titel.GAdrDat$) + CHR$ (13) + CHR$ (10)
         IF Geburtsname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (nachname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (geburtsname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (Vorname.GAdrDat$) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10)
         IF land.GAdrDat$ <> "" THEN p$ = p$ + CHR$ (13) + CHR$ (10) + Land.GAdrDat$
       END IF 
       Postanschrift.adressen = p$
      CALL QuickStore(GADRDat$)
      knr% = codeku%
      IF GZP% = - 1 THEN CALL ProtAll(codeku%,"Adresse NEU",nachname$ + " " + vorname$,0,"",0,"")
      zzz% = workstation%

      BLANK FILE GTelDat$
      codeku.GTelDat$ = codeku%
      art.GTelDat$ = "Telefon:"
      nummer.GTelDat$ = Telefon$
      KART1.GTelDat$ = "FON"
      KART2.GTelDat$ = "k.A."
      codetel.GTelDat$ = SER (GTelDat$)
      fonoderfax.GTelDat$ = "n"
      IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
      IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
      IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
      IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
      RecStatus.GTelDat$ = "c"
      Qart.GTelDat$ = VSNRPack$("Telefon")
      Qnummer.GTelDat$ = VSNRPack$(Telefon$)
      STORE FILE GTelDat$
      
      
      BLANK FILE GTelDat$
      codeku.GTelDat$ = codeku%
      art.GTelDat$ = "Handy:"
      nummer.GTelDat$ = Handy$
      KART1.GTelDat$ = "MOBIL"
      KART2.GTelDat$ = "k.A."
      codetel.GTelDat$ = SER (GTelDat$)
      fonoderfax.GTelDat$ = "n"
      IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
      IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
      IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
      IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
      RecStatus.GTelDat$ = "c"
      Qart.GTelDat$ = VSNRPack$("Handy")
      Qnummer.GTelDat$ = VSNRPack$(Handy$)
      STORE FILE GTelDat$
      
      
      BLANK FILE GTelDat$
      codeku.GTelDat$ = codeku%
      art.GTelDat$ = "Telefax:"
      nummer.GTelDat$ = Telefax$
      KART1.GTelDat$ = "FAX"
      KART2.GTelDat$ = "k.A."
      codetel.GTelDat$ = SER (GTelDat$)
      fonoderfax.GTelDat$ = "j"
      IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
      IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
      IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
      IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
      RecStatus.GTelDat$ = "c"
      Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
      Qnummer.GTelDat$ = VSNRPack$(Telefax$)
      STORE FILE GTelDat$

      BLANK FILE GTelDat$
      codeku.GTelDat$ = codeku%
      art.GTelDat$ = "Email:"
      nummer.GTelDat$ = email$
      KART1.GTelDat$ = "EMAIL"
      KART2.GTelDat$ = "k.A."
      codetel.GTelDat$ = SER (GTelDat$)
      fonoderfax.GTelDat$ = "n"
      IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
      IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
      IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
      IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
      RecStatus.GTelDat$ = "c"
      Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
      Qnummer.GTelDat$ = VSNRPack$(email$)
      STORE FILE GTelDat$

      BLANK FILE GTelDat$
      codeku.GTelDat$ = codeku%
      art.GTelDat$ = "Internet:"
      nummer.GTelDat$ = Internet$
      KART1.GTelDat$ = "WWW"
      KART2.GTelDat$ = "k.A."
      codetel.GTelDat$ = SER (GTelDat$)
      fonoderfax.GTelDat$ = "n"
      IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
      IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
      IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
      IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
      RecStatus.GTelDat$ = "c"
      Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
      Qnummer.GTelDat$ = VSNRPack$(Internet$)
      STORE FILE GTelDat$


    ELSE 
      REQUEST "Wollen Sie wirklich die Erfassung abbrechen?","",130,reqa%
      IF reqa% <> 1 THEN GOTO dia070520041
    END IF 
end190520041: 
 CALL ADRIntro()
 CALL ADRFeldnamen()
 END SUB 

SUB ADRNeuN()
 IF GADRDat$ LIKE "BCK*" THEN 
   IF disabled%("INTERESSENTNEW") THEN END SUB 
 ELSE 
   IF disabled%("ADRNeu") THEN END SUB 
 END IF 
 MOUSE OFF 
 IF title$ LIKE "*DEMO*" AND RECCOUNT (GAdrDat$) >= 10 THEN 
   CALL DemoInfo()
   END SUB 
 END IF 
 MOUSE OFF 
 SET STATUS "Lege neuen Datensatz an..."
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) AND Nachname.GAdrDat$ <> "" THEN CALL FStore( FILE )
 IF title$ LIKE "*ffffffirststep*" THEN 
   IF RECCOUNT ( FILE ) > 250 THEN 
     CALL Fehler("In der FirstStep - Version kînnen maximal 250 Adressen erfa·t werden!","")
     END SUB 
   END IF 
 END IF 
 MOUSE OFF 
 FILE GAdrDat$
 miab$ = ""
 IF GASP% THEN 
   GOTO esu150520031
   REM zzz% = GetWksCodema$(prompt%,Workstation.GADRDat$)
   REM REQUEST "WÑhlen Sie die Filiale aus, fÅr die die Adresse erfa·t werden soll:","",25,req%,filialnr%,72,filialnr.filiale,name.filiale INDEX name.filiale
   wks1% = Workstation%
   a% = SelectOffice%("BÅro-Auswahl","",1,wks1%)
   MOUSE ON 
   IF a% <> - 1 THEN 
     zzz% = a%
   ELSE 
     CALL Fehler("Adresserfassung abgebrochen!","Sie haben nicht ausgwÑhlt, fÅr welche Filiale die Adresse erfa·t werden soll!")
     GOTO endadr07040101
   END IF 
 
   'Jan: neu --------------------
   'Mitarbeiter des BÅros einlesen, fÅr welches die Adresse erzeugt werden soll:
   IF jaDebug% = - 1 THEN CALL Fehler("mitarbeiter fÅr adresse holen ...","")
   wks% = Workstation%
   IF Workstation% = 0 THEN wks% = zzz%'Aaarg ... Spaghetti-Code 
esu150520031: 
   CALL MADRSuchen()
   codema% = GCodema%
   REM codema% = VAL (GetWkscodema$("",wks%))
   IF codema% = 0 THEN 
     CALL Fehler("Adresserfassung abgebrochen!","")
     GOTO endadr07040101 
   END IF 
   'Jan ende --------------------  
   MOUSE ON 
 
 END IF 
 
 
 
 BLANK FILE GAdrDat$
 SET STATUS "Datensatz neu angelegt..."
 CodeKU% = SER (GAdrDat$,1)
 CodeKU.GAdrDat$ = codeku%
 EXPInternet.GADRDat$ = "n"
 IF GASP% THEN 
   Codema.GADRDat$ = codema%
   IF workstation.maadr > 0 THEN 
     Workstation.GADRDat$ = Workstation.maadr
     SELECT KEY workstation.maadr FILE "filiale" INDEX filialnr.filiale
     bueronr% = bÅronr.filiale
   ELSE 
     Workstation.GADRDat$ = zzz%
     SELECT FIRST FILE "filiale" INDEX filialnr.filiale
     SELECT KEY zzz% FILE "filiale" INDEX filialnr.filiale
     bueronr% = bÅronr.filiale
   END IF 
 END IF 
 Erstkontakt.GADRDat$ = TODAY 
 STORE FILE GAdrDat$
 
 UNLOCK CURRENT FILE GAdrDat$
 UNLOCK FILE GAdrDat$
 SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
 ADRStatus.GAdrDat$ = "<OHNE ZUORDNUNG>"
 ADRGruppe.GAdrDat$ = "<OHNE ZUORDNUNG>"
 IF GASP% <> - 1 THEN 
   IF _projekt$ <> "IMMAK" THEN 
     codema.GAdrDat$ = GetCodeMA%(prompt%,Workstation%)
        AGNachname.gadrdat$ = Nachname.maadr
        AGVorname.gadrdat$ = vorname.maadr
        AGAGNr.gadrdat$ = Agenturnr.maadr
     miab$ = "Agenturnr.: " + Agenturnr.maadr
     agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
     Kunde_seit.GAdrDat$ = TODAY 
   END IF 
 END IF 
 nachname.GAdrDat$ = "NEU"
 IF _projekt$ <> "AKTE" THEN 
   IF GADRDat$ LIKE "ADRESSEN" THEN 
     REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
     REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LastKunr.stamm + 1
       LastKunr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (KUNRPREFIX.stamm)
   ELSE 
       REM nnum% = VAL (ReadConfig$("NUMMERN","LAST" + GADRDAT$)) + 1
       REM CALL WriteConfig("NUMMERN","LAST" + GADRDAT$, LTRIM$ ( STR$ (nnum%,"999999")))
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LASTIntnr.stamm + 1
       LastIntnr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (IntPREFIX.stamm)
   END IF 
   MOUSE OFF 
   REM IF proserv$ <> "TRUE" THEN Kundennummer.GAdrDat$ = "K" + LTRIM$ ( STR$ (nnum%,"999999"))
   Kundennummer.GAdrDat$ = prefix$ + LTRIM$ ( STR$ (nnum%,"9999999999"))
   IF GASP% THEN 
     Kundennummer.GADRDat$ = prefix$ + LTRIM$ ( STR$ (bueronr%,"000")) + "-" + LTRIM$ ( STR$ (nnum%,"9999999999"))
   END IF 
   Debitorkto.GAdrDat$ = LTRIM$ ( STR$ (nnum%,"999999"))
   AAKunde.GAdrDat$ = "j"
   AAMakler.GAdrDat$ = "n"
   AAMitarbeiter.GAdrDat$ = "n"
   AAInteressent.GAdrDat$ = "n"
   AALieferant.GAdrDat$ = "n"
   FIPrivat.GAdrDat$ = "n"
   FIATEC.GAdrDat$ = "j"
   FIIMMAK.GAdrDat$ = "n"
   BerProtok.GADRDat$ = "n"
 END IF 
 zero.GAdrDat$ = 0
 QNachname.GAdrDat$ = "NEU"
 REM Workstation.GAdrDat$ = Workstation%
 REM QWoNo.GAdrDat$ = STR$ (Workstation%,"000000") + STR$ (codeku.GAdrDat$,"000000")
 RecStatus.GAdrDat$ = "c"
 STORE FILE GAdrDat$
 IF GZP% = - 1 THEN CALL ProtAll(codeku%,"Adresse NEU","NEU",0,"",0,"")
 UNLOCK CURRENT FILE GAdrDat$
 UNLOCK FILE GAdrDat$
 MOUSE OFF 
 IF _projekt$ <> "AKTE" THEN 
 REM IF _projekt$ = "AKTENNNNNNNN" THEN 
   BLANK FILE GTelDat$
   codeku.GTelDat$ = codeku%
   art.GTelDat$ = "Telefon:"
   fonoderfax.GTelDat$ = "n"
   KART1.GTelDat$ = "FON"
   KART2.GTelDat$ = "k.A."
   codetel.GTelDat$ = SER (GTelDat$)
   IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
   IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
   IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
   IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
 
   RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
   STORE FILE GTelDat$
   UNLOCK CURRENT FILE GTelDat$
   UNLOCK FILE GTelDat$
   BLANK FILE GTelDat$
   codeku.GTelDat$ = codeku%
   art.GTelDat$ = "Telefax:"
   KART1.GTelDat$ = "FAX"
   KART2.GTelDat$ = "k.A."
   codetel.GTelDat$ = SER (GTelDat$)
   fonoderfax.GTelDat$ = "j"
   IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
   IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
   IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
   IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
   RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
   STORE FILE GTelDat$
   UNLOCK CURRENT FILE GTelDat$
   UNLOCK FILE GTelDat$
   BLANK FILE GTelDat$
   codeku.GTelDat$ = codeku%
   art.GTelDat$ = "email:"
   KART1.GTelDat$ = "EMAIL"
   KART2.GTelDat$ = "k.A."
   fonoderfax.GTelDat$ = "n"
   codetel.GTelDat$ = SER (GTelDat$)
   IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
   IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
   IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
   IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
   RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
   STORE FILE GTelDat$
   UNLOCK CURRENT FILE GTelDat$
   UNLOCK FILE GTelDat$
   BLANK FILE GTelDat$
   codeku.GTelDat$ = codeku%
   art.GTelDat$ = "Internet:"
   KART1.GTelDat$ = "WWW"
   KART2.GTelDat$ = "k.A."
   fonoderfax.GTelDat$ = "n"
   codetel.GTelDat$ = SER (GTelDat$)
   IF zzz% > 0 THEN Workstation.GTelDat$ = zzz%
   IF zzz% > 0 THEN QWoNo.GTelDat$ = STR$ (zzz%,"000000") + STR$ (codetel.GTelDat$,"000000")
   IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
   IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
   RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
   STORE FILE GTelDat$
   UNLOCK CURRENT FILE GTelDat$
   UNLOCK FILE GTelDat$
   SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
 END IF 
 SELECT FORM KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
 IF GASP% THEN 
   IF codema2.GADRDat$ > 0 THEN 
     SELECT KEY codema2.GADRDat$ FILE "maadr" INDEX codema.maadr
     agent2$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   ELSE 
     agent2$ = "<ohne Zuordnung>"
   END IF 
   miab$ = "BÅro: " + LTRIM$ (GetWksName$(Workstation.GADRDat$))
   SELECT KEY codema.GADRDat$ FILE "maadr" INDEX codema.maadr
   agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
 END IF 
 FORM 
 MOUSE ON 
 ADRsub% = 99
endadr07040101: 
 END SUB 
 
 REM **** Generierung Kundennummer.GAdrDat$ wie Kreditkarte***
SUB ProServGen()
 knr% = codeku.GAdrDat$
 CALL FStore(GAdrDat$)
 FILE GAdrDat$
 SELECT FIRST 
 SELECT KEY knr% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
 ok% = 1
 sprung$ = "K1BLZ." + GAdrDat$
 IF Kundennummer.GAdrDat$ = "" THEN 
   IF vorname.GAdrDat$ = "" THEN 
     CALL Fehler("Es mu· erst ein Vorname eingegeben werden!","")
     ok% = 0
     sprung$ = "Vorname." + GAdrDat$
   END IF 
   IF geburtstag.GAdrDat$ = 0 THEN 
     CALL Fehler("Es mu· erst das Geburtsdatum eingegeben werden!","")
     ok% = 0
     sprung$ = "Geburtstag." + GAdrDat$
   END IF 
   IF nachname.GAdrDat$ = "" THEN 
     CALL Fehler("Es mu· erst ein Nachname eingegeben werden!","")
     ok% = 0
     sprung$ = "nachname." + GAdrDat$
   END IF 
   IF Kunde_seit.GAdrDat$ = 0 THEN 
     CALL Fehler("Es mu· erst ein Datum bei Kunde seit eingegeben werden!","")
     ok% = 0
     sprung$ = "Kunde_seit." + GAdrDat$
   END IF 
   td$ = DATE$ ( TODAY ,"ddmmyy")
   td2$ = ReadConfig$("PROVIS","PROSERVDAT")
   IF ok% <> 0 THEN 
     IF td$ <> td2$ THEN 
       CALL WriteConfig("PROVIS","PROSERVDAT",td$)
       CALL WriteConfig("PROVIS","PROSERVNR","1")
       nnum% = 1
     ELSE 
       nnum% = VAL (ReadConfig$("PROVIS","PROSERVNR")) + 1
     END IF 
     CALL WriteConfig("PROVIS","PROSERVNR", LTRIM$ ( STR$ (nnum%,"99")))
     kundnr$ = LEFT$ (vorname.GAdrDat$,1)
     kundnr$ = kundnr$ + MID$ ( DATE$ (Kunde_seit.GAdrDat$,"ddmmyy"),1,2)
     kundnr$ = kundnr$ + LEFT$ ( DATE$ (geburtstag.GAdrDat$,"dd.mm.yy"),2)
     kundnr$ = kundnr$ + STR$ (nnum%,"00")
     kundnr$ = kundnr$ + MID$ ( DATE$ (geburtstag.GAdrDat$,"ddmmyy"),3,2)
     kundnr$ = kundnr$ + LEFT$ (Nachname.GAdrDat$,1)
     kundnr$ = kundnr$ + MID$ ( DATE$ (Kunde_seit.GAdrDat$,"ddmmyy"),3,2)
     kundnr$ = kundnr$ + MID$ ( DATE$ (Kunde_seit.GAdrDat$,"ddmmyy"),6,1)
     kundnr$ = kundnr$ + MID$ ( DATE$ (geburtstag.GAdrDat$,"ddmmyy"),5,2)
     Kundennummer.GAdrDat$ = kundnr$
     CALL QuickStore(GAdrDat$)
     REM sprung$ = "Telefon1."+GAdrDat$
     sprung$ = "K1BLZ." + GAdrDat$
   END IF 
 END IF 
 MOUSE ON 
 MENU OFF 
 EXECUTE "ENTER " + sprung$ + ",0"
 MENU ON 
 FORM 
 END SUB 
  
 
 
 
 
 ' Adresse Kopieren
 ' ======================================================================
 ' Zweck:       kopiert Adresse
 ' Nutzung:     CALL ADRKopieren()
 ' ======================================================================
 ' 0003/26.09.94/AB
 
SUB ADRKopieren()
 IF disabled%("ADRNeu") THEN END SUB 
 knr% = Codeku.GADRDat$
 IF title$ LIKE "*DEMO*" AND RECCOUNT (GAdrDat$) >= 10 THEN 
   CALL DemoInfo()
   END SUB 
 END IF 
 REQUEST "Mîchten Sie diese Adresse duplizieren?","",130,req130%
 IF req130% = 1 THEN 
   codeku1% = Codeku.GAdrDat$
   SET STATUS "Lege neuen Datensatz an..."
   BLANK DUPLICATE 
   CodeKUneu% = SER (GAdrDat$,1)
   CodeKU.GAdrDat$ = CodeKUneu%
   REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
   REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
   IF GADRDat$ LIKE "ADRESSEN" THEN 
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LastKunr.stamm + 1
       LastKunr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (KUNRPREFIX.stamm)
   ELSE 
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LASTIntnr.stamm + 1
       LastIntnr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (INTPREFIX.stamm)
   END IF 
   Kundennummer.GAdrDat$ = prefix$ + LTRIM$ ( STR$ (nnum%,"999999")) + "*"
   CALL QuickStore(GAdrDat$)
   FILE GTelDat$
   INDEX codeku.GTelDat$
   IF EXISTS (codeku1%,codeku.GTelDat$) THEN 
     SELECT FIRST FILE GTelDat$ INDEX codeku.GTelDat$
     SELECT KEY codeku1% FILE GTelDat$ INDEX codeku.GTelDat$
   ELSE 
     SELECT LAST 
   END IF 
   telanz% = RECCOUNT (GTelDat$)
   IF telanz% > 20000 THEN telanz% = 20000
   DIM Telart$(telanz%)
   DIM TelNum$(telanz%)
   DIM FF$(telanz%)
   a% = 0
  IF EXISTS (codeku1%,codeku.GTelDat$) THEN 
   WHILE NOT EOF (GTelDat$) AND codeku.GTelDat$ = codeku1%
     Telart$(a%) = Art.GTelDat$
     TelNum$(a%) = Nummer.GTelDat$
     FF$(a%) = FonOderFax.GTelDat$
     a% = a% + 1
   SELECT NEXT FILE GTelDat$
   WEND 
   FOR i% = a% - 1 TO 0 STEP - 1
     BLANK FILE GTelDat$
     codetel.GTelDat$ = SER (GTelDat$,1)
     codeku.GTelDat$ = codekuneu%
     art.GTelDat$ = TelArt$(i%)
     nummer.GTelDat$ = TelNum$(i%)
     FonOderFax.GTelDat$ = FF$(i%)
     IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
     IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
     UNLOCK CURRENT FILE GTelDat$
     UNLOCK FILE GTelDat$
   NEXT i%
  END IF 
   SELECT FORM KEY codekuneu% INDEX Codeku.GTelDat$
   FILE GAdrDat$
   SELECT FORM KEY codekuneu% INDEX Codeku.GAdrDat$
   FORM 
   MOUSE ON 
   ADRsub% = 99
 END IF 
 END SUB 
 
 
 
  
 ' Adresse sperren/freigeben
 ' ======================================================================
 
SUB ADRSperre()
 CALL DSSperre("CodeKU",GAdrDat$)
 END SUB 
 
  
 ' Adressenliste drucken
 ' ======================================================================
 
SUB ADRDrucken()
 IF disabled%("ADRDrucken") THEN END SUB 
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 FILE GAdrDat$
 ueberschr$ = ""
 knr% = CodeKU.GAdrDat$
 cdir$ = DIRECTORY 
 cindex$ = INDEX 
 DIRECTORY _netpath$ + "OFFICE"
 opt% = 1
 ON ERROR GOTO ErrorHandler
    CREATE DIALOG "ADRLIST",0,0,292,188,"WÑhlen Sie den Ausdruck","MS Sans Serif",8
    ADD DIALOG "ADRLIST",4,0,0,290,160,0,""
    ADD DIALOG "ADRLIST",9,4,5,15,21,2
    ADD DIALOG "ADRLIST",5,10,25,238,14,0,"WÑhlen Sie eine Option aus!"
    ADD DIALOG "ADRLIST",3,10,38,236,10,0,"nur die aktuelle Adresse",1,opt%
    ADD DIALOG "ADRLIST",3,10,49,234,10,0,"Adre·liste (alle Adressen)",2,opt%
    ADD DIALOG "ADRLIST",3,10,60,256,10,0,"Adre·-/Telefonliste (ausgewÑhlte Adressen) / EXPORT als Serienbriefdatei",3,opt%
    ADD DIALOG "ADRLIST",3,10,71,236,10,0,"Screenshot akt. Adresse",4,opt%
    ADD DIALOG "ADRLIST",3,10,82,236,10,0,"Geburtstagliste",5,opt%
    ADD DIALOG "ADRLIST",3,10,93,236,10,0,"Telefonliste",9,opt%
    IF _projekt$ LIKE "PROV*" AND GAdrDat$ LIKE "ADRESSEN" THEN 
      ADD DIALOG "ADRLIST",3,10,104,234,10,0,"KundenvertrÑge",6,opt%
      ADD DIALOG "ADRLIST",3,10,115,236,10,0,"ProvisionsÅbersicht akt. Kunde",8,opt%
    END IF 
    IF _projekt$ LIKE "IMMAK*" AND GAdrDat$ LIKE "ADRESSEN" THEN 
      ADD DIALOG "ADRLIST",3,10,104,234,10,0,"Anfragen",13,opt%
      ADD DIALOG "ADRLIST",3,10,115,236,10,0,"Angebote",14,opt%
    END IF 
    ADD DIALOG "ADRLIST",3,10,126,236,10,0,"Adre·liste letzter Kontakt",12,opt%
    REM ADD DIALOG "ADRLIST",3,30,126,236,10,0,"ProvisionsÅbersicht akt. Vertrag",9,opt%
    ADD DIALOG "ADRLIST",1,79,168,51,14,1,"&Weiter",1,1
    ADD DIALOG "ADRLIST",1,131,168,51,14,0,"&Abbruch",0,0
 DIALOG "ADRLIST",req%
 REMOVE DIALOG "ADRLIST"
 IF req% = 1 THEN 
   knr% = Codeku.GAdrDat$
   IF opt% = 9 THEN 
     opt% = 3
     adrtelefon$ = "j"
   END IF 
   MOUSE OFF 
   IF opt% = 6 THEN 
     CALL VLIST1()
   END IF 
   IF opt% = 7 THEN 
     CALL LIST7(knr%)
   END IF 
   IF opt% = 8 THEN 
     IF eurosupport$ = "TRUE" THEN 
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
       IF DruInEur.stamm = 1 THEN 
         req1% = 1
       ELSE 
         CALL Fehler(t1$,t2$)
         REQUEST "öbersicht in EURO drucken?","",130,req1%
       END IF 
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
     END IF 
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL VLIST3(eu%)
     ELSE 
       CALL VLIST3Z(eu%)
     END IF 
   END IF 
 
   REM UmsÑtze einer Adresse
   IF opt% = 15 THEN 
     CALL AdrUmsOne()
   END IF 
   
   REM UmsÑtze aller Adressen
   IF opt% = 16 THEN 
     CALL AdrUmsAll()
   END IF 
 
   REM UmsÑtze ausgewÑhlte Adressen
   IF opt% = 17 THEN 
     CALL AdrUmsSel()
   END IF 
   IF opt% = 18 THEN 
     knr1% = codeku.GAdrDat$
     CALL ArtDruckNeu(1)
     knr% = knr1%
   END IF 
   IF opt% = 12 THEN 
     REM 111297Adre·liste letzter Kontakt
     bis$ = TODAY 
     CREATE DIALOG "Konto1",0,0,221,165,"Datum letzter Kontakt","MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"letzter Kontakt:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Zeitraum Sie eine öbersicht wÅnschen."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     IF von$ <> "" OR bis$ <> "" THEN 
       IF von$ = "" THEN von$ = "1.1.1980"
       IF von$ <> "" AND bis$ = "" THEN 
         bis$ = von$
       END IF 
       von% = DAYS (von$)
       bis% = DAYS (bis$)
       von$ = DATE$ (von%,"0d.mm.yyyy")
       bis$ = DATE$ (bis%,"0d.mm.yyyy")
       SELECT WHERE FILE GAdrDat$
       SELECT WHERE letzter_Kontakt.GAdrDat$ >= von$ AND letzter_Kontakt.GAdrDat$ <= bis$
       wbericht$ = GAdrDat$
       SELECT CASE GAdrDat$
         CASE "ADRESSEN"
           title2$ = "Kundenliste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
         CASE "BCKONTAK"
           IF GBENE% THEN 
             title2$ = "BC-Liste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
           ELSE 
             title2$ = "Interessenten-Liste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
           END IF 
       END SELECT 
       REM title2$ = "Adressliste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
       CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
     ELSE 
       CALL Fehler("Es mu· mindestens ein Datum fÅr - bis - eingegeben werden!","")
     END IF 
   END IF 
   SELECT WHERE FILE GAdrDat$
   IF opt% = 1 THEN 
     IF _projekt$ <> "AKTE" THEN 
       REQUEST "Sollen alle VorgÑnge zu dieser Adresse gedruckt werden?","",135,cmplt%
     ELSE 
       cmplt% = 0
     END IF 
     _CodeKU% = CodeKU.GAdrDat$
     FILE GTelDat$
     INDEX codeku.GTelDat$
     SELECT KEY _Codeku% FILE GTelDat$ INDEX codeku.GTelDat$
     FILE GAdrDat$
     MOUSE OFF 
     SELECT WHERE FILE GAdrDat$
     EXECUTE "SELECT WHERE codeku.GAdrDat$ = _codeku%"
     REM 071098
     SELECT FIRST 
     KurzLang$ = "n"
     IF anrede.GadrDat$ LIKE "Herr*" OR anrede.GadrDat$ LIKE "FrÑ*" OR anrede.GadrDat$ LIKE "Frau*" OR anrede.GadrDat$ LIKE "Fami*" OR anrede.GadrDat$ LIKE "Ehe*" THEN 
       title2$ = "Adressangaben zu " + nachname.GAdrDat$ + ", " + vorname.GadrDat$
     ELSE 
       title2$ = "Adressangaben zu " + nachname.GAdrDat$ + " " + Geburtsname.GadrDat$
     END IF 
     IF cmplt% = 1 THEN 
       Terminejn$ = "j"
       FILE GAkquiDat$
       INDEX codeku.GAkquiDat$
       SELECT FIRST 
       SELECT KEY _codeku% FILE GAkquiDat$ INDEX codeku.GAkquiDat$
       SELECT WHERE FILE GAkquiDat$
       EXECUTE "SELECT WHERE CodeKU.GAkquiDat$ = _CodeKU%"
       INDEX termin.GAkquiDat$
       SELECT FIRST 
     END IF 
     FILE GAdrDat$
     wbericht$ = GAdrDat$
     CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
     SELECT WHERE FILE GAdrDat$
     SELECT WHERE FILE GAkquiDat$
     REM IF cmplt% = 1 THEN 
       REM SELECT ;
         REM WHERE CodeKU.GAkquiDat$ = _CodeKU% AND codeak.GAkquiDat$ = codeak.aktionen
         REM ORDER Termin.GAkquiDat$,Uhrzeit.GAkquiDat$
         REM TO ASK 
ErrADRDRUCK: 
       REM ON ERROR GOTO ErrorHandler
     REM END IF 
   END IF 
   IF opt% = 2 THEN 
     SELECT CASE GAdrDat$
       CASE "ADRESSEN"
         title2$ = "Adressliste alle Adressen"
       CASE "BCKONTAK"
         IF GBene% THEN 
           title2$ = "BC-Liste alle Adressen"
         ELSE 
           title2$ = "Interessenten-Liste alle Adressen"
         END IF 
     END SELECT 
     beding$ = ""
     KurzLang$ = "n"
     wbericht$ = GAdrDat$
     CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
   END IF 
 
   IF opt% = 3 THEN 
   REM ausgewÑhlte Adressen
     cfilt$ = WHERE 
     KurzLang$ = "n"
     opt1% = 2
     stichw$ = "n"
     stichwort$ = ""
     option2% = 1
     VertragJN$ = "n"
     Terminejn$ = "n"
     GohneVertr$ = "n"
     ON ERROR GOTO ErrorHandler
     CREATE DIALOG "ADRFilter",0,0,290,221,title$,"MS Sans Serif",8
     ADD DIALOG "ADRFilter",4,5,0,280,134,0," Suche nach "
     ADD DIALOG "ADRFilter",6,169,30,112,13,128,0,suna$,50
     ADD DIALOG "ADRFilter",6,169,46,112,13,128,0,suna1$,50
     ADD DIALOG "ADRFilter",3,14,11,72,11,0,"Kundennummer",6,opt1%
     ADD DIALOG "ADRFilter",3,14,25,34,11,0,"Anrede",1,opt1%
     ADD DIALOG "ADRFilter",3,14,38,68,11,0,"Nachname/Firma",2,opt1%
     ADD DIALOG "ADRFilter",3,14,52,22,10,0,"Ort",3,opt1%
     ADD DIALOG "ADRFilter",3,14,67,28,11,0,"PLZ",4,opt1%
     ADD DIALOG "ADRFilter",3,14,81,79,11,0,"Stra·e",5,opt1%
     ADD DIALOG "ADRFilter",5,169,16,111,12,0,"Bitte den Suchbegriff eingeben"
     ADD DIALOG "ADRFilter",5,150,32,14,11,0,"von"
     ADD DIALOG "ADRFilter",5,150,46,12,11,0,"bis"
     ADD DIALOG "ADRFilter",2,169,60,85,11,0,"Alle Angaben drucken","n","j",KurzLang$
     ADD DIALOG "ADRFilter",2,169,75,85,11,0,"Termine mitdrucken","j","n",Terminejn$
     IF _projekt$ LIKE "PROVIS" AND GAdrDat$ LIKE "ADRESSEN" THEN 
       ADD DIALOG "ADRFilter",2,169,90,115,11,0,"VertrÑge zur Adresse drucken!","j","n",VertragJN$
       ADD DIALOG "ADRFilter",2,140,100,138,11,0,"nur Adressen, die keine VertrÑge haben","j","n",GohneVertr$
 
     END IF 
     ADD DIALOG "ADRFilter",2,14,118,84,11,0,"Stichwort einbeziehen","j","n",stichw$
     IF _projekt$ LIKE "PROVIS" THEN 
       ADD DIALOG "ADRFilter",2,105,118,105,11,0,"Adressen einer Agentur","j","n",mitarb$
       ADD DIALOG "ADRFilter",2,14,102,105,11,0,"Adress-Status einbeziehen","j","n",adrstatus$
       ADD DIALOG "ADRFilter",2,210,118,70,11,0,"Adress-Gruppe","j","n",adrgruppe$
     END IF 
     ADD DIALOG "ADRFilter",4,5,135,200,60,0,"Ausgabeziel"
     ADD DIALOG "ADRFilter",3,14,149,124,11,0,"Ausgabe auf Drucker/Fenster",1,Option2%
     ADD DIALOG "ADRFilter",3,14,162,155,11,0,"Ausgabe in dBASE - Datei fÅr Serienbriefe",2,Option2%
     ADD DIALOG "ADRFilter",3,14,175,148,11,0,"Ausgabe in MS EXCEL - Datei",3,Option2%
     ADD DIALOG "ADRFilter",2,129,139,60,11,0,"als Telefonliste","j","n",adrtelefon$

     ADD DIALOG "ADRFilter",4,205,135,80,60,0,"Sortierung"
     ADD DIALOG "ADRFilter",3,207,149,50,11,0,"Nachname",1,Option3%
     ADD DIALOG "ADRFilter",3,207,162,50,11,0,"PLZ",2,Option3%
 

     ADD DIALOG "ADRFilter",1,90,204,49,14,1,"&Weiter",1,1
     ADD DIALOG "ADRFilter",1,142,204,49,14,0,"&Abbruch",0,0
     DIALOG "ADRFilter",req%
     REMOVE DIALOG ALL 
     IF req% = 1 THEN 
       IF Option3% = 1 THEN sort$ = "Nachname"
       IF Option3% = 2 THEN sort$ = "plz"
       IF mitarb$ = "j" THEN 
         IF GASP% <> - 1 THEN 
           FILE "maadr"
           INDEX nachname
           SELECT FIRST 
           a% = 0
           SELECT FIRST 
           REDIM AdrFound$( RECCOUNT ("maadr"))
           WHILE NOT EOF ("maadr")
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.MAADR) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF sok% THEN 
               AdrFound$(a%) = LTRIM$ (nachname) + "," + LTRIM$ (vorname) + SPACE$ (80) + STR$ (codema,"000000")
               a% = a% + 1
             END IF 
             SELECT NEXT FILE "MAADR"
           WEND 
           AdrFound$(a%) = ""
           LAuswahl$ = AdrFound$(0)
           LAuswahl1$(0) = LAuswahl$
           CREATE DIALOG "ADRSTICHW",0,0,194,202,title$,"MS Sans Serif",8
           ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
           ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
           ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
           DIALOG "ADRSTICHW",req5%
           MOUSE ON 
           REMOVE DIALOG "ADRSTICHW"
           IF req5% = 1 THEN 
             LAuswahl$ = LAuswahl1$(0)
             scodema% = VAL ( RIGHT$ (LAuswahl$,6))
             SELECT FIRST 
             SELECT KEY scodema% FILE "maadr" INDEX codema.maadr
             smaname$ = nachname.maadr + ", " + vorname.maadr
           ELSE 
             mitarb$ = "n"
             GOTO adrdr140996
           END IF 
         END IF 
         IF GASP% THEN 
          'Jan: modi ---------------------
          wks1% = workstation%
          IF workstation% > 0 THEN 
            wks1% = workstation%
            rep% = GetCodeMA%(cuma%,Workstation%)
          ELSE 
            IF GMASuperCount% > 0 THEN 
              req% = 0
            ELSE 
              REQUEST "Mîchten Sie die BÅrostruktur zur Suche benutzen?","",130,req%
            END IF 
            IF req% = 1 THEN 
              a% = SelectOffice%("VorgÑnger-Auswahl","",1,0)
              IF a% <> - 1 THEN 
                zzz% = a%
                wks% = zzz%'Aaarg ... Spaghetti-Code 
                codema% = VAL (GetWkscodema$("",wks%))
                rep% = codema%
              ELSE 
                CALL Fehler("Es wurde kein BÅro gewÑhlt!","")
                rep% = 0
              END IF 
            ELSE 
              rep% = GetCodeMA%(_cuma%,Wks1%)
            END IF 
          END IF 
          IF rep% <> 0 THEN 
            scodema% = rep%
            SELECT FIRST 
            SELECT KEY scodema% FILE "maadr" INDEX codema.maadr
            smaname$ = nachname.maadr + ", " + vorname.maadr
          ELSE 
            mitarb$ = "n"
            req% = 0
            GOTO adrdr140996
          END IF 
         END IF 
 
       END IF 
       FILE GAdrDat$
       IF adrgruppe$ = "j" THEN 
         REDIM AdrFound$( RECCOUNT ("ADRGRUP"),1)
         REDIM AdrFound$( RECCOUNT ("ADRGRUP"))
         FILE "ADRGRUP"
         INDEX keyword.adrgrup
         SELECT FIRST 
         iii% = 0
         WHILE NOT EOF ("ADRGrup")
           AdrFound$(iii%) = keyword.adrgrup
           iii% = iii% + 1
           SELECT NEXT 
         WEND 
         CREATE DIALOG "ADRSTICHW",0,0,194,202,"Adress-Gruppen-Auswahl","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
         ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           adrgrup$ = LEFT$ (LAuswahl$)
           IF LAuswahl$ = "leer" THEN adrgruppe$ = ""
         ELSE 
           adrgruppe$ = "n"
           GOTO adrdr140996
         END IF 
         FILE GAdrDat$
       END IF 
       IF adrstatus$ = "j" THEN 
         REDIM AdrFound$( RECCOUNT ("ADRStat"))
         FILE "ADRStat"
         INDEX keyword.adrstat
         SELECT FIRST 
         iii% = 0
         WHILE NOT EOF ("ADRStat")
           AdrFound$(iii%) = keyword.adrstat
           iii% = iii% + 1
           SELECT NEXT 
         WEND 
         CREATE DIALOG "ADRSTICHW",0,0,194,202,"Adress-Status-Auswahl","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
         ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           adrstat$ = LEFT$ (LAuswahl$)
           IF LAuswahl$ = "leer" THEN adrstat$ = ""
         ELSE 
           adrstatus$ = "n"
           GOTO adrdr140996
         END IF 
         FILE GAdrDat$
       END IF 
       IF stichw$ = "j" THEN 
         CALL DFile(2,"OFFICE\keywords" + _fpw$)
         FILE "keywords"
         INDEX keyword
         SELECT FIRST 
         a% = 0
         SELECT WHERE keyword <> ""
         SELECT FIRST 
         REDIM AdrFound$( RECCOUNT ("keywords"))
         WHILE NOT EOF ("keywords")
           AdrFound$(a%) = LTRIM$ (keyword)
           a% = a% + 1
           SELECT NEXT 
         WEND 
         AdrFound$(a%) = ""
         LAuswahl$ = AdrFound$(0)
         LAuswahl1$(0) = LAuswahl$
         CREATE DIALOG "ADRSTICHW",0,0,194,202,"Stichwort-Auswahl","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
         ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           stichwort$ = "*" + LEFT$ (LAuswahl$) + "*"
         ELSE 
           stichw$ = "n"
           GOTO adrdr140996
         END IF 
         FILE GAdrDat$
       END IF 
       MOUSE OFF 
       SELECT CASE opt1%
       CASE 1
         feld$ = "Anrede." + GAdrDat$
         IF suna1$ = "" THEN 
           REM suna$ = suna$ + "*"
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 2
         feld$ = "nachname." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 3
         feld$ = "Ort." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 4
         feld$ = "PLZ." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 5
         feld$ = "Stra·e." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 6
         feld$ = "Kundennummer." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 7
         REM feld$="Telefon/Faxnummer"
       END SELECT 
       
       x% = ASC ( LEFT$ ( UCASE$ (suna$),1))
       SELECT CASE x%
         CASE 142
           sun$ = "A" + RIGHT$ (suna$, LEN (suna$) - 1)
           suna$ = sun$
         CASE 153
           sun$ = "O" + RIGHT$ (suna$, LEN (suna$) - 1)
           suna$ = sun$
         CASE 154
           sun$ = "U" + RIGHT$ (suna$, LEN (suna$) - 1)
           suna$ = sun$
       END SELECT 
 
       MOUSE OFF 
       SET STATUS "Bitte warten Adressdatei wird vorbereitet!"
       SELECT WHERE FILE GAdrDat$
       REM IF suna$ = "*" THEN suna$ = "**"
       stichwort$ = "*" + stichwort$ + "*"
       SELECT CASE GAdrDat$
         CASE "ADRESSEN"
           IF adrtelefon$ <> "j" THEN 
             title2$ = "Adressl"
           ELSE 
             title2$ = "Telefonl"
           END IF 
         CASE "BCKONTAK"
           IF GBene% THEN 
             title2$ = "BC-L"
           ELSE 
             title2$ = "Interessenten-L"
           END IF 
       END SELECT 
       IF stichw$ = "j" THEN 
         IF suna$ = "" THEN 
           title2$ = title2$ + "iste selektiert nach Stichwort: *" + stichwort$
         ELSE 
           IF opt1% = 1 THEN title2$ = title2$ + "iste selektiert nach Anrede von : " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 2 THEN title2$ = title2$ + "iste selektiert nach Nachname von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 3 THEN title2$ = title2$ + "iste selektiert nach Ort von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 4 THEN title2$ = title2$ + "iste selektiert nach PLZ von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 5 THEN title2$ = title2$ + "iste selektiert nach Stra·e von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 6 THEN title2$ = title2$ + "iste selektiert nach Kundennummer von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
         END IF 
       ELSE 
         IF suna$ = "" THEN 
           title2$ = title2$ + "iste alle Adressen"
         ELSE 
           IF opt1% = 1 THEN title2$ = title2$ + "iste selektiert nach Anrede von: " + suna$ + " bis: " + suna1$
           IF opt1% = 2 THEN title2$ = title2$ + "iste selektiert nach Nachname von: " + suna$ + " bis: " + suna1$
           IF opt1% = 3 THEN title2$ = title2$ + "iste selektiert nach Ort von: " + suna$ + " bis: " + suna1$
           IF opt1% = 4 THEN title2$ = title2$ + "iste selektiert nach PLZ von: " + suna$ + " bis: " + suna1$
           IF opt1% = 6 THEN title2$ = title2$ + "iste selektiert nach Stra·e von: " + suna$ + " bis: " + suna1$
           IF opt1% = 6 THEN title2$ = title2$ + "iste selektiert nach Kundennummer von: " + suna$ + " bis: " + suna1$
         END IF 
 
       END IF 
       IF adrstatus$ = "j" THEN 
         IF adrstat$ = "" THEN 
           title2$ = title2$ + " /Adress-Status: leer"
         ELSE 
           title2$ = title2$ + " /Adress-Status: " + adrstat$
         END IF 
       END IF 
       IF adrgruppe$ = "j" THEN 
         IF adrgrup$ = "" THEN 
           title2$ = title2$ + " /Adress-Gruppe: leer"
         ELSE 
           title2$ = title2$ + " /Adress-Gruppe: " + adrgrup$
         END IF 
       END IF 
 
       IF GohneVertr$ LIKE "j" THEN 
         title2$ = title2$ + " /ohne Vertrag"
       END IF 

       x% = ASC ( LEFT$ (suna$,1))
       b1$ = "select where "
       IF lief$ = "j" THEN 
         b2$ = "aalieferant=~j~"
         title2$ = title2$ + " fÅr Lieferanten"
       END IF 
       IF mitarb$ = "j" THEN 
         title2$ = title2$ + " fÅr Mitarbeiter: " + smaname$
         IF stichw$ = "j" OR suna$ <> "" THEN 
           b1$ = "select where codema=scodema% AND "
         ELSE 
           beding$ = "select where codema=scodema%"
         END IF 
       END IF 
       IF stichw$ = "j" AND suna$ <> "" THEN 
         beding$ = b1$ + "LEFT$(UCASE$(feld$$),LEN(suna$)) >= suna$ and LEFT$(UCASE$(feld$$),LEN(suna$)) <= suna1$ AND Stichwort LIKE Stichwort$"
         SELECT CASE x%
           CASE 142,65
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 142"
           CASE 153,79
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 153"
           CASE 154,85
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 154"
           CASE 225
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 225"
         END SELECT 
       ELSE 
       END IF 
       IF stichw$ <> "j" AND suna$ <> "" THEN 
         beding$ = b1$ + "LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna1$)) <= suna1$"
         SELECT CASE x%
           CASE 142,65
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 142"
           CASE 153,79
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 153"
           CASE 154,85
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 154"
           CASE 225
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 225"
         END SELECT 
       ELSE 
       END IF 
       IF stichw$ = "j" AND suna$ = "" THEN 
         beding$ = b1$ + "stichwort.GAdrDat$ LIKE Stichwort$"
       END IF 
       IF stichw$ <> "j" AND suna$ = "" AND mitarb$ <> "j" THEN beding$ = "select where"
       IF stichw$ <> "j" AND suna$ = "" AND mitarb$ <> "j" AND lief$ = "j" THEN beding$ = "select where aalieferant=~j~"
       IF stichw$ = "j" OR suna$ <> "" OR mitarb$ = "j" THEN 
         IF lief$ = "j" THEN beding$ = beding$ + "and aalieferant=~j~"
       END IF 
       IF adrstatus$ = "j" THEN 
         IF RIGHT$ (beding$,5) LIKE "where" THEN 
           beding$ = beding$ + " adrstatus = adrstat$"
         ELSE 
           beding$ = beding$ + " and adrstatus = adrstat$"
         END IF 
       END IF 
       IF adrgruppe$ = "j" THEN 
         IF RIGHT$ (beding$,5) LIKE "where" THEN 
           beding$ = beding$ + " adrgruppe = adrgrup$"
         ELSE 
           beding$ = beding$ + " and adrgruppe = adrgrup$"
         END IF 
       END IF 
       FILE GADRDat$
       SELECT WHERE FILE GAdrDat$
       EXECUTE beding$
       SELECT FIRST 
       wbericht$ = GAdrDat$
       
       IF option2% = 1 THEN 
         IF adrtelefon$ <> "j" THEN 
           REM CALL Fehler("","")
           CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
           GohneVertr$ = "n"
         ELSE 
           REM *********** Telefonliste *************************************
           REM Telefonliste 11.10.2001
           REQUEST "Sollen nur diejenigen Adressen berÅcksichtigt werden","bei denen Nummern existieren?",130,nurtel%
           IF OPEN ("adrtemp") THEN 
             IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
             REM CLOSE FILE "ADRTEMP"
           ELSE 
             CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
             IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
           END IF 
           FILE GAdrDat$
           INDEX Nachname.GAdrDat$
           SELECT FIRST 
           CALL Server("LISTBOXINIT","Adre·auswahl fÅr Telefonliste")
           CALL Gauge(1,"Adre·datei wird durchsucht...")
           CALL Server("GAUGEENABLECANCEL","")
           _prozt% = 0
           _proz2% = 0
           _anz% = RECCOUNT (GAdrDat$)
           abz% = 0
           WHILE NOT EOF (GAdrDat$) AND ServerReply$() <> "CANCEL"
             codeku% = codeku.GAdrDat$
             _proz% = INT ((100 / _anz%) * _proz2%)
             IF _proz% > 100 THEN _proz% = 100
             IF _proz% < 2 THEN _proz% = 2
             IF _proz% <> _prozt% THEN 
               _prozt% = _proz%
               SET STATUS "Telefonliste... " + STR$ (_prozt%,"999") + " %"
               CALL Gauge(_proz%,"")
             END IF 
             _proz2% = _proz2% + 1
             ok% = 0
             IF nurtel% = 1 THEN 
               IF EXISTS (codeku.GADRDat$,codeku.GTelDat$) THEN 
                 SELECT FIRST FILE GTelDat$ INDEX codeku.GTelDat$
                 SELECT KEY codeku.GADRDat$ FILE GTelDat$ INDEX codeku.GTelDat$
                 WHILE NOT EOF (GTElDat$) AND codeku.GTelDat$ = codeku.GADRDat$
                   IF LTRIM$ (nummer.GTElDat$) <> "" THEN 
                     ok% = 1
                     SELECT LAST FILE GTelDat$ INDEX codeku.GTelDat$
                   END IF 
                   SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
                 WEND 
               ELSE 
                 ok% = 0
               END IF 
             ELSE 
               ok% = 1
             END IF 
             IF GASP% AND Workstation% <> 0 THEN 
               IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
             END IF 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.GAdrDat$) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF GohneVertr$ LIKE "j" THEN 
               IF EXISTS (codeku%,codeku.kvertrag) THEN sok% = 0
             END IF 
             IF ok% = 1 AND sok% THEN 
               anrede$ = LTRIM$ (Anrede.GAdrDat$)
               titel$ = LTRIM$ (Titel.GAdrDat$)
               IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" THEN 
                 nachname$ = LTRIM$ (nachname.GAdrDat$)
                 vorname$ = LTRIM$ (vorname.GAdrDat$)
               ELSE 
                 nachname$ = LTRIM$ (nachname.GAdrDat$)
                 vorname$ = LTRIM$ (Geburtsname.GAdrDat$)
               END IF 
               gebdat% = Geburtstag.GAdrDat$
               CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
               abz% = abz% + 1
               tmpzeile$ = LTRIM$ (Nachname.GAdrDat$) + ", " + LEFT$ ( LTRIM$ (Vorname.GAdrDat$),10)
               CALL Server("GaugeMessage","... " + STR$ (abz%,"999999") + " gefunden (" + tmpzeile$ + ")")
               CALL Server("LISTBOXADD",tmpZeile$)
             END IF 
             FILE GAdrDat$
           SELECT NEXT FILE GAdrDat$
           WEND 
           CALL Gauge(0,"")
           IF abz% > 0 THEN 
             wbsort$ = "Nachname"
             listart% = 2
             SELECT CASE GAdrDat$
               CASE "ADRESSEN"
                 title2$ = "Kunden-Telefonliste"
               CASE "BCKONTAK"
                 title2$ = "BC-Telefonliste"
             END SELECT 
             CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
           ELSE 
             CALL Fehler("Es waren keine Adressen zur Erstellung einer Telefonliste vorhanden!","")
           END IF 
           REM ************ Ende Telefonliste *******************************
         END IF 
         option2% = 0
       END IF 
       IF option2% > 0 THEN 
         MOUSE OFF 
         IF OPEN ("adrtemp") THEN 
           IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
           REM CLOSE FILE "ADRTEMP"
         ELSE 
           CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
           IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
         END IF 
         FILE GAdrDat$
         SELECT FIRST 
         abz% = 0
         a% = 0
         b% = RECCOUNT (GAdrDat$)
         IF b% > 20000 THEN 
           b% = 20000
           REDIM AdrFound$(20000,1)
           REDIM AdrFound$(20000)
         ELSE 
           REDIM AdrFound$( RECCOUNT (GAdrDat$),1)
           REDIM AdrFound$( RECCOUNT (GAdrDat$))
         END IF 
         REM FOR a% = 0 TO b%
           REM AdrFound$(a%) = ""
         REM NEXT a%
         a% = 0
         WHILE NOT EOF (GAdrDat$)
           abz% = abz% + 1
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.GAdrDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF gasp% = - 1 AND sok% = - 1 THEN 
             IF (IsWksVisible%(Workstation.GADRDat$) <> - 1) THEN sok% = 0
           END IF 
           SET STATUS "Anzahl der verarbeiteten Adressen: " + STR$ (abz%,"99999999")
           IF sok% THEN 
             codeku% = codeku.GAdrDat$
             REM 200999
             BLANK FILE "adrtemp"
             codeadrt% = SER ("ADRTEMP",1)
             codeadrt.adrtemp = codeadrt%
             codeku.adrtemp = codeku%
             ADRGruppe.adrtemp = ADRGruppe.GADRDat$
             ADRStatus.adrtemp = ADRStatus.GADRDat$
             Kundennummer.adrtemp = Kundennummer.GAdrDat$
             Postanschrift.adrtemp = Postanschrift.GAdrDat$
             Anrede.adrtemp = Anrede.GAdrDat$
             ASerJN.adrtemp = ASerJN.GAdrDat$
             IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
               Name2.adrtemp = Nachname.GAdrDat$
               Name1.adrtemp = Vorname.GAdrDat$
               REM Name3.adrtemp = Geburtsname.GAdrDat$
             ELSE 
               Name1.adrtemp = Nachname.GAdrDat$
               zuHaenden.adrtemp = Vorname.GAdrDat$
               Name2.adrtemp = Geburtsname.GAdrDat$
             END IF 
             Strasse.adrtemp = Stra·e.GAdrDat$
             PLZ.adrtemp = PLZ.GAdrDat$
             Ort.adrtemp = Ort.GAdrDat$
             NationalitÑt.adrtemp = NationalitÑt.GAdrDat$
             Staatsangehîrig.adrtemp = Staatsangehîrig.GAdrDat$
             Land.adrtemp = Land.GAdrDat$
             Geburtstag.adrtemp = DATE$ (Geburtstag.GAdrDat$,"0d.mm.yyyy")
             K1Bank.adrtemp = K1Bank.GAdrDat$
             K1BLZ.adrtemp = K1BLZ.GAdrDat$
             K1Konto.adrtemp = K1Konto.GAdrDat$
             K2Bank.adrtemp = K2Bank.GAdrDat$
             K2BLZ.adrtemp = K2BLZ.GAdrDat$
             K2Konto.adrtemp = K2Konto.GAdrDat$
             Kunde_seit.adrtemp = DATE$ (Kunde_seit.GAdrDat$,"0d.mm.yyyy")
             letzter_Kontakt.adrtemp = DATE$ (letzter_Kontakt.GAdrDat$,"0d.mm.yyyy")
             REM Notiz.adrtemp = Notiz.GAdrDat$
             Beruf.adrtemp = Beruf.GAdrDat$
             Hobbys.adrtemp = Hobbys.GAdrDat$
             Geschlecht.adrtemp = Geschlecht.GAdrDat$
             Familienstand.adrtemp = Familienstand.GAdrDat$
             Briefanrede.adrtemp = Briefanrede.GAdrDat$
             REM Geburtsname.adrtemp = Geburtsname.GAdrDat$
             feld1$ = "Telart"
             feld2$ = "Telnr"
             feld3$ = "FaxJN"
             codema% = Codema.GAdrDat$
             codema.adrtemp = codema%
             codepr.adrtemp = codepr.GAdrDat$
             REM 061196
             IF _projekt$ LIKE "FACTURA" THEN 
               IF EXISTS (codema%,codema.vertrete) THEN 
                 FILE "vertrete"
                 INDEX codema.vertrete
                 SELECT FIRST 
                 SELECT KEY codema% FILE "vertrete" INDEX codema.vertrete
                 Mitarbeiter.adrtemp = TRIM$ (nachname.vertrete) + ", " + TRIM$ (vorname.vertrete)
                 QuickMaKund.adrtemp = TRIM$ (nachname.vertrete) + TRIM$ (vorname.vertrete) + nachname.GAdrDat$
               END IF 
             END IF 
             IF _projekt$ LIKE "PROVIS" THEN 
               IF EXISTS (codema%,codema.maadr) THEN 
                 FILE "maadr"
                 INDEX codema.maadr
                 SELECT FIRST 
                 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
                 Mitarbeiter.adrtemp = TRIM$ (nachname.maadr) + ", " + TRIM$ (vorname.maadr)
                 QuickMaKund.adrtemp = TRIM$ (nachname.maadr) + TRIM$ (vorname.maadr) + nachname.GAdrDat$
               END IF 
             END IF 
             EGNachname.adrtemp = EGNachname.GAdrDat$
             EGGeburtsname.adrtemp = EGGeburtsname.GAdrDat$
             EGVorname.adrtemp = EGVorname.GAdrDat$
             EGGeburtstag.adrtemp = EGGeburtstag.GAdrDat$
             EGBeruf.adrtemp = EGBeruf.GAdrDat$
             EGASStra·e.adrtemp = EGASStra·e.GAdrDat$
             EGASOrt.adrtemp = EGASOrt.GAdrDat$
             EGASPLZ.adrtemp = EGASPLZ.GAdrDat$
             EGAnrede.adrtemp = eganrede.GADRDat$
             EGTitel.adrtemp = EGTitel.GADRDat$
             ADRStatus.adrtemp = adrstatus.GADRDat$
             codema% = codema.GADRDat$
             SELECT FIRST FILE "maadr" INDEX codema.maadr
             SELECT KEY codema% FILE "maadr" INDEX codema.maadr
             Agentur1.adrtemp = Agenturnr.maadr + ", " + Nachname.maadr + ", " + Vorname.maadr
             codema% = codema2.GADRDat$
             SELECT FIRST FILE "maadr" INDEX codema.maadr
             SELECT KEY codema% FILE "maadr" INDEX codema.maadr
             Agentur2.adrtemp = Agenturnr.maadr + ", " + Nachname.maadr + ", " + Vorname.maadr

             FOR k1% = 1 TO 4
               k1$ = STR$ (k1%,"9")
               K_feld1$ = "K" + k1$ + "Name" + ".adrtemp"
               K_feld2$ = "K" + k1$ + "NName" + ".adrtemp"
               K_feld3$ = "K" + k1$ + "Ort" + ".adrtemp"
               K_feld4$ = "K" + k1$ + "Strasse" + ".adrtemp"
               K_feld5$ = "K" + k1$ + "PLZ" + ".adrtemp"
               K_feld6$ = "K" + k1$ + "Telefon1" + ".adrtemp"
               K_feld7$ = "K" + k1$ + "Fax1" + ".adrtemp"
               K_feld8$ = "K" + k1$ + "Mobil1" + ".adrtemp"
               K_feld9$ = "K" + k1$ + "email1" + ".adrtemp"
               K_feld10$ = "K" + k1$ + "www1" + ".adrtemp"
               K_feld11$ = "K" + k1$ + "Telefon2" + ".adrtemp"
               K_feld12$ = "K" + k1$ + "Fax2" + ".adrtemp"
               K_feld13$ = "K" + k1$ + "Mobil2" + ".adrtemp"
               K_feld14$ = "K" + k1$ + "email2" + ".adrtemp"
               K_feld15$ = "K" + k1$ + "www2" + ".adrtemp"
               K_feld1$$ = K1Name.GAdrDat$
               K_feld2$$ = K1NName .GAdrDat$
               K_feld3$$ = K1Ort .GAdrDat$
               K_feld4$$ = K1Strasse.GAdrDat$
               K_feld5$$ = K1PLZ.GAdrDat$
               K_feld6$$ = K1Telefon1.GAdrDat$
               K_feld7$$ = K1Fax1.GAdrDat$
               K_feld8$$ = K1Mobil1.GAdrDat$
               K_feld9$$ = K1email1.GAdrDat$
               K_feld10$$ = K1www1.GAdrDat$
               K_feld11$$ = K1Telefon2.GAdrDat$
               K_feld12$$ = K1Fax2.GAdrDat$
               K_feld13$$ = K1Mobil2.GAdrDat$
               K_feld14$$ = K1email2.GAdrDat$
               K_feld15$$ = K1www2.GAdrDat$
             NEXT k1%
             IF EXISTS (codeku%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               INDEX Qcodekutel.GTelDat$
               SELECT FIRST FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               Qcodekutel$ = STR$ (codeku%,"000000") + "000000"
               REM CALL Fehler(Qcodekutel$,"")
               SELECT KEY Qcodekutel$ FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               abi% = 0
               WHILE codeku.GTelDat$ = codeku% AND abi% < 20 AND NOT EOF (GTelDat$)
                 abi% = abi% + 1
                 IF abi% < 10 THEN 
                   feldart$ = feld1$ + STR$ (abi%,"9") + ".adrtemp"
                   feldnum$ = feld2$ + STR$ (abi%,"9") + ".adrtemp"
                   feldFax$ = TRIM$ (feld3$ + STR$ (abi%,"9") + ".adrtemp")
                 ELSE 
                   feldart$ = feld1$ + STR$ (abi%,"99") + ".adrtemp"
                   feldnum$ = feld2$ + STR$ (abi%,"99") + ".adrtemp"
                   feldFax$ = TRIM$ (feld3$ + STR$ (abi%,"99") + ".adrtemp")
                 END IF 
                 feldart$$ = LEFT$ (art.GTelDat$,60)
                 feldnum$$ = LEFT$ (nummer.GTelDat$,60)
                 FeldFax$$ = FonOderFax.GTelDat$
                 SELECT NEXT FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               WEND 
             END IF 
             FILE "adrtemp"
             STORE FILE "adrtemp"
             AdrFound$(a%) = Nachname.GAdrDat$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
           END IF 
         FILE GAdrDat$
         SELECT NEXT FILE GAdrDat$
         MOUSE OFF 
         WEND 
         SELECT WHERE FILE GAdrDat$
       END IF 
       REM Serienbrief nach dbase
       REM 240999
       IF option2% = 2 THEN 
         SELECT WHERE FILE GAdrDat$
         adrser% = 1
         CALL SerieNeu1("ADRTEMP")
       END IF 
 
       IF option2% = 3 THEN 
         FILE "adrtemp"
         INDEX name2.adrtemp
         SELECT FIRST 
         REM EXPORT nach EXCEL aufrufen
         dir1$ = DIRECTORY 
         dateiname2$ = "*.xls"
         REQUEST "Speichern als MS EXCEL..."," ",27,req%,dateiname2$
         IF req% = 1 THEN 
           MOUSE OFF 
           SET STATUS "EXPORT der gewÑhlten Adressen nach: " + dateiname2$
           Superbase.Converters.SBF.SourceFormat = "Superbase"
           Superbase.Converters.SBF.SourceFile = "ADRTEMP"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = dateiname2$
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
           DIRECTORY dir1$
           WAIT FOR 3
           a% = CALL ("ShellExecute",0,"open",dateiname2$,"","",1)
           IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
           SET STATUS "EXPORT beendet!"

         END IF 
       END IF 
       SELECT WHERE FILE GAdrDat$
ErrADRDR2: 
       ON ERROR GOTO ErrorHandler
     END IF 
   END IF 
   IF opt% = 4 THEN 
     CALL PrinterSetup()
     CALL SeiteDrucken()
   END IF 
   IF opt% = 5 THEN 
     CALL GEBLISTE()
   END IF 
   IF opt% = 9 THEN 
     REM Telefonliste 141196
     IF OPEN ("adrtemp") THEN 
       REM CLOSE FILE "ADRTEMP"
       IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
     ELSE 
       CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
       IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
     END IF 
     FILE GAdrDat$
     INDEX Nachname.GAdrDat$
     SELECT FIRST 
     CALL Server("LISTBOXINIT","Adre·auswahl fÅr Telefonliste")
     CALL Gauge(1,"Adre·datei wird durchsucht...")
     CALL Server("GAUGEENABLECANCEL","")
     _prozt% = 0
     _proz2% = 0
     _anz% = RECCOUNT (GAdrDat$)
     abz% = 0
     WHILE NOT EOF (GAdrDat$) AND ServerReply$() <> "CANCEL"
       codeku% = codeku.GAdrDat$
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "Telefonliste... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
       anrede$ = LTRIM$ (Anrede.GAdrDat$)
       titel$ = LTRIM$ (Titel.GAdrDat$)
       IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" THEN 
         nachname$ = LTRIM$ (nachname.GAdrDat$)
         vorname$ = LTRIM$ (vorname.GAdrDat$)
       ELSE 
         nachname$ = LTRIM$ (nachname.GAdrDat$)
         vorname$ = LTRIM$ (Geburtsname.GAdrDat$)
       END IF 
       gebdat% = Geburtstag.GAdrDat$
       sok% = - 1
       IF GMASuperCount% > 0 THEN 
         IF IsMASuper%(codema.GAdrDat$) THEN 
         ELSE 
           sok% = 0
         END IF 
       END IF 
       IF sok% THEN 
         CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
         abz% = abz% + 1
       END IF 
       tmpzeile$ = LTRIM$ (Nachname.GAdrDat$) + ", " + LEFT$ ( LTRIM$ (Vorname.GAdrDat$),10)
       CALL Server("GaugeMessage","... " + STR$ (abz%,"999999") + " gefunden (" + tmpzeile$ + ")")
       CALL Server("LISTBOXADD",tmpZeile$)
       FILE GAdrDat$
     SELECT NEXT FILE GAdrDat$
     WEND 
     CALL Gauge(0,"")
     IF abz% > 0 THEN 
       wbsort$ = "Nachname"
       listart% = 2
       SELECT CASE GAdrDat$
         CASE "ADRESSEN"
           title2$ = "Kunden-Telefonliste"
         CASE "BCKONTAK"
           title2$ = "BC-Telefonliste"
       END SELECT 
       CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
     ELSE 
       CALL Fehler("Es waren keine Adressen zur Erstellung einer Telefonliste vorhanden!","")
     END IF 
   END IF 
 END IF 
adrdr140996: 
 FILE GAdrDat$
 SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 FORM 
 SET INDEX cindex$
 INDEX cindex$
 MOUSE ON 
 DIRECTORY cdir$
 END SUB 
  
 
 ' Adresse testen
 ' ======================================================================
 ' Zweck:       automatische Vergabe der Seriennummer
 ' Nutzung:     wird vom Adressenformular verwendet
 ' ======================================================================
 
SUB ADRTest()
 IF CodeKU.GAdrDat$ = 0 THEN 
   CodeKU.GAdrDat$ = SER (GAdrDat$,1)
   FORM 
 END IF 
 REM CALL ADRFeldnamen()
  IF anrede.GAdrDat$ LIKE "*herr*" OR anrede.GAdrDat$ LIKE "*frau*" OR anrede.GAdrDat$ LIKE "*frÑ*" OR anrede.GAdrDat$ LIKE "*fam*" OR anrede.GAdrDat$ LIKE "ehe*" THEN 
    adrfn1$ = "Nachname"
    adrfn2$ = "Geburtsname"
    adrfn3$ = "Vorname"
    adrfn4$ = "Geburtstag"
    adrfn5$ = "Kinder"
    adrfn6$ = "Anzahl"
    adrfn7$ = "Hobbys"
  ELSE 
    adrfn1$ = "Firma"
    adrfn2$ = "Zusatz"
    adrfn3$ = "z.H."
    adrfn4$ = "FirmengrÅndung"
    adrfn5$ = "GF"
    adrfn6$ = "Anzahl MA"
    adrfn7$ = "Betriebsbeschr."
 END IF 
 IF anrede.GADRDat$ LIKE "Herr*" THEN 
   Geschlecht.GADRDat$ = "j"
 ELSE 
   IF anrede.GADRDat$ LIKE "Frau*" OR anrede.GADRDat$ LIKE "FrÑu*" THEN 
     Geschlecht.GADRDat$ = "n"
   ELSE 
     Geschlecht.GADRDat$ = ""
   END IF 
 END IF 
 MOUSE ON 
 END SUB 
 
 
 ' Adressen Feldnamen
 ' ======================================================================
 ' Zweck:       VerÑndert die angezeigten Feldnamen dem Adre·typ 
 '              entsprechend; Adre·typ wird Åber Feld Anrede.GAdrDat$ 
 '              ermittelt
 ' Nutzung:     CALL ADRFeldnamen()
 ' ======================================================================
 
SUB ADRFeldnamen()
 MOUSE OFF 
  codeku% = codeku.GAdrDat$
  IF MOD (GAdrDat$) OR NEW (GAdrDat$) THEN 
    IF nachname.GAdrDat$ = "" THEN nachname.GAdrDat$ = "NEU"
    CALL QuickStore(GAdrDat$)
    SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
  END IF 
  IF anrede.GAdrDat$ LIKE "*herr*" OR anrede.GAdrDat$ LIKE "*frau*" OR anrede.GAdrDat$ LIKE "*frÑ*" OR anrede.GAdrDat$ LIKE "*fam*" OR anrede.GAdrDat$ LIKE "ehe*" THEN 
    adrfn1$ = "Nachname"
    adrfn2$ = "Geburtsname"
    adrfn3$ = "Vorname"
    adrfn4$ = "Geburtstag"
    adrfn5$ = "Kinder"
    adrfn6$ = "Anzahl"
    adrfn7$ = "Hobbys"
  ELSE 
    adrfn1$ = "Firma"
    adrfn2$ = "Zusatz"
    adrfn3$ = "z.H."
    adrfn4$ = "FirmengrÅndung"
    adrfn5$ = "GF"
    adrfn6$ = "Anzahl MA"
    adrfn7$ = "Betriebsbeschr."
 END IF 
 IF GADRDat$ LIKE "ADRESSEN" AND _projekt$ <> "IMMAK" THEN 
   IF EXISTS (codeku.GADRDat$,codeku.vermoeg) THEN 
     verm$ = "Zahlungsein-/ausgÑnge zur Vermîgensverwaltung Æ"
   ELSE 
     verm$ = "Zahlungsein-/ausgÑnge zur Vermîgensverwaltung"
   END IF 
 END IF 
 IF Zweitanschrift.GADRDat$ <> "" THEN 
   zweitan$ = "ZweitanschriftÆ"
 ELSE 
   zweitan$ = "Zweitanschrift"
 END IF 
 
 IF GFinanzAnalyse% = - 1 THEN 
   IF EXISTS (codeku%,codeku.FINVGES) THEN 
     finadr$ = "Finazanalyse Æ"
   ELSE 
     finadr$ = "Finazanalyse"
   END IF 
 END IF 


 IF EXISTS (codeku%,codeku.GConDat$) THEN 
   adrvliste$ = "Kontakte Æ"
   akont$ = adrvliste$
 ELSE 
   adrvliste$ = "Kontakte"
   akont$ = adrvliste$
 END IF 
 IF EXISTS (codeku%,codeku.GDokDat$) THEN 
   dok1$ = "Dokumente Æ"
 ELSE 
   dok1$ = "Dokumente"
 END IF 
 IF GAleks% = - 1 THEN 
   IF EmpfehlTXT.GADRDat$ <> "" THEN 
     EmpfehlTXT$ = "Empfehlung Æ"
   ELSE 
     EmpfehlTXT$ = "Empfehlung"
   END IF 
 END IF 
 lastkont$ = DATE$ (letzter_kontakt.GAdrDat$,"0d.mm.yyyy")
 IF _projekt$ LIKE "PROV*" OR _projekt$ LIKE "IMM*" THEN 
     ON ERROR GOTO err300920081
     IF ADRFarbe.GAdrDat$ < 1 THEN f.adrstat1.BackColor = 8
     IF ADRFarbe.GAdrDat$ > 0 THEN f.adrstat1.BackColor = ADRFarbe.GAdrDat$
err300920081: 
     ON ERROR GOTO ErrorHandler
     adrst$ = STR$ (ADRFarbe.GAdrDat$,"000")
 END IF 
 IF notiz.GAdrDat$ <> "" THEN notiz$ = "Notiz Æ" ELSE notiz$ = "Notiz"
 IF Stammblatt.GADRDat$ <> "" THEN zeigestamm$ = "Zeige das Stammblatt Æ" ELSE zeigestamm$ = "Zeige das Stammblatt"
 st$ = "Termine: "
 IF EXISTS (CodeKU.GAdrDat$,CodeKU.GAkquiDat$) THEN 
   akquise$ = "&Termine Æ"
   cfile$ = FILE 
   FILE GAkquiDat$
   INDEX CodeKU.GAkquiDat$
   REM SELECT DUPLICATE 
   SELECT WHERE 
   SELECT FIRST INDEX codeku.GAkquiDat$
   SELECT KEY CodeKU.GAdrDat$ FILE GAkquiDat$ INDEX CodeKU.GAkquiDat$
   a% = 0
   WHILE NOT EOF (GAkquiDat$):REM AND CodeKU.GAkquiDat$ = CodeKU.GAdrDat$
     a% = a% + 1
     REM SELECT NEXT FILE GAkquiDat$ INDEX CodeKU.GAkquiDat$
     SELECT DUPLICATE 
   WEND 
   SELECT WHERE 
   FILE cfile$
   st$ = st$ + LTRIM$ ( STR$ (a%,"999999"))
 ELSE 
   akquise$ = "&Termine"
   st$ = st$ + "0"
 END IF 
 IF _projekt$ = "IMMAK" THEN 
   IF EXISTS (CodeKU.GAdrDat$,CodeKU.ANFRAGE) THEN 
     anfragebuton$ = "&Anfrage Æ"
   ELSE 
     anfragebuton$ = "&Anfrage"
   END IF 
   IF EXISTS (CodeKU.GAdrDat$,CodeKU.OBJEKTE) THEN 
     angebotbuton$ = "An&gebot Æ"
   ELSE 
     angebotbuton$ = "An&gebot"
   END IF 
 END IF 
 IF _projekt$ LIKE "PROVIS" AND GAdrDat$ LIKE "ADRESSEN" THEN 
   st$ = st$ + ", VertrÑge: "
   IF EXISTS (codema.GAdrDat$,codema.maadr) THEN 
     SELECT FORM KEY codema.GAdrDat$ FILE "maadr" INDEX codema.maadr
     miab$ = LTRIM$ (vorname.maadr) + "," + Agenturnr.maadr
   ELSE 
     miab$ = ""
   END IF 
   IF GASP% <> - 1 THEN 
     agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   ELSE 
     agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   END IF 
   IF codema2.GADRDat$ > 0 THEN 
     SELECT KEY codema2.GADRDat$ FILE "maadr" INDEX codema.maadr
     agent2$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   ELSE 
     agent2$ = "<ohne Zuordnung>"
   END IF 
   IF MAKLER$ = "TRUE" THEN 
     IF EXISTS (CodeKU.GAdrDat$,CodeKU.KUKTO) THEN 
       kukto1$ = "KundenkontoÆ"
     ELSE 
       kukto1$ = "Kundenkonto"
     END IF 
   END IF 
   IF EXISTS (CodeKU.GAdrDat$,CodeKU.VORGANG) THEN 
     vorgang$ = "SchÑden/Nachbeab. von VertrÑgenÆ"
   ELSE 
     vorgang$ = "SchÑden/Nachbeab. von VertrÑgen"
   END IF 
   IF EXISTS (CodeKU.GAdrDat$,CodeKU.KVERTRAG) THEN 
     cfile$ = FILE 
     FILE "KVERTRAG"
     INDEX CodeKU.KVERTRAG
     SELECT FIRST 
     SELECT KEY CodeKU.GAdrDat$ FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
     a% = 0
     WHILE NOT EOF ("KVERTRAG"):REM  AND CodeKU.KVERTRAG = CodeKU.GAdrDat$
       a% = a% + 1
       REM SELECT NEXT FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
       SELECT DUPLICATE 
     WEND 
     FILE cfile$
     vertrag$ = "&VertrÑge Æ"
     vvertr$ = vertrag$
     st$ = st$ + LTRIM$ ( STR$ (a%,"999999"))
   ELSE 
     st$ = st$ + "0"
     vertrag$ = "&VertrÑge"
     vvertr$ = vertrag$
   END IF 
 ELSE 
   st$ = ""
 END IF 
 IF Sperre.GAdrDat$ <> 0 THEN 
   IF MNdisabled%("DATALOCK") THEN 
     AdrLock$ = "gesperrt"
   ELSE 
     SELECT KEY Sperre.GAdrDat$ FILE "SUPERVIS" INDEX CodeMA.SUPERVIS
     AdrLock$ = "gesperrt durch " + Name.SUPERVIS
   END IF 
   MENU 2,7,2
 ELSE 
   AdrLock$ = "freier Zugriff"
   MENU 2,7,1
 END IF 
 sort$ = INDEX 
 IF INDEX LIKE "FIIM*" THEN sort$ = "Datenexport"
 b$ = "              DatensÑtze gesamt: " + STR$ ( RECCOUNT (GAdrDat$),"99999999")
 IF GADRDat$ LIKE "ADRESSEN" THEN sq$ = "   Schadensquote: " + LTRIM$ ( STR$ (Schadquote.GAdrDat$,",9999.0000"))
 IF GADRDat$ LIKE "ADRESSEN" THEN sto$ = "   Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.GAdrDat$,",9999.0000"))
 IF workstation% = 0 THEN 
   SET STATUS st$ + b$
 ELSE 
   SET STATUS st$
 END IF 
 
 IF GASP% THEN 
   IF codema2.GADRDat$ > 0 THEN 
     SELECT KEY codema2.GADRDat$ FILE "maadr" INDEX codema.maadr
     agent2$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   ELSE 
     agent2$ = "<ohne Zuordnung>"
   END IF 
   miab$ = "BÅro: " + LTRIM$ (GetWksName$(Workstation.GADRDat$))
   SELECT KEY codema.GADRDat$ FILE "maadr" INDEX codema.maadr
   agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
 ELSE 
   IF _projekt$ LIKE "IMMAK" THEN 
   ELSE 
     IF codema2.GADRDat$ > 0 THEN 
       SELECT KEY codema2.GADRDat$ FILE "maadr" INDEX codema.maadr
       agent2$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
     ELSE 
       agent2$ = "<ohne Zuordnung>"
     END IF 
     IF EXISTS (codema.GAdrDat$,codema.maadr) THEN 
       SELECT FORM KEY codema.GAdrDat$ FILE "maadr" INDEX codema.maadr
       REM miab$ = LTRIM$ (vorname.maadr) + "," + Agenturnr.maadr
       miab$ = "Agenturnr.: " + Agenturnr.maadr
       agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
     ELSE 
       miab$ = ""
       agent$ = ""
     END IF 
     REM agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr)
     REM miab$ = "Agenturnr.: " + Agenturnr.maadr
   END IF 
 END IF 
 ON ERROR GOTO a1002051 
 IF Information.maadr LIKE "vertr*" THEN 
   f.agentur.Backcolor = 2
 ELSE 
   f.agentur.Backcolor = 189
 END IF 
a1002051: 
 ON ERROR GOTO ErrorHandler
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' Adressen - Briefanrede generieren
 ' ======================================================================
 ' Zweck:       generiert Briefanrede
 ' Nutzung:     CALL ADRAnrede()
 ' ======================================================================
 
SUB ADRAnrede()
 IF Briefanrede.GAdrDat$ = "" THEN 
   SELECT CASE UCASE$ ( LEFT$ (anrede.GAdrDat$,3))
   CASE "HER"
     briefanrede.GAdrDat$ = "Sehr geehrter Herr " + nachname.GAdrDat$ + ","
     
   CASE "FRA","FR."
     briefanrede.GAdrDat$ = "Sehr geehrte Frau " + nachname.GAdrDat$ + ","
   CASE "FRé","FRL"
     briefanrede.GAdrDat$ = "Sehr geehrtes FrÑulein " + nachname.GAdrDat$ + ","
   CASE "FA.","FIR",""
     briefanrede.GAdrDat$ = "Sehr geehrte Damen und Herren,"
   CASE "FAM"
     briefanrede.GAdrDat$ = "Sehr geehrte Familie " + nachname.GAdrDat$ + ","
   CASE "EHE"
     briefanrede.GAdrDat$ = "Sehr geehrte Eheleute " + nachname.GAdrDat$ + ","
   CASE ELSE 
     briefanrede.GAdrDat$ = "Sehr geehrte Damen und Herren,"
   END SELECT 
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' Adressen - Postleitzahl ermitteln
 ' ======================================================================
 
FUNCTION GetPLZ$(PLZOrt$,PLZStrasse$)
 DIM StrListe$(400)
 tmpStrasse$ = PLZStrasse$
 IF PLZStrasse$ LIKE "*strasse*" OR PLZStrasse$ LIKE "*stra·e*" THEN 
   fpos% = INSTR ( UCASE$ (PLZStrasse$),"STRA")
   IF fpos% <> 1 THEN 
     tmpStrasse$ = LEFT$ (PLZStrasse$,fpos% + 2)
   END IF 
 END IF 
 cdir$ = DIRECTORY 
 DIRECTORY _netpath$
 i% = CALL ("SUCHEN","",PLZOrt$,tmpStrasse$,0, VAL ( FN numeric(PLZStrasse$)))
 _PLZ$ = CALL ("GETPLZ")
 GetPLZ$ = _PLZ$
 PSTR$ = CALL ("GETSTR")
 _str$ = PSTR$
 strfound% = 0
 StrListe$(strfound%) = PSTR$ + " [" + _PLZ$ + "]"
 WHILE PSTR$ = _STR$ AND PLZStra·e$ <> ""
   i% = CALL ("SWEITER")
   PSTR$ = CALL ("GETSTR")
   IF PSTR$ = _STR$ THEN 
     strfound% = strfound% + 1
     _PLZ$ = CALL ("GETPLZ")
     StrListe$(strfound%) = PSTR$ + " [" + _PLZ$ + "]"
   END IF 
 WEND 
 IF strfound% > 0 THEN 
   CREATE DIALOG "PLZ",0,0,304,161,title$,"MS Sans Serif",8
   ADD DIALOG "PLZ",4,0,0,302,137,0,""
   ADD DIALOG "PLZ",9,8,8,20,22,2
   ADD DIALOG "PLZ",5,32,8,230,9,0,"Zur aktuellen Adresse wurden mehrere Postleitzahlen gefunden."
   ADD DIALOG "PLZ",5,32,17,180,8,0,"Bitte wÑhlen Sie die zutreffende Postleitzahl aus:"
   ADD DIALOG "PLZ",7,31,29,263,90,0,0,StrListe$,Auswahl$
   ADD DIALOG "PLZ",1,93,142,55,15,1,"&OK",1,1
   ADD DIALOG "PLZ",1,150,142,55,15,0,"&Abbrechen",0,0
   DIALOG "PLZ",req%
   REMOVE DIALOG "PLZ"
   IF req% = 1 THEN 
     _PLZ$ = MID$ (Auswahl$(0), LEN (Auswahl$(0)) - 5,5)
     GetPLZ$ = _PLZ$
   ELSE 
     GetPLZ$ = ""
   END IF 
 END IF 
 DIRECTORY cdir$
 MOUSE ON 
 END FUNCTION 
 
 
 
 ' Postleitzahl suchen
 ' ====================================================================== 
 
SUB ADRPLZTest()
 IF plzfound% = 1 THEN 
   SET STATUS "PLZ wird ermittelt..."
   MOUSE OFF 
   REM IF PLZ.GAdrDat$ = "" THEN PLZ.GAdrDat$ = GetPLZ$(ort.GAdrDat$,stra·e.GAdrDat$)
   FORM 
   MOUSE ON 
   SET STATUS "Bereit"
 END IF 
 END SUB 
 
  
 ' Postleitzahl ergÑnzen
 ' ====================================================================== 
 ' mu· aus KompatibilitÑtsgrÅnden beibehalten werden!
 
SUB ADROrtTest()
 END SUB 
 

SUB ADRImport()
  ok% = 1
  IF MNdisabled%("SUPERVISOR") THEN 
    CALL Fehler("Keine Zugangsberechtigung!","AusfÅhrung nur durch Supervisor mîglich!")
    ok% = - 1
  END IF 
  IF ok% = - 1 THEN END SUB 
  REQUEST "Haben alle anderen Nutzer die Anwendung geschlossen?","",130,req%
  IF req% <> 1 THEN 
    REQUEST "Import kann nur durchgefÅhrt werden,","wenn alle Nutzer die Anwendung verlassen haben",2
    ok% = - 1
  END IF 
 IF ok% = - 1 THEN END SUB 
 CALL DFile(2,"OFFICE\keywords" + _fpw$)
 REM IF EXISTS (_remotepath$ + "impoadr.dbd") THEN 
 END IF 
 REQUEST "Wollen Sie den Import aus der Datei " + _netpath$ + "IMPOADR.DBF beginnen ? ","",130,req%
 REM dateiname$ = "Impoadr.dbf"
 REM REQUEST "Import aus dBase - Datei..."," ",26,req%,dateiname$
 IF req% <> 1 THEN END SUB 
 MOUSE ON 
 CALL DFile(2,"impoadr.dbf")
 REM OPEN FILE SHARE "C:\CODIDEFA\FACTURA\IMPOADR.DBF"
 REQUEST "Soll die Kundennummer automatisch erzeugt werden ?","JA=Erzeugung/ NEIN=öbernahme der Kundennummer KUNDENNUMM aus IMPOADR.DBF",130,req%
 FILE "impoadr"
 SELECT FIRST 
 i% = 0
 zzz% = 0
 MOUSE OFF 
 WHILE NOT EOF ("impoadr")
   zzz% = zzz% + 1
   FILE GAdrDat$
   BLANK 
   codeku1% = SER (GAdrDat$,1)
   codeku.GAdrDat$ = codeku1%
   REM nnum% = VAL (ReadConfig$("NUMMERN","LASTKundennummer")) + 1
   REM CALL WriteConfig("NUMMERN","LASTKundennummer", LTRIM$ ( STR$ (nnum%,"999999")))
   IF GADRDat$ LIKE "ADRESSEN" THEN 
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LastKunr.stamm + 1
       LastKunr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (KUNRPREFIX.stamm)
   ELSE 
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LastIntnr.stamm + 1
       LastIntnr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       prefix$ = LTRIM$ (INTPREFIX.stamm)
   END IF 
   IF req% = 1 THEN 
     kundennummer.GAdrDat$ = "IMPO" + LTRIM$ ( STR$ (nnum%,"999999"))
   ELSE 
     kundennummer.GAdrDat$ = LTRIM$ ( LEFT$ (kundennumm.impoadr,20))
   END IF 
   debitorkto.GAdrDat$ = STR$ (nnum%,"99999")
   stichwort$ = stichwort.impoadr
   IF stichwort$ <> "" THEN 
     stichwort.GAdrDat$ = stichwort$ + ",IMPOADR" + DATE$ ( TODAY ,"0dmmyyyy")
   ELSE 
     stichwort.GAdrDat$ = "IMPOADR" + DATE$ ( TODAY ,"0dmmyyyy")
   END IF 
   stich$ = stichwort.GAdrDat$
   anrede.GAdrDat$ = LEFT$ (anrede.impoadr,20)
   nachname.GAdrDat$ = LEFT$ (nachname.impoadr,50)
   vorname.GAdrDat$ = LEFT$ (vorname.impoadr,50)
   geburtsname.GAdrDat$ = LEFT$ (geburtsnam.impoadr,50)
   stra·e.GAdrDat$ = LEFT$ (stra·e.impoadr,50)
   plz.GAdrDat$ = LEFT$ (plz.impoadr,8)
   ort.GAdrDat$ = LEFT$ (ort.impoadr,50)
   geburtstag.GAdrDat$ = geburtstag.impoadr
   k1bank.GAdrDat$ = LEFT$ (k1bank.impoadr,50)
   k1blz.GAdrDat$ = LEFT$ (k1blz.impoadr,8)
   k1konto.GAdrDat$ = LEFT$ (k1konto.impoadr,10)
   k2bank.GAdrDat$ = LEFT$ (k2bank.impoadr,50)
   k2blz.GAdrDat$ = LEFT$ (k2blz.impoadr,8)
   k2konto.GAdrDat$ = LEFT$ (k2konto.impoadr,10)
   kunde_seit.GAdrDat$ = kunde_seit.impoadr
   letzter_Kontakt.GAdrDat$ = letzter_ko.impoadr
   notiz.GAdrDat$ = notiz.impoadr
 
     IF Postanschrift.GAdrDat$ = "" THEN 
       p$ = ""
       IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
         p$ = Anrede.GAdrDat$
         IF LTRIM$ (Titel.GAdrDat$) <> "" THEN 
           p$ = p$ + " " + LTRIM$ (Titel.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (Vorname.GAdrDat$) + " " + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10)
         p$ = p$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
       ELSE 
         p$ = Anrede.GAdrDat$ + CHR$ (13) + CHR$ (10)
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (nachname.GAdrDat$) + " " + LTRIM$ (vorname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10)
         p$ = p$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
       END IF 
       Postanschrift.GAdrDat$ = p$
     END IF 
   zero.GAdrDat$ = 0
   QNachname.GAdrDat$ = VSNRPack$(nachname.GAdrDat$)
   QVorname.GAdrDat$ = VSNRPack$(vorname.GAdrDat$)
   QOrt.GAdrDat$ = VSNRPack$(Ort.GAdrDat$)
   QStra·e.GAdrDat$ = VSNRPack$(Stra·e.GAdrDat$)
   QPLZ.GAdrDat$ = VSNRPack$(PLZ.GAdrDat$)
   QGeburtsname.GAdrDat$ = VSNRPack$(Geburtsname.GAdrDat$)
   IF Workstation% > 0 THEN Workstation.GAdrDat$ = Workstation%
   IF Workstation% > 0 THEN QWoNo.GAdrDat$ = STR$ (Workstation%,"000000") + STR$ (codeku.GAdrDat$,"000000")
   RecStatus.GAdrDat$ = "c"
 
   STORE FILE GAdrDat$
   UNLOCK CURRENT FILE GADRDat$
   UNLOCK FILE GADRDat$
   SET STATUS "Anzahl importierter Adressen: " + STR$ (zzz%,"999999")
   FILE GTelDat$
   IF telefon1.impoadr <> "" THEN 
     BLANK 
     codetel.GTelDat$ = SER (GTelDat$,1)
     codeku.GTelDat$ = codeku1%
     art.GTelDat$ = "Telefon1"
     nummer.GTelDat$ = telefon1.impoadr
     fonoderfax = "n"
     IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
     IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     STORE FILE GTelDat$
     UNLOCK CURRENT FILE GTelDat$
     UNLOCK FILE GTelDat$
   END IF 
   IF telefon2.impoadr <> "" THEN 
     BLANK 
     codetel.GTelDat$ = SER (GTelDat$,1)
     codeku.GTelDat$ = codeku1%
     art.GTelDat$ = "Telefon2"
     nummer.GTelDat$ = telefon2.impoadr
     fonoderfax = "n"
     IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
     IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     STORE FILE GTelDat$
     UNLOCK CURRENT FILE GTelDat$
     UNLOCK FILE GTelDat$
   END IF 
   IF telefax.impoadr <> "" THEN 
     BLANK 
     codetel.GTelDat$ = SER (GTelDat$,1)
     codeku.GTelDat$ = codeku1%
     art.GTelDat$ = "Telefax"
     nummer$ = telefax.impoadr
     nummer.GTelDat$ = telefax.impoadr
     fonoderfax = "j"
     IF Workstation% > 0 THEN Workstation.GTelDat$ = Workstation%
     IF Workstation% > 0 THEN QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     STORE FILE GTelDat$
     UNLOCK CURRENT FILE GTelDat$
     UNLOCK FILE GTelDat$
   END IF 
   i% = i% + 1
   SET STATUS "importierte Anzahl:" + STR$ (i%,"000000")
   FILE "impoadr"
   SELECT NEXT 
 WEND 
 CLOSE FILE "IMPOADR"
 FILE "keywords"
 IF NOT EXISTS (stich$,keyword.keywords) THEN 
   BLANK 
   keyword.keywords = LEFT$ (stich$,30)
   CALL FStore("keywords")
 END IF 
 SET STATUS "MenÅ"
 REQUEST "Adress-Import beendet!","importierte Anzahl:" + STR$ (i%,"000000"),2
 SET STATUS ""
 FILE GTelDat$
 INDEX codeku.GTelDat$
 SELECT FORM KEY codeku1% FILE GTelDat$ INDEX codeku.GTelDat$
 FILE GAdrDat$
 SELECT FORM KEY codeku1% FILE GAdrDat$ INDEX codeku.GAdrDat$
 FORM 
 MOUSE ON 
 END SUB 
 
 
SUB ADRExport()
 ok% = 0
 cdir$ = DIRECTORY 
 IF disabled%("ADREXPORT") THEN END SUB 
 REQUEST "Wollen Sie ausgewÑhlte Adressen in eine dBASE III/IV-Datei exportieren?","",130,req%
 IF req% = 1 THEN 
   MOUSE OFF 
   FILE GAdrDat$
   INDEX nachname.GAdrDat$
   SELECT WHERE ASK 
   bedingung$ = WHERE 
   IF bedingung$ = "" THEN bedingung$ = "codeku>0"
   SET ANSICONVERT OFF 
   FILE GTelDat$
   INDEX codeku.GTelDat$
   UPDATE fonoderfax.GTelDat$ = "j" WHERE UCASE$ (Art.GTelDat$) LIKE "FAX*" OR UCASE$ (Art.GTelDat$) LIKE "*FAX*"
   END UPDATE 
   UPDATE fonoderfax.GTelDat$ = "n" WHERE UCASE$ (Art.GTelDat$) LIKE "FON*" OR UCASE$ (Art.GTelDat$) LIKE "*FON*"
   END UPDATE 
   CLOSE FILE GTelDat$
   CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
   FILE GTelDat$
   INDEX codeku.GTelDat$
   SELECT FIRST 
   FILE GAdrDat$
   INDEX codeku.GAdrDat$
   SELECT FIRST LOCK 
   WHILE NOT EOF (GAdrDat$)
      codeku% = codeku.GAdrDat$
      IF EXISTS (codeku%,codeku.GTelDat$) THEN 
        fax% = 0
        tel1% = 0
        tel2% = 0
        telefon1.GAdrDat$ = ""
        telefon2.GAdrDat$ = ""
        telefax.GAdrDat$ = ""
        BTX.GAdrDat$ = ""
        autotelefon.GAdrDat$ = ""
        SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
        IF FonoderFax.GTelDat$ <> "j" THEN 
          telefon1.GAdrDat$ = nummer.GTelDat$
          tel1% = 1
        ELSE 
          telefax.GAdrDat$ = nummer.GTelDat$
          fax% = 1
        END IF 
        SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
        IF codeku.GTelDat$ = codeku% THEN 
          IF FonoderFax.GTelDat$ <> "j" THEN 
            IF tel1% = 1 THEN 
              telefon2.GAdrDat$ = nummer.GTelDat$
              tel2% = 1
            ELSE 
              telefon1.GAdrDat$ = nummer.GTelDat$
              tel1% = 1
            END IF 
          ELSE 
            IF fax% <> 1 THEN 
              telefax.GAdrDat$ = nummer.GTelDat$
              fax% = 1
            END IF 
          END IF 
        END IF 
        SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
        IF codeku.GTelDat$ = codeku% THEN 
          IF FonoderFax.GTelDat$ <> "j" THEN 
            IF tel1% = 1 AND tel2% <> 1 THEN 
              telefon2.GAdrDat$ = nummer.GTelDat$
              tel2% = 1
            ELSE 
              IF tel1% <> 1 THEN 
                telefon1.GAdrDat$ = nummer.GTelDat$
                tel1% = 1
              END IF 
            END IF 
          ELSE 
            IF fax% <> 1 THEN 
              telefax.GAdrDat$ = nummer.GTelDat$
              fax% = 1
            END IF 
          END IF 
        END IF 
      END IF 
      FILE GAdrDat$
      IF Workstation% > 0 THEN Workstation.GAdrDat$ = Workstation%
      IF Workstation% > 0 THEN QWoNo.GAdrDat$ = STR$ (Workstation%,"000000") + STR$ (codeku.GAdrDat$,"000000")
      RecStatus.GAdrDat$ = "c"
      STORE FILE GAdrDat$
      UNLOCK CURRENT FILE GAdrDat$
      UNLOCK FILE GAdrDat$
      SELECT NEXT LOCK FILE GAdrDat$
   WEND 
   OPEN FIELDS Kundennummer,Anrede,Nachname,Vorname,Geburtsname,Stra·e,PLZ,Ort,Telefon1,Telefon2,Telefax,Geburtstag,K1Bank,K1BLZ,K1Konto,K2Bank,K2BLZ,K2Konto,Kunde_seit,letzter_Kontakt,Stichwort,Notiz 
   OPEN FIELDS ASK 
   cdir$ = DIRECTORY 
   DIRECTORY _netpath$
   dateiname$ = "EXPOADR.DBF"
   REQUEST "Export nach dBase..."," ",27,req%,dateiname$
   IF req% = 1 THEN 
     befehl$ = "EXPORT FILE " + CHR$ (34) + GAdrDat$ + CHR$ (34) + CHR$ (34) + dateiname$ + CHR$ (34) + " WHERE " + bedingung$ + " USING " + CHR$ (34) + "3" + CHR$ (34)
     EXECUTE befehl$
     REQUEST "Adress-Export beendet!","",2
   END IF 
 END IF 
 FILE GAdrDat$
 SELECT WHERE 
 CLOSE FIELDS 
 DIRECTORY cdir$
 MOUSE ON 
 END SUB 
 

FUNCTION GetTelno$(codeku%)
 MOUSE OFF 
 Kundennummer% = codeku%
 cfile$ = FILE 
 DIM Auswahl1$(1)
 Voicedial$ = ReadINI$("MODEM","VoiceDial")
 FaxDial$ = ReadINI$("System","FAXavailable")
 VoiceISDNdial$ = ReadINI$("SYSTEM","VoiceISDNdial")
 DIM Telefonliste$(120)
 ok% = - 1
 WHILE ok%
   MOUSE OFF 
   SELECT KEY Kundennummer% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   FILE GTelDat$
   INDEX CodeKU
   SELECT FIRST 
   SELECT KEY Kundennummer%
   a% = 0
   prompt$ = "ZZZZZZ"
   WHILE CodeKU.GTelDat$ = Kundennummer% AND NOT EOF (GTelDat$)
     IF kart1.GTELDAT$ LIKE "FAX" THEN 
       Telefonliste$(a%) = Art.GTelDat$ + ", " + Nummer.GTelDat$ + "," + KART1.GTelDat$ + "," + Kart2.GTelDat$ + SPACE$ (80) + STR$ (CodeTEL.GTelDat$,"000000")
       IF Telefonliste$(a%) < prompt$ THEN prompt$ = Telefonliste$(a%)
       a% = a% + 1
     END IF 
     SELECT NEXT 
   WEND 
   TelefonListe$(a%) = ""
   Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
   CREATE DIALOG GTelDat$,0,0,350,179,"Faxnummern - Liste","MS Sans Serif",8
   ADD DIALOG GTelDat$,5,5,6,56,10,0,"von:"
   ADD DIALOG GTelDat$,5,62,6,174,9,128,Kunde$
   ADD DIALOG GTelDat$,5,5,22,65,10,0,"Art/&Telefonnummer:"
   ADD DIALOG GTelDat$,7,5,32,275,137,2,2,Telefonliste$,Auswahl$,prompt$
   ADD DIALOG GTelDat$,1,287,32,55,15,1,"&OK",1,1
   ADD DIALOG GTelDat$,1,287,50,55,15,0,"&Abbrechen",0,0
   MOUSE ON 
   DIALOG GTelDat$,req%
   REMOVE DIALOG GTelDat$
   IF req% = 1 THEN 
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY telnr% FILE GTelDat$ INDEX CodeTEL.GTelDat$
     GetTelno$ = Nummer.GTelDat$
   ELSE 
     GetTelno$ = ""
   END IF 
 END FUNCTION 
 
 
SUB TelefonListe(Kundennummer%)
 MOUSE OFF 
 cfile$ = FILE 
 DIM Auswahl1$(1)
 Voicedial$ = ReadINI$("MODEM","VoiceDial")
 FaxDial$ = ReadINI$("System","FAXavailable")
 VoiceISDNdial$ = ReadINI$("SYSTEM","VoiceISDNdial")
 DIM Telefonliste$(300)
 ok% = - 1
 
 WHILE ok%
   GCodieRuf1% = 0
   MOUSE OFF 
   SELECT KEY Kundennummer% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   FILE GTelDat$
   INDEX CodeKU
   SELECT FIRST 
   SELECT KEY Kundennummer%
   a% = 0
   prompt$ = "ZZZZZZ"
   WHILE CodeKU.GTelDat$ = Kundennummer% AND NOT EOF (GTelDat$)
     Telefonliste$(a%) = Art.GTelDat$ + ", " + Nummer.GTelDat$ + "," + KART1.GTelDat$ + "," + Kart2.GTelDat$ + SPACE$ (80) + STR$ (CodeTEL.GTelDat$,"000000")
     IF Telefonliste$(a%) < prompt$ THEN prompt$ = Telefonliste$(a%)
     IF GCODIE% = - 1 THEN 
       IF GCodieRuf1% = 0 THEN CALL SearchInitTelA("TELEFON")
     END IF 
     IF GCODIE% = - 1 THEN CALL SearchVorbTelA("TELEFON")
 
     a% = a% + 1
     SELECT NEXT 
   WEND 
   IF a% > 0 THEN 
     IF GCODie% = - 1 THEN 
       req3% = CALL ("_SearchShow",c$)
       REM req3=27 Nummer Ñndern
       REM req3=28 Nummer neu
       REM req3=29 Nummer lîschen
       REM CALL Fehler( STR$ (req3%,"99"),c$)
       IF req3% = 27 AND VAL (c$) <> 0 THEN 
         kn% = Codeku.GAdrDat$
         telnr% = VAL (c$)
         IF telnr% > 0 THEN 
           codetel% = telnr%
           REM Nummer Ñndern/anzeigen
           req% = 4
         END IF 
       END IF 
       IF req3% = 28 THEN 
         req% = 3
       END IF 
       IF req3% = 29 AND VAL (c$) <> 0 THEN 
         kn% = Codeku.GAdrDat$
         telnr% = VAL (c$)
         IF telnr% > 0 THEN 
           codetel% = telnr%
           REM Nummer Ñndern/anzeigen
           req% = 5
         END IF 
       END IF 
     ELSE 
          TelefonListe$(a%) = ""
          Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
          CREATE DIALOG GTelDat$,0,0,350,179,"Telefonliste","MS Sans Serif",8
          ADD DIALOG GTelDat$,5,5,6,56,10,0,"Telefonliste von:"
          ADD DIALOG GTelDat$,5,62,6,280,20,128,Kunde$
          ADD DIALOG GTelDat$,5,5,22,65,10,0,"Art/&Telefonnummer:"
          ADD DIALOG GTelDat$,7,5,32,275,137,2,2,Telefonliste$,Auswahl$,prompt$
          ADD DIALOG GTelDat$,1,287,32,55,15,1,"&OK",1,1
          ADD DIALOG GTelDat$,1,287,50,55,15,0,"&Abbrechen",0,0
          IF VoiceDial$ LIKE "true" OR FaxDial$ LIKE "true" THEN ADD DIALOG GTelDat$,1,287,80,55,15,0,"&WÑhlen",2,1
          IF GADRDat$ LIKE "ADRESS*" THEN 
            IF ag$ <> "j" THEN 
              ADD DIALOG GTelDat$,1,287,98,55,15,0,"&Neu",3,1
              IF a% <> 0 THEN ADD DIALOG GTelDat$,1,287,116,55,15,0,"én&dern",4,1
              ADD DIALOG GTelDat$,1,287,134,55,15,0,"&Lîschen",5,1
            END IF 
          ELSE 
            ADD DIALOG GTelDat$,1,287,98,55,15,0,"&Neu",3,1
            IF a% <> 0 THEN ADD DIALOG GTelDat$,1,287,116,55,15,0,"én&dern",4,1
            ADD DIALOG GTelDat$,1,287,134,55,15,0,"&Lîschen",5,1
          END IF 
          MOUSE ON 
          DIALOG GTelDat$,req%
          REMOVE DIALOG GTelDat$
        END IF 
   
   SELECT CASE req%
   CASE 1,0
     ok% = 0
   CASE 2
     kn% = Codeku.GAdrDat$
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY telnr% FILE GTelDat$ INDEX CodeTEL.GTelDat$
     IF FonOderFax.GTelDat$ LIKE "j" OR art.GTelDat$ LIKE "*fax*" THEN 
       IF FaxDial$ LIKE "true" THEN 
         CALL FAX(Nummer.GTelDat$)
       ELSE 
         CALL Fehler("Der Faxversand wurde nicht konfiguriert!","")
       END IF 
     ELSE 
       IF VoiceDial$ LIKE "true" THEN 
         IF VoiceISDNdial$ LIKE "TEDAS" THEN 
           tn$ = FN numeric(Nummer.GTelDat$)
           ON ERROR GOTO end2605984
           APPACTIVATE "HANDY"
           SENDKEYS "{HOME}"
           SENDKEYS "++{END}"
           SENDKEYS "{DELETE}"
           SENDKEYS tn$
           ok% = 0
           REM SENDKEYS "%V" + tn$
           REM SENDKEYS "%b"
         ELSE 
           CALL Telefon(Nummer.GTelDat$)
         END IF 
       ELSE 
         CALL Fehler("Die Telefonwahl wurde nicht konfiguriert!","")
       END IF 
     END IF 
     GOTO end2605983
end2605984: 
     CALL Fehler("Das Tedas Telefonprogramm wurde noch nicht aufgerufen!","")
     ON ERROR GOTO ErrorHandler
end2605983: 
   CASE 3
     REM Nummer neu
     Nummer$ = ""
     Art$ = ""
     Auswahl$ = "FON"
     Auswahl1$ = "k.A."
     IF GCODie% <> - 1 THEN 
       CREATE DIALOG GTelDat$,0,0,350,200,"Telefonliste (Eintrag Neu)","MS Sans Serif",8
       ADD DIALOG GTelDat$,5,5,6,56,10,0,"Telefonliste von:"
       ADD DIALOG GTelDat$,6,54,144,220,11,0,0,Art$,100
       ADD DIALOG GTelDat$,6,54,156,220,10,0,0,Nummer$,100
       REM ADD DIALOG GTelDat$,2,186,144,52,9,0,"Fax ?","j","n",FonOrFax$
       ADD DIALOG GTelDat$,5,62,6,280,20,128,Kunde$
       ADD DIALOG GTelDat$,5,5,22,65,10,0,"Art/Telefonnummer:"
       ADD DIALOG GTelDat$,7,5,32,270,81,2,2,Telefonliste$,Auswahl$,prompt$
       ADD DIALOG GTelDat$,1,287,32,54,14,1,"&OK",1,1
       ADD DIALOG GTelDat$,1,287,49,54,16,0,"&Abbrechen",0,0
       ADD DIALOG GTelDat$,5,5,121,156,21,0,"Bitte geben Sie die Daten ein."
       ADD DIALOG GTelDat$,5,5,145,45,10,0,"A&rt:"
       ADD DIALOG GTelDat$,5,5,156,45,10,0,"&Nummer:"
       ADD DIALOG GTelDat$,5,5,170,45,10,0,"Merkmal1:"
       ADD DIALOG GTelDat$,8,54,168,48,48,259,2,Auswahl$,GAutoKArt1$
       ADD DIALOG GTelDat$,5,109,170,45,10,0,"Merkmal2:"
       ADD DIALOG GTelDat$,8,144,168,48,48,259,2,Auswahl1$,GAutoKArt2$
       DIALOG GTelDat$,req%
       REMOVE DIALOG GTelDat$
     ELSE 
       CREATE DIALOG GTelDat$,0,0,350,80,"Telefonliste (Eintrag neu)","MS Sans Serif",8
       ADD DIALOG GTelDat$,6,54,24,220,11,0,0,Art$,100
       ADD DIALOG GTelDat$,6,54,36,220,10,0,0,Nummer$,100
       ADD DIALOG GTelDat$,1,287,22,54,14,1,"&OK",1,1
       ADD DIALOG GTelDat$,1,287,39,54,16,0,"&Abbrechen",0,0
       ADD DIALOG GTelDat$,5,5,11,290,11,0,"Bitte geben Sie die gewÅnschten Informationen ein."
       ADD DIALOG GTelDat$,5,5,25,45,10,0,"A&rt:"
       ADD DIALOG GTelDat$,5,5,36,45,10,0,"&Nummer:"
       ADD DIALOG GTelDat$,5,5,51,45,10,0,"Merkmal1:"
       ADD DIALOG GTelDat$,8,54,48,48,48,259,2,Auswahl$,GAutoKArt1$
       ADD DIALOG GTelDat$,5,109,51,45,10,0,"Merkmal2:"
       ADD DIALOG GTelDat$,8,144,48,48,48,259,2,Auswahl1$,GAutoKArt2$
       DIALOG GTelDat$,req%
       REMOVE DIALOG GTelDat$
     END IF 
     IF req% = 1 THEN 
       BLANK FILE GTelDat$
       CodeTEL.GTelDat$ = SER (GTelDat$,1)
       Art.GTelDat$ = Art$
       Nummer.GTelDat$ = Nummer$
       CodeKU.GTelDat$ = Kundennummer%
       Kart1.GtelDat$ = Auswahl$
       Kart2.GtelDat$ = Auswahl1$
       IF Kart1.GtelDat$ = "FAX" THEN 
         FonOderFax.GTelDat$ = "j"
       ELSE 
         FonOderFax.GTelDat$ = "n"
       END IF 
       CALL FStore(GTelDat$)
       SELECT FORM KEY Kundennummer% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       FORM 
     END IF 
   CASE 4
     IF GCODie% <> - 1 THEN 
       prompt$ = Auswahl$(0)
       telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     END IF 
     SELECT KEY telnr% FILE GTelDat$ INDEX CodeTEL.GTelDat$
     Art$ = Art.GTelDat$
     Nummer$ = Nummer.GTelDat$
     Auswahl$ = KART1.GTelDat$
     Auswahl1$ = KART2.GTelDat$
     IF GCODie% <> - 1 THEN 
       CREATE DIALOG GTelDat$,0,0,350,200,"Telefonliste (Eintrag Ñndern)","MS Sans Serif",8
       ADD DIALOG GTelDat$,5,5,6,56,10,0,"Telefonliste von:"
       ADD DIALOG GTelDat$,6,54,144,220,11,0,0,Art$,100
       ADD DIALOG GTelDat$,6,54,156,220,10,0,0,Nummer$,100
       ADD DIALOG GTelDat$,5,62,6,280,20,128,Kunde$
       ADD DIALOG GTelDat$,5,5,22,65,10,0,"Art/Telefonnummer:"
       ADD DIALOG GTelDat$,7,5,32,270,81,2,2,Telefonliste$,Auswahl$,prompt$
       ADD DIALOG GTelDat$,1,287,32,54,14,1,"&OK",1,1
       ADD DIALOG GTelDat$,1,287,49,54,16,0,"&Abbrechen",0,0
       ADD DIALOG GTelDat$,5,5,121,156,21,0,"Bitte geben Sie die gewÅnschten énderungen fÅr den gewÑhlten Eintrag ein."
       ADD DIALOG GTelDat$,5,5,145,45,10,0,"A&rt:"
       ADD DIALOG GTelDat$,5,5,156,45,10,0,"&Nummer:"
       ADD DIALOG GTelDat$,5,5,170,45,10,0,"Merkmal1:"
       ADD DIALOG GTelDat$,8,54,168,48,48,259,2,Auswahl$,GAutoKArt1$
       ADD DIALOG GTelDat$,5,109,170,45,10,0,"Merkmal2:"
       ADD DIALOG GTelDat$,8,144,168,48,48,259,2,Auswahl1$,GAutoKArt2$
       DIALOG GTelDat$,req%
       REMOVE DIALOG GTelDat$
     ELSE 
       CREATE DIALOG GTelDat$,0,0,350,80,"Telefonliste (Eintrag Ñndern)","MS Sans Serif",8
       ADD DIALOG GTelDat$,6,54,24,220,11,0,0,Art$,100
       ADD DIALOG GTelDat$,6,54,36,220,10,0,0,Nummer$,100
       ADD DIALOG GTelDat$,1,287,22,54,14,1,"&OK",1,1
       ADD DIALOG GTelDat$,1,287,39,54,16,0,"&Abbrechen",0,0
       ADD DIALOG GTelDat$,5,5,11,290,11,0,"Bitte geben Sie die gewÅnschten énderungen fÅr den gewÑhlten Eintrag ein."
       ADD DIALOG GTelDat$,5,5,25,45,10,0,"A&rt:"
       ADD DIALOG GTelDat$,5,5,36,45,10,0,"&Nummer:"
       ADD DIALOG GTelDat$,5,5,51,45,10,0,"Merkmal1:"
       ADD DIALOG GTelDat$,8,54,48,48,48,259,2,Auswahl$,GAutoKArt1$
       ADD DIALOG GTelDat$,5,109,51,45,10,0,"Merkmal2:"
       ADD DIALOG GTelDat$,8,144,48,48,48,259,2,Auswahl1$,GAutoKArt2$
       DIALOG GTelDat$,req%
       REMOVE DIALOG GTelDat$
     END IF 
     IF req% = 1 THEN 
       SELECT KEY telnr% LOCK FILE GTelDat$ INDEX CodeTEL.GTelDat$
       Art.GTelDat$ = Art$
       Nummer.GTelDat$ = Nummer$
       Kart1.GtelDat$ = Auswahl$
       Kart2.GtelDat$ = Auswahl1$
       IF Kart1.GtelDat$ = "FAX" THEN 
         FonOderFax.GTelDat$ = "j"
       ELSE 
         FonOderFax.GTelDat$ = "n"
       END IF 
       CALL FStore(GTelDat$)
       SELECT FORM KEY Kundennummer% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       FORM 
     END IF 
   CASE 5
     REM lîschen
     IF GCODie% <> - 1 THEN 
       telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     END IF 
     SELECT KEY telnr% LOCK FILE GTelDat$ INDEX CodeTEL.GTelDat$
     REM CALL Fehler("Es soll der Eintrag" + Art.GTelDat$,"gelîscht werden!")
     nrrr$ = LEFT$ (Art.GTelDat$,20)
     REQUEST nrrr$,"Wirklich lîschen?",135,req%
     IF req% = 1 THEN 
       SELECT REMOVE FILE GTelDat$
       SELECT FORM KEY Kundennummer% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       FORM 
     END IF 
   END SELECT 
 WEND 
 FILE cfile$
 END SUB 

SUB VoiceDial1()
 Voicedial$ = ReadINI$("MODEM","VoiceDial")
 VoicePrg$ = ReadINI$("SYSTEM","VoiceWindowName")
 FaxDial$ = ReadINI$("System","FAXavailable")
 VoiceISDNdial$ = ReadINI$("SYSTEM","VoiceISDNdial")
 ESTOSTAPIDIAL$ = ReadINI$("SYSTEM","ESTOSTAPIDIAL")
 IF Nummer.GTeldat$ LIKE "*www*" OR Nummer.GTeldat$ LIKE "www*" OR Nummer.GTeldat$ LIKE "htt*" OR KArt1.GTeldat$ LIKE "www*" THEN 
   IF NOT EXISTS (GMACodeDir$ + "openurl.exe") THEN COPY _netpath$ + "local\openurl.exe" TO GMACodeDir$ + "openurl.exe"
   IF LEFT$ (Nummer.GTeldat$,3) LIKE "www" THEN 
     nr$ = "http://" + Nummer.GTeldat$
   END IF 
   IF LEFT$ (Nummer.GTeldat$,4) LIKE "http" THEN 
     nr$ = Nummer.GTeldat$
   END IF 
   prg$ = GMACodeDir$ + "openurl.exe"
   REM nr$ = "http://" + Nummer.GTeldat$
   REM a% = CALL ("_OpenUrl",nr$)
   IF EXISTS (GMACodeDir$ + "opurl.bat") THEN DELETE GMACodeDir$ + "opurl.bat"
   OPEN GMACodeDir$ + "opurl.bat" FOR APPEND 
   ? "echo OFF"
   ? prg$ + " " + nr$
   CLOSE OUTPUT 
   REM a% = CALL ("ShellExecute",0,"open",prg$,nr$,"",1)
   REM a% = CALL ("ShellExecute",0,"open",netpath$ + "opurl.bat","","",1)
   CALL (GMACodeDir$ + "opurl.bat"),0
   GOTO end040520031
 END IF 
 IF GCODie% AND Nummer.GTeldat$ <> "" THEN 
   IF Nummer.GTeldat$ LIKE "*@*" THEN 
     CALL SendEMAIL(Nummer.GTeldat$,codeku.GTelDat$)
     GOTO end040520031
   ELSE 
    tel$ = ""
    IF LEFT$ (Nummer.TELEFON,1) = "+" THEN tel$ = "00"
    tn$ = tel$ + FN numeric(Nummer.TELEFON)
    REM CALL Fehler(tn$,"ESTOS")
    IF ESTOSTAPIDIAL$ LIKE "TRUE" AND LTRIM$ (tn$) <> "" THEN 
      aufruf$ = ESTOSTAPIDIAL$ + tn$
      aufruf$ = _netpath$ + "local\dialit32.exe"
      par1$ = " phone:" + tn$
      ges$ = aufruf$ + par1$
      REM a% = CALL ("_SBFileCall",ges$)
      REM  i% = CALL ("ShellExecute",0,"open",ges$,"","",1)
      CALL (ges$)
    ELSE 
      REM   CALL Fehler("","")
      APPACTIVATE "ProCall"
      COPY FROM tn$
    END IF 
    REM SENDKEYS "{HOME}"
    REM SENDKEYS "++{END}
    REM SENDKEYS "{DELETE}"
    REM SENDKEYS tn$
   END IF 
 ELSE 
   IF Nummer.GTeldat$ LIKE "*@*" THEN 
     CALL Fehler("EMAIL-Versandt wurde nicht konfiguriert!","")
   END IF 
 END IF 
 IF FonOderFax.TELEFON LIKE "j" OR art.telefon LIKE "*fax*" THEN 
   IF FaxDial$ LIKE "true" THEN 
     CALL FAX(Nummer.TELEFON)
   ELSE 
     CALL Fehler("Der Faxversand wurde nicht konfiguriert!","")
   END IF 
 ELSE 
   IF VoiceDial$ LIKE "true" THEN 
     IF VoiceISDNdial$ LIKE "TEDAS" THEN 
 ON ERROR GOTO end2605982
       tn$ = FN numeric(Nummer.TELEFON)
       REM APPACTIVATE "HANDY":REM phoneware zentrale-pware2.exe
       IF VoicePrg$ LIKE "RVS*" THEN 
         APPACTIVATE VoicePrg$
         REM SENDKEYS "{HOME}"
         REM SENDKEYS "%W"
         REM APPACTIVATE "WÑhlen"
         SENDKEYS "{CLEAR}"
         REM SENDKEYS "{DELETE}"
         REM WAIT FOR 1
         SENDKEYS tn$
         
         SENDKEYS "{ENTER}"
       ELSE 
         APPACTIVATE VoicePrg$
         REM SENDKEYS "{HOME}"
         SENDKEYS "{CLEAR}"
         REM SENDKEYS "{DELETE}"
         SENDKEYS tn$
         SENDKEYS "{ENTER}"
       END IF 
       ok% = 0
       REM SENDKEYS "%V" + tn$
       REM SENDKEYS "%b"
     ELSE 
       CALL Telefon(Nummer.TELEFON)
     END IF 
   ELSE 
     REM CALL Fehler("Die Telefonwahl wurde nicht konfiguriert!","")
   END IF 
   GOTO end2605981
end2605982: 
 CALL Fehler("Das Tedas Telefonprogramm wurde noch nicht aufgerufen!","")
 ON ERROR GOTO ErrorHandler
end2605981: 
 END IF 
end040520031: 
 END SUB 
  
 
SUB SerienListe(codear%)
 MOUSE OFF 
 DIM Telefonliste$(1200)
 ok% = - 1
 WHILE ok%
   MOUSE OFF 
   SELECT KEY codear% FILE "Artikel" INDEX Codear.artikel
   FILE "Serienr"
   INDEX Codear
   SELECT FIRST 
   SELECT KEY codear%
   a% = 0
   prompt$ = "ZZZZZZ"
   WHILE Codear.serienr = codear% AND NOT EOF ("serienr")
     Telefonliste$(a%) = serienr.serienr + SPACE$ (80) + STR$ (CodeSER.serienr,"000000")
     IF Telefonliste$(a%) < prompt$ THEN prompt$ = Telefonliste$(a%)
     a% = a% + 1
     SELECT NEXT 
   WEND 
   TelefonListe$(a%) = ""
   Kunde$ = Bezeichnung.artikel
   CREATE DIALOG GTelDat$,0,0,243,179,"Seriennr.liste","MS Sans Serif",8
   ADD DIALOG GTelDat$,5,5,6,56,10,0,"Liste von:"
   ADD DIALOG GTelDat$,5,62,6,174,9,128,Kunde$
   ADD DIALOG GTelDat$,5,5,22,65,10,0,"Seriennummer:"
   ADD DIALOG GTelDat$,7,5,32,168,137,2,2,Telefonliste$,Auswahl$,prompt$
   ADD DIALOG GTelDat$,1,180,32,55,15,1,"&OK",1,1
   ADD DIALOG GTelDat$,1,180,50,55,15,0,"&Abbrechen",0,0
   ADD DIALOG GTelDat$,1,180,68,55,15,0,"&Drucken",7,1
   ADD DIALOG GTelDat$,1,180,98,55,15,0,"&Neu",3,1
   IF a% <> 0 THEN ADD DIALOG GTelDat$,1,180,116,55,15,0,"én&dern",4,1
   ADD DIALOG GTelDat$,1,180,134,55,15,0,"&Lîschen",5,1
   MOUSE ON 
   DIALOG GTelDat$,req%
   REMOVE DIALOG GTelDat$
   IF req% = 7 THEN 
     req% = 0
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY telnr% FILE "serienr" INDEX Codeser.serienr
     IF codems.serienr > 0 THEN 
       CALL MSDrucken(codems.serienr)
     ELSE 
       IF codeJO.serienr > 0 THEN 
         CALL JournalDr(codejo.serienr)
       ELSE 
         IF codeVL.serienr > 0 THEN 
           CALL VerleihDr(codeVL.serienr)
         END IF 
       END IF 
     END IF 
   END IF 
   SELECT CASE req%
   CASE 1,0
     ok% = 0
   CASE 3
     Nummer$ = ""
     Art$ = ""
     CREATE DIALOG GTelDat$,0,0,242,179,"Seriennr.-Liste (neuer Eintrag)","MS Sans Serif",8
     ADD DIALOG GTelDat$,5,5,6,56,10,0,"Seriennr.-Liste von:"
     ADD DIALOG GTelDat$,6,64,144,131,10,0,0,Art$,50
     ADD DIALOG GTelDat$,6,64,160,131,10,0,0,Stdzaehl$,50
     ADD DIALOG GTelDat$,5,62,6,174,8,128,Kunde$
     ADD DIALOG GTelDat$,5,5,22,65,10,0,"Seriennummer:"
     ADD DIALOG GTelDat$,7,5,32,168,81,2,2,Telefonliste$,Auswahl$
     ADD DIALOG GTelDat$,1,180,32,54,14,1,"&OK",1,1
     ADD DIALOG GTelDat$,1,180,49,54,16,0,"&Abbrechen",0,0
     ADD DIALOG GTelDat$,5,5,121,156,21,0,"Bitte geben Sie die Daten fÅr den neuen Eintrag ein."
     ADD DIALOG GTelDat$,5,5,145,58,10,0,"Seriennummer:"
     ADD DIALOG GTelDat$,5,5,160,58,10,0,"StundenzÑhler:"
     DIALOG GTelDat$,req%
     REMOVE DIALOG GTelDat$
     IF req% = 1 THEN 
       BLANK FILE "serienr"
       Codeser.serienr = SER ("serienr",1)
       serienr.serienr = Art$
       Stdzaehler.serienr = VAL ( FN numeric(Stdzaehl$))
       Codear.serienr = codear%
       verleih.serienr = "n"
       CALL FStore("serienr")
       SELECT FORM KEY codear% FILE "artikel" INDEX Codear.artikel
       FORM 
     END IF 
   CASE 4
     prompt$ = Auswahl$(0)
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY telnr% FILE "serienr" INDEX Codeser.serienr
     Art$ = serienr.serienr
     rnr$ = nummer.serienr
     rdat$ = DATE$ (datum.serienr,"0d.mm.yyyy")
     CREATE DIALOG GTelDat$,0,0,242,199,"Seriennr.-Liste (Eintrag Ñndern)","MS Sans Serif",8
     ADD DIALOG GTelDat$,5,5,6,56,10,0,"Seriennr.liste von:"
     ADD DIALOG GTelDat$,5,62,6,174,8,128,Kunde$
     ADD DIALOG GTelDat$,5,5,22,65,10,0,"Seriennummer:"
     ADD DIALOG GTelDat$,5,5,121,156,21,0,"Bitte geben Sie die gewÅnschten énderungen fÅr den gewÑhlten Eintrag ein."
     ADD DIALOG GTelDat$,6,63,144,120,11,0,0,Art$,50
     ADD DIALOG GTelDat$,5,4,145,48,10,0,"Serien-Nr.:"
     ADD DIALOG GTelDat$,6,63,155,72,11,0,0,Rnr$,10
     ADD DIALOG GTelDat$,5,4,155,48,9,0,"Rechnungs-Nr.:"
     ADD DIALOG GTelDat$,5,4,166,59,10,0,"Rechnungsdatum:"
     ADD DIALOG GTelDat$,6,63,166,79,11,0,0,Rdat$,10
     ADD DIALOG GTelDat$,5,4,177,59,10,0,"StundenzÑhler:"
     ADD DIALOG GTelDat$,6,63,177,79,11,0,0,Stdzaehl$,12
     ADD DIALOG GTelDat$,7,5,32,168,81,2,2,Telefonliste$,Auswahl$,prompt$
     ADD DIALOG GTelDat$,1,180,32,54,14,1,"&OK",1,1
     ADD DIALOG GTelDat$,1,180,49,54,14,1,"&Drucken",2,0
     ADD DIALOG GTelDat$,1,180,66,54,16,0,"&Abbrechen",0,0
     DIALOG GTelDat$,req%
     REMOVE DIALOG GTelDat$
     IF req% = 1 THEN 
       SELECT KEY telnr% LOCK FILE "serienr" INDEX Codeser.serienr
       serienr.serienr = Art$
       nummer.serienr = rnr$
       Stdzaehler.serienr = VAL ( FN numeric(Stdzaehl$))
       datum.serienr = DAYS $(rdat$)
       QuickArSer.serienr = STR$ (codear,"000000") + serienr.serienr
       QuickSerNumm.serienr = serienr.serienr + nummer.serienr
       CALL FStore("serienr")
       SELECT FORM KEY codear% FILE "artikel" INDEX Codear.artikel
       FORM 
     END IF 
     IF req% = 2 THEN 
       req% = 0
       ok% = 0
       SELECT KEY telnr% LOCK FILE "serienr" INDEX Codeser.serienr
     IF codems.serienr > 0 THEN 
       CALL MSDrucken(codems.serienr)
     ELSE 
       IF codeJO.serienr > 0 THEN 
         CALL JournalDr(codejo.serienr)
       ELSE 
         IF codeVL.serienr > 0 THEN 
           CALL VerleihDr(codeVL.serienr)
         END IF 
       END IF 
     END IF 
     END IF 
   CASE 5
     telnr% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY telnr% LOCK FILE "serienr" INDEX Codeser.serienr
     REQUEST "Soll der Eintrag '" + serienr.serienr + "' wirklich gelîscht werden?","",135,req%
     IF req% = 1 THEN 
       SELECT REMOVE FILE "serienr"
       SELECT FORM KEY codear% FILE "artikel" INDEX Codear.artikel
       FORM 
     END IF 
   END SELECT 
 WEND 
 END SUB 
 
 
 
 
 ' ADRESSEN Suchen (neue Version)
 ' ====================================================================== 
 ' Zweck:       Suchen einer Adresse
 ' Nutzung:     wird vom Adressenformular verwendet
 ' ======================================================================
 
SUB ADRSuchen()
 ON ERROR GOTO ErrorHandler
 SELECT WHERE FILE GTelDat$
 filtbutadr1$ = "Filter: ohne"
 SET STATUS "Adresse suchen"
 adrser% = 0
 FILE GAdrDat$
 cuknr% = codeku.GAdrDat$
 adrglob% = 0
 adr% = 0
 adrhis% = 0
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) AND nachname.GAdrDat$ <> "" THEN CALL FStore(GAdrDat$)
     ON ERROR GOTO delsu2509051
     IF EXISTS (GMACodeDir$ + "search.dat") THEN DELETE GMACodeDir$ + "search.dat"
     IF EXISTS (GMACodeDir$ + "search.idx") THEN DELETE GMACodeDir$ + "search.idx"
     IF EXISTS (_netpath$ + "local\search.dat") AND EXISTS (_netpath$ + "local\search.idx") THEN 
       COPY _netpath$ + "local\search.dat",GMACodeDir$ + "search.dat"
       COPY _netpath$ + "local\search.idx",GMACodeDir$ + "search.idx"
     END IF 
     GOTO delsu2509052
delsu2509051: 
     ON ERROR GOTO delsu2509052
     ret% = CALL ("_SearchClose")
     IF EXISTS (GMACodeDir$ + "search.dat") THEN DELETE GMACodeDir$ + "search.dat"
     IF EXISTS (GMACodeDir$ + "search.idx") THEN DELETE GMACodeDir$ + "search.idx"
     IF EXISTS (_netpath$ + "local\search.dat") AND EXISTS (_netpath$ + "local\search.idx") THEN 
       COPY _netpath$ + "local\search.dat",GMACodeDir$ + "search.dat"
       COPY _netpath$ + "local\search.idx",GMACodeDir$ + "search.idx"
     END IF 
delsu2509052: 
 ON ERROR GOTO ErrorHandler
 adr% = ADRSuche%(0)
 REM CALL Fehler("Adresssuche","")
 IF adr% <> 0 THEN 
   cuknr% = adr%
   adrhis% = - 1
 END IF 
 IF adrglob% <> 0 THEN 
   cuknr% = adrglob%
   adrhis% = - 1
 END IF 
 SELECT FORM KEY cuknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 SELECT FIRST FILE GTelDat$ INDEX CodeKU.GTelDat$
 SELECT FORM KEY cuknr% FILE GTelDat$ INDEX CodeKU.GTelDat$
 REM IF UCASE$ (_projekt$) LIKE "FACTURA" THEN SELECT FORM KEY cuknr% FILE "umsatz" INDEX CodeKU.umsatz
 ON ERROR GOTO w151020041
 IF adrhis% = - 1 AND GADRDAT$ LIKE "ADRESSEN" THEN 
   REM Suchergebnis in die Datei ADRHIS eintragen
   BLANK FILE "ADRHIS"
   codekey.adrhis = SER ("ADRHIS",1)
   codema.adrhis = GMACodeMA%
   codeku.adrhis = cuknr%
   name.adrhis = LEFT$ (Nachname.adressen + "/" + Vorname.adressen + "/" + Ort.adressen + "/" + Stra·e.adressen,200)
   QCodeMAKey.adrhis = STR$ (GMACodeMA%,"000000") + STR$ (codekey.adrhis,"000000")
   timestamp$ = DATE$ ( TODAY ,"yymmdd") + STR$ ( HRS ( NOW ) * 100 + MINS ( NOW ),"0000")
   timestamp% = VAL (timestamp$)
   Timestamp.adrhis = timestamp%
   STORE FILE "ADRHIS"
 END IF 
 GOTO w151020042
w151020041: 
 CALL Fehler("Beim Speichern in der ADRHIS - Datei ist ein Fehler aufgetreten!","Bitte diese Datei reorganisieren!")
w151020042: 
 ON ERROR GOTO ErrorHandler
 knr% = cuknr%
 SET INDEX INDEX 
 
 IF FORM LIKE "ADR*" OR FORM LIKE "*ADR*" THEN CALL ADRFeldnamen()
 FORM 
 REM CALL BMCheckMail()
 MOUSE ON 
 END SUB 
 
 
 ' ADRESSEN Suchen (projektunabhÑngig)
 ' ====================================================================== 
 ' Zweck:       Suchen einer Adresse
 ' Nutzung:     wird vom Adressenformular verwendet
 ' Parameter:   filtertype%     0 - keine Filtergenerierung
 '                              1 - mit Filtergenerierung
 ' filtertyp%
 ' ======================================================================
 ' 13.07.94    - Dialog fertiggestellt / Schnellsuche & erweiterte Suche
 '               getrennt aufrufbar
 ' 10.09.95    - Unterbindung von Suchen ohne Suchbegriff
 
  
FUNCTION ADRSuche%(filtertype%)
 suna$ = sunaold$
 DIM aaa$(1)
 cfile$ = FILE 
 adrfound% = 0
 IF GAFSK$ LIKE "TRUE" THEN 
   IF GGSuna$ <> "" THEN 
     GOTO GAFSK140820021
   END IF 
 END IF 
 REM ** Feldnamen definieren
 DIM Feldnamen$(60)
 DIM FeldN$(60)
 IF _projekt$ <> "AKTE" THEN 
   IF _projekt$ <> "PROVIS" AND _projekt$ <> "IMMAK" THEN 
     Feldnamen$(0) = "Nachname"
     Feldnamen$(1) = "Kundennummer"
     Feldnamen$(2) = "Vorname"
     Feldnamen$(3) = "Stra·e"
     Feldnamen$(4) = "Ort"
     Feldnamen$(5) = "Postleitzahl"
     Feldnamen$(6) = "Telefon/-fax"
     Feldnamen$(7) = "Firmenform"
     sw% = 8
   END IF 
 ELSE 
   Feldnamen$(0) = "Aktenzeichen"
   Feldnamen$(1) = "HRB/HRA"
   Feldnamen$(2) = "Schuldner-Name"
   Feldnamen$(3) = "GeschÑftsfÅhrer"
   Feldnamen$(4) = "Schuldner-Ort"
   Feldnamen$(5) = "Schuldner-Stra·e"
   Feldnamen$(6) = "Schuldner-PLZ"
   Feldnamen$(7) = "GlÑubiger"
   Feldnamen$(8) = "Gutachter"
   Feldnamen$(9) = "Sequester"
 
  Feldnamen$(10) = "Verwalter"
   sw% = 10
  END IF 
 IF defa$ LIKE "MEGA" THEN 
   Feldnamen$(sw%) = "KostentrÑger"
   Feldnamen$(sw% + 1) = "Kostenstelle"
   sw% = sw% + 2
 END IF 
  
     Feldnamen$(0) = "Nachname"
     Feldnamen$(1) = "Matchcode"
     Feldnamen$(2) = "Kundennummer"
     Feldnamen$(3) = "Ausweinummer"
     Feldnamen$(4) = "Vorname"
     Feldnamen$(5) = "Stra·e"
     Feldnamen$(6) = "Ort"
     Feldnamen$(7) = "Postleitzahl"
     Feldnamen$(8) = "Telefon/-fax"
     Feldnamen$(9) = "Firmenform"
 
 IF _projekt$ <> "PROVIS" THEN 
   Feldnamen$(sw%) = "Geburtstag"
   sw% = sw% + 1
   IF _projekt$ <> "AKTE" THEN Feldnamen$(sw%) = "Stichwort"
   sw% = sw% + 1
   IF _projekt$ <> "AKTE" THEN Feldnamen$(sw%) = "Adress-Status"
   sw% = sw% + 1
 END IF 
 IF _projekt$ LIKE "PROVIS*" OR _projekt$ LIKE "IMMAK*" THEN 
     sw% = 0
     Feldnamen$(sw%) = "Nachname"
     sw% = sw% + 1
     IF GAdrDat$ LIKE "ADRESSEN" AND _projekt$ <> "IMMAK" THEN 
       Feldnamen$(sw%) = "VERSNR/Antragsnr/KFZ/Risiko/Tarif"
       sw% = sw% + 1
     END IF 
     IF GBene% <> - 1 THEN 
       Feldnamen$(sw%) = "Matchcode"
       sw% = sw% + 1
     END IF 
     Feldnamen$(sw%) = "Kundennummer"
     sw% = sw% + 1
     IF _projekt$ <> "IMMAK" THEN 
       Feldnamen$(sw%) = "Ausweisnummer"
       sw% = sw% + 1
     END IF 
     Feldnamen$(sw%) = "Vorname"
     sw% = sw% + 1
     
     Feldnamen$(sw%) = "Geburtsname"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Stra·e"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Ort"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Postleitzahl"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Geburtstag"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Telefon/-fax"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Telefon/-fax schnell"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Firmenform"
     sw% = sw% + 1
   Feldnamen$(sw%) = "Adress-Status"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Adress-Gruppe"
   sw% = sw% + 1
   Feldnamen$(sw%) = "MS OutlookExport -> JA"
   sw% = sw% + 1
   Feldnamen$(sw%) = "MS OutlookExport -> NEIN"
  IF _projekt$ LIKE "PROVIS*" THEN 
   sw% = sw% + 1
   Feldnamen$(sw%) = "InternetExport -> JA"
   sw% = sw% + 1
   Feldnamen$(sw%) = "InternetExport -> NEIN"
  END IF 
 
   sw% = sw% + 1
   Feldnamen$(sw%) = "Stichwort"
  IF _projekt$ LIKE "PROVIS*" THEN 
   sw% = sw% + 1
   Feldnamen$(sw%) = "Agentur1"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Agentur2"
 END IF 
   sw% = sw% + 1
   Feldnamen$(sw%) = "Anrede"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Land"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Kunde seit"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Erstkontakt"
  IF _projekt$ LIKE "PROVIS*" THEN 
   sw% = sw% + 1
   Feldnamen$(sw%) = "letzter Kontakt"

   sw% = sw% + 1
   Feldnamen$(sw%) = "NationalitÑt"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Staatsangehîrigkeit"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Beruf"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Hobbys"
   sw% = sw% + 1
   Feldnamen$(sw%) = "Familienstand"
   sw% = sw% + 1
   Feldnamen$(sw%) = "AnstellungsverhÑltnis"
   sw% = sw% + 1
   IF GAdrDat$ LIKE "ADRESSEN" THEN 
     Feldnamen$(sw%) = "Anzahl Kinder"
      sw% = sw% + 1
     Feldnamen$(sw%) = "KV Pflicht -> JA"
     sw% = sw% + 1
     Feldnamen$(sw%) = "KV Pflicht -> NEIN"
     sw% = sw% + 1
     Feldnamen$(sw%) = "RV Pflicht -> JA"
     sw% = sw% + 1
     Feldnamen$(sw%) = "RV Pflicht -> NEIN"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Maklerauftrag -> JA"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Maklerauftrag -> NEIN"
     sw% = sw% + 1
     
     Feldnamen$(sw%) = "Beratungsprotokoll-Adresse -> JA"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Beratungsprotokoll-Adresse -> NEIN"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Beratungsprotokolldatum"
     sw% = sw% + 1
     IF GLundWrigg$ = "TRUE" THEN 
       Feldnamen$(sw%) = "Abruf -> JA"
     ELSE 
       Feldnamen$(sw%) = "Vollmacht -> JA"
     END IF 
     sw% = sw% + 1
     IF GLundWrigg$ = "TRUE" THEN 
       Feldnamen$(sw%) = "Abruf -> NEIN"
     ELSE 
       Feldnamen$(sw%) = "Vollmacht -> NEIN"
     END IF 
     sw% = sw% + 1
     Feldnamen$(sw%) = "Generalvollmacht -> JA"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Generalvollmacht -> NEIN"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Gesellschaftsadresse -> JA"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Gesellschaftsadresse -> NEIN"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Agenturadresse -> JA"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Agenturadresse -> NEIN"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Postanschrift"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Zweitanschrift"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Drittanschrift"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Viertanschrift"
     sw% = sw% + 1
     Feldnamen$(sw%) = "Fuenftanschrift"
   END IF 
  END IF 
 
 END IF 
 SET STATUS "Adresse suchen"
 
 REM 070398
 datsu$ = GAdrDat$
 
 FILE GAdrDat$
 INDEX nachname.datsu$
 IF ProjectJN$ = "TRUE" THEN 
   IF suchopt$ = "" THEN suchopt$ = "Nachname"
 END IF 
 Auswahl$ = suchopt$
 IF _projekt$ LIKE "PROVIS*" AND Hubert$ <> "TRUE" THEN 
   nabn1$ = " Bei den Datumsfeldern wird Ihnen ein Auswahlbereich von... bis... angezeigt"
   CREATE DIALOG "ADRSUCH",0,0,320,340,title$,"MS Sans Serif",8
   ADD DIALOG "ADRSUCH",4,0,0,309,340,0,""
   ADD DIALOG "ADRSUCH",9,6,12,20,23,2
   ADD DIALOG "ADRSUCH",5,32,8,244,19,0,"Bitte wÑhlen Sie aus, in welchem Datenbankfeld gesucht werden soll."
   ADD DIALOG "ADRSUCH",5,32,19,244,33,0,"Bei der Suche Åber Stichwort/Agentur/Vertreter und bei den JA/NEIN Feldern kînnen Sie den Suchbegriff weglassen, um eine Liste aller Stichwîrter/Agenturen/Vertreter zu erhalten. " + nabn1$
   ADD DIALOG "ADRSUCH",5,32,55,56,8,0,"Suchfeld:"
   ADD DIALOG "ADRSUCH",6,180,315,88,11,128,0,suna$,50
   ADD DIALOG "ADRSUCH",7,32,64,158,280,1,2,Feldnamen$,Auswahl$,Feldnamen$(0)
   ADD DIALOG "ADRSUCH",1,200,116,64,15,1,"Suchmaske",3,1
   ADD DIALOG "ADRSUCH",1,200,133,64,15,1,"&Schnellsuche",1,1
   ADD DIALOG "ADRSUCH",1,200,150,64,15,0,"&erweiterte Suche",2,1
   ADD DIALOG "ADRSUCH",1,200,167,64,15,0,"&Abbruch",0,0
   ADD DIALOG "ADRSUCH",5,200,305,61,10,0,"Suchbegriff:"
   DIALOG "ADRSUCH",req%
   REMOVE DIALOG "ADRSUCH"
 ELSE 
   CREATE DIALOG "ADRSUCH",0,0,265,325,title$,"MS Sans Serif",8
   ADD DIALOG "ADRSUCH",4,0,0,264,326,0,""
   ADD DIALOG "ADRSUCH",9,6,12,20,23,2
   ADD DIALOG "ADRSUCH",5,32,14,184,19,0,"Bitte wÑhlen Sie aus, in welchem Datenbankfeld gesucht werden soll."
   ADD DIALOG "ADRSUCH",5,32,35,184,33,0,"Bei der Suche Åber Stichwort/Agentur/Vertreter kînnen Sie den Suchbegriff weglassen, um eine Liste aller Stichwîrter/Agenturen/Vertreter zu erhalten."
   ADD DIALOG "ADRSUCH",5,32,75,56,8,0,"Suchfeld:"
   ADD DIALOG "ADRSUCH",6,32,305,88,11,128,0,suna$,50
   ADD DIALOG "ADRSUCH",7,32,64,148,228,1,2,Feldnamen$,Auswahl$,Feldnamen$(0)
   IF GSeaButDis% = 0 THEN 
     IF NOT MNdisabled%("ADRSPEZSUCH1") THEN 
       IF UCASE$ ( FORM ) <> "BCKONTAK" AND UCASE$ ( FORM ) <> "ADRE1" AND _projekt$ LIKE "PROVIS" THEN ADD DIALOG "ADRSUCH",1,190,156,64,15,1,"Spezialsuche 1",5,1
     END IF 
     IF NOT MNdisabled%("ADRSPEZSUCH2") THEN 
       IF UCASE$ ( FORM ) <> "BCKONTAK" AND UCASE$ ( FORM ) <> "ADRE1" AND _projekt$ LIKE "PROVIS" THEN ADD DIALOG "ADRSUCH",1,190,171,64,15,1,"Spezialsuche 2",4,1
     END IF 
     ADD DIALOG "ADRSUCH",1,190,186,64,15,1,"Spezialsuche 3",6,1
   END IF 
   ADD DIALOG "ADRSUCH",1,190,206,64,15,1,"Suchmaske",3,1
   ADD DIALOG "ADRSUCH",1,190,230,64,20,1,"&Schnellsuche",1,1
   ADD DIALOG "ADRSUCH",1,190,260,64,15,0,"&erweiterte Suche",2,1
   ADD DIALOG "ADRSUCH",1,190,277,64,15,0,"&Abbruch",0,0
   ADD DIALOG "ADRSUCH",5,32,295,61,10,0,"Suchbegriff:"
   IF GASP% THEN 
     'Jan: neu -------------------------   
     IF jaDebug% = - 1 THEN CALL Fehler("Adre·-Suche","")
     DIM office$(VisCount%,0)'eins mehr fÅr <Alle BÅros>
     REDIM office$(VisCount%)
     FOR i% = 0 TO VisCount% - 1
      office$(i%) = VisNames$(i%)
     NEXT i%
     office$(VisCount%) = "<Alle BÅros>"
     selOff$ = office$(VisCount%)'sis
     ShowOther% = - 1
     IF ShowOther% <> - 1 THEN 
         FOR i% = 0 TO VisCount% - 1
            IF VisOff%(i%) = ShowOther% THEN 
                selOff$ = VisNames$(i%)
                i% = VisCount%
            END IF 
        NEXT i%
     END IF 
 
     ADD DIALOG "ADRSUCH",5,130,295,61,10,0,"BÅro:"
     ADD DIALOG "ADRSUCH",8,130,305,130,65,259,2,selOff$,office$
     'Jan ende -------------------------   
   END IF 
   DIALOG "ADRSUCH",req%
   REMOVE DIALOG "ADRSUCH"
   IF GASP% THEN 
     'Jan: neu -------------------------   
     ShowOther% = - 1'sis
     IF selOff$ <> "<Alle BÅros>" THEN 
        FOR i% = 0 TO VisCount% - 1
            IF VisNames$(i%) = selOff$ THEN 
                ShowOther% = VisOff%(i%)
                i% = VisCount%'und raus
            END IF 
        NEXT i%
     END IF 
     'Jan ende -------------------------   
   END IF 
 END IF 
 sunaold$ = suna$
 sunaorig$ = suna$
 AdrSuche% = 0
 datsel% = 0
GAFSK140820021: 
 IF GAFSK$ LIKE "TRUE" THEN 
   IF GGSuna$ <> "" THEN 
     sunaorig$ = GGSuna$
     AdrSuche% = 0
     datsel% = 0
     suna$ = GGSuna$
     Auswahl$(0) = "Nachname"
     GGSuna$ = ""
     req% = 1
     GAdrDat$ = "ADRESSEN"
     GTelDat$ = "TELEFON"
     FILE "ADRESSEN"
   END IF 
 END IF 
 IF req% = 3 THEN CALL AdrGlobalSuch()
 IF req% = 4 THEN 
   CALL ADRSuNeg()
   suna$ = ""
   Auswahl$(0) = ""
 END IF 
 IF req% = 5 THEN 
   CALL ADRSuNeg1()
   Auswahl$(0) = ""
   suna$ = ""
 END IF 
 IF req% = 6 THEN 
   CALL ADRSuNeg2()
   Auswahl$(0) = ""
   suna$ = ""
 END IF 
 IF suna$ = "" AND (Auswahl$(0) LIKE "Geburtstag*" OR Auswahl$(0) LIKE "letzter Kontakt*" OR Auswahl$(0) LIKE "Kunde seit*" OR Auswahl$(0) LIKE "Erstkontakt*" OR Auswahl$(0) LIKE "Beratungsprotokolld*") THEN suna$ = "01.01.1900"
 IF Auswahl$(0) LIKE "KV Pflicht*" OR Auswahl$(0) LIKE "RV Pflicht*" OR Auswahl$(0) LIKE "Makler*" OR Auswahl$(0) LIKE "Outl*" OR Auswahl$(0) LIKE "Inter*" THEN suna$ = "#"
 IF Auswahl$(0) LIKE "Vollmacht*" OR Auswahl$(0) LIKE "Generalvollmacht*" OR Auswahl$(0) LIKE "Abruf*" THEN suna$ = "#"
 IF Auswahl$(0) LIKE "Beratungsprotokoll-*" OR Auswahl$(0) LIKE "Gesellschaft*" OR Auswahl$(0) LIKE "Agentur*" OR Auswahl$(0) LIKE "Adress-*" THEN suna$ = "#"
 IF req% <> 0 AND req% <> 3 AND (suna$ <> "" OR Auswahl$(0) LIKE "VERSNR/Antragsnr/KFZ/Risiko/Tarif" OR Auswahl$(0) LIKE "Stichwort" OR Auswahl$(0) LIKE "Vertreter" OR Auswahl$(0) LIKE "Agentur") THEN 
   suchopt$ = Auswahl$(0)
   MOUSE OFF 
   suan1% = 0
   SELECT CASE suchopt$
   CASE "Aktenzeichen"
     feld$ = "Kundennummer"
   CASE "HRB/HRA"
     feld$ = "HRA"
   CASE "Schuldner-Name"
     feld$ = "Nachname"
   CASE "GeschÑftsfÅhrer"
     feld$ = "Geburtsname"
   CASE "Schuldner-Ort"
     feld$ = "Ort"
   CASE "Schuldner-Stra·e"
     feld$ = "Stra·e"
   CASE "Schuldner-PLZ"
     feld$ = "PLZ"
   CASE "GlÑubiger"
     feld$ = "AdresseGlaeubig"
   CASE "Gutachter"
     feld$ = "Gutachter"
   CASE "Sequester"
     feld$ = "Sequester"
   CASE "Verwalter"
     feld$ = "Verwalter"
   CASE "Telefon/-fax"
     feld$ = "Telefon1"
   CASE "Telefon/-fax schnell"
     feld$ = "Telefon2"
   CASE "Postleitzahl"
     feld$ = "QPLZ"
   CASE "Agentur1"
     feld1ab$ = "Agentur1"
     feld$ = "Codema"
   CASE "Agentur2"
     feld1ab$ = "Agentur2"
     feld$ = "Codema2"
   CASE "Adress-Status"
     feld1ab$ = "ADRStatus"
     feld$ = "ADRStatus"
   CASE "Adress-Gruppe"
     feld1ab$ = "ADRGruppe"
     feld$ = "ADRGruppe"
   CASE "Vertreter"
     feld1ab$ = "Vertreter"
     feld$ = "Codema"
   CASE "Nachname"
     feld1ab$ = "QNachname"
     feld$ = "QNachname"
     suna$ = VSNRPack$(suna$)
     IF suna$ = "" THEN suna$ = "*"
   CASE "Anrede"
     feld1ab$ = "Anrede"
     feld$ = "Anrede"
     suna$ = VSNRPack$(suna$)
     IF suna$ = "" THEN suna$ = "*"
   CASE "Geburtsname"
     feld1ab$ = "QGeburtsname"
     feld$ = "QGeburtsname"
     suna$ = VSNRPack$(suna$)
     IF suna$ = "" THEN suna$ = "*"
   CASE "Matchcode"
     feld1ab$ = "QMatchcode"
     feld$ = "QMatchcode"
     suna$ = VSNRPack$(suna$)
     IF suna$ = "" THEN suna$ = "*"
   CASE "Ausweisnummer"
     feld1ab$ = "QAusweisnr"
     feld$ = "QAusweisnr"
     suna$ = VSNRPack$(suna$)
     IF suna$ = "" THEN suna$ = "*"
   CASE "Vorname"
     feld1ab$ = "QVorname"
     feld$ = "QVorname"
     suna$ = VSNRPack$(suna$)
   CASE "Ort"
     feld1ab$ = "QOrt"
     feld$ = "QOrt"
     suna$ = VSNRPack$(suna$)
   CASE "Stra·e"
     feld1ab$ = "QStra·e"
     feld$ = "QStra·e"
     suna$ = VSNRPack$(suna$)
   CASE "PLZ"
     feld1ab$ = "QPLZ"
     feld$ = "QPLZ"
     suna$ = VSNRPack$(suna$)
   CASE "Kunde"
     feld1ab$ = "AAKunde"
     feld$ = "AAKunde"
   CASE "Lieferant"
     feld1ab$ = "AALieferant"
     feld$ = "AALieferant"
   CASE "Privat"
     feld1ab$ = "FIprivat"
     feld$ = "FIprivat"
   CASE "Firmenintern"
     feld1ab$ = "FIATEC"
     feld$ = "FIATEC"
   CASE "VERSNR/Antragsnr/KFZ/Risiko/Tarif"
     REM feld1ab$ = "Vertragsnummer"
     REM feld$ = "Vertragsnummer"
     CALL ADRVertrSu()
     adrglob% = codeku.kvertrag
     GOTO Ende230420091
   CASE "Land"
     feld1ab$ = "Land"
     feld$ = "Land"
   CASE "Beratungsprotokolldatum"
     feld1ab$ = "BerProtokVom"
     feld$ = "BerProtokVom"
     datsel% = 1
   CASE "Kunde seit"
     feld1ab$ = "Kunde_seit"
     feld$ = "Kunde_seit"
     datsel% = 1
   CASE "Geburtstag"
     feld1ab$ = "Geburtstag"
     feld$ = "Geburtstag"
     datsel% = 1
   CASE "letzter Kontakt"
     feld1ab$ = "letzter_Kontakt"
     feld$ = "letzter_Kontakt"
     datsel% = 1
   CASE "Erstkontakt"
     feld1ab$ = "Erstkontakt"
     feld$ = "Erstkontakt"
     datsel% = 1
   CASE "NationalitÑt"
     feld1ab$ = "NationalitÑt"
     feld$ = "NationalitÑt"
   CASE "Staatsangehîrigkeit"
     feld1ab$ = "Staatsangehîrig"
     feld$ = "Staatsangehîrig"
   CASE "Firmenform"
     feld1ab$ = "Firmenform"
     feld$ = "Firmenform"
   CASE "Beruf"
     feld1ab$ = "Beruf"
     feld$ = "Beruf"
   CASE "Hobbys"
     feld1ab$ = "Hobbys"
     feld$ = "Hobbys"
   CASE "Familienstand"
     feld1ab$ = "Familienstand"
     feld$ = "Familienstand"
   CASE "AnstellungsverhÑltnis"
     feld1ab$ = "Anstellungsverh"
     feld$ = "Anstellungsverh"
   CASE "Anzahl Kinder"
     feld1ab$ = "Anzahl_Kinder"
     feld$ = "Anzahl_Kinder"
   CASE "KV Pflicht -> JA"
     feld1ab$ = "KVPflicht"
     feld$ = "KVPflicht"
     suna$ = "j"
   CASE "MS OutlookExport -> JA"
     feld1ab$ = "FIIMMAK"
     feld$ = "FIIMMAK"
     suna$ = "j"
   CASE "MS OutlookExport -> NEIN"
     feld1ab$ = "FIIMMAK"
     feld$ = "FIIMMAK"
     suna$ = "n"

   CASE "Beratungsprotokoll-Adresse -> JA"
     feld1ab$ = "BerProtok"
     feld$ = "BerProtok"
     suna$ = "j"
   CASE "Beratungsprotokoll-Adresse -> NEIN"
     feld1ab$ = "BerProtok"
     feld$ = "BerProtok"
     suna$ = "n"

   CASE "InternetExport -> JA"
     feld1ab$ = "ExpInternet"
     feld$ = "ExpInternet"
     suna$ = "j"
   CASE "InternetExport -> NEIN"
     feld1ab$ = "ExpInternet"
     feld$ = "ExpInternet"
     suna$ = "n"
   CASE "KV Pflicht -> NEIN"
     feld1ab$ = "KVPflicht"
     feld$ = "KVPflicht"
     suna$ = "n"
   CASE "RV Pflicht -> JA"
     feld1ab$ = "RVPflicht"
     feld$ = "RVPflicht"
     suna$ = "j"
   CASE "RV Pflicht -> NEIN"
     feld1ab$ = "RVPflicht"
     feld$ = "RVPflicht"
     suna$ = "n"
   CASE "Maklerauftrag -> JA"
     feld1ab$ = "AAMakler"
     feld$ = "AAMakler"
     suna$ = "j"
   CASE "Maklerauftrag -> NEIN"
     feld1ab$ = "AAMakler"
     feld$ = "AAMakler"
     suna$ = "n"
   CASE "Vollmacht -> JA","Abruf -> JA"
     feld1ab$ = "Vollmacht"
     feld$ = "Vollmacht"
     suna$ = "j"
   CASE "Vollmacht -> NEIN","Abruf -> NEIN"
     feld1ab$ = "Vollmacht"
     feld$ = "Vollmacht"
     suna$ = "n"
   CASE "Generalvollmacht -> JA"
     feld1ab$ = "Generalvollmach"
     feld$ = "Generalvollmach"
     suna$ = "j"
   CASE "Generalvollmacht -> NEIN"
     feld1ab$ = "Generalvollmach"
     feld$ = "Generalvollmach"
     suna$ = "n"
   CASE "Gesellschaftsadresse -> JA"
     feld1ab$ = "AAGesellschaft"
     feld$ = "AAGesellschaft"
     suna$ = "j"
   CASE "Gesellschaftsadresse -> NEIN"
     feld1ab$ = "AAGesellschaft"
     feld$ = "AAGesellschaft"
     suna$ = "n"
   CASE "Agenturadresse -> JA"
     feld1ab$ = "AAMitarbeiter"
     feld$ = "AAMitarbeiter"
     suna$ = "j"
   CASE "Agenturadresse -> NEIN"
     feld1ab$ = "AAMitarbeiter"
     feld$ = "AAMitarbeiter"
     suna$ = "n"
   CASE "Zweitanschrift"
     suan1% = 1
     CALL ADRspezsu("Zweitanschrift",suna$)
     GOTO Ende230420091
   CASE "Postanschrift"
     suan1% = 1
     CALL ADRspezsu("Postanschrift",suna$)
     GOTO Ende230420091
   CASE "Drittanschrift"
     suan1% = 1
     CALL ADRspezsu("Drittanschrift",suna$)
     GOTO Ende230420091
   CASE "Viertanschrift"
     suan1% = 1
     CALL ADRspezsu("Viertanschrift",suna$)
     GOTO Ende230420091
   CASE "Fuenftanschrift"
     suan1% = 1
     CALL ADRspezsu("Fuenftanschrift",suna$)
     GOTO Ende230420091
   CASE ELSE 
     feld$ = Auswahl$(0)
   END SELECT 
anf230120031: 
   IF datsel% = 1 THEN 
datfehl200620021: 
     CREATE DIALOG "Konto1",0,0,221,135,title$,"MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"Suche nach Datum:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Zeitraum Sie suchen mîchten."
     ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Zeitraum eintragen, werden alle DatensÑtze aufgelistet."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,suna$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     ADD DIALOG "Konto1",1,50,114,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,114,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",reqdatum%
     REMOVE DIALOG "Konto1"
     IF suna$ = "" OR VAL (suna$) < 1 THEN 
       vondat$ = "0"
       suna$ = vondat$
     ELSE 
       vondat$ = suna$
     END IF 
     IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
     IF NOT DateOK%(vondat$) OR NOT DateOK%(bisdat$) THEN 
       CALL Fehler("Sie mÅssen das Datum in der Form jj.mm.yyyy angeben!","")
       GOTO datfehl200620021
     END IF 
     IF reqdatum% = 0 THEN GOTO Ende230420091 
   END IF 
   REM SET STATUS "Adre·suche nach " + feld$ + " = " + suna$
   SET STATUS "Adre·suche lÑuft..."
   feld$ = feld$ + "." + GAdrDat$
   a% = 0
   b% = RECCOUNT (GAdrDat$)
   IF b% > 20000 THEN 
     b% = 20000
     REDIM AdrFound$(20000 + 1,1)
     REDIM aaa$(20000,1)
     REDIM AdrFound$(20000 + 1)
     REDIM aaa$(20000)
   ELSE 
     REDIM AdrFound$( RECCOUNT (GAdrDat$) + 1,1)
     REDIM aaa$( RECCOUNT (GAdrDat$),1)
     REDIM AdrFound$( RECCOUNT (GAdrDat$) + 1)
     REDIM aaa$( RECCOUNT (GAdrDat$))
   END IF 
   MOUSE OFF 
   REM FOR a% = 0 TO b%
     REM AdrFound$(a%) = ""
   REM NEXT a%
   REM 280999
   REM CALL Fehler("Suche","")
   a% = 0
   REM CALL Fehler("V-Suche","")
   FILE GADRDat$
   IF feld$ LIKE "Vertragsnummer*" THEN 
   ELSE 
     INDEX feld$$
   END IF 
   ok% = 1
   IF req% = 1 THEN 
tel181096: 
     
     IF feld$ LIKE "Vertragsnummer*" THEN 
       CALL VISuchen1()
       IF nvtab% <> 0 AND kontoinf% = 0 THEN 
         codeku% = codeku.kvertrag
         adrglob% = codeku%
         SELECT FORM KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
         FORM 
         CALL VINFBearb()
       END IF 
       IF nvtab% <> 0 AND kontoinf% <> 0 THEN 
         codeku% = codeku.kvertrag
         adrglob% = codeku%
         SELECT FORM KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
         FORM 
         SELECT KEY nvtab% FILE "Kvertrag" INDEX lfdnr.kvertrag
         SELECT KEY nvtab% FILE "kukto" INDEX codevt.kukto
         cuvt% = nvtab%
         CALL KuKto()
       END IF 
       suna$ = ""
     END IF 
     IF feld$ LIKE "Telefon*" THEN 
       suna1$ = VSNRPack$(suna$)
       suna2$ = "*" + VSNRPack$(suna$) + "*"
       IF RIGHT$ (suna1$,1) <> "*" THEN suna1$ = suna1$ + "*"
       REM IF LEFT$ (suna$,1) <> "*" THEN 
         REM suna1$ = "*" + suna$
         REM IF RIGHT$ (suna1$,1) <> "*" THEN suna1$ = suna1$ + "*"
       REM ELSE 
         REM IF RIGHT$ (suna1$,1) <> "*" THEN suna1$ = suna1$ + "*"
       REM END IF 
       FILE GTelDat$
       INDEX nummer.GTelDat$
       SELECT FIRST 
       SET STATUS "Adre·suche lÑuft..."
       wi% = 0
       CALL Server("LISTBOXINIT","Adre·auswahl")
       MOUSE OFF 
       CALL Gauge(1,"Adre·datei wird durchsucht...")
       CALL Server("GAUGEENABLECANCEL","")
       _prozt% = 0
       _proz2% = 0
       _anz% = RECCOUNT (GTelDat$)
       IF RECCOUNT (GTelDat$) > 20000 THEN 
         REDIM AdrFound$(20000)
       ELSE 
         REDIM AdrFound$( RECCOUNT (GTelDat$))
       END IF 
       a% = 0
       codekuold% = - 1
       IF GCODIE% = - 1 THEN 
         CALL SearchInitADR()
       END IF 
       REM CALL Fehler("Adresssuche","")
       WHILE NOT EOF (GTelDat$) AND ServerReply$() <> "CANCEL"
         _proz% = INT ((100 / _anz%) * _proz2%)
         IF _proz% > 100 THEN _proz% = 100
         IF _proz% < 2 THEN _proz% = 2
         IF _proz% <> _prozt% THEN 
           _prozt% = _proz%
           SET STATUS "Suche... " + STR$ (_prozt%,"999") + " %"
           CALL Gauge(_proz%,"")
         END IF 
         _proz2% = _proz2% + 1
         adrfound% = 0
         pc% = pc% + 1
         cp% = INT (100 / adrmax% * pc%)
         IF qnummer.GTelDat$ LIKE suna1$ OR Qnummer.GTelDat$ LIKE suna2$ OR qart.GTelDat$ LIKE suna1$ OR Qart.GTelDat$ LIKE suna2$ THEN 
           codeku% = Codeku.GTelDat$
           SELECT KEY codeku% FILE datsu$ INDEX codeku.datsu$


           sok% = - 1
           IF GASP% THEN 
               codemaField$ = "codema." + datsu$
               succ% = 0
               REM 25102002 IF (IsWksVisible%(Workstation.datsu$) = - 1 OR codemaField$$ = 0) THEN 
               IF (IsWksVisible%(Workstation.datsu$) = - 1) THEN 
                 IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                   succ% = - 1
                 ELSE 
                   SELECT CASE UCASE$ (datsu$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.datsu$ > 0))
                     ELSE CASE 
                        succ% = - 1
                   END SELECT 
                 END IF 
               END IF 
               sok% = succ%
           END IF 
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.datsu$ <> 0 AND Sperre.datsu$ <> vcodema% THEN sok% = 0
           END IF 
           IF sok% THEN 
             IF GCODIE% = - 1 THEN 
               CALL SearchVorbAdr(datsu$)
               CALL SearchVorbTel(datsu$)
             END IF 
             AdrFound$(a%) = LTRIM$ (nummer.GTelDat$) + ",   " + LTRIM$ (nachname.datsu$) + ", " + LTRIM$ (vorname.datsu$) + ", " + LTRIM$ (ort.datsu$) + ", " + PLZ.datsu$ + ", " + LTRIM$ (Stra·e.datsu$) + ", " + SPACE$ (120) + STR$ (codeku%,"000000")
             tmpZeile$ = AdrFound$(a%)
             a% = a% + 1
             IF GCODIE% = - 1 THEN 
               ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
             END IF 
           END IF 
           CALL Server("GaugeMessage","Adre·datei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + Nachname.datsu$ + ", " + LEFT$ (Vorname.datsu$,1) + ".)")
           CALL Server("LISTBOXADD",tmpZeile$)
         END IF 
         SELECT NEXT FILE GTelDat$
       WEND 
       AdrFound$(a%) = ""
       tmpZeile$ = AdrFound$(a%)
       CALL Gauge(0,"")
       FILE GAdrDat$
       IF a% > 0 THEN 
         adrfound% = a%
         REM MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
       END IF 
       GOTO Telf190896
     END IF 
 

     IF feld$ LIKE "Telefon2*" THEN 
       suna1$ = VSNRPack$(suna$)
       suna3$ = suna1$
       IF suna1$ = "" THEN suna1$ = suna$
       suna2$ = "*" + suna1$ + "*"
       IF RIGHT$ (suna1$,1) <> "*" THEN suna1$ = suna1$ + "*"
       REM IF LEFT$ (suna$,1) <> "*" THEN 
         REM suna1$ = "*" + suna$
         REM IF RIGHT$ (suna1$,1) <> "*" THEN suna1$ = suna1$ + "*"
       REM ELSE 
         REM IF RIGHT$ (suna1$,1) <> "*" THEN suna1$ = suna1$ + "*"
       REM END IF 
       lae% = LEN (suna3$)
       IF lae% > 4 THEN lae% = 4
       ls$ = LEFT$ (suna3$,lae%)
       FILE "Telefon"
       INDEX Qnummer.telefon
       SELECT FIRST 
       SELECT KEY ls$ FILE "telefon" INDEX qnummer.telefon
       SET STATUS "Adre·suche lÑuft..."
       wi% = 0
       CALL Server("LISTBOXINIT","Adre·auswahl")
       MOUSE OFF 
       CALL Gauge(1,"Adre·datei wird durchsucht...")
       CALL Server("GAUGEENABLECANCEL","")
       _prozt% = 0
       _proz2% = 0
       _anz% = RECCOUNT ("telefon")
       REDIM AdrFound$( RECCOUNT ("telefon"))
       a% = 0
       codekuold% = - 1
 
       IF GCODIE% = - 1 THEN 
         CALL SearchInitADR()
       END IF 
       lq$ = LEFT$ (qnummer.telefon,lae%)
       WHILE NOT EOF ("telefon") AND ServerReply$() <> "CANCEL" AND LEFT$ (qnummer.telefon,lae%) = LEFT$ (suna1$,lae%)
         _proz% = INT ((100 / _anz%) * _proz2%)
         IF _proz% > 100 THEN _proz% = 100
         IF _proz% < 2 THEN _proz% = 2
         IF _proz% <> _prozt% THEN 
           _prozt% = _proz%
           SET STATUS "Suche... " + STR$ (_prozt%,"999") + " %"
           CALL Gauge(_proz%,"")
         END IF 
         _proz2% = _proz2% + 1
         adrfound% = 0
         pc% = pc% + 1
         cp% = INT (100 / adrmax% * pc%)
         
         IF Qnummer.telefon LIKE suna1$ OR qnummer.telefon LIKE suna2$ OR qart.telefon LIKE suna1$ OR qart.telefon LIKE suna2$ THEN 
           codeku% = Codeku.telefon
           SELECT KEY codeku% FILE "Adressen" INDEX codeku.Adressen
     AdrFound$(a%) = LTRIM$ (nummer.telefon) + ",   " + LTRIM$ (nachname.datsu$) + ", " + LTRIM$ (vorname.datsu$) + ", " + LTRIM$ (ort.datsu$) + ", " + PLZ.datsu$ + ", " + LTRIM$ (Stra·e.datsu$) + ", " + SPACE$ (120) + STR$ (codeku%,"000000")
            tmpZeile$ = AdrFound$(a%)
            GTelDat$ = "TELEFON"
            IF GCODIE% = - 1 THEN 
              CALL SearchVorbAdr("ADRESSEN")
              IF _projekt$ <> "WAWI" THEN CALL SearchVorbTel("ADRESSEN")
            END IF 
            
            a% = a% + 1
           CALL Server("GaugeMessage","Adre·datei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + Nachname.datsu$ + ", " + LEFT$ (Vorname.datsu$,1) + ".)")
           CALL Server("LISTBOXADD",tmpZeile$)
           IF GCODIE% = - 1 THEN 
             ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
           END IF 
         END IF 
         MOUSE OFF 
         SELECT NEXT FILE "telefon"
       WEND 
       AdrFound$(a%) = ""
       tmpZeile$ = AdrFound$(a%)
       CALL Gauge(0,"")
       FILE "adressen"
       IF a% > 0 THEN 
         adrfound% = a%
         REM MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
       END IF 
       GOTO Telf190896
     END IF 
 


 
     IF feld1ab$ LIKE "ADRStatus" THEN 
       datei1$ = "ADRStat"
       
       z% = RECCOUNT (datei$)
       IF z% < RECCOUNT (GAdrDat$) THEN 
         z% = RECCOUNT (GAdrDat$)
       END IF 
       IF z% < RECCOUNT (datei$) + 5 THEN 
         z% = RECCOUNT (datei$) + 5
       END IF 
       IF z% > 20000 THEN z% = 20000
       REDIM AdrFound$(z%)
       REM FOR i% = 0 TO z% - 1
         REM AdrFound$(i%) = ""
       REM NEXT i%
       CALL DFile(3,datei1$ + _fpw$)
       FILE datei1$
       INDEX keyword.datei1$
       SELECT FIRST 
       a% = 0
       SELECT WHERE keyword.datei1$ <> ""
       SELECT FIRST 
       WHILE NOT EOF (datei1$)
         AdrFound$(a%) = keyword
         a% = a% + 1
         SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRLISTE",0,0,340,197,"Adress-Status wÑhlen","MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
       DIALOG "ADRLISTE",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         suna$ = LAuswahl$
         REM FOR i% = 0 TO z% - 1
           REM AdrFound$(i%) = ""
         REM NEXT i%
       ELSE 
         ok% = 0
         AdrSuche% = 0
         REDIM AdrFound$( RECCOUNT (GAdrDat$))
         GOTO Ende230420091
       END IF 
       MOUSE OFF 
       FILE GAdrDat$
       datsu$ = GAdrDat$
       INDEX ADRStatus.datsu$
       a% = 0
       SELECT FIRST 
       SELECT KEY suna$ INDEX ADRStatus.datsu$
       adrmax% = RECCOUNT (GAdrDat$)
       cp% = 0
       lp% = 0
       pc% = 0
       IF GCODIE% = - 1 THEN 
         CALL SearchInitADR()
       END IF 
       ia% = 0
       ij% = RECCOUNT (datsu$)
       
       WHILE NOT EOF (datsu$) AND ADRStatus.datsu$ = suna$
         MOUSE OFF 
         ia% = ia% + 1
         pc% = pc% + 1
         cp% = INT (100 / adrmax% * pc%)
         IF cp% <> lp% THEN 
           SET STATUS "Verarbeitung: " + STR$ (cp%,"999") + "%"
           lp% = cp%
         END IF 
           sok% = - 1
           IF GASP% THEN 
               codemaField$ = "codema." + datsu$
               succ% = 0
               REM 25102002 IF (IsWksVisible%(Workstation.datsu$) = - 1 OR codemaField$$ = 0) THEN 
               IF (IsWksVisible%(Workstation.datsu$) = - 1) THEN 
                 IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                   succ% = - 1
                 ELSE 
                   SELECT CASE UCASE$ (datsu$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.datsu$ > 0))
                     ELSE CASE 
                        succ% = - 1
                   END SELECT 
                 END IF 
               END IF 
               sok% = succ%
           END IF 
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.datsu$ <> 0 AND Sperre.datsu$ <> vcodema% THEN sok% = 0
           END IF 
           IF sok% THEN 
             codeku% = codeku.datsu$
             IF GCODIE% = - 1 THEN 
               CALL SearchVorbAdr(datsu$)
             END IF 
             MOUSE OFF 
             IF EXISTS (codeku%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               INDEX codetel.GTelDat$
               SELECT FIRST 
               SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
               telefon$ = nummer.GTelDat$
               CALL SearchVorbTel(datsu$)
               FILE GAdrDat$
             END IF 
             AdrFound$(a%) = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + LTRIM$ (telefon$) + SPACE$ (120) + STR$ (codeku,"000000")
             a% = a% + 1
             IF GCODIE% = - 1 THEN 
               ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
             END IF 
             MOUSE OFF 
           END IF 
           SET STATUS STR$ (ia%,",999999") + "/" + STR$ (ij%,",999999") + " gefunden: " + STR$ (a%,",999999")
           SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       SET STATUS "Bereit"
       IF a% = 0 THEN 
         CALL Fehler("Es wurde keine Adresse gefunden!","")
         AdrSuche% = 0
         ok% = 0
       END IF 
       GOTO Telf190896
     END IF 
 
 
 
 
     IF feld1ab$ LIKE "ADRGruppe" THEN 
       datei1$ = "ADRGRUP"
       
       z% = RECCOUNT (datei1$)
       IF z% < RECCOUNT (GAdrDat$) THEN 
         z% = RECCOUNT (GAdrDat$)
       END IF 
       IF z% < RECCOUNT (datei1$) + 5 THEN 
         z% = RECCOUNT (datei1$) + 5
       END IF 
       IF z% > 20000 THEN z% = 20000
       REDIM AdrFound$(z%)
       REM FOR i% = 0 TO z% - 1
         REM AdrFound$(i%) = ""
       REM NEXT i%
       CALL DFile(3,datei1$ + _fpw$)
       FILE datei1$
       INDEX keyword.datei1$
       SELECT FIRST 
       a% = 0
       SELECT WHERE keyword.datei1$ <> ""
       SELECT FIRST 
       WHILE NOT EOF (datei1$)
         AdrFound$(a%) = keyword
         a% = a% + 1
         SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRLISTE",0,0,340,197,"Adress-Gruppe wÑhlen","MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
       DIALOG "ADRLISTE",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         suna$ = LAuswahl$
         REM FOR i% = 0 TO z% - 1
           REM AdrFound$(i%) = ""
         REM NEXT i%
       ELSE 
         ok% = 0
         AdrSuche% = 0
         REDIM AdrFound$( RECCOUNT (GAdrDat$))
         GOTO Ende230420091
       END IF 
       MOUSE OFF 
       FILE GAdrDat$
       datsu$ = GAdrDat$
       INDEX ADRGruppe.datsu$
       a% = 0
       SELECT FIRST 
       SELECT KEY suna$ INDEX ADRGruppe.datsu$
       adrmax% = RECCOUNT (GAdrDat$)
       cp% = 0
       lp% = 0
       pc% = 0
       IF GCODIE% = - 1 THEN 
         CALL SearchInitADR()
       END IF 
       WHILE NOT EOF (datsu$) AND ADRGruppe.datsu$ = suna$
         pc% = pc% + 1
         cp% = INT (100 / adrmax% * pc%)
         IF cp% <> lp% THEN 
           SET STATUS "Verarbeitung: " + STR$ (cp%,"999") + "%"
           lp% = cp%
         END IF 
           sok% = - 1
           IF GASP% THEN 
               codemaField$ = "codema." + datsu$
               succ% = 0
               REM 25102002 IF (IsWksVisible%(Workstation.datsu$) = - 1 OR codemaField$$ = 0) THEN 
               IF (IsWksVisible%(Workstation.datsu$) = - 1) THEN 
                 IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                   succ% = - 1
                 ELSE 
                   SELECT CASE UCASE$ (datsu$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.datsu$ > 0))
                     ELSE CASE 
                        succ% = - 1
                   END SELECT 
                 END IF 
               END IF 
               sok% = succ%
           END IF 
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.datsu$ <> 0 AND Sperre.datsu$ <> vcodema% THEN sok% = 0
           END IF 
           IF sok% THEN 
             codeku% = codeku.datsu$
             IF GCODIE% = - 1 THEN 
               CALL SearchVorbAdr(datsu$)
             END IF 
             IF EXISTS (codeku%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               INDEX codetel.GTelDat$
               SELECT FIRST 
               SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
               telefon$ = nummer.GTelDat$
               CALL SearchVorbTel(datsu$)
               FILE GAdrDat$
             END IF 
             AdrFound$(a%) = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + LTRIM$ (telefon$) + SPACE$ (120) + STR$ (codeku,"000000")
             a% = a% + 1
             IF GCODIE% = - 1 THEN 
               ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
             END IF 
           END IF 
           SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       SET STATUS "Bereit"
       IF a% = 0 THEN 
         CALL Fehler("Es wurde keine Adresse gefunden!","")
         AdrSuche% = 0
         ok% = 0
       END IF 
       GOTO Telf190896
     END IF 
 
     IF feld1ab$ LIKE "Agentur*" OR feld1ab$ LIKE "Vertreter" THEN 
       IF feld1ab$ LIKE "Agentur*" THEN datei1$ = "MAADR"
       IF feld1ab$ LIKE "Vertreter" THEN datei1$ = "VERTRETE"

       IF workstation% = 0 THEN 
         IF BZwang.stamm = 0 AND gasp% = - 1 THEN 
           a% = SelectOffice%("VorgÑnger-Auswahl","",1,0)
           IF a% <> - 1 THEN 
             zzz% = a%
             wks% = zzz%
             REM codema% = VAL (GetWkscodema$(prompt$,wks%))
             codema% = GetCodeMA%(_cuma%,Wks%)
           ELSE 
             CALL Fehler("BÅroauswahl abgebrochen!","")
             codema% = 0
           END IF 
         ELSE 
           codema% = GetCodeMA%(_cuma%,0)
         END IF 
       ELSE 
         REM codema% = VAL (GetWkscodema$(prompt$,Workstation.GADRDat$))
         wks1% = Workstation%
         codema% = GetCodeMA%(ma%,Wks1%)
       END IF 

       IF codema% > 0 THEN 
         suna% = codema%
       ELSE 
         REQUEST "Wollen Sie wirklich alle Adressen"," ohne eingetragenen Betreuer anzeigen lassen?",130,req%
         IF req% = 1 THEN 
           suna% = 0
         ELSE 
           ok% = 0
           AdrSuche% = 0
           REDIM AdrFound$( RECCOUNT (GAdrDat$))
           GOTO Ende230420091
         END IF 
       END IF 
       MOUSE OFF 
       FILE GAdrDat$
       IF feld1ab$ LIKE "Agentur1" THEN 
         INDEX codema.datsu$
       END IF 
       IF feld1ab$ LIKE "Agentur2" THEN 
         INDEX codema2.datsu$
       END IF 
       a% = 0
       SELECT FIRST 
       IF suna% < 1 THEN 
         SELECT FIRST 
       ELSE 
         SELECT KEY suna%
       END IF 
       adrmax% = RECCOUNT (GAdrDat$)
       cp% = 0
       lp% = 0
       pc% = 0
       IF GCODIE% = - 1 THEN 
         CALL SearchInitADR()
       END IF 
       IF suna% = 0 AND feld1ab$ LIKE "Agentur1" THEN WHILE NOT EOF (GAdrDat$) AND codema.datsu$ < 1
       IF suna% = 0 AND feld1ab$ LIKE "Agentur2" THEN WHILE NOT EOF (GAdrDat$) AND codema2.datsu$ < 1
       IF suna% > 0 AND feld1ab$ LIKE "Agentur1" THEN WHILE NOT EOF (GAdrDat$) AND codema.datsu$ = suna%
       IF suna% > 0 AND feld1ab$ LIKE "Agentur2" THEN WHILE NOT EOF (GAdrDat$) AND codema2.datsu$ = suna%
         MOUSE OFF 
         pc% = pc% + 1
         cp% = INT (100 / adrmax% * pc%)
         IF cp% <> lp% THEN 
           SET STATUS "Verarbeitung: " + STR$ (cp%,"999") + "%"
           lp% = cp%
         END IF 
           sok% = - 1
           IF GASP% THEN 
               codemaField$ = "codema." + datsu$
               succ% = 0
               REM 25102002 IF (IsWksVisible%(Workstation.datsu$) = - 1 OR codemaField$$ = 0) THEN 
               IF (IsWksVisible%(Workstation.datsu$) = - 1) THEN 
                 MOUSE OFF 
                 IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                   succ% = - 1
                 ELSE 
                   SELECT CASE UCASE$ (datsu$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.datsu$ > 0))
                     ELSE CASE 
                        succ% = - 1
                   END SELECT 
                 END IF 
               END IF 
               sok% = succ%
           END IF 
           MOUSE OFF 
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.datsu$ <> 0 AND Sperre.datsu$ <> vcodema% THEN sok% = 0
           END IF 
           IF sok% THEN 
             codeku% = codeku.datsu$
             IF GCODIE% = - 1 THEN 
               codeku$ = STR$ (codeku.datsu$,"000000")
               CALL SearchVorbAdr(datsu$)
             END IF 
             IF EXISTS (codeku%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               INDEX codetel.GTelDat$
               SELECT FIRST 
               SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
               telefon$ = nummer.GTelDat$
               CALL SearchVorbAdr(datsu$)
               FILE GAdrDat$
             END IF 
             AdrFound$(a%) = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + LTRIM$ (telefon$) + SPACE$ (120) + STR$ (codeku,"000000")
             a% = a% + 1
             IF GCODIE% = - 1 THEN 
               ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
             END IF 
           END IF 
           SELECT NEXT 
           MOUSE OFF 
       WEND 
       AdrFound$(a%) = ""
       SET STATUS "Bereit"
       IF a% = 0 THEN 
         CALL Fehler("Es wurde keine Adresse gefunden!","")
         AdrSuche% = 0
         ok% = 0
       END IF 
       GOTO Telf190896
     END IF 
     IF feld$ LIKE "Stichwort*" THEN 
       CALL DFile(2,"OFFICE\keywords" + _fpw$)
       FILE "keywords"
       INDEX keyword
       SELECT FIRST 
 
       a% = 0
       datei$ = "keywords"
       z% = RECCOUNT (datei$) + 1
       IF z% < RECCOUNT (GAdrDat$) THEN z% = RECCOUNT (GAdrDat$) + 1
       IF z% < 20000 THEN 
         REDIM AdrFound$(z%)
       ELSE 
         z% = 20000
         REDIM AdrFound$(z%)
       END IF 
       REM FOR i% = 0 TO z% - 1
         REM AdrFound$(i%) = ""
       REM NEXT i%
       SELECT WHERE keyword <> ""
       SELECT FIRST 
       WHILE NOT EOF ("keywords")
         AdrFound$(a%) = LTRIM$ (keyword)
         a% = a% + 1
         SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRLISTE",0,0,340,197,"Stichwortauswahl","MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
       REM IF noserie% = 0 THEN ADD DIALOG "ADRLISTE",1,194,174,56,16,0,"&Serienbrief",2,0
       DIALOG "ADRLISTE",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req5% = 2 THEN 
         adrser% = 1
         CALL SerieNeu1(GAdrDat$)
         GOTO Ende230420091
       END IF 
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         suna$ = "*" + LEFT$ (LAuswahl$) + "*"
       ELSE 
         ok% = 0
         AdrSuche% = 0
         REDIM AdrFound$(z%)
         GOTO Ende230420091
       END IF 
       MOUSE OFF 
       REM FOR cl% = 0 TO RECCOUNT (GAdrDat$)
       REM   AdrFound$(cl%) = ""
       REM NEXT cl%
       adatei$ = GAdrDat$
       FILE GAdrDat$
       INDEX feld$$
       a% = 0
       SELECT FIRST 
       SELECT KEY suna$ INDEX feld$$
       adrmax% = RECCOUNT (GAdrDat$)
       cp% = 0
       lp% = 0
       pc% = 0
       wi% = 0
       CALL Server("LISTBOXINIT","Adre·auswahl")
       MOUSE OFF 
       CALL Gauge(1,"Adre·datei wird durchsucht...")
       CALL Server("GAUGEENABLECANCEL","")
       _prozt% = 0
       _proz2% = 0
       _anz% = RECCOUNT (GAdrDat$)
       REM FOR i% = 0 TO z% - 1
         REM AdrFound$(i%) = ""
       REM NEXT i%
       IF GCODIE% = - 1 THEN 
         CALL SearchInitADR()
       END IF 
       WHILE NOT EOF (GAdrDat$) AND ServerReply$() <> "CANCEL"
         _proz% = INT ((100 / _anz%) * _proz2%)
         IF _proz% > 100 THEN _proz% = 100
         IF _proz% < 2 THEN _proz% = 2
         IF _proz% <> _prozt% THEN 
           _prozt% = _proz%
           SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
           CALL Gauge(_proz%,"")
         END IF 
         _proz2% = _proz2% + 1
         adrfound% = 0
         pc% = pc% + 1
         cp% = INT (100 / adrmax% * pc%)
         IF Stichwort.datsu$ LIKE suna$ THEN 
           sok% = - 1
           codeku% = codeku.datsu$
           SELECT KEY codeku% FILE adatei$ INDEX codeku.adatei$
           IF GASP% THEN 
               codemaField$ = "codema." + adatei$
               succ% = 0
               REM 25102002 IF (IsWksVisible%(Workstation.adatei$) = - 1 OR codemaField$$ = 0) THEN 
               IF (IsWksVisible%(Workstation.adatei$) = - 1) THEN 
                 IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                   succ% = - 1
                 ELSE 
                   SELECT CASE UCASE$ (adatei$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.adatei$ > 0))
                     ELSE CASE 
                        succ% = - 1
                   END SELECT 
                 END IF 
               END IF 
           
               sok% = succ%
           END IF 
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.datsu$ <> 0 AND Sperre.datsu$ <> vcodema% THEN sok% = 0
           END IF 
           IF sok% THEN 
             IF GCODIE% = - 1 THEN 
               codeku% = codeku.datsu$
               CALL SearchVorbAdr(datsu$)
             END IF 
 
             codeku% = codeku.datsu$
             IF EXISTS (codeku%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               INDEX codetel.GTelDat$
               SELECT FIRST 
               SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
               telefon$ = nummer.GTelDat$
               CALL SearchVorbTel(datsu$)
               FILE GAdrDat$
             END IF 
             tmpZeile$ = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + LTRIM$ (telefon$) + SPACE$ (120) + STR$ (codeku,"000000")
             AdrFound$(a%) = tmpZeile$
             CALL Server("GaugeMessage","Adre·datei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + LTRIM$ (Nachname.datsu$) + ", " + LEFT$ ( LTRIM$ (Vorname.datsu$),13) + ".)")
             CALL Server("LISTBOXADD",tmpZeile$)
             a% = a% + 1
             IF GCODIE% = - 1 THEN 
               ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
             END IF 
           END IF 
         END IF 
         SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       CALL Gauge(0,"")
       SET STATUS "Bereit"
       IF a% = 0 THEN 
         CALL Fehler("Es wurde keine Adresse mit diesem Stichwort gefunden!","")
         AdrSuche% = 0
         ok% = 0
       END IF 
       GOTO Telf190896
     ELSE 
       IF feld$ <> "Kostenstelle." + GAdrDat$ AND feld$ <> "Vertragsnummer." + GAdrDat$ THEN 
         IF GCODIE% = - 1 THEN 
           CALL SearchInitADR()
         END IF 
         a% = 0
         locktest% = MNdisabled%("DATALOCK")
         INDEX feld$$
         SELECT FIRST 
         okab% = - 1
         ta% = 0
         x% = ASC ( LEFT$ ( UCASE$ (suna$),1))
         SELECT CASE x%
           CASE 142
             sun$ = "A" + RIGHT$ (suna$, LEN (suna$) - 1)
             suna$ = sun$
             ta% = - 1
           CASE 153
             sun$ = "O" + RIGHT$ (suna$, LEN (suna$) - 1)
             suna$ = sun$
             ta% = - 1
           CASE 154
             sun$ = "U" + RIGHT$ (suna$, LEN (suna$) - 1)
             suna$ = sun$
             ta% = - 1
         END SELECT 
         IF feld$ LIKE "Anzahl*" THEN 
           SELECT KEY VAL (suna$) INDEX feld$$
         ELSE 
           IF feld$ LIKE "letzter_Kontakt*" OR feld$ LIKE "Kunde_seit*" OR feld$ LIKE "Geburtst*" OR feld$ LIKE "Erstkontakt*" OR feld$ LIKE "BerProtokVom*" THEN 
             IF suna$ = "0" THEN 
               SELECT FIRST INDEX feld$$
             ELSE 
               SELECT KEY suna$ INDEX feld$$
             END IF 
           ELSE 
             IF suna$ <> "" THEN 
               SELECT KEY suna$ INDEX feld$$
             ELSE 
               SELECT FIRST INDEX feld$$
             END IF 
           END IF 
         END IF 
         REM 200998
         IF feld$ LIKE "letzter_Kontakt*" OR feld$ LIKE "Kunde_seit*" OR feld$ LIKE "Geburtst*" OR feld$ LIKE "Erstkontakt*" OR feld$ LIKE "BerProtokVom*" THEN 
           IF vondat$ = "0" THEN 
             IF feld$$ < 1 THEN 
               okab% = - 1
             ELSE 
               IF feld$$ <= DAYS (bisdat$) THEN 
                 okab% = - 1
               ELSE 
                 okab% = 0
               END IF 
             END IF 
           ELSE 
             IF feld$$ >= DAYS (vondat$) AND feld$$ <= DAYS (bisdat$) THEN 
               okab% = - 1
             ELSE 
               IF feld$$ < 1 THEN 
                 IF vondat$ = "0" THEN 
                   okab% = - 1
                 ELSE 
                   okab% = 0
                 END IF 
               ELSE 
                 okab% = 0
               END IF 
             END IF 
           END IF 
         ELSE 
           IF feld$ LIKE "Anzahl*" THEN 
             IF feld$$ = VAL (suna$) THEN 
               okab% = - 1
             ELSE 
               okab% = 0
             END IF 
           ELSE 
             IF feld$ LIKE "KV*" OR feld$ LIKE "RV*" OR feld$ LIKE "AA*" OR feld$ LIKE "Berprotok*" THEN 
               ttab$ = feld$$
               IF suna$ LIKE "j" THEN 
                 IF feld$$ LIKE suna$ THEN 
                   okab% = - 1
                 ELSE 
                   okab% = 0
                 END IF 
               END IF 
               IF suna$ LIKE "n" THEN 
                 IF feld$$ LIKE suna$ OR LTRIM$ (feld$$) = "" THEN 
                   okab% = - 1
                 ELSE 
                   okab% = 0
                 END IF 
               END IF 
             ELSE 
               IF suna$ = "" THEN 
                 ta% = - 1
               END IF 
               IF feld$$ LIKE suna$ + "*" THEN 
                 okab% = - 1
               ELSE 
                 IF ta% = - 1 THEN 
                   okab% = - 1
                 ELSE 
                   okab% = 0
                   REM Hier jetzt testen, ob in dem gefundenen Feldinhalt ein Umlaut existiert und deshalb nicht
                   REM vernÅnftig auf suna$ positioniert wurde
                   REM 280999
                   lenab% = LEN (suna$)
                   umlaut% = - 1
                   WHILE (umlaut%)
                     umlaut% = 0
                     testfel$ = LEFT$ (feld$$,lenab%)
                     FOR i% = 1 TO lenab%
                       x% = ASC ( MID$ ( UCASE$ (testfel$),i%,1))
                       SELECT CASE x%
                         CASE 142
                           umlaut% = - 1
                         CASE 153
                           umlaut% = - 1
                         CASE 154
                           umlaut% = - 1
                       END SELECT 
                     NEXT i%
                     IF umlaut% = - 1 THEN 
                       SELECT NEXT INDEX feld$$
                       IF feld$$ LIKE suna$ + "*" THEN 
                         okab% = - 1
                         umlaut% = 0
                       END IF 
                     END IF 
                   WEND 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
         REM 071098
         length% = LEN (suna$)
         IF feld$ LIKE "Anzahl*" OR feld$ LIKE "letzter_Kontakt*" OR feld$ LIKE "Kunde_seit*" OR feld$ LIKE "Geburtst*" OR feld$ LIKE "Erstkontakt*" OR feld$ LIKE "BerProtokVom*" THEN 
         ELSE 
           atest$ = feld$$
         END IF 
         REM CALL Fehler( STR$ (a%),"")
         WHILE okab% AND NOT EOF (GAdrDat$)
           
           IF feld$ LIKE "Anzahl*" OR feld$ LIKE "letzter_Kontakt*" OR feld$ LIKE "Kunde_seit*" OR feld$ LIKE "Geburtst*" OR feld$ LIKE "Erstkontakt*" OR feld$ LIKE "BerProtokVom*" THEN 
             sok% = - 1
 
 
             IF feld$ LIKE "letzter_Kontakt*" OR feld$ LIKE "Kunde_seit*" OR feld$ LIKE "Geburtst*" OR feld$ LIKE "Erstkontakt*" OR feld$ LIKE "BerProtokVom*" THEN 
               IF vondat$ = "0" THEN 
                 IF feld$$ < 1 THEN 
                   sok% = - 1
                 ELSE 
                   IF feld$$ <= DAYS (bisdat$) THEN 
                     sok% = - 1
                   ELSE 
                     sok% = 0
                   END IF 
                 END IF 
               ELSE 
                 IF feld$$ >= DAYS (vondat$) AND feld$$ <= DAYS (bisdat$) THEN 
                   sok% = - 1
                 ELSE 
                   IF feld$$ < 1 THEN 
                     IF vondat$ = "0" THEN 
                       sok% = - 1
                     ELSE 
                       sok% = 0
                     END IF 
                   ELSE 
                     sok% = 0
                   END IF 
                 END IF 
               END IF 
             END IF 
 
 
           ELSE 
             IF feld$ LIKE "ADRStatus*" THEN 
               IF feld$$ LIKE suna$ + "*" THEN 
                 sok% = - 1
               ELSE 
                 sok% = 0
               END IF 
             ELSE 
               atest$ = feld$$
               IF feld$$ LIKE suna$ + "*" THEN 
                 okab% = - 1
               ELSE 
                 IF suna$ <> "" THEN 
                   okab% = 0
                 END IF 
               END IF 
               REM FOR i% = 1 TO length%
                 REM tb$ = MID$ (nachname.GAdrDat$,i%,1)
 REM IF UCASE$ (tb$) LIKE "é" OR UCASE$ (tb$) LIKE "ô" OR UCASE$ (tb$) LIKE "ö" OR tb$ LIKE "·" OR tb$ LIKE " " OR tb$ LIKE "." OR tb$ LIKE "-" OR tb$ LIKE "," OR tb$ LIKE ";" OR tb$ LIKE ":" OR tb$ LIKE "_" OR tb$ LIKE "(" OR tb$ LIKE ")" THEN 
                  REM okab% = - 1
                 REM END IF 
               REM NEXT i%
               sok% = - 1
               IF GASP% THEN 
                 adatei$ = GADRDat$
                 codemaField$ = "codema." + adatei$
                 succ% = 0
                 REM 25102002 IF (IsWksVisible%(Workstation.adatei$) = - 1 OR codemaField$$ = 0) THEN 
                 IF (IsWksVisible%(Workstation.adatei$) = - 1) THEN 
                   IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                     succ% = - 1
                   ELSE 
                     SELECT CASE UCASE$ (adatei$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.adatei$ > 0))
                     ELSE CASE 
                        succ% = - 1
                     END SELECT 
                   END IF 
                 END IF 
                 sok% = succ%
               END IF 
               IF locktest% THEN 
                 IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
               END IF 
               IF okab% = 0 THEN sok% = 0
             END IF 
           END IF 
           REM 12092003 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN sok% = 0
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN sok% = 0
           END IF 
           IF (okab% <> 0) AND FreeFormular.GadrDat$ > 0 THEN sok% = - 1
           IF sok% THEN 
             codeku% = CodeKU.GADRDat$
             AdrFound1$ = LTRIM$ (nachname)
             IF LTRIM$ (vorname) <> "" THEN AdrFound1$ = AdrFound1$ + ", " + LTRIM$ (vorname)
             IF LTRIM$ (EGNachname) <> "" AND LTRIM$ (EGNACHNAme) <> LTRIM$ (Nachname) THEN AdrFound1$ = AdrFound1$ + ",LAB: " + LTRIM$ (EGNachname)
             IF LTRIM$ (EGvorname) <> "" THEN AdrFound1$ = AdrFound1$ + ", " + LTRIM$ (EGvorname)
             IF LTRIM$ (K1name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind1: " + LTRIM$ (K1name)
             IF LTRIM$ (K2name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind2: " + LTRIM$ (K2name)
             IF LTRIM$ (K3name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind3: " + LTRIM$ (K3name)
             IF LTRIM$ (K4name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind4: " + LTRIM$ (K4name)
             AdrFound1$ = PAD$ (AdrFound1$ + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", ",70)
             IF workstation% = 0 THEN 
               SET STATUS AdrFound1$
             END IF 
             IF GCODIE% = - 1 THEN 
               codeku$ = STR$ (codeku.GAdrDat$,"000000")
               CALL SearchVorbAdr(GAdrDat$)
             END IF 
             IF EXISTS (codeku%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               SELECT FIRST FILE GTelDat$ INDEX codeku.GTelDat$
               codekutmp% = codeku% + 1
               SELECT KEY codekutmp% FILE GTelDat$ INDEX codeku.GTelDat$
               SELECT PREVIOUS 
               WHILE NOT EOF (GTelDat$) AND codeku.GTelDat$ = codeku%
                 CALL SearchVorbTel(GADRDat$)
                 AdrFound1$ = AdrFound1$ + LTRIM$ (nummer.GTelDat$) + ","
                 SELECT PREVIOUS FILE GTelDat$ INDEX codeku.GTelDat$
               WEND 
             END IF 
             FILE GAdrDat$
             AdrFound$(a%) = AdrFound1$ + SPACE$ (120) + STR$ (codeku,"000000")
             a% = a% + 1
             IF GCODIE% = - 1 THEN 
               ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
             END IF 
           END IF 
           SELECT NEXT FILE GAdrDat$
           MOUSE OFF 
           
           IF gasp% = - 1 AND GBVF$ LIKE "TRUE" AND workstation% > 0 THEN 
             SELECT CASE zei$
             CASE ""
               zei$ = "/"
             CASE "/"
               zei$ = "-"
             CASE "-"
               zei$ = "\"
             CASE "\"
               zei$ = "-"
             END SELECT 
             IF zei$ = "-" THEN zei$ = "/"
             SET STATUS zei$
           ELSE 
             SET STATUS nachname
           END IF 
         WEND 
         IF a% = 0 THEN 
           IF feld1ab$ LIKE "QNachname" THEN 
             REQUEST "Es wurde kein Eintrag unter diesem Namen gefunden!","In den Feldern Matchcode,Vorname/z.H.,Geburtsname/Zusatz suchen?",130,req21%
             IF req21% <> 1 THEN GOTO weiasu230120032
             feld1ab$ = "QVorname"
             feld$ = "QVorname"
             suna$ = VSNRPack$(suna$)
             GOTO anf230120031
            ELSE 
              IF feld1ab$ LIKE "QVorname" THEN 
                feld1ab$ = "QGeburtsname"
                feld$ = "QGeburtsname"
                suna$ = VSNRPack$(suna$)
                GOTO anf230120031
              ELSE 
                REM QMatchcode
                IF feld1ab$ LIKE "QGeburtsname" THEN 
                  feld1ab$ = "QMatchcode"
                  feld$ = "QMatchcode"
                  suna$ = VSNRPack$(suna$)
                  GOTO anf230120031 
                END IF 
              END IF 
            END IF 
            REM INDEX GAdrDat$
         END IF 
weiasu230120032: 
         AdrFound$(a%) = ""
       ELSE 
         IF feld$ <> "Vertragsnummer." + GAdrDat$ THEN 
           a% = 0
           INDEX feld$$
           SELECT FIRST 
           suna% = VAL (suna$)
           SELECT KEY suna% INDEX feld$$
           IF GCODIE% = - 1 THEN 
             CALL SearchInitADR()
           END IF 
           WHILE feld$$ = suna% AND NOT EOF (GAdrDat$)
            sok% = - 1
               IF GASP% THEN 
                 adatei$ = GADRDat$
                 codemaField$ = "codema." + adatei$
                 succ% = 0
                 REM 25102002 IF (IsWksVisible%(Workstation.adatei$) = - 1 OR codemaField$$ = 0) THEN 
                 IF (IsWksVisible%(Workstation.adatei$) = - 1) THEN 
                   IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                     succ% = - 1
                   ELSE 
                     SELECT CASE UCASE$ (adatei$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.adatei$ > 0))
                     ELSE CASE 
                        succ% = - 1
                     END SELECT 
                   END IF 
                 END IF 
                 sok% = succ%
               END IF 
            IF MNdisabled%("DATALOCK") THEN 
              IF Sperre.datsu$ <> 0 AND Sperre.datsu$ <> vcodema% THEN sok% = 0
            END IF 
            IF sok% THEN 
             IF GCODIE% = - 1 THEN 
               codeku$ = STR$ (codeku.datsu$,"000000")
               CALL SearchVorbAdr(datsu$)
             END IF 
              test$ = PAD$ ( LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e),70)
              AdrFound$(a%) = test$ + ", " + LTRIM$ (telefon1) + SPACE$ (120) + STR$ (codeku,"000000")
              a% = a% + 1
              IF GCODIE% = - 1 THEN 
                ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
              END IF 
             END IF 
             SELECT NEXT FILE GAdrDat$
           WEND 
         END IF 
         AdrFound$(a%) = ""
       END IF 
     END IF 
Telf190896: 
     
     LAuswahl$ = AdrFound$(0)
     LAuswahl1$(0) = LAuswahl$
     req3% = 0
     IF a% <> 0 THEN 
       req3% = 0
       IF GCODIE% = - 1 THEN 
         c$ = "aa"
         REM 19062002
drshow190620024: 
         req3% = CALL ("_SearchShow",c$)
         REM REQUEST c$,"",2
         REM ret% = CALL ("_SearchClose"):rem CALL Fehler("","")
         IF VAL (c$) <> 0 THEN 
           AdrSuche% = VAL (c$)
           adrfound% = VAL (c$)
           ok% = 0
           SET STATUS "Adresse gefunden..."
           IF req3% = 0 THEN GOTO Ende230420091
         END IF 
         IF req3% = 2 THEN 
           adrser% = 1
           ON ERROR GOTO ErrorHandler
           CALL Fehler("Aufruf Serienbrief","")
           CALL SerieNeu1(GAdrDat$)
           GOTO Ende230420091
         END IF 
         ja% = - 1
         IF disabled1%("ADRDrucken") THEN ja% = 0
         IF req3% = 3 AND ja% = - 1 THEN 
           REM drucken
           ON ERROR GOTO adrdr190620021
           DIM dlg AS Dialog
           DIM control AS DialogControl
adrdr190620021: 
           ON ERROR GOTO ErrorHandler
           Superbase.Dialogs.Add("ADRFilter")
           SET dlg = Superbase.Dialogs.ADRFilter
           dlg.Move(0,0,158,111)
           dlg.Caption = title$
           dlg.FontName = "MS Sans Serif"
           dlg.FontSize = 8
 
           SET control = dlg.Add("DialogFrame2","DialogFrame")
           control.Move(5,7,141,77)
           control.Caption = "Druckoptionen"
 
           SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
           control.Move(11,24,85,10)
           control.Caption = "Alle Angaben drucken"
           control.Bind("KurzLang$")
           control.ValueOn = "j"
           control.ValueOff = "n"
 
           SET control = dlg.Add("DialogCheckBox2","DialogCheckBox")
           control.Move(11,38,85,11)
           control.Caption = "Termine mitdrucken"
           control.Bind("Terminejn$")
           control.ValueOn = "j"
           control.ValueOff = "n"
 
           SET control = dlg.Add("DialogCheckBox3","DialogCheckBox")
           control.Move(11,53,115,11)
           control.Caption = "VertrÑge zur Adresse drucken!"
           control.Bind("VertragJN$")
           control.ValueOn = "j"
           control.ValueOff = "n"
 
           SET control = dlg.Add("DialogCheckBox4","DialogCheckBox")
           control.Move(11,68,105,11)
           control.Caption = "als Telefonliste"
           control.Bind("adrtelefon$")
           control.ValueOn = "j"
           control.ValueOff = "n"
 
           SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
           control.Move(22,89,48,15)
           control.Default = 1
           control.Caption = "&Weiter"
           control.ReturnValue = 1
 
           SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
           control.Move(74,89,48,15)
           control.Caption = "&Abbruch"
           control.ReturnValue = 0
           control.Cancel = 1
           DIALOG "ADRFilter",req%
           REMOVE DIALOG ALL 
           IF req% = 1 THEN 
             REM jetzt das Array auslesen und in eine Datei speichern
             FILE GADRDat$
             cindex$ = INDEX 
             INDEX codeku.Gadrdat$
             CALL DFile(2,"OFFICE\ADRLEER" + _fpw$)
             FOR xi% = 0 TO a% - 1
               codeku% = VAL ( RIGHT$ (AdrFound$(xi%),6))
               SELECT FIRST FILE GADRDat$ INDEX codeku.GADRDat$
               SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
               anrede$ = Anrede.GadrDat$
               titel$ = Titel.GADRDat$
               IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" THEN 
                 nachname$ = LTRIM$ (nachname.GAdrDat$)
                 vorname$ = LTRIM$ (vorname.GAdrDat$)
               ELSE 
                 nachname$ = LTRIM$ (nachname.GAdrDat$)
                 vorname$ = LTRIM$ (Geburtsname.GAdrDat$)
               END IF 
               gebdat% = Geburtstag.GAdrDat$
               REM CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
               BLANK FILE "ADRLEER"
               a% = CopyRecord%(GADRDat$,"ADRLEER")
               Nachname.adrleer = nachname$
               Vorname.adrleer = Vorname$
               STORE FILE "ADRLEER"
               UNLOCK FILE "ADRLEER"
             NEXT xi%
             REM dann drucken auslîsen
             Wbericht$ = "ADRLEER"
             title2$ = "Adressliste "
             CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
             INDEX cindex$
             REMOVE FROM FILE "ADRLEER"
             REM CALL Fehler("","")
           END IF 
         END IF 
       ELSE 
         IF disabled1%("ADRSERIENBRIEF") THEN noserie% = 1
         IF _projekt$ LIKE "PROVIS" THEN 
           MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
         ELSE 
           MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
         END IF 
         CREATE DIALOG "ADRLISTE",0,0,420,277,title$,"MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,408,241,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,124,254,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,184,254,56,16,0,"&Abbrechen",0,0
         IF noserie% = 0 THEN ADD DIALOG "ADRLISTE",1,244,254,56,16,0,"&Serienbrief",2,0
         DIALOG "ADRLISTE",req3%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         REM 200999 Serienbrief
         IF req3% = 2 THEN 
           adrser% = 1
           CALL SerieNeu1(GAdrDat$)
           GOTO Ende230420091
         END IF 
         IF req3% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           AdrSuche% = VAL ( RIGHT$ (LAuswahl$,6))
           adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
           ok% = 0
           SET STATUS "Adresse gefunden..."
         ELSE 
           AdrSuche% = 0
         END IF 
       END IF 
     ELSE 
       adrfound% = 0
       IF _projekt$ LIKE "PROVIS" THEN 
         MENU 3,6,0
       ELSE 
         MENU 4,6,0
       END IF 
     END IF 
     IF AdrSuche% = 0 AND ok% = 1 THEN 
       AdrSuche% = 0
       ok% = 1
       IF feld$ LIKE "Telefon1*" THEN 
         REQUEST "Keine Telefonnummer gefunden!","",2
         ok% = 0
       ELSE 
         IF feld$ <> "Vertragsnummer." + GAdrDat$ AND req3% <> 3 THEN 
           REQUEST "Eintrag nicht gefunden!","Erweiterte Suche durchfÅhren?",135,req2%
         ELSE 
           req2% = 0
         END IF 
         IF req2% = 1 THEN 
           ok% = 1
         ELSE 
           ok% = 0
         END IF 
       END IF 
     END IF 
     REM REDIM AdrFound$( RECCOUNT (GAdrDat$))
   END IF 
   IF AdrSuche% = 0 AND ok% = 1 THEN 
 
     IF feld1ab$ LIKE "Agentur" OR feld1ab$ LIKE "Vertreter" THEN 
       IF feld1ab$ LIKE "Agentur" THEN datei1$ = "MAADR"
       IF feld1ab$ LIKE "Vertreter" THEN datei1$ = "VERTRETE"
       CALL DFile(3,datei1$ + _fpw$)
       FILE datei1$
       INDEX nachname.datei1$
       SELECT FIRST 
       a% = 0
       SELECT WHERE nachname.datei1$ <> ""
       SELECT FIRST 
       WHILE NOT EOF (datei1$)
         ja% = - 1
         IF GASP% THEN 
           codemaField$ = "codema." + datei1$
           succ% = 0
           REM 25102002 IF (IsWksVisible%(Workstation.datei1$) = - 1 OR codemaField$$ = 0) THEN 
           IF (IsWksVisible%(Workstation.datei1$) = - 1) THEN 
             IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
               succ% = - 1
             ELSE 
               SELECT CASE UCASE$ (datei1$)
                 CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                    succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                    succ% = succ% OR ((Workstation% = 0) AND (Workstation.datei1$ > 0))
                 ELSE CASE 
                    succ% = - 1
               END SELECT 
             END IF 
           END IF 
           ja% = succ%
         END IF 
         IF ja% THEN 
           AdrFound$(a%) = LTRIM$ (nachname) + "," + LTRIM$ (vorname) + SPACE$ (120) + STR$ (codema,"000000")
           a% = a% + 1
         END IF 
         SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
       IF noserie% = 0 THEN ADD DIALOG "ADRLISTE",1,194,174,56,16,0,"&Serienbrief",2,0
       DIALOG "ADRLISTE",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req5% = 2 THEN 
         adrser% = 1
         CALL SerieNeu1(GAdrDat$)
         GOTO Ende230420091
       END IF 
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         suna% = VAL ( RIGHT$ (LAuswahl$,6))
       ELSE 
         ok% = 0
         AdrSuche% = 0
         REDIM AdrFound$( RECCOUNT (GAdrDat$))
         GOTO Ende230420091
       END IF 
     END IF 
 
 
     IF feld$ LIKE "Stichwort." + GAdrDat$ THEN 
       CALL DFile(2,"OFFICE\keywords" + _fpw$)
       FILE "keywords"
       INDEX keyword
       SELECT FIRST 
       a% = 0
       SELECT WHERE keyword <> ""
       SELECT FIRST 
       WHILE NOT EOF ("keywords")
         AdrFound$(a%) = LTRIM$ (keyword)
         a% = a% + 1
         SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
       IF noserie% = 0 THEN ADD DIALOG "ADRLISTE",1,194,174,56,16,0,"&Serienbrief",2,0
       DIALOG "ADRLISTE",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       REM FOR i% = 0 TO a%
         REM AdrFound$(i%) = ""
       REM NEXT i%
       REM CALL Fehler("","")
       IF req5% = 2 THEN 
         adrser% = 1
         CALL SerieNeu1(GAdrDat$)
         GOTO Ende230420091
       END IF 
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         suna$ = LEFT$ (LAuswahl$)
       ELSE 
         ok% = 0
         AdrSuche% = 0
         REDIM AdrFound$( RECCOUNT (GAdrDat$))
         GOTO Ende230420091
       END IF 
       MOUSE OFF 
     END IF 
 
     REM 200999
     IF (Auswahl$(0) LIKE "Geburtstag*" OR Auswahl$(0) LIKE "letzter Kontakt*" OR Auswahl$(0) LIKE "Kunde seit*" OR Auswahl$(0) LIKE "Anzahl*") THEN 
     ELSE 
       IF Auswahl$(0) LIKE "KV Pflicht*" OR Auswahl$(0) LIKE "RV Pflicht*" OR Auswahl$(0) LIKE "Makler*" OR Auswahl$(0) LIKE "Vollmacht*" OR Auswahl$(0) LIKE "Generalvollmacht*" OR Auswahl$(0) LIKE "Beratungsprotokoll -*" THEN 
       ELSE 
         IF Auswahl$(0) LIKE "Gesellschaft*" OR Auswahl$(0) LIKE "Agentur*" THEN 
         ELSE 
           suna$ = "*" + suna$ + "*"
         END IF 
       END IF 
     END IF 
     REM SET STATUS "Adre·suche nach " + feld$ + " = " + suna$
     SET STATUS "Adre·suche lÑuft..."
     wi% = 0
     CALL Server("LISTBOXINIT","Adre·auswahl")
     FILE GAdrDat$
     SELECT FIRST 
     MOUSE OFF 
     CALL Gauge(1,"Adre·datei wird durchsucht...")
     CALL Server("GAUGEENABLECANCEL","")
     _prozt% = 0
     _proz2% = 0
     _anz% = RECCOUNT (GAdrDat$)
     IF feld$ LIKE "Telefon*" THEN GOTO tel181096
     a% = 0
     IF GCODIE% = - 1 THEN 
       CALL SearchInitADR()
     END IF 
     WHILE NOT EOF (GAdrDat$) AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
       adrfound% = 0
       SELECT CASE feld$
       CASE "Anrede." + GAdrDat$
         IF Anrede.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Hobbys." + GAdrDat$
         IF Hobbys.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Kundennummer." + GAdrDat$
         IF Kundennummer.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "QAusweisnr." + GAdrDat$
         IF QAusweisnr.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "QNachname." + GAdrDat$,"QVorname." + GAdrDat$,"QMatchcode." + GAdrDat$
         IF QNachname.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF QMatchcode.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF _projekt$ <> "AKTE" THEN 
           IF QVorname.GAdrDat$ LIKE suna$ THEN adrfound% = 1
           IF QGeburtsname.GAdrDat$ LIKE suna$ THEN adrfound% = 1
           IF egnachname.GADRDat$ LIKE sunaorig$ OR egnachname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF egvorname.GADRDat$ LIKE sunaorig$ OR egvorname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF egvorname.GADRDat$ LIKE sunaorig$ OR egvorname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF eggeburtsname.GADRDat$ LIKE sunaorig$ OR eggeburtsname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K1Name.GADRDat$ LIKE sunaorig$ OR K1Name.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K2Name.GADRDat$ LIKE sunaorig$ OR K2Name.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K3Name.GADRDat$ LIKE sunaorig$ OR K3Name.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K4Name.GADRDat$ LIKE sunaorig$ OR K4Name.GADRDat$ LIKE suna$ THEN adrfound% = 1

           IF K1NName.GADRDat$ LIKE sunaorig$ OR K1NName.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K2NName.GADRDat$ LIKE sunaorig$ OR K2NName.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K3NName.GADRDat$ LIKE sunaorig$ OR K3NName.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K4NName.GADRDat$ LIKE sunaorig$ OR K4NName.GADRDat$ LIKE suna$ THEN adrfound% = 1


         END IF 
       CASE "QStra·e." + GAdrDat$
         IF QStra·e.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASStra·e.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF EGASStra·e.GAdrDat$ LIKE suna$ OR EGASStra·e.GAdrDat$ LIKE sunaorig$ THEN adrfound% = 1
       CASE "QOrt." + GAdrDat$
         IF QOrt.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASOrt.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF EGASOrt.GAdrDat$ LIKE suna$ OR EGASOrt.GAdrDat$ LIKE sunaorig$ THEN adrfound% = 1
       CASE "QPLZ." + GAdrDat$
         IF QPLZ.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASPLZ.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF EGASPLZ.GAdrDat$ LIKE suna$ OR EGASPLZ.GAdrDat$ LIKE sunaorig$ THEN adrfound% = 1
       CASE "Stichwort." + GAdrDat$
         IF Stichwort.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF Notiz.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "HRA." + GAdrDat$
         IF HRA.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "QGeburtsname." + GAdrDat$
         IF QGeburtsname.GAdrDat$ LIKE suna$ THEN adrfound% = 1
           IF egnachname.GADRDat$ LIKE sunaorig$ OR egnachname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF egvorname.GADRDat$ LIKE sunaorig$ OR egvorname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF egvorname.GADRDat$ LIKE sunaorig$ OR egvorname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF eggeburtsname.GADRDat$ LIKE sunaorig$ OR eggeburtsname.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K1Name.GADRDat$ LIKE sunaorig$ OR K1Name.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K2Name.GADRDat$ LIKE sunaorig$ OR K2Name.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K3Name.GADRDat$ LIKE sunaorig$ OR K3Name.GADRDat$ LIKE suna$ THEN adrfound% = 1
           IF K4Name.GADRDat$ LIKE sunaorig$ OR K4Name.GADRDat$ LIKE suna$ THEN adrfound% = 1
       CASE "AdresseGlaeubig." + GAdrDat$
         IF AdresseGlaeubig.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Verwalter." + GAdrDat$
         IF Verwalter.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Sequester." + GAdrDat$
         IF Sequester.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Gutachter." + GAdrDat$
         IF Gutachter.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       REM 200999
       CASE "Land." + GAdrDat$
         IF Land.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Kunde_seit." + GAdrDat$
         IF feld$$ >= DAYS (vondat$) AND feld$$ <= DAYS (bisdat$) THEN adrfound% = 1
       CASE "BerProtokVom." + GADRDat$
         IF feld$$ >= DAYS (vondat$) AND feld$$ <= DAYS (bisdat$) THEN adrfound% = 1
       CASE "Geburtstag." + GAdrDat$
         IF feld$$ >= DAYS (vondat$) AND feld$$ <= DAYS (bisdat$) THEN adrfound% = 1
         IF EGGeburtstag.GADRDat$ >= DAYS (vondat$) AND EGGeburtstag.GADRDat$ <= DAYS (bisdat$) THEN adrfound% = 1
         IF K1Geburtstag.GADRDat$ >= DAYS (vondat$) AND K1Geburtstag.GADRDat$ <= DAYS (bisdat$) THEN adrfound% = 1
         IF K2Geburtstag.GADRDat$ >= DAYS (vondat$) AND K2Geburtstag.GADRDat$ <= DAYS (bisdat$) THEN adrfound% = 1
         IF K3Geburtstag.GADRDat$ >= DAYS (vondat$) AND K3Geburtstag.GADRDat$ <= DAYS (bisdat$) THEN adrfound% = 1
         IF K4Geburtstag.GADRDat$ >= DAYS (vondat$) AND K4Geburtstag.GADRDat$ <= DAYS (bisdat$) THEN adrfound% = 1
       CASE "letzter_Kontakt." + GAdrDat$
         IF feld$$ >= DAYS (vondat$) AND feld$$ <= DAYS (bisdat$) THEN adrfound% = 1
       CASE "Erstkontakt." + GAdrDat$
         IF feld$$ >= DAYS (vondat$) AND feld$$ <= DAYS (bisdat$) THEN adrfound% = 1
       CASE "NationalitÑt." + GAdrDat$
         IF NationalitÑt.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Staatsangehîrig." + GAdrDat$
         IF Staatsangehîrig.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Firmenform." + GAdrDat$
         IF Firmenform.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Beruf." + GAdrDat$
         IF Beruf.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF EGBeruf.GAdrDat$ LIKE suna$ OR EGBeruf.GAdrDat$ LIKE sunaorig$ THEN adrfound% = 1
       CASE "Familienstand." + GAdrDat$
         IF Familienstand.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Anstellungsverh." + GAdrDat$
         IF Anstellungsverh.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Anzahl_Kinder." + GAdrDat$
         IF Anzahl_Kinder.GAdrDat$ = VAL (suna$) THEN adrfound% = 1
       CASE "KVPflicht." + GAdrDat$
         IF suna$ = "j" THEN 
           IF KVPflicht.GAdrDat$ = suna$ THEN adrfound% = 1
         ELSE 
           IF KVPflicht.GAdrDat$ = "n" OR KVPflicht.GAdrDat$ = "" THEN adrfound% = 1
         END IF 
       CASE "Vollmacht." + GAdrDat$
         IF suna$ = "j" THEN 
           IF Vollmacht.GAdrDat$ = suna$ THEN adrfound% = 1
         ELSE 
           IF Vollmacht.GAdrDat$ = "n" OR Vollmacht.GAdrDat$ = "" THEN adrfound% = 1
         END IF 
       CASE "Generalvollmach." + GAdrDat$
         IF suna$ = "j" THEN 
           IF Generalvollmach.GAdrDat$ = suna$ THEN adrfound% = 1
         ELSE 
           IF Generalvollmach.GAdrDat$ = "n" OR Generalvollmach.GAdrDat$ = "" THEN adrfound% = 1
         END IF 
       CASE "RVPflicht." + GAdrDat$
         IF suna$ = "j" THEN 
           IF RVPflicht.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         ELSE 
           IF RVPflicht.GAdrDat$ = "n" OR RVPflicht.GAdrDat$ = "" THEN adrfound% = 1
         END IF 

       CASE "BerProtok." + GAdrDat$
         IF suna$ = "j" THEN 
           IF BerProtok.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         ELSE 
           IF BerProtok.GAdrDat$ = "n" OR BerProtok.GAdrDat$ = "" THEN adrfound% = 1
         END IF 

       CASE "AAMakler." + GAdrDat$
         IF suna$ = "j" THEN 
           IF AAMakler.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         ELSE 
           IF AAMakler.GAdrDat$ = "n" OR AAMakler.GAdrDat$ = "" THEN adrfound% = 1
         END IF 
       CASE "AAMitarbeiter." + GAdrDat$
         IF suna$ = "j" THEN 
           IF AAMitarbeiter.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         ELSE 
           IF AAMitarbeiter.GAdrDat$ = "n" OR AAMitarbeiter.GAdrDat$ = "" THEN adrfound% = 1
         END IF 
       CASE "AAGesellschaft." + GAdrDat$
         IF suna$ = "j" THEN 
           IF AAGesellschaft.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         ELSE 
           IF AAGesellschaft.GAdrDat$ = "n" OR AAGesellschaft.GAdrDat$ = "" THEN adrfound% = 1
         END IF 
     END SELECT 
       IF GMASuperCount% > 0 THEN 
         IF IsMASuper%(codema.GAdrDat$) THEN 
         ELSE 
           adrfound% = 0
         END IF 
       END IF 
       IF adrfound% = 1 THEN 
         ok% = - 1
         IF GASP% THEN 
               datei1$ = GADRDat$
               codemaField$ = "codema." + datei1$
               succ% = 0
               REM 25102002 IF (IsWksVisible%(Workstation.datei1$) = - 1) OR codemaField$$ = 0 THEN 
               IF (IsWksVisible%(Workstation.datei1$) = - 1) THEN 
                 IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                   succ% = - 1
                 ELSE 
                   SELECT CASE UCASE$ (datei1$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.datei1$ > 0))
                     ELSE CASE 
                        succ% = - 1
                   END SELECT 
                 END IF 
               END IF 
               ok% = succ%
         END IF 
         IF MNdisabled%("DATALOCK") THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
         END IF 
         IF ok% THEN 
           IF _projekt$ <> "AKTE" THEN 
             IF GCODIE% = - 1 THEN 
               CALL SearchVorbAdr(GAdrDat$)
               codeku% = Codeku.GAdrDat$
               IF EXISTS (codeku%,codeku.gteldat$) THEN 
                 SELECT KEY codeku% FILE GTElDat$ INDEX codeku.gteldat$
                 CALL SearchVorbTel(GAdrDat$)
               END IF 
             END IF 
             tmpZeile$ = LTRIM$ (nachname)
             IF LTRIM$ (vorname) <> "" THEN tmpZeile$ = tmpZeile$ + ", " + LTRIM$ (vorname)
             IF LTRIM$ (EGNachname) <> "" AND LTRIM$ (EGNACHNAme) <> LTRIM$ (Nachname) THEN tmpZeile$ = tmpZeile$ + ",LAB: " + LTRIM$ (EGNachname)
             IF LTRIM$ (EGvorname) <> "" THEN tmpZeile$ = tmpZeile$ + ", " + LTRIM$ (EGvorname)
             IF LTRIM$ (K1name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind1: " + LTRIM$ (K1name)
             IF LTRIM$ (K2name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind2: " + LTRIM$ (K2name)
             IF LTRIM$ (K3name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind3: " + LTRIM$ (K3name)
             IF LTRIM$ (K4name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind4: " + LTRIM$ (K4name)
             tmpZeile$ = tmpZeile$ + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + SPACE$ (100) + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
             REM tmpZeile$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
             AdrFound$(a%) = tmpZeile$
             REM CALL Fehler(AdrFound$(a%),"")
             a% = a% + 1
           ELSE 
             SELECT CASE feld$
               CASE "HRA." + GAdrDat$
                 tmpZeile$ = HRA.GAdrDat$ + ", " + Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
               CASE "QGeburtsname." + GAdrDat$
                 tmpZeile$ = LEFT$ (Geburtsname.GAdrDat$,40) + "...,SCHULDNER: " + Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
               CASE "AdresseGlaeubig." + GAdrDat$
                 tmpZeile$ = LEFT$ (AdresseGlaeubig.GAdrDat$,40) + "...,SCHULDNER: " + Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
               CASE "Verwalter." + GAdrDat$
                 tmpZeile$ = LEFT$ (Verwalter.GAdrDat$,40) + "...,SCHULDNER: " + Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
               CASE "Sequester." + GAdrDat$
                 tmpZeile$ = LEFT$ (Sequester.GAdrDat$,40) + "...,SCHULDNER: " + Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
               CASE "Gutachter." + GAdrDat$
                 tmpZeile$ = LEFT$ (Gutachter.GAdrDat$,40) + "...,SCHULDNER: " + Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
               CASE ELSE 
                 tmpZeile$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
             END SELECT 
           END IF 
           wi% = wi% + 1
           IF GCODIE% = - 1 THEN 
             ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
           END IF 
           CALL Server("GaugeMessage","Adre·datei wird durchsucht... " + TRIM$ ( STR$ (wi%,"9999")) + " gefunden (" + Nachname.GAdrDat$ + ", " + LEFT$ (Vorname.GAdrDat$,1) + ".)")
           CALL Server("LISTBOXADD",tmpZeile$)
         END IF 
       END IF 
       MOUSE OFF 
       SELECT NEXT FILE GAdrDat$
     WEND 
     AdrFound$(a%) = ""
     CALL Gauge(0,"")
     SET STATUS "Bereit"
     IF wi% <> 0 THEN 
       SET STATUS "Bitte wÑhlen Sie eine Adresse aus"
       IF _projekt$ LIKE "PROVIS" THEN 
         REM MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
         IF a% <> 0 THEN MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
       ELSE 
         IF _projekt$ <> "AKTE" THEN MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
         IF _projekt$ = "AKTE" THEN MENU 4,1,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
       END IF 
       IF GCODIE% = - 1 THEN 
         c$ = "aa"
         req3% = CALL ("_SearchShow",c$)
         REM REQUEST c$,"",2
         REM ret% = CALL ("_SearchClose"):
         REM CALL Fehler(c$,"")
         IF VAL (c$) <> 0 THEN 
           AdrSuche% = VAL (c$)
           adrfound% = VAL (c$)
           ok% = 0
           SET STATUS "Adresse gefunden..."
         END IF 
         IF req3% = 2 THEN 
           adrser% = 1
           CALL SerieNeu1(GAdrDat$)
           GOTO Ende230420091
         END IF 
       ELSE 
         CREATE DIALOG "ADRLISTE",0,0,440,197,title$,"MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,428,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,124,174,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,184,174,56,16,0,"&Abbrechen",0,0
         IF noserie% = 0 THEN ADD DIALOG "ADRLISTE",1,244,174,56,16,0,"&Serienbrief",2,0
         DIALOG "ADRLISTE",req4%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         REM 200999 Serienbrief
         IF req4% = 2 THEN 
           adrser% = 1
           CALL SerieNeu1(GAdrDat$)
           GOTO Ende230420091
         END IF 
         IF req4% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           AdrSuche% = VAL ( RIGHT$ (LAuswahl$,6))
           adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
           ok% = 0
           SET STATUS "Adresse gefunden..."
         ELSE 
           AdrSuche% = 0
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Keine entsprechende Adresse gefunden!","")
       ADRSuche% = 0
     END IF 
   END IF 
   tfoundadr% = a%
 ELSE 
   REM 020799 adrglob%
   IF adrglob% > 0 THEN 
     ADRSuche% = adrglob%
     REM tfoundadr% = adrglob%
     adrglob% = 0
   ELSE 
     tfoundadr% = 0
   END IF 
   IF _projekt$ LIKE "PROVIS" THEN 
     REM MENU 3,6,0,"aus Suchliste &wÑhlen,F7","ADRWahl"
     MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
   ELSE 
     IF _projekt$ <> "AKTE" THEN 
       IF tfoundadr% = 0 THEN 
         MENU 4,6,0,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
       ELSE 
         MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
       END IF 
     IF _projekt$ = "AKTE" THEN MENU 4,1,0,"aus Suchliste &wÑhlen,F7","ADRKurzSuche"
   END IF 
 END IF 
Ende230420091: 
 REM CALL Fehler("Ende230420091","")
 SET STATUS "Bereit"
 MOUSE ON 
 FILE cfile$
 END FUNCTION 
 
SUB ADRspezsu(feld$,su$)
 FILE GADRDat$
 INDEX nachname.Gadrdat$
 REDIM AdrFound$( RECCOUNT (GADRDat$) + 1)
 SELECT FIRST FILE GADRDat$ INDEX nachname.GADRDat$
     SET STATUS "Adre·suche lÑuft..."
     wi% = 0
     CALL Server("LISTBOXINIT","Adre·auswahl")
     MOUSE OFF 
     CALL Gauge(1,"Adre·datei wird durchsucht...")
     CALL Server("GAUGEENABLECANCEL","")
     _prozt% = 0
     _proz2% = 0
     _anz% = RECCOUNT (GAdrDat$)
     a% = 0
     IF GCODIE% = - 1 THEN 
       CALL SearchInitADR()
     END IF 

       a% = 0
 WHILE NOT EOF (GADRDat$) AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
       adrfound% = 0
       f$ = feld$$
       IF feld$$ LIKE su$ + "*" OR feld$$ LIKE "*" + su$ + "*" THEN 
         adrfound% = 1
       END IF 
       IF GMASuperCount% > 0 THEN 
         IF IsMASuper%(codema.GAdrDat$) THEN 
         ELSE 
           adrfound% = 0
         END IF 
       END IF 
       IF adrfound% = 1 THEN 
         ok% = - 1
         IF GASP% THEN 
               datei1$ = GADRDat$
               codemaField$ = "codema." + datei1$
               succ% = 0
               REM 25102002 IF (IsWksVisible%(Workstation.datei1$) = - 1) OR codemaField$$ = 0 THEN 
               IF (IsWksVisible%(Workstation.datei1$) = - 1) THEN 
                 IF VAL (GMAView$) = 0 THEN 'wenn Daten aller Mitarbeiter sichtbar
                   succ% = - 1
                 ELSE 
                   SELECT CASE UCASE$ (datei1$)
                     CASE "ADRESSEN","DOKUMENT","AKQUISE","BCKONTAK","DOKBCK","AKQUIBCK","MAADR","KVERTRAG","ANTRAG"
                        
                        succ% = (codemaField$$ = VAL (GMAView$)) OR codemaField$$ = 0
                        succ% = succ% OR ((Workstation% = 0) AND (Workstation.datei1$ > 0))
                     ELSE CASE 
                        succ% = - 1
                   END SELECT 
                 END IF 
               END IF 
               ok% = succ%
         END IF 
         IF MNdisabled%("DATALOCK") THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
         END IF 
         IF ok% THEN 
             IF GCODIE% = - 1 THEN 
               CALL SearchVorbAdr(GAdrDat$)
               codeku% = Codeku.GAdrDat$
               IF EXISTS (codeku%,codeku.gteldat$) THEN 
                 SELECT KEY codeku% FILE GTElDat$ INDEX codeku.gteldat$
                 CALL SearchVorbTel(GAdrDat$)
               END IF 
             END IF 
             tmpZeile$ = LTRIM$ (nachname)
             IF LTRIM$ (vorname) <> "" THEN tmpZeile$ = tmpZeile$ + ", " + LTRIM$ (vorname)
             IF LTRIM$ (EGNachname) <> "" AND LTRIM$ (EGNACHNAme) <> LTRIM$ (Nachname) THEN tmpZeile$ = tmpZeile$ + ",LAB: " + LTRIM$ (EGNachname)
             IF LTRIM$ (EGvorname) <> "" THEN tmpZeile$ = tmpZeile$ + ", " + LTRIM$ (EGvorname)
             IF LTRIM$ (K1name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind1: " + LTRIM$ (K1name)
             IF LTRIM$ (K2name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind2: " + LTRIM$ (K2name)
             IF LTRIM$ (K3name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind3: " + LTRIM$ (K3name)
             IF LTRIM$ (K4name) <> "" THEN tmpZeile$ = tmpZeile$ + ", Kind4: " + LTRIM$ (K4name)
             tmpZeile$ = tmpZeile$ + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + SPACE$ (100) + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
             REM tmpZeile$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
             AdrFound$(a%) = tmpZeile$
             REM CALL Fehler(AdrFound$(a%),"")
             a% = a% + 1
           wi% = wi% + 1
           IF GCODIE% = - 1 THEN 
             ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
           END IF 
           CALL Server("GaugeMessage","Adre·datei wird durchsucht... " + TRIM$ ( STR$ (wi%,"9999")) + " gefunden (" + Nachname.GAdrDat$ + ", " + LEFT$ (Vorname.GAdrDat$,1) + ".)")
           CALL Server("LISTBOXADD",tmpZeile$)
         END IF 
       END IF 

       SELECT NEXT FILE GADRDat$
 WEND 
     AdrFound$(a%) = ""
     CALL Gauge(0,"")
     SET STATUS "Bereit"
     tfoundadr% = a%
     IF wi% <> 0 THEN 
       SET STATUS "Bitte wÑhlen Sie eine Adresse aus"
       IF _projekt$ LIKE "PROVIS" THEN 
         REM MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
         IF a% <> 0 THEN MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
       ELSE 
         IF _projekt$ <> "AKTE" THEN MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
       END IF 
       IF GCODIE% = - 1 THEN 
         c$ = "aa"
         req3% = CALL ("_SearchShow",c$)
         REM REQUEST c$,"",2
         REM ret% = CALL ("_SearchClose"):rem CALL Fehler("","")
         IF VAL (c$) <> 0 THEN 
           AdrSuche% = VAL (c$)
           adrfound% = VAL (c$)
           ok% = 0
           SET STATUS "Adresse gefunden..."
         END IF 
         IF req3% = 2 THEN 
           adrser% = 1
           CALL SerieNeu1(GAdrDat$)
           GOTO Ende230420091
         END IF 
       ELSE 
         CREATE DIALOG "ADRLISTE",0,0,440,197,title$,"MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,428,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,124,174,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,184,174,56,16,0,"&Abbrechen",0,0
         IF noserie% = 0 THEN ADD DIALOG "ADRLISTE",1,244,174,56,16,0,"&Serienbrief",2,0
         DIALOG "ADRLISTE",req4%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         REM 200999 Serienbrief
         IF req4% = 2 THEN 
           adrser% = 1
           CALL SerieNeu1(GAdrDat$)
           GOTO Ende230420091
         END IF 
         IF req4% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           AdrSuche% = VAL ( RIGHT$ (LAuswahl$,6))
           adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
           ok% = 0
           SET STATUS "Adresse gefunden..."
         ELSE 
           AdrSuche% = 0
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Keine entsprechende Adresse gefunden!","")
       ADRSuche% = 0
     END IF 
 END SUB 

FUNCTION ADRSuche1%(filtertype%)
 cfile$ = FILE 
 adrfound% = 0
 REM ** Feldnamen definieren
 DIM Feldnamen$(12)
 Feldnamen$(0) = "Nachname"
 Feldnamen$(1) = "Kundennummer"
 Feldnamen$(2) = "Vorname"
 Feldnamen$(3) = "Stra·e"
 Feldnamen$(4) = "Ort"
 Feldnamen$(5) = "Postleitzahl"
 Feldnamen$(6) = "Telefon/-fax"
 Feldnamen$(7) = "Firmenform"
 sw% = 8
 IF filtertype% <> 0 THEN 
   Feldnamen$(sw%) = "Hobby"
   sw% = 9
 END IF 
 IF defa$ LIKE "MEGA" THEN 
   Feldnamen$(sw%) = "KostentrÑger"
   Feldnamen$(sw% + 1) = "Kostenstelle"
   sw% = sw% + 2
 END IF 
 Feldnamen$(sw%) = "Stichwort"
 SET STATUS "Adresse suchen"
 FILE GAdrDat$:INDEX nachname.GAdrDat$
 Auswahl$ = suchopt$
 REM CREATE DIALOG "ADRSUCH",0,0,202,142,title$,"MS Sans Serif",8
 REM ADD DIALOG "ADRSUCH",4,0,0,202,142,0,""
 REM ADD DIALOG "ADRSUCH",9,6,12,20,23,2
 REM ADD DIALOG "ADRSUCH",5,32,14,164,19,0,"Bitte wÑhlen Sie aus, in welchem Datenbankfeld gesucht werden soll."
 REM ADD DIALOG "ADRSUCH",5,32,35,164,26,0,"Bei der Suche Åber das Stichwort kînnen Sie den Suchbegriff weglassen, um eine Liste aller Stichwîrter zu erhalten."
 REM ADD DIALOG "ADRSUCH",5,34,112,62,10,0,"Suchbegriff:"
 REM ADD DIALOG "ADRSUCH",6,34,122,88,11,128,0,suna$,50
 REM ADD DIALOG "ADRSUCH",5,34,83,56,8,0,"Suchfeld:"
 REM ADD DIALOG "ADRSUCH",8,34,93,88,60,3,2,Auswahl$,Feldnamen$
 REM REM ADD DIALOG "ADRSUCH",1,130,67,64,15,1,"&Schnellsuche",1,1
 REM REM ADD DIALOG "ADRSUCH",1,130,84,64,15,0,"&erweiterte Suche",2,1
 REM REM ADD DIALOG "ADRSUCH",1,130,101,64,15,0,"&Hilfe",3,1
 REM REM ADD DIALOG "ADRSUCH",1,130,118,64,15,0,"&Abbruch",0,0
 REM ADD DIALOG "ADRSUCH",1,130,84,64,15,1,"&Schnellsuche",1,1
 REM ADD DIALOG "ADRSUCH",1,130,101,64,15,0,"&erweiterte Suche",2,1
 REM REM ADD DIALOG "ADRSUCH",1,130,101,64,15,0,"&Hilfe",3,1
 REM ADD DIALOG "ADRSUCH",1,130,118,64,15,0,"&Abbruch",0,0
 REM DIALOG "ADRSUCH",req%
 REM REMOVE DIALOG "ADRSUCH"
 
 
     opt1% = 2
     stichw$ = "n"
     stichwort$ = ""
     option2% = 1
     CREATE DIALOG "ADRFilter",0,0,290,164,title$,"MS Sans Serif",8
     ADD DIALOG "ADRFilter",4,5,0,280,124,0," Suche nach "
     ADD DIALOG "ADRFilter",6,169,30,112,13,128,0,suna$,50
     ADD DIALOG "ADRFilter",6,169,46,112,13,128,0,suna1$,50
     ADD DIALOG "ADRFilter",3,14,11,72,11,0,"Kundennummer",6,opt1%
     ADD DIALOG "ADRFilter",3,14,25,34,11,0,"Anrede",1,opt1%
     ADD DIALOG "ADRFilter",3,14,38,68,11,0,"Nachname/Firma",2,opt1%
     ADD DIALOG "ADRFilter",3,14,52,22,11,0,"Ort",3,opt1%
     ADD DIALOG "ADRFilter",3,14,67,28,11,0,"PLZ",4,opt1%
     ADD DIALOG "ADRFilter",3,14,81,79,11,0,"Stra·e",5,opt1%
     ADD DIALOG "ADRFilter",3,14,94,79,11,0,"Telefon/Fax",7,opt1%
     ADD DIALOG "ADRFilter",5,169,16,111,12,0,"Bitte den Suchbegriff eingeben"
     ADD DIALOG "ADRFilter",5,150,32,14,11,0,"von"
     ADD DIALOG "ADRFilter",5,150,46,12,11,0,"bis"
     REM ADD DIALOG "ADRFilter",2,169,60,85,12,0,"Alle Angaben drucken","j","n",KurzLang$
     REM ADD DIALOG "ADRFilter",2,169,75,85,12,0,"Termine mitdrucken","j","n",Terminejn$
     ADD DIALOG "ADRFilter",2,14,108,84,12,0,"Stichwort einbeziehen","j","n",stichw$
     REM ADD DIALOG "ADRFilter",3,4,128,125,11,0,"Ausgabe auf Drucker/Fenster",1,Option2%
     REM ADD DIALOG "ADRFilter",3,136,128,148,11,0,"Ausgabe in dBASE - Datei fÅr Serienbriefe",2,Option2%
     ADD DIALOG "ADRFilter",1,89,147,49,14,1,"&Weiter",1,1
     ADD DIALOG "ADRFilter",1,141,147,49,14,0,"&Abbruch",0,0
     DIALOG "ADRFilter",req%
     REMOVE DIALOG ALL 
 
 
 
 AdrSuche% = 0
 IF req% <> 0 AND (suna$ <> "" OR suna1$ <> "" OR stichw$ = "j") THEN 
   IF stichw$ = "j" THEN feld1$ = "Stichwort." + GAdrDat$
     SELECT CASE opt1%
     CASE 1
       feld$ = "Anrede." + GAdrDat$
       INDEX feld$$
       IF suna1$ = "" THEN 
         REM suna$ = suna$ + "*"
         suna$ = UCASE$ (suna$)
         suna1$ = suna$
       ELSE 
         IF suna$ <> "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = UCASE$ (suna1$)
         ELSE 
           suna$ = UCASE$ (suna1$)
           suna1$ = suna$
         END IF 
       END IF 
     CASE 2
       feld$ = "nachname." + GAdrDat$
       INDEX feld$$
       IF suna1$ = "" THEN 
         suna$ = UCASE$ (suna$)
         suna1$ = suna$
       ELSE 
         IF suna$ <> "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = UCASE$ (suna1$)
         ELSE 
           suna$ = UCASE$ (suna1$)
           suna1$ = suna$
         END IF 
       END IF 
     CASE 3
       feld$ = "Ort." + GAdrDat$
       INDEX feld$$
       IF suna1$ = "" THEN 
         suna$ = UCASE$ (suna$)
         suna1$ = suna$
       ELSE 
         IF suna$ <> "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = UCASE$ (suna1$)
         ELSE 
           suna$ = UCASE$ (suna1$)
           suna1$ = suna$
         END IF 
       END IF 
     CASE 4
       feld$ = "PLZ." + GAdrDat$
       INDEX feld$$
       IF suna1$ = "" THEN 
         suna$ = UCASE$ (suna$)
         suna1$ = suna$
       ELSE 
         IF suna$ <> "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = UCASE$ (suna1$)
         ELSE 
           suna$ = UCASE$ (suna1$)
           suna1$ = suna$
         END IF 
       END IF 
     CASE 5
       feld$ = "Stra·e." + GAdrDat$
       INDEX feld$$
       IF suna1$ = "" THEN 
         suna$ = UCASE$ (suna$)
         suna1$ = suna$
       ELSE 
         IF suna$ <> "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = UCASE$ (suna1$)
         ELSE 
           suna$ = UCASE$ (suna1$)
           suna1$ = suna$
         END IF 
       END IF 
     CASE 6
       feld$ = "Kundennummer." + GAdrDat$
       INDEX feld$$
       IF suna1$ = "" THEN 
         suna$ = UCASE$ (suna$)
         suna1$ = suna$
       ELSE 
         IF suna$ <> "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = UCASE$ (suna1$)
         ELSE 
           suna$ = UCASE$ (suna1$)
           suna1$ = suna$
         END IF 
       END IF 
     CASE 7
       feld$ = "Telefon/Faxnummer"
       IF suna1$ = "" THEN 
         suna$ = UCASE$ (suna$)
         suna1$ = suna$
       ELSE 
         IF suna$ <> "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = UCASE$ (suna1$)
         ELSE 
           suna$ = UCASE$ (suna1$)
           suna1$ = suna$
         END IF 
       END IF 
     END SELECT 
     x% = ASC ( LEFT$ ( UCASE$ (suna$),1))
     SELECT CASE x%
       CASE 142
         sun$ = "A" + RIGHT$ (suna$, LEN (suna$) - 1)
         suna$ = sun$
       CASE 153
         sun$ = "O" + RIGHT$ (suna$, LEN (suna$) - 1)
         suna$ = sun$
       CASE 154
         sun$ = "U" + RIGHT$ (suna$, LEN (suna$) - 1)
         suna$ = sun$
     END SELECT 
 
 
 
   SET STATUS "Adre·suche lÑuft..."
   REM feld$ = feld$ + "."+GAdrDat$
   a% = 0
   REDIM AdrFound$( RECCOUNT (GAdrDat$))
   b% = RECCOUNT (GAdrDat$)
   
   ok% = 1
   IF req% = 1 THEN 
     IF feld$ LIKE "Telefon/Faxnummer" THEN 
       suna1$ = suna$
       REM IF RIGHT$ (suna1$,1) <> "*" THEN suna1$ = suna1$ + "*"
       FILE GTelDat$
       INDEX nummer.GTelDat$
       SELECT FIRST 
       SELECT KEY suna1$ FILE GTelDat$ INDEX nummer.GTelDat$
       a% = 0
       codekuold% = - 1
       WHILE NOT EOF (GTelDat$) AND LEFT$ (nummer.GTelDat$, LEN (suna$)) >= suna$ AND LEFT$ (nummer.GTelDat$, LEN (suna1$)) <= suna1$
         codeku% = Codeku.GTelDat$
         IF codeku% <> codekuold% THEN 
           codekuold% = codeku%
           SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
           IF stichw$ <> "j" THEN 
 AdrFound$(a%) = LTRIM$ (nummer.GTelDat$) + ",   " + LTRIM$ (nachname.GAdrDat$) + ", " + LTRIM$ (vorname.GAdrDat$) + ", " + LTRIM$ (ort.GAdrDat$) + ", " + PLZ.GAdrDat$ + ", " + LTRIM$ (Stra·e.GAdrDat$) + ", " + SPACE$ (120) + STR$ (codeku%,"000000")
           a% = a% + 1
           ELSE 
             IF stichwort.GAdrDat$ LIKE sunast$ THEN 
 AdrFound$(a%) = LTRIM$ (nummer.GTelDat$) + ",   " + LTRIM$ (nachname.GAdrDat$) + ", " + LTRIM$ (vorname.GAdrDat$) + ", " + LTRIM$ (ort.GAdrDat$) + ", " + PLZ.GAdrDat$ + ", " + LTRIM$ (Stra·e.GAdrDat$) + ", " + SPACE$ (120) + STR$ (codeku%,"000000")
           a% = a% + 1
             END IF 
           END IF 
         END IF 
         SELECT NEXT FILE GTelDat$
       WEND 
       FILE GAdrDat$
       GOTO Telf070796
     END IF 
     IF feld1$ LIKE "Stichwort." + GAdrDat$ THEN 
       CALL DFile(2,"OFFICE\keywords" + _fpw$)
       FILE "keywords"
       INDEX keyword
       SELECT FIRST 
       a% = 0
       SELECT WHERE keyword <> ""
       SELECT FIRST 
       WHILE NOT EOF ("keywords")
         AdrFound$(a%) = LTRIM$ (keyword)
         a% = a% + 1
         SELECT NEXT 
       WEND 
       AdrFound$(a%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRSTICHW",0,0,194,202,title$,"MS Sans Serif",8
       ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
       ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
       DIALOG "ADRSTICHW",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRSTICHW"
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         sunast$ = "*" + LEFT$ (LAuswahl$) + "*"
       ELSE 
         ok% = 0
         AdrSuche% = 0
         REDIM AdrFound$( RECCOUNT (GAdrDat$))
         GOTO Ende230420091adrsu
       END IF 
       MOUSE OFF 
       FILE GAdrDat$
       IF suna$ = "" AND suana1$ = "" THEN 
         FILE GAdrDat$
         INDEX feld$$
         a% = 0
         SELECT FIRST 
         SELECT KEY suna$ INDEX feld$$
         adrmax% = RECCOUNT (GAdrDat$)
         cp% = 0
         lp% = 0
         pc% = 0
         WHILE NOT EOF (GAdrDat$)
           pc% = pc% + 1
           cp% = INT (100 / adrmax% * pc%)
           IF cp% <> lp% THEN 
             SET STATUS "Verarbeitung: " + STR$ (cp%,"999") + "%"
             lp% = cp%
           END IF 
           IF Stichwort.GAdrDat$ LIKE sunast$ THEN 
             sok% = - 1
             IF MNdisabled%("DATALOCK") THEN 
               IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
             END IF 
             IF sok% THEN 
               AdrFound$(a%) = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + LTRIM$ (telefon1) + SPACE$ (120) + STR$ (codeku,"000000")
               a% = a% + 1
             END IF 
           END IF 
           SELECT NEXT 
         WEND 
         AdrFound$(a%) = ""
         SET STATUS "Bereit"
         IF a% = 0 THEN 
           CALL Fehler("Es wurde keine Adresse mit diesem Stichwort gefunden!","")
           AdrSuche% = 0
           ok% = 0
         END IF 
       END IF 
     END IF 
     IF feld$ <> "Kostenstelle." + GAdrDat$ THEN 
         a% = 0
         locktest% = MNdisabled%("DATALOCK")
         INDEX feld$$
         i% = 1
         ok% = 1
         SELECT FIRST 
         z% = LEN (suna$)
         suna2$ = suna$
         WHILE i% <= z% AND ok% = 1
           SELECT FIRST 
           x% = ASC ( MID$ ( UCASE$ (suna$),i%,1))
           SELECT CASE x%
             CASE 142
               SELECT KEY suna$ INDEX feld$$
               ok% = 0
             CASE 153
               SELECT KEY suna$ INDEX feld$$
               ok% = 0
             CASE 154
               SELECT KEY suna$ INDEX feld$$
               ok% = 0
             CASE ELSE 
               SELECT FIRST 
               suna2$ = suna$
               SELECT KEY suna2$ INDEX feld$$
           END SELECT 
           i% = i% + 1
         WEND 
         IF suna1$ = suna$ THEN suna1$ = suna2$
         suna$ = suna2$
         lensuna% = LEN (suna$)
         lensuna1% = LEN (suna1$)
         IF suna$ <> suna1$ THEN 
           x% = ASC ( LEFT$ ( UCASE$ (suna$),1))
           SELECT CASE x%
             CASE 142,65
             suna3$ = suna$ + "*"
             suna4$ = suna1$ + "*"
             EXECUTE "select where feld$$ like suna3$ or feld$$ like suna4$ OR LEFT$ ( UCASE$ (feld$$),lensuna1%) <= suna1$ OR ASC ( LEFT$ ( UCASE$ (feld$$),1)) = 142"
             REM 071098
             SELECT FIRST 
             WHILE NOT EOF (GAdrDat$)
             CASE 153,79
             EXECUTE "select where feld$$ like suna3$ or feld$$ like suna4$ OR LEFT$ ( UCASE$ (feld$$),lensuna1%) <= suna1$ OR ASC ( LEFT$ ( UCASE$ (feld$$),1)) = 153"
             REM 071098
             SELECT FIRST 
             WHILE NOT EOF (GAdrDat$)
             CASE 154,85
             EXECUTE "select where feld$$ like suna3$ or feld$$ like suna4$ OR LEFT$ ( UCASE$ (feld$$),lensuna1%) <= suna1$ OR ASC ( LEFT$ ( UCASE$ (feld$$),1)) = 154"
             REM 071098
             SELECT FIRST 
             WHILE NOT EOF (GAdrDat$)
             CASE ELSE 
             EXECUTE "select where feld$$ like suna3$ or feld$$ like suna4$ OR LEFT$ ( UCASE$ (feld$$),lensuna1%) <= suna1$
             REM 071098
             SELECT FIRST 
             WHILE NOT EOF (GAdrDat$)
           END SELECT 
           REM WHILE (feld$$ LIKE suna$ + "*" OR feld$$ LIKE suna1$ + "*" OR LEFT$ ( UCASE$ (feld$$),lensuna1%) <= suna1$) AND NOT EOF (GAdrDat$)
         END IF 
         IF suna$ = suna1$ THEN 
           x% = ASC ( LEFT$ ( UCASE$ (suna$),1))
           suna3$ = suna$ + "*"
           SELECT CASE x%
             CASE 142,65
             EXECUTE "select where feld$$ like suna3$ OR ASC ( LEFT$ ( UCASE$ (feld$$),1)) = 142"
             REM 071098
             SELECT FIRST 
             WHILE NOT EOF (GAdrDat$)
             CASE 153,79
              EXECUTE "select where feld$$ like suna3$ OR ASC ( LEFT$ ( UCASE$ (feld$$),1)) = 153"
             REM 071098
             SELECT FIRST 
             WHILE NOT EOF (GAdrDat$)
             CASE 154,85
              EXECUTE "select where feld$$ like suna3$ OR ASC ( LEFT$ ( UCASE$ (feld$$),1)) = 154"
             REM 071098
             SELECT FIRST 
             WHILE NOT EOF (GAdrDat$)
             CASE ELSE 
             REM IF RIGHT$ (suna$,1) <> "*" THEN suna$ = suna$ + "*"
             SELECT FIRST 
             SELECT KEY suna$ INDEX feld$$
             suna3$ = suna$ + "*"
             EXECUTE "select where feld$$ like suna3$"
             WHILE LEFT$ ( UCASE$ (nachname.GAdrDat$), LEN (suna1$)) <= suna1$ AND NOT EOF (GAdrDat$)
           END SELECT 
         END IF 
           sok% = - 1
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
           END IF 
           IF sok% THEN 
             codeku% = codeku.GAdrDat$
             IF suna$ <> suna1$ THEN 
               y% = ASC ( LEFT$ ( UCASE$ (feld$$),1))
               SELECT CASE y%
                 CASE 142,65
                   y% = 142
                 CASE 153,79
                   y% = 153
                 CASE 154,85
                   y% = 154
               END SELECT 
               IF LEFT$ ( UCASE$ (feld$$),lensuna1%) <= suna1$ OR ASC ( LEFT$ ( UCASE$ (feld$$),1)) = y% THEN 
                 IF stichw$ <> "j" THEN 
                   AdrFound1$ = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", "
                   IF EXISTS (codeku,codeku.GTelDat$) THEN 
                     SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
                     WHILE NOT EOF (GTelDat$) AND codeku.GTelDat$ = codeku%
                       AdrFound1$ = AdrFound1$ + LTRIM$ (nummer.GTelDat$) + ","
                       SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
                     WEND 
                   END IF 
                   AdrFound$(a%) = AdrFound1$ + SPACE$ (120) + STR$ (codeku,"000000")
                   a% = a% + 1
                   SET STATUS "Anzahl gefundene Adressen: " + STR$ (a%,"99999999") + " " + nachname.GAdrDat$
                 ELSE 
                   IF stichwort.GAdrDat$ LIKE sunast$ THEN 
                     AdrFound1$ = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", "
                     IF EXISTS (codeku,codeku.GTelDat$) THEN 
                       SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
                       WHILE NOT EOF (GTelDat$) AND codeku.GTelDat$ = codeku%
                         AdrFound1$ = AdrFound1$ + LTRIM$ (nummer.GTelDat$) + ","
                         SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
                       WEND 
                     END IF 
                     AdrFound$(a%) = AdrFound1$ + SPACE$ (120) + STR$ (codeku,"000000")
                     a% = a% + 1
                     SET STATUS "Anzahl gefundene Adressen: " + STR$ (a%,"99999999") + " " + nachname.GAdrDat$
                   END IF 
                 END IF 
               END IF 
             ELSE 
               IF stichw$ <> "j" THEN 
                 AdrFound1$ = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", "
                 IF EXISTS (codeku,codeku.GTelDat$) THEN 
                   SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
                   WHILE NOT EOF (GTelDat$) AND codeku.GTelDat$ = codeku%
                     AdrFound1$ = AdrFound1$ + LTRIM$ (nummer.GTelDat$) + ","
                     SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
                   WEND 
                 END IF 
                 AdrFound$(a%) = AdrFound1$ + SPACE$ (120) + STR$ (codeku,"000000")
                 a% = a% + 1
                 SET STATUS "Anzahl gefundene Adressen: " + STR$ (a%,"99999999") + " " + nachname.GAdrDat$
               ELSE 
                 IF stichwort.GAdrDat$ LIKE sunast$ THEN 
                   AdrFound1$ = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", "
                   IF EXISTS (codeku,codeku.GTelDat$) THEN 
                     SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
                     WHILE NOT EOF (GTelDat$) AND codeku.GTelDat$ = codeku%
                       AdrFound1$ = AdrFound1$ + LTRIM$ (nummer.GTelDat$) + ","
                       SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
                     WEND 
                   END IF 
                   AdrFound$(a%) = AdrFound1$ + SPACE$ (120) + STR$ (codeku,"000000")
                   a% = a% + 1
                   SET STATUS "Anzahl gefundene Adressen: " + STR$ (a%,"99999999") + " " + nachname.GAdrDat$
                 END IF 
               END IF 
             END IF 
           END IF 
           FILE GAdrDat$
           SELECT NEXT FILE GAdrDat$ INDEX feld$$
           x% = ASC ( LEFT$ ( UCASE$ (feld$$),1))
         WEND 
         SELECT WHERE FILE GAdrDat$
         AdrFound$(a%) = ""
       ELSE 
         a% = 0
         INDEX feld$$
         SELECT FIRST 
         suna% = VAL (suna$)
         SELECT KEY suna% INDEX feld$$
         WHILE feld$$ = suna% AND NOT EOF (GAdrDat$)
           sok% = - 1
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN sok% = 0
           END IF 
           IF sok% THEN 
             AdrFound$(a%) = LTRIM$ (nachname) + ", " + LTRIM$ (vorname) + ", " + LTRIM$ (ort) + ", " + PLZ + ", " + LTRIM$ (Stra·e) + ", " + LTRIM$ (telefon1) + SPACE$ (120) + STR$ (codeku,"000000")
             a% = a% + 1
           END IF 
           SELECT NEXT 
         WEND 
         AdrFound$(a%) = ""
       END IF 
     END IF 
Telf070796: 
     LAuswahl$ = AdrFound$(0)
     LAuswahl1$(0) = LAuswahl$
     req3% = 0
     IF a% <> 0 THEN 
     IF _projekt$ LIKE "PROVIS" THEN 
       MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
     ELSE 
       MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
     END IF 
       CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"MS Sans Serif",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,114,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,174,174,56,16,0,"&Abbrechen",0,0
       DIALOG "ADRLISTE",req3%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req3% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         AdrSuche% = VAL ( RIGHT$ (LAuswahl$,6))
         adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
         ok% = 0
         SET STATUS "Adresse gefunden..."
       ELSE 
         AdrSuche% = 0
       END IF 
     ELSE 
       adrfound% = 0
       IF _projekt$ LIKE "PROVIS" THEN 
         MENU 3,6,0
       ELSE 
         MENU 4,6,0
       END IF 
     END IF 
     IF AdrSuche% = 0 AND ok% = 1 THEN 
       AdrSuche% = 0
       ok% = 1
       REQUEST "Eintrag nicht gefunden!","Erweiterte Suche durchfÅhren?",135,req2%
       IF req2% = 1 THEN 
         ok% = 1
       ELSE 
         ok% = 0
       END IF 
     END IF 
     REM REDIM AdrFound$( RECCOUNT (GAdrDat$))
   END IF 
   IF AdrSuche% = 0 AND ok% = 1 THEN 
     suna$ = "*" + suna$ + "*"
     REM SET STATUS "Adre·suche nach " + feld$ + " = " + suna$
     SET STATUS "Adre·suche lÑuft..."
     wi% = 0
     CALL Server("LISTBOXINIT","Adre·auswahl")
     FILE GAdrDat$
     SELECT FIRST 
     MOUSE OFF 
     CALL Gauge(1,"Adre·datei wird durchsucht...")
     CALL Server("GAUGEENABLECANCEL","")
     _prozt% = 0
     _proz2% = 0
     _anz% = RECCOUNT (GAdrDat$)
     WHILE NOT EOF (GAdrDat$) AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
       adrfound% = 0
       SELECT CASE feld$
       CASE "Kundennummer." + GAdrDat$
         IF Kundennummer.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Telefon1." + GAdrDat$
         IF Telefon1.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF Telefon2.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF Telefax.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASTelefax.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASTelefon1.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASTelefon2.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Nachname." + GAdrDat$,"Vorname." + GAdrDat$
         IF Nachname.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF Vorname.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF Geburtsname.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Stra·e." + GAdrDat$
         IF Stra·e.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASStra·e.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Ort." + GAdrDat$
         IF Ort.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASOrt.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "PLZ." + GAdrDat$
         IF PLZ.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF ASPLZ.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       CASE "Stichwort." + GAdrDat$
         IF Stichwort.GAdrDat$ LIKE suna$ THEN adrfound% = 1
         IF Notiz.GAdrDat$ LIKE suna$ THEN adrfound% = 1
       END SELECT 
       IF adrfound% = 1 THEN 
         ok% = - 1
         IF MNdisabled%("DATALOCK") THEN 
           IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
         END IF 
         IF ok% THEN 
           tmpZeile$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ", " + ort.GAdrDat$ + " (" + STR$ (CodeKU.GAdrDat$,"000000") + ")"
           wi% = wi% + 1
           CALL Server("GaugeMessage","Adre·datei wird durchsucht... " + TRIM$ ( STR$ (wi%,"9999")) + " gefunden (" + Nachname.GAdrDat$ + ", " + LEFT$ (Vorname.GAdrDat$,1) + ".)")
           CALL Server("LISTBOXADD",tmpZeile$)
         END IF 
       END IF 
       SELECT NEXT FILE GAdrDat$
     WEND 
     CALL Gauge(0,"")
     SET STATUS "Bereit"
     IF wi% <> 0 THEN 
       SET STATUS "Bitte wÑhlen Sie eine Adresse aus"
       IF _projekt$ LIKE "PROVIS" THEN 
         MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
       ELSE 
         MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRWahl"
       END IF 
       CALL Server("LISTBOXSHOW","Bitte wÑhlen Sie die gewÅnschte Adresse aus:")
       erg$ = ServerReply$()
       IF erg$ <> "" THEN 
         ADRSuche% = VAL ( MID$ (erg$, LEN (erg$) - 6,6))
       ELSE 
         ADRSuche% = 0
       END IF 
     ELSE 
       CALL Fehler("Keine entsprechende Adresse gefunden!","")
       ADRSuche% = 0
     END IF 
   END IF 
   tfoundadr% = a%
   adrglob% = 0
 ELSE 
   tfoundadr% = 0
   IF _projekt$ LIKE "PROVIS" THEN 
     MENU 3,6,0,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
   ELSE 
     MENU 4,6,0,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
   END IF 
   adrglob% = 0
 END IF 
Ende1adrsu: 
 SET STATUS "Bereit"
 MOUSE ON 
 FILE cfile$
 END FUNCTION 
  
SUB ADRKurzSuche()
   IF adrfound% < 1 THEN END SUB 
   IF GCODIE% = - 1 THEN 
     c$ = "aa"
     req3% = CALL ("_SearchReShow",c$)
     REM REQUEST c$,"",2
     REM ret% = CALL ("_SearchClose"):rem CALL Fehler("","")
     IF VAL (c$) <> 0 THEN 
       AdrSuche% = VAL (c$)
       adrfound% = VAL (c$)
       adr% = VAL (c$)
       ok% = 0
       SET STATUS "Adressen gefunden..."
       SELECT FORM KEY adr% FILE GAdrDat$ INDEX Codeku.GAdrDat$
       SELECT FORM KEY adr% FILE GTelDat$ INDEX Codeku.GTelDat$
       SET INDEX INDEX 
       REM CALL Fehler("","")
       CALL ADRFeldnamen()
       FORM 
       MOUSE ON 
     END IF 
     IF req3% = 2 THEN 
       adrser% = 1
       CALL SerieNeu1(GAdrDat$)
       GOTO endadr200806
     END IF 
     ja% = - 1
     IF disabled%("ADRDrucken") THEN ja% = 0
     IF req3% = 3 AND ja% = - 1 THEN 
       REM drucken
       ON ERROR GOTO adrdr190620021
       DIM dlg AS Dialog
       DIM control AS DialogControl
asdrdr190620021: 
       ON ERROR GOTO ErrorHandler
       Superbase.Dialogs.Add("ADRFilter")
       SET dlg = Superbase.Dialogs.ADRFilter
       dlg.Move(0,0,158,111)
       dlg.Caption = title$
       dlg.FontName = "MS Sans Serif"
       dlg.FontSize = 8
 
       SET control = dlg.Add("DialogFrame2","DialogFrame")
       control.Move(5,7,141,77)
       control.Caption = "Druckoptionen"
 
       SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
       control.Move(11,24,85,10)
       control.Caption = "Alle Angaben drucken"
       control.Bind("KurzLang$")
       control.ValueOn = "j"
       control.ValueOff = "n"
 
       SET control = dlg.Add("DialogCheckBox2","DialogCheckBox")
       control.Move(11,38,85,11)
       control.Caption = "Termine mitdrucken"
       control.Bind("Terminejn$")
       control.ValueOn = "j"
       control.ValueOff = "n"
 
       SET control = dlg.Add("DialogCheckBox3","DialogCheckBox")
       control.Move(11,53,115,11)
       control.Caption = "VertrÑge zur Adresse drucken!"
       control.Bind("VertragJN$")
       control.ValueOn = "j"
       control.ValueOff = "n"
 
       SET control = dlg.Add("DialogCheckBox4","DialogCheckBox")
       control.Move(11,68,105,11)
       control.Caption = "als Telefonliste"
       control.Bind("adrtelefon$")
       control.ValueOn = "j"
       control.ValueOff = "n"
 
       SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
       control.Move(22,89,48,15)
       control.Default = 1
       control.Caption = "&Weiter"
       control.ReturnValue = 1
 
       SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
       control.Move(74,89,48,15)
       control.Caption = "&Abbruch"
       control.ReturnValue = 0
       control.Cancel = 1
       DIALOG "ADRFilter",req%
       REMOVE DIALOG ALL 
       IF req% = 1 THEN 
         REM jetzt das Array auslesen und in eine Datei speichern
         FILE GADRDat$
         cindex$ = INDEX 
         INDEX codeku.Gadrdat$
         CALL DFile(2,"OFFICE\ADRLEER" + _fpw$)
         xi% = 0
         REM FOR xi% = 0 TO a% - 1
         WHILE AdrFound$(xi%) <> ""
           codeku% = VAL ( RIGHT$ (AdrFound$(xi%),6))
           SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
           anrede$ = Anrede.GadrDat$
           titel$ = Titel.GADRDat$
           IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" THEN 
             nachname$ = LTRIM$ (nachname.GAdrDat$)
             vorname$ = LTRIM$ (vorname.GAdrDat$)
           ELSE 
             nachname$ = LTRIM$ (nachname.GAdrDat$)
             vorname$ = LTRIM$ (Geburtsname.GAdrDat$)
           END IF 
           gebdat% = Geburtstag.GAdrDat$
           REM CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
           BLANK FILE "ADRLEER"
           a% = CopyRecord%(GADRDat$,"ADRLEER")
           Nachname.adrleer = nachname$
           Vorname.adrleer = Vorname$
           STORE FILE "ADRLEER"
           UNLOCK FILE "ADRLEER"
           REM NEXT xi%
           xi% = xi% + 1
           SET STATUS nachname$ + "    " + STR$ (xi%,",999999") + " Adressen aufbereitet"
         WEND 
         REM dann drucken auslîsen
         Wbericht$ = "ADRLEER"
         title2$ = "Adressliste "
         CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
         INDEX cindex$
         REMOVE FROM FILE "ADRLEER"
         REM CALL Fehler("","")
       END IF 
     END IF 
   ELSE 
     prompt% = 0
     FOR a% = 0 TO tfoundadr%
       IF AdrFound$(a%) <> "" AND VAL ( RIGHT$ (Adrfound$(a%),6)) = adrfound% THEN 
       IF prompt% = 0 THEN prompt% = a%
      END IF 
     NEXT a%
     cuknr% = Codeku.GAdrDat$
     LAuswahl$ = LAuswahl1$(0)
     AdrFound$ = LAuswahl$
     adrfound% = 1
     CREATE DIALOG "ADRLISTE",0,0,440,197,title$,"MS Sans Serif",8
     ADD DIALOG "ADRLISTE",7,5,8,428,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
     ADD DIALOG "ADRLISTE",1,164,174,56,16,1,"&OK",1,1
     ADD DIALOG "ADRLISTE",1,224,174,56,16,0,"&Abbrechen",0,0
     ADD DIALOG "ADRLISTE",1,284,174,56,16,0,"&Serienbrief",3,0
     DIALOG "ADRLISTE",req3%
     MOUSE ON 
     REMOVE DIALOG "ADRLISTE"
     IF req3% = 1 THEN 
       LAuswahl$ = LAuswahl1$(0)
       adr% = VAL ( RIGHT$ (LAuswahl$,6))
       adrfound% = adr%
       ok% = 0
       SET STATUS "Adresse gefunden..."
     ELSE 
       adr% = 0
     END IF 
   END IF 
   adrhis% = 0
   IF adr% <> 0 THEN 
     cuknr% = adr%
     REM 22072003
     adrhis% = - 1
   END IF 
   IF adr% <> 0 THEN 
     cuknr% = adr%
     SELECT KEY cuknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     IF adrhis% = - 1 AND GADRDat$ LIKE "ADRESSEN" THEN 
       BLANK FILE "ADRHIS"
       codekey.adrhis = SER ("ADRHIS",1)
       codema.adrhis = GMACodeMA%
       codeku.adrhis = cuknr%
       name.adrhis = LEFT$ (Nachname.adressen + "/" + Vorname.adressen + "/" + Ort.adressen + "/" + Stra·e.adressen,200)
       QCodeMAKey.adrhis = STR$ (GMACodeMA%,"000000") + STR$ (codekey.adrhis,"000000")
       timestamp$ = DATE$ ( TODAY ,"yymmdd") + STR$ ( HRS ( NOW ) * 100 + MINS ( NOW ),"0000")
       timestamp% = VAL (timestamp$)
       Timestamp.adrhis = timestamp%
       STORE FILE "ADRHIS"
     END IF 
     knr% = cuknr%
     CALL ADRFeldnamen()
     SET INDEX INDEX 
   END IF 
endadr200806: 
   FORM 
   MOUSE ON 
 END SUB 
  
 
SUB ADRWahl()
 MOUSE OFF 
 CALL Server("LISTBOXSHOW","Bitte wÑhlen Sie die gewÅnschte Adresse aus:")
 cfile$ = FILE 
 FILE GAdrDat$
 cindex$ = INDEX 
 erg$ = ServerReply$()
 IF erg$ <> "" THEN 
   cuknr% = VAL ( MID$ (erg$, LEN (erg$) - 6,6))
   SELECT KEY cuknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   SELECT FORM KEY cuknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   CALL ADRFeldnamen()
   SET INDEX cindex$$
   FORM 
 END IF 
 INDEX cindex$$
 MOUSE ON 
 END SUB 
 
 
 ' Filter fÅr Adressen setzen
 ' ====================================================================== 
  
SUB ADRFilter1()
 CALL DFile(2,"OFFICE\keywords" + _fpw$)
 IF WHERE = "" THEN 
   opt% = 1
   stichw$ = "n"
   stichwort$ = ""
   CREATE DIALOG "ADRFilter",0,0,109,110,title$,"MS Sans Serif",8
   ADD DIALOG "ADRFilter",4,4,1,101,77,0," Suche nach "
   ADD DIALOG "ADRFilter",3,8,12,34,12,0,"Anrede",1,opt%
   ADD DIALOG "ADRFilter",3,8,24,69,12,0,"Nachname/Firma",2,opt%
   ADD DIALOG "ADRFilter",3,8,36,22,12,0,"Ort",3,opt%
   ADD DIALOG "ADRFilter",3,8,48,29,12,0,"PLZ",4,opt%
   ADD DIALOG "ADRFilter",6,8,61,91,13,128,0,suna$,30
   ADD DIALOG "ADRFilter",2,4,80,85,11,0,"Stichwort einbeziehen","j","n",stichw$
   ADD DIALOG "ADRFilter",1,4,92,50,15,1,"&Weiter",1,1
   ADD DIALOG "ADRFilter",1,56,92,50,15,0,"&Abbruch",0,0
   DIALOG "ADRFilter",req%
   REMOVE DIALOG ALL 
   IF req% = 1 THEN 
     IF stichw$ = "j" THEN 
       REQUEST "Nach welchem Stichwort soll gesucht werden?","WÑhlen Sie ein Stichwort aus!",25,req%,stichwort$,72,keyword.keywords INDEX keyword.keywords
       IF req% = 0 THEN 
         stichw$ = "n"
       END IF 
     END IF 
     SELECT CASE opt%
     CASE 1
       feld$ = "Anrede." + GAdrDat$
       suna$ = suna$ + "*"
     CASE 2
       feld$ = "nachname." + GAdrDat$
       suna$ = suna$ + "*"
     CASE 3
       feld$ = "Ort." + GAdrDat$
       suna$ = suna$ + "*"
     CASE 4
       feld$ = "PLZ." + GAdrDat$
       suna$ = suna$ + "*"
     END SELECT 
     MOUSE OFF 
     SELECT WHERE FILE GAdrDat$
     IF suna$ = "*" THEN suna$ = "**"
     stichwort$ = "*" + stichwort$ + "*"
     IF stichw$ = "j" THEN 
       EXECUTE "SELECT WHERE FILE GADRDat$ " + feld$ + " LIKE ~" + suna$ + "~ AND Stichwort.GAdrDat$ LIKE ~" + Stichwort$ + "~"
       SELECT FIRST 
     ELSE 
       EXECUTE "SELECT WHERE FILE GADRDat$ " + feld$ + " LIKE ~" + suna$ + "~"
       SELECT FIRST 
     END IF 
     SET STATUS "Suche erste öbereinstimmung..."
     SELECT FORM FIRST FILE GAdrDat$
     FORM 
   END IF 
 ELSE 
   SELECT WHERE FILE GAdrDat$
 END IF 
 MOUSE ON 
 IF WHERE <> "" THEN 
   MENU 4,3,2
 ELSE 
   MENU 4,3,1
 END IF 
 END SUB 
 
 
SUB ADRFilter2()
 CALL SelectFilter()
 IF WHERE <> "" THEN 
   MENU 4,3,2
 ELSE 
   MENU 4,3,1
 END IF 
 END SUB 
 
 
 ' Dokumentenverwaltung (Adre·bezogen mit direktem MenÅaufruf)
 ' ============================================================================
 
SUB ADRDOK()
 IF DOKsub% <> 1 THEN 
   Gruppe$ = DOKGruppen$(mnadr2% - 1)
 ELSE 
   Gruppe$ = "allgemeine Schreiben"
 END IF 
 Doksub% = 0
 knr% = CodeKU.GAdrDat$
 CALL DOKUMENT(Gruppe$,knr%)
 _formend% = 1
 END SUB 
 
 
 ' Dokumentenverwaltung (Adre·bezogen mit direktem MenÅaufruf)
 ' ============================================================================
 
SUB MAADRDOK1()
 IF DOKsub% <> 1 THEN 
   Gruppe$ = DOKGruppen$(mnadr2% - 1)
 ELSE 
   Gruppe$ = "Mitarbeiterdokument"
 END IF 
 Doksub% = 0
 knr% = CodeKU.GAdrDat$
 CALL DOKUMENT(Gruppe$,knr%)
 END SUB 
 
 
 ' Dokumentenverwaltung (Adre·bezogen Optionen|Dokumente)
 ' ============================================================================
 
SUB ADRDok()
 knr% = CodeKU.GAdrDat$
 CALL DOKUMENT(DOKGruppen$(0),knr%)
 END SUB 
 
 
 ' Eintrag eines adressenbezogenen Dokumentes in die Termindatei
 ' ============================================================================
SUB ADRDokRegister1(textdatei%,codeak%)
 SET STATUS "Eintrag in Termindatei..."
 cfile$ = FILE 
 cdir$ = DIRECTORY 
 FILE GAkquiDat$
 _vcodeak% = codeak%
 SELECT KEY textdatei% FILE GDokDat$ INDEX CodeDOK.GDokDat$
 RNotiz$ = "Dokument (" + Gruppe.GDokDat$ + "): " + Dokument.GDokDat$
 CALL AQRegister1()
 FILE cfile$
 DIRECTORY cdir$
 END SUB 
 
SUB ADRDokRegister(textdatei%)
 SET STATUS "Eintrag in Termindatei..."
 cfile$ = FILE 
 cdir$ = DIRECTORY 
 SELECT KEY textdatei% FILE "Dokument" INDEX CodeDOK.Dokument
 RNotiz$ = "Dokument (" + Gruppe.Dokument + "): " + Dokument.Dokument
 CALL AQRegister()
 FILE GAkquiDat$
 SELECT KEY cuaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
 CodeDOK.GAkquiDat$ = textdatei%
 CALL QuickStore(GAkquiDat$)
 SELECT KEY textdatei% LOCK FILE "Dokument" INDEX CodeDOK.Dokument
 codeaq.Dokument = cuaq%
 CALL QuickStore("Dokument")
 FILE cfile$
 DIRECTORY cdir$
 END SUB 
 
 
 ' Adressen TelefonÅbersicht
 ' ======================================================================
 ' Zweck:       Anzeige der verfÅgbaren Telefon-/Faxnummern
 '              wahleiser Versand von Mitteilungen per FAX
 ' Nutzung:     CALL ADRTelefon()
 ' ======================================================================
 ' 0001 - Reihenfolge der Felder und Buttons geÑndert
 ' 0002 - Auswertung Fax-/Telefonnummer; öbergang zu FAX:
SUB ADRTelefon1()
  CALL TelefonListe(CodeKU.GAdrDat$)
  CALL ADRFeldnamen()
 END SUB 
 
SUB ADRTelefon()
 SET STATUS "Telefon-/FAX-Nummern..."
 SELECT CASE UCASE$ ( FORM )
 CASE GAkquiDat$
   knr% = CodeKU.GAkquiDat$
 CASE GAdrDat$,"ADRDEFA"
   knr% = CodeKU.GAdrDat$
   IF NEW (GAdrDat$) OR MOD (GAdrDat$) THEN CALL FStore(GAdrDat$)
 END SELECT 
 SELECT KEY knr% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 d$ = "TELSEL"
 CREATE DIALOG d$,0,0,229,195,title$,"MS Sans Serif",8
 REM -- Rahmen --
 ADD DIALOG d$,4,4,0,220,84,0,"Hauptanschrift"
 ADD DIALOG d$,4,4,86,220,84,0,"Zweitanschrift"
 REM -- Beschriftungen --
 Voicedial$ = ReadINI$("MODEM","VoiceDial")
 VoiceISDNdial$ = ReadINI$("SYSTEM","VoiceISDNdial")
 FaxDial$ = ReadINI$("System","FAXavailable")
 ADD DIALOG d$,5,8,14,35,10,0,"Telefon 1"
 ADD DIALOG d$,5,8,27,34,10,0,"Telefon 2"
 ADD DIALOG d$,5,8,40,39,10,0,"Autotelefon"
 ADD DIALOG d$,5,8,53,16,10,0,"Fax"
 ADD DIALOG d$,5,8,66,18,10,0,"BTX"
 ADD DIALOG d$,5,8,101,32,10,0,"Telefon 1"
 ADD DIALOG d$,5,8,114,33,10,0,"Telefon 2"
 ADD DIALOG d$,5,8,127,39,10,0,"Autotelefon"
 ADD DIALOG d$,5,8,140,15,10,0,"Fax"
 ADD DIALOG d$,5,8,153,18,10,0,"BTX"
 REM -- Felder --
 ADD DIALOG d$,6,50,12,120,12,0,0,telefon1.GAdrDat$,30
 ADD DIALOG d$,6,50,25,120,12,0,0,telefon2.GAdrDat$,30
 ADD DIALOG d$,6,50,38,120,12,0,0,Autotelefon.GAdrDat$,30
 ADD DIALOG d$,6,50,51,120,12,0,0,telefax.GAdrDat$,30
 ADD DIALOG d$,6,50,64,120,12,0,0,btx.GAdrDat$,30
 ADD DIALOG d$,6,50,99,120,12,0,0,astelefon1.GAdrDat$,30
 ADD DIALOG d$,6,50,112,120,12,0,0,astelefon2.GAdrDat$,30
 ADD DIALOG d$,6,50,125,120,12,0,0,asAutotelefon.GAdrDat$,30
 ADD DIALOG d$,6,50,138,120,12,0,0,astelefax.GAdrDat$,30
 ADD DIALOG d$,6,50,151,120,12,0,0,asbtx.GAdrDat$,30
 IF VoiceDial$ LIKE "true" THEN ADD DIALOG d$,1,174,12,45,12,0,"wÑhlen",2,1
 IF VoiceDial$ LIKE "true" THEN ADD DIALOG d$,1,174,25,45,12,0,"wÑhlen",3,1
 IF VoiceDial$ LIKE "true" THEN ADD DIALOG d$,1,174,38,45,12,0,"wÑhlen",4,1
 IF FaxDial$ LIKE "true" THEN ADD DIALOG d$,1,174,51,45,12,0,"senden",5,1
 IF VoiceDial$ LIKE "true" THEN ADD DIALOG d$,1,174,99,45,12,0,"wÑhlen",6,1
 IF VoiceDial$ LIKE "true" THEN ADD DIALOG d$,1,174,112,45,12,0,"wÑhlen",7,1
 IF VoiceDial$ LIKE "true" THEN ADD DIALOG d$,1,174,125,45,12,0,"wÑhlen",8,1
 IF FaxDial$ LIKE "true" THEN ADD DIALOG d$,1,174,138,45,12,0,"senden",9,1
 ADD DIALOG d$,1,122,176,50,14,1,"&OK",1,1
 ADD DIALOG d$,1,174,176,50,14,0,"&Abbruch",0,0
 DIALOG d$,a%
 REMOVE DIALOG d$
 IF a% <> 0 THEN 
   IF NEW (GAdrDat$) OR MOD (GAdrDat$) THEN 
     cfile$ = FILE 
     CALL QuickStore(GAdrDat$)
     FILE cfile$
   ELSE 
     UNLOCK CURRENT FILE GAdrDat$
   END IF 
   SELECT CASE a%
   CASE 2
     CALL Telefon(Telefon1.GAdrDat$)
   CASE 3
     CALL Telefon(Telefon2.GAdrDat$)
   CASE 4
     CALL Telefon(Autotelefon.GAdrDat$)
   CASE 5
     CALL FAX(Telefax.GAdrDat$)
   CASE 6
     CALL Telefon(ASTelefon1.GAdrDat$)
   CASE 7
     CALL Telefon(ASTelefon2.GAdrDat$)
   CASE 8
     CALL Telefon(ASAutotelefon.GAdrDat$)
   CASE 9
     CALL FAX(ASTelefax.GAdrDat$)
   END SELECT 
 END IF 
 SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' FÅhren von TelefongesprÑchen
 ' ======================================================================
 ' Zweck:       Herstellung einer Telefonverbindung
 ' Nutzung:     CALL Telefon(nummer$)
 '              nummer$ = anzuwÑhlende Telefonnummer
 ' ======================================================================
 
SUB Telefon(nummer$)
 IF nummer$ = "" THEN 
   CALL Fehler("Es wurde keine Telefonnummer angegeben!","")
 ELSE 
   nummer1$ = FN NUMERIC(nummer$)
   nummer$ = nummer1$
   CALL Server("LOADMESSAGE","")
   CALL Server("MESSAGE","Bitte warten, die Telefonnummer wird gewÑhlt...")
   SET STATUS "Bitte warten: Telefonnummer wird gewÑhlt..."
   Port$ = ReadINI$("Modem","Port")
   IF Port$ LIKE "COM1" THEN port% = 0
   IF Port$ LIKE "COM2" THEN port% = 1
   IF Port$ LIKE "COM3" THEN port% = 2
   IF Port$ LIKE "COM4" THEN port% = 3
   init$ = ReadINI$("Modem","Init")
   setup$ = ReadINI$("Modem","Setup")
   dial$ = ReadINI$("Modem","Dial")
   Baudrate% = VAL (ReadINI$("Modem","Baudrate"))
 
   REM OPEN COMMS USING 1....,2400.....,0,1,8,0,1,0,0,0,0,"0123123456",""
   OPEN COMMS USING port%,Baudrate%,0,1,8,1,1,0,0,0,0,"",init$
   REM COMMS ? Setup$ + CHR$ (13)
   COMMS ? dial$ + nummer$ + ";" + CHR$ (13)
   a$ = ""
   _ok% = 0
   inbuffer$ = ""
   WHILE _ok% = 0
     COMMS GET a$
     IF a$ <> CHR$ (13) AND a$ <> CHR$ (10) AND a$ <> "" THEN 
       inbuffer$ = inbuffer$ + a$
     ELSE 
       IF ASC (a$) = 13 THEN 
         IF inbuffer$ LIKE "OK" THEN 
           CALL Server("UNLOADMESSAGE","")
           SET STATUS "Bitte Telefonhîrer abnehmen!"
           REQUEST "Die gewÅnschte Telefonnummer wurde gewÑhlt.","Bitte nehmen Sie den Telefonhîrer ab!",113
           _ok% = 1
         END IF 
         IF inbuffer$ LIKE "NO CARRIER" THEN 
           CALL Server("UNLOADMESSAGE","")
           SET STATUS "Fehler beim WÑhlen!"
           REQUEST "Bei der Anwahl trat ein Fehler auf (NO CARRIER)","",139
           _ok% = 1
         END IF 
         IF inbuffer$ LIKE "NO DIALTONE" THEN 
           CALL Server("UNLOADMESSAGE","")
           SET STATUS "Fehler beim WÑhlen!"
           REQUEST "Bei der Anwahl trat ein Fehler auf (NO DIALTONE)","",139
           _ok% = 1
         END IF 
         IF inbuffer$ LIKE "BUSY" THEN 
           CALL Server("UNLOADMESSAGE","")
           SET STATUS "Fehler beim WÑhlen!"
           REQUEST "Der angewÑhlte Anschlu· ist besetzt.","",139
           _ok% = 1
         END IF 
         inbuffer$ = ""
       END IF 
     END IF 
   WEND 
   SET STATUS "Modem-Port wird geschlossen..."
   COMMS ? "ATH" + CHR$ (13)
   CLOSE COMMS 
   SET STATUS "Bereit"
 END IF 
 MOUSE ON 
 END SUB 
 
   
 ' FAX-Versand
 ' ======================================================================
 ' Zweck:       Versenden von FAX-Mitteilungen
 ' Nutzung:     CALL FAX(dest%)
 '              dest%   = EmpfÑnger
 ' ======================================================================
 
SUB FAX(nummer$)
 direction% = VAL ( FN Numeric(nummer$))
 CALL DFile(2,"OFFICE\FAX" + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 IF ReadINI$("SYSTEM","FAXavailable") = "TRUE" THEN 
   MOUSE OFF 
   REM ** Absender testen 
   cfile$ = FILE 
   FILE GAdrDat$
   cuku% = CodeKU.GAdrDat$
   SELECT KEY "1" FILE GAdrDat$ INDEX Kundennummer.GAdrDat$
   IF FOUND (GAdrDat$) THEN 
     SET HEADING title$ + " - Kurzfax"
     IF EXISTS (GOFFForm$ + "FAX.sbv") THEN 
       OPEN FORM GOFFForm$ + "FAX"
     ELSE 
       OPEN FORM GOFFForm$ + "FAX"
     END IF 
     SET STATUS "Kurzfax"
     dest% = direction%
     BLANK 
     SET STATUS "Datensatz neu angelegt..."
     CodeFA.fax = SER ("fax",1)
     CodeKU.fax = cuku%
     faxnummer.fax = nummer$
     SELECT KEY cuku% FILE GAdrDat$ INDEX codeku.GAdrDat$
     FORM 
     _formend% = 0
     WHILE _formend% = 0
       ON ERROR GOTO ErrorHandler
       faxnummer$ = FN numeric(nummer$)
       FAXsub% = 0
       MOUSE ON 
       MENU OFF 
       ENTER Mitteilung.fax,0
       MENU ON 
     WEND 
   ELSE 
     CALL Fehler("Sie haben noch keine Absenderadresse erfa·t!","Bitte erfassen Sie eine Adresse mit der Kundennummer 1 - diese wird im Fax als Absender verwendet.")
   END IF 
   SELECT KEY cuku% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   FILE cfile$
 ELSE 
   CALL Fehler("Ihr System ist nicht fÅr den FAX-Versand vorbereitet!","")
 END IF 
 _formend% = 0
 END SUB 
 
 REM SUB FAXSenden(nummer$)
SUB FAXSenden()
 Adresse1$ = MakeAdr$(Cuku%,0, - 1,0)
 _knr% = CodeKU.GAdrDat$
 nr$ = "1"
 faxnummer$ = faxnummer.fax
 SELECT KEY nr$ FILE GAdrDat$ INDEX kundennummer.GAdrDat$
 nr% = codeku.GAdrDat$
 Absender$ = MakeAdr$(nr%,0, - 1,0)
 Adresse$ = Adresse1$
 CREATE DIALOG "FAXSEND",0,0,222,161,title$,"MS Sans Serif",8
 ADD DIALOG "FAXSEND",9,6,8,19,20,4
 ADD DIALOG "FAXSEND",5,34,9,144,8,0,"Vor dem Versenden kînnen Sie die Adresse"
 ADD DIALOG "FAXSEND",5,34,19,130,9,0,"und FAX-Nummer bei Bedarf verÑndern."
 ADD DIALOG "FAXSEND",6,34,30,180,67,4,2,Adresse1$,400
 ADD DIALOG "FAXSEND",5,35,97,28,8,0,"Adresse"
 ADD DIALOG "FAXSEND",6,35,112,178,12,0,0,faxnummer$,20
 ADD DIALOG "FAXSEND",5,36,126,44,8,0,"FAX-Nummer"
 ADD DIALOG "FAXSEND",1,114,140,51,16,1,"&Senden",1,1
 ADD DIALOG "FAXSEND",1,166,140,50,16,0,"&Abbrechen",0,0
 DIALOG "FAXSEND",req%
 REMOVE DIALOG "FAXSEND"
 IF req% = 1 THEN 
   CALL Server("LOADMESSAGE","")
   CALL Server("MESSAGE","Bitte warten, das Fax wird Åbertragen...")
   FILE "fax"
   Datum.fax = TODAY 
   Zeit.fax = NOW 
   CodeMA.fax = vcodema%
   cprinter$ = PRINTER 
   DDETERM 1
   SELECT KEY _knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   FaxDriv$ = ReadINI$("SYSTEM","FAXDRIVER")
   CALL FaxDriv$,2
   DDEINIT 1,"FAXMNG","TRANSMIT"
   DDEPOKE 1,"RECEIVER", LEFT$ (nachname.GAdrDat$,31)
   DDEPOKE 1,"FAX NUMBER", LEFT$ (faxnummer$,47)
   DDETERM 1
   SET PRINTER ReadINI$("SYSTEM","FAXDEVICE")
   FORM 2
   PRINT CURRENT USING 0,1,1,1,1,1,1
   CALL Server("MESSAGE","Das Fax wurde an die Faxsoftware Åbergeben" + CHR$ (13) + CHR$ (10) + "und wird augenblicklich als Termin registriert...")
   FORM 1
   SET PRINTER cprinter$
   MOUSE OFF 
   SET STATUS "Eintragung in Termindatei..."
   FILE GAkquiDat$
   BLANK 
   CodeAQ.GAkquiDat$ = SER (GAkquiDat$,1)
   CodeMA.GAkquiDat$ = vcodema%
   SELECT KEY vcodema% FILE "supervis" INDEX CodeMA.supervis
   Bearbeiter.GAkquiDat$ = Nachname.supervis
   Codeku.GAkquiDat$ = _knr%
   SELECT KEY _knr% FILE GAdrDat$ INDEX Codeku.GAdrDat$
   Nachname.GAkquiDat$ = LEFT$ ( TRIM$ (nachname.GAdrDat$) + "," + TRIM$ (vorname.GadrDat$),100)
   Datum.GAkquiDat$ = TODAY 
   Termin.GAkquiDat$ = TODAY 
   Uhrzeit.GAkquiDat$ = NOW 
   erledigt_Termin.GAkquiDat$ = "j"
   Notiz.GAkquiDat$ = "FAX gesendet:" + lf$ + Mitteilung.FAX
   CALL QuickStore(GAkquiDat$)
   CALL Server("UNLOADMESSAGE","")
   SET STATUS "Bereit"
 END IF 
 _formend% = 1
 END SUB 
   
 ' ========================================================================
 ' Bankleitzahlen-Verwaltung
 ' ========================================================================
 
SUB BLZ1()
 CALL BLZ(1)
 END SUB 
 
SUB BLZ2()
 CALL BLZ(2)
 END SUB 
 
SUB BLZ(BLZID%)
 MOUSE OFF 
 CALL DFile(2,"OFFICE\BANKEN" + _fpw$)
 IF BLZID% = 1 THEN 
   BLZField$ = "K1BLZ." + GAdrDat$
   BankField$ = "K1Bank." + GAdrDat$
 END IF 
 IF BLZID% = 2 THEN 
   BLZField$ = "K2BLZ." + GAdrDat$
   BankField$ = "K2Bank." + GAdrDat$
 END IF 
 IF BLZID% = 3 THEN 
   BLZField$ = "K3BLZ." + GAdrDat$
   BankField$ = "K3Bank." + GAdrDat$
 END IF 
 IF BLZField$$ <> "" AND BankField$$ = "" THEN 
   blz% = VAL (BLZField$$)
   cfile$ = FILE 
   FILE "BANKEN"
   INDEX BLZ.BANKEN
   SELECT FIRST 
   SELECT KEY blz% FILE "BANKEN" INDEX BLZ.BANKEN
   DIM Banken$( RECCOUNT ("BANKEN"))
   a% = 0
   prompt% = 9999999999
   prompt$ = ""
   WHILE BLZ.BANKEN = blz% AND NOT EOF ("BANKEN")
     Banken$(a%) = LTRIM$ ( STR$ (BLZ.BANKEN,"99999999")) + " " + Bank.BANKEN + " " + Ort.BANKEN + SPACE$ (80) + STR$ (CodeBLZ.BANKEN,"000000")
     IF BLZ.BANKEN < prompt% THEN 
       prompt% = BLZ.BANKEN
       prompt$ = Banken$(a%)
     END IF 
     SELECT NEXT 
     a% = a% + 1
   WEND 
   IF a% = 1 THEN 
     SELECT KEY VAL ( RIGHT$ (Banken$(0),6)) FILE "BANKEN" INDEX CodeBLZ.BANKEN
     BankField$$ = Bank.BANKEN
   END IF 
   IF a% > 1 THEN 
     CREATE DIALOG "BANKEN2",0,0,269,152,title$,"MS Sans Serif",8
     ADD DIALOG "BANKEN2",4,0,0,269,124,0,""
     ADD DIALOG "BANKEN2",9,9,11,23,23,2
     ADD DIALOG "BANKEN2",5,41,13,156,11,0,"Bitte wÑhlen Sie eine Bank aus:"
     ADD DIALOG "BANKEN2",7,41,27,221,89,130,2,Banken$,Auswahl$,prompt$
     ADD DIALOG "BANKEN2",1,74,131,55,15,1,"&Weiter",1,1
     ADD DIALOG "BANKEN2",1,133,131,55,15,0,"&Abbrechen",0,0
     DIALOG "BANKEN2",req%
     REMOVE DIALOG "BANKEN2"
     IF req% = 1 THEN 
       nblz% = VAL ( RIGHT$ (Auswahl$(0),6))
       SELECT KEY nblz% FILE "BANKEN" INDEX CodeBLZ.BANKEN
       BankField$$ = Bank.BANKEN
     END IF 
   END IF 
   FILE cfile$
 ELSE 
   IF BankField$$ = "" THEN 
     blz% = GetBLZ%(Ort.GAdrDat$)
     IF blz% <> 0 THEN 
       SELECT KEY blz% FILE "BANKEN" INDEX CodeBLZ.BANKEN
       BankField$$ = Bank.BANKEN
       BLZField$$ = LTRIM$ ( STR$ (BLZ.BANKEN,"99999999"))
     END IF 
   END IF 
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
  
 
FUNCTION GetBLZ%(Ort$)
 DIM Banken$( RECCOUNT ("BANKEN"))
 DIM Auswahl$(0)
 cfile$ = FILE 
 CREATE DIALOG "BANKEN1",0,0,195,82,title$,"MS Sans Serif",8
 ADD DIALOG "BANKEN1",4,0,0,194,59,0,""
 ADD DIALOG "BANKEN1",9,5,8,20,22,2
 ADD DIALOG "BANKEN1",5,34,11,154,21,0,"Bitte geben Sie den Ort ein, dessen Banken aufgelistet werden sollen:"
 ADD DIALOG "BANKEN1",6,56,39,132,11,0,0,Ort$,20
 ADD DIALOG "BANKEN1",5,34,41,19,10,0,"Ort:"
 ADD DIALOG "BANKEN1",1,38,62,55,15,1,"&Suchen",1,1
 ADD DIALOG "BANKEN1",1,97,62,55,15,0,"&Abbrechen",0,0
 ok% = 0
 WHILE NOT ok%
   DIALOG "BANKEN1",req%
   IF req% = 1 THEN 
     IF Ort$ = "" THEN 
       REQUEST "Bitte geben Sie einen Ort ein!","Sie kînnen auch die Anfangsbuchstaben des Ortes eingeben.",113,req2%
     ELSE 
       ok% = - 1
     END IF 
   ELSE 
     ok% = - 1
   END IF 
 WEND 
 REMOVE DIALOG "BANKEN1"
 IF req% = 1 AND Ort$ <> "" THEN 
   FILE "BANKEN"
   INDEX Ort
   SELECT FIRST 
   SELECT KEY ort$
   a% = 0
   prompt% = 99999999999999
   MOUSE OFF 
   WHILE Ort.BANKEN LIKE Ort$ + "*" AND NOT EOF ("BANKEN")
     Banken$(a%) = LTRIM$ ( STR$ (BLZ.BANKEN,"99999999")) + CHR$ (9) + Bank.BANKEN + SPACE$ (80) + STR$ (CodeBLZ.BANKEN,"000000")
     IF BLZ.BANKEN < prompt% THEN 
       prompt% = BLZ.BANKEN
       prompt$ = Banken$(a%)
     END IF 
     SELECT NEXT 
     a% = a% + 1
   WEND 
   IF a% = 0 THEN 
     REQUEST "Zu diesem Ort konnten keine Banken gefunden werden!","",113,req2%
     GetBLZ% = 0
   ELSE 
     CREATE DIALOG "BANKEN2",0,0,269,152,title$,"MS Sans Serif",8
     ADD DIALOG "BANKEN2",4,0,0,269,124,0,""
     ADD DIALOG "BANKEN2",9,9,11,23,23,2
     ADD DIALOG "BANKEN2",5,41,13,156,11,0,"Bitte wÑhlen Sie eine Bank aus:"
     ADD DIALOG "BANKEN2",7,41,27,221,89,130,2,Banken$,Auswahl$,prompt$
     ADD DIALOG "BANKEN2",1,74,131,55,15,1,"&Weiter",1,1
     ADD DIALOG "BANKEN2",1,133,131,55,15,0,"&Abbrechen",0,0
     MOUSE ON 
     DIALOG "BANKEN2",req%
     REMOVE DIALOG "BANKEN2"
     IF req% = 1 THEN 
       GetBLZ% = VAL ( RIGHT$ (Auswahl$(0),6))
     ELSE 
       GetBLZ% = 0
     END IF 
   END IF 
 ELSE 
   GetBLZ% = 0
 END IF 
 FILE cfile$
 END IF 
 END FUNCTION 
 
SUB ADRConnectOld()
 DIM AdrListe$( RECCOUNT (GAdrDat$))
 knr% = CodeKU.GAdrDat$
 FILE GAdrDat$
 INDEX VorgÑnger.GAdrDat$
 SELECT FIRST 
 SELECT KEY knr%
 prompt$ = "ZZZZZZZZ"
 a% = 0
 WHILE VorgÑnger.GAdrDat$ = knr% AND NOT EOF (GAdrDat$)
   aok% = - 1
   IF MNdisabled%("DATALOCK") THEN 
     IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN aok% = 0
   END IF 
   IF aok% THEN 
     AdrListe$(a%) = Nachname + ", " + Vorname + ", " + Ort + SPACE$ (120) + STR$ (CodeKU,"000000")
     IF Nachname < prompt$ THEN prompt$ = AdrListe$(a%)
     a% = a% + 1
   END IF 
   SELECT NEXT 
 WEND 
 SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 CREATE DIALOG "ADRCON1",0,0,241,182,title$,"MS Sans Serif",8
 ADD DIALOG "ADRCON1",4,0,0,241,158,0,""
 ADD DIALOG "ADRCON1",9,5,9,20,21,2
 ADD DIALOG "ADRCON1",5,30,10,206,28,0,"Bitte wÑhlen Sie eine der untergeordneten Adressen aus oder wÑhlen Sie 'Neu' um eine neue Adresse in die Gruppe aufzunehmen."
 ADD DIALOG "ADRCON1",5,30,40,205,20,0,"Mit 'Lîschen' kînnen Sie die VerknÅpfung zur angewÑhlten Adresse lîschen."
 ADD DIALOG "ADRCON1",7,30,64,204,89,2,2,AdrListe$,Auswahl$,prompt$
 ADD DIALOG "ADRCON1",1,3,162,55,15,1,"&WÑhlen",1,1
 ADD DIALOG "ADRCON1",1,63,162,55,15,0,"&Neu",2,1
 ADD DIALOG "ADRCON1",1,123,162,55,15,0,"&Lîschen",3,1
 ADD DIALOG "ADRCON1",1,183,162,55,15,0,"&Abbrechen",0,0
 DIALOG "ADRCON1",req%
 REMOVE DIALOG "ADRCON1"
 MOUSE OFF 
 nknr% = VAL ( RIGHT$ (Auswahl$(0),6))
 SELECT CASE req%
 CASE 1
   IF nknr% <> 0 THEN SELECT KEY nknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 CASE 2
   nachfolger% = ADRSuche%(0)
   IF nachfolger% <> 0 THEN 
     SELECT KEY nachfolger% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     ok% = - 1
     IF VorgÑnger.GAdrDat$ <> 0 AND VorgÑnger.GAdrDat$ <> knr% THEN 
       REQUEST "Die gewÑhlte Adresse gehîrt bereits zu einer anderen Gruppe!","Trotzdem Åbernehmen?",134,req2%
       IF req2% <> 1 THEN ok% = 0
     END IF 
     IF ok% THEN VorgÑnger.GAdrDat$ = knr%
     CALL QuickStore(GAdrDat$)
   END IF 
   SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 CASE 3
   IF nknr% <> 0 THEN 
     SELECT KEY nknr% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     VorgÑnger.GAdrDat$ = 0
     CALL QuickStore(GAdrDat$)
   END IF 
   SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 END SELECT 
 SET INDEX Nachname.GAdrDat$
 INDEX Nachname.GAdrDat$
 CALL ADRFeldnamen()
 MOUSE ON 
 END SUB 
 
 
SUB ADRConnect1()
 DIM AdrListe$( RECCOUNT (GAdrDat$))
 knr% = CodeKU.GAdrDat$
 FILE GConDat$
 INDEX codeku.GConDat$
 
 REM FILE GAdrDat$
 REM INDEX VorgÑnger.GAdrDat$
 SELECT FIRST 
 SELECT KEY knr%
 prompt$ = "ZZZZZZZZ"
 a% = 0
 WHILE codeku.GConDat$ = knr% AND NOT EOF (GConDat$)
   aok% = - 1
   IF MNdisabled%("DATALOCK") THEN 
     IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN aok% = 0
   END IF 
   IF aok% THEN 
     AdrListe$(a%) = Typ.GConDat$ + ", " + Nachname + ", " + Vorname + ", " + Ort + ", " + Strasse + SPACE$ (120) + STR$ (CodeCon,"000000")
     IF Nachname < prompt$ THEN prompt$ = AdrListe$(a%)
     a% = a% + 1
   END IF 
   SELECT NEXT 
 WEND 
 SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 CREATE DIALOG "ADRCON1",0,0,341,182,title$,"MS Sans Serif",8
 ADD DIALOG "ADRCON1",4,0,0,341,158,0,""
 ADD DIALOG "ADRCON1",9,5,9,20,21,2
 ADD DIALOG "ADRCON1",5,30,10,306,28,0,"Bitte wÑhlen Sie eine der untergeordneten Adressen aus oder wÑhlen Sie 'Neu' um eine neue Adresse in die Gruppe aufzunehmen."
 ADD DIALOG "ADRCON1",5,30,40,305,20,0,"Mit 'Lîschen' kînnen Sie die VerknÅpfung zur angewÑhlten Adresse lîschen."
 ADD DIALOG "ADRCON1",7,30,64,304,89,2,2,AdrListe$,Auswahl$,prompt$
 ADD DIALOG "ADRCON1",1,30,162,55,15,1,"&WÑhlen",1,1
 ADD DIALOG "ADRCON1",1,90,162,55,15,0,"&Details",4,1
 ADD DIALOG "ADRCON1",1,150,162,55,15,0,"&Neu",2,1
 ADD DIALOG "ADRCON1",1,210,162,55,15,0,"&Lîschen",3,1
 ADD DIALOG "ADRCON1",1,270,162,55,15,0,"&Abbrechen",0,0
 DIALOG "ADRCON1",req%
 REMOVE DIALOG "ADRCON1"
 MOUSE OFF 
 nknr% = VAL ( RIGHT$ (Auswahl$(0),6))
 IF req% = 1 THEN knr% = nknr%
 SELECT CASE req%
 CASE 1
   IF nknr% <> 0 THEN SELECT KEY nknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 CASE 2
   nachfolger% = ADRSuche%(0)
   IF nachfolger% <> 0 THEN 
     SELECT KEY nachfolger% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     BLANK FILE GConDat$
     codekey.GConDat$ = SER (GConDat$,1)
     codeku.GConDat$ = knr%
     codecon.GConDat$ = nachfolger%
     CodeKUCon.GConDat$ = STR$ (knr%,"000000") + STR$ (nachfolger%,"000000")
     Nachname.GConDat$ = Nachname.GAdrDat$
     vorname.GConDat$ = Vorname.GAdrDat$
     Ort.GConDat$ = Ort.GAdrDat$
     Strasse.GConDat$ = Stra·e.GAdrDat$
     Typ.GConDat$ = "N"
     CALL QuickStore(GConDat$)
     SELECT KEY knr% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     BLANK FILE GConDat$
     codekey.GConDat$ = SER (GConDat$,1)
     codeku.GConDat$ = nachfolger%
     codecon.GConDat$ = knr%
     CodeConKU.GConDat$ = STR$ (nachfolger%,"000000") + STR$ (knr%,"000000")
     Nachname.GConDat$ = Nachname.GAdrDat$
     vorname.GConDat$ = Vorname.GAdrDat$
     Ort.GConDat$ = Ort.GAdrDat$
     Strasse.GConDat$ = Stra·e.GAdrDat$
     Typ.GConDat$ = "V"
     CALL QuickStore(GConDat$)
      SELECT KEY CodeKUCon$ LOCK FILE GConDat$ INDEX CodeKUCon.GConDat$
     Adr$ = Typ.GConDat$ + ", " + Nachname + ", " + Vorname + ", " + Ort + ", " + Strasse
     notiz1$ = Notiz.GConDat$
     CREATE DIALOG "ADRCON1",0,0,341,182,"Details zur VerknÅpfung","MS Sans Serif",8
     ADD DIALOG "ADRCON1",4,0,0,341,158,0,""
     ADD DIALOG "ADRCON1",9,5,9,20,21,2
     ADD DIALOG "ADRCON1",5,30,10,306,28,0,"Tragen Sie hier Kommentare zur aktuellen AdressverknÅpfung ein und bestÑtigen Sie mit éndern"
     ADD DIALOG "ADRCON1",5,30,40,305,20,0,adr$
     ADD DIALOG "ADRCON1",6,30,64,304,89,4,2,Notiz.GConDat$,4000
     REM ADD DIALOG "ADRCON1",7,30,64,304,89,2,2,AdrListe$,Auswahl$,prompt$
     ADD DIALOG "ADRCON1",1,30,162,55,15,1,"&WÑhlen",1,1
     ADD DIALOG "ADRCON1",1,90,162,55,15,0,"é&ndern",4,1
     ADD DIALOG "ADRCON1",1,270,162,55,15,0,"&Abbrechen",0,0
     DIALOG "ADRCON1",req%
     REMOVE DIALOG "ADRCON1"
     IF req% = 1 THEN 
       IF notiz1$ <> Notiz.GConDat$ THEN 
         REQUEST "Der Kommentar wurde geÑndert!","Soll die énderung Åbernommen werden?",130,req1%
         IF req1% = 1 THEN CALL QuickStore(GConDat$)
       END IF 
       SELECT KEY nachfolger% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     END IF 
     IF req% = 4 THEN 
       CALL QuickStore(GConDat$)
       SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       REM SELECT KEY nachfolger% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     END IF 
   END IF 
 CASE 3
   IF nknr% <> 0 THEN 
     FILE GConDat$
     loe1$ = STR$ (knr%,"000000") + STR$ (nknr%,"000000")
     loe2$ = STR$ (nknr%,"000000") + STR$ (knr%,"000000")
     REMOVE FROM FILE GConDat$ WHERE CodeKUCon.GConDat$ = loe1$
     REMOVE FROM FILE GConDat$ WHERE CodeConKU.GConDat$ = loe2$
   END IF 
   SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
  CASE 4
   REM Details
   nknr% = VAL ( RIGHT$ (Auswahl$(0),6))
   FILE GConDat$
   INDEX codecon.GConDat$
   SELECT KEY nknr% LOCK FILE GConDat$ INDEX codecon.GConDat$
   Adr$ = Typ.GConDat$ + ", " + Nachname + ", " + Vorname + ", " + Ort + ", " + Strasse
   notiz1$ = Notiz.GConDat$
   CREATE DIALOG "ADRCON1",0,0,341,182,"Details zur VerknÅpfung","MS Sans Serif",8
   ADD DIALOG "ADRCON1",4,0,0,341,158,0,""
   ADD DIALOG "ADRCON1",9,5,9,20,21,2
   ADD DIALOG "ADRCON1",5,30,10,306,28,0,"Tragen Sie hier Kommentare zur aktuellen AdressverknÅpfung ein und bestÑtigen Sie mit éndern"
   ADD DIALOG "ADRCON1",5,30,40,305,20,0,adr$
   ADD DIALOG "ADRCON1",6,30,64,304,89,4,2,Notiz.GConDat$,4000
   REM ADD DIALOG "ADRCON1",7,30,64,304,89,2,2,AdrListe$,Auswahl$,prompt$
   ADD DIALOG "ADRCON1",1,30,162,55,15,1,"&WÑhlen",1,1
   ADD DIALOG "ADRCON1",1,90,162,55,15,0,"é&ndern",4,1
   ADD DIALOG "ADRCON1",1,270,162,55,15,0,"&Abbrechen",0,0
   DIALOG "ADRCON1",req%
   REMOVE DIALOG "ADRCON1"
   IF req% = 0 THEN END SUB 
   IF req% = 1 THEN 
     IF notiz1$ <> Notiz.GConDat$ THEN 
       REQUEST "Der Kommentar wurde geÑndert!","Soll die énderung Åbernommen werden?",130,req1%
       IF req1% = 1 THEN CALL QuickStore(GConDat$)
     END IF 
     SELECT KEY nknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   END IF 
   IF req% = 4 THEN 
     CALL QuickStore(GConDat$)
     SELECT KEY nknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   END IF 
 END SELECT 
 FILE GAdrDat$
 SET INDEX Nachname.GAdrDat$
 INDEX Nachname.GAdrDat$
 CALL ADRFeldnamen()
 MOUSE ON 
 END SUB 
 
SUB ADRConnect()
 knr% = CodeKU.GAdrDat$
 FILE GConDat$
 INDEX codeku.GConDat$
 CALL ADRKontakt()
 
 END SUB 
 
SUB KontXLS(codeku%)
 IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   REM CLOSE FILE "ADRTEMP"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 

 abz% = 0
 a% = 0
 b% = RECCOUNT (GAdrDat$)
 IF b% > 20000 THEN 
   b% = 20000
   REDIM AdrFound$(20000,1)
   REDIM AdrFound$(20000)
 ELSE 
   REDIM AdrFound$( RECCOUNT (GAdrDat$),1)
   REDIM AdrFound$( RECCOUNT (GAdrDat$))
 END IF 

 FILE GADRDat$
 INDEX codeku.GadrDat$
 FILE GConDat$
 INDEX codeku.GCondat$
 SELECT FIRST FILE GCondat$ INDEX codeku.GCondat$
 SELECT KEY codeku% FILE GCondat$ INDEX codeku.GCondat$
 a1% = 0
 WHILE NOT EOF (GCondat$)
    IF codeku.GConDat$ = codeku% THEN 
      IF UCASE$ (typ.GConDat$) = "V" THEN 
        knr1% = VAL ( RIGHT$ (codeconku.GConDat$,6))
      ELSE 
        knr1% = VAL ( RIGHT$ (codekucon.GConDat$,6))
      END IF 
      IF EXISTS (knr1%,codeku.GADRDat$) THEN 
        SELECT FIRST FILE GADRDat$ INDEX codeku.GADRDat$
        SELECT KEY knr1% FILE GADRDat$ INDEX codeku.GADRDat$
        a1% = a1% + 1
        REM ********************************************************************************************************************************
             BLANK FILE "adrtemp"
             codeadrt% = SER ("ADRTEMP",1)
             codeadrt.adrtemp = codeadrt%
             codeku.adrtemp = codeku%
             Kundennummer.adrtemp = Kundennummer.GAdrDat$
             Postanschrift.adrtemp = Postanschrift.GAdrDat$
             Anrede.adrtemp = Anrede.GAdrDat$
             ASerJN.adrtemp = ASerJN.GAdrDat$
             IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
               Name2.adrtemp = Nachname.GAdrDat$
               Name1.adrtemp = Vorname.GAdrDat$
               REM Name3.adrtemp = Geburtsname.GAdrDat$
             ELSE 
               Name1.adrtemp = Nachname.GAdrDat$
               zuHaenden.adrtemp = Vorname.GAdrDat$
               Name2.adrtemp = Geburtsname.GAdrDat$
             END IF 
             Strasse.adrtemp = Stra·e.GAdrDat$
             PLZ.adrtemp = PLZ.GAdrDat$
             Ort.adrtemp = Ort.GAdrDat$
             NationalitÑt.adrtemp = NationalitÑt.GAdrDat$
             Staatsangehîrig.adrtemp = Staatsangehîrig.GAdrDat$
             Land.adrtemp = Land.GAdrDat$
             Geburtstag.adrtemp = DATE$ (Geburtstag.GAdrDat$,"0d.mm.yyyy")
             K1Bank.adrtemp = K1Bank.GAdrDat$
             K1BLZ.adrtemp = K1BLZ.GAdrDat$
             K1Konto.adrtemp = K1Konto.GAdrDat$
             K2Bank.adrtemp = K2Bank.GAdrDat$
             K2BLZ.adrtemp = K2BLZ.GAdrDat$
             K2Konto.adrtemp = K2Konto.GAdrDat$
             Kunde_seit.adrtemp = DATE$ (Kunde_seit.GAdrDat$,"0d.mm.yyyy")
             letzter_Kontakt.adrtemp = DATE$ (letzter_Kontakt.GAdrDat$,"0d.mm.yyyy")
             REM Notiz.adrtemp = Notiz.GAdrDat$
             Beruf.adrtemp = Beruf.GAdrDat$
             Hobbys.adrtemp = Hobbys.GAdrDat$
             Geschlecht.adrtemp = Geschlecht.GAdrDat$
             Familienstand.adrtemp = Familienstand.GAdrDat$
             Briefanrede.adrtemp = Briefanrede.GAdrDat$
             REM Geburtsname.adrtemp = Geburtsname.GAdrDat$
             feld1$ = "Telart"
             feld2$ = "Telnr"
             feld3$ = "FaxJN"
             codema% = Codema.GAdrDat$
             codema.adrtemp = codema%
             codepr.adrtemp = codepr.GAdrDat$
             REM 061196
             IF _projekt$ LIKE "FACTURA" THEN 
               IF EXISTS (codema%,codema.vertrete) THEN 
                 FILE "vertrete"
                 INDEX codema.vertrete
                 SELECT FIRST 
                 SELECT KEY codema% FILE "vertrete" INDEX codema.vertrete
                 Mitarbeiter.adrtemp = TRIM$ (nachname.vertrete) + ", " + TRIM$ (vorname.vertrete)
                 QuickMaKund.adrtemp = TRIM$ (nachname.vertrete) + TRIM$ (vorname.vertrete) + nachname.GAdrDat$
               END IF 
             END IF 
             IF _projekt$ LIKE "PROVIS" THEN 
               IF EXISTS (codema%,codema.maadr) THEN 
                 FILE "maadr"
                 INDEX codema.maadr
                 SELECT FIRST 
                 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
                 Mitarbeiter.adrtemp = TRIM$ (nachname.maadr) + ", " + TRIM$ (vorname.maadr)
                 QuickMaKund.adrtemp = TRIM$ (nachname.maadr) + TRIM$ (vorname.maadr) + nachname.GAdrDat$
               END IF 
             END IF 
             EGNachname.adrtemp = EGNachname.GAdrDat$
             EGGeburtsname.adrtemp = EGGeburtsname.GAdrDat$
             EGVorname.adrtemp = EGVorname.GAdrDat$
             EGGeburtstag.adrtemp = EGGeburtstag.GAdrDat$
             EGBeruf.adrtemp = EGBeruf.GAdrDat$
             EGASStra·e.adrtemp = EGASStra·e.GAdrDat$
             EGASOrt.adrtemp = EGASOrt.GAdrDat$
             EGASPLZ.adrtemp = EGASPLZ.GAdrDat$
             EGAnrede.adrtemp = eganrede.GADRDat$
             EGTitel.adrtemp = EGTitel.GADRDat$
             ADRStatus.adrtemp = adrstatus.GADRDat$
             codema% = codema.GADRDat$
             SELECT FIRST FILE "maadr" INDEX codema.maadr
             SELECT KEY codema% FILE "maadr" INDEX codema.maadr
             IF _projekt$ LIKE "IMMAK" THEN 
               Agentur1.adrtemp = Agenturnr.maadr + ", " + Nachname.maadr + ", " + Vorname.maadr
               Agentur2.adrtemp = Kontaktgruppe.GConDat$
             ELSE 
               Agentur1.adrtemp = Agenturnr.maadr + ", " + Nachname.maadr + ", " + Vorname.maadr
               codema% = codema2.GADRDat$
               SELECT FIRST FILE "maadr" INDEX codema.maadr
               SELECT KEY codema% FILE "maadr" INDEX codema.maadr
               Agentur2.adrtemp = Agenturnr.maadr + ", " + Nachname.maadr + ", " + Vorname.maadr
             END IF 
             FOR k1% = 1 TO 4
               k1$ = STR$ (k1%,"9")
               K_feld1$ = "K" + k1$ + "Name" + ".adrtemp"
               K_feld2$ = "K" + k1$ + "NName" + ".adrtemp"
               K_feld3$ = "K" + k1$ + "Ort" + ".adrtemp"
               K_feld4$ = "K" + k1$ + "Strasse" + ".adrtemp"
               K_feld5$ = "K" + k1$ + "PLZ" + ".adrtemp"
               K_feld6$ = "K" + k1$ + "Telefon1" + ".adrtemp"
               K_feld7$ = "K" + k1$ + "Fax1" + ".adrtemp"
               K_feld8$ = "K" + k1$ + "Mobil1" + ".adrtemp"
               K_feld9$ = "K" + k1$ + "email1" + ".adrtemp"
               K_feld10$ = "K" + k1$ + "www1" + ".adrtemp"
               K_feld11$ = "K" + k1$ + "Telefon2" + ".adrtemp"
               K_feld12$ = "K" + k1$ + "Fax2" + ".adrtemp"
               K_feld13$ = "K" + k1$ + "Mobil2" + ".adrtemp"
               K_feld14$ = "K" + k1$ + "email2" + ".adrtemp"
               K_feld15$ = "K" + k1$ + "www2" + ".adrtemp"
               K_feld1$$ = K1Name.GAdrDat$
               K_feld2$$ = K1NName .GAdrDat$
               K_feld3$$ = K1Ort .GAdrDat$
               K_feld4$$ = K1Strasse.GAdrDat$
               K_feld5$$ = K1PLZ.GAdrDat$
               K_feld6$$ = K1Telefon1.GAdrDat$
               K_feld7$$ = K1Fax1.GAdrDat$
               K_feld8$$ = K1Mobil1.GAdrDat$
               K_feld9$$ = K1email1.GAdrDat$
               K_feld10$$ = K1www1.GAdrDat$
               K_feld11$$ = K1Telefon2.GAdrDat$
               K_feld12$$ = K1Fax2.GAdrDat$
               K_feld13$$ = K1Mobil2.GAdrDat$
               K_feld14$$ = K1email2.GAdrDat$
               K_feld15$$ = K1www2.GAdrDat$
             NEXT k1%
             IF EXISTS (knr1%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               INDEX Qcodekutel.GTelDat$
               REM INDEX codeku.GTeldat$
               SELECT FIRST FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               REM SELECT FIRST FILE GTelDat$ INDEX codeku.GTelDat$
               Qcodekutel$ = STR$ (knr1%,"000000") + "000000"
               REM CALL Fehler(Qcodekutel$,"")
               SELECT KEY Qcodekutel$ FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               abi% = 0
               WHILE codeku.GTelDat$ = knr1% AND abi% < 20 AND NOT EOF (GTelDat$)
                 abi% = abi% + 1
                 IF abi% < 10 THEN 
                   feldart$ = feld1$ + STR$ (abi%,"9") + ".adrtemp"
                   feldnum$ = feld2$ + STR$ (abi%,"9") + ".adrtemp"
                   feldFax$ = TRIM$ (feld3$ + STR$ (abi%,"9") + ".adrtemp")
                 ELSE 
                   feldart$ = feld1$ + STR$ (abi%,"99") + ".adrtemp"
                   feldnum$ = feld2$ + STR$ (abi%,"99") + ".adrtemp"
                   feldFax$ = TRIM$ (feld3$ + STR$ (abi%,"99") + ".adrtemp")
                 END IF 
                 feldart$$ = LEFT$ (art.GTelDat$,60)
                 feldnum$$ = LEFT$ (nummer.GTelDat$,60)
                 FeldFax$$ = FonOderFax.GTelDat$
                 SELECT NEXT FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               WEND 
             END IF 
             FILE "adrtemp"
             STORE FILE "adrtemp"
        REM ********************************************************************************************************************************
      END IF 
      SELECT NEXT FILE GConDat$ INDEX codeku.GCondat$
    ELSE 
      GOTO w170520091
    END IF 

 WEND 
w170520091: 
 IF a1% > 0 THEN 
   WAIT FOR 2
         FILE "adrtemp"
         INDEX name2.adrtemp
         SELECT FIRST 
         REM EXPORT nach EXCEL aufrufen
         dir1$ = DIRECTORY 
         dateiname2$ = "*.xls"
         REQUEST "Speichern als MS EXCEL..."," ",27,req%,dateiname2$
         IF req% = 1 THEN 
           MOUSE OFF 
           SET STATUS "EXPORT der gewÑhlten Adressen nach: " + dateiname2$
           Superbase.Converters.SBF.SourceFormat = "Superbase"
           Superbase.Converters.SBF.SourceFile = "ADRTEMP"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = dateiname2$
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
           DIRECTORY dir1$
           WAIT FOR 3
           a% = CALL ("ShellExecute",0,"open",dateiname2$,"","",1)
           IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
           SET STATUS "EXPORT beendet!"
 
         END IF 



 END IF 
 END SUB 
 
 
 REM 240398
SUB ADRConnUpd()
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 FILE GAdrDat$
 INDEX VorgÑnger.GAdrDat$
 SELECT FIRST 
 WHILE NOT EOF (GAdrDat$)
 knr% = Codeku.GAdrDat$
 IF vorgÑnger.GAdrDat$ > 0 THEN 
     nachfolger% = vorgÑnger.GAdrDat$
     vorgÑnger.GAdrDat$ = 0
     CALL QuickStore(GAdrDat$)
     SELECT KEY nachfolger% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     BLANK FILE GConDat$
     codekey.GConDat$ = SER (GConDat$,1)
     codeku.GConDat$ = knr%
     codecon.GConDat$ = nachfolger%
     CodeKUCon.GConDat$ = STR$ (knr%,"000000") + STR$ (nachfolger%,"000000")
     Nachname.GConDat$ = Nachname.GAdrDat$
     vorname.GConDat$ = Vorname.GAdrDat$
     Ort.GConDat$ = Ort.GAdrDat$
     Strasse.GConDat$ = Stra·e.GAdrDat$
     Typ.GConDat$ = "V"
     CALL QuickStore(GConDat$)
     SELECT KEY knr% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     BLANK FILE GConDat$
     codekey.GConDat$ = SER (GConDat$,1)
     codeku.GConDat$ = nachfolger%
     codecon.GConDat$ = knr%
     CodeConKU.GConDat$ = STR$ (nachfolger%,"000000") + STR$ (knr%,"000000")
     Nachname.GConDat$ = Nachname.GAdrDat$
     vorname.GConDat$ = Vorname.GAdrDat$
     Ort.GConDat$ = Ort.GAdrDat$
     Strasse.GConDat$ = Stra·e.GAdrDat$
     Typ.GConDat$ = "N"
     CALL QuickStore(GConDat$)
     SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
 END IF 
 SELECT NEXT FILE GAdrDat$ INDEX VorgÑnger.GAdrDat$
 WEND 
 END SUB 
 
 
 
 
 
SUB ADRVorgaenger()
 IF VorgÑnger.GAdrDat$ <> 0 THEN 
   cuadr% = CodeKU.GAdrDat$
   SELECT KEY VorgÑnger.GAdrDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   ok% = - 1
   IF MNdisabled%("DATALOCK") THEN 
     IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN 
       SELECT KEY cuadr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       CALL Fehler("Die Daten der Adresse des VorgÑngers sind fÅr den Zugriff gesperrt!","")
     END IF 
   END IF 
   SET INDEX Nachname.GAdrDat$
   INDEX Nachname.GAdrDat$
 END IF 
 CALL ADRFeldnamen()
 FORM 
 END SUB 
 
 
 
SUB ADRLoeschen()
 IF title$ LIKE "*DEMO*" AND RECCOUNT (GAdrDat$) >= 10 THEN 
   CALL DemoInfo()
   END SUB 
 END IF 
 IF disabled%("ADRLoeschen") THEN END SUB 
 cuku% = CodeKU.GAdrDat$
 REQUEST "Adresse wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   IF EXISTS (cuku%,codeku.GAdrDat$) THEN 
     SET STATUS "Lîsche die Adresse!"
     SELECT KEY cuku% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     IF cuku% = codeku.GAdrDat$ THEN SELECT REMOVE FILE GADRDat$
     FILE GTelDat$
     INDEX codeku.GTelDat$
     SELECT FIRST 
     IF EXISTS (cuku%,codeku.GTelDat$) THEN 
       SET STATUS "Lîsche die Telefonnummern zur Adresse!"
       REMOVE FROM FILE GTelDat$ WHERE codeku.GTelDat$ = cuku%
     END IF 
     IF EXISTS (cuku%,codeku.GAkquiDat$) THEN 
       SET STATUS "Lîsche die Termine zur Adresse!"
       REMOVE FROM FILE GAkquiDat$ WHERE codeku.GAkquiDat$ = cuku%
     END IF 
     FILE GAdrDat$
     SELECT FORM NEXT 
     codeku% = codeku.GAdrDat$
     SELECT FORM KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
     FORM 
   END IF 
   FORM 
 END IF 
 CALL ADRFeldnamen()
 FORM 
 END SUB 
 
 
 
  
 '      ************************
 '      ** Stichworterfassung **
 '      ************************
 
SUB ADRStichwort():
 IF AutoKeyword$ LIKE "TRUE" AND stichwort.GAdrDat$ = "" THEN 
   codeku% = codeku.GAdrDat$
   CALL AStichNeu("keyword","Keywords","Stichwîrter",20)
   SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
 END IF 
 END SUB 
 
SUB ADRStichw1():
 GAnredADR$ = anrede.GAdrDat$
 GTitelADR$ = Titel.GAdrDat$
 GNachnameADR$ = Nachname.GAdrDat$
 GGebname$ = Geburtsname.GAdrDat$
 GVornameADR$ = Vorname.GAdrDat$
 GPLZADR$ = plz.GAdrDat$
 GStrasseADR$ = Stra·e.GAdrDat$
 GOrtADR$ = Ort.GAdrDat$
 GLandADR$ = Land.Gadrdat$
 GGeburtstag% = Geburtstag.GADRDat$
           GBlz1$ = K1blz.GADRDat$
           GBLZ2$ = K2blz.GADRDat$
           GBLZ3$ = K3blz.GADRDat$
           GBank1$ = K1bank.GADRDat$
           GBank2$ = K2bank.GADRDat$
           GBank3$ = K3bank.GADRDat$
           GKonto1$ = K1Konto.GADRDat$
           GKonto2$ = K2Konto.GADRDat$
           GKonto3$ = K3Konto.GADRDat$
           GKontoinh1$ = Kontoinh1.GADRDat$
           GKontoinh2$ = Kontoinh2.GADRDat$
           GKontoinh3$ = Kontoinh3.GADRDat$
           GTelefon1$ = Telefon1.GADRDat$
 CALL AStichNeu("keyword","Keywords","Stichwîrter",20)
 END SUB 
  
SUB AnredeStichwort()
 IF AutoAnrede$ LIKE "TRUE" AND anrede.GAdrDat$ = "" THEN CALL AStichNeu("Anrede","Anrede","Anrede",20)
 END SUB 
 
SUB BerufStichwort()
 IF AutoBeruf$ LIKE "TRUE" AND Beruf.GAdrDat$ = "" THEN CALL AStichNeu("Beruf","Beruf","Beruf",50)
 END SUB 
 
 
SUB TitelStichwort()
 IF AutoTitel$ LIKE "TRUE" AND Titel.GAdrDat$ = "" THEN CALL AStichNeu("Titel","Titel","Titel",30)
 END SUB 
 
SUB LandStichwort()
 IF AutoLAND$ LIKE "TRUE" AND LAND.GAdrDat$ = "" THEN CALL AStichNeu("Land","Land","Land",50)
 END SUB 
 
SUB HobbysStichwort()
 IF AutoHobbys$ LIKE "TRUE" AND Hobbys.GAdrDat$ = "" THEN CALL AStichNeu("Hobbys","Hobbys","Hobby",40)
 END SUB 
 
SUB FiFormStichwort()
 IF AutoFiForm$ LIKE "TRUE" AND Firmenform.GAdrDat$ = "" THEN CALL AStichNeu("Firmenform","FiForm","Firmenform",15)
 END SUB 
  
SUB FStandStichwort()
 IF AutoFStand$ LIKE "TRUE" AND Familienstand.GAdrDat$ = "" THEN CALL AStichNeu("Familienstand","FStand","Familienstand",15)
 END SUB 
 
SUB AnStStichwort()
 IF AutoAnstell$ LIKE "TRUE" AND Anstellungsverh.GAdrDat$ = "" THEN CALL AStichNeu("Anstellungsverh","Anstell","AnstellungsverhÑltnis",15)
 END SUB 
  
 
SUB OrtStichwort()
 IF AutoOrt$ LIKE "TRUE" AND Ort.GAdrDat$ = "" THEN CALL OrtStichNeu(1)
 END SUB 
 
 
SUB PLZStichwort()
 IF AutoPLZ$ LIKE "TRUE" AND PLZ.GAdrDat$ = "" THEN CALL OrtStichNeu(2)
 END SUB 
 
SUB NationalStich()
 IF AutoNational$ LIKE "TRUE" AND NationalitÑt.GAdrDat$ = "" THEN CALL AStichNeu("NationalitÑt","National","NationalitÑt",10)
 END SUB 
 
SUB StaatStichwort()
 IF AutoStaat$ LIKE "TRUE" AND Staatsangehîrig.GAdrDat$ = "" THEN CALL AStichNeu("Staatsangehîrig","Staat","Staatsangehîrig",10)
 END SUB 
 
SUB MaGruppe1Stich()
  cuku% = Codema.maadr
  fdat$ = "maadrgru"
  feld$ = "MAGRUPPE"
 feldold$ = feld$
 IF NEW ("maadr") OR MOD ("maadr") THEN CALL FStore("maadr")
 SET STATUS tit$ + " erzeugen"
 titel$ = tit$ + " erzeugen"
 cfile$ = FILE 
  CALL DFile(3,"maadrgru" + _fpw$)
 DIM Keyword$( RECCOUNT (fdat$))
 DIM Auswahl$(1)
 MOUSE OFF 
 FILE fdat$
 SELECT FIRST 
 a% = 0
 feld2$ = feld$ + "." + fdat$
 feld3$ = feld$ + ".maadr"
 feld$ = feld2$
 IF feld3$ LIKE "keyword*" THEN 
   prompt$ = ""
 ELSE 
   prompt$ = feld3$$
 END IF 
 IF prompt$ = "" THEN prompt$ = "ZZZZZZZ"
 WHILE NOT EOF (fdat$)
   IF LTRIM$ (feld$$) <> "" THEN 
     Keyword$(a%) = feld$$
     IF prompt$ = "ZZZZZZZ" THEN prompt$ = Keyword$(a%)
     a% = a% + 1
   END IF 
   SELECT NEXT FILE fdat$
 WEND 
 MOUSE ON 
 CREATE DIALOG "KEYWORD",0,0,233,200,title$,"MS Sans Serif",8
 ADD DIALOG "KEYWORD",4,0,1,233,176,0,""
 ADD DIALOG "KEYWORD",9,4,12,21,24,2
 ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie den Eintrag aus, der in die aktuelle Agentur aufgenommen werden soll:"
 ADD DIALOG "KEYWORD",7,31,38,188,122,2,2,Keyword$,Auswahl$,prompt$
 ADD DIALOG "KEYWORD",6,31,158,188,12,0,0,KW$,laenge%
 IF MNdisabled%("SUPERVISOR") THEN 
   ADD DIALOG "KEYWORD",1,57,182,55,15,1,"&OK",1,1
   ADD DIALOG "KEYWORD",1,113,182,55,15,0,"&Abbrechen",0,0
 ELSE 
   ADD DIALOG "KEYWORD",1,32,182,55,15,1,"&OK",1,1
   ADD DIALOG "KEYWORD",1,88,182,55,15,0,"&Abbrechen",0,0
   ADD DIALOG "KEYWORD",1,144,182,55,15,0,"&Lîschen",2,1
 END IF 
 DIALOG "KEYWORD",req%
 REMOVE DIALOG "KEYWORD"
 IF req% <> 0 THEN 
   IF kw$ = "" THEN kw$ = Auswahl$(0)
   REM 030697
   IF feld3$ LIKE "keyword*" THEN 
     kw$ = UCASE$ (kw$)
   END IF 
   IF req% = 1 THEN 
     REM ** ANREDE neu aufnehmen
     IF NOT EXISTS (kw$,feld$$) THEN 
       BLANK 
       codemagr% = SER ("maadrgru")
       IF feld3$ LIKE "keyword*" THEN 
         feld$$ = UCASE$ (kw$)
       ELSE 
         feld$$ = UCASE$ (kw$)
       END IF 
       codemagr.maadrgru = codemagr%
       CALL FStore(fdat$)
     END IF 
     FILE "maadr"
     SELECT KEY cuku% LOCK FILE "maadr" INDEX Codema.maadr
     feld1$ = feldold$ + "." + "maadr"
     feld1$$ = UCASE$ (kw$)
     codemagr.maadr = codemagr.maadrgru
     CALL MATimeStamp("MAADR")
     STORE FILE "maadr"
   END IF 
   IF req% = 2 THEN 
     REM ** Stichwort aus Datei Anrede lîschen
     IF EXISTS (kw$,feld$$) THEN 
       SELECT KEY kw$ LOCK FILE fdat$ INDEX feld$$
       REQUEST "Wollen Sie den Eintrag wirklich lîschen?","",130,req2%
       IF req2% = 1 THEN 
         SELECT REMOVE FILE fdat$
         SET STATUS "Eintrag gelîscht"
       END IF 
     ELSE 
       CALL Fehler("Der eingegebene Eintrag ist nicht in der Auswahl - Liste enthalten!","")
     END IF 
   END IF 
 END IF 
 SET STATUS "Bereit"
 FILE cfile$
 MOUSE ON 
 END SUB 
 
SUB Anrede1Stich()
 CALL AStichNeu("Anrede","Anrede","Anrede",20)
 END SUB 
 
SUB Beruf1Stich()
 CALL AStichNeu("Beruf","Beruf","Beruf",50)
 END SUB 
 
SUB Titel1Stich()
 CALL AStichNeu("Titel","Titel","Titel",30)
 END SUB 
 
SUB Land1Stich()
 CALL AStichNeu("Land","Land","Land",50)
 END SUB 
 
SUB Hobbys1Stich()
 CALL AStichNeu("Hobbys","Hobbys","Hobby",40)
 END SUB 
 
SUB FiForm1Stich()
 CALL AStichNeu("Firmenform","FiForm","Firmenform",15)
 END SUB 
  
SUB FStand1Stich()
 CALL AStichNeu("Familienstand","FStand","Familienstand",15)
 END SUB 
 
SUB AnSt1Stich()
 CALL AStichNeu("Anstellungsverh","Anstell","AnstellungsverhÑltnis",15)
 END SUB 
  
 
SUB Ort1Stich()
 CALL OrtStichNeu(1)
 END SUB 
 
SUB PLZ1Stich()
 CALL OrtStichNeu(2)
 END SUB 
 
 
SUB National1Stich()
 CALL AStichNeu("NationalitÑt","National","NationalitÑt",10)
 END SUB 
 
SUB Staat1Stich()
 CALL AStichNeu("Staatsangehîrig","Staat","Staatsangehîrigkeit",10)
 END SUB 
 
SUB ADRStatusNeu()
 IF disabled%("ADRSTATUS") THEN END SUB 
 IF ag$ = "j" THEN 
   IF Gadrdat$ LIKE "ADRESS*" THEN 
     CALL Fehler("Diese Funktion steht unter der Agenturvariante nicht zur VerfÅgung","")
   ELSE 
     CALL AStichNeu("keyword","ADRStat","Adress-Status",20)
     CALL ADRFeldnamen()
   END IF 
 ELSE 
   CALL AStichNeu("keyword","ADRStat","Adress-Status",20)
   CALL ADRFeldnamen()
 END IF 
 UNLOCK FORM 
 END SUB 
 
SUB ADRGruppeNeu()
 IF disabled%("ADRGRUPCH") THEN END SUB 
 IF ag$ = "j" THEN 
   IF Gadrdat$ LIKE "ADRESS*" THEN 
     CALL Fehler("Diese Funktion steht unter der Agenturvariante nicht zur VerfÅgung","")
   ELSE 
     CALL AStichNeu("keyword","ADRGRUP","Adress-Gruppe",20)
     CALL ADRFeldnamen()
   END IF 
 ELSE 
   CALL AStichNeu("keyword","ADRGRUP","Adress-Gruppe",20)
   CALL ADRFeldnamen()
 END IF 
 UNLOCK FORM 
 END SUB 
 
 
SUB GEGruppeNeu()
 REM IF disabled%("ADRGRUPCH") THEN END SUB 
 IF ag$ = "j" THEN 
   IF Gadrdat$ LIKE "ADRESS*" THEN 
     CALL Fehler("Diese Funktion steht unter der Agenturvariante nicht zur VerfÅgung","")
   ELSE 
     IF codege.geadr = 0 THEN 
       CALL Fehler("Die Gesellschaft <ohne Zuordnung> darf nicht bearbeitet werden, um eine neue Gesellschaft anzulegen drÅcken Sie bitte auf den Button NEU !","")
     ELSE 
       CALL AStichNeu("keyword","GEGRUP","Gesellschafts-Gruppe",30)
       REM CALL ADRFeldnamen()
     END IF 
   END IF 
 ELSE 
   IF codege.geadr = 0 THEN 
     CALL Fehler("Die Gesellschaft <ohne Zuordnung> darf nicht bearbeitet werden, um eine neue Gesellschaft anzulegen drÅcken Sie bitte auf den Button NEU !","")
   ELSE 
     CALL AStichNeu("keyword","GEGRUP","Gesellschafts-Gruppe",30)
     REM CALL ADRFeldnamen()
   END IF 
 END IF 
 UNLOCK FORM 
 END SUB 
 


SUB AStichNeu(feld$,fdat$,tit$,laenge%)
 IF fdat$ LIKE "GEGRUP" THEN 
   codege% = codege.geadr
 ELSE 
   IF fdat$ LIKE "MAGRUP" THEN 
     codema% = codema.maadr
   ELSE 
     cuku% = CodeKU.GAdrDat$
     cuko% = CodeKU.GAdrDat$
     knr% = cuku%
     IF NEW (GAdrDat$) OR MOD (GAdrDat$) THEN CALL FStore(GAdrDat$)
     CALL DFile(2,"OFFICE\" + fdat$ + _fpw$)
   END IF 
 END IF 

 IF fdat$ LIKE "TERFLOSK" THEN 
   cuku% = codeku.akquise
   cuko% = codeku.akquise
   codeaq% = codeaq.akquise
   knr% = cuku%
   laenge% = 200
   IF NEW ("akquise") OR MOD ("akquise") THEN CALL FStore("akquise")
 ELSE 
   IF fdat$ LIKE "MAGRUP" OR fdat$ LIKE "GEGRUP" THEN 
   ELSE 
     cuku% = CodeKU.GAdrDat$
     cuko% = CodeKU.GAdrDat$
     knr% = cuku%
   END IF 
 END IF 
 
 DIM tt$( RECCOUNT ("Color"))
 feldold$ = feld$
 
 SET STATUS tit$ + " erzeugen"
 titel$ = tit$ + " erzeugen"
 cfile$ = FILE 
 
 DIM Keyword$( RECCOUNT (fdat$))
 DIM Keyword%( RECCOUNT (fdat$))
 DIM Auswahl$(1)
 DIM Farbe$(1)
 MOUSE OFF 
 FILE fdat$
 SELECT FIRST 
 a% = 0
 feld2$ = feld$ + "." + fdat$
 feld3$ = feld$ + "." + GAdrDat$
 feld$ = feld2$
 IF feld3$ LIKE "keyword*" THEN 
   prompt$ = ""
 ELSE 
   prompt$ = feld3$$
 END IF 
 IF prompt$ = "" THEN prompt$ = "ZZZZZZZ"
 WHILE NOT EOF (fdat$)
   IF LTRIM$ (feld$$) <> "" THEN 
     IF fdat$ LIKE "ADRStat" THEN 
       Keyword$(a%) = feld$$
       Keyword%(a%) = farbewert.adrstat
     ELSE 
       Keyword$(a%) = feld$$
     END IF 
     IF prompt$ = "ZZZZZZZ" THEN prompt$ = Keyword$(a%)
     a% = a% + 1
   END IF 
   SELECT NEXT 
 WEND 
 MOUSE ON 
 IF fdat$ LIKE "ADRStat" OR fdat$ LIKE "ADRGrup" THEN 
   CREATE DIALOG "KEYWORD",0,0,233,200,title$,"MS Sans Serif",8
   ADD DIALOG "KEYWORD",4,0,1,233,176,0,""
   ADD DIALOG "KEYWORD",9,4,12,21,24,2
   ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie den Eintrag aus, der in die aktuelle Adresse aufgenommen werden soll:"
   ADD DIALOG "KEYWORD",7,31,38,188,122,2,2,Keyword$,Auswahl$,prompt$
   
   IF MNdisabled%("ADRSTATSUPERVIS") THEN 
     ADD DIALOG "KEYWORD",1,57,182,55,15,1,"&OK",1,1
     ADD DIALOG "KEYWORD",1,113,182,55,15,0,"&Abbrechen",0,0
     
   ELSE 
     ADD DIALOG "KEYWORD",6,31,158,188,12,0,0,KW$,laenge%
     ADD DIALOG "KEYWORD",1,12,182,45,15,1,"&OK",1,1
     ADD DIALOG "KEYWORD",1,68,182,45,15,0,"&Abbrechen",0,0
     ADD DIALOG "KEYWORD",1,124,182,45,15,0,"&Lîschen",2,1
     IF fdat$ LIKE "ADRStat" THEN 
       IF MNdisabled%("ADRSTATUSFARBE") THEN 
       ELSE 
         ADD DIALOG "KEYWORD",1,180,182,45,15,0,"&Farbe",3,1
       END IF 
     END IF 
   END IF 
 ELSE 

   IF fdat$ LIKE "TERFLOSK" THEN 
     CREATE DIALOG "KEYWORD",0,0,333,200,title$,"MS Sans Serif",8
     ADD DIALOG "KEYWORD",4,0,1,333,176,0,""
     ADD DIALOG "KEYWORD",9,4,12,21,24,2
   ELSE 
     CREATE DIALOG "KEYWORD",0,0,233,200,title$,"MS Sans Serif",8
     ADD DIALOG "KEYWORD",4,0,1,233,176,0,""
     ADD DIALOG "KEYWORD",9,4,12,21,24,2
   END IF 
   IF fdat$ LIKE "TERFLOSK" THEN 
     ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie den Eintrag aus, der in den aktuellen Termin aufgenommen werden soll:"
     ADD DIALOG "KEYWORD",7,31,38,288,122,2,2,Keyword$,Auswahl$,prompt$
     IF MNdisabled%("TERFLOSKNEU") THEN 
       kw$ = ""
     ELSE 
       ADD DIALOG "KEYWORD",6,31,158,288,12,0,0,KW$,laenge%
     END IF 
   ELSE 
     ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie den Eintrag aus, der aufgenommen werden soll:"
     ADD DIALOG "KEYWORD",7,31,38,188,122,2,2,Keyword$,Auswahl$,prompt$
     ADD DIALOG "KEYWORD",6,31,158,188,12,0,0,KW$,laenge%
   END IF 
   IF MNdisabled%("TERFLOSKDEL") THEN 
     ADD DIALOG "KEYWORD",1,57,182,55,15,1,"&OK",1,1
     ADD DIALOG "KEYWORD",1,113,182,55,15,0,"&Abbrechen",0,0
     IF fdat$ LIKE "ADRStat" THEN ADD DIALOG "KEYWORD",1,180,182,45,15,0,"&Farbe",3,1
   ELSE 
     ADD DIALOG "KEYWORD",1,12,182,45,15,1,"&OK",1,1
     ADD DIALOG "KEYWORD",1,68,182,45,15,0,"&Abbrechen",0,0
     ADD DIALOG "KEYWORD",1,124,182,45,15,0,"&Lîschen",2,1
     IF fdat$ LIKE "ADRStat" THEN ADD DIALOG "KEYWORD",1,180,182,45,15,0,"&Farbe",3,1
   END IF 
 END IF 
 DIALOG "KEYWORD",req%
 REMOVE DIALOG "KEYWORD"




 IF req% = 3 THEN 
   kw$ = Auswahl$(0)
   req% = 1
   GOTO setzeFarbe
 END IF 
 IF req% <> 0 THEN 
   IF LTRIM$ (kw$) = "" THEN 
     kw$ = Auswahl$(0)
     IF fdat$ LIKE "ADRStat" THEN 
       FOR i% = 0 TO a% - 1
         IF Keyword$(i%) = kw$ THEN 
           farbe% = Keyword%(i%)
           i% = a% + 1
         END IF 
       NEXT i%
     END IF 
   END IF 
   REM 030697
   IF feld3$ LIKE "keyword*" THEN 
     IF fdat$ LIKE "TERFLOSK" THEN 
     ELSE 
       kw$ = UCASE$ (kw$)
     END IF 
   END IF 
   IF req% = 1 THEN 
     REM ** keyword neu aufnehmen
     IF NOT EXISTS (kw$,feld$$) THEN 
       BLANK 
       codeKey = SER (fdat$,1)
       neuneu% = 1
       IF Workstation% > 0 THEN Workstation.fdat$ = Workstation%
       IF Workstation% > 0 THEN QWoNo.fdat$ = STR$ (Workstation%,"000000") + STR$ (codekey.fdat$,"000000")
       RecStatus.fdat$ = "c"
       IF feld3$ LIKE "keyword*" THEN 
         IF fdat$ LIKE "TERFLOSK" THEN 
           feld$$ = kw$
         ELSE 
           feld$$ = UCASE$ (kw$)
         END IF 
       ELSE 
         feld$$ = kw$
       END IF 
       CALL FStore(fdat$)
     END IF 
     REM IF fdat$ LIKE "TERFLOSK" THEN 
     SELECT CASE fdat$
     CASE "TERFLOSK"
       FILE "Akquise"
       SELECT FIRST FILE "Supervis" INDEX codema.supervis
       SELECT KEY GMACodeMA% FILE "Supervis" INDEX codema.supervis
       SELECT FIRST FILE "akquise" INDEX codeaq.akquise
       SELECT KEY codeaq% LOCK FILE "akquise" INDEX codeaq.akquise
       ON ERROR GOTO w080820071
       IF kuerzel.supervis <> "" THEN 
         na$ = " - " + kuerzel.supervis
       ELSE 
w080820071: 
         na$ = " - " + name.supervis
       END IF 
       ON ERROR GOTO ErrorHandler
       temptxt$ = DATE$ ( TODAY ,"0d.mm.yyyy") + " " + TIME$ ( NOW ,"hh.mm") + " " + kw$ + na$
       IF GTerflNote% = - 1 THEN 
         temptxt$ = DATE$ ( TODAY ,"0d.mm.yyyy") + " " + TIME$ ( NOW ,"hh.mm") + " " + kw$
         notiz.akquise = temptxt$ + CHR$ (13) + CHR$ (10) + notiz.akquise
       ELSE 
         temptxt$ = DATE$ ( TODAY ,"0d.mm.yyyy") + " " + TIME$ ( NOW ,"hh.mm") + " " + kw$ + na$
         ergebnis.akquise = ergebnis.akquise + CHR$ (13) + CHR$ (10) + temptxt$
       END IF 
       CALL QuickStore("Akquise")
       FORM 
     CASE "GEGRUP"
       FILE "GEADR"
       INDEX codege.geadr
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY codege% LOCK FILE "geadr" INDEX codege.geadr
       IF kw$ LIKE "<ohne Zuordnung>" THEN kw$ = ""
       gegruppe.geadr = kw$
       CALL MATimeStamp("GEADR")
       STORE FILE "geadr"
     CASE "MAGRUP"
       FILE "MAADR"
       INDEX codema.maadr
       SELECT FIRST FILE "maadr" INDEX codema.maadr
       SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
       maadrgruppe.maadr = kw$
       CALL MATimeStamp("MAADR")
       STORE FILE "maadr"
     CASE ELSE 
       FILE GAdrDat$
       SELECT KEY cuku% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       feld1$ = feldold$ + "." + GAdrDat$
       IF feld1$ LIKE "Keyword*" THEN 
         IF fdat$ LIKE "ADRStat" THEN 
           ADRStatus.GAdrDat$ = kw$
           ADRFarbe.GAdrDat$ = farbe%
         ELSE 
           IF fdat$ LIKE "ADRGRUP" THEN 
             ADRGruppe.GAdrDat$ = kw$
           ELSE 
             IF stichwort.GAdrDat$ = "" THEN 
               stichwort.GAdrDat$ = kw$
             ELSE 
               stichwort.GAdrDat$ = Stichwort.GAdrDat$ + ", " + kw$
             END IF 
           END IF 
         END IF 
       ELSE 
         feld1$$ = kw$
       END IF 
       CALL QuickStore(GAdrDat$)
     END SELECT 
     
     
     IF fdat$ LIKE "ADRStat" AND farbewert.adrstat < 1 THEN 
       IF disabled%("ADRSTATUSFARBE") THEN 
         req% = 0
       ELSE 
         REQUEST "Mîchten Sie dem Eintrag eine Farbe zuordnen?","",130,req%
       END IF 
setzeFarbe:  
       
 
       IF req% = 1 THEN 
         FILE fdat$
         SELECT FIRST 
         a% = 0
         WHILE NOT EOF (fdat$)
           Keyword$(a%) = feld$$
           Keyword%(a%) = farbewert.adrstat
           a% = a% + 1
           SELECT NEXT 
         WEND 
         farbe1% = - 1
         FOR i% = 0 TO a% - 1
           IF Keyword$(i%) = kw$ THEN 
             farbe1% = Keyword%(i%)
             i% = a% + 1
           END IF 
         NEXT i%
         cc$ = FILE 
         FILE "Color"
         INDEX color.color
         SELECT FIRST 
         FOR i% = 0 TO RECCOUNT ("Color") - 1
           tt$(i%) = color.color + SPACE$ (200) + STR$ (colorno.color,"000")
           SELECT NEXT 
         NEXT i%
         CREATE DIALOG "EYWORD",0,0,233,200,title$,"MS Sans Serif",8
         ADD DIALOG "EYWORD",4,0,1,233,176,0,""
         ADD DIALOG "EYWORD",9,4,12,21,24,2
         ADD DIALOG "EYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie die gewÅnschte Farbe aus:"
         ADD DIALOG "EYWORD",7,31,38,188,122,2,2,tt$,Farbe$,prompt$
         ADD DIALOG "EYWORD",1,57,182,55,15,1,"&OK",1,1
         ADD DIALOG "EYWORD",1,113,182,55,15,0,"&Abbrechen",0,0
         DIALOG "EYWORD",reqc%
         REMOVE DIALOG "EYWORD"
         IF reqc% = 1 THEN 
           farbe% = VAL ( RIGHT$ (Farbe$(0),3))
           IF farbe% <> farbe1% THEN 
             SELECT KEY kw$ LOCK FILE "ADRStat" INDEX keyword.adrstat
             IF keyword.adrstat = kw$ THEN 
               farbewert.adrstat = farbe%
                
               STORE FILE "ADRSTAT"
               UNLOCK CURRENT FILE "adrstat"
               UNLOCK FILE "adrstat"
             END IF 
             FILE GAdrDat$
             SELECT KEY cuko% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
             ADRFarbe.GAdrDat$ = farbe%
             STORE FILE GAdrDat$
             UNLOCK CURRENT FILE GAdrDat$
             UNLOCK FILE GAdrDat$
             REQUEST "Mîchten Sie allen Adressen mit diesem Adress-Status die Farbe zuordnen?","",130,req2%
             IF req2% = 1 THEN 
               indold$ = INDEX 
               INDEX adrstatus.GAdrDat$
               IF RECCOUNT (GAdrDat$) > 0 THEN 
                 SELECT FIRST FILE GAdrDat$ INDEX adrstatus.GAdrDat$
               ELSE 
                 SELECT LAST FILE GAdrDat$ INDEX adrstatus.GAdrDat$
               END IF 
               SELECT KEY kw$ LOCK FILE GAdrDat$ INDEX adrstatus.GAdrDat$
               MOUSE OFF 
               i% = 0
               WHILE NOT EOF (GAdrDat$) AND adrstatus.GAdrDat$ = kw$
                 IF adrstatus.GAdrDat$ = kw$ THEN 
                   i% = i% + 1
                   adrfarbe.GAdrDat$ = farbe%
                   STORE FILE GAdrDat$
                   UNLOCK CURRENT FILE GAdrDat$
                   UNLOCK FILE GAdrDat$
                 END IF 
                 SELECT NEXT LOCK 
                 SET STATUS "DatensÑtze geÑndert: " + STR$ (i%,"999999")
               WEND 
               MOUSE ON 
               INDEX indold$
               SELECT KEY cuko% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
             END IF 
           END IF 
         END IF 
         FILE cc$
 
       END IF 
     END IF 
   END IF 
   IF req% = 2 THEN 
     REM ** Stichwort aus Datei Anrede lîschen
     IF EXISTS (kw$,feld$$) THEN 
       SELECT KEY kw$ LOCK FILE fdat$ INDEX feld$$
       REQUEST "Wollen Sie den Eintrag wirklich lîschen?","",130,req2%
       IF req2% = 1 THEN 
         SELECT REMOVE FILE fdat$
         SET STATUS "Eintrag gelîscht"
       END IF 
     ELSE 
       CALL Fehler("Der eingegebene Eintrag ist nicht in der Auswahl - Liste enthalten!","")
     END IF 
   END IF 
 END IF 
 SET STATUS "Bereit"
 FILE cfile$
 IF fdat$ LIKE "TERFLOSK" OR fdat$ LIKE "GEGRUP" OR fdat$ LIKE "MAGRUP" THEN 
 ELSE 
   SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   FORM 
 END IF 
 MOUSE ON 
 END SUB 
  
 REM 1=Ort
 REM 2=PLZ
SUB OrtStichNeu(art%)
 cuku% = CodeKU.GAdrDat$
 IF NEW (GAdrDat$) OR MOD (GAdrDat$) THEN CALL FStore(GAdrDat$)
 SET STATUS "Ort erzeugen"
 cfile$ = FILE 
 CALL DFile(2,"OFFICE\Ort" + _fpw$)
 DIM Keyword$( RECCOUNT ("Ort"))
 DIM Auswahl$(1)
 MOUSE OFF 
 FILE "Ort"
 prompt$ = ""
 IF art% = 1 THEN 
   INDEX OrtPLZ.ort
   IF ort.GAdrDat$ <> "" THEN 
     ok% = 0
     IF plz.GAdrDat$ <> "" THEN 
       plz$ = plz.GAdrDat$
       IF EXISTS (plz$,plz.ort) THEN 
         SELECT KEY plz$ FILE "ort" INDEX plz.ort
         ok% = 1
       ELSE 
         ort$ = ort.GAdrDat$
         IF EXISTS (ort$,ort.ort) THEN 
           SELECT KEY ort$ FILE "Ort" INDEX ort.ort
           ok% = 1
         ELSE 
           ok% = 0
         END IF 
       END IF 
     ELSE 
       ort$ = ort.GAdrDat$
       IF EXISTS (ort$,ort.ort) THEN 
         SELECT KEY ort$ FILE "Ort" INDEX ort.ort
         ok% = 1
       ELSE 
         ok% = 0
       END IF 
     END IF 
     IF ok% = 1 THEN prompt$ = Ort.GAdrDat$ + " ," + FN NUMERIC(PLZ.ort) + SPACE$ (160) + STR$ (codeort.ort,"999999")
   END IF 
 END IF 
 IF art% = 2 THEN 
   INDEX PLZOrt.ort
   IF plz.GAdrDat$ <> "" THEN 
     plz$ = plz.GAdrDat$
     IF EXISTS (plz$,plz.ort) THEN 
       SELECT KEY plz$ FILE "ort" INDEX plz.ort
       prompt$ = FN NUMERIC(PLZ.ort) + " ," + ort.ort + SPACE$ (160) + STR$ (codeort.ort,"999999")
     END IF 
   END IF 
 END IF 
 SELECT FIRST 
 a% = 0
 IF prompt$ = "" THEN prompt$ = "ZZZZZZZ"
 
 WHILE NOT EOF ("Ort")
   IF art% = 1 THEN Keyword$(a%) = Ort.Ort + " ," + FN NUMERIC(PLZ.ort) + SPACE$ (160) + STR$ (codeort.ort,"999999")
   IF art% = 2 THEN Keyword$(a%) = FN NUMERIC(PLZ.ort) + " ," + ort.ort + SPACE$ (160) + STR$ (codeort.ort,"999999")
   IF prompt$ = "ZZZZZZZ" THEN prompt$ = Keyword$(a%)
   a% = a% + 1
   SELECT NEXT 
 WEND 
ort301296: 
 MOUSE ON 
 CREATE DIALOG "KEYWORD",0,0,310,200,title$,"MS Sans Serif",8
 ADD DIALOG "KEYWORD",4,0,1,292,176,0,""
 ADD DIALOG "KEYWORD",9,4,12,21,24,2
 ADD DIALOG "KEYWORD",5,30,14,190,19,0,"Bitte wÑhlen Sie den Ort aus, der in die aktuelle Adresse aufgenommen werden soll:"
 ADD DIALOG "KEYWORD",7,30,38,260,105,2,2,Keyword$,Auswahl$,prompt$
 ADD DIALOG "KEYWORD",6,50,158,40,12,0,0,KWPLZ$,8
 ADD DIALOG "KEYWORD",6,110,158,175,12,0,0,KW$,50
 ADD DIALOG "KEYWORD",5,30,158,20,10,0,"PLZ:"
 ADD DIALOG "KEYWORD",5,95,158,12,10,0,"Ort:"
 IF MNdisabled%("SUPERVISOR") THEN 
   ADD DIALOG "KEYWORD",1,92,180,54,15,1,"&OK",1,1
   ADD DIALOG "KEYWORD",1,148,180,54,15,0,"&Abbrechen",0,0
 ELSE 
   ADD DIALOG "KEYWORD",1,92,180,54,15,1,"&OK",1,1
   ADD DIALOG "KEYWORD",1,148,180,54,15,0,"&Abbrechen",0,0
   ADD DIALOG "KEYWORD",1,204,180,54,15,0,"&Lîschen",2,1
 END IF 
 DIALOG "KEYWORD",req%
 REMOVE DIALOG "KEYWORD"
 IF req% <> 0 THEN 
   neu1% = 0
   IF kw$ = "" THEN 
     codeort% = VAL ( RIGHT$ (Auswahl$(0),6))
     SELECT KEY codeort% FILE "ort" INDEX codeort.ort
     kw$ = ort.ort
     kwplZ$ = plz.ort
     IF req% <> 2 THEN 
       SELECT KEY cuku% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       Ort.GAdrDat$ = kw$
       plz.GAdrDat$ = kwplz$
       CALL FStore(GAdrDat$)
        
     END IF 
   ELSE 
     neu1% = 1
     IF kw$ = "" OR kwplz$ = "" THEN 
       REQUEST "Bitte PLZ und Ort eintragen!","",2
       GOTO ort301296
     END IF 
   END IF 
   IF neu1% = 1 THEN 
     REM ** Ort neu aufnehmen
     plzort$ = FN NUMERIC(kwPLZ$) + TRIM$ ( LTRIM$ (kw$))
     IF NOT EXISTS (plzort$,PLZOrt.Ort) THEN 
       BLANK 
       codeort.ort = SER ("ort",1)
       fdat$ = "Ort"
       codeKey = SER (fdat$,1)
       IF Workstation% > 0 THEN Workstation.fdat$ = Workstation%
       IF Workstation% > 0 THEN QWoNo.fdat$ = STR$ (Workstation%,"000000") + STR$ (codekey.fdat$,"000000")
       RecStatus.fdat$ = "c"
       Ort.Ort = kw$
       plz.ort = kwplz$
       CALL FStore("Ort")
     END IF 
     SELECT KEY cuku% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     REM IF Ort.GAdrDat$ = "" THEN 
       Ort.GAdrDat$ = kw$
       plz.GAdrDat$ = kwplz$
     REM END IF 
     CALL FStore(GAdrDat$)
   END IF 
   IF req% = 2 THEN 
     REM ** Stichwort aus Datei KEYWORDS lîschen
 
     IF EXISTS (codeort%,codeOrt.Ort) THEN 
       SELECT KEY codeort% LOCK FILE "Ort" INDEX codeort.Ort
       REQUEST "Wollen Sie den Ort " + CHR$ (34) + kw$ + CHR$ (34),"wirklich aus der Orts - Liste entfernen?",135,req2%
       IF req2% = 1 THEN 
         SELECT REMOVE FILE "ort"
         SET STATUS "Ort gelîscht"
       END IF 
     ELSE 
       CALL Fehler("Der eingegebene Ort ist nicht in der Orts - Liste enthalten!","")
     END IF 
   END IF 
 END IF 
 SET STATUS "Bereit"
 FILE cfile$
 MOUSE ON 
 FORM 
 END SUB 
 
  
  
  
 
 
 ' Anzeige der Kundendaten als Fenster
 ' ======================================================================
 
SUB SHOWAdr()
 w% = 120:h% = 120:st% = NOW 
 d$ = "ShowCustoms"
 CREATE DIALOG d$,0,0,w%,h%,title$,"MS Sans Serif",8
 Kunde$ = vorname.GAdrDat$ + " " + nachname.GAdrDat$
 Ort$ = Plz.GAdrDat$ + " " + ort.GAdrDat$
 ADD DIALOG d$,5,4,20,90,9,0,anrede.GAdrDat$
 ADD DIALOG d$,5,4,28,90,9,0,kunde$
 ADD DIALOG d$,5,4,36,90,9,0,stra·e.GAdrDat$
 ADD DIALOG d$,5,4,44,90,9,0,ort$
 ADD DIALOG d$,5,4,58,90,9,0,"Telefon 1"
 ADD DIALOG d$,5,40,58,90,9,0,telefon1.GAdrDat$
 ADD DIALOG d$,5,4,66,90,9,0,"Telefon 2"
 ADD DIALOG d$,5,40,66,90,9,0,telefon2.GAdrDat$
 ADD DIALOG d$,5,4,74,90,9,0,"Telefax"
 ADD DIALOG d$,5,40,74,90,9,0,telefax.GAdrDat$
 ADD DIALOG d$,5,4,82,90,9,0,"BTX"
 ADD DIALOG d$,5,40,82,90,9,0,btx.GAdrDat$
 ADD DIALOG d$,1,w% - 40,h% - 18,36,14,1,"OK",1,1
 DIALOG d$,a%
 REMOVE DIALOG d$
 END SUB 
 
 
 ' Ausgabe Geburtstagsliste
 ' ======================================================================
 
SUB GEBLISTE()
 IF disabled%("ADRDrucken") THEN END SUB 
   IF OPEN ("adrtemp") THEN 
     REM CLOSE FILE "ADRTEMP"
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   ELSE 
     CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   END IF 
 SET STATUS "Geburtstagsliste ausgeben"
 IF _projekt$ LIKE "PROVIS*" THEN 
   CALL DFile(3,"MAADR" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
 CALL DFile(2,"color" + _fpw$)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 opt% = 8
 opt2% = 1
 sort% = 2
 listart% = 1
 ok1% = - 1
 IF GGebList% = - 1 THEN 
   req% = 1
   GGebList% = 0
 ELSE 
   GOTO Geb1Dial150996
GebDial150996: 
   REQUEST "Die Datumseingabe von: bis: war falsch","Bitte geben Sie das Datum in der Form: tt.mm.jjjj ein!",0
Geb1Dial150996: 
    CREATE DIALOG "GBLISTE",0,0,236,289,"Geburtstagsliste","MS Sans Serif",8
    ADD DIALOG "GBLISTE",4,0,0,235,268,0,""
    ADD DIALOG "GBLISTE",9,6,9,22,23,2
    ADD DIALOG "GBLISTE",5,37,9,105,11,0,"Ausgabe einer Geburtstagsliste:"
    ADD DIALOG "GBLISTE",5,37,22,184,19,0,"Bitte geben Sie an, welche Art von Geburtstagsliste Sie wÅnschen."
    ADD DIALOG "GBLISTE",4,37,43,84,122,0," Liste fÅr ... "
    ADD DIALOG "GBLISTE",3,41,52,70,9,0,"aktueller Tag",8,opt%
    ADD DIALOG "GBLISTE",3,41,63,70,10,0,"ganzes Jahr",1,opt%
    ADD DIALOG "GBLISTE",3,41,74,70,10,0,"diesen Monat",2,opt%
    ADD DIALOG "GBLISTE",3,41,85,70,9,0,"nÑchsten Monat",3,opt%
    ADD DIALOG "GBLISTE",3,41,96,63,9,0,"wahlfreier Monat",7,opt%
    ADD DIALOG "GBLISTE",3,41,106,63,9,0,"in Tage",9,opt%
    ADD DIALOG "GBLISTE",6,105,96,13,11,0,0,mon1%,2
    ADD DIALOG "GBLISTE",6,105,106,13,11,0,0,tag1%,2
 
    
    REM ADD DIALOG "GBLISTE",5,42,114,20,8,0,"Monat:"
    ADD DIALOG "GBLISTE",3,41,127,81,9,0,"freie Wahl Datum",6,opt%
    ADD DIALOG "GBLISTE",6,57,139,53,11,0,0,von$,10
    ADD DIALOG "GBLISTE",5,41,141,15,8,0,"von:"
    ADD DIALOG "GBLISTE",6,57,151,53,12,0,0,bis$,10
    ADD DIALOG "GBLISTE",5,41,152,12,8,0,"bis:"
    ADD DIALOG "GBLISTE",4,121,43,112,53,0," Ausgabeziel ... "
    ADD DIALOG "GBLISTE",3,124,57,85,8,0,"Bildschirm/Drucker",1,opt2%
    ADD DIALOG "GBLISTE",3,124,67,90,9,0,"Serienbriefdatei (dBASE)",2,opt2%
    ADD DIALOG "GBLISTE",3,124,77,73,9,0,"MS EXCEL - Tabelle",3,opt2%
    ADD DIALOG "GBLISTE",4,121,98,112,53,0,"Sortierung fÅr Druck... "
    ADD DIALOG "GBLISTE",3,124,113,99,8,0,"Alphabetisch Kunde",1,sort%
    IF _projekt$ LIKE "PROVIS" THEN ADD DIALOG "GBLISTE",3,124,123,105,9,0,"Alphabetisch Agentur/Kunde",2,sort%
    ADD DIALOG "GBLISTE",3,124,133,71,10,0,"Geburtsdatum",3,sort%
    
    ADD DIALOG "GBLISTE",4,37,175,189,41,0,"Listenart ... "
    ADD DIALOG "GBLISTE",3,41,188,176,9,0,"Ausdruck mit allen Angaben zur Adresse",1,listart%
    ADD DIALOG "GBLISTE",3,41,199,178,9,0,"nur Kurzausdruck mit Name, Geb.datum, Agentur",2,listart%
    ADD DIALOG "GBLISTE",2,37,218,184,13,0,"Kunden einer bestimmten Agentur","j","n",mitarb$
    ADD DIALOG "GBLISTE",2,37,230,137,13,0,"Kunden einer bestimmten Adressgruppe","j","n",adrgrupjn$
    ADD DIALOG "GBLISTE",2,37,242,130,13,0,"Kunden mit bestimmten Adressstatus","j","n",adrstatjn$
    ADD DIALOG "GBLISTE",2,176,230,50,13,0,"ausschlie·en","j","n",adrgrupaus$
    ADD DIALOG "GBLISTE",2,176,242,50,13,0,"ausschlie·en","j","n",adrstataus$
    ADD DIALOG "GBLISTE",2,37,254,130,13,0,"Kunden mit bestimmten Stichwort","j","n",adrstichjn$
    ADD DIALOG "GBLISTE",2,176,254,50,13,0,"ausschlie·en","j","n",adrstiaus$
    ADD DIALOG "GBLISTE",1,61,270,53,15,1,"&OK",1,1
    ADD DIALOG "GBLISTE",1,117,270,56,15,0,"&Abbrechen",0,0
   DIALOG "GBLISTE",req%
   REMOVE DIALOG "GBLISTE"


   IF req% = 1 AND opt% = 6 THEN 
     ON ERROR GOTO GebDial150996
     IF von$ = "" THEN von$ = "01.01.1901"
     IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyyy")
     tagvon% = DAYS (von$)
     tagbis% = DAYS (bis$)
   END IF 


   sunagrup$ = ""
   sunastat$ = ""
   sunastich$ = ""
 END IF 
  IF req% = 1 THEN 
       IF adrgrupjn$ = "j" THEN 

         datei1$ = "ADRGRUP"
       
         z% = RECCOUNT (datei1$)
         IF z% < RECCOUNT (GAdrDat$) THEN 
           z% = RECCOUNT (GAdrDat$)
         END IF 
         IF z% < RECCOUNT (datei1$) + 5 THEN 
           z% = RECCOUNT (datei1$) + 5
         END IF 
         IF z% > 20000 THEN z% = 20000
         REDIM AdrFound$(z%,1)
         REDIM AdrFound$(z%)
         REM FOR i% = 0 TO z% - 1
           REM AdrFound$(i%) = ""
         REM NEXT i%
         CALL DFile(3,datei1$ + _fpw$)
         FILE datei1$
         INDEX keyword.datei1$
         SELECT FIRST 
         a% = 0
         SELECT WHERE keyword.datei1$ <> ""
         SELECT FIRST 
         WHILE NOT EOF (datei1$)
           AdrFound$(a%) = keyword
           a% = a% + 1
           SELECT NEXT 
         WEND 
         AdrFound$(a%) = ""
         LAuswahl$ = AdrFound$(0)
         LAuswahl1$(0) = LAuswahl$
         CREATE DIALOG "ADRLISTE",0,0,340,197,"Adress-Gruppe wÑhlen","MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
         DIALOG "ADRLISTE",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           sunagrup$ = LAuswahl$
           REM FOR i% = 0 TO z% - 1
             REM AdrFound$(i%) = ""
           REM NEXT i%
         ELSE 
           ok% = 0
           AdrSuche% = 0
           REDIM AdrFound$( RECCOUNT (GAdrDat$))
           GOTO gebend061196
         END IF 

       END IF 
       IF adrstatjn$ = "j" THEN 

         datei1$ = "ADRStat"
       
         z% = RECCOUNT (datei1$)
         IF z% < RECCOUNT (GAdrDat$) THEN 
           z% = RECCOUNT (GAdrDat$)
         END IF 
         IF z% < RECCOUNT (datei1$) + 5 THEN 
           z% = RECCOUNT (datei1$) + 5
         END IF 
         IF z% > 20000 THEN z% = 20000
         REDIM AdrFound$(z%,1)
         REDIM AdrFound$(z%)
         REM FOR i% = 0 TO z% - 1
           REM AdrFound$(i%) = ""
         REM NEXT i%
         CALL DFile(3,datei1$ + _fpw$)
         FILE datei1$
         INDEX keyword.datei1$
         SELECT FIRST 
         a% = 0
         SELECT WHERE keyword.datei1$ <> ""
         SELECT FIRST 
         WHILE NOT EOF (datei1$)
           AdrFound$(a%) = keyword
           a% = a% + 1
           SELECT NEXT 
         WEND 
         AdrFound$(a%) = ""
         LAuswahl$ = AdrFound$(0)
         LAuswahl1$(0) = LAuswahl$
         CREATE DIALOG "ADRLISTE",0,0,340,197,"Adress-Status wÑhlen","MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
         DIALOG "ADRLISTE",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           sunastat$ = LAuswahl$
           REM FOR i% = 0 TO z% - 1
             REM AdrFound$(i%) = ""
           REM NEXT i%
         ELSE 
           ok% = 0
           AdrSuche% = 0
           REDIM AdrFound$( RECCOUNT (GAdrDat$))
           GOTO gebend061196
         END IF 
       END IF 
       IF adrstichjn$ = "j" THEN 
         CALL DFile(2,"OFFICE\keywords" + _fpw$)
         datei1$ = "keywords"
       
         z% = RECCOUNT (datei1$)
         IF z% < RECCOUNT (GAdrDat$) THEN 
           z% = RECCOUNT (GAdrDat$)
         END IF 
         IF z% < RECCOUNT (datei1$) + 5 THEN 
           z% = RECCOUNT (datei1$) + 5
         END IF 
         IF z% > 20000 THEN z% = 20000
         REDIM AdrFound$(z%,1)
         REDIM AdrFound$(z%)
         REM FOR i% = 0 TO z% - 1
           REM AdrFound$(i%) = ""
         REM NEXT i%
         CALL DFile(3,datei1$ + _fpw$)
         FILE datei1$
         INDEX keyword.datei1$
         SELECT FIRST 
         a% = 0
         SELECT WHERE keyword.datei1$ <> ""
         SELECT FIRST 
         WHILE NOT EOF (datei1$)
           AdrFound$(a%) = keyword
           a% = a% + 1
           SELECT NEXT 
         WEND 
         AdrFound$(a%) = ""
         LAuswahl$ = AdrFound$(0)
         LAuswahl1$(0) = LAuswahl$
         CREATE DIALOG "ADRLISTE",0,0,340,197,"Stichwort wÑhlen","MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
         DIALOG "ADRLISTE",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           sunastich$ = LAuswahl$
           REM FOR i% = 0 TO z% - 1
             REM AdrFound$(i%) = ""
           REM NEXT i%
         ELSE 
           ok% = 0
           AdrSuche% = 0
           REDIM AdrFound$( RECCOUNT (GAdrDat$))
           GOTO gebend061196
         END IF 


       END IF 
       IF mitarb$ = "j" THEN 
         IF gasp% <> - 1 THEN 
           FILE "maadr"
           INDEX nachname
           SELECT FIRST 
           a% = 0
           SELECT FIRST 
           REDIM AdrFound$( RECCOUNT ("maadr"))
           WHILE NOT EOF ("maadr")
             AdrFound$(a%) = LTRIM$ (nachname) + "," + LTRIM$ (vorname) + SPACE$ (80) + STR$ (codema,"000000")
             a% = a% + 1
             SELECT NEXT 
           WEND 
           AdrFound$(a%) = ""
           LAuswahl$ = AdrFound$(0)
           LAuswahl1$(0) = LAuswahl$
           CREATE DIALOG "ADRSTICHW",0,0,194,202,title$,"MS Sans Serif",8
           ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
           ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
           ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
           DIALOG "ADRSTICHW",req5%
           MOUSE ON 
           REMOVE DIALOG "ADRSTICHW"
           IF req5% = 1 THEN 
             LAuswahl$ = LAuswahl1$(0)
             scodema% = VAL ( RIGHT$ (LAuswahl$,6))
             SELECT FIRST 
             SELECT KEY scodema% FILE "maadr" INDEX codema.maadr
             smaname$ = nachname.maadr + ", " + vorname.maadr
           ELSE 
             mitarb$ = "n"
             req% = 0
             GOTO gebend061196
           END IF 
         END IF 
 
 
         IF GASP% THEN 
          'Jan: modi ---------------------
          wks1% = workstation%
          IF workstation% > 0 THEN 
            wks1% = workstation%
            rep% = GetCodeMA%(cuma%,Workstation%)
          ELSE 
            REQUEST "Mîchten Sie die BÅrostruktur zur Suche benutzen?","",130,req%
            IF req% = 1 THEN 
              a% = SelectOffice%("VorgÑnger-Auswahl","",1,0)
              IF a% <> - 1 THEN 
                zzz% = a%
                wks% = zzz%'Aaarg ... Spaghetti-Code 
                codema% = VAL (GetWkscodema$("",wks%))
                rep% = codema%
              ELSE 
                CALL Fehler("Es wurde kein BÅro gewÑhlt!","")
                rep% = 0
              END IF 
            ELSE 
              rep% = GetCodeMA%(_cuma%,Wks1%)
            END IF 
          END IF 
          IF rep% <> 0 THEN 
            scodema% = rep%
            SELECT FIRST 
            SELECT KEY scodema% FILE "maadr" INDEX codema.maadr
            smaname$ = nachname.maadr + ", " + vorname.maadr
          ELSE 
            mitarb$ = "n"
            req% = 0
            GOTO gebend061196 
          END IF 
         END IF 
 
       END IF 
 
   MOUSE OFF 
   cdir$ = DIRECTORY 
   DIRECTORY _netpath$ + "OFFICE"
   SELECT CASE GAdrDat$
     CASE "ADRESSEN"
       Ueberschrift$ = "Kunden - Geburtstagsliste "
     CASE "BCKONTAK"
       Ueberschrift$ = "BC - Geburtstagsliste "
   END SELECT 
   
   SELECT CASE opt%
   CASE 1
     hd$ = "(ganzes Jahr)"
   CASE 2
     hd$ = "(Monat " + MONTH$ ( TODAY ) + ")"
   CASE 3
     hd$ = "(Monat " + MONTH$ ( TODAY + 30) + ")"
   CASE 4
     hd$ = "(diese Woche)"
   CASE 5
     hd$ = "(nÑchste Woche)"
   CASE 6
     hd$ = "vom: " + von$ + " bis: " + bis$
   CASE 7
     IF mon1% = 1 THEN monlang$ = "Januar"
     IF mon1% = 2 THEN monlang$ = "Februar"
     IF mon1% = 3 THEN monlang$ = "MÑrz"
     IF mon1% = 4 THEN monlang$ = "April"
     IF mon1% = 5 THEN monlang$ = "Mai"
     IF mon1% = 6 THEN monlang$ = "Juni"
     IF mon1% = 7 THEN monlang$ = "Juli"
     IF mon1% = 8 THEN monlang$ = "August"
     IF mon1% = 9 THEN monlang$ = "September"
     IF mon1% = 10 THEN monlang$ = "Oktober"
     IF mon1% = 11 THEN monlang$ = "November"
     IF mon1% = 12 THEN monlang$ = "Dezember"
     hd$ = "Monat: " + monlang$
   CASE 8
     REM today
   CASE 9
     REM in xy Tagen
     x$ = DATE$ ( TODAY + tag1%,"0d.mm.yyyy")
     hd$ = "fÅr den: " + x$
 
   END SELECT 
   Ueberschrift$ = Ueberschrift$ + hd$
   title2$ = Ueberschrift$

   SELECT FIRST FILE "supervis" INDEX codema.supervis
   SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
   fussma$ = "gedruckt durch: " + Name.supervis + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
   title2$ = title2$ + " " + fussma$
   MOUSE OFF 
   CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
   CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
   IF OPEN ("adrtemp") THEN 
     REM CLOSE FILE "ADRTEMP"
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   ELSE 
     CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   END IF 
   FILE GAdrDat$
   INDEX codema.GAdrDat$
   SELECT FIRST FILE GAdrDat$ INDEX codema.GAdrDat$
   IF scodema% > 0 THEN 
     SELECT KEY scodema% FILE GAdrDat$ INDEX codema.GAdrDat$
   END IF 
   abz% = 0
   ok% = 1
   CALL Server("LISTBOXINIT","Adre·auswahl")
   CALL Gauge(1,"Adre·datei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   _prozt% = 0
   _proz2% = 0
   _anz% = RECCOUNT (GAdrDat$)
   REM 240999
   a% = 0
   b% = RECCOUNT (GAdrDat$)
   IF b% * 6 > 32690 THEN 
     b% = 32690
     REDIM AdrFound$(32690,1)
     REDIM AdrFound$(32690)
   ELSE 
     b% = b% * 6
     REDIM AdrFound$(b%,1)
     REDIM AdrFound$(b%)
   END IF 
   REM FOR a% = 0 TO b%
     REM AdrFound$(a%) = ""
   REM NEXT a%
   a% = 0
   WHILE NOT EOF (GAdrDat$) AND ServerReply$() <> "CANCEL"
     codeku% = codeku.GAdrDat$
     _proz% = INT ((100 / _anz%) * _proz2%)
     IF _proz% > 100 THEN _proz% = 100
     IF _proz% < 2 THEN _proz% = 2
     IF _proz% <> _prozt% THEN 
       _prozt% = _proz%
       SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
       CALL Gauge(_proz%,"")
     END IF 
     _proz2% = _proz2% + 1

      locktest% = MNdisabled%("DATALOCK")
      IF locktest% AND FreeFormular.GadrDat$ < 1 THEN 
        IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN GOTO endgeb120220041
      END IF 


     SELECT CASE opt%
       CASE 1
         locktest% = MNdisabled%("DATALOCK")
         IF geburtstag.GAdrDat$ > 0 THEN 
           anrede$ = anrede.GAdrDat$
           titel$ = titel.GAdrDat$
           IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" THEN 
             
             nachname$ = LTRIM$ (nachname.GAdrDat$)
             vorname$ = LTRIM$ (vorname.GAdrDat$)
           ELSE 
             nachname$ = LTRIM$ (nachname.GAdrDat$)
             vorname$ = LTRIM$ (Geburtsname.GAdrDat$)
           END IF 
           gebdat% = Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
             REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
           END IF 
         END IF 

         IF K1geburtstag.GAdrDat$ > 0 THEN 
           
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K1Name.GAdrDat$
           nachname$ = k1NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K1Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF locktest% THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             REM CALL Fehler(anrede$ + " " + titel$,nachname$ + " " + vorname$ + " " + DATE$ (gebdat%,"0d.mm.yyyy"))
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K2geburtstag.GAdrDat$ > 0 THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K2Name.GAdrDat$
           nachname$ = k2NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K2Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF locktest% AND FreeFormular.GadrDat$ < 1 THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             REM CALL Fehler(anrede$ + " " + titel$,nachname$ + " " + vorname$ + " " + DATE$ (gebdat%,"0d.mm.yyyy"))
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K3geburtstag.GAdrDat$ > 0 THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K3Name.GAdrDat$
           nachname$ = k3NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K3Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF locktest% AND FreeFormular.GadrDat$ < 1 THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K4geburtstag.GAdrDat$ > 0 THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K4Name.GAdrDat$
           nachname$ = k4NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K4Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF locktest% AND FreeFormular.GadrDat$ < 1 THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF EGgeburtstag.GAdrDat$ > 0 THEN 
           anrede$ = EGAnrede.GAdrDat$
           titel$ = ""
           nachname$ = EGNachname.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           vorname$ = EGvorname.GAdrDat$
           gebdat% = EGGeburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF locktest% AND FreeFormular.GadrDat$ < 1 THEN 
             IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 2
         locktest% = MNdisabled%("DATALOCK")
         IF geburtstag.GAdrDat$ > 0 AND MONTH (geburtstag.GAdrDat$) = MONTH ( TODAY ) THEN 
           anrede$ = anrede.GAdrDat$
           titel$ = titel.GAdrDat$
           nachname$ = nachname.GAdrDat$
           vorname$ = vorname.GAdrDat$
           gebdat% = Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K1geburtstag.GAdrDat$ > 0 AND MONTH (k1geburtstag.GAdrDat$) = MONTH ( TODAY ) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K1Name.GAdrDat$
           nachname$ = k1NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K1Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K2geburtstag.GAdrDat$ > 0 AND MONTH (k2geburtstag.GAdrDat$) = MONTH ( TODAY ) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K2Name.GAdrDat$
           nachname$ = k2NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K2Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K3geburtstag.GAdrDat$ > 0 AND MONTH (k3geburtstag.GAdrDat$) = MONTH ( TODAY ) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K3Name.GAdrDat$
           nachname$ = k3NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K3Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             abz% = abz% + 1
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K4geburtstag.GAdrDat$ > 0 AND MONTH (k4geburtstag.GAdrDat$) = MONTH ( TODAY ) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K4Name.GAdrDat$
           nachname$ = k4NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K4Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF EGgeburtstag.GAdrDat$ > 0 AND MONTH (EGgeburtstag.GAdrDat$) = MONTH ( TODAY ) THEN 
           anrede$ = EGAnrede.GAdrDat$
           titel$ = ""
           nachname$ = EGNachname.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           vorname$ = EGvorname.GAdrDat$
           gebdat% = EGGeburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 3
         nextmonat% = MONTH ( TODAY ) + 1
         IF nextmonat% = 13 THEN nextmonat% = 1
         IF geburtstag.GAdrDat$ > 0 AND MONTH (geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = anrede.GAdrDat$
           titel$ = titel.GAdrDat$
           nachname$ = nachname.GAdrDat$
           vorname$ = vorname.GAdrDat$
           gebdat% = Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K1geburtstag.GAdrDat$ > 0 AND MONTH (k1geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K1Name.GAdrDat$
           nachname$ = k1NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K1Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K2geburtstag.GAdrDat$ > 0 AND MONTH (k2geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K2Name.GAdrDat$
           nachname$ = k2NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K2Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K3geburtstag.GAdrDat$ > 0 AND MONTH (k3geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K3Name.GAdrDat$
           nachname$ = k3NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K3Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K4geburtstag.GAdrDat$ > 0 AND MONTH (k4geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K4Name.GAdrDat$
           nachname$ = k4NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K4Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF EGgeburtstag.GAdrDat$ > 0 AND MONTH (EGgeburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = EGAnrede.GAdrDat$
           titel$ = ""
           nachname$ = EGNachname.GAdrDat$
           vorname$ = EGvorname.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = EGGeburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 4
       CASE 5
       CASE 6
         
         IF geburtstag.GAdrDat$ > 0 AND geburtstag.GAdrDat$ >= tagvon% AND geburtstag.GAdrDat$ <= tagbis% THEN 
           anrede$ = anrede.GAdrDat$
           titel$ = titel.GAdrDat$
           nachname$ = nachname.GAdrDat$
           vorname$ = vorname.GAdrDat$
           gebdat% = Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K1geburtstag.GAdrDat$ > 0 AND k1geburtstag.GAdrDat$ >= tagvon% AND k1geburtstag.GAdrDat$ <= tagbis% THEN 
           REM CALL Fehler("Test","")
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K1Name.GAdrDat$
           nachname$ = k1NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K1Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K2geburtstag.GAdrDat$ > 0 AND k2geburtstag.GAdrDat$ >= tagvon% AND k2geburtstag.GAdrDat$ <= tagbis% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K2Name.GAdrDat$
           nachname$ = k2NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K2Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K3geburtstag.GAdrDat$ > 0 AND k3geburtstag.GAdrDat$ >= tagvon% AND k3geburtstag.GAdrDat$ <= tagbis% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K3Name.GAdrDat$
           nachname$ = k3NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K3Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K4geburtstag.GAdrDat$ > 0 AND k4geburtstag.GAdrDat$ >= tagvon% AND k4geburtstag.GAdrDat$ <= tagbis% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K4Name.GAdrDat$
           nachname$ = k4NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K4Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF EGgeburtstag.GAdrDat$ > 0 AND EGgeburtstag.GAdrDat$ >= tagvon% AND EGgeburtstag.GAdrDat$ <= tagbis% THEN 
           anrede$ = EGAnrede.GAdrDat$
           titel$ = ""
           nachname$ = EGNachname.GAdrDat$
           vorname$ = EGvorname.GAdrDat$
           gebdat% = EGGeburtstag.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 7
         nextmonat% = mon1%
         IF nextmonat% = 13 THEN nextmonat% = 1
         mont% = MONTH (geburtstag.GAdrDat$)
         IF geburtstag.GAdrDat$ > 0 AND MONTH (geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = anrede.GAdrDat$
           titel$ = titel.GAdrDat$
           nachname$ = nachname.GAdrDat$
           vorname$ = vorname.GAdrDat$
           gebdat% = Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K1geburtstag.GAdrDat$ > 0 AND MONTH (k1geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K1Name.GAdrDat$
           nachname$ = k1NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K1Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K2geburtstag.GAdrDat$ > 0 AND MONTH (k2geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K2Name.GAdrDat$
           nachname$ = k2NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K2Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K3geburtstag.GAdrDat$ > 0 AND MONTH (k3geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K3Name.GAdrDat$
           nachname$ = k3NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K3Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K4geburtstag.GAdrDat$ > 0 AND MONTH (k4geburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K4Name.GAdrDat$
           nachname$ = k4NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K4Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF EGgeburtstag.GAdrDat$ > 0 AND MONTH (EGgeburtstag.GAdrDat$) = nextmonat% THEN 
           anrede$ = EGAnrede.GAdrDat$
           titel$ = ""
           nachname$ = EGNachname.GAdrDat$
           vorname$ = EGvorname.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = EGGeburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 8
         REM today+Wochenende
         REM opt2a% = 3
         todaytm$ = LEFT$ ( DATE$ ( TODAY ,"0dmmyyyy"),4)
         IF DAY$ ( TODAY ) LIKE "fr*" THEN 
           todaytmb1$ = LEFT$ ( DATE$ ( TODAY + 1,"0dmmyyyy"),4)
           todaytmb2$ = LEFT$ ( DATE$ ( TODAY + 2,"0dmmyyyy"),4)
 
         END IF 
         IF geburtstag.GAdrDat$ > 0 AND (GebDatKurz.adressen = todaytm$ OR GebDatKurz.adressen = todaytmb1$ OR GebDatKurz.adressen = todaytmb2$) THEN 
           anrede$ = anrede.GAdrDat$
           titel$ = titel.GAdrDat$
           nachname$ = nachname.GAdrDat$
           vorname$ = vorname.GAdrDat$
           gebdat% = Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K1geburtstag.GAdrDat$ > 0 AND (GebDatKurz1.adressen = todaytm$ OR GebDatKurz1.adressen = todaytmb1$ OR GebDatKurz1.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K1Name.GAdrDat$
           nachname$ = k1NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K1Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K2geburtstag.GAdrDat$ > 0 AND (GebDatKurz2.adressen = todaytm$ OR GebDatKurz2.adressen = todaytmb1$ OR GebDatKurz2.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K2Name.GAdrDat$
           nachname$ = k2NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K2Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K3geburtstag.GAdrDat$ > 0 AND (GebDatKurz3.adressen = todaytm$ OR GebDatKurz3.adressen = todaytmb1$ OR GebDatKurz3.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K3Name.GAdrDat$
           nachname$ = k3NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K3Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K4geburtstag.GAdrDat$ > 0 AND (GebDatKurz4.adressen = todaytm$ OR GebDatKurz4.adressen = todaytmb1$ OR GebDatKurz4.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K4Name.GAdrDat$
           nachname$ = k4NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K4Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF EGgeburtstag.GAdrDat$ > 0 AND (GebDatKurzEG.adressen = todaytm$ OR GebDatKurzEG.adressen = todaytmb1$ OR GebDatKurzEG.adressen = todaytmb2$) THEN 
           anrede$ = EGAnrede.GAdrDat$
           titel$ = ""
           nachname$ = EGNachname.GAdrDat$
           vorname$ = EGvorname.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = EGGeburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 9
         REM in xy Tagen
         REM opt2a% = 3
         todaytm$ = LEFT$ ( DATE$ ( TODAY + tag1%,"0dmmyyyy"),4)
         IF DAY$ ( TODAY ) LIKE "fr*" THEN 
           todaytmb1$ = LEFT$ ( DATE$ ( TODAY + tag1% + 1,"0dmmyyyy"),4)
           todaytmb2$ = LEFT$ ( DATE$ ( TODAY + tag1% + 2,"0dmmyyyy"),4)
         END IF 
         IF geburtstag.GAdrDat$ > 0 AND GebDatKurz.adressen = todaytm$ THEN 
           anrede$ = anrede.GAdrDat$
           titel$ = titel.GAdrDat$
           nachname$ = nachname.GAdrDat$
           vorname$ = vorname.GAdrDat$
           gebdat% = Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K1geburtstag.GAdrDat$ > 0 AND (GebDatKurz1.adressen = todaytm$ OR GebDatKurz1.adressen = todaytmb1$ OR GebDatKurz1.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K1Name.GAdrDat$
           nachname$ = k1NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K1Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K2geburtstag.GAdrDat$ > 0 AND (GebDatKurz2.adressen = todaytm$ OR GebDatKurz2.adressen = todaytmb1$ OR GebDatKurz2.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K2Name.GAdrDat$
           nachname$ = k2NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K2Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K3geburtstag.GAdrDat$ > 0 AND (GebDatKurz3.adressen = todaytm$ OR GebDatKurz3.adressen = todaytmb1$ OR GebDatKurz3.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K3Name.GAdrDat$
           nachname$ = k3NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K3Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF K4geburtstag.GAdrDat$ > 0 AND (GebDatKurz4.adressen = todaytm$ OR GebDatKurz4.adressen = todaytmb1$ OR GebDatKurz4.adressen = todaytmb2$) THEN 
           anrede$ = "Kind/MA von " + Nachname.GADRDat$
           titel$ = ""
           vorname$ = K4Name.GAdrDat$
           nachname$ = k4NName.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = K4Geburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
         IF EGgeburtstag.GAdrDat$ > 0 AND (GebDatKurzEG.adressen = todaytm$ OR GebDatKurzEG.adressen = todaytmb1$ OR GebDatKurzEG.adressen = todaytmb2$) THEN 
           anrede$ = EGAnrede.GAdrDat$
           titel$ = ""
           nachname$ = EGNachname.GAdrDat$
           vorname$ = EGvorname.GAdrDat$
           IF nachname$ = "" THEN nachname$ = nachname.GADRDat$
           gebdat% = EGGeburtstag.GAdrDat$
           ok% = - 1
           IF mitarb$ = "j" THEN 
             IF codema.GAdrDat$ = scodema% THEN 
               ok% = - 1
             ELSE 
               ok% = 0
             END IF 
           END IF 
           IF gasp% AND workstation% <> 0 AND ok% THEN 
             IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF GMASuperCount% > 0 AND ok% THEN 
             IF IsMASuper%(codema.GADRDat$) <> - 1 THEN ok% = 0
           END IF 
           IF NOT TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$) THEN 
             ok% = 0
           END IF 
           IF ok% = - 1 THEN 
             CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
 
     END SELECT 
endgeb120220041: 
     FILE GAdrDat$
     SELECT NEXT FILE GAdrDat$
   WEND 
   SELECT WHERE FILE GAdrDat$
   CALL Gauge(0,"")
   IF GOptGeb% > 0 AND GOptGeb% = 4 THEN 
     opt2% = 1
     opt2a% = 0
   END IF 
   IF GOptGeb% > 0 AND GOptGeb% = 3 THEN opt2% = 3
   IF opt2% = 1 THEN 
     REM 25092002 
     REM Ausgabe auf Bildschirm
     REM listart%=1 ausfÅhrliche Liste
     REM listart%=2 Kurzliste
     
     IF sort% = 1 THEN 
       wbsort$ = "Nachname"
       CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
     END IF 
     IF sort% = 2 THEN 
       wbsort$ = "QuickMaKund"
       CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
     END IF 
     IF sort% = 3 THEN 
       wbsort$ = "Gebsort"
       CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
     END IF 
 
     wbsort$ = ""
   END IF 
   IF opt2% = 2 THEN 
     adrser% = 1
     CALL SerieNeu1("ADRTEMP")
     REM 240999 Ausgabe nach dBASE
     REM FILE "adrtemp"
     REM INDEX nachname.adrtemp
     REM SELECT FIRST 
     REM EXPORT nach dBase aufrufen
     REM dir1$ = DIRECTORY 
     REM dateiname2$ = "*.dbf"
     REM REQUEST "Speichern als dBase-Datei..."," ",27,req%,dateiname2$
     REM IF req% = 1 THEN 
       REM SET STATUS "EXPORT der gewÑhlten Adressen nach: " + dateiname2$
       REM Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
       REM Superbase.Converters.SBF.SourceFile = "ADRTEMP"
       REM Superbase.Converters.SBF.Descending = 0
       REM Superbase.Converters.SBF.Merge = 0
       REM Superbase.Converters.SBF.LogErrors = 0
       REM Superbase.Converters.SBF.MultiResponse = 0
       REM Superbase.Converters.DBF.DestFormat = "dBase III+ / IV"
       REM Superbase.Converters.DBF.DestFile = dateiname2$
       REM Superbase.Converters.DBF.Convert(Superbase.Converters.SBF)
       REM DIRECTORY dir1$
       REM REMOVE FROM FILE "adrtemp"
       REM SET STATUS "EXPORT beendet!"
     REM END IF 
 
   END IF 
   IF opt2% = 3 OR opt2a% = 3 THEN 
     REM Ausgabe nach Excel
     FILE "adrtemp"
     INDEX name1.adrtemp
     SELECT FIRST 
     REM EXPORT nach EXCEL aufrufen
     dir1$ = DIRECTORY 
     dateiname2$ = "gebli.xls"
     REQUEST "Speichern als MS EXCEL..."," ",27,req%,dateiname2$
     IF req% = 1 THEN 
       SET STATUS "EXPORT der gewÑhlten Adressen nach: " + dateiname2$
       Superbase.Converters.SBF.SourceFormat = "Superbase"
       Superbase.Converters.SBF.SourceFile = "ADRTEMP"
       Superbase.Converters.SBF.Descending = 0
       Superbase.Converters.SBF.Merge = 0
       Superbase.Converters.SBF.LogErrors = 0
       Superbase.Converters.SBF.MultiResponse = 0
       Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
       Superbase.Converters.XLS.DestFile = dateiname2$
       Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
       WAIT FOR 1
       
       
       ON ERROR GOTO nana120320021
       REQUEST "Wollen Sie gleich das MS EXCEL-Dokument anzeigen lassen?","",130,req%
       IF req% = 1 THEN 
         a% = CALL ("ShellExecute",0,"open",dateiname2$,"","",1)
       END IF 
nana120320021: 
       ON ERROR GOTO ErrorHandler
       DIRECTORY dir1$
       REM REMOVE FROM FILE "adrtemp"
       SET STATUS "EXPORT beendet!"
     END IF 
   END IF 
 END IF 
gebend061196: 
 FILE GAdrDat$
 END SUB 
 
 
FUNCTION TestAdrgrSta%(sunastich$,sunagrup$,sunastat$,adrgrupjn$,adrgrupaus$,adrstatjn$,adrstataus$,adrstiaus$)
 TestAdrgrSta% = 0
 IF sunagrup$ = "" AND sunastat$ = "" AND sunastich$ = "" THEN 
   TestAdrgrSta% = - 1
   GOTO eTestAdrgrSta071020031
 END IF 
 ok% = - 1
 IF sunagrup$ <> "" THEN 
   IF adrgruppe.GADRDat$ LIKE sunagrup$ THEN 
     IF adrgrupaus$ = "j" THEN 
       ok% = 0
     END IF 
   ELSE 
     IF adrgrupaus$ <> "j" THEN 
       ok% = 0
     END IF 
   END IF 
 END IF 
 IF sunastat$ <> "" AND ok% = - 1 THEN 
   IF adrstatus.GADRDat$ LIKE sunastat$ THEN 
     IF adrstataus$ = "j" THEN 
       ok% = 0
     END IF 
   ELSE 
     IF adrstataus$ <> "j" THEN 
       ok% = 0
     END IF 
   END IF 
 END IF 
 IF sunastich$ <> "" AND ok% = - 1 THEN 
   as1$ = Stichwort.GADRDat$
   IF Stichwort.GADRDat$ LIKE sunastich$ OR Stichwort.GADRDat$ LIKE sunastich$ + "*" OR Stichwort.GADRDat$ LIKE "*" + sunastich$ + "*" THEN 
     IF adrstiaus$ = "j" THEN 
       ok% = 0
     END IF 
   ELSE 
     IF adrstiaus$ <> "j" THEN 
       ok% = 0
     END IF 
   END IF 
 END IF 
 IF ok% = - 1 THEN 
   TestAdrgrSta% = - 1
 ELSE 
   TestAdrgrSta% = 0
 END IF 
eTestAdrgrSta071020031: 
 END FUNCTION 
  
 
SUB WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
  BLANK FILE "adrtemp"
  codeadrt% = SER ("ADRTEMP",1)
  codeadrt.adrtemp = codeadrt%
  Kundennummer.adrtemp = Kundennummer.GAdrDat$
  anrede.adrtemp = anrede$
  titel.adrtemp = titel$
  ASerJN.adrtemp = ASerJN.GAdrDat$
  IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" OR LTRIM$ (anrede$) = "" THEN 
    Name2.adrtemp = Nachname$
    Name1.adrtemp = Vorname$
    REM Name3.adrtemp = Geburtsname.GAdrDat$
  ELSE 
    REM 24072000
    REM Name1.adrtemp = Nachname$
    REM Name2.adrtemp = Vorname$
    Name1.adrtemp = Nachname$
    Name2.adrtemp = Geburtsname.GAdrDat$
    zuHaenden.adrtemp = Vorname.GAdrDat$
  END IF 
  Strasse.adrtemp = Stra·e.GAdrDat$
  PLZ.adrtemp = PLZ.GAdrDat$
  Ort.adrtemp = Ort.GAdrDat$
  Land.adrtemp = Land.GAdrDat$
  Postanschrift.adrtemp = Postanschrift.GAdrDat$
  NationalitÑt.adrtemp = NationalitÑt.GAdrDat$
  Staatsangehîrig.adrtemp = Staatsangehîrig.GAdrDat$
  Land.adrtemp = Land.GAdrDat$
  Geburtstag.adrtemp = DATE$ (gebdat%,"0d.mm.yyyy")
  mon1% = MONTH (gebdat%)
  tag1% = DAY (gebdat%)
  TagMon.adrtemp = (tag1% * 100) + mon1%
  Gebsort.adrtemp = VAL ( LEFT$ ( DATE$ (gebdat%,"mm0dyy"),4))
  K1Bank.adrtemp = K1Bank.GAdrDat$
  K1BLZ.adrtemp = K1BLZ.GAdrDat$
  K1Konto.adrtemp = K1Konto.GAdrDat$
  K2Bank.adrtemp = K2Bank.GAdrDat$
  K2BLZ.adrtemp = K2BLZ.GAdrDat$
  K2Konto.adrtemp = K2Konto.GAdrDat$
  Kunde_seit.adrtemp = DATE$ (Kunde_seit.GAdrDat$,"0d.mm.yyyy")
  REM Notiz.adrtemp = Notiz.GAdrDat$
  Beruf.adrtemp = Beruf.GAdrDat$
  Hobbys.adrtemp = Hobbys.GAdrDat$
  Geschlecht.adrtemp = Geschlecht.GAdrDat$
  Familienstand.adrtemp = Familienstand.GAdrDat$
  Briefanrede.adrtemp = Briefanrede.GAdrDat$
  REM Geburtsname.adrtemp = Geburtsname.GAdrDat$
  feld1$ = "Telart"
  feld2$ = "Telnr"
  feld3$ = "FaxJn"
  codema% = codema.GAdrDat$
  IF EXISTS (codeku%,codeku.GTelDat$) THEN 
    FILE GTelDat$
    INDEX codeku.GTelDat$
    SELECT FIRST 
    SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
    abi% = 0
    WHILE codeku.GTelDat$ = codeku% AND abi% < 20 AND NOT EOF (GTelDat$)
      abi% = abi% + 1
      IF abi% < 10 THEN 
        feldart$ = feld1$ + STR$ (abi%,"9") + ".adrtemp"
        feldnum$ = feld2$ + STR$ (abi%,"9") + ".adrtemp"
        feldfax$ = feld3$ + STR$ (abi%,"9") + ".adrtemp"
      ELSE 
        feldart$ = feld1$ + STR$ (abi%,"99") + ".adrtemp"
        feldnum$ = feld2$ + STR$ (abi%,"99") + ".adrtemp"
        feldfax$ = feld3$ + STR$ (abi%,"99") + ".adrtemp"
      END IF 
      feldart$$ = art.GTelDat$
      feldnum$$ = nummer.GTelDat$
      feldfax$ = FonOderFax.GTelDat$
      SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
    WEND 
  END IF 
  IF _projekt$ LIKE "PROVIS" THEN 
    IF EXISTS (codema%,codema.maadr) THEN 
      FILE "maadr"
      INDEX codema.maadr
      SELECT FIRST 
      SELECT KEY codema% FILE "maadr" INDEX codema.maadr
      Mitarbeiter.adrtemp = TRIM$ (nachname.maadr) + ", " + TRIM$ (vorname.maadr)
      QuickMaKund.adrtemp = TRIM$ (nachname.maadr) + TRIM$ (vorname.maadr) + nachname.GAdrDat$
    END IF 
  END IF 
  FILE "adrtemp"
  STORE FILE "adrtemp"
  UNLOCK CURRENT FILE "adrtemp"
 END SUB 
 
 

 '      *********************************
 '      ** Routinen fÅr BÅromanagement **
 '      ** OFFICE V2.1                 **
 '      *********************************
 
  
 
SUB OFFICE()
 IF title$ LIKE "*FACTURA*" OR title$ LIKE "*price*" THEN 
   CALL Fehler("Funktion wird in dieser Programm-Version nicht unterstÅtzt!","")
   END SUB 
 END IF 
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   Upd$ = UCASE$ (ReadConfig$(_projekt$,"UPDATE"))
   OFFICEsub% = 0
   IF FORM <> "OFFICE" THEN 
cst3004981: 
     IF quickbar% = 1 THEN 
       IF _projekt$ = "OFFICE" OR _projekt$ = "AKTE" THEN CALL Server("OFFICEON","&Ende") ELSE CALL Server("OFFICEON","&ZurÅck")
       SET DISPLAY OFF 
     ELSE 
       
       
       IF _projekt$ = "OFFICE" OR _projekt$ = "FACTURA" OR _projekt$ = "WAWI" OR _projekt$ = "IMMAK" OR _projekt$ = "MEDIA" THEN 
         IF EXISTS (GOFFForm$ + "OFFICE.sbv") THEN 
           OPEN FORM GOFFForm$ + "OFFICE"
         ELSE 
           OPEN FORM GOFFForm$ + "OFFICE"
         END IF 
         SET HEADING title$ + " - HauptÅbersicht"
         SET STATUS "HauptÅbersicht"
         ende$ = "&Ende"
       ELSE 
         IF _projekt$ = "AKTE" THEN 
         ELSE 
           SET HEADING title$ + " - BÅromanager"
           SET STATUS "BÅromanager"
           ende$ = "&ZurÅck"
         END IF 
       END IF 
       CALL MNOFFICE()
       REM SELECT WHERE FILE GAdrDat$
       REM SELECT WHERE FILE GAkquiDat$
       MENU ON addon1%,addon2%
       FORM 
       SET DISPLAY ON 
       CALL HideStartup()
    END IF 
   END IF 
   CALL ClearKBDBuffer()
   IF MATagest$ = "TRUE" AND fir% = 0 AND upd$ <> "TRUE" AND _projekt$ = "OFFICE" THEN 
     REQUEST "Mîchten Sie Ihre Tagestermine sehen?","",130,req%
     IF req% = 1 THEN CALL TagestMA()
     fir% = 1
   END IF 
   IF Upd$ LIKE "TRUE" THEN 
     IF NOT PROGRAMFILE ("UPDATE") THEN LOAD _netpath$ + "UPDATE.SBR", NEW 
     CALL DoUpdate()
     Upd$ = UCASE$ (ReadConfig$(_projekt$,"UPDATE"))
   END IF 
   IF UCASE$ ( FORM ) <> "OFFICE" THEN GOTO cst3004981
   WAIT MOUSE OR KEY OR MENU OR FOR 600
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE OFFICEsub%
   CASE 1
     CALL ADRESSEN()
   CASE 2
     CALL MAILING()
   CASE 3
     CALL DOKallg()
   CASE 4
     termin% = 1
     CALL AKQUISE(1)
   CASE 5
     CALL SETUP()
   CASE 6
     CALL BMKurzbericht()
   CASE 7
     CALL AKTIONEN()
   END SELECT 
   CALL BMCheckMail()
 WEND 
 _formend% = 0
 END SUB 
  
 
 ' Erstellen von Kurzberichten
 ' ====================================================================
SUB BMKurzbericht()
 pfad1$ = DIRECTORY 
 IF disabled%("BERICHTE") THEN END SUB 
 IF disabled%("DATALOCK") THEN END SUB 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 IF _projekt$ LIKE "PROVIS" THEN 
   CALL DFile(3,"sparten" + _fpw$)
   CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
   CALL DFile(3,"gekond" + _fpw$)
   CALL DFile(3,"maadr" + _fpw$)
   CALL DFile(3,"kvertrag" + _fpw$)
   CALL DFile(3,"spgruppe" + _fpw$)
 END IF 
 CALL FClose("ACCESS")
 CALL FClose("ACCODE")
 CALL FClose("FAX")
 CALL FClose("KEYWORDS")
 CALL FClose("SUPERVIS")
 CALL FClose("MAIL")
 CLEAR ERRNO 
 ok% = - 1
 opt% = 2
 berdatei$ = "*.sbq"
 ON ERROR GOTO ErrBericht 
 WHILE ok%
   IF berdatei$ = "*.sbq" THEN 
     Stat$ = "kein Bericht geladen"
   ELSE 
     Stat$ = "Bericht " + FN name(berdatei$) + " geladen"
   END IF 
   CREATE DIALOG "BER",0,0,183,146,title$,"MS Sans Serif",8
   ADD DIALOG "BER",4,0,0,182,121,0,""
   ADD DIALOG "BER",9,8,9,21,21,2
   ADD DIALOG "BER",5,36,11,134,16,0,"Bitte wÑhlen Sie eine der nachfolgenden Optionen aus:"
   ADD DIALOG "BER",5,36,32,27,10,0,"Status:"
   ADD DIALOG "BER",5,65,32,106,18,0,Stat$
   ADD DIALOG "BER",3,36,57,132,11,0,"Kurzbericht bearbeiten/ausfÅhren",1,opt%
   ADD DIALOG "BER",3,36,69,132,11,0,"Kurzbericht laden",2,opt%
   ADD DIALOG "BER",3,36,81,132,11,0,"Kurzbericht speichern",3,opt%
   ADD DIALOG "BER",3,36,93,134,11,0,"Bericht nach MS Excel exportieren",4,opt%
   ADD DIALOG "BER",3,36,105,134,11,0,"Bericht nach dBase III/IV exportieren",5,opt%
   ADD DIALOG "BER",1,30,125,55,15,1,"&OK",1,1
   ADD DIALOG "BER",1,86,125,55,15,0,"&Beenden",0,0
   DIALOG "BER",req%
   REMOVE DIALOG "BER"
   IF req% = 1 THEN 
     SELECT CASE opt%
     CASE 1
       SET STATUS "Bericht bearbeiten/ausfÅhren..."
       EDIT QUERY ,ziel%%
       MOUSE OFF 
       SELECT CASE ziel%%
       CASE 1' Drucker
         ? QUERY TO PRINTER 
       CASE 2' Datei auf Platte
         dat$ = "*.asc"
         REQUEST "Bericht speichern als"," ",27,req2%,dat$
         IF req2% = 1 THEN ? QUERY TO dat$
       CASE 3' Datenbankdatei
         dat$ = "*.sbf"
         REQUEST "Dateinamen fÅr Bericht"," ",27,req2%,dat$
         
         IF RIGHT$ (dat$,4) LIKE ".sbf" THEN 
           d$ = LEFT$ (dat$, LEN (dat$) - 4)
           IF EXISTS (dat$) THEN DELETE d$ + ".*"
         ELSE 
           d$ = dat$
           IF EXISTS (dat$) THEN DELETE d$ + ".*"
         END IF 
         IF req2% = 1 THEN ? QUERY TO FILE d$
       CASE 4' Zwischenablage
         COPY QUERY 
       CASE 0,5,6' Fenster
         ? QUERY TO WINDOW ,"Kurzbericht"
       END CASE 
     CASE 2
       SET STATUS "Kurzbericht laden..."
       REQUEST "Kurzbericht laden"," ",26,req%,berdatei$
       IF req% = 1 THEN LOAD QUERY berdatei$
     CASE 3
       SET STATUS "Kurzbericht speichern..."
       REQUEST "Kurzbericht speichern als..."," ",27,req%,berdatei$
       IF req% <> 0 THEN SAVE QUERY berdatei$
     CASE 4,5
       IF opt% = 4 THEN 
         dateiname1$ = "*.xls"
         REQUEST "Speichern als MS Excel-Datei..."," ",27,req%,dateiname1$
       END IF 
       IF opt% = 5 THEN 
         dateiname2$ = "*.dbf"
         REQUEST "Speichern als dBase-Datei..."," ",27,req%,dateiname2$
       END IF 
       IF req% <> 0 THEN 
         CALL Server("LOADMESSAGE","")
         CALL Server("MESSAGE","Erstellen einer temporÑren Ausgabedatei!")
         MOUSE OFF 
         dat$ = "tempfile"
         IF EXISTS (dat$ + ".sbf") THEN DELETE dat$ + ".*"
         SET STATUS "Erstellen einer temporÑren Ausgabedatei!"
         ? QUERY TO FILE dat$
         IF opt% = 4 THEN 
           msg$ = "öbergabe der Daten an die MS Excel-Datei!"
           SET STATUS msg$
           CALL Server("MESSAGE",msg$)
           REM EXPORT FILE dat$ TO dateiname1$ USING LABELS 
           Superbase.Converters.SBF.SourceFormat = "Superbase"
           Superbase.Converters.SBF.SourceFile = "TEMPFILE"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = dateiname1$
           Superbase.Converters.XLS.StartRow = 2
           Superbase.Converters.XLS.StartCol = 1
           Superbase.Converters.XLS.EndRow = - 1
           Superbase.Converters.XLS.EndCol = - 1
           Superbase.Converters.XLS.UseLabels = - 1
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
         END IF 
         IF opt% = 5 THEN 
           msg$ = "öbergabe der Daten an die dBASE III/IV-Datei!"
           SET STATUS msg$
           CALL Server("MESSAGE",msg$)
           REM EXPORT FILE dat$ TO dateiname2$ USING "3"
           Superbase.Converters.SBF.SourceFormat = "Superbase"
           Superbase.Converters.SBF.SourceFile = "TEMPFILE"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.DBF.DestFormat = "dBase III+ / IV"
           Superbase.Converters.DBF.DestFile = dateiname2$
           Superbase.Converters.DBF.Convert(Superbase.Converters.SBF)
         END IF 
         CALL Server("UNLOADMESSAGE","")
       END IF 
       IF OPEN ("TEMPFILE") THEN CLOSE FILE "TEMPFILE"
       dat$ = "tempfile"
       IF EXISTS (dat$ + ".sbf") THEN DELETE dat$ + ".*"
     END SELECT 
     SET STATUS "Bereit"
     MOUSE ON 
   ELSE 
     ok% = 0
   END IF 
   GOTO ErrBericht1 
 
ErrBericht: 
 ok% = 0
 CALL Fehler("Bei der Erstellung des Berichtes ist ein Fehler aufgetreten!","PrÅfen Sie, ob sie Felder mit gleichem Namen exportieren, wenn ja benennen Sie diese Åber den Button Eigenschaften um!")
 ON ERROR GOTO ErrorHandler
ErrBericht1: 
 WEND 
 ON ERROR GOTO ErrorHandler
 REM CALL Server("UNLOADMESSAGE","")
 CALL DFile(2,"supervis" + _fpw$)
 MOUSE ON 
 DIRECTORY pfad1$
 SET STATUS "Bereit"
 END SUB 
 
  
SUB FClose(Datei$)
 IF OPEN (datei$) THEN CLOSE FILE datei$
 END SUB 
 
 
 
 ' QBE
 ' ====================================================================
 
SUB BMQBE()
 CALL DFile(2,"OFFICE\FAX" + _fpw$)
 CALL DFile(2,"OFFICE\mail" + _fpw$)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CLEAR ERRNO 
 IF FN sys(4) = 3 OR FN sys(4) = 2 THEN 
   CALL Fehler("Diese Funktion steht innerhalb des","RUNTIME-Systems nicht zur VerfÅgung!")
 ELSE 
   EDIT QBE QUERY 
   IF ERRNO <> 11 THEN 
     ON ERROR GOTO ErrQBE
     ? QBE QUERY TO ASK 
ErrQBE: 
     ON ERROR GOTO ErrorHandler
   END IF 
 END IF 
 END SUB 
 

 '      *************************
 '      ** Formular "AKTIONEN" **
 '      *************************
 '
  
SUB AKTIONEN()
 IF disabled%("AKTIONEN") THEN END SUB 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 MOUSE OFF 
 _formend% = 0
 SET STATUS "Bereit"
 AKsub% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   AKsub% = 0
   IF FORM <> "AKTIONEN" THEN 
     SET HEADING title$ + " - Aktionen"
     IF EXISTS (GOFFForm$ + "AKTIONEN.sbv") THEN 
       OPEN FORM GOFFForm$ + "AKTIONEN"
     ELSE 
       OPEN FORM GOFFForm$ + "AKTIONEN"
     END IF 
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\Aktionen.pdf"
     SET STATUS "Aktionen"
     CALL MNAKTIONEN()
     CALL AKIntro()
     SET DISPLAY ON 
   END IF 
   MENU ON 
   MOUSE ON 
   FILE "aktionen"
   SET STATUS "Bereit"
   CALL AKUpdate()
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE AKsub%
   CASE 1
     REM -- Auflistung aller Termine
     IF gasp% AND workstation% <> 0 THEN 
       CALL Fehler("Sorry, diese Funktion steht fÅr externe BÅros nicht zur VerfÅgung!!!","Gehen Sie bitte Åber die Kundenmaske in die einzelnen Termine!")
     ELSE 
       CALL AKTermine()
     END IF 
   CASE 2
     REM -- Auflistung aller Kunden
     IF gasp% AND workstation% <> 0 THEN 
       CALL Fehler("Sorry, diese Funktion steht fÅr externe BÅros nicht zur VerfÅgung!!!","Gehen Sie bitte Åber die Kundenmaske in die einzelnen Termine!")
     ELSE 
       CALL AKKunden()
     END IF 
   CASE 3
     REM -- alle Termine als erledigt kennzeichnen
   CASE 4
     REM -- allgemeine Auswertung
   CASE 5
     REM -- alle Dokumente auflisten
   CASE 6
     IF gasp% AND workstation% <> 0 THEN 
       CALL Fehler("Sorry, diese Funktion steht fÅr externe BÅros nicht zur VerfÅgung!!!","")
     ELSE 
       CALL AKQUISE(3)
     END IF 
   CASE 99
     SELECT CASE PAGE 
     CASE 1
       MENU OFF 
       CALL ButDesabled()
       MOUSE ON 
       ENTER Bezeichnung.aktionen,0
       CALL ButEnabled()
       MENU ON 
     END SELECT 
   END SELECT 
 WEND 
 cuak% = 0
 IF FileChanged%("aktionen") = 1 THEN CALL FStore("aktionen")
 _formend% = 0
 END SUB 
  
 
 ' Aktionen-Intro
 ' ======================================================================
 
SUB AKIntro()
 MOUSE OFF 
 FILE "aktionen"
 INDEX Bezeichnung.aktionen
 IF cuak% <> 0 THEN 
   SELECT KEY cuak% FILE "aktionen" INDEX codeak.aktionen
   SET INDEX Bezeichnung.aktionen
 ELSE 
   SELECT FIRST 
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' AKTIONEN Formular updaten
 ' ======================================================================
 
SUB AKUpdate()
 _cuak% = CodeAK.AKTIONEN
 SET INDEX Bezeichnung.AKTIONEN
 INDEX Bezeichnung.AKTIONEN
 IF LEN (MemberOf.AKTIONEN) <= 6 THEN 
   akvorg$ = "<keine Zuordnung>"
 ELSE 
   scode% = VAL ( MID$ (MemberOf.AKTIONEN, LEN (MemberOf.AKTIONEN) - 11,6))
   SELECT KEY scode% FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
   akvorg$ = Bezeichnung.AKTIONEN
 END IF 
 SELECT KEY _cuak% FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
 FORM 
 END SUB 
 
 ' Aktion neu
 ' ======================================================================
 
SUB AKNeu()
 IF disabled%("AKNEU") THEN END SUB 
 FILE "aktionen"
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 CodeAK.aktionen = SER ("aktionen",1)
 CodeAK% = CodeAK.aktionen
 Bezeichnung.Aktionen = "NEU"
 STORE FILE "Aktionen"
 SELECT KEY codeak% LOCK FILE "aktionen" INDEX codeak.aktionen
 AKsub% = 99
 FORM 
 END SUB 
 
 
 ' nÑchste Aktion
 ' ======================================================================
 
SUB AKNext()
 FILE "aktionen"
 SET INDEX Bezeichnung.aktionen
 INDEX Bezeichnung.aktionen
 CALL PSelectNext()
 FORM 
 END SUB 
 
  
 ' FORM "AKTIONEN" - Aktion auswÑhlen
 ' ======================================================================
 
SUB AKVorg()
 _cuak% = CodeAK.AKTIONEN
 a% = AKSelect%(MemberOf.AKTIONEN)
 IF a% <> 0 THEN 
   MOUSE OFF 
   SELECT KEY a% FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
   MemberOf$ = MemberOf.AKTIONEN
   SELECT KEY _cuak% LOCK FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
   MemberOf.AKTIONEN = MemberOf$ + STR$ (CodeAK.AKTIONEN,"000000")
   CALL FStore("AKTIONEN")
   CALL WriteConfig("OFFICE","UpdAkquise","TRUE")
   CALL AKAQUpd()
 END IF 
 SELECT KEY _cuak% FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
 FORM 
 MOUSE ON 
 END SUB 
 
 ' Aufforderung zum Update der Akquisedatei
 ' ======================================================================
 
SUB AKAQUpd()
 CREATE DIALOG "AKINFO",0,0,218,139,title$,"MS Sans Serif",8
 ADD DIALOG "AKINFO",9,5,6,24,22,1
 ADD DIALOG "AKINFO",5,34,8,174,20,0,"Die énderung der Struktur der Aktionsgruppen erfordert eine Reorganisation der Termindatei."
 ADD DIALOG "AKINFO",5,33,30,173,24,0,"Sie kînnen die Reorganisation entweder sofort oder erst nach Abschlu· aller énderungen der Aktionsgruppen durchfÅhren."
 ADD DIALOG "AKINFO",5,34,59,172,18,0,"Der Zugriff auf die Terminverwaltung ist erst nach Abschlu· der Reorganisation wieder mîglich."
 ADD DIALOG "AKINFO",5,34,86,173,13,0,"Wann wollen Sie die Reorganisation durchfÅhren?"
 ADD DIALOG "AKINFO",1,116,112,55,15,0,"s&pÑter",0,0
 ADD DIALOG "AKINFO",1,54,112,52,15,1,"&sofort",1,1
 DIALOG "AKINFO",req%
 REMOVE DIALOG "AKINFO"
 IF req% = 1 THEN CALL AQFileUpdate()
 END SUB 
 
 
 ' Akquise-Datei nach énderung von AKTIONEN.SBF anpassen
 ' ======================================================================
 
SUB AQFileUpdate()
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 stime% = NOW 
 MOUSE OFF 
 FILE GAkquiDat$
 INDEX CodeAQ.GAkquiDat$
 SELECT FIRST LOCK 
 fmax% = RECCOUNT (GAkquiDat$)
 cp% = 0
 lp% = 0
 cr% = 0
 WHILE NOT EOF (GAkquiDat$)
   cr% = cr% + 1
   cp% = INT (100 / fmax% * cr%)
   IF lp% <> cp% THEN 
     lp% = cp%
     SET STATUS "Verarbeitung: " + LTRIM$ ( STR$ (lp%,"9999")) + "%"
   END IF 
   SELECT KEY CodeAK.GAkquiDat$ FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
   MemberOf.GAkquiDat$ = MemberOf.AKTIONEN
   IF Workstation% > 0 THEN Workstation.GAkquiDat$ = Workstation%
   IF Workstation% > 0 THEN QWoNo.GAkquiDat$ = STR$ (Workstation%,"000000") + STR$ (codeAQ.GAkquiDat$,"000000")
   RecStatus.GAkquiDat$ = "c"
   STORE FILE GAkquiDat$
   UNLOCK CURRENT FILE GAkquiDat$
   UNLOCK FILE GAkquiDat$
   SELECT NEXT LOCK FILE GAkquiDat$ INDEX CodeAQ.GAkquiDat$
 WEND 
 SET STATUS "Bereit"
 ftime% = NOW 
 REQUEST "Start: " + TIME$ (stime%,"hh:mm:ss") + ", Ende: " + TIME$ (ftime%,"hh:mm:ss") + ", Dauer: " + TIME$ (ftime% - stime%,"hh:mm:ss"),"",100
 CALL WriteConfig("OFFICE","UpdAkquise","FALSE")
 MOUSE ON 
 END SUB 
 
 
 ' Aktion auswÑhlen
 ' ======================================================================
  
FUNCTION AKSelect%(MemberOf$)
 _MemberOf$ = MemberOf$
 cfile$ = FILE 
 FILE "AKTIONEN"
 _cuak% = CodeAK.AKTIONEN
 cindex$ = INDEX 
 DIM Liste$( RECCOUNT ("AKTIONEN"))
 ok% = 0
 WHILE ok% = 0
   INDEX MemberOf
   SELECT FIRST 
   IF _MemberOf$ <> "" THEN 
     Liste$(0) = ".."
     a% = 1
   ELSE 
     a% = 0
   END IF 
   msg$ = "Bitte wÑhlen Sie eine Aktion aus."
   IF _MemberOf$ = "" THEN 
     _MemberOf$ = "*"
     msg$ = CHR$ (13) + msg$
     butofs% = 64
   ELSE 
     msg$ = msg$ + CHR$ (13) + "Um weitere Åbergeordnete Aktionen einzublenden, drÅcken Sie bitte die SchaltflÑche " + CHR$ (34) + "Obergruppen" + CHR$ (34) + "."
     butofs% = 92
   END IF 
   WHILE NOT EOF ("AKTIONEN")
     IF MemberOf.AKTIONEN LIKE _MemberOf$ + "*" THEN 
       IF LEN (_MemberOf$) < 6 THEN 
         space% = LEN (MemberOf) - 6
       ELSE 
         space% = LEN (MemberOf) - LEN (_memberOf$)
       END IF 
       IF space% < 1 THEN space% = 1
       Liste$(a%) = SPACE$ (space%) + Bezeichnung.aktionen + SPACE$ (150) + STR$ (CodeAK.aktionen,"000000")
       a% = a% + 1
     END IF 
     SELECT NEXT 
   WEND 
   CREATE DIALOG "TERLISTE",0,0,323,214,title$,"MS Sans Serif",8
   ADD DIALOG "TERLISTE",4,0,0,319,190,0,""
   ADD DIALOG "TERLISTE",9,8,9,22,22,2
   ADD DIALOG "TERLISTE",5,39,9,274,26,128,msg$
   ADD DIALOG "TERLISTE",7,5,41,308,137,0,2,Liste$,Auswahl$,Liste$(0)
   ADD DIALOG "TERLISTE",1,butofs% + 58,195,55,15,1,"&OK",1,1
   ADD DIALOG "TERLISTE",1,butofs% + 116,195,55,15,0,"&Abbrechen",0,0
   IF _MemberOf$ <> "*" THEN ADD DIALOG "TERLISTE",1,butofs%,195,55,15,0,"&Obergruppen",2,1
   DIALOG "TERLISTE",req%
   REMOVE DIALOG "TERLISTE"
   IF req% > 0 THEN 
     IF Auswahl$(0) = ".." OR req% = 2 THEN 
       _MemberOf$ = LEFT$ (_MemberOf$, LEN (_MemberOf$) - 6)
     ELSE 
       AKSelect% = VAL ( RIGHT$ (Auswahl$(0),6))
       ok% = 1
     END IF 
   ELSE 
     ok% = 1
     AKSelect% = 0
   END IF 
 WEND 
 SELECT KEY _cuak% FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
 INDEX cindex$$
 FILE cfile$
 END FUNCTION 
 
 
 
 
 ' Termine einer Aktion auflisten
 ' ======================================================================
 ' 22.09.94    - angepa·t an MemberOf-Strukturen
 
SUB AKTermine()
 cuak% = CodeAK.aktionen
 cMember$ = MemberOf.AKTIONEN
 REQUEST "Sollen die Untergruppen der aktuellen Aktion auch durchsucht werden?","",130,opt1%
 IF cuak% <> 1 THEN 
   MOUSE OFF 
   IF RECCOUNT (GAkquiDat$) < 23000 THEN 
     REDIM Termine$( RECCOUNT (GAkquiDat$))
   ELSE 
     REDIM Termine$(23000)
   END IF 
   REM FOR a% = 0 TO RECCOUNT (GAkquiDat$):Termine$(a%) = "":NEXT a%
   fMember$ = cMember$
   caption$ = "Terminauswahl Aktion: " + Bezeichnung.AKTIONEN
   IF opt1% = 1 THEN 
     fMember$ = cMember$ + "*"
     caption$ = caption$ + " und Unteraktionen"
   END IF 
   FILE GAkquiDat$
   INDEX MemberOf.GAkquiDat$
   SET STATUS "Setze Filter..."
   z$ = "SELECT WHERE MemberOf.GAkquiDat$ LIKE fMember$"
   EXECUTE z$
   INDEX Termin.GAkquiDat$
   SELECT FIRST 
   tfound% = 0
   SET STATUS "Durchsuche Termindatei..."
   WHILE NOT EOF (GAkquiDat$)
     Termine$(tfound%) = DATE$ (Termin.GAkquiDat$,"0d.mm.yyyy") + "; " + LEFT$ ( TRIM$ (nachname.GAkquiDat$)) + ";  " + LEFT$ ( TRIM$ (notiz.GAkquiDat$),50) + SPACE$ (120) + STR$ (CodeAQ.GAkquiDat$,"000000")
     tfound% = tfound% + 1
     SELECT NEXT FILE GAkquiDat$ INDEX Termin.GAkquiDat$
   WEND 
   Termine$(tfound%) = ""
   IF tfound% <> 0 THEN 
     CREATE DIALOG "TERLISTE",0,0,340,197,title$,"MS Sans Serif",8
     ADD DIALOG "TERLISTE",7,5,8,328,161,0,2,Termine$,Auswahl$,Termine$(0)
     ADD DIALOG "TERLISTE",1,114,174,56,16,1,"&OK",1,1
     ADD DIALOG "TERLISTE",1,174,174,56,16,0,"&Abbrechen",0,0
     SET STATUS "Bitte wÑhlen Sie einen Termin aus."
     DIALOG "TERLISTE",req%
     REMOVE DIALOG "TERLISTE"
     IF req% = 1 THEN 
       _cuaq% = VAL ( RIGHT$ (Auswahl$(0),6))
       SELECT KEY _cuaq% FILE GAkquiDat$ INDEX CodeAQ.GAkquiDat$
       cuaq% = _cuaq%
       cuak% = CodeAK.GAkquiDat$
       CALL AKQUISE(3)
       SELECT WHERE FILE GAkquiDat$
       FILE "aktionen"
     END IF 
   ELSE 
     CALL Fehler("Es wurden keine Termine gefunden!","")
   END IF 
 ELSE 
   CALL Fehler("Anzeige fÅr Termine des allgemeinen Terminkalenders nicht mîglich!","")
 END IF 
 END SUB 
 
 
 ' Kunden einer Aktion auflisten
 ' ======================================================================
 
SUB AKKunden()
 ON ERROR GOTO ErrorHandler
 IF disabled%("AKKUNDEN") THEN END SUB 
 MOUSE OFF 
 cdir$ = DIRECTORY 
 DIRECTORY _netpath$ + "OFFICE"
 cuak% = CodeAK.aktionen
 IF cuak% <> 1 THEN 
   CALL ORep("AKLIST")
   BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
   END REPORT 
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
   END FOOTING 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   ON ERROR GOTO ErrAKKUND
   SELECT ;
     WHERE CodeAK.AKTIONEN = CodeAK.GAkquiDat$ AND CodeKU.GAkquiDat$ = CodeKU.GAdrDat$ AND CodeAK.GAkquiDat$ = cuak%
     ORDER Nachname.GAdrDat$,Termin.GAkquiDat$
     TO ASK 
ErrAKKUND: 
   ON ERROR GOTO ErrorHandler
   MOUSE ON 
 ELSE 
   CALL Fehler("Ausgabe fÅr aktuelle Aktion nicht mîglich","")
 END IF 
 DIRECTORY cdir$
 END SUB 
 
 
 ' vorherige Aktion
 ' ======================================================================
 
SUB AKPrev()
 FILE "aktionen"
 SET INDEX Bezeichnung.aktionen
 INDEX Bezeichnung.aktionen
 CALL PSelectPrev()
 FORM 
 END SUB 
 
 
 ' Aktion suchen
 ' ======================================================================
 
SUB AKSuchen()
 cuak% = CodeAK.aktionen
 _cuak% = AKSelect%(MemberOf.AKTIONEN)
 IF _cuak% <> 0 THEN cuak% = _cuak%
 SELECT KEY cuak% FILE "AKTIONEN" INDEX CodeAK.aktionen
 SET INDEX Bezeichnung.aktionen
 INDEX Bezeichnung.aktionen
 FORM 
 END SUB 
 
 
 ' Aktion lîschen
 ' ======================================================================
 
SUB AKLoeschen()
 cuak% = CodeAK.AKTIONEN
 REQUEST "Aktion wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   SELECT KEY cuak% LOCK FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
   SELECT REMOVE FILE "AKTIONEN"
   MOUSE OFF 
   SET STATUS "Termine der Aktion werden gelîscht..."
   REMOVE FROM FILE GAkquiDat$ WHERE CodeAK.GAkquiDat$ = cuak%
   REM SELECT REMOVE 
   SELECT NEXT 
 END IF 
 SET STATUS "Bereit"
 MOUSE ON 
 FORM 
 END SUB 
 



 '      ****************************************
 '      ** Anschreiben / Dokumentenverwaltung **
 '      ****************************************
 
SUB DOKUMENT(Gruppe$,link%)
 IF disabled%("DOKUMENT") THEN END SUB 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKGE" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DokMA" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKKV" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SET STATUS "Dokumentenverwaltung"
 _OK% = 1
 REM 261198
 DIM Gruppe$(1)
 cfileneu$ = GDokDat$
 GDOKDAT$ = "DOKUMENT"
 CREATE DIALOG "ANSCHR",0,0,450,293,title$,"MS Sans Serif",8
 ADD DIALOG "ANSCHR",4,0,0,449,293,0,""
 ADD DIALOG "ANSCHR",9,6,14,20,22,2
 ADD DIALOG "ANSCHR",5,37,14,277,11,0,"Bitte markieren Sie die Dokumentengruppe, in der Sie arbeiten wollen und wÑhlen"
 ADD DIALOG "ANSCHR",5,37,25,276,11,0,"Sie anschlie·end die Art der Bearbeitung."
 ADD DIALOG "ANSCHR",5,38,44,28,10,0,"&Gruppe"
 ADD DIALOG "ANSCHR",7,7,54,177,229,2,2,DOKGruppen$,Gruppe$,Gruppe$
 ADD DIALOG "ANSCHR",1,193,54,250,15,0,"&neues Dokument (ohne Vorlage)",1,1
 ADD DIALOG "ANSCHR",1,193,70,250,15,0,"neues Dokument (mit &Vorlage aus allgemeiner Dokumentendatei)",2,1
 
 IF FORM LIKE "ADR*" OR FORM LIKE "DOK*" THEN ADD DIALOG "ANSCHR",1,193,86,250,15,0,"neues Dokument (Vorl.aus allg.Dokumentendatei von anderer Adresse)",4,1
 ADD DIALOG "ANSCHR",1,193,102,250,15,0,"bestehendes Dokument &bearbeiten",3,1
 IF FORM LIKE "ADR*" OR FORM LIKE "DOK*" THEN ADD DIALOG "ANSCHR",2,193,118,160,10,0,"Vorlage vom aktuellen Kunden","j","n",Kontrollfeld$
 REM 301296
 REM ADD DIALOG "ANSCHR",1,193,114,120,15,0,"Dokument &suchen",4,1
 ADD DIALOG "ANSCHR",1,193,268,250,15,0,"&Abbruch",0,0
 DIALOG "ANSCHR",req%
 REMOVE DIALOG "ANSCHR"
 DokVor$ = Kontrollfeld$
 SELECT CASE req%
 CASE 0
   adrser% = 0
   maser% = 0
   gesser% = 0
   reser% = 0
   mahnser% = 0
 CASE 1
   IF FORM LIKE "*VER*" OR FORM LIKE "*VORG*" THEN 
     Gdname$ = VS_NR.kvertrag
   END IF 
   textdatei% = DOKNeu%(0,Gruppe$(0),link%)
   REM GDokDat$ = "DOKUMENT"
   REM a$ = FILE 
   IF FILE LIKE "DOKBCK" OR FILE LIKE "DOKADRE1" THEN 
     GDokDat$ = FILE 
   ELSE 
     GDokDat$ = "DOKUMENT"
   END IF 
   IF textdatei% <> - 1 THEN CALL DOKBearbeiten(textdatei%,0)
 CASE 2
   abf$ = FORM 
   IF DokVor$ = "j" THEN 
     GDokDat$ = "DOKUMENT"
     abfo$ = FORM 
     IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR" OR FORM LIKE "DOKGES" OR FORM LIKE "DOKGESPR" OR FORM LIKE "DOKGES1" OR FORM LIKE "DOKGES2" OR FORM LIKE "DOKGES3" THEN 
       codeku% = codeku.GAdrDat$
     ELSE 
       IF FORM LIKE "VORG*" THEN 
         codeku% = codeku.vorgang
       ELSE 
         codeku% = codeku.kvertrag
       END IF 
     END IF 
     ggcodie% = GCodie%
     GCodie% = 0
     vorlage% = DOKAuswahl%(Gruppe$(0),link%,0)
     GCodie% = ggcodie%
     link% = knr%
   ELSE 
     link% = - 2
     f1fo$ = FORM 
     IF FORM LIKE "*KV*" THEN 
       ggcodie% = GCodie%
       GCodie% = 0
       codeku% = codeku.kvertrag
       vorlage% = DOKAuswahl%(Gruppe$(0),0,0)
       GCodie% = ggcodie%
     END IF 
     IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR" OR FORM LIKE "DOKGES" OR FORM LIKE "DOKGESPR" OR FORM LIKE "DOKGES1" OR FORM LIKE "DOKGES2" OR FORM LIKE "DOKGES3" OR FORM LIKE "VORGANG" THEN 
       ggcodie% = GCodie%
       GCodie% = 0
       codeku% = codeku.GAdrDat$
       vorlage% = DOKAuswahl%(Gruppe$(0),link%,0)
       link% = knr%
       GCodie% = ggcodie%
     END IF 
   END IF 
   IF vorlage% <> - 1 THEN 
     textdatei% = DOKNeu%(vorlage%,Gruppe$(0),link%)
     af$ = FORM 
     REM 17092003
     IF FORM LIKE "DOKGESKV" OR FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN 
       FILE "KVERTRAG"
       cuvt% = lfdnr.KVeRTRAG
       SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
       SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
       CALL VERTRSync()
       
     END IF 
     IF textdatei% <> - 1 THEN CALL DOKBearbeiten(textdatei%,0)
   END IF 
 CASE 3
   textdatei% = DOKAuswahl%(Gruppe$(0),link%,0)
   IF textdatei% <> - 1 THEN CALL DOKBearbeiten(textdatei%,0)
 CASE 4
   REM Dokument suchen
   cuknr% = codeku.GAdrDat$
   adr% = ADRSuche%(0)
   IF adr% <> 0 THEN 
     REM linkfield% = - 2 
     ggcodie% = GCodie%
     GCodie% = 0
     vorlage% = DOKAuswahl%(Gruppe$(0),linkfield%,adr%)
     GCodie% = ggcodie%
     IF vorlage% <> - 1 THEN 
       SELECT FORM KEY cuknr% FILE GAdrDat$ INDEX codeku.GAdrDat$
       textdatei% = DOKNeu%(vorlage%,Gruppe$(0),link%)
       IF textdatei% <> - 1 THEN CALL DOKBearbeiten(textdatei%,0)
     END IF 
     knr% = cuknr%
     link% = cuknr%
     SELECT FIRST FILE GADRDat$ INDEX codeku.GADRDat$
     SELECT KEY cuknr% FILE GADRDat$ INDEX codeku.GADRDat$
   END IF 
   adr% = cuknr%
   SELECT FORM KEY adr% FILE GAdrDat$ INDEX codeku.GAdrDat$
   cuknr% = codeku.GAdrDat$
 END SELECT 
 GDOKDAT$ = cfileneu$
 END SUB 
 
 
 ' Aufruf der allgemeinen Dokumentenverwaltung
 ' ===========================================================================
 
SUB DOKallg()
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 CALL DOKUMENT("allgemeine Schreiben",0)
 END SUB 
 
 
 
 ' Dokumenten-/Vorlagenauswahl
 ' ===========================================================================
 ' Zweck:       Auswahl eines Dokumentes zur Bearbeitung
 ' Nutzung:     x%=DOKAuswahl%(filter$,linkfield%)
 '              Åbergibt Dokumentennummer
 ' Hinweis:     bei RÅckgabewert -1 wurde die Auswahl abgebrochen
 ' ===========================================================================
 
FUNCTION DOKAuswahl%(filter$,linkfield%,t%)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SET STATUS "Dokumenten-/Vorlagenauswahl"
 cfile$ = FILE 
 _cuko% = knr%
 foo$ = FORM 
 IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR" OR FORM LIKE "DOKGES" OR FORM LIKE "DOKGESPR" OR FORM LIKE "DOKGES1" OR FORM LIKE "DOKGES2" OR FORM LIKE "DOKGES3" THEN 
   SELECT KEY knr% FILE GADRDat$ INDEX codeku.GADRDat$
 END IF 
 FILE GDokDat$
 DIM DokList$(25000)
 REM 261198-1  
 MOUSE OFF 

 SELECT WHERE FILE GDokDat$
 IF t% = 0 THEN 
   INDEX Gruppe.GDokDat$
   SELECT FIRST 
   IF filter$ <> "<ALLE DOKUMENTENGRUPPEN>" THEN 
     SELECT KEY filter$ FILE GDokDat$ INDEX Gruppe.GDokDat$
     REM SELECT WHERE Gruppe.GDokDat$ LIKE filter$
     REM SELECT FIRST 
   END IF 
 ELSE 
   INDEX Codeku.GDokdat$
   SELECT FIRST 
   SELECT KEY t% FILE GDokDat$ INDEX codeku.GDokDat$
   REM SELECT WHERE codeku.GDokDat$ = t%
   IF filter$ <> "<ALLE DOKUMENTENGRUPPEN>" THEN 
     INDEX Gruppe.GDokDat$
     SELECT FIRST 
     SELECT KEY filter$ FILE GDokDat$ INDEX Gruppe.GDokDat$
   END IF 
 END IF 
 a% = 0

 IF GCODIE% = - 1 THEN 
   CALL SearchInitDo1(GDokDat$)
 END IF 
 locktest% = MNdisabled%("DATALOCK")

 IF t% = 0 THEN 
   IF filter$ <> "<ALLE DOKUMENTENGRUPPEN>" THEN WHILE NOT EOF (GDokDat$) AND Gruppe.GDokDat$ LIKE filter$
   IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN WHILE NOT EOF (GDokDat$)
     abfo$ = FORM 
     MOUSE OFF 
     IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR" OR FORM LIKE "DOKGES" OR FORM LIKE "DOKGESPR" OR FORM LIKE "DOKGES1" OR FORM LIKE "DOKGES2" OR FORM LIKE "DOKGES3" THEN 
       IF linkfield% = - 2 THEN 
         REM IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
         REM ELSE 
           REM IF Gruppe.GDokDat$ LIKE filter$ THEN 
             IF CodeKU.GDokDat$ <> 0 THEN 
               sok% = - 1
               SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
               Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
               IF GASP% AND Workstation% > 0 THEN 
                 wks% = Workstation.GADRDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                    sok% = 0
                   END IF 
                 NEXT ii%
               ELSE 
                 sok% = - 1
               END IF 
             ELSE 
               sok% = - 1
               IF GASP% THEN 
                 IF Workstation% > 0 THEN 
                   wks% = Workstation.GDOKDAT$
                   FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                     wks% = VisOff%(ii%)
                     aa% = IsWksVisible%(wks%)
                     IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                       sok% = - 1
                       ii% = VisCount%
                     ELSE 
                       sok% = 0
                     END IF 
                   NEXT ii%
                 END IF 
               END IF 
               Name$ = "(ohne Zuordnung)"
             END IF 
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(CodeMA.GADRDat$) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1

             IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
               IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
                 IF Gund$ = "J" THEN 
                   REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                  IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                  ELSE 
                    sok% = 0
                  END IF 
                ELSE 
                  IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                  ELSE 
                    sok% = 0
                  END IF 
                END IF 
               ELSE 
                 IF Gsuna1$ <> "" THEN 
                   IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                   ELSE 
                     sok% = 0
                   END IF 
                 END IF 
                 IF Gsuna2$ <> "" THEN 
                   IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                   ELSE 
                    sok% = 0
                   END IF 
                 END IF 
               END IF 
             END IF 
             IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
             ELSE 
               IF Gruppe.GDokDat$ LIKE filter$ THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF locktest% THEN 
               IF GDokDat$ LIKE "Dokument" THEN 
                 IF codeku.GDokDat$ > 0 THEN 
                   codeku% = codeku.GDokdat$
                   SELECT FIRST FILE "Adressen" INDEX codeku.adressen
                   SELECT KEY codeku% FILE "Adressen" INDEX codeku.adressen
                   IF Sperre.adressen <> 0 AND Sperre.adressen <> GMAcodema% THEN sok% = 0
                 END IF 
               END IF 
             END IF 
             IF sok% THEN 
               DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
               IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
               a% = a% + 1
             END IF 
           REM END IF 
         REM END IF 
       ELSE 
         IF (codeku.GDokDat$ = _cuko%) THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
             Name$ = "(ohne Zuordnung)"
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
             IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
               IF Gund$ = "J" THEN 
                 REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              ELSE 
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
             ELSE 
               IF Gsuna1$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF Gsuna2$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                 ELSE 
                  sok% = 0
                 END IF 
               END IF 
             END IF 
           END IF 
           IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
           ELSE 
             IF Gruppe.GDokDat$ LIKE filter$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
       IF linkfield% = - 2 THEN 
         REM IF Gruppe.GDokDat$ LIKE filter$ THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
             Name$ = "(ohne Zuordnung)"
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
             IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
               IF Gund$ = "J" THEN 
                 REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              ELSE 
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
             ELSE 
               IF Gsuna1$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF Gsuna2$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                 ELSE 
                  sok% = 0
                 END IF 
               END IF 
             END IF 
           END IF 
           IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
           ELSE 
             IF Gruppe.GDokDat$ LIKE filter$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             a% = a% + 1
           END IF 
         REM END IF 
       ELSE 
         IF (linkfield% = 0 OR link.GDokDat$ = linkfield%) THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
             Name$ = "(ohne Zuordnung)"
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
             IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
               IF Gund$ = "J" THEN 
                 REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              ELSE 
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
             ELSE 
               IF Gsuna1$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF Gsuna2$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                 ELSE 
                  sok% = 0
                 END IF 
               END IF 
             END IF 
           END IF 
           IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
           ELSE 
             IF Gruppe.GDokDat$ LIKE filter$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             a% = a% + 1
           END IF 
           
         END IF 
       END IF 
    END IF 
    SET STATUS STR$ (a%,",99999999")
    SELECT NEXT 
  WEND 
 ELSE 
   IF filter$ <> "<ALLE DOKUMENTENGRUPPEN>" THEN WHILE NOT EOF (GDokDat$) AND Gruppe.GDokDat$ LIKE filter$
   IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN WHILE NOT EOF (GDokDat$)
     abfo$ = FORM 
     IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR" OR FORM LIKE "DOKGES" OR FORM LIKE "DOKGESPR" OR FORM LIKE "DOKGES1" OR FORM LIKE "DOKGES2" OR FORM LIKE "DOKGES3" THEN 
       IF linkfield% = - 2 THEN 
         REM IF Gruppe.GDokDat$ LIKE filter$ THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
             Name$ = "(ohne Zuordnung)"
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
             IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
               IF Gund$ = "J" THEN 
                 REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              ELSE 
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
             ELSE 
               IF Gsuna1$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF Gsuna2$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                 ELSE 
                  sok% = 0
                 END IF 
               END IF 
             END IF 
           END IF 
           IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
           ELSE 
             IF Gruppe.GDokDat$ LIKE filter$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             a% = a% + 1
           END IF 
         REM END IF 
       ELSE 
         IF (codeku.GDokDat$ = t%) THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
             Name$ = "(ohne Zuordnung)"
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
             IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
               IF Gund$ = "J" THEN 
                 REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              ELSE 
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
             ELSE 
               IF Gsuna1$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF Gsuna2$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                 ELSE 
                  sok% = 0
                 END IF 
               END IF 
             END IF 
           END IF 
           IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
           ELSE 
             IF Gruppe.GDokDat$ LIKE filter$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
       IF linkfield% = - 2 THEN 
         REM IF Gruppe.GDokDat$ LIKE filter$ THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
             Name$ = "(ohne Zuordnung)"
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
             IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
               IF Gund$ = "J" THEN 
                 REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              ELSE 
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
             ELSE 
               IF Gsuna1$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF Gsuna2$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                 ELSE 
                  sok% = 0
                 END IF 
               END IF 
             END IF 
           END IF 
           IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
           ELSE 
             IF Gruppe.GDokDat$ LIKE filter$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             a% = a% + 1
           END IF 
         REM END IF 
       ELSE 
         IF (linkfield% = 0 OR link.GDokDat$ = t%) THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             Name$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
             Name$ = "(ohne Zuordnung)"
           END IF 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
             IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
               IF Gund$ = "J" THEN 
                 REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              ELSE 
                IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
             ELSE 
               IF Gsuna1$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF Gsuna2$ <> "" THEN 
                 IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
                 ELSE 
                  sok% = 0
                 END IF 
               END IF 
             END IF 
           END IF 
           IF filter$ = "<ALLE DOKUMENTENGRUPPEN>" THEN 
           ELSE 
             IF Gruppe.GDokDat$ LIKE filter$ THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF sok% THEN 
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
    END IF 
    SET STATUS STR$ (a%,",99999999")
    SELECT NEXT 
  WEND 
 END IF 
 DOKAuswahl% = - 1
 IF a% <> 0 THEN 
   IF GCODIE% = - 1 THEN 
     c$ = "aa"
     REM CALL Fehler("","")
     req3% = CALL ("_SearchShow",c$)
     IF VAL (c$) <> 0 THEN 
       AdrSuche% = VAL (c$)
       adrfound% = VAL (c$)
       DokSuchen% = AdrSuche%
       REM IF opt1% = 3 THEN 
       GDoksu1% = AdrSuche%
       DOKAuswahl% = AdrSuche%
       cudo% = DOKAuswahl%
       REM END IF 
       MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
       ok% = 0
       SET STATUS "Dokument gefunden..."
     END IF 
   ELSE 
     CREATE DIALOG "DOK",0,0,426,304,title$,"MS Sans Serif",8
     ADD DIALOG "DOK",4,0,0,426,280,0,""
     ADD DIALOG "DOK",5,40,12,160,10,0,"Bitte wÑhlen Sie das gewÅnschte Dokument aus:"
     ADD DIALOG "DOK",9,6,14,22,22,2
     ADD DIALOG "DOK",5,40,24,160,10,0,"Bezeichnung, erstellt/bearbeitet, Adressat"
     ADD DIALOG "DOK",7,19,35,400,239,2,1,DokList$,Auswahl$
     ADD DIALOG "DOK",1,210,287,55,15,0,"&Abbrechen",0,0
     ADD DIALOG "DOK",1,154,287,55,15,1,"&OK",1,1
     DIALOG "DOK",req%
     REMOVE DIALOG "DOK"
     IF req% = 1 THEN 
       DOKAuswahl% = VAL ( RIGHT$ (Auswahl$(0),6))
       cudo% = DOKAuswahl%
     END IF 
   END IF 
 ELSE 
   MENU 4,2,0,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
   CALL Fehler("Keine Dokumente in dieser Gruppe gefunden!","")
 END IF 
 SELECT KEY _cuko% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 FILE cfile$
 END FUNCTION 
 



 REM Gibt den Docpath$ und lege das Verzeichnis an, falls es nicht da ist
FUNCTION GetDocPath$(Gruppe$)
     GetDocPath$ = ""
     docpath$ = UCASE$ (ReadConfig$("DOKUMENTE", FN ansi(Gruppe$)))
 
     pfad$ = MID$ ( UCASE$ (_netpath$),3)
     IF LEFT$ (docpath$,1) <> "#" THEN 
       l1% = 0
       l1% = LEN (pfad$)
       pos% = 0
       pos% = INSTR (docpath$,pfad$)
       IF pos% > 0 THEN 
         dateiname1$ = MID$ (docpath$,pos% + l1%)
         docpath$ = dateiname1$
         IF RIGHT$ (docpath$,1) <> "\" THEN docpath$ = docpath$ + "\"
         IF LEFT$ (docpath$,1) = "\" THEN docpath$ = MID$ (docpath$,2)
         CALL WriteConfig("DOKUMENTE", FN ansi(Gruppe$),"#" + docpath$)
       ELSE 
         t1% = INSTR (4,docpath$,"\")
         zw1$ = MID$ (docpath$,t1%)
         docpath$ = zw1$
         IF RIGHT$ (docpath$,1) <> "\" THEN docpath$ = docpath$ + "\"
         IF LEFT$ (docpath$,1) = "\" THEN docpath$ = MID$ (docpath$,2)
         CALL WriteConfig("DOKUMENTE", FN ansi(Gruppe$),"#" + docpath$)
       END IF 
 
     ELSE 
       docpath$ = MID$ (docpath$,2)
     END IF 
     IF RIGHT$ (docpath$,1) <> "\" THEN docpath$ = docpath$ + "\"
     IF LEFT$ (docpath$,1) = "\" THEN docpath$ = MID$ (docpath$,2)
     jamo$ = LEFT$ ( DATE$ ( TODAY ,"yyyymm0d"),6)
     dirtest$ = _netpath$ + docpath$ + jamo$ + "\"
     l% = LEN (dirtest$)
     dirtest$ = LEFT$ (dirtest$,l% - 1)
     ON ERROR GOTO test051020041
     MAKE DIRECTORY dirtest$
test051020041: 
     ON ERROR GOTO ErrorHandler
     GetDocPath$ = docpath$ + jamo$ + "\"
 END FUNCTION 
  
 ' Dokument neu anlegen
 ' ===========================================================================
 ' Zweck:       legt neues Dokumente an
 ' Nutzung:     x%=DOKNeu%(vorlage%,Gruppe$,Linkfield%)
 '              vorlage%        =Nummer der Vorlage in der Dokumentendatei
 ' Hinweis:     bei RÅckgabewert -1 wurde die Auswahl abgebrochen
 '              die Zieldatei hat das gleiche Format wie die Vorlage
 ' ===========================================================================
 ' 18.07.93    - Texte werden nach Gruppen abgelegt
 ' 03.11.95    - Fehlerunterbindung bei nicht gefundener Vorlage, die im Ab-
 '               schnitt [Vorlagen] definiert wurde
 
FUNCTION DOKNeu%(vorlage%,Gruppe$,Linkfield%)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 cfile$ = FILE 
 REM CALL Fehler("Test-Doku","")
 REM _WPSuffix$ = ReadINI$("SYSTEM","WPSuffix")
 IF _WPSuffix$ LIKE "leer" THEN 
   CALL Fehler("Keine Textverarbeitung ausgewÑhlt!","Bitte starten Sie Åber den Hauptbildschirm die Funktion 'Einstellungen' und wÑhlen Sie dort eine Textverarbeitung aus.")
   DOKNeu% = - 1
 ELSE 
   IF vorlage% = 0 THEN 
     _vorlage$ = ReadConfig$("VORLAGEN",Gruppe$)
     IF _vorlage$ LIKE "VorlageG.DOC" AND GBanGesFil% = - 1 THEN _vorlage$ = "VorlageF.DOC"
     IF FORM LIKE "VORG*" THEN 
       _vorlage$ = "leer"
     END IF 
     abfo$ = FORM 
     IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR" OR FORM LIKE "DOKGES" OR FORM LIKE "DOKGESPR" OR FORM LIKE "DOKGES1" OR FORM LIKE "DOKGES2" OR FORM LIKE "DOKGES3" OR FORM LIKE "VORGA*" AND Gruppe$ LIKE "Dokumente an*" THEN 
       _vorlage$ = "leer"
     END IF 
 
     IF _vorlage$ <> "leer" THEN 
       REM textvorlage$ = ReadConfig$("DOKUMENTE", FN ansi(Gruppe$)) + _vorlage$
       textvorlage$ = ReadConfig$("DOKUMENTE", FN ansi(Gruppe$))
       IF LEFT$ (textvorlage$,1) = "#" THEN 
         tt1$ = MID$ (textvorlage$,2)
         textvorlage$ = UCASE$ (tt1$)
       ELSE 
         pfad$ = MID$ ( UCASE$ (_netpath$),3)
         l1% = 0
         l1% = LEN (pfad$)
         pos% = 0
         pos% = INSTR (textvorlage$,pfad$)
         IF pos% > 0 THEN 
           dateiname1$ = MID$ (textvorlage$,pos% + l1%)
           textvorlage$ = dateiname1$
           IF RIGHT$ (textvorlage$,1) <> "\" THEN textvorlage$ = textvorlage$ + "\"
           IF LEFT$ (textvorlage$,1) = "\" THEN textvorlage$ = MID$ (textvorlage$,2)
           CALL WriteConfig("DOKUMENTE", FN ansi(Gruppe$),"#" + textvorlage$)
         ELSE 
           t1% = INSTR (4,textvorlage$,"\")
           zw1$ = MID$ (textvorlage$,t1%)
           textvorlage$ = zw1$
           IF RIGHT$ (textvorlage$,1) <> "\" THEN textvorlage$ = textvorlage$ + "\"
           IF LEFT$ (textvorlage$,1) = "\" THEN textvorlage$ = MID$ (textvorlage$,2)
           CALL WriteConfig("DOKUMENTE", FN ansi(Gruppe$),"#" + textvorlage$)
         END IF 
       END IF 
       IF RIGHT$ (textvorlage$,1) <> "\" THEN textvorlage$ = textvorlage$ + "\"
       IF LEFT$ (textvorlage$,1) = "\" THEN textvorlage$ = MID$ (textvorlage$,2)
       textvorlage$ = _netpath$ + textvorlage$ + _vorlage$
       IF NOT EXISTS (textvorlage$) THEN 
         REM 081098
         REM CALL Fehler("ADRSER","")
         IF w97$ <> "TRUE" THEN 
           IF wXP$ <> "TRUE" THEN textvorlage$ = _netpath$ + "OFFICE\TEXT\0." + _WPSuffix$
         END IF 
         IF WXP$ = "TRUE" THEN 
           IF adrser% = 1 THEN 
             REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
             req% = SelSerZiel%()
             IF req% = 1 THEN 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRS1XP.DOC"
             ELSE 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRS1XPx.DOC"
             END IF 
           ELSE 
             IF gesser% = 1 THEN 
               REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
               req% = SelSerZiel%()
               IF req% = 1 THEN 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESS1XP.DOC"
               ELSE 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESS1XPx.DOC"
               END IF 
             ELSE 
               IF maser% = 1 THEN 
                 REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                 req% = SelSerZiel%()
                 IF req% = 1 THEN 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XP.DOC"
                 ELSE 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XPx.DOC"
                 END IF 
               ELSE 
                 IF reser% = 1 THEN 
                   REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                   req% = SelSerZiel%()
                   IF req% = 1 THEN 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECH1XP.DOC"
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECH1xXP.DOC"
                   END IF 
                 ELSE 
                   IF mahnSER% = 1 THEN 
                     REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                     req% = SelSerZiel%()
                     IF req% = 1 THEN 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XP.DOC"
                     ELSE 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XPX.DOC"
                     END IF 
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\0XP." + _WPSuffix$
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
         IF w97$ = "TRUE" THEN 
           IF adrser% = 1 THEN 
             REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
             req% = SelSerZiel%()
             IF req% = 1 THEN 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRSER1.DOC"
             ELSE 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRSER1x.DOC"
             END IF 
           ELSE 
             IF gesser% = 1 THEN 
               REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
               req% = SelSerZiel%()
               IF req% = 1 THEN 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESSER1.DOC"
               ELSE 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESSER1x.DOC"
               END IF 
             ELSE 
               IF maser% = 1 THEN 
                 REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                 req% = SelSerZiel%()
                 IF req% = 1 THEN 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MASER1.DOC"
                 ELSE 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MASER1x.DOC"
                 END IF 
               ELSE 
                 IF reser% = 1 THEN 
                   REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                   req% = SelSerZiel%()
                   IF req% = 1 THEN 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECHDRU1.DOC"
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECHDR1x.DOC"
                   END IF 
                 ELSE 
                   IF mahnSER% = 1 THEN 
                     REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                     req% = SelSerZiel%()
                     IF req% = 1 THEN 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MahnSer.DOC"
                     ELSE 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MahnSerX.DOC"
                     END IF 
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\0w97." + _WPSuffix$
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF w97$ <> "TRUE" THEN 
         IF wXP$ <> "TRUE" THEN textvorlage$ = _netpath$ + "OFFICE\TEXT\0." + _WPSuffix$
       END IF 
         IF wxp$ = "TRUE" THEN 
           IF adrser% = 1 THEN 
             REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
             req% = SelSerZiel%()
             IF req% = 1 THEN 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRS1XP.DOC"
             ELSE 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRS1XPx.DOC"
             END IF 
           ELSE 
             IF gesser% = 1 THEN 
               REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
               req% = SelSerZiel%()
               IF req% = 1 THEN 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESS1XP.DOC"
               ELSE 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESS1XPx.DOC"
               END IF 
             ELSE 
               IF maser% = 1 THEN 
                 REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                 req% = SelSerZiel%()
                 IF req% = 1 THEN 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XP.DOC"
                 ELSE 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XPx.DOC"
                 END IF 
               ELSE 
                 IF reser% = 1 THEN 
                   REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                   req% = SelSerZiel%()
                   IF req% = 1 THEN 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECH1XP.DOC"
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECH1XPx.DOC"
                   END IF 
                 ELSE 
                   IF mahnSER% = 1 THEN 
                     REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                     req% = SelSerZiel%()
                     IF req% = 1 THEN 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XP.DOC"
                     ELSE 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MAS1XPX.DOC"
                     END IF 
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\0XP." + _WPSuffix$
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
         IF w97$ = "TRUE" THEN 
           IF adrser% = 1 THEN 
             REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
             req% = SelSerZiel%()
             IF req% = 1 THEN 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRSER1.DOC"
             ELSE 
               textvorlage$ = _netpath$ + "OFFICE\TEXT\ADRSER1x.DOC"
             END IF 
           ELSE 
             IF gesser% = 1 THEN 
               REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
               req% = SelSerZiel%()
               IF req% = 1 THEN 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESSER1.DOC"
               ELSE 
                 textvorlage$ = _netpath$ + "OFFICE\TEXT\GESSER1x.DOC"
               END IF 
             ELSE 
               IF maser% = 1 THEN 
                 REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                 req% = SelSerZiel%()
                 IF req% = 1 THEN 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MASER1.DOC"
                 ELSE 
                   textvorlage$ = _netpath$ + "OFFICE\TEXT\MASER1x.DOC"
                 END IF 
               ELSE 
                 IF reser% = 1 THEN 
                   REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                   req% = SelSerZiel%()
                   IF req% = 1 THEN 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECHDRU1.DOC"
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\RECHDR1x.DOC"
                   END IF 
                 ELSE 
                   IF mahnSER% = 1 THEN 
                     REM REQUEST "Mîchten Sie die dBASE-Datei als Serienbrief nutzen -> JA oder","die EXCEL-Datei -> NEIN",130,req%
                     req% = SelSerZiel%()
                     IF req% = 1 THEN 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MahnSer.DOC"
                     ELSE 
                       textvorlage$ = _netpath$ + "OFFICE\TEXT\MahnSerX.DOC"
                     END IF 
                   ELSE 
                     textvorlage$ = _netpath$ + "OFFICE\TEXT\0w97." + _WPSuffix$
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
     END IF 
   ELSE 
     SELECT KEY vorlage% FILE GDokDat$ INDEX CodeDOK.GDokDat$
     REM  **FEHLER?** textvorlage$ = LEFT$ (_netdirectory$,2) + Dateiname.GDokDat$
     textvorlage$ = _netpath$ + Dateiname.GDokDat$

     REM *02022006PrÅfung, ob das Dokument geschÅtzt ist und wenn ja, dann entschlÅsseln*
     textvorlage$ = DokEncVorl$(_netpath$ + Dateiname.GDokDat$,vorlage%)
    
     REM ************************************************************************
   END IF 
   Auswahl$ = Gruppe$
   IF ProjectJN$ <> "TRUE" THEN 
     REM 21082001
     IF Gdname$ <> "" THEN dokname$ = Gdname$
     IF GMailIn% THEN 
       dokname$ = "EMAIL OUT " + GMailBetreff$
     END IF 
     CREATE DIALOG "DOKNEU",0,0,253,147,title$,"MS Sans Serif",8
     ADD DIALOG "DOKNEU",4,0,0,253,123,0,""
     ADD DIALOG "DOKNEU",9,6,14,20,21,2
     ADD DIALOG "DOKNEU",5,30,10,205,10,0,"Bitte geben Sie fÅr das neue Dokument eine Bezeichnung ein."
     ADD DIALOG "DOKNEU",5,30,20,134,10,0,"(diese kann bis zu 60 Zeichen enthalten)"
     REM ADD DIALOG "DOKNEU",5,30,35,214,10,0,"Bei Bedarf kînnen Sie auch die Zuordnung zu einer Dokumenten-"
     REM ADD DIALOG "DOKNEU",5,30,45,53,10,0,"gruppe Ñndern."
     ADD DIALOG "DOKNEU",5,30,94,79,10,0,"&Bezeichnung"
     ADD DIALOG "DOKNEU",6,30,104,208,12,0,0,dokname$,60
     ADD DIALOG "DOKNEU",5,30,54,200,20,0,"Bitte wÑhlen Sie die Dokumentengruppe aus, in der Sie das Dokument ablegen mîchten:"
     ADD DIALOG "DOKNEU",8,30,73,140,188,259,2,Auswahl$,DOKGruppen$
     ADD DIALOG "DOKNEU",1,75,127,50,15,1,"&OK",1,1
     ADD DIALOG "DOKNEU",1,130,127,50,15,0,"&Abbrechen",0,0
     DIALOG "DOKNEU",req%
     REMOVE DIALOG "DOKNEU"
     Gdname$ = ""
   ELSE 
dokprj200498:  
     IF prj11$ = "" THEN prj11$ = "Projekt"
     Auswahl$ = Gruppe$
     IF GMailIn% THEN 
       dokname$ = "EMAIL OUT " + GMailBetreff$
     END IF 
     CREATE DIALOG "DOKNEU",0,0,253,177,title$,"MS Sans Serif",8
     ADD DIALOG "DOKNEU",4,0,0,253,153,0,""
     ADD DIALOG "DOKNEU",9,6,14,20,21,2
     ADD DIALOG "DOKNEU",5,30,10,205,10,0,"Bitte geben Sie fÅr das neue Dokument eine Bezeichnung ein."
     ADD DIALOG "DOKNEU",5,30,20,134,10,0,"(diese kann bis zu 60 Zeichen enthalten)"
     ADD DIALOG "DOKNEU",5,30,35,214,10,0,"Bei Bedarf kînnen Sie auch die Zuordnung zu einer Dokumenten-"
     ADD DIALOG "DOKNEU",5,30,45,53,10,0,"gruppe Ñndern."
     ADD DIALOG "DOKNEU",5,30,94,79,10,0,"&Bezeichnung"
     ADD DIALOG "DOKNEU",6,30,104,208,12,0,0,dokname$,60
     ADD DIALOG "DOKNEU",5,30,64,65,8,0,"&Gruppe"
     ADD DIALOG "DOKNEU",8,30,73,140,48,259,2,Auswahl$,DOKGruppen$
     ADD DIALOG "DOKNEU",1,30,127,208,15,1,prj11$,2,1
     ADD DIALOG "DOKNEU",1,75,157,50,15,1,"&OK",1,1
     ADD DIALOG "DOKNEU",1,130,157,50,15,0,"&Abbrechen",0,0
     DIALOG "DOKNEU",req%
     REMOVE DIALOG "DOKNEU"
     IF req% = 2 THEN 
      nachfolger% = PRJSuche%(0)
      IF nachfolger% <> 0 THEN 
        SELECT KEY nachfolger% FILE "project" INDEX codepr.project
        codeprdok% = nachfolger%
        Projektdok$ = LEFT$ (name1.project) + "/" + LEFT$ (ort.project) + "/" + LEFT$ (strasse.project)
        prj11$ = LEFT$ (name1.project) + "/" + LEFT$ (ort.project) + "/" + LEFT$ (strasse.project)
      END IF 
       GOTO dokprj200498
     END IF 
     
   END IF 
   GzurzumVertr% = 0
   IF req% = 1 THEN 
     Gruppe$ = Auswahl$
     docpath$ = GetDocPath$(Gruppe$)
     MOUSE OFF 
     SET STATUS "Dokument wird vorbereitet..."
     ab$ = FORM 
     IF FORM LIKE "Ver*" OR FORM LIKE "VORG*" OR FORM LIKE "Ker*" OR FORM LIKE "Rer*" OR FORM LIKE "Wer*" OR FORM LIKE "DOKGESKV" THEN 
       GDokDat$ = "DOKUMENT"
       REM maskeold$ = FORM 
       REM cuvt% = lfdnr.KVERTRAG
       REM OPEN FORM GPrjForm$ + "\" + "VERTR000"
       REM CALL VERTRSync()
       REM FORM 
       GzurzumVertr% = - 1
     END IF 
     IF FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" OR FORM LIKE "VORG*" THEN 
       GDokDat$ = "DOKUMENT"
     END IF 
     IF FORM LIKE "DOKBC*" OR FORM LIKE "DOKGESBC" OR FORM LIKE "DOKGES1B" OR FORM LIKE "DOKGES2B" OR FORM LIKE "DOKGES3B" OR FORM LIKE "DOKGES4B" THEN GDokDat$ = "DOKBCK"
     neuDokDat$ = GDokDat$
     FILE GDokDat$
     BLANK FILE GDokDat$
     CodeDOK.GDokDat$ = SER (GDokDat$,1)
     codedok% = CodeDOK.GDokDat$
     dokument.GDokDat$ = dokname$
     erstellt_am.GDokDat$ = TODAY 
     letzte_Bearbeit.GDokDat$ = TODAY 
     CodeMA.GDokDat$ = GMAcodema%
     IF adrser% = 0 AND gesser% = 0 AND maser% = 0 THEN 
       CodeKU.GDokDat$ = knr%
     ELSE 
       knr% = 0
     END IF 
     SELECT KEY codema.GDokDat$ FILE "supervis" INDEX codema.supervis
     Bearbeiter.GDokDat$ = nachname.supervis
     Creator.GDokDat$ = nachname.supervis
     IF GMailIn% THEN 
       textvorlage$ = _netpath$ + "OFFICE\TEXT\0.txt"
       IF NOT EXISTS (textvorlage$) THEN 
         OPEN textvorlage$ FOR OUTPUT 
         CLOSE OUTPUT 
       END IF 
       textdatei$ = docpath$ + LTRIM$ ( STR$ (CodeDOK.GDokDat$,"999999")) + ".txt"
     ELSE 
       endung$ = GetDateiendung$(textvorlage$)
       textdatei$ = docpath$ + LTRIM$ ( STR$ (CodeDOK.GDokDat$,"999999")) + "." + endung$
     END IF 
     Dateiname.GDokDat$ = textdatei$
     andidateiname$ = Dateiname.GDokDat$
     Gruppe.GDokDat$ = Gruppe$
     link.GDokDat$ = Linkfield%
     REM link.GDokDat$ = 0
     codepr.GDokDat$ = codeprdok%
     Projekt.GDokDat$ = Projektdok$
     CALL QuickStore(GDokDat$)
     cudoc% = CodeDOK.GDokDat$
     DOKNeu% = - 1
     REM IF EXISTS (textvorlage$) THEN 
     a% = CALL ("_SBFileExists",textvorlage$)
     IF a% = - 1 THEN 
       ziel$ = _netpath$ + textdatei$
       REM COPY textvorlage$,_netpath$ + textdatei$
       a% = CALL ("_SBFileCopy",textvorlage$,ziel$)
       DOKNeu% = CodeDOK.GDokDat$
       IF knr% > 0 THEN 
         foo$ = FORM 
         IF FORM LIKE "VORGKV*" THEN 
           IF codeaq.vorgang > 0 AND EXISTS (codeaq.vorgang,codeaq.akquise) THEN 
             SELECT FIRST FILE "AKQUISE" INDEX codeaq.akquise
             SELECT KEY codeaq.vorgang LOCK FILE "AKQUISE" INDEX codeaq.akquise
             codedok.akquise = cudoc%
             CALL QuickStore("AKQUISE")
           END IF 
         ELSE 
           IF GEMAILSer% <> - 1 THEN 
             REQUEST "Eintrag in Termindatei vornehmen?","",130,raa%
             IF raa% = 1 THEN CALL ADRDokRegister(CodeDOK.GDokDat$)
           END IF 
         END IF 
         af$ = FORM 
         mache% = 0
         IF FORM LIKE "Ver*" OR FORM LIKE "VORGKV*" OR FORM LIKE "Ker*" OR FORM LIKE "Rer*" OR FORM LIKE "Wer*" OR FORM LIKE "DOKGESKV" THEN mache% = 1
         IF FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN mache% = 1
         IF mache% = 1 THEN 
           FILE "DOKKV"
           BLANK 
           CodeDOK.DOKKV = SER ("DOKKV",1)
           IF DOKNeu% = - 1 THEN DOKNeu% = CodeDOK.DOKKV
           CodeVG.DOKKV = Gcuvg%
           dokument.DOKKV = dokument.Dokument
           erstellt_am.DOKKV = TODAY 
           letzte_Bearbeit.DOKKV = TODAY 
           CodeMA.DOKKV = GMAcodema%
           CodeKU.DOKKV = lfdnr.kvertrag
           Bearbeiter.DOKKV = Bearbeiter.Dokument
           Creator.DOKKV = Creator.Dokument
           Dateiname.DOKKV = Dateiname.Dokument
           Gruppe.DOKKV = Gruppe.Dokument
           link.DOKKV = Linkfield%
           CALL QuickStore("DOKKV")
           IF GBanGE% = 1 THEN 
             FILE "DOKGE"
             BLANK 
             CodeDOK.DOKGE = SER ("DOKGE",1)
             dokument.DOKGE = dokument.Dokument
             erstellt_am.DOKGE = TODAY 
             letzte_Bearbeit.DOKGE = TODAY 
             CodeMA.DOKGE = GMAcodema%
             CodeKU.DOKGE = codege.kvertrag
             Bearbeiter.DOKGE = Bearbeiter.Dokument
             Creator.DOKGE = Creator.Dokument
             Dateiname.DOKGE = Dateiname.Dokument
             Gruppe.DOKGE = Gruppe.Dokument
             link.DOKGE = Linkfield%
             CALL QuickStore("DOKGE")
             GBanGE% = 1
           END IF 
           IF GBanMA% = 1 THEN 
             FILE "DOKMA"
             BLANK 
             CodeDOK.DOKMA = SER ("DOKGE",1)
             dokument.DOKMA = dokument.Dokument
             erstellt_am.DOkMA = TODAY 
             letzte_Bearbeit.DOKMA = TODAY 
             CodeMA.DOKMA = GMAcodema%
             CodeKU.DOKMA = codema.kvertrag
             Bearbeiter.DOKMA = Bearbeiter.Dokument
             Creator.DOKMA = Creator.Dokument
             Dateiname.DOKMA = Dateiname.Dokument
             Gruppe.DOKMA = Gruppe.Dokument
             link.DOKMA = Linkfield%
             CALL QuickStore("DOKMA")
             GBanMA% = 1
           END IF 
           REM IF FORM LIKE "DOKGESKV" OR FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN 
             REM GDokDat$ = "DOKKV"
             REM SELECT FORM KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
             REM SELECT FIRST FILE GDokDat$ INDEX codeku.GDokDat$
             REM SELECT FORM KEY knr% FILE GDokDat$ INDEX codeku.GDokDat$
             REM FORM 
           REM END IF 
            
 
         END IF 
       END IF 
       REM CALL Fehler("Test","")
       IF adrser% <> 0 AND knr% = 0 THEN 
         REQUEST "Mîchten Sie das Dokument bei allen angeschriebenen","Adressen eintragen lassen?",130,reqdoc%
         IF reqdoc% = 1 THEN 
           cfile$ = userfile$
           IF RECCOUNT (cfile$) > 0 THEN 
             SELECT FIRST FILE cfile$
             diciz% = 0
             WHILE NOT EOF (cfile$)
               MOUSE OFF 
               SET STATUS STR$ (diciz%) + " Dokumente eingetragen"
               FILE GDokDat$
               BLANK FILE GDokDat$
               CodeDOK.GDokDat$ = SER (GDokDat$,1)
               dokument.GDokDat$ = dokname$
               erstellt_am.GDokDat$ = TODAY 
               letzte_Bearbeit.GDokDat$ = TODAY 
               CodeMA.GDokDat$ = _vcodema%
               CodeKU.GDokDat$ = VAL (codeku.cfile$)
               SELECT KEY codema.GDokDat$ FILE "supervis" INDEX codema.supervis
               Bearbeiter.GDokDat$ = nachname.supervis
               Creator.GDokDat$ = nachname.supervis
               REM textdatei$ = docpath$ + LTRIM$ ( STR$ (CodeDOK.GDokDat$,"999999")) + "." + RIGHT$ (textvorlage$,3)
               Dateiname.GDokDat$ = andidateiname$
               Gruppe.GDokDat$ = Gruppe$
               link.GDokDat$ = Linkfield%
               codepr.GDokDat$ = codeprdok%
               Projekt.GDokDat$ = Projektdok$
               CALL QuickStore(GDokDat$)
               IF ASerie25%(0) > 0 THEN 
                 IF ASerie25%(diciz%) > 0 THEN 
                   codeaq% = ASerie25%(diciz%)
                   SELECT FIRST FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
                   SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
                   codedok.GAkquiDat$ = CodeDOK.GDokDat$
                   CALL QuickStore(GAkquiDat$)
                 END IF 
               END IF 
               diciz% = diciz% + 1
               SELECT NEXT FILE cfile$
             WEND 
             REDIM ASerie25%(1,1)
             REDIM ASerie25%(1)
           END IF 
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Textvorlage " + textvorlage$ + " konnte nicht gefunden werden!","Eintrag wird aus Dokumentenverwaltung entfernt.")
       SELECT KEY cudoc% LOCK FILE GDokDat$ INDEX CodeDOK.GDokDat$
       SELECT REMOVE FILE GDokDat$
       DOKNeu% = - 1
     END IF 
   ELSE 
     DOKNeu% = - 1
   END IF 
 END IF 
 MOUSE ON 
 FILE cfile$
 IF neuDokDat$ <> "" THEN FILE neuDokDat$
 IF neuDokDat$ LIKE "DOKBCK" OR neuDokDat$ LIKE "DOKADRE1" THEN 
   GDokDat$ = neuDokDat$
 ELSE 
   GDokDat$ = "DOKUMENT"
 END IF 
 END FUNCTION 
 

 REM Check ung ggf Umwandlung wenn Textvorlage geschÅtzt ist
FUNCTION DokEncVorl$(textdatei$,dok%)
 DokEncVorl$ = textdatei$
 IF dokpass1.GDokDat$ = "" THEN 
   IF dokpass.GDokDat$ <> "" THEN 
k020220060: 
     neutxtd$ = GMACodeDir$ + TIME$ ( NOW ,"hh_mm_ss") + RIGHT$ (textdatei$,4)
     IF EXISTS (neutxtd$) THEN 
       ON ERROR GOTO k180120061
       DELETE neutxtd$
       GOTO 020220062
k180120061: 
       CALL Fehler("Es konnte die temporÑre Datei: " + neutxtd$ + " nicht gelîscht werden, wahrscheinlich ist sie noch geîffnet!","")
       GOTO k020220060
     END IF 
k180120062: 
     ON ERROR GOTO ErrorHandler
     REM COPY textdatei$ TO neutxtd$
     REM CALL Fehler("hier die Decrypt aufrufen","")
     CALL DecryptDoks(dok%,neutxtd$,0)
     DokEncVorl$ = neutxtd$
     REM CALL Fehler("Es wird nur eine Kopie der Datei geîffnet, da das Original geschÅtzt wurde!","")
   END IF 
 ELSE 
   CALL Fehler("Diese Dokument kann solange nicht als Vorlage dienen, solange es durch einen persînlichen Schutz belegt ist!,"")
   DokEncVorl$ = ""
 END IF 
 END FUNCTION 


 
 ' Dokument bearbeiten
 ' ===========================================================================
 ' Zweck:       Bearbeiten eines Dokumentes aus der Dokumentendatei
 ' Nutzung:     CALL DOKBearbeiten(dok%)
 '              dok%    = Nummer des Textes in der Dokumentendatei
 ' ===========================================================================
 ' Stand: 12.09.93   
 
SUB DOKBearbeiten(dok%,x%)
 MOUSE OFF 
 IF NOT OPEN (GDokDat$) THEN CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 IF NOT OPEN (GADRDat$) THEN CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SET STATUS "Dokument bearbeiten..."
 cfile$ = FILE 
 cdir$ = DIRECTORY 
 FILE GAdrDat$
 MOUSE OFF 
 maske$ = GAdrDat$
 IF ProjectJN$ = "TRUE" THEN maske$ = "ADRPROJ"
 REM 081099
 abf$ = FORM 
 IF adrser% < 1 THEN 
   IF UCASE$ ( FORM ) = maske$ OR UCASE$ ( FORM ) LIKE "DOKGE*" THEN 
     IF FORM LIKE "DOKGESKV" OR FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN 
       FILE "KVERTRAG"
       cuvt% = lfdnr.KVeRTRAG
       SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
       SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
       CALL VERTRSync()
     ELSE 
       IF FORM LIKE "DOKGESMA" OR FORM LIKE "DOKGE1MA" OR FORM LIKE "DOKGE2MA" OR FORM LIKE "DOKGE3MA" OR FORM LIKE "DOKGE4MA" THEN 
       ELSE 
         IF x% = 0 THEN 
           IF GDokDat$ <> "DOKGE" THEN 
             Adresse$ = MakeAdr$(CodeKU.GAdrDat$, - 1,0,0)
             COPY FROM Adresse$
           END IF 
         END IF 
       END IF 
     END IF 
   END IF 
 END IF 
 SELECT KEY GMAcodema% FILE "SUPERVIS" INDEX CodeMA.supervis
 FILE GDokDat$
 SELECT KEY dok% LOCK FILE GDokDat$ INDEX CodeDOK.GDokDat$
 IF FOUND (GDokDat$) THEN 
   IF GELO% = - 1 AND ELOTRANS.GDokDat$ = 1 THEN 
     codedok% = codedok.GDokDat$
     codeku% = codeku.GDokDat$
     GELOErg% = - 1
     CALL ADRDokShowELO(codedok%,codeku%)
     REM CALL Fehler ("RÅckkehr aus ELO zur Dokumentenanzeige","Hier noch umbauen!....")
     IF GELOErg% = 0 THEN 
       GOTO e180520031
     ELSE 
       SELECT CASE GELOErg%
       CASE 1
         CALL Fehler ("Das Dokument konnt in ELO nicht gefunden werden","Es wird aus der SmartPROVIS-Dokumentenverwaltung angezeigt!")
       END SELECT 
     END IF 
   END IF 
   SELECT KEY dok% LOCK FILE GDokDat$ INDEX CodeDOK.GDokDat$
   IF dokpass.GDokDat$ = "" THEN 
     CodeMA.GDokDat$ = GMAcodema%
     Bearbeiter.GDokDat$ = Nachname.supervis
     letzte_Bearbeit.GDokDat$ = TODAY 
   END IF 
   textdatei$ = _netpath$ + Dateiname.GDokDat$
   IF dokpass.GDokDat$ <> "" THEN 
k180120060: 
     neutxtd$ = GMACodeDir$ + TIME$ ( NOW ,"hh_mm_ss") + RIGHT$ (textdatei$,4)
     IF EXISTS (neutxtd$) THEN 
       ON ERROR GOTO k180120061
       DELETE neutxtd$
       GOTO k180120062
k180120061: 
       CALL Fehler("Es konnte die temporÑre Datei: " + neutxtd$ + " nicht gelîscht werden, wahrscheinlich ist sie noch geîffnet!","")
       GOTO k180120060
     END IF 
k180120062: 
     ON ERROR GOTO ErrorHandler
     REM COPY textdatei$ TO neutxtd$
     REM CALL Fehler("hier die Decrypt aufrufen","")
     CALL DecryptDoks(dok%,neutxtd$,0)
     textdatei$ = neutxtd$
     CALL Fehler("Es wird nur eine Kopie der Datei geîffnet, da das Original geschÅtzt wurde!","")
   END IF 
   REM IF EXISTS (textdatei$) THEN 
   a% = CALL ("_SBFileExists",textdatei$)
   IF a% = - 1 THEN 
     MOUSE OFF 
     IF dokpass.GDokDat$ = "" THEN CALL MATimeStamp(GDokDat$)
     IF dokpass.GDokDat$ = "" THEN CALL QuickStore(GDokDat$)
     MOUSE OFF 
     IF X% = 0 THEN 
       codematmp% = 0
       IF GNoAbsendInfo% <> 0 THEN 
         REM CALL Fehler("Bitte wÑhlen Sie den Mitarbeiter aus,dessen Absendedaten in den Brief Åbernommen werden sollen!","")
         REQUEST "Mîchten Sie einen Mitarbeiter auswÑhlen","dessen Absendedaten in den Brief Åbernommen werden sollen?",130,req%
         IF req% = 1 THEN 
           SELECT WHERE FILE "supervis"
           codematmp% = GetSupervis%(GMACodema%)
         END IF 
       END IF 
     END IF 
     REM i% = CALL ("ShellExecute",0,"open",textdatei$,"","",1)
     CALL TextAnz(textdatei$)

       IF codematmp% > 0 THEN 
       FILE "supervis"
       INDEX codema.supervis
         SELECT FIRST FILE "supervis" INDEX codema.supervis
         SELECT KEY codematmp% FILE "supervis" INDEX codema.supervis
         REM CALL Fehler(name.supervis, STR$ (codema.supervis))
       END IF 
     IF i% <= 32 THEN 
       IF (i% = 31) OR (i% = 2) THEN 
         CALL Fehler("Das benîtigte Bearbeitungsprogramm konnte nicht gefunden werden!","Bitte wÑhlen Sie das Bearbeitungsprogramm aus.")
         WordProc$ = "*.EXE"
         REQUEST "Programm fÅr " + UCASE$ ( RIGHT$ (textdatei$,3)) + "-Dateien...","",26,req%,WordProc$
         IF req% = 1 THEN 
           CALL WordProc$ + " " + textdatei$
         END IF 
       END IF 
     ELSE 
       IF adrser% = 1 THEN 
         REM wenn serienbrief
         ON ERROR GOTO apperr0501001
         APPACTIVATE "Microsoft Word"
         GOTO apperr0501002
apperr0501001: 
         ON ERROR GOTO apperr0501002
         dokkk$ = LTRIM$ ( STR$ (dok%,"999999"))
         APPACTIVATE dokkk$
apperr0501002: 
         ON ERROR GOTO ErrorHandler
         REM DDEINIT 5,"WINWORD","SYSTEM"
         REM IF w97$ = "TRUE" THEN 
           REM DDEEXEC 5,"[ToolsMacro " + g$ + "DoMakro97.ADRSER" + g$ + ",1]"
         REM END IF 
         REM DDETERM 5
         adrser% = 0
         gesser% = 0
         maser% = 0
       END IF 
 
     END IF 
     MOUSE ON 
     IF knr% > 0 THEN 
       SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
       ab$ = FORM 
       IF UCASE$ ( FORM ) LIKE "*ERTR*" OR UCASE$ ( FORM ) LIKE "DOKGESKV" OR FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN 
         IF FORM LIKE "DOKGESKV" OR FORM LIKE "DOKGE1KV" OR FORM LIKE "DOKGE2KV" OR FORM LIKE "DOKGE3KV" OR FORM LIKE "DOKGE4KV" THEN 
           SELECT FORM KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
           SELECT FORM KEY knr% FILE GDokDat$ INDEX codeku.GDokDat$
           FORM 
         ELSE 
           FILE "kvertrag"
           SELECT FORM CURRENT 
           FORM 
         END IF 
       END IF 
       REM 04102000
       ON ERROR GOTO apperr0501003
       REM APPACTIVATE "Smart"
       APPACTIVATE ""
       GOTO apperr0501004
apperr0501003: 
       ON ERROR GOTO apperr0501004
       dokkk$ = LTRIM$ ( STR$ (dok%,"999999"))
       APPACTIVATE dokkk$
apperr0501004: 
       ON ERROR GOTO ErrorHandler
 
       REM CALL Fehler(nachname.GAdrDat$,"")
     END IF 
     IF _projekt$ LIKE "FACTURA" THEN dokfehl% = 0
   ELSE 
     CALL Fehler("Die benîtigte Dokumentendatei konnte nicht gefunden werden!","")
   END IF 
 ELSE 
   CALL Fehler("Das entsprechende Dokument konnte nicht gefunden werden!","Es wurde wahrscheinlich innerhalb der Dokumentenverwaltung gelîscht.")
   IF _projekt$ LIKE "FACTURA" THEN 
     CALL DFile(3,"MASTER" + _fpw$)
     FILE "master"
     IF EXISTS (dok%,codedok.MASTER) THEN 
       INDEX codedok.master
       SELECT FIRST 
       SELECT KEY dok% LOCK FILE "master" INDEX CodeDOK.master
       codedok.master = 0
       CALL Fehler("Beim nÑchsten Aufruf der Winwordausgabe wird ein neues Dokument angelegt!","")
       CALL QuickStore("master")
       dokfehl% = 1
     END IF 
   END IF 
 END IF 
e180520031: 
 MOUSE ON 
 FILE cfile$
 DIRECTORY cdir$
 END SUB 
   
 
 ' Adre·string erstellen
 ' ===========================================================================
 ' mode%=0      keine Abfrage der Optionen
 ' mode%=-1     Dialog mit Optionen wird angezeigt
 ' opt1%        Telefon/Fax aufnehmen Ja:-1/Nein:0
 ' opt2%        Briefanrede aufnehmen Ja:-1/Nein:0
 ' bei mode%=-1 werden opt1% und opt2% ignoriert
 
FUNCTION MakeAdr$(kn%,mode%,opt1%,opt2%)
 reqpo% = 0
 IF mode% <> 0 THEN 
   REM REQUEST "Adresse aus dem Postanschriftsfeld Åbernehmen?","",130,reqpo%
    DIM dlg AS Dialog
    DIM control AS DialogControl
    opt% = 1
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,222,119)
    dlg.Caption = "Art der Adresse"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(2,8,219,90)
    control.Caption = " WÑhlen Sie eine Option "
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(6,20,159,10)
    control.Caption = "Adresse aus dem Postanschriftsfeld nehmen"
    control.Bind("opt%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(6,32,214,9)
    control.Caption = "Adresse aus den Feldern der Adressmaske Seite 1 nehmen"
    control.Bind("opt%")
    control.ValueOn = 0

      SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
      control.Move(6,44,200,10)
      control.Caption = "Zweitanschrift verwenden"
      control.Bind("opt%")
      control.ValueOn = 2
 
      SET control = dlg.Add("DialogOptionButton4","DialogOptionButton")
      control.Move(6,56,200,10)
      control.Caption = "Drittanschrift verwenden"
      control.Bind("opt%")
      control.ValueOn = 3

      SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
      control.Move(6,68,200,10)
      control.Caption = "Viertanschrift verwenden"
      control.Bind("opt%")
      control.ValueOn = 4

      SET control = dlg.Add("DialogOptionButton6","DialogOptionButton")
      control.Move(6,80,200,10)
      control.Caption = "FÅnftanschrift verwenden"
      control.Bind("opt%")
      control.ValueOn = 5
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(59,100,43,16)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(105,100,42,16)
    control.Caption = "Abbruch"
    control.ReturnValue = 0
 
    DIALOG "Dialogname",req%
    REMOVE DIALOG "Dialogname"
    IF req% = 1 THEN 
      reqpo% = opt%
    ELSE 
      GOTO madrend250220021
    END IF 
 ELSE 
   reqpo% = 1
 END IF 
 cfile$ = FILE 
 FILE GAdrDat$
 SELECT FIRST 
 cuadr% = kn%
 SELECT KEY kn% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 lf$ = CHR$ (13) + CHR$ (10)
 
 IF anrede.GAdrDat$ LIKE "*herr*" OR anrede.GAdrDat$ LIKE "*frau*" OR anrede.GAdrDat$ LIKE "*frÑ*" OR anrede.GAdrDat$ LIKE "*fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
   IF UCASE$ ( FORM ) LIKE "MASTER" THEN 
     Adresse$ = Anrede.GAdrDat$ + lf$ + IF (Titel.GAdrDat$ <> "",Titel.GAdrDat$ + " ","") + IF (Vorname.GAdrDat$ <> "",Vorname.GAdrDat$ + " ","") + Nachname.GAdrDat$ + lf$
   ELSE 
     IF _projekt$ <> "PROVIS" THEN 
       Adresse$ = Kundennummer.GAdrDat$ + lf$ + Anrede.GAdrDat$ + lf$ + IF (Titel.GAdrDat$ <> "",Titel.GAdrDat$ + " ","") + IF (Vorname.GAdrDat$ <> "",Vorname.GAdrDat$ + " ","") + Nachname.GAdrDat$ + lf$
     ELSE 
       REM 200398
       Adresse$ = Anrede.GAdrDat$ + lf$ + IF (Titel.GAdrDat$ <> "",Titel.GAdrDat$ + " ","") + IF (Vorname.GAdrDat$ <> "",Vorname.GAdrDat$ + " ","") + Nachname.GAdrDat$ + lf$
       Adresse$ = IF (Vorname.GAdrDat$ <> "",Vorname.GAdrDat$ + " ","") + Nachname.GAdrDat$ + lf$
       anrede$ = anrede.GAdrDat$
       titela$ = titel.GAdrDat$
       IF titela$ <> "" THEN 
         Adresse$ = titela$ + " " + Adresse$
       END IF 
       IF anrede$ <> "" THEN 
         Adresse$ = anrede$ + CHR$ (13) + CHR$ (10) + Adresse$
       END IF 
     END IF 
   END IF 
 ELSE 
   IF UCASE$ ( FORM ) LIKE "MAST*" THEN 
     IF anrede.GAdrDat$ LIKE "Firma" THEN 
       Adresse$ = Nachname.GAdrDat$ + lf$
     ELSE 
       Adresse$ = anrede.GAdrDat$ + lf$ + Nachname.GAdrDat$ + lf$
     END IF 
   ELSE 
     IF _projekt$ <> "PROVIS" THEN 
       Adresse$ = Kundennummer.GAdrDat$ + lf$ + anrede.GAdrDat$ + lf$ + Nachname.GAdrDat$ + lf$
     ELSE 
       Adresse$ = Nachname.GAdrDat$ + lf$
       IF anrede.GADRDat$ <> "" THEN Adresse$ = anrede.GAdrDat$ + lf$ + Adresse$
       anred$ = anrede.GAdrDat$
         titela$ = titel.GAdrDat$
     END IF 
   END IF 
   IF Geburtsname.GAdrDat$ <> "" THEN Adresse$ = Adresse$ + Geburtsname.GAdrDat$ + lf$
   IF Vorname.GAdrDat$ <> "" THEN Adresse$ = Adresse$ + "z.Hd. " + Vorname.GAdrDat$ + lf$
 END IF 
 Adresse$ = Adresse$ + Stra·e.GAdrDat$ + lf$ + lf$ + plz.GAdrDat$ + " " + ort.GAdrDat$ + lf$ + lf$ + IF (Land.GAdrDat$ <> "",Land.GAdrDat$ + lf$ + lf$,"")
 IF reqpo% = 1 THEN Adresse$ = Postanschrift.GAdrDat$
 IF reqpo% = 2 THEN Adresse$ = Zweitanschrift.GAdrDat$
 IF reqpo% = 3 THEN Adresse$ = Drittanschrift.GAdrDat$
 IF reqpo% = 4 THEN Adresse$ = Viertanschrift.GAdrDat$
 IF reqpo% = 5 THEN Adresse$ = Fuenftanschrift.GAdrDat$
 REM IF opt1% = 1 THEN 
   CALL WriteConfig("OFFICE","AdrTelefon","1")
   codeku1% = codeku.GAdrDat$
   cfile1$ = FILE 
   IF EXISTS (codeku1%,codeku.GTelDat$) THEN 
     FILE GTelDat$
     INDEX codeku.GTelDat$
     SELECT FIRST 
     SELECT KEY codeku1% FILE GTelDat$ INDEX codeku.GTelDat$
     WHILE codeku.GTelDat$ = codeku1% AND NOT EOF (GTelDat$)
       REM 270899
       IF FonOderFax.GTelDat$ = "j" THEN 
         REM Telefon$ = Telefon$ + lf$ + art.GTelDat$ + "   " + nummer.GTelDat$
         Telefon$ = nummer.GTelDat$ + lf$
         SELECT LAST 
       END IF 
       SELECT NEXT 
     WEND 
     FILE cfile1$
   END IF 
 REM ELSE 
   REM CALL WriteConfig("OFFICE","AdrTelefon","0")
 REM END IF 
 IF Briefanrede.GAdrDat$ <> "" THEN 
   CALL WriteConfig("OFFICE","AdrBriefanrede","1")
   IF reqpo% = 0 THEN Brief$ = lf$ + lf$ + lf$ + Briefanrede.GAdrDat$ + lf$
 ELSE 
   CALL WriteConfig("OFFICE","AdrBriefanrede","0")
 END IF 
 REM Brief$ = lf$ + lf$ + lf$ + Briefanrede.GAdrDat$ + lf$
 IF mode% AND adrser% = 0 AND gesser% = 0 AND maser% = 0 THEN 
   IF reqpo% = 0 THEN Adrtemp$ = Adresse$ + Telefon$ + Brief$
   Adrtemp$ = Adresse$
   adrold$ = Adrtemp$
   REM IF VAL (ReadConfig$("OFFICE","AdrTelefon")) <> 0 THEN opt1% = 1 ELSE opt1% = 0
   REM IF VAL (ReadConfig$("OFFICE","AdrBriefanrede")) <> 0 THEN opt2% = 1 ELSE opt2% = 0
   CREATE DIALOG "MakeAdr",0,0,273,250,title$,"MS Sans Serif",8
   ADD DIALOG "MakeAdr",4,0,0,272,230,0,""
   ADD DIALOG "MakeAdr",9,3,10,21,22,2
   ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse fÅr die öbergabe an die Textverarbeitung in der Zwischenablage bereitgestellt werden soll:"
   ADD DIALOG "MakeAdr",6,30,33,236,146,68,2,Adrtemp$,1800
   ADD DIALOG "MakeAdr",2,30,192,121,13,0,"mit Faxnummer oben",1,0,opt1%
   ADD DIALOG "MakeAdr",2,30,206,121,11,0,"mit Faxnummer unten",1,0,opt5%
   IF _projekt$ LIKE "PROVIS" THEN 
     REM IF reqpo% = 0 THEN ADD DIALOG "MakeAdr",2,150,102,50,13,0,"mit Anrede",1,0,opt3%
     REM IF reqpo% = 0 THEN ADD DIALOG "MakeAdr",2,150,116,100,13,0,"mit Titel",1,0,opt4%
   END IF 
   ADD DIALOG "MakeAdr",2,160,206,110,13,0,"Briefanrede aus Postanschrift",1,0,opt3%
   IF reqpo% = 0 THEN ADD DIALOG "MakeAdr",2,160,192,110,13,0,"Briefanrede von Adresse",1,0,opt2%
   IF UCASE$ ( FORM ) LIKE GAdrDat$ THEN 
     ADD DIALOG "MakeAdr",1,73,232,55,15,1,"&Weiter",1,1
   ELSE 
     ADD DIALOG "MakeAdr",1,100,232,55,15,1,"&Weiter",1,1
   END IF 
   IF UCASE$ ( FORM ) LIKE GAdrDat$ THEN ADD DIALOG "MakeAdr",1,129,232,55,15,0,"&Abbrechen",0,0
   DIALOG "MakeAdr",req%
   REMOVE DIALOG "MakeAdr"
 END IF 
  IF adrold$ <> adrtemp$ THEN 
    adresse$ = adrtemp$
  END IF 
  IF _projekt$ LIKE "PROVIS" THEN 
    IF opt4% = 1 THEN 
      IF titela$ <> "" THEN 
        Adresse$ = titela$ + lf$ + Adresse$
      END IF 
    END IF 
    IF opt3% = 1111111 THEN 
      IF anrede$ <> "" THEN 
        Adresse$ = anrede$ + lf$ + adresse$
      END IF 
    END IF 
 END IF 
  IF opt1% > 0 OR opt5% > 0 THEN 
    REM IF VAL (ReadConfig$("OFFICE","AdrTelefon")) <> 0 THEN 
    telefon$ = GetTelno$(codeku.GADRDat$)
    IF Telefon$ <> "" THEN 
      IF opt1% = 1 THEN 
        Adresse$ = Telefon$ + lf$ + Adresse$
      ELSE 
        IF opt5% = 1 THEN 
          Adresse$ = Adresse$ + lf$ + Telefon$
        END IF 
      END IF 
    END IF 
  END IF 
  IF opt2% = 1 THEN 
    z% = VAL (ReadConfig$("OFFICE","AdrBriefanrede"))
    IF VAL (ReadConfig$("OFFICE","AdrBriefanrede")) <> 0 THEN 
      Adresse$ = Adresse$ + Brief$
    END IF 
  END IF 
  IF opt3% = 1 AND PostBriefanrede.GADRDat$ <> "" THEN 
    Adresse$ = Adresse$ + lf$ + lf$ + lf$ + lf$ + PostBriefanrede.GADRDat$
  END IF 
  MakeAdr$ = Adresse$
 SELECT KEY cuadr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 FILE cfile$
madrend250220021: 
 END FUNCTION 
  
  
  
 
 
 
 ' Dokument lîschen
 ' ===========================================================================
 ' Zweck:       lîscht Dokument aus der Dokumentendatei
 ' Nutzung:     CALL DOKLoeschen(dok%)
 '              dok%    = Nummer des Textes in der Dokumentendatei
 ' ===========================================================================
 
SUB DOKLoeschen(dok%)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 IF disabled%("DOKUMENTLôSCHEN") THEN END SUB 
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 SET STATUS "Dokument lîschen"
 cfile$ = FILE 
 FILE GDokDat$
 SELECT KEY dok% LOCK FILE GDokDat$ INDEX CodeDOK.GDokDat$
 textdatei$ = LEFT$ (_netdirectory$,2) + Dateiname.GDokDat$
 REQUEST "Wollen Sie das Dokument wirklich lîschen?","",130,req%
 IF req% = 1 THEN 
   SET STATUS "Dokument wird gelîscht..."
   SELECT REMOVE FILE GDokDat$
   a% = CALL ("_SBFileExists",textdatei$)
   IF a% = - 1 THEN 
   REM IF EXISTS (textdatei$) THEN 
     REM DELETE textdatei$
     a% = CALL ("_SBFileDelete1",ziel$)
     REQUEST "Dokument gelîscht !","",2
     SELECT CURRENT 
   END IF 
 END IF 
 FILE cfile$
 END SUB 
 
 
 ' Dokumente eines Kunden auflisten
 ' ===========================================================================
 ' Zweck:       öbersicht aller Dokumente eines Kunden
 ' Nutzung:     CALL DOKLIST(CodeKU%)
 '              CodeKU% = Nummer des Kunden
 ' ===========================================================================
 
SUB DOKLIST(CodeKU%)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 MOUSE OFF 
 SET STATUS "WARTEN: Dokumente werden gesucht..."
 DOKIND% = 0
 FILE GAkquiDat$
 INDEX CodeKU.GAkquiDat$
 SELECT FIRST 
 SELECT KEY CodeKU% FILE GAkquiDat$ INDEX CodeKU.GAkquiDat$
 WHILE (CodeKU% = CodeKU.GAkquiDat$) AND (DOKIND% < 80) AND NOT EOF (GAkquiDat$)
   IF CodeDOK.GAkquiDat$ <> 0 THEN 
     SELECT KEY CodeDOK.GAkquiDat$ FILE GDokDat$ INDEX CodeDOK.GDokDat$
     DOKU$(DOKIND%) = Dokument.GDokDat$ + " (Nr.: " + STR$ (CodeDOK.GAkquiDat$,"000000") + ")"
     DOKIND% = DOKIND% + 1
   END IF 
   SELECT NEXT FILE GAkquiDat$ INDEX CodeKU.GAkquiDat$
 WEND 
 IF DOKIND% <> 0 THEN 
   CREATE DIALOG "DOKLIST",0,0,302,152,title$,"MS Sans Serif",8
   ADD DIALOG "DOKLIST",5,5,8,223,8,0,"Auflistung aller Dokumente, die an eine Adressen geschickt wurden:"
   ADD DIALOG "DOKLIST",5,4,24,214,8,0,"Um ein bestimmtes Dokument einzusehen, wÑhlen Sie dieses aus"
   ADD DIALOG "DOKLIST",5,4,33,124,10,0,"und bestÑtigen die Auswahl mit "
   ADD DIALOG "DOKLIST",7,4,44,293,82,2,2,DOKU$,Auswahl$," "
   ADD DIALOG "DOKLIST",1,195,131,50,16,1,"&OK",1,1
   ADD DIALOG "DOKLIST",1,247,131,50,16,0,"&Abbruch",0,0
   DIALOG "DOKLIST",req%
   REMOVE DIALOG "DOKLIST"
   IF req% = 1 THEN 
     Dok% = VAL ( MID$ (Auswahl$(0), LEN (Auswahl$(0)) - 6,6))
     CALL DOKBearbeiten(Dok%,0)
   END IF 
 ELSE 
   REQUEST "Keine Dokumente gefunden!","",0
 END IF 
 MOUSE ON 
 SET STATUS "Bereit"
 END SUB 
 
 
 
 
 '      **********************************************
 '      ** Serviceroutinen fÅr Dokumentenverwaltung **
 '      **********************************************
 
SUB DOKUMENTSRV()
 IF disabled%("DOKUMENT") THEN END SUB 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 IF _projekt$ LIKE "PROV*" THEN 
   CALL DFile(3,"KVERTRAG" + _fpw$)
   CALL DFile(3,"VORGANG" + _fpw$)
   CALL DFile(3,"MAADR" + _fpw$)
 END IF 
 cudo% = CodeDOK.GDokDat$
 _formend% = 0
 SET STATUS "Bereit"
 maske$ = GDokDat$
 IF ProjectJN$ = "TRUE" THEN maske$ = "DOKEPRJ"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   DOKsub% = 0
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Kunden Dokumente"
     IF EXISTS (GOFFForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GOFFForm$ + maske$
     ELSE 
       OPEN FORM GOFFForm$ + maske$
     END IF 
     SET f = superbase.form
     GAppName$ = _netpath$ + "DOC\Dokument.pdf"
     SET STATUS "Kunden Dokumente"
     CALL MNDOKSRV()
     FILE GDokDat$
     INDEX Dokument.GDokDat$
     SELECT FORM FIRST 
     FORM 
     SET DISPLAY ON 
   END IF 
   MENU ON 
   MOUSE ON 
   dokgrup$ = Gruppe.GDokDat$
   IF projekt.GDokDat$ <> "" THEN 
     proj$ = Projekt.GDokDat$
   ELSE 
     proj$ = "<ohne Zuordnung>"
   END IF 
   f.imp.visible = - 1
   f.such.visible = - 1
   IF GASP% AND workstation% > 0 THEN 
     f.left.visible = 0
     f.right.visible = 0
   ELSE 
     f.left.visible = - 1
     f.right.visible = - 1
   END IF 
   f.doksuchen.visible = - 1
   ON ERROR GOTO dowei081220031
   IF GELO% = - 1 THEN 
     f.elo.visible = - 1
     f.elo1.visible = - 1
     f.elo2.visible = - 1
     f.elo3.visible = - 1
     f.elo4.visible = - 1
     f.elo5.visible = - 1
     f.elo6.visible = - 1
   ELSE 
     f.elo.visible = 0
     f.elo1.visible = 0
     f.elo2.visible = 0
     f.elo3.visible = 0
     f.elo4.visible = 0
     f.elo5.visible = 0
     f.elo6.visible = 0
   END IF 
dowei081220031: 
   ON ERROR GOTO dowei081220032
   IF GASP% = - 1 THEN 
     f.doksehen.visible = - 1
     f.doksehen.enabled = - 1
   ELSE 
     f.doksehen.visible = 0
     f.doksehen.enabled = 0
   END IF 
dowei081220032: 
   ON ERROR GOTO ErrorHandler 
   IF dokpass.GDokDat$ = "" THEN 
     f.dokschu.Backcolor = 3
     dokschutz$ = "Dokument gegen énderungen schÅtzen"
     f.dateiname.readonly = 0
     f.dateiname.enabled = - 1
     f.dateiname.visible = - 1
     f.textschu.visible = 0
   ELSE 
     f.dokschu.Backcolor = 2
     dokschutz$ = "Dokument wurde erfolgreich geschÅtzt"
     f.dateiname.readonly = - 1
     f.dateiname.enabled = 0
     f.dateiname.visible = 0
     f.textschu.visible = - 1
   END IF 
   CALL ClearKBDBuffer()
   FORM 
   MENU ON 
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE DOKsub%
   CASE 100
     REM Dokument einscannen
     REM CALL Fehler("Dokument einscannen","")
     codeku% = 0
     knr% = 0
     CALL ScanDok(codeku%)
   CASE 1
     CALL DokSuchen1(0,"")
 
   CASE 2
     REM Dokument lîschen
     CALL DOKVLoeschen()
   CASE 3
     IF NOT disabled%("DOKUMENTBEARB") THEN 
       MENU OFF 
       CALL DOKAuswGrup()
       MENU ON 
     END IF 
   CASE 4
     REM Import
     CALL DOKImport()
     REM cudo% = Codedok.GDokDat$
   CASE 6
     REM Dokument schÅtzen
     codedok% = codedok.GDokDat$
     IF dokpass.GDokDat$ = "" THEN 
       SELECT FIRST FILE "Stamm"
       passw$ = DokPass.stamm
       passw1$ = ""
       IF passw$ = "" THEN 
         CALL Fehler("Es wurde kein Passwort hinterlegt!","Bitte tragen Sie in Einstellungen->Firmenstammdaten->Dokumentenpasswort ein Passwort ein!")
         GOTO endpw300520061
       END IF 
       IF dokpass1.GDokDat$ = "" THEN 
         REQUEST "Soll das Dokument jetzt geschÅtzt werden?","",135,req%
         IF req% = 1 THEN 
           passw1$ = ""
           CALL EncryptDoks(codedok%,0,passw$,passw1$)
         END IF 
       END IF 
     ELSE 
       IF GDisDokSchu$ = "j" THEN 
         REQUEST "Soll der Dokumentenschutz jetzt aufgehoben werden?","",135,req%
         IF req% = 1 THEN 
           REM passw$ = DokPass.GDokDat$
           SELECT FIRST FILE "Stamm"
           passw1$ = DokPass.stamm
           REM passdenc$ = ""
           REM encpw$ = "london8474" 
           
           CREATE DIALOG "LOGIN",0,0,193,79,title$,"MS Sans Serif",8
           ADD DIALOG "LOGIN",4,0,0,193,58,0,""
           ADD DIALOG "LOGIN",9,5,11,20,22,2
           ADD DIALOG "LOGIN",5,33,11,139,9,0,"Das EntschlÅsseln ist durch "
           ADD DIALOG "LOGIN",5,33,20,68,10,0,"Passwort geschÅtzt."
           ADD DIALOG "LOGIN",5,33,31,32,12,0,"&Passwort:"
           ADD DIALOG "LOGIN",6,33,41,149,11,32,0,pw$,10
           ADD DIALOG "LOGIN",1,38,61,50,15,1,"&OK",1,1
           ADD DIALOG "LOGIN",1,89,61,50,15,0,"&Abbruch",0,0
           DIALOG "LOGIN",req%
           REMOVE DIALOG ALL 
           IF req% = 1 THEN 
             IF pw$ = passw1$ THEN 
               req% = 1
             ELSE 
               req% = 0
               xpwvers% = xpwvers% + 1
               IF xpwvers% < 3 THEN 
                 CALL Fehler("Passwort ist falsch!","")
               END IF 
               IF xpwvers% > 2 THEN 
                 REQUEST "Passwort ist falsch!","Programm wird beendet!",2
                 CALL EXIT()
               END IF 
             END IF 
           END IF 
           pw$ = ""
           REM ac% = CALL ("_DecryptString",passw$,passdenc$,encpw$)
           IF req% = 1 THEN CALL DecryptDoks(codedok%,"",0)
         END IF 
       ELSE 
         CALL Fehler("Das Dokument wurde bereits geschÅtzt","")
       END IF 
     END IF 
endpw300520061: 
     DOKsub% = 0
   CASE 99
     MENU OFF 
     ENTER Dokument.GDokDat$,0
     MENU ON 
   END SELECT 
 WEND 
 _formend% = 0
 IF FileChanged%(GDokDat$) = 1 THEN CALL FStore(GDokDat$)
 END SUB 
 
SUB DOKSRVTAB()
 CALL TableEdit(GDokDat$)
 CALL MNDOKSRV()
 MENU ON 
 END SUB 
 
 ' Dokument importieren
 ' ======================================================================
 
SUB DOKImport()
 cudok% = CodeDOK.GDokDat$
 cdir$ = DIRECTORY 
 cfile$ = FILE 
 FILE GDokDat$
 ON ERROR GOTO w230120055
 DIRECTORY GScanDir$
w230120055: 
 ON ERROR GOTO ErrorHandler 
 textvorlage$ = "*.*"
 REM REQUEST "Dokument importieren","",26,req%,textvorlage$
   IF Gcodie% = - 1 THEN 
     iniPath$ = GScanDir$
     IF inipath$ LIKE "" THEN iniPath$ = "C:\"
     REGISTER _netpath$ + "CODieLIB.dll","_SelectFile","IFFF"
     a% = CALL ("_SelectFile",texttitel$,iniPath$,textvorlage$)
     REGISTER CLEAR "_SelectFile"
     a% = CALL ("_SBFileExists",iniPath$)
     DIRECTORY cdir$
     IF a% = - 1 THEN 
       req% = 1
       REM ziel$ = GMACodeDir$ + "tt.doc"
       endung$ = GetDateiendung$(iniPath$)
       ziel$ = GMACodeDir$ + "tt." + endung$
       REM CALL Fehler(ziel$,"")
       REM IF EXISTS (ziel$) THEN DELETE ziel$
       a% = CALL ("_SBFileExists",ziel$)
       IF a% = - 1 THEN 
         a% = CALL ("_SBFileDelete1",ziel$)
       END IF 
       a% = CALL ("_SBFileCopy",iniPath$,ziel$)
       IF a% = - 1 THEN 
         REM CALL Fehler(ziel$,"Kopieren hat geklappt")
         textvorlage$ = ziel$
       ELSE 
         textvorlage$ = iniPath$
       END IF 
     END IF 
   ELSE 
     REQUEST "Dokument importieren","",26,req%,textvorlage$
     DIRECTORY cdir$
     IF req% = 1 AND EXISTS (textvorlage$) THEN 
       a% = - 1
     END IF 
   END IF 


 IF req% = 1 THEN 
   REM IF EXISTS (textvorlage$) THEN 
   a% = CALL ("_SBFileExists",textvorlage$)
   IF a% = - 1 THEN 
     Gruppe$ = "allgemeine Schreiben"
     CREATE DIALOG "DOKNEU",0,0,250,147,title$,"MS Sans Serif",8
     ADD DIALOG "DOKNEU",5,28,10,205,9,0,"Bitte geben Sie fÅr das Dokument eine Bezeichnung ein."
     ADD DIALOG "DOKNEU",9,4,12,20,21,2
     ADD DIALOG "DOKNEU",5,28,19,134,9,0,"(diese kann bis zu 60 Zeichen enthalten)"
     ADD DIALOG "DOKNEU",5,28,34,214,10,0,"Bei Bedarf kînnen Sie auch die Zuordnung zu einer Dokumenten-"
     ADD DIALOG "DOKNEU",5,28,44,53,10,0,"gruppe Ñndern."
     ADD DIALOG "DOKNEU",5,28,93,79,9,0,"&Bezeichnung"
     ADD DIALOG "DOKNEU",6,28,103,208,12,0,0,dokname$,60
     ADD DIALOG "DOKNEU",5,28,62,65,8,0,"&Gruppe"
     ADD DIALOG "DOKNEU",8,28,72,140,178,259,2,Gruppe$,DOKGruppen$
     ADD DIALOG "DOKNEU",1,80,126,49,15,1,"&OK",1,1
     ADD DIALOG "DOKNEU",1,130,126,50,14,0,"&Abbrechen",0,0
     DIALOG "DOKNEU",req%
     REMOVE DIALOG "DOKNEU"
     IF req% = 1 THEN 
       docpath$ = GetDocPath$(Gruppe$)
 
       MOUSE OFF 
       SET STATUS "Dokument wird importiert..."
       BLANK FILE GDokDat$
       CodeDOK.GDokDat$ = SER (GDokDat$,1)
       cudok% = CodeDOK.GDokDat$
       IF dokname$ <> "" THEN 
         dokument.GDokDat$ = dokname$
       ELSE 
         dokument.GDokDat$ = textvorlage$
       END IF 
       erstellt_am.GDokDat$ = TODAY 
       letzte_Bearbeit.GDokDat$ = TODAY 
       CodeMA.GDokDat$ = vcodema%
       SELECT KEY codema.GDokDat$ FILE "supervis" INDEX codema.supervis
       Bearbeiter.GDokDat$ = nachname.supervis
       Creator.GDokDat$ = nachname.supervis
       MACodeMA.GDokDat$ = vcodema%
       endung$ = GetDateiendung$(textvorlage$)
       textdatei$ = docpath$ + LTRIM$ ( STR$ (CodeDOK.GDokDat$,"99999999")) + "." + endung$
       Dateiname.GDokDat$ = textdatei$
       Gruppe.GDokDat$ = Gruppe$
       link.GDokDat$ = 0
       CALL QuickStore(GDokDat$)
       REM COPY textvorlage$,_netpath$ + textdatei$
       ziel$ = _netpath$ + textdatei$
       a% = CALL ("_SBFileCopy",textvorlage$,ziel$)
     END IF 
   ELSE 
     CALL Fehler("Dokument konnte nicht gefunden werden!","")
   END IF 
 END IF 
 SELECT FORM KEY cudok% FILE GDokDat$ INDEX CodeDOK.GDokDat$
 FORM 
 MOUSE ON 
 FILE cfile$
 DIRECTORY cdir$
 END SUB 
 
 
SUB DOKImportKU(x%)
 ON ERROR GOTO ErrorHandler
 cudok% = CodeDOK.GDokDat$
 cdir$ = DIRECTORY 
 cfile$ = FILE 
 FILE GDokDat$
 IF x% = 0 THEN 
   textvorlage$ = "*.*"
   REM REQUEST "Dokument importieren","",26,req%,textvorlage$
   IF Gcodie% = - 1 AND GoldScanVerf$ <> "TRUE" THEN 
     iniPath$ = GScanDir$
     IF inipath$ LIKE "" THEN iniPath$ = "C:\"
     
     REM REGISTER _netpath$ + "CODieLIB.dll","_SelectFile","IFFF"
     REM a% = CALL ("_SelectFile",texttitel$,iniPath$,textvorlage$)
     REM REGISTER CLEAR "_SelectFile"
     inifile$ = GMACodeDir$ + "codiesf0.ini"
     exefile$ = GMACodeDir$ + "codiesf0.exe"
     a% = CALL ("_SBFileExists",inifile$)
     IF a% = - 1 THEN 
       a% = CALL ("_SBFileDelete1",inifile$)
     END IF 
 
     a% = 1
     CALL WriteINIDes("DATA","ScanDir",GScanDir$,inifile$)
     CALL WriteINIDes("DATA","Titel","Auswahl der zu importierenden Datei",inifile$)
     CALL WriteINIDes("DATA","Filter","*.*",inifile$)
     IF EXISTS (GMACodeDir$ + "sready.ini") THEN 
       DELETE GMACodeDir$ + "sready.ini"
     END IF 
     i% = CALL ("ShellExecute",0,"open",exefile$,"","",1)
     zz% = 0
     WHILE NOT EXISTS (GMACodeDir$ + "sready.ini")
       zz% = zz% + 1
       MOUSE OFF 
       WAIT FOR 1
       IF zz% = 60 THEN 
         CALL Fehler("Irgendwas ist beim ôffnendialog schiefgegangen!","")
         GOTO w230120055
       END IF 
     WEND 
     inipath$ = ReadINIDes$("DATA","Importfile",inifile$)
     IF inipath$ = "" OR inipath$ = "leer" THEN 
       CALL Fehler("Es wurde keine zu importierende Datei ausgewÑhlt!","Der Import abgebrochen!")
       a% = 0
     ELSE 
       a% = CALL ("_SBFileExists",iniPath$)
     END IF 
     DIRECTORY cdir$
     IF a% = - 1 THEN 
       req% = 1
       endung$ = GetDateiendung$(iniPath$)
       ziel$ = GMACodeDir$ + "tt." + endung$
       REM CALL Fehler(ziel$,"")
       REM IF EXISTS (ziel$) THEN DELETE ziel$
       a% = CALL ("_SBFileExists",ziel$)
       IF a% = - 1 THEN 
         a% = CALL ("_SBFileDelete1",ziel$)
       END IF 
       a% = CALL ("_SBFileCopy",iniPath$,ziel$)
       IF a% = - 1 THEN 
         REM CALL Fehler(ziel$,"Kopieren hat geklappt")
         textvorlage$ = ziel$
       ELSE 
         textvorlage$ = iniPath$
       END IF 
     END IF 
   ELSE 
     REQUEST "Dokument importieren","",26,req%,textvorlage$
     DIRECTORY cdir$
     IF req% = 1 AND EXISTS (textvorlage$) THEN 
       a% = - 1
     END IF 
   END IF 
 
 ELSE 
   textvorlage$ = _netpath$ + "OFFICE\text\0w97.doc"
   req% = 1
 END IF 
 IF req% = 1 THEN 
   a% = CALL ("_SBFileExists",textvorlage$)
   IF a% = - 1 THEN 
     REM IF EXISTS (textvorlage$) THEN 
     dokname$ = GetDateiName$(inipath$)
     Gruppe$ = "allgemeine Schreiben"
     CREATE DIALOG "DOKNEU",0,0,250,147,title$,"MS Sans Serif",8
     ADD DIALOG "DOKNEU",5,28,10,205,9,0,"Bitte geben Sie fÅr das Dokument eine Bezeichnung ein."
     ADD DIALOG "DOKNEU",9,4,12,20,21,2
     ADD DIALOG "DOKNEU",5,28,19,134,9,0,"(diese kann bis zu 60 Zeichen enthalten)"
     ADD DIALOG "DOKNEU",5,28,34,214,10,0,"Bei Bedarf kînnen Sie auch die Zuordnung zu einer Dokumenten-"
     ADD DIALOG "DOKNEU",5,28,44,53,10,0,"gruppe Ñndern."
     ADD DIALOG "DOKNEU",5,28,93,79,9,0,"&Bezeichnung"
     ADD DIALOG "DOKNEU",6,28,103,208,12,0,0,dokname$,60
     ADD DIALOG "DOKNEU",5,28,62,65,8,0,"&Gruppe"
     ADD DIALOG "DOKNEU",8,28,72,140,178,259,2,Gruppe$,DOKGruppen$
     ADD DIALOG "DOKNEU",1,80,126,49,15,1,"&OK",1,1
     ADD DIALOG "DOKNEU",1,130,126,50,14,0,"&Abbrechen",0,0
     DIALOG "DOKNEU",req%
     REMOVE DIALOG "DOKNEU"
     IF req% = 1 THEN 
       docpath$ = GetDocPath$(Gruppe$)
       MOUSE OFF 
       SET STATUS "Dokument wird importiert..."
       BLANK FILE GDokDat$
       CodeDOK.GDokDat$ = SER (GDokDat$,1)
       cudok% = CodeDOK.GDokDat$
       IF dokname$ <> "" THEN 
         dokument.GDokDat$ = dokname$
       ELSE 
         dokument.GDokDat$ = textvorlage$
       END IF 
       erstellt_am.GDokDat$ = TODAY 
       codeku.GDokDat$ = codeku.GADRDat$
       letzte_Bearbeit.GDokDat$ = TODAY 
       CodeMA.GDokDat$ = vcodema%
       SELECT KEY codema.GDokDat$ FILE "supervis" INDEX codema.supervis
       Bearbeiter.GDokDat$ = nachname.supervis
       Creator.GDokDat$ = nachname.supervis
       MACodeMA.GDokDat$ = vcodema%
       endung$ = GetDateiendung$(textvorlage$)
       textdatei$ = docpath$ + LTRIM$ ( STR$ (CodeDOK.GDokDat$,"99999999")) + "." + endung$
       REM t1$ = MID$ (textdatei$,3, LEN (textdatei$) - 2)
       REM Dateiname.GDokDat$ = MID$ (textdatei$,3, LEN (textdatei$) - 2)
       Dateiname.GDokDat$ = textdatei$
       Gruppe.GDokDat$ = Gruppe$
       link.GDokDat$ = 0
       CALL MATimeStamp(GDokDat$)
       IF cuaq% > 0 THEN codeaq.GDokDat$ = cuaq%
       CALL QuickStore(GDokDat$)
       REM COPY textvorlage$,_netpath$ + textdatei$
       t$ = _netpath$ + textdatei$
       REM CALL Fehler(textvorlage$,t$)
       a% = CALL ("_SBFileCopy",textvorlage$,t$)
       IF cuaq% < 1 THEN 
         REQUEST "Eintrag in Termindatei vornehmen?","",130,raa%
         IF raa% = 1 THEN CALL ADRDokRegister(Cudok%)
       ELSE 
         SELECT KEY cuaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquidat$
          IF ergebnis.GAkquiDat$ <> "" THEN 
            ergebnis.GAkquiDat$ = ergebnis.GAkquiDat$ + CHR$ (13) + CHR$ (10) + DATE$ ( TODAY ,"0d.mm.yyyy") + " " + TIME$ ( NOW ,"hh.mm") + " "
          ELSE 
            ergebnis.GAkquiDat$ = ergebnis.GAkquiDat$ + DATE$ ( TODAY ) + " " + TIME$ ( NOW ,"hh.mm") + " "
          END IF 
          ergebnis.GAkquiDat$ = ergebnis.GAkquiDat$ + " - " + GMAName$ + " - Dokument importiert: " + dokname$
          STORE FILE GAkquiDat$
       END IF 
       CALL DOKBearbeiten(cudok%,1)
     END IF 
   ELSE 
     CALL Fehler("Dokument " + textvorlage$ + " konnte nicht gefunden werden!","")
   END IF 
 END IF 
 SELECT FORM KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
 SELECT FORM KEY knr% FILE GDokDat$ INDEX codeku.GDokDat$
 fo$ = UCASE$ ( FORM )
 IF fo$ = "DOKUMENT" THEN 
   SELECT KEY cudok% FILE GDokDat$ INDEX CodeDOK.GDokDat$
   FORM 
   SELECT FORM KEY cudok% FILE GDokDat$ INDEX codedok.GDokDat$
 END IF 
 FORM 
 MOUSE ON 
 FILE cfile$
 DIRECTORY cdir$
 END SUB 
  
 ' Dokument bearbeiten (Aufruf fÅr MenÅ)
 ' ======================================================================
 
SUB DOKSRVBearb()
 CALL DOKBearbeiten(CodeDOK.GDokDat$,0)
 END SUB 
 
  
 ' Dokument suchen
 ' ======================================================================
 ' Stand: 12.09.93   
 
 
 ' Dokument lîschen
 ' ======================================================================
 
SUB DOKVLoeschen()
 cudo% = CodeDOK.GDokDat$
 CALL DOKLoeschen(cudo%)
 FORM 
 END SUB 
 
 
 ' Auswahl Dokumentengruppe
 ' ======================================================================
 
SUB DOKAuswGrup()
 cfile$ = FILE 
 cudok% = CodeDOK.GDokDat$
 IF NEW (GDokDat$) OR MOD (GDokDat$) THEN CALL FStore(GDokDat$)
 caption$ = "Auswahl: Dokumentengruppe"
 CREATE DIALOG "AUSWDok",0,0,202,267,title$,"MS Sans Serif",8
 ADD DIALOG "AUSWDok",5,28,6,174,8,0,"Bitte geben Sie an, zu welcher Gruppe das"
 ADD DIALOG "AUSWDok",9,4,9,20,21,2
 ADD DIALOG "AUSWDok",5,28,16,174,9,0,"aktuelle Dokument zugeordnet werden soll:"
 ADD DIALOG "AUSWDok",5,28,27,174,8,0,""
 ADD DIALOG "AUSWDok",7,7,37,189,199,2,0,DOKGruppen$,Auswahl$,Gruppe.GDokDat$
 ADD DIALOG "AUSWDok",1,56,241,55,16,1,"&OK",1,1
 ADD DIALOG "AUSWDok",1,112,241,55,16,0,"&Abbruch",0,0
 DIALOG "AUSWDok",req%
 REMOVE DIALOG "AUSWDok"
 IF req% = 1 THEN 
   SELECT KEY cudok% LOCK FILE GDokDat$ INDEX CodeDOK.GDokDat$
   Gruppe.GDokDat$ = Auswahl$(0)
   CALL QuickStore(GDokDat$)
 END IF 
 FILE cfile$
 SELECT FORM KEY cudok% FILE GDokDat$ INDEX CodeDok.GDokDat$
 FORM 
 END SUB 
  
 
 
 '      **********************************
 '      ** Routinen fÅr Notizverwaltung **
 '      **********************************
 
 ' Notiz neu anlegen
 ' =======================================================================
 ' Zweck:       legt neuen Datensatz in der Notizdatei an
 ' Nutzung:     x%=NOTIZNeu%(Art$,Projekt$,Link%)
 '              Art$            = Art der Notiz
 '              Projekt$        = in welchem Projekt erfa·t
 '              Link%           = CodeXX des zugehîrigen Datensatzes einer
 '                                Projektdatei
 ' RÅckgabe:    x%              = Datensatznummer in der Notizdatei
 '                                0 = keine Notiz angelegt
 ' =======================================================================
 
FUNCTION NOTIZNeu%(Art$,Projekt$,Link%)
 MOUSE OFF 
 cfile$ = FILE 
 CALL DFile(2,"OFFICE\notiz" + _fpw$)
 FILE "Notiz"
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 CodeNO.notiz = SER ("notiz",1)
 Art.NOTIZ = Art$
 Projekt.NOTIZ = Projekt$
 Link.Notiz = Link%
 NOTIZNeu% = CodeNO.notiz
 CALL FStore("Notiz")
 FILE cfile$
 MOUSE ON 
 END FUNCTION 
 
SUB DOKKunde()
 _ku% = CodeKU.GDokDat$
 _dok% = CodeDOK.GDokDat$
 cindex$ = INDEX 
 IF NEW (GDokDat$) OR MOD (GDokDat$) THEN CALL FStore(GDokDat$)
 SET STATUS "Adresse zuordnen"
 adr% = ADRSuche%(0)
 IF adr% <> 0 THEN 
   SELECT KEY _dok% LOCK FILE GDokDat$ INDEX CodeDOK.GDokDat$
   CodeKU.GDokDat$ = adr%
   REM IF link.GDokDat$ = 0 THEN link.GDokDat$ = CodeKU.GDokDat$
   link.GDokDat$ = CodeKU.GDokDat$
   CALL FStore(GDokDat$)
 END IF 
 SELECT FORM KEY _dok% FILE GDokDat$ INDEX CodeDOK.GDokDat$
 SET INDEX cindex$$
 INDEX cindex$$
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' Notiz bearbeiten
 ' =======================================================================
 ' Zweck:       Anzeigen und éndern einer Notiz
 ' Nutzung:     CALL NOTIZBearbeiten(Note%)
 '              Note% = Datensatznummer der Notiz
 ' =======================================================================
 
SUB NOTIZBearbeiten(Note%)
 cfile$ = FILE 
 CALL DFile(2,"OFFICE\notiz" + _fpw$)
 FILE "Notiz"
 SELECT KEY Note% LOCK FILE "Notiz" INDEX CodeNO.notiz
 Caption$ = "NOTIZ - " + Art.notiz
 Notiz$ = Notiz.NOTIZ
 CREATE DIALOG "NOTE",0,0,320,205,title$,"MS Sans Serif",8
 ADD DIALOG "NOTE",9,4,4,20,21,4
 ADD DIALOG "NOTE",5,33,9,121,10,0,"Geben Sie die gewÅnschte Notiz ein:"
 ADD DIALOG "NOTE",6,33,26,272,151,68,2,Notiz$,4000
 ADD DIALOG "NOTE",1,193,183,54,16,0,"&OK",1,1
 ADD DIALOG "NOTE",1,251,183,54,16,0,"&Abbrechen",0,0
 DIALOG "NOTE",req%
 REMOVE DIALOG "NOTE"
 IF req% = 1 THEN 
   IF notiz$ <> "" THEN 
     Notiz.Notiz = Notiz$
     CALL FStore("NOTIZ")
   ELSE 
     SELECT REMOVE FILE "Notiz"
   END IF 
 END IF 
 FILE cfile$
 END SUB 
 
 
 ' Notiz lîschen
 ' =======================================================================
 ' Zweck:       Lîschen einer Notiz
 ' Nutzung:     CALL NOTIZLoeschen(Notiz%)
 '              Notiz%          = Datensatznummer der Notiz
 ' =======================================================================
 
SUB NOTIZLoeschen(Notiz%)
 MOUSE OFF 
 cfile$ = FILE 
 CALL DFile(2,"OFFICE\notiz" + _fpw$)
 FILE "Notiz"
 SELECT KEY Notiz% LOCK FILE "Notiz" INDEX CodeNO.notiz
 SELECT REMOVE FILE "Notiz"
 FILE cfile$
 MOUSE ON 
 END SUB 
 
 
 ' Notiz auswÑhlen
 ' =======================================================================
 ' Zweck:       WÑhlt Notiz aus Notizdatei aus
 ' Nutzung:     x%=NOTIZAuswahl%(Art$,Projekt$,Link%)
 '              Art$            = Art der Notiz ("" fÅr alle Arten)
 '              Projekt$        = in welchem Projekt erfa·t ("" fÅr alle Projekte"
 '              Link%           = CodeXX des zugehîrigen Datensatzes einer
 '                                Projektdatei (0 fÅr alle Links)
 ' RÅckgabe:    x%              = Datensatznummer in der Notizdatei
 '                                0 = keine Notiz ausgewÑhlt
 ' =======================================================================
 
FUNCTION NOTIZAuswahl%(Art$,Projekt$,Link%)
 MOUSE OFF 
 cfile$ = FILE 
 CALL DFile(2,"OFFICE\notiz" + _fpw$)
 IF Art$ = "" THEN Art$ = "**" ELSE Art$ = Art$ + "*"
 IF Projekt$ = "" THEN Projekt$ = "**" ELSE Projekt$ = Projekt$ + "*"
 FILE "Notiz"
 INDEX CodeNO.notiz
 NoteInd% = 0
 SELECT FIRST 
 WHILE NOT EOF ("notiz")
   IF Link% = 0 THEN 
     IF Art.Notiz LIKE Art$ AND Projekt.Notiz LIKE Projekt$ THEN 
       Notizen$(NoteInd%) = Notiz.Notiz + " (" + STR$ (CodeNO.notiz,"000000") + ")"
       NoteInd% = NoteInd% + 1
     END IF 
   ELSE 
     IF Art.Notiz LIKE Art$ AND Projekt.Notiz LIKE Projekt$ AND Link.Notiz = Link% THEN 
       Notizen$(NoteInd%) = Notiz.Notiz + " (" + STR$ (CodeNO.notiz,"000000") + ")"
       NoteInd% = NoteInd% + 1
     END IF 
   END IF 
   SELECT NEXT FILE "NOTIZ" INDEX CodeNO.notiz
 WEND 
 CREATE DIALOG "NOTESEL",0,0,290,148,title$,"MS Sans Serif",8
 ADD DIALOG "NOTESEL",9,8,6,18,21,2
 ADD DIALOG "NOTESEL",5,33,12,89,8,0,"WÑhlen Sie eine Notiz aus:"
 ADD DIALOG "NOTESEL",7,32,24,252,90,2,2,Notizen$,Auswahl$
 ADD DIALOG "NOTESEL",1,173,126,55,16,0,"&OK",1,1
 ADD DIALOG "NOTESEL",1,229,126,55,16,0,"&Abbrechen",0,0
 DIALOG "NOTESEL",req%
 REMOVE DIALOG "NOTESEL"
 IF req% = 1 THEN 
   Notesel$ = LEFT$ ( RIGHT$ (Auswahl$(0),7),6)
   NOTIZAuswahl% = VAL (Notesel$)
 ELSE 
   NOTIZAuswahl% = 0
 END IF 
 FILE cfile$
 MOUSE ON 
 END FUNCTION 
 
 
 
 '      **************************
 '      ** Routinen fÅr Mailing **
 '      **************************
 
 ' Mailing
 ' ===========================================================================
 ' ToDo: Stichwortauswahl 
 
SUB MAILING()
 cdir$ = DIRECTORY 
 IF disabled%("MAILING") THEN END SUB 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF OPEN ("adrtemp") THEN 
   REM CLOSE FILE "ADRTEMP"
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\keywords" + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 OK% = 1
 aopt% = 5
 opt% = 0
 userfile$ = STR$ (CodeMA.supervis,"00000000")
 SET STATUS "Mailing - Schritt 1..."
 CREATE DIALOG "MAILING",0,0,257,136,title$,"MS Sans Serif",8
 ADD DIALOG "MAILING",9,6,9,22,24,2
 ADD DIALOG "MAILING",5,36,9,211,10,0,"Mailing - Schritt 1"
 ADD DIALOG "MAILING",4,36,19,212,5,0,""
 ADD DIALOG "MAILING",5,36,28,212,22,0,"Nachfolgend fÅhrt das Programm Sie durch alle notwendigen Arbeitsschritte, um ein Mailing durchzufÅhren."
 ADD DIALOG "MAILING",5,36,51,212,23,0,"Zuerst mÅssen Sie auswÑhlen, ob Sie eine neue Adre·liste erstellen mîchten oder mit der zuletzt erstellten Adre·liste arbeiten mîchten."
 ADD DIALOG "MAILING",3,47,82,124,10,0,"&neue Adre·liste erstellten",0,opt%
 ADD DIALOG "MAILING",3,47,92,136,12,0,"&zuvor erstellte Adre·liste verwenden",1,opt%
 ADD DIALOG "MAILING",4,36,107,212,5,0,""
 ADD DIALOG "MAILING",1,136,116,55,15,1,"&Weiter >>",1,1
 ADD DIALOG "MAILING",1,192,116,55,15,0,"&Abbrechen",0,0
 DIALOG "MAILING",req%
 REMOVE DIALOG "MAILING"
 IF req% = 0 THEN END SUB 'Procedure verlassen
 SELECT CASE opt%
 CASE 1
   IF EXISTS (GMACodeDir$ + userfile$ + ".sbf") THEN 
     OPEN FILE GMACodeDir$ + userfile$
   ELSE 
     CALL Fehler("Sie hatten noch keine Mailingdatei erzeugt!","Bitte erzeugen Sie eine neue Adre·liste.")
     END SUB 'Procedure verlassen
   END IF 
 CASE 0
   SET STATUS "Mailing - Schritt 1 - Filter erstellen..."
   REM adrfilt$ = GetFilter$(_netpath$ + "OFFICE\"+GADRDat$)
   adrfilt$ = GetFilter$(_netpath$ + "OFFICE\" + GADRDat$)
   IF adrFilt$ = "" THEN 
     CALL Fehler("Die Mailingerstellung wurde abgebrochen!","")
     END SUB 'Procedure verlassen
   END IF 
   CALL CreateMailFile(adrfilt$,userfile$)
   IF tString$ = "" THEN END SUB 
 END SELECT 
 REM -- Schritt 2 - Adre·liste bearbeiten
 opt% = 0
 SET STATUS "Mailing - Schritt 2..."
 CREATE DIALOG "MAIL2",0,0,257,136,title$,"MS Sans Serif",8
 ADD DIALOG "MAIL2",9,6,9,22,24,2
 ADD DIALOG "MAIL2",5,36,9,210,10,0,"Mailing - Schritt 3"
 ADD DIALOG "MAIL2",4,36,19,212,5,0,""
 ADD DIALOG "MAIL2",5,36,28,212,10,0,"Die Adre·liste wurde erfolgreich erstellt und geladen."
 ADD DIALOG "MAIL2",5,36,46,212,10,0,"Mîchten Sie die Adre·liste vor der Mailingerstellung bearbeiten?"
 ADD DIALOG "MAIL2",3,47,66,124,11,0,"&Ja",0,opt%
 ADD DIALOG "MAIL2",3,47,79,136,11,0,"&Nein",1,opt%
 ADD DIALOG "MAIL2",4,36,107,212,5,0,""
 ADD DIALOG "MAIL2",1,136,116,55,15,1,"&Weiter >>",1,1
 ADD DIALOG "MAIL2",1,192,116,55,15,0,"&Abbrechen",0,0
 DIALOG "MAIL2",req%
 REMOVE DIALOG "MAIL2"
 IF req% = 0 THEN 
   CALL Fehler("Die Mailingerstellung wurde abgebrochen!","")
   END SUB 'Procedure verlassen
 END IF 
 IF opt% = 0 THEN 
   REM Adre·liste bearbeiten
   SET STATUS "Adre·liste bearbeiten..."
   Superbase.Dialogs.Add("MAIL2")
   SET dlg = Superbase.Dialogs.MAIL2
   dlg.Move(0,0,425,330):dlg.Caption = "Dialog Title":dlg.FontName = "MS Sans Serif"
   dlg.FontSize = 8:dlg.OnActivate = "MLFillList1"
   SET c = dlg.Add("DialogIcon1","DialogIcon"):c.Move(6,11,22,23):c.Icon = 2
   SET c = dlg.Add("DialogLabel1","DialogLabel"):c.Move(33,11,184,9):c.Caption = "Mailing - Schritt 3 (Adre·liste bearbeiten)"
   SET c = dlg.Add("DialogFrame1","DialogFrame"):c.Move(33,19,183,5):c.Caption = ""
   SET c = dlg.Add("DialogLabel3","DialogLabel"):c.Move(33,28,183,21):c.Caption = "Bitte entfernen Sie in der nachfolgenden Liste die EintrÑge, die nicht im Mailing erscheinen sollen."
   SET c = dlg.Add("adrList","DialogListBox"):c.Move(33,52,320,268):c.Sorted = 1:c.ScrollBars = 2:c.OnDblClick = "MListDel1"
   SET c = dlg.Add("cmDelete","DialogCommandButton"):c.Move(360,83,55,14):c.Caption = "&Entfernen":c.ReturnValue = 0:c.Cancel = 1:c.OnClick = "MListDel1"
   SET c = dlg.Add("cmOK","DialogCommandButton"):c.Move(360,181,55,15):c.Default = 1:c.Caption = "&Weiter":c.ReturnValue = 1
   SET c = dlg.Add("cmCancel","DialogCommandButton"):c.Move(360,200,55,15):c.Caption = "&Abbrechen":c.ReturnValue = 0:c.Cancel = 1
   DIALOG "MAIL2",req%
   REMOVE DIALOG "MAIL2"
   IF req% = 0 THEN 
     CALL Fehler("Die Mailingerstellung wurde abgebrochen!","")
     END SUB 'Procedure verlassen
   END IF 
 END IF 
 
 REM -- Schritt 3 - Export der Adre·liste
 opt% = 0
 SET STATUS "Adre·liste exportieren..."
 CREATE DIALOG "MAIL3",0,0,257,136,title$,"MS Sans Serif",8
 ADD DIALOG "MAIL3",9,6,9,22,24,2
 ADD DIALOG "MAIL3",5,36,9,210,10,0,"Mailing - Schritt 5"
 ADD DIALOG "MAIL3",4,36,19,212,5,0,""
 ADD DIALOG "MAIL3",5,36,28,212,21,0,"Die Adre·liste mu· nun in ein von Ihrer Textverarbeitung unterstÅtztes Datenbankformat umgewandelt werden."
 ADD DIALOG "MAIL3",5,36,51,212,26,0,"Bitte geben Sie an, welches Datenbankformat von Ihrer Textverarbeitung genutzt werden kann (vorzugsweise sollten Sie dBase verwenden)."
 ADD DIALOG "MAIL3",3,47,81,144,11,0,"Umwandlung in &dBase- und MS Excel-Format",0,opt%
 ADD DIALOG "MAIL3",3,47,92,136,12,0,"Umwandlung in A&SCII-Format",1,opt%
 ADD DIALOG "MAIL3",4,36,107,212,5,0,""
 ADD DIALOG "MAIL3",1,136,116,55,15,1,"&Weiter >>",1,1
 ADD DIALOG "MAIL3",1,192,116,55,15,0,"&Abbrechen",0,0
 DIALOG "MAIL3",req%
 REMOVE DIALOG "MAIL3"
 IF req% = 0 THEN 
   CALL Fehler("Die Mailingerstellung wurde abgebrochen!","")
   END SUB 'Procedure verlassen
 END IF 
 SELECT CASE opt%
 CASE 0
   CALL FileExport(userfile$,1)
 CASE 1
   CALL FileExport(userfile$,2)
 END SELECT 
 DIRECTORY cdir$
 CALL MAILAQAkt(userfile$)
 END SUB 
 
 ' Zusatzroutinen fÅr Dialog MAIL3
 ' ===============================
 
SUB MLFillList()
 MOUSE OFF 
 FILE userfile$
 INDEX CodeKU
 SELECT FIRST 
 WHILE NOT EOF (userfile$)
   dlg.adrList.AddItem(name1.userfile$ + ", " + name2.userfile$ + ", " + Ort.userfile$ + SPACE$ (165) + CodeKU.userfile$)
   SELECT NEXT 
 WEND 
 MOUSE ON 
 END SUB 
 
SUB MListDel()
 lidx% = dlg.AdrList.ListIndex
 IF lidx% <> 0 THEN 
   item$ = dlg.adrList.List(lidx%)
   SELECT KEY RIGHT$ (item$,6) LOCK FILE userfile$ INDEX CodeKU.userfile$
   REQUEST name1.userfile$ + ", " + name2.userfile$ + ", " + Ort,"Eintrag lîschen?",130,req%
   IF req% <> 0 THEN 
     dlg.adrList.RemoveItem(lidx%)
     SELECT REMOVE FILE userfile$
   END IF 
 END IF 
 END SUB 
 
 
 
 
 ' Adre·liste generieren
 ' ===========================================================================
 ' Zweck:       erzeugt Adre·liste fÅr Mailing
 ' Nutzung:     CALL CreateMailFile(filter$,destfile$)
 '              filter$         = Filterbedingungen
 '              destfile$       = Zieldatei
 ' ===========================================================================
 
SUB CreateMailFile(filter$,destfile$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 cfile$ = FILE 
 SET STATUS "Feldauswahl..."
 MOUSE OFF 
 FILE GAdrDat$
 IF OPEN (destfile$) THEN CLOSE FILE destfile$
 IF EXISTS (destfile$ + ".sbf") THEN DELETE destfile$ + ".*"
 REM 280999
 adrser% = 1
 bef$ = "SELECT WHERE " + filter$
 EXECUTE bef$
 SELECT FIRST 
   a% = 0
   b% = RECCOUNT (GAdrDat$)
   IF b% > 20000 THEN 
     b% = 20000
     REDIM AdrFound$(20000,1)
     REDIM AdrFound$(20000)
   ELSE 
     REDIM AdrFound$( RECCOUNT (GAdrDat$),1)
     REDIM AdrFound$( RECCOUNT (GAdrDat$))
   END IF 
   REM FOR a% = 0 TO b%
     REM AdrFound$(a%) = ""
   REM NEXT a%
   a% = 0
   WHILE NOT EOF (GAdrDat$)
     AdrFound$(a%) = nachname.GAdrDat$ + STR$ (codeku.GAdrDat$,"000000")
     a% = a% + 1
     SELECT NEXT FILE GAdrDat$
   WEND 
 
 CALL SerieNeu1(GAdrDat$)
 
 SET STATUS "Adre·liste wird generiert..."
 MOUSE OFF 
 
 
 MOUSE ON 
 END SUB 
 


SUB MNOFFICE()
 CALL MNProgramm()
 MENU 2,0,1,"&Optionen","",""
 MENU 2,1,1,"&Adressen",GAdrDat$,"Aufruf der Adre·verwaltung"
 MENU 2,2,1,"&Mailing","MAILING","Erzeugen von Serienbriefen"
 MENU 2,3,1,"Do&kumente","DOKallg","Dokumente erstellen, einsehen und bearbeiten"
 MENU 2,4,1,"&Termine","AKQUISE1","Aufruf der Terminverwaltung"
 MENU 2,5,1,"Akt&ionen","AKTIONEN","Aufruf der Aktionsverwaltung"
 MENU 2,6,1,"&Berichte","BMKurzbericht","Kurzberichte erstellen"
 MENU 2,7,1,"Einste&llungen","SETUP","Programmeinstellungen/Mitarbeiterverwaltung"
 SELECT KEY vcodema% FILE "SUPERVIS" INDEX CodeMA.supervis
 IF NOT MNdisabled%("DOKUMENTE") THEN 
   MENU 2,8,1,"&Dokumentenverwaltung","DOKUMENTSRV","erweiterte Dokumentenverwaltung"
 ELSE 
   MENU 2,8,0,"&Dokumentenverwaltung"
 END IF 
 IF inhouse1$ = "TRUE" AND inhouse$ = "TRUE" THEN 
   MENU 2,9,3
   MENU 2,10,1,"1&1-AdressÅbernahme","INHOUSE1"
 END IF 
 mnline$ = ReadINI$("AddOn","1")
 IF mnline$ <> "leer" THEN 
   a% = 0
   AddOn$(0) = ""
   WHILE AddOn$(a%) <> "leer"
     AddOn$(a%) = FN ibm(ReadINI$("AddOn", LTRIM$ ( STR$ (a% + 1,"999999"))))
     IF AddOn$(a%) <> "leer" THEN a% = a% + 1
   WEND 
   AddOn$(a%) = ""
   MENU 3,0,1,"An&wendungen"
   a% = 0
   WHILE AddOn$(a%) <> ""
     IF a% < 10 THEN mnline$ = "&" ELSE mnline$ = ""
     mnline$ = mnline$ + LTRIM$ ( STR$ (a%,"999")) + " " + AddOn$(a%)
     MENU 3,a% + 1,1,mnline$,"ADDON"
     a% = a% + 1
   WEND 
   CALL MNHilfe(4)
 ELSE 
   CALL MNHilfe(3)
 END IF 
 END SUB 
  
 
 ' Formular AKTIONEN
 ' ======================================================================
 
SUB MNAKTIONEN()
 CALL MNProgramm()
 MENU 1,1,0,"D&rucken","AKDrucken","AktionsÅbersicht drucken"
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,1,"&Neu,F2","AKNeu","neue Aktion hinzufÅgen"
 REM MENU 2,2,1,"S&ichern,F4","MStore","Daten der aktuellen Aktion speichern"
 MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO","letzte énderungen verwerfen"
 IF NOT MNdisabled%("AKTIONLoeschen") THEN 
   MENU 2,3,1,"&Lîschen","AKLoeschen","aktuelle Aktion lîschen"
 ELSE 
   MENU 2,3,0,"&Lîschen"
 END IF 
 MENU 3,0,1,"Be&wegen","",""
 MENU 3,1,1,"&NÑchster,BildAb","AKNext","nÑchster Datensatz"
 MENU 3,2,1,"&Vorheriger,BildAuf","AKPrev","vorheriger Datensatz"
 MENU 4,0,1,"&Optionen","",""
 MENU 4,1,1,"&Termine","AKQUISE3","Termine der aktuellen Aktion bearbeiten"
 CALL MNHilfe(5)
 END SUB 
 
 ' Formular DOKUMENT
 ' ======================================================================
 
SUB MNDOKSRV()
 CALL MNProgramm()
 MENU 2,0,1,"Bearbeiten","",""
 MENU 2,1,1,"&RÅckgÑngig,Ctrl+RckT","UNDO","letzte énderungen verwerfen"
 MENU 2,2,1,"Dokument &importieren","DOKImport","existierende Dokumente in Dokumentenverwaltung aufnehmen"
 REM MENU 2,3,1,"S&ichern,F4","MStore","Daten des aktelen Dokumentes sichern"
 MENU 2,3,1,"&Suchen,F6","DOKVSuchen()","Dokument suchen"
 MENU 2,4,1,"Text &bearbeiten","DOKSRVBearb()","Textverarbeitung starten"
 MENU 3,0,1,"&Bewegen","",""
 MENU 3,1,1,"&NÑchster,BildAb","PSelectNext","nÑchstes Dokument"
 MENU 3,2,1,"&Vorheriger,BildAuf","PSelectPrev","vorheriges Dokument"
 MENU 3,3,1,"&Erster","PSelectFirst","erstes Dokument"
 MENU 3,4,1,"&Letzter","PSelectLast","letztes Dokument"
 MENU 4,0,1,"&Optionen"
 MENU 4,1,1,"als &Tabelle bearbeiten","DOKSRVTAB","DokumenteneintrÑge als Tabelle bearbeiten"
 MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
 IF ProjectJN$ = "TRUE" THEN 
   MENU 5,0,1,"Projektzuordnung zurÅcksetzen"
   MENU 5,1,1,"Zuordnung zum Projekt zurÅcksetzen","DelProjDok","Zuordnung zum Projekt zurÅcksetzen"
   CALL MNHilfe(6)
 ELSE 
   CALL MNHilfe(5)
 END IF 
 END SUB 
 
SUB DelProjDok()
 codedok% = codedok.GDokDat$
 SELECT KEY codedok% LOCK FILE GDokDat$ INDEX codedok.GDokDat$
 codepr.GDokDat$ = 0
 Projekt.GDokDat$ = ""
 IF Workstation% > 0 THEN Workstation.GDokDat$ = Workstation%
 IF Workstation% > 0 THEN QWoNo.GDokDat$ = STR$ (Workstation%,"000000") + STR$ (codedok.GDokDat$,"000000")
 RecStatus.GDokDat$ = "c"
 STORE FILE GDokDat$
 UNLOCK CURRENT FILE GDokDat$
 END SUB 
 
SUB GENoteBig(fnam$)
   notizn$ = fnam$ + ".geadr"
   LÑnge$ = FIELDINFO$ (notizn$,4)
   lÑnge% = VAL (LÑnge$)
   inh$ = notizn$$
   SET EDIT SELECT OFF 
   SET EDIT SELECT ON 
   nr$ = gesellschaft.geadr
   CREATE DIALOG GTelDat$,0,0,443,253,"Notiz","MS Sans Serif",8
   ADD DIALOG GTelDat$,5,5,6,56,10,0,"Gesellschaft:"
   ADD DIALOG GTelDat$,5,62,6,380,9,128,nr$
   ADD DIALOG GTelDat$,5,5,22,165,10,0,"Notiz: zum Zeilenumbruch Strg+Enter drÅcken"
   REM ADD DIALOG GTelDat$,6,5,32,430,200,4,0,inh$
   ADD DIALOG GTelDat$,6,5,32,430,200,68,3,inh$,lÑnge%
   ADD DIALOG GTelDat$,1,170,235,55,15,1,"&OK",1,1
   ADD DIALOG GTelDat$,1,237,235,55,15,0,"&Druck",2,2
   DIALOG GTelDat$,req%
   REMOVE DIALOG ALL 
   IF inh$ <> notizn$$ THEN 
     REM es wurde geÑndert
     IF NOT disabled%("GEADRBEARB") THEN 
       REQUEST "énderungen speichern?","",130,req%
       IF req% = 1 THEN 
         SELECT CURRENT LOCK FILE "GEADR"
         notizn$$ = LEFT$ (inh$,lÑnge%)
         CALL QuickStore("GEADR")
       END IF 
     END IF 
   END IF 
   IF req% = 2 THEN 
     PRINT ;
     ? inh$
     DISPLAY ;
   END IF 
   SET EDIT SELECT ON 
 END SUB 



SUB KVHist()
   REM CALL Fehler("ADRHIS","")
 _formend% = 0
 SET STATUS "Bereit"
 ON ERROR GOTO ErrorHandler
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   SUPERVISsub% = 0
   fvf$ = FORM 
   IF FORM <> "KVHIS" THEN 
     SET HEADING title$ + " - Vertrags-Such-Historie"
     OPEN FORM GPrjForm$ + "\KVHIS"
     SET f = Superbase.Form
     SET STATUS "Vertrags-Such-Historie"
     FILE "SUPERVIS"
     INDEX codema.supervis
     SELECT FIRST FILE "supervis" INDEX codema.supervis
     SELECT FORM KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
     FILE "KVHIS"
     INDEX QCodeMAkey.KVhis
     SELECT FIRST FILE "KVHIS" INDEX QCodeMAkey.kvhis
     QCodeMAkey$ = STR$ (GMACodeMA%,"000000") + "000000"
     SELECT FORM KEY QCodeMAkey$ INDEX QCodeMAkey.kvhis
     GAppName$ = _netpath$ + "DOCP\provis.pdf"
     
     CALL MNKVHIS()
     FORM 
   END IF 
   MENU ON 
   MOUSE ON 
   waehr$ = "FirmenwÑhrung: " + waehrung.stamm
   FORM 
   CALL ClearKBDBuffer()
   MENU ON 
   WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     REM CALL SVPrev()
   CASE CrsRight%,PgDn%
     REM CALL SVNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   CALL ClearKBDBuffer()
   SELECT CASE SUPERVISsub%
   CASE 1
     ok% = - 1
     IF GMASuperCount% > 0 THEN 
       ok% = 0
       cuvt% = lfdnr.kvhis
       SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
       SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
       codema% = codema.kvertrag
       IF IsMASuper%(codema%) = - 1 THEN 
         ok% = - 1
       ELSE 
         CALL Fehler("Sie haben keine Berechtigung auf diesen Vertrag zuzugreifen!","")
       END IF 
     END IF 
     IF ok% = - 1 THEN 
       REM Auswahl einer Adresse
       cuvt% = lfdnr.kvhis
       CALL DFile(3,"FOERKOND" + _fpw$)
       IF GAFSK$ LIKE "TRUE" THEN 
         CALL DFile(3,"AFSKSUT" + _fpw$)
       END IF 
       lfdnr% = cuvt%
       SELECT WHERE FILE "kvertrag"
       CALL KVERTRAGneu(lfdnr%)
     END IF 
     END IF 
   CASE 2
     REM Abbruch
     MOUSE ON 
     _formend% = 1
 END SELECT 
 WEND 
 
 _formend% = 0
 END SUB 
 
SUB MNKVHIS()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 END SUB 
 
 
 
 
 REM 08092003 Vertrags-Such-Historie lîschen
SUB LoeKVHist()
 CALL DFile(3,"KVHIS" + _fpw$)
 opt% = 2
 von% = 30
anfloe090920031: 
 CREATE DIALOG "Konto1",0,0,221,165,"Lîschen der eigenen Vertrags-Such-Historie","MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Lîschen:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Sie haben jetzt die Mîglichkeit die gesamte Vertrags-Such-Historie zu lîschen oder"
 ADD DIALOG "Konto1",5,34,40,175,32,0,"zu sagen, dass sie NUR die Historie der letzten xy Tage aufheben mîchten!"
 ADD DIALOG "Konto1",3,34,64,153,10,0,"komplette Historie lîschen",1,opt%
 ADD DIALOG "Konto1",3,34,80,153,10,0,"xy Tage aufheben",2,opt%
 ADD DIALOG "Konto1",5,34,100,60,10,0,"xy Tage aufheben"
 ADD DIALOG "Konto1",6,100,99,15,11,0,0,von%,2
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 IF req% = 1 THEN 
   IF opt% = 2 AND von% < 1 THEN 
     CALL Fehler ("Sie mÅssen bei xy einen Wert grî·er Null eintragen!","")
     GOTO anfloe090920031
   END IF 
   IF opt% = 1 THEN 
     REM alle lîschen
     REQUEST "Komplette Vertrags-Such-Historie lîschen?","",130,reqloe%
     IF reqloe% = 1 THEN 
       MOUSE OFF 
       REMOVE FROM FILE "KVHIS" WHERE codema.kvhis = GMACodeMA%
       MOUSE ON 
       REQUEST "Vertrags-Such-Historie wurde gelîscht!",""
     END IF 
   END IF 
   IF opt% = 2 THEN 
     REM bis zu einem bestimmten Datum lîschen
     REQUEST "Vertrags-Such-Historie lîschen au·er den letzten " + LTRIM$ ( STR$ (von%,"99")),"Tagen",130,reqloe%
     IF reqloe% = 1 THEN 
       MOUSE OFF 
       test% = ( DAYS ( TODAY ) - von%)
       tag$ = LEFT$ ( DATE$ (test%,"0dmmyyyy"),2)
       monat$ = LEFT$ ( DATE$ (test%,"mm.0d.yyyy"),2)
       jahr$ = LEFT$ ( DATE$ (test%,"yy.mm.0d"),2)
       dat1$ = jahr$ + monat$ + tag$ + "0000"
       test1% = VAL (dat1$)
       NUMBASE "0000000000."
       dat1$ = DATE$ (test%,"yymmdd") + "9999"
       test1% = VAL (dat1$)
       REMOVE FROM FILE "KVHIS" WHERE codema.KVhis = GMACodeMA% AND timestamp.kvhis < test1%
       MOUSE ON 
       REQUEST "Vertrags-Such-Historie wurde bis auf die letzten " + LTRIM$ ( STR$ (von%,"99")),"Tage gelîscht!"
     END IF 
   END IF 
 END IF 
 REM SELECT FORM CURRENT LOCK 
 END SUB 




SUB BerlimAbbruch()
   codeku% = codeku.GADRDat$
   ENTER END 
   SELECT FIRST FILE GADRDat$ INDEX codeku.GADRDat$
   SELECT KEY codeku% LOCK FILE GADRDat$ INDEX codeku.GADRDat$
           anrede.GAdrDat$ = GAnredADR$
           Titel.GAdrDat$ = GTitelADR$
           Nachname.GAdrDat$ = GNachnameADR$
           Vorname.GAdrDat$ = GVornameADR$
           Geburtsname.GAdrDat$ = GGebname$
           plz.GAdrDat$ = GPLZADR$
           Stra·e.GAdrDat$ = GStrasseADR$
           Ort.GAdrDat$ = GOrtADR$
           Land.GADRDat$ = GLandADR$
           Geburtstag.GADRDat$ = GGeburtstag%
           Telefon1.GADRDat$ = GTelefon1$
           CALL QuickStore(GADRDAT$)
 END SUB 




FUNCTION BerlimexSuch%(name1$,name2$,strasse$,plz$,ort$)
    BerlimexSuch% = 0
    Projektnummer$ = ""
    name3$ = ""
    land$ = ""
    Projektstart$ = ""
    Projektstart2$ = ""
    Notiz1$ = ""
    Notiz2$ = ""
    Notiz3$ = ""
    Notiz4$ = ""
    Stichwort1$ = ""
    Stichwort2$ = ""
    Stichwort3$ = ""
    ADRStatus1$ = ""
    ADRStatus2$ = ""
    ADRStatus3$ = ""
AnfSuAdr20052004:   
   adrglob% = 0
    reqsu% = 1
 notiz% = 0
 suna1$ = "J"
 MOUSE OFF 
 IF projektnummer$ <> "" THEN 
   suna$ = projektnummer$
   feld$ = "Kundennummer." + GAdrDat$
 ELSE 
   IF name1$ <> "" THEN 
     suna$ = VSNRPack$(name1$)
     feld$ = "QNachname." + GAdrDat$
   ELSE 
     IF name2$ <> "" THEN 
       suna$ = VSNRPack$(name2$)
       feld$ = "QVorname." + GAdrDat$
     ELSE 
       IF name3$ <> "" THEN 
         suna$ = VSNRPack$(name3$)
         feld$ = "QGeburtsname." + GAdrDat$
       ELSE 
         IF strasse$ <> "" THEN 
           suna$ = VSNRPack$(strasse$)
           feld$ = "Qstra·e." + GAdrDat$
         ELSE 
           IF plz$ <> "" THEN 
             suna$ = VSNRPack$(plz$)
             feld$ = "Qplz." + GAdrDat$
           ELSE 
             IF ort$ <> "" THEN 
               suna$ = VSNRPack$(ort$)
               feld$ = "Qort." + GAdrDat$
             ELSE 
               IF land$ <> "" THEN 
                 suna$ = land$
                 feld$ = "land." + GAdrDat$
               ELSE 
                 IF Stadtteil$ <> "" THEN 
                   suna$ = stadtteil$
                   REM feld$ = "Stadtteil.project"
                 ELSE 
                   IF projektstart$ <> "" OR projektstart2$ <> "" THEN 
                     suna$ = projektstart$
                     feld$ = "Kunde_seit." + GAdrDat$
                   ELSE 
                     IF LTRIM$ (adrstatus1$) <> "" THEN 
                       suna$ = ADRSTATUS1$
                       feld$ = "ADRSTATUS." + GAdrDat$
                     ELSE 
                       IF LTRIM$ (Stichwort1$) <> "" THEN 
                         notiz% = - 1
                         suna$ = ADRStatus1$
                         feld$ = "ADRSTatus." + GAdrDat$
                       ELSE 
                         IF LTRIM$ (notiz1$) <> "" THEN 
                           notiz% = - 1
                           suna$ = ADRStatus1$
                           feld$ = "ADRStatus." + GAdrDat$
                         END IF 
                       END IF 
                     END IF 
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
   END IF 
 END IF 
 FILE GAdrDat$
 REM 150699
 IF feld$ = "" THEN GOTO endadr200504
 INDEX feld$$
 SELECT FIRST 
 datind$ = "FALSE"
 datind1$ = "FALSE"
 IF feld$ LIKE "Kunde_seit*" THEN 
   IF projektstart$ = "" THEN projektstart$ = "1.1.1980"
   IF projektstart2$ = "" THEN projektstart2$ = "31.12.2999"
   IF DateOK%(projektstart$) THEN 
     datind$ = "TRUE"
   ELSE 
     GOTO AnfSuAdr20052004
   END IF 
   IF projektstart2$ <> "" THEN 
     IF DateOK%(projektstart2$) THEN 
       datind1$ = "TRUE"
     ELSE 
       GOTO AnfSuAdr180998
     END IF 
   END IF 
 END IF 
 
 IF notiz% <> - 1 THEN 
   SELECT FIRST INDEX feld$$
   IF datind$ <> "TRUE" THEN 
     SELECT KEY suna$ INDEX feld$$
   ELSE 
     suna% = DAYS (suna$)
     SELECT KEY suna% INDEX feld$$
   END IF 
 END IF 
 IF name1$ = "" AND name2$ = "" AND name3$ = "" AND strasse$ = "" AND ort$ = "" AND plz$ = "" THEN datind$ = "ALLE"
 IF datind$ LIKE "ALLE" THEN 
   IF (notiz1$ <> "" AND notiz2$ <> "") OR (notiz1$ <> "" AND notiz4$ <> "") THEN 
     SELECT FIRST FILE GAdrDat$
   END IF 
   IF (ADRStatus1$ <> "" AND ADRStatus2$ <> "") OR (ADRStatus2$ <> "" AND ADRStatus3$ <> "") THEN 
     SELECT FIRST FILE GAdrDat$
   END IF 
   IF (Stichwort1$ <> "" AND Stichwort2$ <> "") OR (Stichwort2$ <> "" AND Stichwort3$ <> "") THEN 
     SELECT FIRST FILE GAdrDat$
   END IF 
   REM ? ADRSTATUS.GAdrDat$
 END IF 
 REM suna$ = suna$ + "*"
 SET STATUS "Adresssuche lÑuft..."
 a% = 0
 fanz% = RECCOUNT (GAdrDat$)
 IF fanz% < 100 OR fanz% > 20000 THEN fanz% = 20000
 REDIM AdrFound$(fanz%)
 b% = RECCOUNT (GAdrDat$)
 REM FOR i% = 0 TO b%
   REM AdrFound$(i%) = ""
 REM NEXT i%
 REM CALL Fehler("","")
 i% = 0
 adrfound% = 1
 projektstart% = suna%
 projektstart2% = DAYS (projektstart2$)
 j% = RECCOUNT (GAdrDat$)
 adro0% = 0
 adro1% = 0
 IF GCODIE% = - 1 THEN 
   CALL SearchInitADR()
 END IF 
 locktest% = MNdisabled%("DATALOCK")
 IF datind$ LIKE "ALLE" THEN WHILE NOT EOF (GAdrDat$)
 IF datind$ LIKE "FALSE" AND notiz% <> - 1 THEN WHILE feld$$ LIKE suna$ + "*" AND NOT EOF (GAdrDat$)
 IF datind$ = "TRUE" AND datind1$ = "FALSE" AND notiz% <> - 1 THEN WHILE feld$$ = DAYS (projektstart$) AND NOT EOF (GAdrDat$)
 IF datind$ = "TRUE" AND datind1$ = "TRUE" AND notiz% <> - 1 THEN WHILE feld$$ >= projektstart% AND feld$$ <= projektstart2% + 1 AND NOT EOF (GAdrDat$)
 IF notiz% = - 1 THEN WHILE NOT EOF (GAdrDat$)
   i% = i% + 1
   test$ = nachname.GAdrDat$
   IF LTRIM$ (notiz1$) <> "" THEN 
     IF LTRIM$ (notiz2$) <> "" THEN 
       IF LTRIM$ (notiz4$) <> "" THEN 
         IF RIGHT$ (notiz1$,1) <> "*" THEN notiz1$ = notiz1$ + "*"
         IF RIGHT$ (notiz2$,1) <> "*" THEN notiz2$ = notiz2$ + "*"
         IF RIGHT$ (notiz4$,1) <> "*" THEN notiz4$ = notiz4$ + "*"
         IF noder0% = 1 AND noder1% = 1 THEN 
           IF (notiz.GAdrDat$ LIKE notiz1$ OR notiz.GAdrDat$ LIKE "*" + notiz1$) AND (notiz.GAdrDat$ LIKE notiz2$ OR notiz.GAdrDat$ LIKE "*" + notiz2$) AND (notiz.GAdrDat$ LIKE notiz4$ OR notiz.GAdrDat$ LIKE "*" + notiz4$) THEN 
           ELSE 
             adrfound% = 0
           END IF 
         END IF 
         IF noder0% = 1 AND noder1% = 0 THEN 
           IF (notiz.GAdrDat$ LIKE notiz1$ OR notiz.GAdrDat$ LIKE "*" + notiz1$) AND (notiz.GAdrDat$ LIKE notiz2$ OR notiz.GAdrDat$ LIKE "*" + notiz2$) OR (notiz.GAdrDat$ LIKE notiz4$ OR notiz.GAdrDat$ LIKE "*" + notiz4$) THEN 
           ELSE 
             adrfound% = 0
           END IF 
         END IF 
         IF noder0% = 0 AND noder1% = 1 THEN 
           IF (notiz.GAdrDat$ LIKE notiz1$ OR notiz.GAdrDat$ LIKE "*" + notiz1$) OR (notiz.GAdrDat$ LIKE notiz2$ OR notiz.GAdrDat$ LIKE "*" + notiz2$) AND (notiz.GAdrDat$ LIKE notiz4$ OR notiz.GAdrDat$ LIKE "*" + notiz4$) THEN 
           ELSE 
             adrfound% = 0
           END IF 
         END IF 
         IF noder0% = 0 AND noder1% = 0 THEN 
           IF (notiz.GAdrDat$ LIKE notiz1$ OR notiz.GAdrDat$ LIKE "*" + notiz1$) OR (notiz.GAdrDat$ LIKE notiz2$ OR notiz.GAdrDat$ LIKE "*" + notiz2$) OR (notiz.GAdrDat$ LIKE notiz4$ OR notiz.GAdrDat$ LIKE "*" + notiz4$) THEN 
           ELSE 
             adrfound% = 0
           END IF 
         END IF 
       ELSE 
         IF RIGHT$ (notiz1$,1) <> "*" THEN notiz1$ = notiz1$ + "*"
         IF RIGHT$ (notiz2$,1) <> "*" THEN notiz2$ = notiz2$ + "*"
         IF noder0% = 1 THEN 
           REM UND
           IF (notiz.GAdrDat$ LIKE notiz1$ OR notiz.GAdrDat$ LIKE "*" + notiz1$) AND (notiz.GAdrDat$ LIKE notiz2$ OR notiz.GAdrDat$ LIKE "*" + notiz2$) THEN 
           ELSE 
             adrfound% = 0
           END IF 
         ELSE 
           REM ODER
           IF (notiz.GAdrDat$ LIKE notiz1$ OR notiz.GAdrDat$ LIKE "*" + notiz1$) OR (notiz.GAdrDat$ LIKE notiz2$ OR notiz.GAdrDat$ LIKE "*" + notiz2$) THEN 
           ELSE 
             adrfound% = 0
           END IF 
         END IF 
       END IF 
     ELSE 
       IF RIGHT$ (notiz1$,1) <> "*" THEN notiz1$ = notiz1$ + "*"
         IF notiz.GAdrDat$ LIKE notiz1$ OR notiz.GAdrDat$ LIKE "*" + notiz1$ THEN 
         ELSE 
          adrfound% = 0
       END IF 
     END IF 
   END IF 
 
 
     
 
 
   IF projektnummer$ <> "" THEN 
     IF kundennummer LIKE projektnummer$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
   IF name1$ <> "" THEN 
     IF Nachname.GAdrDat$ LIKE name1$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
 
   IF name2$ <> "" THEN 
     IF Vorname LIKE name2$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
   IF name3$ <> "" THEN 
     IF Geburtsname LIKE name3$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
   IF strasse$ <> "" THEN 
     IF stra·e LIKE strasse$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
   IF plz$ <> "" THEN 
     IF plz LIKE plz$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
   IF ort$ <> "" THEN 
     IF ort LIKE ort$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
   IF land$ <> "" THEN 
     IF land LIKE land$ + "*" THEN 
     ELSE 
       adrfound% = 0
     END IF 
   END IF 
   IF projektstart$ <> "" THEN 
     IF DateOK%(projektstart$) THEN 
       IF projektstart2$ <> "" THEN 
         IF DateOK%(projektstart2$) THEN 
         ELSE 
           GOTO AnfSuAdr180998
         END IF 
         IF Kunde_seit >= projektstart% AND Kunde_seit <= projektstart2% THEN 
         ELSE 
           adrfound% = 0
         END IF 
       ELSE 
         IF projektstart$ <> "" AND kunde_seit = DAYS (projektstart$) THEN 
         ELSE 
           adrfound% = 0
         END IF 
       END IF 
     ELSE 
       GOTO AnfSuAdr180998
     END IF 
   END IF 
   IF locktest% AND FreeFormular.GadrDat$ < 1 THEN 
     IF Sperre.GAdrDat$ <> 0 AND Sperre.GAdrDat$ <> GMAcodema% THEN adrfound% = 0
   END IF 
   IF GMASuperCount% > 0 THEN 
     IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN adrfound% = 0
   END IF 
   IF GASP% AND Workstation% <> 0 THEN 
     IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN adrfound% = 0
   END IF 
   IF adrfound% = 1 THEN 
     codeku% = codeku.GAdrDat$
     REM 141199
     IF GCODIE% = - 1 THEN 
       CALL SearchVorbAdr(GADRDAT$)
       codeku% = Codeku.GADRDAT$
       IF EXISTS (codeku%,codeku.GTelDat$) THEN 
         SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
         CALL SearchVorbTel(GADRDAT$)
       END IF 
     END IF 
     AdrFound1$ = LTRIM$ (nachname)
     IF LTRIM$ (vorname) <> "" THEN AdrFound1$ = AdrFound1$ + ", " + LTRIM$ (vorname)
     IF LTRIM$ (EGNachname) <> "" AND LTRIM$ (EGNACHNAme) <> LTRIM$ (Nachname) THEN AdrFound1$ = AdrFound1$ + ",LAB: " + LTRIM$ (EGNachname) + ", "
     IF LTRIM$ (EGvorname) <> "" THEN AdrFound1$ = AdrFound1$ + ", " + LTRIM$ (EGvorname)
     IF LTRIM$ (K1name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind1: " + LTRIM$ (K1name)
     IF LTRIM$ (K2name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind2: " + LTRIM$ (K2name)
     IF LTRIM$ (K3name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind3: " + LTRIM$ (K3name)
     IF LTRIM$ (K4name) <> "" THEN AdrFound1$ = AdrFound1$ + ", Kind4: " + LTRIM$ (K4name)
     AdrFound1$ = AdrFound1$ + ", " + LTRIM$ (Kundennummer) + "/" + LTRIM$ (ort) + ", " + LTRIM$ (PLZ) + ", " + LTRIM$ (Stra·e) + ", "
     REM FILE "project"
     AdrFound$(a%) = AdrFound1$ + SPACE$ (120) + STR$ (codeku,"000000")
     a% = a% + 1
     IF GCODIE% = - 1 THEN 
       GGGcodeku$ = STR$ (codeku,"000000")
       ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
     END IF 
   ELSE 
     adrfound% = 1
   END IF 
   SET STATUS "Datensatz: " + STR$ (i%,"999999") + " von " + STR$ (j%,"999999") + " durchsucht, gefunden: " + STR$ (a%,"999999")
   SELECT NEXT 
   test$ = Nachname.GAdrDat$
 WEND 
 a% = a% + 1
 tfoundadr% = a%
 AdrFound$(a%) = ""
 IF a% > 0 THEN 
 
   LAuswahl$ = AdrFound$(0)
   LAuswahl1$(0) = LAuswahl$
   IF _projekt$ LIKE "PROVIS" THEN 
     MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
   ELSE 
     MENU 4,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
   END IF 
   IF GCODIE% = - 1 THEN 
     c$ = "aa"
     req3% = CALL ("_SearchShow",c$)
     REM REQUEST c$,"",2
     REM ret% = CALL ("_SearchClose"):rem CALL Fehler("","")
     IF VAL (c$) <> 0 THEN 
       AdrSuche% = VAL (c$)
       adrfound% = VAL (c$)
       codeku1% = VAL (c$)
       knr% = codeku1%
       adrglob% = knr%
       BerlimexSuch% = knr%
       ok% = 0
       SET STATUS "Adressen gefunden..."
       SELECT FORM KEY codeku1% FILE GAdrDat$ INDEX Codeku.GAdrDat$
       SELECT FIRST FILE GTelDat$ INDEX Codeku.GTelDat$
       SELECT KEY codeku1% FILE GTelDat$ INDEX Codeku.GTelDat$
       SET INDEX INDEX 
       REM CALL Fehler("von suche","")
       CALL ADRFeldnamen()
       SELECT FORM KEY codeku1% FILE GTelDat$ INDEX Codeku.GTelDat$
       FORM 
       MOUSE ON 
     END IF 

   ELSE 
     CREATE DIALOG "ADRLISTE",0,0,440,197,title$,"MS Sans Serif",8
     ADD DIALOG "ADRLISTE",7,5,8,428,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
     ADD DIALOG "ADRLISTE",1,164,174,56,16,1,"&OK",1,1
     ADD DIALOG "ADRLISTE",1,224,174,56,16,0,"&Abbrechen",0,0
     DIALOG "ADRLISTE",req3%
     MOUSE ON 
     REMOVE DIALOG "ADRLISTE"
     IF req3% = 3 THEN 
       adrser% = 1
       CALL SerieNeu1(GAdrDat$)
       GOTO endadr180998
     END IF 
     IF req3% = 1 THEN 
       adrglob% = a% - 1
       LAuswahl$ = LAuswahl1$(0)
       codeku1% = VAL ( RIGHT$ (LAuswahl$,6))
       REM adrglob% = codeku1%
       adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
       adrglob% = adrfound%
       BerlimexSuch% = adrfound%
       knr% = adrfound%
       ok% = 0
       SET STATUS "Adressen gefunden..."
       SELECT FORM KEY codeku1% FILE GAdrDat$ INDEX Codeku.GAdrDat$
       SELECT FIRST FILE GTelDat$ INDEX Codeku.GTelDat$
       SELECT KEY codeku1% FILE GTelDat$ INDEX Codeku.GTelDat$
       SET INDEX INDEX 
       REM CALL Fehler("","")
       CALL ADRFeldnamen()
       SELECT FORM KEY codeku1% FILE GTelDat$ INDEX Codeku.GTelDat$
       FORM 
       MOUSE ON 
     END IF 
   END IF 
 ELSE 
   CALL Fehler ("Es wurden keine Adressen gefunden, die den angegebenen Kriterien entsprechen!","")
   GOTO AnfSuAdr180998
 END IF 
endadr200504: 
 
 
 END FUNCTION 


SUB reoGekond()
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 FILE "gekond"
 
   LOCK ALL FILE "GEKOND"
   CALL FldAdd1("TZ6","NUM;999.00",0)
   CALL FldAdd1("TZ7","NUM;999.00",0)
   CALL FldAdd1("TZ8","NUM;999.00",0)
   CALL FldAdd1("TZ9","NUM;999.00",0)
   CALL FldAdd1("TZ10","NUM;999.00",0)
   CALL FldAdd1("TZ11","NUM;999.00",0)
   CALL FldAdd1("TZ12","NUM;999.00",0)
   CALL FldAdd1("TZD6","NUM;999.",0)
   CALL FldAdd1("TZD7","NUM;999.",0)
   CALL FldAdd1("TZD8","NUM;999.",0)
   CALL FldAdd1("TZD9","NUM;999.",0)
   CALL FldAdd1("TZD10","NUM;999.",0)
   CALL FldAdd1("TZD11","NUM;999.",0)
   CALL FldAdd1("TZD12","NUM;999.",0)
   CALL FldAdd1("PflegeZW","NMI;99.",0)
   CALL FldAdd1("Courtage","NUM;999.0000",0)
   CALL FldAdd1("AP","NUM;999.0000",0)
   CALL FldAdd1("SR","NUM;999.0000",0)
   CALL FldAdd1("PflegeProvi","NUM;999.0000",0)
   CALL FldAdd1("BWjn","TXT;1",0)
   CALL FldAdd1("VDjn","TXT;1",0)
   CALL FldAdd1("TZjn","TXT;1",0)
   CALL FldAdd1("PflegeJN","TXT;1",0)
   CALL FldAdd1("PauschaleJN","TXT;1",0)
   CALL FldAdd1("FormelJN","TXT;1",0)
   CALL FldAdd1("DynamikJN","TXT;1",0)
   CALL FldAdd1("MaximierungJN","TXT;1",0)
   CALL FldAdd1("APjn","TXT;1",0)
   CALL FldAdd1("CourtageJN","TXT;1",0)
   CALL FldAdd1("SRjn","TXT;1",0)
   CALL FldAdd1("CourtageZWjn","TXT;1",0)
   REM CALL FldAdd1("CourtHaftUnbeg","TXT;1",0)
   CALL FldAdd1("PflegeNachZahlw","TXT;1",0)
   CALL FldAdd1("CourtEinstellen","TXT;1",0)
   CALL FldAdd1("DMEinheit","NUM;,9999999.000000",0)
   CALL FldAdd1("Anpass","NUM;0.",1)
   CALL FldAdd1("Notiz","TXT;70",0)
   CALL FldAdd1("RechArt","NUM;0.",0)
   CALL FldAdd1("Faktor","NUM;,99999999.000000",0)
   CALL FldAdd1("FormelHaft","TXT;4000",0)
   CALL FldAdd1("QCodeGEVA","TXT;12",1)
   CALL FldAdd1("Gesellschaft","TXT;30",0)
   CALL FldAdd1("Sparte","TXT;60",0)
   CALL FldAdd1("Kurzname","TXT;30",0)
   CALL FldAdd1("QuickCodeGes","TXT;104",1)
   CALL FldAdd1("CodeVP","NUM;000000.",1)
   CALL FldAdd1("EuroEinheit","NUM;,9999999.000000",0)
   CALL FldAdd1("EUUmstellung","TXT;1",0)
   CALL FldAdd1("AFSKPauschJN","TXT;1",0)
   CALL FldAdd1("AFSKPausch","NUM;,9999999.00",0)
   CALL FldAdd1("VSVjn","TXT;1",0)
   CALL FldAdd1("VSV","NUM;999.00",0)
   CALL FldAdd1("nurEinh","TXT;1",0)
   CALL FldAdd1("EuroproEinh","NUM;,999999999.00",0)
   CALL FldAdd1("DynamikPjn","TXT;1",0)
   CALL FldAdd1("DynamikProz","NUM;999.0000",0)
   CALL FldAdd1("Betreujn","TXT;1",0)
   CALL FldAdd1("BetreuProz","NUM;999.0000",0)
   CALL FldAdd1("MWSTProvBN","TXT;1",0)
 
   SAVE FILE "GEKOND"
 FILE "gekond"
 SELECT FIRST LOCK 
 i% = 0
     WHILE NOT EOF ("GEKOND")
       i% = i% + 1
       j% = RECCOUNT ("GEKOND")
       SET STATUS LTRIM$ ( STR$ (i%,",999999999")) + " DatensÑtze in GEKOND geprÅft von " + LTRIM$ ( STR$ (j%,",999999999"))
       lfdnr$ = STR$ (lfdnr,"0000000")
       IF lfdnr.GEKOND < 1 THEN 
         lfdnr.GEKOND = SER ("GEKOND",1)
       END IF 
       QCodeGEVA$ = STR$ (Codege.gekond,"000000") + STR$ (Codeva.gekond,"000000")
       IF codevp.gekond < 1 THEN 
         IF EXISTS (QCodeGEVA$,QCodeGEVA.vprodukt) THEN 
           QCodeGEVA.gekond = STR$ (Codege.gekond,"000000") + STR$ (Codeva.gekond,"000000")
           SELECT KEY QCodeGEVA.gekond FILE "Vprodukt" INDEX QCodeGEVA.vprodukt
           codevp.gekond = codevp.vprodukt
           Gesellschaft.gekond = gesellschaft.vprodukt
           Sparte.gekond = sparte.vprodukt
           Kurzname.gekond = kurzname.vprodukt
           QuickCodeGes.gekond = STR$ (CodeMA.gekond,"000000") + UCASE$ (gesellschaft.gekond) + UCASE$ (sparte.gekond) + DATE$ (bwvon.gekond,"yyyymm0d")
         ELSE 
           codevp.gekond = 0
         END IF 
       ELSE 
         IF EXISTS (codevp.gekond,codevp.vprodukt) THEN 
           SELECT FIRST FILE "vprodukt" INDEX codevp.vprodukt
           SELECT KEY codevp.gekond FILE "vprodukt" INDEX codevp.vprodukt
           s1$ = STR$ (codevp.gekond,"000000") + "   vp " + STR$ (codevp.vprodukt,"000000") + " ge " + STR$ (codege.vprodukt,"000000") + " va " + STR$ (codeva.vprodukt,"000000")
           s2$ = Gesellschaft.vprodukt + "    " + sparte.vprodukt
           REM CALL Fehler(s1$,s2$)
           IF codege.gekond = codege.vprodukt AND codeva.gekond = codeva.vprodukt THEN 
             Gesellschaft.gekond = gesellschaft.vprodukt
             Sparte.gekond = sparte.vprodukt
             Kurzname.gekond = kurzname.vprodukt
             QuickCodeGes.gekond = STR$ (CodeMA.gekond,"000000") + UCASE$ (gesellschaft.gekond) + UCASE$ (sparte.gekond) + DATE$ (bwvon.gekond,"yyyymm0d")
           ELSE 
             IF EXISTS (QCodeGEVA$,QCodeGEVA.vprodukt) THEN 
               QCodeGEVA.gekond = STR$ (Codege.gekond,"000000") + STR$ (Codeva.gekond,"000000")
               SELECT KEY QCodeGEVA.gekond FILE "Vprodukt" INDEX QCodeGEVA.vprodukt
               codevp.gekond = codevp.vprodukt
               Gesellschaft.gekond = gesellschaft.vprodukt
               Sparte.gekond = sparte.vprodukt
               Kurzname.gekond = kurzname.vprodukt
               QuickCodeGes.gekond = STR$ (CodeMA.gekond,"000000") + UCASE$ (gesellschaft.gekond) + UCASE$ (sparte.gekond) + DATE$ (bwvon.gekond,"yyyymm0d")
             ELSE 
               codevp.gekond = 0
             END IF 
           END IF 
         ELSE 
           codevp.gekond = 0
         END IF 
       END IF 
       CALL QuickStore("gekond")
       SELECT NEXT LOCK FILE "gekond"
     WEND 
     CALL Fehler("Anpassung GEKOND beendet!","")
 END SUB 












 '      *************************
 '      ** Formular "MAKREDIT" **
 '      *************************
 '
  
SUB MAKREDIT()
 IF disabled%("MAKREDIT") THEN END SUB 
 CALL DFile(3,"KVERTRAG" + _fpw$)
 _codekre% = 0
 MOUSE OFF 
 _formend% = 0
 SET STATUS "Bereit"
 AKsub% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   AKsub% = 0
   IF FORM <> "MAKREDIT" THEN 
     SET HEADING title$ + " - Mitarbeiterkredit"
     OPEN FORM GPrjForm$ + "MAKREDIT"
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\provis.pdf"
     SET STATUS "Aktionen"
     CALL MNMAKredit()
     CALL MAKreditUPD()
     FORM 1
     SET DISPLAY ON 
   END IF 
   MENU ON 
   MOUSE ON 
   FILE "MAKredit"
   SET STATUS "Bereit"
   
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
 
   SELECT CASE AKsub%
   CASE 1
     REM -- zum einzelnen Kredit springen
     _codekre% = codekre.MAKredit
     FORM 2
     CALL MAKreditUPD()
   CASE 2
     REM -- zur KreditÅbersicht springen
     FORM 1
     CALL MAKreditUPD()
   CASE 3
     REM -- in einzelnen MAKREBUC - Satz gehen
     _codekre% = codekre.MAKredit
     _codebuc% = codebuc.MAKreBuc
     FORM 3
     CALL MAKreditUPD()
   CASE 4
     REM -- zurÅck zum einzelnen Kredit
     FORM 2
     CALL MAKreditUPD()
   CASE 5
     REM -- neu einzelînen MAKREDBUC
     CALL MAKredtBucNeu()
     CALL MAKreditUPD()
   CASE 6
     REM neu Kredit 
     CALL MAKredtNeu()
     FORM 2
     CALL MAKreditUPD()
   CASE 7
     REM Ausdruck KreditÅbersicht
     CALL KREDIT1(cuma%)
   CASE 8
     REM Ausdruck EinzeltsÑtze eines Kredites 
     CALL KREDIT2(cuma%)
   CASE 99
     SELECT CASE PAGE 
     CASE 2
       MENU OFF 
       CALL ButDesabled()
       MOUSE ON 
       ENTER Sache.MAKredit,0
       CALL ButEnabled()
       MENU ON 
     CASE 3
       MENU OFF 
       f.neu1.enabled = 0
       f.bearb1.enabled = 0
       f.zurueck1.enabled = 0
       ENTER gezahlterBetrag.makrebuc,0
       f.neu1.enabled = - 1
       f.bearb1.enabled = - 1
       f.zurueck1.enabled = - 1
     END SELECT 
   END SELECT 
 WEND 
 cuak% = 0
 IF FileChanged%("MAKredit") = 1 THEN CALL FStore("MAKredit")
 _formend% = 0
 END SUB 
  



SUB KREDIT2(ma1%)
 CALL PRep("KREDIT2")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,gezahlterBetrag.MAKREBUC AS "summe1%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP CodeKre.MAKREDIT,gezahlterBetrag.MAKREBUC AS "summe%"
 BEFORE GROUP CodeKre.MAKREDIT
     SET REPORT PAGE "H_CodeKre.MA003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeKre.MAKREDIT
     SET REPORT PAGE "F_CodeKre.MA003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 IF ma1% > 0 THEN 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.MAKREDIT AND CodeKre.MAKREDIT = CodeKre.MAKREBUC AND codema.maadr = ma1%
   ORDER REPORT Nachname.MAADR,QCodeMAKre.MAKREDIT,QCodeMAKreBuc.MAKREBUC
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.MAKREDIT AND CodeKre.MAKREDIT = CodeKre.MAKREBUC
   ORDER REPORT Nachname.MAADR,QCodeMAKre.MAKREDIT,QCodeMAKreBuc.MAKREBUC
   TO ASK 
 END IF 
 END SELECT 
 END SUB 
 




SUB KREDIT1(ma1%)

 CALL PRep("KREDIT1")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 IF ma% > 0 THEN 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.MAKREDIT AND codema.maadr = ma1%
   ORDER REPORT Nachname.MAADR,QCodeMAKre.MAKREDIT
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.MAKREDIT
   ORDER REPORT Nachname.MAADR,QCodeMAKre.MAKREDIT
   TO ASK 
 END SELECT 
 END SUB 
 
 ' MAKREDIT-Intro
 ' ======================================================================
 
SUB MAKreditIntro()
 MOUSE OFF 
 FILE "MAADR"
 INDEX codema.maadr
 FILE "MAKredit"
 INDEX CodeMA.MAKredit
 FILE "MAKreBuc"
 INDEX CodeKRE.MAKrebuc
 SELECT KEY cuma% FILE "maadr" INDEX codema.maadr
 codema1% = codema.maadr
 SELECT FORM KEY codema1% FILE "maadr" INDEX codema.maadr
 IF EXISTS (codema1%,codema.makredit) THEN 

   SELECT FIRST FILE "makredit" INDEX codema.makredit
   SELECT FORM KEY codema1% FILE "makredit" INDEX codema.makredit
   _codekre% = codekre.makredit
   SELECT FORM KEY _codekre% FILE "makrebuc" INDEX codekre.makrebuc
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' AKTIONEN Formular updaten
 ' ======================================================================
 
SUB MAKreditUPD()
 codema1% = cuma%
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 SELECT KEY cuma% FILE "maadr" INDEX codema.maadr
 SELECT FORM KEY codema1% FILE "maadr" INDEX codema.maadr
 FORM 
 IF EXISTS (codema1%,codema.makredit) THEN 
   IF PAGE = 1 THEN 
     SELECT FIRST FILE "makredit" INDEX codema.makredit
     SELECT FORM KEY codema1% FILE "makredit" INDEX codema.makredit
     FORM 
     _codekre% = codekre.makredit
     IF EXISTS (_codekre%,codekre.makrebuc) THEN 
       SELECT FIRST FILE "makrebuc" INDEX codekre.makrebuc
       SELECT FORM KEY _codekre% FILE "makrebuc" INDEX codekre.makrebuc
     END IF 
   FORM 
   END IF 
   IF PAGE = 2 THEN 
     SELECT FIRST FILE "makredit" INDEX codekre.makredit
     SELECT FORM KEY _codekre% FILE "makredit" INDEX codekre.makredit
     IF EXISTS (_codekre%,codekre.makrebuc) THEN 
       SELECT FIRST FILE "makrebuc" INDEX codekre.makrebuc
       SELECT FORM KEY _codekre% FILE "makrebuc" INDEX codekre.makrebuc
     END IF 
   END IF 
   IF PAGE = 3 THEN 
     SELECT FIRST FILE "makredit" INDEX codekre.makredit
     SELECT FORM KEY _codekre% FILE "makredit" INDEX codekre.makredit
     IF EXISTS (_codebuc%,codebuc.makrebuc) THEN 
       SELECT FIRST FILE "makrebuc" INDEX codebuc.makrebuc
       SELECT FORM KEY _codebuc% FILE "makrebuc" INDEX codebuc.makrebuc
     END IF 
   END IF 
 END IF 
 FORM 
 END SUB 
 
 ' Aktion neu
 ' ======================================================================
 
SUB MAKredtNeu()
 IF disabled%("MAKreditNEU") THEN END SUB 
 FILE "MAKredit"
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 CodeKre.MAKredit = SER ("MAKredit",1)
 _CodeKre% = CodeKre.MAKredit
 Codema.MAKredit = codema.maadr
 QCodeMAKre.MAKredit = STR$ (codema.makredit,"000000") + STR$ (codeKre.makredit,"000000")
 Sache.makredit = "NEU"
 CALL QuickStore ("makredit")
 SELECT FIRST FILE "makredit" INDEX CodeKre.MAKredit
 SELECT KEY _CodeKre% LOCK FILE "makredit" INDEX CodeKre.MAKredit
 AKsub% = 99
 FORM 
 END SUB 



SUB MAKredtBucNeu()
 IF disabled%("MAKreBucNEU") THEN END SUB 

 SELECT FIRST FILE "makredit" INDEX codekre.makredit
 SELECT KEY _codekre% FILE "makredit" INDEX codekre.makredit
 
 FILE "MAKreBuc"
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 aa% = CopyRecord%("MAKREDIT","MAKREBUC")
 CodeBUC.MAKreBuc = SER ("MAKreBUC",1)
 _CodeBUC% = CodeBUC.MAKreBuc
 Codema.MAKredit = cuma%
 CALL QuickStore("makrebuc")
 SELECT FIRST FILE "makrebuc" INDEX codebuc.makrebuc
 SELECT KEY _codebuc% LOCK FILE "makrebuc" INDEX codebuc.makrebuc
 FORM 
 AKsub% = 99
 FORM 
 END SUB 

 

SUB MAKredtNeu1()
 IF disabled%("MAKreditNEU") THEN END SUB 
 FILE "MAKredit"
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 CodeKre.MAKredit = SER ("MAKredit",1)
 Codema.MAKredit = codema.maadr
 QCodeMAKre.MAKredit = STR$ (codema.makredit,"000000") + STR$ (codeKre.makredit,"000000")
 Sache.makredit = "NEU"
 CALL QuickStore("makredit")
 FORM 
 END SUB 
 
 
 ' Aktion lîschen
 ' ======================================================================
 
SUB MAKreditLoe()
 cuak% = CodeAK.AKTIONEN
 REQUEST "Aktion wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   SELECT KEY cuak% LOCK FILE "AKTIONEN" INDEX CodeAK.AKTIONEN
   SELECT REMOVE FILE "AKTIONEN"
   MOUSE OFF 
   SET STATUS "Termine der Aktion werden gelîscht..."
   REMOVE FROM FILE GAkquiDat$ WHERE CodeAK.GAkquiDat$ = cuak%
   REM SELECT REMOVE 
   SELECT NEXT 
 END IF 
 SET STATUS "Bereit"
 MOUSE ON 
 FORM 
 END SUB 
 
 
 
SUB MNMAKredit()
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 




SUB Kvan14032005()
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"zeingan1" + _fpw$)
   FILE "kvertrag"
   INDEX lfdnr.kvertrag
   IF RECCOUNT ("kvertrag") > 0 THEN 
     SELECT FIRST LOCK 
   ELSE 
     SELECT LAST 
   END IF 
   a% = 0
   j% = RECCOUNT ("Kvertrag")
 
   REM wenn ttestFeld% = 0 dann wurde das Feld KuenCourt1 neu erfunden und muss jett entsprechend den Angaben in der ZE Datei
   REM gesetzt werden fÅr RealCash
     WHILE NOT EOF ("kvertrag")
       a% = a% + 1
       SET STATUS STR$ (a%,"999999") + "  von " + STR$ (j%,"999999") + " DatensÑtzen in KVERTRAG angepa·t"
       codevt% = lfdnr.kvertrag
       IF EXISTS (codevt%,codevt.zeingan1) THEN 
         FILE "zeingan1"
         INDEX codevt.zeingan1
         SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
         SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
         WHILE NOT EOF ("zeingan1") AND codevt.zeingan1 = codevt%
           IF kondart.zeingan1 = 0 AND gebuchtJN.zeingan1 = "J" THEN 
             REM FILE "kvertrag"
             REM SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
             gez_Abschlu·.kvertrag = "j"
             STORE FILE "kvertrag"
             SELECT LAST FILE "zeingan1"
           ELSE 
             IF kondart.zeingan1 = 1 AND gebuchtJN.zeingan1 = "J" THEN 
               REM FILE "kvertrag"
               REM SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
               KuenCourt1.kvertrag = "j"
               STORE FILE "kvertrag"
               SELECT LAST FILE "zeingan1"
             END IF 
           END IF 
           SELECT NEXT FILE "zeingan1"
         WEND 
       END IF 
       FILE "kvertrag"
       
       SELECT NEXT LOCK FILE "kvertrag"
     WEND 
     REM CALL Fehler("FERTIG!","")
 END SUB 


 '      *************************************************
 '      ** Routinen fÅr Suter_AFSK KVERTRAG**
 '      *************************************************
 ' wenn codevt%=0 dann so wie immer
 ' wenn codevt%>0 dann Sollstellung von KVERTRAG aus
SUB Sutor()
 CALL DFile(3,"AFSKSUT" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "AFSKSUT" WHERE codevt.AFSKSUT < 1
 MOUSE ON 
 CALL DFile(30,"KVERTRAG" + _fpw$)
 CALL DFile(20,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(30,"geadr" + _fpw$)
 CALL DFile(30,"sparten" + _fpw$)
 CALL DFile(30,"maadr" + _fpw$)
 CALL DFile(30,"maadrgru" + _fpw$)
 CALL DFile(3,"zeingan1" + _fpw$)
 codevt% = lfdnr.kvertrag
 IF FORM LIKE "PROVI*" THEN codevt% = 0
 FILE "AFSKSUT"
 INDEX codevt.AFSKSUT
 SELECT FIRST 
 _formend% = 0
 IF codevt% = 0 THEN maske$ = "EINGSUT1"
 IF codevt% <> 0 THEN 
   maske$ = "EINGSUT"
   IF NOT EXISTS (codevt%,codevt.AFSKSUT) THEN 
     CALL Fehler("Es existieren fÅr diesen Vertrag noch keine Sutor-DatensÑtze! ","")
     END SUB 
   END IF 
 END IF 
 MOUSE OFF 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Sutorimport"
     OPEN FORM GPrjForm$ + maske$
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\Sollstel.pdf"
     REM IF maske$ <> "EINGANGK" THEN SET FORM OFF Uebers$
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     lAussenstand$ = ""
     eingbei$ = ""
     CALL ZSutIntro1(codevt%)
     CALL MNSUTOR()
     SET STATUS "Sutorimport"
     IF RECCOUNT ("AFSKSUT") > 0 THEN CALL ZSutUpdate1(codesut.afsksut)
   END IF 
   FORM 
   MENU ON 
   MOUSE ON 
   ZEINsub% = 0
   REM IF RECCOUNT ("AFSKSUT") > 0 THEN CALL ZEISutUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF ZEINsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL ZSutPrev1()
   CASE CrsRight%,PgDn%
     CALL ZSutNext1()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZEINsub%
   CASE 1
     REM Suchen
     CALL ZSutSuch1()
     CALL ZSutIntro1(codevt.afsksut)
   CASE 2
     CALL ZSutPrev1()
   CASE 3
     IF maske$ = "EINGSUT" THEN 
       CALL ZSutDruck(codevt.AFSKSUT)
     ELSE 
       CALL ZSutDruck(0)
     END IF 
   CASE 4
     REM Lîschen
     codesut% = codesut.AFSKSUT
     codevt% = codevt.AFSKSUT
     REQUEST "Wollen Sie wirklich diese Sollstellung lîschen?","",135,req%
     IF req% = 1 THEN 
       SELECT KEY codesut% LOCK FILE "AFSKSUT" INDEX codesut.AFSKSUT
       SELECT REMOVE FILE "AFSKSUT"
       REQUEST "Sollstellung wurde gelîscht!","",2
       IF maske$ = "EINGSUT" THEN 
         IF EXISTS (codevt%,codevt.AFSKSUT) THEN 
           FILE "AFSKSUT"
           INDEX codesut.AFSKSUT
           SELECT FIRST 
           REM OPEN FORM maske$
           REM SET f = Superbase.Form
           SELECT FORM FIRST 
           FORM 
           CALL ZSutIntro1(codevt%)
           CALL ZSutUpdate1(codesut.afsksut)
           ZEINsub% = 0
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen zu diesem Vertrag!","")
           _formend% = 1
         END IF 
       ELSE 
         IF RECCOUNT ("AFSKSUT") > 0 THEN 
           IF EXISTS (codevt%,codevt.AFSKSUT) THEN 
             SELECT FIRST FILE "AFSKSUT" INDEX codesut.AFSKSUT
             SELECT FORM KEY codevt% FILE "AFSKSUT" INDEX codevt.AFSKSUT
             FORM 
             CALL ZSutIntro1(codevt%)
             CALL ZSutUpdate1(codesut.afsksut)
             ZEINsub% = 0
           ELSE 
             SELECT FORM FIRST FILE "AFSKSUT" INDEX codesut.AFSKSUT
             FORM 
           END IF 
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen!","")
           _formend% = 1
         END IF 
       END IF 
     END IF 
   CASE 5
     REM neu
     CALL AFSKSUTNeu()
     MOUSE ON 
     codevt% = codevt.AFSKSUT
     ENTER Bewertung.AFSKSUT,0
     CALL ZSutIntro1(codevt%)
     FORM 
     REM BewertungEU.AFSKSUT = VAL ( STR$ (Bewertung.AFSKSUT / Umrechnung.AFSKSUT,"99999999.00"))
     REM CALL QuickStore("AFSKSUT")
     REM ENTER END 
   CASE 6
     REM edit
     codevt% = codevt.AFSKSUT
     ENTER Betrag.AFSKSUT,0
     CALL ZSutIntro1(codevt%)
     FORM 
   CASE 7
     CALL ZSutNext1()
   END SELECT 
   MENU ON 
 WEND 
 REM CALL ZEINbuchung1( - 1)
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
 
  
 
 
SUB ZSutIntro1(codevt%)
 MOUSE OFF 
 FILE "AFSKSUT"
 IF codevt% < 1 THEN 
   INDEX codevt.AFSKSUT
   SELECT FIRST FILE "AFSKSUT" INDEX codesut.AFSKSUT
   codevt% = codevt.AFSKSUT
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "AFSKSUT" INDEX codevt.AFSKSUT
   REM IF codeko.kvertrag <> 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
 ELSE 
   INDEX codevt.AFSKSUT
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "AFSKSUT" INDEX codevt.AFSKSUT
   REM IF codeko.kvertrag <> 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
 END IF 
 FORM 
 END SUB 
 
 
SUB ZSutUpdate1(codesut%)
 REM 25012000
 REM codeaz$ = codeaz.AFSKSUT
 codevt% = codevt.AFSKSUT
 SELECT FIRST FILE "AFSKSUT" INDEX codevt.AFSKSUT
 IF codesut% <> 0 AND codevt.AFSKSUT <> 0 THEN 
   REM SELECT FORM KEY CodeVT.AFSKSUT FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT KEY codesut% FILE "AFSKSUT" INDEX codesut.AFSKSUT
   REM SELECT KEY CodeVT.AFSKSUT FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT FORM KEY codevt% FILE "AFSKSUT" INDEX codevt.AFSKSUT
   FORM 
 END IF 
 FORM 
 END SUB 
 
 
SUB MNSUTOR()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
 ' AFSKSUT Eintrag zurÅck
 ' =======================================================================
 
SUB ZSutPrev1()
 IF RECCOUNT ("AFSKSUT") > 0 THEN 
   IF MOD ("AFSKSUT") OR NEW ("AFSKSUT") THEN CALL FStore("AFSKSUT")
   codesut% = codesut.AFSKSUT
   SELECT FORM PREVIOUS 
   IF EOF ("AFSKSUT") THEN 
     REQUEST "Dateianfang erreicht!","",2
     SELECT FORM KEY codesut% INDEX codesut.AFSKSUT
   END IF 
 END IF 
 IF RECCOUNT ("AFSKSUT") > 0 THEN CALL ZSutUpdate1(0)
 FORM 
 END SUB 
 
 
 ' AFSKSUT vor
 ' =======================================================================
 
SUB ZSutNext1()
 IF RECCOUNT ("AFSKSUT") > 0 THEN 
   IF MOD ("AFSKSUT") OR NEW ("AFSKSUT") THEN CALL FStore("AFSKSUT")
   codesut% = codesut.AFSKSUT
   SELECT FORM NEXT 
   IF EOF ("AFSKSUT") THEN 
     REQUEST "Dateiende erreicht!","",2
     SELECT FORM KEY codesut% INDEX codesut.AFSKSUT
   END IF 
 END IF 
 IF RECCOUNT ("AFSKSUT") > 0 THEN CALL ZSutUpdate1(0)
 FORM 
 END SUB 


SUB EinZSut1()
 codesut% = codesut.AFSKSUT
 SELECT KEY codesut% FILE "AFSKSUT" INDEX codesut.AFSKSUT
 REM SELECT FORM KEY codesut% FILE "AFSKSUT" INDEX codesut.AFSKSUT
 REM Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 REM kondart% = kondart.AFSKSUT
 FORM 
 END SUB 
 

SUB ZSutSuch1()
 codesut% = codesut.AFSKSUT
 opt&% = VAL (ReadConfig$("PROVIS","ZSutopt"))
 IF opt&% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 CREATE DIALOG "ZEINSUCH",0,0,228,164,"Sollstellungen","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Satz suchen mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu durchsuchende Datenmenge durch die wahlfreie Angabe des FÑlligkeitsdatum einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,64,76,10,0,"Suche Åber..."
 ADD DIALOG "ZEINSUCH",3,58,74,149,12,0,"Vertrags-/Policennummer",1,opt&%
 REM ADD DIALOG "ZEINSUCH",3,58,86,148,12,0,"Gesellschaft",2,opt&%
 ADD DIALOG "ZEINSUCH",5,38,107,96,9,0,"Zeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,120,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,119,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,120,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,119,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZSutvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZSutbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZSutopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"ZahlungseingÑnge","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten DatensÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
   ELSE 
     suge% = GetCodeGE%(0)
     IF suge% = 0 THEN ok% = 0
   END IF 
   IF ok% THEN 
     REM -- Suche durchfÅhren
     cfile$ = FILE 
     IF von$ = "" THEN von% = DAYS ("1.1.1901") ELSE von% = DAYS (von$)
     IF bis$ = "" THEN bis% = DAYS ("31.12.2920") ELSE bis% = DAYS (bis$)
     DIM Auswahl$(1)
     IF RECCOUNT ("AFSKSUT") > 30000 THEN 
       DIM Buchungen$(30000)
     ELSE 
       DIM Buchungen$( RECCOUNT ("AFSKSUT"))
     END IF 
     FILE "AFSKSUT"
     MOUSE OFF 
     IF opt&% = 1 THEN 
       INDEX QuickVSNR.AFSKSUT
       SELECT FIRST 
       sVSNR$ = VSNRPack$(VSNR$)
       SELECT KEY sVSNR$ FILE "AFSKSUT" INDEX QuickVSNR.AFSKSUT
       a% = 0
       WHILE QuickVSNR.AFSKSUT LIKE sVSNR$ + "*" AND NOT EOF ("AFSKSUT")
         IF datum1.AFSKSUT >= von% AND datum1.AFSKSUT <= bis% THEN 
           x$ = ""
           yy$ = PAD$ ( LTRIM$ ( STR$ (betrag.AFSKSUT,",99999999.00")),15) + " " + Statustxt.AFSKSUT
           Buchungen$(a%) = PAD$ (VS_Nr.AFSKSUT,30) + CHR$ (9) + PAD$ ( DATE$ (datum1.AFSKSUT,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (codesut.AFSKSUT,"000000")
           a% = a% + 1
           SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
         END IF 
         IF a% > 29998 THEN 
           CALL Fehler ("Die Sutordatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
           SELECT LAST FILE "AFSKSUT"
         ELSE 
           SELECT NEXT FILE "AFSKSUT" INDEX QuickVSNR.AFSKSUT
         END IF 
       WEND 
     ELSE 
       INDEX CodeGE.AFSKSUT
       SELECT FIRST 
       SELECT KEY suge% FILE "AFSKSUT" INDEX CodeGE.AFSKSUT
       a% = 0
       WHILE CodeGE.AFSKSUT = suge% AND NOT EOF ("AFSKSUT")
         IF datum1.AFSKSUT >= von% AND datum1.AFSKSUT <= bis% THEN 
           x$ = ""
           yy$ = PAD$ ( LTRIM$ ( STR$ (betrag.AFSKSUT,",99999999.00")),15) + " " + statustxt.AFSKSUT
           Buchungen$(a%) = PAD$ (VS_Nr.AFSKSUT,30) + CHR$ (9) + PAD$ ( DATE$ (datum1.AFSKSUT,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (codesut.AFSKSUT,"000000")
           a% = a% + 1
           SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
         END IF 
         IF a% > 29998 THEN 
           CALL Fehler ("Die Sutordatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
           SELECT LAST FILE "AFSKSUT"
         ELSE 
           SELECT NEXT FILE "AFSKSUT" INDEX CodeGE.AFSKSUT
        END IF 
       WEND 
     END IF 
     IF a% <> 0 THEN 
       REM -- Prompt ermitteln
       prompt$ = Buchungen$(0)
       FOR b% = 1 TO a% - 1
         IF Buchungen$(b%) < prompt$ THEN prompt$ = Buchungen$(b%)
       NEXT b%
       IF opt&% = 1 THEN 
         caption$ = "Suche Åber Vertrags-/Policennummer..."
       ELSE 
         caption$ = "Suche Åber Gesellschaft..."
       END IF 
       MOUSE ON 
       CREATE DIALOG "DZ3",0,0,350,300,caption$,"MS Sans Serif",8
       ADD DIALOG "DZ3",4,0,0,349,27,0,""
       ADD DIALOG "DZ3",5,36,11,179,9,0,"Bitte wÑhlen Sie den gesuchten Zahlungseingang aus:"
       REM ADD DIALOG "DZ3",9,8,12,21,23,2
       ADD DIALOG "DZ3",5,36,27,260,9,0,"Vertragsnummer                       Datum               Betrag       "
       ADD DIALOG "DZ3",7,36,40,290,240,130,2,Buchungen$,Auswahl$,prompt$
       ADD DIALOG "DZ3",1,88,280,55,15,1,"&OK",1,1
       ADD DIALOG "DZ3",1,146,280,55,15,0,"&Abbrechen",0,0
       DIALOG "DZ3",req3%
       REMOVE DIALOG "DZ3"
       IF req3% = 1 THEN 
         codesut% = VAL ( RIGHT$ (Auswahl$(0),6))
       END IF 
     ELSE 
       CALL Fehler("Es konnten keine entsprechenden SutorsÑtze gefunden werden!","")
     END IF 
     FILE cfile$
   END IF 
 END IF 
 IF codesut% <> 0 THEN 
   SELECT FORM KEY codesut% FILE "AFSKSUT" INDEX codesut.AFSKSUT
   SELECT KEY codevt.AFSKSUT FILE "kvertrag" INDEX lfdnr.kvertrag
   CALL ZSutUpdate1(codevt.AFSKSUT)
 END IF 
 FORM 
 MOUSE ON 
 END SUB 




 
 REM Sutor drucken
SUB ZSutDruck(codevt%)
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechneten Summen richtig sein wird(z.B. DM+US$=?)!"
       REM CALL Fehler(t1$,t2$)
       REM REQUEST "öbersicht in EURO drucken?","",130,req1%
       req1% = 1
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
 gesell$ = ""
 suge% = 0
 codesut% = codesut.AFSKSUT
 IF codevt% <> 0 THEN 
   VSNR1$ = VS_Nr.kvertrag
 ELSE 
   VSNR1$ = ""
 END IF 
 opt&% = 0
 IF codevt% = 0 THEN opt&% = VAL (ReadConfig$("PROVIS","ZSutopt"))
 IF opt&% = 0 AND codevt% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZSutvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZSutbis")
 IF bis$ = "leer" THEN bis$ = ""
 CREATE DIALOG "ZEINSUCH",0,0,228,164,"Sutor","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Satz drucken mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des FÑlligkeitsdatum einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,54,76,50,0,"Druck Åber..."
 IF codevt% = 0 THEN 
   ADD DIALOG "ZEINSUCH",3,58,66,149,12,0,"Vertrags-/Policennummer",1,opt&%
   REM ADD DIALOG "ZEINSUCH",3,58,76,148,12,0,"Gesellschaft",2,opt&%
   ADD DIALOG "ZEINSUCH",3,58,86,148,12,0,"keine EinschrÑnkung",3,opt&%
 END IF 
 ADD DIALOG "ZEINSUCH",5,38,107,96,9,0,"Buchungszeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,120,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,119,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,120,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,119,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZSutvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZSutbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZSutopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"Sutor","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten DatensÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
     VSNR1$ = VSNR$
     VSNR$ = VSNR$ + "*"
 
   ELSE 
     IF opt&% = 2 THEN 
       suge% = GetCodeGE%(0)
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY suge% FILE "geadr" INDEX codege.geadr
       gesell$ = gesellschaft.geadr
       IF suge% < 1 THEN ok% = 0
     END IF 
   END IF 
 END IF 
 IF ok% = 0 THEN END SUB 
 von0$ = von$
 bis0$ = bis$
 IF von$ = "" THEN von% = 0 ELSE von% = DAYS (von$)
 IF bis$ = "" THEN bis% = DAYS ("31.12.2920") ELSE bis% = DAYS (bis$)
 
 
 CALL PRep("SUTDRE")
  REPORT ON Betrag.AFSKSUT AS "BewSum%",CodeSut.AFSKSUT AS "anz%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO zsutdrend19110101
 ueberschr0$ = "Sutor-DatensÑtze " + drwaehr$
 
 IF gesell$ <> "" THEN 
   ueberschr0$ = ueberschr0$ + " fÅr Gesellschaft " + gesell$
 ELSE 
   IF codevt% <> 0 THEN 
     ueberschr0$ = ueberschr0$ + " fÅr Vertrag " + VSNR1$
   END IF 
 END IF 
 IF von0$ <> "" THEN 
   ueberschr1$ = "im Zeitraum von " + von0$
   IF bis0$ <> "" THEN 
     ueberschr1$ = ueberschr1$ + " bis " + bis0$
   END IF 
 ELSE 
   IF bis0$ <> "" THEN 
     ueberschr1$ = "im Zeitraum bis " + bis0$
   END IF 
 END IF 
 IF von0$ = "" AND bis0$ = "" THEN 
   ueberschr1$ = "alle DatensÑtze ohne ZeitraumbeschrÑnkung"
 END IF 
 SET QUERY ON 
 SET QUERY LOCK OFF 
 IF codevt% <> 0 THEN 
     a$ = "adressen"
     k$ = "Kvertrag"
     z$ = "AFSKSUT"
   SELECT ;
     WHERE codevt.z$ = codevt% AND Datum1.z$ >= von% AND Datum1.z$ <= bis%
     ORDER REPORT Datum1.AFSKSUT
     TO ASK 
   END SELECT 
 ELSE 
   IF opt&% = 3 THEN 
     REM alles drucken
     SELECT ;
     WHERE Datum1.AFSKSUT >= von% AND Datum1.AFSKSUT <= bis%
     ORDER REPORT Datum1.AFSKSUT,VS_Nr.AFSKSUT
     TO ASK 
     END SELECT 
   ELSE 
     a$ = "adressen"
     k$ = "Kvertrag"
     REM nach Gesellschaft suchen
     SELECT ;
 WHERE CodeVT.AFSKSUT = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND codege.geadr = suge% AND Datum1.AFSKSUT >= von% AND Datum1.AFSKSUT <= bis%
     ORDER REPORT Gesellschaft.GEADR,Datum1.AFSKSUT,VS_Nr.AFSKSUT
     TO ASK 
     END SELECT 
   END IF 
 END IF 
zsutdrend19110101: 
 ON ERROR GOTO ErrorHandler
 END SUB 
  



 REM ************************************************************************************************************
 REM                            AFSK- Provisionsliste
 REM                            11052002
 REM ************************************************************************************************************
 
SUB AFSKPLI1(vondat$,bisdat$,allprov$,ma%)
 REM CALL Fehler("AFSK-Liste","")
 REM REPORT USING "AFSKPLI1"
 CALL PRep("AFSKPLI1")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsliste in " + Waehrung.stamm
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP QNameCodema.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%"
 BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrAFSKPLI1
   IF ma% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
       END SELECT 
     ELSE 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
       END SELECT 
     END IF 
   END IF 
   IF ma% > 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
       END SELECT 
     ELSE 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
       END SELECT 
     END IF 
   END IF 
ErrAFSKPLI1: 
   ON ERROR GOTO ErrorHandler 
 REQUEST "MS Excel-Export-Dateien erstellen?","",130,req1%
 IF req1% <> 1 THEN GOTO AFSKend17022003E
 ON ERROR GOTO afskvexp170220031
 MAKE DIRECTORY _netpath$ + "\AGEXPORT"
afskvexp170220031: 
 ON ERROR GOTO ErrorHandler 
 DIRECTORY _netpath$ + "\AGEXPORT"
 IF OPEN ("TEST1A") THEN CLOSE FILE "TEST1A"
 IF EXISTS ("TEST1A.SBF") THEN DELETE "TEST1A.*"
 IF ma% = 0 THEN 
   Superbase.QueryOptimizer = - 1:REM                     Menu:  QuickReport
   SET QUERY HEADING "",0,0
   SELECT Nachname.MAADR AS "NachnameAG",Vorname.MAADR AS "VornameAG",Agenturnr.MAADR,Steuernummer.maadr,VTAgentur.BUCHUNG1,UnterVermNr.BUCHUNG1,Nachname.BUCHUNG1 AS "NachnameKU",
   Vorname.BUCHUNG1 AS "VornameKU",Gesellschaft.BUCHUNG1,Sparte.BUCHUNG1,Antragsnr.BUCHUNG1,VS_NR.Buchung1,VS_Beginn.BUCHUNG1,
   Bewertung2EU.BUCHUNG1,Datum.BUCHUNG1,BetragEU.BUCHUNG1,SREU.BUCHUNG1,Buchungstext.BUCHUNG1
   REPORT 
   WHERE CodeMA.BUCHUNG1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
   ORDER REPORT Nachname.MAADR,Vorname.MAADR,Datum.BUCHUNG1,Nachname.BUCHUNG1,Vorname.BUCHUNG1,Gesellschaft.BUCHUNG1,Sparte.BUCHUNG1
   TO FILE _netpath$ + "\AGEXPORT\TEST1A"
   END SELECT 
   Superbase.QueryOptimizer = 0
 ELSE 
   Superbase.QueryOptimizer = - 1:REM                     Menu:  QuickReport
   SET QUERY HEADING "",0,0
   SELECT Nachname.MAADR AS "NachnameAG",Vorname.MAADR AS "VornameAG",Agenturnr.MAADR,Steuernummer.maadr,VTAgentur.BUCHUNG1,UnterVermNr.BUCHUNG1,Nachname.BUCHUNG1 AS "NachnameKU",
   Vorname.BUCHUNG1 AS "VornameKU",Gesellschaft.BUCHUNG1,Sparte.BUCHUNG1,Antragsnr.BUCHUNG1,VS_NR.Buchung1,VS_Beginn.BUCHUNG1,
   Bewertung2EU.BUCHUNG1,Datum.BUCHUNG1,BetragEU.BUCHUNG1,SREU.BUCHUNG1,Buchungstext.BUCHUNG1
   REPORT 
   WHERE CodeMA.BUCHUNG1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND codema.buchung1 = ma%
   ORDER REPORT Nachname.MAADR,Vorname.MAADR,Datum.BUCHUNG1,Nachname.BUCHUNG1,Vorname.BUCHUNG1,Gesellschaft.BUCHUNG1,Sparte.BUCHUNG1
   TO FILE _netpath$ + "\AGEXPORT\TEST1A"
   END SELECT 
   Superbase.QueryOptimizer = 0
 END IF 
 FILE "TEST1A"
 CREATE INDEX ON Agenturnr
 INDEX Agenturnr
 SELECT FIRST FILE "TEST1A" INDEX Agenturnr
 agold$ = Agenturnr.TEST1A
 agneu$ = ""
 REM NUMBASE "00000000"
 MOUSE OFF 
 WHILE NOT EOF ("TEST1A")
   IF agold$ <> agneu$ THEN 
     REM Export durchfÅhren
     SELECT WHERE Agenturnr.TEST1A = agold$
     agname% = VAL (agold$)
     agfile$ = STR$ (agname%,"00000000") + ".XLS"
     SET STATUS Nachnameag + " " + vornameag + " wird exportiert nach " + _netpath$ + "\AGEXPORT\" + agfile$
     REM CALL Fehler(Nachnameag + " " + vornameag + " wird exportiert nach " + agfile$,"")
     IF EXISTS (agfile$) THEN DELETE agfile$
     Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
     Superbase.Converters.SBF.SourceFile = "TEST1A"
     Superbase.Converters.SBF.Descending = 0
     Superbase.Converters.SBF.Merge = 0
     Superbase.Converters.SBF.LogErrors = 0
     Superbase.Converters.SBF.MultiResponse = 0
     Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
     Superbase.Converters.XLS.DestFile = _netpath$ + "\AGEXPORT\" + agfile$
     Superbase.Converters.XLS.StartRow = 2
     Superbase.Converters.XLS.StartCol = 1
     Superbase.Converters.XLS.EndRow = - 1
     Superbase.Converters.XLS.EndCol = - 1
     Superbase.Converters.XLS.UseLabels = - 1
     Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
 
     agneu$ = Agenturnr.TEST1A
     agold$ = Agenturnr.TEST1A
     SELECT WHERE 
     
   ELSE 
     SELECT NEXT FILE "TEST1A" INDEX Agenturnr
   END IF 
   agneu$ = Agenturnr.TEST1A
 WEND 
 MOUSE ON 
 CALL Fehler("EXPORT BEENDET","")
AFSKend17022003E: 
 ON ERROR GOTO ErrorHandler 
 DIRECTORY _netpath$
 END SUB 
 


 '      *************************************************
 '      ** Routinen fÅr PSP_AFSK KVERTRAG**
 '      *************************************************
 ' wenn codevt%=0 dann so wie immer
 ' wenn codevt%>0 dann Sollstellung von KVERTRAG aus
SUB PSP()
 CALL DFile(3,"AFSPSP" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "AFSPSP" WHERE codevt.AFSPSP < 1
 MOUSE ON 
 CALL DFile(30,"KVERTRAG" + _fpw$)
 CALL DFile(20,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(30,"geadr" + _fpw$)
 CALL DFile(30,"sparten" + _fpw$)
 CALL DFile(30,"maadr" + _fpw$)
 CALL DFile(30,"maadrgru" + _fpw$)
 CALL DFile(3,"zeingan1" + _fpw$)
 codevt% = lfdnr.kvertrag
 IF FORM LIKE "PROVI*" THEN codevt% = 0
 FILE "AFSPSP"
 INDEX codevt.AFSPSP
 SELECT FIRST 
 _formend% = 0
 IF codevt% = 0 THEN maske$ = "EINGPSP1"
 IF codevt% <> 0 THEN 
   maske$ = "EINGPSP"
   IF NOT EXISTS (codevt%,codevt.AFSPSP) THEN 
     REM CALL Fehler("Es existieren fÅr diesen Vertrag noch keine Sutor-DatensÑtze! ","")
     REM END SUB 
     knr% = codeku.kvertrag
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
     cuvt% = lfdnr.kvertrag
     CALL AFSPSPNeu()
   END IF 
 END IF 
 MOUSE OFF 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - PSPimport"
     OPEN FORM GPrjForm$ + maske$
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\provis.pdf"
     REM IF maske$ <> "EINGANGK" THEN SET FORM OFF Uebers$
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     lAussenstand$ = ""
     eingbei$ = ""
     CALL ZPSPIntro1(codevt%)
     CALL MNPSP()
     SET STATUS "PSPimport"
     IF RECCOUNT ("AFSPSP") > 0 THEN CALL ZPSPUpdate1(codesut.AFSPSP)
   END IF 
   FORM 
   MENU ON 
   MOUSE ON 
   ZEINsub% = 0
   REM IF RECCOUNT ("AFSPSP") > 0 THEN CALL ZEISutUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF ZEINsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL ZPSPPrev1()
   CASE CrsRight%,PgDn%
     CALL ZPSPNext1()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZEINsub%
   CASE 1
     REM Suchen
     CALL ZPSPSuch1()
     CALL ZPSPIntro1(codevt.AFSPSP)
   CASE 2
     CALL ZPSPPrev1()
   CASE 3
     IF maske$ = "EINGSUT" THEN 
       CALL ZPSPDruck(codevt.AFSPSP)
     ELSE 
       CALL ZPSPDruck(0)
     END IF 
   CASE 4
     REM Lîschen
     codesut% = codesut.AFSPSP
     codevt% = codevt.AFSPSP
     REQUEST "Wollen Sie wirklich diesen Datensatz lîschen?","",135,req%
     IF req% = 1 THEN 
       SELECT KEY codesut% LOCK FILE "AFSPSP" INDEX codesut.AFSPSP
       SELECT REMOVE FILE "AFSPSP"
       REQUEST "Datensatz wurde gelîscht!","",2
       IF maske$ = "EINGSUT" THEN 
         IF EXISTS (codevt%,codevt.AFSPSP) THEN 
           FILE "AFSPSP"
           INDEX codesut.AFSPSP
           SELECT FIRST 
           REM OPEN FORM maske$
           REM SET f = Superbase.Form
           SELECT FORM FIRST 
           FORM 
           CALL ZPSPIntro1(codevt%)
           CALL ZPSPUpdate1(codesut.AFSPSP)
           ZEINsub% = 0
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen zu diesem Vertrag!","")
           _formend% = 1
         END IF 
       ELSE 
         IF RECCOUNT ("AFSPSP") > 0 THEN 
           IF EXISTS (codevt%,codevt.AFSPSP) THEN 
             SELECT FIRST FILE "AFSPSP" INDEX codesut.AFSPSP
             SELECT FORM KEY codevt% FILE "AFSPSP" INDEX codevt.AFSPSP
             FORM 
             CALL ZPSPIntro1(codevt%)
             CALL ZPSPUpdate1(codesut.AFSPSP)
             ZEINsub% = 0
           ELSE 
             SELECT FORM FIRST FILE "AFSPSP" INDEX codesut.AFSPSP
             FORM 
           END IF 
         ELSE 
           CALL Fehler("Es existieren keine weiteren Sollstellungen!","")
           _formend% = 1
         END IF 
       END IF 
     END IF 
   CASE 5
     REM neu
     knr% = codeku.kvertrag
     SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
     SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
     cuvt% = lfdnr.kvertrag
     CALL AFSPSPNeu()
     MOUSE ON 
     codevt% = codevt.AFSPSP
     ENTER Sparbetrag.AFSPSP,0
     CALL ZPSPIntro1(codevt%)
     FORM 
     REM BewertungEU.AFSPSP = VAL ( STR$ (Bewertung.AFSPSP / Umrechnung.AFSPSP,"99999999.00"))
     REM CALL QuickStore("AFSPSP")
     REM ENTER END 
   CASE 6
     REM edit
     codevt% = codevt.AFSPSP
     ENTER Sparbetrag.AFSPSP,0
     CALL ZPSPIntro1(codevt%)
     FORM 
   CASE 7
     CALL ZPSPNext1()
   END SELECT 
   MENU ON 
 WEND 
 REM CALL ZEINbuchung1( - 1)
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
 
SUB AFSPSPNeu()
 BLANK FILE "AFSPSP"
 codesut% = SER ("AFSPSP",1)
 codesut.AFSPSP = codesut%
 codevt.afspsp = lfdnr.kvertrag
 vs_Nr.AFSPSP = vs_nr.kvertrag
 Antragsnr.afspsp = Antragsnr.kvertrag
 Statustxt.AFSPSP = "Handeingabe"
 datum1.afspsp = TODAY 
 QuickVSNR.AFSPSP = VSNRPack$(VS_Nr.KVERTRAG)
 QuickAntrNr.AFSPSP = VSNRPack$(Antragsnr.kvertrag)
 codesort.AFSPSP = VSNRPack$(VS_NR.AFSPSP) + DATE$ (datum1.AFSPSP,"yyyymm0d") + "00"
 STORE FILE "AFSPSP"
 SELECT FIRST FILE "AFSPSP" INDEX codesut.afspsp
 SELECT KEY codesut% LOCK FILE "AFSPSP" INDEX codesut.afspsp

 END SUB 
 
 
SUB ZPSPIntro1(codevt%)
 MOUSE OFF 
 FILE "AFSPSP"
 IF codevt% < 1 THEN 
   INDEX codevt.AFSPSP
   SELECT FIRST FILE "AFSPSP" INDEX codesut.AFSPSP
   codevt% = codevt.AFSPSP
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "AFSPSP" INDEX codevt.AFSPSP
   REM IF codeko.kvertrag <> 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
 ELSE 
   INDEX codevt.AFSPSP
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "AFSPSP" INDEX codevt.AFSPSP
   REM IF codeko.kvertrag <> 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
 END IF 
 FORM 
 END SUB 
 
 
SUB ZPSPUpdate1(codesut%)
 REM 25012000
 REM codeaz$ = codeaz.AFSPSP
 codevt% = codevt.AFSPSP
 SELECT FIRST FILE "AFSPSP" INDEX codevt.AFSPSP
 IF codesut% <> 0 AND codevt.AFSPSP <> 0 THEN 
   REM SELECT FORM KEY CodeVT.AFSPSP FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT KEY codesut% FILE "AFSPSP" INDEX codesut.AFSPSP
   REM SELECT KEY CodeVT.AFSPSP FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT FORM KEY codevt% FILE "AFSPSP" INDEX codevt.AFSPSP
   FORM 
 END IF 
 FORM 
 END SUB 
 
 
SUB MNPSP()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
 
 
SUB EinZPSP1()
 codesut% = codesut.AFSPSP
 SELECT KEY codesut% FILE "AFSPSP" INDEX codesut.AFSPSP
 REM SELECT FORM KEY codesut% FILE "AFSPSP" INDEX codesut.AFSPSP
 REM Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 REM kondart% = kondart.AFSPSP
 FORM 
 END SUB 
 
 
 REM Sutor drucken
SUB ZPSPDruck(codevt%)
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechneten Summen richtig sein wird(z.B. DM+US$=?)!"
       REM CALL Fehler(t1$,t2$)
       REM REQUEST "öbersicht in EURO drucken?","",130,req1%
       req1% = 1
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
 gesell$ = ""
 suge% = 0
 codesut% = codesut.AFSPSP
 IF codevt% <> 0 THEN 
   VSNR1$ = VS_Nr.kvertrag
 ELSE 
   VSNR1$ = ""
 END IF 
 opt&% = 0
 IF codevt% = 0 THEN opt&% = VAL (ReadConfig$("PROVIS","ZPSPopt"))
 IF opt&% = 0 AND codevt% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZPSPvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZPSPbis")
 IF bis$ = "leer" THEN bis$ = ""
 CREATE DIALOG "ZEINSUCH",0,0,228,164,"Sutor","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Satz drucken mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des FÑlligkeitsdatum einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,54,76,50,0,"Druck Åber..."
 IF codevt% = 0 THEN 
   ADD DIALOG "ZEINSUCH",3,58,66,149,12,0,"Vertrags-/Policennummer",1,opt&%
   REM ADD DIALOG "ZEINSUCH",3,58,76,148,12,0,"Gesellschaft",2,opt&%
   ADD DIALOG "ZEINSUCH",3,58,86,148,12,0,"keine EinschrÑnkung",3,opt&%
 END IF 
 ADD DIALOG "ZEINSUCH",5,38,107,96,9,0,"Buchungszeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,120,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,119,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,120,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,119,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZPSPvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZPSPbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZPSPopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"Sutor","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten DatensÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
     VSNR1$ = VSNR$
     VSNR$ = VSNR$ + "*"
 
   ELSE 
     IF opt&% = 2 THEN 
       suge% = GetCodeGE%(0)
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY suge% FILE "geadr" INDEX codege.geadr
       gesell$ = gesellschaft.geadr
       IF suge% < 1 THEN ok% = 0
     END IF 
   END IF 
 END IF 
 IF ok% = 0 THEN END SUB 
 von0$ = von$
 bis0$ = bis$
 IF von$ = "" THEN von% = 0 ELSE von% = DAYS (von$)
 IF bis$ = "" THEN bis% = DAYS ("31.12.2920") ELSE bis% = DAYS (bis$)
 
 
 CALL PRep("SUTDRE")
  REPORT ON Betrag.AFSPSP AS "BewSum%",CodeSut.AFSPSP AS "anz%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO ZPSPdrend19110101
 ueberschr0$ = "Sutor-DatensÑtze " + drwaehr$
 
 IF gesell$ <> "" THEN 
   ueberschr0$ = ueberschr0$ + " fÅr Gesellschaft " + gesell$
 ELSE 
   IF codevt% <> 0 THEN 
     ueberschr0$ = ueberschr0$ + " fÅr Vertrag " + VSNR1$
   END IF 
 END IF 
 IF von0$ <> "" THEN 
   ueberschr1$ = "im Zeitraum von " + von0$
   IF bis0$ <> "" THEN 
     ueberschr1$ = ueberschr1$ + " bis " + bis0$
   END IF 
 ELSE 
   IF bis0$ <> "" THEN 
     ueberschr1$ = "im Zeitraum bis " + bis0$
   END IF 
 END IF 
 IF von0$ = "" AND bis0$ = "" THEN 
   ueberschr1$ = "alle DatensÑtze ohne ZeitraumbeschrÑnkung"
 END IF 
 SET QUERY ON 
 SET QUERY LOCK OFF 
 IF codevt% <> 0 THEN 
     a$ = "adressen"
     k$ = "Kvertrag"
     z$ = "AFSPSP"
   SELECT ;
     WHERE codevt.z$ = codevt% AND Datum1.z$ >= von% AND Datum1.z$ <= bis%
     ORDER REPORT Datum1.AFSPSP
     TO ASK 
   END SELECT 
 ELSE 
   IF opt&% = 3 THEN 
     REM alles drucken
     SELECT ;
     WHERE Datum1.AFSPSP >= von% AND Datum1.AFSPSP <= bis%
     ORDER REPORT Datum1.AFSPSP,VS_Nr.AFSPSP
     TO ASK 
     END SELECT 
   ELSE 
     a$ = "adressen"
     k$ = "Kvertrag"
     REM nach Gesellschaft suchen
     SELECT ;
 WHERE CodeVT.AFSPSP = lfdNr.K$ AND codeku.k$ = codeku.a$ AND CodeGE.K$ = CodeGE.GEADR AND codege.geadr = suge% AND Datum1.AFSPSP >= von% AND Datum1.AFSPSP <= bis%
     ORDER REPORT Gesellschaft.GEADR,Datum1.AFSPSP,VS_Nr.AFSPSP
     TO ASK 
     END SELECT 
   END IF 
 END IF 
ZPSPdrend19110101: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 


SUB ZPSPSuch1()
 codesut% = codesut.AFSPSP
 opt&% = VAL (ReadConfig$("PROVIS","ZPSPopt"))
 IF opt&% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 CREATE DIALOG "ZEINSUCH",0,0,228,164,"Sollstellungen","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Satz suchen mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu durchsuchende Datenmenge durch die wahlfreie Angabe des FÑlligkeitsdatum einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,64,76,10,0,"Suche Åber..."
 ADD DIALOG "ZEINSUCH",3,58,74,149,12,0,"Vertrags-/Policennummer",1,opt&%
 REM ADD DIALOG "ZEINSUCH",3,58,86,148,12,0,"Gesellschaft",2,opt&%
 ADD DIALOG "ZEINSUCH",5,38,107,96,9,0,"Buchungszeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,120,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,119,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,120,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,119,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZPSPvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZPSPbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZPSPopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"ZahlungseingÑnge","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten DatensÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
   ELSE 
     suge% = GetCodeGE%(0)
     IF suge% = 0 THEN ok% = 0
   END IF 
   IF ok% THEN 
     REM -- Suche durchfÅhren
     cfile$ = FILE 
     IF von$ = "" THEN von% = DAYS ("1.1.1901") ELSE von% = DAYS (von$)
     IF bis$ = "" THEN bis% = DAYS ("31.12.2920") ELSE bis% = DAYS (bis$)
     DIM Auswahl$(1)
     IF RECCOUNT ("AFSPSP") > 30000 THEN 
       DIM Buchungen$(30000)
     ELSE 
       DIM Buchungen$( RECCOUNT ("AFSPSP"))
     END IF 
     FILE "AFSPSP"
     MOUSE OFF 
     IF opt&% = 1 THEN 
       INDEX QuickVSNR.AFSPSP
       SELECT FIRST 
       sVSNR$ = VSNRPack$(VSNR$)
       SELECT KEY sVSNR$ FILE "AFSPSP" INDEX QuickVSNR.AFSPSP
       a% = 0
       WHILE QuickVSNR.AFSPSP LIKE sVSNR$ + "*" AND NOT EOF ("AFSPSP")
         IF FÑlligkeit.AFSPSP >= von% AND FÑlligkeit.AFSPSP <= bis% THEN 
           x$ = ""
           yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.AFSPSP + sr.AFSPSP,",99999999.00")),15) + " " + Buchungstext.AFSPSP
           Buchungen$(a%) = PAD$ (VS_Nr.AFSPSP,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.AFSPSP,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + SPACE$ (40) + STR$ (codesut.AFSPSP,"000000")
           a% = a% + 1
           SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
         END IF 
         IF a% > 29998 THEN 
           CALL Fehler ("Die Sollstellungsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
           SELECT LAST FILE "AFSPSP"
         ELSE 
           SELECT NEXT FILE "AFSPSP" INDEX QuickVSNR.AFSPSP
         END IF 
       WEND 
     ELSE 
       INDEX CodeGE.AFSPSP
       SELECT FIRST 
       SELECT KEY suge% FILE "AFSPSP" INDEX CodeGE.AFSPSP
       a% = 0
       WHILE CodeGE.AFSPSP = suge% AND NOT EOF ("AFSPSP")
         IF FÑlligkeit.AFSPSP >= von% AND FÑlligkeit.AFSPSP <= bis% THEN 
           x$ = ""
           yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.AFSPSP + sr.AFSPSP,",99999999.00")),15) + " " + Buchungstext.AFSPSP
           Buchungen$(a%) = PAD$ (VS_Nr.AFSPSP,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.AFSPSP,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (codesut.AFSPSP,"000000")
           a% = a% + 1
           SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
         END IF 
         IF a% > 29998 THEN 
           CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
           SELECT LAST FILE "AFSPSP"
         ELSE 
           SELECT NEXT FILE "AFSPSP" INDEX CodeGE.AFSPSP
        END IF 
       WEND 
     END IF 
     IF a% <> 0 THEN 
       REM -- Prompt ermitteln
       prompt$ = Buchungen$(0)
       FOR b% = 1 TO a% - 1
         IF Buchungen$(b%) < prompt$ THEN prompt$ = Buchungen$(b%)
       NEXT b%
       IF opt&% = 1 THEN 
         caption$ = "Suche Åber Vertrags-/Policennummer..."
       ELSE 
         caption$ = "Suche Åber Gesellschaft..."
       END IF 
       MOUSE ON 
       CREATE DIALOG "DZ3",0,0,350,300,caption$,"MS Sans Serif",8
       ADD DIALOG "DZ3",4,0,0,349,27,0,""
       ADD DIALOG "DZ3",5,36,11,179,9,0,"Bitte wÑhlen Sie den gesuchten Zahlungseingang aus:"
       REM ADD DIALOG "DZ3",9,8,12,21,23,2
       ADD DIALOG "DZ3",5,36,27,260,9,0,"Vertragsnummer                       Datum               Bewertung     "
       ADD DIALOG "DZ3",7,36,40,290,240,130,2,Buchungen$,Auswahl$,prompt$
       ADD DIALOG "DZ3",1,88,280,55,15,1,"&OK",1,1
       ADD DIALOG "DZ3",1,146,280,55,15,0,"&Abbrechen",0,0
       DIALOG "DZ3",req3%
       REMOVE DIALOG "DZ3"
       IF req3% = 1 THEN 
         codesut% = VAL ( RIGHT$ (Auswahl$(0),6))
       END IF 
     ELSE 
       CALL Fehler("Es konnten keine entsprechenden Sollstellungen gefunden werden!","")
     END IF 
     FILE cfile$
   END IF 
 END IF 
 IF codesut% <> 0 THEN 
   SELECT FORM KEY codesut% FILE "AFSPSP" INDEX codesut.AFSPSP
   SELECT KEY codevt.AFSPSP FILE "kvertrag" INDEX lfdnr.kvertrag
   CALL ZPSPUpdate1(codevt.AFSPSP)
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' AFSPSP Eintrag zurÅck
 ' =======================================================================
 
SUB ZPSPPrev1()
 IF RECCOUNT ("AFSPSP") > 0 THEN 
   IF MOD ("AFSPSP") OR NEW ("AFSPSP") THEN CALL FStore("AFSPSP")
   codesut% = codesut.AFSPSP
   SELECT FORM PREVIOUS 
   IF EOF ("AFSPSP") THEN 
     REQUEST "Dateianfang erreicht!","",2
     SELECT FORM KEY codesut% INDEX codesut.AFSPSP
   END IF 
 END IF 
 IF RECCOUNT ("AFSPSP") > 0 THEN CALL ZPSPUpdate1(0)
 FORM 
 END SUB 
 
 
 ' AFSPSP vor
 ' =======================================================================
 
SUB ZPSPNext1()
 IF RECCOUNT ("AFSPSP") > 0 THEN 
   IF MOD ("AFSPSP") OR NEW ("AFSPSP") THEN CALL FStore("AFSPSP")
   codesut% = codesut.AFSPSP
   SELECT FORM NEXT 
   IF EOF ("AFSPSP") THEN 
     REQUEST "Dateiende erreicht!","",2
     SELECT FORM KEY codesut% INDEX codesut.AFSPSP
   END IF 
 END IF 
 IF RECCOUNT ("AFSPSP") > 0 THEN CALL ZPSPUpdate1(0)
 FORM 
 END SUB 
 
 

 REM **********************************************************************************************************
 REM *                   FSSOnline Import                                                                     *
 REM **********************************************************************************************************
SUB FSSOnlineImp()
 CALL DFile(2,"OFFICE\" + "ADRHIS" + _fpw$)
 CALL DFile(2,"OFFICE\" + "ORT" + _fpw$)
 IF GADRDat$ LIKE "ADRESSEN" THEN 
   IF disabled%("ADRESSEN") THEN END SUB 
 END IF 
 IF GADRDat$ LIKE "ADRE1" THEN 
   IF disabled%("ADRE1") THEN END SUB 
 END IF 
 IF GADRDat$ LIKE "BCKONTAK" THEN 
   IF disabled%("BCKONTAK") THEN END SUB 
 END IF 
 IF GBENE% THEN 
   CALL DFile(2,"OFFICE\" + "ADRE1" + _fpw$)
   CALL DFile(2,"OFFICE\" + "AKQUI1" + _fpw$)
   CALL DFile(2,"OFFICE\" + "TELADR1" + _fpw$)
   CALL DFile(2,"OFFICE\" + "DOKADR1" + _fpw$)
 END IF 
 IF intverw.stamm = "j" OR GADRDat$ LIKE "BCKONTAK" THEN 
   CALL DFile(2,"OFFICE\" + "BCKONTAK" + _fpw$)
   CALL DFile(2,"OFFICE\" + "AKQUIBCK" + _fpw$)
   CALL DFile(2,"OFFICE\" + "TELBCK" + _fpw$)
   CALL DFile(2,"OFFICE\" + "DOKBCK" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKQUISE" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKTIONEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 CALL DFile(2,"OFFICE\adrgrup" + _fpw$)
 IF OPEN ("adrtemp") THEN 
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   REM CLOSE FILE "ADRTEMP"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 CALL DFile(2,"color" + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 IF _projekt$ LIKE "PROV*" OR GAufrufproj$ LIKE "PROVIS" THEN 
   IF EXISTS (_netpath$ + "PROVIS\kvertrag.sbf") THEN CALL DFile(3,"KVERTRAG" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\vermoeg.sbf") THEN CALL DFile(3,"VERMOEG" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\vorgang.sbf") THEN CALL DFile(3,"VORGANG" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\maadr.sbf") THEN CALL DFile(3,"MAADR" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\kukto.sbf") THEN CALL DFile(3,"KUKTO" + _fpw$)
   IF EXISTS (_netpath$ + "office\kvhis.sbf") THEN CALL DFile(2,"OFFICE\KVHIS" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\geadr.sbf") THEN CALL DFile(3,"geadr" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\sparten.sbf") THEN CALL DFile(3,"sparten" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\spgruppe.sbf") THEN CALL DFile(3,"spgruppe" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\vpspezko.sbf") THEN CALL DFile(3,"vpspezko" + _fpw$)
   IF EXISTS (_netpath$ + "PROVIS\vprodukt.sbf") THEN CALL DFile(3,"vprodukt" + _fpw$)

   IF GAFSK$ LIKE "TRUE" THEN 
     IF EXISTS (_netpath$ + "PROVIS\afsksut.sbf") THEN CALL DFile(3,"AFSKSUT" + _fpw$)
   END IF 
 END IF 
 IF MAKLER$ = "TRUE" AND (_projekt$ LIKE "PROV*" OR GAufrufproj$ LIKE "PROV*") THEN 
   IF EXISTS (_netpath$ + "PROVIS\inkstamm.sbf") THEN CALL DFile(3,"INKSTAMM" + _fpw$)
 END IF 
 fehl% = 0
 pp$ = _netpath$ + "FSS-Imp\"
 CALL Fehler("FSS-Online-Import","Es werden jetzt die XML-Importdateien aus dem Verzeichnis " + pp$ + " ausgewertet und importiert, die Sicherheitskopie der verarbeiteten Dateien befindet sich dann im Verzeichnis " + pp$ + "backup.xml\")
 REQUEST "Soll der Import gestartet werden?","",130,req%
 IF req% <> 1 THEN GOTO end210420051
 REM Start Import
 MOUSE OFF 
 cdir$ = DIRECTORY 
 DIRECTORY pp$
 IF EXISTS (pp$ + "ready.ini") THEN DELETE pp$ + "ready.ini"
 REM GOTO w210420053
 ON ERROR GOTO w210420052
 a% = CALL ("ShellExecute",0,"open",pp$ + "FSSImp.exe","","",1)
 WHILE NOT EXISTS (pp$ + "ready.ini")
   WAIT FOR 1
 WEND 
 CALL Fehler("Einlesen durch FSSImp.exe beendet!","")
 REQUEST "Einlesen durch FSSImp.exe beendet!","",2
 GOTO w210420053
w210420052: 
 fehl% = 1
 CALL Fehler("Es ist ein Fehler aufgetreten!","Bitte prÅfen Sie ob die Datei " + pp$ + "FSSImp.exe   vorhanden ist!")
 GOTO end210420051
w210420053: 
 ON ERROR GOTO ErrorHandler
 REM feststellen welche INI-Dateien vorhanden sind
 DIM inidat$(10000)
 FILLARRAY inidat$,5,"*.ini"
 FOR a% = 0 TO 9999
   IF inidat$(a%) LIKE "ready.ini" THEN GOTO w210420054
   IF inidat$(a%) = "" THEN 
     a% = 10000
     GOTO w210420054
   END IF 
   REM Verarbeitung der Dateien
   inid$ = inidat$(a%)
   CALL FSSVerarb(pp$ + inid$)
w210420054: 
 NEXT a%


end210420051: 
 DIRECTORY cdir$
 END SUB 


 REM Verarbeitung der einzelnen umgewandelten FSS-Online-Import-Ini Dateien
 REM inid$=Dateiname der zu verarbeitenden Datei
SUB FSSVerarb(inid1$)
 REM Spartennummer
 snr$ = ReadDestiIBM$("DATA","snr",inid1$)
 snr% = VAL (snr$)
 REM Tarifcode
 tnr$ = ReadDestiIBM$("DATA","tnr",inid1$)
 tnr% = VAL (tnr$)
 REM Antragsnummer
 vnr$ = ReadDestiIBM$("DATA","vnr",inid1$)
 REM Gesellschaftsname
 gkurz$ = ReadDestiIBM$("DATA","gkurz",inid1$)
 strasse$ = ReadDestiIBM$("DATA","strasse",inid1$)
 
 REM Feststellung der Sparte
 SELECT CASE snr%
   CASE 1010
     REM KFZ Versicherung
     IF tnr% = 1 THEN 
       REM PKW Versicherung
         REM Vertrag an Hand der Antragsnummer suchen
         eingab$ = ""
         eingab2$ = "fss" + vnr$
         nvt% = 0
         REM viab%=1 sorgt dafÅr, das ohne Anzeige von Dialog geprÅft wird
         viab% = 1
         REM nvt% = GetVertrag%(0)
         nvt% = GetAntrag%(0)
         viab% = 0
         IF nvt% > 0 THEN 
           REQUEST "Vertrag wird aktualisiert","",2
           cuvt% = nvt%
           SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
           SELECT KEY cuvt% FILE "kvertrag" INDEX lfdnr.kvertrag
           knr% = codeku.kvertrag
         END IF 
         IF nvt% = 0 THEN 
           CALL fssadr(inid1$)
           CALL fssvtneu(inid1$,gkurz$,"KFZ-PKW-Versicherung")
         END IF 
         IF knr% <> 0 AND cuvt% <> 0 THEN 
           REM Kunde und Vertrag vorhanden, jetzt die Spartensachen in Vertrag eintragen
           CALL fsskfz(inid1$)
         END IF 
     END IF 

   CASE 1020
     REM Rechtsschutzversicherungen
     IF tnr% = 1020 THEN 
       REM Privat- und Berufs-RS
     END IF 
     IF tnr% = 1021 THEN 
       REM Privat-, Berufs, Verkehrs-RS
     END IF 
     IF tnr% = 1022 THEN 
       REM Verkehrs-RS
     END IF 
     IF tnr% = 1023 THEN 
       REM EigentÅmer- und Mieter-RS
     END IF 
     IF tnr% = 1024 THEN 
       REM Vermieter-RS
     END IF 
   CASE 1040
     REM Haftpflichtversicherungen
     IF tnr% = 1040 THEN 
       REM Privathaftpflichtversicherung
     END IF 
     IF tnr% = 1041 THEN 
       REM Hundhalterhaftpflicht
     END IF 
     IF tnr% = 1042 THEN 
       REM GewÑsserschadenhaftpflicht
     END IF 
     IF tnr% = 1043 THEN 
       REM Pferdehalterhaftpflicht
     END IF 
     IF tnr% = 1044 THEN 
       REM Bauherrnhaftpflicht
     END IF 
     IF tnr% = 1045 THEN 
       REM Haus- und Grundbesitzerhaftp.
     END IF 
     IF tnr% = 1046 THEN 
       REM Jagdhaftpflicht
     END IF 
   CASE 1050
     REM Hausratversicherungen
     IF tnr% = 1050 THEN 
       REM 
     END IF 
   CASE 1060
     REM WohngebÑudeversicherung
     IF tnr% = 1060 THEN 
       REM 
     END IF 
   CASE 1070
     REM Unfallversicherung
     IF tnr% = 1070 THEN 
       REM 
     END IF 

  REM Lebensversicherungen

   CASE 1110
     REM Kapitaltarife
     IF tnr% = 1110 THEN 
       REM Gemischte Versicherung
     END IF 
   CASE 1120
     REM Kapitaltarife
     IF tnr% = 1111 THEN 
       REM Gemischte Versicherung mB
     END IF 

   CASE 1130
     REM Risikotarife
     IF tnr% = 1120 THEN 
       REM Risikotarif konstante VS
     END IF 
 
   CASE 1140
     REM Risikotarife
     IF tnr% = 1121 THEN 
       REM Risikotarif konstante VS mB
     END IF 
 
   CASE 1150
     REM Risikotarife
     IF tnr% = 1140 THEN 
       REM SBV
     END IF 
  
   CASE 1160
     REM Rententarife
     IF tnr% = 1130 THEN 
       REM aufg. Rente laufender Beitrag
     END IF 

   CASE 1170
     REM Rententarife
     IF tnr% = 1131 THEN 
       REM sofortbeginnende Rente
     END IF 
 
   CASE 1180
     REM Fondspolice
     IF tnr% = 1180 THEN 
       REM Fondspolice mit lfd. Beitrag
     END IF 
 
   CASE 1190
     REM Fîrderrente
     IF tnr% = 1190 THEN 
       REM Fîrderrente
     END IF 

 REM Krankenversicherungen

   CASE 1210
     REM Private Krankenversicherungen
     IF tnr% = 1210 THEN 
       REM Vollversicherung
     END IF 
  
   CASE 1220
     REM Private Krankenversicherungen
     IF tnr% = 1220 THEN 
       REM StationÑre Zusatzversicherung
     END IF 
     IF tnr% = 1221 THEN 
       REM Erweiterte Zusatzversicherung
     END IF 
 

    CASE 1230
     REM Krankentagegeld
     IF tnr% = 1222 THEN 
       REM Krankentagegeld
     END IF 
     IF tnr% = 1223 THEN 
       REM Krankenhaustagegeld
     END IF 
 

    CASE 1240
     REM Auslandsreise-KV
     IF tnr% = 1240 THEN 
       REM Auslandsreise-KV
     END IF 

   CASE 1250
     REM Gesetzliche KV (GKV)
     IF tnr% = 1250 THEN 
       REM Gesetzliche KV (GKV)
     END IF 

 END SELECT 
 END SUB 


SUB fsskfz(inid1$)
 vnr$ = ReadDestiIBM$("DATA","vnr",inid1$)
 REM Spartennummer
 snr$ = ReadDestiIBM$("DATA","snr",inid1$)
 snr% = VAL (snr$)
 gnr$ = ReadDestiIBM$("DATA","gnr",inid1$)
 gkurz$ = ReadDestiIBM$("DATA","gkurz",inid1$)
 REM Tarifcode
 tnr$ = ReadDestiIBM$("DATA","tnr",inid1$)
 tnr% = VAL (tnr$)
 datum$ = ReadDestiIBM$("DATA","datum",inid1$)
 antragsart$ = ReadDestiIBM$("DATA","antragsart",inid1$)
 anrede$ = ReadDestiIBM$("DATA","anrede",inid1$)
 titel$ = ReadDestiIBM$("DATA","titel",inid1$)
 vorname$ = ReadDestiIBM$("DATA","vorname",inid1$)
 name$ = ReadDestiIBM$("DATA","name",inid1$)
 strasse$ = ReadDestiIBM$("DATA","strasse",inid1$)
 plz$ = ReadDestiIBM$("DATA","plz",inid1$)
 ort$ = ReadDestiIBM$("DATA","ort",inid1$)
 gebdat$ = ReadDestiIBM$("DATA","gebdat",inid1$)
 fstand$ = ReadDestiIBM$("DATA","fstand",inid1$)
 geschlecht$ = ReadDestiIBM$("DATA","geschlecht",inid1$)
 nation$ = ReadDestiIBM$("DATA","nation",inid1$)
 beruf$ = ReadDestiIBM$("DATA","beruf",inid1$)
 taetigkeit$ = ReadDestiIBM$("DATA","taetigkeit",inid1$)
 telefonprivat$ = ReadDestiIBM$("DATA","telefonprivat",inid1$)
 telefonberufl$ = ReadDestiIBM$("DATA","telefonberuflich",inid1$)
 erreichbarkei$ = ReadDestiIBM$("DATA","erreichbarkeit",inid1$)
 telefax$ = ReadDestiIBM$("DATA","telefax",inid1$)
 email$ = ReadDestiIBM$("DATA","email",inid1$)
 kontovorname$ = ReadDestiIBM$("DATA","kontovorname",inid1$)
 kontoname$ = ReadDestiIBM$("DATA","kontoname",inid1$)
 kto$ = ReadDestiIBM$("DATA","kto",inid1$)
 blz$ = ReadDestiIBM$("DATA","blz",inid1$)
 bank$ = ReadDestiIBM$("DATA","bank",inid1$)
 zahlart$ = ReadDestiIBM$("DATA","zahlart",inid1$)
 
 v_gnr$ = ReadDestiIBM$("DATA","v_gnr",inid1$)
 v_gkurz$ = ReadDestiIBM$("DATA","v_gkurz",inid1$)
 v_kuend$ = ReadDestiIBM$("DATA","v_kuend",inid1$)
 v_versnr$ = ReadDestiIBM$("DATA","v_versnr",inid1$)
 v_anzschaden$ = ReadDestiIBM$("DATA","v_anzschaden",inid1$)
 v_schadensumme$ = ReadDestiIBM$("DATA","v_schadensumme",inid1$)
 v_besch$ = ReadDestiIBM$("DATA","v_besch",inid1$)
 vbeginn$ = ReadDestiIBM$("DATA","vbeginn",inid1$)
 zahlweise$ = ReadDestiIBM$("DATA","zahlweise",inid1$)
 vdauer$ = ReadDestiIBM$("DATA","vdauer",inid1$)
 tarifart$ = ReadDestiIBM$("DATA","tarifart",inid1$)
 waehrung$ = ReadDestiIBM$("DATA","waehrung",inid1$)
 beitrag$ = ReadDestiIBM$("DATA","beitrag",inid1$)
 agrabatt_kh$ = ReadDestiIBM$("DATA","agenturrabatt_kh",inid1$)
 agrabatt_vk$ = ReadDestiIBM$("DATA","agenturrabatt_vk",inid1$)
 agrabatt_tk$ = ReadDestiIBM$("DATA","agenturrabatt_tk",inid1$)
 wagniskz$ = ReadDestiIBM$("DATA","kfz_wagniskz",inid1$)
 hersteller$ = ReadDestiIBM$("DATA","kfz_hersteller",inid1$)
 herstellername$ = ReadDestiIBM$("DATA","kfz_herstellername",inid1$)
 typ$ = ReadDestiIBM$("DATA","kfz_typ",inid1$)
 typname$ = ReadDestiIBM$("DATA","kfz_typname",inid1$)
 hubraum$ = ReadDestiIBM$("DATA","kfz_hubraum",inid1$)
 leistung_kw$ = ReadDestiIBM$("DATA","kfz_leistung_kw",inid1$)
 leistung_ps$ = ReadDestiIBM$("DATA","kfz_leistung_ps",inid1$)
 fgnummer$ = ReadDestiIBM$("DATA","kfz_fgnummer",inid1$)
 kennzort$ = ReadDestiIBM$("DATA","kfz_kennzort",inid1$)
 kennza$ = ReadDestiIBM$("DATA","kfz_kennza",inid1$)
 kennzn$ = ReadDestiIBM$("DATA","kfz_kennzn",inid1$)
 erstzulassung$ = ReadDestiIBM$("DATA","kfz_erstzulassung",inid1$)
 zulassungvn$ = ReadDestiIBM$("DATA","kfz_zulassungvn",inid1$)
 neuwert$ = ReadDestiIBM$("DATA","kfz_neuwert",inid1$)
 zeitwert$ = ReadDestiIBM$("DATA","kfz_zeitwert",inid1$)
 zbn$ = ReadDestiIBM$("DATA","kfz_zbn",inid1$)
 zbezirk$ = ReadDestiIBM$("DATA","kfz_zbezirk",inid1$)
 khdeckungsart$ = ReadDestiIBM$("DATA","kfz_khdeckungsart",inid1$)
 khsfklasse$ = ReadDestiIBM$("DATA","kfz_khsfklasse",inid1$)
 khbeitragsatz$ = ReadDestiIBM$("DATA","kfz_khbeitragsatz",inid1$)
 khbeitrag$ = ReadDestiIBM$("DATA","kfz_khbeitrag",inid1$)
 khtypklasse$ = ReadDestiIBM$("DATA","kfz_khtypklasse",inid1$)
 khregionalkl$ = ReadDestiIBM$("DATA","kfz_khregionalkl",inid1$)
 tkdeckungsart$ = ReadDestiIBM$("DATA","kfz_tkdeckungsart",inid1$)
 tksfklasse$ = ReadDestiIBM$("DATA","kfz_tksfklasse",inid1$)
 tkbeitragsatz$ = ReadDestiIBM$("DATA","kfz_tkbeitragsatz",inid1$)
 tkbeitrag$ = ReadDestiIBM$("DATA","kfz_tkbeitrag",inid1$)
 tkregionalkl$ = ReadDestiIBM$("DATA","kfz_tkregionalkl",inid1$)
 tktypklasse$ = ReadDestiIBM$("DATA","kfz_tktypklasse",inid1$)
 vkdeckungsart$ = ReadDestiIBM$("DATA","kfz_vkdeckungsart",inid1$)
 vksfklasse$ = ReadDestiIBM$("DATA","kfz_vksfklasse",inid1$)
 vkbeitragsatz$ = ReadDestiIBM$("DATA","kfz_vkbeitragsatz",inid1$)
 vkbeitrag$ = ReadDestiIBM$("DATA","kfz_vkbeitrag",inid1$)
 vkregionalkl$ = ReadDestiIBM$("DATA","kfz_vkregionalkl",inid1$)
 vktypklasse$ = ReadDestiIBM$("DATA","kfz_vktypklasse",inid1$)
 schutzbrflst$ = ReadDestiIBM$("DATA","kfz_schutzbriefleistungen",inid1$)
 fahrleistung$ = ReadDestiIBM$("DATA","kfz_fahrleistung",inid1$)
 aktueller_km$ = ReadDestiIBM$("DATA","kfz_aktueller_km",inid1$)
 nutzung$ = ReadDestiIBM$("DATA","kfz_nutzung",inid1$)
 abstellplatz$ = ReadDestiIBM$("DATA","kfz_abstellplatz",inid1$)
 abschliessbar$ = ReadDestiIBM$("DATA","kfz_abschliessbar",inid1$)
 fahrerkreis$ = ReadDestiIBM$("DATA","kfz_fahrerkreis",inid1$)
 gebdatfahrer1$ = ReadDestiIBM$("DATA","kfz_gebdatfahrer1",inid1$)
 gebdatfahrer2$ = ReadDestiIBM$("DATA","kfz_gebdatfahrer2",inid1$)
 wegfahrsperre$ = ReadDestiIBM$("DATA","kfz_wegfahrsperre",inid1$)
 vorfuehrwagen$ = ReadDestiIBM$("DATA","kfz_vorfuehrwagen",inid1$)
 zweitwagen$ = ReadDestiIBM$("DATA","kfz_zweitwagen",inid1$)
 vnnatperson$ = ReadDestiIBM$("DATA","kfz_vnnatperson",inid1$)
 bahncard$ = ReadDestiIBM$("DATA","kfz_bahncard",inid1$)
 jahreskarte$ = ReadDestiIBM$("DATA","kfz_jahreskarte",inid1$)
 straining$ = ReadDestiIBM$("DATA","kfz_straining",inid1$)
 wgv$ = ReadDestiIBM$("DATA","kfz_wgv",inid1$)
 wgv_ges$ = ReadDestiIBM$("DATA","kfz_wgv_ges",inid1$)
 bspv$ = ReadDestiIBM$("DATA","kfz_bspv",inid1$)
 vnhalter$ = ReadDestiIBM$("DATA","kfz_vnhalter",inid1$)
 khschaden$ = ReadDestiIBM$("DATA","kfz_khschaden",inid1$)
 tkschaden$ = ReadDestiIBM$("DATA","kfz_tkschaden",inid1$)
 vkschaden$ = ReadDestiIBM$("DATA","kfz_vkschaden",inid1$)
 wohnung$ = ReadDestiIBM$("DATA","kfz_wohnung",inid1$)
 beruf$ = ReadDestiIBM$("DATA","kfz_beruf",inid1$)
 arbeitgeber$ = ReadDestiIBM$("DATA","kfz_arbeitgeber",inid1$)
 berufbereich$ = ReadDestiIBM$("DATA","kfz_berufbereich",inid1$)
 arbeitsverh$ = ReadDestiIBM$("DATA","kfz_arbeitsverhaeltnis",inid1$)
 jahrefe$ = ReadDestiIBM$("DATA","kfz_jahrefe",inid1$)
 fscheinerwerb$ = ReadDestiIBM$("DATA","kfz_fscheinerwerb",inid1$)
 erwerbfe$ = ReadDestiIBM$("DATA","kfz_erwerbfe",inid1$)
 anzkinder$ = ReadDestiIBM$("DATA","kfz_anzkinder",inid1$)
 gebdatkind1$ = ReadDestiIBM$("DATA","kfz_gebdatkind1",inid1$)
 gebdatkind2$ = ReadDestiIBM$("DATA","kfz_gebdatkind2",inid1$)
 saisonstart$ = ReadDestiIBM$("DATA","kfz_saisonstart",inid1$)
 saisonende$ = ReadDestiIBM$("DATA","kfz_saisonende",inid1$)
 tarifgr$ = ReadDestiIBM$("DATA","kfz_tarifgr",inid1$)
 gebdat$ = ReadDestiIBM$("DATA","kfz_gebdat",inid1$)
 geschlecht$ = ReadDestiIBM$("DATA","kfz_geschlecht",inid1$)
 zahlungsart$ = ReadDestiIBM$("DATA","kfz_zahlungsart",inid1$)
 pltbereich$ = ReadDestiIBM$("DATA","kfz_pltbereich",inid1$)
 erstbesitzer$ = ReadDestiIBM$("DATA","kfz_erstbesitzer",inid1$)
 staatsang$ = ReadDestiIBM$("DATA","kfz_staatsang",inid1$)
 verheiratet$ = ReadDestiIBM$("DATA","kfz_verheiratet",inid1$)
 berufcode$ = ReadDestiIBM$("DATA","kfz_berufcode",inid1$)
 arbgebcode$ = ReadDestiIBM$("DATA","kfz_arbeitgebercode",inid1$)
 schutzbrief$ = ReadDestiIBM$("DATA","kfz_schutzbrief",inid1$)
 kuendigvorvers$ = ReadDestiIBM$("DATA","kfz_kuendigvorvers",inid1$)
 finanzierung$ = ReadDestiIBM$("DATA","kfz_finanzierung",inid1$)
 fahrgebiet$ = ReadDestiIBM$("DATA","kfz_fahrgebiet",inid1$)
 software$ = ReadDestiIBM$("DATA","software",inid1$)
 
 REM aktualisieren der Vertragsdaten
 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
 SELECT KEY cuvt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
 Notiz.kvertrag = "Vorversicherung:" + CHR$ (13) + CHR$ (10)
 Notiz.kvertrag = Notiz.kvertrag + "Vorgesellschaft:" + v_gkurz$ + " / KÅndigung durch: " + v_kuend$ + " / VsNummer:" + v_versnr$ + CHR$ (13) + CHR$ (10)
 Notiz.kvertrag = Notiz.kvertrag + "Anzahl SchÑden:" + v_anzschaden$ + " / Schadensumme:" + v_schadensumme$ + CHR$ (13) + CHR$ (10)
 Notiz.kvertrag = Notiz.kvertrag + v_besch$
 KFZ_WagKZ.kvertrag = wagniskz$
 Typ_Nr.kvertrag = typ$
 Fabrikat.kvertrag = herstellername$
 FahrzeugstÑrke.kvertrag = VAL (leistung_kw$)
 Fahrgestell_Nr.kvertrag = fgnummer$
 Kennzeichen.kvertrag = kennzort$
 Erstzlassung.kvertrag = erstzulassung$
 Fahrzeugwert.kvertrag = VAL (zeitwert$) * 1000
 KFZRegionZo.kvertrag = zbezirk$
 TypklasseHP.kvertrag = khtypklasse$
 HV_SFR.kvertrag = VAL (khbeitragsatz$)
 KFZ_VSBH.kvertrag = VAL (khbeitrag$)
 Reg_Haftpflicht.kvertrag = khregionalkl$

 REM tksfklasse$

             IF zahlweise$ LIKE "j*" THEN 
               zw.kvertrag = 1
             END IF 
             IF zahlweise$ LIKE "h*" THEN 
               zw.kvertrag = 2
             END IF 
             IF zahlweise$ LIKE "v*" THEN 
               zw.kvertrag = 4
             END IF 
             IF zahlweise$ LIKE "m*" THEN 
               zw.kvertrag = 12
             END IF 
             Antragsnr.KVERTRAG = "fss" + vnr$
             Beitrag.kvertrag = VAL (beitrag$)
             REM Bewertungssumme.Kvertrag = 
             VS_Beginn.kvertrag = vbeginn$
             Antragsdatum.kvertrag = vbeginn$
             REM DBeitrZahlung.kvertrag = Laufzeit.AFSIPSP
             REM VSumme.kvertrag = Vertragssumme.afsipsp
             CALL QuickStore("KVERTRAG")
             REM CALL Fehler("","")
             REQUEST "Vertrag wurde aktualisiert","",2
 END SUB 


SUB fssvtneu(inid1$,gbkurz1$,sparte1$)
 vnr$ = ReadDestiIBM$("DATA","vnr",inid1$)
 REM Spartennummer
 snr$ = ReadDestiIBM$("DATA","snr",inid1$)
 snr% = VAL (snr$)
 gnr$ = ReadDestiIBM$("DATA","gnr",inid1$)
 gkurz$ = ReadDestiIBM$("DATA","gkurz",inid1$)
 REM Tarifcode
 tnr$ = ReadDestiIBM$("DATA","tnr",inid1$)
 tnr% = VAL (tnr$)
 datum$ = ReadDestiIBM$("DATA","datum",inid1$)
 antragsart$ = ReadDestiIBM$("DATA","antragsart",inid1$)
  
  vbeginn$ = ReadDestiIBM$("DATA","vbeginn",inid1$)
 zahlweise$ = ReadDestiIBM$("DATA","zahlweise",inid1$)
 waehrung$ = ReadDestiIBM$("DATA","waehrung",inid1$)
 beitrag$ = ReadDestiIBM$("DATA","beitrag",inid1$)

         SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
         SELECT KEY knr% FILE "ADRESSEN" INDEX codeku.adressen
         REM CALL Fehler(nachname.adressen,vorname.adressen)
         REQUEST "Vertrag aufnehmen?","",130,reqv1%
         IF reqv1% THEN 
           CALL Fehler("Bitte suchen Sie ein Produkt aus der nachfolgenden Liste, das den untenstehenden Angaben entspricht!",gbkurz1$ + "/" + sparte1$)
           viab% = 1
           lfdnr% = CreateVertrag%(knr%)
           
           viab% = 0
           IF lfdnr% > 0 THEN 
             cuvt% = lfdnr%
             SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
             SELECT KEY lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
             IF zahlweise$ LIKE "j*" THEN 
               zw.kvertrag = 1
             END IF 
             IF zahlweise$ LIKE "h*" THEN 
               zw.kvertrag = 2
             END IF 
             IF zahlweise$ LIKE "v*" THEN 
               zw.kvertrag = 4
             END IF 
             IF zahlweise$ LIKE "m*" THEN 
               zw.kvertrag = 12
             END IF 
             Antragsnr.KVERTRAG = "fss" + vnr$
             Beitrag.kvertrag = VAL (beitrag$)
             REM Bewertungssumme.Kvertrag = 
             VS_Beginn.kvertrag = vbeginn$
             Antragsdatum.kvertrag = vbeginn$
             REM DBeitrZahlung.kvertrag = Laufzeit.AFSIPSP
             REM VSumme.kvertrag = Vertragssumme.afsipsp
             CALL QuickStore("KVERTRAG")
             REM CALL KVERTRAGneu(lfdnr%)
             nvt% = lfdnr%
           ELSE 
             CALL Fehler("Vertragserfassung abgebrochen!,"")
             cuvt% = 0
           END IF 
         END IF 

 END SUB 

SUB fssadr(inid1$)
 vnr$ = ReadDestiIBM$("DATA","vnr",inid1$)
 REM Spartennummer
 snr$ = ReadDestiIBM$("DATA","snr",inid1$)
 snr% = VAL (snr$)
 gnr$ = ReadDestiIBM$("DATA","gnr",inid1$)
 gkurz$ = ReadDestiIBM$("DATA","gkurz",inid1$)
 REM Tarifcode
 tnr$ = ReadDestiIBM$("DATA","tnr",inid1$)
 tnr% = VAL (tnr$)
 datum$ = ReadDestiIBM$("DATA","datum",inid1$)
 antragsart$ = ReadDestiIBM$("DATA","antragsart",inid1$)
 anrede$ = ReadDestiIBM$("DATA","anrede",inid1$)
 titel$ = ReadDestiIBM$("DATA","titel",inid1$)
 vorname$ = ReadDestiIBM$("DATA","vorname",inid1$)
 name$ = ReadDestiIBM$("DATA","name",inid1$)
 strasse$ = ReadDestiIBM$("DATA","strasse",inid1$)
 plz$ = ReadDestiIBM$("DATA","plz",inid1$)
 ort$ = ReadDestiIBM$("DATA","ort",inid1$)
 gebdat$ = ReadDestiIBM$("DATA","gebdat",inid1$)
 fstand$ = ReadDestiIBM$("DATA","fstand",inid1$)
 geschlecht$ = ReadDestiIBM$("DATA","geschlecht",inid1$)
 nation$ = ReadDestiIBM$("DATA","nation",inid1$)
 beruf$ = ReadDestiIBM$("DATA","beruf",inid1$)
 taetigkeit$ = ReadDestiIBM$("DATA","taetigkeit",inid1$)
 telefonprivat$ = ReadDestiIBM$("DATA","telefonprivat",inid1$)
 telefonberufl$ = ReadDestiIBM$("DATA","telefonberuflich",inid1$)
 erreichbarkei$ = ReadDestiIBM$("DATA","erreichbarkeit",inid1$)
 telefax$ = ReadDestiIBM$("DATA","telefax",inid1$)
 email$ = ReadDestiIBM$("DATA","email",inid1$)
 kontovorname$ = ReadDestiIBM$("DATA","kontovorname",inid1$)
 kontoname$ = ReadDestiIBM$("DATA","kontoname",inid1$)
 kto$ = ReadDestiIBM$("DATA","kto",inid1$)
 blz$ = ReadDestiIBM$("DATA","blz",inid1$)
 bank$ = ReadDestiIBM$("DATA","bank",inid1$)
 zahlart$ = ReadDestiIBM$("DATA","zahlart",inid1$)
  nvt% = 0
   REM prÅfen, ob Adresse vorhanden
   CALL Fehler("Vertrag NICHTgefunden","Es wird auf Adresse geprÅft")
   GGSuna$ = name$
   GAFSK$ = "TRUE"
   nn$ = (name$ + " " + vorname$ + " " + strasse$ + " " + plz$ + " " + ort$)
   CALL Fehler("Adresssuche:" + nn$,"")
   adrtest% = ADRSuche%(0)
   GAFSK$ = ""
   IF adrtest% <> 0 THEN 
     knr% = adrtest%
     REM Adresse gefunden, es kann der Vertrag aufgenommen werden
     CALL Fehler("Adresse gefunden, es kann der Vertrag aufgenommen werden","")
   ELSE 
     REM Adresse nicht gefunden, muss neu aufgenommen werden
     REM CALL Fehler("Adresssuche:" + name$ + " " + vorname$ + " " + strasse$ + " " + plz$ + " " + ort$,"")
     REQUEST "Adresse wurde nicht gefunden!","Soll die Adresse neu aufgenommen werden?",130,req%
           GAdrDat$ = "ADRESSEN"
           BLANK FILE "ADRESSEN"
           CodeKU% = SER (GAdrDat$,1)
           adrtest% = codeku%
           CodeKU.GAdrDat$ = codeku%
           knr% = codeku%
           EXPInternet.GADRDat$ = "j"
           STORE FILE GAdrDat$
           UNLOCK CURRENT FILE GAdrDat$
           UNLOCK FILE GAdrDat$
           SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
           ADRStatus.GAdrDat$ = "FSS Import"
           ADRGruppe.GAdrDat$ = "<OHNE ZUORDNUNG>"
           IF GASP% <> - 1 THEN 
             codema.GAdrDat$ = GetCodeMA%(prompt%,Workstation%)
             miab$ = "Agenturnr.: " + Agenturnr.maadr
             agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
             Kunde_seit.GAdrDat$ = TODAY 
           END IF 
           nachname.adressen = name$
           vorname.adressen = vorname$
           ort.adressen = ort$
           plz.adressen = plz$
           stra·e.adressen = strasse$
           anrede.adressen = anrede$
           titel.adressen = titel$
           Land.adressen = nation$
           Geburtstag.adressen = Gebdat$
           Familienstand.adressen = fstand$
           IF geschlecht$ LIKE "M" THEN 
             Geschlecht.adressen = "j"
           END IF 
           IF geschlecht$ LIKE "W" THEN 
             Geschlecht.adressen = "n"
           END IF 
           Kunde_seit.adressen = datum$
           Beruf.adressen = beruf$
           Hobbys.adressen = "TÑtigkeit:" + taetigkeit$
           Kontoinh1$ = LEFT$ ( LTRIM$ (kontoname$ + "/" + kontovorname$),27)
           Kontoinh1.adressen = Kontoinh1$
           k1konto.adressen = LEFT$ (kto$,17)
           k1blz.adressen = LEFT$ (blz$,20)
           k1bank.adressen = LEFT$ (bank$,50)

           CALL QuickStore("ADRESSEN")
           BLANK FILE "Telefon"
           codetel.telefon = SER ("TELEFON",1)
           codeku.telefon = codeku%
           Art.telefon = "Telefon privat "
           Nummer.telefon = telefonprivat$
           fonoderfax.telefon = "n"
           CALL QuickStore("Telefon")
           BLANK FILE "Telefon"
           codetel.telefon = SER ("TELEFON",1)
           codeku.telefon = codeku%
           Art.telefon = "Telefon berufl"
           Nummer.telefon = telefonberufl$
           fonoderfax.telefon = "n"
           CALL QuickStore("Telefon")
           BLANK FILE "Telefon"
           codetel.telefon = SER ("TELEFON",1)
           codeku.telefon = codeku%
           Art.telefon = erreichbarkei$
           Nummer.telefon = ""
           fonoderfax.telefon = "n"
           CALL QuickStore("Telefon")
           BLANK FILE "Telefon"
           codetel.telefon = SER ("TELEFON",1)
           codeku.telefon = codeku%
           Art.telefon = "FAX"
           Nummer.telefon = telefax$
           fonoderfax.telefon = "j"
           CALL QuickStore("Telefon")
           BLANK FILE "Telefon"
           codetel.telefon = SER ("TELEFON",1)
           codeku.telefon = codeku%
           Art.telefon = "Email"
           Nummer.telefon = email$
           fonoderfax.telefon = "n"
           CALL QuickStore("Telefon")
   END IF 

 END SUB 




 REM wenn codeku%=0 dann fragen
 REM wenn codeku%>0 dann export nur fÅr diese adresse
SUB OnlBeratPrADR(codeku%)
 IF disabled%("ADREXPORT") THEN END SUB 
 IF disabled%("ADRESSEN") THEN END SUB 
 
     GAdrDat$ = "ADRESSEN"
     GConDat$ = "CONNECT"
     GTelDat$ = "TELEFON"
     GAkquiDat$ = "AKQUISE"
     GDokDat$ = "DOKUMENT"
     GADRStat$ = "ADRSTAT"
   
 CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
 IF OPEN ("onlberat") THEN CLOSE FILE "onlberat"
 CALL DFile(2,"OFFICE\" + "ONLBERAT" + _fpw$)
 IF RECCOUNT ("ONLBERAT") > 0 THEN REMOVE FROM FILE "ONLBERAT"
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 IF codeku% = 0 THEN CALL Fehler("Export fÅr KMU-EU-Beratungsprotokoll","")
 expodir$ = GMACodeDir$ + "ONLBERAT"
 REM impodir$ = GMACodeDir$ + "ONLBERAT\PROTOKOL\"
 ON ERROR GOTO e130620051
 MAKE DIRECTORY expodir$
 REM ON ERROR GOTO e130620051
 REM MAKE DIRECTORY impodir$
 GOTO e130620052
e130620051: 
 f% = - 1
e130620052: 
 expodir$ = GMACodeDir$ + "ONLBERAT\"
 ON ERROR GOTO ErrorHandler 
 optemail% = 1
   IF codeku% = 0 THEN 
     DIM dlg1 AS Dialog
     DIM control AS DialogControl 
 
     Superbase.Dialogs.Add("Dialogname")
     SET dlg1 = Superbase.Dialogs.Dialogname
     dlg1.Move(0,0,150,73)
     dlg1.Caption = "Art des Export"
     dlg1.FontName = "MS Sans Serif"
     dlg1.FontSize = 8
 
     SET control = dlg1.Add("DialogFrame1","DialogFrame")
     control.Move(2,8,150,44)
     control.Caption = " WÑhlen Sie eine Option "
 
     SET control = dlg1.Add("DialogOptionButton1","DialogOptionButton")
     control.Move(6,20,114,10)
     control.Caption = "einzelne Adresse"
     control.Bind("optemail%")
     control.ValueOn = 1
 
     SET control = dlg1.Add("DialogOptionButton2","DialogOptionButton")
     control.Move(6,32,114,9)
     control.Caption = "alle Adressen"
     control.Bind("optemail%")
     control.ValueOn = 2
 
 
 
     SET control = dlg1.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(39,54,43,16)
     control.Default = 1
     control.Caption = "OK"
     control.ReturnValue = 1
 
     SET control = dlg1.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(85,54,42,16)
     control.Caption = "Abbruch"
     control.ReturnValue = 0
 
     DIALOG "Dialogname",reqemail%
     REMOVE DIALOG "Dialogname"
     codeku% = 0
     IF reqemail% <> 1 THEN GOTO e130620053
     IF optemail% = 1 THEN 
       REM Export fÅr einzene Adresse
       codeku% = ADRSuche%(0)
       IF codeku% < 1 THEN 
         CALL Fehler("EXPORT abgebrochen,da keine Adresse ausgewÑhlt wurde","")
         GOTO e130620053
       END IF 
       SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
       SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
     ELSE 
       REM Export alle Adressen
       codeku% = 0
     END IF 
   END IF 
   CALL CreateONLBerat(codeku%)
   IF RECCOUNT ("ONLBERAT") > 0 THEN 
     GOTO w270320071
     REM CSV-Export
     FILE "ONLBERAT"
     SELECT FIRST 
     IF EXISTS (expodir$ + "ONLBERAT.csv") THEN 
       DELETE expodir$ + "ONLBERAT.csv"
     END IF 
     OPEN expodir$ + "ONLBERAT.csv" FOR OUTPUT 
     WHILE NOT EOF ("ONLBERAT")
       teil1$ = Kundennummer + ";" + Anrede + ";" + Titel + ";" + Firma + ";" + Vorname + ";" + Nachname + ";" + Strasse + ";" + PLZ + ";" + Ort + ";" + Land + ";" + TelBuero + ";" + TelPrivat + ";" + TelMobil + ";" + Telefax + ";"
       teil2$ = email + ";" + Mibewohner + ";" + Geburtstag + ";" + NurOnline
       ? FN ansi(teil1$ + teil2$)
       SELECT NEXT FILE "ONLBERAT"
     WEND 
     CLOSE OUTPUT 
w270320071: 
     REM XML-Export
     FILE "ONLBERAT"
     SELECT FIRST 
     IF EXISTS (expodir$ + "ONLBERAT.xml") THEN 
       DELETE expodir$ + "ONLBERAT.xml"
     END IF 
    CALL Fehler("Bei der öbergabe von Daten zu einem anderen Programm kînnen InkompatibilitÑten bei der Darstellung von Sonderzeichen z.B. Å,ö,Ñ,é,î,ô,·,  .... auftreten! Dies kann man verhindern, in dem man die Umlaute dudenkonform umwandelt.","")
     REQUEST "Sollen die Umlaute fÅr die Exportdatei umgewandelt werden?","",130,req%
     wandeln$ = "N"
     IF req% = 1 THEN 
       wandeln$ = "J"
     END IF 
     OPEN expodir$ + "ONLBERAT.xml" FOR OUTPUT 
     ? "<?xml version=" + CHR$ (34) + "1.0" + CHR$ (34) + " encoding=" + CHR$ (34) + "ISO-8859-1" + CHR$ (34) + "?>"
     ? "<euprotokollimport>"
     i% = 0
     j% = RECCOUNT ("onlberat")
     WHILE NOT EOF ("ONLBERAT")
         i% = i% + 1
         SET STATUS STR$ (i%,",99999999") + "/" + STR$ (j%,",99999999") + " DatensÑtze exportiert"
         IF wandeln$ = "J" THEN 
           ? "<customer>"
             ? "<id></id>"
             ? "<externalid>" + STR$ (codeku.onlberat,"000000") + "</externalid>"
             ? "<companyname />"
             ? "<gender>" + gender.onlberat"</gender>"
             titel$ = UmlEx$(Titel.onlberat)
             ? "<title>" + Titel$ + "</title>"
             ? "<isprivate>" + isprivate.onlberat + "</isprivate>"
             vorname$ = UmlEx$(vorname.onlberat)
             ? "<firstname>" + vorname$ + "</firstname>"
             nachname$ = UmlEx$(nachname.onlberat)
             ? "<lastname>" + nachname$ + "</lastname>"
             IF geburtstag.onlberat <> "" THEN 
               ? "<birthday>" + geburtstag.onlberat + "</birthday>"
             ELSE 
               ? "<birthday></birthday>"
             END IF 
             ? "<birthplace></birthplace>"
             ? "<familystatus>" + family.onlberat + "</familystatus>"
             strasse$ = UmlEx$(strasse.onlberat)
             ? "<street>" + strasse$ + "</street>"
             ? "<zipcode>" + FN ibm(plz.onlberat) + "</zipcode>"
             Ort$ = UmlEx$(Ort.onlberat)
             ? "<city>" + Ort$ + "</city>"
             ? "<countryindicator>" + country.onlberat + "</countryindicator>"
             ? "<phoneprivate>" + telprivat.onlberat + "</phoneprivate>"
             ? "<phonebusiness>" + TelBuero.onlberat + "</phonebusiness>"
             ? "<phonemobile>" + TelMobil.onlberat + "</phonemobile>"
             ? "<fax>" + Telefax.onlberat + "</fax>"
             ? "<email>" + email.onlberat + "</email>"
           ? "</customer>"
         ELSE 
           ? "<customer>"
             ? "<id></id>"
             ? "<externalid>" + STR$ (codeku.onlberat,"000000") + "</externalid>"
             ? "<companyname />"
             ? "<gender>" + gender.onlberat"</gender>"
             ? "<title>" + FN ansi(Titel.onlberat) + "</title>"
             ? "<isprivate>" + isprivate.onlberat + "</isprivate>"
             ? "<firstname>" + FN ansi(vorname.onlberat) + "</firstname>"
             ? "<lastname>" + FN ansi(nachname.onlberat) + "</lastname>"
             IF geburtstag.onlberat <> "" THEN 
               ? "<birthday>" + geburtstag.onlberat + "</birthday>"
             ELSE 
               ? "<birthday></birthday>"
             END IF 
             ? "<birthplace></birthplace>"
             ? "<familystatus>" + family.onlberat + "</familystatus>"
             ? "<street>" + FN ansi(strasse.onlberat) + "</street>"
             ? "<zipcode>" + plz.onlberat + "</zipcode>"
             ? "<city>" + FN ansi(Ort.onlberat) + "</city>"
             ? "<countryindicator>" + country.onlberat + "</countryindicator>"
             ? "<phoneprivate>" + telprivat.onlberat + "</phoneprivate>"
             ? "<phonebusiness>" + TelBuero.onlberat + "</phonebusiness>"
             ? "<phonemobile>" + TelMobil.onlberat + "</phonemobile>"
             ? "<fax>" + Telefax.onlberat + "</fax>"
             ? "<email>" + email.onlberat + "</email>"
           ? "</customer>"
         END IF 
       SELECT NEXT FILE "ONLBERAT"
     WEND 
     ? "</euprotokollimport>"
     CLOSE OUTPUT 

     CALL Fehler("Der Export wurde erfolgreich beendet! Sie finden die Datei in: " + expodir$ + ", der Name lautet: ONLBERAT.xml","Diese Datei kînnen Sie im Programm EU-Protokoll Åber Tools->Import->Kundendatensatz  importieren lassen!")
     CLOSE FILE "onlberat"
   END IF 

e130620053: 
  DIRECTORY _netpath$
 END SUB 
  

FUNCTION UmlEx$(tsring$)
 tVSNR$ = ""
 VSNR$ = tsring$
 FOR a% = 1 TO LEN (VSNR$)
   tC$ = MID$ (VSNR$,a%,1)
         x% = ASC ( LEFT$ ( UCASE$ (tC$),1))
         SELECT CASE tc$
           CASE "î"
             tC$ = "oe"
           CASE "ô"
             tC$ = "Oe"
           CASE "Å"
             tC$ = "ue"
           CASE "ö"
             tC$ = "Ue"
           CASE "Ñ"
             tC$ = "ae"
           CASE "é"
             tC$ = "Ae"
           CASE "·"
             tC$ = "ss"
         END SELECT 
         IF tc$ LIKE "·" THEN tc$ = "SS"
   REM SELECT CASE tC$
   REM CASE "A" TO "Z","0" TO "9"
     tVSNR$ = tVSNR$ + tC$
   REM END SELECT 
 NEXT a%
 UmlEx$ = tVSNR$
 END FUNCTION 
 



SUB CreateONLBerat(codeku1%)
  MOUSE OFF 
  SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
  IF codeku1% > 0 THEN 
    SELECT KEY codeku1% FILE "ADRESSEN" INDEX codeku.adressen
  END IF 
  ok% = - 1
  i% = 0
  IF codeku1% > 0 THEN 
    j% = 1
  ELSE 
    j% = RECCOUNT ("adressen")
  END IF 
  WHILE NOT EOF ("ADRESSEN") AND ok% = - 1
    i% = i% + 1
    SET STATUS "Datensatz: " + STR$ (i%,",99999999") + " von " + STR$ (j%,",99999999") + "  " + nachname.adressen
    BLANK FILE "ONLBERAT"
    codeku.onlberat = codeku.adressen
    k$ = FN NUMeric(Kundennummer.adressen)
    Kundennummer% = VAL (K$)
    Kundennummer.ONLBERAT = LTRIM$ ( STR$ (Kundennummer%,"999999999"))
    Anrede = anrede.adressen
    Titel = titel.adressen
    IF Geschlecht.adressen LIKE "j" THEN 
      gender.onlberat = "M"
    END IF 
    IF Land.adressen = "D" OR land.adressen LIKE "Deutsch*" OR land.adressen LIKE "BRD*" THEN 
      country.onlberat = "D"
    END IF 
    IF Land.adressen = "CH" OR land.adressen LIKE "Schweiz*" THEN 
      country.onlberat = "CH"
    END IF 
    IF Land.adressen = "A" OR land.adressen LIKE "ôster*" THEN 
      country.onlberat = "A"
    END IF 
    IF Familienstand.adressen LIKE "verhei*" THEN 
      family.onlberat = "married"
    END IF 
    IF anrede.adressen LIKE "Firma" OR anrede.adressen LIKE "Insti*" OR anrede.adressen = "" THEN 
      Firma.ONLBERAT = Nachname.adressen
      Nachname.ONLBERAT = Geburtsname.adressen
      Vorname.ONLBERAT = Vorname.adressen
      isprivate.onlberat = "False"
    ELSE 
      Nachname.ONLBERAT = Nachname.adressen
      Vorname.ONLBERAT = Vorname.adressen
      isprivate.onlberat = "True"
    END IF 
    Strasse.ONLBERAT = Stra·e.adressen
    Ort.ONLBERAT = Ort.adressen
    plz.ONLBERAT = plz.adressen
    IF Geburtstag.adressen > 0 AND YEAR (Geburtstag.adressen) < YEAR ( TODAY ) THEN 
      Geburtstag.ONLBERAT = DATE$ (Geburtstag.adressen,"yyyy-mm-0d")
    END IF 
    IF EXISTS (codeku.adressen,codeku.telefon) THEN 
      SELECT FIRST FILE "Telefon" INDEX codeku.telefon
      SELECT KEY codeku.adressen FILE "Telefon" INDEX codeku.telefon
      WHILE NOT EOF ("Telefon") AND codeku.telefon = codeku.adressen
        IF art.telefon LIKE "*fon*" THEN 
          IF Telbuero.ONLBERAT = "" THEN 
            Telbuero.ONLBERAT = Nummer.telefon
          ELSE 
            IF Telprivat.ONLBERAT = "" THEN 
              Telprivat.ONLBERAT = Nummer.telefon
            ELSE 
              IF TelMobil.ONLBERAT = "" THEN TelMobil.ONLBERAT = Nummer.telefon
            END IF 
          END IF 
        END IF 
        IF art.telefon LIKE "*fax*" THEN 
          IF telefax.onlberat = "" THEN telefax.onlberat = Nummer.telefon
        END IF 
        IF art.telefon LIKE "*email*" THEN 
          IF email.onlberat = "" THEN email.onlberat = Nummer.telefon
        END IF 
        SELECT NEXT FILE "Telefon" INDEX codeku.telefon
      WEND 
    END IF 
    STORE FILE "ONLBERAT"
    IF codeku1% > 0 THEN 
      ok% = 0
    END IF 
    SELECT NEXT FILE "ADRESSEN" INDEX codeku.adressen
  WEND 
  MOUSE ON 
 END SUB 
 
 




 ' Bearbeitung der internen Vertragsstati
SUB IntStatustab()
 CALL DFile(3,"KVERTRAG" + _fpw$)
 FILE "KVERTRAG"
 INDEX statuskey.kvertrag

 CALL DFile(3,"STATUKEY" + _fpw$)
 FILE "STATUKEY"
 INDEX statuskey.statukey

 IF disabled%("INTVSTATUS") THEN END SUB 
 
 _formend% = 0
 SET STATUS "Bereit"
 maske$ = "STATUKEY"
 IF eurosupport$ = "TRUE" THEN maske$ = "STATUKEY"
 FILE "STATUKEY"
 INDEX statuskey.statukey
 SELECT FIRST 
 codekey% = statuskey.statukey
 aend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   SUPERVISsub% = 0
   IF FORM <> maske$ THEN 
     SET HEADING title$ + " - interne Vertragsstati"
     IF EXISTS (GPrjForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GPrjForm$ + maske$
     ELSE 
       OPEN FORM GPrjForm$ + maske$
     END IF 
     SET f = superbase.form
    SET STATUS "interne Vertragsstati"
     SELECT FORM KEY codekey% FILE "STATUKEY" INDEX statuskey.statukey
     FORM 
     CALL MNProgramm()
     CALL ButEnabled()
     REM FORM 
   END IF 
   MENU ON 
   f.suchen.visible = 0
   f.suchen.enabled = 0
   f.links1.enabled = 0
   f.rechts1.enabled = 0
   f.links1.visible = 0
   f.rechts1.visible = 0
   MOUSE ON 
   FORM 
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   CALL ClearKBDBuffer()
   SELECT CASE SUPERVISsub%
   CASE 1
     REM Datensatz lîschen
     IF NOT disabled%("INTVSTATUSDEL") THEN 
       IF NOT EXISTS (statuskey.statukey,statuskey.kvertrag) THEN 
         REQUEST "Wollen Sie den aktuellen Datensatz wirklich lîschen?","",135,req%
         IF req% = 1 THEN 
           statuskey% = statuskey.statukey
           SELECT KEY statuskey% LOCK FILE "statukey" INDEX statuskey.statukey
           SELECT REMOVE FILE "statukey"
           SELECT FORM FIRST FILE "STATUKEY" INDEX statuskey.STATUKEY
           FORM 
           REQUEST "Datensatz wurde gelîscht!","",2
         END IF 
       ELSE 
         CALL Fehler("Derinterne Status kann nicht gelîscht werden, da VertrÑge existieren, die diesen internen Status verwenden!","Details: Generator zur Vertragssuche und Statistik, bitte lassen Sie sich dort die entsprechenden VertrÑge anzeigen!")
       END IF 
     END IF 
   CASE 2
     REM Auswahl und Positionierung auf den Datensatz
     statuskey% = statuskey.statukey
     SELECT KEY statuskey% LOCK FILE "statukey" INDEX statuskey.statukey
     FORM 
   CASE 90
     REM Datensatz neu
     IF NOT disabled%("INTVSTATUSNEW") THEN 
       codekey% = SER ("STATUKEY")
       BLANK FILE "STATUKEY"
       statuskey.statukey = codekey%
       zero.STATUKEY = 0
       Keyword.STATUKEY = "Neu"
       IF Workstation% > 0 THEN Workstation.STATUKEY = Workstation%
       IF Workstation% > 0 THEN QWoNo.STATUKEY = STR$ (Workstation%,"000000") + STR$ (statuskey.statukey,"000000")
       RecStatus.STATUKEY = "c"
       STORE FILE "STATUKEY"
       UNLOCK CURRENT FILE "STATUKEY"
       SELECT FORM FIRST FILE "STATUKEY" INDEX statuskey.statukey
       FORM 
       SELECT KEY codekey% LOCK FILE "STATUKEY" INDEX statuskey.statukey
       FORM 
       CALL ButDesabled()
       MOUSE ON 
       f.loeschen.enabled = 0
       ENTER keyword.STATUKEY,0
       aend% = 1
       CALL ButEnabled()
       f.suchen.visible = 0
       f.suchen.enabled = 0
       f.links1.enabled = 0
       f.rechts1.enabled = 0
       f.links1.visible = 0
       f.rechts1.visible = 0
       f.loeschen.enabled = - 1
       SELECT FIRST FILE "STATUKEY" INDEX statuskey.statukey
       SELECT KEY codekey% LOCK FILE "STATUKEY" INDEX statuskey.statukey
       FORM 
       MENU ON 
       IF abbruch% = - 1 THEN 
         SELECT KEY keyword.STATUKEY FILE "STATUKEY" INDEX keyword.STATUKEY
         FORM 
         abbruch% = 0
       END IF 
     END IF 
   CASE 99
     codekey% = statuskey.statukey
     IF NOT disabled%("INTVSTATUSEDIT") THEN 
       MENU OFF 
       CALL ButDesabled()
       f.loeschen.enabled = 0
       MOUSE ON 
       ENTER keyword.STATUKEY,0
       aend% = 1
       CALL ButEnabled()
       f.loeschen.enabled = - 1
       f.suchen.visible = 0
       f.suchen.enabled = 0
       f.links1.enabled = 0
       f.rechts1.enabled = 0
       f.links1.visible = 0
       f.rechts1.visible = 0
       MENU ON 
       IF abbruch% = - 1 THEN 
         SELECT FIRST FILE "STATUKEY" INDEX statuskey.STATUKEY
         SELECT KEY codekey FILE "STATUKEY" INDEX statuskey.STATUKEY
         FORM 
         abbruch% = 0
       END IF 
     END IF 
 END SELECT 
 IF aend% = 1 THEN 
   aend% = 0
 END IF 
end150620051: 
 SET STATUS ""
 WEND 
 _formend% = 0
 IF MOD ("STATUKEY") OR NEW ("STATUKEY") THEN CALL FStore("STATUKEY")
 END SUB 
 
 
 'statukeyauswahl fÅr Vertragsdatei
 
SUB VertrStatukey()
  cv% = lfdnr.kvertrag
  IF ag$ = "j" THEN 
    CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
    GOTO end150620052
  END IF 
  IF disabled%("VERTRBEARB") THEN GOTO end150620052
   codekey% = statuskey.kvertrag
   cv% = lfdnr.kvertrag
   DIM Waehrung$( RECCOUNT ("statukey"))
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
     FILE "statukey"
     DIM Auswahl1$(1)
     INDEX statuskey.statukey
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("Statukey")
       Waehrung$(a%) = STR$ (statuskey.statukey,"999") + "    " + keyword.statukey + SPACE$ (120) + STR$ (statuskey.statukey,"000000")
       a% = a% + 1
       SELECT NEXT 
     WEND 
     FILE "kvertrag"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,164,"interne Vertrags-Stati","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl Status"
      ADD DIALOG "PREISLIS",7,5,14,180,125,2,0,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        codekey% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY codekey% FILE "statukey" INDEX statuskey.statukey
        SELECT KEY cv% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
        Statuskey.kvertrag = codekey%
        statusintern.kvertrag = keyword.statukey
        CALL FStore("kvertrag")
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
        statukey$ = keyword.statukey
      END IF 
 
 MOUSE ON 
 FORM 
end150620052: 
 END SUB 
 

SUB DOKVSuchen(codeku%)
 cudok% = CodeDOK.GDokDat$
 
 DOKGruppen$(0) = "<ALLE DOKUMENTENGRUPPEN>"
 DOKGruppen$(1) = "allgemeine Schreiben"
 CALL FillDokGruppe(1)
 a% = 0
 knr% = codeku%
 
 CREATE DIALOG "DOK",0,0,300,338,title$,"MS Sans Serif",8
 ADD DIALOG "DOK",9,2,4,22,23,2
 ADD DIALOG "DOK",5,26,11,236,9,0,"WÑhlen Sie eine Dokumentengruppe aus:"
 ADD DIALOG "DOK",7,25,25,263,250,2,2,DOKGruppen$,Auswahl$,Gruppe.dokument
 ADD DIALOG "DOK",6,25,300,98,11,128,0,Gsuna1$,50
 ADD DIALOG "DOK",2,130,300,28,10,0,"UND","J","N",Gund$
 ADD DIALOG "DOK",6,160,300,108,11,128,0,Gsuna2$,50
 ADD DIALOG "DOK",5,25,270,250,30,0,"Geben Sie hier bis zu 2 Bestandteile des Dokumentennamens ein, den Sie suchen: Die Begriffe kînne mit UND verknÅpft werden. Die Eingabe von Suchbegriffen ist optional!"
 
 ADD DIALOG "DOK",1,106,317,48,16,1,"&Weiter",1,1
 ADD DIALOG "DOK",1,158,317,48,16,0,"&Abbruch",0,0
 ADD DIALOG "DOK",1,210,317,48,16,0,"Alle",2,2
 DIALOG "DOK",req%
 REMOVE DIALOG "DOK"
 IF req% > 0 THEN 
   req% = DOKAuswahl%(Auswahl$(0),0,codeku%)
   IF req% <> - 1 THEN 
     cudok% = req%
   END IF 
 END IF 
 IF codeku% = 0 THEN 
   SELECT FORM KEY cudok% FILE GDokDat$ INDEX codeDok.GDokDat$
 ELSE 
   SELECT FIRST FILE GDokDat$ INDEX codedok.GDokDat$
   SELECT KEY cudok% FILE GDokDat$ INDEX codedok.GDokDat$
 END IF 
 SET INDEX Dokument.GDokDat$
 INDEX Dokument.GDokDat$
 FORM 
 MOUSE OFF 
 DOKGruppen$(0) = "allgemeine Schreiben"
 CALL FillDokGruppe(0)
 a% = 0
 MOUSE ON 
 END SUB 
 
 
FUNCTION DOKAuswahlNeu%(filter$,linkfield%,alle%)
  alle$ = "j"
  IF alle% = 1 THEN alle$ = "n"
  IF alle% = 2 THEN alle$ = "j"
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDAt$ + _fpw$)
 SET STATUS "Dokumenten-/Vorlagenauswahl"
 cfile$ = FILE 
 _cuko% = CodeKU.GADRDAt$
 
 DIM DokList$(25000)
 REM 261198-1
a240120051: 
 FILE "Dokument"
 INDEX Gruppe.GDokDat$
 SELECT WHERE FILE GDokDat$
 SELECT FIRST 
 IF filter$ LIKE "<ALLE DOKUMENTENGRUPPEN>" THEN 
   filter$ = ""
   FILE GDokDat$
   INDEX codedok.GDokDat$
   SELECT WHERE FILE GDokDat$
   SELECT FIRST 
 
 ELSE 
   SELECT FIRST FILE GDokDat$ INDEX Gruppe.GDokDat$
   SELECT KEY filter$ FILE GDokDat$ INDEX Gruppe.GDokDat$
 END IF 
 a% = 0
 
      IF GCODIE% = - 1 THEN 
        CALL SearchInitDo1(GDokDat$)
      END IF 
 
   MOUSE OFF 
   IF filter$ <> "" THEN WHILE NOT EOF (GDokDat$) AND Gruppe.GDokDat$ LIKE filter$
   IF filter$ = "" THEN WHILE NOT EOF (GDokDat$)
     ok% = - 1
     IF alle$ = "n" THEN 
       IF novi1.GDokDat$ = 1 THEN ok% = 0
     END IF 
     IF Gsuna1$ <> "" OR Gsuna2$ <> "" THEN 
       IF Gsuna1$ <> "" AND Gsuna2$ <> "" THEN 
         IF Gund$ = "J" THEN 
           REM beide suchbegriffe ausgefÅllt und mit UND verknÅpft
           IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" AND dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
           ELSE 
             ok% = 0
           END IF 
         ELSE 
           IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" OR dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
           ELSE 
             ok% = 0
           END IF 
         END IF 
       ELSE 
         IF Gsuna1$ <> "" THEN 
           IF dokument.GDokDat$ LIKE "*" + Gsuna1$ + "*" THEN 
           ELSE 
             ok% = 0
           END IF 
         END IF 
         IF Gsuna2$ <> "" THEN 
           IF dokument.GDokDat$ LIKE "*" + Gsuna2$ + "*" THEN 
           ELSE 
             ok% = 0
           END IF 
         END IF 
       END IF 
     END IF 
     IF ok% = - 1 THEN 
       IF filter$ <> "" THEN 
         IF Gruppe.GDokDat$ LIKE filter$ AND (linkfield% = 0 OR link.GDokDat$ = linkfield%) THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             Name$ = Nachname.GADRDAt$ + ", " + Vorname.GADRDAt$
             sok% = - 1
             SELECT KEY CodeKU.GDokDat$ FILE GAdrDat$ INDEX CodeKU.GAdrDat$
            IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 
           ELSE 
             Name$ = "(ohne Zuordnung)"
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
           END IF 
 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF sok% = - 1 THEN 
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (linkfield% = 0 OR link.GDokDat$ = linkfield%) THEN 
           IF CodeKU.GDokDat$ <> 0 THEN 
             SELECT KEY CodeKU.GDokDat$ FILE GADRDAt$ INDEX CodeKU.GADRDAt$
             Name$ = Nachname.GADRDAt$ + ", " + Vorname.GADRDAt$
             sok% = - 1
             IF GASP% AND Workstation% > 0 THEN 
               wks% = Workstation.GADRDAT$
               FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                 wks% = VisOff%(ii%)
                 aa% = IsWksVisible%(wks%)
                 IF aa% = - 1 AND Workstation.GADRDAT$ = wks% THEN 
                   sok% = - 1
                   ii% = VisCount%
                 ELSE 
                  sok% = 0
                 END IF 
               NEXT ii%
             ELSE 
               sok% = - 1
             END IF 

           ELSE 
             Name$ = "(ohne Zuordnung)"
 
             sok% = - 1
             IF GASP% THEN 
               IF Workstation% > 0 THEN 
                 wks% = Workstation.GDOKDAT$
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                   wks% = VisOff%(ii%)
                   aa% = IsWksVisible%(wks%)
                   IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                     sok% = - 1
                     ii% = VisCount%
                   ELSE 
                     sok% = 0
                   END IF 
                 NEXT ii%
               END IF 
             END IF 
           END IF 
 
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(CodeMA.GADRDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF FreeFormular.GDokDat$ > 0 THEN sok% = - 1
           IF sok% = - 1 THEN 
             IF GCODIE% = - 1 THEN CALL SearchVorbDO1("dokument")
             DokList$(a%) = Dokument.GDokDat$ + ", " + LTRIM$ ( DATE$ (erstellt_am.GDokDat$,"0d.mm.yyyy")) + "/" + LTRIM$ ( DATE$ (letzte_Bearbeit.GDokDat$,"0d.mm.yyyy")) + ", " + Name$ + SPACE$ (100) + STR$ (CodeDOK.GDokDat$,"000000")
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     END IF 
     SET STATUS STR$ (a%,",9999999") + " gefunden " + Dokument.GDokDat$
     SELECT NEXT FILE GDokDat$
   WEND 
 MOUSE ON 
 DOKAuswahl% = - 1
 IF a% <> 0 THEN 
   IF GCODIE% = - 1 THEN 
     c$ = "aa"
     req3% = 0
     DOKAuswahl% = 0
     REM CALL Fehler("","")
     req3% = CALL ("_SearchShow",c$)
     IF VAL (c$) <> 0 THEN 
       DOKAuswahl% = VAL (c$)
       ok% = 0
       SET STATUS "Dokument gefunden..."
     END IF 
     IF VAL (c$) = 0 AND req3% = 33 THEN 
       ret% = CALL ("_SearchClose")
       GCODieRuf% = 0
       GCODieRuf1% = 0
       GCODieRuf2% = 0
       alle$ = "j"
       req3% = 0
       GOTO a240120051
     END IF 
   ELSE 
     CREATE DIALOG "DOK",0,0,426,304,"Dokumentensuche","MS Sans Serif",8
     ADD DIALOG "DOK",4,0,0,426,280,0,""
     ADD DIALOG "DOK",5,40,12,160,10,0,"Bitte wÑhlen Sie das gewÅnschte Dokument aus:"
     ADD DIALOG "DOK",9,6,14,22,22,2
     ADD DIALOG "DOK",5,40,24,160,10,0,"Bezeichnung, erstellt/bearbeitet, Adressat"
     ADD DIALOG "DOK",7,19,35,400,239,2,1,DokList$,Auswahl$
     ADD DIALOG "DOK",1,210,287,55,15,0,"&Abbrechen",0,0
     ADD DIALOG "DOK",1,154,287,55,15,1,"&OK",1,1
     DIALOG "DOK",req%
     REMOVE DIALOG "DOK"
     IF req% = 1 THEN 
       DOKAuswahl% = VAL ( RIGHT$ (Auswahl$(0),6))
     END IF 
   END IF 
 ELSE 
   CALL Fehler("Keine Dokumente in dieser Gruppe gefunden!","")
 END IF 
 SELECT KEY _cuko% FILE "ADRESSEN" INDEX CodeKU.ADRESSEN
 FILE cfile$
 END FUNCTION 
 
 
SUB FillDokGruppe(awert%)
 DOKKundFound% = 0
 DOKGesFound% = 0
 a% = awert%
 b% = 0
 
 REM CALL Fehler("Doktest","")
 WHILE DOKGruppen$(a%) <> "leer"
   IF MNdisabled%("DOCSINTERN") THEN 
     a% = a% + 1
     c$ = FN ibm(ReadConfig$("Dokumentengruppen","Gruppe" + LTRIM$ ( STR$ (a%,"999999"))))
     
     REM CALL Fehler("Doktest",c$)
     IF c$ LIKE "interne Sc*" OR c$ LIKE "Vertr*" THEN 
       REM CALL Fehler("Doktest",c$)
       DOKGruppen$(a%) = "---------------------" + LTRIM$ ( STR$ (a%,"999999"))
     ELSE 
       DOKGruppen$(a%) = FN ibm(ReadConfig$("Dokumentengruppen","Gruppe" + LTRIM$ ( STR$ (a%,"999999"))))
     END IF 
   ELSE 
     a% = a% + 1
     DOKGruppen$(a%) = FN ibm(ReadConfig$("Dokumentengruppen","Gruppe" + LTRIM$ ( STR$ (a%,"999999"))))
   END IF 
 WEND 
 DOKGruppen$(a%) = ""
 
 END SUB 
 
 
 
 
FUNCTION NewGetCodeVP%()
 NewGetCodeVP% = 0
 FILE "sparten"
 INDEX sparte.sparten
 FILE "spgruppe"
 INDEX Gruppe
 SELECT FIRST 
 codegrsp% = codegrsp.spgruppe
 REM control.Bind("GSpGruppe$","GSPGrausw$","GSpGrPrompt$")
 REDIM GSpGruppe$(1,1)
 tanz% = RECCOUNT ("spgruppe") + RECCOUNT ("sparten")
 REDIM GSpGruppe$(tanz%)
 a% = 0
 WHILE NOT EOF ("spgruppe")
   IF LTRIM$ (Gruppe.spgruppe) <> "" THEN 
     IF GSpGSparte% <> - 1 THEN 
       GSpGruppe$(a%) = Gruppe.spgruppe + " ________________________________________" + SPACE$ (160) + STR$ (CodeGRSP.spgruppe,"000000") + "000000"
     ELSE 
       GSpGruppe$(a%) = Gruppe.spgruppe + SPACE$ (160) + STR$ (CodeGRSP.spgruppe,"000000") + "000000"
     END IF 
     a% = a% + 1
     codegrsp% = CodeGRSP.spgruppe
     IF GSpGSparte% <> - 1 THEN 
       IF EXISTS (codegrsp%,codegrsp.sparten) THEN 
         SELECT FIRST FILE "sparten" INDEX sparte.sparten
         WHILE NOT EOF ("sparten")
           IF codegrsp.sparten = codegrsp% THEN 
             IF EXISTS (codeva.sparten,codeva.vprodukt) THEN 
               REM CALL Fehler(sparte.sparten, STR$ (inhaus.sparten))
               IF inhaus.sparten = 1 THEN 
                 GSpGruppe$(a%) = "  + " + sparte.sparten + " **INH** " + SPACE$ (160) + STR$ (Codegrsp.sparten,"000000") + STR$ (Codeva.sparten,"000000")
               ELSE 
                 GSpGruppe$(a%) = "  + " + sparte.sparten + SPACE$ (160) + STR$ (Codegrsp.sparten,"000000") + STR$ (Codeva.sparten,"000000")
               END IF 
               a% = a% + 1
             END IF 
           END IF 
           SELECT NEXT FILE "sparten" INDEX sparte.sparten
         WEND 
       END IF 
     END IF 
   END IF 
   SELECT NEXT FILE "spgruppe"
 WEND 
 Galle$ = "n"
 GSpGrPrompt$ = GSpGruppe$(0)
 GSpGranz% = a%
anf290620051: 
 plang$ = RIGHT$ (GSpGruppe$(a%),12)
 codegrsp% = VAL ( LEFT$ (plang$,6))
 REM GGesell$(1),GGesellausw$(1),GGesellPrompt$
 REDIM GGesell$( RECCOUNT ("geadr"),1)
 REDIM GGesell$( RECCOUNT ("geadr"))
 FILE "vprodukt"
 REM INDEX codegrsp.vprodukt
 SELECT WHERE FILE "vprodukt"
 SELECT WHERE codegrsp.vprodukt = codegrsp%
 INDEX codege.vprodukt
 GGesellanz% = 0
 SELECT FIRST FILE "vprodukt"
   codegeold% = - 1
   a% = 0
   WHILE NOT EOF ("Vprodukt")
     ok% = - 1
     IF Galle$ = "n" THEN 
       IF NoAnzeige.vprodukt LIKE "j" THEN ok% = 0
     END IF 
     IF gasp% = - 1 AND workstation% > 0 THEN 
       IF noanzaspbuero.vprodukt LIKE "j" THEN ok% = 0
     END IF 
     IF codege.vprodukt > 0 AND codege.vprodukt <> codegeold% AND ok% <> 0 THEN 
       codege% = codege.Vprodukt
       SELECT FIRST FILE "geadr" INDEX codege.geadr
       SELECT KEY codege% FILE "geadr" INDEX codege.geadr
       codegeold% = codege.Vprodukt
       j% = - 1
       IF LTRIM$ (Gesellschaft.vprodukt) <> "" THEN 
         GGesell$(a%) = Gesellschaft.vprodukt
         IF inhaus.geadr = 1 THEN 
           GGesell$(a%) = GGesell$(a%) + " **INH** "
         END IF 
         GGesell$(a%) = GGesell$(a%) + SPACE$ (160) + STR$ (CodeGRSP.vprodukt,"000000") + STR$ (CodeGE.vprodukt,"000000")
         a% = a% + 1
       END IF 
     END IF 
     SELECT NEXT FILE "Vprodukt" INDEX codege.Vprodukt
   WEND 
   GGesellPrompt$ = GGesell$(0)
   IF a% > 0 THEN GGesellanz% = a%
 
 REM GSpart$(1),GSpartausw$(1),GSpartPrompt$
 IF RECCOUNT ("vprodukt") > RECCOUNT ("sparten") THEN 
   rc% = RECCOUNT ("vprodukt")
 ELSE 
   rc% = RECCOUNT ("sparten")
 END IF 
 REDIM GSpart$(rc%,1)
 REDIM GSpart$(rc%)
 INDEX codevp.vprodukt
 SELECT FIRST FILE "vprodukt"
   codevaold% = - 1
   a% = 0
   Gspartanz% = 0
   WHILE NOT EOF ("Vprodukt")
     IF codeva.vprodukt > 0 THEN 
       codeva% = codeva.Vprodukt
       SELECT FIRST FILE "Sparten" INDEX codeva.sparten
       SELECT KEY codeva% FILE "Sparten" INDEX codeva.sparten
       codevaold% = codeva.Vprodukt
       j% = - 1
       ok% = - 1
       IF Gesellschaft.vprodukt LIKE "Micros*" THEN 
          REM CALL Fehler(Gesellschaft.vprodukt, STR$ (inhaus.vprodukt))
       END IF 
       IF LTRIM$ (Sparte.vprodukt) <> "" THEN 
         IF Galle$ = "n" THEN 
           IF NoAnzeige.vprodukt LIKE "j" THEN ok% = 0
         END IF 
         IF gasp% = - 1 AND workstation% > 0 THEN 
           IF noanzaspbuero.vprodukt LIKE "j" THEN ok% = 0
         END IF 
         IF inhaus.vprodukt = 1 THEN 
           IF MNdisabled%("VERTRINHAUSSEE") OR MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") THEN 
             ok% = 0
           END IF 
         END IF 
         IF ok% = - 1 THEN 
           IF Galle$ <> "j" THEN 
             ge$ = LEFT$ (Gesellschaft.vprodukt,20)
             ge$ = PAD$ (ge$,20)
             gsp$ = ge$ + "  -  " + sparte.vprodukt
             IF inhaus.vprodukt = 1 THEN 
               GSpart$(a%) = gsp$ + " **INH**" + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             ELSE 
               GSpart$(a%) = gsp$ + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             END IF 
             a% = a% + 1
           ELSE 
             IF NoAnzeige.vprodukt LIKE "j" THEN 
               ge$ = "*" + LEFT$ (Gesellschaft.vprodukt,20)
             ELSE 
               ge$ = LEFT$ (Gesellschaft.vprodukt,20)
             END IF 
             ge$ = PAD$ (ge$,20)
             gsp$ = ge$ + "  -  " + sparte.vprodukt
             IF inhaus.vprodukt = 1 THEN 
               GSpart$(a%) = gsp$ + "**INH**" + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             ELSE 
               GSpart$(a%) = gsp$ + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             END IF 
             a% = a% + 1
           END IF 
         END IF 
       END IF 
       REM END IF 
     END IF 
     SELECT NEXT FILE "Vprodukt" INDEX codevp.Vprodukt
   WEND 
   GSpartPrompt$ = GSpart$(0)
   IF a% > 0 THEN Gspartanz% = a%
  SELECT WHERE FILE "vprodukt"
  MOUSE ON 
 
 
    REM DIM dlg AS Dialog
    REM DIM control AS DialogControl
 
    Superbase.Dialogs.Add("ProdSel")
    SET dlg = Superbase.Dialogs.ProdSel
    REM dlg.OnActivate = "PFillList1"
    dlg.Move(0,0,526,310)
    dlg.Caption = "Produktauswahl"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(4,10,57,13)
    control.Caption = "Spartengruppen"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(137,10,57,13)
    control.Caption = "Gesellschaften"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(284,10,57,11)
    control.Caption = "Produkte"
 
    SET control = dlg.Add("spgruppen","DialogListBox")
    control.Move(2,23,127,274)
    control.ScrollBars = 2
    REM control.Sorted = 1
    control.Bind("GSpGruppe$","GSPGrausw$","GSpGrPrompt$")
    control.OnSelChange = "SelSpGruppe"
 
    SET control = dlg.Add("gesell","DialogListBox")
    control.Move(136,23,120,274)
    control.ScrollBars = 2
    control.Sorted = 1
    control.Bind("GGesell$","GGesellausw$","GGesellPrompt$")
    control.OnSelChange = "SelGesell"
 
    SET control = dlg.Add("produkte","DialogListBox")
    control.Move(260,23,218,274)
    control.ScrollBars = 2
    control.Sorted = 1
    control.Bind("GSpart$","GSpartausw$","GSpartPrompt$")
    control.OnSelChange = "SelProdukt"
 
    ggewprod$(0) = "gewÑhltes Produkt: "
    SET control = dlg.Add("prodwahl","DialogListBox")
    control.Move(2,296,477,14)
    control.Bind("ggewprod$","ggewprod1$","ggewprod2$")
 
 
    SET control = dlg.Add("OK","DialogCommandButton")
    control.Move(484,260,38,13)
    control.Default = 1
    control.Caption = "&OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("Abbruch","DialogCommandButton")
    control.Move(484,276,38,12)
    control.Default = 0
    control.Caption = "&Abbruch"
    control.ReturnValue = 0
 
    SET control = dlg.Add("Alle","DialogCommandButton")
    control.Move(484,292,38,12)
    control.Default = 0
    control.Caption = "&Alle"
    control.ReturnValue = 2
 
   DIALOG "ProdSel",req%
   REMOVE DIALOG "ProdSel"
   REM REQUEST "Dialog Ende",""
   REM REMOVE DIALOG ALL 
   IF req% = 2 THEN 
     Galle$ = "j"
     GOTO anf290620051
   END IF 
   IF req% = 1 THEN 
     REM REQUEST "ausgew.Produkt", LEFT$ (GSpartausw$(0),20)
     codevp% = VAL ( RIGHT$ (GSpartausw$(0),6))
     NewGetCodeVP% = codevp%
   END IF 
 Galle$ = "n"
 END FUNCTION 
 
SUB SelProdukt()
 lidx% = dlg.produkte.ListIndex
 IF lidx% <> 0 THEN 
   item$ = dlg.produkte.List(lidx%)
   codevp% = VAL ( RIGHT$ (item$,6))
   SELECT FIRST FILE "vprodukt" INDEX codevp.vprodukt
   SELECT KEY codevp% FILE "vprodukt" INDEX codevp.vprodukt
   ggewprod$ = "gewÑhltes Produkt: " + Gesellschaft.vprodukt + "  -  " + sparte.vprodukt
   IF dlg.prodwahl.ListCount > 0 THEN dlg.prodwahl.RemoveItem(1)
   dlg.prodwahl.AddItem(ggewprod$)
   REM REQUEST LEFT$ (ggewprod$,40),""
 END IF 
 
 END SUB 
 
SUB SelGesell()
 MOUSE OFF 
 FILE "spgruppe"
 INDEX Gruppe
 SELECT FIRST 
 lidx% = dlg.spgruppen.ListIndex
 IF lidx% <> 0 THEN 
   item$ = dlg.spgruppen.List(lidx%)
   poslang$ = RIGHT$ (item$,12)
   poskurz$ = LEFT$ (poslang$,6)
   codegrsp% = VAL (poskurz$)
   codeva% = VAL ( RIGHT$ (item$,6))
 END IF 
 REM IF codegrsp% < 1 THEN GOTO w160620053 
 lidy% = dlg.gesell.ListIndex
 IF lidy% <> 0 THEN 
   item$ = dlg.gesell.List(lidy%)
   codege% = VAL ( RIGHT$ (item$,6))
 END IF 
 REM CALL Fehler("codegrsp: " + poskurz$,"codege: " + RIGHT$ (item$,6))
 IF codege% < 1 THEN GOTO w160620053 
 
 FILE "vprodukt"
 SELECT WHERE 
 IF codeva% > 0 THEN 
   SELECT WHERE codegrsp.vprodukt = codegrsp% AND codege.vprodukt = codege% AND codeva.vprodukt = codeva%
 ELSE 
   SELECT WHERE codegrsp.vprodukt = codegrsp% AND codege.vprodukt = codege%
 END IF 
 INDEX codeva.vprodukt
 SELECT FIRST 
 IF RECCOUNT ("vprodukt") > RECCOUNT ("sparten") THEN 
   rc% = RECCOUNT ("vprodukt")
 ELSE 
   rc% = RECCOUNT ("sparten")
 END IF 
 REDIM GSpart$(rc%,1)
 REDIM GSpart$(rc%)
 INDEX codevp.vprodukt
 SELECT FIRST FILE "vprodukt"
   codevaold% = - 1
   a% = 0
   x% = dlg.produkte.ListCount
   IF x% > 0 THEN 
     FOR i% = 0 TO x% - 1
       dlg.produkte.RemoveItem(1)
     NEXT i%
   END IF 
   Gspartanz% = 0
   WHILE NOT EOF ("Vprodukt")
     IF codeva.vprodukt > 0 THEN 
       codeva% = codeva.Vprodukt
       codevaold% = codeva.Vprodukt
       ok% = - 1
       IF LTRIM$ (Sparte.vprodukt) <> "" THEN 
         IF Galle$ = "n" THEN 
           IF NoAnzeige.vprodukt LIKE "j" THEN ok% = 0
         END IF 
         IF gasp% = - 1 AND workstation% > 0 THEN 
           IF noanzaspbuero.vprodukt LIKE "j" THEN ok% = 0
         END IF 
         IF inhaus.vprodukt = 1 THEN 
           IF MNdisabled%("VERTRINHAUSSEE") OR MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") THEN 
             ok% = 0
           END IF 
         END IF 
         IF ok% = - 1 THEN 
           IF Galle$ <> "j" THEN 
             ge$ = LEFT$ (Gesellschaft.vprodukt,20)
             ge$ = PAD$ (ge$,20)
             wkn$ = PAD$ ( LTRIM$ (wknr.vprodukt),12)
             gsp$ = ge$ + "  -  " + sparte.vprodukt
             IF wknr.vprodukt <> "" THEN 
               gsp$ = wkn$ + gsp$
             END IF 
             IF inhaus.vprodukt = 1 THEN 
               GSpart$(a%) = gsp$ + " **INH**" + + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             ELSE 
               GSpart$(a%) = gsp$ + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             END IF 
             dlg.produkte.AddItem(GSpart$(a%))
             a% = a% + 1
           ELSE 
             IF NoAnzeige.vprodukt LIKE "j" THEN 
               ge$ = "*" + LEFT$ (Gesellschaft.vprodukt,20)
             ELSE 
               ge$ = LEFT$ (Gesellschaft.vprodukt,20)
             END IF 
             ge$ = PAD$ (ge$,20)
             wkn$ = PAD$ ( LTRIM$ (wknr.vprodukt),12)
             gsp$ = ge$ + "  -  " + sparte.vprodukt
             IF wknr.vprodukt <> "" THEN 
               gsp$ = wkn$ + gsp$
             END IF 
             IF inhaus.vprodukt = 1 THEN 
               GSpart$(a%) = gsp$ + " **INH**" + + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             ELSE 
               GSpart$(a%) = gsp$ + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             END IF 
             dlg.produkte.AddItem(GSpart$(a%))
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     END IF 
 
     SELECT NEXT FILE "Vprodukt" INDEX codevp.Vprodukt
   WEND 
   GSpartPrompt$ = GSpart$(0)
   x% = dlg.produkte.ListCount
  SELECT WHERE FILE "vprodukt"
w160620053: 
 MOUSE ON 
 END SUB 
 
 
SUB SelSpGruppe()
  REM GLOBAL GSpGruppe$(1),GSPGrausw$(1),GSpGrPrompt$
  REM GLOBAL GGesell$(1),GGesellausw$(1),GGesellPrompt$
  REM GLOBAL GSpart$(1),GSpartausw$(1),GSpartPrompt$
  REM SET STATUS GSPGrausw$(0)
 REM REQUEST "selspgr",""
 FILE "spgruppe"
 SELECT WHERE FILE "spgruppe"
 INDEX Gruppe
 SELECT FIRST 
 lidx% = dlg.spgruppen.ListIndex
 codeva% = 0
 codegrsp% = 0

 IF lidx% <> 0 THEN 
   item$ = dlg.spgruppen.List(lidx%)
   codeva% = VAL ( RIGHT$ (item$,6))
   poslang$ = RIGHT$ (item$,12)
   poskurz$ = LEFT$ (poslang$,6)
   codegrsp% = VAL (poskurz$)
   REM CALL Fehler(item$,poslang$ + "  poskurz " + poskurz$)
 END IF 
 REM IF codegrsp% < 1 THEN GOTO w160620052
 GSpGrPrompt$ = GSPGrausw$(0)
 REDIM GGesell$( RECCOUNT ("geadr"),1)
 REDIM GGesell$( RECCOUNT ("geadr"))
 FILE "vprodukt"
 INDEX codegrsp.vprodukt
 SELECT WHERE FILE "vprodukt"
 IF codeva% > 0 THEN 
   SELECT WHERE codegrsp.vprodukt = codegrsp% AND codeva.vprodukt = codeva%
   REM SELECT WHERE codegrsp.vprodukt = codegrsp%
 ELSE 
   SELECT WHERE codegrsp.vprodukt = codegrsp%
 END IF 
 INDEX codege.vprodukt
 SELECT FIRST FILE "vprodukt"
   codegeold% = - 1
   a% = 0
   x% = dlg.gesell.ListCount
   IF x% > 0 THEN 
     FOR i% = 0 TO x% - 1
       dlg.gesell.RemoveItem(1)
     NEXT i%
   END IF 
   GGesellanz% = 0
   WHILE NOT EOF ("Vprodukt")
     ok% = - 1
     IF Galle$ = "n" THEN 
       IF NoAnzeige.vprodukt LIKE "j" THEN ok% = 0
     END IF 
     IF gasp% = - 1 AND workstation% > 0 THEN 
       IF noanzaspbuero.vprodukt LIKE "j" THEN ok% = 0
     END IF 
     IF inhaus.vprodukt = 1 THEN 
       IF MNdisabled%("VERTRINHAUSSEE") OR MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") THEN 
         ok% = 0
       END IF 
     END IF 
     IF codege.vprodukt > 0 AND codege.vprodukt <> codegeold% AND ok% <> 0 THEN 
       codege% = codege.Vprodukt
       SELECT FIRST FILE "GEADR" INDEX codege.geadr
       SELECT KEY codege% FILE "GEADR" INDEX codege.geadr
       codegeold% = codege.Vprodukt
       j% = - 1
         IF LTRIM$ (Gesellschaft.vprodukt) <> "" THEN 
           REM CALL Fehler( STR$ (codeva%,"000000") + "   codeva%=0"," Codegrsp: " + STR$ (codegrsp%,"000000"))
           REM REQUEST "Gesell",Gesellschaft.vprodukt
           IF inhaus.geadr = 1 THEN 
             GGesell$(a%) = Gesellschaft.vprodukt + " **INH**" + SPACE$ (160) + STR$ (CodeGRSP.vprodukt,"000000") + STR$ (CodeGE.vprodukt,"000000")
           ELSE 
             GGesell$(a%) = Gesellschaft.vprodukt + SPACE$ (160) + STR$ (CodeGRSP.vprodukt,"000000") + STR$ (CodeGE.vprodukt,"000000")
           END IF 
           dlg.gesell.AddItem(GGesell$(a%))
           a% = a% + 1
         END IF 
     END IF 
     SELECT NEXT FILE "Vprodukt" INDEX codege.Vprodukt
   WEND 
   GGesellPrompt$ = GGesell$(0)
 
 REM GSpart$(1),GSpartausw$(1),GSpartPrompt$
 IF RECCOUNT ("vprodukt") > RECCOUNT ("sparten") THEN 
   rc% = RECCOUNT ("vprodukt")
 ELSE 
   rc% = RECCOUNT ("sparten")
 END IF 
 REDIM GSpart$(rc%,1)
 REDIM GSpart$(rc%)
 INDEX codevp.vprodukt
 SELECT FIRST 
   codevaold% = - 1
   a% = 0
   x% = dlg.produkte.ListCount
   IF x% > 0 THEN 
     FOR i% = 0 TO x% - 1
       dlg.produkte.RemoveItem(1)
     NEXT i%
   END IF 
   ook% = 1
   WHILE ook% = 1
     IF codeva.vprodukt > 0 THEN 
       codeva% = codeva.Vprodukt
       codevaold% = codeva.Vprodukt
       ok% = - 1
       IF LTRIM$ (Sparte.vprodukt) <> "" THEN 
         IF Galle$ = "n" THEN 
           IF NoAnzeige.vprodukt LIKE "j" THEN ok% = 0
         END IF 
         IF gasp% = - 1 AND workstation% > 0 THEN 
           IF noanzaspbuero.vprodukt LIKE "j" THEN ok% = 0
         END IF 
         IF inhaus.vprodukt = 1 THEN 
           IF MNdisabled%("VERTRINHAUSSEE") OR MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") THEN 
             ok% = 0
           END IF 
         END IF 
         IF ok% = - 1 THEN 
           IF Galle$ <> "j" THEN 
             ge$ = LEFT$ (Gesellschaft.vprodukt,20)
             ge$ = PAD$ (ge$,20)
             wkn$ = PAD$ ( LTRIM$ (wknr.vprodukt),12)
             gsp$ = ge$ + "  -  " + sparte.vprodukt
             IF wknr.vprodukt <> "" THEN 
               gsp$ = wkn$ + gsp$
             END IF 
             IF inhaus.vprodukt = 1 THEN 
               GSpart$(a%) = gsp$ + " **INH**" + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             ELSE 
               GSpart$(a%) = gsp$ + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             END IF 
             dlg.produkte.AddItem(GSpart$(a%))
             a% = a% + 1
           ELSE 
             IF NoAnzeige.vprodukt LIKE "j" THEN 
               ge$ = "*" + LEFT$ (Gesellschaft.vprodukt,20)
             ELSE 
               ge$ = LEFT$ (Gesellschaft.vprodukt,20)
             END IF 
             ge$ = PAD$ (ge$,20)
             wkn$ = PAD$ ( LTRIM$ (wknr.vprodukt),12)
             gsp$ = ge$ + "  -  " + sparte.vprodukt
             IF wknr.vprodukt <> "" THEN 
               gsp$ = wkn$ + gsp$
             END IF 
             IF inhaus.vprodukt = 1 THEN 
               GSpart$(a%) = gsp$ + " **INH**" + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             ELSE 
               GSpart$(a%) = gsp$ + SPACE$ (160) + STR$ (Codevp.vprodukt,"000000")
             END IF 
             dlg.produkte.AddItem(GSpart$(a%))
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     END IF 
 
     SELECT NEXT FILE "Vprodukt" INDEX codevp.Vprodukt
     IF EOF ("vprodukt") THEN ook% = 0
   WEND 
   GSpartPrompt$ = GSpart$(0)
  SELECT WHERE FILE "vprodukt"
w160620052: 
  MOUSE ON 
 
 END SUB 
 





 ' Bearbeitung der WKN
SUB WKNTab()
 CALL DFile(3,"WKNR" + _fpw$)
 CALL DFile(3,"KVERTRAG" + _fpw$)
 IF disabled%("SUPERVIS") THEN END SUB 
 
 _formend% = 0
 SET STATUS "Bereit"
 maske$ = "WKNR"
 IF eurosupport$ = "TRUE" THEN maske$ = "WKNR"
 FILE "WKNR"
 INDEX WKNR.WKNR
 SELECT FIRST 
 codekey% = codekey.WKNR
 aend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   SUPERVISsub% = 0
   IF FORM <> maske$ THEN 
     SET HEADING title$ + " - WKNR"
     IF EXISTS (GPrjForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GPrjForm$ + maske$
     ELSE 
       OPEN FORM GPrjForm$ + maske$
     END IF 
     SET f = superbase.form
    SET STATUS "WKNR"
     SELECT FORM KEY codekey% FILE "WKNR" INDEX codekey.WKNR
     FORM 
     CALL MNProgramm()
     CALL ButEnabled()
     REM FORM 
   END IF 
   MENU ON 
   f.suchen.visible = 0
   f.suchen.enabled = 0
   f.links1.enabled = 0
   f.rechts1.enabled = 0
   f.links1.visible = 0
   f.rechts1.visible = 0
   f.loeschen.visible = - 1
   MOUSE ON 
   FORM 
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   CALL ClearKBDBuffer()
   SELECT CASE SUPERVISsub%
   CASE 1
     REM Lîschen
     codekey% = codekey.WKNR
     IF NOT disabled%("WKNDEL") THEN 
       IF WKNr.wknr <> "000000" THEN 
         REQUEST "Wollen Sie wirklich den Datensatz lîschen?","",135,req%
         IF req% = 1 THEN 
           codekey% = codekey.WKNR
           SELECT FIRST FILE "WKNR" INDEX codekey.wknr
           SELECT KEY codekey% LOCK FILE "WKNR" INDEX codekey.wknr
           SELECT REMOVE FILE "WKNR"
           REQUEST "Datensatz gelîscht","",2
           SELECT FORM FIRST FILE "WKNR" INDEX wknr.wknr
           FORM 1
         END IF 
       ELSE 
         CALL Fehler("WKNr = 0 darf nicht gelîscht werden!","")
       END IF 
     END IF 
   CASE 2
     REM auswahl
         codekey% = codekey.WKNR
         SELECT FIRST FILE "WKNR" INDEX codekey.wknr
         SELECT KEY codekey% LOCK FILE "WKNR" INDEX codekey.wknr
         FORM 2
   CASE 3
     FORM 1
     SELECT FORM FIRST FILE "WKNR" INDEX wknr.wknr
     FORM 
   CASE 90
     REM Datensatz neu
     IF NOT disabled%("WKNNEW") THEN 
       codekey% = SER ("WKNR",0)
       BLANK FILE "WKNR"
       codekey.WKNR = codekey%
       zero.wknr = 0
       WKNR.WKNR = "99999999"
       WKNText.wknr = "Neue WKNR"
       STORE FILE "WKNR"
       UNLOCK CURRENT FILE "WKNR"
       SELECT KEY codekey% LOCK FILE "WKNR" INDEX codekey.WKNR
       FORM 2
       CALL ButDesabled()
       MOUSE ON 
       f.loeschen.visible = 0
       ENTER WKNR.WKNR,0
       CALL ButEnabled()
       aend% = 1
       f.suchen.visible = 0
       f.suchen.enabled = 0
       f.links1.enabled = 0
       f.rechts1.enabled = 0
       f.links1.visible = 0
       f.rechts1.visible = 0
       f.loeschen.visible = - 1
       MENU ON 
       IF abbruch% = - 1 THEN 
         SELECT KEY WKNR.WKNR FILE "WKNR" INDEX WKNR.WKNR
         FORM 
         abbruch% = 0
       END IF 

     END IF 
   CASE 99
     IF NOT disabled%("WKNEDIT") THEN 
       codekey% = codekey.WKNR
       IF wknr.wknr <> "000000" THEN 
         MENU OFF 
         CALL ButDesabled()
         MOUSE ON 
         f.loeschen.visible = 0
         ENTER WKNR.WKNR,0
         aend% = 1
         CALL ButEnabled()
         f.suchen.visible = 0
         f.suchen.enabled = 0
         f.links1.enabled = 0
         f.rechts1.enabled = 0
         f.links1.visible = 0
         f.rechts1.visible = 0
         f.loeschen.visible = - 1
         MENU ON 
 
         IF abbruch% = - 1 THEN 
           SELECT KEY WKNR.WKNR FILE "WKNR" INDEX WKNR.WKNR
           FORM 
           abbruch% = 0
         END IF 
         SELECT KEY codekey% FILE "WKNR" INDEX codekey.wknr
         FORM 
       ELSE 
         CALL Fehler("Die WKNr = 0 darf nicht bearbeitet werden!","")
       END IF 
     END IF 
  END SELECT 
 IF aend% = 1 THEN 
   aend% = 0
 END IF 
wend150620051: 
 SET STATUS ""
 WEND 
 _formend% = 0
 IF MOD ("WKNR") OR NEW ("WKNR") THEN CALL FStore("WKNR")
 END SUB 
 
 
 'statukeyauswahl fÅr Vertragsdatei
 
SUB VertrWKNR()
  cv% = lfdnr.kvertrag
  IF ag$ = "j" THEN 
    CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
    GOTO wend150620052
  END IF 
  IF disabled%("VERTRBEARB") THEN GOTO end150620052
   wknr$ = WKNR.kvertrag
   cv% = lfdnr.kvertrag
   DIM Waehrung$( RECCOUNT ("WKNR"))
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
     FILE "WKNR"
     DIM Auswahl1$(1)
     INDEX WKNR.WKNR
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("WKNR")
       Waehrung$(a%) = LTRIM$ (WKNR.WKNR) + "   -   " + WKNText.WKNR + "-" + WKNGesell.wknr + "(" + LTRIM$ ( STR$ (AAuf.wknr,",999999.0000")) + ")" + SPACE$ (120) + STR$ (codekey.WKNR,"000000")
       a% = a% + 1
       SELECT NEXT FILE "wknr"
     WEND 
     FILE "kvertrag"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,290,264,"WKNR","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,289,240,0," Auswahl WKNR"
      ADD DIALOG "PREISLIS",7,5,14,280,225,2,0,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,87,245,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,157,245,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        codekey% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY codekey% FILE "WKNR" INDEX codekey.WKNR
        SELECT KEY cv% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
        WKNR.kvertrag = WKNR.WKNR
        WKNText.kvertrag = WKNText.WKNR
        IF WKNText.kvertrag LIKE "<ohne zu*" THEN 
          WKNR.kvertrag = ""
          WKNText.kvertrag = ""
        END IF 
        CALL FStore("kvertrag")
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
        WKNR$ = WKNR.WKNR
      END IF 
 
 MOUSE ON 
 FORM 
wend150620052: 
 END SUB 
 
SUB VertrWKNR1()
  cv% = lfdnr.kvertrag
  IF ag$ = "j" THEN 
    CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
    GOTO wend1506200521
  END IF 
  IF disabled%("VERTRBEARB") THEN GOTO end150620052
   wknr$ = WKNR.kvertrag
   cv% = lfdnr.kvertrag
   DIM Waehrung$( RECCOUNT ("WKNR"))
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
     FILE "WKNR"
     DIM Auswahl1$(1)
     INDEX WKNR.WKNR
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("WKNR")
       Waehrung$(a%) = WKNText.WKNR + "   -   " + LTRIM$ (WKNR.WKNR) + "  -   " + WKNGesell.wknr + "(" + LTRIM$ ( STR$ (AAuf.wknr,",999999.0000")) + ")" + SPACE$ (120) + STR$ (codekey.WKNR,"000000")
       a% = a% + 1
       SELECT NEXT FILE "wknr"
     WEND 
     FILE "kvertrag"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,290,264,"WKNR","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,289,240,0," Auswahl WKNR"
      ADD DIALOG "PREISLIS",7,5,14,280,225,2,0,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,87,245,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,157,245,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        codekey% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY codekey% FILE "WKNR" INDEX codekey.WKNR
        SELECT KEY cv% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
        WKNR.kvertrag = WKNR.WKNR
        WKNText.kvertrag = WKNText.WKNR
        IF WKNText.kvertrag LIKE "<ohne zu*" THEN 
          WKNR.kvertrag = ""
          WKNText.kvertrag = ""
        END IF 
        CALL FStore("kvertrag")
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
        WKNR$ = WKNR.WKNR
      END IF 
 
 MOUSE ON 
 FORM 
wend1506200521: 
 END SUB 
  



SUB UnisuKv(code%,suindex$)
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   CALL DFile(3,"Buchung1" + _fpw$)
   SELECT WHERE FILE "Buchung1"
 ELSE 
   CALL DFile(3,"Buchung" + _fpw$)
   SELECT WHERE FILE "Buchung"
 END IF 
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 SELECT WHERE FILE "adrstat"
 CALL DFile(2,"OFFICE\adrgrup" + _fpw$)
 SELECT WHERE FILE "adrgrup"
 CALL DFile(3,"Kgeadr" + _fpw$)
 CALL DFile(3,"statukey" + _fpw$)
 
 CALL DFile(3,"sparten" + _fpw$)
 SELECT WHERE FILE "Sparten"
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 SELECT WHERE FILE "geadr"
 CALL DFile(3,"tarif" + _fpw$)
 SELECT WHERE FILE "tarif"
 CALL DFile(3,"maadr" + _fpw$)
 SELECT WHERE FILE "maadr"
 CALL DFile(3,"maadrgru" + _fpw$)
 SELECT WHERE FILE "maadrgru"
 CALL DFile(3,"kvertrag" + _fpw$)
 SELECT WHERE FILE "kvertrag"
 CALL DFile(3,"vprodukt" + _fpw$)
 SELECT WHERE FILE "vprodukt"
 CALL DFile(3,"tarif" + _fpw$)
 SELECT WHERE FILE "tarif"
 CALL DFile(3,"vorgang" + _fpw$)
 SELECT WHERE FILE "vorgang"
 CALL DFile(3,"vkond" + _fpw$)
 SELECT WHERE FILE "vkond"
 CALL DFile(3,"formular" + _fpw$)
 SELECT WHERE FILE "formular"
 CALL DFile(3,"spgruppe" + _fpw$)
 SELECT WHERE FILE "spgruppe"
 
 CALL DFile(3,"KVEXEXP" + _fpw$)
 
 IF GAFSK$ LIKE "TRUE" THEN 
   CALL DFile(3,"AFSKSUT" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SELECT WHERE FILE GAdrDat$
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 SELECT WHERE FILE GAkquiDat$
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 SELECT WHERE FILE "aktionen"
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 SELECT WHERE FILE GTelDat$
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(2,"OFFICE\tvorlage" + _fpw$)
 CALL DFile(2,"OFFICE\kvhis" + _fpw$)
 CALL DFile(2,"OFFICE\adrhis" + _fpw$)
 GVSupersuch% = - 1
 GCodeGE% = 0
 GCodeVA% = 0
 GCodeVP% = 0
 GCodeMA% = 0
 GDatumVON% = 0
 GDatumBis% = 0
 GSuFromAdr% = 0
 IF suindex$ LIKE "Codeva" THEN GCodeva% = code%
 IF suindex$ LIKE "Codema" THEN GCodema% = code%
 IF suindex$ LIKE "Codege" THEN GCodege% = code%
 IF suindex$ LIKE "Codevp" THEN GCodevp% = code%
 CALL VISuchen1()
 IF cuvt% > 0 THEN 
   CALL VINFBearb()
   IF G1Vertraege$(1) <> "" THEN CALL VAn280403()
 END IF 
 GVSupersuch% = 0
 GCodeGE% = 0
 GCodeVA% = 0
 GCodeVP% = 0
 GCodeMA% = 0
 GDatumVON% = 0
 GDatumBis% = 0
 GSuFromAdr% = 0
 END SUB 



  

 REM Erzeuge eine Empfehlung(EmpfehlTXT) bei der Adresse codeku1%, 17.09.2005
 REM par%=0, dann Adresse abfragen, par%=1 dann codeku1%=EmpfehlCode.GADRDat$
SUB GenerateEmpf(codeku1%,par%)
 datei$ = FILE 
 dind$ = INDEX 
 IF par% = 0 THEN 
   adr% = ADRSuche%(0)
 ELSE 
   adr% = EmpfehlCode.GADRDat$
 END IF 
 IF adr% <> 0 THEN 
   EmpfehlTXT1$ = ""
   FILE GADRDat$
   INDEX codeku.Gadrdat$
   SELECT FIRST FILE GADRDAT$ INDEX codeku.GADRDat$
   SELECT KEY adr% FILE GADRDAT$ INDEX codeku.GADRDat$
   EmpfehlTXT1$ = "Eintrag vom: " + DATE$ ( TODAY ,"0d.mm.yyyy") + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10)
   EmpfehlTXT1$ = EmpfehlTXT1$ + LTRIM$ (Nachname.GADRDat$) + "," + LTRIM$ (Vorname.GADRDat$) + "     Kundennummer: " + LTRIM$ (Kundennummer.GADRDat$) + CHR$ (13) + CHR$ (10)
   EmpfehlTXT1$ = EmpfehlTXT1$ + LTRIM$ (Stra·e.GADRDat$) + CHR$ (13) + CHR$ (10)
   EmpfehlTXT1$ = EmpfehlTXT1$ + LTRIM$ (plz.GADRDat$) + " " + LTRIM$ (ort.GADRDat$) + CHR$ (13) + CHR$ (10)
   IF Geburtstag.GAdrDat$ > 0 THEN 
     EmpfehlTXT1$ = EmpfehlTXT1$ + "Geburtstag: " + DATE$ (Geburtstag.GADRDat$,"0d.mm.yyyy") + CHR$ (13) + CHR$ (10)
   ELSE 
     EmpfehlTXT1$ = EmpfehlTXT1$ + "Geburtstag: " + CHR$ (13) + CHR$ (10)
   END IF 
   IF Erstkontakt.GAdrDat$ > 0 THEN 
     EmpfehlTXT1$ = EmpfehlTXT1$ + "Erstkontakt: " + DATE$ (Erstkontakt.GADRDat$,"0d.mm.yyyy") + CHR$ (13) + CHR$ (10)
   ELSE 
     EmpfehlTXT1$ = EmpfehlTXT1$ + "Erstkontakt: " + CHR$ (13) + CHR$ (10)
   END IF 
   IF letzter_Kontakt.GAdrDat$ > 0 THEN 
     EmpfehlTXT1$ = EmpfehlTXT1$ + "letzter Kontakt: " + DATE$ (letzter_Kontakt.GADRDat$,"0d.mm.yyyy") + CHR$ (13) + CHR$ (10)
   ELSE 
     EmpfehlTXT1$ = EmpfehlTXT1$ + "letzter Kontakt: " + CHR$ (13) + CHR$ (10)
   END IF 
   IF EXISTS (adr%,codeku.KVERTRAG) THEN 
     EmpfehlTXT1$ = EmpfehlTXT1$ + CHR$ (13) + CHR$ (10) + "VertrÑge:" + CHR$ (13) + CHR$ (10)
     FILE "KVERTRAG"
     INDEX codeku.kvertrag
     SELECT FIRST FILE "KVERTRAG"
     SELECT KEY adr% FILE "KVERTRAG" INDEX codeku.KVERTRAG
     ok% = 1
     WHILE NOT EOF ("KVERTRAG") AND codeku.kvertrag = adr% AND ok% = 1
       IF codeku.kvertrag = adr% THEN 
         test$ = LTRIM$ (Sparte.kvertrag) + "," + LTRIM$ (Gesellschaft.kvertrag)
         IF vs_Beginn.kvertrag > 0 THEN test$ = test$ + ", VSBeginn: " + DATE$ (vs_beginn.kvertrag,"0d.mm.yyyy")
         IF vsumme.kvertrag <> 0 THEN test$ = test$ + ", Versich.Sum.: " + LTRIM$ ( STR$ (vsumme.kvertrag,",999999999.00"))
         IF Beitrag.kvertrag <> 0 THEN test$ = test$ + ", Beitrag: " + LTRIM$ ( STR$ (Beitrag.kvertrag,",999999999.00"))
           zw$ = ""
           SELECT CASE zw.kvertrag
             CASE 0
               zw$ = " einm."
             CASE 1
               zw$ = " jÑhrl."
             CASE 2
               zw$ = " halbj."
             CASE 4
               zw$ = " viertelj."
             CASE 6
               zw$ = " 2monatl."
             CASE 12
               zw$ = " monatl."
           END SELECT 
           test$ = test$ + zw$
         test$ = test$ + ", " + Vstatustxt.kvertrag + CHR$ (13) + CHR$ (10)
         len1% = LEN (EmpfehlTXT1$)
         len2% = LEN (test$)
         lenges% = len1% + len2%
         IF lenges% < 4000 THEN 
           EmpfehlTXT1$ = EmpfehlTXT1$ + LTRIM$ (test$)
         ELSE 
           ok% = 0
         END IF 
       END IF 
       SELECT NEXT FILE "KVERTRAG" INDEX codeku.KVERTRAG
     WEND 
   END IF 
   SELECT FIRST FILE GADRDAT$ INDEX codeku.GADRDat$
   SELECT KEY codeku1% LOCK FILE GADRDAT$ INDEX codeku.GADRDat$
   EmpfehlTXT.GADRDat$ = EmpfehlTXT1$
   EmpfehlCode.GADRDat$ = adr%
   STORE FILE GADRDat$
 END IF 
 END SUB 



 REM ***********************************************************************************************************************************************
 REM                      Service - Center
 REM ***********************************************************************************************************************************************
SUB ServiceCenter()
 IF disabled%("SERVICESTATION") THEN END SUB 
 GSeaButDis% = 1
 GCodieRuf1% = 0
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gegrup" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"foerkond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 i% = 0
 REM CALL SearchInitSST("")
 GOTO w140420102
 DIM Keyword$(50)
 Keyword$(i%) = "Liste01 - alle in Haftung befindlichen VertrÑge eines Vermittlers oder aller Vermittler (Beginn+Haftung in Monaten=Haftungsende)"
 i% = i% + 1
 Keyword$(i%) = "Liste02 - alle lebenden VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen"
 i% = i% + 1
 Keyword$(i%) = "Liste03 - alle Fremd-VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen"
 i% = i% + 1
 Keyword$(i%) = "Liste04 - alle VertrÑge eines Vermittler, mit Wiedervorlage zwischen mm1 jjjj1 und mm2 jjjj2"
 i% = i% + 1
       DIM Lisaus$(1)
 
        
       CREATE DIALOG "KEYWORD",0,0,493,262,"Wahl der Listenart","MS Sans Serif",8
       ADD DIALOG "KEYWORD",4,0,1,493,209,0,""
       ADD DIALOG "KEYWORD",9,4,12,21,24,2
       ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie die Listenart aus:"
       ADD DIALOG "KEYWORD",7,21,30,448,176,2,2,Keyword$,Lisaus$,prompt$

       IF NOT MNdisabled%("VERTRINHAUSSEE") THEN 
         REM ADD DIALOG "BVERTRAG",2,10,345,84,11,0,"Inhouse-Vertrag J/N","j","n",Inhaus$
         ADD DIALOG "KEYWORD",4,5,215,280,25,0,"Optionen zur Anzeige von Inhouse-VertrÑgen"
         ADD DIALOG "KEYWORD",3,10,225,64,11,0,"nicht anzeigen",0,inhaus%
         ADD DIALOG "KEYWORD",3,77,225,64,11,0,"auch anzeigen",1,inhaus%
         ADD DIALOG "KEYWORD",3,143,225,124,11,0,"nur Inhouse-VertrÑge anzeigen",2,inhaus%
       END IF 
 

       ADD DIALOG "KEYWORD",1,157,245,55,15,1,"&OK",1,1
       ADD DIALOG "KEYWORD",1,213,245,55,15,0,"&Abbrechen",0,0
       DIALOG "KEYWORD",req%
       REMOVE DIALOG "KEYWORD"
       IF req% = 0 THEN GOTO end170320101
       test$ = LEFT$ (Lisaus$(0),7)



w140420102: 
 GSeaButDis% = 1
 GCodieRuf1% = 0
       CALL SearchInitSST("")
    REM CALL Fehler("Listen","")
       CALL SearchVorbSST("Liste01","Vertragslisten","Vermittler","Haftung","alle in Haftung befindlichen VertrÑge eines Vermittlers oder aller Vermittler (Beginn+Stornohaftung(Vertrag) in Monaten=Haftungsende)","")
       CALL SearchVorbSST("Liste02","Vertragslisten","Vermittler","Ablauf","alle lebenden VertrÑge eines Vermittler oder aller Vermittler, die bis zum tt.mm.jjjj ablaufen","")
       CALL SearchVorbSST("Liste03","Vertragslisten","Vermittler","Ablauf","alle Fremd-VertrÑge eines Vermittler oder aller Vermittler, die bis zum tt.mm.jjjj ablaufen","")
       CALL SearchVorbSST("Liste04","Vertragslisten","Vermittler","Wiedervorlage","alle lebenden VertrÑge eines Vermittler oder aller Vermittler, mit Wiedervorlage zwischen mm1 jjjj1 und mm2 jjjj2","")
       CALL SearchVorbSST("Liste05","Vertragslisten","Vermittler","VertragsÅbersicht einzeln","VertrÑge eines Vermittler","")
       CALL SearchVorbSST("Liste15","Vertragslisten","Vermittler","VertragsÅbersicht gesamt","VertrÑge aller Vermittler","")

       CALL SearchVorbSST("Liste06","Vertragslisten","Gesellschaft","VertragsÅbersicht einzeln","VertrÑge einer Gesellschaft","")
       CALL SearchVorbSST("Liste07","Vertragslisten","Gesellschaft","VertragsÅbersicht gesamt","VertrÑge aller Gesellschaften","")
       CALL SearchVorbSST("Liste08","Vertragslisten","Kunde","VertragsÅbersicht einzeln","verprovisionierte, nicht stornierte VertrÑge eines Kunden","")
       CALL SearchVorbSST("Liste09","Vertragslisten","Kunde","VertragsÅbersicht gesamt","verprovisionierte, nicht stornierte VertrÑge aller Kunden","")
       CALL SearchVorbSST("Liste10","Vertragslisten","Kunde","ohne Abschluss","VertrÑge ohne Abschluss (AntrÑge - werden noch nicht verprovisioniert) aller Kunden","")
       CALL SearchVorbSST("Liste11","Vertragslisten","Kunde","ohne Abschluss","VertrÑge ohne Poilcenummer aller Kunden","")
       CALL SearchVorbSST("Liste13","Vertragslisten","FremdvertrÑge","VertragsÅbersicht","FremdvertrÑge","")
       CALL SearchVorbSST("Liste14","Vertragslisten","Listengenerator","VertragsÅbersicht","Listengenerator fÅr VertrÑge","")
 
      
       CALL SearchVorbSST("Liste20","Vermittlerlisten","Vermittler","VermittlerÅbersicht","VermittlerÅbersicht","")
       CALL SearchVorbSST("Liste33","Vermittlerlisten","Geburtstagsliste","Vermittler","Generator fÅr Geburtstagslisten-Vermittler","")
       CALL SearchVorbSST("Liste05","Vermittlerlisten","Vermittler","VertragsÅbersicht einzeln","VertrÑge eines Vermittler","")
       CALL SearchVorbSST("Liste15","Vermittlerlisten","Vermittler","VertragsÅbersicht gesamt","VertrÑge aller Vermittler","")
       CALL SearchVorbSST("Liste14","Vermittlerlisten","Vertragsliste","Listengenerator","Listengenerator fÅr VertrÑge","")
       CALL SearchVorbSST("Liste21","Vermittlerlisten","Struktur","StrukturÅbersicht","StrukturÅbersicht ab einen bestimmten Vermittler","")
       CALL SearchVorbSST("Liste22","Vermittlerlisten","Struktur","SummenÅbersicht NeuvertrÑge","SummenÅbersicht NeuvertrÑge einzelner Vermittler mit Struktur in XLS","")
 
       CALL SearchVorbSST("Liste23","Vermittlerlisten","Konditionen","Listengenerator","Listengenerator Konditionen","")
       CALL SearchVorbSST("Liste24","Vermittlerlisten","Konditionen","KurzÅbersicht einzeln","KonditionsÅbersicht fÅr einen Vermittler","")
       CALL SearchVorbSST("Liste25","Vermittlerlisten","Konditionen","KurzÅbersicht gesamt","KonditionsÅbersicht fÅr alle Vermittler","")
       CALL SearchVorbSST("Liste26","Vermittlerlisten","Konditionen","LangÅbersicht einzeln","KonditionsÅbersicht fÅr einen Vermittler","")
       CALL SearchVorbSST("Liste27","Vermittlerlisten","Konditionen","LangÅbersicht gesamt","KonditionsÅbersicht fÅr alle Vermittler","")
       CALL SearchVorbSST("Liste28","Vermittlerlisten","Konditionen","Fîrderkonditionen gesamt","FîrderkonditionsÅbersicht fÅr alle Vermittler","")
 
       CALL SearchVorbSST("Liste30","Vermittlerlisten","Provisionsliste","Provisionsliste einzeln","Provisionsliste fÅr einen einzelnen Vermittler","")
       CALL SearchVorbSST("Liste31","Vermittlerlisten","Provisionsliste","Provisionsliste gesamt","Provisionsliste fÅr alle Vermittler","")
       CALL SearchVorbSST("Liste32","Vermittlerlisten","Stornoreserve","Stornoreserve gesamt","Export SR, Einheiten und SRAuto nach XLS fÅr alle Vermittler","")
 
       CALL SearchVorbSST("Liste40","Gesellschaftslisten","Gesellschaft","Gesellschaftsliste","Liste der Gesellschaften","")
       CALL SearchVorbSST("Liste06","Gesellschaftslisten","Vertragsliste","VertragsÅbersicht einzeln","VertrÑge einer Gesellschaft","")
       CALL SearchVorbSST("Liste07","Gesellschaftslisten","Vertragsliste","VertragsÅbersicht gesamt","VertrÑge aller Gesellschaften","")
       CALL SearchVorbSST("Liste14","Gesellschaftslisten","Vertragsliste","Listengenerator","Listengenerator fÅr VertrÑge","")
      
 
       CALL SearchVorbSST("Liste08","Kundenlisten","Vertragsliste","VertragsÅbersicht einzeln","verprovisionierte, nicht stornierte VertrÑge eines Kunden","")
       CALL SearchVorbSST("Liste09","Kundenlisten","Vertragsliste","VertragsÅbersicht gesamt","verprovisionierte, nicht stornierte VertrÑge aller Kunden","")
       CALL SearchVorbSST("Liste10","Kundenlisten","Vertragsliste","ohne Abschluss einzeln","VertrÑge ohne Abschluss (AntrÑge - werden noch nicht verprovisioniert)eines Kunden","")
       CALL SearchVorbSST("Liste11","Kundenlisten","Vertragsliste","ohne Abschluss gesamt","VertrÑge ohne Abschluss (AntrÑge - werden noch nicht verprovisioniert)aller Kunden","")
       CALL SearchVorbSST("Liste12","Kundenlisten","ProvisionsÅbersicht","Kunde einzeln","ProvisionsÅbersicht einzelner Kunde","")
       
       CALL SearchVorbSST("Liste14","Kundenlisten","Vertragsliste","Listengenerator","Listengenerator fÅr VertrÑge","")
       CALL SearchVorbSST("Liste50","Kundenlisten","Geburtstagsliste","Kunden","Generator fÅr Geburtstagslisten-Kunden","")
       CALL SearchVorbSST("Liste51","Kundenlisten","Adressliste","Adresse einzeln","Adresse einzeln","")
       CALL SearchVorbSST("Liste52","Kundenlisten","Adressliste","Adresse Listengenrator","Adress-/Telefonliste","")
       CALL SearchVorbSST("Liste53","Kundenlisten","Adressliste","Telefonliste gesamt","Telefonliste gesamt","")
       CALL SearchVorbSST("Liste54","Kundenlisten","Adressliste","Adressen letzter Kontakt","Adressen letzter Kontakt","")
       
       CALL SearchVorbSST("Liste12","Provisionslisten","Kunde","Kunde einzeln","ProvisionsÅbersicht einzelner Kunde","")
       CALL SearchVorbSST("Liste30","Provisionslisten","Vermittler","Vermittler einzeln","Provisionsliste fÅr einen einzelnen Vermittler","")
       CALL SearchVorbSST("Liste31","Provisionslisten","Vermittler","Vermittler gesamt","Provisionsliste fÅr alle Vermittler","")
 
       CALL SearchVorbSST("Liste33","Geburtstagslisten","Vermittler","Geburtstagsliste","Generator fÅr Geburtstagslisten-Vermittler","")
       CALL SearchVorbSST("Liste50","Geburtstagslisten","Kunde","Geburtstagsliste","Generator fÅr Geburtstagslisten-Kunden","")
       c$ = "aa"
       REM CALL Fehler("","")
       req3% = CALL ("_SearchShow",c$)
       GReShow% = - 1
       GOTO w260420101
w260420102: 
       IF GReShow% = - 1 THEN 
         req3% = CALL ("_SearchReShow",c$)
       ELSE 
         GOTO w140420102
       END IF 
w260420101: 
       IF c$ <> "" THEN 
         test$ = c$
       ELSE 
         GOTO end170320101
       END IF 
       o1NeuSuGeadr$ = GNeuSuGeadr$
       GNeuSuGeadr$ = "j"

       SELECT CASE test$
       CASE "Liste01"
         REM CALL Fehler("Liste01","")
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         ma1% = 0
         REQUEST "Wollen Sie die Liste fÅr ALLE Vermittler erzeugen?","",130,req%
         IF req% <> 1 THEN 
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           ma1% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
           IF ma1% > 0 THEN CALL LServStat1(ma1%)
         ELSE 
           CALL LServStat1(0)
         END IF 
         DIRECTORY _ppath$
       CASE "Liste02"
         REM CALL Fehler("Liste02","")
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         ma1% = 0
         REQUEST "Wollen Sie die Liste fÅr ALLE Vermittler erzeugen?","",130,req%
         IF req% <> 1 THEN 
           REM ma1% = GetCodeMA%(GMaCodeMA%,Workstation%)
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           ma1% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
           CALL LServStat2(ma1%)
         ELSE 
           CALL LServStat2(0)
         END IF 
         DIRECTORY _ppath$
       CASE "Liste03"
         REM CALL Fehler("Liste03","")
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         ma1% = 0
         REQUEST "Wollen Sie die Liste fÅr ALLE Vermittler erzeugen?","",130,req%
         IF req% <> 1 THEN 
           REM ma1% = GetCodeMA%(GMaCodeMA%,Workstation%)
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           ma1% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
           CALL LServStat3(ma1%)
         ELSE 
           CALL LServStat3(0)
         END IF 
         DIRECTORY _ppath$
       CASE "Liste04"
         REM CALL Fehler("Liste04","")
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         ma1% = 0
         REQUEST "Wollen Sie die Liste fÅr ALLE Vermittler erzeugen?","",130,req%
         IF req% <> 1 THEN 
           REM ma1% = GetCodeMA%(GMaCodeMA%,Workstation%)
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           ma1% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
           CALL LServStat4(ma1%)
         ELSE 
           CALL LServStat4(0)
         END IF 
         DIRECTORY _ppath$
       CASE "Liste05"
         REM VertragsÅbersicht Agenturen (Auswahl)
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL DFile(3,"maadr" + _fpw$)
         REM codema% = GetCodeMA%(cuma%,Workstation%)
         CALL LIST6()
         DIRECTORY _ppath$
       CASE "Liste06"
         REM VertragsÅbersicht Gesellschaften (Auswahl)
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL DFile(3,"geadr" + _fpw$)
         REM codege% = GetCodeGE%(cuge%)
         CALL LIST4()
         DIRECTORY _ppath$
       CASE "Liste07"
         REM VertragsÅbersicht Gesellschaften (gesamt)
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL LIST3()
         DIRECTORY _ppath$
       CASE "Liste08"
         REM VertragsÅbersicht Kunden-Auswahl (verprovisioniert,nicht storniert)
         IF disabled%("KVERTRAG") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
         CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
         CALL DFile(3,"sparten" + _fpw$)
         CALL DFile(3,"geadr" + _fpw$)
         CALL DFile(3,"geadr2" + _fpw$)
         CALL DFile(3,"maadr" + _fpw$)
         CALL DFile(3,"maadrgru" + _fpw$)
         CALL DFile(3,"kvertrag" + _fpw$)
         CALL DFile(3,"vorgang" + _fpw$)
         CALL DFile(3,"vkond" + _fpw$)
         adr% = ADRSuche%(0)
         REM CALL LIST2(0)
         CALL LIST2(adr%)
         DIRECTORY _ppath$
       CASE "Liste09"
         REM VertragsÅbersicht Kunden-Gesamt (verprovisioniert,nicht storniert)
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL LIST1()
         DIRECTORY _ppath$
       CASE "Liste10"
         REM VertrÑge ohne Abschlu·
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL LIST7(0)
         DIRECTORY _ppath$
       CASE "Liste11"
         REM VertrÑge ohne Abschlu· (keine Versicherungsnummer)
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL LIST10()
       CASE "Liste12"
         IF disabled%("BUCHUNG") OR disabled%("PROVISIONSLISTE") THEN GOTO w260420102
         adr% = ADRSuche%(0)
         IF adr% > 0 THEN 
           knr% = adr%
           SELECT FIRST FILE GadrDat$ INDEX codeku.GADRDat$
           SELECT KEY knr% FILE GadrDat$ INDEX codeku.GADRDat$
           eu% = 1
           drwaehr$ = " in Euro"
           IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
             CALL VLIST3(eu%)
           ELSE 
             CALL VLIST3Z(eu%)
           END IF 
         END IF 
       CASE "Liste13"
         REM VertragsÅbersicht FremdvertrÑge
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL LIST9()
       CASE "Liste14"
         REM Listengenerator VertrÑge
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         CALL VertrUniRep(0,0,0,0,0,0,0,0,1, - 1,tarif%)
         DIRECTORY _ppath$
       CASE "Liste15"
         REM VertragsÅbersicht Agenturen (gesamt)
         IF disabled%("KVERTRAG") OR disabled%("MAADRVERTRUEBERSICHT") THEN GOTO w260420102
         DIRECTORY _ppath$
         CALL LIST5()
       CASE "Liste20"
         REM Vermittler-Liste
         IF disabled%("MAADR") OR disabled%("MAADRLIST") THEN GOTO w260420102
         CALL MAADRLIST()
       CASE "Liste21"
         REM Struktur ab einem Vermittler
         IF disabled%("MAADR") OR disabled%("MAADRLIST") THEN GOTO w260420102
           REM codema% = GetCodeMA%(_cuma%,Wks1%)

           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           codema% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
         _cuma% = codema%
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY codema% FILE "maadr" INDEX codema.maadr
         CALL StruDruck(codema%)
         DIRECTORY _ppath$
       CASE "Liste22"
         REM StrukturÅbersicht mit Zahlen,NeuabschlÅsse
         IF disabled%("MAADR") OR disabled%("MAADRLIST") OR disabled%("BUCHUNG") OR disabled%("PROVISIONSLISTE") THEN GOTO w260420102
         REM rep% = GetCodeMA%(_cuma%,Wks1%)
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           rep% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
         _cuma% = rep%
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY rep% FILE "maadr" INDEX codema.maadr
         CALL StatisStrMA()
         DIRECTORY _ppath$
       CASE "Liste23"
         REM Listengenerator (Konditionen)
         IF disabled%("KONDITIONVIEW") OR disabled%("GEKOND") OR disabled%("MAADRKONDUEBERSICHT") OR disabled%("MAADR") OR disabled%("MAADRLIST") THEN GOTO w260420102
         IF ag$ <> "j" THEN 
           DIRECTORY _ppath$
           IF NOT disabled%("DATALOCK") THEN CALL GekondUniRep(0,0,0,1,1)
         ELSE 
           CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
         END IF 
         DIRECTORY _ppath$
       CASE "Liste24"
         REM Konditionsliste aktueller Vermittler - Kurzform
         IF disabled%("KONDITIONVIEW") OR disabled%("GEKOND") OR disabled%("MAADRKONDUEBERSICHT") OR disabled%("MAADR") THEN GOTO w260420102
         REM rep% = GetCodeMA%(_cuma%,Wks1%)
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           REM% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
         _cuma% = rep%
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY rep% FILE "maadr" INDEX codema.maadr
         CALL KLIST()
         DIRECTORY _ppath$
       CASE "Liste25"
         REM Konditionsliste aktueller Vermittler - Kurzform
         IF disabled%("KONDITIONVIEW") OR disabled%("GEKOND") OR disabled%("MAADRKONDUEBERSICHT") OR disabled%("MAADR") OR disabled%("MAADRLIST") THEN GOTO w260420102
         REM rep% = GetCodeMA%(_cuma%,Wks1%)
         REM _cuma% = rep%
         REM SELECT FIRST FILE "maadr" INDEX codema.maadr
         REM SELECT KEY rep% FILE "maadr" INDEX codema.maadr
         CALL KLISTAll()
         DIRECTORY _ppath$
       CASE "Liste26"
         REM Konditionsliste aktueller Vermittler - Langform
         IF disabled%("KONDITIONVIEW") OR disabled%("GEKOND") OR disabled%("MAADRKONDUEBERSICHT") OR disabled%("MAADR") THEN GOTO w260420102
         REM rep% = GetCodeMA%(_cuma%,Wks1%)
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           rep% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
         _cuma% = rep%
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY rep% FILE "maadr" INDEX codema.maadr
         CALL KLIST2()
         DIRECTORY _ppath$
       CASE "Liste27"
         REM Konditionsliste aktueller Vermittler - Langform
         IF disabled%("KONDITIONVIEW") OR disabled%("GEKOND") OR disabled%("MAADRKONDUEBERSICHT") OR disabled%("MAADR") OR disabled%("MAADRLIST") THEN GOTO w260420102
         REM rep% = GetCodeMA%(_cuma%,Wks1%)
         REM _cuma% = rep%
         REM SELECT FIRST FILE "maadr" INDEX codema.maadr
         REM SELECT KEY rep% FILE "maadr" INDEX codema.maadr
         CALL KLIST2All()
         DIRECTORY _ppath$
       CASE "Liste28"
         REM Vermittler-Liste FôP
         IF disabled%("KONDITIONVIEW") OR disabled%("GEKOND") OR disabled%("MAADRKONDUEBERSICHT") OR disabled%("MAADR") OR disabled%("FOERKOND") OR disabled%("MAADRLIST") THEN GOTO w260420102
         CALL KONDFOE()
         DIRECTORY _ppath$
       CASE "Liste30"
         REM KontenÅbersicht Agenturen (Auswahl)
         IF disabled%("BUCHUNG") OR disabled%("PROVISIONSLISTE") THEN GOTO w260420102
         IF ag$ <> "j" THEN 
           IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
             DIRECTORY _ppath$
             CALL UEBERSAG1()
           ELSE 
             DIRECTORY _ppath$
             CALL UEBERSAG1Z()
           END IF 
         ELSE 
           CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
         END IF 
         DIRECTORY _ppath$
       CASE "Liste31"
         REM KontenÅbersicht Agenturen (gesamt)
         IF disabled%("BUCHUNG") OR disabled%("PROVISIONSLISTE") THEN GOTO w260420102
         IF ag$ <> "j" THEN 
           IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
             CALL PROVILIST()
           ELSE 
             IF GASP% THEN 
               IF workstation% = 0 THEN 
                 CALL PROVILISTZ()
               ELSE 
                 CALL Fehler("Die Gesamtprovisionsliste kann nur von der Zentrale aus gedruckt werden!","")
               END IF 
             ELSE 
               CALL PROVILISTZ()
             END IF 
           END IF 
         ELSE 
           CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
         END IF 
         DIRECTORY _ppath$
       CASE "Liste32"
         IF disabled%("BUCHUNG") OR disabled%("MAADR") OR disabled%("MAADRLIST") THEN GOTO w260420102
         CALL SRExpExcel()
         DIRECTORY _ppath$
       CASE "Liste33"
         IF disabled%("MAADR") OR disabled%("MAADRLIST") THEN GOTO w260420102
         CALL GEBLISTEV()
         DIRECTORY _ppath$
       CASE "Liste40"
         REM Gesellschaftsliste
         IF disabled%("GEADR") OR disabled%("GEADRLIST") THEN GOTO w260420102
         CALL LGEADR()
         DIRECTORY _ppath$
       CASE "Liste50"
         IF disabled%("ADRDRUCKEN") THEN GOTO w260420102
         REM Geburtstagsliste
         ccdir$ = DIRECTORY 
         GAdrDat$ = "ADRESSEN"
         GConDat$ = "CONNECT"
         GTelDat$ = "TELEFON"
         GAkquiDat$ = "AKQUISE"
         GDokDat$ = "DOKUMENT"
         CALL GEBLISTE()
         DIRECTORY ccdir$
       CASE "Liste51"
         IF disabled%("ADRDRUCKEN") THEN GOTO w260420102
         CALL ADREinzSu()
       CASE "Liste52"
         IF disabled%("ADRDRUCKEN") THEN GOTO w260420102
         CALL AdrSelSuL("n")
       CASE "Liste53"
         IF disabled%("ADRDRUCKEN") THEN GOTO w260420102
         CALL AdrSelSuL("j")
       CASE "Liste54"
         IF disabled%("ADRDRUCKEN") THEN GOTO w260420102
         CALL AdrLeKontSul()
       END SELECT 
       GOTO w260420102
end170320101: 
 GNeuSuGeadr$ = o1NeuSuGeadr$
 GSeaButDis% = 0
 IF OPEN ("KVTMP") THEN CLOSE FILE "KVTMP"
 END SUB 

SUB LServStat1(ma%)
   REM Liste01 - alle in Haftung befindlichen VertrÑge eines Vermittlers (Beginn+Haftung in Monaten=Haftungsende)
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name$ = vorname.maadr + " " + nachname.maadr
   CALL KVRech(1,ma%,0,0)
   REQUEST "Wollen Sie die Liste nach MS Excel exportieren?","",130,req%
   IF req% = 1 THEN 
     CALL ServExpXLS1(Gf%)
   ELSE 
     CALL ASERV1(ma%,"Alle in Haftung befindlichen VertrÑge")
   END IF 
 END SUB 

SUB LServStat2(ma%)
 REM Liste02 - alle lebenden VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name$ = vorname.maadr + " " + nachname.maadr
   bis$ = TODAY 
lsanf220320102: 
   CREATE DIALOG "Konto1",0,0,221,145,title$,"MS Sans Serif",8
   ADD DIALOG "Konto1",9,6,7,24,22,2
   ADD DIALOG "Konto1",5,34,8,170,9,0,"Liste02:"
   ADD DIALOG "Konto1",4,34,14,176,5,0,""
   ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, bis zu welchem Datum Sie eine öbersicht wÅnschen."
   REM ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
   REM ADD DIALOG "Konto1",5,34,80,13,8,0,"vom"
   REM ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
   ADD DIALOG "Konto1",5,72,80,12,8,0,"bis"
   ADD DIALOG "Konto1",6,86,79,45,11,0,0,bis$,10
   ADD DIALOG "Konto1",1,50,124,55,15,1,"&Weiter",1,1
   ADD DIALOG "Konto1",1,110,124,55,15,0,"&Abbruch",0,0
   DIALOG "Konto1",req%
   REMOVE DIALOG "Konto1"

   REM IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = TODAY ELSE bisdat$ = bis$
   REM IF DateOK%(vondat$) THEN 
     REM vondat% = DAYS (vondat$)
   REM ELSE 
     REM CALL Fehler("ungÅltiges Von-Datum","")
     REM GOTO lsanf220320102
   REM END IF 
   IF req% = 1 THEN 
     IF DateOK%(bisdat$) THEN 
       bisdat% = DAYS (bisdat$)
     ELSE 
       CALL Fehler("ungÅltiges Bis-Datum","")
       GOTO lsanf220320102
     END IF 
     CALL KVRech(2,ma%,0,bisdat%)
     REQUEST "Wollen Sie die Liste nach MS Excel exportieren?","",130,req%
     IF req% = 1 THEN 
       CALL ServExpXLS1(Gf%)
     ELSE 
       CALL ASERV1(ma%,"Alle NICHT stornierten- /NICHT Fremd VertrÑge, die bis zum " + bisdat$ + " ablaufen")
     END IF 
   END IF 
 END SUB 


SUB LServStat3(ma%)
 REM Liste03 - alle Fremd-VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name$ = vorname.maadr + " " + nachname.maadr
   bis$ = TODAY 
lsanf220320103: 
   CREATE DIALOG "Konto1",0,0,221,145,title$,"MS Sans Serif",8
   ADD DIALOG "Konto1",9,6,7,24,22,2
   ADD DIALOG "Konto1",5,34,8,170,9,0,"Liste03:"
   ADD DIALOG "Konto1",4,34,14,176,5,0,""
   ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, bis zu welchem Datum Sie eine öbersicht wÅnschen."
   REM ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
   REM ADD DIALOG "Konto1",5,34,80,13,8,0,"vom"
   REM ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
   ADD DIALOG "Konto1",5,72,80,12,8,0,"bis"
   ADD DIALOG "Konto1",6,86,79,45,11,0,0,bis$,10
   ADD DIALOG "Konto1",1,50,124,55,15,1,"&Weiter",1,1
   ADD DIALOG "Konto1",1,110,124,55,15,0,"&Abbruch",0,0
   DIALOG "Konto1",req%
   REMOVE DIALOG "Konto1"
   REM IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = "31.12.2199" ELSE bisdat$ = bis$
   REM IF DateOK%(vondat$) THEN 
     REM vondat% = DAYS (vondat$)
   REM ELSE 
     REM CALL Fehler("ungÅltiges Von-Datum","")
     REM GOTO lsanf220320102
   REM END IF 
   IF req% = 1 THEN 
     IF DateOK%(bisdat$) THEN 
       bisdat% = DAYS (bisdat$)
     ELSE 
       CALL Fehler("ungÅltiges Bis-Datum","")
       GOTO lsanf220320103
     END IF 
     CALL KVRech(3,ma%,0,bisdat%)
     REQUEST "Wollen Sie die Liste nach MS Excel exportieren?","",130,req%
     IF req% = 1 THEN 
       CALL ServExpXLS1(Gf%)
     ELSE 
       CALL ASERV1(ma%,"Alle FremdvertrÑge, die bis zum " + bisdat$ + " ablaufen")
     END IF 
   END IF 
 END SUB 


SUB LServStat4(ma%)
 REM Liste04 - alle VertrÑge eines Vermittler, mit Wiedervorlage zwischen mm1 jjjj1 und mm2 jjjj2
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name$ = vorname.maadr + " " + nachname.maadr
   CALL KVRech(4,ma%,0,0)
 END SUB 



   REM Waehrung$(0) = "Filter deaktiviert"
   REM Waehrung$(1) = "alle nicht stornierten,nicht Fremdvertr.,nicht Altvertr." + SPACE$ (90) + "17"
   REM Waehrung$(2) = "alle nicht stornierten,alle Fremdvertr.,nicht Altvertr." + SPACE$ (90) + "18"
   REM Waehrung$(3) = "lebend" + SPACE$ (90) + "01"
   REM Waehrung$(4) = "leben/kurzfristig/unterjÑhrig" + SPACE$ (90) + "02"
   REM Waehrung$(5) = "ruhend/Anwartschaft" + SPACE$ (90) + "03"
   REM Waehrung$(6) = "storniert" + SPACE$ (90) + "04"
   REM Waehrung$(7) = "ruhend/beitragsfrei" + SPACE$ (90) + "05"
   REM Waehrung$(8) = "beitragsfrei" + SPACE$ (90) + "06"
   REM Waehrung$(9) = "beitragsfrei durch Leistung" + SPACE$ (90) + "07"
   REM Waehrung$(10) = "Beitragsstundung" + SPACE$ (90) + "08"
   REM Waehrung$(11) = "Sonstiges" + SPACE$ (90) + "09"
   REM Waehrung$(12) = "Altvertrag" + SPACE$ (90) + "10"
   REM Waehrung$(13) = "Fremdvertrag" + SPACE$ (90) + "11"
   REM Waehrung$(14) = "Antrag" + SPACE$ (90) + "12"
   REM Waehrung$(15) = "storniert durch Dynamisierung" + SPACE$ (90) + "13"
   REM Waehrung$(16) = "Bestandteil eines BÅndelungsvertrages" + SPACE$ (90) + "14"
   REM Waehrung$(17) = "Antragswiderruf" + SPACE$ (90) + "15"
   REM Waehrung$(18) = "Policenwiderspruch" + SPACE$ (90) + "16" 




 REM Zentrale Vertragssuchroutine
SUB KVRech(liste%,ma%,vondat%,bisdat%)
 DIM Monate%(12)
 IF OPEN ("KVTMP") THEN CLOSE FILE "kvtmp"
 CALL DFile(3,"KVTMP" + _fpw$)
 IF RECCOUNT ("KVTMP") < 0 THEN REMOVE FROM FILE "KVTMP"
 i% = 0
 Gf% = 0
 j% = RECCOUNT ("KVERTRAG")
 MOUSE OFF 
 FILE "KVERTRAG"
 SELECT CASE liste%
   CASE 1
     REM Liste01 - alle in Haftung befindlichen VertrÑge eines Vermittlers (Beginn+Haftung in Monaten=Haftungsende)
     INDEX lfdnr.kvertrag
   CASE 2
     REM Liste02 - alle lebenden VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen
     INDEX lfdnr.kvertrag
   CASE 3
     REM Liste03 - alle Fremd-VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen
     INDEX lfdnr.kvertrag
   CASE 4
     REM Liste04 - alle VertrÑge eines Vermittler, mit Wiedervorlage zwischen mm1 jjjj1 und mm2 jjjj2
     INDEX lfdnr.kvertrag
     mm1% = 0
     jj1% = 0
     mm2% = 0
     jj2% = 0
     mm1$ = "00"
     mm2$ = "00"
     jj1$ = "0000"
     jj2$ = "0000"
lsanf220320104: 
     CREATE DIALOG "Konto1",0,0,221,145,title$,"MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     REM ADD DIALOG "Konto1",5,34,8,170,9,0,"Liste02:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,36,0,"Bitte geben Sie ein, fÅr welchen Zeitraum Sie eine öbersicht wÅnschen (Monat1 mm Jahr1 jjjj  und Monat2 mm Jahr2 jjjj)."
     REM ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
     ADD DIALOG "Konto1",5,34,80,13,8,0,"M1"
     ADD DIALOG "Konto1",6,53,79,15,11,0,0,mm1$,2
     ADD DIALOG "Konto1",5,102,80,12,8,0,"J1"
     ADD DIALOG "Konto1",6,116,79,25,11,0,0,jj1$,4
     ADD DIALOG "Konto1",5,34,95,13,8,0,"M2"
     ADD DIALOG "Konto1",6,53,94,15,11,0,0,mm2$,2
     ADD DIALOG "Konto1",5,102,95,12,8,0,"J2"
     ADD DIALOG "Konto1",6,116,94,25,11,0,0,jj2$,4
     ADD DIALOG "Konto1",1,50,124,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,124,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     IF req% = 1 THEN 
       ON ERROR GOTO er030520101
       mm1% = VAL (mm1$)
       mm2% = VAL (mm2$)
       jj1% = VAL (jj1$)
       jj2% = VAL (jj2$)
       IF mm1% = 0 AND mm2% = 0 AND jj1% = 0 AND jj2% = 0 THEN 
         CALL Fehler("Es wurden keine Werte eingegeben!","")
         GOTO lsanf220320104
       END IF 
       GOTO er030520102
er030520101: 
       CALL Fehler("Eine der Eingaben ist falsch!","Achten Sie darauf, dass Sie nur ZIFFERN eingeben und keine Buchstaben.")
       GOTO lsanf220320104
er030520102: 
       ON ERROR GOTO ErrorHandler
       IF mm1% > 12 THEN 
         CALL Fehler("Monatsangabe fÅr Monat 1 ist zu gro·!","Sie darf nur zwischen 0 und 12 liegen!")
         GOTO lsanf220320104
      END IF 
      IF mm2% > 12 THEN 
        CALL Fehler("Monatsangabe fÅr Monat 2 ist zu gro·!","Sie darf nur zwischen 0 und 12 liegen!")
        GOTO lsanf220320104
      END IF 

      mm1$ = STR$ (mm1%,"00")
      mm2$ = STR$ (mm2%,"00")
      jj1$ = STR$ (jj1%,"0000")
      jj2$ = STR$ (jj2%,"0000")
      jahrvon% = jj1%
      jahrbis% = jj2%

      REM IF mm1% > mm2% THEN 
        REDIM Monate%(12,1)
        REDIM Monate%(12)
        a% = 0
        MOUSE OFF 
        FOR i% = mm1% TO 13
          IF a% > 0 AND i% = 1 THEN jahrvon% = jahrvon% + 1
          IF i% < 13 THEN 
            Monate%(a%) = i%
          ELSE 
            i% = 1
            Monate%(a%) = i%
            IF a% > 0 AND i% = 1 THEN jahrvon% = jahrvon% + 1
          END IF 
          IF i% = mm2% THEN 
            IF jj1% > 0 AND jj2% > 0 THEN 
              IF a% > 0 AND jahrvon% = jahrbis% THEN i% = 14
            ELSE 
              i% = 14
            END IF 
          END IF 
          a% = a% + 1
        NEXT i%
      REM END IF 

     ELSE 
       GOTO e040420101
     END IF 

 END SELECT 
 FILE "kvertrag"
 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
 k$ = "KVERTRAG"
 liste4ok% = 0
 REDIM GVertraege$( RECCOUNT ("KVERTRAG"))
 WHILE NOT EOF ("KVERTRAG")
   i% = i% + 1
   ok% = - 1
   MOUSE OFF 
   IF MNdisabled%("VERTRINHAUSSEE") THEN 
    IF inhaus.kvertrag = 1 THEN GOTO w140420101
   END IF 
   SELECT CASE liste%
     CASE 1
       REM Liste01 - alle in Haftung befindlichen VertrÑge eines Vermittlers (Beginn+Haftung in Monaten=Haftungsende)
       IF vs_nr.k$ LIKE "xxxxxxxxxxxx*" OR vs_nr.k$ LIKE "65436543" OR vs_nr.k$ LIKE "25139" THEN 
         REM CALL Fehler(vs_nr.k$,"")
       END IF 
       IF CodeVstatus.k$ <> 04 AND CodeVstatus.k$ <> 13 AND CodeVstatus.k$ <> 10 AND CodeVstatus.k$ <> 11 AND CodeVstatus.k$ <> 15 AND CodeVstatus.k$ <> 16 AND CodeVstatus.k$ <> 12 THEN 
         IF vs_beginn.k$ > 0 AND SRHaftung.k$ > 0 THEN 
           haftende% = 0
           haftende% = DatumBerech%(vs_beginn.k$,SRHaftung.k$)
           IF haftende% > 0 AND haftende% >= TODAY THEN 
             IF ma% > 0 THEN 
               IF ma% <> codema.k$ THEN ok% = 0
             END IF 
             IF ok% = - 1 THEN 
               BLANK FILE "kvtmp"
               a% = CopyRecord%("kvertrag","kvtmp")
               HaftpflichtDat.kvtmp = haftende%
               STORE FILE "kvtmp"
               GVertraege$(Gf%) = STR$ (lfdnr.kvtmp,"000000")
               Gf% = Gf% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     CASE 2
       REM Liste02 - alle lebenden VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen
       IF vs_nr.k$ LIKE "xxxxxxxxxxxx*" OR vs_nr.k$ LIKE "65436543" OR vs_nr.k$ LIKE "25139" THEN 
         REM CALL Fehler(vs_nr.k$,"")
       END IF 
       IF CodeVstatus.k$ <> 04 AND CodeVstatus.k$ <> 13 AND CodeVstatus.k$ <> 10 AND CodeVstatus.k$ <> 11 AND CodeVstatus.k$ <> 15 AND CodeVstatus.k$ <> 16 THEN 
         IF kÅndigung.k$ > 0 AND kÅndigung.k$ < bisdat% THEN 
             IF ma% > 0 THEN 
               IF ma% <> codema.k$ THEN ok% = 0
             END IF 
             IF ok% = - 1 THEN 
               haftende% = 0
               IF vs_beginn.k$ > 0 AND SRHaftung.k$ > 0 THEN haftende% = DatumBerech%(vs_beginn.k$,SRHaftung.k$)
               BLANK FILE "kvtmp"
               a% = CopyRecord%("kvertrag","kvtmp")
               HaftpflichtDat.kvtmp = haftende%
               STORE FILE "kvtmp"
               GVertraege$(Gf%) = STR$ (lfdnr.kvtmp,"000000")
               Gf% = Gf% + 1
             END IF 
         END IF 
       END IF 
     CASE 3
       REM Liste03 - alle Fremd-VertrÑge eines Vermittler, die bis zum tt.mm.jjjj ablaufen
       IF vs_nr.k$ LIKE "xxxxxxxxxxxx*" OR vs_nr.k$ LIKE "65436543" OR vs_nr.k$ LIKE "25139" THEN 
         REM CALL Fehler(vs_nr.k$,"")
       END IF 
       IF Fremdvertrag.k$ = "j" THEN 
         IF kÅndigung.k$ > 0 AND kÅndigung.k$ < bisdat% THEN 
             IF ma% > 0 THEN 
               IF ma% <> codema.k$ THEN ok% = 0
             END IF 
             IF ok% = - 1 THEN 
               BLANK FILE "kvtmp"
               a% = CopyRecord%("kvertrag","kvtmp")
               REM HaftpflichtDat.kvtmp = KÅndigung.k$
               STORE FILE "kvtmp"
               GVertraege$(Gf%) = STR$ (lfdnr.kvtmp,"000000")
               Gf% = Gf% + 1
             END IF 
         END IF 
       END IF 
     CASE 4
       REM Liste04 - alle VertrÑge eines Vermittler, mit Wiedervorlage zwischen mm1 jjjj1 und mm2 jjjj2
         wmon% = wmon.k$
         wjahr% = wjahr.k$
         IF wmon% < 1 THEN 
           wmon% = 0
         ELSE 
           REM CALL Fehler("","")
         END IF 
         IF wjahr% < 1 THEN wjahr% = 0
           REM CALL Fehler( STR$ (wmon%,"00") + " " + STR$ (wjahr%,"0000"),"vor test")
         IF (mm1% > 0 OR mm2% > 0) THEN 
           REM IF (wmon% >= mm1% AND wmon% <= mm2%) THEN 
           gefunden% = 0
           FOR kk% = 0 TO 12
             IF gefunden% = 0 AND Monate%(kk%) > 0 AND wmon% = Monate%(kk%) THEN 
               gefunden% = - 1
               kk% = 13
               IF ma% > 0 THEN 
                 IF ma% <> codema.k$ THEN ok% = 0
               END IF 
             END IF 
             
           NEXT kk%
           IF gefunden% <> - 1 THEN ok% = 0
           
         END IF 
         IF (wjahr% > 0) AND (jj1% > 0 OR jj2% > 0) THEN 
           IF (wjahr% >= jj1% AND wjahr% <= jj2%) THEN 
             IF ma% > 0 THEN 
               IF ma% <> codema.k$ THEN ok% = 0
             END IF 
             IF wjahr% = jj2% THEN 
               IF wmon% > mm2% THEN ok% = 0
             END IF 
             IF wjahr% = jj1% THEN 
               IF wmon% < mm1% THEN 
                 ok% = 0
               END IF 
             END IF 
           ELSE 
             ok% = 0
           END IF 
         END IF 
         REM IF wmon% > 0 THEN CALL Fehler( STR$ (wmon%,"00") + " " + STR$ (wjahr%,"0000"), STR$ (ok%,"0"))
         IF ok% = - 1 THEN 
           haftende% = 0
           IF vs_beginn.k$ > 0 AND SRHaftung.k$ > 0 THEN haftende% = DatumBerech%(vs_beginn.k$,SRHaftung.k$)
           BLANK FILE "kvtmp"
           a% = CopyRecord%("kvertrag","kvtmp")
           HaftpflichtDat.kvtmp = haftende%
           STORE FILE "kvtmp"
           GVertraege$(Gf%) = STR$ (lfdnr.kvtmp,"000000")
           Gf% = Gf% + 1
           liste4ok% = - 1
         END IF 
         MOUSE OFF 
   END SELECT 
w140420101: 
   SET STATUS STR$ (i%,",999999") + " verarbeitet/ " + STR$ (Gf%,",999999") + " gefunden/ von: " + STR$ (j%,",999999")
   SELECT NEXT FILE "kvertrag"
   MOUSE OFF 
 WEND 
 IF liste% = 4 AND liste4ok% = - 1 THEN 
   REQUEST "Wollen Sie die Liste nach MS Excel exportieren?","",130,req%
   IF req% = 1 THEN 
     CALL ServExpXLS1(Gf%)
   ELSE 
     CALL ASERV1(ma%,"Alle VertrÑge, mit Wiedervorlage zwischen Monat " + mm1$ + "   " + mm2$ + " und/oder Jahr " + jj1$ + "   " + jj2$)
   END IF 
 ELSE 
   CALL Fehler("Es wurden keine DatensÑtze gefunden, die den Auswahlkriterien entsprechen!","")
 END IF 
e040420101: 
 MOUSE ON 
 END SUB 


 REM berechnet DatumBerech% = beginn1ab%+monatadd%
FUNCTION DatumBerech%(beginn1ab%,monatadd%)
 DatumBerech% = 0
           _day% = DAY (beginn1ab%)
           _month% = MONTH (beginn1ab%)
           _year% = YEAR (beginn1ab%)
           _month% = _month% + monatadd%
           REM CALL Fehler(begin1ab$,begin2ab$)
       
           WHILE _month% > 0
             _year% = _year% + 1
             _month% = _month% - 12
           WEND 
           IF _month% <= 0 THEN 
             _year% = _year% - 1
             _month% = _month% + 12
           END IF 
           IF _day% < 1 THEN _day% = 1
           IF _day% > 28 THEN 
             IF _month% = 2 THEN _day% = 28
             IF (_month% = 4 OR _month% = 6 OR _month% = 9 OR _month% = 11) AND _day% > 30 THEN _day% = 30
           END IF 
           DatumBerech% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
 END FUNCTION 


SUB ASERV1(ma%,uebers$)
 CALL PRep("ASERV1")
 REM REPORT USING "ASERV1"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis

 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 

 GROUP Nachname.MAADR
 BEFORE GROUP Nachname.MAADR
     SET REPORT PAGE "H_Nachname.M002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP Nachname.MAADR
     SET REPORT PAGE "F_Nachname.M002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
  
 SET QUERY ON 
 SET QUERY LOCK OFF 
 ON ERROR GOTO EAserv1
 SET FIRST PAGE HEADING OFF 
 Ueberschr$ = uebers$
 IF ma% = 0 THEN 
   SELECT ;
     WHERE CodeMA.KVTMP = CodeMA.MAADR AND CodeGE.KVTMP = CodeGE.GEADR AND CodeVA.KVTMP = CodeVA.SPARTEN AND CodeKU.KVTMP = CodeKU.ADRESSEN
     ORDER REPORT Nachname.MAADR,Vorname.MAADR,Gesellschaft.KVTMP,Sparte.KVTMP
     TO ASK 
 ELSE 
   SELECT ;
     WHERE CodeMA.KVTMP = CodeMA.MAADR AND CodeGE.KVTMP = CodeGE.GEADR AND CodeVA.KVTMP = CodeVA.SPARTEN AND CodeKU.KVTMP = CodeKU.ADRESSEN AND codema.maadr = ma%
     ORDER REPORT Nachname.MAADR,Vorname.MAADR,Gesellschaft.KVTMP,Sparte.KVTMP
     TO ASK 
 END IF 
 END SELECT 
EAserv1: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 


SUB ServExpXLS1(a%)
 
         MOUSE OFF 
         CALL DFile(3,"KVEXEXP" + _fpw$)
         CALL DFile(3,"AGDIR" + _fpw$)
         CALL DFile(3,"SPGRUPPE" + _fpw$)
         CALL DFile(2,"OFFICE\Telefon" + _fpw$)
         FILE "agdir"
         INDEX codeagdir.agdir
         FILE "KVEXEXP"
         SELECT FIRST 
         IF RECCOUNT ("KVEXEXP") > 0 THEN REMOVE FROM FILE "KVEXEXP"
         REM CALL Fehler("Export nach MS Excel","")
         FOR i% = 0 TO a%
            IF Gvertraege$(i%) <> "" THEN 
              SET STATUS STR$ (i%) + " von " + STR$ (a%) + " DatensÑtze kopiert"
              codevt% = VAL ( RIGHT$ (Gvertraege$(i%),6))
              SELECT KEY codevt% FILE "kvtmp" INDEX lfdnr.kvtmp
              SELECT FIRST FILE "maadr" INDEX codema.maadr
              SELECT KEY codema.kvtmp FILE "maadr" INDEX codema.maadr
              SELECT FIRST FILE "AGDIR" INDEX codeagdir.agdir
              SELECT KEY codeagdir.maadr FILE "AGDIR" INDEX codeagdir.agdir
              SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
              SELECT KEY codeku.kvtmp FILE "ADRESSEN" INDEX codeku.adressen
              SELECT FIRST FILE "sparten" INDEX codeva.sparten
              SELECT KEY codeva.kvtmp FILE "sparten" INDEX codeva.sparten
              SELECT FIRST FILE "spgruppe" INDEX codegrsp.spgruppe
              SELECT KEY codegrsp.sparten FILE "spgruppe" INDEX codegrsp.spgruppe
              IF GASP% = - 1 THEN 
                SELECT FIRST FILE "filiale" INDEX filialnr.filiale
                SELECT KEY workstation.kvtmp FILE "filiale" INDEX filialnr.filiale
              END IF 
              BLANK FILE "KVEXEXP"
              REM axxxa% = CopyRecord%("kvtmp","KVEXEXP")
              VNehmer.KVexexp = VNehmer.kvtmp
 
              IF Inhaus.kvtmp = 1 THEN 
                inhouse.kvexexp = "J"
              ELSE 
                inhouse.kvexexp = "N"
              END IF 
              Gesellschaft.kvexexp = Gesellschaft.kvtmp
              Sparte.kvexexp = Sparte.kvtmp
              IF MNdisabled%("SEEEINGBEI") THEN 
              ELSE 
                Eingereicht_Bei.kvexexp = EingereichtBei.kvtmp
              END IF 
              VS_NR.kvexexp = VS_NR.kvtmp
              Direktion.kvexexp = Direktion.agdir
              Einheiten.kvexexp = STR$ (Einheiten.kvtmp,",999999.0000")
              VStatus.kvexexp = VStatusTxT.kvtmp
              IF Antragsdatum.kvtmp > 0 THEN Antragsdatum.kvexexp = DATE$ (Antragsdatum.kvtmp,"0d.mm.yyyy")
              IF VS_Beginn.kvtmp > 0 THEN VS_Beginn.kvexexp = DATE$ (VS_Beginn.kvtmp,"0d.mm.yyyy")
              IF KÅndigung.kvtmp > 0 THEN Kuendigung.kvexexp = DATE$ (KÅndigung.kvtmp,"0d.mm.yyyy")
              IF HaftpflichtDat.kvtmp > 0 THEN HaftungBis.kvexexp = DATE$ (HaftpflichtDat.kvtmp,"0d.mm.yyyy")
              IF beitrag.kvtmp > 0 THEN Beitrag.kvexexp = LTRIM$ ( STR$ (Beitrag.kvtmp,",99999999.00"))
              IF Bewertungssumme.kvtmp > 0 THEN Bewertungssumme.kvexexp = LTRIM$ ( STR$ (Bewertungssumme.kvtmp,",9999999999"))
              IF VSumme.kvtmp > 0 THEN VSUmme.kvexexp = LTRIM$ ( STR$ (VSUmme.kvtmp,",9999999999"))
              Waehrung.kvexexp = Waehrung.kvtmp
              Kennzeichen.kvexexp = Kennzeichen.kvtmp
              Fabrikat.kvexexp = Fabrikat.kvtmp
              Typ_Nr.kvexexp = Typ_Nr.kvtmp
              zwtxt.KVEXEXP = ZW2Str$(ZW.kvtmp)
              SRHaftung.kvexexp = LTRIM$ ( STR$ (SRHaftung.kvtmp,"999"))
              Postanschrift.kvexexp = Postanschrift.adressen
              POSTBriefanrede.kvexexp = POSTBriefanrede.adressen
              Vermittler.kvexexp = Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr
              PostanVermittle.kvexexp = Postanschrift.maadr
              Agenturnr.kvexexp = Agenturnr.maadr
              spartenart.kvexexp = spartenart.sparten
              spartengruppe.kvexexp = gruppe.spgruppe
              IF GASP% = - 1 THEN Buero.kvexexp = Name.filiale
              ProvSperreJN.kvexexp = ProvSperreJN.kvtmp
              IF ProvSperreVom.kvtmp > 0 THEN ProvSperreVom.kvexexp = DATE$ (ProvSperreVom.kvtmp,"0d.mm.yyyy")
              BerProtok.kvexexp = BerProtok.kvtmp
              IF BerProtokVom.kvtmp > 0 THEN BerProtokVom.kvexexp = DATE$ (BerProtokVom.kvtmp,"0d.mm.yyyy")
              REM IF vs_Beginn.KVEXEXP < 1 THEN vs_Beginn.KVEXEXP = 1
              REM CALL Fehler("Export0 nach Excel","")
              IF EXISTS (codeku.kvtmp,codeku.telefon) THEN 
                SELECT FIRST FILE "telefon" INDEX Qcodekutel.telefon
                Qcodekutel$ = STR$ (codeku.kvtmp,"000000") + "000000"
                SELECT KEY Qcodekutel$ FILE "telefon" INDEX Qcodekutel.telefon
                itel% = 0
                WHILE NOT EOF ("telefon") AND codeku.telefon = codeku.kvtmp AND itel% < 5
                  itel% = itel% + 1
                  IF codeku.telefon = codeku.kvtmp AND itel% < 5 THEN 
                    feldt$ = "Tel" + STR$ (itel%,"0") + ".kvexexp"
                    feldt$$ = Art.telefon + " " + nummer.telefon
                  END IF 
                  SELECT NEXT FILE "telefon" INDEX Qcodekutel.telefon
                WEND 
              END IF 
              Nachname.kvexexp = Nachname.adressen
              Vorname.kvexexp = Vorname.adressen
              Ort.kvexexp = Ort.adressen
              Plz.kvexexp = plz.adressen
              Strasse.kvexexp = Stra·e.adressen
              STORE FILE "KVEXEXP"
            END IF 
         NEXT i%
         REM CALL Fehler("Export0 nach Excel","Zwischendatei beendet")
         dateiname1$ = "*.xls"
w090420101: 
         REQUEST "Speichern als MS Excel-Datei..."," ",27,req%,dateiname1$
         IF req% <> 0 AND LTRIM$ (dateiname1$) = "" THEN 
           CALL Fehler("Bitte fÅllen Sie den Dateinamen korrekt aus (maximal 8 Zeichen vor dem Punkt, danach XLS)","")
           GOTO w090420101
         END IF 
         IF req% <> 0 THEN 
           FILE "KVEXEXP"
           INDEX vnehmer.kvexexp
           SELECT FIRST FILE "KVEXEXP"
           MOUSE OFF 
           msg$ = "öbergabe der Daten an die MS Excel-Datei!"
           SET STATUS msg$
           REM CALL Fehler("","")
           ON ERROR GOTO VexpEx170420021
           REM EXPORT FILE "KVEXEXP" TO dateiname1$
           Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
           Superbase.Converters.SBF.SourceFile = "KVEXEXP"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = dateiname1$
           Superbase.Converters.XLS.StartRow = 2
           Superbase.Converters.XLS.StartCol = 1
           Superbase.Converters.XLS.EndRow = - 1
           Superbase.Converters.XLS.EndCol = - 1
           Superbase.Converters.XLS.UseLabels = - 1
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
           MOUSE ON 
           a% = CALL ("ShellExecute",0,"open",dateiname1$,"","",1)
VexpEx170420021: 
           ON ERROR GOTO ErrorHandler
           WAIT FOR 2
           CLOSE FILE "KVEXEXP"
           CALL Fehler("Ausgabe nach MS Excel ist beendet!","")
           MOUSE ON 
         END IF 
 END SUB 




SUB SearchInitSST(fu$)
 GReShow% = 0
 REM CALL Fehler("DoInit","")
 GCODieRuf% = - 1
 GCODieRuf2% = - 1
 GCodieRuf3% = 0
 REM MENU 1,9,0,"aus Termin-Suchliste &wÑhlen,F10","TERKurzSuche","Auflistung Termine"
           f1$ = "Rubrik"
           f2$ = "Art"
           f3$ = "Spezifizierung"
           f4$ = "Listen-Nummer"
           f5$ = "Bezeichnung"
           f6$ = "Kommentar"
           f7$ = ""
           f8$ = ""
 
           f9$ = ""
           f10$ = ""
           f11$ = ""
           f12$ = ""
           f13$ = ""
           f14$ = ""
           f15$ = ""
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbSST(ListNumber$,Rubrik$,Art$,Art2$,Bezeichnung$,Kommentar$)
               GGGcodeku$ = ListNumber$
               f1$ = FN ansi(Rubrik$)
               f2$ = FN ansi(Art$)
               f3$ = FN ansi(Art2$)
               f4$ = FN ansi(ListNumber$)
               f5$ = FN ansi(Bezeichnung$)
               f6$ = FN ansi(Kommentar$)
               f7$ = ""
               f8$ = ""
               f9$ = ""
               f10$ = ""
               f11$ = ""
               f12$ = ""
               f13$ = ""
               f14$ = ""
               f15$ = ""
               f16$ = ""
               f17$ = "":f18$ = "":f19$ = "":f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
FUNCTION GetVermGruppe$(AGr$)
 GetVermGruppe$ = ""
 END FUNCTION 


FUNCTION GetGesGruppe$(Gag$)
 GetGesGruppe$ = ""
 END FUNCTION 



SUB ADREinzSu()
  SELECT FIRST FILE "supervis" INDEX codema.supervis
  SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
  fussma$ = "gedruckt durch: " + Name.supervis + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
   FILE GAdrDat$
   SELECT WHERE FILE GAdrDat$
   opt% = 1
   _CodeKU% = 0
   _CodeKU% = ADRSuche%(0)
   IF _CodeKU% = 0 THEN GOTO e200420101 
   IF opt% = 1 THEN 
     IF _projekt$ <> "AKTE" THEN 
       REQUEST "Sollen alle VorgÑnge zu dieser Adresse gedruckt werden?","",135,cmplt%
     ELSE 
       cmplt% = 0
     END IF 
     FILE GTelDat$
     INDEX codeku.GTelDat$
     SELECT KEY _Codeku% FILE GTelDat$ INDEX codeku.GTelDat$
     FILE GAdrDat$
     MOUSE OFF 
     SELECT WHERE FILE GAdrDat$
     EXECUTE "SELECT WHERE codeku.GAdrDat$ = _codeku%"
     REM 071098
     SELECT FIRST 
     KurzLang$ = "n"
     IF anrede.GadrDat$ LIKE "Herr*" OR anrede.GadrDat$ LIKE "FrÑ*" OR anrede.GadrDat$ LIKE "Frau*" OR anrede.GadrDat$ LIKE "Fami*" OR anrede.GadrDat$ LIKE "Ehe*" THEN 
       title2$ = "Adressangaben zu " + nachname.GAdrDat$ + ", " + vorname.GadrDat$
     ELSE 
       title2$ = "Adressangaben zu " + nachname.GAdrDat$ + " " + Geburtsname.GadrDat$
     END IF 
     REM title2$ = title2$ + " " + fussma$
     IF cmplt% = 1 THEN 
       Terminejn$ = "j"
       FILE GAkquiDat$
       INDEX codeku.GAkquiDat$
       SELECT FIRST 
       SELECT KEY _codeku% FILE GAkquiDat$ INDEX codeku.GAkquiDat$
       SELECT WHERE FILE GAkquiDat$
       EXECUTE "SELECT WHERE CodeKU.GAkquiDat$ = _CodeKU%"
       INDEX termin.GAkquiDat$
       SELECT FIRST 
     END IF 
     FILE GAdrDat$
     wbericht$ = GAdrDat$
     CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
e200420101: 
     SELECT WHERE FILE GAdrDat$
     SELECT WHERE FILE GAkquiDat$
 
 END SUB 



SUB AdrSelSuL(adrtelefon$)
   FILE GAdrDat$
   REM ausgewÑhlte Adressen
     cfilt$ = WHERE 
     KurzLang$ = "n"
     opt1% = 2
     stichw$ = "n"
     stichwort$ = ""
     option2% = 1
     VertragJN$ = "n"
     Terminejn$ = "n"
     GohneVertr$ = "n"
     ON ERROR GOTO ErrorHandler
     CREATE DIALOG "ADRFilter",0,0,290,221,title$,"MS Sans Serif",8
     ADD DIALOG "ADRFilter",4,5,0,280,134,0," Suche nach "
     ADD DIALOG "ADRFilter",6,169,30,112,13,128,0,suna$,50
     ADD DIALOG "ADRFilter",6,169,46,112,13,128,0,suna1$,50
     ADD DIALOG "ADRFilter",3,14,11,72,11,0,"Kundennummer",6,opt1%
     ADD DIALOG "ADRFilter",3,14,25,34,11,0,"Anrede",1,opt1%
     ADD DIALOG "ADRFilter",3,14,38,68,11,0,"Nachname/Firma",2,opt1%
     ADD DIALOG "ADRFilter",3,14,52,22,10,0,"Ort",3,opt1%
     ADD DIALOG "ADRFilter",3,14,67,28,11,0,"PLZ",4,opt1%
     ADD DIALOG "ADRFilter",3,14,81,79,11,0,"Stra·e",5,opt1%
     ADD DIALOG "ADRFilter",5,169,16,111,12,0,"Bitte den Suchbegriff eingeben"
     ADD DIALOG "ADRFilter",5,150,32,14,11,0,"von"
     ADD DIALOG "ADRFilter",5,150,46,12,11,0,"bis"
     ADD DIALOG "ADRFilter",2,169,60,85,11,0,"Alle Angaben drucken","n","j",KurzLang$
     ADD DIALOG "ADRFilter",2,169,75,85,11,0,"Termine mitdrucken","j","n",Terminejn$
     IF _projekt$ LIKE "PROVIS" AND GAdrDat$ LIKE "ADRESSEN" THEN 
       ADD DIALOG "ADRFilter",2,169,90,115,11,0,"VertrÑge zur Adresse drucken!","j","n",VertragJN$
       ADD DIALOG "ADRFilter",2,140,100,138,11,0,"nur Adressen, die keine VertrÑge haben","j","n",GohneVertr$
 
     END IF 
     ADD DIALOG "ADRFilter",2,14,118,84,11,0,"Stichwort einbeziehen","j","n",stichw$
     IF _projekt$ LIKE "PROVIS" THEN 
       ADD DIALOG "ADRFilter",2,105,118,105,11,0,"Adressen einer Agentur","j","n",mitarb$
       ADD DIALOG "ADRFilter",2,14,102,105,11,0,"Adress-Status einbeziehen","j","n",adrstatus$
       ADD DIALOG "ADRFilter",2,210,118,70,11,0,"Adress-Gruppe","j","n",adrgruppe$
     END IF 
     ADD DIALOG "ADRFilter",4,5,135,200,60,0,"Ausgabeziel"
     ADD DIALOG "ADRFilter",3,14,149,124,11,0,"Ausgabe auf Drucker/Fenster",1,Option2%
     ADD DIALOG "ADRFilter",3,14,162,155,11,0,"Ausgabe in dBASE - Datei fÅr Serienbriefe",2,Option2%
     ADD DIALOG "ADRFilter",3,14,175,148,11,0,"Ausgabe in MS EXCEL - Datei",3,Option2%
     ADD DIALOG "ADRFilter",2,129,139,60,11,0,"als Telefonliste","j","n",adrtelefon$
 
     ADD DIALOG "ADRFilter",4,205,135,80,60,0,"Sortierung"
     ADD DIALOG "ADRFilter",3,207,149,50,11,0,"Nachname",1,Option3%
     ADD DIALOG "ADRFilter",3,207,162,50,11,0,"PLZ",2,Option3%
 
 
     ADD DIALOG "ADRFilter",1,90,204,49,14,1,"&Weiter",1,1
     ADD DIALOG "ADRFilter",1,142,204,49,14,0,"&Abbruch",0,0
     DIALOG "ADRFilter",req%
     REMOVE DIALOG ALL 
     IF req% = 1 THEN 
       IF Option3% = 1 THEN sort$ = "Nachname"
       IF Option3% = 2 THEN sort$ = "plz"
       IF mitarb$ = "j" THEN 
         IF GASP% <> - 1 THEN 
           FILE "maadr"
           INDEX nachname
           SELECT FIRST 
           a% = 0
           SELECT FIRST 
           REDIM AdrFound$( RECCOUNT ("maadr"))
           WHILE NOT EOF ("maadr")
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.MAADR) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF sok% THEN 
               AdrFound$(a%) = LTRIM$ (nachname) + "," + LTRIM$ (vorname) + SPACE$ (80) + STR$ (codema,"000000")
               a% = a% + 1
             END IF 
             SELECT NEXT FILE "MAADR"
           WEND 
           AdrFound$(a%) = ""
           LAuswahl$ = AdrFound$(0)
           LAuswahl1$(0) = LAuswahl$
           CREATE DIALOG "ADRSTICHW",0,0,194,202,title$,"MS Sans Serif",8
           ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
           ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
           ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
           DIALOG "ADRSTICHW",req5%
           MOUSE ON 
           REMOVE DIALOG "ADRSTICHW"
           IF req5% = 1 THEN 
             LAuswahl$ = LAuswahl1$(0)
             scodema% = VAL ( RIGHT$ (LAuswahl$,6))
             SELECT FIRST 
             SELECT KEY scodema% FILE "maadr" INDEX codema.maadr
             smaname$ = nachname.maadr + ", " + vorname.maadr
           ELSE 
             mitarb$ = "n"
             GOTO adrdr140996
           END IF 
         END IF 
         IF GASP% THEN 
          'Jan: modi ---------------------
          wks1% = workstation%
          IF workstation% > 0 THEN 
            wks1% = workstation%
            REM rep% = GetCodeMA%(cuma%,Workstation%)
           oGNeuSuGeadr$ = GNeuSuGeadr$
           GNeuSuGeadr$ = "j"
           rep% = GetCodeMA%(GMaCodeMA%,Workstation%)
           GNeuSuGeadr$ = oGNeuSuGeadr$
          ELSE 
            IF GMASuperCount% > 0 THEN 
              req% = 0
            ELSE 
              REQUEST "Mîchten Sie die BÅrostruktur zur Suche benutzen?","",130,req%
            END IF 
            IF req% = 1 THEN 
              a% = SelectOffice%("VorgÑnger-Auswahl","",1,0)
              IF a% <> - 1 THEN 
                zzz% = a%
                wks% = zzz%'Aaarg ... Spaghetti-Code 
                codema% = VAL (GetWkscodema$("",wks%))
                rep% = codema%
              ELSE 
                CALL Fehler("Es wurde kein BÅro gewÑhlt!","")
                rep% = 0
              END IF 
            ELSE 
              rep% = GetCodeMA%(_cuma%,Wks1%)
            END IF 
          END IF 
          IF rep% <> 0 THEN 
            scodema% = rep%
            SELECT FIRST 
            SELECT KEY scodema% FILE "maadr" INDEX codema.maadr
            smaname$ = nachname.maadr + ", " + vorname.maadr
          ELSE 
            mitarb$ = "n"
            req% = 0
            GOTO adrdr140996
          END IF 
         END IF 
 
       END IF 
       FILE GAdrDat$
       IF adrgruppe$ = "j" THEN 
         REDIM AdrFound$( RECCOUNT ("ADRGRUP"),1)
         REDIM AdrFound$( RECCOUNT ("ADRGRUP"))
         FILE "ADRGRUP"
         INDEX keyword.adrgrup
         SELECT FIRST 
         iii% = 0
         WHILE NOT EOF ("ADRGrup")
           AdrFound$(iii%) = keyword.adrgrup
           iii% = iii% + 1
           SELECT NEXT 
         WEND 
         CREATE DIALOG "ADRSTICHW",0,0,194,202,"Adress-Gruppen-Auswahl","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
         ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           adrgrup$ = LEFT$ (LAuswahl$)
           IF LAuswahl$ = "leer" THEN adrgruppe$ = ""
         ELSE 
           adrgruppe$ = "n"
           GOTO adrdr140996
         END IF 
         FILE GAdrDat$
       END IF 
       IF adrstatus$ = "j" THEN 
         REDIM AdrFound$( RECCOUNT ("ADRStat"))
         FILE "ADRStat"
         INDEX keyword.adrstat
         SELECT FIRST 
         iii% = 0
         WHILE NOT EOF ("ADRStat")
           AdrFound$(iii%) = keyword.adrstat
           iii% = iii% + 1
           SELECT NEXT 
         WEND 
         CREATE DIALOG "ADRSTICHW",0,0,194,202,"Adress-Status-Auswahl","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
         ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           adrstat$ = LEFT$ (LAuswahl$)
           IF LAuswahl$ = "leer" THEN adrstat$ = ""
         ELSE 
           adrstatus$ = "n"
           GOTO adrdr140996
         END IF 
         FILE GAdrDat$
       END IF 
       IF stichw$ = "j" THEN 
         CALL DFile(2,"OFFICE\keywords" + _fpw$)
         FILE "keywords"
         INDEX keyword
         SELECT FIRST 
         a% = 0
         SELECT WHERE keyword <> ""
         SELECT FIRST 
         REDIM AdrFound$( RECCOUNT ("keywords"))
         WHILE NOT EOF ("keywords")
           AdrFound$(a%) = LTRIM$ (keyword)
           a% = a% + 1
           SELECT NEXT 
         WEND 
         AdrFound$(a%) = ""
         LAuswahl$ = AdrFound$(0)
         LAuswahl1$(0) = LAuswahl$
         CREATE DIALOG "ADRSTICHW",0,0,194,202,"Stichwort-Auswahl","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,183,168,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,33,180,55,16,1,"&OK",1,1
         ADD DIALOG "ADRSTICHW",1,93,180,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           stichwort$ = "*" + LEFT$ (LAuswahl$) + "*"
         ELSE 
           stichw$ = "n"
           GOTO adrdr140996
         END IF 
         FILE GAdrDat$
       END IF 
       MOUSE OFF 
       SELECT CASE opt1%
       CASE 1
         feld$ = "Anrede." + GAdrDat$
         IF suna1$ = "" THEN 
           REM suna$ = suna$ + "*"
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 2
         feld$ = "nachname." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 3
         feld$ = "Ort." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 4
         feld$ = "PLZ." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 5
         feld$ = "Stra·e." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 6
         feld$ = "Kundennummer." + GAdrDat$
         IF suna1$ = "" THEN 
           suna$ = UCASE$ (suna$)
           suna1$ = suna$
         ELSE 
           IF suna$ <> "" THEN 
             suna$ = UCASE$ (suna$)
             suna1$ = UCASE$ (suna1$)
           ELSE 
             suna$ = UCASE$ (suna1$)
             suna1$ = suna$
           END IF 
         END IF 
       CASE 7
         REM feld$="Telefon/Faxnummer"
       END SELECT 
       
       x% = ASC ( LEFT$ ( UCASE$ (suna$),1))
       SELECT CASE x%
         CASE 142
           sun$ = "A" + RIGHT$ (suna$, LEN (suna$) - 1)
           suna$ = sun$
         CASE 153
           sun$ = "O" + RIGHT$ (suna$, LEN (suna$) - 1)
           suna$ = sun$
         CASE 154
           sun$ = "U" + RIGHT$ (suna$, LEN (suna$) - 1)
           suna$ = sun$
       END SELECT 
 
       MOUSE OFF 
       SET STATUS "Bitte warten Adressdatei wird vorbereitet!"
       SELECT WHERE FILE GAdrDat$
       REM IF suna$ = "*" THEN suna$ = "**"
       stichwort$ = "*" + stichwort$ + "*"
       SELECT CASE GAdrDat$
         CASE "ADRESSEN"
           IF adrtelefon$ <> "j" THEN 
             title2$ = "Adressl"
           ELSE 
             title2$ = "Telefonl"
           END IF 
         CASE "BCKONTAK"
           IF GBene% THEN 
             title2$ = "BC-L"
           ELSE 
             title2$ = "Interessenten-L"
           END IF 
       END SELECT 
       IF stichw$ = "j" THEN 
         IF suna$ = "" THEN 
           title2$ = title2$ + "iste selektiert nach Stichwort: *" + stichwort$
         ELSE 
           IF opt1% = 1 THEN title2$ = title2$ + "iste selektiert nach Anrede von : " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 2 THEN title2$ = title2$ + "iste selektiert nach Nachname von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 3 THEN title2$ = title2$ + "iste selektiert nach Ort von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 4 THEN title2$ = title2$ + "iste selektiert nach PLZ von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 5 THEN title2$ = title2$ + "iste selektiert nach Stra·e von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
           IF opt1% = 6 THEN title2$ = title2$ + "iste selektiert nach Kundennummer von: " + suna$ + " bis: " + suna1$ + " und Stichwort: *" + stichwort$
         END IF 
       ELSE 
         IF suna$ = "" THEN 
           title2$ = title2$ + "iste alle Adressen"
         ELSE 
           IF opt1% = 1 THEN title2$ = title2$ + "iste selektiert nach Anrede von: " + suna$ + " bis: " + suna1$
           IF opt1% = 2 THEN title2$ = title2$ + "iste selektiert nach Nachname von: " + suna$ + " bis: " + suna1$
           IF opt1% = 3 THEN title2$ = title2$ + "iste selektiert nach Ort von: " + suna$ + " bis: " + suna1$
           IF opt1% = 4 THEN title2$ = title2$ + "iste selektiert nach PLZ von: " + suna$ + " bis: " + suna1$
           IF opt1% = 6 THEN title2$ = title2$ + "iste selektiert nach Stra·e von: " + suna$ + " bis: " + suna1$
           IF opt1% = 6 THEN title2$ = title2$ + "iste selektiert nach Kundennummer von: " + suna$ + " bis: " + suna1$
         END IF 
 
       END IF 
       IF adrstatus$ = "j" THEN 
         IF adrstat$ = "" THEN 
           title2$ = title2$ + " /Adress-Status: leer"
         ELSE 
           title2$ = title2$ + " /Adress-Status: " + adrstat$
         END IF 
       END IF 
       IF adrgruppe$ = "j" THEN 
         IF adrgrup$ = "" THEN 
           title2$ = title2$ + " /Adress-Gruppe: leer"
         ELSE 
           title2$ = title2$ + " /Adress-Gruppe: " + adrgrup$
         END IF 
       END IF 
 
       IF GohneVertr$ LIKE "j" THEN 
         title2$ = title2$ + " /ohne Vertrag"
       END IF 
 
       x% = ASC ( LEFT$ (suna$,1))
       b1$ = "select where "
       IF lief$ = "j" THEN 
         b2$ = "aalieferant=~j~"
         title2$ = title2$ + " fÅr Lieferanten"
       END IF 
       IF mitarb$ = "j" THEN 
         title2$ = title2$ + " fÅr Mitarbeiter: " + smaname$
         IF stichw$ = "j" OR suna$ <> "" THEN 
           b1$ = "select where codema=scodema% AND "
         ELSE 
           beding$ = "select where codema=scodema%"
         END IF 
       END IF 
       IF stichw$ = "j" AND suna$ <> "" THEN 
         beding$ = b1$ + "LEFT$(UCASE$(feld$$),LEN(suna$)) >= suna$ and LEFT$(UCASE$(feld$$),LEN(suna$)) <= suna1$ AND Stichwort LIKE Stichwort$"
         SELECT CASE x%
           CASE 142,65
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 142"
           CASE 153,79
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 153"
           CASE 154,85
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 154"
           CASE 225
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$ AND Stichwort LIKE Stichwort$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 225"
         END SELECT 
       ELSE 
       END IF 
       IF stichw$ <> "j" AND suna$ <> "" THEN 
         beding$ = b1$ + "LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna1$)) <= suna1$"
         SELECT CASE x%
           CASE 142,65
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 142"
           CASE 153,79
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 153"
           CASE 154,85
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 154"
           CASE 225
             beding$ = b1$ + "( LEFT$ ( UCASE$ (feld$$), LEN (suna$)) >= suna$ AND LEFT$ ( UCASE$ (feld$$), LEN (suna$)) <= suna1$) OR ASC ( LEFT$ ( UCASE$ (feld$$), LEN (suna$))) = 225"
         END SELECT 
       ELSE 
       END IF 
       IF stichw$ = "j" AND suna$ = "" THEN 
         beding$ = b1$ + "stichwort.GAdrDat$ LIKE Stichwort$"
       END IF 
       IF stichw$ <> "j" AND suna$ = "" AND mitarb$ <> "j" THEN beding$ = "select where"
       IF stichw$ <> "j" AND suna$ = "" AND mitarb$ <> "j" AND lief$ = "j" THEN beding$ = "select where aalieferant=~j~"
       IF stichw$ = "j" OR suna$ <> "" OR mitarb$ = "j" THEN 
         IF lief$ = "j" THEN beding$ = beding$ + "and aalieferant=~j~"
       END IF 
       IF adrstatus$ = "j" THEN 
         IF RIGHT$ (beding$,5) LIKE "where" THEN 
           beding$ = beding$ + " adrstatus = adrstat$"
         ELSE 
           beding$ = beding$ + " and adrstatus = adrstat$"
         END IF 
       END IF 
       IF adrgruppe$ = "j" THEN 
         IF RIGHT$ (beding$,5) LIKE "where" THEN 
           beding$ = beding$ + " adrgruppe = adrgrup$"
         ELSE 
           beding$ = beding$ + " and adrgruppe = adrgrup$"
         END IF 
       END IF 
       FILE GADRDat$
       SELECT WHERE FILE GAdrDat$
       EXECUTE beding$
       SELECT FIRST 
       wbericht$ = GAdrDat$
       
       SELECT FIRST FILE "supervis" INDEX codema.supervis
       SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
       fussma$ = "gedruckt durch: " + Name.supervis + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
       REM title2$ = title2$ + " " + fussma$
       IF option2% = 1 THEN 
         IF adrtelefon$ <> "j" THEN 
           REM CALL Fehler("","")
           CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
           GohneVertr$ = "n"
         ELSE 
           REM *********** Telefonliste *************************************
           REM Telefonliste 11.10.2001
           REQUEST "Sollen nur diejenigen Adressen berÅcksichtigt werden","bei denen Nummern existieren?",130,nurtel%
           IF OPEN ("adrtemp") THEN 
             IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
             REM CLOSE FILE "ADRTEMP"
           ELSE 
             CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
             IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
           END IF 
           FILE GAdrDat$
           INDEX Nachname.GAdrDat$
           SELECT FIRST 
           CALL Server("LISTBOXINIT","Adre·auswahl fÅr Telefonliste")
           CALL Gauge(1,"Adre·datei wird durchsucht...")
           CALL Server("GAUGEENABLECANCEL","")
           _prozt% = 0
           _proz2% = 0
           _anz% = RECCOUNT (GAdrDat$)
           abz% = 0
           WHILE NOT EOF (GAdrDat$) AND ServerReply$() <> "CANCEL"
             codeku% = codeku.GAdrDat$
             _proz% = INT ((100 / _anz%) * _proz2%)
             IF _proz% > 100 THEN _proz% = 100
             IF _proz% < 2 THEN _proz% = 2
             IF _proz% <> _prozt% THEN 
               _prozt% = _proz%
               SET STATUS "Telefonliste... " + STR$ (_prozt%,"999") + " %"
               CALL Gauge(_proz%,"")
             END IF 
             _proz2% = _proz2% + 1
             ok% = 0
             IF nurtel% = 1 THEN 
               IF EXISTS (codeku.GADRDat$,codeku.GTelDat$) THEN 
                 SELECT FIRST FILE GTelDat$ INDEX codeku.GTelDat$
                 SELECT KEY codeku.GADRDat$ FILE GTelDat$ INDEX codeku.GTelDat$
                 WHILE NOT EOF (GTElDat$) AND codeku.GTelDat$ = codeku.GADRDat$
                   IF LTRIM$ (nummer.GTElDat$) <> "" THEN 
                     ok% = 1
                     SELECT LAST FILE GTelDat$ INDEX codeku.GTelDat$
                   END IF 
                   SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
                 WEND 
               ELSE 
                 ok% = 0
               END IF 
             ELSE 
               ok% = 1
             END IF 
             IF GASP% AND Workstation% <> 0 THEN 
               IF IsWksVisible%(Workstation.GADRDat$) <> - 1 THEN ok% = 0
             END IF 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.GAdrDat$) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF GohneVertr$ LIKE "j" THEN 
               IF EXISTS (codeku%,codeku.kvertrag) THEN sok% = 0
             END IF 
             IF ok% = 1 AND sok% THEN 
               anrede$ = LTRIM$ (Anrede.GAdrDat$)
               titel$ = LTRIM$ (Titel.GAdrDat$)
               IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" THEN 
                 nachname$ = LTRIM$ (nachname.GAdrDat$)
                 vorname$ = LTRIM$ (vorname.GAdrDat$)
               ELSE 
                 nachname$ = LTRIM$ (nachname.GAdrDat$)
                 vorname$ = LTRIM$ (Geburtsname.GAdrDat$)
               END IF 
               gebdat% = Geburtstag.GAdrDat$
               CALL WriteAdrTemp(codeku%,anrede$,titel$,nachname$,vorname$,gebdat%)
               abz% = abz% + 1
               tmpzeile$ = LTRIM$ (Nachname.GAdrDat$) + ", " + LEFT$ ( LTRIM$ (Vorname.GAdrDat$),10)
               CALL Server("GaugeMessage","... " + STR$ (abz%,"999999") + " gefunden (" + tmpzeile$ + ")")
               CALL Server("LISTBOXADD",tmpZeile$)
             END IF 
             FILE GAdrDat$
           SELECT NEXT FILE GAdrDat$
           WEND 
           CALL Gauge(0,"")
           IF abz% > 0 THEN 
             wbsort$ = "Nachname"
             listart% = 2
             SELECT CASE GAdrDat$
               CASE "ADRESSEN"
                 title2$ = "Kunden-Telefonliste"
               CASE "BCKONTAK"
                 title2$ = "BC-Telefonliste"
             END SELECT 
             CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
           ELSE 
             CALL Fehler("Es waren keine Adressen zur Erstellung einer Telefonliste vorhanden!","")
           END IF 
           REM ************ Ende Telefonliste *******************************
         END IF 
         option2% = 0
       END IF 
       IF option2% > 0 THEN 
         MOUSE OFF 
         IF OPEN ("adrtemp") THEN 
           IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
           REM CLOSE FILE "ADRTEMP"
         ELSE 
           CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
           IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
         END IF 
         FILE GAdrDat$
         SELECT FIRST 
         abz% = 0
         a% = 0
         b% = RECCOUNT (GAdrDat$)
         IF b% > 20000 THEN 
           b% = 20000
           REDIM AdrFound$(20000,1)
           REDIM AdrFound$(20000)
         ELSE 
           REDIM AdrFound$( RECCOUNT (GAdrDat$),1)
           REDIM AdrFound$( RECCOUNT (GAdrDat$))
         END IF 
         REM FOR a% = 0 TO b%
           REM AdrFound$(a%) = ""
         REM NEXT a%
         a% = 0
         WHILE NOT EOF (GAdrDat$)
           abz% = abz% + 1
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.GAdrDat$) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
           IF gasp% = - 1 AND sok% = - 1 THEN 
             IF (IsWksVisible%(Workstation.GADRDat$) <> - 1) THEN sok% = 0
           END IF 
           SET STATUS "Anzahl der verarbeiteten Adressen: " + STR$ (abz%,"99999999")
           IF sok% THEN 
             codeku% = codeku.GAdrDat$
             REM 200999
             BLANK FILE "adrtemp"
             codeadrt% = SER ("ADRTEMP",1)
             codeadrt.adrtemp = codeadrt%
             codeku.adrtemp = codeku%
             Kundennummer.adrtemp = Kundennummer.GAdrDat$
             Postanschrift.adrtemp = Postanschrift.GAdrDat$
             Anrede.adrtemp = Anrede.GAdrDat$
             ASerJN.adrtemp = ASerJN.GAdrDat$
             IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
               Name2.adrtemp = Nachname.GAdrDat$
               Name1.adrtemp = Vorname.GAdrDat$
               REM Name3.adrtemp = Geburtsname.GAdrDat$
             ELSE 
               Name1.adrtemp = Nachname.GAdrDat$
               zuHaenden.adrtemp = Vorname.GAdrDat$
               Name2.adrtemp = Geburtsname.GAdrDat$
             END IF 
             Strasse.adrtemp = Stra·e.GAdrDat$
             PLZ.adrtemp = PLZ.GAdrDat$
             Ort.adrtemp = Ort.GAdrDat$
             NationalitÑt.adrtemp = NationalitÑt.GAdrDat$
             Staatsangehîrig.adrtemp = Staatsangehîrig.GAdrDat$
             Land.adrtemp = Land.GAdrDat$
             Geburtstag.adrtemp = DATE$ (Geburtstag.GAdrDat$,"0d.mm.yyyy")
             K1Bank.adrtemp = K1Bank.GAdrDat$
             K1BLZ.adrtemp = K1BLZ.GAdrDat$
             K1Konto.adrtemp = K1Konto.GAdrDat$
             K2Bank.adrtemp = K2Bank.GAdrDat$
             K2BLZ.adrtemp = K2BLZ.GAdrDat$
             K2Konto.adrtemp = K2Konto.GAdrDat$
             Kunde_seit.adrtemp = DATE$ (Kunde_seit.GAdrDat$,"0d.mm.yyyy")
             letzter_Kontakt.adrtemp = DATE$ (letzter_Kontakt.GAdrDat$,"0d.mm.yyyy")
             REM Notiz.adrtemp = Notiz.GAdrDat$
             Beruf.adrtemp = Beruf.GAdrDat$
             Hobbys.adrtemp = Hobbys.GAdrDat$
             Geschlecht.adrtemp = Geschlecht.GAdrDat$
             Familienstand.adrtemp = Familienstand.GAdrDat$
             Briefanrede.adrtemp = Briefanrede.GAdrDat$
             REM Geburtsname.adrtemp = Geburtsname.GAdrDat$
             feld1$ = "Telart"
             feld2$ = "Telnr"
             feld3$ = "FaxJN"
             codema% = Codema.GAdrDat$
             codema.adrtemp = codema%
             codepr.adrtemp = codepr.GAdrDat$
             REM 061196
             IF _projekt$ LIKE "FACTURA" THEN 
               IF EXISTS (codema%,codema.vertrete) THEN 
                 FILE "vertrete"
                 INDEX codema.vertrete
                 SELECT FIRST 
                 SELECT KEY codema% FILE "vertrete" INDEX codema.vertrete
                 Mitarbeiter.adrtemp = TRIM$ (nachname.vertrete) + ", " + TRIM$ (vorname.vertrete)
                 QuickMaKund.adrtemp = TRIM$ (nachname.vertrete) + TRIM$ (vorname.vertrete) + nachname.GAdrDat$
               END IF 
             END IF 
             IF _projekt$ LIKE "PROVIS" THEN 
               IF EXISTS (codema%,codema.maadr) THEN 
                 FILE "maadr"
                 INDEX codema.maadr
                 SELECT FIRST 
                 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
                 Mitarbeiter.adrtemp = TRIM$ (nachname.maadr) + ", " + TRIM$ (vorname.maadr)
                 QuickMaKund.adrtemp = TRIM$ (nachname.maadr) + TRIM$ (vorname.maadr) + nachname.GAdrDat$
               END IF 
             END IF 
             EGNachname.adrtemp = EGNachname.GAdrDat$
             EGGeburtsname.adrtemp = EGGeburtsname.GAdrDat$
             EGVorname.adrtemp = EGVorname.GAdrDat$
             EGGeburtstag.adrtemp = EGGeburtstag.GAdrDat$
             EGBeruf.adrtemp = EGBeruf.GAdrDat$
             EGASStra·e.adrtemp = EGASStra·e.GAdrDat$
             EGASOrt.adrtemp = EGASOrt.GAdrDat$
             EGASPLZ.adrtemp = EGASPLZ.GAdrDat$
             EGAnrede.adrtemp = eganrede.GADRDat$
             EGTitel.adrtemp = EGTitel.GADRDat$
             ADRStatus.adrtemp = adrstatus.GADRDat$
             codema% = codema.GADRDat$
             SELECT FIRST FILE "maadr" INDEX codema.maadr
             SELECT KEY codema% FILE "maadr" INDEX codema.maadr
             Agentur1.adrtemp = Agenturnr.maadr + ", " + Nachname.maadr + ", " + Vorname.maadr
             codema% = codema2.GADRDat$
             SELECT FIRST FILE "maadr" INDEX codema.maadr
             SELECT KEY codema% FILE "maadr" INDEX codema.maadr
             Agentur2.adrtemp = Agenturnr.maadr + ", " + Nachname.maadr + ", " + Vorname.maadr
 
             FOR k1% = 1 TO 4
               k1$ = STR$ (k1%,"9")
               K_feld1$ = "K" + k1$ + "Name" + ".adrtemp"
               K_feld2$ = "K" + k1$ + "NName" + ".adrtemp"
               K_feld3$ = "K" + k1$ + "Ort" + ".adrtemp"
               K_feld4$ = "K" + k1$ + "Strasse" + ".adrtemp"
               K_feld5$ = "K" + k1$ + "PLZ" + ".adrtemp"
               K_feld6$ = "K" + k1$ + "Telefon1" + ".adrtemp"
               K_feld7$ = "K" + k1$ + "Fax1" + ".adrtemp"
               K_feld8$ = "K" + k1$ + "Mobil1" + ".adrtemp"
               K_feld9$ = "K" + k1$ + "email1" + ".adrtemp"
               K_feld10$ = "K" + k1$ + "www1" + ".adrtemp"
               K_feld11$ = "K" + k1$ + "Telefon2" + ".adrtemp"
               K_feld12$ = "K" + k1$ + "Fax2" + ".adrtemp"
               K_feld13$ = "K" + k1$ + "Mobil2" + ".adrtemp"
               K_feld14$ = "K" + k1$ + "email2" + ".adrtemp"
               K_feld15$ = "K" + k1$ + "www2" + ".adrtemp"
               K_feld1$$ = K1Name.GAdrDat$
               K_feld2$$ = K1NName .GAdrDat$
               K_feld3$$ = K1Ort .GAdrDat$
               K_feld4$$ = K1Strasse.GAdrDat$
               K_feld5$$ = K1PLZ.GAdrDat$
               K_feld6$$ = K1Telefon1.GAdrDat$
               K_feld7$$ = K1Fax1.GAdrDat$
               K_feld8$$ = K1Mobil1.GAdrDat$
               K_feld9$$ = K1email1.GAdrDat$
               K_feld10$$ = K1www1.GAdrDat$
               K_feld11$$ = K1Telefon2.GAdrDat$
               K_feld12$$ = K1Fax2.GAdrDat$
               K_feld13$$ = K1Mobil2.GAdrDat$
               K_feld14$$ = K1email2.GAdrDat$
               K_feld15$$ = K1www2.GAdrDat$
             NEXT k1%
             IF EXISTS (codeku%,codeku.GTelDat$) THEN 
               FILE GTelDat$
               INDEX Qcodekutel.GTelDat$
               SELECT FIRST FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               Qcodekutel$ = STR$ (codeku%,"000000") + "000000"
               REM CALL Fehler(Qcodekutel$,"")
               SELECT KEY Qcodekutel$ FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               abi% = 0
               WHILE codeku.GTelDat$ = codeku% AND abi% < 20 AND NOT EOF (GTelDat$)
                 abi% = abi% + 1
                 IF abi% < 10 THEN 
                   feldart$ = feld1$ + STR$ (abi%,"9") + ".adrtemp"
                   feldnum$ = feld2$ + STR$ (abi%,"9") + ".adrtemp"
                   feldFax$ = TRIM$ (feld3$ + STR$ (abi%,"9") + ".adrtemp")
                 ELSE 
                   feldart$ = feld1$ + STR$ (abi%,"99") + ".adrtemp"
                   feldnum$ = feld2$ + STR$ (abi%,"99") + ".adrtemp"
                   feldFax$ = TRIM$ (feld3$ + STR$ (abi%,"99") + ".adrtemp")
                 END IF 
                 feldart$$ = LEFT$ (art.GTelDat$,60)
                 feldnum$$ = LEFT$ (nummer.GTelDat$,60)
                 FeldFax$$ = FonOderFax.GTelDat$
                 SELECT NEXT FILE GTelDat$ INDEX Qcodekutel.GTelDat$
               WEND 
             END IF 
             FILE "adrtemp"
             STORE FILE "adrtemp"
             AdrFound$(a%) = Nachname.GAdrDat$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
           END IF 
         FILE GAdrDat$
         SELECT NEXT FILE GAdrDat$
         MOUSE OFF 
         WEND 
         SELECT WHERE FILE GAdrDat$
       END IF 
       REM Serienbrief nach dbase
       REM 240999
       IF option2% = 2 THEN 
         SELECT WHERE FILE GAdrDat$
         adrser% = 1
         CALL SerieNeu1("ADRTEMP")
       END IF 
 
       IF option2% = 3 THEN 
         FILE "adrtemp"
         INDEX name2.adrtemp
         SELECT FIRST 
         REM EXPORT nach EXCEL aufrufen
         dir1$ = DIRECTORY 
         dateiname2$ = "*.xls"
         REQUEST "Speichern als MS EXCEL..."," ",27,req%,dateiname2$
         IF req% = 1 THEN 
           MOUSE OFF 
           SET STATUS "EXPORT der gewÑhlten Adressen nach: " + dateiname2$
           Superbase.Converters.SBF.SourceFormat = "Superbase"
           Superbase.Converters.SBF.SourceFile = "ADRTEMP"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = dateiname2$
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
           DIRECTORY dir1$
           WAIT FOR 3
           a% = CALL ("ShellExecute",0,"open",dateiname2$,"","",1)
           IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
           SET STATUS "EXPORT beendet!"
 
         END IF 
       END IF 
       SELECT WHERE FILE GAdrDat$
Err200420102: 
       ON ERROR GOTO ErrorHandler
     END IF 
 END SUB 


SUB AdrLeKontSul()
     FILE GAdrDat$
     SELECT WHERE FILE GAdrDat$
     REM 111297Adre·liste letzter Kontakt
     bis$ = TODAY 
     CREATE DIALOG "Konto1",0,0,221,165,"Datum letzter Kontakt","MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"letzter Kontakt:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Zeitraum Sie eine öbersicht wÅnschen."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     IF von$ <> "" OR bis$ <> "" THEN 
       IF von$ = "" THEN von$ = "1.1.1980"
       IF von$ <> "" AND bis$ = "" THEN 
         bis$ = von$
       END IF 
       von% = DAYS (von$)
       bis% = DAYS (bis$)
       von$ = DATE$ (von%,"0d.mm.yyyy")
       bis$ = DATE$ (bis%,"0d.mm.yyyy")
       SELECT WHERE FILE GAdrDat$
       SELECT WHERE letzter_Kontakt.GAdrDat$ >= von$ AND letzter_Kontakt.GAdrDat$ <= bis$
       wbericht$ = GAdrDat$
       SELECT CASE GAdrDat$
         CASE "ADRESSEN"
           title2$ = "Kundenliste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
         CASE "BCKONTAK"
           IF GBENE% THEN 
             title2$ = "BC-Liste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
           ELSE 
             title2$ = "Interessenten-Liste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
           END IF 
       END SELECT 
       REM title2$ = "Adressliste selektiert nach letzter Kontakt von : " + von$ + " bis: " + bis$
       CALL VPEADRGr(Wbericht$,FormatPrint$,title2$,Terminejn$,KurzLang$,sort$)
     ELSE 
       CALL Fehler("Es mu· mindestens ein Datum fÅr - bis - eingegeben werden!","")
     END IF 
 END SUB 


 ' Ausgabe Geburtstagsliste
 ' ======================================================================
 
SUB GEBLISTEV()
   IF OPEN ("adrtemp") THEN 
     REM CLOSE FILE "ADRTEMP"
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   ELSE 
     CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   END IF 
 SET STATUS "Geburtstagsliste ausgeben"
 IF _projekt$ LIKE "PROVIS*" THEN 
   CALL DFile(3,"MAADR" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
 CALL DFile(2,"color" + _fpw$)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 GMAADat$ = "maadr"
 opt% = 8
 opt2% = 1
 sort% = 2
 listart% = 1
 ok1% = - 1
 IF GGebList% = - 1 THEN 
   req% = 1
   GGebList% = 0
 ELSE 
   GOTO GeV1Dial150996
GeVDial150996: 
   REQUEST "Die Datumseingabe von: bis: war falsch","Bitte geben Sie das Datum in der Form: tt.mm.jjjj ein!",0
GeV1Dial150996: 
    CREATE DIALOG "GBLISTE",0,0,236,240,"Geburtstagsliste","MS Sans Serif",8
    ADD DIALOG "GBLISTE",4,0,0,235,268,0,""
    ADD DIALOG "GBLISTE",9,6,9,22,23,2
    ADD DIALOG "GBLISTE",5,37,9,105,11,0,"Ausgabe einer Geburtstagsliste:"
    ADD DIALOG "GBLISTE",5,37,22,184,19,0,"Bitte geben Sie an, welche Art von Geburtstagsliste Sie wÅnschen."
    ADD DIALOG "GBLISTE",4,37,43,84,122,0," Liste fÅr ... "
    ADD DIALOG "GBLISTE",3,41,52,70,9,0,"aktueller Tag",8,opt%
    ADD DIALOG "GBLISTE",3,41,63,70,10,0,"ganzes Jahr",1,opt%
    ADD DIALOG "GBLISTE",3,41,74,70,10,0,"diesen Monat",2,opt%
    ADD DIALOG "GBLISTE",3,41,85,70,9,0,"nÑchsten Monat",3,opt%
    ADD DIALOG "GBLISTE",3,41,96,63,9,0,"wahlfreier Monat",7,opt%
    ADD DIALOG "GBLISTE",3,41,106,63,9,0,"in Tage",9,opt%
    ADD DIALOG "GBLISTE",6,105,96,13,11,0,0,mon1%,2
    ADD DIALOG "GBLISTE",6,105,106,13,11,0,0,tag1%,2
 
    
    REM ADD DIALOG "GBLISTE",5,42,114,20,8,0,"Monat:"
    ADD DIALOG "GBLISTE",3,41,127,81,9,0,"freie Wahl Datum",6,opt%
    ADD DIALOG "GBLISTE",6,57,139,53,11,0,0,von$,10
    ADD DIALOG "GBLISTE",5,41,141,15,8,0,"von:"
    ADD DIALOG "GBLISTE",6,57,151,53,12,0,0,bis$,10
    ADD DIALOG "GBLISTE",5,41,152,12,8,0,"bis:"
    ADD DIALOG "GBLISTE",4,121,43,112,53,0," Ausgabeziel ... "
    ADD DIALOG "GBLISTE",3,124,57,85,8,0,"Bildschirm/Drucker",1,opt2%
    ADD DIALOG "GBLISTE",3,124,67,90,9,0,"Serienbriefdatei (dBASE)",2,opt2%
    ADD DIALOG "GBLISTE",3,124,77,73,9,0,"MS EXCEL - Tabelle",3,opt2%
    ADD DIALOG "GBLISTE",4,121,98,112,53,0,"Sortierung fÅr Druck... "
    ADD DIALOG "GBLISTE",3,124,113,99,8,0,"Alphabetisch Vermittler",1,sort%
    REM IF _projekt$ LIKE "PROVIS" THEN ADD DIALOG "GBLISTE",3,124,123,105,9,0,"Alphabetisch Agentur/Kunde",2,sort%
    ADD DIALOG "GBLISTE",3,124,133,71,10,0,"Geburtsdatum",3,sort%
    
    ADD DIALOG "GBLISTE",4,37,175,189,41,0,"Listenart ... "
    ADD DIALOG "GBLISTE",3,41,188,176,9,0,"Ausdruck mit allen Angaben zur Adresse",1,listart%
    ADD DIALOG "GBLISTE",3,41,199,178,9,0,"nur Kurzausdruck mit Name, Geb.datum, Agentur",2,listart%
    REM ADD DIALOG "GBLISTE",2,37,218,184,13,0,"Kunden einer bestimmten Agentur","j","n",mitarb$
    REM ADD DIALOG "GBLISTE",2,37,230,137,13,0,"Kunden einer bestimmten Adressgruppe","j","n",adrgrupjn$
    REM ADD DIALOG "GBLISTE",2,37,242,130,13,0,"Kunden mit bestimmten Adressstatus","j","n",adrstatjn$
    REM ADD DIALOG "GBLISTE",2,176,230,50,13,0,"ausschlie·en","j","n",adrgrupaus$
    REM ADD DIALOG "GBLISTE",2,176,242,50,13,0,"ausschlie·en","j","n",adrstataus$
    REM ADD DIALOG "GBLISTE",2,37,254,130,13,0,"Kunden mit bestimmten Stichwort","j","n",adrstichjn$
    REM ADD DIALOG "GBLISTE",2,176,254,50,13,0,"ausschlie·en","j","n",adrstiaus$
    ADD DIALOG "GBLISTE",1,61,220,53,15,1,"&OK",1,1
    ADD DIALOG "GBLISTE",1,117,220,56,15,0,"&Abbrechen",0,0
   DIALOG "GBLISTE",req%
   REMOVE DIALOG "GBLISTE"
 
 
   IF req% = 1 AND opt% = 6 THEN 
     ON ERROR GOTO GeVDial150996
     IF von$ = "" THEN von$ = "01.01.1901"
     IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyyy")
     tagvon% = DAYS (von$)
     tagbis% = DAYS (bis$)
   END IF 
 
 
   sunagrup$ = ""
   sunastat$ = ""
   sunastich$ = ""
 END IF 
  IF req% = 1 THEN 
 
   MOUSE OFF 
   cdir$ = DIRECTORY 
   DIRECTORY _netpath$ + "OFFICE"
   Ueberschrift$ = "Vermittler - Geburtstagsliste "
   
   SELECT CASE opt%
   CASE 1
     hd$ = "(ganzes Jahr)"
   CASE 2
     hd$ = "(Monat " + MONTH$ ( TODAY ) + ")"
   CASE 3
     hd$ = "(Monat " + MONTH$ ( TODAY + 30) + ")"
   CASE 4
     hd$ = "(diese Woche)"
   CASE 5
     hd$ = "(nÑchste Woche)"
   CASE 6
     hd$ = "vom: " + von$ + " bis: " + bis$
   CASE 7
     IF mon1% = 1 THEN monlang$ = "Januar"
     IF mon1% = 2 THEN monlang$ = "Februar"
     IF mon1% = 3 THEN monlang$ = "MÑrz"
     IF mon1% = 4 THEN monlang$ = "April"
     IF mon1% = 5 THEN monlang$ = "Mai"
     IF mon1% = 6 THEN monlang$ = "Juni"
     IF mon1% = 7 THEN monlang$ = "Juli"
     IF mon1% = 8 THEN monlang$ = "August"
     IF mon1% = 9 THEN monlang$ = "September"
     IF mon1% = 10 THEN monlang$ = "Oktober"
     IF mon1% = 11 THEN monlang$ = "November"
     IF mon1% = 12 THEN monlang$ = "Dezember"
     hd$ = "Monat: " + monlang$
   CASE 8
     REM today
   CASE 9
     REM in xy Tagen
     x$ = DATE$ ( TODAY + tag1%,"0d.mm.yyyy")
     hd$ = "fÅr den: " + x$
 
   END SELECT 
   Ueberschrift$ = Ueberschrift$ + hd$
   title2$ = Ueberschrift$
 
   SELECT FIRST FILE "supervis" INDEX codema.supervis
   SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
   fussma$ = "gedruckt durch: " + Name.supervis + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
   REM title2$ = title2$ + " " + fussma$
   MOUSE OFF 
   IF OPEN ("adrtemp") THEN 
     REM CLOSE FILE "ADRTEMP"
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   ELSE 
     CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
     IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
   END IF 
   FILE GMAADat$
   INDEX codema.GMAADat$
   SELECT FIRST FILE GMAADat$ INDEX codema.GMAADat$
   IF scodema% > 0 THEN 
     SELECT KEY scodema% FILE GMAADat$ INDEX codema.GMAADat$
   END IF 
   abz% = 0
   ok% = 1
   CALL Server("LISTBOXINIT","Vermittlerauswahl")
   CALL Gauge(1,"Vermittlerdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   _prozt% = 0
   _proz2% = 0
   _anz% = RECCOUNT (GMAADat$)
   REM 240999
   a% = 0
   b% = RECCOUNT (GMAADat$)
   IF b% * 6 > 32690 THEN 
     b% = 32690
     REDIM AdrFound$(32690,1)
     REDIM AdrFound$(32690)
   ELSE 
     b% = b% * 6
     REDIM AdrFound$(b%,1)
     REDIM AdrFound$(b%)
   END IF 
   REM FOR a% = 0 TO b%
     REM AdrFound$(a%) = ""
   REM NEXT a%
   a% = 0
   WHILE NOT EOF (GMAADat$) AND ServerReply$() <> "CANCEL"
     codema% = codema.GMAADat$
     _proz% = INT ((100 / _anz%) * _proz2%)
     IF _proz% > 100 THEN _proz% = 100
     IF _proz% < 2 THEN _proz% = 2
     IF _proz% <> _prozt% THEN 
       _prozt% = _proz%
       SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
       CALL Gauge(_proz%,"")
     END IF 
     _proz2% = _proz2% + 1
 
 
 
     SELECT CASE opt%
       CASE 1
         locktest% = MNdisabled%("DATALOCK")
         IF geburtstag.GMAADat$ > 0 THEN 
           anrede$ = anrede.GMAADat$
           titel$ = ""
           IF anrede$ LIKE "Herr*" OR anrede$ LIKE "Fr*" OR anrede$ LIKE "Fam*" OR anrede$ LIKE "Ehe*" OR anrede$ LIKE "Kind*" THEN 
             
             nachname$ = LTRIM$ (nachname.GMAADat$)
             vorname$ = LTRIM$ (vorname.GMAADat$)
           ELSE 
             nachname$ = LTRIM$ (nachname.GMAADat$)
             vorname$ = LTRIM$ (Geburtsname.GMAADat$)
           END IF 
           gebdat% = Geburtstag.GMAADat$
           ok% = - 1
           IF ok% = - 1 THEN 
             CALL WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
             REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
           END IF 
         END IF 
 
       CASE 2
         IF geburtstag.GMAADat$ > 0 AND MONTH (geburtstag.GMAADat$) = MONTH ( TODAY ) THEN 
           anrede$ = anrede.GMAADat$
           titel$ = ""
           nachname$ = nachname.GMAADat$
           vorname$ = vorname.GMAADat$
           gebdat% = Geburtstag.GMAADat$
           ok% = - 1
           IF ok% = - 1 THEN 
             CALL WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 3
         nextmonat% = MONTH ( TODAY ) + 1
         IF nextmonat% = 13 THEN nextmonat% = 1
         IF geburtstag.GMAADat$ > 0 AND MONTH (geburtstag.GMAADat$) = nextmonat% THEN 
           anrede$ = anrede.GMAADat$
           titel$ = ""
           nachname$ = nachname.GMAADat$
           vorname$ = vorname.GMAADat$
           gebdat% = Geburtstag.GMAADat$
           ok% = - 1
           IF ok% = - 1 THEN 
             CALL WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 4
       CASE 5
       CASE 6
         
         IF geburtstag.GMAADat$ > 0 AND geburtstag.GMAADat$ >= tagvon% AND geburtstag.GMAADat$ <= tagbis% THEN 
           anrede$ = anrede.GMAADat$
           titel$ = ""
           nachname$ = nachname.GMAADat$
           vorname$ = vorname.GMAADat$
           gebdat% = Geburtstag.GMAADat$
           ok% = - 1
           IF ok% = - 1 THEN 
             CALL WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 7
         nextmonat% = mon1%
         IF nextmonat% = 13 THEN nextmonat% = 1
         mont% = MONTH (geburtstag.GMAADat$)
         IF geburtstag.GMAADat$ > 0 AND MONTH (geburtstag.GMAADat$) = nextmonat% THEN 
           anrede$ = anrede.GMAADat$
           titel$ = ""
           nachname$ = nachname.GMAADat$
           vorname$ = vorname.GMAADat$
           gebdat% = Geburtstag.GMAADat$
           ok% = - 1
           IF ok% = - 1 THEN 
             CALL WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
       CASE 8
         REM today+Wochenende
         REM opt2a% = 3
         todaytm$ = LEFT$ ( DATE$ ( TODAY ,"0dmmyyyy"),4)
         IF DAY$ ( TODAY ) LIKE "fr*" THEN 
           todaytmb1$ = LEFT$ ( DATE$ ( TODAY + 1,"0dmmyyyy"),4)
           todaytmb2$ = LEFT$ ( DATE$ ( TODAY + 2,"0dmmyyyy"),4)
 
         END IF 
         IF geburtstag.GMAADat$ > 0 AND (GebDatKurz.maadr = todaytm$ OR GebDatKurz.maadr = todaytmb1$ OR GebDatKurz.maadr = todaytmb2$) THEN 
           anrede$ = anrede.GMAADat$
           titel$ = ""
           nachname$ = nachname.GMAADat$
           vorname$ = vorname.GMAADat$
           gebdat% = Geburtstag.GMAADat$
           ok% = - 1
           IF ok% = - 1 THEN 
             CALL WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 




       CASE 9
         REM in xy Tagen
         REM opt2a% = 3
         todaytm$ = LEFT$ ( DATE$ ( TODAY + tag1%,"0dmmyyyy"),4)
         IF DAY$ ( TODAY ) LIKE "fr*" THEN 
           todaytmb1$ = LEFT$ ( DATE$ ( TODAY + tag1% + 1,"0dmmyyyy"),4)
           todaytmb2$ = LEFT$ ( DATE$ ( TODAY + tag1% + 2,"0dmmyyyy"),4)
         END IF 
         IF geburtstag.GMAADat$ > 0 AND GebDatKurz.maadr = todaytm$ THEN 
           anrede$ = anrede.GMAADat$
           titel$ = ""
           nachname$ = nachname.GMAADat$
           vorname$ = vorname.GMAADat$
           gebdat% = Geburtstag.GMAADat$
           ok% = - 1
           IF ok% = - 1 THEN 
             CALL WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
             AdrFound$(a%) = nachname$ + STR$ (codeadrt%,"000000")
             a% = a% + 1
             abz% = abz% + 1
             CALL Server("GaugeMessage","... " + TRIM$ ( STR$ (abz%,"9999")) + " gefunden (" + LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10) + ")")
             tmpzeile$ = LTRIM$ (Nachname$) + ", " + LEFT$ ( LTRIM$ (Vorname$),10)
             CALL Server("LISTBOXADD",tmpZeile$)
           END IF 
           REM SET STATUS "Anzahl gefundener Geburtstage: " + STR$ (abz%,"99999999")
         END IF 
 
     END SELECT 
endgeV120220041: 
     FILE GMAADat$
     SELECT NEXT FILE GMAADat$
   WEND 
   SELECT WHERE FILE GMAADat$
   CALL Gauge(0,"")
   IF GOptGeb% > 0 AND GOptGeb% = 4 THEN 
     opt2% = 1
     opt2a% = 0
   END IF 
   IF GOptGeb% > 0 AND GOptGeb% = 3 THEN opt2% = 3
   IF opt2% = 1 THEN 
     REM 25092002 
     REM Ausgabe auf Bildschirm
     REM listart%=1 ausfÅhrliche Liste
     REM listart%=2 Kurzliste
     
     IF sort% = 1 THEN 
       wbsort$ = "Nachname"
       CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
     END IF 
     IF sort% = 2 THEN 
       wbsort$ = "QuickMaKund"
       CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
     END IF 
     IF sort% = 3 THEN 
       wbsort$ = "Gebsort"
       CALL VPEADRTemp("ADRTEMP",FormatPrint$,title2$,wbsort$,listart%)
     END IF 
 
     wbsort$ = ""
   END IF 
   IF opt2% = 2 THEN 
     adrser% = 1
     CALL SerieNeu1("ADRTEMP")
     REM 240999 Ausgabe nach dBASE
     REM FILE "adrtemp"
     REM INDEX nachname.adrtemp
     REM SELECT FIRST 
     REM EXPORT nach dBase aufrufen
     REM dir1$ = DIRECTORY 
     REM dateiname2$ = "*.dbf"
     REM REQUEST "Speichern als dBase-Datei..."," ",27,req%,dateiname2$
     REM IF req% = 1 THEN 
       REM SET STATUS "EXPORT der gewÑhlten maadr nach: " + dateiname2$
       REM Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
       REM Superbase.Converters.SBF.SourceFile = "ADRTEMP"
       REM Superbase.Converters.SBF.Descending = 0
       REM Superbase.Converters.SBF.Merge = 0
       REM Superbase.Converters.SBF.LogErrors = 0
       REM Superbase.Converters.SBF.MultiResponse = 0
       REM Superbase.Converters.DBF.DestFormat = "dBase III+ / IV"
       REM Superbase.Converters.DBF.DestFile = dateiname2$
       REM Superbase.Converters.DBF.Convert(Superbase.Converters.SBF)
       REM DIRECTORY dir1$
       REM REMOVE FROM FILE "adrtemp"
       REM SET STATUS "EXPORT beendet!"
     REM END IF 
 
   END IF 
   IF opt2% = 3 OR opt2a% = 3 THEN 
     REM Ausgabe nach Excel
     FILE "adrtemp"
     INDEX name1.adrtemp
     SELECT FIRST 
     REM EXPORT nach EXCEL aufrufen
     dir1$ = DIRECTORY 
     dateiname2$ = "gebli.xls"
     REQUEST "Speichern als MS EXCEL..."," ",27,req%,dateiname2$
     IF req% = 1 THEN 
       SET STATUS "EXPORT der gewÑhlten Vermittleradressen nach: " + dateiname2$
       Superbase.Converters.SBF.SourceFormat = "Superbase"
       Superbase.Converters.SBF.SourceFile = "ADRTEMP"
       Superbase.Converters.SBF.Descending = 0
       Superbase.Converters.SBF.Merge = 0
       Superbase.Converters.SBF.LogErrors = 0
       Superbase.Converters.SBF.MultiResponse = 0
       Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
       Superbase.Converters.XLS.DestFile = dateiname2$
       Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
       WAIT FOR 1
       
       
       ON ERROR GOTO nanV120320021
       REQUEST "Wollen Sie gleich das MS EXCEL-Dokument anzeigen lassen?","",130,req%
       IF req% = 1 THEN 
         a% = CALL ("ShellExecute",0,"open",dateiname2$,"","",1)
       END IF 
nanV120320021: 
       ON ERROR GOTO ErrorHandler
       DIRECTORY dir1$
       REM REMOVE FROM FILE "adrtemp"
       SET STATUS "EXPORT beendet!"
     END IF 
   END IF 
 END IF 
geVend061196: 
 FILE GMAADat$

 END SUB 
 


SUB WriteMAdrTemp(codema%,anrede$,titel$,nachname$,vorname$,gebdat%)
  GMAdrDat$ = "MAADR"
  BLANK FILE "adrtemp"
  codeadrt% = SER ("ADRTEMP",1)
  codeadrt.adrtemp = codeadrt%
  Kundennummer.adrtemp = Agenturnr.GMAdrDat$
  anrede.adrtemp = anrede$
  Name2.adrtemp = Nachname.GMAdrDat$
  Name1.adrtemp = Vorname.GMAdrDat$
  Strasse.adrtemp = Stra·e.GMAdrDat$
  PLZ.adrtemp = PLZ.GMAdrDat$
  Ort.adrtemp = Ort.GMAdrDat$
  Land.adrtemp = lAND.GMAdrDat$
  Postanschrift.adrtemp = Postanschrift.GMAdrDat$
  Geburtstag.adrtemp = DATE$ (gebdat%,"0d.mm.yyyy")
  mon1% = MONTH (gebdat%)
  tag1% = DAY (gebdat%)
  TagMon.adrtemp = (tag1% * 100) + mon1%
  Gebsort.adrtemp = VAL ( LEFT$ ( DATE$ (gebdat%,"mm0dyy"),4))
  K1Bank.adrtemp = K1Bank.GMAdrDat$
  K1BLZ.adrtemp = K1BLZ.GMAdrDat$
  K1Konto.adrtemp = K1Konto.GMAdrDat$
  Kunde_seit.adrtemp = DATE$ (MAseit.GMAdrDat$,"0d.mm.yyyy")
  REM Notiz.adrtemp = Notiz.GMAdrDat$
  REM Briefanrede.adrtemp = Briefanrede.GMAdrDat$
  REM Geburtsname.adrtemp = Geburtsname.GMAdrDat$
  Telart1.adrtemp = "Telefon"
  Telart2.adrtemp = "Telefon"
  Telart3.adrtemp = "Fax"
  Telart4.adrtemp = "BTX"
  Telart5.adrtemp = "email"
  Telnr1.adrtemp = Telefon1.GMAdrDat$
  Telnr2.adrtemp = Telefon2.GMAdrDat$
  Telnr3.adrtemp = Telefax.GMAdrDat$
  Telnr4.adrtemp = BTX.GMAdrDat$
  Telnr5.adrtemp = email.GMAdrDat$
  FILE "adrtemp"
  STORE FILE "adrtemp"
  UNLOCK CURRENT FILE "adrtemp"
 END SUB 
 
 

 REM ****************************************************************************************************************
 REM          Adress-öbersicht
 REM ****************************************************************************************************************
 
SUB AdrUEB()
   REM CALL Fehler("ADRHIS","")
 _formend% = 0
 SET STATUS "Bereit"
 ON ERROR GOTO ErrorHandler
 FILE "Adressen"
 WHILE _formend% = 0
   SUPERVISsub% = 0
   IF FORM <> "ADRUEB" THEN 
     SET HEADING title$ + " - Adress-öbersicht"
     OPEN FORM GOFFFORM$ + "\ADRUEB"
     SET f = Superbase.Form
     SET STATUS "Adress-öbersicht"
     FILE "SUPERVIS"
     INDEX codema.supervis
     SELECT FIRST FILE "supervis" INDEX codema.supervis
     SELECT FORM KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
     FILE "ADRESSEN"
     INDEX codeku.adressen
     SELECT FIRST FILE "ADRessen" INDEX codeku.adressen
     SELECT FORM FIRST INDEX codeku.adressen
     GAppName$ = _netpath$ + "DOCP\project.pdf"
     
     CALL MNADRUEB()
     FORM 
   END IF 
   MENU ON 
   MOUSE ON 
   waehr$ = "FirmenwÑhrung: " + waehrung.stamm
   FORM 
   CALL ClearKBDBuffer()
   MENU ON 
   WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL SVPrev()
   CASE CrsRight%,PgDn%
     CALL SVNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   CALL ClearKBDBuffer()
   SELECT CASE SUPERVISsub%
   CASE 1
     REM Auswahl einer Adresse
     knr% = codeku.adressen
     _formend% = 1
   CASE 2
     REM Abbruch
     MOUSE ON 
     _formend% = 1
 END SELECT 
 WEND 
 
 _formend% = 0
 END SUB 
 
SUB MNADRUEB()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
 
 
 
 
  
 



