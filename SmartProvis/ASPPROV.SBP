SBP
ÿÿmain()
 'CALL CreateCenter()
 'CALL SimpleConnect("adressen")
 'CALL CreateLoadSend("formular")
 'CALL FilialeToCenter("d:\afm.tst\",0, - 1)
 ÿƒCenterToFiliale("d:\afm.tst\",1,0)

 ÿ’ÿÿ
 

ÿÿPROVPPCS()
 ÿ’ÿÿ
 '*********************************************************************************************** 
 

ÿÿmain()
 'REGISTER CLEAR 
 'REGISTER "USER","MessageBox","IICCI"
 'CALL AbgPlausi("plausi.txt")
 
'DIRECTORY "d:\ppcsabgl\hiera"
'LOAD "HIERA", APPEND 
'IF CopyRecord%("adrsend","adressen") <> - 1 REQUEST ""
'CALL SimpleConnect("connect")
'CALL AbgleichInit()
'IF Send%() = - 1 THEN REQUEST "supa"
'CALL ManiSer("Adressen", 5000)
'CALL test()
'CALL DeleteAll()
'CALL DeleteCenter()
 
'CALL SimpleConnect("akquise")
ÿƒSimpleConnect("maadr")

'CALL ForceLoad("adressen")
'CALL ForceLoad("telefon")
 
'CALL CryptPwd("d:\dkm\temp")
'CALL PPCSOpenTest2()
'CALL PrintPPCSOpen("times2.txt")
'CALL PPCSSuchTest()
 
 ÿ’ÿÿ
 '***********************************************************************************************
 
 
ÿÿPPCSOpenTest()
 '”ffnet alle Dateien vom Typ "A" ber PPCS und protokolliert die Dauer fr 
 'diesen Vorgang in die Datei PPCSTime
 
ÿ†ÿt
ÿ¡ÿOÿ´("AbgFiles")ÿp
ÿ´ÿ™ÿà,1jaPPCSPath$ÿ"abgfiles;paris"
ÿ’ÿ¡
typ$ÿ"P"' C - Verschlsselt, P - Zugriffs-pwd
leervoll$ÿ"L"
rep%ÿ20' wie oft soll ge”ffnet werden (direkt nacheinander)
ÿ×Values%(rep%)
 
ip$ÿ"130.50.0.203"
port$ÿ"1280"
udpserver$ÿip$ÿ":"ÿport$
Connections.Clear()
ÿ¡ÿOConnections.Exists("CODIE")ÿÿ1ÿp
Connections.Add("CODIE","ConnectionUDPClient").ServerName ÿudpserver$
Superbase.Connections.CODIE.Timeoutÿ8000
ÿ’ÿ¡
 
ÿÉÿ`ÿ™"abgfiles"ÿ£CodeFile.AbgFiles
ÿØÿOÿB("AbgFiles")
'
ÿ¡Typ.AbgFilesÿ"A"ÿTyp.AbgFilesÿ"C"ÿTyp.AbgFilesÿ"Z"ÿp
datei$ÿFileName.AbgFiles
ÿÊÿËdatei$
'CALL Fehler("PPCSOpen","Datei: " + datei$)
 
ÿ›z%ÿ1ÿqrep%
 
tBefore%ÿSuperbase.Now
ÿ´ÿ™ÿà,1"CODIE:"ÿdatei$ÿ";paris"
tAfter%ÿSuperbase.Now
 
Values%(z%)ÿtAfter%ÿtBefore%
average%ÿaverage%ÿ(tAfter%ÿtBefore%)
 
ÿ¡ÿ´(datei$)ÿpÿ†ÿ™datei$
 
ÿ±z%
average%ÿaverage%ÿrep%
 
'mittleres Abstandsquadrat berechnen
square%ÿ0
ÿ›z%ÿ1ÿqrep%
square%ÿsquare%ÿ(average%ÿValues%(z%))ÿ(average%ÿValues%(z%))
ÿ±z%
square%ÿÿ(square%)ÿrep%
 
 
'Ergebnis wegschreiben
ÿÉÿYÿáÿ™"AbgFiles"ÿ£CodeFile.AbgFiles

Square.AbgFilesÿsquare%
ÿ¡typ$ÿ"C"ÿleervoll$ÿ"L"ÿp
TimeC_L.AbgFilesÿaverage%
ÿ’ÿ¡
ÿ¡typ$ÿ"P"ÿleervoll$ÿ"L"ÿp
TimeP_L.AbgFilesÿaverage%
ÿ’ÿ¡
ÿ¡typ$ÿ"C"ÿleervoll$ÿ"V"ÿp
TimeC.AbgFilesÿaverage%
ÿ’ÿ¡
ÿ¡typ$ÿ"P"ÿleervoll$ÿ"V"ÿp
TimeP.AbgFilesÿaverage%
ÿ’ÿ¡

 
ÿÌÿ™"AbgFiles"
 
ÿ’ÿ¡
 
ÿÉÿ±ÿ™"abgfiles"ÿ£CodeFile.AbgFiles
ÿÙ
 
 ÿ’ÿÿ
 '***********************************************************************************************  

 
ÿÿPPCSOpenTest2()
 '”ffnet alle Dateien vom Typ "A" ber PPCS und protokolliert die Dauer fr 
 'diesen Vorgang in die Datei PPCSTime
 
ÿ†ÿt
ÿ¡ÿOÿ´("AbgFiles")ÿp
ÿ´ÿ™ÿà,1jaPPCSPath$ÿ"abgfiles;paris"
ÿ’ÿ¡
 
leervoll$ÿ"L"
rep%ÿ20' wie oft soll ge”ffnet werden (direkt nacheinander)    
 
ip$ÿ"130.50.0.203"
port$ÿ"1280"
udpserver$ÿip$ÿ":"ÿport$
 
 
ÿ›z%ÿ1ÿqrep%

ÿ†ÿt
ÿ¡ÿOÿ´("AbgFiles")ÿp
ÿ´ÿ™ÿà,1jaPPCSPath$ÿ"abgfiles;paris"
ÿ’ÿ¡

ÿÂ"Loop: "ÿÿ(z%,"z")
Connections.Clear()
ÿ¡ÿOConnections.Exists("CODIE")ÿÿ1ÿp
Connections.Add("CODIE","ConnectionUDPClient").ServerName ÿudpserver$
Superbase.Connections.CODIE.Timeoutÿ8000
ÿ’ÿ¡

ÿÉÿ`ÿ™"abgfiles"ÿ£CodeFile.AbgFiles
ÿØÿOÿB("AbgFiles")
'            
ÿ¡Typ.AbgFilesÿ"A"ÿTyp.AbgFilesÿ"C"ÿTyp.AbgFilesÿ"Z"ÿp
datei$ÿFileName.AbgFiles
ÿÊÿËdatei$
'CALL Fehler("PPCSOpen2","Datei: " + datei$)
 
tBefore%ÿSuperbase.Now
ÿ´ÿ™ÿà,1"CODIE:"ÿdatei$ÿ";paris"
tAfter%ÿSuperbase.Now
 
ÿ¡ÿ´(datei$)ÿpÿ†ÿ™datei$
 
'kummulierende Summe wegschreiben
ÿÉÿYÿáÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿ¡(z%ÿ1)ÿp
ÿ¡leervoll$ÿ"L"ÿp
Time_L.AbgFilesÿ0
ÿ’ÿ¡
ÿ¡leervoll$ÿ"V"ÿp
Time.AbgFilesÿ0
ÿ’ÿ¡
ÿ’ÿ¡
 
ÿ¡leervoll$ÿ"L"ÿp
Time_L.AbgFilesÿTime_L.AbgFilesÿ(tAfter%ÿtBefore%)ÿrep%
ÿ’ÿ¡
ÿ¡leervoll$ÿ"V"ÿp
Time.AbgFilesÿTime.AbgFilesÿ(tAfter%ÿtBefore%)ÿrep%
ÿ’ÿ¡

ÿÌÿ™"AbgFiles"
ÿïÿYÿ™"AbgFiles"
ÿ’ÿ¡
 
ÿÉÿ±ÿ™"abgfiles"ÿ£CodeFile.AbgFiles
ÿÙ

ÿ±z%

 ÿ’ÿÿ
 '***********************************************************************************************  
 

ÿÿPrintPPCSOpen(txtfile$)
sep$ÿ";"
ÿ´txtfile$ÿ›ÿ¶
ÿÉÿ`ÿ™"abgfiles"ÿ£CodeFile.AbgFiles
'Header schreiben
ÿ{"FileName"ÿsep$ÿ"FieldCount"ÿsep$ÿ"IndexCount"ÿsep$ÿ"TXT1000Count"ÿsep$;
ÿ{"Time"ÿsep$ÿ"Time_L"
ÿØÿOÿB("AbgFiles")

ÿ¡Typ.AbgFilesÿ"A"ÿTyp.AbgFilesÿ"C"ÿTyp.AbgFilesÿ"Z"ÿp
ÿ{FileName.AbgFilesÿsep$;
ÿ{ÿ(FieldCount.AbgFiles,"z")ÿsep$;
ÿ{ÿ(IndexCount.AbgFiles,"z")ÿsep$;
ÿ¡TXT1000Count.AbgFilesÿ0ÿp
ÿ{"0"ÿsep$;
ÿ^
ÿ{ÿ(TXT1000Count.AbgFiles,"z")ÿsep$;
ÿ’ÿ¡
ÿ{ÿ(Time.AbgFiles,"0000")ÿsep$;
ÿ{ÿ(Time_L.AbgFiles,"0000")
ÿ’ÿ¡
 
ÿÉÿ±ÿ™"abgfiles"ÿ£CodeFile.AbgFiles
ÿÙ
ÿ{""
 
ÿ†ÿ¶
 ÿ’ÿÿ
 '***********************************************************************************************  
 

ÿÿFehler(Z1$,Z2$)
 msg$ÿZ1$
 ÿ¡z2$ÿ""ÿpmsg$ÿmsg$ÿÿ(13)ÿÿ(10)ÿZ2$
 v%ÿÿƒ("MessageBox",hWnd%%,ÿåansi(msg$),ÿåansi(title$),48)
 ÿ’ÿÿ
 '***********************************************************************************************
 

ÿÿForceLoad(datei$,wks%)

'Dirty-Felder in der Zentrale neu setzen
'wenn wks% <> -1 ==> nur die Daten dieser Filiale bekommen den Dirty-Zustand
'nach Ausfhrung der Funktion werden alle Daten von den Filialen
'beim n„chsten CenterToLoad bernommen
'Vor.: datei$ und AbgFiles mssen ge”ffnet sein
oldErrorLabel$ÿSuperbase.ErrorTrapLabel
 
wks$ÿ"Workstation."ÿdatei$
code$ÿGetFileCode$(datei$)
code$ÿcode$ÿ"."ÿdatei$
ÿ¡wks%ÿÿ1ÿp
 
ÿÉÿ`ÿ™datei$ÿ£code$$
ÿØÿOÿB(datei$)
ÿ³ÿ_ÿwForceNextError1
ÿÉÿYÿáÿ™datei$ÿ£code$$
recfield$ÿ"rec0."ÿdatei$
recfield$$ÿwks$$
ÿ›i%ÿ1ÿq19
recfield$ÿ"rec"ÿÿ(i%,"z")ÿ"."ÿdatei$
recfield$$ÿwks$$
ÿ±i%

ÿÌÿ™datei$
ÿïÿYÿ™datei$
'alles io
ÿwForceNext2

ForceNextError1: 
ÿ¡jaDebug%ÿÿ1ÿpÿƒFehler("Fehler in ForceLoad: "ÿdatei$,ÿ(ÿ&,"z")ÿ": "ÿÿ((ÿ&))

ForceNext1: 
ÿ³ÿ_ÿwErrorHandler
ÿÉÿ±ÿ™datei$ÿ£code$$
ÿÙ
ÿ^

ÿÉÿ`ÿ™datei$ÿ£wks$$
ÿÉÿ¥wks%ÿ™datei$ÿ£wks$$
ÿØÿOÿB(datei$)ÿwks$$ÿwks%
ÿ³ÿ_ÿwForceNextError2
ÿÉÿYÿáÿ™datei$ÿ£wks$$
recfield$ÿ"rec0."ÿdatei$
recfield$$ÿwks$$
ÿ›i%ÿ1ÿq19
recfield$ÿ"rec"ÿÿ(i%,"z")ÿ"."ÿdatei$
recfield$$ÿwks$$
ÿ±i%

ÿÌÿ™datei$
ÿïÿYÿ™datei$
'alles io
ÿwForceNext2

ForceNextError2: 
ÿ¡jaDebug%ÿÿ1ÿpÿƒFehler("Fehler in ForceLoad: "ÿdatei$,ÿ(ÿ&,"z")ÿ": "ÿÿ((ÿ&))
 
ForceNext2: 
ÿ³ÿ_ÿwErrorHandler
ÿÉÿ±ÿ™datei$ÿ£wks$
ÿÙ
ÿ’ÿ¡

Superbase.ErrorTrapLabelÿoldErrorLabel$
 ÿ’ÿÿ
 '***********************************************************************************************   
 
 
ÿÿSetDisplay(typ%)
 'typ = -1 -> Standard-Fenster-Eigenschaften
 'typ = 0  -> Abgleich-Formular-Eigenschaften
 
 ÿ¡typ%ÿ0ÿp

'Abgleich-Formular zurechtbasteln
ÿÊÿ¬ÿe
Superbase.MDIModeÿ0
Superbase.WindowStateÿ0
Superbase.Sizeableÿÿ1
Superbase.Topÿ50
Superbase.Leftÿ50
Superbase.Widthÿ500
Superbase.Heightÿ220
Superbase.Sizeableÿ0
Superbase.SelectionBarÿ0
Superbase.StatusBarÿ0
Superbase.IconBarStateÿ0
Superbase.BorderStyleÿ1

ÿ×w ÿUSDIWindow 
ÿÊw ÿSuperbase.Windows(1)
w.OpenForm(_netpath$ÿ"ppcsabgl")
w.Form.FktL.Captionÿ" "
w.Form.TitleL.Captionÿ" "
w.Form.CounterL.Captionÿ" "
ÿÊÿÿ³

 ÿ^

 
Superbase.StatusBarÿÿ1
ScrWidth%ÿÿåsys(6)
ScrHeight%ÿÿåsys(7)
CapHeight%ÿÿƒ("GetSystemMetrics",4)
ÿ½ CALL Fehler("Screen","")
ÿ¡(ScrWidth%ÿ
800ÿScrHeight%ÿ
600)ÿ(ÿ>(_projekt$)ÿ"FACTURA"ÿÿ>(_projekt$)ÿ"AKTE"ÿÿ>(_projekt$)ÿ"PROVIS"ÿÿ>(_projekt$)ÿ"OFFICE")ÿp

ÿƒFehler("Sie k”nnen das Programm nicht unter der Bildschirmaufl”sung 640*480 betreiben!","ndern Sie bitte Ihre Bildschirmaufl”sung in 800 * 600 (kleine Schrift/Small Fonts)!")
ÿ^

ÿÉÿæScrWidth%

ÿæ640
LargeFont$ÿ"FALSE"
ÿ¡ÿ>(_projekt$)ÿ"FACTURA"ÿÿ>(_projekt$)ÿ"AKTE"ÿÿ>(_projekt$)ÿ"PROVIS"ÿÿ>(_projekt$)ÿ"OFFICE"ÿp
ÿƒFehler("Sie k”nnen das Programm nicht unter der Bildschirmaufl”sung 640*480 betreiben!","ndern Sie bitte Ihre Bildschirmaufl”sung in 800 * 600 (kleine Schrift/Small Fonts)!")
ÿ½ CALL EXIT()
ÿ’ÿ¡

ÿæ800
ÿ¡CapHeight%ÿ20ÿpLargeFont$ÿ"TRUE"ÿ^LargeFont$ÿ"FALSE"
ÿ¡LargeFont$ÿ"TRUE"ÿp
ÿƒFehler("Siehe haben als Bildschirmfont ~Largefonts/Groáe Schriftart~ eingestellt, dies fhrt zu Problemen, da die Programm-Masken fr Aufl”sung 800*600 Kleine Schriftart erstellt wurden!","Bitte „ndern Sie den Bildschirmfont!")
ÿ’ÿ¡

ÿæ1024
ÿ¡CapHeight%ÿ20ÿpLargeFont$ÿ"TRUE"ÿ^LargeFont$ÿ"FALSE"

ÿæ1152
ÿ¡CapHeight%ÿ20ÿpLargeFont$ÿ"TRUE"ÿ^LargeFont$ÿ"FALSE"

ÿæ1280
ÿ¡CapHeight%ÿ20ÿpLargeFont$ÿ"TRUE"ÿ^LargeFont$ÿ"FALSE"

ÿæ1600
ÿ¡CapHeight%ÿ20ÿpLargeFont$ÿ"TRUE"ÿ^LargeFont$ÿ"FALSE"

ÿ’ÿÉ

ÿ½ 060499

ÿ¡ÿ>(LargeFont$)ÿ"FALSE"ÿp
WndWidth%ÿ640
WndHeight%ÿ480
ÿ¡ÿ>(_projekt$)ÿ"FACTURA"ÿÿ>(_projekt$)ÿ"AKTE"ÿÿ>(_projekt$)ÿ"PROVIS"ÿÿ>(_projekt$)ÿ"OFFICE"ÿÿ>(_projekt$)ÿ"IMMAK"ÿÿ>(_projekt$)ÿ"MEDIA"ÿp
WndWidth%ÿ800
WndHeight%ÿ600
ÿ’ÿ¡

ÿ^
ÿÉÿæScrWidth%
ÿæ640
WndWidth%ÿ640
WndHeight%ÿ480
ÿæ800
WndWidth%ÿ950
WndHeight%ÿ700
ÿæ1024
WndWidth%ÿ950
WndHeight%ÿ700
ÿæ1152
WndWidth%ÿ950
WndHeight%ÿ700
ÿæ1280
WndWidth%ÿ950
WndHeight%ÿ700
ÿæ1600
WndWidth%ÿ950
WndHeight%ÿ700
ÿ’ÿÉ

ÿ’ÿ¡
ÿ’ÿ¡
 
_wpx%ÿ(ÿåsys(6)ÿWndWidth%)ÿ2
_wpy%ÿ(ÿåsys(7)ÿWndHeight%)ÿ2
ÿÊÿ¸_wpx%,_wpy%,WndWidth%,WndHeight%
ÿÊÿ¸
 ÿ’ÿ¡
 DisplaySet%ÿ0
 ÿ’ÿÿ
'***********************************************************************************************


ÿÿAbgleichInit()
'Deklariert Globale Variablen, die fr den Abgleich und die Filial-Hierarchie ben”tigt werden
'ruft Funktion ReadHiera() auf, die die Hierarchie-Infos aus der FILIALE bzw. LFILIALE liest
'baut im Online-Fall die LFILIALE neu auf
'definiert im Offline-Fall die Workstation% aus der Ini
'definiert jaDebug%


oldErrorLabel$ÿSuperbase.ErrorTrapLabel
ÿÿjaDebug%
jaDebug%ÿ0

a$ÿReadConfig$("PROVIS","jaDEBUG")
ÿ½ CALL Fehler(a$,"")
ÿ¡a$ÿ"0"ÿa$ÿ"leer"ÿp

jaDebug%ÿÿ1
ÿ’ÿ¡
 
ÿ¡jaDebug%ÿÿ1ÿp

ÿƒFehler("AbgleichInit()","")
ÿ’ÿ¡

'Konstanten fr Hierarchie-Modell
ÿ½ GLOBAL Nachfolger%(0)'Array aller Filial-Nummern
ÿ½ GLOBAL Vorg„nger%(0)'Array alller Vorg„nger-Filial-Nummern (korrespondierend zu Nachfolger%)
ÿÿOffNames$(0)'Array aller Filial-Namen (korresp. zu Nachfolger%)
ÿÿOffCount%'Anzahl Bros der eigenen Hierarchie 
 
'Sichtbare Bros ermitteln
ÿÿVisOff%(0)'Array der sichtbaren Workstation-Nummern
ÿÿVisNames$(0)'Array der sichtbaren Workstation-Namen
ÿÿVisCount%'Anzahl sichbarer Workstations       

 
 
'Hierarchie-DLL
'I   : Rckgabe der ausgew„hlten FilialNr; -1 bei Abbruch
'C   : Pfad zum TXT-File mit Hierarchie-Abbild
'I   : Vorauswahl fr FilialNr; Wurzel, wenn Wert nicht ex.
'C   : Aktion (max. 2 Zeilen); Wordwrap
'C   : Info (max Zeilen); Wordwrap
'I   : 0 - Ok-Button, 1 - Ausw„hlen/Abbrechen

WinDir$ÿ""
a%ÿÿƒ("GetWindowsDirectory",WinDir$,128)
ÿ¡ÿJ(WinDir$ÿ"\CODieLIB.dll")ÿÿJ(_remotepath$ÿ"CODieLIB.dll")ÿp

'REGISTER "hiera.dll","_SelectOffice","IC"

ÿî"CODieLIB.dll","_SelectOffice","ICICCI"
ÿ^

ÿƒFehler("Die Bibliothek 'hiera.dll' konnte nicht geladen werden!","")
ÿ’ÿ¡

'auch untergeordnete Bros anzeigen?
ÿÿShowOther%
ShowOther%ÿÿ1

ÿÿjaRecField$'das eigene RecStatus-Feld    
ÿÿWksStufe%'Hierarchie-Level ermitteln  

'Filial-Hierarchie-Infos einlesen
ÿƒReadHiera()
 

 ÿÿgMaxLocalCode%'ID-Range-Trennung zwischen Filiale und Zentrale
 gMaxLocalCode%ÿ2000000
 
 'TState-Konstanten fr Abgleich "lokal -> zentral"
 'genutzter Zeichenbereich: "0" ... "9", "A" ... "Z","a" ... "z"..
 '(..entspricht 48 ... 57, 65 ... 90,97 ... 122)
 'Zwischen den Zust„nden jeweils 8 Zeichen Platz lassen
 ÿÿglcStart$,glcCenter1$,glcCenter2$,glcSub1$,glcSub2$
 ÿÿglcSubCenter1$,glcSubCenter2$,glcLocal1$,glcLocal2$
 ÿÿglcMainToSub1$,glcMainToSub2$,glcMainToSub3$
 glcStart$ÿ""

 'Vorgang 1.4.1
 'Datenbertragung und Rckschreiben der neuen zentralen ID'S
 glcCenter1$ÿ"A"
 glcCenter2$ÿ"B"'lokaler Datensatz wurde in Zentrale kopiert und zentrale ID wurde in die *Send bernommen
 
 
 'Vorgang 1.4.1.1
 'šbergabe der Main-ID's an die Sub-Files
 'Schreiben in die TState-Felder der Main-Files
 glcMainToSub1$ÿ"J"'bei šbergabe traten Fehler auf; šbergabe kann noch (weiter)laufen
 glcMainToSub2$ÿ"K"'šbergabe l„uft noch; bisher ohne Fehler
 glcMainToSub3$ÿ"L"'šbergabe komplett
 
 
 'Vorgang 1.4.2
 'Untergeordnete lokale Datens„tze wurden in Zentrale kopiert und zentrale ID wurde bernommen
 glcSubCenter1$ÿ"S"
 glcSubCenter2$ÿ"T"
 
 
 'šbernahme der (neuen) zentralen ID's in die lokalen Dateien
 glcLocal1$ÿ"b"
 glcLocal2$ÿ"c"
 
 'Parameter-Konstanten fr Funktionsaufrufe
 ÿÿjaSFile$,jaSCode$,jaSCodeServer$,jaSTState$,jaSRStat$
 ÿÿjaCFile$,jaCCode$,jaCRStat$
 ÿÿjaLFile$'hier nur zum Schlieáen der lokalen adressen.sbf  
 ÿÿjaSSubFile$,jaSMainCode$,jaSMainCode2$,jaSMainCode3$,jaSMainCode4$,jaSSubTState$
 ÿÿjaSSubRStat$,jaSSubCodeServ$,jaSSubCode$
 ÿÿjaCSubServWork$,jaCSubCode$,jaCMainCode$,jaCSubFile$,jaCSubRStat$
 ÿÿjaLSubFile$
 ÿÿjaLCode$,jaLMainCode$,jaLMainCode2$,jaLMainCode3$,jaLMainCode4$,jaLRStat$
 ÿÿjaLSubCode$,jaLSubRStat$
 ÿÿjaFirstSubFile%,jaLastSubFile%'bool
 ÿÿjaIsMain%'fr SendMain() (bzw. SendFile)
 ÿÿjaDummySub%'  fr Files, die zwar zentrale ID's ber MainToSub() bekommen, 
'  aber selbst nicht zur Zentrale abgeglichen werden
 ÿÿjaSendSucc%'war der gesamte(!) Send-Vorgang erfolgreich?
 ÿÿjaCTLSucc%'war der CenterToLoad-Vorgang erfolgreich?
 ÿÿjaLTLSucc%'war der LoadToLocal-Vorgang erfolgreich?

 ÿÿjaTyp1To1%,jaFilePrefix$,jaFileTyp$,jaFileCode$
 
 'Konstanten fr Log-File-Erzeugung
 ÿÿjaLogFile$
 ÿÿjaLogRepeat$' Abgleich hat nicht fkt. ==> zurcksetzen der TState-Konstante fr einen neuen Versuch
 ÿÿjaLogOk$'
 ÿÿjaLogError$'irgend etwas ist schief gelaufen
 ÿÿjaLogNew$'neuer Datensatz wird erstellt
 ÿÿjaLogCopy$' Datensatz wird bernommen
 ÿÿjaLogPass$'ID in die untergeordneten Send-Files reichen (MainToSub)
 ÿÿjaLogIter$'nur fr Fehler in „uáerer verschachtelter while-Schleife
 jaLogRepeat$ÿ"Repeat"
 jaLogOk$ÿ"Ok"
 jaLogError$ÿ"Error"
 jaLogNew$ÿ"New"
 jaLogCopy$ÿ"Copy"
 jaLogPass$ÿ"Pass"
 jaLogIter$ÿ"Iter"
 ÿÿjaLoadSubOff%'sollen die Daten der untergeordneten Bros beim Download bernommen werden ?
 ÿÿjaCenterDirty%'-1 -> LoadToLocal ist sp„testens mit dem n„chsten Programmstart n”tig


 Superbase.ErrorTrapLabelÿoldErrorLabel$
 ÿ’ÿÿ
'***********************************************************************************************
 

ÿÿAbgleich()
 'Datenabgleich
 oldErrorLabel$ÿSuperbase.ErrorTrapLabel

 ÿ¡ÿOÿ´("abgfiles")ÿpÿ´ÿ™ÿà,1_remotepath$ÿ"abgfiles;paris"
 ÿ¡ÿOÿ´("abgdeps")ÿpÿ´ÿ™ÿà,1_remotepath$ÿ"abgdeps;paris"
 
 ÿƒAbgleichInit()
 jaCenterDirty%ÿÿ0(ReadConfig$("PROVIS","LTL"))
 
 ÿ¡GPPCS$ÿ"TRUE"ÿp

ÿ¡Workstation%ÿ0ÿp


ÿ¡jaDebug%ÿÿ1ÿpÿƒFehler ("Abgleich-Vorbereitung","")


'Dialog fr Abgleichtyp-Abfrage holen

AblTyp%ÿ1'1 -> kein Abgleich, 2 -> nur Send(), 3 -> Send + Load

jaLoadSubOff%ÿ0' -1 -> auch Daten untergeordneter Bros downloaden ?


ÿƒAbglDlg(Ant%%,AbglTyp%,jaLoadSubOff%)



ÿ¡Ant%%ÿ1ÿp'Dlg mit Cancel beendet ==> Voreinstellung "kein Abgleich"
AblTyp%ÿ1'
jaLoadSubOff%ÿ0'

ÿ’ÿ¡


	

ÿ¡(AbglTyp%ÿ2)ÿ(AbglTyp%ÿ3)ÿp

ÿ¡IsSingleUser%()ÿÿ1ÿp

ÿƒSetDisplay(0)
ÿ×w ÿUSDIWindow 
ÿÊw ÿSuperbase.Windows(1)
w.Form.FktL.Captionÿ"Ableich vorbereiten ..."

'Abgleich starten
ÿ³ÿ_ÿwErrorHandler
ÿ¡jaDebug%ÿÿ1ÿpÿƒFehler ("Abgleich-Start","")

ÿƒCAbgleichLog("sed")
ÿƒSend()

ÿ¡AbglTyp%ÿ3ÿp

ÿƒCAbgleichLog("ctl")
ÿƒCenterToLoad()

ÿƒCAbgleichLog("ltl")
ÿƒLoadToLocal()
ÿ’ÿ¡
ÿ^
ÿƒFehler("Es wurde kein Datenabgleich vorgenommen!","")
ÿ’ÿ¡
 
'Standard-Fenster-Eigenschaften zurcksetzen
ÿƒSetDisplay(ÿ1)

ÿ’ÿ¡

ÿ’ÿ¡'Worksation% <> 0 
 ÿ^
'GPPCS$=FALSE
ÿ¡jaCenterDirty%ÿ0ÿp

'LoadToLocal muá ausgefhrt werden 

ÿƒFehler("Bei der letzten Programm-Sitzung wurden zentralen Daten ge„ndert.","Diese nderungen werden nun bernommen.")

ÿ¡IsSingleUser%()ÿÿ1ÿp

ÿƒSetDisplay(0)'Abgleich-Formular laden/erzeugen
ÿƒCAbgleichLog("ltl")
ÿƒLoadToLocal()
ÿƒSetDisplay(ÿ1)'Abgleich-Formular laden/erzeugen

ÿ¡jaLTLSucc%ÿÿ1ÿp
ÿƒWriteConfig("PROVIS","LTL","0")
ÿ^
ÿƒFehler("Die šbernahme der Zentralen Daten konnte nicht vollst„ndig vorgenommen werden."," Es wird empfohlen das Programm neu zu starten und den Vorgang zu wiederholen.")
ÿ’ÿ¡

ÿ^
ÿƒFehler("Die šbernahme der Zentralen Daten konnte nicht vorgenommen werden.","Es wird empfohlen, das Programm neu zu starten und den Vorgang zu wiederholen.")

ÿ’ÿ¡

ÿ’ÿ¡
 ÿ’ÿ¡
 Superbase.ErrorTrapLabelÿoldErrorLabel$
 ÿ’ÿÿ
 '***********************************************************************************************
 
 
ÿÿIsSingleUser%()
 'prft, ob der aktuelle der einzige User ist
 '-1 wenn ja
 '0 wenn nein
 '
 'erzeugt Schleife, in der der User Gelegenheit bekommt, andere User aus dem Programm zu schmeiáen

 oldErrorLabel$ÿSuperbase.ErrorTrapLabel
 IsSingleUser%ÿ0
 ÿ_remotepath$

SingleUserStart:

ÿ³ÿ_ÿwSingleUserError
ÿ¡ÿ´("supervis")ÿpÿ†ÿ™"supervis"
ÿ´ÿ™ÿà,8"supervis;paris"
ÿ†ÿ™"supervis"
'bisher alles io
ÿwSingleUserContin
 
SingleUserError: 
a$ÿ"šberprfen Sie, ob Sie der einzige Nutzer des Programmes sind."
ÿÂ"Der ausschliesslicher Zugriff konnte nicht erfolgen.",a$,113
ÿÂ"W„hlen Sie 'Ja', wenn Sie den Vorgang jetzt fortsetzen m”chten.","W„hlen Sie 'Nein', wenn Sie den Datenabgleich berspringen wollen.",130,Ant%%
ÿ¡Ant%%ÿ0ÿp
ÿySingleUserEnd
ÿ^
ÿySingleUserStart 
ÿ’ÿ¡
 
SingleUserContin:
IsSingleUser%ÿÿ1

SingleUserEnd: 

ÿƒDFile(2,"supervis;paris")'wieder ”ffnen 

 Superbase.ErrorTrapLabelÿoldErrorLabel$
 ÿ’ÿÿ

 '*********************************************************************************************** 

ÿÿActivateHiera()
Superbase.Dialogs.ABGL.HieraCB.Enabledÿÿ1
 ÿ’ÿÿ
 '***********************************************************************************************


ÿÿDeactivateHiera()
Superbase.Dialogs.ABGL.HieraCB.Enabledÿ0
 ÿ’ÿÿ
 '*********************************************************************************************** 

 
ÿÿActivateABGL()
'REQUEST "Activate"
Superbase.Dialogs.ABGL.UDNoneOB.Valueÿÿ1
Superbase.Dialogs.ABGL.HieraCB.Enabledÿ0
 ÿ’ÿÿ
 '*********************************************************************************************** 


ÿÿAbglDlg(Ant%,AbglTyp%,HieraTyp%)
 
ÿ×dlg ÿUDialog
ÿ×control ÿUDialogControl
 
Superbase.Dialogs.Add("ABGL")
ÿÊdlg ÿSuperbase.Dialogs.ABGL
dlg.Move(76,34,204,160)
dlg.Captionÿ"Daten-Abgleich"
dlg.FontNameÿ"MS Sans Serif"
dlg.FontSizeÿ10
dlg.OnActivateÿ"ActivateABGL"
 
ÿÊcontrol ÿdlg.Add("DialogLabel1","DialogLabel")
control.Move(20,12,132,12)
control.Captionÿ"Bitte w„hlen Sie die Art des Abgleiches."
 
ÿÊcontrol ÿdlg.Add("DialogIcon1","DialogIcon")
control.Move(2,10,16,18)
control.Iconÿ2
 
ÿÊcontrol ÿdlg.Add("DialogLabel2","DialogLabel")
control.Move(20,33,172,31)
control.Captionÿ"Hinweis: Wenn Sie einen Daten-Abgleich vornehmen wollen, mssen alle anderen Nutzer die Arbeit mit dem Programm einstellen."
 
ÿÊcontrol ÿdlg.Add("UDNoneOB","DialogOptionButton")
control.Move(20,68,130,15)
control.Captionÿ"Kein Abgleich"
control.Bind("AbglTyp%")
control.ValueOnÿ1
control.OnClickÿ"DeactivateHiera"
 
ÿÊcontrol ÿdlg.Add("DialogOptionButton2","DialogOptionButton")
control.Move(20,81,130,15)
control.Captionÿ"Lokale Daten senden"
control.Bind("AbglTyp%")
control.ValueOnÿ2
control.OnClickÿ"DeactivateHiera"
 
ÿÊcontrol ÿdlg.Add("DUOption","DialogOptionButton")
control.Move(20,95,171,15)
control.Captionÿ"Lokale Daten senden und zentrale Daten empfangen"
control.Bind("AbglTyp%")
control.ValueOnÿ3
control.OnClickÿ"ActivateHiera"
 
ÿÊcontrol ÿdlg.Add("HieraCB","DialogCheckBox")
control.Move(34,109,150,14)
control.Bind("HieraTyp%")
control.ValueOnÿÿ1
control.Captionÿ"Daten untergeordneter Bros einschlieáen"
control.OnClickÿ"ActivateHiera"
 
ÿÊcontrol ÿdlg.Add("DialogCommandButton1","DialogCommandButton")
control.Move(71,135,52,12)
control.Defaultÿ1
control.Captionÿ"Ok"
control.ReturnValueÿ1

ÿñ"ABGL",Ant%
ÿ¾ÿñ"ABGL"
 
 ÿ’ÿÿ
 '*********************************************************************************************** 


ÿÿReadHiera()
oldErrorLabel$ÿSuperbase.ErrorTrapLabel

'die Daten der LFILIALE kopieren
ÿ³ÿ_ÿwReadHieraErr
ÿƒDFile(2,"LFILIALE;paris")
OffCount%ÿ0
VisCount%ÿ0
ÿ½ CALL Fehler("ReadHiera","")
ÿ¡GPPCS$ÿ"TRUE"ÿWorkstation%ÿ0ÿp

ÿƒReadHArray("filiale",OffCount%)
'sichtbare Workstations aus Vorg„nger%, Nachfolger%, OffCount% holen
ÿƒGetVisOff(Workstation%)
'sich selbst noch zu den sichbaren Bros hinzufgen
VisCount%ÿVisCount%ÿ1
ÿÿVisOff%(VisCount%ÿ1)
ÿÿVisNames$(VisCount%ÿ1)
VisOff%(VisCount%ÿ1)ÿWorkstation%
ÿ½ CALL Fehler("VisNames$","")
VisNames$(VisCount%ÿ1)ÿGetWksName$(Workstation%)

'die lokale lfiliale aus den sichtbaren Bros neu aufbauen
'(fr den n„chsten Offline-Start)
ÿ½ REMOVE FROM FILE "lfiliale"
 
'das h”chste Bro immer per Def. eintragen (Zentrale)
ÿÉÿ`ÿ™"filiale"ÿ£filialnr.filiale
ÿÉÿ¥0ÿ™"filiale"ÿ£filialnr.filiale
ÿ½ CALL Fehler(Name.filiale,"")
ÿ¡ÿJ(filialnr.filiale,filialnr.lfiliale)ÿp

ÿÉÿ¥filialnr.filialeÿáÿ™"lfiliale"ÿ£filialnr.lfiliale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"
ÿ^
ÿÿ™"lfiliale"
filialnr.lfilialeÿfilialnr.filiale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"
ÿ’ÿ¡
'den Pfad vom aktuellen Bro bis zur Zenrale: 
'suche solange den Vorg„nger, bis die 0 erreicht wird
ÿ³ÿ_ÿwErrorHandler
wks%ÿGetWksVorg%(Workstation%)

ÿØwks%ÿ0
ÿÉÿ`ÿ™"filiale"ÿ£filialnr.filiale
ÿÉÿ¥wks%ÿ™"filiale"ÿ£filialnr.filiale
ÿ¡ÿC("filiale")ÿp
ÿ¡ÿJ(filialnr.filiale,filialnr.lfiliale)ÿp
ÿÉÿ¥filialnr.filialeÿáÿ™"lfiliale"ÿ£filialnr.lfiliale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"
ÿ^
ÿÿ™"lfiliale"
filialnr.lfilialeÿfilialnr.filiale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"
ÿ’ÿ¡
ÿ’ÿ¡
wks%ÿGetWksVorg%(wks%)
ÿÙ
 
'die restlichen sichtbaren Bros, einschl. sich selbst (untergeordnete Bros)
ÿ›i%%ÿ0ÿqVisCount%ÿ1
ÿÉÿ¥VisOff%(i%%)ÿ™"filiale"ÿ£filialnr.filiale
ÿ¡ÿC("filiale")ÿp
ÿ¡ÿJ(filialnr.filiale,filialnr.lfiliale)ÿp
ÿÉÿ¥filialnr.filialeÿáÿ™"lfiliale"ÿ£filialnr.lfiliale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"
ÿ^
ÿÿ™"lfiliale"
filialnr.lfilialeÿfilialnr.filiale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"
ÿ’ÿ¡
ÿ’ÿ¡
ÿ³ÿ_ÿwErrorHandler
ÿÉÿ±ÿ™"filiale"ÿ£filialnr.filiale
ÿ±i%%
ÿ^
'wenn nicht online ==> lfiliale nutzen, um Bro-Hierarchie einzulesen
ÿÉÿ`ÿ™"filiale"ÿ£filialnr.filiale
ÿÉÿ¥0ÿ™"filiale"ÿ£filialnr.filiale
ÿ½ CALL Fehler(Name.filiale,"")
ÿØÿOÿB("filiale")

ÿ¡ÿJ(filialnr.filiale,filialnr.lfiliale)ÿp
ÿÉÿ¥filialnr.filialeÿáÿ™"lfiliale"ÿ£filialnr.lfiliale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"

ÿ^
ÿÿ™"lfiliale"
filialnr.lfilialeÿfilialnr.filiale
Name.lfilialeÿName.filiale
Stufe.lfilialeÿStufe.filiale
Vorg„nger.lfilialeÿVorg„nger.filiale
ÿÌÿ™"lfiliale"

ÿ’ÿ¡

ÿÉÿ±ÿ™"filiale"ÿ£filialnr.filiale
ÿÙ
ÿ½ CALL Fehler("ReadHiera-Stufe1","")
ÿƒReadHArray("lfiliale",OffCount%)
VisCount%ÿ0
ÿƒGetVisOff(Workstation%)'sichtbare Workstations aus zentraler filiale.sbf holen   
'sich selbst noch zu den sichbaren Bros hinzufgen
VisCount%ÿVisCount%ÿ1
ÿÿVisOff%(VisCount%ÿ1)
ÿÿVisNames$(VisCount%ÿ1)
VisOff%(VisCount%ÿ1)ÿWorkstation%
ÿ½ CALL Fehler("VisNames$","")
VisNames$(VisCount%ÿ1)ÿGetWksName$(Workstation%)
 
ÿ’ÿ¡

'Hierarchie-Level ermitteln 
ÿÉÿ`ÿ™"lfiliale"ÿ£FilialNr.lFiliale
ÿÉÿ¥Workstation%ÿ™"lfiliale"ÿ£FilialNr.lFiliale

ÿ¡ÿC("lfiliale")ÿp
WksStufe%ÿStufe.lFiliale

ÿ^
ÿƒFehler("Ungltige Filial-Nummer: "ÿÿ(Workstation%,"z"),"")

ÿ’ÿ¡
ÿ’ÿ¡
 
'das eigene RecStatus-Feld und den Dirty-Wert errechnen
ÿ¡WksStufe%ÿ0ÿp

jaRecField$ÿ"rec0"'Sonder-Behandlung fr die Null
ÿ^

jaRecField$ÿ"rec"ÿÿ(WksStufe%,"z")
ÿ’ÿ¡

'alles io
ÿwReadHieraEnde
 
ReadHieraErr: 
ÿƒFehler("Fehler bei šbertragung der Filial-Hierarchie:","Fehler "ÿÿ(ÿ&,"z")ÿ": "ÿÿ((ÿ&))

ReadHieraEnde:
Superbase.ErrorTrapLabelÿoldErrorLabel$
 ÿ’ÿÿ
 '*********************************************************************************************** 


ÿÿSimpleConnect(datei$)
'CALL Fehler("SimpleConnect: " + datei$,"")
ÿ³ÿ_ÿwConnectError
ÿ¡ÿ´(datei$)ÿpÿ†ÿ™datei$
ÿ×sbfile$,ip$,port$,updserver$
sbfile$ÿdatei$ÿ";paris"

ip$ÿ"130.50.0.254"
port$ÿ"1280"
udpserver$ÿip$ÿ":"ÿport$
Connections.Clear()
ÿ¡ÿOConnections.Exists("CODIE")ÿÿ1ÿp
Connections.Add("CODIE","ConnectionUDPClient").ServerName ÿudpserver$
Superbase.Connections.CODIE.Timeoutÿ8000
ÿ’ÿ¡

ÿ´ÿ™ÿà,1"CODIE:"ÿsbfile$
 
ÿwConnectEnde
 
ConnectError: 
ÿÂ"Fehler "ÿÿ(ÿ&,"z")ÿ": "ÿÿ((Superbase.LastError)
 
ConnectEnde: 
 
 ÿ’ÿÿ
 '***********************************************************************************************  
 
 
 
 
ÿÿIsOnline%(datei$)
 'Online-Test fr Dateien  
 ' Prft, ob Datei ber PPCS ge”ffnet wurde (Rckgabe -1) oder nicht (Rckgabe 0)
oldErrorLabel$ÿSuperbase.ErrorTrapLabel
ÿ³ÿ_ÿwIsOnlineError

ÿ´"status.txt"ÿ›ÿ¶
ÿ{ÿËÿ™datei$
ÿ†ÿ¶
 
ÿ´"status.txt"ÿ›ÿ¤
ÿ¤ÿca$
ÿ†ÿ¤

x$ÿ"CODIE:"
pos%ÿÿ?(a$,x$)
ÿ¡(pos%ÿ0)ÿp
IsOnline%ÿÿ1
ÿ^
IsOnline%ÿ0
ÿ’ÿ¡
 
'alles io
ÿwIsOnlineEnde
 
IsOnlineError: 
IsOnline%ÿ0
ÿwIsOnlineEnde
 
IsOnlineEnde: 
Superbase.ErrorTrapLabelÿoldErrorLabel$
 
 ÿ’ÿÿ
 '***********************************************************************************************  


ÿÿGetFileCode$(datei$)
 'liefert den Namen des Code-Feldes zurck
ÿÉÿ`ÿ™"AbgFiles"ÿ£FileName.AbgFiles
ÿÉÿ¥datei$ÿ™"AbgFiles"ÿ£FileName.AbgFiles
GetFileCode$ÿCodeField.AbgFiles
 
 ÿ’ÿÿ
 '***********************************************************************************************

 
ÿÿGetFileTyp$(datei$)
 'liefert den Abgleich-Typ der Datei zurck (I, "", C, Z, A, Y)
ÿÉÿ`ÿ™"AbgFiles"ÿ£FileName.AbgFiles
ÿÉÿ¥datei$ÿ™"AbgFiles"ÿ£FileName.AbgFiles
GetFileTyp$ÿTyp.AbgFiles
 ÿ’ÿÿ
 '***********************************************************************************************  


ÿÿGetFilePrefix$(datei$)
 'liefert den Namen des Prefix' fr die Send/Load-Dateien zurck
ÿÉÿ`ÿ™"AbgFiles"ÿ£FileName.AbgFiles
ÿÉÿ¥datei$ÿ™"AbgFiles"ÿ£FileName.AbgFiles
GetFilePrefix$ÿPrefix.AbgFiles
 ÿ’ÿÿ
 '*********************************************************************************************** 

ÿÿGetFileInfo(datei$)
 'setzt globale Variablen, auf die File-Infos
 'wenn keine Infos verfgbar (datei$ nicht in AbgFiles) ==> jaFileTyp$ = ""
datei$ÿÿ>(datei$)
jaFilePrefix$ÿ""
jaFileTyp$ÿ""
jaFileCode$ÿ""
jaTyp1To1%ÿ0
ÿ¡ÿOÿJ(datei$,FileName.AbgFiles)ÿp

ÿ’ÿÿ
ÿ’ÿ¡
ÿÉÿ`ÿ™"AbgFiles"ÿ£FileName.AbgFiles
ÿÉÿ¥datei$ÿ™"AbgFiles"ÿ£FileName.AbgFiles
jaFilePrefix$ÿPrefix.AbgFiles
jaFileTyp$ÿTyp.AbgFiles
jaFileCode$ÿCodeField.AbgFiles
jaTyp1To1%ÿ(Typ1To1.AbgFilesÿ"J")
 ÿ’ÿÿ
 '***********************************************************************************************  

 '--------------------------------------------------------------------
 '-------- Hierarchie - Routinen -------------------------------------
 '-------------------------------------------------------------------- 
 
ÿÿAddOffice%(nameneu$)
datei$ÿ"FILIALE"
'neues Bro unterhalb eines w„hlbaren Bros erzeugen
'liefert die neue Bro-Nummer zurck bzw. -1, wenn Fehler oder Abbruch
'und positioniert "filiale" auf den neuen Datensatz
'geht davon aus, daá Datei "Filiale" ge”ffnet ist
'Aufruf nur von Zentrale (Workstation% = 0)
'nimmt kein STORE vor
 
'mainwks% vom User erfragen
AddOffice%ÿÿ1
mainwks%ÿSelectOffice%("Neue Filiale erstellen","W„hlen Sie einen Vorg„nger fr die neue Filiale.",1,ÿ1)
ÿ¡mainwks%ÿÿ1ÿpÿ’ÿÿ'Cancel-Fall
ÿÉÿ`ÿ™"filiale"ÿ£Filialnr.Filiale
ÿÉÿ¥mainwks%ÿ™"filiale"ÿ£Filialnr.Filiale
ÿ¡ÿOÿC("filiale")ÿp

ÿƒFehler("Fehler: šbergeordnete Filiale nicht gefunden:",GetWksName$(mainwks%))

ÿ’ÿÿ
ÿ’ÿ¡

wks$ÿ"Filialnr.filiale"
vorg$ÿ"vorg„nger.filiale"
level$ÿ"Stufe.filiale"
name$ÿ"Name.filiale"
name2$ÿ"Nachname.filiale"
datei$ÿ"filiale"

wksneu%ÿÿI(datei$,1)
levelneu%ÿlevel$$ÿ1
 
'Filiale-Datensatz erzeugen
ÿÿ™datei$
wks$$ÿwksneu%
vorg$$ÿmainwks%
level$$ÿlevelneu%
name$$ÿnameneu$
name2$$ÿnameneu$
ÿÌÿ™datei$

AddOffice%ÿwksneu%'Rckgabe-Wert

 ÿ’ÿÿ
 '***********************************************************************************************
 
 
ÿÿReadHArray(datei$,z%)
 'liest das gesamte(!) Hierarchie-Array fr eine bestimmte _datei$ ein
 'z% gibt als call by reference die Anzahl zurck
 
datei$ÿÿ>(datei$)
ÿÉÿædatei$

ÿæ"FILIALE","LFILIALE"
vorgaenger$ÿ"Vorg„nger"
nachfolger$ÿ"FilialNr"
name$ÿ"Name"
ÿ’ÿæ
codefield$ÿnachfolger$ÿ"."ÿdatei$
vorgfield$ÿvorgaenger$ÿ"."ÿdatei$
namefield$ÿname$ÿ"."ÿdatei$

z%ÿ0
ÿÉÿ`ÿ™datei$ÿ£codefield$$
ÿØÿOÿB(datei$)


ÿ¡(vorgfield$$ÿ0)ÿ(codefield$$ÿ0)ÿp
ÿÿNachfolger%(z%)
ÿÿVorg„nger%(z%)
ÿÿOffNames$(z%)
ÿ¡codefield$$ÿ
1ÿp
Nachfolger%(z%)ÿ0
ÿ^
Nachfolger%(z%)ÿcodefield$$
ÿ’ÿ¡
ÿ¡vorgfield$$ÿ
1ÿp
Vorg„nger%(z%)ÿ0
ÿ^
Vorg„nger%(z%)ÿvorgfield$$
ÿ’ÿ¡
 
OffNames$(z%)ÿnamefield$$
z%ÿz%ÿ1

ÿ’ÿ¡


ÿÉÿ±ÿ™datei$ÿ£codefield$$
ÿÙ
ÿ½ CALL Fehler("ReadHiera 3","")
'? STR$ (z%) + " Eintr„ge insgesamt"

 ÿ’ÿÿ
 '***********************************************************************************************
 
 
ÿÿGetVisOff(startcode%)
 'Sichbare Bros ermitteln: fllt VisOff% und setzt VisCount%
 'VisCount% muá vorher auf 0 gesetzt werden  
 'nutzt golbale Variablen Vorg„nger%, Nachfolger%, OffCount%
 'Workstation% wird als startcode% bergeben
 'fgt das aktuelle Bro nicht mit ein !!!

pos%ÿ0
vorg%ÿstartcode%
x%ÿ0
z%ÿ0
zaehl%ÿ0
ÿ½ IF workstation% = 0 THEN VisCount% = 0
ÿ½ IF workstation% <> 0 THEN VisCount% = 0
ÿ½ CALL Fehler("VisNames$","")
ÿØpos%ÿ
OffCount%
'den n„chsten Nachfolger von startcode% (also vorg%) bestimmen
ÿ¡workstation%ÿ0ÿp

ÿ½ IF (Vorg„nger%(pos%) = vorg%) AND (Nachfolger%(pos%) <> Vorg„nger%(pos%)) THEN 
'also ein direkter/indirekter Nachfolger gefunden
VisCount%ÿVisCount%ÿ1
ÿÿVisOff%(VisCount%ÿ1)
ÿÿVisNames$(VisCount%ÿ1)
x%ÿNachfolger%(pos%)
ÿ½ 25102002 VisOff%(VisCount% - 1) = x%
VisOff%(VisCount%ÿ1)ÿx%
ÿ½ CALL Fehler("VisNames$","")
VisNames$(VisCount%ÿ1)ÿOffNames$(pos%)
ÿ½ z% = x%
ÿ½ VisCount% = VisCount% + 1
ÿ½ CALL GetVisOff(Nachfolger%(pos%))'Rekursion

ÿ½ END IF 
ÿ^

ÿ¡(Vorg„nger%(pos%)ÿvorg%)ÿ(Nachfolger%(pos%)ÿVorg„nger%(pos%))ÿp
'also ein direkter/indirekter Nachfolger gefunden
ÿ½ VisCount% = VisCount% + 1
ÿÿVisOff%(VisCount%)
ÿÿVisNames$(VisCount%)
x%ÿNachfolger%(pos%)
ÿ¡z%ÿx%ÿp
ÿ½ 25102002 VisOff%(VisCount% - 1) = x%
ÿ½ 14052003 VisOff%(VisCount% - 1) = x%
ÿ½ CALL Fehler("VisNames$","")
ÿ½ CALL Fehler(OffNames$(pos%),"")
 
VisNames$(VisCount%)ÿOffNames$(pos%)
VisOff%(VisCount%)ÿx%
z%ÿx%
VisCount%ÿVisCount%ÿ1
ÿ’ÿ¡
ÿƒGetVisOff(Nachfolger%(pos%))'Rekursion

ÿ’ÿ¡
ÿ’ÿ¡
pos%ÿpos%ÿ1
ÿÙ
 
 
 ÿ’ÿÿ
 '***********************************************************************************************
 

ÿÿPrintHierarchy(datei$,startcode%,lines$)
 'gibt die Hierarchie von _datei$ als Text-Report aus 
 
datei$ÿÿ>(datei$)
ÿÉÿædatei$
ÿæ"OFFICE"
vorgaenger$ÿ"Vorg„nger"
nachfolger$ÿ"Workstation"
info$ÿ"Name"
stufe$ÿ"Level"
ÿæ"FILIALE"
vorgaenger$ÿ"Vorg„nger"
nachfolger$ÿ"FilialNr"
info$ÿ"Name"
stufe$ÿ"Stufe"
 
ÿ’ÿæ
codefield$ÿnachfolger$ÿ"."ÿdatei$
vorgfield$ÿvorgaenger$ÿ"."ÿdatei$
infofield$ÿinfo$ÿ"."ÿdatei$
levelfield$ÿstufe$ÿ"."ÿdatei$
 
horz$ÿ"-"
vert$ÿ"|"
einstieg$ÿvert$ÿhorz$
code2%ÿstartcode%
 
 
'frs Baum-Zeichnen: die Anzahl der direkten Nachfolger bestimmen
pos%ÿ0
ÿ›pos%ÿ0ÿqOffCount%ÿ1
'den n„chsten Nachfolger von codema2% bestimmen
ÿ¡(Vorg„nger%(pos%)ÿcode2%)ÿp
maxNachfolger%ÿNachfolger%(pos%)
ÿ’ÿ¡
ÿ±pos%

'Ausgabe des (aktuellen) Vorg„ngers
ÿÉÿ`ÿ™datei$ÿ£codefield$$
ÿÉÿ¥code2%ÿ™datei$ÿ£codefield$$

ÿ{infofield$$ÿ" ("ÿÿ(levelfield$$,"000.")ÿ")"
tempstufe%ÿlevelfield$$
 
pos%ÿ0
ÿØpos%ÿ
OffCount%
'den n„chsten Nachfolger von codema2% bestimmen
ÿ¡(Vorg„nger%(pos%)ÿcode2%)ÿp
ÿ¡(Nachfolger%(pos%)ÿmaxNachfolger%)ÿp
sublines$ÿlines$ÿ"  "
ÿ^
sublines$ÿlines$ÿvert$ÿ" "
ÿ’ÿ¡
ÿ{lines$ÿeinstieg$;'die Einstiegs-Linie fr den Nachfolger   
ÿƒPrintHierarchy(datei$,Nachfolger%(pos%),sublines$)'Rekursion
ÿ’ÿ¡
 
pos%ÿpos%ÿ1
ÿÙ

ÿ¡tempstufe%ÿ2ÿpÿ{lines$'sieht besser aus
 
 ÿ’ÿÿ
 '***********************************************************************************************
 
 
ÿÿIsWksVisible%(wks%)
 'prft, ob die bergebene Workstation im Array der sichbaren Workstations enthalten ist    
'CALL Fehler( STR$ (wks%,"z"),"")
 
'CALL Fehler("","")
ÿ¡ShowOther%ÿÿ1ÿp
'nur ein bestimmtes Bro?
IsWksVisible%ÿ(wks%ÿShowOther%)
ÿ^IsWksVisible%ÿ0

ÿ¡Workstation%ÿ0ÿp'Fall Zentrale
IsWksVisible%ÿÿ1
ÿ’ÿÿ
ÿ’ÿ¡
 
ÿ›i%ÿ0ÿqVisCount%ÿ1' Fall externes Bro
ÿ¡VisOff%(i%)ÿwks%ÿp
'CALL Fehler( STR$ (wks%,"z"),"")
IsWksVisible%ÿÿ1
i%ÿVisCount%
ÿ’ÿ¡
ÿ±i%
ÿ’ÿ¡
 
 ÿ’ÿÿ
 '***********************************************************************************************
 

ÿÿGetWksName$(wks%)
 'liefert den Bro-Namen anhand der Bronummer
 GetWksName$ÿ"unbekannt"

ÿ›i%ÿ0ÿqOffCount%ÿ1
 
ÿ¡Nachfolger%(i%)ÿwks%ÿp
 
GetWksName$ÿOffNames$(i%)
i%ÿOffCount%
 
ÿ’ÿ¡
 
ÿ±i%
 
 ÿ’ÿÿ
'***********************************************************************************************
 
ÿÿGetWksVorg%(wks%)
 'liefert den Vorg„nger fr eine Bronummer
 GetWksVorg%ÿÿ1

ÿ›i%ÿ0ÿqOffCount%ÿ1
 
ÿ¡Nachfolger%(i%)ÿwks%ÿp
 
GetWksVorg%ÿVorg„nger%(i%)
i%ÿOffCount%
 
ÿ’ÿ¡
 
ÿ±i%
 
 ÿ’ÿÿ
 '***********************************************************************************************
 
ÿÿGetWksIndex%(wks%)
 'liefert den Index der Workstation aus dem Wks-Array (also aus Nachfolger%)
 GetWksIndex%ÿÿ1

ÿ›i%ÿ0ÿqOffCount%ÿ1
 
ÿ¡Nachfolger%(i%)ÿwks%ÿp
 
GetWksIndex%ÿi%
i%ÿOffCount%
 
ÿ’ÿ¡
 
ÿ±i%
 ÿ’ÿÿ
 '***********************************************************************************************


ÿÿGetVisWksIndex%(wks%)
 'liefert den Index der Workstation aus dem "sichtbar"-Array der (also aus VisOff%)
 GetWksIndex%ÿÿ1

ÿ›i%ÿ0ÿqVisCount%ÿ1
 
ÿ¡VisOff%(i%)ÿwks%ÿp
 
GetWksIndex%ÿi%
i%ÿOffCount%
 
ÿ’ÿ¡
 
ÿ±i%
 ÿ’ÿÿ
 '*********************************************************************************************** 

ÿÿSelectOffice%(action$,info$,buttons%,aktwks%)
 ÿ½ CALL Fehler("SelectOffice%","")
 'Tree-Auswahl eines Bros mit Hilfe von hiera.dll
 'txt-file mit Struktur der sichtbaren Bros erzeugen und 
 'hiera.dll::_SelectOffice aufrufen
 'txt-File: Zentrale ... Pfad zum aktuellen Bro ... untergeodnete Bros
 
 info$ÿÿåANSI(info$)
 action$ÿÿåansi(action$)

 ÿ¡ÿJ(_localpath$ÿ"hiera.txt")ÿp
ÿ(_localpath$ÿ"hiera.txt")
 ÿ’ÿ¡
 
 ÿ´_localpath$ÿ"hiera.txt"ÿ›ÿ¶
 'das h”chste Bro immer zuerst
ÿ{GetWksName$(0)
ÿ{"0"
ÿ{"0"
 
 'den Pfad vom aktuellen Bro bis zur Zenrale: 
 'suche solange den Vorg„nger, bis die 0 erreicht wird
 wks%ÿGetWksVorg%(Workstation%)
 ÿØwks%ÿ0
ÿ{GetWksName$(wks%)
ÿ{ÿ(wks%,"z")
wks%ÿGetWksVorg%(wks%)
ÿ¡wks%ÿ0ÿp
ÿ{"0"
ÿ^
ÿ{ÿ(wks%,"z")
ÿ’ÿ¡
 ÿÙ
 
 'die restlichen Nachfolger (sichtbare Bros) einschl. sich selbst
 ÿ›i%ÿ0ÿqVisCount%ÿ1
ÿ¡VisOff%(i%)ÿ0ÿp'Zentrale schon ausgegeben 

ÿ{ÿåansi(VisNames$(i%))

ÿ{ÿ(VisOff%(i%),"z")

wks%ÿGetWksVorg%(VisOff%(i%))

ÿ¡wks%ÿ0ÿp
ÿ{"0"

ÿ^
ÿ{ÿ(wks%,"z")

ÿ’ÿ¡
ÿ’ÿ¡
 ÿ±i%
 ÿ†ÿ¶
 
 SelectOffice%ÿÿƒ("_SelectOffice",_localpath$ÿ"hiera.txt",aktwks%,action$,info$,buttons%)
 
 ÿ_localpath$ÿ"hiera.txt"
 
 ÿ’ÿÿ
 '***********************************************************************************************


ÿÿPrintAbgFiles(txtfile$)
 'Ausgabe der Daten der Datei AbgFiles in eine Text-Datei
 
 ÿ´txtfile$ÿ›ÿ¶

ÿ{&10"FileName";
ÿ{&10"CodeFile";
ÿ{&8"Prefix";
ÿ{&5"Typ";
ÿ{&8"Dir";
ÿ{&8"Level";
ÿ{&12"CodeField";
ÿ{&5"1To1"
ÿ{"-----------------------------------------------------------------------"
 
 ÿ™"AbgFiles"
 ÿ£FileName
 ÿÉÿ`
 ÿØÿOÿB("AbgFiles")
ÿ¡Typ ÿ"I"ÿp
 
ÿ{&10FileName;
ÿ{&10ÿ(CodeFile,"z");
ÿ{&8Prefix;
ÿ{&5Typ;
ÿ{&8Dir;
ÿ{&8ÿ(Level,"z");
ÿ{&12CodeField;
ÿ{&5Typ1To1

ÿ’ÿ¡
ÿÉÿ±
 
 ÿÙ
 ÿ†ÿ¶
 
 
 ÿ’ÿÿ
 '***********************************************************************************************

 
ÿÿAbgPlausi(txtfile$)
 'Plausibilit„ts-Prfung fr AbgFiles und AbgDeps
 
 ÿ¡txtfile$ÿ""ÿp
ÿ´txtfile$ÿ›ÿ¶
 ÿ’ÿ¡
 
 path$ÿ"d:\dkm\muster\"
 
 '1. MainField.AbgDeps muá in entsprechendem MainFile.AbgFiles existieren
 'Vorgang: ber alle CodeFile's: FeldInfos holen und prfen, ob MainField enthalten ist 
 
 ÿ{"Phase 1 ----------------------"
 
 ÿ×FieldNames$(1000)

 ÿÉÿ`ÿ™"abgDeps"ÿ£CodeFile.AbgDeps
 filecode%ÿCodeFile.AbgDeps
 filename$ÿFileName.AbgDeps
 newfile%ÿÿ1
 fieldno%ÿ0
 ÿØÿOÿB("AbgDeps")
ÿ¡newfile%ÿÿ1ÿp
'Feld-Infos holen            
ÿÉÿ`ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿÉÿ¥CodeFile.AbgDepsÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿ¡ÿC("AbgFiles")ÿp

 
'REQUEST FileName.AbgDeps
ÿ¡ÿOÿ´(FileName.AbgDeps)ÿp
ÿ´ÿ™ÿà,1path$ÿDir.AbgFilesÿ"\"ÿFileName.AbgDepsÿ";paris"
ÿ’ÿ¡

'Feld-Infos holen
fieldno%ÿÿõ(FileName.AbgDeps,1)
ÿÿFieldNames$(fieldno%)
ÿÿFieldNames$,1

ÿ^
ÿÂ"Fehler in Planquadrat 42"
ÿ’ÿ¡
ÿ’ÿ¡
 
 
'existiert der FeldName?
fieldFound%ÿ0
ÿ›i%ÿ0ÿqfieldno%ÿ1
ÿ¡ÿ>(FieldNames$(i%))ÿÿ>(MainField.AbgDeps)ÿp
fieldFound%ÿÿ1
i%ÿfieldno%
ÿ’ÿ¡
ÿ±i%
ÿ¡fieldFound%ÿ0ÿp
'nicht plausi. !!!
ÿ{"AbgDeps: Feld "ÿMainField.AbgDepsÿ" ex. nicht in Datei "ÿFileName.AbgDeps
ÿ’ÿ¡
 
 
'ist das angegenene MainField tats„chlich das Code-Feld des MainFiles?
'... l„át sich nicht (eindeutig) testen
'... h”chstens indirekt, z.B. ber Feld-Format  
 
 
'Sprung auf n„chstes File ?
ÿÉÿ±ÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
ÿ¡filecode%ÿCodeFile.AbgDepsÿp
filecode%ÿCodeFile.AbgDeps
filename$ÿFileName.AbgDeps
newfile%ÿÿ1
ÿ^
'wenn immernoch die selbe CodeFile ==> auch der Dateinamen darf sich nich „ndern
'also Prfung, ob Zuordnung zwischen CodeFile.AbgDeps und FileName.AbgDeps 
'innerhalb der CodeDeps konstant ist - wird aber eigentlich in 2. erledigt
 
ÿ¡filename$ÿFileName.AbgDepsÿp
'nicht plausi. !!!
ÿÂ"gaga"
ÿ’ÿ¡

ÿ’ÿ¡
 ÿÙ
 ÿƒFehler("","")
 
 '2.Prfen,ob Zuordnung zwischen CodeFile.AbgFiles und FileName.AbgFiles bereinstimmt 
 ' mit a) Zuordnung zwischen CodeFile.AbgDeps und FileName.AbgDeps 
 ' bzw. b) MainCodeFile.AbgDeps und MainFile.AbgDeps 
 ' bei b) wird zus„tzlich geprft
 
 ÿ{" "
 ÿ{"Phase 2 ----------------------"
 
 ÿÍtest.AbgDepsÿ0
 ÿĞ
 ÿ’ÿÍ
 
 z%ÿ0'Anzahl korrekter Zuordnungen ... muá am Ende = Reccount("AbgDeps") sein
 ÿÉÿ`ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
 ÿØÿOÿB("AbgFiles")

a$ÿ"CodeFile = "ÿÿ(CodeFile.AbgFiles,"z")ÿ": "
 
' a)
ÿÉÿ`ÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
ÿÉÿ¥CodeFile.AbgFilesÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
ÿØÿOÿB("AbgDeps")ÿCodeFile.AbgDepsÿCodeFile.AbgFiles
ÿ¡ÿ>(FileName.AbgFiles)ÿÿ>(FileName.AbgDeps)ÿp
'nicht plausi. !!            
ÿ{a$ÿ"FileName.AbgFiles = "ÿFileName.AbgFilesÿ", FileName.AbgDeps = "ÿFileName.AbgDeps
ÿ’ÿ¡
ÿÉÿYÿáÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
test.AbgDepsÿtest.AbgDepsÿ1
ÿÌÿ™"AbgDeps"
ÿïÿYÿ™"AbgDeps"
 
ÿÉÿ±ÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
ÿÙ
 
' b)
ÿÉÿ`ÿ™"AbgDeps"ÿ£MainCodeFile.AbgDeps
ÿÉÿ¥CodeFile.AbgFilesÿ™"AbgDeps"ÿ£MainCodeFile.AbgDeps
ÿØÿOÿB("AbgDeps")ÿMainCodeFile.AbgDepsÿCodeFile.AbgFiles
ÿ¡ÿ>(FileName.AbgFiles)ÿÿ>(MainFile.AbgDeps)ÿp
'nicht plausi. !! 
ÿ{a$ÿ"FileName.AbgFiles = "ÿFileName.AbgFilesÿ", FileName.AbgDeps = "ÿFileName.AbgDeps
ÿ’ÿ¡
ÿÉÿYÿáÿ™"AbgDeps"ÿ£MainCodeFile.AbgDeps
test.AbgDepsÿtest.AbgDepsÿ1
ÿÌÿ™"AbgDeps"
ÿïÿYÿ™"AbgDeps"
 
ÿÉÿ±ÿ™"AbgDeps"ÿ£MainCodeFile.AbgDeps
ÿÙ


'Feld-Infos fr Zeit-Statistik-Felder holen            
'ON ERROR GOTO IgnoreFile
'IF NOT OPEN (FileName.AbgFiles) THEN 
'    OPEN FILE SHARE ,1path$ + Dir.AbgFiles + "\" + FileName.AbgFiles + ";paris"
'END IF 
'FILE FileName.AbgFiles'fr FIELDINFO n”tig 
'
'fieldno% = FILEINFO (FileName.AbgFiles,1)
'REDIM FieldNames$(fieldno%)
'FILLARRAY FieldNames$,1
'
'
''Feld-Infos fr Zeitstatistik ermitteln ---------------
'# Indizes
'indexno% = FILEINFO (FileName.AbgFiles,0)
''# der TXT - Felder mit L„nge > 1000
'txt1000% = 0
'FOR i% = 0 TO fieldno% - 1
'    IF FIELDINFO$ (FieldNames$(i%),0) = "TXT" THEN 
'
'        IF VAL ( FIELDINFO$ (FieldNames$(i%),4)) > 1000 THEN 
'           'CALL Fehler (FieldNames$(i%) + "." + FileName.AbgFiles,"")
'            txt1000% = txt1000% + 1
'        END IF 
'    END IF 
'NEXT i%
'
'SELECT CURRENT LOCK FILE "abgfiles" INDEX CodeFile.AbgFiles
'    a$ = FileName.AbgFiles
'    FieldCount.AbgFiles = fieldno%
'    IndexCount.AbgFiles = indexno%
'    TXT1000Count.AbgFiles = txt1000%
'    'CALL Fehler (FileName.AbgFiles,"")
'STORE FILE "abgfiles"
'UNLOCK CURRENT FILE "abgfiles" 
 'IgnoreFile: 
'ON ERROR 
''Ende:  Feld-Infos fr Zeitstatistik ermitteln --------------- 
 
ÿÉÿ±ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
 ÿÙ
 
 z%ÿ0
 ÿÉÿ`ÿ™"AbgDeps"ÿ£CodeDep.AbgDeps
 ÿØÿOÿB("AbgDeps")
ÿ¡test.AbgDepsÿ2ÿp
ÿ{"    Fehler in CodeDep = "ÿÿ(CodeDep.AbgDeps,"z")ÿ": "ÿÿ(test.AbgDepsÿ2,"z")
ÿ^
z%ÿz%ÿ1
ÿ’ÿ¡

ÿÉÿ±ÿ™"AbgDeps"ÿ£CodeDep.AbgDeps
 ÿÙ
 ÿƒFehler("Ende Phase 2","")
 
ÿ{"AbgDeps enthaelt "ÿÿ(ÿA("AbgDeps"),"z")ÿ" Master-Detail-Beziehungen, "ÿÿ(z%,"z")ÿ" davon sind ok."
 
 
 '3. šbergeordnete Files von Z und C und A mssen selbst Z oder C oder A sein
 
 ÿ{" "
 ÿ{"Phase 3 ----------------------"
 
 ÿÉÿ`ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
 ÿØÿOÿB("AbgFiles")
 
'--- Fieldcount fr Zeitmessung schreiben---
ÿ¡FileName.AbgFilesÿ"CONFIG"ÿp
'CALL Fehler(FileName.AbgFiles,"")
ÿ¡ÿOÿ´(FileName.AbgFiles)ÿp
ÿ´ÿ™ÿà,1path$ÿDir.AbgFilesÿ"\"ÿFileName.AbgFilesÿ";paris"
ÿ’ÿ¡
fieldno%ÿÿõ(FileName.AbgFiles,1)

ÿÉÿYÿáÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
FieldCount.AbgFilesÿfieldno%
ÿÌÿ™"AbgFiles"
ÿïÿYÿ™"AbgFiles"
 
ÿ¡ÿ´(FileName.AbgFiles)ÿpÿ†ÿ™FileName.AbgFiles
 
ÿ¡Typ.AbgFilesÿ"Z"ÿTyp.AbgFilesÿ"C"ÿTyp.AbgFilesÿ"A"ÿp
ÿ’ÿ¡
'--- Ende: Fieldcount fr Zeitmessung schreiben---

'die aktuelle Code merken
code%ÿCodeFile.AbgFiles
 
 
'fr Fehlerausgabe
filename$ÿFileName.AbgFiles
typ$ÿTyp.AbgFiles
ÿ{filename$ÿ": Typ = "ÿtyp$
'CALL Fehler(filename$,"")
'bergeordnete durchlaufen, falls C oder Z
ÿÉÿ`ÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
ÿÉÿ¥code%ÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
ÿØÿOÿB("AbgDeps")ÿCodeFile.AbgDepsÿcode%
ÿ{"    "ÿMainFile.AbgDepsÿ": Typ = ";
'CALL Fehler(MainFile.AbgDeps,"")
'zum bergeordneten File (in AbgFiles) springen und auf Z oder C oder A prfen
ÿÉÿ`ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿÉÿ¥MainCodeFile.AbgDepsÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿ¡ÿC("AbgFiles")ÿp
ÿ{Typ.AbgFiles
ÿ¡Typ.AbgFilesÿ"Z"ÿTyp.AbgFilesÿ"C"ÿTyp.AbgFilesÿ"A"ÿp
' nicht plausi. !!
a$ÿ"!!!! Datei "ÿfilename$ÿ" ist vom Typ "ÿtyp$
a$ÿa$ÿ" und hat uebergeordnete Datei "ÿFileName.AbgFilesÿ" vom Typ "ÿTyp.AbgFilesÿ" !!!!"
ÿ{a$
ÿ’ÿ¡
ÿ^

ÿ{" ... nicht gefunden"
ÿ’ÿ¡
ÿÉÿ±ÿ™"AbgDeps"ÿ£CodeFile.AbgDeps
ÿÙ
 
'und weiter bei code% 
ÿÉÿ`ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿÉÿ¥code%ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿ’ÿ¡
 
ÿÉÿ±ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
 
 ÿÙ

 ÿ¡txtfile$ÿ""ÿp
ÿ†ÿ¶
 ÿ’ÿ¡
 
 
 
 ÿ’ÿÿ
 '*********************************************************************************************** 


ÿÿCryptPwd(basepath$)
 
 'basepath$ ist (z.B.) der CODie-Pfad 
 ausgabe%ÿÿ1
 ÿ×dir$(10)
 dir$(0)ÿbasepath$
 dir$(1)ÿbasepath$ÿ"OFFICE"
 dir$(2)ÿbasepath$ÿ"PROVIS"
 dir$(3)ÿbasepath$ÿ"ABGLEICH\SEND"
 dir$(4)ÿbasepath$ÿ"ABGLEICH\LOAD"
 
 ÿ×files$(1000)
 ÿ¡ausgabe%ÿÿ1ÿpÿ‡
 
 
 dir%ÿ0
 'ber alle Verzeichnisse
 ÿØdir$(dir%)ÿ""
ÿ³ÿ_ÿwNextDirErr
ÿ¡ÿOÿJ(dir$(dir%))ÿp
ÿÂ"Verzeichnis "ÿdir$(dir%)ÿ" existiert nicht"
ÿwNextDir
ÿ’ÿ¡
ÿdir$(dir%)
ÿ¡ausgabe%ÿÿ1ÿpÿ{"----"ÿdir$(dir%)ÿ"---"
ÿÿfiles$(1000)'Array leeren
ÿÿfiles$,5,"*.SBf"
datei%ÿ0
'ber alle Dateien im aktuellen Verzeichnis
ÿØfiles$(datei%)ÿ""
ÿ³ÿ_ÿwNextFileErr
ÿ¡ÿOÿJ(files$(datei%))ÿp
ÿÂ"Datei "ÿfiles$(datei%)existiert nicht
ÿwNextFile
ÿ’ÿ¡
datei$ÿÿ,(files$(datei%),1,ÿ/(files$(datei%))ÿ4)'.sbf entfernen
ÿ¡ausgabe%ÿÿ1ÿpÿ{&11datei$;
'Datei auf einen anderen Namen reorganisieren
'sicherheitshalber vorher die Sperrdatei l”schen
ÿ¡ÿJ(datei$ÿ".sb!")ÿpÿdatei$ÿ".sb!"
ÿ´ÿ™datei$ÿ";paris"
ÿÀÿ™datei$ÿq"gaga.sbf"
ÿ´ÿ™"gaga;paris"
ÿ†ÿ™datei$
ÿdatei$ÿ".*"
 
ÿ‰ÿ™datei$ÿ";;;;paris"ÿaÿ™"gaga"
ÿ†ÿ™"gaga"
ÿ"gaga.*"
 
ÿ¡ausgabe%ÿÿ1ÿpÿ{"... Ok"
 
'alles io
ÿwNextFile
 
NextFileErr: 
ÿ¡ausgabe%ÿÿ1ÿpÿ{"FEHLER beim Reorganisieren von "ÿÿÿ"\"ÿdatei$
ÿ³ÿ_
NextFile:
 
datei%ÿdatei%ÿ1
 
ÿÙ
'alles io
ÿwNextDir
NextDirErr: 
ÿ³ÿ_
ÿÂ"Fehler beim Reorganisieren von "ÿÿÿ"\"ÿdatei$
NextDir: 
 
dir%ÿdir%ÿ1
 
 ÿÙ
 
 
 ÿ’ÿÿ
 '***********************************************************************************************  
 

ÿÿCreatePPCSFile(datei$,path$)
 'Fgt fr PPCS-Abgleich notwendige Felder hinzu
 '”ffnet kurzzeitig die crfilepp.sbr (nutzt FldAddUpd)

ÿƒServerDown()
ÿƒServerInit()
cfile$ÿÿ™
ÿ¡ÿ´(datei$)ÿpÿ†ÿ™datei$

ÿƒDFileUpd(2,path$ÿdatei$ÿ";paris")
 
ÿ™datei$

ÿƒFldAddUpd("Workstation","NUM;00000000.",1)
ÿƒFldAddUpd("CodeServer","NUM;00000000.",1)
ÿƒFldAddUpd("TState","TXT;1",1)
ÿƒFldAddUpd("Rec0","NUM;00000000.",1)
ÿƒFldAddUpd("Rec1","NUM;00000000.",1)
ÿƒFldAddUpd("Rec2","NUM;00000000.",1)
ÿƒFldAddUpd("Rec3","NUM;00000000.",1)
ÿƒFldAddUpd("Rec4","NUM;00000000.",1)
ÿƒFldAddUpd("Rec5","NUM;00000000.",1)
ÿƒFldAddUpd("Rec6","NUM;00000000.",1)
ÿƒFldAddUpd("Rec7","NUM;00000000.",1)
ÿƒFldAddUpd("Rec8","NUM;00000000.",1)
ÿƒFldAddUpd("Rec9","NUM;00000000.",1)
ÿƒFldAddUpd("Rec10","NUM;00000000.",1)
ÿƒFldAddUpd("Rec11","NUM;00000000.",1)
ÿƒFldAddUpd("Rec12","NUM;00000000.",1)
ÿƒFldAddUpd("Rec13","NUM;00000000.",1)
ÿƒFldAddUpd("Rec14","NUM;00000000.",1)
ÿƒFldAddUpd("Rec15","NUM;00000000.",1)
ÿƒFldAddUpd("Rec16","NUM;00000000.",1)
ÿƒFldAddUpd("Rec17","NUM;00000000.",1)
ÿƒFldAddUpd("Rec18","NUM;00000000.",1)
ÿƒFldAddUpd("Rec19","NUM;00000000.",1)
ÿÅÿ™ÿ™
 
ÿ™cfile$

 ÿ’ÿÿ
 '***********************************************************************************************

 
ÿÿDeleteWksData(wks%)
 'l”scht aus allen Dateien die Datens„tze mit Workstation.file = wks%
 
 tempdir$ÿÿ
 
 ÿ×sbf$(1000)
 ÿ‡
 ÿ×dirs$(10)
 dirs$(0)ÿ"d:\afm.her\provis"
 dirs$(1)ÿ"d:\afm.her\office"
 dirs$(2)ÿ"d:\afm.her"
 
 dir%ÿ0
 ÿØ(dirs$(dir%)ÿ"")

ÿdirs$(dir%)
i%%ÿ0
ÿÿsbf$(1000)
ÿÿsbf$,5,"*.SBf"
ÿØsbf$(i%%)ÿ""


ÿÊÿËsbf$(i%%)

ÿ³ÿ_ÿwError2

sbf$(i%%)ÿÿ,(sbf$(i%%),1,ÿ/(sbf$(i%%))ÿ4)

ÿ´ÿ™sbf$(i%%)ÿ";paris"
 

wksfield$ÿ"Workstation."ÿsbf$(i%%)

ÿ³ÿ_ÿwFieldError

ÿÉÿ`ÿ™sbf$(i%%)ÿ£wksfield$$

ÿÉÿ¥wks%ÿ™sbf$(i%%)ÿ£wksfield$$

ÿØÿOÿB(sbf$(i%%))ÿwksfield$$ÿwks%

ÿÉÿYÿáÿ™sbf$(i%%)
ÿÉÿ¾ÿ™sbf$(i%%)
 
'SELECT NEXT FILE sbf$(i%%) INDEX wksfield$$

ÿÙ
 

ÿ†ÿ™sbf$(i%%)

ÿwNext2
 
FieldError: 

'Feld Workstation wahrscheinlich nicht vorhanden ==> n„chste Datei

ÿwNext2
Error2: 
ÿÂ"Fehler bei Bearbeitung von Datei "ÿsbf$(i%%),"",2
ÿ³ÿ_
Next2: 
i%%ÿi%%ÿ1
 
ÿÙ

dir%ÿdir%ÿ1
 
 ÿÙ
 
 ÿ’ÿÿ
 '***********************************************************************************************  
 

ÿÿFilialeToCenter(BaseDir$,wks%,OCenterFiliale%)
 'wandelt ein Verzeichnis mit Filial-Daten in eine Zentrale um
 '
 'wenn wks% >= 0  ==> die Abgleichs-Daten (Typ A, Y - also Adressen, Telefon, ...) verbleiben 
 '                    und werden der Filiale wks% zugeordnet (Workstation=wks%)
 '                ==> Spezialfall:  wenn wks% = 0 und OCenterFiliale% = -1 wird die Filiale also komplett
 '                    in eine Zentrale umgewandelt
 '                    
 '  - OCenterFiliale% = -1 ==> AY-Daten werden nicht gel”scht ==> OnlineCenterFiliale wird erzeugt
 '    Problem: wie bekommt man die Mitarbeiter in die Zentrale?
 '
 'wenn wks% = -1  ==> es wird eine Zentrale erstellt mit zentralen Daten (GEADR, SPARTEN, ...)
 '                    die von der Filiale bernommen werden und also so behandelt werden, als w„hren sie
 '                    von zentralen Mitarbeitern erfaát worden
 '                    lokale Daten werden gel”scht
 '                    Abgleichs - Daten werden gel”scht
 '
 'OCenterFiliale% = 0 ==> AY-Daten werden gel”scht
 '                    
 'Z-Daten werden gel”scht, wenn OCenterFiliale% = -1 AND wks% > 0
 
 
 'Vorgang
 '  * alle Daten auf Workstation = 0 bringen; 
 '      wenn wks% gesetzt = = > Typ-A,Y-Dateien erhalten Workstation = wks%
 '  * Sonderbehandlung fr bestimmte Dateien im SELECT CASE - Block m”glich
 '  
 'Vor.: AbgFiles muá ge”ffnet sein
 '  
 '
 'Sinn machen folgende (wks%,OCenterFiliale%)-Paare:
 '  - (0,-1)    komplette Zentrale aus Filiale erstellen
 '  - (0, 0)    Zentrale Daten einer Filiale bernehmen
 '  - (>0, -1)  normale Filiale in OnlineCenter-Filiale umwandeln (Problem: CZ-Dateien)
 '  - (>0, 0)   eine leere Filiale aus einem Zentral-Pfad erzeugen
 '  - (-1, x)   nur bedingt sinnvoll ...

 ÿ•jaFileTyp$,jaFileCode$
 ÿÿjaFileTyp$,jaFileCode$

 ÿ¡ÿOÿ´("abgfiles")ÿpÿ´ÿ™BaseDir$ÿ"AbgFiles;paris"

 tempdir$ÿÿ
 
 ÿ×sbf$(1000)
 ÿ×dirs$(10)
 dirs$(0)ÿBaseDir$ÿ"provis\"
 dirs$(1)ÿBaseDir$ÿ"office\"
 dirs$(2)ÿBaseDir$

 
 dir%ÿ0
 ÿØ(dirs$(dir%)ÿ"")
ÿ³ÿ_ÿwFTCDirError
dir$ÿdirs$(dir%)
ÿdir$
i%%ÿ0
ÿÿsbf$(1000)
ÿÿsbf$,5,"*.SBf"
ÿØsbf$(i%%)ÿ""
ErrorNo%ÿ0
ÿ³ÿ_ÿwFTCFileError 
sbf$(i%%)ÿÿ,(sbf$(i%%),1,ÿ/(sbf$(i%%))ÿ4)
datei$ÿÿ>(sbf$(i%%))


ÿÉÿædatei$

ÿæ"ABGFILES"
'gar nix tun
datei$ÿ""'schlieáen verhindern

ÿæ"CONFIG","REDRU","STATIST","STATIST2","ABGDEPS"
'??

ÿæÿ^'Normalfall: AbgFiles nutzen
ÿ¡ÿ´(datei$)ÿpÿ†ÿ™datei$
ÿ´ÿ™dir$ÿdatei$ÿ";paris"

ÿƒGetFileInfo(datei$)
ÿ¡jaFileTyp$ÿ""ÿjaFileTyp$ÿ"I"ÿp
ÿ¡wks%ÿÿ1ÿp
ÿ¾ÿaÿ™datei$
ÿ^
'lokale Daten erzeugen
ErrorNo%ÿChangeWksData%(datei$,ÿ1,wks%)
ÿ¡ErrorNo%ÿÿ1ÿp
'Fehlerausgabe
ÿwFTCFileError
ÿ’ÿ¡
ÿ’ÿ¡
ÿ’ÿ¡

ÿ¡jaFileTyp$ÿ"A"ÿjaFileTyp$ÿ"Y"ÿjaFileTyp$ÿ"C"ÿp
'Daten der Filiale mit Workstation=wks%, die bereits in der Zentrale liegen 
ÿ¡OCenterFiliale%ÿ0ÿwks%ÿÿ1ÿp
ÿ¾ÿaÿ™datei$
ÿ^
ErrorNo%ÿChangeWksData%(datei$,ÿ1,wks%)
ÿ¡ErrorNo%ÿÿ1ÿp
'Fehlerausgabe
ÿwFTCNextError
ÿ’ÿ¡
ÿ’ÿ¡

ÿ’ÿ¡

ÿ¡jaFileTyp$ÿ"Z"ÿp
'Zentrale Daten erzeugen (Workstation = 0) oder l”schen
 
ÿ¡wks%ÿ0ÿOCenterFiliale%ÿ0ÿp
ÿ¾ÿaÿ™datei$
ÿ^
ErrorNo%ÿChangeWksData%(datei$,ÿ1,0)' Daten in Workstation = 0 umwandeln

ÿ¡ErrorNo%ÿÿ1ÿp
'Fehlerausgabe
ÿwFTCNextError
ÿ’ÿ¡
ÿ’ÿ¡
ÿ’ÿ¡

ÿÉÿædatei$
ÿæ"MAADR"
'Workstation von Mitarbeiter <ohne Zuordnung> auf 0 setzen
ÿ’ÿæ
ÿ’ÿæ
'alles io
ÿ{datei$ÿ": Ok"
ÿ¡ÿ´(datei$)ÿpÿ†ÿ™datei$
ÿwFTCNextFile
FTCFileError: 
ÿ{datei$ÿ": "ÿÿ((ÿ&)
ÿwFTCNextFile

FTCNextFile: 

ÿ³ÿ_ÿwFTCDirError
i%%ÿi%%ÿ1
ÿÙ

FTCDirError: 
ÿ{datei$ÿ": "ÿÿ((ÿ&)
ÿwFTCDirNext

FTCDirNext: 
ÿ³ÿ_
ÿ{"---- "ÿdir$ÿ" ---"
dir%ÿdir%ÿ1
 ÿÙ

 
 ÿ’ÿÿ
 '*********************************************************************************************** 
 
 
ÿÿCenterToFiliale(BaseDir$,wks%,CopyData%)

 'erzeugt aus einem Center-Pfad eine leere Online-Center-Filiale
 'šbergabe:
 '  - "CODie-Pfad" der Zentrale
 '  - Nummer der knftigen Workstation
 
 'Vorgang: 
 '  * in allen lokalen Dateien die Workstation setzen
 '  * die Load/Send-Dateien erzeugen
 '  * die Signatur in die INI-Datei schreiben  

ÿƒFilialeToCenter(BaseDir$,wks%,0)

ÿ¡ÿOÿJ(BaseDir$ÿ"Abgleich")ÿp
ÿªÿBaseDir$ÿ"Abgleich"
ÿ’ÿ¡
ÿ¡ÿOÿJ(BaseDir$ÿ"Abgleich\Load")ÿp
ÿªÿBaseDir$ÿ"Abgleich\Load"
ÿ’ÿ¡
ÿ¡ÿOÿJ(BaseDir$ÿ"Abgleich\Send")ÿp
ÿªÿBaseDir$ÿ"Abgleich\Send"
ÿ’ÿ¡
ÿ¡ÿOÿJ(BaseDir$ÿ"Abgleich\Log")ÿp
ÿªÿBaseDir$ÿ"Abgleich\Log"
ÿ’ÿ¡

ÿ•_localpath$
ÿÿ_localpath$
_localpath$ÿBaseDir$

ÿ¡ÿOÿ´("abgfiles")ÿpÿ´ÿ™BaseDir$ÿ"AbgFiles;paris"
ÿÉÿ`ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿØÿOÿB("AbgFiles")

ÿÉÿæÿ>(Typ.AbgFiles)
ÿæ"C","Z","A","Y"
ÿƒCreateLoadSend(FileName.AbgFiles,ÿ1)

ÿ’ÿÉ

ÿÉÿ±ÿ™"AbgFiles"ÿ£CodeFile.AbgFiles
ÿÙ

ÿ³ÿ_ÿwCTFRegisterOk
ÿîÿ…"WritePrivateProfileString"
CTFRegisterOk: 
ÿî"Kernel","WritePrivateProfileString","ICCCC"


ÿ³ÿ_ÿwCTFRegisterOk2
ÿîÿ…"_GetStringHash"
CTFRegisterOk2: 
ÿî"CODieLIB.dll","_GetStringHash","ICCF"

a%ÿÿƒ("WritePrivateProfileString","PROVIS","Workstation",ÿ(wks%,"z"),_localpath$ÿ"CODIEAPP.NET")
a%ÿÿƒ("_GetStringHash",ÿ(wks%,"z"),"paris",sig$)
a%ÿÿƒ("WritePrivateProfileString","PROVIS","WorkstationSig",sig$,_localpath$ÿ"CODIEAPP.NET")

 ÿ’ÿÿ
 '***********************************************************************************************

 
ÿÿChangeWksData%(datei$,oldwks%,newwks%)
 'wandelt alle Datens„tze mit Workstation = oldwks% in newwks% um
 '
 'wenn oldwks% = -1 ==> fr alle Datens„tze Workstation = newwks% setzen
 '           sonst  ==> nur Datens„tze mit Workstation = oldwks% in Workstation = newwks% umwandeln
 'Vor.: datei$ muá ge”ffnet sein 

 'Rckgabe von -1 wenn alles io, sonst ERRNO
 '
 'kann vielleicht sp„ter mal fr das Ver„ndern von Bro-Strukturen verwendet werden ?!
 
 ÿ³ÿ_ÿwCWDError
 ChangeWksData%ÿÿ1
 wksfield$ÿ"Workstation."ÿdatei$
 
 ÿ¡oldwks%ÿÿ1ÿp
 
ÿÍwksfield$$ÿnewwks%
ÿ’ÿÍ
 ÿ^
ÿÍwksfield$$ÿnewwks%ÿĞwksfield$$ÿoldwks%
ÿ’ÿÍ
 ÿ’ÿ¡
 'alles io
 ÿwCWDOk:

CWDError: 
ChangeWksData%ÿÿ&
CWDOk: 
 
 ÿ’ÿÿ
 '***********************************************************************************************  

 
 
ÿÿKonRepair(path$,mainFile$,mainField$,testFile$,testField$,testCode$)
 
'prft fr die aktuelle Datei, ob Werte in _testField$ existieren, die
'nicht in _mainFile$ im Feld _mainField$ existieren
'_testCode$ ist das Code-Feld der aktuellen Datei
'wenn gefunden: auf <ohne Zuordnung>-Datensatz im MainFile (ZweiMille%) verweisen
ÿ¡ÿOÿ´(mainFile$)ÿp

ÿ´ÿ™ÿà,1path$ÿmainFile$ÿ";paris"

hasOpen%ÿÿ1' ==> Datei am Ende wieder schlieáen
ÿ’ÿ¡
 
mainField$ÿmainField$ÿ"."ÿmainFile$

zeroCode%ÿÿ1

testCode$ÿtestCode$ÿ"."ÿtestFile$
testField$ÿtestField$ÿ"."ÿtestFile$
testFile$ÿÿ>(testFile$)
ÿÉÿ`ÿ™testFile$ÿ£testCode$$
ÿØÿOÿB(testFile$)

ÿ¡(testField$$ÿ
1)ÿ(ÿOÿJ(testField$$,mainField$$))ÿp
 
'IF jaDebug% = - 1 THEN CALL Fehler("Inkonsistenz (KonRepair)",testFile$)
 
ÿÉÿYÿáÿ™testFile$ÿ£testCode$$
testField$$ÿZweiMille%
ÿÌÿ™testFile$
ÿïÿYÿ™testFile$
 

ÿ’ÿ¡

ÿÉÿ±ÿ™testFile$ÿ£testCode$$
ÿÙ
ÿ¡hasOpen%ÿÿ1ÿp

ÿ†ÿ™mainFile$
ÿ’ÿ¡
'CALL Fehler("","")
 ÿ’ÿÿ
 '*************************************************************************
 
 
ÿÿKonDelete(path$,mainFile$,mainField$,testFile$,testField$,testCode$)
 
'prft fr die aktuelle Datei, ob Werte in _testField$ existieren, die
'nicht in _mainFile$ im Feld _mainField$ existieren
'_testCode$ ist das Code-Feld der aktuellen Datei
'wenn gefunden ==> rabiat l”schen

ÿ¡ÿOÿ´(mainFile$)ÿp

ÿ´ÿ™ÿà,1path$ÿmainFile$ÿ";paris"

hasOpen%ÿÿ1
ÿ’ÿ¡
mainField$ÿmainField$ÿ"."ÿmainFile$
testCode$ÿtestCode$ÿ"."ÿtestFile$
testField$ÿtestField$ÿ"."ÿtestFile$
 
ÿÉÿ`ÿ™testFile$ÿ£testCode$$
ÿØÿOÿB(testFile$)

ÿ¡ÿOÿJ(testField$$,mainField$$)ÿp
'IF jaDebug% = - 1 THEN CALL Fehler("Inkonsistenz (KonDelete)",testFile$)
ÿÉÿYÿáÿ™testFile$ÿ£testCode$$
ÿÉÿ¾ÿ™testFile$

ÿ^
ÿÉÿ±ÿ™testFile$ÿ£testCode$$

ÿ’ÿ¡
ÿÙ
ÿ¡hasOpen%ÿÿ1ÿp

ÿ†ÿ™mainFile$
ÿ’ÿ¡
 ÿ’ÿÿ
 '*************************************************************************
 
 
ÿÿKonKvertrag(basepath$)
'sucht nach Vertr„gen ohne Adresse und erzeugt diese gegebenenfalls aus
'den rudiment„ren Adreá-Angaben in der KVERTRAG.sbf
ÿ½ CALL Fehler("KonKvertrag","")
ÿ¡ÿOÿ´("ADRESSEN")ÿpÿ´ÿ™ÿà,1basepath$ÿ"\office\Adressen;paris"
zerocode%ÿÿ1
ÿÉÿ`ÿ™"kvertrag"ÿ£lfdnr.kvertrag
ÿØÿOÿB("kvertrag")

ÿ¡ÿOÿJ(CodeKu.Kvertrag,CodeKu.Adressen)ÿp
 
ÿ¡jaDebug%ÿÿ1ÿpÿƒFehler("Vertrag ohne Adresse","")
 
codekuneu$ÿSER1 ("codeku","adressen")
ÿÿ™"adressen"
CodeKu.Adressenÿcodekuneu$
CodeMa.AdressenÿZweiMille$
Workstation.AdressenÿWorkstation%
Nachname.AdressenÿANachname.Kvertrag
Vorname.AdressenÿAVorname.Kvertrag
AOrt.AdressenÿAOrt.Kvertrag
APLZ.AdressenÿAPLZ.Kvertrag
AStraáe.AdressenÿAStrasse.Kvertrag
ÿÌÿ™"adressen"
 
ÿÉÿYÿáÿ™"kvertrag"ÿ£lfdnr.kvertrag
CodeKu.Kvertragÿcodekuneu$
ÿÌÿ™"kvertrag"
ÿïÿYÿ™"kvertrag"

ÿ’ÿ¡

ÿÉÿ±ÿ™"kvertrag"ÿ£lfdnr.Kvertrag
ÿÙ
ÿ†ÿ™"adressen"
 ÿ’ÿÿ
 '*************************************************************************
 
 
ÿÿCreateLoadSend(sfile$,removeData%)
'Erzeugt die zu einer Datei geh”rigen Load- und Send-Dateien
'Informationen ber die Namen der Load/Send-Dateien werden aus AbgFiles.sbf
'entnommen    
'sfile$: Name der Quelldatei (ohne .sbf)
'removeData%: -1 ==> den Inhalt der Load/Send-Dateien l”schen ?
'Vor.: AbgFiles offen, _localpath$ definiert
 
ÿÉÿ`ÿ™"AbgFiles"ÿ£FileName.AbgFiles
ÿÉÿ¥sfile$ÿ™"AbgFiles"ÿ£FileName.AbgFiles
ÿ¡ÿOÿC("AbgFiles")ÿp
ÿ¡jaDebug%ÿÿ1ÿpÿƒFehler("Load/Send-Dateien konnten nicht erstellt werden:",sfile$)
ÿ’ÿÿ
ÿ’ÿ¡

loadfile$ÿPrefix.AbgFilesÿ"Load"
sendfile$ÿPrefix.AbgFilesÿ"Send"
typ$ÿTyp.AbgFiles
 
ÿ¡ÿ´(sendfile$)ÿp
ÿ†ÿ™sendfile$
ÿ’ÿ¡
ÿ¡ÿJ(_localpath$ÿ"ABGLEICH\Send\"ÿsendfile$ÿ".SBF")ÿp
ÿ_localpath$ÿ"ABGLEICH\Send\"ÿsendfile$ÿ".*"
ÿ’ÿ¡
 
ÿ¡ÿ´(loadfile$)ÿp
ÿ†ÿ™loadfile$
ÿ’ÿ¡
 
ÿ¡ÿJ(_localpath$ÿ"ABGLEICH\Load\"ÿloadfile$ÿ".SBF")ÿp
ÿ_localpath$ÿ"ABGLEICH\Load\"ÿloadfile$ÿ".*"
ÿ’ÿ¡
 
ÿ¡ÿOÿ´(sfile$)ÿp
ÿ´ÿ™_localpath$ÿDir.Abgfilesÿ"\"ÿsfile$ÿ";paris"
ÿ’ÿ¡

ÿÀÿ™sfile$ÿq_localpath$ÿ"ABGLEICH\Send\"ÿsendfile$ÿ".SBF"
ÿ¡removeData%ÿÿ1ÿp
ÿ¾ÿaÿ™sendfile$
ÿ’ÿ¡
ÿ†ÿ™sendfile$
ÿˆ_localpath$ÿ"ABGLEICH\Send\"ÿsendfile$ÿ".*"ÿq_localpath$ÿ"ABGLEICH\Load"
ÿ¡ÿJ(_localpath$ÿ"ABGLEICH\Load\"ÿsendfile$ÿ".sb!")ÿp
ÿ_localpath$ÿ"ABGLEICH\Load\"ÿsendfile$ÿ".sb!"
ÿ’ÿ¡
ÿ´ÿ™_localpath$ÿ"ABGLEICH\Load\"ÿsendfile$ÿ";paris"
ÿ¾ÿaÿ™sendfile$
ÿÀÿ™sendfile$ÿq_localpath$ÿ"ABGLEICH\Load\"ÿloadfile$ÿ".SBF"
ÿ†ÿ™loadfile$
ÿ¾ÿ™sendfile$
 
 ÿ’ÿÿ
 '*************************************************************************
 
 
ÿÿCrOhneZuord()
 'erzeugt <ohne Zuordnung>-Datens„tze mit code = ZweiMille%
 
path$ÿ_netpath$ÿ"PROVIS\"
 
ÿƒDFileUpd(2,path$ÿ"MAADR;paris")
ÿ¡ZweiMille%ÿ0ÿp

'PPCS-Version

ÿ¡ÿJ(0,CodeMa.Maadr)ÿp
 
'<ohne Zuordnung> ex. bereits ==> jetzt zentrale Code verpassen
ÿÉÿ`ÿ™"Maadr"ÿ£CodeMa
ÿÉÿ¥0ÿ™"Maadr"ÿ£CodeMa
ÿÉÿYÿáÿ™"Maadr"
CodeMa.MaadrÿZweiMille%
Workstation.Maadrÿ0
CodeServer ÿZweiMille%
ÿÌÿ™"Maadr"
ÿïÿYÿ™"Maadr"

ÿ’ÿ¡
 

ÿ¡ÿOÿJ(ZweiMille%,CodeMa.MAADR)ÿp
ÿÿ™"Maadr"
CodeMa.MaadrÿZweiMille%
Nachname.Maadrÿ"<ohne Zuordnung>"
CodeServer ÿZweiMille%
ÿÌÿ™"Maadr"

ÿ’ÿ¡
 
ÿ^

'Normale Programm-Version

ÿ¡ÿOÿJ(0,CodeMa.MAADR)ÿp
ÿÿ™"Maadr"
CodeMa.Maadrÿ0
Nachname.Maadrÿ"<ohne Zuordnung>"
CodeServer ÿ0
ÿÌÿ™"Maadr"

ÿ’ÿ¡
ÿ’ÿ¡

'CALL DFileUpd(2,path$ + "SPGRUPPE;paris") 
'u.s.w. ... SPGRUPPE, GEADR, SPARTEN, VPRODUKT, TARIF, AKTIONEN, SUPERVIS
 
 ÿ’ÿÿ
 '************************************************************************* 
 
 
ÿÿPPCSFldUpdate()
 'fgt PPCS-spezifische Felder zur aktuellen Datei hinzu
 'Vor.: Datei offen und auf FILE gesetzt
 
ÿ¡ZweiMille%ÿ0ÿpÿ’ÿÿ
 
typ$ÿGetFileTyp$(ÿ™)
ÿ¡typ$ÿ"Z"ÿtyp$ÿ"C"ÿtyp$ÿ"Y"ÿtyp$ÿ"D"ÿtyp$ÿ"A"ÿp
ÿ^

ÿ’ÿÿ'keine Datei, die in den Abgleich involviert ist 
ÿ’ÿ¡
 
ÿƒFldAddUpd("CodeServer","NUM;00000000.",1)
ÿƒFldAddUpd("TState","TXT;1",1)
ÿƒFldAddUpd("Rec0","NUM;00000000.",1)
ÿƒFldAddUpd("Rec1","NUM;00000000.",1)
ÿƒFldAddUpd("Rec2","NUM;00000000.",1)
ÿƒFldAddUpd("Rec3","NUM;00000000.",1)
ÿƒFldAddUpd("Rec4","NUM;00000000.",1)
ÿƒFldAddUpd("Rec5","NUM;00000000.",1)
ÿƒFldAddUpd("Rec6","NUM;00000000.",1)
ÿƒFldAddUpd("Rec7","NUM;00000000.",1)
ÿƒFldAddUpd("Rec8","NUM;00000000.",1)
ÿƒFldAddUpd("Rec9","NUM;00000000.",1)
ÿƒFldAddUpd("Rec10","NUM;00000000.",1)
ÿƒFldAddUpd("Rec11","NUM;00000000.",1)
ÿƒFldAddUpd("Rec12","NUM;00000000.",1)
ÿƒFldAddUpd("Rec13","NUM;00000000.",1)
ÿƒFldAddUpd("Rec14","NUM;00000000.",1)
ÿƒFldAddUpd("Rec15","NUM;00000000.",1)
ÿƒFldAddUpd("Rec16","NUM;00000000.",1)
ÿƒFldAddUpd("Rec17","NUM;00000000.",1)
ÿƒFldAddUpd("Rec18","NUM;00000000.",1)
ÿƒFldAddUpd("Rec19","NUM;00000000.",1)
 
'SAVE FILE FILE 
 
 ÿ’ÿÿ
 '************************************************************************* 
 
ÿÿPPCSUpdate()
 'Update, fr PPCS-Version
 'Voraussetzung: Datei offen und auf FILE gesetzt
cfile$ÿÿ™
'CALL Fehler("","")
ÿ¡ZweiMille%ÿ
0ÿp

ÿwPPCSUpdateEnd 
ÿ’ÿ¡
 
ÿƒGetFileInfo(ÿ™)

ÿ¡jaFileTyp$ÿ"Z"ÿjaFileTyp$ÿ"C"ÿjaFileTyp$ÿ"Y"ÿjaFileTyp$ÿ"D"ÿjaFileTyp$ÿ"A"ÿp

ÿ^

'keine Datei, die in den Abgleich involviert ist 

ÿwPPCSUpdateEnd
ÿ’ÿ¡
 
'sis:
ÿ¡jaFileCode$ÿ""ÿp

ÿÂ"Fehler: FileCode konnte nicht ermittelt werden",ÿ™

ÿwPPCSUpdateEnd

ÿ’ÿÿ
ÿ’ÿ¡
ÿÊÿË"PPCS - Felder hinzufgen"
ÿƒFldAddUpd("CodeServer","NUM;00000000.",1)
ÿƒFldAddUpd("TState","TXT;1",1)
ÿƒFldAddUpd("Rec0","NUM;00000000.",1)
ÿƒFldAddUpd("Rec1","NUM;00000000.",1)
ÿƒFldAddUpd("Rec2","NUM;00000000.",1)
ÿƒFldAddUpd("Rec3","NUM;00000000.",1)
ÿƒFldAddUpd("Rec4","NUM;00000000.",1)
ÿƒFldAddUpd("Rec5","NUM;00000000.",1)
ÿƒFldAddUpd("Rec6","NUM;00000000.",1)
ÿƒFldAddUpd("Rec7","NUM;00000000.",1)
ÿƒFldAddUpd("Rec8","NUM;00000000.",1)
ÿƒFldAddUpd("Rec9","NUM;00000000.",1)
ÿƒFldAddUpd("Rec10","NUM;00000000.",1)
ÿƒFldAddUpd("Rec11","NUM;00000000.",1)
ÿƒFldAddUpd("Rec12","NUM;00000000.",1)
ÿƒFldAddUpd("Rec13","NUM;00000000.",1)
ÿƒFldAddUpd("Rec14","NUM;00000000.",1)
ÿƒFldAddUpd("Rec15","NUM;00000000.",1)
ÿƒFldAddUpd("Rec16","NUM;00000000.",1)
ÿƒFldAddUpd("Rec17","NUM;00000000.",1)
ÿƒFldAddUpd("Rec18","NUM;00000000.",1)
ÿƒFldAddUpd("Rec19","NUM;00000000.",1)
 
ÿÊÿË"PPCS-Update"
ÿÍworkstation ÿWorkstation%

Rec0 ÿ10000000ÿWorkstation%

Rec1 ÿ10000000ÿWorkstation%

Rec2 ÿ10000000ÿWorkstation%

Rec3 ÿ10000000ÿWorkstation%

Rec4 ÿ10000000ÿWorkstation%

Rec5 ÿ10000000ÿWorkstation%

Rec6 ÿ10000000ÿWorkstation%

Rec7 ÿ10000000ÿWorkstation%

Rec8 ÿ10000000ÿWorkstation%

Rec9 ÿ10000000ÿWorkstation%

Rec10 ÿ10000000ÿWorkstation%

Rec11 ÿ10000000ÿWorkstation%

Rec12 ÿ10000000ÿWorkstation%

Rec13 ÿ10000000ÿWorkstation%

Rec14 ÿ10000000ÿWorkstation%

Rec15 ÿ10000000ÿWorkstation%

Rec16 ÿ10000000ÿWorkstation%

Rec17 ÿ10000000ÿWorkstation%

Rec18 ÿ10000000ÿWorkstation%

Rec19 ÿ10000000ÿWorkstation%
ÿ’ÿÍ

ÿÊÿË"Erzeugen Load/Send-Dateien"
ÿ¡jaFileTyp$ÿ"Y"ÿjaFileTyp$ÿ"A"ÿp
ÿƒCreateLoadSend(ÿ™)
ÿ’ÿ¡
 
PPCSUpdateEnd: 
ÿ™cfile$
ÿÅÿ™ÿ™
dir$ÿÿ
ÿ½ CALL Fehler(dir$ + "\" + FILE + ".sbf","Reorg")
ÿÀÿ™ÿ™ÿqdir$ÿ"\"ÿÿ™ÿ".sbf"
 ÿ’ÿÿ
 
 '*************************************************************************   
ÿÿCheckWksHash%()
 'Prft die Checksumme der Workstation
 'benutzt fr Filiale offline (in AbgleichInit())
 ' -1, wenn šbereinstimmung, sonst 0
 'Workstation muá bereits eingelesen Worden sein
 'berechneter hash-Wert wird in calcSig$ geschrieben
ÿ³ÿ_ÿwErrorHandler
CheckWksHash%ÿ0
sig$ÿReadConfig$("PROVIS","WorkstationSig")
magic$ÿ"paris"'oder was auch immer ...
a%ÿÿƒ("_GetStringHash",ÿ(Workstation%,"z"),magic$,calcSig$)
ÿ¡calcSig$ÿsig$ÿp
CheckWksHash%ÿÿ1
ÿ^
ÿ¡jaDebug%ÿÿ1ÿpÿƒFehler ("Ungliger Eintrag fr 'Workstation' in codieapp.net","")
ÿ’ÿ¡
 
 ÿ’ÿÿ

