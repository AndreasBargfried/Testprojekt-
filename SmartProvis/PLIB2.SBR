  CALL main()' plib2.sbr
 
 
 '      ************************************
 '      ** Routinen fÅr Formular KVERTRAG **
 '      ************************************
 ' 04.02.95  - Auswahlliste zur Fehlervermeidung entfernt
 '             - Test, ob Vertragsbearbeitung mîglich ist



 
 
 ' KVERTRAG Intro
 ' =======================================================================
 
SUB VERTRIntro(z%)
 
 CALL DFile(3,"VProdukt" + _fpw$)
 CALL DFile(3,"VPGEKOND" + _fpw$)
 FILE "KVERTRAG"
 IF cuvt% <> 0 THEN 
   SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   REM SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT KEY cuvt% FILE "KGEADR" INDEX codevt.KGeadr
 ELSE 
   SELECT FORM KEY knr% FILE "KVERTRAG" INDEX codeku.KVERTRAG
  REM 070796 IF CodeKU.KVERTRAG <> knr% THEN 
  IF NOT EXISTS (knr%,codeku.kvertrag) THEN 
     CALL VERTRNeu()
   ELSE 
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX codeku.KVERTRAG
   END IF 
 END IF 
 codege% = codege.kvertrag
 codeva% = codeva.kvertrag
 codevp% = codevp.kvertrag
 IF codevp% > 0 THEN 
   SELECT KEY codevp% FILE "Vprodukt" INDEX codevp.vprodukt
   IF kurzname.vprodukt <> "" THEN 
     vgessparte$ = Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt + " / " + kurzname.VPRODUKT
   ELSE 
     vgessparte$ = Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt
   END IF 
 ELSE 
   vgessparte$ = "Bitte wÑhlen Sie hier ein Produkt"
 END IF 
 eingbei$ = EingereichtBei.kvertrag
 IF eingbei$ = "" THEN 
   eingbei$ = "eingereicht Åber"
 END IF 
 IF MNdisabled%("SEEEINGBEI") THEN 
     eingbei$ = "wurde ausgeblendet"
     REM f.eingbei.enabled = 0
 END IF 
 IF statuskey.kvertrag > 0 THEN 
   SELECT FIRST FILE "statukey" INDEX statuskey.statukey
   SELECT KEY statuskey.kvertrag FILE "statukey" INDEX statuskey.statukey
   statukey$ = keyword.statukey
   REM CALL Fehler(statukey$, STR$ (statuskey.kvertrag,"000000"))
 END IF 
 IF EXISTS (lfdnr.kvertrag,codevt.kvfael) THEN 
   SELECT KEY lfdnr.kvertrag FILE "kvfael" INDEX codevt.kvfael
 ELSE 
   BLANK FILE "kvfael"
   codevt.kvfael = lfdnr.kvertrag
   IF EXISTS (codevp.kvertrag,codevp.vpgekond) THEN 
     SELECT KEY codevp.kvertrag FILE "VPGEKOND" INDEX codevp.vpgekond
     IF afsk.vpgekond = "j" THEN 
       erledigt.kvfael = "n"
     ELSE 
       erledigt.kvfael = "j"
     END IF 
   ELSE 
     erledigt.kvfael = "j"
   END IF 
   IF codew.kvertrag = 3 THEN EUUmstellung.kvfael = "j"
   STORE FILE "kvfael"
   UNLOCK CURRENT FILE "kvfael"
   SELECT KEY lfdnr.kvertrag FILE "kvfael" INDEX codevt.kvfael
 END IF 
 IF codema.kvertrag > 0 THEN 
   SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
   vagent$ = TRIM$ ( LTRIM$ (nachname.maadr)) + ", " + TRIM$ ( LTRIM$ (vorname.maadr)) + ", " + TRIM$ ( LTRIM$ (Agenturnr.maadr))
 ELSE 
   vagent$ = "WÑhlen Sie hier eine Agentur aus!"
 END IF 
 SET INDEX QuickKUGEs.KVERTRAG
 cuvt% = lfdnr.KVERTRAG
 INDEX QuickKUGEs.KVERTRAG
 IF UCASE$ ( FORM ) LIKE "VERTR018" AND z% = 1 THEN bges% = KFZ_VSBH.kvertrag + KFZ_VSBK.kvertrag + KFZ_VSBU.kvertrag
 IF z% = 1 THEN FORM 
 END SUB 
 
 
 ' KVERTRAG Maskenupdate
 ' =======================================================================
 
SUB VERTRUpdate()
 CALL DFile(2,"OFFICE\DOKKV" + _fpw$)
 IF EXISTS (lfdnr.kvertrag,codeku.dokkv) THEN 
   WinDok$ = "DokumentÆ"
 ELSE 
   WinDok$ = "Dokument"
 END IF 
 IF WinDok.kvertrag <> "" THEN 
   REM WinDok$ = "DokumentÆ"
 END IF 

 IF BezugsberPErl.kvertrag <> "" OR BezugsberTod.kvertrag <> "" OR GarAblLstgErl.kvertrag <> 0 OR GarAblLstgTod.kvertrag <> 0 THEN 
   ablaufl$ = "AblaufleistungÆ"
 ELSE 
   ablaufl$ = "Ablaufleistung"
 END IF 

 vstatus$ = VStatusTxT.kvertrag
 REM CALL Fehler(vstatus$,"")
 ON ERROR GOTO f110820096 
 IF StorWarnJN.kvertrag LIKE "j" THEN 
   stowarn$ = "Stornowarnung Æ"
   f.stornowarn.BackColor = 20
   f.stornowarn.ForeColor = 0
 ELSE 
   IF StorWarnDatGes.KVERTRAG > 0 THEN 
     stowarn$ = "Stornowarnung"
     f.stornowarn.BackColor = 75
     f.stornowarn.ForeColor = 1
   ELSE 
     stowarn$ = "Stornowarnung"
     f.stornowarn.BackColor = 253
     f.stornowarn.ForeColor = 1
   END IF 
 END IF 
f110820096: 
 ON ERROR GOTO ErrorHandler
 eingbei$ = EingereichtBei.kvertrag
 IF eingbei$ = "" THEN 
   eingbei$ = "eingereicht Åber"
 END IF 
 IF MNdisabled%("SEEEINGBEI") THEN 
     eingbei$ = "wurde ausgeblendet"
     f.eingbei.enabled = 0
 END IF 
 SELECT CASE CodevStatus.kvertrag
 CASE 1
     REM lebend
     f.vstatus.BackColor = 13
     f.vstatus.ForeColor = 0
 CASE 2
     REM lebend
     f.vstatus.BackColor = 13
     f.vstatus.ForeColor = 0
 CASE 3
     REM ruhend Anwartschaft
     f.vstatus.BackColor = 12
     f.vstatus.ForeColor = 0
 CASE 4
     REM storniert
     f.vstatus.BackColor = 20
     f.vstatus.ForeColor = 0
 CASE 5,6,7
     REM ruhend/beitragsfrei
     REM beitragsfrei
     REM beitragsfrei durch Leistung
     f.vstatus.BackColor = 18
     f.vstatus.ForeColor = 0
 CASE 8
     REM Beitragsstundung
     f.vstatus.BackColor = 20
     f.vstatus.ForeColor = 0
 CASE 9
     REM sonstiges
     f.vstatus.BackColor = 0
     f.vstatus.ForeColor = 1
 CASE 10
     REM Altvertrag
     f.vstatus.BackColor = 102
     f.vstatus.ForeColor = 0
 CASE 11
     REM Fremdvertrag
     f.vstatus.BackColor = 1
     f.vstatus.ForeColor = 0
 CASE 12
     REM Antrag
     f.vstatus.BackColor = 12
     f.vstatus.ForeColor = 0
 CASE 13
     REM storniert durch Dynamisierung
     f.vstatus.BackColor = 147
     f.vstatus.ForeColor = 1
 CASE 14
     REM Bestandteil eines BÅndelungsvertrages
     f.vstatus.BackColor = 5
     f.vstatus.ForeColor = 1
 CASE 15,16,20,21
     REM Waehrung$(15) = "Antragswiderruf" + SPACE$ (90) + "15"
     REM Waehrung$(16) = "Policenwiderspruch" + SPACE$ (90) + "16" 
     REM Waehrung$(17) = "Antragsablehnung" + SPACE$ (90) + "20"
     f.vstatus.BackColor = 20
     f.vstatus.ForeColor = 0
 END SELECT 
 SELECT KEY CodeMA.kvertrag FILE "maadr" INDEX CodeMA.maadr
 IF FOUND ("MAADR") THEN maadr$ = Nachname.maadr + ", " + LEFT$ (Vorname.MAADR,1) + "." ELSE maadr$ = "<keine Zuordnung>"
 agnr$ = LTRIM$ (agenturnr.maadr) + " " + Nachname.maadr + "," + Vorname.maadr
 SELECT KEY CodeVA.kvertrag FILE "sparten" INDEX CodeVA.sparten
 IF FOUND ("SPARTEN") THEN sparte$ = Sparte.sparten ELSE sparte$ = "<keine Zuordnung>"
 SELECT KEY CodeGE.kvertrag FILE "GEADR" INDEX CodeGE.geadr
 IF FOUND ("GEADR") THEN geadr$ = Gesellschaft.geadr ELSE geadr$ = "<keine Zuordnung>"
 IF ProviAb.KVERTRAG <> 0 OR Fremdvertrag.KVERTRAG LIKE "j" OR Altvertrag.KVERTRAG LIKE "j" THEN 
   provis$ = "S&tatus"
 ELSE 
   provis$ = "&Abrechnung"
 END IF 
 
 ON ERROR GOTO a1002052 
 IF Information.maadr LIKE "vertr*" THEN 
   f.comboagentur.Backcolor = 2
 END IF 
a1002052: 
 ON ERROR GOTO ErrorHandler 
 
 SELECT KEY CodeW.kvertrag FILE "waehrung" INDEX CodeW.waehrung
 IF CodeW.waehrung = CodeW.kvertrag THEN 
   waehr$ = "WÑhrung: " + waehrungbezeich.waehrung
 END IF 
 IF MAKLER$ = "TRUE" THEN 
   IF EXISTS (lfdnr.KVERTRAG,CodeVT.KUKto) THEN Kukto1$ = "Kontoinformation Æ" ELSE Kukto1$ = "Kontoinformation"
 END IF 
 IF EXISTS (lfdnr.kvertrag,codevt.kgeadr) THEN 
   beteil$ = "Beteiligungen Æ"
 ELSE 
   beteil$ = "Beteiligungen"
 END IF 
 IF GAFSK$ LIKE "TRUE" THEN 
   IF VAL ( RIGHT$ ( FORM ,2)) < 25 THEN 
     IF EXISTS (lfdnr.kvertrag,codevt.afsksut) THEN 
       sutor$ = "Sutor Æ"
     ELSE 
       sutor$ = "Sutor"
     END IF 
   ELSE 
     REM psp
     IF EXISTS (lfdnr.kvertrag,codevt.afspsp) THEN 
       sutor$ = "PSP Æ"
     ELSE 
       sutor$ = "PSP"
     END IF 
   END IF 
     IF EXISTS (lfdnr.kvertrag,codevt.afspfl) THEN 
       pflege$ = "Pflege Æ"
     ELSE 
       pflege$ = "Pflege"
     END IF 
 END IF 
 ON ERROR GOTO f110820097
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   IF EXISTS (lfdnr.kvertrag,codevt.zeingan1) THEN 
     VZeing$ = "ZE Æ"
   ELSE 
     VZeing$ = "ZE "
   END IF 
   IF GAFSK$ LIKE "TRUE" THEN 
   ELSE 
     IF ag$ <> "j" AND GLundWrigg$ <> "TRUE" THEN 
       IF sollst.kvertrag = "j" THEN 
         f.soll.BackColor = 2
       ELSE 
         f.soll.BackColor = 253
       END IF 
     END IF 
   END IF 
   IF EXISTS (lfdnr.kvertrag,codevt.zeinvor) THEN 
     VSoll$ = "SOLL Æ"
   ELSE 
     VSoll$ = "SOLL "
   END IF 
   IF EXISTS (lfdnr.kvertrag,codevt.buchung1) THEN 
     VBuch$ = "Buchungen Æ"
   ELSE 
     VBuch$ = "Buchungen"
   END IF 
 ELSE 
   IF EXISTS (lfdnr.kvertrag,codevt.zeingang) THEN 
     VZeing$ = "ZE Æ"
   ELSE 
     VZeing$ = "ZE "
   END IF 
   IF EXISTS (lfdnr.kvertrag,codevt.buchung) THEN 
     VBuch$ = "Buchungen Æ"
   ELSE 
     VBuch$ = "Buchungen"
   END IF 
 END IF 
 IF EXISTS (lfdnr.kvertrag,codevt.Spezkond) THEN 
   speziprov$ = "Spezialkonditionen Æ"
   IF SpezProvAktiv.kvertrag LIKE "j" THEN 
     f.speziprov.BackColor = 13
     f.speziprov.ForeColor = 0
   ELSE 
     f.speziprov.BackColor = 0
     f.speziprov.ForeColor = 1
   END IF 
 ELSE 
   speziprov$ = "Spezialkonditionen"
   f.speziprov.BackColor = 0
   f.speziprov.ForeColor = 1
 END IF 
 IF codetarif.kvertrag > 0 THEN 
   bertarif$ = Tariffo.kvertrag
 END IF 
f110820097: 
 ON ERROR GOTO ErrorHandler
 codevp% = codevp.kvertrag
 IF codevp% > 0 THEN 
   SELECT KEY codevp% FILE "Vprodukt" INDEX codevp.vprodukt
   IF kurzname.vprodukt <> "" THEN 
     vgessparte$ = Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt + " / " + kurzname.VPRODUKT
   ELSE 
     vgessparte$ = Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt
   END IF 
 ELSE 
   vgessparte$ = "Bitte wÑhlen Sie hier ein Produkt"
 END IF 
 IF codema.kvertrag > 0 THEN 
   SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
   vagent$ = TRIM$ ( LTRIM$ (nachname.maadr)) + ", " + TRIM$ ( LTRIM$ (vorname.maadr)) + ", " + TRIM$ ( LTRIM$ (Agenturnr.maadr))
 ELSE 
   vagent$ = "WÑhlen Sie hier eine Agentur aus!"
 END IF 
 IF EXISTS (lfdnr.KVERTRAG,CodeVT.VORGANG) THEN schaeden$ = "Nachbea&rb. Æ" ELSE schaeden$ = "Nachbea&rb."
 REM -- Status fÅr VORGANG.SBF in Statuszeile anzeigen --
 NBSumme% = 0
 NBunerledig% = 0
 cfile$ = FILE 
 FILE "VORGANG"
 INDEX CodeVT.VORGANG
 SELECT FIRST 
 SELECT KEY lfdnr.KVERTRAG FILE "VORGANG" INDEX CodeVT.VORGANG
 WHILE CodeVT.VORGANG = lfdnr.KVERTRAG AND NOT EOF ("VORGANG")
   NBSumme% = NBSumme% + 1
   IF erledigt.VORGANG <> "j" THEN NBunerledigt% = NBunerledigt% + 1
   SELECT NEXT FILE "VORGANG" INDEX CodeVT.VORGANG
 WEND 
 smsg$ = "VorgÑnge in Nachbearbeitung: " + LTRIM$ ( STR$ (NBSumme%,"999999"))
 IF NBunerledigt% <> 0 THEN 
   REM -- 13.05.96  NBSumme nach NBunerledigt geÑndert
   smsg$ = smsg$ + " (davon " + LTRIM$ ( STR$ (NBunerledigt%,"999999")) + " unerledigt)"
 END IF 
 REM SET STATUS smsg$ + "   Agentur:" + Agnr$ + "   Nettobeitrag: " + STR$ (nettobeitrag.kvertrag,",999999.00") + "    VST: " + STR$ (mwst.kvertrag,"999.00")
 sq$ = " Schad.quote: " + LTRIM$ ( STR$ (Schadquote.kvertrag,",9999.0000"))
 SET STATUS smsg$ + " Nettobeitrag: " + LTRIM$ ( STR$ (nettobeitrag.kvertrag,",9999999.00")) + "  VST: " + LTRIM$ ( STR$ (mwst.kvertrag,"999.00")) + "%  Einheiten: " + LTRIM$ ( STR$ (Einheiten.kvertrag,",999999999999.00")) + sq$
 FILE cfile$
 IF CodeKO.KVERTRAG <> 0 THEN 
   SET FORM ON kond$
 ELSE 
   ON ERROR GOTO f110820098
   SET FORM OFF kond$
f110820098: 
   ON ERROR GOTO ErrorHandler
 END IF 
 IF iim.stamm = "j" THEN 
     IF LTRIM$ (IIMLastdok.kvertrag) <> "" THEN 
       f.xmldok.BackColor = 27
       f.xmldok.ForeColor = 0
       f.xmldok.BorderColor = 2
     END IF 
 END IF 
 Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 Zahlart$ = Zahlart2Str$(Zahlart.KVERTRAG)
 IF NOT MNdisabled%("VERTRDEAKTIVIEREN") AND ProviAb.KVERTRAG > 0 THEN MENU 3,3,1 ELSE MENU 3,3,0
 IF NOT MNdisabled%("VERTRSTORNO") AND ProviAb.KVERTRAG > 0 THEN MENU 3,4,1 ELSE MENU 3,4,0
 FILE "KVERTRAG"
 cuvtold% = lfdnr.KVERTRAG
 SET INDEX QuickKUGEs.KVERTRAG
 INDEX QuickKUGEs.KVERTRAG
 cuvt% = lfdnr.KVERTRAG
 CALL VERTRSync()
 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
 REM SELECT FORM FIRST 
 SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 FORM 
 END SUB 
  
 
 
 
 
 'Zahlweise neu 05.01.2000
 
SUB KZW()
   cv% = lfdnr.kvertrag
 IF disabled%("VERTRBEARB") THEN END SUB 
   IF ag$ = "j" THEN 
     CALL Fehler("Diese Funktion ist in SmartPROVIS Agentur gesperrt!","")
     END SUB 
   END IF 
   REQUEST "Wollen Sie die Zahlweise wirklich Ñndern?","",130,req%
   IF req% <> 1 THEN END SUB 
 FILE "KVERTRAG"
 cvt% = lfdnr.KVERTRAG
 IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
 SELECT KEY cvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 
   DIM Waehrung$(5)
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
     DIM Auswahl1$(1)
     Waehrung$(0) = "einmalig" + SPACE$ (100) + "00"
     Waehrung$(1) = "jÑhrlich" + SPACE$ (100) + "01"
     Waehrung$(2) = "halbjÑhrlich" + SPACE$ (100) + "02"
     Waehrung$(3) = "vierteljÑhrlich" + SPACE$ (100) + "04"
     Waehrung$(4) = "2monatlich" + SPACE$ (100) + "06"
     Waehrung$(5) = "monatlich" + SPACE$ (100) + "12"
     FILE "kvertrag"
     CREATE DIALOG "PREISLIS",0,0,120,110,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,119,103,0," Auswahl Zahlweise"
      ADD DIALOG "PREISLIS",7,5,14,110,65,0,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,4,80,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,59,80,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        zw.kvertrag = VAL ( RIGHT$ (Auswahl1$(0),2))
        CALL MATimeStamp("KVERTRAG")
        CALL FStore("kvertrag")
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
      END IF 
 
 MOUSE ON 
 FORM 
 
 END SUB 
 
SUB KZWAut()
   cv% = lfdnr.kvertrag
 IF disabled%("VERTRBEARB") THEN END SUB 
   IF ag$ = "j" THEN 
     CALL Fehler("Diese Funktion ist in SmartPROVIS Agentur gesperrt!","")
     END SUB 
   END IF 
   REM REQUEST "Wollen Sie die Zahlweise wirklich Ñndern?","",130,req%
   req% = 1
   IF req% <> 1 THEN END SUB 
 FILE "KVERTRAG"
 cvt% = lfdnr.KVERTRAG
 IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
 SELECT KEY cvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 
   DIM Waehrung$(5)
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
     DIM Auswahl1$(1)
     Waehrung$(0) = "einmalig" + SPACE$ (100) + "00"
     Waehrung$(1) = "jÑhrlich" + SPACE$ (100) + "01"
     Waehrung$(2) = "halbjÑhrlich" + SPACE$ (100) + "02"
     Waehrung$(3) = "vierteljÑhrlich" + SPACE$ (100) + "04"
     Waehrung$(4) = "2monatlich" + SPACE$ (100) + "06"
     Waehrung$(5) = "monatlich" + SPACE$ (100) + "12"
     FILE "kvertrag"
     CREATE DIALOG "PREISLIS",0,0,120,110,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,119,103,0," Auswahl Zahlweise"
      ADD DIALOG "PREISLIS",7,5,14,110,65,0,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,4,80,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,59,80,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        zw.kvertrag = VAL ( RIGHT$ (Auswahl1$(0),2))
        CALL FStore("kvertrag")
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
      END IF 
 
 MOUSE ON 
 FORM 
 
 END SUB 
 
 
 
 
 'Zahlweise neu 05.01.2000
 
SUB KZA()
   cv% = lfdnr.kvertrag
   REM ZA% = 1,"Bankeinzug", IF (ZA% = 2,"öberweisung", IF (ZA% = 3,"Dauerauftrag", IF (ZA% = 4,"Scheck","<keine Zuordnung>"
 IF disabled%("VERTRBEARB") THEN END SUB 
   IF ag$ = "j" THEN 
     CALL Fehler("Diese Funktion ist in SmartPROVIS Agentur gesperrt!","")
     END SUB 
   END IF 
   REQUEST "Wollen Sie die Zahlart wirklich Ñndern?","",130,req%
   IF req% <> 1 THEN END SUB 
 FILE "KVERTRAG"
 cvt% = lfdnr.KVERTRAG
 IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
 SELECT KEY cvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 
   DIM Waehrung$(5)
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
     DIM Auswahl1$(1)
     Waehrung$(0) = "<keine Zuordnung>" + SPACE$ (100) + "00"
     Waehrung$(1) = "Bankeinzug" + SPACE$ (100) + "01"
     Waehrung$(2) = "öberweisung" + SPACE$ (100) + "02"
     Waehrung$(3) = "Dauerauftrag" + SPACE$ (100) + "03"
     Waehrung$(4) = "Scheck" + SPACE$ (100) + "04"
     FILE "kvertrag"
     CREATE DIALOG "PREISLIS",0,0,120,110,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,119,103,0," Auswahl Zahlart"
      ADD DIALOG "PREISLIS",7,5,14,110,65,2,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,4,80,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,59,80,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        zahlart.kvertrag = VAL ( RIGHT$ (Auswahl1$(0),2))
        CALL MATimeStamp("KVERTRAG")
        CALL FStore("kvertrag")
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
      END IF 
 
 MOUSE ON 
 FORM 
 
 END SUB 
 
 
 
 
 
  
  
 
SUB VERTRKopieren()
 IF disabled%("VERTRNeu") THEN END SUB 
 FILE "KVERTRAG"
 REQUEST "Wollen Sie den Vertrag duplizieren?","",130,req%
 IF req% <> 1 THEN END SUB 
 lfdnrold% = lfdnr.KVERTRAG
 lfdnrab% = lfdnrold%
 BLANK DUPLICATE 
 lfdnr% = SER ("KVERTRAG",1)
 lfdnr.KVERTRAG = lfdnr%
 VS_NR.KVERTRAG = VS_NR.KVERTRAG + "*"
 REM 140596
 proviab.kvertrag = 0
 REM 060597
 VertragAktiv.kvertrag = "n":
 BewertcalcDat = 0:letzteProvi = 0:gez_Abschlu·.KVERTRAG = "":gez_Pauschale.KVERTRAG = ""
 TZRate.KVERTRAG = 0:letztePflege.KVERTRAG = 0:Pool.KVERTRAG = 0:Mahnung.KVERTRAG = "n"
 letzteBearb.KVERTRAG = TODAY 
   KÅndigung.kvertrag = 0
   Fremdvertrag.kvertrag = "n"
   Altvertrag.kvertrag = "n"
   storno.kvertrag = 0
   DynJN.kvertrag = "N"
   VStatusTXT.kvertrag = "Antrag"
   codevstatus.kvertrag = 12
   REM 210597
   TatsKuenDat.kvertrag = 0
   REM 140497
   letzteProvi = 0:gez_Abschlu·.KVERTRAG = "":gez_Pauschale.KVERTRAG = ""
   TZRate.KVERTRAG = 0:letztePflege.KVERTRAG = 0:Pool.KVERTRAG = 0:Mahnung.KVERTRAG = "n"
   REM 030697
   codeko.kvertrag = 0
 CALL FStore("KVERTRAG")
   IF EXISTS (lfdnr%,codevt.KVFAEL) THEN 
     SELECT FIRST FILE "KVFAEL" INDEX codevt.kvfael
     SELECT KEY lfdnr% LOCK FILE "KVFAEL" INDEX codevt.kvfael
     BewertcalcDat.kvfael = 0:letzteProvi.KVFAEL = 0:gez_Abschlu·.KVFAEL = "":gez_Pauschale.KVFAEL = ""
     TZRate.KVFAEL = 0:letztePflege.KVFAEL = 0:Pool.KVFAEL = 0:Mahnung.KVFAEL = "n"
     STORE FILE "KVFAEL"
     UNLOCK CURRENT FILE "KVFAEL"
   END IF 
 IF EXISTS (lfdnrold%,CodeVT.spezkond) THEN 
   REQUEST "Wollen Sie die Spezialkonditionen","ebenfalls kopieren?",130,req%
   IF req% = 1 THEN 
     DIM test%(300)
     FILE "spezkond"
     INDEX codevt.spezkond
     SELECT FIRST 
     SELECT KEY lfdnrold% FILE "spezkond" INDEX codevt.spezkond
     i% = 0
     WHILE NOT EOF ("spezkond") AND codevt.spezkond = lfdnrold%
       IF codevt.spezkond = lfdnrold% THEN 
         test%(i%) = codekey.spezkond
         i% = i% + 1
       END IF 
       SELECT NEXT FILE "spezkond" INDEX codevt.spezkond
     WEND 
     FILE "spezkond"
     INDEX codekey.spezkond
     FOR a% = 0 TO i% - 1
       SELECT FIRST FILE "spezkond" INDEX codekey.spezkond
       SELECT KEY test%(a%) FILE "spezkond" INDEX codekey.spezkond
       BLANK DUPLICATE 
       codekey.spezkond = SER ("spezkond",1)
       codevt.spezkond = lfdnr%
       QCodeVTMA.spezkond = STR$ (codevt.spezkond,"000000") + STR$ (codema.spezkond,"000000")
       QCodeGEVAMA.spezkond = STR$ (codege.spezkond,"000000") + STR$ (codeva.spezkond,"000000") + STR$ (codema.spezkond,"000000")
       STORE FILE "spezkond"
     NEXT a%
   END IF 
 END IF 
 REM Fonds bei Standardabrechnung Åbertragen
 IF EXISTS (lfdnrab%,codevt.fonds) THEN 
   REQUEST "Wollen Sie die Fondsbewegungen","ebenfalls kopieren?",130,req%
   IF req% = 1 THEN 
     FILE "Fonds"
     INDEX codevt.fonds
     SELECT FIRST 
     SELECT KEY lfdnrab% FILE "Fonds" INDEX codevt.fonds
     codefo% = 0
     DIM fondarr%(10000)
     i% = 0
     WHILE NOT EOF ("Fonds") AND codevt.fonds = lfdnrab%
       IF codevt.fonds = lfdnrab% THEN 
         fondarr%(i%) = codefo.fonds
         i% = i% + 1
       END IF 
       SELECT NEXT FILE "fonds" INDEX codevt.fonds
     WEND 
     REM CALL Fehler("Fonds kopieren","")
     FILE "fonds"
     INDEX codefo.fonds
     SELECT FIRST 
     FOR j% = 0 TO i% - 1
       SET STATUS "Fondszahlungen kopieren " + STR$ (j%,"999999")
       SELECT FIRST 
       SELECT KEY fondarr%(j%) FILE "Fonds" INDEX codefo.fonds
       BLANK DUPLICATE 
       codefo.fonds = SER ("Fonds",1)
       codevt.fonds = lfdnr%
       codeaz.fonds = 0
       STORE FILE "Fonds"
     NEXT j%
   END IF 
 END IF 
 IF EXISTS (lfdnrold%,codevt.vorgang) THEN 
   REQUEST "Sollen dem duplizierten Vertrag die VorgÑnge","des Urvertrages zugewiesen werden?",130,req%
   IF req% = 1 THEN 
     REQUEST "Es werden jetzt alle Nachbearbeitungen/Schadensmeldungen","dem neuen Vertrag zugewiesen!"
     UPDATE codevt.vorgang = lfdnr% WHERE codevt.vorgang = lfdnrold%
     END UPDATE 
     CLOSE FILE "vorgang"
     CALL DFile(3,"vorgang" + _fpw$)
   END IF 
 END IF 
 IF EXISTS (lfdnrold%,codeku.dokkv) THEN 
   REQUEST "Sollen dem duplizierten Vertrag die Dokumente","des Urvertrages zugewiesen werden?",130,req%
   IF req% = 1 THEN 
     REQUEST "Es werden jetzt alle Vertragsdokumente","dem neuen Vertrag zugewiesen!"
     UPDATE codeku.dokkv = lfdnr% WHERE codeku.dokkv = lfdnrold%
     END UPDATE 
     CLOSE FILE "dokkv"
     CALL DFile(2,"OFFICE\" + "dokkv" + _fpw$)
   END IF 
 END IF 
 SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 REM 140596 
 CALL VERTRUpdate()
 SET INDEX CodeKU.KVERTRAG
 INDEX codeku.kvertrag
 SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 FORM 
 MOUSE ON 
 MENU OFF 
 ENTER VS_NR.KVERTRAG,0
 MENU ON 
 END SUB 
 
 
 
SUB VERTRSichern()
 REM ********** ToDo: Sperrung im Netzwerk testen
 CALL DFile(3,"VProdukt" + _fpw$)
 IF NOT MOD ("KVERTRAG") AND NOT NEW ("KVERTRAG") THEN 
   tvn% = lfdnr.KVERTRAG
   SELECT KEY tvn% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT KEY codeku.kvertrag FILE GAdrDat$ INDEX codeku.GAdrDat$
   ANachname.kvertrag = nachname.GAdrDat$
   AVorname.kvertrag = vorname.GAdrDat$
   AStrasse.kvertrag = Stra·e.GAdrDat$
   AOrt.kvertrag = Ort.GAdrDat$
   APLZ.kvertrag = Plz.GAdrDat$
   letzteBearb.KVERTRAG = TODAY 
   REM 030697
   IF zw.kvertrag = 55 THEN 
     IF fremdvertrag.kvertrag <> "j" AND altvertrag.kvertrag <> "j" THEN 
       CALL Fehler("Sie mÅssen erst die Zahlweise angeben, bevor Sie den Antrag abschlie·en kînnen!","")
     END IF 
   END IF 
 END IF 
 
       IF ProviAb.kvertrag > 0 AND ProviAb.kvertrag <= TODAY THEN 
         IF KÅndigung.kvertrag > 0 THEN 
           IF KÅndigung.kvertrag >= TODAY THEN 
             VertragAktiv.kvertrag = "j"
           ELSE 
             VertragAktiv.kvertrag = "n"
           END IF 
         ELSE 
           VertragAktiv.kvertrag = "j"
         END IF 
       ELSE 
         VertragAktiv.kvertrag = "n"
       END IF 
       IF TatsKuenDat.kvertrag > 0 THEN 
         IF TatsKuenDat.kvertrag >= TODAY THEN 
           VertragAktiv.kvertrag = "j"
         ELSE 
           VertragAktiv.kvertrag = "n"
         END IF 
       END IF 
 IF DBeitrZahlung.kvertrag = 0 THEN DBeitrZahlung.kvertrag = VS_Dauer.kvertrag
 REM ***********************************************************
 REM *               Feldberechnungen                          *
 REM ***********************************************************
 NUMBASE "999999999.0000"
 IF codege.kvertrag > 0 AND codeva.kvertrag > 0 THEN 
   CALL FeldBerKV()
   ein% = einheiten.kvertrag
 END IF 
 CALL MATimeStamp("KVERTRAG")
 CALL QuickStore("KVERTRAG")
 IF GProvSperreJN$ <> ProvSperreJN.kvertrag AND GProvSperreJN$ = "j" AND ProvSperreJN.kvertrag = "n" THEN 
   IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
     CALL DFile(3,"zeingan1" + _fpw$)
     codevt% = lfdnr.kvertrag
     cfile$ = FILE 
     IF EXISTS (codevt%,codevt.zeingan1) THEN 
       REM 19.04.2005 wenn Provisionssperre aufgehoben, dann Datum der nicht verarbeiteten ZE auf >=TODAY, jedenfalls auf akt.Monat
       FILE "zeingan1"
       INDEX codevt.zeingan1
       SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
       SELECT KEY codevt% LOCK FILE "zeingan1" INDEX codevt.zeingan1
       fe% = 0
       WHILE NOT EOF ("zeingan1") AND codevt.zeingan1 = codevt%
         IF gebuchtJN.zeingan1 <> "J" THEN 
           fe% = 1
           SELECT LAST FILE "zeingan1"
         END IF 
         SELECT NEXT FILE "zeingan1"
       WEND 
       IF fe% = 1 THEN 
         FILE "zeingan1"
         INDEX codevt.zeingan1
         SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
         SELECT KEY codevt% LOCK FILE "zeingan1" INDEX codevt.zeingan1
         codevt% = lfdnr.kvertrag
         GVertrID% = lfdnr.kvertrag
         Date1$ = DATE$ ( TODAY ,"0d.mm.yyyy")
  aa12$ = " damit die verhinderten Zahlungen durch die Provisionsperre, jetzt verarbeitet werden kînnen" + " Hierbei ist es jetzt notwendig bei den ZE das Datum neu zu setzen,damit die Provisionen beim aktuellen Monat auf der Provisionsliste erscheinen!"
       CALL Fehler("Sie erhalten jetzt die Mîglichkeit, bei allen noch nicht gebuchten ZE mit Buchungsdatum < Heute dieses Vertrages das Buchungsdatum zu setzen.","Dies ist notwendig, " + aa12$)
a190420051: 
         CREATE DIALOG "ANSCHLUSS",0,0,191,92,"ZE Datum","MS Sans Serif",8
         ADD DIALOG "ANSCHLUSS",4,0,0,191,68,0,""
         ADD DIALOG "ANSCHLUSS",9,9,12,21,23,2
         ADD DIALOG "ANSCHLUSS",5,38,12,144,20,0,"Bitte geben Sie ein, auf welches Datum die ZE gesetzt werden sollen:"
         ADD DIALOG "ANSCHLUSS",5,38,42,33,10,0,"Datum:"
         ADD DIALOG "ANSCHLUSS",6,73,41,51,11,0,0,Date1$,10
         ADD DIALOG "ANSCHLUSS",1,98,72,55,14,1,"&Abbruch",0,0
         ADD DIALOG "ANSCHLUSS",1,38,72,55,14,1,"&OK",1,1
         DIALOG "ANSCHLUSS",req%
         REMOVE DIALOG "ANSCHLUSS"
         IF req% = 1 THEN 
 REM ***************************************************************************************************
           IF DateOK%(Date1$) THEN 
             Date1% = DAYS (Date1$)
           ELSE 
             CALL Fehler("Datum ist fehlerhaft!","")
             GOTO a190420051
           END IF 
           REM REQUEST "Soll bei allen nichtgebuchten ZE des Vertrages das Datum auf den ",Date1$ + "  geÑndert werden?",130,req%
           req% = 1
           IF req% = 1 THEN 
             SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
             SELECT KEY codevt% LOCK FILE "zeingan1" INDEX codevt.zeingan1
             WHILE NOT EOF ("zeingan1") AND codevt.zeingan1 = codevt%
               IF gebuchtJN.zeingan1 LIKE "j" THEN 
               ELSE 
                 IF BuchungsDatum.zeingan1 <= TODAY THEN 
                   buold$ = DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy")
                   BuchungsDatum.zeingan1 = date1%
                   IF znotiz.zeingan1 <> "" THEN 
                     znotiz.zeingan1 = znotiz.zeingan1 + CHR$ (13) + CHR$ (10) + "Buchungsdatum vom: " + buold$ + " in " + DATE$ (date1%,"0d.mm.yyyy") + " durch Aufhebung Provisionssperre, geÑndert am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " von " + GMAName$
                   ELSE 
                     znotiz.zeingan1 = "Buchungsdatum vom: " + buold$ + " in " + DATE$ (date1%,"0d.mm.yyyy") + " durch Aufhebung Provisionssperre, geÑndert am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " von " + GMAName$
                   END IF 
                   CALL QuickStore("zeingan1")
                 END IF 
               END IF 
               SELECT NEXT LOCK FILE "zeingan1" INDEX codevt.zeingan1
             WEND 
             REQUEST "Verarbeitung beendet!","",2
           END IF 
 REM *************************************************************************************************** 
         END IF 
       END IF 
     END IF 
   END IF 
 END IF 
sichend15032002: 
 GProvSperreJN$ = ""
 END SUB 
  
 ' KVERTRAG Suchen (kundenbezogen)
 ' =======================================================================
 
SUB VERTRSuchen()
 cuvt% = lfdnr.KVERTRAG
 a% = VERTRSuch%(CodeKU.KVERTRAG,cuvt%)
 IF a% <> 0 THEN cuvt% = a%
 SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 FILE "KVERTRAG"
 SET INDEX CodeKU.KVERTRAG
 INDEX CodeKU.KVERTRAG
 FORM 
 SET STATUS "Bereit"
 END SUB 
 
 ' KVERTRAG Suchen (kundenbezogen) mit Auswahl nach Vertragsnummer/KFZKennz/ KFZTyp/
 ' ================================================================================= 
SUB VERTRSuchen1()
 viab% = 0
 cfile$ = FILE 
 cindex$ = INDEX 
 cuvt% = lfdnr.KVERTRAG
 akver1% = 0
  CREATE DIALOG "vsuch",0,0,175,166,title$,"MS Sans Serif",8
 ADD DIALOG "vsuch",9,6,6,24,22,2
 ADD DIALOG "vsuch",5,34,6,132,10,0,"Vertrag suchen"
 ADD DIALOG "vsuch",4,34,14,132,5,0,""
 ADD DIALOG "vsuch",5,34,22,132,26,0,"Bitte geben Sie an, Åber welche Infor- mation Sie den Vertrag suchen mîchten"
 REM ADD DIALOG "vsuch",3,34,49,154,10,0,"alle VertrÑge anzeigen",0,akVer1%
 ADD DIALOG "vsuch",5,34,42,175,26,0,"Standardsuche (schnell):"
 ADD DIALOG "vsuch",5,34,75,175,26,0,"erweiterte Suche (langsamer):"
 ADD DIALOG "vsuch",6,34,121,132,12,0,0,Eingabe$,20
 ADD DIALOG "vsuch",3,41,51,154,10,0,"alle VertrÑge anzeigen",0,akVer1%
 ADD DIALOG "vsuch",3,41,63,148,10,0,"Vertrags&nummer",1,akVer1%
 ADD DIALOG "vsuch",3,41,84,132,10,0,"KFZ-&Kennzeichen",2,akVer1%
 ADD DIALOG "vsuch",3,41,96,132,10,0,"KFZ-&Typ",3,akVer1%
 ADD DIALOG "vsuch",5,34,111,175,10,0,"&Suchbegriff:"
 REM ADD DIALOG "vsuch",4,26,102,190,38,0,"Bitte den Suchbegriff eingeben"
 ADD DIALOG "vsuch",1,28,145,55,14,1,"&Weiter",1,1
 ADD DIALOG "vsuch",1,87,145,55,14,0,"&Abbruch",0,0
 DIALOG "vsuch",req%
 REMOVE DIALOG "vsuch"
 IF req% = 1 THEN 
   IF akver1% = 0 THEN 
     a% = VERTRSuch%(CodeKU.KVERTRAG,cuvt%)
     IF a% <> 0 THEN cuvt% = a%
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     
   END IF 
   IF akver1% = 1 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GetVerab%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde keine Vertragsnummer eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 2 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZKe%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein Kennzeichen eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 3 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZTyp%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein KFZ-Typ eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 END IF 
 SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 knr% = codeku.kvertrag
 FILE cfile$
 SET INDEX cindex$
 INDEX cindex$
 IF akver1% > 1 AND nvt% <> 0 THEN 
   FORM 2
 ELSE 
   FORM 
 END IF 
 SET STATUS "Bereit"
 END SUB 
 
 ' KVERTRAG Suchen (kundenbezogen)
 ' =======================================================================
 
FUNCTION VERTRSuch%(kunr%,prompt%)
 cfile$ = FILE 
 vt% = lfdnr.KVERTRAG
 IF EXISTS (kunr%,CodeKU.KVERTRAG) THEN 
   SET STATUS "Vertragsdatei wird durchsucht..."
   DIM Auswahl$(1)
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM VListe$(10000)
   ELSE 
     DIM VListe$( RECCOUNT ("KVERTRAG"))
   END IF 
   FILE "KVERTRAG"
   INDEX CodeKU.KVERTRAG
   SELECT FIRST 
   SELECT KEY kunr%
   a% = 0
   WHILE NOT EOF ("KVERTRAG") AND kunr% = CodeKU.KVERTRAG
     SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
     tGesellschaft$ = IF ( FOUND ("GEADR"), LTRIM$ ( LEFT$ (Gesellschaft.GEADR,10)),"<keine Zuordnung>")
     IF FOUND ("SPARTEN") THEN 
       REM tSparte$ = Sparte.SPARTEN"
       codegrsp% = Codegrsp.sparten
       SELECT KEY codegrsp% FILE "SPGRUPPE" INDEX codegrsp.spgruppe
       tSparte$ = LTRIM$ (gruppe.spgruppe) + "," + LTRIM$ (Sparte.SPARTEN)
     ELSE 
       tSparte$ = "<keine Zuordnung>,<keine Zuordnung>"
     END IF 
     tAgentur$ = IF ( FOUND ("MAADR"), LTRIM$ ( LEFT$ (Nachname.MAADR,10)) + ", " + LEFT$ (Vorname.MAADR,1) + ".","<keine Zuordnung>")
     tDatum$ = IF (VS_Beginn.KVERTRAG <> 0, DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy"),"__.__.____")
     abzusatz$ = ""
     IF kennzeichen.kvertrag <> "" OR fabrikat <> "" THEN 
       abzusatz$ = ",(" + TRIM$ (kennzeichen.kvertrag) + "," + TRIM$ (fabrikat.kvertrag) + ")"
     END IF 
     IF zvp1name.kvertrag <> "" THEN abzusatz$ = ",mitvers.:" + LTRIM$ (zvp1name.kvertrag)
 
     VListe$(a%) = VS_Nr.KVERTRAG + ", " + tGesellschaft$ + ", " + tSparte$ + ", " + tDatum$ + abzusatz$ + "," + tAgentur$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
     REM andi 2.11.95 
     REM Original IF lfdnr.KVERTRAG = prompt% THEN prompt$ = VListe$(a%)
     IF prompt$ = "" THEN 
       prompt$ = VListe$(0)
     ELSE 
       IF lfdnr.KVERTRAG = prompt% THEN prompt$ = VListe$(a%)
     END IF 
     a% = a% + 1
     SELECT NEXT FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
   WEND 
    CREATE DIALOG "GETVERTRAG",0,0,405,224,"VertragsÅbersicht","MS Sans Serif",8
    ADD DIALOG "GETVERTRAG",4,0,0,403,201,0,""
    ADD DIALOG "GETVERTRAG",9,6,11,23,22,2
    ADD DIALOG "GETVERTRAG",5,36,12,202,12,0,"Bitte wÑhlen Sie den Vertrag, den Sie bearbeiten mîchten:"
    ADD DIALOG "GETVERTRAG",5,36,25,202,11,0,"Police-Nr., Gesellschaft ,Spartengruppe, Sparte, Beginn, Agentur"
    ADD DIALOG "GETVERTRAG",7,8,37,392,161,2,2,VListe$,Auswahl$,prompt$
    ADD DIALOG "GETVERTRAG",1,129,206,55,16,1,"&OK",1,1
    ADD DIALOG "GETVERTRAG",1,186,206,55,16,0,"&Abbrechen",0,0
   SET STATUS "Bitte wÑhlen Sie einen Vertrag aus..."
   DIALOG "GETVERTRAG",req%
   SET STATUS "Bereit"
   REMOVE DIALOG "GETVERTRAG"
   IF req% = 1 THEN 
     VERTRSuch% = VAL ( RIGHT$ (Auswahl$(0),6))
   ELSE 
     VERTRSuch% = 0
   END IF 
 ELSE 
   REQUEST "keine VertrÑge fÅr angegebenen Kunden gefunden!"
   VERTRSuch% = 0
 END IF 
 FILE cfile$
 SELECT KEY vt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 END FUNCTION 
 
 
 
 
 ' KVERTRAG Eintrag zurÅck
 ' =======================================================================
 
SUB VERTRPrev()
 IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
 cunr% = lfdnr.KVERTRAG
 SELECT FORM PREVIOUS FILE "KVERTRAG" INDEX QuickKUGEs.KVERTRAG
 IF codeku.KVERTRAG <> knr% THEN 
   REQUEST "Dateianfang erreicht!","",2
   SELECT FORM KEY cunr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX QuickKUGEs.KVERTRAG
   INDEX QuickKUGEs.KVERTRAG
 END IF 
 cuvt% = lfdnr.KVERTRAG
 FORM 
 END SUB 
 
 
 ' KVERTRAG Eintrag vor
 ' =======================================================================
 
SUB VERTRNext()
 cunr% = lfdnr.KVERTRAG
 IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
 SELECT FORM NEXT INDEX QuickKUGEs.KVERTRAG
 IF codeku.KVERTRAG <> knr% THEN 
   REQUEST "Dateiende erreicht!","",2
   SELECT FORM KEY cunr% INDEX lfdnr.KVERTRAG
   SET INDEX QuickKUGEs.KVERTRAG
   INDEX QuickKUGEs.KVERTRAG
 END IF 
 cuvt% = lfdnr.KVERTRAG
 FORM 
 END SUB 
 
 
 ' KVERTRAG lîschen
 ' =======================================================================
 
SUB VERTRLoeschen()
 IF disabled%("VERTRLoeschen") THEN END SUB 
 IF inhaus.kvertrag = 1 THEN 
   IF disabled%("VERTRINHAUSDEL") THEN END SUB 
 END IF 
 IF ag$ = "j" THEN 
   CALL Fehler("Diese Funktion ist fÅr SmartPROVIS Agentur gesperrt!","")
   END SUB 
 END IF 
 cuvt% = lfdnr.KVERTRAG
 REQUEST "Soll der aktuelle Vertrag gelîscht werden?","(VS-Nr.: " + VS_Nr.KVERTRAG + ")",135,req%
 IF req% = 1 THEN 
   REQUEST "Wollen Sie den Vertrag wiklich lîschen?","(VS-Nr.: " + VS_Nr.KVERTRAG + ")",135,req%
 END IF 
 IF req% = 1 THEN 
   ok% = 1
   MOUSE OFF 
   REM 210799 Abfrage nach Provisionierungsvariante einbauen -> Buchun1 testen
   IF EXISTS (cuvt%,codevt.kvfael) THEN 
     REMOVE FROM FILE "KVFAEL" WHERE codevt.kvfael = cuvt%
   END IF 
   CALL DFile(3,"vkond" + _fpw$)
   IF EXISTS (cuvt%,Codevt.vkond) THEN 
     CALL Fehler("Vertrag kann nicht gelîscht werden, es existieren EintrÑge in der Konditionsdatei!","Deaktivieren Sie erst den Vertrag, dann kann er gelîscht werden!")
     ok% = 0
   END IF 
   CALL DFile(3,"buchung" + _fpw$)
   IF EXISTS (cuvt%,Codevt.buchung) THEN 
     CALL Fehler("Vertrag kann nicht gelîscht werden, es existieren EintrÑge in der Buchungsdatei (Provis Standard)!","Deaktivieren Sie erst den Vertrag, dann kann er gelîscht werden!")
     ok% = 0
   END IF 
   CALL DFile(3,"zeingang" + _fpw$)
   IF EXISTS (cuvt%,Codevt.zeingang) THEN 
     CALL Fehler("Vertrag kann nicht gelîscht werden, es existieren EintrÑge in der Zahlungseingangsdatei (Provis Standard)!","Diese mÅssen erst manuell gelîscht werden!")
     ok% = 0
   END IF 
   CALL DFile(3,"buchung1" + _fpw$)
   IF EXISTS (cuvt%,Codevt.buchung1) THEN 
     CALL Fehler("Vertrag kann nicht gelîscht werden, es existieren EintrÑge in der Buchungsdatei von RealCASH!","Deaktivieren Sie erst den Vertrag, dann kann er gelîscht werden!")
     ok% = 0
   END IF 
   CALL DFile(3,"zeingan1" + _fpw$)
   IF EXISTS (cuvt%,Codevt.zeingan1) THEN 
     CALL Fehler("Vertrag kann nicht gelîscht werden, es existieren EintrÑge in der Zahlungseingangsdatei (RealCASH)!","Diese mÅssen erst manuell gelîscht werden!")
     ok% = 0
   END IF 
   CALL DFile(3,"fonds" + _fpw$)
   IF EXISTS (cuvt%,Codevt.fonds) THEN 
     FILE "fonds"
     REMOVE FROM FILE "fonds" WHERE codevt.fonds = cuvt%
     FILE "kvertrag"
   END IF 
   IF EXISTS (cuvt%,Codevt.spezkond) THEN 
     FILE "spezkond"
     REMOVE FROM FILE "spezkond" WHERE codevt.spezkond = cuvt%
     FILE "kvertrag"
   END IF 
   MOUSE OFF 
   SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF FOUND ("KVERTRAG") AND ok% = 1 THEN 
     codeku% = codeku.kvertrag
     SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
     daten$ = "Vertrag:" + nachname.GAdrDat$ + "/" + geburtsname.GAdrDat$ + "/" + vorname.GAdrDat$ + "/" + "Vertragsnr: " + Vs_Nr.kvertrag
     CALL LoeschProt(codeku%,Daten$)
     REM 05102005
     SELECT REMOVE FILE "KVERTRAG"
     REQUEST "Vertrag wurde gelîscht!","",0
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX codeku.KVERTRAG
     IF CodeKU.KVERTRAG <> knr% THEN 
       REQUEST "Es sind keine weiteren VertrÑge fÅr","diesen Kunden vorhanden!",0
       _formend% = 1
     END IF 
   ELSE 
     IF ok% = 1 THEN CALL Fehler("Vertrag lîschen:","Fehler bei Datenbankpositionierung!")
   END IF 
 END IF 
 _formend% = 1
 FORM 
 MOUSE ON 
 SET STATUS ""
 END SUB 
 
 
 
 ' KVERTRAG Zusatz
 ' =======================================================================
 
SUB VERTRZusatz()
 FORM 2
 END SUB 
 
 
 
 ' VertragsÅbersicht fÅr aktuellen Kunden drucken
 ' =======================================================================
SUB VGRNeu()
 CALL DruckVertr(knr%,0)
 END SUB 
 
SUB VLIST2()
 CALL LIST2(CodeKU.KVERTRAG)
 END SUB 
 
 
 
  
 
 ' Vertragsinformationen anzeigen
 ' =======================================================================
 
SUB VINFO(lfdnr%)
 MOUSE OFF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 cvt% = lfdnr.KVERTRAG
 cfile$ = FILE 
 FILE "KVERTRAG"
 cindex$ = INDEX 
 MOUSE OFF 
 SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF FOUND ("KVERTRAG") THEN 
   SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   IF FOUND (GAdrDat$) THEN 
     Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
   ELSE 
     Kunde$ = "<keine Zuordnung>"
   END IF 
   SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
   IF FOUND ("GEADR") THEN 
     Gesellschaft$ = Gesellschaft.GEADR
   ELSE 
     Gesellschaft$ = "<keine Zuordnung>"
   END IF 
   SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
   IF FOUND ("SPARTEN") THEN 
     Sparte$ = Sparte.SPARTEN
   ELSE 
     Sparte$ = "<keine Zuordnung>"
   END IF 
   IF VS_Beginn.KVERTRAG > 0 THEN 
     von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
   ELSE 
     von$ = "__.__.____"
   END IF 
   IF KÅndigung.KVERTRAG > 0 THEN 
     bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
   ELSE 
     bis$ = "__.__.____"
   END IF 
   Vertrag$ = VS_Nr.KVERTRAG
   VStatus$ = "zur Zeit nicht verfÅgbar"
   CREATE DIALOG "VINFO",0,0,265,191,"Vertragsinfo","MS Sans Serif",8
   ADD DIALOG "VINFO",4,0,0,265,190,0,""
   ADD DIALOG "VINFO",9,5,9,24,25,4
   ADD DIALOG "VINFO",5,33,9,200,11,0,"Informationen zum Vertrag " + VS_Nr.KVERTRAG + "        +++"
   ADD DIALOG "VINFO",5,33,24,49,10,0,"Kunde:"
   ADD DIALOG "VINFO",5,88,24,174,10,128,Kunde$
   ADD DIALOG "VINFO",5,33,34,49,10,0,"Gesellschaft:"
   ADD DIALOG "VINFO",5,88,34,173,10,128,Gesellschaft$
   ADD DIALOG "VINFO",5,33,44,48,10,0,"Sparte:"
   ADD DIALOG "VINFO",5,88,44,173,10,128,Sparte$
   ADD DIALOG "VINFO",5,33,54,45,9,0,"Laufzeit:"
   ADD DIALOG "VINFO",5,88,54,173,10,0,"vom " + von$ + " bis " + bis$
   ADD DIALOG "VINFO",4,33,70,226,35,0,"Provisions-Status"
   ADD DIALOG "VINFO",5,36,80,220,19,0,VStatus$
   ADD DIALOG "VINFO",4,33,120,226,35,0,"Vertrags-Status"
   ADD DIALOG "VINFO",5,36,130,220,19,0,VStatusTXT.kvertrag
   ADD DIALOG "VINFO",1,110,161,57,16,1,"&OK",1,1
   DIALOG "VINFO",req%
   REMOVE DIALOG "VINFO"
 ELSE 
   REM CALL Fehler("Der angegebene Vertrag konnte nicht gefunden werden!","")
   REQUEST "Vertrag nicht gefunden!"
 END IF 
 FILE "KVERTRAG"
 SELECT KEY cvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SET INDEX cindex$
 INDEX cindex$
 FILE cfile$
 MOUSE ON 
 END SUB 
 
 
 ' Gesamtbeitrag fÅr GebÑudeversicherung berechnen
 ' =======================================================================
 
SUB GebGesamt()
 cfile$ = FILE 
 FILE "KVERTRAG"
 ok% = 0
 REM -- Berechnung bei leeren Feldern unterdrÅcken (zur manuellen Eingabe
 REM -- des Gesamtbeitrages
 IF F_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF FKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF LW_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF LWKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF ST_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF STKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF ED_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF EDVANDA_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF EDKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF ok% THEN 
   Gesamtbeitrag = F_Beitrag + FKBU_Beitrag + LW_Beitrag + LWKBU_Beitrag + ST_Beitrag + STKBU_Beitrag + ED_Beitrag + EDVANDA_Beitrag + EDKBU_Beitrag
   FORM 
 END IF 
 FILE cfile$
 END SUB 
 
 
  
 
  
 
 
 
 ' Status eines Vertrages anzeigen und Ñndern
 ' =======================================================================
 ' 05.09.95 
  
SUB VStatus(vnr%)
 IF disabled%("VERTRSTATUS") THEN END SUB 
 MOUSE OFF 
 cuv% = lfdnr.KVERTRAG
 cfile$ = FILE 
 CALL DFile(3,"BUCHUNG" + _fpw$)
 SELECT KEY vnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF FOUND ("KVERTRAG") THEN 
   REM -- Stornoreserve ermitteln --
   sr% = GetSR%(vnr%)
   CREATE DIALOG "VSTATUS",0,0,350,163,"Vertragsstatus","MS Sans Serif",8
   IF Storno.KVERTRAG <> 0 THEN 
     Storno$ = LTRIM$ ( DATE$ (KÅndigung,"0d.mm.yyyy"))
     IF vorzeitig.KVERTRAG LIKE "j" THEN 
       Storno$ = Storno$ + CHR$ (13) + "(vorzeitig)"
     END IF 
   ELSE 
     Storno$ = "nicht gekÅndigt"
   END IF 
   ADD DIALOG "VSTATUS",9,6,8,20,22,4
   ADD DIALOG "VSTATUS",4,35,3,192,19,0,""
   ADD DIALOG "VSTATUS",5,37,10,169,9,0,"Status des Vertrages " + VS_NR.KVERTRAG
   ADD DIALOG "VSTATUS",5,37,24,69,10,0,"verprovisioniert seit:"
   ADD DIALOG "VSTATUS",5,148,24,65,11,0, IF (ProviAb.KVERTRAG > 0, LTRIM$ ( DATE$ (ProviAb.KVERTRAG,"0d.mm.yyyy")),"nicht aktiviert")
   ADD DIALOG "VSTATUS",5,37,34,73,10,0,"letzte Bearbeitung am:"
   ADD DIALOG "VSTATUS",5,148,34,73,10,0, LTRIM$ ( DATE$ (letzteBearb.KVERTRAG,"0d.mm.yyyy"))
   ADD DIALOG "VSTATUS",5,37,44,111,10,0,"letzte Provisionszahlung:"
   ADD DIALOG "VSTATUS",5,148,44,65,11,0, IF (letzteProvi.KVERTRAG > 0, LTRIM$ ( DATE$ (letzteProvi.KVERTRAG,"dd.mm.yyyy")),"keine Angaben")
   ADD DIALOG "VSTATUS",5,37,54,111,10,0,"Stornoreserve:"
   ADD DIALOG "VSTATUS",5,148,54,65,11,0, LTRIM$ ( STR$ (GetSR%(vnr%),",9999999.00"))
   ADD DIALOG "VSTATUS",5,37,64,73,10,0,"Stornierung:"
   ADD DIALOG "VSTATUS",5,148,64,65,20,0,Storno$
   ADD DIALOG "VSTATUS",4,35,85,192,19,0,""
   ADD DIALOG "VSTATUS",5,37,92,85,10,0,"Zahlungeingangskontrolle"
   ADD DIALOG "VSTATUS",5,37,106,111,10,0,"PrÅfung der ZahlungseingÑnge:"
   ADD DIALOG "VSTATUS",5,147,106,70,10,0, IF (check.KVERTRAG = "j","aktiviert","deaktiviert")
   ADD DIALOG "VSTATUS",5,37,116,104,9,0,"zahlbare Provision:"
   ADD DIALOG "VSTATUS",5,147,116,66,11,0, LTRIM$ ( STR$ (Pool.KVERTRAG,",9999999.00"))
   REM ADD DIALOG "VSTATUS",5,17,136,270,9,0,"um den Status von lebend... auf Antrag zu Ñndern -> Button Deaktivieren drÅcken"
   REM ADD DIALOG "VSTATUS",5,17,144,270,9,0,"um den Status von lebend... auf ruhend..., beitragsfrei...,storniert... zu Ñndern"
   REM ADD DIALOG "VSTATUS",5,17,152,270,9,0,"- > Button Stornieren drÅcken"
   
   ADD DIALOG "VSTATUS",1,235,6,95,15,1,"&OK",1,1
 
   REM IF vstatus% > 0 THEN ADD DIALOG "VSTATUS",1,235,23,55,15,0,"&Abbrechen",0,0
   REM IF NOT MNdisabled%("VERTRDEAKTIVIEREN") AND ProviAb.KVERTRAG > 0 THEN 
     REM IF vstatus% > 0 THEN ADD DIALOG "VSTATUS",1,235,46,55,15,0,"&Deaktivieren",3,1
   REM END IF 
   REM IF NOT MNdisabled%("VERTRSTORNO") AND ProviAb.KVERTRAG > 0 THEN 
     REM IF vstatus% > 0 THEN ADD DIALOG "VSTATUS",1,235,63,55,15,0,"&Stornieren",4,1
   REM END IF 
   ADD DIALOG "VSTATUS",1,235,23,95,15,0,"&Abbrechen",0,0
   IF NOT MNdisabled%("VERTRDEAKTIVIEREN") AND ProviAb.KVERTRAG > 0 THEN 
     ADD DIALOG "VSTATUS",1,235,46,95,15,0,"Vertrag &Deaktivieren",3,1
   END IF 
   IF NOT MNdisabled%("VERTRSTORNO") AND ProviAb.KVERTRAG > 0 THEN 
     ADD DIALOG "VSTATUS",1,235,63,95,15,0,"Vertrag &Stornieren",4,1
   END IF 
   IF GSoll$ = "j" AND sollst.kvertrag = "n" THEN 
     IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
       ADD DIALOG "VSTATUS",1,235,80,95,15,0,"Sollstellung aktivieren",6,1
     END IF 
   END IF 
   IF GSoll$ = "j" AND sollst.kvertrag = "j" THEN 
     IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
       ADD DIALOG "VSTATUS",1,235,80,95,15,0,"Sollstellung deaktivieren",5,1
     END IF 
   END IF 
   DIALOG "VSTATUS",req%
   REMOVE DIALOG "VSTATUS"
   SELECT CASE req%
   CASE 0
     REM RÅckschreiben, der vorhergehenden Statusinfos
     REM vstatus% = 2
   CASE 3
     REM 290799
     vstatus% = CodeVStatus.kvertrag
     REM IF vstatus% > 4 AND vstatus% < 13 THEN 
       REM vstatus% = 0
       CALL VERTRDeak()
     REM ELSE 
       REM CALL Fehler("ungÅltige Auswahl","")
       REM vstatus% = 2
     REM END IF 
   CASE 4
     vstatus% = CodeVStatus.kvertrag
     REM IF vstatus% > 0 AND vstatus% < 5 THEN 
       REM vstatus% = 0
       CALL VERTRStorno()
     REM ELSE 
       REM CALL Fehler("ungÅltige Auswahl","")
       REM vstatus% = 2
     REM END IF 
    CASE 5
      REM Sollstellung deaktivieren
      REQUEST "Sollstellung wirklich deaktivieren?","",130,req%
      IF req% = 1 THEN 
        tvn% = lfdnr.KVERTRAG
        SELECT KEY tvn% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
        sollst.kvertrag = "n"
        CALL QuickStore("KVERTRAG")
        IF EXISTS (tvn%,codevt.kvskond) THEN 
          FILE "kvskond"
          INDEX codevt.kvskond
          SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
          REMOVE FROM FILE "kvskond" WHERE codevt.kvskond = tvn%
        END IF 
        IF EXISTS (tvn%,codevt.zeinvor) THEN 
          FILE "zeinvor"
          INDEX codevt.zeinvor
          SELECT FIRST FILE "zeinvor" INDEX codevt.zeinvor
          REMOVE FROM FILE "zeinvor" WHERE codevt.zeinvor = tvn%
        END IF 
      END IF 
    CASE 6
      REM Sollstellung aktivieren
      DIM KVKond$( RECCOUNT ("VPGEKOND"))
               REM *******************************************************************************************
               REM *   Einbeziehung der Produktkonditionen                                                   *
               REM *******************************************************************************************
               IF PrvVerfahr$ = "ZAHLUNGSEINGANG" AND GSoll$ LIKE "j" AND GAFSK$ <> "TRUE" THEN 
                 cfile$ = FILE 
                 alfdnr% = lfdnr.kvertrag
                 acodevp% = codevp.kvertrag
                 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF EXISTS (codevp.kvertrag,codevp.VPGEKOND) THEN 
                   zwtext$ = "an Hand derer die Sollstellung fÅr den Vertrag berechnet werden kann! BEACHTEN SIE, DASS VERTRéGE IN DER WéHRUNG DM NICHT IN DIE SOLLSTELLUNG öBERNOMMEN WERDEN KôNNEN!"
                   CALL Fehler("Sie erhalten jetzt die Mîglichkeit eine Produktkondition auszuwÑhlen,",zwtext$)
 
                   REQUEST "Wollen Sie den Vertrag an die Sollstellung Åbergeben ? ","",130,req1ab%
                   FILE "VPGEKOND"
                   INDEX codevp.VPGEKOND
                   SELECT FIRST 
                   SELECT KEY codevp.kvertrag FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   IF codew.kvertrag = 1 OR req1ab% <> 1 THEN 
                     IF codew.kvertrag = 1 THEN 
                       CALL Fehler("Der Vertrag kann nicht an die Sollstellung Åbergeben werden, da er noch in der WÑhrung DM gefÅhrt wird!","")
                     END IF 
                     GOTO endprodi190320041
                   END IF 
                   IF Bewertungssumme.kvertrag <= 0 THEN 
                     CALL Fehler("Der Vertrag kann nicht an die Sollstellung Åbergeben werden, da die Bewertungssumme <= 0 ist!","")
                     GOTO endprodi190320041
                   END IF 
                   a% = 0
                   gefunden% = 0
                   WHILE NOT EOF ("VPGEKOND") AND codevp.VPGEKOND = codevp.kvertrag
                     ok% = - 1
                     gefunden% = gefunden% + 1
                     IF bwvon.VPGEKOND > 0 THEN 
                       IF Gvuebs$ LIKE "TRUE" THEN 
                         IF Antragsdatum.kvertrag < bwvon.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       ELSE 
                         IF VS_Beginn.kvertrag < bwvon.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       END IF 
                     END IF 
                     IF bwbis.VPGEKOND > 0 THEN 
                       IF Gvuebs$ LIKE "TRUE" THEN 
                         IF Antragsdatum.kvertrag > bwbis.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       ELSE 
                         IF VS_Beginn.kvertrag > bwbis.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       END IF 
                     END IF 
                     IF ok% = 0 THEN 
                       fehl% = fehl% + 1
                       GOTO nextkond18032004
                     END IF 
                     IF ok% THEN 
                       KVKond$(a%) = "BWVon:" + DATE$ (bwvon.VPGEKOND,"0d.mm.yyyy") + " "
                       IF bwbis.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "BWBis:" + DATE$ (bwbis.VPGEKOND,"0d.mm.yyyy") + " "
                       END IF 
 
                       IF Monatjn.VPGEKOND = "j" AND MonatFakt.VPGEKOND > 0 THEN 
                         IF MonatBrutto.vpgekond = "j" THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Brutto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         ELSE 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Netto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                       END IF 
 
                       IF Pauschalejn.VPGEKOND = "j" AND Pauschale.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:Pauschale=" + LTRIM$ ( STR$ (Pauschale.VPGEKOND,"9999.0000")) + " " + Waehrung.kvertrag
                       END IF 
                   
                       IF apjn.VPGEKOND = "j" AND ap.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:" + LTRIM$ ( STR$ (ap.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       IF courtagejn.VPGEKOND = "j" AND courtage.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "Courtage:" + LTRIM$ ( STR$ (courtage.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       zus$ = ""
                       IF VDjn.VPGEKOND = "j" THEN 
                         IF VS_Dauer.kvertrag < 1 THEN 
                           CALL Fehler("Sie kînnen den Vertrag " + VS_NR.kvertrag + " nicht mittels den Konditionen zur Vertragslaufzeit and die Sollstellung Åbergeben,","da keine Laufzeit eingetragen wurde!")
                           GOTO endprodi190320041
                         ELSE 
                           ok% = 0
                           IF VS_Dauer.kvertrag <= VD5Dauer.VPGEKOND AND VD5Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD5AP.VPGEKOND,"9999.0000")) + " "
                             IF VD5SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD5SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD5HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD4Dauer.VPGEKOND AND VD4Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD4AP.VPGEKOND,"9999.0000")) + " "
                             IF VD4SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD4SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD4HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD3Dauer.VPGEKOND AND VD3Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD3AP.VPGEKOND,"9999.0000")) + " "
                             IF VD3SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD3SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD3HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD2Dauer.VPGEKOND AND VD2Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD2AP.VPGEKOND,"9999.0000")) + " "
                             IF VD2SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD2SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD2HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD1Dauer.VPGEKOND AND VD1Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD1AP.VPGEKOND,"9999.0000")) + " "
                             IF VD1SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD1SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD1HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF ok% = - 1 THEN 
                             KVKond$(a%) = KVKond$(a%) + zus$ + " "
                           ELSE 
                             CALL Fehler("Sie kînnen den Vertrag " + VS_NR.kvertrag + " nicht mittels den Konditionen zur Vertragslaufzeit and die Sollstellung Åbergeben,","da keine gÅltige Kondition eingetragen wurde!")
                             GOTO endprodi190320041
                           END IF 
                         END IF 
                       END IF 
                       IF pflegejn.VPGEKOND = "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Pflege:" + LTRIM$ ( STR$ (pflegeProvi.VPGEKOND,"99.0000")) + " "
                       END IF 
                       IF srjn.VPGEKOND = "j" AND vdjn.vpgekond <> "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Storno:" + LTRIM$ ( STR$ (sr.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       KVKond$(a%) = KVKond$(a%) + SPACE$ (100) + STR$ (codekey.VPGEKOND,"000000")
                       IF bwstart% >= bwvon.vpgekond THEN 
                         IF bwbis.vpgekond > 0 THEN 
                           IF bwstart% <= bwbis.vpgekond THEN prompt$ = KVKond$(a%)
                         ELSE 
                           prompt$ = KVKond$(a%)
                         END IF 
                       END IF 
                       a% = a% + 1
                     END IF 
nextkond18032004:                     
                     SELECT NEXT FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   WEND 
                   IF a% = 0 AND fehl% > 0 THEN 
                     req% = 0
                     text1$ = "es wurden insgesamt " + LTRIM$ ( STR$ ("gefunden")) + "Konditionen gefunden,davon enthÑlt keine Kondition in den Feldern BWVON und/oder BWBIS einen Eintrag der mit"
                     CALL Fehler(text1$,"dem Provisionierungsbeginn des Vertrages harmonisiert")
                   ELSE 
                     KVKond$(a%) = ""
                     prompt$ = KVKond$(0)
                     CREATE DIALOG "MASUCH",0,0,358,288,"Sollstellungskonditionen","MS Sans Serif",8
                     ADD DIALOG "MASUCH",4,0,0,358,263,0,""
                     ADD DIALOG "MASUCH",9,9,11,21,21,2
                     ADD DIALOG "MASUCH",5,37,11,151,10,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
                     ADD DIALOG "MASUCH",7,7,27,348,229,2,2,KVKond$,Auswahl$,prompt$
                     ADD DIALOG "MASUCH",1,100,268,55,15,1,"&OK",1,1
                     ADD DIALOG "MASUCH",1,160,268,55,15,0,"&Abbrechen",0,0
                     MOUSE ON 
                     DIALOG "MASUCH",req%
                     REMOVE DIALOG "MASUCH"
                   END IF 
                   IF req% = 1 THEN 
                     dDate$ = "0"
                     CodeKey% = VAL ( RIGHT$ (Auswahl$(0),6))
                     IF CodeKey% <> 0 THEN 
                       IF NOT EXISTS (cuvt%,codevt.kvskond) THEN 
                         BLANK FILE "KVSKOND"
                         CodeKey1% = SER ("KVSKOND",1)
                         CodeKey.kvskond = CodeKey1%
                         Codevt.KVSKOND = cuvt%
                         CodeKO.KVSKOND = CodeKey%
                         erledigt.KVSKOND = "n"
                         test1% = TODAY - 60
                         jetztlos% = 0
                         STORE FILE "KVSKOND"
                         UNLOCK CURRENT FILE "KVSKOND"
                         IF vs_beginn.kvertrag < test1% THEN 
                           atext$ = "ob die Zahlungen bis jetzt erfolgt sind und Sie die Sollstellung erst ab heutigem Datum generieren lassen wollen!"
                           CALL Fehler("Der Vertragsbeginn liegt mehr als 2 Monate zurÅck! Sie mÅssen selbst entscheiden, ob Sie die Sollstellung von Vertragsbeginn an erzeugen lassen mîchten oder,",atext$)
                           REQUEST "Sollstellung ab Vertragsbeginn generieren?","",135,req1234%
                           IF req1234% <> 1 THEN 
                             REM in kvskond verschiedene Sachen als erledigt kennzeichnen
 
                             dDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
                             _day% = DAY ( TODAY )
                             _month% = MONTH ( TODAY )
                             _year% = YEAR ( TODAY )
                             _day% = 1
                             dDate% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
                             dDate$ = DATE$ (dDate%,"0d.mm.yyyy")
datsoll180320041: 
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsbeginn","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, ab wann die"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellung beginnen soll:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,dDATE$,10
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Beginndatum:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               ELSE 
                                 GOTO datsoll180320041
                               END IF 
                             END IF 
                             SELECT KEY codekey% FILE "vpgekond" INDEX codekey.vpgekond
                             jetztlos% = 0
                           END IF 
                         END IF 
                       ELSE 
                         SELECT KEY cuvt% LOCK FILE "KVSKOND" INDEX codevt.KVSKOND
                         CodeKO.KVSKOND = CodeKey%
                         Codevt.KVSKOND = cuvt%
                         erledigt.KVSKOND = "n"
                         test1% = TODAY - 60
                         STORE FILE "KVSKOND"
                         UNLOCK CURRENT FILE "KVSKOND"
                         IF vs_beginn.kvertrag < test1% THEN 
                           atext$ = "ob die Zahlungen bis jetzt erfolgt sind und Sie die Sollstellung erst ab heutigem Datum generieren lassen wollen!"
                           CALL Fehler("Der Vertragsbeginn liegt mehr als 2 Monate zurÅck! Sie mÅssen selbst entscheiden, ob Sie die Sollstellung von Vertragsbeginn an erzeugen lassen mîchten oder,",atext$)
                           REQUEST "Sollstellung ab Vertragsbeginn generieren?","",135,req1234%
                           IF req1234% <> 1 THEN 
                             REM in kvskond verschiedene Sachen als erledigt kennzeichnen
 
                             dDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
datsoll180320042: 
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsbeginn","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, ab wann die"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellung beginnen soll:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,dDATE$,10
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Beginndatum:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               IF DateOK%(dDATE$) THEN 
                               ELSE 
                                 GOTO datsoll180320042
                               END IF 
                             END IF 
                             SELECT KEY codekey% FILE "vpgekond" INDEX codekey.vpgekond
                           END IF 
                         END IF 
                       END IF 
                       SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
                       sollst.kvertrag = "j"
                       STORE FILE "KVERTRAG"
                       UNLOCK FILE "KVERTRAG"
                       REQUEST "Wollen Sie jetzt gleich die Sollstellung ermitteln lassen?","",130,req1soll%
                       IF req1soll% = 1 THEN 
                         CALL Sollstellung(cuvt%,1,dDate$)
                       END IF 
                     END IF 
                   END IF 
                 END IF 
                 FILE cfile$
               END IF 
endprodi190320041: 
               REM ***********************Ende Produktkonditionen ********************************************  
 
 
 
    CASE 555
      REM Anzeige Sollstellungskonditionen
      REM CALL VPKondanz(codevp.kvertrag)
        codevp% = codevp.kvertrag
        IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
          IF EXISTS (codevp%,codevp.vpgekond) THEN 
            CALL VPGekond(codevp%)
          ELSE 
            REQUEST "Es existieren noch keine Konditionen fÅr dieses Produkt!","Neue Kondition anlegen?",130,req%
            IF req% = 1 THEN 
              CALL VPGekondNeu(codevp%)
              CALL VPGekond(codevp%)
            END IF 
          END IF 
        END IF 
   END SELECT 
 ELSE 
   REQUEST "nicht gefunden"
 END IF 
 FILE cfile$
 SELECT FORM KEY cuv% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF FORM <> "" THEN FORM 
 MOUSE ON 
 END SUB 
 
 'Sollstellungskonditionen aus dem Vertrag heraus einsehen
SUB ViewSoll()
        codevp% = codevp.kvertrag
        IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
          IF EXISTS (codevp%,codevp.vpgekond) THEN 
            CALL VPGekond(codevp%)
          ELSE 
            REQUEST "Es existieren noch keine Konditionen fÅr dieses Produkt!","Neue Kondition anlegen?",130,req%
            IF req% = 1 THEN 
              CALL VPGekondNeu(codevp%)
              CALL VPGekond(codevp%)
            END IF 
          END IF 
        END IF 
 END SUB 
 
SUB ViewSoll1(codevp%)
        REM codevp% = codevp.kvertrag
        IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
          IF EXISTS (codevp%,codevp.vpgekond) THEN 
            CALL VPGekond(codevp%)
          ELSE 
            REQUEST "Es existieren noch keine Konditionen fÅr dieses Produkt!","Neue Kondition anlegen?",130,req%
            IF req% = 1 THEN 
              CALL VPGekondNeu(codevp%)
              CALL VPGekond(codevp%)
            END IF 
          END IF 
        END IF 
 END SUB 
 
 
 ' Vertrag aus Abrechnung nehmen
 ' =======================================================================
 ' 06.09.95 
 
SUB VERTRDeak()
 CALL DFile(3,"VKOND" + _fpw$)
 CREATE DIALOG "VDEAKTIV",0,0,235,132,title$,"MS Sans Serif",8
 ADD DIALOG "VDEAKTIV",9,9,12,22,24,2
 ADD DIALOG "VDEAKTIV",5,40,11,186,9,0,"Vertrag deaktivieren"
 ADD DIALOG "VDEAKTIV",4,40,20,186,5,0,""
 ADD DIALOG "VDEAKTIV",5,40,28,185,22,0,"Mit dieser Funktion kînnen Sie einen Vertrag aus der Provisionsabrechnung herausnehmen."
 ADD DIALOG "VDEAKTIV",5,40,51,185,18,0,"Klicken Sie auf " + CHR$ (34) + "Ja" + CHR$ (34) + ", wenn der Vertrag nicht mehr bei der Provisionsberechnung berÅcksichtigt werden soll."
 ADD DIALOG "VDEAKTIV",5,40,70,184,27,0,"Sie kînnen den Vertrag (nach erfolgter Korrektur der Vertragsdaten) erneut Åber den Button <Abrechnung> an die Vertragsabrechnung Åbergeben."
 ADD DIALOG "VDEAKTIV",1,58,107,55,15,0,"&Ja",1,1
 ADD DIALOG "VDEAKTIV",1,116,107,55,15,1,"&Nein",0,0
 DIALOG "VDEAKTIV",req%
 REMOVE DIALOG "VDEAKTIV"
 tvn% = lfdnr.KVERTRAG
 IF req% = 1 THEN 
   tvn% = lfdnr.KVERTRAG
   SELECT KEY tvn% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   ProviAb.KVERTRAG = 0
   BewertcalcDat.kvertrag = 0
   KuenCourt1.kvertrag = ""
   VertragAktiv.kvertrag = "n"
   vorzeitig.kvertrag = ""
   IF GAFSK$ LIKE "TRUE" THEN 
     AFSKPAUJN.kvertrag = "n"
     AFSKPAUEUR.kvertrag = 0
     AFSKPAUDAT.kvertrag = 0
     REM QAFSKPAUDAT.kvertrag = "n" + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
     IF AFSKPauschDat.kvertrag < 1 THEN 
 
     END IF 
     IF AFSKPAUDAT.kvertrag < 1 THEN 
       QAFSKPAUDAT.kvertrag = AFSKPAUJN.kvertrag + "00000000"
     ELSE 
       QAFSKPAUDAT.kvertrag = AFSKPAUJN.kvertrag + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
     END IF 
   END IF 
   REM ******************************************************************************************************************
   IF StatusZOK.kvertrag = "ESTORNO" OR StatusZOK.kvertrag = "MSTORNO" THEN 
     CALL ZentrAGZaehl(codema.kvertrag,StatusZOK.kvertrag,Bewertungssumme.kvertrag,Volumen.kvertrag,0,KÅndigung.KVERTRAG,1)
   END IF 
   REM ******************************************************************************************************************
   KÅndigung.kvertrag = 0
   storno.kvertrag = 0
   DynJN.kvertrag = "N"
   VStatusTXT.kvertrag = "Antrag"
   CodeVStatus.kvertrag = 12
   REM 210597
   TatsKuenDat.kvertrag = 0
   REM 140497
   letzteProvi = 0:gez_Abschlu·.KVERTRAG = "":gez_Pauschale.KVERTRAG = ""
   TZRate.KVERTRAG = 0:letztePflege.KVERTRAG = 0:Pool.KVERTRAG = 0:Mahnung.KVERTRAG = "n"
   REM 030697
   codeko.kvertrag = 0
   sollst.kvertrag = "n"
   CALL QuickStore("KVERTRAG")
   REM 110397 Lîschung der EintrÑge in der Buchungsdatei
   REM 230897
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     CALL DFile(3,"buchung" + _fpw$)
     FILE "Buchung"
     INDEX codevt.buchung
     SELECT FIRST 
     REM 060497
     SELECT KEY tvn% FILE "buchung" INDEX codevt.buchung
     WHILE NOT EOF ("Buchung") AND codevt.buchung = tvn%
       srb% = sr.buchung
       einheit% = einheiten.buchung
       volumen% = Volumen.buchung
       ma% = Codema.buchung
       IF srb% <> 0 OR einheit% <> 0 OR volumen% <> 0 THEN 
         ma% = Codema.buchung
         vcodema% = vtcodema.buchung
         FILE "maadr"
         INDEX codema.maadr
         SELECT FIRST 
         SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
         IF srb% <> 0 THEN 
           Stornoreserve.maadr = stornoreserve.maadr - srb%
           StornoreserveEU.maadr = VAL ( STR$ (stornoreserve.maadr / umrechnung.buchung,"999999999.00"))
         END IF 
         IF einheit% <> 0 THEN 
           Einheiten.maadr = einheiten.maadr - einheit%
           IF ma% = vcodema% THEN 
             EigEinheiten.maadr = Eigeinheiten.maadr - einheit%
             EinheitGes.maadr = EinheitGes.maadr - einheit%
           ELSE 
             sEinheitGes.maadr = sEinheitGes.maadr - einheit%
           END IF 
         END IF 
         IF volumen% <> 0 THEN 
           gesvolumen.maadr = Gesvolumen.maadr - volumen%
           IF ma% = vcodema% THEN 
             eigvolumen.maadr = eigvolumen.maadr - volumen%
           END IF 
         END IF 
         REM Workstation.maadr = Workstation%
         REM QWoNo.maadr = STR$ (Workstation%,"000000") + STR$ (codema.maadr,"000000")
         RecStatus.maadr = "c"
         STORE FILE "maadr"
         UNLOCK CURRENT FILE "maadr"
       END IF 
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       betr% = Betrag.buchung * - 1
       IF Provision.buchung = "j" THEN 
         zusatz% = 0
       ELSE 
         zusatz% = 1
       END IF 
       IF vtcodema.buchung = codema.buchung THEN 
         eigen% = 1
       ELSE 
         eigen% = 0
       END IF 
       PSpAll$ = ""
       PSpAllSeit% = 0
       PROVSpEig$ = ""
       PSpESeit% = 0
       einheit% = einheit% * - 1
       datumz% = Datum.buchung
       codew1% = codew.buchung
       waehrung1$ = waehrung.buchung
       euro1% = umrechnung.buchung
       srb% = srb% * - 1
       CALL ZentrKTO(ma%,datumz%,betr%,srb%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,einheit%)
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       IF zusatz% = 0 THEN 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         AuszProvABGes.maadr = AuszProvABGes.maadr + betr%
         AuszProvABGesEU.maadr = VAL ( STR$ (AuszProvABGes.maadr / euro1%,"999999999.00"))
       ELSE 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         zusAuszahl.maadr = zusAuszahl.maadr + betr%
         zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
         aktZusB.maadr = aktZusB.maadr + betr%
         aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
       END IF 
       STORE FILE "maadr"
       UNLOCK CURRENT FILE "maadr"
       
       FILE "Buchung"
       SELECT NEXT FILE "Buchung" INDEX codevt.buchung
     WEND 
     REM 019798 REMOVE FROM FILE "Buchung" WHERE codevt.buchung = tvn%
     FILE "Buchung"
     INDEX codevt.buchung
     SELECT FIRST 
loebu010798: 
     IF EXISTS (tvn%,codevt.buchung) THEN 
       SELECT KEY tvn% LOCK FILE "Buchung" INDEX codevt.buchung
       SELECT REMOVE FILE "Buchung"
       SELECT FIRST FILE "Buchung"
       GOTO loebu010798
     END IF 
 
      
     REM 010798 REMOVE FROM FILE "VKOND" WHERE codevt.vkond = tvn%
     FILE "vkond"
     INDEX codevt.VKOND
     SELECT FIRST 
loevk010798: 
     IF EXISTS (tvn%,codevt.VKOND) THEN 
       SELECT KEY tvn% LOCK FILE "VKOND" INDEX codevt.VKOND
       SELECT REMOVE FILE "VKOND"
       SELECT FIRST FILE "VKOND"
       GOTO loevk010798
     END IF 
 
   ELSE 
     IF EXISTS (tvn%,codevt.kvskond) THEN 
       FILE "kvskond"
       INDEX codevt.kvskond
       SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
       REMOVE FROM FILE "kvskond" WHERE codevt.kvskond = tvn%
     END IF 
     IF EXISTS (tvn%,codevt.zeinvor) THEN 
       FILE "zeinvor"
       INDEX codevt.zeinvor
       SELECT FIRST FILE "zeinvor" INDEX codevt.zeinvor
       REMOVE FROM FILE "zeinvor" WHERE codevt.zeinvor = tvn%
     END IF 
     CALL DFile(3,"zeingan1" + _fpw$)
     FILE "zeingan1"
     INDEX codevt.zeingan1
     CALL DFile(3,"buchung1" + _fpw$)
     IF EXISTS (tvn%,codevt.spezkond) THEN 
       FILE "spezkond"
       INDEX codevt.spezkond
       SELECT FIRST 
       SELECT KEY tvn% LOCK FILE "spezkond" INDEX codevt.spezkond
       WHILE NOT EOF ("Spezkond") AND codevt.spezkond = tvn%
         einmaligerfolgt.spezkond = "n"
         EinmDatum.spezkond = 0
         STORE FILE "spezkond"
         UNLOCK CURRENT 
         SELECT NEXT LOCK FILE "spezkond" INDEX codevt.spezkond
       WEND 
     END IF 
     FILE "Buchung1"
     INDEX codevt.buchung1
     SELECT FIRST 
     REM 060497
     SET STATUS "RÅckrechnung Einheiten/Volumen fÅr Mitarbeiter"
     SELECT KEY tvn% FILE "buchung1" INDEX codevt.buchung1
     WHILE NOT EOF ("Buchung1") AND codevt.buchung1 = tvn%
       IF provision.buchung1 <> "j" THEN GOTO w201220041
       srb% = sr.buchung1
       einheit% = einheiten.buchung1
       volumen% = Volumen.buchung1
       ma% = Codema.buchung1
       IF srb% <> 0 OR einheit% <> 0 OR volumen% <> 0 THEN 
         ma% = Codema.buchung1
         vcodema% = vtcodema.buchung1
         FILE "maadr"
         INDEX codema.maadr
         SELECT FIRST 
         SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
         IF srb% <> 0 THEN 
           Stornoreserve.maadr = stornoreserve.maadr - srb%
           StornoreserveEU.maadr = VAL ( STR$ (stornoreserve.maadr / Umrechnung.buchung1,"999999999.00"))
         END IF 
         IF einheit% <> 0 THEN 
           Einheiten.maadr = einheiten.maadr - einheit%
           IF ma% = vcodema% THEN 
             EigEinheiten.maadr = Eigeinheiten.maadr - einheit%
             EinheitGes.maadr = EinheitGes.maadr - einheit%
           ELSE 
             sEinheitGes.maadr = sEinheitGes.maadr - einheit%
           END IF 
         END IF 
         IF volumen% <> 0 THEN 
           gesvolumen.maadr = Gesvolumen.maadr - volumen%
           IF ma% = vcodema% THEN 
             eigvolumen.maadr = eigvolumen.maadr - volumen%
           END IF 
         END IF 
         REM Workstation.maadr = Workstation%
         REM QWoNo.maadr = STR$ (Workstation%,"000000") + STR$ (codema.maadr,"000000")
         RecStatus.maadr = "c"
         STORE FILE "maadr"
         UNLOCK CURRENT FILE "maadr"
       END IF 
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       betr% = Betrag.buchung1 * - 1
       IF Provision.buchung1 = "j" THEN 
         zusatz% = 0
       ELSE 
         zusatz% = 1
       END IF 
       IF vtcodema.buchung1 = codema.buchung1 THEN 
         eigen% = 1
       ELSE 
         eigen% = 0
       END IF 
       einheit% = einheit% * - 1
       PSpAll$ = ""
       PSpAllSeit% = 0
       PROVSpEig$ = ""
       PSpESeit% = 0
       datumz% = Datum.buchung1
       codew1% = codew.buchung1
       waehrung1$ = waehrung.buchung1
       euro1% = umrechnung.buchung1
       srb% = srb% * - 1
       CALL ZentrKTO(ma%,datumz%,betr%,srb%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,einheit%)
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       IF zusatz% = 0 THEN 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         AuszProvABGes.maadr = AuszProvABGes.maadr + betr%
         AuszProvABGesEU.maadr = VAL ( STR$ (AuszProvABGes.maadr / euro1%,"999999999.00"))
       ELSE 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         zusAuszahl.maadr = zusAuszahl.maadr + betr%
         zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
         aktZusB.maadr = aktZusB.maadr + betr%
         aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
       END IF 
       STORE FILE "maadr"
       UNLOCK CURRENT FILE "maadr"
 
 
w201220041:       
       FILE "Buchung1"
       SELECT NEXT FILE "Buchung1" INDEX codevt.buchung1
     WEND 
     IF EXISTS (tvn%,codevt.kvfael) AND GAFSK$ = "TRUE" THEN 
       SELECT FIRST FILE "KVFAEL" INDEX codevt.kvfael
       SELECT KEY tvn% LOCK FILE "KVFAEL" INDEX codevt.kvfael
       REM REMOVE FROM FILE "KVFAEL" WHERE codevt.kvfael = tvn%
       gezProv.kvfael = 0
       gezProvEU.kvfael = 0
       gezProvAnz.kvfael = 0
       TgezProvAnz.kvfael = 0
       StornoBetrag.kvfael = 0
       StornoBetrEU.kvfael = 0
       StornoDat.kvfael = 0
       gez_Abschlu·.kvfael = "n"
       gezahltam.kvfael = 0
       VMProv.kvfael = 0
       erledigt.kvfael = "n"
       abserledigt.kvfael = "n"
       autokuend.kvfael = "n"
       REM faelligam.kvfael = 0
       erwProvAnz.kvfael = 0
       gezProvAnz.kvfael = 0
       STORE FILE "kvfael"
       UNLOCK CURRENT FILE "KVFAEL"
     END IF 
     SET STATUS "RÅcksetzen Zahlungseingangsdatei"
     IF EXISTS (tvn%,codevt.Zeingan1) THEN 
       SELECT WHERE FILE "zeingan1"
       abc% = 1
       SELECT FIRST FILE "Zeingan1" INDEX codevt.Zeingan1
       REM SET STATUS "vor while und lock"
       SELECT KEY tvn% FILE "Zeingan1" INDEX codevt.Zeingan1
       ErrZAB% = 0
       ON ERROR GOTO ErrorHandler
       SELECT CURRENT LOCK FILE "Zeingan1" INDEX codevt.Zeingan1
       WHILE NOT EOF ("Zeingan1") AND codevt.Zeingan1 = tvn%
         IF tvn% = codevt.zeingan1 THEN 
           SET STATUS "in while"
           gebuchtJN.zeingan1 = "N"
           gebuchtJNT.zeingan1 = "N"
           STORE FILE "zeingan1"
           UNLOCK CURRENT FILE "Zeingan1"
           SET STATUS "in while nach unlock"
         END IF 
         IF EXISTS (tvn%,codevt.Zeingan1) THEN 
           SELECT NEXT LOCK FILE "Zeingan1" INDEX codevt.Zeingan1
         ELSE 
           SELECT LAST FILE "Zeingan1" INDEX codevt.Zeingan1
         END IF 
         SET STATUS "in while nach select next"
       WEND 
       ErrZAB% = 0
     END IF 
     SET STATUS ""
     REM 019798 REMOVE FROM FILE "Buchung" WHERE codevt.buchung = tvn%
     FILE "Buchung1"
     INDEX codevt.buchung1
     SELECT FIRST 
     SELECT KEY tvn% LOCK FILE "Buchung1" INDEX codevt.buchung1
loebu0107981: 
     ErrZAB% = 0
     REM CALL Fehler("Test","")
     IF EXISTS (tvn%,codevt.buchung1) AND codevt.buchung1 = tvn% AND NOT EOF ("buchung1") THEN 
       SET STATUS "lîschen in buchung1"
       IF provision.buchung1 = "j" THEN 
         SELECT REMOVE FILE "buchung1"
         SELECT FIRST FILE "buchung1"
         IF RECCOUNT ("buchung1") > 0 THEN 
           SELECT KEY tvn% LOCK FILE "Buchung1" INDEX codevt.buchung1
         ELSE 
           SELECT LAST FILE "buchung1"
         END IF 
       ELSE 
         SELECT NEXT LOCK FILE "buchung1"
       END IF 
       MOUSE OFF 
       REM SELECT FIRST 
       GOTO loebu0107981
     END IF 
 
      
     REM 010798 REMOVE FROM FILE "VKOND" WHERE codevt.vkond = tvn%
     FILE "vkond"
     INDEX codevt.VKOND
     SELECT FIRST 
loevk0107982: 
     ErrZAB% = 0
     IF EXISTS (tvn%,codevt.VKOND) THEN 
       SET STATUS "in vkond"
       SELECT KEY tvn% LOCK FILE "VKOND" INDEX codevt.VKOND
       SELECT REMOVE FILE "VKOND"
       SELECT FIRST FILE "VKOND"
       GOTO loevk0107982
     END IF 
   END IF 
   FILE "kvertrag"
   SET STATUS "Vertrag wurde deaktiviert"
   END IF 
   FILE "kvertrag"
   SET STATUS "Vertrag wurde deaktiviert"
 ELSE 
   SET STATUS "Bereit"
   vstatus% = 2
 END IF 
 SELECT FORM KEY tvn% FILE "kvertrag" INDEX lfdnr.kvertrag
 FORM 
 cuvt% = tvn%
 ErrZAB% = 0
 END SUB 
 
 ' Vertrag stornieren
 ' =======================================================================
 ' 220697
 
SUB VERTRStornoOld()
 vnr% = lfdnr.KVERTRAG
 
 cfile$ = FILE 
 MOUSE OFF 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"buchtemp" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"foerkond" + _fpw$)
 MOUSE ON 
 IF Storno.KVERTRAG = 1 OR Storno.KVERTRAG = 2 THEN 
   CREATE DIALOG "STORNO",0,0,189,87,title$,"MS Sans Serif",8
   ADD DIALOG "STORNO",9,6,7,22,22,3
   ADD DIALOG "STORNO",5,32,8,145,10,0,"Der aktuelle Vertrag wurde bereits storniert!"
   ADD DIALOG "STORNO",5,32,19,149,48,0,"Falls Sie énderungen an den Stornodaten vornehmen wollen, bearbeiten Sie bitte die entsprechenden BuchungssÑtze in der Buchungsdatei (Funktion Nachbearbeitung von BuchungssÑtzen)."
   ADD DIALOG "STORNO",1,66,65,55,15,1,"&OK",0,0
   DIALOG "STORNO",req%
   REMOVE DIALOG "STORNO"
 ELSE 
   einheit$ = "n"
   srkont$ = "n"
   srno$ = "n"
datok170698: 
   REM 130199
   stornowert% = 0
   SELECT KEY vnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
     IF ( TODAY - Antragsdatum.kvertrag) > 365 THEN 
       opt% = 2
     ELSE 
       opt% = 1
     END IF 
     CREATE DIALOG "STORNO",0,0,202,290,title$,"MS Sans Serif",8
     ADD DIALOG "STORNO",4,0,0,202,183,0,""
     REM ADD DIALOG "STORNO",9,8,14,20,21,2
     ADD DIALOG "STORNO",5,13,8,63,10,0,"Vertrag stornieren"
     ADD DIALOG "STORNO",4,13,15,151,5,0,""
     ADD DIALOG "STORNO",5,13,20,149,16,0,"Bitte geben Sie an, ob und wie der Vertrag storniert werden soll."
     ADD DIALOG "STORNO",3,13,38,108,10,0,"Vertrag nicht stornieren",0,stornowert%
     ADD DIALOG "STORNO",3,13,50,108,10,0,"vollstÑndige RÅckbuchung",1,stornowert%
     ADD DIALOG "STORNO",3,13,62,108,10,0,"anteilige RÅckbuchung",2,stornowert%
     ADD DIALOG "STORNO",3,13,86,108,10,0,"ohne RÅckbuchung",3,stornowert%
     ADD DIALOG "STORNO",3,13,98,128,10,0,"alle Buchungen ab Datum stornieren",4,stornowert%
     ADD DIALOG "STORNO",5,42,74,23,10,0,"Anteil:"
     ADD DIALOG "STORNO",6,67,73,22,11,0,0,StornoAnteil.KVERTRAG,20
     ADD DIALOG "STORNO",6,142,98,43,11,0,0,stordat1$,10
     
 
     ADD DIALOG "STORNO",5,93,74,22,9,0,"% "
     REM ADD DIALOG "STORNO",5,93,90,22,9,0,"% oder"
     REM ADD DIALOG "STORNO",6,121,89,50,11,0,0,StornoBetrag.KVERTRAG,20
     REM ADD DIALOG "STORNO",5,174,90,12,9,0,"DM"
 
     ADD DIALOG "STORNO",5,5,118,90,10,0,"Vertragsablaufdatum:"
     ADD DIALOG "STORNO",6,80,118,43,11,0,0,KÅndigung.KVERTRAG,10
     ADD DIALOG "STORNO",2,142,118,44,11,0,"vorzeitig?","j","n",vorzeitig.KVERTRAG
     ADD DIALOG "STORNO",5,5,136,140,10,0,"Buchungsdatum des Stornodatensatzes:"
     ADD DIALOG "STORNO",6,142,136,43,11,0,0,buchdat1$,10
 
     ADD DIALOG "STORNO",5,5,150,125,10,0,"Provisionsberechnung erfolgt bis zum:"
     ADD DIALOG "STORNO",6,142,150,43,11,0,0,TatsKuenDat.KVERTRAG,10
     einheit$ = "j"
     srkont$ = ""
     ADD DIALOG "STORNO",2,4,170,164,11,0,"Einheitenkonto runterrechnen ? ","j","n",einheit$
     ADD DIALOG "STORNO",4,0,185,202,50,0,"Optionen Stornokonto"
     REM ADD DIALOG "STORNO",2,4,195,184,11,0,"Stornokono anteilig runterrechnen?","j","n",srkont$
     REM ADD DIALOG "STORNO",2,4,207,184,11,0,"Storno komplett aus dem Stornokonto entnehmen?","j","n",srkont$
     optab% = 1
     ADD DIALOG "STORNO",3,4,195,183,10,0,"Stornokonto anteilig runterrechnen",1,optab%
     ADD DIALOG "STORNO",3,4,207,185,10,0,"Storno komplett aus dem Stornokonto entnehmen",2,optab%
     ADD DIALOG "STORNO",3,4,219,195,10,0,"Storno komplett aus der laufenden Provision entnehmen",3,optab%
 
 
     REM ADD DIALOG "STORNO",2,34,165,144,11,0,"evt. Stornores. nicht auszahlen ?","j","n",srno$
 
     ADD DIALOG "STORNO",4,0,240,202,30,0,""
     ADD DIALOG "STORNO",3,39,245,153,10,0,"Einjahresstorno",1,opt%
     ADD DIALOG "STORNO",3,39,257,155,10,0,"Mehrjahresstorno",2,opt%
 
     ADD DIALOG "STORNO",1,37,272,55,15,1,"&OK",1,1
     ADD DIALOG "STORNO",1,96,272,55,15,0,"&Abbrechen",0,0
     DIALOG "STORNO",req%
     REMOVE DIALOG "STORNO"
     IF optab% = 1 OR optab% = 2 THEN 
       srkont$ = "j"
     ELSE 
       srkont$ = "n"
     END IF 
   ELSE 
     stornowert% = 3
     kkuend$ = TODAY 
     vorzeitig$ = "j"
     CREATE DIALOG "STORNO",0,0,192,200,title$,"MS Sans Serif",8
     ADD DIALOG "STORNO",4,0,0,192,168,0,""
     ADD DIALOG "STORNO",9,8,14,20,21,2
     ADD DIALOG "STORNO",5,33,14,63,10,0,"Vertrag stornieren"
     ADD DIALOG "STORNO",4,33,21,151,5,0,""
     ADD DIALOG "STORNO",5,33,30,149,16,0,"Bitte geben Sie an, ob und wie der Vertrag storniert werden soll."
     ADD DIALOG "STORNO",5,33,60,149,36,0,"Sollen BetrÑge zurÅckgebucht werden,mÅssen Sie diese beim Zahlungseingang mit negativem Vorzeichen erfassen!"
     REM ADD DIALOG "STORNO",3,33,54,108,10,0,"Vertrag nicht stornieren",0,stornowert%
     IF GAFSK$ <> "TRUE" THEN 
       ADD DIALOG "STORNO",3,33,102,98,10,0,"ohne RÅckbuchung",3,stornowert%
     END IF 
     ADD DIALOG "STORNO",5,34,121,25,10,0,"Datum:"
     ADD DIALOG "STORNO",6,61,120,43,11,0,0,kkuend$,10
     ADD DIALOG "STORNO",2,113,120,44,11,0,"vorzeitig?","j","n",vorzeitig$
     ADD DIALOG "STORNO",1,37,172,55,15,1,"&OK",1,1
     ADD DIALOG "STORNO",1,96,172,55,15,0,"&Abbrechen",0,0
     DIALOG "STORNO",req%
     REMOVE DIALOG "STORNO"
     IF req% = 1 THEN 
       KÅndigung.KVERTRAG = kkuend$
       vorzeitig.KVERTRAG = vorzeitig$
       IF StorWarnJN.kvertrag = "j" THEN StorWarnJN.kvertrag = "c"
     END IF 
   END IF 
   REM DIALOG "STORNO",req%
   REM REMOVE DIALOG "STORNO"
   DATEBASE "0d.mm.yyyy"
   REM IF req% <> 1 THEN vstatus% = 2
   IF req% <> 1 THEN vstatus% = 0
   IF req% = 1 THEN 
     lfdnr% = lfdnr.kvertrag
     IF storno.kvertrag > 0 THEN 
       IF Proviab.kvertrag > 0 THEN 
         CALL Fehler("Der Vertrag wurde schon storniert!","Wenn Sie Korrekturen vornehmen wollen, mÅssen Sie den Vertrag zunÑcht deaktivieren und dann neu berechnen lassen. Danach kînnen Sie den Vertrag erneut stornieren!")
         GOTO EndStorno
       ELSE 
         IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
           REMOVE FROM FILE "Buchung" WHERE codevt.buchung = lfdnr%
         ELSE 
           REMOVE FROM FILE "Buchung1" WHERE codevt.buchung1 = lfdnr%
         END IF 
       END IF 
     ELSE 
       IF proviab.kvertrag < 1 THEN 
         IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
           REMOVE FROM FILE "Buchung" WHERE codevt.buchung = lfdnr%
         ELSE 
           REMOVE FROM FILE "Buchung1" WHERE codevt.buchung1 = lfdnr%
         END IF 
       END IF 
     END IF 
     REM 190398
     MOUSE OFF 
     IF buchdat1$ = "" THEN buchdat1$ = TODAY 
     IF NOT DateOK%(buchdat1$) THEN GOTO datok170698
     IF stordat1$ <> "" THEN 
       IF NOT DateOK%(stordat1$) THEN GOTO datok170698
     END IF 
     IF stornowert% = 4 AND stordat1$ = "" THEN 
       CALL Fehler("Sie haben die Option >alle Buchungen ab Datum stornieren< gewÑhlt, haben aber vergessen das Datumsfeld auszufÅllen!","")
     END IF 
     kÅnd% = KÅndigung.KVERTRAG
     IF KÅndigung.KVERTRAG < 1 THEN 
       KÅndigung.KVERTRAG = TODAY 
       kÅnd% = TODAY 
     END IF 
     kÅnd$ = KÅndigung.KVERTRAG
     REM CALL Fehler(kÅnd$,"")
     REM 230699
     IF NOT DateOK%( DATE$ (kÅnd%)) THEN GOTO datok170698
     REM 210597
     tkÅnd% = TatsKuenDat.KVERTRAG
     IF TatsKuenDat.KVERTRAG < 1 THEN 
       REM TatsKuenDat.KVERTRAG = TODAY 
       TatsKuenDat.KVERTRAG = kÅnd%
       REM tkÅnd% = TODAY 
       tkÅnd% = kÅnd%
     END IF 
     IF NOT DateOK%( DATE$ (tkÅnd%)) THEN GOTO datok170698
     IF TatsKuenDat.KVERTRAG < Proviab.kvertrag THEN 
       CALL Fehler ("Das Datum der Provisionsberechnung bis zum: " + DATE$ (tkÅnd%,"0d.mm.yyyy"),"mu· >= dem Datum der Provisionsberechnung ab:" + DATE$ (proviab.kvertrag,"0d.mm.yyyy") + "sein!")
       GOTO datok170698
     END IF 
       IF ProviAb.kvertrag > 0 AND ProviAb.kvertrag <= TODAY THEN 
         IF DAYS (KÅnd$) > 0 THEN 
           IF DAYS (KÅnd$) >= TODAY THEN 
             VertragAktiv.kvertrag = "j"
           ELSE 
             VertragAktiv.kvertrag = "n"
           END IF 
         ELSE 
           VertragAktiv.kvertrag = "j"
         END IF 
       ELSE 
         VertragAktiv.kvertrag = "n"
       END IF 
       IF TatsKuenDat.kvertrag > 0 THEN 
         IF TatsKuenDat.kvertrag >= TODAY THEN 
           VertragAktiv.kvertrag = "j"
         ELSE 
           VertragAktiv.kvertrag = "n"
         END IF 
       END IF 
     Storno.KVERTRAG = stornowert%
     CodeVStatus.kvertrag = 4
     VStatusTXT.kvertrag = "storniert"
     REM *************************************************************************************************************
     REM        fÅr Stornoverrechnung
     IF opt% = 1 THEN 
       StatusZOK.kvertrag = "ESTORNO"
     ELSE 
       StatusZOK.kvertrag = "MSTORNO"
     END IF 
     CALL ZentrAGZaehl(codema.kvertrag,StatusZOK.kvertrag,Bewertungssumme.kvertrag,Volumen.kvertrag,0,KÅndigung.KVERTRAG,0)
     REM *************************************************************************************************************
     CALL QuickStore("KVERTRAG")
     
     IF stornowert% = 1 OR stornowert% = 2 OR stornowert% = 4 THEN 
       SET STATUS "Stornobuchung wird durchgefÅhrt..."
       REMOVE FROM FILE "BUCHTEMP"
       REM - Provisionen in Datei BUCHTEMP Åbernehmen
       FILE "Stamm"
       SELECT FIRST 
       FILE "BUCHUNG"
       INDEX CodeVT.BUCHUNG
       SELECT FIRST 
       SELECT KEY vnr% FILE "BUCHUNG" INDEX CodeVT.BUCHUNG
       WHILE CodeVT.BUCHUNG = vnr% AND NOT EOF ("BUCHUNG")
         MOUSE OFF 
         SET STATUS "Stornobuchung wird durchgefÅhrt...(Zahlung vom " + DATE$ (Datum.BUCHUNG,"0d.mm.yyyy") + ")"
         ok% = - 1
         IF stornowert% = 4 THEN 
           IF datum.buchung < stordat1$ THEN ok% = 0
         ELSE 
           ok% = - 1
         END IF 
         IF ok% = - 1 THEN 
           BLANK FILE "BUCHTEMP"
           CodeBU.BUCHTEMP = SER ("BUCHTEMP",1)
           CodeVT.BUCHTEMP = CodeVT.BUCHUNG
           CodeMA.BUCHTEMP = CodeMA.BUCHUNG
           codew.Buchtemp = 3
           umrechnung.buchtemp = 1
           waehrung.buchtemp = "EUR"
           codeW% = 3
           euro1% = 1
           waehrung$ = "EUR"
           QuickCode.BUCHTEMP = CodeMA.BUCHTEMP * 1000000 + CodeVT.BUCHTEMP
           IF Storno.KVERTRAG = 1 OR stornowert% = 4 THEN 
             Betrag.BUCHTEMP = BetragEU.BUCHUNG
             IF einheit$ = "j" THEN Einheiten.buchtemp = Einheiten.Buchung
             REM IF srkont$ = "j" THEN SR.buchtemp = SR.Buchung
             SR.buchtemp = SREU.Buchung
           END IF 
           IF stornowert% <> 4 THEN 
             IF Storno.KVERTRAG = 2 THEN 
               Betrag.BUCHTEMP = BetragEU.Buchung / 100 * StornoAnteil.KVERTRAG
               IF einheit$ = "j" THEN Einheiten.BUCHTEMP = Einheiten.Buchung / 100 * StornoAnteil.KVERTRAG
               REM IF srkont$ = "j" THEN SR.BUCHTEMP = SR.Buchung / 100 * StornoAnteil.KVERTRAG
               SR.BUCHTEMP = SREU.Buchung / 100 * StornoAnteil.KVERTRAG
             END IF 
           END IF 
           CALL QuickStore("BUCHTEMP")
         END IF 
         SELECT NEXT FILE "BUCHUNG" INDEX CodeVT.BUCHUNG
       WEND 
       REM CALL Fehler("Storno1","")
       REM - Summen aus BUCHTEMP bilden - und irgendwie mit AUMSATZ verrechnen
 
       IF RECCOUNT ("BUCHTEMP") <> 0 THEN 
         FILE "BUCHTEMP"
         INDEX QuickCode.BUCHTEMP
         SELECT FIRST 
         WHILE NOT EOF ("BUCHTEMP")
           quickcode% = QuickCode.BUCHTEMP
           summe% = 0
           SummeEinh% = 0
           SummeSR% = 0
           codematmp% = CodeMA.BUCHTEMP
           SELECT KEY CodeMAtmp% LOCK FILE "MAADR" INDEX CodeMA.MAADR
           SET STATUS "Stornobuchung wird durchgefÅhrt...(Agentur " + Nachname.MAADR + ", " + Vorname.MAADR + ")"
           WHILE QuickCode.BUCHTEMP = quickcode% AND NOT EOF ("BUCHTEMP")
             Summe% = Summe% + Betrag.BUCHTEMP
             IF einheit$ = "j" THEN SummeEinh% = SummeEinh% + Einheiten.BUCHTEMP
             REM IF srkont$ = "j" THEN SummeSR% = SummeSR% + SR.Buchtemp
             SummeSR% = SummeSR% + SR.Buchtemp
             SELECT NEXT FILE "BUCHTEMP" INDEX QuickCode.BUCHTEMP
           WEND 
           REM CALL Fehler("Storno2","")
           IF summe% <> 0 THEN 
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             BLANK FILE "BUCHUNG"
             CodeBU.BUCHUNG = SER ("BUCHUNG",1)
             codew.buchung = 3
             umrechnung.buchung = 1
             waehrung.buchung = "EUR"
             REM 06052003
             IF optab% = 1 THEN 
               srkont$ = "j"
               REM anteilig aus SR und Prov
               sr1% = stornoreserve.maadr
               sr2% = Stornoab.maadr
               IF stornoreserve.maadr >= Stornoab.maadr AND StornoVerrech.maadr <> "j" THEN 
                 REM auf dem Stornoreservekonto ist ein Guthaben
                 SR.Buchung = 0 - SummeSR%
               ELSE 
                 REM auf dem Stornoreservekonto ist kein oder weniger Guthaben
                 CALL Fehler("Das Guthaben des Stornoreserve-Konto des Mitarbeiter " + Nachname.maadr,"ist kleiner als das Betrag der SR-Auszahlungsschwelle")
                 REQUEST "Soll trotzdem der Betrag aus der SR genommen werden?","",135,req%
                 IF req% = 1 THEN 
                   SR.Buchung = 0 - SummeSR%
                 ELSE 
                   SR.Buchung = 0
                   Summe% = Summe% + SummeSR%
                 END IF 
               END IF 
             END IF 
             IF optab% = 2 THEN 
               REM komplett aus Storno
               srkont$ = "j"
               IF stornoreserve.maadr >= Stornoab.maadr AND StornoVerrech.maadr <> "j" THEN 
                 SummeSR% = Summe% + SummeSR%
                 SR.Buchung = 0 - SummeSR%
                 Summe% = 0
               ELSE 
                 CALL Fehler("Das Guthaben des Stornoreserve-Konto des Mitarbeiter " + Nachname.maadr,"ist kleiner als das Betrag der SR-Auszahlungsschwelle")
                 REQUEST "Soll trotzdem der Betrag aus der SR genommen werden?","",135,req%
                 IF req% = 1 THEN 
                   SummeSR% = Summe% + SummeSR%
                   SR.Buchung = 0 - SummeSR%
                   Summe% = 0
                 ELSE 
                   SR.Buchung = 0
                   Summe% = Summe% + SummeSR%
                 END IF 
               END IF 
             END IF 
             IF optab% = 3 THEN 
               REM komplett aus der Provision
               SR.Buchung = 0
               Summe% = Summe% + SummeSR%
             END IF 
             IF einheit$ = "j" THEN Einheiten.Buchung = 0 - SummeEinh%
             Betrag.BUCHUNG = 0 - Summe%
             BetragEU.buchung = VAL ( STR$ (Betrag.Buchung / umrechnung.buchung,"999999999.00"))
             NettoEU.buchung = BetragEU.buchung
             srEU.buchung = VAL ( STR$ (SR.buchung / umrechnung.buchung,"999999999.00"))
             Nachname.BUCHUNG = Nachname.GAdrDat$
             Vorname.Buchung = Vorname.GAdrDat$
             Sparte.BUCHUNG = Sparte.SPARTEN
             Gesellschaft.BUCHUNG = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG = Bewertungssumme.KVERTRAG
             BewertungssumEU.BUCHUNG = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
             Buchungstext.BUCHUNG = "StornorÅckbuch.zum " + DATE$ (kÅnd%,"0d.mm.yyyy") + " zum Vertr. " + VS_NR.KVERTRAG
             IF KÅndigung.maadr > 0 AND StornoNachf.maadr = "j" THEN 
               Nachf% = Nachfolger.maadr
               IF DAYS (buchdat1$) >= KÅndigung.maadr THEN 
                 SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
                 SELECT KEY Nachf% LOCK FILE "MAADR" INDEX CodeMA.MAADR
                 CodeMA.BUCHUNG = codema.maadr
                 agentur.buchung = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
                 SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
                 SELECT KEY CodeMAtmp% LOCK FILE "MAADR" INDEX CodeMA.MAADR
               END IF 
             ELSE 
               CodeMA.BUCHUNG = CodeMA.MAADR
               agentur.buchung = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
             END IF 
             CodeKU.BUCHUNG = CodeKU.KVERTRAG
             CodeVT.BUCHUNG = lfdnr.KVERTRAG
             REM 210597
             REM Datum.BUCHUNG = KÅndigung.KVERTRAG
             REM 170698
             REM IF TatsKuenDat.KVERTRAG >= KÅndigung.KVERTRAG THEN 
               REM Datum.BUCHUNG = TODAY 
             REM ELSE 
               REM Datum.BUCHUNG = KÅndigung.KVERTRAG
             REM END IF 
             Datum.BUCHUNG = buchdat1$
             REM 210597
             KÅndigung.Buchung = KÅndigung.KVERTRAG
             CALL QuickStore("BUCHUNG")
             REM 220697
             IF srkont$ = "j" OR einheit$ = "j" THEN 
               FILE "maadr"
               SELECT FIRST 
               SELECT KEY CodeMAtmp% LOCK FILE "MAADR" INDEX CodeMA.MAADR
               IF srkont$ = "j" THEN 
                 IF stornoreserve.maadr > Stornoab.maadr AND StornoVerrech.maadr <> "j" THEN 
                   Stornoreserve.maadr = Stornoreserve.maadr - SummeSR%
                   StornoreserveEU.maadr = VAL ( STR$ (Stornoreserve.maadr / umrechnung.stamm,"999999999.00"))
                 END IF 
               END IF 
               IF einheit$ = "j" THEN Einheiten.maadr = Einheiten.maadr - SummeEinh%
               CALL QuickStore("maadr")
               FILE "Buchtemp"
             END IF 
           END IF 
           REM CALL Fehler("REMOVE FROM FILE BUCHTEMP WHERE QuickCode.BUCHTEMP = QuickCode%","")
           SELECT FIRST FILE "BUCHTEMP" INDEX QuickCode.BUCHTEMP
           REMOVE FROM FILE "BUCHTEMP" WHERE QuickCode.BUCHTEMP = quickcode%
           SELECT WHERE FILE "BUCHTEMP"
           SELECT FIRST FILE "BUCHTEMP" INDEX QuickCode.BUCHTEMP
         WEND 
       END IF 
     ELSE 
       IF stornowert% = 3 THEN 
         IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
             CALL DFile(3,"buchung" + _fpw$)
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             BLANK FILE "BUCHUNG"
             CodeBU.BUCHUNG = SER ("BUCHUNG",1)
             codew.buchung = 3
             umrechnung.buchung = 1
             waehrung.buchung = "EUR"
             Betrag.BUCHUNG = 0
             SR.Buchung = 0
             Einheiten.Buchung = 0
             BetragEU.buchung = 0
             NettoEU.buchung = BetragEU.buchung
 
             srEU.buchung = 0
             Nachname.BUCHUNG = Nachname.GAdrDat$
             Vorname.Buchung = Vorname.GAdrDat$
             Sparte.BUCHUNG = Sparte.SPARTEN
             Gesellschaft.BUCHUNG = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG = Bewertungssumme.KVERTRAG
             BewertungssumEU.BUCHUNG = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
             Buchungstext.BUCHUNG = "StornorÅckbuch.zum " + DATE$ (kÅnd%,"0d.mm.yyyy") + " zum Vertr. " + VS_NR.KVERTRAG
             CodeMA.BUCHUNG = CodeMA.MAADR
             CodeKU.BUCHUNG = CodeKU.KVERTRAG
             CodeVT.BUCHUNG = lfdnr.KVERTRAG
             Datum.BUCHUNG = buchdat1$
             REM 210597
             KÅndigung.Buchung = KÅndigung.KVERTRAG
             CALL QuickStore("BUCHUNG")
         ELSE 
           IF GAFSK$ <> "TRUE" THEN 
             REQUEST "Wollen Sie einen Storno-Buchungssatz mit NULL-Werten erzeugen lassen?","",130,req1%
           ELSE 
             req1% = 0
             codevt% = codevt.kvfael
             IF EXISTS (codevt%,codevt.kvfael) THEN 
               IF gez_Abschlu·.kvfael = "j" THEN 
                 codevt% = codevt.kvfael
                 CALL AFSKHandStor(codevt%)
               END IF 
             END IF 
           END IF 
           IF req1% = 1 THEN 
             CALL DFile(3,"buchung1" + _fpw$)
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             BLANK FILE "BUCHUNG1"
             CodeBU.BUCHUNG1 = SER ("BUCHUNG1",1)
             codew.buchung1 = 3
             umrechnung.buchung1 = 1
             waehrung.buchung1 = "EUR"
             Agentur.buchung1 = Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr
             Betrag.BUCHUNG1 = 0
             SR.Buchung1 = 0
             Einheiten.Buchung1 = 0
             BetragEU.buchung1 = 0
             NettoEU.buchung1 = BetragEU.buchung1
 
             srEU.buchung1 = 0
             Nachname.BUCHUNG1 = Nachname.GAdrDat$
             Vorname.Buchung1 = Vorname.GAdrDat$
             Sparte.BUCHUNG1 = Sparte.SPARTEN
             Gesellschaft.BUCHUNG1 = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG1 = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG1 = Bewertungssumme.KVERTRAG
             BewertungssumEU.BUCHUNG1 = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
             Buchungstext.BUCHUNG1 = "StornorÅckbuch.zum " + DATE$ (kÅnd%,"0d.mm.yyyy") + " zum Vertr. " + VS_NR.KVERTRAG
             CodeMA.BUCHUNG1 = CodeMA.MAADR
             CodeKU.BUCHUNG1 = CodeKU.KVERTRAG
             CodeVT.BUCHUNG1 = lfdnr.KVERTRAG
             Datum.BUCHUNG1 = buchdat1$
             REM 210597
             KÅndigung.Buchung1 = KÅndigung.KVERTRAG
             CALL QuickStore("BUCHUNG1")
           END IF 
         END IF 
       END IF 
     END IF 
   END IF 
 END IF 
EndStorno: 
 FILE cfile$
 SET STATUS "Bereit"
 IF FORM <> "" THEN FORM 
 MOUSE ON 
 END SUB 
 
  
 ' vorhandene Stornoreserve fÅr einen Vertrag ermitteln
 ' wird z.Zt. nur von VStatus() benutzt
 ' =======================================================================
 ' 05.09.95 
 
FUNCTION GetSR%(vnr%)
 cfile$ = FILE 
 MOUSE OFF 
 IF EXISTS (vnr%,CodeVT.BUCHUNG) THEN 
   FILE "BUCHUNG"
   INDEX CodeVT.BUCHUNG
   SELECT FIRST 
   sr% = 0
   SELECT KEY lfdnr.KVERTRAG FILE "BUCHUNG" INDEX CodeVT.BUCHUNG
   WHILE CodeVT.BUCHUNG = lfdnr.KVERTRAG AND NOT EOF ("BUCHUNG")
     IF SRgezahlt.BUCHUNG <> "j" AND SR.BUCHUNG <> 0 THEN 
       sr% = sr% + SR.BUCHUNG
     END IF 
     SELECT NEXT FILE "BUCHUNG" INDEX CodeVT.BUCHUNG
   WEND 
   GetSR% = sr%
 ELSE 
   GetSR% = 0
 END IF 
 FILE cfile$
 MOUSE ON 
 END FUNCTION 
 
  
SUB VertrKond()
 IF disabled%("GEKOND") THEN END SUB 
 doprov% = EditKond%(CodeKO.KVERTRAG,0)
 MOUSE ON 
 END SUB 

SUB VertrKondBu1()
 cuvt% = codevt.buchung1
 IF disabled%("GEKOND") THEN END SUB 
 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
 SELECT KEY cuvt% FILE "kvertrag" INDEX lfdnr.kvertrag
 doprov% = EditKond%(CodeKO.KVERTRAG,1)
 MOUSE ON 
 END SUB 


SUB VertrKondBu()
 cuvt% = codevt.buchung
 IF disabled%("GEKOND") THEN END SUB 
 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
 SELECT KEY cuvt% FILE "kvertrag" INDEX lfdnr.kvertrag
 doprov% = EditKond%(CodeKO.KVERTRAG,1)
 MOUSE ON 
 END SUB 
 
 
SUB ZEKondShow()
 IF disabled%("GEKOND") THEN END SUB 
 doprov% = EditKond%(CodeKO.KVERTRAG, - 1)
 END SUB 
 
 
 
 REM *********************************************************************************
 REM *          Feststellung der vergebenen Firmenkondition fÅr RealCash ZE          *
 REM *  01.10.2001                                                                   *
 REM *********************************************************************************
 
FUNCTION ZwFirmKond$(kond%)
 _kond% = kond%
 HaftVertrag% = SRHaftung.kvertrag
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 DIM Auswahl$(1)
 DIM KondList$(100,1)
 
 changing% = 1
 
 
   ok% = 1
   REDIM KondList$(100,1)
   REDIM KondList$(100)
   REM FOR a% = 0 TO 100
     REM Kondlist$(a%) = ""
   REM NEXT a%
   
   a% = 0
 
   WHILE ok% = 1
     MOUSE OFF 
     SELECT KEY _kond% FILE "VKOND" INDEX CodeVK.VKOND
     SELECT KEY CodeKO.VKOND FILE "GEKOND" INDEX lfdnr.GEKOND
     SELECT KEY CodeMA.GEKOND FILE "MAADR" INDEX CodeMA.MAADR
     ListItem$ = ""
     notiz$ = ""
     IF notiz.gekond <> "" THEN notiz$ = " - " + notiz.gekond
     IF Geinh% = 0 THEN 
       IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         
         IF APjn.gekond = "j" THEN 
           IF APEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; AP Eu/Einh: " + LTRIM$ ( STR$ (APEurEinh.GEKOND,",999999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; AP Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
           END IF 
         END IF 
         IF CourtageJN.gekond = "j" THEN 
           IF CourtEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (CourtEurEinh.GEKOND,",999999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
           END IF 
         END IF 
         IF PflegeJN.gekond = "j" THEN 
           IF PflEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (PflEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
         IF DynamikPjn.gekond LIKE "j" THEN 
           IF DynEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (DynEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
         IF Betreujn.gekond LIKE "j" THEN 
           IF FolgEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (FolgEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
       ELSE 
         IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; AP " + STR$ (AP.GEKOND,",999.000") + "% "
         IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage " + STR$ (Courtage.GEKOND,",999.000") + "% "
         IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
         IF VDjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu· (LZ)"
         IF TZjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Teilzahlung"
         IF PauschaleJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pauschale " + STR$ (Pauschale.GEKOND,",99999.000")
         a$ = VSVjn.gekond
         IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
       END IF 
     ELSE 
       IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; AP Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage  Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
       IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
     END IF 
     REM 201299
     IF srjn.gekond = "j" AND sr.gekond <> 0 THEN 
       ListItem$ = ListItem$ + "; Storno " + STR$ (sr.GEKOND,"999.000")
       IF HaftVertrag% <> 0 THEN 
         IF HaftVertrag% <> - 1 THEN 
           ListItem$ = ListItem$ + "; Haftung " + STR$ (HaftVertrag%,"999.") + " Monate"
         ELSE 
           ListItem$ = ListItem$ + "; Haftung unbegrenzt"
         END IF 
       ELSE 
         IF haftung.gekond <> - 1 THEN 
           ListItem$ = ListItem$ + "; Haftung " + STR$ (haftung.GEKOND,"999.") + " Monate"
         ELSE 
           ListItem$ = ListItem$ + "; Haftung unbegrenzt"
         END IF 
       END IF 
     END IF 
     listitem$ = listitem$ + "/BWVON:" + DATE$ (bwvon.gekond,"0d.mm.yyyy")
     IF bwbis.gekond > 0 THEN listitem$ = listitem$ + "/BWBIS:" + DATE$ (bwbis.gekond,"0d.mm.yyyy")
     IF agenturnr.maadr <> "" THEN 
       KondList$(a%) = ListItem$ + notiz$ + SPACE$ (120) + STR$ (CodeVK.VKOND,"000000")
     ELSE 
       KondList$(a%) = ListItem$ + notiz$ + SPACE$ (120) + STR$ (CodeVK.VKOND,"000000")
     END IF 
     IF nÑchsteKond.VKOND <> 0 THEN 
       _kond% = nÑchsteKond.VKOND
       a% = a% + 1
     ELSE 
       ok% = 0
     END IF 
     REM nur Mitarbeiterkondition aneigen, deshalb nach der 1.Kondition abbrechen
     ok% = 0
   WEND 
   ZwFirmKond$ = KondList$(0)
   REM IF a% > 0 THEN 
     REM nur Mitarbeiterkondition aneigen
     REM ZwFirmKond$ = KondList$(a%)
     REM ZwFirmKond$ = KondList$(0)
   REM ELSE 
     REM ZwFirmKond$ = ""
   REM END IF 
 END FUNCTION 
 
 
 
 
 REM onlyshow% - fÅr nur anschauen
FUNCTION EditKond%(kond%,onlyshow%)
 _kond% = kond%
 HaftVertrag% = SRHaftung.kvertrag
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 DIM Auswahl$(1)
 DIM KondList$(100,1)
 CodeEingGE% = CodeEingGE.Kvertrag
 changing% = 1
 REM CALL Fehler("Konditionen","16022006")
anf300920074: 
 REDIM KondList$(100,1)

 WHILE changing% = 1
   ok% = 1
   REDIM KondList$(100,1)
   REDIM KondList$(100)
   REM FOR a% = 0 TO 100
     REM Kondlist$(a%) = ""
   REM NEXT a%
   
   a% = 0
 
   WHILE ok% = 1
     SELECT KEY _kond% FILE "VKOND" INDEX CodeVK.VKOND
     SELECT KEY CodeKO.VKOND FILE "GEKOND" INDEX lfdnr.GEKOND
     SELECT KEY CodeMA.GEKOND FILE "MAADR" INDEX CodeMA.MAADR
     ListItem$ = ""
     notiz$ = ""
     IF notiz.gekond <> "" THEN notiz$ = " - " + notiz.gekond
     IF Geinh% = 0 THEN 
       IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         
         IF APjn.gekond = "j" THEN 
           IF APEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; AP Eu/Einh: " + LTRIM$ ( STR$ (APEurEinh.GEKOND,",999999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; AP Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
           END IF 
         END IF 
         IF CourtageJN.gekond = "j" THEN 
           IF CourtEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (CourtEurEinh.GEKOND,",999999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
           END IF 
         END IF 
         IF PflegeJN.gekond = "j" THEN 
           IF PflEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (PflEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
         IF DynamikPjn.gekond LIKE "j" THEN 
           IF DynEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (DynEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
         IF Betreujn.gekond LIKE "j" THEN 
           IF FolgEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (FolgEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
       ELSE 
         IF CodeEingGE% > 0 THEN 
           REM IF CodeEingGE.gekond <> CodeEingGE% GOTO nextko300920075
         END IF 
         IF APjn.gekond = "j" THEN 
           ListItem$ = ListItem$ + "; AP " + STR$ (AP.GEKOND,",999.000") + "% "
         ELSE 
           IF APKVMonatJN.gekond LIKE "j" THEN 
             ListItem$ = ListItem$ + "; APKV " + STR$ (KVMonatFakt.GEKOND,",999.000") + " MB "
           END IF 
           IF APPfMonatJN.gekond LIKE "j" THEN 
             ListItem$ = ListItem$ + "; APPfl " + STR$ (PflMonatFakt.GEKOND,",999.000") + " MB "
           END IF 
         END IF 
         IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage " + STR$ (Courtage.GEKOND,",999.000") + "% "
         IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
         IF VDjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu· (LZ)"
         IF TZjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Teilzahlung"
         IF PauschaleJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pauschale " + STR$ (Pauschale.GEKOND,",99999.000")
         a$ = VSVjn.gekond
         IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
       END IF 
     ELSE 
       IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; AP Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage  Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
       IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
     END IF 
     REM 201299
     IF srjn.gekond = "j" AND sr.gekond <> 0 THEN 
       ListItem$ = ListItem$ + "; Storno " + STR$ (sr.GEKOND,"999.000")
       IF HaftVertrag% <> 0 THEN 
         IF HaftVertrag% <> - 1 THEN 
           ListItem$ = ListItem$ + "; Haftung " + STR$ (HaftVertrag%,"999.") + " Monate"
         ELSE 
           ListItem$ = ListItem$ + "; Haftung unbegrenzt"
         END IF 
       ELSE 
         IF haftung.gekond <> - 1 THEN 
           ListItem$ = ListItem$ + "; Haftung " + STR$ (haftung.GEKOND,"999.") + " Monate"
         ELSE 
           ListItem$ = ListItem$ + "; Haftung unbegrenzt"
         END IF 
       END IF 
     END IF 
     listitem$ = listitem$ + "/BWVON:" + DATE$ (bwvon.gekond,"0d.mm.yyyy")
     m$ = "maadr"
     IF bwbis.gekond > 0 THEN listitem$ = listitem$ + "/BWBIS:" + DATE$ (bwbis.gekond,"0d.mm.yyyy")
     IF agenturnr.maadr <> "" THEN 
       IF KÅndigung.maadr > 0 THEN 
 KondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.m$) + ", " + LTRIM$ (Vorname.m$) + ", " + TRIM$ (Agenturnr.m$) + ListItem$ + notiz$ + " - KÅnd.:" + DATE$ (KÅndigung.m$,"0d.mm.yyyy")
       ELSE 
         KondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.m$) + ", " + LTRIM$ (Vorname.m$) + ", " + TRIM$ (Agenturnr.m$) + ListItem$ + notiz$
       END IF 
     ELSE 
       IF KÅndigung.maadr > 0 THEN 
         KondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.m$) + ", " + LTRIM$ (Vorname.m$) + ListItem$ + notiz$ + " - KÅnd.:" + DATE$ (KÅndigung.m$,"0d.mm.yyyy")
       ELSE 
         KondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.m$) + ", " + LTRIM$ (Vorname.M$) + ListItem$ + notiz$
       END IF 
     END IF 
     IF EingereichtBei.gekond <> "" THEN 
       KondList$(a%) = KondList$(a%) + "/eingereicht Åber: " + EingereichtBei.gekond
     END IF 
     KondList$(a%) = KondList$(a%) + SPACE$ (120) + STR$ (CodeVK.VKOND,"000000")
     IF nÑchsteKond.VKOND <> 0 THEN 
       _kond% = nÑchsteKond.VKOND
       a% = a% + 1
     ELSE 
       ok% = 0
     END IF 
   WEND 
   REM FOR a% = 1 TO 10
   REM   KondList$(a%) = STR$ (a%,"999") + ". " + KondList$(0)
   REM NEXT a%
   prompt$ = KondList$(0)
   CREATE DIALOG "KONDLIST",0,0,555,320,"KonditionsÅbersicht","Arial",8
   ADD DIALOG "KONDLIST",4,0,0,554,337,0,""
   ADD DIALOG "KONDLIST",9,9,11,21,21,2
   ADD DIALOG "KONDLIST",5,44,15,150,10,0,"KonditionsÅbersicht fÅr den aktuellen Vertrag:"
   IF onlyshow% = 0 THEN 
     ADD DIALOG "KONDLIST",5,44,29,262,18,0,"BestÑtigen Sie mit " + CHR$ (34) + "OK" + CHR$ (34) + " die Richtigkeit der gefundenen Konditonen oder wÑhlen Sie die richtigen Konditionen aus."
     ADD DIALOG "KONDLIST",5,44,49,256,23,0,"Um eine der angezeigten Konditionen zu Ñndern, wÑhlen Sie mit der Maus eine Kondition aus und klicken anschlie·end auf die SchaltflÑche " + CHR$ (34) + "éndern" + CHR$ (34) + "."
   END IF 
   IF onlyshow% = 0 THEN 
     ADD DIALOG "KONDLIST",7,4,78,546,219,2,2,KondList$,Auswahl$,prompt$
   ELSE 
     ADD DIALOG "KONDLIST",7,4,28,546,269,2,2,KondList$,Auswahl$,prompt$
   END IF 
   IF onlyshow% = 0 THEN 
     ADD DIALOG "KONDLIST",1,151,302,55,15,0,"é&ndern",2,1
     ADD DIALOG "KONDLIST",1,209,302,55,15,1,"&OK",1,1
   END IF 
   ADD DIALOG "KONDLIST",1,67,302,81,15,0,"gehe zur Kondition",3,1
   ADD DIALOG "KONDLIST",1,287,302,55,15,0,"&Abbrechen",0,0
   DIALOG "KONDLIST",req%
   REMOVE DIALOG "KONDLIST"
   IF req% = 1 THEN 
     EditKond% = 1
     changing% = 0
   END IF 
   IF req% = 0 THEN 
     EditKond% = 0
     changing% = 0
   END IF 
   IF req% = 2 THEN CALL ChangeKond( VAL ( RIGHT$ (Auswahl$(0),6)))
   IF req% = 3 THEN CALL GoToKond( VAL ( RIGHT$ (Auswahl$(0),6)))
   _kond% = kond%
 WEND 
 END FUNCTION 
 
SUB GoToKond(codevk%)
  cuvt% = lfdnr.KVERTRAG
  knr% = codeku.kvertrag
  foo$ = FORM 
  SELECT FIRST FILE "vkond" INDEX codevk.vkond
  SELECT KEY codevk% FILE "vkond" INDEX codevk.vkond
  SELECT FIRST FILE "GEKOND" INDEX lfdnr.GEKOND
  SELECT KEY CodeKO.VKOND FILE "GEKOND" INDEX lfdnr.GEKOND
  codelfdnr$ = STR$ (lfdnr.GEKOND,"000000")
  Glfdnr% = lfdnr.gekond
  cuma% = codema.gekond
  CALL GEKOND()
  Glfdnr% = 0
  OPEN FORM GPrjForm$ + foo$
  LGDV$ = sparte.sparten
  SET f = Superbase.Form
  SELECT FIRST FILE gadrdat$ INDEX codeku.gadrdat$
  SELECT KEY knr% FILE gadrdat$ INDEX codeku.gadrdat$
  CALL VERTRIntro(1)
     IF anrede.GAdrDat$ LIKE "Her*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
       n$ = LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Vorname.GAdrDat$)
       SET HEADING "VertrÑge von: " + LEFT$ (n$,60)
     ELSE 
       n$ = LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Geburtsname.GAdrDat$)
       n% = LEN (n$)
       SET HEADING "VertrÑge von: " + LEFT$ (n$,60)
     END IF 
  CALL MNVERTR()
 END SUB 

SUB ChangeKond(ckond%)
 REM REQUEST STR$ (ckond%,"000000")
 DIM KondFound$(1000)
 DIM Auswahl$(1)
 SELECT KEY ckond% LOCK FILE "VKOND" INDEX CodeVK.VKOND
 SELECT KEY CodeKO.VKOND FILE "GEKOND" INDEX lfdnr.GEKOND
 SELECT KEY CodeMA.GEKOND FILE "MAADR" INDEX CodeMA.MAADR
 _cuko% = lfdnr.GEKOND
 geadr% = CodeGE.GEKOND
 sparte% = CodeVA.GEKOND
 ma% = CodeMA.GEKOND
 FILE "GEKOND"
 INDEX QuickCode.GEKOND
 scode$ = STR$ (ma%,"000000") + STR$ (geadr%,"000000") + STR$ (sparte%,"000000")
 SELECT FIRST 
 SELECT KEY scode$ FILE "GEKOND" INDEX QuickCode.GEKOND
 a% = 0
 prompt$ = ""
 WHILE QuickCode.GEKOND LIKE scode$ AND NOT EOF ("GEKOND")
   IF BWvon.GEKOND < 1 THEN BWvon$ = "__.__.____" ELSE BWvon$ = DATE$ (BWvon.GEKOND,"0d.mm.yyyy")
   IF BWbis.GEKOND < 1 THEN BWbis$ = "__.__.____" ELSE BWbis$ = DATE$ (BWbis.GEKOND,"0d.mm.yyyy")
   ListItem$ = ""
   notiz$ = ""
   IF notiz.gekond <> "" THEN notiz$ = " - " + notiz.gekond
   IF Geinh% = 0 THEN 
     IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       IF APjn.gekond = "j" THEN 
         IF APEurEinh.gekond <> 0 THEN 
           ListItem$ = ListItem$ + "; AP Eur/Ein: " + LTRIM$ ( STR$ (APEurEinh.GEKOND,",999999.00"))
         ELSE 
           ListItem$ = ListItem$ + "; AP Eur/Ein: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
         END IF 
       END IF 
       IF CourtageJN.gekond = "j" THEN 
         IF CourtEurEinh.gekond <> 0 THEN 
           ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (CourtEurEinh.GEKOND,",999999.00"))
         ELSE 
           ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
         END IF 
       END IF 
       IF PflegeJN.gekond = "j" THEN 
         IF PflEurEinh.gekond <> 0 THEN 
           ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (PflEurEinh.GEKOND,",99999.000"))
         ELSE 
           ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.000"))
         END IF 
       END IF 
       IF DynamikPjn.gekond LIKE "j" THEN 
         IF DynEurEinh.gekond <> 0 THEN 
           ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (DynEurEinh.GEKOND,",99999.000"))
         ELSE 
           ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.000"))
         END IF 
       END IF 
       IF Betreujn.gekond LIKE "j" THEN 
         IF FolgEurEinh.gekond <> 0 THEN 
           ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (FolgEurEinh.GEKOND,",99999.000"))
         ELSE 
           ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.000"))
         END IF 
       END IF 
     ELSE 
       IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; AP " + STR$ (AP.GEKOND,",999.000") + "% "
       IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage " + STR$ (Courtage.GEKOND,",999.000") + "% "
       IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
       IF VDjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu· (LZ)"
       IF TZjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Teilzahlung"
       IF PauschaleJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pauschale " + STR$ (Pauschale.GEKOND,",99999.000")
       IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
       IF DynamikPjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; Dynamik(AP) " + STR$ (DynamikProz.GEKOND,",99999.000")
       IF Betreujn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; Betreuung(Pflege) " + STR$ (BetreuProz.GEKOND,",99999.000")
     END IF 
   ELSE 
     IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; AP Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
     IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage  Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
     IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
     IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
   END IF 

   KondFound$(a%) = BWvon$ + "-" + BWbis$ + ListItem$ + notiz$
   IF EingereichtBei.gekond <> "" THEN 
     KondFound$(a%) = KondFound$(a%) + "/eingereicht Åber: " + LTRIM$ (EingereichtBei.gekond)
   END IF 
   KondFound$(a%) = KondFound$(a%) + SPACE$ (120) + STR$ (lfdnr.GEKOND,"000000")
   IF lfdnr.GEKOND = _cuko% THEN prompt$ = KondFound$(a%)
   a% = a% + 1
   SELECT NEXT FILE "GEKOND" INDEX QuickCode.GEKOND
 WEND 
 IF prompt$ = "" THEN prompt$ = KondFound$(0)
 IF a% <> 0 THEN a% = a% - 1
 SELECT KEY geadr% FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY sparte% FILE "SPARTEN" INDEX CodeVA.SPARTEN
 CREATE DIALOG "SELGEKOND",0,0,426,251,"Konditionsauswahl: " + Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + "., " + Gesellschaft.GEADR + "/" + Sparte.SPARTEN,"MS Sans Serif",8
 ADD DIALOG "SELGEKOND",4,0,0,425,220,0,""
 ADD DIALOG "SELGEKOND",9,9,16,21,25,2
 ADD DIALOG "SELGEKOND",5,38,16,205,10,0,"WÑhlen Sie die Kondition aus, die Sie Åbernehmen mîchten:"
 ADD DIALOG "SELGEKOND",5,40,31,130,9,0,"Bewertungszeitraum, Kondition"
 ADD DIALOG "SELGEKOND",7,4,42,409,169,2,2,KondFound$,Auswahl$,prompt$
 ADD DIALOG "SELGEKOND",1,130,227,58,17,1,"&OK",1,1
 ADD DIALOG "SELGEKOND",1,190,227,60,17,0,"&Abbrechen",0,0
 DIALOG "SELGEKOND",req%
 REMOVE DIALOG "SELGEKOND"
 IF req% = 1 THEN 
   CodeKO.VKOND = VAL ( RIGHT$ (Auswahl$(0),6))
   Workstation.VKOND = Workstation%
   QWoNo.VKOND = STR$ (Workstation%,"000000") + STR$ (codeko.VKOND,"000000")
   RecStatus.VKOND = "c"
   STORE FILE "VKOND"
 END IF 
 END SUB 
 
 
 REM onlyshow% - fÅr nur anschauen
FUNCTION EditKondSpez%(kond%,onlyshow%)
 _kond% = kond%
 HaftVertrag% = SRHaftung.kvertrag
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond1" + _fpw$)
 DIM Auswahl$(1)
 REDIM GKondList$(100,1)
 
 changing% = 1
 
 WHILE changing% = 1
   ok% = 1
   REDIM GKondList$(100,1)
   REDIM GKondList$(100)
   REM FOR a% = 0 TO 100
     REM Kondlist$(a%) = ""
   REM NEXT a%
   
   a% = 0
 
   WHILE ok% = 1
     SELECT KEY _kond% FILE "vkond1" INDEX CodeVK.vkond1
     SELECT KEY CodeKO.vkond1 FILE "GEKOND" INDEX lfdnr.GEKOND
     SELECT KEY CodeMA.GEKOND FILE "MAADR" INDEX CodeMA.MAADR
     ListItem$ = ""
     notiz$ = ""
     IF notiz.gekond <> "" THEN notiz$ = " - " + notiz.gekond
     REM 29082005
     IF Geinh% = 0 THEN 
       IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         
         IF APjn.gekond = "j" THEN 
           IF APEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; AP Eu/Einh: " + LTRIM$ ( STR$ (APEurEinh.GEKOND,",999999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; AP Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
           END IF 
         END IF 
         IF CourtageJN.gekond = "j" THEN 
           IF CourtEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (CourtEurEinh.GEKOND,",999999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Court Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
           END IF 
         END IF 
         IF PflegeJN.gekond = "j" THEN 
           IF PflEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (PflEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Pflege Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
         IF DynamikPjn.gekond LIKE "j" THEN 
           IF DynEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (DynEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Dynamik(AP) Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
         IF Betreujn.gekond LIKE "j" THEN 
           IF FolgEurEinh.gekond <> 0 THEN 
             ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (FolgEurEinh.GEKOND,",99999.00"))
           ELSE 
             ListItem$ = ListItem$ + "; Folgeprov. Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",99999.00"))
           END IF 
         END IF 
       ELSE 
         IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; AP " + STR$ (AP.GEKOND,",999.000") + "% "
         IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage " + STR$ (Courtage.GEKOND,",999.000") + "% "
         IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
         IF VDjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu· (LZ)"
         IF TZjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Teilzahlung"
         IF PauschaleJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pauschale " + STR$ (Pauschale.GEKOND,",99999.000")
         a$ = VSVjn.gekond
         IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
       END IF 
     ELSE 
       IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; AP Eur/Einh: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage  Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
       IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
     END IF 
     IF srjn.gekond = "j" AND sr.gekond <> 0 THEN 
       ListItem$ = ListItem$ + "; Storno " + STR$ (sr.GEKOND,"999.000")
       IF HaftVertrag% <> 0 THEN 
         IF HaftVertrag% <> - 1 THEN 
           ListItem$ = ListItem$ + "; Haftung " + STR$ (HaftVertrag%,"999.") + " Monate"
         ELSE 
           ListItem$ = ListItem$ + "; Haftung unbegrenzt"
         END IF 
       ELSE 
         IF haftung.gekond <> - 1 THEN 
           ListItem$ = ListItem$ + "; Haftung " + STR$ (haftung.GEKOND,"999.") + " Monate"
         ELSE 
           ListItem$ = ListItem$ + "; Haftung unbegrenzt"
         END IF 
       END IF 
     END IF 
     listitem$ = listitem$ + "/BWVON:" + DATE$ (bwvon.gekond,"0d.mm.yyyy")
     IF bwbis.gekond > 0 THEN listitem$ = listitem$ + "/BWBIS:" + DATE$ (bwbis.gekond,"0d.mm.yyyy")
     IF agenturnr.maadr <> "" THEN 
       m$ = "maadr"
       IF KÅndigung.maadr > 0 THEN 
    GKondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.m$) + ", " + LTRIM$ (Vorname.m$) + ", " + TRIM$ (Agenturnr.m$) + ListItem$ + notiz$ + " - KÅnd.:" + DATE$ (KÅndigung.m$,"0d.mm.yyyy") + SPACE$ (120) + STR$ (CodeVK.vkond1,"000000")
       ELSE 
         GKondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.m$) + ", " + LTRIM$ (Vorname.m$) + ", " + TRIM$ (Agenturnr.m$) + ListItem$ + notiz$ + SPACE$ (120) + STR$ (CodeVK.vkond1,"000000")
       END IF 
     ELSE 
       IF KÅndigung.maadr > 0 THEN 
     GKondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.M$) + ", " + LTRIM$ (Vorname.M$) + ListItem$ + notiz$ + " - KÅnd.:" + DATE$ (KÅndigung.m$,"0d.mm.yyyy") + SPACE$ (120) + STR$ (CodeVK.vkond1,"000000")
       ELSE 
         GKondList$(a%) = STR$ (a% + 1,"999") + ". " + LTRIM$ (Nachname.MAADR) + ", " + LTRIM$ (Vorname.MAADR) + ListItem$ + notiz$ + SPACE$ (120) + STR$ (CodeVK.vkond1,"000000")
       END IF 
     END IF 
     IF nÑchsteKond.vkond1 <> 0 THEN 
       _kond% = nÑchsteKond.vkond1
       a% = a% + 1
     ELSE 
       ok% = 0
     END IF 
   WEND 
   REM FOR a% = 1 TO 10
   REM   KondList$(a%) = STR$ (a%,"999") + ". " + KondList$(0)
   REM NEXT a%
   prompt$ = GKondList$(0)
   CREATE DIALOG "KONDLIST",0,0,450,320,"KonditionsÅbersicht","Arial",8
   ADD DIALOG "KONDLIST",4,0,0,449,337,0,""
   ADD DIALOG "KONDLIST",9,9,11,21,21,2
   ADD DIALOG "KONDLIST",5,44,15,150,10,0,"KonditionsÅbersicht fÅr den aktuellen Vertrag:"
   ADD DIALOG "KONDLIST",5,44,29,262,18,0,"BestÑtigen Sie mit " + CHR$ (34) + "OK" + CHR$ (34) + " die Richtigkeit der gefundenen Konditonen oder wÑhlen Sie die richtigen Konditionen aus."
   ADD DIALOG "KONDLIST",5,44,49,256,23,0,"Um eine der angezeigten Konditionen zu Ñndern, wÑhlen Sie mit der Maus eine Kondition aus und klicken anschlie·end auf die SchaltflÑche " + CHR$ (34) + "éndern" + CHR$ (34) + "."
   ADD DIALOG "KONDLIST",7,4,78,448,219,2,2,GKondList$,Auswahl$,prompt$
   IF onlyshow% = 0 THEN 
     ADD DIALOG "KONDLIST",1,101,302,55,15,0,"é&ndern",2,1
     ADD DIALOG "KONDLIST",1,159,302,55,15,1,"&OK",1,1
   END IF 
   ADD DIALOG "KONDLIST",1,237,302,55,15,0,"&Abbrechen",0,0
   DIALOG "KONDLIST",req%
   REMOVE DIALOG "KONDLIST"
   IF req% = 1 THEN 
     EditKondSpez% = 1
     changing% = 0
   END IF 
   IF req% = 0 THEN 
     EditKondSpez% = 0
     changing% = 0
   END IF 
   IF req% = 2 THEN CALL ChangeKondS( VAL ( RIGHT$ (Auswahl$(0),6)))
   _kond% = kond%
 WEND 
 END FUNCTION 
 
SUB ChangeKondS(ckond%)
 REM REQUEST STR$ (ckond%,"000000")
 DIM KondFound$(1000)
 DIM Auswahl$(1)
 SELECT KEY ckond% LOCK FILE "vkond1" INDEX CodeVK.vkond1
 SELECT KEY CodeKO.vkond1 FILE "GEKOND" INDEX lfdnr.GEKOND
 SELECT KEY CodeMA.GEKOND FILE "MAADR" INDEX CodeMA.MAADR
 _cuko% = lfdnr.GEKOND
 geadr% = CodeGE.GEKOND
 sparte% = CodeVA.GEKOND
 ma% = CodeMA.GEKOND
 FILE "GEKOND"
 INDEX QuickCode.GEKOND
 scode$ = STR$ (ma%,"000000") + STR$ (geadr%,"000000") + STR$ (sparte%,"000000")
 SELECT FIRST 
 SELECT KEY scode$ FILE "GEKOND" INDEX QuickCode.GEKOND
 a% = 0
 prompt$ = ""
 WHILE QuickCode.GEKOND LIKE scode$ AND NOT EOF ("GEKOND")
   IF BWvon.GEKOND < 1 THEN BWvon$ = "__.__.____" ELSE BWvon$ = DATE$ (BWvon.GEKOND,"0d.mm.yyyy")
   IF BWbis.GEKOND < 1 THEN BWbis$ = "__.__.____" ELSE BWbis$ = DATE$ (BWbis.GEKOND,"0d.mm.yyyy")
   ListItem$ = ""
   notiz$ = ""
   IF notiz.gekond <> "" THEN notiz$ = " - " + notiz.gekond
   IF GEinh% = 0 THEN 
     IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu·provision " + STR$ (AP.GEKOND,",999.000")
     IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage " + STR$ (Courtage.GEKOND,",999.000")
     IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000")
     IF VDjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu· (LZ)"
     IF TZjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Teilzahlung"
     IF PauschaleJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pauschale " + STR$ (Pauschale.GEKOND,",99999.000")
     IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
     IF DynamikPjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; Dynamik(AP) " + STR$ (DynamikProz.GEKOND,",99999.000")
     IF Betreujn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; Betreuung(Pflege) " + STR$ (BetreuProz.GEKOND,",99999.000")
   ELSE 
     IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu·provision Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
     IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage  Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
     IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
     IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
   END IF 
   KondFound$(a%) = BWvon$ + "-" + BWbis$ + ListItem$ + notiz$ + SPACE$ (120) + STR$ (lfdnr.GEKOND,"000000")
   IF lfdnr.GEKOND = _cuko% THEN prompt$ = KondFound$(a%)
   a% = a% + 1
   SELECT NEXT FILE "GEKOND" INDEX QuickCode.GEKOND
 WEND 
 IF prompt$ = "" THEN prompt$ = KondFound$(0)
 IF a% <> 0 THEN a% = a% - 1
 SELECT KEY geadr% FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY sparte% FILE "SPARTEN" INDEX CodeVA.SPARTEN
 CREATE DIALOG "SELGEKOND",0,0,426,251,"Konditionsauswahl: " + Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + "., " + Gesellschaft.GEADR + "/" + Sparte.SPARTEN,"MS Sans Serif",8
 ADD DIALOG "SELGEKOND",4,0,0,425,220,0,""
 ADD DIALOG "SELGEKOND",9,9,16,21,25,2
 ADD DIALOG "SELGEKOND",5,38,16,205,10,0,"WÑhlen Sie die Kondition aus, die Sie Åbernehmen mîchten:"
 ADD DIALOG "SELGEKOND",5,40,31,130,9,0,"Bewertungszeitraum, Kondition"
 ADD DIALOG "SELGEKOND",7,4,42,409,169,2,2,KondFound$,Auswahl$,prompt$
 ADD DIALOG "SELGEKOND",1,130,227,58,17,1,"&OK",1,1
 ADD DIALOG "SELGEKOND",1,190,227,60,17,0,"&Abbrechen",0,0
 DIALOG "SELGEKOND",req%
 REMOVE DIALOG "SELGEKOND"
 IF req% = 1 THEN 
   CodeKO.vkond1 = VAL ( RIGHT$ (Auswahl$(0),6))
   Workstation.vkond1 = Workstation%
   QWoNo.vkond1 = STR$ (Workstation%,"000000") + STR$ (codeko.vkond1,"000000")
   RecStatus.vkond1 = "c"
   STORE FILE "vkond1"
 END IF 
 END SUB 
   
 
  
 
 
 ' KVERTRAG Konditionen prÅfen
 ' =======================================================================
FUNCTION KonditionOK%(vertrag%,ProviAb%)
 MOUSE OFF 
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 SET STATUS "PrÅfung der Konditionen"
 DIM FehlerListe$(40)
 FehlerIndex% = 0
 cfile$ = FILE 
 SELECT KEY vertrag% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 _cuvt% = lfdnr.KVERTRAG
 codema% = CodeMA.kvertrag
 codege% = CodeGE.kvertrag
 codeva% = CodeVA.kvertrag
 KonditionOK% = 0
 WHILE CodeMA% <> 0
   FILE "GEKOND"
   REM ### Andi Anfang
   SELECT WHERE 
   INDEX QuickCode.gekond:REM Fred
   SELECT FIRST 
   REM ### Andi Ende
   SCode$ = STR$ (CodeMA%,"000000") + STR$ (CodeGE%,"000000") + STR$ (CodeVA%,"000000")
   SELECT KEY codema% FILE "maadr" INDEX CodeMA.MAADR
   SELECT KEY SCode$ FILE "gekond" INDEX QuickCode.gekond
   IF FOUND ("GEKOND") THEN 
     WHILE notfound% = 1 AND QuickCode.GEKOND = SCode$
       REM -- Bewertungszeitraum ermitteln ----------------------------------------
       IF DAYS (BWvon.GEKOND) < 1 THEN BWvon% = DAYS ("01.01.1980") ELSE BWvon% = DAYS (BWvon.GEKOND)
       IF DAYS (BWbis.GEKOND) < 1 THEN BWbis% = DAYS ("31.12.2300") ELSE BWbis% = DAYS (BWbis.GEKOND)
       IF ProviAb% >= BWvon% AND ProviAb% <= BWbis% THEN 
         notfound% = 0
       ELSE 
         SELECT NEXT FILE "gekond" INDEX QuickCode.GEKOND
       END IF 
     WEND 
     IF notfound% = 1 THEN 
       FehlerListe$(FehlerIndex%) = "keine Kondition fÅr gesuchten Zeitraum/" + Nachname.maadr
       FehlerIndex% = FehlerIndex% + 1
     END IF 
   ELSE 
     FehlerListe$(FehlerIndex%) = "keine passende Kondition gefunden/" + Nachname.maadr
     FehlerIndex% = FehlerIndex% + 1
   END IF 
   IF CodeMA.MAADR = VorgÑnger.MAADR THEN 
     CodeMA% = 0
   ELSE 
     CodeMA% = VorgÑnger.MAADR
   END IF 
 WEND 
 IF FehlerIndex% > 0 THEN 
   CREATE DIALOG "KONDPRUEF",0,0,350,144,"Fehlerliste","MS Sans Serif",8
   ADD DIALOG "KONDPRUEF",9,6,6,20,21,1
   ADD DIALOG "KONDPRUEF",5,33,8,213,9,0,"Bei der PrÅfung der Konditionen sind folgende Fehler aufgetreten:"
   ADD DIALOG "KONDPRUEF",7,33,23,310,100,0,0,FehlerListe$,Auswahl$
   ADD DIALOG "KONDPRUEF",1,156,124,55,15,1,"&OK",0,0
   DIALOG "KONDPRUEF"
   REMOVE DIALOG "KONDPRUEF"
   KonditionOK% = 0
 ELSE 
   KonditionOK% = - 1
 END IF 
 SET STATUS "Bereit"
 FILE cfile$
 MOUSE OFF 
 END FUNCTION 
 
   
 ' Kondition fÅr Vertrag auswÑhlen
 ' ========================================================================
 
FUNCTION KondAuswahl%(CodeVT%,ProviAb%)
 cfile$ = FILE 
 CALL DFile(3,"gekond" + _fpw$)
 KONDIND% = 0
 SELECT KEY CodeVT% FILE "kvertrag" INDEX lfdnr.kvertrag
 CodeMA% = CodeMA.kvertrag
 CodeGE% = CodeGE.kvertrag
 CodeVA% = CodeVA.kvertrag
 SCode$ = STR$ (CodeMA%,"000000") + STR$ (CodeGE%,"000000") + STR$ (CodeVA%,"000000")
 FILE "gekond"
 INDEX QuickCode.gekond
 SELECT FIRST 
 SELECT KEY SCode$ FILE "gekond" INDEX QuickCode.gekond
 WHILE (QuickCode.gekond = SCode$) AND (KONDIND% < 80) AND NOT EOF ("gekond")
 
   REM -- Bewertungszeitraum testen --
 
   IF DAYS (BWvon.GEKOND) < 1 THEN BWvon% = DAYS ("01.01.1980") ELSE BWvon% = DAYS (BWvon.GEKOND)
   IF DAYS (BWbis.GEKOND) < 1 THEN BWbis% = DAYS ("31.12.99") ELSE BWbis% = DAYS (BWbis.GEKOND)
   IF ProviAb% >= BWvon% AND ProviAb% <= BWbis% THEN 
     ListItem$ = ""
     IF geinh% = 0 THEN 
       IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu·provision " + STR$ (AP.GEKOND,",999.00")
       IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage " + STR$ (Courtage.GEKOND,",999.00")
       IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.00")
       IF VDjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu· (LZ)"
       IF TZjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Teilzahlung"
       IF PauschaleJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pauschale " + STR$ (Pauschale.GEKOND,",99999.00")
       IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
       IF DynamikPjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; Dynamik(AP) " + STR$ (DynamikProz.GEKOND,",99999.000")
       IF Betreujn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; Betreuung(Pflege) " + STR$ (BetreuProz.GEKOND,",99999.000")
     ELSE 
       IF APjn.gekond = "j" THEN ListItem$ = ListItem$ + "; Abschlu·provision Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF CourtageJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Courtage  Euro/Einheit: " + LTRIM$ ( STR$ (europroeinh.GEKOND,",999999.00"))
       IF PflegeJN.gekond = "j" THEN ListItem$ = ListItem$ + "; Pflege " + STR$ (PflegeProvi.GEKOND,",999.000") + "% "
       IF VSVjn.gekond LIKE "j" THEN ListItem$ = ListItem$ + "; VSV " + STR$ (VSV.GEKOND,",99999.000")
     END IF 
     GEKOND$(KONDIND%) = ListItem$ + SPACE$ (120) + STR$ (lfdnr.gekond,"000000")
     KONDIND% = KONDIND% + 1
   END IF 
   SELECT NEXT FILE "gekond" INDEX QuickCode.gekond
 
 WEND 
 IF KONDIND% <> 0 THEN 
   CREATE DIALOG "KONDSEL",0,0,314,134,"Konditionen","MS Sans Serif",8
   ADD DIALOG "KONDSEL",9,5,3,19,22,3
   ADD DIALOG "KONDSEL",5,34,3,182,8,0,"WÑhlen Sie aus der nachfolgenden Liste die"
   ADD DIALOG "KONDSEL",5,34,12,196,10,0,"Kondition aus, mit der der Vertrag provisioniert werden soll:"
   ADD DIALOG "KONDSEL",7,34,24,272,81,2,0,GEKOND$,Auswahl$
   ADD DIALOG "KONDSEL",1,110,110,48,16,1,"&OK",1,1
   ADD DIALOG "KONDSEL",1,162,110,51,16,0,"&Abbrechen",0,0
   DIALOG "KONDSEL",req%
   REMOVE DIALOG "KONDSEL"
   IF req% = 1 THEN 
     KondAuswahl% = VAL ( RIGHT$ (Auswahl$(0),6))
   ELSE 
     KondAuswahl% = 0
   END IF 
 ELSE 
   KondAuswahl% = 0
 END IF 
 FILE cfile$
 SET STATUS "Bereit"
 END FUNCTION 
 
 
 
 




 
SUB KVERTRAGGR()
 IF disabled%("KVERTRAG") THEN END SUB 
 IF gfsc% = - 1 THEN CALL DFile(3,"fs24imp" + _fpw$)
 CALL DFile(3,"AUmsatz" + _fpw$)
 CALL DFile(3,"FONDS" + _fpw$)
 CALL DFile(3,"KGEADR" + _fpw$)
 CALL DFile(3,"KURSHIST" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 CALL DFile(3,"vpspezko" + _fpw$)
 CALL DFile(3,"spezkond" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"maadrag" + _fpw$)
 CALL DFile(3,"kvfael" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
   CALL DFile(3,"MABETREU" + _fpw$)
   CALL DFile(3,"kvpsp" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 knr% = codeku.GAdrDat$
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL FStore(GAdrDat$)
 FILE "KVERTRAG"
 ok% = 1
 IF RECCOUNT (GAdrDat$) = 0 THEN ok% = 0
 IF RECCOUNT ("SPARTEN") = 0 THEN ok% = 0
 IF RECCOUNT ("MAADR") = 0 THEN ok% = 0
 IF RECCOUNT ("GEADR") = 0 THEN ok% = 0
 IF ok% = 0 THEN 
   CALL Fehler("Die Vertragserfassung ist noch nicht mîglich!","Achten Sie darauf, da· in den Datenbanken 'Adressen', 'Sparten', 'Gesellschaften' und 'Agenturen' jeweils mindestens ein Datensatz erfa·t sein mu·.")
   END SUB 
 END IF 
 knr% = CodeKu.GAdrDat$
 REM SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
 SELECT KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
 IF NOT EXISTS (knr%,codeku.KVERTRAG) THEN 
   _continue% = 0
   REQUEST "Keine VertrÑge fÅr " + LEFT$ (nachname.GAdrDat$,10) + " vorhanden!","Vertrag erfassen?",130,req%
   IF req% = 0 THEN 
     END SUB 
   ELSE 
     REM 160996 Vertrag anlegen
     GCodeVStatus% = 0
     IF NOT disabled%("VERTRBEARBPOL") THEN 
       lfdnr% = CreateVertrag%(knr%)
     END IF 
   END IF 
 END IF 
 _formend% = 0
 SET STATUS "Vertragsverwaltung"
 REM CALL VERTRIntro()
 vuebform$ = "VERTRGR"
 selv$ = "0"
 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   vform% = 0
   IF UCASE$ ( FORM ) <> UCASE$ (vuebform$) THEN 
     MOUSE OFF 
     REM CALL Fehler( DIRECTORY ,"")
     REM OPEN FORM _ppath$ + vuebform$
     IF EXISTS (GPrjForm$ + vuebform$ + ".sbv") THEN 
       OPEN FORM GPrjForm$ + vuebform$
     ELSE 
       OPEN FORM GPrjForm$ + vuebform$
     END IF 
     cuvt% = lfdnr.KVERTRAG
     SELECT KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     IF anrede.GAdrDat$ LIKE "Her*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
       n$ = LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Vorname.GAdrDat$)
       SET HEADING "VertrÑge von: " + LEFT$ (n$,60)
     ELSE 
       n$ = LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Geburtsname.GAdrDat$)
       n% = LEN (n$)
       SET HEADING "VertrÑge von: " + LEFT$ (n$,60)
     END IF 
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\kvertrag.pdf"
     FILE "kvertrag"
     SELECT FIRST 
     selVertr$ = selv$
     SELECT WHERE FILE "Kvertrag"
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "Select where Codeku.kvertrag = knr% and inhaus.kvertrag<>1"
       EXECUTE bef$
     END IF 
     REM CALL Fehler("","")
     CALL FiltIntro()
     CALL MNVERTRGR()
     alleV$ = "Alle VertrÑge"
     aktv$ = "Prov. Vertr."
     AntrV$ = "AntrÑge"
     stornV$ = "prov. stornierte Vertr."
     falt$ = "F/Alt"
     falt1$ = "NICHT F/Alt/IH"
     Inhaus$ = "Inhouse"
     alleV$ = "Alle VertrÑge Æ"
     FORM 
     MENU ON 
   END IF 
   IF VERTRGRsub% > 4 AND VERTRGRsub% < 10 THEN CALL FiltIntro()
   MOUSE ON 
   VERTRGRsub% = 0
   IF ag$ = "j" THEN 
     f.neu.enabled = 0
     f.neu.visible = 0
   END IF 
    
   CALL ClearKBDBuffer()
   FORM 
   IF VERTRGRsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU FOR 600
   REM ** Tastencodes
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL VERTRPrev()
   CASE CrsRight%,PgDn%
     CALL VERTRNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE VERTRGRsub%
   CASE 1
     REM Vertrag neu anlegen
     IF NOT disabled%("VERTRNEU") THEN 
       IF ag$ <> "j" THEN 
         SELECT WHERE FILE "kvertrag"
         lfdnr% = CreateVertrag%(knr%)
         IF lfdnr% > 0 THEN 
           SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.Kvertrag
           FORM 
           lfdnr% = lfdnr.kvertrag
           CALL KVERTRAGneu(lfdnr%)
         END IF 
       ELSE 
         CALL Fehler("Diese Funktion ist in SmartProvis Agentur gesperrt!","")
       END IF 
     END IF 
   CASE 2
     REM in Vertrag verzweigen
     IF NOT OPEN ("FOERKOND") THEN CALL DFile(3,"FOERKOND" + _fpw$)
     lfdnr% = lfdnr.kvertrag
     SELECT WHERE FILE "kvertrag"
     CALL KVERTRAGneu(lfdnr%)
     
     REM vstatusu$ = "Filter: " + 
   CASE 3
     REM Drucken
     codeku% = codeku.adressen
     knr% = codeku%
     IF disabled%("VERTRDRUCK") THEN END SUB 
     CALL DruckVertr(knr%,0)
     knr% = codeku%
   CASE 4
     MOUSE OFF 
     CALL Fehler("Die PrÅfung beinhaltet die Lîschung von VertrÑgen zu denen kein Kunde existiert.","")
     FILE "Kvertrag"
     INDEX lfdnr.Kvertrag
     IF RECCOUNT ("Kvertrag") > 0 THEN 
       SELECT FIRST LOCK 
     ELSE 
       SELECT LAST 
     END IF 
     lfdnrold% = lfdnr.Kvertrag
     lfdnr% = lfdnr.Kvertrag
 
     WHILE NOT EOF ("kvertrag")
       codeku% = Codeku.kvertrag
       lfdnr% = lfdnr.Kvertrag
       SET STATUS STR$ (lfdnr.Kvertrag,"000000")
       IF NOT EXISTS (codeku%,codeku.GAdrDat$) THEN 
         t$ = "Mit Vertrag " + STR$ (lfdnr,"000000") + " ist kein Kunde verbunden!"
         CALL Fehler(t$,"Vertrag wird gelîscht!")
         REM SELECT REMOVE 
         SELECT FIRST 
         SELECT KEY lfdnrold% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
       ELSE 
         lfdnrold% = lfdnr%
       END IF 
       SELECT NEXT LOCK FILE "Kvertrag"
     WEND 
     SELECT FORM KEY knr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     REQUEST "PrÅfung beendet!","",2
     SET STATUS ""
   CASE 5
     SELECT WHERE FILE "KVERTRAG"
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "SELECT WHERE codeku.kvertrag = knr% AND inhaus.kvertrag <> 1"
       EXECUTE bef$
     END IF 
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
     gesfi$ = "Gesellschafts-Filter"
     sparfi$ = "Sparten-Filter "
     gesfi$ = "Gesellschafts-Filter"

     alleV$ = "Alle VertrÑge"
     aktv$ = "Prov. Vertr."
     AntrV$ = "AntrÑge"
     stornV$ = "prov. stornierte Vertr."
     falt$ = "F/Alt"
     falt1$ = "NICHT F/Alt/IH"
     Inhaus$ = "Inhouse"

     alleV$ = "Alle VertrÑge Æ"
     GCodeVStatus% = 0
     GCodeGE% = 0
     GCodeVA% = 0
     FORM 
   CASE 6
     MOUSE OFF 
     SELECT WHERE FILE "KVERTRAG"
     FILE "KVERTRAG"
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "SELECT WHERE ProviAB.kvertrag > 0 and storno.kvertrag < 1 and Fremdvertrag.kvertrag <> ~j~ and Altvertrag.kvertrag <> ~j~ and inhaus.kvertrag<>1"
     ELSE 
       bef$ = "SELECT WHERE ProviAB.kvertrag > 0 and storno.kvertrag < 1 and Fremdvertrag.kvertrag <> ~j~ and Altvertrag.kvertrag <> ~j~"
     END IF 
     EXECUTE bef$
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
     FORM 
     gesfi$ = "Gesellschafts-Filter"
     sparfi$ = "Sparten-Filter "
     gesfi$ = "Gesellschafts-Filter"


     alleV$ = "Alle VertrÑge"
     aktv$ = "Prov. Vertr."
     AntrV$ = "AntrÑge"
     stornV$ = "prov. stornierte Vertr."
     falt$ = "F/Alt"
     falt1$ = "NICHT F/Alt/IH"
     Inhaus$ = "Inhouse"




     aktv$ = "Prov. Vertr.Æ"
     GCodeVStatus% = 0
     GCodeGE% = 0
     GCodeVA% = 0
     MOUSE ON 
   CASE 7
     REM Antrag
     MOUSE OFF 
     SELECT WHERE FILE "KVERTRAG"
     FILE "KVERTRAG"
     REM IF workstation% = 0 THEN 
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "select where codevstatus=12 and inhaus.kvertrag<>1"
     ELSE 
       bef$ = "select where codevstatus=12"
     END IF 
     EXECUTE bef$
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
     FORM 
     gesfi$ = "Gesellschafts-Filter"
     sparfi$ = "Sparten-Filter "
     gesfi$ = "Gesellschafts-Filter"


     alleV$ = "Alle VertrÑge"
     aktv$ = "Prov. Vertr."
     AntrV$ = "AntrÑge"
     stornV$ = "prov. stornierte Vertr."
     falt$ = "F/Alt"
     falt1$ = "NICHT F/Alt/IH"
     Inhaus$ = "Inhouse"


     AntrV$ = "AntrÑge Æ"
     GCodeVStatus% = 0
     GCodeGE% = 0
     GCodeVA% = 0
     MOUSE ON 
   CASE 8
     MOUSE OFF 
     SELECT WHERE FILE "KVERTRAG"
     FILE "KVERTRAG"
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "SELECT WHERE Fremdvertrag.kvertrag <> ~j~ AND Altvertrag.kvertrag <> ~j~ AND storno.kvertrag > 0 and inhaus.kvertrag<>1"
     ELSE 
       bef$ = "SELECT WHERE Fremdvertrag.kvertrag <> ~j~ AND Altvertrag.kvertrag <> ~j~ AND storno.kvertrag > 0"
     END IF 
     EXECUTE bef$
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG


     alleV$ = "Alle VertrÑge"
     aktv$ = "Prov. Vertr."
     AntrV$ = "AntrÑge"
     stornV$ = "prov. stornierte Vertr."
     falt$ = "F/Alt"
     falt1$ = "NICHT F/Alt/IH"
     Inhaus$ = "Inhouse"


     stornV$ = "prov. stornierte Vertr. Æ"
     FORM 
     MOUSE ON 
   CASE 9
     MOUSE OFF 
     SELECT WHERE FILE "KVERTRAG"
     FILE "KVERTRAG"
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "SELECT WHERE Fremdvertrag.kvertrag = ~j~ OR Altvertrag.kvertrag = ~j~ and inhaus.kvertrag<>1"
     ELSE 
       bef$ = "SELECT WHERE Fremdvertrag.kvertrag = ~j~ OR Altvertrag.kvertrag = ~j~"
     END IF 
     EXECUTE bef$
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
     FORM 
     gesfi$ = "Gesellschafts-Filter"
     sparfi$ = "Sparten-Filter "
     gesfi$ = "Gesellschafts-Filter"

     alleV$ = "Alle VertrÑge"
     aktv$ = "Prov. Vertr."
     AntrV$ = "AntrÑge"
     stornV$ = "prov. stornierte Vertr."
     falt$ = "F/Alt"
     falt1$ = "NICHT F/Alt/IH"
     Inhaus$ = "Inhouse"



     falt$ = "F/Alt Æ"
     GCodeVStatus% = 0
     GCodeGE% = 0
     GCodeVA% = 0
     MOUSE ON 
   CASE 10
     MOUSE OFF 
     SELECT WHERE FILE "KVERTRAG"
     FILE "KVERTRAG"
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "SELECT WHERE Fremdvertrag.kvertrag <> ~j~ and Altvertrag.kvertrag <> ~j~ and Inhaus.kvertrag<>1"
     ELSE 
       bef$ = "SELECT WHERE Fremdvertrag.kvertrag <> ~j~ and Altvertrag.kvertrag <> ~j~ and Inhaus.kvertrag<>1"
     END IF 
     EXECUTE bef$
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
     FORM 
     gesfi$ = "Gesellschafts-Filter"
     sparfi$ = "Sparten-Filter "
     gesfi$ = "Gesellschafts-Filter"


     alleV$ = "Alle VertrÑge"
     aktv$ = "Prov. Vertr."
     AntrV$ = "AntrÑge"
     stornV$ = "prov. stornierte Vertr."
     falt$ = "F/Alt"
     falt1$ = "NICHT F/Alt/IH"
     Inhaus$ = "Inhouse"


     falt1$ = "NICHT F/Alt/IH Æ"
     GCodeVStatus% = 0
     GCodeGE% = 0
     GCodeVA% = 0
     MOUSE ON 
   CASE 21
     vuebform$ = "VERTRGR1"
     SET INDEX gesellschaft.kvertrag
     INDEX gesellschaft.kvertrag
   CASE 22
     vuebform$ = "VERTRGR2"
     SET INDEX Agentur.kvertrag
     INDEX Agentur.kvertrag
   CASE 23
     vuebform$ = "VERTRGR3"
     SET INDEX sparte.kvertrag
     INDEX sparte.kvertrag
   CASE 24
     vuebform$ = "VERTRGR4"
     SET INDEX VS_nr.kvertrag
     INDEX VS_nr.kvertrag
   CASE 25
     vuebform$ = "VERTRGR5"
   CASE 26
     vuebform$ = "VERTRGR6"
   CASE 27
     MOUSE OFF 
     selv$ = selVertr$
     wert% = VAL (selVertr$)
     
    
     IF (wert% > 0) THEN 
       bef$ = "SELECT WHERE CodeVStatus.kvertrag = VAL (selVertr$)"
       
     ELSE 
       bef$ = "SELECT WHERE FILE ~KVERTRAG~"
     END IF 
     CALL VertrFilter(selVertr$)
     MOUSE ON 

   CASE 40
     MOUSE OFF 
     sok% = - 1
     IF Disabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
     IF sok% THEN 
       SELECT WHERE FILE "KVERTRAG"
       FILE "KVERTRAG"
       bef$ = "SELECT WHERE Inhaus.kvertrag = 1"
       EXECUTE bef$
       SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
       FORM 
       gesfi$ = "Gesellschafts-Filter"
       sparfi$ = "Sparten-Filter "
       gesfi$ = "Gesellschafts-Filter"

       alleV$ = "Alle VertrÑge"
       aktv$ = "Prov. Vertr."
       AntrV$ = "AntrÑge"
       stornV$ = "prov. stornierte Vertr."
       falt$ = "F/Alt"
       falt1$ = "NICHT F/Alt/IH"
       Inhaus$ = "Inhouse Æ"
       GCodeVStatus% = 0
       GCodeGE% = 0
       GCodeVA% = 0
     END IF 
     MOUSE ON 


   END SELECT 
   REM CALL BMCheckMail()
   cuvt% = lfdnr.KVERTRAG
 WEND 
 cuivt% = lfdnr.KVERTRAG
 SELECT WHERE FILE "Kvertrag"
 REM 191299
 GCodeVStatus% = 0
 GCodeGE% = 0
 GCodeVA% = 0
 
 cuvt% = 0
 abbruch% = 0
 _formend% = 0
 END SUB 
 
 
SUB VertrFilter(wert$)
     MOUSE OFF 
     wert% = VAL (wert$)
     SELECT WHERE FILE "KVERTRAG"
     FILE "KVERTRAG"
     IF (wert% > 0) THEN 
       bef$ = "SELECT WHERE CodeVStatus.kvertrag = wert%"
       EXECUTE bef$
     END IF 
     SELECT FORM KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
     FORM 
     
     MOUSE ON 
 END SUB 
 
 
 
SUB DruckVertr(codeku%,o%)
 
 opt% = 1
 CREATE DIALOG "ADRLIST",0,0,281,123,"WÑhlen Sie den Ausdruck","MS Sans Serif",8
 ADD DIALOG "ADRLIST",4,0,0,280,102,0,""
 ADD DIALOG "ADRLIST",9,4,9,20,21,2
 ADD DIALOG "ADRLIST",5,30,22,238,14,0,"WÑhlen Sie eine Option aus!"
 ADD DIALOG "ADRLIST",3,30,37,236,10,0,"VertrÑge des aktuellen Kunden, mit Auswahldialog",1,opt%
 ADD DIALOG "ADRLIST",3,30,48,234,11,0,"VertrÑge ohne Abschlu· (AntrÑge, werden noch nicht verprovisioniert)",2,opt%
 IF ag$ <> "j" AND workstation% = 0 THEN ADD DIALOG "ADRLIST",3,30,59,236,11,0,"ProvisionsÅbersicht akt. Kunde",3,opt%
 ADD DIALOG "ADRLIST",3,30,70,236,10,0,"Screenshot akt. Bildschirm",4,opt%
 IF ag$ <> "j" AND o% = 1 AND workstation% = 0 THEN ADD DIALOG "ADRLIST",3,30,81,236,12,0,"ProvisionsÅbersicht akt. Vertrag",5,opt%
 ADD DIALOG "ADRLIST",1,77,105,51,15,1,"&Weiter",1,1
 ADD DIALOG "ADRLIST",1,129,105,51,15,0,"&Abbruch",0,0
 DIALOG "ADRLIST",req%
 REMOVE DIALOG "ADRLIST"
 IF req% = 1 THEN 
     IF eurosupport$ = "TRUE" THEN 
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
       IF DruInEur.stamm = 1 THEN 
         req1% = 1
       ELSE 
         CALL Fehler(t1$,t2$)
         REQUEST "öbersicht in EURO drucken?","",130,req1%
       END IF 
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
     END IF 
   knr% = Codeku%
   IF opt% = 1 THEN 
     IF disabled%("VERTRDRUCK") THEN END SUB 
     REM CALL VLIST2()
     CALL VLIST1()
   END IF 
   IF opt% = 2 THEN 
     IF disabled%("VERTRDRUCK") THEN END SUB 
     CALL LIST7(knr%)
   END IF 
   IF opt% = 3 THEN 
     IF disabled%("BUCHUNG") THEN END SUB 
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL VLIST3(eu%)
     ELSE 
       CALL VLIST3Z(eu%)
     END IF 
   END IF 
   IF opt% = 4 THEN 
     IF disabled%("VERTRDRUCK") THEN END SUB 
     CALL SeiteDrucken()
   END IF 
   REM AB130597 IF opt% = 5 THEN CALL VLIST4()
   REM 220697
   IF opt% = 5 THEN 
     IF disabled%("BUCHUNG") THEN END SUB 
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL VLIST3a(lfdnr.kvertrag,eu%)
     ELSE 
       CALL VLIST3az(lfdnr.kvertrag,eu%)
     END IF 
   END IF 
 END IF 
 END SUB 
 
 
 
FUNCTION CreateVertrag%(knr%)
 IF NOT OPEN ("statukey") THEN CALL DFile(3,"statukey" + _fpw$)
 IF NOT OPEN ("geadr") THEN CALL DFile(3,"geadr" + _fpw$)
 IF NOT OPEN ("geadr2") THEN CALL DFile(3,"geadr2" + _fpw$)
 IF NOT OPEN ("vprodukt") THEN CALL DFile(3,"vprodukt" + _fpw$)
 FILE "statukey"
 INDEX statuskey.statukey
 SELECT FIRST 
 REM DIM Sparten$( RECCOUNT ("SPARTEN") + 1)
 DIM Sparten$( RECCOUNT ("VPRODUKT") + 2)
 Sparten$(0) = "<keine Zuordnung>" + SPACE$ (80) + "000000"
 cfile$ = FILE 
 FILE "Waehrung"
 INDEX codew.waehrung
 SELECT FIRST 
 REM FILE "SPARTEN"
 REM INDEX CodeVA.SPARTEN
 alle$ = "n"
AnfVertAlle200220021: 
 FILE "VPRODUKT"
 INDEX gesspa.VPRODUKT
 SELECT WHERE FILE "vprodukt"
 REM IF MNdisabled%("VERTRINHAUSNEW") OR MNdisabled%("VERTRINHAUSSEE") THEN 
   REM SELECT WHERE inhaus.vprodukt <> 1
 REM END IF 
 SELECT FIRST 
 a% = 1
 
 REM WHILE NOT EOF ("SPARTEN")
   REM Sparten$(a%) = Sparte.SPARTEN + SPACE$ (160) + STR$ (CodeVA.SPARTEN,"000000")
   REM a% = a% + 1
   REM SELECT NEXT 
 REM WEND 


 GOTO selpro290620051
 WHILE NOT EOF ("VPRODUKT")
   IF codege.vprodukt > 0 AND codeva.vprodukt > 0 THEN 
     ok% = - 1
     IF alle$ = "n" THEN 
       IF NoAnzeige.vprodukt LIKE "j" THEN ok% = 0
     END IF 
     IF gasp% = - 1 AND workstation% > 0 THEN 
       IF noanzaspbuero.vprodukt LIKE "j" THEN ok% = 0
     END IF 
     IF ok% = - 1 THEN 
       IF alle$ <> "j" THEN 
         IF kurzname.vprodukt <> "" THEN 
           REM Sparten$(a%) = kurzname.VPRODUKT + "/" + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
           Sparten$(a%) = Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + "/" + kurzname.VPRODUKT + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
         ELSE 
           Sparten$(a%) = Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
         END IF 
       ELSE 
         IF NoAnzeige.vprodukt LIKE "j" THEN 
           IF kurzname.vprodukt <> "" THEN 
             REM Sparten$(a%) = kurzname.VPRODUKT + "/" + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
             Sparten$(a%) = "*  " + Gesellschaft.VPRODUKT + " / " + Sparte.vprodukt + " / " + kurzname.VPRODUKT + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
           ELSE 
             Sparten$(a%) = "*  " + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
           END IF 
         ELSE 
           IF kurzname.vprodukt <> "" THEN 
             REM Sparten$(a%) = kurzname.VPRODUKT + "/" + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
             Sparten$(a%) = "   " + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + "/" + kurzname.VPRODUKT + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
           ELSE 
             Sparten$(a%) = "   " + Gesellschaft.VPRODUKT + "/" + Sparte.vprodukt + SPACE$ (160) + STR$ (CodeVP.VPRODUKT,"000000")
           END IF 
         END IF 
       END IF 
 
       a% = a% + 1
     END IF 
   END IF 
   SELECT NEXT 
 WEND 
 Auswahl$ = Sparten$(0)
 prompt$ = sparten$(0)
 IF alle$ <> "j" THEN 
   CREATE DIALOG "VTNEU",0,0,330,350,"Vertrag neu - Produkte die zur Zeit aktiv sind","MS Sans Serif",8
 ELSE 
   CREATE DIALOG "VTNEU",0,0,330,350,"Vertrag neu - alle Produkte","MS Sans Serif",8
   ADD DIALOG "VTNEU",5,44,18,245,11,0,"die mit * gekennzeichneten Produkte wurden fÅr die Auswahl deaktiviert"
 END IF 
 ADD DIALOG "VTNEU",9,2,6,24,24,2
 ADD DIALOG "VTNEU",5,44,8,245,11,0,"Bitte wÑhlen Sie das Produkt, fÅr das Sie den Vertrag erfassen wollen:"
 REM ADD DIALOG "VTNEU",8,4,34,293,214,257,2,Auswahl$,Sparten$
 ADD DIALOG "VTNEU",7,7,27,320,300,2,2,Sparten$,Auswahl$,prompt$
 ADD DIALOG "VTNEU",1,44,330,56,14,1,"&OK",1,1
 ADD DIALOG "VTNEU",1,102,330,54,14,0,"&Abbrechen",0,0
 IF alle$ <> "j" THEN ADD DIALOG "VTNEU",1,162,330,94,14,0,"Alle Produkte anzeigen",2,0
 DIALOG "VTNEU",req%
 REMOVE DIALOG "VTNEU"
 IF req% = 2 THEN 
   REDIM Sparten$( RECCOUNT ("VPRODUKT") + 2,1)
   REDIM Sparten$( RECCOUNT ("VPRODUKT") + 2)
   Sparten$(0) = "<keine Zuordnung>" + SPACE$ (80) + "000000"
   alle$ = "j"
   GOTO AnfVertAlle200220021
 END IF 
selpro290620051: 
 REM codevp% = NewGetCodeVP%()
 IF GOldProdSu$ LIKE "TRUE" THEN 
   codevp% = GetVprodukt%(0,0,0)
 ELSE 
   codevp% = NewGetCodeVP%()
 END IF 
 IF codevp% > 0 THEN 
   req% = 1
   Auswahl$(0) = STR$ (codevp%,"000000")
 END IF 
 IF req% = 1 THEN 
   nsp% = VAL ( RIGHT$ (Auswahl$(0),6))
   REM SELECT KEY nsp% FILE "Sparten" INDEX codeva.sparten
   SELECT KEY nsp% FILE "vprodukt" INDEX codevp.vprodukt
   IF inhaus.vprodukt = 1 THEN 
     IF disabled%("VERTRINHAUSNEW") THEN GOTO end120920091
   END IF 
   mwst% = mwst.vprodukt
   inhaus% = InHaus.vprodukt
   SELECT KEY codeva.vprodukt FILE "sparten" INDEX codeva.sparten
   codeva% = codeva.sparten
   SELECT KEY codege.vprodukt FILE "geadr" INDEX codege.geadr
   sparte$ = sparte.sparten
   ges$ = Gesellschaft.geadr
   codege% = codege.geadr
   wknr$ = wknr.vprodukt
   codegrsp% = codegrsp.sparten
   SELECT KEY codegrsp% FILE "Spgruppe" INDEX codegrsp.spgruppe
   gruppe$ = Gruppe.spgruppe
   IF GAFSK$ LIKE "TRUE" OR viab% = 1 OR inhaus% = 1 THEN 
     req% = 0
   ELSE 
     REQUEST "Wollen Sie einen Fremdvertrag erfassen?","",135,req%
   END IF 
   SET STATUS "Datensatz neu angelegt..."
   BLANK FILE "KVERTRAG"
   lfdnr% = SER ("KVERTRAG",1)
   CreateVertrag% = lfdnr%
   ErfasDatum.kvertrag = TODAY 
   lfdnr.KVERTRAG = lfdnr%
   lfdnrtotal.KVERTRAG = lfdnr% * 10000
   SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
   codeku.KVERTRAG = knr%
   VNehmer.kvertrag = LEFT$ ( LTRIM$ ( TRIM$ (Nachname.adressen)) + "," + LTRIM$ ( TRIM$ (vorname.adressen)) + "," + LTRIM$ ( TRIM$ (Stra·e.adressen)) + "," + LTRIM$ ( TRIM$ (PLZ.adressen + " " + Ort.adressen)),210)
   codevp.kvertrag = nsp%
   inhaus.kvertrag = inhaus%
   ANachname.kvertrag = nachname.GAdrDat$
   AVorname.kvertrag = vorname.GAdrDat$
   AStrasse.kvertrag = Stra·e.GAdrDat$
   AOrt.kvertrag = Ort.GAdrDat$
   APLZ.kvertrag = Plz.GAdrDat$
   letzteBearb.kvertrag = TODAY 
   REM CodeMV.KVERTRAG = 0
   codeGE.KVERTRAG = codege%
   Gesellschaft.kvertrag = LEFT$ (ges$,30)
   codeMA.KVERTRAG = 0
   codeVA.KVERTRAG = codeva%
   codegrsp.kvertrag = codegrsp%
   sparte.kvertrag = sparte$
   wknr.kvertrag = wknr$
   Spartengruppe.kvertrag = gruppe$
   letzteBearb.KVERTRAG = TODAY 
   Zahlart.KVERTRAG = 1
   Inkart.kvertrag = 2
   mwst.kvertrag = mwst%
   REM 141199
   codew.kvertrag = codew.stamm
   umrechnung.kvertrag = umrechnung.stamm
   waehrung.kvertrag = waehrung.stamm
   REM WaehrungBezeich.kvertrag = WaehrungBezeich.waehrung
   REM REQUEST "Wollen Sie einen Fremdvertrag erfassen?","",135,req%
   IF req% = 1 THEN 
     CodeVStatus.kvertrag = 11
     VStatusTXT.kvertrag = "Fremdvertrag"
     Fremdvertrag.kvertrag = "j"
   ELSE 
     CodeVStatus.kvertrag = 12
     VStatusTxT.kvertrag = "Antrag"
     IF GFPB% = - 1 THEN 
       Statuskey.kvertrag = Statuskey.statukey
       statusintern.kvertrag = keyword.statukey
     END IF 
   END IF 
 
   REM 030697
   ZW.KVERTRAG = 55
   cuvt% = 0
   tarif.Kvertrag = ""
   workstation.kvertrag = workstation.adressen
   IF EXISTS (nsp%,codevp.vpspezko) THEN SpezProvAktiv.kvertrag = "j"
   CALL QuickStore("KVERTRAG")
   REM Einkopieren der Spezialkonditionen
   IF EXISTS (nsp%,codevp.vpspezko) THEN 
     FILE "vpspezko"
     SELECT FIRST FILE "vpspezko" INDEX codevp.vpspezko
     SELECT KEY nsp% FILE "vpspezko" INDEX codevp.vpspezko
     WHILE NOT EOF ("vpspezko") AND codevp.vpspezko = nsp%
        IF codevp.vpspezko = nsp% THEN 
          BLANK FILE "spezkond"
          a% = CopyRecord%("VPSPEZKO","SPEZKOND")
          codekey.spezkond = SER ("spezkond",1)
          codevt.spezkond = lfdnr%
          QCodeVTMA.SPEZKOND = STR$ (codevt.SPEZKOND,"000000") + STR$ (codema.SPEZKOND,"000000")
          STORE FILE "SPEZKOND"
          UNLOCK CURRENT FILE "spezkond"
        ELSE 
          SELECT LAST FILE "vpspezko" INDEX codevp.vpspezko
        END IF 
       SELECT NEXT FILE "vpspezko" INDEX codevp.vpspezko
     WEND 
   END IF 
   REM Ende Einkopieren der Spezialkonditionen
 ELSE 
   CreateVertrag% = 0
 END IF 
end120920091: 
 END FUNCTION 
 
 
SUB KVERTRAGneu(lfdnr%)
 REM CALL Fehler("test","")
 IF disabled%("KVERTRAG") THEN END SUB 
 DIM dlg AS Dialog
 DIM control AS DialogControl 
 IF NOT OPEN ("wknr") THEN CALL DFile(3,"WKNR" + _fpw$)
 IF NOT OPEN ("aumsatz") THEN CALL DFile(3,"AUmsatz" + _fpw$)
 IF NOT OPEN ("sparten") THEN CALL DFile(3,"sparten" + _fpw$)
 IF NOT OPEN ("kvfael") THEN CALL DFile(3,"kvfael" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
  IF NOT OPEN ("kvpsp") THEN CALL DFile(3,"kvpsp" + _fpw$)
  IF NOT OPEN ("afspsp") THEN CALL DFile(3,"afspsp" + _fpw$)
  IF NOT OPEN ("afsksut") THEN CALL DFile(3,"afsksut" + _fpw$)
  IF NOT OPEN ("afspfl") THEN CALL DFile(3,"afspfl" + _fpw$)
 END IF 
 IF NOT OPEN ("geadr") THEN CALL DFile(3,"geadr" + _fpw$)
 
 IF NOT OPEN ("geadr2") THEN CALL DFile(3,"geadr2" + _fpw$)
 IF NOT OPEN ("tarif") THEN CALL DFile(3,"tarif" + _fpw$)
 IF NOT OPEN ("maadr") THEN CALL DFile(3,"maadr" + _fpw$)
 IF NOT OPEN ("maadrag") THEN CALL DFile(3,"maadrag" + _fpw$)
 IF NOT OPEN ("maadrgru") THEN CALL DFile(3,"maadrgru" + _fpw$)
 IF NOT OPEN ("kvertrag") THEN CALL DFile(3,"kvertrag" + _fpw$)
 IF NOT OPEN ("vorgang") THEN CALL DFile(3,"vorgang" + _fpw$)
 IF NOT OPEN ("vkond") THEN CALL DFile(3,"vkond" + _fpw$)
 IF NOT OPEN ("vprodukt") THEN CALL DFile(3,"vprodukt" + _fpw$)
 IF NOT OPEN ("formular") THEN CALL DFile(3,"formular" + _fpw$)
 IF NOT OPEN ("spgruppe") THEN CALL DFile(3,"spgruppe" + _fpw$)
 IF NOT OPEN ("kukto") THEN CALL DFile(3,"kukto" + _fpw$)
 IF NOT OPEN ("kgeadr") THEN CALL DFile(3,"kgeadr" + _fpw$)
 IF NOT OPEN ("fonds") THEN CALL DFile(3,"fonds" + _fpw$)
 IF NOT OPEN ("zeinvor") THEN CALL DFile(3,"zeinvor" + _fpw$)
 IF NOT OPEN (GADRDat$) THEN CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF NOT OPEN ("spezkond") THEN CALL DFile(3,"Spezkond" + _fpw$)
 IF Gfsc% = - 1 THEN 
   IF NOT OPEN ("fs24imp") THEN CALL DFile(3,"fs24imp" + _fpw$)
 END IF 
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   IF NOT OPEN ("zeingan1") THEN CALL DFile(3,"zeingan1" + _fpw$)
   IF NOT OPEN ("buchung1") THEN CALL DFile(3,"buchung1" + _fpw$)
   IF NOT OPEN ("zeinvor") THEN CALL DFile(3,"zeinvor" + _fpw$)
   IF NOT OPEN ("kvskond") THEN CALL DFile(3,"kvskond" + _fpw$)
 ELSE 
   IF NOT OPEN ("zeingang") THEN CALL DFile(3,"zeingang" + _fpw$)
   IF NOT OPEN ("buchung") THEN CALL DFile(3,"buchung" + _fpw$)
 END IF 
 IF GAFSK$ LIKE "TRUE" THEN 
   IF NOT OPEN ("mabetreu") THEN CALL DFile(3,"MABETREU" + _fpw$)
 END IF 
 knr% = codeku.GAdrDat$
 cuvt% = lfdnr%
 IF NOT OPEN ("kgeadr") THEN CALL DFile(3,"Kgeadr" + _fpw$)
 IF NOT OPEN ("dokkv") THEN CALL DFile(2,"OFFICE\DOKKV" + _fpw$)
 FILE "KVERTRAG"
 INDEX QuickKUGEs.kvertrag
 ok% = 1
 IF RECCOUNT (GAdrDat$) = 0 THEN ok% = 0
 IF RECCOUNT ("SPARTEN") = 0 THEN ok% = 0
 IF RECCOUNT ("MAADR") = 0 THEN ok% = 0
 IF RECCOUNT ("GEADR") = 0 THEN ok% = 0
 IF ok% = 0 THEN 
   CALL Fehler("Die Vertragserfassung ist noch nicht mîglich!","Achten Sie darauf, da· in den Datenbanken 'Adressen', 'Sparten', 'Gesellschaften' und 'Agenturen' jeweils mindestens ein Datensatz erfa·t sein mu·.")
   END SUB 
 END IF 
 
 SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 _formend% = 0
 SET STATUS "Vertragsverwaltung"
 CALL VERTRIntro(0)
 vform% = 0
 vformold% = - 1
 REM cuvt% = Codeva.kvertrag
 DIM dlg1 AS Dialog
 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   MOUSE OFF 
   cc% = Codeva.kvertrag
   SELECT FIRST FILE "SPARTEN" INDEX CodeVA.SPARTEN
   SELECT KEY cc% FILE "SPARTEN" INDEX CodeVA.SPARTEN
   IF EXISTS (cc%,codeva.sparten) THEN 
     vform1$ = Formular.SPARTEN
   ELSE 
     vform1$ = "VERTR000"
   END IF 
   IF vform1$ = "" THEN vform1$ = "VERTR000"
   vform% = VAL ( RIGHT$ (vform1$,3))
   VForm$ = "VERTR000"
   REM CALL Fehler("","")
   IF GDieMakler$ LIKE "TRUE" THEN 
     IF VForm1$ LIKE "VERTR018" THEN vform1$ = "VERTR028"
   END IF 
   IF GVertrArt$ = "j" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "W" + test$
   END IF 
   IF GLundWrigg$ = "TRUE" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "R" + test$
     GVertrArt$ = "n"
   END IF 
   IF GAFSK$ = "TRUE" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "K" + test$
     GVertrArt$ = "n"
   END IF 
   REM IF GInhouse$ = "TRUE" THEN 
     REM test$ = MID$ (VForm1$,2)
     REM VForm1$ = "I" + test$
     REM GVertrArt$ = "n"
   END IF 

   REM CALL Fehler(VForm1$,"")
   IF vform1$ <> "" THEN VForm$ = vform1$
   IF UCASE$ ( FORM ) <> UCASE$ (VForm$) OR vform% <> vformold% THEN 
     vformold% = vform%
     cuvt% = lfdnr.KVERTRAG
     REM SET HEADING title$ + " - Vertr.von: " + LEFT$ ( LTRIM$ (nachname.GAdrDat$) + ", " + LTRIM$ (Vorname.GAdrDat$),50)
     IF anrede.GAdrDat$ LIKE "Her*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
       n$ = LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Vorname.GAdrDat$)
       SET HEADING "VertrÑge von: " + LEFT$ (n$,60)
     ELSE 
       n$ = LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Geburtsname.GAdrDat$)
       n% = LEN (n$)
       SET HEADING "VertrÑge von: " + LEFT$ (n$,60)
     END IF 
     DIRECTORY _ppath$
     IF GDieMakler$ LIKE "TRUE" THEN 
       IF VForm1$ LIKE "VERTR018" THEN vform1$ = "VERTR028"
     END IF 
     IF EXISTS (GPrjForm$ + VForm1$ + ".sbv") THEN 
       OPEN FORM GPrjForm$ + vform1$
     ELSE 
       IF EXISTS (GPrjForm$ + vform1$ + ".sbv") THEN 
         OPEN FORM GPrjForm$ + vform1$
       ELSE 
         REM OPEN FORM _ppath$ + "VERTR000"
         OPEN FORM GPrjForm$ + "VERTR000"
         vform% = 0
       END IF 
     END IF 
     MOUSE ON 
     LGDV$ = sparte.sparten
     SET f = Superbase.Form
     REM knr% = codeku.kvertrag
     CALL VERTRIntro(1)
     CALL MNVERTR()
     IF gfsc% = - 1 AND FORM LIKE "VERTR000" THEN 
       f.fs24.visible = 0
       f.fs24impods.enabled = - 1
       f.fs24impods.visible = - 1
       IF EXISTS (lfdnr.kvertrag,codevt.fs24imp) THEN 
         fs24impods$ = "importierte DatensÑtze Æ"
       END IF 
     END IF 
     IF GLundWrigg$ = "TRUE" THEN 
       IF vform1$ <> "RERTR018" THEN f.grnotiz.enabled = 0
       IF vform1$ <> "RERTR018" THEN f.grnotiz.visible = 0
       IF vform1$ <> "RERTR018" THEN f.klnotiz.enabled = - 1
       IF vform1$ <> "RERTR018" THEN f.klnotiz.visible = - 1
       IF vform1$ <> "RERTR018" THEN grosnote$ = "Gro·es Notizfeld anzeigen"
     END IF 
     MENU ON 
   END IF 
   MOUSE OFF 
   SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   REM CALL Fehler("VS_Nr " + vs_nr.kvertrag," WKS " + STR$ (workstation.kvertrag))
   cuvt% = lfdnr%
   G_Antrag% = Antragsdatum.kvertrag
   G_Vertrag% = VS_Beginn.kvertrag
   G_Volume% = Volumen.kvertrag
   G_Bewert% = Bewertungssumme.kvertrag
   G_MonAntrag$ = LEFT$ ( DATE$ (Antragsdatum.kvertrag,"mm0dyyyy"),2)
   G_JahrAntrag$ = LEFT$ ( DATE$ (Antragsdatum.kvertrag,"yyyymm0d"),4)
   G_MonVertr$ = LEFT$ ( DATE$ (VS_Beginn.kvertrag,"mm0dyyyy"),2)
   G_JahrVertr$ = LEFT$ ( DATE$ (VS_Beginn.kvertrag,"yyyymm0d"),4)
   G_VStatus% = CodeVstatus.kvertrag
   G_Ma% = CodeMA.kvertrag
   IF UCASE$ (VForm1$) = "VERTR022" OR UCASE$ (VForm1$) = "VERTR023" OR UCASE$ (VForm1$) = "WERTR022" OR UCASE$ (VForm1$) = "WERTR023" THEN CALL RechKvertrag(lfdnr%)
   ON ERROR GOTO w230920092
   IF inhaus.kvertrag = 1 THEN 
     f.status.enabled = 0
     f.dyn.enabled = 0
     f.zahlungseingang.enabled = 0
     f.soll.enabled = 0
     f.vbuch.enabled = 0
     f.stornowarn.enabled = 0
     f.beteil.enabled = 0
     f.gdv.enabled = 0
     f.bertarif.enabled = 0
     f.speziprov.enabled = 0
   ELSE 
     f.status.enabled = - 1
     f.dyn.enabled = - 1
     f.zahlungseingang.enabled = - 1
     f.soll.enabled = - 1
     f.vbuch.enabled = - 1
     f.stornowarn.enabled = - 1
     f.beteil.enabled = - 1
     f.gdv.enabled = - 1
     f.bertarif.enabled = - 1
     f.speziprov.enabled = - 1
   END IF 
w230920092: 
   ON ERROR GOTO ErrorHandler 
   IF proviab.kvertrag > 0 THEN 
     f.combosparte.BackColor = 0
     f.combosparte.ForeColor = 1
     f.combosparte.FontBold = - 1
     f.comboagentur.BackColor = 0
     f.comboagentur.ForeColor = 1
     f.comboagentur.FontBold = - 1
   ELSE 
     f.combosparte.BackColor = 12
     f.combosparte.ForeColor = 0
     f.combosparte.FontBold = - 1
     f.comboagentur.BackColor = 12
     f.comboagentur.ForeColor = 0
     f.comboagentur.FontBold = - 1
   END IF 

   IF GAFSK$ LIKE "TRUE" THEN 
   ELSE 
     IF iim.stamm = "j" AND ag$ <> "j" THEN 
       IF LEFT$ (VForm1$,1) LIKE "V" THEN 
         f.indatexpic.visible = - 1
         f.indatexpic.enabled = - 1
         f.xmldok.visible = - 1
         f.xmldok.enabled = - 1
       END IF 
     ELSE 
       IF ag$ <> "j" THEN 
         IF LEFT$ (VForm1$,1) LIKE "V" THEN 
           f.indatexpic.visible = 0
           f.indatexpic.enabled = 0
           f.xmldok.visible = 0
           f.xmldok.enabled = 0
         END IF 
       END IF 
     END IF 
   END IF 
   SELECT FIRST FILE "config"
   IF GSoll$ LIKE "j" THEN 
     ON ERROR GOTO NoSoll180220021 
     f.soll.visible = - 1
     f.soll.enabled = - 1
NoSoll180220021: 
     ON ERROR GOTO ErrorHandler
   ELSE 
     ON ERROR GOTO NoSoll180220022 
     f.soll.visible = 0
     f.soll.enabled = 0
NoSoll180220022: 
     ON ERROR GOTO ErrorHandler 
   END IF 
   REM FORM 
 
   MOUSE ON 
   IF waehrung.kvertrag = "" THEN CALL VertrWaehrung()
   IF MAKLER$ <> "TRUE" OR ag$ = "j" THEN 
     f.kontoinfo.visible = 0
     f.kontoinfo.enabled = 0
     ON ERROR GOTO f110820091
     f.dtaus.visible = 0
     f.dtaus.enabled = 0
f110820091: 
     ON ERROR GOTO ErrorHandler
   ELSE 
     f.kontoinfo.visible = - 1
     f.kontoinfo.enabled = - 1
     ON ERROR GOTO f110820092
     f.dtaus.visible = - 1
     f.dtaus.enabled = - 1
f110820092: 
     ON ERROR GOTO ErrorHandler 
   END IF 
   IF vform1$ LIKE "KERTR*" THEN 
   ELSE 
     f.eingbei.enabled = - 1
   END IF 
   VERTRsub% = 0

   IF ag$ <> "j" THEN 
     IF GLundWrigg$ LIKE "TRUE" THEN 
       f.zahlungseingang.visible = 0
       f.zahlungseingang.enabled = 0
     ELSE 
       ON ERROR GOTO f110820093
       f.zahlungseingang.visible = - 1
       f.zahlungseingang.enabled = - 1
f110820093: 
     ON ERROR GOTO ErrorHandler
     END IF 
     ON ERROR GOTO f110820094
     f.vbuch.visible = - 1
     f.vbuch.enabled = - 1
     f.gdv.visible = - 1
     f.gdv.enabled = - 1
     f.dyn.visible = - 1
     f.dyn.enabled = - 1
     f.beteil.enabled = - 1
     f.speziprov.visible = GShowSpeziKond%
     f.speziprov.enabled = GShowSpeziKond%
     f.bertarif.enabled = - 1
     f.bertarif.visible = - 1
     f.cspezprov.visible = GShowSpeziKond%
     f.cspezprov.enabled = GShowSpeziKond%
     f.neu.enabled = - 1
     f.neu.visible = - 1
f110820094: 
     ON ERROR GOTO ErrorHandler 
     f.suchen.visible = - 1
     f.suchen.enabled = - 1
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     f.abbruch2.enabled = 0
     f.abbruch2.visible = 0
     f.bearb2.enabled = - 1
     f.sichern2.enabled = - 1
     IF zw.kvertrag = 55 THEN CALL KZWAut()
   ELSE 
     ON ERROR GOTO f110820095
     f.zahlungseingang.visible = 0
     f.zahlungseingang.enabled = 0
     REM f.vbuch.visible = 0
     f.gdv.visible = 0
     f.dyn.visible = 0
     REM f.vbuch.enabled = 0
     f.gdv.enabled = 0
     f.dyn.enabled = 0
     f.status.enabled = 0
     f.status.visible = 0
     REM f.CommandButton26.enabled = 0
     REM f.CommandButton26.visible = 0
     f.konditionen.enabled = 0
     f.konditionen.visible = 0
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     f.speziprov.visible = GShowSpeziKond%
     f.speziprov.enabled = 0
     f.cspezprov.visible = GShowSpeziKond%
     f.cspezprov.enabled = GShowSpeziKond%
     f.bertarif.enabled = - 1
     f.bertarif.visible = - 1
f110820095: 
     ON ERROR GOTO ErrorHandler 
     f.bearb2.enabled = 0
     f.sichern2.enabled = 0
     f.bearb.enabled = 0
     f.sichern.enabled = 0
     f.bearb2.visible = 0
     f.sichern2.visible = 0
     f.bearb.visible = 0
     f.sichern.visible = 0
     f.neu.visible = 0
     f.neu.enabled = 0
   END IF 
   CALL VERTRUpdate()
   G_Antrag% = Antragsdatum.kvertrag
   G_Vertrag% = VS_Beginn.kvertrag
   G_Volume% = Volumen.kvertrag
   G_Bewert% = Bewertungssumme.kvertrag
   G_MonAntrag$ = LEFT$ ( DATE$ (Antragsdatum.kvertrag,"mm0dyyyy"),2)
   G_JahrAntrag$ = LEFT$ ( DATE$ (Antragsdatum.kvertrag,"yyyymm0d"),4)
   G_MonVertr$ = LEFT$ ( DATE$ (VS_Beginn.kvertrag,"mm0dyyyy"),2)
   G_JahrVertr$ = LEFT$ ( DATE$ (VS_Beginn.kvertrag,"yyyymm0d"),4)
   G_VStatus% = CodeVstatus.kvertrag
   G_Ma% = CodeMA.kvertrag
    w% = workstation.maadr
 
   CALL ClearKBDBuffer()
   IF PAGE > 1 THEN 
     IF disabled%("VERTRAGS2") THEN FORM 1
   END IF 
   IF GLundWrigg$ = "TRUE" THEN 
     f.bearbkvf.enabled = - 1
     f.sichkvf.enabled = 0
     IF disabled1%("COURTAGEANZ") THEN 
       f.courtage.visible = 0
       f.courtage.enabled = 0
       f.einzcourtage.visible = 0
       f.einzcourtage.enabled = 0
     ELSE 
       f.courtage.visible = - 1
       f.courtage.enabled = - 1
       f.einzcourtage.visible = - 1
       f.einzcourtage.enabled = - 1
     END IF 
   END IF 
   IF GAFSK$ LIKE "TRUE" THEN 
     f.sutor.visible = - 1
     f.sutor.enabled = - 1
     ON ERROR GOTO e281220041
     f.xmlexp.visible = 0
     f.xmlexp.enabled = 0
     f.xmldok.visible = 0
     f.xmldok.enabled = 0
e281220041: 
     ON ERROR GOTO ErrorHandler
   END IF 
   FORM 
   MENU ON 
   w% = workstation.kvertrag
   REM CALL Fehler("von Vertrag " + VS_Nr.kvertrag, STR$ (w%))
   ON ERROR GOTO Err09032005a
   IF disabled1%("BERPROTOK") THEN 
     ON ERROR GOTO Err09032005a
     IF vform1$ LIKE "KERTR*" THEN 
     ELSE 
       f.BerProtok.readonly = - 1
       f.BerProtokVom.readonly = - 1
       f.BerProtokVom.BackColor = 0
     END IF 
   ELSE 
     ON ERROR GOTO Err09032005a
     IF vform1$ LIKE "KERTR*" THEN 
     ELSE 
       f.BerProtok.readonly = 0
       f.BerProtokVom.readonly = 0
     END IF 
   END IF 
Err09032005a: 
   ON ERROR GOTO Err09032005b
   IF disabled1%("PROVSPERREJN") THEN 
     ON ERROR GOTO Err09032005b
     IF vform1$ LIKE "KERTR*" THEN 
     ELSE 
       f.ProvSperreJN.readonly = - 1
       f.ProvSperreVom.readonly = - 1
       f.ProvSperreVom.BackColor = 0
     END IF 
   ELSE 
     ON ERROR GOTO Err09032005b
     IF vform1$ LIKE "KERTR*" THEN 
     ELSE 
       f.ProvSperreJN.readonly = 0
       f.ProvSperreVom.readonly = 0
     END IF 
   END IF 
Err09032005b:  
   ON ERROR GOTO Er2506200302
   IF BEWERT2JN.stamm LIKE "j" THEN 
     IF disabled1%("VERTRBEWERT2") THEN 
       ON ERROR GOTO Er2506200302
       f.bewert2txt.visible = 0
       f.bewertung2.visible = 0
       f.bewertung2.enabled = 0
     ELSE 
       ON ERROR GOTO Er2506200302
       f.bewert2txt.visible = - 1
       f.bewertung2.visible = - 1
       f.bewertung2.enabled = - 1
     END IF 
   ELSE 
     ON ERROR GOTO Er2506200302
     f.bewert2txt.visible = 0
     f.bewertung2.visible = 0
     f.bewertung2.enabled = 0
   END IF 
Er2506200302: 
   IF FORM LIKE "VERTR000" THEN 
     ON ERROR GOTO Er1607200401
     IF GFSC% = - 1 THEN 
       f.fs24.visible = 0
     ELSE 
       f.fs24.visible = - 1
     END IF 
   END IF 
Er1607200401: 
   ON ERROR GOTO ErrorHandler 
   ON ERROR GOTO s150920041
   IF gasp% = - 1 AND workstation% > 0 THEN 
     f.ProvSperreJN.enabled = 0
     f.ProvSperreJN.visible = 0
     f.ProvSperreVom.enabled = 0
     f.ProvSperreVom.visible = 0
     f.zahlungseingang.enabled = 0
     f.zahlungseingang.visible = 0
     f.vbuch.enabled = 0
     f.vbuch.visible = 0
     f.soll.enabled = 0
     f.soll.visible = 0
     f.konditionen.enabled = 0
     f.konditionen.visible = 0
     f.dyn.enabled = 0
     f.dyn.visible = 0
     f.status.enabled = 0
     f.speziprov.enabled = 0
     f.speziprov.visible = 0
   END IF 
   IF Gfsc% = - 1 THEN 
     ON ERROR GOTO w081220041
     f.datvorschtxt.visible = 0
     f.FS24DatVors.visible = 0
     f.FS24DatVors.enabled = 0
     f.vorschtxtx.visible = 0
     f.FS24Vors.visible = 0
     f.FS24Vors.enabled = 0
     IF kzv.Kvertrag = "1" THEN 
       f.kzv.visible = 0
       f.kzv.enabled = 0
       f.vorschjnr.visible = 0
       f.vorschjnr.enabled = 0
       f.vorschram.visible = 0
       f.vorschram.enabled = 0
     ELSE 
       f.kzv.visible = - 1
       f.kzv.enabled = - 1
       f.vorschjnr.visible = 0
       f.vorschjnr.enabled = 0
       f.vorschram.visible = 0
       f.vorschram.enabled = 0
     END IF 
w081220041: 
     ON ERROR GOTO ErrorHandler 
   END IF 
s150920041:  
   ON ERROR GOTO ErrorHandler 
   
   MENU ON 
   UNLOCK FILE "vorgang"
   UNLOCK FILE "dokkv"
   knr% = codeku.kvertrag
   f.inhaus.readonly = - 1
   f.inhaus.enabled = 0
   ON ERROR GOTO w280920091
   IF inhaus.kvertrag = 1 THEN 
     f.status.enabled = 0
     f.dyn.enabled = 0
     f.zahlungseingang.enabled = 0
     f.soll.enabled = 0
     f.vbuch.enabled = 0
     f.stornowarn.enabled = 0
     f.beteil.enabled = 0
     f.gdv.enabled = 0
     f.bertarif.enabled = 0
     f.speziprov.enabled = 0
   END IF 
w280920091: 
   vertrvon$ = "Vertrag von " + n$
   ON ERROR GOTO ErrorHandler 
   IF VERTRsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU FOR 600
   lfdnr% = lfdnr.kvertrag
   REM ** Tastencodes
   REM SET EDIT ATTR ON 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     VERTRsub% = 5
   CASE CrsRight%,PgDn%
     VERTRsub% = 4
   END SELECT 
   IF k$ = CHR$ (27) THEN 
     IF PAGE = 1 THEN _formend% = 1
     IF PAGE > 1 THEN FORM 1
   END IF 
   SELECT CASE VERTRsub%
   CASE 207
     cuvt% = lfdnr.kvertrag
     SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
     SELECT KEY codeku.kvertrag FILE "Adressen" INDEX codeku.adressen
     BezugsberPTod.kvertrag = Nachname.Adressen + "," + vorname.adressen
     ADRTod.kvertrag = plz.Adressen + " " + Ort.adressen + CHR$ (13) + CHR$ (10) + Stra·e.adressen + CHR$ (13) + CHR$ (10) + land.adressen
     GebDatTod.kvertrag = Geburtstag.adressen
     STORE FILE "KVERTRAG"
     FORM 
   CASE 206
     cuvt% = lfdnr.kvertrag
     SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
     SELECT KEY codeku.kvertrag FILE "Adressen" INDEX codeku.adressen
     BezugsberPErl.kvertrag = Nachname.Adressen + "," + vorname.adressen
     ADRErleben.kvertrag = plz.Adressen + " " + Ort.adressen + CHR$ (13) + CHR$ (10) + Stra·e.adressen + CHR$ (13) + CHR$ (10) + land.adressen
     GebDatErl.kvertrag = Geburtstag.adressen
     STORE FILE "KVERTRAG"
     FORM 
   CASE 205
     codevt% = lfdnr.kvertrag
     IF ag$ <> "j" THEN 
       IF NOT disabled%("VERTRBEARB") AND NOT disabled%("EDITEINGBEI") AND NOT disabled%("SEEEINGBEI") THEN 
         geold% = CodeEingGE.kvertrag
         ge% = GetCodeGEE%(CodeEingGE.kvertrag)
         IF ge% = - 1 THEN GOTO abr300920071
         IF ge% = 0 THEN 
           IF ge% <> geold% THEN 
             MOUSE OFF 
             SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
             SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
             CodeEingGE.kvertrag = 0
             EingereichtBei.kvertrag = ""
             eingbei$ = ""
             STORE FILE "kvertrag"
             IF EXISTS (codevt%,codevt.zeinvor) THEN 
               FILE "zeinvor"
               INDEX codevt.zeinvor
               SELECT KEY codevt% LOCK FILE "zeinvor" INDEX codevt.zeinvor
               WHILE NOT EOF ("zeinvor") AND codevt.zeinvor = codevt%
                 CodeEingGE.zeinvor = CodeEingGE.kvertrag
                 EingereichtBei.zeinvor = EingereichtBei.kvertrag
                 STORE FILE "zeinvor"
                 SELECT NEXT LOCK FILE "zeinvor" INDEX codevt.zeinvor
               WEND 
             END IF 
             IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
               buch$ = "Buchung1"
               zein$ = "zeingan1"
             ELSE 
               buch$ = "Buchung"
               zein$ = "zeingang"
             END IF 
             IF EXISTS (codevt%,codevt.buch$) THEN 
               FILE buch$
               INDEX codevt.buch$
               SELECT KEY codevt% LOCK FILE buch$ INDEX codevt.buch$
               WHILE NOT EOF (buch$) AND codevt.buch$ = codevt%
                 CodeEingGE.buch$ = CodeEingGE.kvertrag
                 EingereichtBei.buch$ = EingereichtBei.kvertrag
                 STORE FILE buch$
                 SELECT NEXT LOCK FILE buch$ INDEX codevt.buch$
               WEND 
             END IF 
             IF EXISTS (codevt%,codevt.zein$) THEN 
               FILE zein$
               INDEX codevt.zein$
               SELECT KEY codevt% LOCK FILE zein$ INDEX codevt.zein$
               WHILE NOT EOF (zein$) AND codevt.zein$ = codevt%
                 CodeEingGE.zein$ = CodeEingGE.kvertrag
                 EingereichtBei.zein$ = EingereichtBei.kvertrag
                 STORE FILE zein$
                 SELECT NEXT LOCK FILE zein$ INDEX codevt.zein$
               WEND 
             END IF 
           END IF 
         ELSE 
           MOUSE OFF 
           SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
           SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
           codevt% = lfdnr.kvertrag
           CodeEingGE.kvertrag = ge%
           EingereichtBei.kvertrag = gesellschaft.geadr
           eingbei$ = gesellschaft.geadr
           STORE FILE "kvertrag"
           IF EXISTS (codevt%,codevt.zeinvor) THEN 
             FILE "zeinvor"
             INDEX codevt.zeinvor
             SELECT KEY codevt% LOCK FILE "zeinvor" INDEX codevt.zeinvor
             WHILE NOT EOF ("zeinvor") AND codevt.zeinvor = codevt%
               CodeEingGE.zeinvor = CodeEingGE.kvertrag
               EingereichtBei.zeinvor = EingereichtBei.kvertrag
               STORE FILE "zeinvor"
               SELECT NEXT LOCK FILE "zeinvor" INDEX codevt.zeinvor
             WEND 
           END IF 
           IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
             buch$ = "Buchung1"
             zein$ = "zeingan1"
           ELSE 
             buch$ = "Buchung"
             zein$ = "zeingang"
           END IF 
           IF EXISTS (codevt%,codevt.buch$) THEN 
             FILE buch$
             INDEX codevt.buch$
             SELECT KEY codevt% LOCK FILE buch$ INDEX codevt.buch$
             WHILE NOT EOF (buch$) AND codevt.buch$ = codevt%
               CodeEingGE.buch$ = CodeEingGE.kvertrag
               EingereichtBei.buch$ = EingereichtBei.kvertrag
               STORE FILE buch$
               SELECT NEXT LOCK FILE buch$ INDEX codevt.buch$
             WEND 
           END IF 
           IF EXISTS (codevt%,codevt.zein$) THEN 
             FILE zein$
             INDEX codevt.zein$
             SELECT KEY codevt% LOCK FILE zein$ INDEX codevt.zein$
             WHILE NOT EOF (zein$) AND codevt.zein$ = codevt%
               CodeEingGE.zein$ = CodeEingGE.kvertrag
               EingereichtBei.zein$ = EingereichtBei.kvertrag
               STORE FILE zein$
               SELECT NEXT LOCK FILE zein$ INDEX codevt.zein$
             WEND 
           END IF 


         END IF 
         FILE "kvertrag"
         FORM 
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion wird in der Agentuvariante nicht unterstÅtzt!","")
     END IF 
abr300920071:     
   CASE 204
     codevt% = lfdnr.kvertrag
     cuvt% = codevt%
     CALL VertrWKNR1()
   CASE 203
     codevt% = lfdnr.kvertrag
     cuvt% = codevt%
     CALL VertrWKNR()
   CASE 202
     REM Sprung zu vprodukt
        Gcodevp% = codevp.kvertrag
        CALL VProdukt1()
        Gcodevp% = 0
   CASE 201
     REM fs24 ImportDatensÑtze
       codevt% = lfdnr.kvertrag
       cuvt% = codevt%
       OPEN FORM GPrjForm$ + "FS24IMPV"
       CALL MNProgramm()

       SELECT FORM KEY codevt% FILE "kvertrag" INDEX lfdnr.kvertrag
       SELECT FORM KEY codevt% FILE "fs24imp" INDEX codevt.fs24imp
       FORM 
       _formend% = 0
       CALL ClearKBDBuffer()
       MENU ON 
       fs24e% = 0
       WHILE _formend% = 0
         ON ERROR GOTO ErrorHandler
         fs24e% = 0
         WAIT MOUSE OR KEY 
         IF k$ = CHR$ (27) AND PAGE = 1 THEN _formend% = 1
         IF k$ = CHR$ (27) AND PAGE = 2 THEN 
           SELECT KEY codevt% FILE "fs24imp" INDEX codevt.fs24imp
           FORM 1
         END IF 
         IF fs24e% <> 0 THEN 
           codekey% = codekey.fs24imp
           SELECT KEY codekey% FILE "fs24imp" INDEX codekey.fs24imp
           FORM 2
         END IF 
       WEND 
       _formend% = 0
   CASE 1
     cuvt% = lfdnr.kvertrag
     CALL VERTRSuchen1()
     lfdnr% = cuvt%
   CASE 2
     CALL DruckVertr(knr%,1)
   CASE 3
     cuvt% = lfdnr.KVERTRAG
     CALL Vorgang()
   CASE 4
     REM VertragNext
     CALL VERTRNext()
     lfdnr% = cuvt%
     CALL VERTRUpdate()
   CASE 5
     REM Vertragprev
     CALL VERTRPrev()
     lfdnr% = cuvt%
     CALL VERTRUpdate()
   CASE 6
     cuvt% = lfdnr.KVERTRAG
     cuge% = Codege.kvertrag
     CALL GEADR()
     cuge% = 0
     lfdnr% = cuvt%
   CASE 7
     cuvt% = lfdnr.KVERTRAG
     codevaprobe% = codeva.kvertrag
     CALL CODEVA()
     codevaprobe% = 0
     lfdnr% = cuvt%
   CASE 8
     cuvt% = lfdnr.KVERTRAG
     cuma% = Codema.kvertrag
     CALL MAADR()
     cuma% = 0
     lfdnr% = cuvt%
   CASE 9
     ok% = - 1
     IF proviab.kvertrag > 0 THEN 
       IF disabled%("VERTRBEARBPOL") THEN 
         ok% = 0
       END IF 
     END IF 
     IF NOT disabled%("VERTRNeu") AND NOT disabled%("VERTRBEARB") AND ok% = - 1 THEN 
       IF ag$ <> "j" THEN 
         REQUEST "Mîchten Sie den Vertrag dynamisieren?","",130,req%
         IF req% = 1 THEN 
           IF ProviAb.kvertrag < 1 OR Fremdvertrag.KVERTRAG LIKE "j" OR Altvertrag.KVERTRAG LIKE "j" THEN 
             CALL Fehler("Vertrag kann nicht dynamisiert werden, da er entweder ein Altvertrag, Fremdvertrag","ist oder noch nicht an die Provisionsabrechnung Åbergeben wurde!")
           ELSE 
             IF ProviAb.kvertrag > 1 AND storno.kvertrag > 0 THEN 
               CALL Fehler("Vertrag kann nicht dynamisiert werden, da er bereits storniert wurde!","")
             ELSE 
               CALL Dynamisier(lfdnr.kvertrag)
               lfdnr% = lfdnr.kvertrag
             END IF 
           END IF 
         END IF 
       ELSE 
         CALL Fehler ("Diese Funktion wird fÅr SmartPROVIS Agentur nicht unterstÅtzt","")
       END IF 
     END IF 
   CASE 10
     cuvt% = lfdnr.KVERTRAG
     CALL KuKto()
   CASE 11
     REM Verzweigung in die Fondsverwaltung
     cuvt% = lfdnr.KVERTRAG
     CALL VFonds(lfdnr.KVERTRAG)
   CASE 12
     REM Lund und Wrigges Bearbeiten KVFAEL
         CALL ButDesabled()
         f.abbruch.enabled = 0
         f.abbruch.visible = 0
         f.sichern.enabled = 0
         f.neu.enabled = 0
         f.beteil.enabled = 0
         f.neu.visible = 0
         f.gesb1.enabled = 0
         f.spa1b.enabled = 0
         f.agb.enabled = 0
         f.seite2.enabled = 0
         f.konditionen.enabled = 0
         f.status.enabled = 0
         f.nachbearb.enabled = 0
         f.zahlweise.enabled = 0
         f.zahlart.enabled = 0
         f.druck.enabled = 0
         f.speziprov.visible = GShowSpeziKond%
         f.speziprov.enabled = 0
         f.cspezprov.visible = GShowSpeziKond%
         f.cspezprov.enabled = GShowSpeziKond%
         f.bertarif.enabled = Gbertarif%
         f.bertarif.visible = 0
         f.vstatus.enabled = 0
         f.waehrbutton1.enabled = 0
         f.combosparte.enabled = 0
         f.comboagentur.enabled = 0
         f.kontoinfo.enabled = 0
         f.zahlungseingang.enabled = 0
         f.vbuch.enabled = 0
         f.tel.enabled = 0
         f.bank.enabled = 0
         f.gdv.enabled = 0
         f.dyn.enabled = 0
         IF GLundWrigg$ = "TRUE" THEN 
           f.bearbkvf.enabled = 0
           f.sichkvf.enabled = - 1
         END IF 
     ENTER HauptfÑlligkeit.kvfael,0
          CALL ButEnabled()
         f.sichern.enabled = - 1
         f.neu.enabled = - 1
         f.beteil.enabled = - 1
         f.neu.visible = - 1
         f.seite2.enabled = - 1
         f.gesb1.enabled = - 1
         f.spa1b.enabled = - 1
         f.agb.enabled = - 1
         f.konditionen.enabled = - 1
         f.status.enabled = - 1
         f.nachbearb.enabled = - 1
         f.zahlweise.enabled = - 1
         f.zahlart.enabled = - 1
         f.abbruch2.enabled = 0
         f.bearb2.enabled = - 1
         f.druck.enabled = - 1
         f.speziprov.enabled = GShowSpeziKond%
         f.speziprov.visible = GShowSpeziKond%
         f.cspezprov.visible = GShowSpeziKond%
         f.cspezprov.enabled = GShowSpeziKond%
         f.bertarif.enabled = Gbertarif%
         f.bertarif.visible = Gbertarif%
         f.vstatus.enabled = - 1
         f.waehrbutton1.enabled = - 1
         f.combosparte.enabled = - 1
         f.comboagentur.enabled = - 1
         f.kontoinfo.enabled = - 1
         IF GLundWrigg$ LIKE "TRUE" THEN 
           f.zahlungseingang.visible = 0
           f.zahlungseingang.enabled = 0
         ELSE 
           f.zahlungseingang.visible = - 1
           f.zahlungseingang.enabled = - 1
         END IF 
         f.vbuch.enabled = - 1
         f.gdv.enabled = - 1
         f.dyn.enabled = - 1
         f.tel.enabled = - 1
         f.bank.enabled = - 1
         IF GLundWrigg$ = "TRUE" THEN 
           f.bearbkvf.enabled = - 1
           f.sichkvf.enabled = 0
         END IF 
 
   CASE 13
     REM Sichern Lund Wrigges KVFAEL
     CALL QuickStore("KVFAEL")
     ENTER END 
   CASE 14
     CALL Sutor()
   CASE 15
     REM Dokument aufrufen
     GBanMA% = 0:GBanGE% = 0
     lfdnr% = lfdnr.kvertrag
     lfdnr1% = lfdnr.kvertrag
     REM CALL KVerDok(lfdnr%)
     IF lfdnr% > 0 THEN 
       GADRDat$ = "ADRESSEN"
       GADRUni$ = "KVERTRAG"
       GDokDat$ = "DOKKV"
       CALL ADRDokUni("lfdnr.kvertrag")
     ELSE 
       CALL Fehler("Dokumente sind fÅr diesen Vertrag nicht verfÅgbar!","")
     END IF 
     GBanMA% = 0:GBanGE% = 0
       SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
       SELECT KEY lfdnr1% FILE "kvertrag" INDEX lfdnr.kvertrag
       cuvt% = lfdnr1%
       CALL VERTRIntro(0)
     REM CALL VertrDokNew()
   CASE 16
     REM Bankverbindung von Adressen Åbernehmen
     IF ag$ <> "j" THEN 
       lfdnr% = lfdnr.kvertrag
       IF NOT disabled%("VERTRBEARB") THEN 
         CALL KVertBank(codeku.kvertrag,lfdnr%)
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
     END IF 
   CASE 17
     REM Telefon
     CALL TelefonListe(CodeKU.KVERTRAG)
   CASE 18
     REM Auswahl zvp1 
     codeku% = codeku.kvertrag
     lfdnr% = lfdnr.kvertrag
     IF NOT disabled%("VERTRBEARB") THEN 
       CALL ZVersPer(1)
     END IF 
   CASE 19
     codeku% = codeku.kvertrag
     lfdnr% = lfdnr.kvertrag
     REM Auswahl zvp2  
     IF NOT disabled%("VERTRBEARB") THEN 
       CALL ZVersPer(2)
     END IF 
   CASE 20
     REM Auswahl zvp3
     codeku% = codeku.kvertrag
     lfdnr% = lfdnr.kvertrag
     IF NOT disabled%("VERTRBEARB") THEN 
       CALL ZVersPer(3)
     END IF 
   CASE 21
     REM Auswahl zvp4
     codeku% = codeku.kvertrag
     lfdnr% = lfdnr.kvertrag
     IF NOT disabled%("VERTRBEARB") THEN 
       CALL ZVersPer(4)
     END IF 
   CASE 22
     REM Auswahl zvp5
     codeku% = codeku.kvertrag
     lfdnr% = lfdnr.kvertrag
     IF NOT disabled%("VERTRBEARB") THEN 
       CALL ZVersPer(5)
     END IF 
   CASE 23
     REM Auswahl zvp6 
     codeku% = codeku.kvertrag
     lfdnr% = lfdnr.kvertrag
     IF NOT disabled%("VERTRBEARB") THEN 
       CALL ZVersPer(6)
     END IF 
   CASE 24
 
     part% = 2
     IF GAFSK$ <> "TRUE" THEN 
       IF EXISTS (lfdnr.kvertrag,codevt.kvfael) THEN 
         SELECT FIRST FILE "KVFAEL" INDEX codevt.kvfael
         SELECT KEY lfdnr.kvertrag LOCK FILE "KVFAEL" INDEX codevt.kvfael
         IF Provisionsart.kvfael > 0 THEN 
           part% = Provisionsart.kvfael
         END IF 
         alleMon% = ProvAlleMon.kvfael
         IF fÑlligam.kvfael > 0 THEN 
           fÑlligam$ = DATE$ (fÑlligam.kvfael,"0d.mm.yyyy")
         ELSE 
           fÑlligam$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
         END IF 
         IF gezahltam.kvfael > 0 THEN 
           gezam$ = DATE$ (gezahltam.kvfael,"0d.mm.yyyy")
         ELSE 
           gezam$ = ""
         END IF 
         ue% = ue.kvfael
         prov% = ProvBetrag.kvfael
         IF erledigt.kvfael <> "j" THEN 
           erledigt$ = ""
         ELSE 
           erledigt$ = "j"
         END IF 
       ELSE 
       END IF 
     ELSE 
  
     END IF 
     REM FÑlligkeit
     lala% = 0
     IF EXISTS (codevp.kvertrag,codevp.vpgekond) THEN 
       SELECT KEY codevp.kvertrag FILE "vpgekond" INDEX codevp.vpgekond
       IF afsk.vpgekond = "j" THEN lala% = - 1
     END IF 
     IF GAFSK$ = "TRUE" THEN 
       IF lala% = - 1 THEN 
         SELECT FIRST FILE "KVFAEL" INDEX codevt.kvfael
         SELECT KEY lfdnr.kvertrag LOCK FILE "KVFAEL" INDEX codevt.kvfael
         erwAnz% = erwProvAnz.kvfael
         fÑlligam$ = DATE$ (fÑlligam.kvfael,"0d.mm.yyyy")
         IF fÑlligam.kvfael < 1 THEN fÑlligam$ = DATE$ (ProviAB.kvertrag,"0d.mm.yyyy")
         VMProvi% = VMProv.kvfael
         gezAnzahl% = gezProvAnz.kvfael
         gezprov% = gezprov.kvfael
         erledigt$ = abserledigt.kvfael
         IF erledigt$ <> "j" THEN erledigt$ = "n"
         IF erwanz% = 0 THEN erwanz% = 4
 
         Superbase.Dialogs.Add("Dialogname")
         SET dlg = Superbase.Dialogs.Dialogname
         dlg.Move(0,0,196,148)
         dlg.Caption = "Angaben zur FÑlligkeit"
         dlg.FontName = "MS Sans Serif"
         dlg.FontSize = 8
 
 
         SET control = dlg.Add("DialogTextBox1","DialogTextBox")
         control.Move(108,15,18,13)
         control.MaxLength = 2
         control.TextBinding = "erwAnz%"
 
         SET control = dlg.Add("DialogLabel1","DialogLabel")
         control.Move(10,16,92,10)
         control.Caption = "erw. Anzahl"
 
         SET control = dlg.Add("DialogTextBox2","DialogTextBox")
         control.Move(108,30,42,13)
         control.MaxLength = 10
         control.TextBinding = "fÑlligam$"
 
         SET control = dlg.Add("DialogLabel2","DialogLabel")
         control.Move(10,32,92,10)
         control.Caption = "nÑchste Zahlung fÑllig am:"
 
         SET control = dlg.Add("DialogTextBox3","DialogTextBox")
         control.Move(108,45,41,13)
         control.MaxLength = 10
         control.TextBinding = "VMProvi%"
 
         SET control = dlg.Add("DialogLabel3","DialogLabel")
         control.Move(10,47,92,9)
         control.Caption = "fÑllige VM Provision:"
 
         SET control = dlg.Add("DialogTextBox4","DialogTextBox")
         control.Move(108,60,41,12)
         control.MaxLength = 10
         control.TextBinding = "gezAnzahl%"
 
         SET control = dlg.Add("DialogLabel4","DialogLabel")
         control.Move(10,61,92,10)
         control.Caption = "gez.Anzahl:"
 
         SET control = dlg.Add("DialogTextBox5","DialogTextBox")
         control.Move(108,74,41,14)
         control.MaxLength = 10
         control.TextBinding = "gezprov%"
 
         SET control = dlg.Add("DialogLabel5","DialogLabel")
         control.Move(10,77,92,8)
         control.Caption = "gezahlte BeitrÑge:"
 
         SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
         control.Move(10,103,177,10)
         control.Caption = "nicht mehr fÅr die öberwachung berÅcksichtigen"
         control.Bind("erledigt$")
         control.ValueOn = "j"
         control.ValueOff = ""
 
 
 
 
         SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
         control.Move(35,129,49,14)
         control.Default = 1
         control.Caption = "OK"
         control.ReturnValue = 1
 
         SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
         control.Move(86,129,49,14)
         control.Caption = "Abbruch"
         control.ReturnValue = 0
         DIALOG "Dialogname",req%
         REMOVE DIALOG "Dialogname"
       ELSE 
         req% = 0
       END IF 
     ELSE 
       Superbase.Dialogs.Add("Dialogname")
       SET dlg = Superbase.Dialogs.Dialogname
       dlg.Move(0,0,196,148)
       dlg.Caption = "Angaben zur FÑlligkeitsvorschau"
       dlg.FontName = "MS Sans Serif"
       dlg.FontSize = 8
 
       SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
       control.Move(10,7,95,10)
       control.Caption = "Folgeprovision"
       control.Bind("part%")
       control.ValueOn = 2
 
       SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
       control.Move(10,19,95,9)
       control.Caption = "Abschlu·provision"
       control.Bind("part%")
       control.ValueOn = 1
 
       SET control = dlg.Add("DialogTextBox1","DialogTextBox")
       control.Move(68,35,18,13)
       control.MaxLength = 2
       control.TextBinding = "alleMon%"
 
       SET control = dlg.Add("DialogLabel1","DialogLabel")
       control.Move(10,36,42,10)
       control.Caption = "alle Monate"
 
       SET control = dlg.Add("DialogTextBox2","DialogTextBox")
       control.Move(68,50,42,13)
       control.MaxLength = 10
       control.TextBinding = "fÑlligam$"
 
       SET control = dlg.Add("DialogLabel2","DialogLabel")
       control.Move(10,52,40,10)
       control.Caption = "fÑllig am:"
 
       SET control = dlg.Add("DialogTextBox3","DialogTextBox")
       control.Move(68,65,41,13)
       control.MaxLength = 10
       control.TextBinding = "gezam$"
 
       SET control = dlg.Add("DialogLabel3","DialogLabel")
       control.Move(10,67,40,9)
       control.Caption = "gezahlt am:"
 
       SET control = dlg.Add("DialogTextBox4","DialogTextBox")
       control.Move(68,80,41,12)
       control.MaxLength = 10
       control.TextBinding = "ue%"
 
       SET control = dlg.Add("DialogLabel4","DialogLabel")
       control.Move(10,81,40,10)
       control.Caption = "UE:"
 
       SET control = dlg.Add("DialogTextBox5","DialogTextBox")
       control.Move(68,94,41,14)
       control.MaxLength = 10
       control.TextBinding = "prov%"
 
       SET control = dlg.Add("DialogLabel5","DialogLabel")
       control.Move(10,97,55,8)
       control.Caption = "fÑllige Provision:"
 
       SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
       control.Move(10,113,167,10)
       control.Caption = "nicht mehr fÅr die Vorausschau berÅcksichtigen"
       control.Bind("erledigt$")
       control.ValueOn = "j"
       control.ValueOff = ""
 
       SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
       control.Move(35,129,49,14)
       control.Default = 1
       control.Caption = "OK"
       control.ReturnValue = 1
 
       SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
       control.Move(86,129,49,14)
       control.Caption = "Abbruch"
       control.ReturnValue = 0
       DIALOG "Dialogname",req%
       REMOVE DIALOG "Dialogname"
     END IF 
     IF req% = 1 AND GAFSK$ <> "TRUE" THEN 
       IF EXISTS (lfdnr.kvertrag,codevt.kvfael) THEN 
         aend% = 0
         IF LTRIM$ (fÑlligam$) <> "" THEN 
           IF DAYS (fÑlligam$) <> fÑlligam.kvfael THEN awnd% = - 1
         END IF 
         IF LTRIM$ (gezam$) <> "" THEN 
           IF DAYS (gezam$) <> gezahltam.kvfael THEN aend% = - 1
         END IF 
         IF part% <> Provisionsart.kvfael OR alleMon% <> ProvAlleMon.kvfael OR ue% <> ue.kvfael OR prov% <> ProvBetrag.kvfael OR erledigt.kvfael <> erledigt$ OR aend% = - 1 THEN 
 
           CALL Fehler("Es wurden énderungen an den Daten der FÑlligkeitsvorausschau vorgenommen!","")
           REQUEST "énderungen zur Berechnung Åbernehmen?","",130,req%
           IF req% = 1 THEN 
             IF Provisionsart.kvfael <> part% THEN 
               IF Provisionsart.kvfael = 1 AND part% = 2 AND erledigt.kvfael = "j" THEN 
                 erledigt.kvfael = ""
               ELSE 
                 IF Provisionsart.kvfael = 2 AND part% = 1 AND DAYS (gezam$) > 0 THEN 
                   erledigt.kvfael = "j"
                 END IF 
               END IF 
             ELSE 
               IF gezahltam.kvfael <> DAYS (gezam$) AND DAYS (gezam$) > 0 THEN 
                 IF Provisionsart.kvfael = 1 THEN 
                   erledigt.kvfael = "j"
                 END IF 
               END IF 
               IF DAYS (gezam$) < 1 THEN erledigt.kvfael = ""
             END IF 
             IF erledigt.kvfael <> erledigt$ THEN erledigt.kvfael = erledigt$
             Provisionsart.kvfael = part%
             ProvAlleMon.kvfael = alleMon%
             fÑlligam.kvfael = DAYS (fÑlligam$)
             gezahltam.kvfael = DAYS (gezam$)
             ue.kvfael = ue%
             ProvBetrag.kvfael = prov%
             HauptfÑlligkeit.kvfael = HauptfÑlligkeit.kvertrag
             ProvBetragEU.kvfael = VAL ( STR$ (ProvBetrag.kvfael / umrechnung.kvertrag,"999999999.00"))
             STORE FILE "KVFAEL"
             UNLOCK CURRENT FILE "KVFAEL"
           END IF 
         END IF 
       ELSE 
       END IF 
     ELSE 
       IF GAFSK$ LIKE "TRUE" THEN 
         IF lala% = - 1 AND req% = 1 THEN 
           REM Kamrodt
           erwProvAnz.kvfael = erwAnz%
           fÑlligam.kvfael = DAYS (fÑlligam$)
           VMProv.kvfael = VMProvi%
           VMProvEu.kvfael = VAL ( STR$ (VMProv.kvfael / umrechnung.kvertrag,"999999999.00"))
           gezProvAnz.kvfael = gezAnzahl%
           gezprov.kvfael = gezprov%
           abserledigt.kvfael = erledigt$
           STORE FILE "KVFAEL"
           UNLOCK CURRENT FILE "KVFAEL"
         ELSE 
           CALL Fehler("Die AFS-Spezialberechnung wurde fÅr dieses Produkt nicht aktiviert!","")
         END IF 
       END IF 
     END IF 
   CASE 25
     REM Umschaltung zwischen kleinem und gro·em Notizfeld
     IF grosnote$ LIKE "Gro·es Notizfeld anzeigen" THEN 
       f.grnotiz.enabled = - 1
       f.grnotiz.visible = - 1
       f.klnotiz.enabled = 0
       f.klnotiz.visible = 0
       grosnote$ = "Kleines Notizfeld anzeigen"
     ELSE 
       f.grnotiz.enabled = 0
       f.grnotiz.visible = 0
       f.klnotiz.enabled = - 1
       f.klnotiz.visible = - 1
       grosnote$ = "Gro·es Notizfeld anzeigen"
     END IF 
   CASE 26
     REM PSP
     CALL PSP()
   CASE 27
     CALL PFL()
   CASE 99
     ok% = - 1
     IF proviab.kvertrag > 0 THEN 
       IF disabled%("VERTRBEARBPOL") THEN 
         ok% = 0
       END IF 
     END IF 
     IF inhaus.kvertrag = 1 THEN 
       IF disabled%("VERTRINHAUSEDIT") THEN 
         ok% = 0
       END IF 
     END IF 
     IF NOT disabled%("VERTRBEARB") AND ok% = - 1 THEN 
       GProvSperreJN$ = ProvSperreJN.kvertrag
       SET EDIT SELECT ON 
       MOUSE ON 
       MENU OFF 
       SELECT CASE PAGE 
       CASE 1
         GBruttoBeitr% = Beitrag.kvertrag
         GNettoBeitr% = NettoBeitrag.kvertrag
         CALL ButDesabled()
         IF GAFSK$ LIKE "TRUE" THEN 
         ELSE 
           IF ag$ <> "j" THEN 
             IF LEFT$ (VForm1$,1) LIKE "V" THEN 
               f.indatexpic.visible = 0
               f.indatexpic.enabled = 0
               f.xmldok.visible = 0
               f.xmldok.enabled = 0
             END IF 
           END IF 
         END IF 
         IF GASPK$ LIKE "TRUE" THEN 
           f.sutor.visible = 0
           f.sutor.enabled = 0
         END IF 
         f.sichern.enabled = - 1
         f.nachbearb.enabled = 0
         f.zahlweise.enabled = 0
         f.zahlart.enabled = 0
         f.druck.enabled = 0
         f.waehrbutton1.enabled = 0
         f.combosparte.enabled = 0
         f.comboagentur.enabled = 0
         f.kontoinfo.enabled = 0
         f.bank.enabled = 0
         ON ERROR GOTO f1108200912
         f.neu.enabled = 0
         f.neu.visible = 0
         f.beteil.enabled = 0
         
         f.gesb1.enabled = 0
         f.spa1b.enabled = 0
         f.agb.enabled = 0
         f.seite2.enabled = 0
         f.konditionen.enabled = 0
         f.status.enabled = 0
         f.speziprov.visible = GShowSpeziKond%
         f.speziprov.enabled = 0
         f.cspezprov.visible = GShowSpeziKond%
         f.cspezprov.enabled = GShowSpeziKond%
         f.bertarif.enabled = Gbertarif%
         f.bertarif.visible = 0
         f.vstatus.enabled = 0
 
         f.zahlungseingang.enabled = 0
         f.vbuch.enabled = 0
         f.tel.enabled = 0
         f.gdv.enabled = 0
         f.dyn.enabled = 0
         IF GLundWrigg$ = "TRUE" THEN 
           f.bearbkvf.enabled = 0
           f.sichkvf.enabled = 0
         END IF 
f1108200912: 
         ON ERROR GOTO ErrorHandler 
         SELECT CASE vform%
         CASE 0
           IF ProviAb.KVERTRAG <> 0 THEN 
           END IF 
           ENTER VS_Nr.KVERTRAG,0
         CASE ELSE 
           IF ProviAb.KVERTRAG <> 0 THEN 
             REM Buttons Gesellschaft,Sparte und Mitarbeiter auf readonly setzen
           END IF 
           REM SET EDIT ATTR ON 
           ENTER VS_Nr.KVERTRAG,0
WM150320021: 
           ENTER END 
           ok% = 0
           WHILE ok% = 0
             REM 15032002
             IF WMon.kvertrag < 0 OR WMon.kvertrag > 12 THEN 
               CALL Fehler("Der Wiedervorlagemonat kann nur die Werte 0 bis 12 beinhalten","Bitte korrigieren Sie Ihre Eingabe")
               ENTER WMon.kvertrag,0
             ELSE 
               ok% = - 1
             END IF 
             IF WJahr.kvertrag < 0 OR WJahr.kvertrag > 3000 THEN 
               CALL Fehler("Das Wiedrvorlagejahr kann nur die Werte 0 bis 3000 beinhalten","Bitte korrigieren Sie Ihre Eingabe")
               ENTER WJahr.kvertrag,0
             ELSE 
               ok% = - 1
             END IF 
           WEND 
         END SELECT 
         CALL ButEnabled()
         IF GASPK$ LIKE "TRUE" THEN 
           f.sutor.visible = - 1
           f.sutor.enabled = - 1
         END IF 
         IF GAFSK$ LIKE "TRUE" THEN 
         ELSE 
           IF iim.stamm = "j" AND ag$ <> "j" THEN 
             IF LEFT$ (VForm1$,1) LIKE "V" THEN 
               f.indatexpic.visible = - 1
               f.indatexpic.enabled = - 1
               f.xmldok.visible = - 1
               f.xmldok.enabled = - 1
             END IF 
           ELSE 
             IF ag$ <> "j" THEN 
               IF LEFT$ (VForm1$,1) LIKE "V" THEN 
                 f.indatexpic.visible = 0
                 f.indatexpic.enabled = 0
                 f.xmldok.visible = - 1
                 f.xmldok.enabled = - 1
               END IF 
             END IF 
           END IF 
         END IF 
         
         f.seite2.enabled = - 1
         f.nachbearb.enabled = - 1
         f.zahlweise.enabled = - 1
         f.zahlart.enabled = - 1
         f.abbruch2.enabled = 0
         f.bearb2.enabled = - 1
         f.druck.enabled = - 1
         f.waehrbutton1.enabled = - 1
         f.combosparte.enabled = - 1
         f.comboagentur.enabled = - 1
         f.kontoinfo.enabled = - 1
         f.bank.enabled = - 1
         ON ERROR GOTO f1108200913
         f.gesb1.enabled = - 1
         f.spa1b.enabled = - 1
         f.agb.enabled = - 1
         f.neu.enabled = - 1
         f.beteil.enabled = - 1
         f.neu.visible = - 1
         f.konditionen.enabled = - 1
         f.status.enabled = - 1
         f.speziprov.enabled = GShowSpeziKond%
         f.speziprov.visible = GShowSpeziKond%
         f.cspezprov.visible = GShowSpeziKond%
         f.cspezprov.enabled = GShowSpeziKond%
         f.bertarif.enabled = Gbertarif%
         f.bertarif.visible = Gbertarif%
         f.vstatus.enabled = - 1
         IF GLundWrigg$ LIKE "TRUE" THEN 
           f.zahlungseingang.visible = 0
           f.zahlungseingang.enabled = 0
         ELSE 
           f.zahlungseingang.visible = - 1
           f.zahlungseingang.enabled = - 1
         END IF 
         f.vbuch.enabled = - 1
         f.gdv.enabled = - 1
         f.dyn.enabled = - 1
         f.tel.enabled = - 1
f1108200913: 
         ON ERROR GOTO ErrorHandler 
         IF GLundWrigg$ = "TRUE" THEN 
           f.bearbkvf.enabled = - 1
           f.sichkvf.enabled = 0
         END IF 
         ON ERROR GOTO s150920042
         IF gasp% = - 1 AND workstation% > 0 THEN 
           f.zahlungseingang.enabled = 0
           f.vbuch.enabled = 0
           f.soll.enabled = 0
           f.konditionen.enabled = 0
           f.dyn.enabled = 0
           f.status.enabled = 0
           f.speziprov.enabled = 0
         END IF 
s150920042:  
         ON ERROR GOTO ErrorHandler 
       CASE 2
         f.seite1.enabled = 0
         f.abbruch2.enabled = - 1
         f.abbruch2.visible = - 1
         f.bearb2.enabled = 0
         SELECT CASE vform%
         CASE 0,24
           ENTER BesVereinbarung.kvertrag,0
         CASE 2
           ENTER Vollinvalid1.KVERTRAG,0
         CASE 3,26
           ENTER zvp1ambulant.kvertrag,0
         CASE 4
           ENTER FDarlnehmer.kvertrag,0
         CASE 5
           ENTER VS_Nr.KVERTRAG,0
         CASE 6,7,8
           ENTER Risiko.KVERTRAG,0
         CASE 10,11
           ENTER risiko.kvertrag,0
         CASE 12
           ENTER RSPrivatjn.kvertrag,0
         CASE 13
           ENTER BezFond1.kvertrag,0
         CASE 14
           ENTER HRSicherungsma.kvertrag,0
         CASE 15
           ENTER GBVersObjekt.kvertrag,0
         CASE 16
           ENTER PHHaftft.kvertrag,0
         CASE 17
           ENTER HRSicherungsma.kvertrag,0
         CASE 18
           f.seite1.enabled = 0
           f.seite3.enabled = 0
           ENTER notiz.kvertrag,0
           f.seite1.enabled = - 1
           f.seite3.enabled = - 1
         CASE 19
           ENTER RSRisiko.kvertrag,0
         CASE 20
           ENTER PHHaftft.kvertrag,0
         CASE 21
           ENTER Risiko.kvertrag,0
         CASE 27
           ENTER AxaDeck1.kvertrag,0
         CASE ELSE 
           ENTER BUZ_Endalter.KVERTRAG,0
         END SELECT 
         f.seite1.enabled = - 1
         f.abbruch2.enabled = 0
         f.abbruch2.visible = 0
         f.bearb2.enabled = - 1
         IF abbruch% = - 1 THEN 
           SELECT KEY lfdnr.kvertrag FILE "kvertrag" INDEX lfdnr.kvertrag
           FORM 
           abbruch% = 0
         END IF 
       CASE 3
         SELECT CASE vform%
         CASE 1
           f.abbr3.visible = - 1
           f.abbr3.enabled = - 1
           f.zur3.enabled = 0
           f.bearb3.enabled = 0
           ENTER BezugsberErl.kvertrag,0
           f.zur3.enabled = - 1
           f.bearb3.enabled = - 1
           f.abbr3.visible = 0
           f.abbr3.enabled = 0
         CASE 6,10
           ENTER HRSicherungsma.kvertrag,0
         CASE 17
           ENTER Vollinvalid1.kvertrag,0
         CASE 18
           f.zur3.enabled = 0
           f.bearb3.enabled = 0
           ENTER Kennzeichen.kvertrag,0
           f.zur3.enabled = - 1
           f.bearb3.enabled = - 1
         CASE 22
           ENTER BezFond1.kvertrag,0
         END SELECT 
       CASE 4
         SELECT CASE vform%
         CASE 17
           ENTER Risiko.kvertrag,0
         END SELECT 
       CASE 5
         SELECT CASE vform%
         CASE 17
           ENTER GBVersObjekt.kvertrag,0
         END SELECT 
       CASE 6
         SELECT CASE vform%
         CASE 17
           ENTER RSRisiko.kvertrag,0
         END SELECT 
       END SELECT 
       MENU ON 
     END IF 
   CASE 100
     IF ag$ <> "j" THEN 
       IF NOT disabled%("VERTRBEARB") THEN 
         IF proviab.kvertrag < 1 THEN 
           IF NOT disabled%("VERTRPRODWECHSEL") THEN 
             CALL VertrVPWahl()
             CALL VERTRUpdate()
           END IF 
         ELSE 
           zwtext$ = "Um den Vertrag aus der Provisionsabrechnung zu entfernen->Button STATUS->Button DEAKTIVIEREN"
           CALL Fehler("Leider kînnen Sie fÅr diesen Vertrag zur Zeit kein anderes Produkt auswÑhlen, da er bereits an die Provisionsabrechnung Åbergeben wurde!",zwtext$)
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion wird in der Agentuvariante nicht unterstÅtzt!","")
     END IF 
   CASE 101
     IF ag$ <> "j" THEN 
       IF NOT disabled%("VERTRBEARB") THEN 
         IF proviab.kvertrag < 1 THEN 
           IF codema.kvertrag > 0 THEN 
             IF NOT disabled%("VERTRVERMCHANGE") THEN 
               CALL SMaadr()
               CALL VERTRUpdate()
             END IF 
           ELSE 
             CALL SMaadr()
             CALL VERTRUpdate()
           END IF 
         ELSE 
           a$ = "Leider kînnen Sie fÅr diesen Vertrag zur Zeit keinen anderen Mitarbeiter auswÑhlen, da er bereits an die Provisionsabrechnung Åbergeben wurde!"
           CALL Fehler(a$,"Um den Vertrag aus der Provisionsabrechnung zu entfernen -> Button STATUS -> Button DEAKTIVIEREN")
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion wird in der Agentuvariante nicht unterstÅtzt!","")
     END IF 
   CASE 102
     REM Spezialprovisionen
    IF ag$ <> "j" THEN 
     IF NOT disabled%("VERTRBEARB") THEN 
      IF NOT disabled%("SPEZKOND") THEN 
       IF proviab.kvertrag > 0 THEN 
         b$ = "da· die jetzt erzeugten énderungen sich nur auf die Verrechnung kÅnftiger ZahlungseingÑnge beziehen!"
         CALL Fehler("Der Vertrag wurde bereits an die Provisionsabrechnung Åbergeben! Wenn Sie jetzt die Spezialkonditionen Ñndern mÅssen Sie bedenken,",b$)
         IF codege.kvertrag > 0 AND codeva.kvertrag > 0 AND codema.kvertrag > 0 THEN 
           FILE "spezkond"
           CALL SpezialProvi()
         ELSE 
           CALL Fehler("Sie mÅssen zu dem Vertrag mindestens das Produkt und die vertragsabschlie·ende Agentur","erfa·t haben, um Spezialprovisionen erfassen zu kînnen!")
         END IF 
       ELSE 
         IF codege.kvertrag > 0 AND codeva.kvertrag > 0 AND codema.kvertrag > 0 THEN 
           FILE "spezkond"
           CALL SpezialProvi()
         ELSE 
           CALL Fehler("Sie mÅssen zu dem Vertrag mindestens das Produkt und die vertragsabschlie·ende Agentur","erfa·t haben, um Spezialprovisionen erfassen zu kînnen!")
         END IF 
       END IF 
     END IF 
    END IF 
     FILE "KVERTRAG"
    ELSE 
      CALL Fehler("Diese Funktion wird in der Agentuvariante nicht unterstÅtzt!","")
    END IF 
   CASE 103
    IF ag$ <> "j" THEN 
     REM Tarif Ñndern
      lfdnr% = lfdnr.kvertrag
      fo$ = UCASE$ ( FORM )
      IF NOT disabled%("TARIFZUWEISEN") THEN 
        IF proviab.kvertrag > 0 AND fo$ <> "VERTR023" THEN 
          tt$ = "Vertrag wurde bereits an die Provisionsabrechnung Åbergeben! AUSNAHME: Sie kînnen jetzt den Tarif nur fÅr VertrÑge mit dem Kapitalanlage-Fonds3 Formular Ñndern!"
          CALL Fehler(tt$,"Wenn Sie den Tarif Ñndern / erfassen wollen mÅssen Sie erst den Vertrag Åber den Button STATUS deaktivieren!")
        ELSE 
          foname$ = UCASE$ ( FORM )
          a% = CodeTarif.kvertrag
          tarif% = GetCodeTarif%(a%,codevp.kvertrag)
          IF UCASE$ ( FORM ) <> foname$ THEN 
            OPEN FORM GPrjForm$ + "\" + foname$
            SET f = Superbase.Form
          END IF 
          IF tarif% > 0 THEN 
            SELECT KEY tarif% FILE "Tarif" INDEX codetarif.tarif
            SELECT KEY lfdnr% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
            codetarif.kvertrag = tarif%
            Tariffo.kvertrag = Tarif.Tarif
            CALL MATimeStamp("KVERTRAG")
            STORE FILE "Kvertrag"
            UNLOCK CURRENT 
            CALL VERTRUpdate()
            REQUEST "Sie haben den Tarif geÑndert! Wollen Sie die Berechnungen der ","durch Formeln hinterlegten Felder jetzt durchfÅhren lassen?",130,req1%
            IF req1% = 1 THEN 
              SELECT KEY lfdnr% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
              CALL FeldBerKVoP()
              CALL QuickStore("kvertrag")
              CALL VERTRUpdate()
            END IF 
          ELSE 
            SELECT KEY lfdnr% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
            Codetarif.kvertrag = 0
            Tariffo.kvertrag = ""
            STORE FILE "Kvertrag"
            UNLOCK CURRENT 
            CALL VERTRUpdate()
            IF FORM LIKE "vertr018" THEN 
              bertarif$ = "Tarifwahl"
            ELSE 
              bertarif$ = "WÑhlen Sie hier einen Berechnungstarif"
            END IF 
          END IF 
        END IF 
      END IF 
    ELSE 
      CALL Fehler("Diese Funktion wird in der Agentuvariante nicht unterstÅtzt!","")
    END IF 
   CASE 104
     REM Aufruf des Zahlungseinganges
     lfdnr1% = lfdnr.kvertrag
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       IF EXISTS (lfdnr.kvertrag,codevt.zeingang) THEN 
         CALL KNZeingang(lfdnr.kvertrag)
       ELSE 
         REQUEST "Es existieren noch keine ZahlungseingÑnge!","Wollen Sie einen Zahlungseingang erfassen?",130,req%
         IF req% = 1 THEN 
           IF LTRIM$ (VS_NR.kvertrag) <> "" THEN 
             CALL ZEINNeu2N()
             CALL KNZeingang(lfdnr.kvertrag)
           ELSE 
             CALL Fehler("Sie kînnen erst einen Zahlungseingang erfassen, wenn fÅr den Vertrag eine Policenummer eingetragen wurde!","")
           END IF 
         END IF 
       END IF 
     ELSE 
       lfdnr% = lfdnr.kvertrag
       MOUSE OFF 
       IF EXISTS (lfdnr.kvertrag,codevt.zeingan1) THEN 
         IF disabled%("EINGANG") THEN 
         ELSE 
           CALL KZeingang(lfdnr.kvertrag)
         END IF 
       ELSE 
         IF disabled%("EINGANG") THEN 
         ELSE 
           REQUEST "Es existieren noch keine ZahlungseingÑnge!","Wollen Sie einen Zahlungseingang erfassen?",130,req%
           IF req% = 1 THEN 
             CALL ZEINNeu2()
             CALL KZeingang(lfdnr.kvertrag)
           END IF 
         END IF 
       END IF 
     END IF 
       SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
       SELECT KEY lfdnr1% FILE "kvertrag" INDEX lfdnr.kvertrag
       cuvt% = lfdnr1%
       CALL VERTRIntro(0)
   CASE 105
     IF ag$ <> "j" THEN 
       lfdnr1% = lfdnr.kvertrag
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         IF disabled%("VBUCHUNG") THEN 
         ELSE 
           CALL KBuchung(lfdnr.kvertrag,"BUCHUNG")
         END IF 
       ELSE 
         IF disabled%("VBUCHUNG") THEN 
         ELSE 
           CALL KBuchung(lfdnr.kvertrag,"BUCHUNG1")
         END IF 
       END IF 
       SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
       SELECT KEY lfdnr1% FILE "kvertrag" INDEX lfdnr.kvertrag
       cuvt% = lfdnr1%
       CALL VERTRIntro(0)
     ELSE 
       CALL Fehler("Diese Funktion steht in der Agenturversion nicht zur VerfÅgung","")
     END IF 
   CASE 106
     REM Aufruf des Zahlungseinganges
     lfdnr1% = lfdnr.kvertrag
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     ELSE 
       IF ag$ <> "j" THEN 
         IF NOT disabled%("VERTRBEARB") THEN 
           IF EXISTS (lfdnr.kvertrag,codevt.zeinvor) THEN 
             IF NOT disabled%("VSOLLSTELLUNG") THEN 
               CALL ZEINVOR(lfdnr.kvertrag)
             END IF 
           ELSE 
             REQUEST "Es existieren noch keine Sollstellungen!","Wollen Sie eine Sollstellung erfassen?",135,req%
             IF req% = 1 THEN 
               CALL ZeinvorNeu()
               CALL ZEINVOR(lfdnr.kvertrag)
             END IF 
           END IF 
         END IF 
       ELSE 
         CALL Fehler("Diese Funktion steht in der Agenturversion nicht zur VerfÅgung","")
       END IF 
     END IF 
       SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
       SELECT KEY lfdnr1% FILE "kvertrag" INDEX lfdnr.kvertrag
       cuvt% = lfdnr1%
       CALL VERTRIntro(0)
   CASE 199
     REM GDV Leben 
     codeva% = codeva.kvertrag
     CALL DFile(3,"anl06" + _fpw$)
     CALL DFile(3,"anl08" + _fpw$)
     CALL DFile(3,"anl13" + _fpw$)
     CALL DFile(3,"anl14" + _fpw$)
     CALL DFile(3,"anl19" + _fpw$)
     CALL DFile(3,"anl20" + _fpw$)
     CALL DFile(3,"anl24" + _fpw$)
     CALL DFile(3,"anl71" + _fpw$)
     CALL DFile(3,"anl72" + _fpw$)
 
   IF codeva% > 0 THEN 
     SELECT KEY codeva% FILE "Sparten" INDEX codeva.sparten
     IF GGDV$ = "TRUE" THEN 
       
       REM 25102000 war vorher auf -1 ich wei· aber nicht mehr warum IF Hauptsparte.sparten > - 1 THEN 
       IF Hauptsparte.sparten > 0 THEN 
        SELECT CASE Hauptsparte.sparten
        CASE 10
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           CALL le21011()
           REM Leben
         CASE 70
           REM Rechtsschutz
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           CALL re021011()
         CASE 40
           REM Haftpflicht
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           CALL ha021011()
         CASE 510
           REM Verkehrsservice
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           CALL vs021011()
         CASE 130
           REM Hausrat
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           CALL vh021011()
         CASE 110
           REM Glas
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           CALL gl021011()
         CASE 190
           REM Transport    
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
            CALL tr021011()
         CASE 020
           REM Kranken
           REM IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           REM CALL kk021011()
         CASE 030
           REM Unfall
             REM IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
             REM CALL un021011()
             CALL Fehler("Unfall wird zur Zeit nicht unterstÅtzt.","")
         CASE 080,081,082,083,231,089,090,099,100,109,120,150,180,181,210
           REM Feuer
           IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           CALL fu021011()
         REM CASE 060,160,290,233,293,294,299
           REM Undefiniert
           REM IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           REM CALL ud021011()
         REM CASE 171,172,174,175,176,179,232,290
           REM  Technische
           REM IF NOT PROGRAMFILE ("PLGDV") THEN LOAD _localpath$ + "PLGDV.SBR", NEW 
           REM CALL te021011()
         CASE 50
           REM KFZ
           CALL Fehler("FÅr KFZ wurden alle Daten komplett Åbernommen, deshalb wird die GDV - Struktur nicht gesondert angezeigt!","")
    REM ********************* 
         CASE ELSE 
           CALL Fehler("Sorry zur Zeit sind nur die GDV-Daten fÅr Leben,Haftpflicht, Rechtsschutz, Verkehrsservice und Hausrat einsehbar!","")
         END SELECT 
       ELSE 
         CALL Fehler("Der Sparte wurde keine GDV-Hauptsparte zugewiesen!","Wechseln Sie in die Spartenmaske und erfassen Sie dort bei der Sparte die zugehîrige GDV-Hauptsparten-Nr!")
       END IF 
     ELSE 
       CALL Fehler("Diese GDV-Formulare sind nur dann sichtbar,","wenn Sie SmartPROVIS mit GDV - Import erworben haben!")
     END IF 
 
   ELSE 
     CALL Fehler ("Sie haben dem Vertrag noch keine Sparte zugeordnet!","BetÑtigen Sie den Button <Bearbeiten> und wechseln Sie dann in das Spartenauswahlfeld, um eine Sparte zuzuordnen!")
   END IF 
 CASE 200
   REM Indatex
     optemail% = 2
     Superbase.Dialogs.Add("Dialogname")
     SET dlg1 = Superbase.Dialogs.Dialogname
     dlg1.Move(0,0,150,97)
     dlg1.Caption = "Indatex"
     dlg1.FontName = "MS Sans Serif"
     dlg1.FontSize = 8
 
     SET control = dlg1.Add("DialogFrame1","DialogFrame")
     control.Move(2,8,147,64)
     control.Caption = " WÑhlen Sie eine Option "
 
     SET control = dlg1.Add("DialogOptionButton1","DialogOptionButton")
     control.Move(6,20,114,10)
     control.Caption = "Export"
     control.Bind("optemail%")
     control.ValueOn = 1
 
     SET control = dlg1.Add("DialogOptionButton2","DialogOptionButton")
     control.Move(6,32,114,9)
     control.Caption = "Anzeige"
     control.Bind("optemail%")
     control.ValueOn = 2
 
 
     SET control = dlg1.Add("DialogOptionButton3","DialogOptionButton")
     control.Move(6,44,114,9)
     control.Caption = "Import nur fÅr aktuellen Vertrag"
     control.Bind("optemail%")
     control.ValueOn = 3
 
     SET control = dlg1.Add("DialogOptionButton4","DialogOptionButton")
     control.Move(6,56,114,9)
     control.Caption = "Import fÅr alle VertrÑge"
     control.Bind("optemail%")
     control.ValueOn = 4
 


     SET control = dlg1.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(35,78,43,16)
     control.Default = 1
     control.Caption = "OK"
     control.ReturnValue = 1
 
     SET control = dlg1.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(81,78,42,16)
     control.Caption = "Abbruch"
     control.ReturnValue = 0
 
     DIALOG "Dialogname",reqemail%
     REMOVE DIALOG "Dialogname"
     IF reqemail% = 1 THEN 
       IF optemail% = 1 THEN 
         REM Export
         CALL XMLExport()
       END IF 
       IF optemail% = 2 THEN 
         REM Anzeige
         CALL XMLDok()
       END IF 
       IF optemail% = 3 THEN 
         REM Import
         CALL XMLImport()
       END IF 
       IF optemail% = 4 THEN 
         REM Import
         CALL VHVXMLImport()
       END IF 
     END IF 
 END SELECT 
   cuvt% = lfdnr.KVERTRAG
   knr% = codeku.kvertrag
   GProvSperreJN$ = ""
   REM 030697
   IF zw.kvertrag = 55 THEN 
     IF fremdvertrag.kvertrag <> "j" AND altvertrag.kvertrag <> "j" THEN 
       IF NOT disabled%("VERTRBEARB") AND ag$ <> "j" THEN 
         CALL Fehler("Sie mÅssen erst die Zahlweise eingeben, bevor Sie den Vertrag abschlie·en kînnen!","")
         _formend% = 0
       END IF 
       
     END IF 
   END IF 
 REM CALL BMCheckMail()
 WEND 
 
 IF GLundWrigg$ = "TRUE" THEN 
   fehler$ = ""
   cvstatus% = CodevStatus.kvertrag
   ok% = - 1
   IF CodevStatus.kvertrag > 3 AND CodevStatus.kvertrag < 8 THEN 
     ok% = 0
   ELSE 
     IF CodevStatus.kvertrag > 9 AND CodevStatus.kvertrag < 14 THEN 
       ok% = 0
     END IF 
   END IF 
   IF ok% = - 1 THEN 
     codevt% = lfdnr.kvertrag
     SELECT FIRST FILE "KVFAEL" INDEX codevt.kvfael
     SELECT KEY codevt% FILE "KVFAEL" INDEX codevt.kvfael
     abruf$ = abruf.kvfael
     IF abruf.kvfael = "j" THEN 
       IF inkart.kvertrag <> 1 THEN 
         fehler$ = "Sie haben den Abruf auf J gestellt, aber die Inkassoart nicht auf Vermittlerinkasso gestellt!"
       END IF 
       IF (k1konto.kvertrag = "" OR K1BLZ.kvertrag = "" OR K1Bank.kvertrag = "") AND zahlart = 1 THEN 
         fehler$ = fehler$ + "Sie haben die Zahlart auf Bankeinzug gestellt, aber die Kontonr,BLZ oder Bankname sind nicht korrekt ausgefÅllt!"
       END IF 
       IF zahlart <> 1 THEN 
         fehler$ = fehler$ + "Sie haben den Abruf auf J gestellt, aber die Zahlart ist nicht Bankeinzug!"
       END IF 
       IF fehler$ <> "" THEN CALL Fehler(fehler$,"")
     END IF 
   END IF 
 END IF 
 REM IF FileChanged%("KVERTRAG") = 1 AND abbruch% = 0 THEN CALL FStore("KVERTRAG")
 REM END IF 
 cuivt% = lfdnr.KVERTRAG
 cuvt% = 0
 abbruch% = 0
 _formend% = 0
 
 END SUB 
 
 REM Kopieren der Felder der Unfallversicherung
SUB COPYUnf(x%)
 codeva% = lfdnr.kvertrag
 SELECT KEY codeva% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
 SELECT CASE x%
   CASE 2
     Vollinvalid2.kvertrag = Vollinvalid1.kvertrag
     Basisinvalid2.kvertrag = Basisinvalid1.kvertrag
     Progression1_2.kvertrag = Progression1_1.kvertrag
     Progression2_2.kvertrag = Progression2_1.kvertrag
     Todesfall2.kvertrag = Todesfall1.kvertrag
     KHT2.kvertrag = KHT1.kvertrag
     Genesungsgeld2.kvertrag = Genesungsgeld1 .kvertrag
     öbergangsleist2.kvertrag = öbergangsleist1.kvertrag
     Chir_Leist2.kvertrag = Chir_Leist1 .kvertrag
     Unfallrente2.kvertrag = Unfallrente1.kvertrag
     zvp2Gliedertaxe.kvertrag = zvp1Gliedertaxe.kvertrag
     UNFBergung2.kvertrag = UNFBergung1.kvertrag
     UNFKurBH2.kvertrag = UNFKurBH1.kvertrag
     UNFsonAs2.kvertrag = UNFsonAs1.kvertrag
     UnfBezugsPers2.kvertrag = UnfBezugsPers1.kvertrag
     UnfBezugsGeb2.kvertrag = UnfBezugsGeb1.kvertrag
     UnfBezugsKomm2.kvertrag = UnfBezugsKomm1.kvertrag
   CASE 3
     Vollinvalid3.kvertrag = Vollinvalid1.kvertrag
     Basisinvalid3.kvertrag = Basisinvalid1.kvertrag
     Progression1_3.kvertrag = Progression1_1.kvertrag
     Progression2_3.kvertrag = Progression2_1.kvertrag
     Todesfall3.kvertrag = Todesfall1.kvertrag
     KHT3.kvertrag = KHT1.kvertrag
     Genesungsgeld3.kvertrag = Genesungsgeld1 .kvertrag
     öbergangsleist3.kvertrag = öbergangsleist1.kvertrag
     Chir_Leist3.kvertrag = Chir_Leist1 .kvertrag
     Unfallrente3.kvertrag = Unfallrente1.kvertrag
     zvp3Gliedertaxe.kvertrag = zvp1Gliedertaxe.kvertrag
     UNFBergung3.kvertrag = UNFBergung1.kvertrag
     UNFKurBH3.kvertrag = UNFKurBH1.kvertrag
     UNFsonAs3.kvertrag = UNFsonAs1.kvertrag
     UnfBezugsPers3.kvertrag = UnfBezugsPers1.kvertrag
     UnfBezugsGeb3.kvertrag = UnfBezugsGeb1.kvertrag
     UnfBezugsKomm3.kvertrag = UnfBezugsKomm1.kvertrag
   CASE 4
     Vollinvalid4.kvertrag = Vollinvalid1.kvertrag
     Basisinvalid4.kvertrag = Basisinvalid1.kvertrag
     Progression1_4.kvertrag = Progression1_1.kvertrag
     Progression2_4.kvertrag = Progression2_1.kvertrag
     Todesfall4.kvertrag = Todesfall1.kvertrag
     KHT4.kvertrag = KHT1.kvertrag
     Genesungsgeld4.kvertrag = Genesungsgeld1 .kvertrag
     öbergangsleist4.kvertrag = öbergangsleist1.kvertrag
     Chir_Leist4.kvertrag = Chir_Leist1 .kvertrag
     Unfallrente4.kvertrag = Unfallrente1.kvertrag
     zvp4Gliedertaxe.kvertrag = zvp1Gliedertaxe.kvertrag
     UNFBergung4.kvertrag = UNFBergung1.kvertrag
     UNFKurBH4.kvertrag = UNFKurBH1.kvertrag
     UNFsonAs4.kvertrag = UNFsonAs1.kvertrag
     UnfBezugsPers4.kvertrag = UnfBezugsPers1.kvertrag
     UnfBezugsGeb4.kvertrag = UnfBezugsGeb1.kvertrag
     UnfBezugsKomm4.kvertrag = UnfBezugsKomm1.kvertrag
   CASE 5
     Vollinvalid5.kvertrag = Vollinvalid1.kvertrag
     Basisinvalid5.kvertrag = Basisinvalid1.kvertrag
     Progression1_5.kvertrag = Progression1_1.kvertrag
     Progression2_5.kvertrag = Progression2_1.kvertrag
     Todesfall5.kvertrag = Todesfall1.kvertrag
     KHT5.kvertrag = KHT1.kvertrag
     Genesungsgeld5.kvertrag = Genesungsgeld1 .kvertrag
     öbergangsleist5.kvertrag = öbergangsleist1.kvertrag
     Chir_Leist5.kvertrag = Chir_Leist1 .kvertrag
     Unfallrente5.kvertrag = Unfallrente1.kvertrag
     zvp5Gliedertaxe.kvertrag = zvp1Gliedertaxe.kvertrag
     UNFBergung5.kvertrag = UNFBergung1.kvertrag
     UNFKurBH5.kvertrag = UNFKurBH1.kvertrag
     UNFsonAs5.kvertrag = UNFsonAs1.kvertrag
     UnfBezugsPers5.kvertrag = UnfBezugsPers1.kvertrag
     UnfBezugsGeb5.kvertrag = UnfBezugsGeb1.kvertrag
     UnfBezugsKomm5.kvertrag = UnfBezugsKomm1.kvertrag
   CASE 6
     Vollinvalid6.kvertrag = Vollinvalid1.kvertrag
     Basisinvalid6.kvertrag = Basisinvalid1.kvertrag
     Progression1_6.kvertrag = Progression1_1.kvertrag
     Progression2_6.kvertrag = Progression2_1.kvertrag
     Todesfall6.kvertrag = Todesfall1.kvertrag
     KHT6.kvertrag = KHT1.kvertrag
     Genesungsgeld6.kvertrag = Genesungsgeld1 .kvertrag
     öbergangsleist6.kvertrag = öbergangsleist1.kvertrag
     Chir_Leist6.kvertrag = Chir_Leist1 .kvertrag
     Unfallrente6.kvertrag = Unfallrente1.kvertrag
     zvp6Gliedertaxe.kvertrag = zvp1Gliedertaxe.kvertrag
     UNFBergung6.kvertrag = UNFBergung1.kvertrag
     UNFKurBH6.kvertrag = UNFKurBH1.kvertrag
     UNFsonAs6.kvertrag = UNFsonAs1.kvertrag
     UnfBezugsPers6.kvertrag = UnfBezugsPers1.kvertrag
     UnfBezugsGeb6.kvertrag = UnfBezugsGeb1.kvertrag
     UnfBezugsKomm6.kvertrag = UnfBezugsKomm1.kvertrag
 END SELECT 
 CALL QuickStore("KVERTRAG")
 END SUB 
 
 
 REM Kopieren der Felder der KV-versicherung
SUB COPYKV(x%)
 codeva% = lfdnr.kvertrag
 SELECT KEY codeva% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
 SELECT CASE x%
   CASE 2
     zvp2ambulant.kvertrag = zvp1ambulant.kvertrag
     zvp2station.kvertrag = zvp1station.kvertrag
     zvp2Zers.kvertrag = zvp1Zers.kvertrag
     zvp2Zahn.kvertrag = zvp1Zahn.kvertrag
     zvp2KHG.kvertrag = zvp1KHG.kvertrag
     zvp2KTG.kvertrag = zvp1KTG.kvertrag
     zvp2PV.kvertrag = zvp1PV.kvertrag
     zvp2PTG.kvertrag = zvp1PTG.kvertrag
     zvp2ZusVers.kvertrag = zvp1ZusVers.kvertrag
     zvp2Reise.kvertrag = zvp1Reise.kvertrag
     zvp2Beitrag.kvertrag = zvp1Beitrag.kvertrag
     KVNotiz2.kvertrag = KVNotiz1.kvertrag
   CASE 3
     zvp3ambulant.kvertrag = zvp1ambulant.kvertrag
     zvp3station.kvertrag = zvp1station.kvertrag
     zvp3Zers.kvertrag = zvp1Zers.kvertrag
     zvp3Zahn.kvertrag = zvp1Zahn.kvertrag
     zvp3KHG.kvertrag = zvp1KHG.kvertrag
     zvp3KTG.kvertrag = zvp1KTG.kvertrag
     zvp3PV.kvertrag = zvp1PV.kvertrag
     zvp3PTG.kvertrag = zvp1PTG.kvertrag
     zvp3ZusVers.kvertrag = zvp1ZusVers.kvertrag
     zvp3Reise.kvertrag = zvp1Reise.kvertrag
     zvp3Beitrag.kvertrag = zvp1Beitrag.kvertrag
     KVNotiz3.kvertrag = KVNotiz1.kvertrag
   CASE 4
     zvp4ambulant.kvertrag = zvp1ambulant.kvertrag
     zvp4station.kvertrag = zvp1station.kvertrag
     zvp4Zers.kvertrag = zvp1Zers.kvertrag
     zvp4Zahn.kvertrag = zvp1Zahn.kvertrag
     zvp4KHG.kvertrag = zvp1KHG.kvertrag
     zvp4KTG.kvertrag = zvp1KTG.kvertrag
     zvp4PV.kvertrag = zvp1PV.kvertrag
     zvp4PTG.kvertrag = zvp1PTG.kvertrag
     zvp4ZusVers.kvertrag = zvp1ZusVers.kvertrag
     zvp4Reise.kvertrag = zvp1Reise.kvertrag
     zvp4Beitrag.kvertrag = zvp1Beitrag.kvertrag
     KVNotiz4.kvertrag = KVNotiz1.kvertrag
   CASE 5
     zvp5ambulant.kvertrag = zvp1ambulant.kvertrag
     zvp5station.kvertrag = zvp1station.kvertrag
     zvp5Zers.kvertrag = zvp1Zers.kvertrag
     zvp5Zahn.kvertrag = zvp1Zahn.kvertrag
     zvp5KHG.kvertrag = zvp1KHG.kvertrag
     zvp5KTG.kvertrag = zvp1KTG.kvertrag
     zvp5PV.kvertrag = zvp1PV.kvertrag
     zvp5PTG.kvertrag = zvp1PTG.kvertrag
     zvp5ZusVers.kvertrag = zvp1ZusVers.kvertrag
     zvp5Reise.kvertrag = zvp1Reise.kvertrag
     zvp5Beitrag.kvertrag = zvp1Beitrag.kvertrag
     KVNotiz5.kvertrag = KVNotiz1.kvertrag
   CASE 6
     zvp6ambulant.kvertrag = zvp1ambulant.kvertrag
     zvp6station.kvertrag = zvp1station.kvertrag
     zvp6Zers.kvertrag = zvp1Zers.kvertrag
     zvp6Zahn.kvertrag = zvp1Zahn.kvertrag
     zvp6KHG.kvertrag = zvp1KHG.kvertrag
     zvp6KTG.kvertrag = zvp1KTG.kvertrag
     zvp6PV.kvertrag = zvp1PV.kvertrag
     zvp6PTG.kvertrag = zvp1PTG.kvertrag
     zvp6ZusVers.kvertrag = zvp1ZusVers.kvertrag
     zvp6Reise.kvertrag = zvp1Reise.kvertrag
     zvp6Beitrag.kvertrag = zvp1Beitrag.kvertrag
     KVNotiz6.kvertrag = KVNotiz1.kvertrag
 END SELECT 
 SummeBeitrag.kvertrag = zvp1Beitrag.kvertrag + zvp2Beitrag.kvertrag + zvp3Beitrag.kvertrag + zvp4Beitrag.kvertrag + zvp5Beitrag.kvertrag + zvp6Beitrag.kvertrag
 CALL QuickStore("KVERTRAG")
 END SUB 
 
 
 
 
SUB KVBrutzuNet()
 GBeitrBerech$ = ""
 REM REQUEST "Soll der Nettobeitrag neu berechnet werden?","",130,req%
 req% = 1
 SELECT KEY codevp.kvertrag FILE "Vprodukt" INDEX codevp.vprodukt
 IF AutomNetBer.vprodukt LIKE "j" THEN 
   GBeitrBerech$ = "TRUE"
   IF mwst.kvertrag <> 0 THEN 
     NettoBeitrag.kvertrag = VAL ( STR$ (Beitrag.kvertrag / (100 + MwSt.kvertrag) * 100,"999999999.00"))
   ELSE 
     NettoBeitrag.kvertrag = Beitrag.kvertrag
   END IF 
 END IF 
 END SUB 
 
SUB KVNetzuBrut()
 GBeitrBerech$ = ""
 REM REQUEST "Soll der Bruttobeitrag neu berechnet werden?","",130,req%
 req% = 1
 SELECT KEY codevp.kvertrag FILE "Vprodukt" INDEX codevp.vprodukt
 IF AutomNetBer.vprodukt LIKE "j" THEN 
   GBeitrBerech$ = "TRUE"
   IF mwst.kvertrag <> 0 THEN 
     Beitrag.kvertrag = VAL ( STR$ (NettoBeitrag.kvertrag + (NettoBeitrag.kvertrag / 100 * MwSt.kvertrag),"999999999.00"))
   ELSE 
     Beitrag.kvertrag = NettoBeitrag.kvertrag
   END IF 
 END IF 
 
 END SUB 
 



SUB KVBrutzuNetKV()
     NettoBeitrag.kvertrag = KVBrutto.kvertrag - KVRisikozu.kvertrag
     Beitrag.kvertrag = KVBrutto.kvertrag + Pflegepflicht.kvertrag
 END SUB 
 
SUB KVNetzuBrutKV()
     KVBrutto.kvertrag = NettoBeitrag.kvertrag + KVRisikozu.kvertrag
     Beitrag.kvertrag = KVBrutto.kvertrag + Pflegepflicht.kvertrag
 END SUB 
  


SUB KVERTRAG()
 IF disabled%("KVERTRAG") THEN END SUB 
 CALL DFile(3,"AUmsatz" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"tarif" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vorgang" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 CALL DFile(3,"kukto" + _fpw$)
 CALL DFile(3,"kgeadr" + _fpw$)
 CALL DFile(3,"maadrag" + _fpw$)
 CALL DFile(3,"fonds" + _fpw$)
 CALL DFile(3,"kvfael" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
  CALL DFile(3,"kvpsp" + _fpw$)
 END IF 
 CALL DFile(3,"Spezkond" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   CALL DFile(3,"buchung1" + _fpw$)
   CALL DFile(3,"zeingan1" + _fpw$)
   CALL DFile(3,"zeinvor" + _fpw$)
 ELSE 
   CALL DFile(3,"buchung" + _fpw$)
   CALL DFile(3,"zeingang" + _fpw$)
 END IF 
 IF GAFSK$ LIKE "TRUE" THEN 
   CALL DFile(3,"MABETREU" + _fpw$)
 END IF 
 IF VertKokor% = 0 THEN knr% = codeku.GAdrDat$
 IF ( MOD (GAdrDat$) OR NEW (GAdrDat$)) THEN CALL FStore(GAdrDat$)
 FILE "KVERTRAG"
 ok% = 1
 IF RECCOUNT (GAdrDat$) = 0 THEN ok% = 0
 IF RECCOUNT ("SPARTEN") = 0 THEN ok% = 0
 IF RECCOUNT ("MAADR") = 0 THEN ok% = 0
 IF RECCOUNT ("GEADR") = 0 THEN ok% = 0
 IF ok% = 0 THEN 
   CALL Fehler("Die Vertragserfassung ist noch nicht mîglich!","Achten Sie darauf, da· in den Datenbanken 'Adressen', 'Sparten', 'Gesellschaften' und 'Agenturen' jeweils mindestens ein Datensatz erfa·t sein mu·.")
   END SUB 
 END IF 
 
 SELECT KEY knr% FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
 IF NOT EXISTS (knr%,codeku.KVERTRAG) THEN 
   _continue% = 0
   REQUEST "Keine VertrÑge fÅr " + nachname.GAdrDat$ + " vorhanden!","Vertrag erfassen?",130,req%
   IF req% = 0 THEN 
     END SUB 
   ELSE 
     cuvt% = 0
   END IF 
 END IF 
 _formend% = 0
 SET STATUS "Vertragsverwaltung"
 CALL VERTRIntro(0)
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   vform% = 0
   SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
   IF FOUND ("SPARTEN") THEN vform1$ = Formular.SPARTEN
   vform% = VAL ( RIGHT$ (vform1$,3))
   VForm$ = "VERTRAG"
   IF vform1$ <> "" THEN VForm$ = vform1$
   IF GVertrArt$ = "j" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "W" + test$
   END IF 
   IF GLundWrigg$ = "TRUE" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "R" + test$
   END IF 
   IF GAFSK$ = "TRUE" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "K" + test$
   END IF 
   VForm$ = vform1$
   IF UCASE$ ( FORM ) <> UCASE$ (VForm$) THEN 
     IF VertKokor% = 0 THEN cuvt% = lfdnr.KVERTRAG
     tex$ = LEFT$ (nachname.GAdrDat$) + ", " + LEFT$ (Vorname.GAdrDat$) + "/" + LEFT$ (PLZ.GAdrDat$) + "-" + LEFT$ (Ort.GAdrDat$) + "/" + LEFT$ (Stra·e.GAdrDat$)
     SET HEADING LEFT$ (title$ + tex$,80)
     IF EXISTS (GPrjForm$ + VForm1$ + ".SBV") THEN 
       IF UCASE$ ( FORM ) <> UCASE$ (VForm1$) THEN OPEN FORM GPrjForm$ + VForm1$
     ELSE 
       IF UCASE$ ( FORM ) <> "VERTR000" THEN OPEN FORM GPrjForm$ + "VERTR000"
       vform% = 0
     END IF 
     SET f = Superbase.Form
   END IF 
   CALL VERTRIntro(1)
   CALL MNVERTR()
   tex$ = LEFT$ (nachname.GAdrDat$) + ", " + LEFT$ (Vorname.GAdrDat$) + "/" + LEFT$ (PLZ.GAdrDat$) + "-" + LEFT$ (Ort.GAdrDat$) + "/" + LEFT$ (Stra·e.GAdrDat$)
   SET HEADING LEFT$ (title$ + tex$,80)
   MOUSE ON 
   VERTRsub% = 0
   f.suchen.visible = - 1
   f.suchen.enabled = - 1
   f.abbruch.enabled = 0
   f.abbruch.visible = 0
   f.abbruch2.enabled = 0
   f.abbruch2.visible = 0
   f.bearb2.enabled = - 1
   f.sichern2.enabled = - 1
   CALL VERTRUpdate()
   CALL ClearKBDBuffer()
   IF ag$ = "j" THEN 
     f.bearb2.enabled = 0
     f.sichern2.enabled = 0
     f.bearb.enabled = 0
     f.sichern.enabled = 0
     f.bearb2.visible = 0
     f.sichern2.visible = 0
     f.bearb.visible = 0
     f.sichern.visible = 0
     f.neu.visible = 0
     f.neu.enabled = 0
     f.status.enabled = 0
     f.status.visible = 0
     f.speziprov.enabled = 0
     f.speziprov.visible = GShowSpeziKond%
     f.cspezprov.visible = GShowSpeziKond%
     f.cspezprov.enabled = 0
     f.bertarif.enabled = 0
     f.bertarif.visible = Gbertarif%
     REM f.CommandButton26.enabled = 0
     REM f.CommandButton26.visible = 0
     f.konditionen.enabled = 0
     f.konditionen.visible = 0
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
   END IF 
   IF VERTRsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU FOR 600
   REM ** Tastencodes
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL VERTRPrev()
   CASE CrsRight%,PgDn%
     CALL VERTRNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE VERTRsub%
   CASE 205
     codevt% = lfdnr.kvertrag
     IF ag$ <> "j" THEN 
       IF NOT disabled%("VERTRBEARB") THEN 
         ge% = GetCodeGE%(CodeEingGE.kvertrag)
         IF ge% > 0 THEN 
           MOUSE OFF 
           SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
           SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
           codevt% = lfdnr.kvertrag
           CodeEingGE.kvertrag = ge%
           EingereichtBei.kvertrag = gesellschaft.geadr
           eingbei$ = gesellschaft.geadr
           STORE FILE "kvertrag"
           IF EXISTS (codevt%,codevt.zeinvor) THEN 
             FILE "zeinvor"
             INDEX codevt.zeinvor
             SELECT KEY codevt% LOCK FILE "zeinvor" INDEX codevt.zeinvor
             WHILE NOT EOF ("zeinvor") AND codevt.zeinvor = codevt%
               CodeEingGE.zeinvor = CodeEingGE.kvertrag
               EingereichtBei.zeinvor = EingereichtBei.kvertrag
               STORE FILE "zeinvor"
               SELECT NEXT LOCK FILE "zeinvor" INDEX codevt.zeinvor
             WEND 
           END IF 
           IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
             buch$ = "Buchung1"
             zein$ = "zeingan1"
           ELSE 
             buch$ = "Buchung"
             zein$ = "zeingang"
           END IF 
           IF EXISTS (codevt%,codevt.buch$) THEN 
             FILE buch$
             INDEX codevt.buch$
             SELECT KEY codevt% LOCK FILE buch$ INDEX codevt.buch$
             WHILE NOT EOF (buch$) AND codevt.buch$ = codevt%
               CodeEingGE.buch$ = CodeEingGE.kvertrag
               EingereichtBei.buch$ = EingereichtBei.kvertrag
               STORE FILE buch$
               SELECT NEXT LOCK FILE buch$ INDEX codevt.buch$
             WEND 
           END IF 
           IF EXISTS (codevt%,codevt.zein$) THEN 
             FILE zein$
             INDEX codevt.zein$
             SELECT KEY codevt% LOCK FILE zein$ INDEX codevt.zein$
             WHILE NOT EOF (zein$) AND codevt.zein$ = codevt%
               CodeEingGE.zein$ = CodeEingGE.kvertrag
               EingereichtBei.zein$ = EingereichtBei.kvertrag
               STORE FILE zein$
               SELECT NEXT LOCK FILE zein$ INDEX codevt.zein$
             WEND 
           END IF 
 
 
         END IF 
         FILE "kvertrag"
         FORM 
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion wird in der Agentuvariante nicht unterstÅtzt!","")
     END IF 
 
   CASE 1
     cuvt% = lfdnr.kvertrag
     CALL VERTRSuchen1()
   CASE 2
     CALL DruckVertr(knr%,1)
   CASE 3
     cuvt% = lfdnr.KVERTRAG
     CALL Vorgang()
   CASE 4
     REM VertragNext
     CALL VERTRNext()
     lfdnr% = cuvt%
   CASE 5
     REM Vertragprev
     CALL VERTRPrev()
     lfdnr% = cuvt%
   CASE 6
     cuvt% = lfdnr.KVERTRAG
     cuge% = Codege.kvertrag
     CALL GEADR()
     cuge% = 0
     lfdnr% = cuvt%
   CASE 7
     cuvt% = lfdnr.KVERTRAG
     codevaprobe% = codeva.kvertrag
     CALL CODEVA()
     codevaprobe% = 0
     lfdnr% = cuvt%
   CASE 8
     cuvt% = lfdnr.KVERTRAG
     cuma% = Codema.kvertrag
     CALL MAADR()
     cuma% = 0
     lfdnr% = cuvt%
   CASE 9
     IF NOT disabled%("VERTRNeu") THEN 
       REQUEST "Mîchten Sie den Vertrag dynamisieren?","",130,req%
       IF req% = 1 THEN 
         IF ProviAb.kvertrag < 1 OR Fremdvertrag.KVERTRAG LIKE "j" OR Altvertrag.KVERTRAG LIKE "j" THEN 
           CALL Fehler("Vertrag kann nicht dynamisiert werden, da er entweder ein Altvertrag, Fremdvertrag","ist oder noch nicht an die Provisionsabrechnung Åbergeben wurde!")
         ELSE 
           IF ProviAb.kvertrag > 1 AND storno.kvertrag > 0 THEN 
             CALL Fehler("Vertrag kann nicht dynamisiert werden, da er bereits storniert wurde!","")
           ELSE 
 
             CALL Dynamisier(lfdnr.kvertrag)
             lfdnr% = lfdnr.kvertrag
           END IF 
         END IF 
       END IF 
     END IF 
   CASE 10
     cuvt% = lfdnr.KVERTRAG
     CALL KuKto()
   CASE 99
     IF NOT disabled%("VERTRBEARB") THEN 
       MOUSE ON 
       MENU OFF 
       SELECT CASE PAGE 
       CASE 1
         CALL ButDesabled()
         f.seite2.enabled = 0
         f.konditionen.enabled = 0
         f.status.enabled = 0
         f.nachbearb.enabled = 0
         f.zahlweise.enabled = 0
         f.zahlart.enabled = 0
         f.speziprov.enabled = 0
         f.speziprov.visible = GShowSpeziKond%
         f.cspezprov.visible = GShowSpeziKond%
         f.cspezprov.enabled = GShowSpeziKond%
         f.bertarif.enabled = 0
         f.bertarif.visible = Gbertarif%
         SELECT CASE vform%
         CASE 0
           IF ProviAb.KVERTRAG <> 0 THEN 
             REM Buttons Gesellschaft,Sparte und Mitarbeiter auf readonly setzen
           END IF 
           ENTER VS_Nr.KVERTRAG,0
         CASE ELSE 
           IF ProviAb.KVERTRAG <> 0 THEN 
             REM Buttons Gesellschaft,Sparte und Mitarbeiter auf readonly setzen
           END IF 
           ENTER VS_Nr.KVERTRAG,0
         END SELECT 
         CALL ButEnabled()
         f.seite2.enabled = - 1
         f.konditionen.enabled = - 1
         f.status.enabled = - 1
         f.nachbearb.enabled = - 1
         f.zahlweise.enabled = - 1
         f.zahlart.enabled = - 1
         f.abbruch2.enabled = 0
         f.bearb2.enabled = - 1
         f.speziprov.enabled = GShowSpeziKond%
         f.speziprov.visible = GShowSpeziKond%
         f.cspezprov.visible = GShowSpeziKond%
         f.cspezprov.enabled = GShowSpeziKond%
         f.bertarif.enabled = Gbertarif%
         f.bertarif.visible = Gbertarif%
       CASE 2
         f.seite1.enabled = 0
         f.abbruch2.enabled = - 1
         f.abbruch2.visible = - 1
         f.bearb2.enabled = 0
         SELECT CASE vform%
         CASE 0
           ENTER BesVereinbarung.kvertrag,0
         CASE 2
           ENTER Vollinvalid1.KVERTRAG,0
         CASE 3
           ENTER zvp1ambulant.kvertrag,0
         CASE 5
           ENTER VS_Nr.KVERTRAG,0
         CASE 6,7,8
           ENTER Risiko.KVERTRAG,0
         CASE 10,11
           ENTER risiko.kvertrag,0
         CASE 12
           ENTER RSPrivatjn.kvertrag,0
         CASE 13
           ENTER BezFond1.kvertrag,0
         CASE ELSE 
           ENTER BUZ_Endalter.KVERTRAG,0
         END SELECT 
         f.seite1.enabled = - 1
         f.abbruch2.enabled = 0
         f.abbruch2.visible = 0
         f.bearb2.enabled = - 1
         IF abbruch% = - 1 THEN 
           SELECT KEY lfdnr.kvertrag FILE "kvertrag" INDEX lfdnr.kvertrag
           FORM 
           abbruch% = 0
         END IF 
       END SELECT 
       MENU ON 
     END IF 
   CASE 100
     IF proviab.kvertrag < 1 THEN 
       CALL VertrVPWahl()
     ELSE 
    CALL Fehler("Leider kînnen Sie fÅr diesen Vertrag zur Zeit kein anderes Produkt auswÑhlen, da er bereits an die Provisionsabrechnung Åbergeben wurde!","Um den Vertrag aus der Provisionsabrechnung zu entfernen -> Button STATUS -> Button DEAKTIVIEREN")
     END IF 
   CASE 101
     IF proviab.kvertrag < 1 THEN 
       CALL SMaadr()
     ELSE 
       a$ = "Leider kînnen Sie fÅr diesen Vertrag zur Zeit keinen anderen Mitarbeiter auswÑhlen, da er bereits an die Provisionsabrechnung Åbergeben wurde!"
       CALL Fehler(a$,"Um den Vertrag aus der Provisionsabrechnung zu entfernen -> Button STATUS -> Button DEAKTIVIEREN")
     END IF 
   CASE 102
     REM Spezialprovisionen
     REM Spezialprovisionen
     IF NOT disabled%("SPEZKOND") THEN 
       IF codege.kvertrag > 0 AND codeva.kvertrag > 0 AND codema.kvertrag > 0 THEN 
         FILE "SPEZKOND"
         CALL SpezialProvi()
       ELSE 
         CALL Fehler("Sie mÅssen zu dem Vertrag mindestens das Produkt und die vertragsabschlie·ende Agentur","erfa·t haben, um Spezialprovisionen erfassen zu kînnen!")
       END IF 
     END IF 
     FILE "KVERTRAG"
   CASE 104
     REM Aufruf des Zahlungseinganges
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       IF EXISTS (lfdnr.kvertrag,codevt.zeingang) THEN 
         CALL KNZeingang(lfdnr.kvertrag)
       ELSE 
         REQUEST "Es existieren noch keine ZahlungseingÑnge!","Wollen Sie einen Zahlungseingang erfassen?",130,req%
         IF req% = 1 THEN 
           IF LTRIM$ (VS_NR.kvertrag) <> "" THEN 
             CALL ZEINNeu2N()
             CALL KNZeingang(lfdnr.kvertrag)
           ELSE 
             CALL Fehler("Sie kînnen erst einen Zahlungseingang erfassen, wenn fÅr den Vertrag eine Policenummer eingetragen wurde!","")
           END IF 
         END IF 
       END IF 
     ELSE 
       IF EXISTS (lfdnr.kvertrag,codevt.zeingan1) THEN 
         CALL KZeingang(lfdnr.kvertrag)
       ELSE 
         REQUEST "Es existieren noch keine ZahlungseingÑnge!","Wollen Sie einen Zahlungseingang erfassen?",130,req%
         IF req% = 1 THEN 
           CALL ZEINNeu2()
           CALL KZeingang(lfdnr.kvertrag)
         END IF 
       END IF 
     END IF 
   CASE 105
     IF ag$ <> "j" THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         CALL KBuchung(lfdnr.kvertrag,"BUCHUNG")
       ELSE 
         CALL KBuchung(lfdnr.kvertrag,"BUCHUNG1")
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion steht in der Agenturversion nicht zur VerfÅgung","")
     END IF 
   CASE 106
     REM Aufruf des Zahlungseinganges
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     ELSE 
       IF ag$ <> "j" THEN 
         IF EXISTS (lfdnr.kvertrag,codevt.zeinvor) THEN 
           IF NOT disabled%("SOLLSTELLUNG") THEN 
             CALL ZEINVOR(lfdnr.kvertrag)
           END IF 
         ELSE 
           REQUEST "Es existieren noch keine Sollstellungen!","Wollen Sie eine Sollstellung erfassen?",135,req%
           IF req% = 1 THEN 
             CALL ZeinvorNeu()
             CALL ZEINVOR(lfdnr.kvertrag)
           END IF 
         END IF 
       ELSE 
         CALL Fehler("Diese Funktion steht in der Agenturversion nicht zur VerfÅgung","")
       END IF 
     END IF 
   CASE 199
     REM GDV Leben 
     codeva% = codeva.kvertrag
     IF codeva% > 0 THEN 
       SELECT KEY codeva% FILE "Sparten" INDEX codeva.sparten
 
 
       IF Hauptsparte.sparten > - 1 THEN 
        SELECT CASE Hauptsparte.sparten
        CASE 10
           CALL le21011()
           REM Leben
         CASE 70
           REM Rechtsschutz
           CALL re021011()
         CASE 40
           REM Haftpflicht
           CALL ha021011()
         CASE 510
           REM Verkehrsservice
           CALL vs021011()
         CASE 130
           REM Hausrat
           CALL vh021011()
         CASE 110
           REM Glas
           CALL gl021011()
         REM CASE 190 
           REM Transport    
            CALL tr021011()
         REM CASE 020
           REM Kranken
           REM CALL kk021011()
         REM CASE 030
           REM Unfall
           REM CALL un021011()
         CASE 080,081,082,083,231,089,090,099,100,109,120,150,180,181,210
           REM Feuer
           CALL fu021011()
         REM CASE 060,160,290,233,293,294,299
           REM Undefiniert
           REM CALL ud021011()
         REM CASE 171,172,174,175,176,179,232,290
           REM  Technische
           REM CALL te021011()
         CASE 50
           REM KFZ
           CALL Fehler("FÅr KFZ wurden alle Daten komplett Åbernommen, deshalb wird die GDV - Struktur nicht gesondert angezeigt!","")
    REM ********************* 
         CASE ELSE 
           CALL Fehler("Sorry zur Zeit sind nur die GDV-Daten fÅr Leben,Haftpflicht, Rechtsschutz, Verkehrsservice und Hausrat einsehbar!","")
         END SELECT 
       ELSE 
         CALL Fehler("Der Sparte wurde keine GDV-Hauptsparte zugewiesen!","Wechseln Sie in die Spartenmaske und erfassen Sie dort bei der Sparte die zugehîrige GDV-Hauptsparten-Nr!")
       END IF 
 
 
     ELSE 
       CALL Fehler ("Sie haben dem Vertrag noch keine Sparte zugeordnet!","BetÑtigen Sie den Button <Bearbeiten> und wechseln Sie dann in das Spartenauswahlfeld, um eine Sparte zuzuordnen!")
     END IF 
   END SELECT 
   CALL BMCheckMail()
   cuvt% = lfdnr.KVERTRAG
 WEND 
 IF FileChanged%("KVERTRAG") = 1 AND abbruch% = 0 THEN CALL FStore("KVERTRAG")
 REM END IF 
 cuivt% = lfdnr.KVERTRAG
 cuvt% = 0
 abbruch% = 0
 _formend% = 0
 END SUB 
   


 '***********************************************************************************************
 ' Anpassung Konditionen  
 
 ' prozentuale Anpassung der aktuellen Kondition
 ' =======================================================================
  
SUB ANPASSUNG()
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung der aktuellen Kondition:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"aktuelle Kondition angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   _cuko% = lfdnr.GEKOND
   SELECT KEY _cuko% LOCK FILE "GEKOND" INDEX lfdnr.GEKOND
   MOUSE OFF 
   SET STATUS "WARTEN: Kondition wird angepa·t..."
   REM REQUEST "gewÑhlter Anpassungswert:",anp$,0
   
   IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
   IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
   IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
   IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
   IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
   IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
   IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
   IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
   IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
   IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
   IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
   IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
   IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
   IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
   IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
   IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
   IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
   IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
   IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
   IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
   IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
   IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
   CALL MATimeStamp("gekond")
   CALL FStore("GEKOND")
   FORM 
   MOUSE ON 
   SET STATUS "Bereit"
 END IF 
 END SUB 
 
 
 
SUB ANPASSUNGS()
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,166,10,0,"Stornoreserve der aktuellen Kondition:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"aktuelle Stornoreserve angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% >= 0 THEN 
   _cuko% = lfdnr.GEKOND
   SELECT KEY _cuko% LOCK FILE "GEKOND" INDEX lfdnr.GEKOND
   MOUSE OFF 
   SET STATUS "WARTEN: Kondition wird angepa·t..."
   REM REQUEST "gewÑhlter Anpassungswert:",anp$,0
   
   IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp%
   IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp%
   IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp%
   IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp%
   IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp%
   IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp%
   CALL MATimeStamp("gekond")
   CALL FStore("GEKOND")
   FORM 
   MOUSE ON 
   SET STATUS "Bereit"
 END IF 
 END SUB 
 
 
 
 ' prozentuale Anpassung aller Kondition mit PrÅfung, ob das geht
 ' =======================================================================
  
SUB ANPASSUNG2()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Kondition:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Konditionen angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 REM ADD DIALOG "ANPASSUNG",5,86,60,7,8,0,"%"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   REQUEST "Mîchten Sie die Åbenommenen Stornoreserven anpassen?","Beachten Sie, da· die Kond.des VorgÑngers als 100% angesehen werden",130,req131%
   IF req131% = 1 THEN 
     CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
     ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Stornoreserven:"
     ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
     ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Stornoreserven angepa·t werden soll."
     ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp1$,10
     ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
     ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
     ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
     DIALOG "ANPASSUNG",req1%
     REMOVE DIALOG "ANPASSUNG"
     anp1% = VAL (anp1$)
     anp1$ = STR$ (anp1%)
   END IF 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   zzab% = 0
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     zzab% = zzab% + 1
     ok% = 1
     IF bwbis.gekond > 0 AND anpass.gekond = 1 THEN 
       SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
       ges$ = Gesellschaft.geadr
       SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
       sparte$ = Sparte.sparten
       bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
       bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
       ap$ = STR$ (ap.gekond,"999.9999")
       co$ = STR$ (courtage.gekond,"999.9999")
       pf$ = STR$ (PflegeProvi.gekond,"999.9999")
       sr$ = STR$ (sr.gekond,"999.9999")
       dyn$ = STR$ (DynamikProz.gekond,"999.9999")
       betreu$ = STR$ (BetreuProz.gekond,"999.9999")


       gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
       IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
       IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
       IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
       IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
       IF DynamikPjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Dynamik: " + dyn$
       IF Betreujn.gekond = "j" THEN gesamt$ = gesamt$ + ", Betreuung: " + betreu$

       IF GKondNoDattes$ <> "TRUE" THEN 
         CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
         REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
       ELSE 
         reqab% = 1
       END IF 
       IF reqab% <> 1 THEN ok% = 0
     END IF 
     IF ok% = 1 THEN 
       IF anpass.gekond = 1 THEN 
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999") + " Datensatz: " + STR$ (zzab%,"99999999")
         IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
         IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
         IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
         IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
         IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
         IF AP.gekond <> 0 AND anpass.gekond = 1 THEN AP.gekond = (AP.gekond / 100) * anp%
         IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
         IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%

         REM 220697
         IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
         IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
         IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
         IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
         IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
         IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
         IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
         IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
         IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
         IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
         IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
         IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
         IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
         IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
         IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
         IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
         IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         IF req1% = 1 AND anp1% > - 1 THEN 
           IF anp1% = 0 THEN srjn.gekond = "n"
           IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp1%
           IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp1%
           IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp1%
           IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp1%
           IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp1%
           IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp1%
         END IF 
         anpass.gekond = 0
       END IF 
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
SUB ANPASSUNG2S()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Stornoreserven:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Stornoreserven angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF bwbis.gekond > 0 THEN 
       SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
       ges$ = Gesellschaft.geadr
       SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
       sparte$ = Sparte.sparten
       bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
       bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
       ap$ = STR$ (ap.gekond,"999.9999")
       co$ = STR$ (courtage.gekond,"999.9999")
       pf$ = STR$ (PflegeProvi.gekond,"999.9999")
       sr$ = STR$ (sr.gekond,"999.9999")
       dyn$ = STR$ (DynamikProz.gekond,"999.9999")
       betreu$ = STR$ (BetreuProz.gekond,"999.9999")

       gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
       IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
       IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
       IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
       IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
       IF DynamikPjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Dynamik: " + dyn$
       IF Betreujn.gekond = "j" THEN gesamt$ = gesamt$ + ", Betreuung: " + betreu$

       CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
       REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
       IF reqab% <> 1 THEN ok% = 0
     END IF 
     IF ok% = 1 THEN 
       IF anpass.gekond = 1 THEN 
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp%
         IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp%
         IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp%
         IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp%
         IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp%
         IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp%
         anpass.gekond = 0
       END IF 
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
  
 
 
 
 
 ' prozentuale Anpassung aller Kondition ohne PrÅfung, ob das geht
 ' =======================================================================
  
SUB ANPASSUNG3()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Konditionen:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Konditionen angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF bwbis.gekond > 0 THEN 
       SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
       ges$ = Gesellschaft.geadr
       SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
       sparte$ = Sparte.sparten
       bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
       bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
       ap$ = STR$ (ap.gekond,"999.9999")
       co$ = STR$ (courtage.gekond,"999.9999")
       pf$ = STR$ (PflegeProvi.gekond,"999.9999")
       sr$ = STR$ (sr.gekond,"999.9999")
       dyn$ = STR$ (DynamikProz.gekond,"999.9999")
       betreu$ = STR$ (BetreuProz.gekond,"999.9999")

       gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
       IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
       IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
       IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
       IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
       IF DynamikPjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Dynamik: " + dyn$
       IF Betreujn.gekond = "j" THEN gesamt$ = gesamt$ + ", Betreuung: " + betreu$

       CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
       REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
       IF reqab% <> 1 THEN ok% = 0
     END IF 
     IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
         IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
         IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
         IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
         IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
         IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
         IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
         IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%

         REM 220697
         IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
         IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
         IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
         IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
         IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
         IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
         IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
         IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
         IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
         IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
         IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
         IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
         IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
         IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
         IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
         IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
         IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
  ' prozentuale Anpassung aller Kondition, die nicht absgeschlossen sind ohne PrÅfung, ob das geht
 ' ======================================================================= 
SUB ANPASSUNG3A1()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,104,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,166,20,0,"Anpassung aller Konditionen, die nicht abgeschlossen sind:"
 ADD DIALOG "ANPASSUNG",5,6,30,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,40,150,8,0,"Konditionen angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,59,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,59,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,80,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,80,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF bwbis.gekond > 0 THEN 
       ok% = 0
     END IF 
     IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
         IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
         IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
         IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
         IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
         IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
         IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
         IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%
         REM 220697
         IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
         IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
         IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
         IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
         IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
         IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
         IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
         IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
         IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
         IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
         IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
         IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
         IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
         IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
         IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
         IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
         IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
 
SUB ANPASSUNG3P()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,113,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,136,10,0,"fÅr diesen Mitabeiter fÅr alle Produkte:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, welcher Wert in die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Pflegeprovision Åbernommen werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Wert:"
 ADD DIALOG "ANPASSUNG",2,34,68,148,11,0,"Pflege Ja/Nein","j","n",Pflege$
 ADD DIALOG "ANPASSUNG",1,34,89,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,89,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 THEN 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF bwbis.gekond > 0 THEN 
       SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
       ges$ = Gesellschaft.geadr
       SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
       sparte$ = Sparte.sparten
       bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
       bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
       ap$ = STR$ (ap.gekond,"999.9999")
       co$ = STR$ (courtage.gekond,"999.9999")
       pf$ = STR$ (PflegeProvi.gekond,"999.9999")
       sr$ = STR$ (sr.gekond,"999.9999")
       dyn$ = STR$ (DynamikProz.gekond,"999.9999")
       betreu$ = STR$ (BetreuProz.gekond,"999.9999")


       gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
       IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
       IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
       IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
       IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
       IF DynamikPjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Dynamik: " + dyn$
       IF Betreujn.gekond = "j" THEN gesamt$ = gesamt$ + ", Betreuung: " + betreu$


       CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
       REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
       IF reqab% <> 1 THEN ok% = 0
     END IF 
     IF ok% = 1 THEN 
         SET STATUS "WARTEN: Kondition wird Åbernommen... " + STR$ (lfdnr.GEKOND,"99999999")
         PflegeJN.gekond = pflege$
         PflegeProvi.gekond = anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
  
 ' prozentuale Anpassung aller Kondition ohne PrÅfung, ob das geht
 ' =======================================================================
  
SUB GekoDMEinh()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Konditionen:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Betrag"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"das Feld DM/Einheit gesetzt werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF bwbis.gekond > 0 THEN 
       SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
       ges$ = Gesellschaft.geadr
       SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
       sparte$ = Sparte.sparten
       bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
       bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
       ap$ = STR$ (ap.gekond,"9999.99")
       co$ = STR$ (courtage.gekond,"9999.99")
       pf$ = STR$ (PflegeProvi.gekond,"9999.99")
       sr$ = STR$ (sr.gekond,"9999.99")
       gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
       IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
       IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
       IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
       IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
       CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
       REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
       IF reqab% <> 1 THEN ok% = 0
     END IF 
     IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         DMEinheit.gekond = anp%
         EuroEinheit.gekond = DMEinheit.gekond / umrechnung.stamm
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
  
 
SUB ANPASSUNG3S()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Stornoreserven:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Stornoreserven angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% >= 0 THEN 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF bwbis.gekond > 0 THEN 
       SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
       ges$ = Gesellschaft.geadr
       SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
       sparte$ = Sparte.sparten
       bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
       bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
       ap$ = STR$ (ap.gekond,"9999.99")
       co$ = STR$ (courtage.gekond,"9999.99")
       pf$ = STR$ (PflegeProvi.gekond,"9999.99")
       sr$ = STR$ (sr.gekond,"9999.99")
       gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
       IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
       IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
       IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
       IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
       CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
       REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
       IF reqab% <> 1 THEN ok% = 0
     END IF 
     IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp%
         IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp%
         IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp%
         IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp%
         IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp%
         IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
  
 
SUB ANPASSUNG3S1()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 anp$ = "0"
 wert% = 0
ko170420031: 
 CREATE DIALOG "ANPASSUNG",0,0,177,150,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,166,20,0,"Anpassung aller Stornoreserven, der Konditionen, die nicht abgeschlossen sind:"
 ADD DIALOG "ANPASSUNG",5,6,30,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,40,150,8,0,"Stornoreserven angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,59,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,59,38,11,0,"Anpassung:"
 
 ADD DIALOG "ANPASSUNG",5,6,79,159,8,0,"oder geben Sie einen absoluten Wert ein"
 ADD DIALOG "ANPASSUNG",5,6,89,150,8,0,"der als Wert eingetragen werden soll"
 ADD DIALOG "ANPASSUNG",6,46,102,59,13,0,0,wert%,3
 ADD DIALOG "ANPASSUNG",5,6,102,38,11,0,"Wert:"
 ADD DIALOG "ANPASSUNG",1,34,130,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,130,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF anp% > 0 AND wert% > 0 AND req% = 1 THEN 
   CALL Fehler ("Es darf nur einer der beiden Werte > 0 sein!","")
   GOTO ko170420031
 END IF 
 IF req% = 1 THEN 
   FILE "gekond"
   INDEX CodeMA.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY cuma% LOCK FILE "gekond" INDEX CodeMA.gekond
   WHILE (CodeMA.gekond = cuma%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF bwbis.gekond > 0 THEN 
       ok% = 0
     END IF 
     IF ok% = 1 THEN 
       IF anp% >= 0 AND wert% = 0 THEN 
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp%
         IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp%
         IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp%
         IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp%
         IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp%
         IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp%
         anpass.gekond = 0
         CALL MATimeStamp("gekond")
         CALL QuickStore("gekond")
       ELSE 
         IF anp% = 0 AND wert% > 0 THEN 
           SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
           IF VD1SR.gekond <> 0 THEN VD1SR.gekond = wert%
           IF VD2SR.gekond <> 0 THEN VD2SR.gekond = wert%
           IF VD3SR.gekond <> 0 THEN VD3SR.gekond = wert%
           IF VD4SR.gekond <> 0 THEN VD4SR.gekond = wert%
           IF VD5SR.gekond <> 0 THEN VD5SR.gekond = wert%
           IF SR.gekond <> 0 THEN SR.gekond = wert%
           anpass.gekond = 0
           CALL MATimeStamp("gekond")
           CALL QuickStore("gekond")
         ELSE 
           IF wert% = 0 AND anp% = 0 THEN 
             SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
             IF VD1SR.gekond <> 0 THEN VD1SR.gekond = wert%
             IF VD2SR.gekond <> 0 THEN VD2SR.gekond = wert%
             IF VD3SR.gekond <> 0 THEN VD3SR.gekond = wert%
             IF VD4SR.gekond <> 0 THEN VD4SR.gekond = wert%
             IF VD5SR.gekond <> 0 THEN VD5SR.gekond = wert%
             IF SR.gekond <> 0 THEN SR.gekond = wert%
             anpass.gekond = 0
             CALL MATimeStamp("gekond")
             CALL QuickStore("gekond")
           END IF 
         END IF 
       END IF 
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX CodeMA.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
  
 
 
 
 
 
 
 REM   Anpassung Konditionen aller Mitarbeiters fÅr dieses Produkt ohne PrÅfung ob das geht
 
SUB ANPASSUNG4()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,136,10,0,"fÅr alle Mitabeiter fÅr dieses Produkt:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Konditionen angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeGE.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY codege% LOCK FILE "gekond" INDEX CodeGE.gekond
   WHILE (CodeGE.gekond = codege%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF codeva.gekond = codeva% THEN 
       IF bwbis.gekond > 0 THEN 
         SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
         ges$ = Gesellschaft.geadr
         SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
         sparte$ = Sparte.sparten
         bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
         bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
         ap$ = STR$ (ap.gekond,"9999.99")
         co$ = STR$ (courtage.gekond,"9999.99")
         pf$ = STR$ (PflegeProvi.gekond,"9999.99")
         sr$ = STR$ (sr.gekond,"9999.99")
         dyn$ = STR$ (DynamikProz.gekond,"999.9999")
         betreu$ = STR$ (BetreuProz.gekond,"999.9999")
         gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
         IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
         IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
         IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
         IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
         IF DynamikPjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Dynamik: " + dyn$
         IF Betreujn.gekond = "j" THEN gesamt$ = gesamt$ + ", Betreuung: " + betreu$
         CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
         REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
         IF reqab% <> 1 THEN ok% = 0
       END IF 
 
       IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
         IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
         IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
         IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
         IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
         IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
         IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
         IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%
         REM 220697
         IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
         IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
         IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
         IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
         IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
         IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
         IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
         IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
         IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
         IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
         IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
         IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
         IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
         IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
         IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
         IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
         IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
       END IF 
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codege.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
 REM   Anpassung Konditionen aller Mitarbeiters fÅr dieses Produkt/Pflege ohne PrÅfung ob das geht
 
SUB ANPASSUNG4pf()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 SELECT WHERE FILE "gekond"
 CALL Fehler("Nachfolgend kînnen Sie die Pflegekonditionen aktivieren und als Prozentwert die AP Kondition eintragen lassen","")
 REQUEST "Soll diese Anpassung jetzt durchgefÅhrt werden?","",130,req%
 IF req% = 1 THEN 
   FILE "gekond"
   INDEX CodeGE.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY codege% LOCK FILE "gekond" INDEX CodeGE.gekond
   ii% = 0
   jj% = 0
   WHILE (CodeGE.gekond = codege%) AND ( NOT EOF ("gekond"))
     ii% = ii% + 1
     ok% = 1
     IF codeva.gekond = codeva% THEN 
       jj% = jj% + 1
       PflegeJN.gekond = "j"
       PflegeProvi.gekond = ap.gekond
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
       END IF 
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codege.gekond
   WEND 
   ii$ = LTRIM$ ( STR$ (ii%,",9999999"))
   jj$ = LTRIM$ ( STR$ (jj%,",9999999"))
   CALL Fehler("Es wurden " + jj$ + " konditionen angeapa·t/von zu dieser Gesellschaft gehîrenden: " + ii$,"")
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 CALL Fehler("Anpassungen wurden durchgefÅhrt","")
 FILE "gekond"
 SELECT WHERE CodeMA.GEKOND = cuma%
 END SUB 
 



 REM   Anpassung aller nicht abgeschlossenen Konditionen aller Mitarbeiters fÅr dieses Produkt ohne PrÅfung ob das geht
 
SUB ANPASSUNG4A1()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,104,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,166,20,0,"fÅr alle nicht abgeschlossenen Konditionen aller Mitabeiter fÅr dieses Produkt:"
 ADD DIALOG "ANPASSUNG",5,6,30,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,40,150,8,0,"Konditionen angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,59,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,59,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,80,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,80,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeGE.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY codege% LOCK FILE "gekond" INDEX CodeGE.gekond
   WHILE (CodeGE.gekond = codege%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF codeva.gekond = codeva% THEN 
       IF bwbis.gekond > 0 THEN 
         ok% = 0
       END IF 
 
       IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
         IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
         IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
         IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
         IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
         IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
         IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
         IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%
         REM 220697
         IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
         IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
         IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
         IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
         IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
         IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
         IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
         IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
         IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
         IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
         IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
         IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
         IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
         IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
         IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
         IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
         IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
       END IF 
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codege.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
 
 
SUB ANPASSUNG4P()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 codevp% = codevp.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,113,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,136,10,0,"fÅr alle Mitabeiter fÅr dieses Produkt:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, welcher Wert in die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Pflegeprovision Åbernommen werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Wert:"
 ADD DIALOG "ANPASSUNG",2,34,68,148,11,0,"Pflege Ja/Nein","j","n",Pflege$
 ADD DIALOG "ANPASSUNG",1,34,89,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,89,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 THEN 
   FILE "gekond"
   INDEX Codevp.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY codevp% LOCK FILE "gekond" INDEX Codevp.gekond
   WHILE (Codevp.gekond = codevp%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF codeva.gekond = codeva% THEN 
       IF bwbis.gekond > 0 THEN 
         SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
         ges$ = Gesellschaft.geadr
         SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
         sparte$ = Sparte.sparten
         bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
         bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
         ap$ = STR$ (ap.gekond,"9999.99")
         co$ = STR$ (courtage.gekond,"9999.99")
         pf$ = STR$ (PflegeProvi.gekond,"9999.99")
         sr$ = STR$ (sr.gekond,"9999.99")
         gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
         IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
         IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
         IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
         IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
         CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
         REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
         IF reqab% <> 1 THEN ok% = 0
       END IF 
 
       IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird Åbernommen... " + STR$ (lfdnr.GEKOND,"99999999")
         PflegeJN.gekond = pflege$
         PflegeProvi.gekond = anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
       END IF 
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codevp.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
SUB ANPASSUNG4S()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"fÅr alle Mitabeiter fÅr dieses Produkt:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Stornoreserven angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% >= 0 THEN 
   FILE "gekond"
   INDEX CodeGE.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY codege% LOCK FILE "gekond" INDEX CodeGE.gekond
   WHILE (CodeGE.gekond = codege%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF codeva.gekond = codeva% THEN 
       IF bwbis.gekond > 0 THEN 
         SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
         ges$ = Gesellschaft.geadr
         SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
         sparte$ = Sparte.sparten
         bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
         bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
         ap$ = STR$ (ap.gekond,"9999.99")
         co$ = STR$ (courtage.gekond,"9999.99")
         pf$ = STR$ (PflegeProvi.gekond,"9999.99")
         sr$ = STR$ (sr.gekond,"9999.99")
         gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
         IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
         IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
         IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
         IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
         CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
         REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
         IF reqab% <> 1 THEN ok% = 0
       END IF 
 
       IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp%
         IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp%
         IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp%
         IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp%
         IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp%
         IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
       END IF 
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codege.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
SUB ANPASSUNG4S1()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 
 anp$ = "0"
 wert% = 0
ko170420032: 
 CREATE DIALOG "ANPASSUNG",0,0,177,160,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,166,30,0,"Anpassung aller Stornoreserven, aller Mitarbeiter fÅr dieses Produkt, der nichtabgeschlossenen Konditionen:"
 ADD DIALOG "ANPASSUNG",5,6,40,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,50,150,8,0,"Stornoreserven angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,69,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,69,38,11,0,"Anpassung:"
 
 ADD DIALOG "ANPASSUNG",5,6,89,159,8,0,"oder geben Sie einen absoluten Wert ein"
 ADD DIALOG "ANPASSUNG",5,6,99,150,8,0,"der als Wert eingetragen werden soll"
 ADD DIALOG "ANPASSUNG",6,46,112,59,13,0,0,wert%,3
 ADD DIALOG "ANPASSUNG",5,6,112,38,11,0,"Wert:"
 ADD DIALOG "ANPASSUNG",1,34,140,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,140,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF anp% > 0 AND Wert% > 0 THEN 
   CALL Fehler("Es darf nur in einem Feld der Wert > 0 sein!","")
   GOTO ko170420032
 END IF 
 IF req% = 1 AND anp% >= 0 THEN 
   FILE "gekond"
   INDEX CodeGE.gekond
   SELECT FIRST FILE "GEKOND"
   SELECT KEY codege% LOCK FILE "gekond" INDEX CodeGE.gekond
   WHILE (CodeGE.gekond = codege%) AND ( NOT EOF ("gekond"))
     ok% = 1
     IF codeva.gekond = codeva% THEN 
       IF bwbis.gekond > 0 THEN 
         ok% = 0
       END IF 
 
       IF ok% = 1 THEN 
         IF anp% >= 0 AND wert% = 0 THEN 
           SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
           IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp%
           IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp%
           IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp%
           IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp%
           IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp%
           IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp%
           anpass.gekond = 0
           CALL MATimeStamp("gekond")
           CALL QuickStore("gekond")
         ELSE 
           IF (anp% = 0 AND wert% > 0) OR (anp% = 0 AND wert% = 0) THEN 
             SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
             IF VD1SR.gekond <> 0 THEN VD1SR.gekond = wert%
             IF VD2SR.gekond <> 0 THEN VD2SR.gekond = wert%
             IF VD3SR.gekond <> 0 THEN VD3SR.gekond = wert%
             IF VD4SR.gekond <> 0 THEN VD4SR.gekond = wert%
             IF VD5SR.gekond <> 0 THEN VD5SR.gekond = wert%
             IF SR.gekond <> 0 THEN SR.gekond = wert%
             anpass.gekond = 0
             CALL MATimeStamp("gekond")
             CALL QuickStore("gekond")
           END IF 
         END IF 
       END IF 
     END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codege.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
  
 
 
 
 
 
 
 
 REM  MENU 5,3,1,"alle Konditionen aller Mitarbeiters alle Produkte","ANPASSUNG5",""
SUB ANPASSUNG5()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"fÅr alle Mitabeiter fÅr alle Produkte:"
 ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Konditionen angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeGE.gekond
   SELECT FIRST LOCK FILE "GEKOND"
   WHILE NOT EOF ("gekond")
     ok% = 1
       IF bwbis.gekond > 0 THEN 
         SELECT KEY codege.gekond FILE "Geadr" INDEX codege.geadr
         ges$ = Gesellschaft.geadr
         SELECT KEY codeva.gekond FILE "sparten" INDEX codeva.sparten
         sparte$ = Sparte.sparten
         bwvon$ = DATE$ (bwvon.gekond,"0d.mm.yyyy")
         bwbis$ = DATE$ (bwbis.gekond,"0d.mm.yyyy")
         ap$ = STR$ (ap.gekond,"999.9999")
         co$ = STR$ (courtage.gekond,"999.9999")
         pf$ = STR$ (PflegeProvi.gekond,"999.9999")
         sr$ = STR$ (sr.gekond,"999.9999")
         dyn$ = STR$ (DynamikProz.gekond,"999.9999")
         betreu$ = STR$ (BetreuProz.gekond,"999.9999")
         gesamt$ = "Gesellschaft: " + ges$ + ", Sparte: " + sparte$ + ", BWvon: " + bwvon$ + " BWbis: " + bwbis$
         IF APjn.gekond = "j" THEN gesamt$ = gesamt$ + ", AP: " + ap$
         IF CourtageJN.gekond = "j" THEN gesamt$ = gesamt$ + ", Courtage: " + co$
         IF pflegejn.gekond = "j" THEN gesamt$ = gesamt$ + ", Pflege: " + pf$
         IF srjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Storno: " + sr$
         IF DynamikPjn.gekond = "j" THEN gesamt$ = gesamt$ + ", Dynamik: " + dyn$
         IF Betreujn.gekond = "j" THEN gesamt$ = gesamt$ + ", Betreuung: " + betreu$
         CALL Fehler("Sie versuchen eine Kondition anzupassen, die im Feld Bewertungszeitraum_bis:  einen Eintrag enthÑlt!",gesamt$)
         REQUEST "Wollen Sie diese Kondition wirklich anpassen?","",130,reqab%
         IF reqab% <> 1 THEN ok% = 0
       END IF 
 
       IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
         IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
         IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
         IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
         IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
         IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
         IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
         IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%
         REM 220697
         IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
         IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
         IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
         IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
         IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
         IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
         IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
         IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
         IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
         IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
         IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
         IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
         IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
         IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
         IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
         IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
         IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
       END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codege.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 
 REM  MENU 5,3,1,"alle nicht abgeschlossenen Konditionen aller Mitarbeiters alle Produkte","ANPASSUNG5",""
SUB ANPASSUNG5A1()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 cuma% = CodeMA.gekond
 cuko% = lfdnr.gekond
 codeva% = codeva.gekond
 codege% = codege.gekond
 CREATE DIALOG "ANPASSUNG",0,0,177,104,"Anpassung","MS Sans Serif",8
 ADD DIALOG "ANPASSUNG",5,6,6,166,20,0,"fÅr alle nicht abgeschlossenen Konditionen aller Mitabeiter fÅr alle Produkte:"
 ADD DIALOG "ANPASSUNG",5,6,30,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
 ADD DIALOG "ANPASSUNG",5,6,40,150,8,0,"Konditionen angepa·t werden soll."
 ADD DIALOG "ANPASSUNG",6,46,59,59,13,0,0,anp$,10
 ADD DIALOG "ANPASSUNG",5,6,59,38,11,0,"Anpassung:"
 ADD DIALOG "ANPASSUNG",1,34,80,50,16,1,"&OK",1,1
 ADD DIALOG "ANPASSUNG",1,86,80,50,16,0,"&Abbruch",0,0
 DIALOG "ANPASSUNG",req%
 REMOVE DIALOG "ANPASSUNG"
 anp% = VAL (anp$)
 anp$ = STR$ (anp%)
 IF req% = 1 AND anp% <> 0 THEN 
   FILE "gekond"
   INDEX CodeGE.gekond
   SELECT FIRST LOCK FILE "GEKOND"
   WHILE NOT EOF ("gekond")
     ok% = 1
       IF bwbis.gekond > 0 THEN 
         ok% = 0
       END IF 
 
       IF ok% = 1 THEN 
       
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999")
         IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
         IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
         IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
         IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
         IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
         IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
         IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
         IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%
         REM 220697
         IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
         IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
         IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
         IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
         IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
         IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
         IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
         IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
         IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
         IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
         IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
         IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
         IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
         IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
         IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
         IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
         IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         anpass.gekond = 0
       CALL MATimeStamp("gekond")
       CALL QuickStore("gekond")
       END IF 
 
     MOUSE OFF 
     SELECT NEXT LOCK FILE "gekond" INDEX Codege.gekond
   WEND 
 END IF 
 SELECT KEY cuko% FILE "gekond" INDEX lfdnr.gekond
 SET STATUS "Bereit"
 FORM 
 MOUSE ON 
 END SUB 
 
 


 '***********************************************************************************************
 ' Anpassung Konditionen
 ' es geht dabei darum die Konditionen eines bestimmten Produktes anzupassen
 '  - einmal - unter Abschlie·ung der vorhanden Produktkonditionen zu einem bestimmten Zeitpunkt
 '  - zum anderen - einfache énderung der vorhanden Produktkonditionen
 '***********************************************************************************************

SUB KoAnpassSpez()
 IF nachname.maadr LIKE "<ohne Zuordnung>" THEN 
   CALL Fehler ("FÅr die Agentur <ohne Zuordnung> kînnen keine Konditionen angepa·t werden!","")
   GOTO KoAn27010301
 END IF 
 t1$ = "Sie erhalten hier die Mîglichkeit, die Konditionen eines Produktes anzupassen. Dabei kînnen Sie entscheiden, ob die vorhanden Konditionen zu einem bestimmten Zeitpunkt abgeschlossen werden sollen und durch neue ersetzt werden sollen,"
 t2$ = "oder aber, ob die vorhanden Konditionen geÑndert werden sollen!"
 CALL Fehler(t1$,t2$)
 nsp% = GetVprodukt%(codege.gekond,codeva.gekond, - 1)
 SELECT FIRST FILE "vprodukt" INDEX codevp.vprodukt
 SELECT KEY nsp% FILE "vprodukt" INDEX codevp.vprodukt
 IF nsp% < 1 THEN GOTO KoAn27010301
 opt% = 2
anfkoan27010301: 
 CREATE DIALOG "UEBERNAHME",0,0,264,245,"Konditionsanpassung","MS Sans Serif",8
 ADD DIALOG "UEBERNAHME",4,0,0,257,221,0,""
 ADD DIALOG "UEBERNAHME",9,6,14,22,22,2
 ADD DIALOG "UEBERNAHME",5,36,14,157,10,0,"Bitte wÑhlen Sie aus, mit welcher Methode"
 ADD DIALOG "UEBERNAHME",5,37,24,202,39,0,"die Konditionen von: " + gesspa.vprodukt + " angepa·t werden sollen, es werden nur -NICHT-abgeschlossene Konditionen berÅcksichtigt"
 ADD DIALOG "UEBERNAHME",3,30,85,137,11,0,"Ñndern",1,opt%
 ADD DIALOG "UEBERNAHME",3,30,123,138,12,0,"an&hÑngen",2,opt%
 ADD DIALOG "UEBERNAHME",5,30,99,207,9,0,"Ñndert alle Konditionen des Produktes"
 REM ADD DIALOG "UEBERNAHME",5,30,108,194,10,0,"keine Daten in der Konditionsdatei vorhanden sind"
 ADD DIALOG "UEBERNAHME",5,30,137,195,10,0,"Åbernimmt alle Konditionen des Produktes, fÅr einen"
 ADD DIALOG "UEBERNAHME",5,29,147,181,24,0,"neuen Bewertungszeitraum und Abschlu· der alten Konditionen mit dem Berwertungszeitraum Datum bis:"
 ADD DIALOG "UEBERNAHME",6,210,152,40,12,0,0,bis1$,10
 ADD DIALOG "UEBERNAHME",5,29,180,144,10,0,"Bewertungszeitraum fÅr neue Konditionen:"
 ADD DIALOG "UEBERNAHME",6,48,194,41,12,0,0,von$,10
 ADD DIALOG "UEBERNAHME",6,114,194,41,12,0,0,bis$,10
 ADD DIALOG "UEBERNAHME",5,30,195,17,10,0,"&von:"
 ADD DIALOG "UEBERNAHME",5,96,195,17,10,0,"&bis:"
 ADD DIALOG "UEBERNAHME",1,68,225,54,15,1,"&OK",1,1
 ADD DIALOG "UEBERNAHME",1,125,225,56,15,0,"&Abbrechen",0,0
 DIALOG "UEBERNAHME",req%
 REMOVE DIALOG "UEBERNAHME"
 IF req% <> 1 THEN GOTO KoAn27010301
     ok% = - 1
     IF bis1$ <> "" THEN 
       IF NOT DateOK%(bis1$) THEN 
         CALL Fehler("Das Datum ist falsch:Abschlu· alte Konditionen zum",bis1$)
         GOTO anfkoan27010301
       END IF 
     END IF 
     IF von$ <> "" THEN 
       IF NOT DateOK%(von$) THEN 
         CALL Fehler("Das Datum ist falsch:Bewertungszeitraum fÅr neue Konditionen von",von$)
         GOTO anfkoan27010301
       END IF 
     END IF 
     IF bis$ <> "" THEN 
       IF NOT DateOK%(bis$) THEN 
         CALL Fehler("Das Datum ist falsch:Bewertungszeitraum fÅr neue Konditionen bis",bis$)
         GOTO anfkoan27010301
       END IF 
     END IF 
     REM ************************************ verschÑrfte Reorganisation ******************
     REM CALL Fehler("","")
     REQUEST "Mîchten Sie die Konditionsdatei vorher sichern lassen?","",130,req%
     IF req% = 1 THEN 
       CLOSE FILE "GEKOND"
       dpfad$ = _netpath$ + "PROVIS\" + DATE$ ( TODAY ,"yymm0d")
       datnr$ = DATE$ ( TODAY ,"yymm0d")
       i% = 0
       ok% = 0
       WHILE ok% = 0
         i% = i% + 1
         IF i% > 99 THEN 
           ON ERROR GOTO karv3004982
           REMOVE DIRECTORY dpfad$ + "01"
karv3004982: 
           i% = 1
         END IF 
         ON ERROR GOTO karv3004981
         tpfad$ = dpfad$ + STR$ (i%,"00")
         MAKE DIRECTORY dpfad$ + STR$ (i%,"00")
         dpfad$ = dpfad$ + STR$ (i%,"00")
         ok% = - 1
karv3004981: 
         ON ERROR GOTO ErrorHandler
       WEND 
       textdo1$ = "Sicherungskopie befindet sich im Pfad: " + tpfad$
       REM CALL Fehler("Es wird jetzt eine Sicherungskopie der Vertragsdatei erstellt!",textdo1$)
       REQUEST "Sicherungskopie wird erstellt in",tpfad$,2
       ON ERROR GOTO krbv00420011
       COPY _netpath$ + "PROVIS\GEKOND.*" TO dpfad$
       CALL DFile(3,"GEKOND" + _fpw$)
       REM CALL reorgkv1(_ppath$,"GEKOND","GEKOOLD","GKLEER",dpfad$)
       REM REQUEST "GEKOND wurde gesichert in",dpfad$,2
       CALL Fehler("GEKOND wurde gesichert in",dpfad$)
       GOTO krbv00420012
krbv00420011: 
       CALL Fehler ("Beim kopieren der Konditionsdatei ist ein Fehler aufgetreten!, deshalb wird der Komplettaufbau nicht durchgefÅhrt","")
krbv00420012: 
       ON ERROR GOTO ErrorHandler
     END IF 
     REM CALL Fehler("Reorg KV","")
     FILE "GEKOND"
     INDEX lfdnr.GEKOND
     SELECT LAST 
     lfdnr% = lfdnr.GEKOND
     WHILE SER ("GEKOND",1) <= lfdnr%
     WEND 
     REM ********************Ende verschÑrfte Reorganisation ************************************************************** 
 
     DIM ProKond%(1)
     DIM ProKondNeu%(1)
     IF RECCOUNT ("GEKOND") > 30000 THEN 
       REDIM ProKond%(30000)
     ELSE 
       REDIM ProKond%( RECCOUNT ("GEKOND"))
     END IF 
     FILE "gekond"
     INDEX codevp.gekond
     SELECT FIRST FILE "GEKOND" INDEX codevp.gekond
     SELECT KEY nsp% FILE "GEKOND" INDEX codevp.gekond
     i% = 0
     MOUSE OFF 
     WHILE NOT EOF ("GEKOND") AND codevp.gekond = nsp%
       IF codevp.gekond = nsp% AND bwbis.gekond < 1 THEN 
         ProKond%(i%) = lfdnr.gekond
         i% = i% + 1
         SET STATUS STR$ (i%,",9999999") + " Produktkonditionen gefunden"
       END IF 
       SELECT NEXT FILE "GEKOND" INDEX codevp.gekond
     WEND 
     IF i% = 0 THEN 
       CALL Fehler("Es wurden keine Konditionen gefunden!","")
       GOTO KoAn27010301
     END IF 
     REDIM ProKondNeu%(i%)
     FILE "gekond"
     INDEX lfdnr.gekond
     anz% = i%
     i% = 0
     ok% = 0
AnpWert27010303: 
       CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
       ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung der Kondition:"
       ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz die"
       ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Konditionen angepa·t werden soll."
       ADD DIALOG "ANPASSUNG",6,49,49,59,13,0,0,anp$,10
       ADD DIALOG "ANPASSUNG",5,6,49,40,11,0,"Anpassung%:"
       REM ADD DIALOG "ANPASSUNG",5,86,60,7,8,0,"%"
       ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
       ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
       DIALOG "ANPASSUNG",req2%
       REMOVE DIALOG "ANPASSUNG"
       anp% = VAL (anp$)
       anp$ = STR$ (anp%)
       noanpko% = 0
       IF anp% <> 0 THEN noanpko% = 1
       IF noanpko% = 0 THEN 
         REQUEST "Sie haben keinen Prozentsatz angegeben!","Soll nur die Stornoreserve angepa·t werden?",130,req131%
         IF req131% <> 1 THEN GOTO AnpWert27010303
       END IF 
       
         REQUEST "Mîchten Sie die Åbenommenen Stornoreserven anpassen?","Beachten Sie, da· der vorhandene Wert als 100% angesehen werden",130,req131%
         REM IF req131% <> 1 THEN GOTO AnpWert27010303
         IF req131% = 1 THEN 
AnpWert27010304: 
           CREATE DIALOG "ANPASSUNG",0,0,177,124,"Anpassung","MS Sans Serif",8
           ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Stornoreserven:"
           ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Prozentsatz"
           ADD DIALOG "ANPASSUNG",5,6,30,159,8,0,"bzw. auf welchen Wert die"
           ADD DIALOG "ANPASSUNG",5,6,40,150,8,0,"Stornoreserven angepa·t werden soll."
           ADD DIALOG "ANPASSUNG",6,48,59,59,13,0,0,anp1$,10
           ADD DIALOG "ANPASSUNG",5,6,59,40,11,0,"Anpassung%:"
           ADD DIALOG "ANPASSUNG",6,48,75,59,13,0,0,anpw1$,10
           ADD DIALOG "ANPASSUNG",5,6,75,38,11,0,"Wert:"
           ADD DIALOG "ANPASSUNG",1,34,100,50,16,1,"&OK",1,1
           ADD DIALOG "ANPASSUNG",1,86,100,50,16,0,"&Abbruch",0,0
           DIALOG "ANPASSUNG",req1%
           REMOVE DIALOG "ANPASSUNG"
           anp1% = VAL (anp1$)
           anp1$ = STR$ (anp1%)
           anpw1% = VAL (anpw1$)
           anpw1$ = STR$ (anpw1%,"99.9999")
           nosr% = 0
           IF anp1% <> 0 AND anpw1% <> 0 THEN 
             CALL Fehler("Sie haben sowohl den Prozentsatz ausgefÅllt,als auch den Wert ausgefÅllt,es ist aber nur gestattet eines von beiden auszufÅllen!","Bitte korrigieren!")
             GOTO AnpWert27010304
           END IF 
           IF anp1% <> 0 OR anpw1% <> 0 THEN nosr% = 1
           IF nosr% = 0 THEN 
             CALL Fehler("Sie haben keinen Prozentsatz eingegeben, das kann 2 Bedeutungen haben 1: Sie wollen die Stornoreserve auf NULL setzen oder ","Sie wollen die Stornoreserve nicht Ñndern!")
             REQUEST "Soll die Stornoreserve auf NULL gesetzt werden?","",130,req131%
             IF req131% = 1 THEN 
               nosr% = 1
               anpw1% = 0
               anp1% = 0
             ELSE 
               REQUEST "Die Stornoreserve soll NICHT auf NULL gesetzt werden!","Wollen Sie den Prozentsatz Ñndern?",130,req131%
               IF req131% = 1 THEN 
                 GOTO AnpWert27010304
               ELSE 
                 nosr% = 0
               END IF 
             END IF 
           END IF 
         END IF 
         FILE "gekond"
       

     '**********************************************************************************
     ' vorhandene Konditionen abschlie·en 
     IF opt% = 2 THEN 
       ' vorhandene Konditionen kopieren
       FOR i% = 0 TO anz% - 1
         SELECT FIRST FILE "GEKOND" INDEX lfdnr.gekond
         SELECT KEY ProKond%(i%) FILE "GEKOND" INDEX lfdnr.gekond
         BLANK DUPLICATE FILE "GEKOND"
         lfdnrneu% = SER ("GEKOND",1)
         lfdnr.gekond = lfdnrneu%
         ProKondNeu%(i%) = lfdnrneu%
         anpass.gekond = 1
         CALL MATimeStamp("gekond")
         CALL QuickStore("GEKOND")
       NEXT i%

       ' alte Konditionen abschlie·en
       FOR i% = 0 TO anz% - 1
         SELECT FIRST FILE "GEKOND" INDEX lfdnr.gekond
         SELECT KEY ProKond%(i%) LOCK FILE "GEKOND" INDEX lfdnr.gekond
         IF BWbis.gekond < 1 AND bis1$ <> "" THEN 
           BWbis.gekond = bis1$
           CALL MATimeStamp("gekond")
           CALL QuickStore("gekond")
         END IF 
       NEXT i%

       ' neue Konditionen anpassen
       FOR i% = 0 TO anz% - 1
         REM CALL Fehler("","")
         SELECT FIRST FILE "GEKOND" INDEX lfdnr.gekond
         SELECT KEY ProKondNeu%(i%) LOCK FILE "GEKOND" INDEX lfdnr.gekond
         IF von$ <> "" THEN 
           BWvon.gekond = von$
         END IF 
         IF bis$ <> "" THEN 
           BWBis.gekond = bis$
         END IF 
         ap$ = STR$ (ap.gekond,"9999.9999")
         co$ = STR$ (courtage.gekond,"9999.9999")
         pf$ = STR$ (PflegeProvi.gekond,"9999.9999")
         sr$ = STR$ (sr.gekond,"9999.9999")
         dyn$ = STR$ (DynamikProz.gekond,"999.9999")
         betreu$ = STR$ (BetreuProz.gekond,"999.9999")

         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999") + " Datensatz: " + STR$ (i%,"99999999")
         IF req2% = 1 AND noanpko% = 1 THEN 
           IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
           IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
           IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
           IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
           IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
           IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
           IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
           IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%
           REM 220697
           IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
           IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
           IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
           IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
           IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
           IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
           IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
           IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
           IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
           IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
           IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
           IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
           IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
           IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
           IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
           IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
           IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         END IF 
         IF req1% = 1 AND nosr% = 1 THEN 
           IF anp1% <> 0 THEN 
             IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp1%
             IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp1%
             IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp1%
             IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp1%
             IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp1%
             IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp1%
           ELSE 
             IF VD1SR.gekond <> 0 THEN VD1SR.gekond = anpw1%
             IF VD2SR.gekond <> 0 THEN VD2SR.gekond = anpw1%
             IF VD3SR.gekond <> 0 THEN VD3SR.gekond = anpw1%
             IF VD4SR.gekond <> 0 THEN VD4SR.gekond = anpw1%
             IF VD5SR.gekond <> 0 THEN VD5SR.gekond = anpw1%
             SR.gekond = anpw1%
           END IF 
         END IF 
         anpass.gekond = 0
         CALL MATimeStamp("gekond")
         CALL QuickStore("GEKOND")
       NEXT i%
 
     END IF 
     '**********************************************************************************


    
     ' vorhandene Konditionen Ñndern
     IF opt% = 1 THEN 
       FOR i% = 0 TO anz% - 1
         SELECT FIRST FILE "GEKOND" INDEX lfdnr.gekond
         SELECT KEY ProKond%(i%) LOCK FILE "GEKOND" INDEX lfdnr.gekond
         SET STATUS "WARTEN: Kondition wird angepa·t... " + STR$ (lfdnr.GEKOND,"99999999") + " Datensatz: " + STR$ (i%,"99999999")
         IF req2% = 1 THEN 
           IF VD1AP.gekond <> 0 THEN VD1AP.gekond = (VD1AP.gekond / 100) * anp%
           IF VD2AP.gekond <> 0 THEN VD2AP.gekond = (VD2AP.gekond / 100) * anp%
           IF VD3AP.gekond <> 0 THEN VD3AP.gekond = (VD3AP.gekond / 100) * anp%
           IF VD4AP.gekond <> 0 THEN VD4AP.gekond = (VD4AP.gekond / 100) * anp%
           IF VD5AP.gekond <> 0 THEN VD5AP.gekond = (VD5AP.gekond / 100) * anp%
           IF AP.gekond <> 0 THEN AP.gekond = (AP.gekond / 100) * anp%
           IF DynamikProz.gekond <> 0 AND anpass.gekond = 1 THEN DynamikProz.gekond = (DynamikProz.gekond / 100) * anp%
           IF BetreuProz.gekond <> 0 AND anpass.gekond = 1 THEN BetreuProz.gekond = (BetreuProz.gekond / 100) * anp%
           REM 220697
           IF DMEinheit.gekond <> 0 THEN DMEinheit.gekond = (DMEinheit.gekond / 100) * anp%
           IF Courtage.gekond <> 0 THEN Courtage.gekond = (Courtage.gekond / 100) * anp%
           IF TZ0.gekond <> 0 THEN TZ0.gekond = (TZ0.gekond / 100) * anp%
           IF TZ1.gekond <> 0 THEN TZ1.gekond = (TZ1.gekond / 100) * anp%
           IF TZ2.gekond <> 0 THEN TZ2.gekond = (TZ2.gekond / 100) * anp%
           IF TZ3.gekond <> 0 THEN TZ3.gekond = (TZ3.gekond / 100) * anp%
           IF TZ4.gekond <> 0 THEN TZ4.gekond = (TZ4.gekond / 100) * anp%
           IF TZ5.gekond <> 0 THEN TZ5.gekond = (TZ5.gekond / 100) * anp%
           IF TZ6.gekond <> 0 THEN TZ6.gekond = (TZ6.gekond / 100) * anp%
           IF TZ7.gekond <> 0 THEN TZ7.gekond = (TZ7.gekond / 100) * anp%
           IF TZ8.gekond <> 0 THEN TZ8.gekond = (TZ8.gekond / 100) * anp%
           IF TZ9.gekond <> 0 THEN TZ9.gekond = (TZ9.gekond / 100) * anp%
           IF TZ10.gekond <> 0 THEN TZ10.gekond = (TZ10.gekond / 100) * anp%
           IF TZ11.gekond <> 0 THEN TZ11.gekond = (TZ11.gekond / 100) * anp%
           IF TZ12.gekond <> 0 THEN TZ12.gekond = (TZ12.gekond / 100) * anp%
           IF PflegeProvi.gekond <> 0 THEN PflegeProvi.gekond = (PflegeProvi.gekond / 100) * anp%
           IF Pauschale.gekond <> 0 THEN Pauschale.gekond = (Pauschale.gekond / 100) * anp%
         END IF 
         IF req1% = 1 THEN 
           IF anp1% <> 0 THEN 
             IF VD1SR.gekond <> 0 THEN VD1SR.gekond = (VD1SR.gekond / 100) * anp1%
             IF VD2SR.gekond <> 0 THEN VD2SR.gekond = (VD2SR.gekond / 100) * anp1%
             IF VD3SR.gekond <> 0 THEN VD3SR.gekond = (VD3SR.gekond / 100) * anp1%
             IF VD4SR.gekond <> 0 THEN VD4SR.gekond = (VD4SR.gekond / 100) * anp1%
             IF VD5SR.gekond <> 0 THEN VD5SR.gekond = (VD5SR.gekond / 100) * anp1%
             IF SR.gekond <> 0 THEN SR.gekond = (SR.gekond / 100) * anp1%
           ELSE 
             IF VD1SR.gekond <> 0 THEN VD1SR.gekond = anpw1%
             IF VD2SR.gekond <> 0 THEN VD2SR.gekond = anpw1%
             IF VD3SR.gekond <> 0 THEN VD3SR.gekond = anpw1%
             IF VD4SR.gekond <> 0 THEN VD4SR.gekond = anpw1%
             IF VD5SR.gekond <> 0 THEN VD5SR.gekond = anpw1%
             SR.gekond = anpw1%
           END IF 
         END IF 
         anpass.gekond = 0
         CALL MATimeStamp("gekond")
         CALL QuickStore("GEKOND")
       NEXT i%
     END IF 
   CALL Fehler("KonditionsÑnderung beendet!","")
KoAn27010301: 
 END SUB 




 
 
 REM ********************************************************************************************************************
 REM                  Statistikmodule zur Aktualisierung der Eckzahlen
 REM  z% = 0 - ausfÅhren ohne nachzufragen
 REM  z% = 1 - ausfÅhren mit Abfrage
 REM ********************************************************************************************************************
SUB StatistMen()
  CALL StatistRefr(1)
 END SUB 
 
 
SUB StatistRefr(z%)
   CALL DFile(3,"KVERTRAG" + _fpw$)
   CALL DFile(3,"MAADR" + _fpw$)
   CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
   CALL DFile(3,"SPARTEN" + _fpw$)
   CALL DFile(3,"VORGANG" + _fpw$)
   CALL DFile(3,"VPRODUKT" + _fpw$)
   CALL DFile(3,"STAMM" + _fpw$)
   CALL DFile(2,"FILIALE" + _fpw$)
   CALL DFile(2,"OFFICE\ADRESSEN" + _fpw$)
   CALL DFile(3,"AGDIR" + _fpw$)
   CALL DFile(3,"maadrgru" + _fpw$)
   Canc% = 0
   IF z% = 1 THEN 
     REQUEST "Mîchten Sie die Statistikberechnungen jetzt ausfÅhren lassen?","Sie mÅssen alleine eingeloggt sein!",135,req%
   ELSE 
     req% = 1
   END IF 
   IF req% <> 1 THEN 
     GOTO endstat151020021
   END IF 
anfst0912200201: 
   file1$ = "STAMM"
   SELECT FIRST LOCK FILE file1$
   i% = 0
   j% = RECCOUNT (file1$)
   
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
   

   file1$ = "FILIALE"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 


   file1$ = "MAADRGRU"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 


   file1$ = "AGDIR"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 

   file1$ = "ADRESSEN"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,",99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,",99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 



   file1$ = "MAADR"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 
 
   file1$ = "GEADR"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 
 
   file1$ = "SPARTEN"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 
 
   file1$ = "VPRODUKT"
   IF RECCOUNT (file1$) THEN 
     SELECT FIRST LOCK FILE file1$
   ELSE 
     SELECT LAST FILE file1$
   END IF 
   i% = 0
   j% = RECCOUNT (file1$)
   WHILE NOT EOF (file1$)
     i% = i% + 1
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze in Datei " + file1$ + " zurÅckgesetzt, von " + LTRIM$ ( STR$ (j%,"99999999"))
     VertrGesamt.file1$ = 0
     VertrStatu20.file1$ = 0
     BWVertrStatu20.file1$ = 0
     BeiVertrStatu20.file1$ = 0
     EinhStatu20.file1$ = 0
     AnzSchStatu20.file1$ = 0
     SchStatu20.file1$ = 0
     VertrStatu21.file1$ = 0
     BWVertrStatu21.file1$ = 0
     BeiVertrStatu21.file1$ = 0
     EinhStatu21.file1$ = 0
     AnzSchStatu21.file1$ = 0
     SchStatu21.file1$ = 0
     f$ = "VertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "VertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BWVertrGesamt.file1$ = 0
     f$ = "BWVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BWVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     BeiVertrGesamt.file1$ = 0
     f$ = "BeiVertrStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "BeiVertrStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     EinhGesamt.file1$ = 0
     f$ = "EinhStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "EinhStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     AnzSchGesamt.file1$ = 0
     f$ = "AnzSchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "AnzSchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
 
     SchGesamt.file1$ = 0
     f$ = "SchStatu"
     x% = 1
     FOR x% = 1 TO 16
       f$ = "SchStatu"
       f$ = f$ + LTRIM$ ( STR$ (x%,"99")) + "." + file1$
       f$$ = 0
     NEXT x%
     STATISTDATE.file1$ = 0
     Schadquote.file1$ = 0
     Stornoquote.file1$ = 0
     CAgez.file1$ = 0
     STORE FILE file1$
     SELECT NEXT LOCK FILE file1$
   WEND 
 
   IF ServerReply$() = "CANCEL" AND Canc% = - 1 THEN 
     CALL Gauge(0,"")
     CALL Fehler("Es wurden in den Dateien Gesellschaften, Sparten, Vermittler und Produkte die Werte auf NULL gesetzt, da Sie den Lauf abgebrochen haben!","")
     GOTO endstat151020021
   END IF 
   FILE "kvertrag"
   INDEX lfdnr.kvertrag
   SELECT FIRST LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
   okcanc% = - 1
   IF RECCOUNT ("KVERTRAG") > 20000 THEN okcanc% = 0
 
   i% = 0
   j% = RECCOUNT (file1$)
 
   wi% = 0
   IF okcanc% = - 1 THEN CALL Server("LISTBOXINIT","Statistik hochrechnen")
   IF okcanc% = - 1 THEN CALL Gauge(1,"VertrÑge hochrechen...")
   IF okcanc% = - 1 THEN CALL Server("GAUGEENABLECANCEL","")
   _prozt% = 0
   _proz2% = 0
   _anz% = RECCOUNT ("kvertrag")
   SumBeitr% = 0
   GesSumBeit% = 0
   IF okcanc% = - 1 THEN WHILE NOT EOF ("KVERTRAG") AND ServerReply$() <> "CANCEL"
   IF okcanc% = 0 THEN WHILE NOT EOF ("KVERTRAG")
     i% = i% + 1
     j% = RECCOUNT ("KVERTRAG")
     IF okcanc% = - 1 THEN 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     END IF 
 
     file1$ = "Stamm"
     REM j% = RECCOUNT (file1$)
     SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze ausgewertet, von " + LTRIM$ ( STR$ (j%,"99999999"))
     SELECT FIRST LOCK FILE file1$
     SumBeitr% = 0
     ltStatzaehl% = 0
     x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
     CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)



     IF codeku.kvertrag > 0 THEN 
       file1$ = "ADRESSEN"
       REM j% = RECCOUNT (file1$)
       SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze ausgewertet, von " + LTRIM$ ( STR$ (j%,"99999999"))
       SELECT FIRST FILE file1$ INDEX codeku.file1$
       SELECT KEY codeku.kvertrag LOCK FILE file1$ INDEX codeku.file1$
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)
     END IF 

     IF codema.kvertrag > 0 THEN 
       file1$ = "Maadr"
       REM j% = RECCOUNT (file1$)
       SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze ausgewertet, von " + LTRIM$ ( STR$ (j%,"99999999"))
       SELECT FIRST FILE file1$ INDEX codema.file1$
       SELECT KEY codema.kvertrag LOCK FILE file1$ INDEX codema.file1$
       IF RECCOUNT ("MAADRGRU") > 0 THEN 
         SELECT FIRST FILE "MAADRGRU" INDEX codemagr.maadrgru
         SELECT KEY codemagr.maadr LOCK FILE "MAADRGRU" INDEX codemagr.maadrgru
       ELSE 
         BLANK FILE "MAADRGRU"
         MAGruppe.maadrgru = "Alle"
         CodeMAGR.maadrgru = SER ("maadrgru",1)
         STORE FILE "maadrgru"
         SELECT FIRST FILE "MAADRGRU" INDEX codemagr.maadrgru
         SELECT KEY codemagr.maadr LOCK FILE "MAADRGRU" INDEX codemagr.maadrgru
       END IF 
       SELECT FIRST FILE "AGDIR" INDEX codeagdir.agdir
       SELECT KEY codeagdir.maadr LOCK FILE "AGDIR" INDEX codeagdir.agdir
       SELECT FIRST FILE "FILIALE" INDEX Filialnr.FILIALE
       w% = Workstation.maadr
       IF Workstation.maadr < 1 THEN w% = 0
       SELECT KEY w% LOCK FILE "FILIALE" INDEX Filialnr.FILIALE
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)

       file1$ = "Maadrgru"
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)

       file1$ = "AGDIR"
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)

       file1$ = "Filiale"
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)

     END IF 
     IF codege.kvertrag > 0 THEN 
       file1$ = "Geadr"
       REM j% = RECCOUNT (file1$)
       SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze ausgewertet, von " + LTRIM$ ( STR$ (j%,"99999999"))
       SELECT FIRST FILE file1$ INDEX codege.file1$
       SELECT KEY codege.kvertrag LOCK FILE file1$ INDEX codege.file1$
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)
     END IF 
     IF codeva.kvertrag > 0 THEN 
       file1$ = "Sparten"
       REM j% = RECCOUNT (file1$)
       SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze ausgewertet, von " + LTRIM$ ( STR$ (j%,"99999999"))
       SELECT FIRST FILE file1$ INDEX codeva.file1$
       SELECT KEY codeva.kvertrag LOCK FILE file1$ INDEX codeva.file1$
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)
     END IF 
     IF codevp.kvertrag > 0 THEN 
       file1$ = "Vprodukt"
       REM j% = RECCOUNT (file1$)
       SET STATUS LTRIM$ ( STR$ (i%,"99999999")) + " DatensÑtze ausgewertet, von " + LTRIM$ ( STR$ (j%,"99999999"))
       SELECT FIRST FILE file1$ INDEX codevp.file1$
       SELECT KEY codevp.kvertrag LOCK FILE file1$ INDEX codevp.file1$
       CALL ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)
     END IF 
     IF EXISTS (lfdnr.kvertrag,codevt.vorgang) THEN 
       codevt% = lfdnr.kvertrag
       IF vs_NR.kvertrag LIKE "12345" THEN 
         REM CALL Fehler("12345","")
       END IF 
       SELECT FIRST FILE "Vorgang" INDEX codevt.vorgang
       SELECT KEY codevt% FILE "Vorgang" INDEX codevt.vorgang
       SELECT FIRST LOCK FILE "stamm"
       file1$ = "Stamm"
       AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
       x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
       f$ = "AnzSchStatu" + x$ + "." + file1$
       f$$ = f$$ + 1
       IF ltStatzaehl% THEN 
         SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
       END IF 
       f$ = "SchStatu" + x$ + "." + file1$
       f$$ = f$$ + gezahlt.vorgang
       STATISTDATE.file1$ = TODAY 
       STORE FILE file1$
       gezahlt% = 0
       FILE "Vorgang"
       WHILE NOT EOF ("Vorgang") AND codevt.vorgang = codevt%
          IF SchadenJN.vorgang LIKE "j" AND gezahlt.vorgang > 0 AND SumBeitr% > 0 THEN 
            gezahlt% = gezahlt% + gezahlt.vorgang
            IF codema.kvertrag > 0 THEN 
              file1$ = "Maadr"
              SELECT FIRST FILE file1$ INDEX codema.file1$
              SELECT KEY codema.kvertrag LOCK FILE file1$ INDEX codema.file1$
              SELECT FIRST FILE "MAADRGRU" INDEX codemagr.maadrgru
              SELECT KEY codemagr.maadr LOCK FILE "MAADRGRU" INDEX codemagr.maadrgru
              SELECT FIRST FILE "AGDIR" INDEX codeagdir.agdir
              SELECT KEY codeagdir.maadr LOCK FILE "AGDIR" INDEX codeagdir.agdir
              SELECT FIRST LOCK FILE "FILIALE" INDEX Filialnr.FILIALE
              w% = Workstation.maadr
              IF Workstation.maadr > 0 THEN 
                SELECT KEY w% LOCK FILE "FILIALE" INDEX Filialnr.FILIALE
              END IF 
              SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
              SELECT KEY codeku.kvertrag LOCK FILE "adressen" INDEX codeku.adressen
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              S% = gezahlt% * 100 / CAgez.file1$
              STORE FILE file1$
 
              file1$ = "MAADRGRU"
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              S% = gezahlt% * 100 / CAgez.file1$
              STORE FILE file1$

              file1$ = "AGDIR"
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              S% = gezahlt% * 100 / CAgez.file1$
              STORE FILE file1$

              file1$ = "FILIALE"
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              S% = gezahlt% * 100 / CAgez.file1$

              STORE FILE file1$

              file1$ = "ADRESSEN"
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              S% = gezahlt% * 100 / CAgez.file1$
              STORE FILE file1$
            END IF 
            IF codege.kvertrag > 0 THEN 
              file1$ = "geadr"
              SELECT FIRST FILE file1$ INDEX codege.file1$
              SELECT KEY codege.kvertrag LOCK FILE file1$ INDEX codege.file1$
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              STORE FILE file1$
              S% = gezahlt% * 100 / CAgez.file1$
              S% = Schadquote.file1$
            END IF 
            IF codeva.kvertrag > 0 THEN 
              file1$ = "sparten"
              SELECT FIRST FILE file1$ INDEX codeva.file1$
              SELECT KEY codeva.kvertrag LOCK FILE file1$ INDEX codeva.file1$
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              STORE FILE file1$
              S% = gezahlt% * 100 / CAgez.file1$
            END IF 
            IF codevp.kvertrag > 0 THEN 
              file1$ = "vprodukt"
              SELECT FIRST FILE file1$ INDEX codevp.file1$
              SELECT KEY codevp.kvertrag LOCK FILE file1$ INDEX codevp.file1$
              IF ltStatzaehl% THEN AnzSchGesamt.file1$ = AnzSchGesamt.file1$ + 1
              x$ = LTRIM$ ( STR$ (codevstatus.kvertrag,"99"))
              f$ = "AnzSchStatu" + x$ + "." + file1$
              f$$ = f$$ + 1
              IF ltStatzaehl% THEN SchGesamt.file1$ = SchGesamt.file1$ + gezahlt.vorgang
              f$ = "SchStatu" + x$ + "." + file1$
              f$$ = f$$ + gezahlt.vorgang
              STATISTDATE.file1$ = TODAY 
              CAgez% = CAgez.file1$
              IF ltStatzaehl% THEN Schadquote.file1$ = gezahlt% * 100 / CAgez.file1$
              STORE FILE file1$
              s% = Schadquote.file1$
            END IF 
          END IF 
          SELECT NEXT FILE "Vorgang" INDEX codevt.vorgang
       WEND 
     END IF 
     codevp% = codevp.kvertrag
     codevp1% = codevp.vprodukt
     wi% = wi% + 1
     daten1$ = LTRIM$ (VS_NR.kvertrag) + LTRIM$ (Gesellschaft.kvertrag) + "/" + LTRIM$ (sparte.kvertrag)
     CALL Server("GaugeMessage","VertrÑge auswerten...  bis jetzt ausgewertet " + TRIM$ ( STR$ (wi%,",9999999")) + " von " + TRIM$ ( STR$ (_anz%,",9999999")))
     CALL Server("LISTBOXADD",daten1$)
     FILE "KVERTRAG"
     IF ltStatzaehl% THEN Schadquote.KVERTRAG = gezahlt% * 100 / SumBeitr%
     STORE FILE "KVERTRAG"
     S% = gezahlt% * 100 / CAgez.file1$
     SELECT NEXT LOCK FILE "KVERTRAG"
   WEND 
   IF ServerReply$() = "CANCEL" AND canc% = 0 THEN 
     Canc% = - 1
     REM CALL Fehler("Das Hochrechnen der Statistik wurde durch Sie abgebrochen,","Es werden jetzt noch in den betroffenen Dateien die Werte rÅckgesetzt!")
     REQUEST "Das Hochrechnen der Statistik wurde durch Sie abgebrochen,","Es werden jetzt noch in den betroffenen Dateien die Werte rÅckgesetzt!",2
     GOTO anfst0912200201
   ELSE 
     CALL Fehler("Berechnung fÅr Statistik wurde beendet!","")
   END IF 
   CALL Gauge(0,"")
endstat151020021: 
 
 END SUB 
 



SUB ZWBerStati1(file1$,SumBeitr%,ltStatzaehl%,x$)
 
     IF vs_nr.kvertrag LIKE "unf1" THEN 
       REM CALL Fehler (VS_Nr.kvertrag,file1$)
     END IF 
     f$ = "VertrStatu" + x$ + "." + file1$
     f$$ = f$$ + 1
     
     f$ = "BWVertrStatu" + x$ + "." + file1$
     a% = f$$
     b% = Bewertungssumme.kvertrag
     a% = a% + b%
     f$$ = f$$ + Bewertungssumme.kvertrag
     f$ = "BeiVertrStatu" + x$ + "." + file1$
     REM 18092003
     IF CodeVStatus.kvertrag = 01 OR CodeVStatus.kvertrag = 02 THEN ltStatzaehl% = - 1
     IF CodeVStatus.kvertrag = 03 OR CodeVStatus.kvertrag = 05 THEN ltStatzaehl% = - 1
     IF CodeVStatus.kvertrag = 06 OR CodeVStatus.kvertrag = 07 THEN ltStatzaehl% = - 1
     IF CodeVStatus.kvertrag = 08 OR CodeVStatus.kvertrag = 14 THEN ltStatzaehl% = - 1
     IF CodeVStatus.kvertrag = 13 OR CodeVStatus.kvertrag = 12 THEN ltStatzaehl% = - 1
     IF CodeVStatus.kvertrag = 20 OR CodeVStatus.kvertrag = 21 THEN ltStatzaehl% = - 1
     IF ltStatzaehl% THEN 
       IF CodeVStatus.kvertrag <> 13 THEN VertrGesamt.file1$ = VertrGesamt.file1$ + 1
       IF CodeVStatus.kvertrag <> 13 THEN BWVertrGesamt.file1$ = BWVertrGesamt.file1$ + Bewertungssumme.kvertrag
       IF CodeVStatus.kvertrag <> 13 THEN EinhGesamt.file1$ = EinhGesamt.file1$ + Einheiten.kvertrag
       bis% = TODAY 
       IF CodeVStatus.kvertrag = 13 THEN 
         bis% = KÅndigung.kvertrag
         IF bis% < 1 THEN 
           bis% = TatsKuenDat.kvertrag
           IF bis% < 1 THEN 
             IF VS_Dauer.kvertrag > 0 THEN 
               bis% = vs_beginn.kvertrag + (VS_Dauer.kvertrag * 12 * 30)
               IF bis% > TODAY THEN bis% = TODAY 
             ELSE 
               bis% = TODAY 
             END IF 
           END IF 
         END IF 
       ELSE 
         bis% = KÅndigung.kvertrag
         IF bis% > TODAY THEN bis% = TODAY 
         IF bis% < 1 THEN 
           bis% = TatsKuenDat.kvertrag
           IF bis% < 1 THEN 
             IF VS_Dauer.kvertrag > 0 THEN 
               bis% = vs_beginn.kvertrag + (VS_Dauer.kvertrag * 12 * 30)
               IF bis% > TODAY THEN bis% = TODAY 
             ELSE 
               bis% = TODAY 
             END IF 
           END IF 
         END IF 
       END IF 
       IF zw.kvertrag = 0 THEN 
         f$$ = f$$ + Beitrag.kvertrag / umrechnung.kvertrag
         IF CodeVStatus.kvertrag <> 13 THEN BeiVertrGesamt.file1$ = BeiVertrGesamt.file1$ + (Beitrag.kvertrag / umrechnung.kvertrag)
         SumBeitr% = NettoBeitrag.kvertrag / umrechnung.kvertrag
         IF NettoBeitrag.kvertrag = 0 THEN SumBeitr% = Beitrag.kvertrag / umrechnung.kvertrag
       ELSE 
         f$$ = f$$ + Beitrag.kvertrag / umrechnung.kvertrag * zw.kvertrag
         IF CodeVStatus.kvertrag <> 13 THEN BeiVertrGesamt.file1$ = BeiVertrGesamt.file1$ + (Beitrag.kvertrag / umrechnung.kvertrag * zw.kvertrag)
         REM rauskriegen wieviel Beitrag gezahlt wurde
         qmonat% = MONTH (vs_beginn.kvertrag)
         qjahr% = YEAR (vs_beginn.kvertrag)
         zmonat% = MONTH (bis%)
         zjahr% = YEAR (bis%)
         IF zjahr% > qjahr% THEN 
           anzmonate% = (bis% - vs_Beginn.kvertrag) / 30
         ELSE 
           IF zmonat% > qmonat% THEN 
             IF CodeVStatus.kvertrag = 13 THEN 
               anzmonate% = zmonat% - qmonat% + 1
             ELSE 
               anzmonate% = zmonat% - qmonat%
             END IF 
           ELSE 
             IF zmonat% = qmonat% THEN 
               anzmonate% = 1
             ELSE 
               anzmonate% = 0
             END IF 
           END IF 
         END IF 
         azw% = zw.kvertrag
         SELECT CASE azw%
         CASE 1
           anzbeitrÑge% = anzmonate% / 12
           rest% = 0
           IF anzbeitrÑge% > 1 THEN 
             rest% = anzmonate% MOD 12
           ELSE 
             anzbeitrÑge% = 1
           END IF 
           IF rest% > 0 THEN 
             anzbeitrÑge% = anzbeitrÑge% + 1
             anzbeitrÑge$ = STR$ (anzbeitrÑge%,"999999")
             anzbeitrÑge% = VAL (anzbeitrÑge$)
           END IF 
         CASE 2
           anzbeitrÑge% = anzmonate% / 6
           rest% = 0
           IF anzbeitrÑge% > 1 THEN 
             rest% = anzmonate% MOD 12
           ELSE 
             anzbeitrÑge% = 1
           END IF 
           IF rest% > 0 THEN 
             anzbeitrÑge% = anzbeitrÑge% + 1 - 0.5
             anzbeitrÑge$ = STR$ (anzbeitrÑge%,"999999")
             anzbeitrÑge% = VAL (anzbeitrÑge$)
           END IF 
         CASE 4
           anzbeitrÑge% = anzmonate% / 3
           rest% = 0
           IF anzbeitrÑge% > 1 THEN 
             rest% = anzmonate% MOD 12
           ELSE 
             anzbeitrÑge% = 1
           END IF 
           IF rest% > 0 THEN 
             anzbeitrÑge% = anzbeitrÑge% + 1 - 0.5
             anzbeitrÑge$ = STR$ (anzbeitrÑge%,"999999")
             anzbeitrÑge% = VAL (anzbeitrÑge$)
           END IF 
         CASE 6
           anzbeitrÑge% = anzmonate% / 2
           rest% = 0
           IF anzbeitrÑge% > 1 THEN 
             rest% = anzmonate% MOD 12
           ELSE 
             anzbeitrÑge% = 1
           END IF 
           IF rest% > 0 THEN 
             anzbeitrÑge% = anzbeitrÑge% + 1 - 0.5
             anzbeitrÑge$ = STR$ (anzbeitrÑge%,"999999")
             anzbeitrÑge% = VAL (anzbeitrÑge$)
           END IF 
         CASE 12
           anzbeitrÑge% = anzmonate%
           rest% = 0
           IF anzbeitrÑge% > 1 THEN 
             rest% = anzmonate% MOD 12
           ELSE 
             anzbeitrÑge% = 1
           END IF 
           IF rest% > 0 THEN 
             anzbeitrÑge% = anzbeitrÑge% + 1 - 0.5
             anzbeitrÑge$ = STR$ (anzbeitrÑge%,"999999")
             anzbeitrÑge% = VAL (anzbeitrÑge$)
           END IF 
         END SELECT 
         REM anzbeitrÑge% = anzmonate% / zw.kvertrag
         IF anzbeitrÑge% < 1 THEN anzbeitrÑge% = 1
         SumBeitr% = anzbeitrÑge% * NettoBeitrag.kvertrag / umrechnung.kvertrag
         IF NettoBeitrag.kvertrag = 0 THEN SumBeitr% = anzbeitrÑge% * Beitrag.kvertrag / umrechnung.kvertrag
       END IF 
     END IF 
     f$ = "EinhStatu" + x$ + "." + file1$
     f$$ = f$$ + Einheiten.kvertrag
     STATISTDATE.file1$ = TODAY 
     storno% = BWVertrStatu4.file1$
     lebend% = BWVertrGesamt.file1$ + storno%
     Stornoquote.file1$ = storno% * 100 / lebend%
     CAgez.file1$ = CAgez.file1$ + SumBeitr%
     STORE FILE file1$
 END SUB 











 
 
 REM ********************************************************************************************************************
 REM                  Statistikmodule zur Aktualisierung der Eckzahlen
 REM  z% = 0 - ausfÅhren ohne nachzufragen
 REM  z% = 1 - ausfÅhren mit Abfrage
 REM ********************************************************************************************************************
SUB StatistMen()
  CALL StatistRefr(1)
 END SUB 
 
 
 



SUB GEADR2()
 REM IF disabled%("GEADR") THEN END SUB 
 voncodege% = codege.geadr
 FILE "GEADR2"
 _formend% = 0
 maske$ = "GEADR2"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - Filialadressen der Gesellschaft"
     IF EXISTS (GPrjForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GPrjForm$ + maske$
     ELSE 
       OPEN FORM GPrjForm$ + maske$
     END IF 
     SELECT FORM KEY voncodege% FILE "GEADR" INDEX codege.geadr

     namfiladr1$ = Gesellschaft.geadr
     FORM 2
     REM OPEN FORM "GEADR"
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\gesell.pdf"
     CALL GEADR2Intro()
     CALL MNGEADR2()
     SET STATUS "Gesellschaften"
   END IF 
   MENU ON 
   MOUSE ON 
   GEADRsub% = 0
   CALL ClearKBDBuffer()
   SET STATUS "Anzahl Gesellschaften: " + STR$ ( RECCOUNT ("geadr"),",99999")
   FORM 
   f.abbruch.visible = 0
   f.abbruch.enabled = 0
   f.suchen.enabled = - 1
   f.suchen.visible = - 1
   FILE "geadr2"
   IF ag$ = "j" THEN 
     f.neu.enabled = 0
     f.neu.visible = 0
     f.bearb.enabled = 0
     f.bearb.visible = 0
     f.sichern.enabled = 0
     f.sichern.visible = 0
   END IF 
   CALL GEADR2Update()
   IF GEADRsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE FOR 600
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE GEADRsub%
   CASE 1
   CASE 2
   CASE 3
   CASE 4
   CASE 5
     REM Maklerinkasso, also welche BetrÑge an die Gesellschaft abzufÅhren sind
   CASE 6
   CASE 7
   CASE 8
   CASE 10
     CALL WechFilForm()
   CASE 11
     IF disabled%("GEADRFILIALEDEL") OR ag$ = "j" THEN 
     ELSE 
       codege2% = Codege2.geadr2
       SELECT KEY codege2% LOCK FILE "GEADR2" INDEX codege2.geadr2
       SELECT REMOVE FILE "GEADR2"
       CALL WechFilForm()
     END IF 
   CASE 99
     REM 110197
     IF disabled%("GEADRFILIALEEDIT") OR ag$ = "j" THEN 
     ELSE 
       MOUSE ON 
       MENU OFF 
       IF RECCOUNT ("GEADR2") = 0 THEN CALL GEADR2Neu()
       IF PAGE = 1 THEN 
         REM 101296
         _gesold$ = Gesellschaft.GEADR2
         _gesold1$ = Gesellschaft2.geadr2
         _gesstra·e$ = Stra·e.geadr2
         _Gesplz$ = PLZ.Geadr2
         _Gesort$ = ort.geadr2
         CALL ButDesabled()
         f.notiz.enabled = 0
         f.loe.enabled = 0
         f.loe.visible = 0
         ENTER gesellschaft.GEADR2,0
         CALL ButEnabled()
         f.notiz.enabled = - 1
         f.loe.enabled = - 1
         f.loe.visible = - 1
       ELSE 
         IF PAGE = 3 THEN 
           _gesold$ = Gesellschaft.GEADR2
           _gesold1$ = Gesellschaft2.geadr2
           _gesstra·e$ = Stra·e.geadr2
           _Gesplz$ = PLZ.Geadr2
           _Gesort$ = ort.geadr2
           ENTER postanschrift.GEADR2,0
         END IF 
       END IF 
     END IF 
     IF ag$ LIKE "j" THEN CALL Fehler("Diese Funktion steht unter der Agenturversion nicht zur VerfÅgung","")
   CASE 100
     REM GesellschaftsÅbersicht
     codege2% = codege2.geadr2
     codege% = vonCodege.geadr2
     SELECT FIRST FILE "geadr" INDEX codege.geadr
     SELECT KEY codege% FILE "geadr" INDEX codege.geadr
     CALL LFGEADR(codege%)
     SELECT FIRST FILE "geadr2" INDEX codege2.geadr2
     SELECT KEY codege2% FILE "geadr2" INDEX codege2.geadr2
   END SELECT 
   IF abbruch% = - 1 THEN 
     SELECT KEY codege2.GEADR2 FILE "GEADR2" INDEX codege2.GEADR2
     FORM 
     abbruch% = 0
   END IF 
   CALL BMCheckMail()
   MENU ON 
 WEND 
 _formend% = 0
 END SUB 
 
 
 ' GEADR2 Intro
 ' =======================================================================
 
SUB GEADR2Intro()
 FILE "GEADR2"
 INDEX voncodege.GEADR2
 SELECT KEY cuge% FILE "GEADR2" INDEX vonCodeGE.GEADR2
 SELECT KEY cuge% FILE "GEADR" INDEX codege.geadr
 namfiladr1$ = Gesellschaft.geadr
 FORM 
 END SUB 
 
SUB GEADR2Update()
 namfiladr1$ = Gesellschaft.geadr
 FORM 
 END SUB 
 
 
SUB MNGEADR2()
 MENU CLEAR 
 CALL MNProgramm()
 IF PAGE = 1 THEN 
   MENU 2,0,1,"&Daten","",""
   MENU 2,1,1,"&Kopieren in Zwischenablage,F11","ADRGes2KopWin","Adresse in Zwischenablage kopieren"
   CALL MNHilfe(3)
 ELSE 
   CALL MNHilfe(2)
 END IF 
 END SUB 
 
SUB GEADR2Neu()
 REM 110197
 IF disabled%("GEADRFILIALENew") THEN END SUB 
 FILE "geadr2"
 IF gesellschaft.geadr2 <> "" THEN CALL FStore("GEADR2")
 BLANK FILE "geadr2"
 SET STATUS "Datensatz neu angelegt..."
 CodeGE% = SER ("geadr2",1)
 CodeGE2.geadr2 = CodeGE%
 vonCodeGE.geadr2 = cuge%
 gesellschaft.geadr2 = "NEU"
 zero.geadr2 = 0
 Gesellschaft2.geadr2 = Gesellschaft.geadr
 CALL QuickStore("geadr2")
 SELECT FORM KEY codege% FILE "geadr2" INDEX CodeGE2.geadr2
 FORM 
 GEADRsub% = 99
 MOUSE ON 
 END SUB 
 
 
 ' GEADR Suchen
 ' =======================================================================
 
SUB GEADR2Suchen()
 cuge2% = codege2.geadr2
 FILE "Geadr2"
 IF ( MOD ("geadr2") OR NEW ("geadr2")) AND gesellschaft.geadr2 <> "" THEN CALL FStore("GEADR2")
 rep% = GetCodeGE2%(cuge2%)
 IF rep% <> 0 THEN cuge2% = rep%
 REM SELECT KEY cuge2% INDEX codege2.geadr2
 REM SET INDEX Gesellschaft.geadr2
 REM INDEX gesellschaft.geadr2
 MOUSE ON 
 FORM 
 END SUB 
  
 
SUB GEADR2Sichern()
 CALL FStore("GEADR2")
 ENTER END 
 END SUB 


SUB Geadr2Next(voncodege%)
 MOUSE OFF 
 cfile$ = FILE 
 SET STATUS "NÑchster Datensatz wird gesucht..."
 SELECT FORM NEXT 
 IF EOF (cfile$) OR voncodege.geadr2 <> voncodege% THEN REQUEST "Letzter Datensatz","",2
 IF MNdisabled%("DATALOCK") THEN 
   REM -- öberspringen gesperrter DatensÑtze --
   WHILE Sperre.cfile$ <> 0 AND Sperre.cfile$ <> vcodema% AND NOT EOF (cfile$)
     MOUSE OFF 
     SELECT FORM NEXT 
     IF EOF (cfile$) THEN 
       IF UCASE$ (cfile$) <> GAkquiDat$ THEN REQUEST "Letzter Datensatz","",2
     END IF 
   WEND 
 ELSE 
   IF cfile$ LIKE "ADRESSEN" OR cfile$ LIKE "SUPERVIS" OR cfile$ LIKE "KVERTRAG" OR cfile$ LIKE "MAADR" THEN 
     IF GMASuperCount% > 0 THEN 
       WHILE IsMASuper%(codema.cfile$) <> - 1 AND NOT EOF (cfile$)
         MOUSE OFF 
         SELECT FORM NEXT 
         IF EOF (cfile$) THEN 
           IF UCASE$ (cfile$) <> GAkquiDat$ THEN REQUEST "Letzter Datensatz","",2
         END IF 
       WEND 
     END IF 
   END IF 
 END IF 
 
 SET STATUS "Bereit"
 MOUSE ON 
 FORM 
 END SUB 
 
SUB Geadr2Prev(voncodege%)
 MOUSE OFF 
 cfile$ = FILE 
 ON ERROR GOTO ErrorHandler
 SET STATUS "Vorheriger Datensatz wird gesucht..."
 SELECT FORM PREVIOUS 
 IF EOF (cfile$) OR voncodege.geadr2 <> voncodege% THEN REQUEST "Erster Datensatz","",2
 IF MNdisabled%("DATALOCK") THEN 
   REM -- öberspringen gesperrter DatensÑtze --
   cfile$ = FILE 
   WHILE Sperre.cfile$ <> 0 AND Sperre.cfile$ <> vcodema% AND NOT EOF (cfile$)
     MOUSE OFF 
     SELECT FORM PREVIOUS 
     IF EOF (cfile$) THEN 
       IF UCASE$ (cfile$) <> GAkquiDat$ THEN REQUEST "Erster Datensatz","",2
     END IF 
   WEND 
 ELSE 
   IF cfile$ LIKE "ADRESSEN" OR cfile$ LIKE "SUPERVIS" OR cfile$ LIKE "KVERTRAG" OR cfile$ LIKE "MAADR" THEN 
     IF GMASuperCount% > 0 THEN 
       WHILE IsMASuper%(codema.cfile$) <> - 1 AND NOT EOF (cfile$)
         MOUSE OFF 
         SELECT FORM PREVIOUS 
         IF EOF (cfile$) THEN 
           IF UCASE$ (cfile$) <> GAkquiDat$ THEN REQUEST "Erster Datensatz","",2
         END IF 
       WEND 
     END IF 
   END IF 
 END IF 
 SET STATUS "Bereit"
 MOUSE ON 
 FORM 
 END SUB 



FUNCTION GetCodeGE2%(voncodege%,prompt%)
 DIM Gesellschaften$( RECCOUNT ("geadr2") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 ind$ = INDEX 
 _pos% = CodeGE2.geadr2
 voncodege% = voncodege.geadr2
 FILE "geadr2"
 INDEX voncodege.geadr2
 SELECT FIRST 
 SELECT KEY voncodege% FILE "GEADR2" INDEX voncodege.geadr2
 REM Gesellschaften$(0) = "<keine Zuordnung>" + SPACE$ (120) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("geadr2") AND voncodege.geadr2 = voncodege%
   Gesellschaften$(a%) = Gesellschaft.geadr2 + "/" + Gesellschaft2.geadr2 + "," + plz.geadr2 + " " + ort.geadr2 + "," + stra·e.geadr2 + SPACE$ (120) + STR$ (CodeGE2.geadr2,"000000")
   IF CodeGE2.geadr2 = prompt% THEN prompt$ = Gesellschaften$(a%)
   SELECT NEXT 
   a% = a% + 1
 WEND 
 
 
 CREATE DIALOG "MASUCH",0,0,330,288,"Gesellschafts-FilialÅbersicht","MS Sans Serif",8
 ADD DIALOG "MASUCH",4,0,0,329,265,0,""
 ADD DIALOG "MASUCH",9,9,11,21,21,2
 ADD DIALOG "MASUCH",5,37,11,151,10,0,"Bitte wÑhlen eine Gesellschaft aus:"
 ADD DIALOG "MASUCH",7,7,27,320,239,2,2,Gesellschaften$,Auswahl$,prompt$
 ADD DIALOG "MASUCH",1,46,268,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,103,268,55,15,0,"&Abbrechen",0,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 
 IF req% = 1 THEN 
   GetCodeGE2% = VAL ( RIGHT$ (Auswahl$(0),6))
   IF Auswahl$(0) LIKE "<ohne Zu*" OR Auswahl$(0) LIKE "<keine Zu*" THEN GetCodeGE% = 0
 ELSE 
   GetCodeGE2% = 0
 END IF 
 SELECT FORM KEY GetCodeGE% FILE "geadr2" INDEX CodeGE2.geadr2
 FORM 
 FILE cfile$
 INDEX ind$$
 END FUNCTION 
 
 
SUB Asnprgeadr2(no%)
    codege% = codege2.geadr2
    SELECT KEY codege% LOCK FILE "geadr2" INDEX codege2.geadr2
    b$ = "B" + LTRIM$ ( STR$ (no%,"99")) + ".geadr2"
    bereich$ = b$$
    a$ = "A" + LTRIM$ ( STR$ (no%,"99")) + ".geadr2"
    ansprechname$ = a$$
    t1$ = "T" + LTRIM$ ( STR$ (no%,"99")) + ".geadr2"
    Telefon1$ = t1$$
    t2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Telefon1.geadr2"
    Telefon2$ = t2$$
    pl$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "PLZ.geadr2"
    plz$ = pl$$
    o$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Ort.geadr2"
    ort$ = o$$
    s$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Strasse.geadr2"
    Strasse$ = s$$
    f1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Fax1.geadr2"
    fax1$ = f1$$
    f2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Fax2.geadr2"
    fax2$ = f2$$
    e1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Email1.geadr2"
    email1$ = e1$$
    e2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Email2.geadr2"
    email2$ = e2$$
 
    h1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Mobil1.geadr2"
    handy1$ = h1$$
    h2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Mobil2.geadr2"
    handy2$ = h2$$
 
    w1$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "www1.geadr2"
    www1$ = w1$$
    w2$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "www2.geadr2"
    www2$ = w2$$
    n$ = "K" + LTRIM$ ( STR$ (no%,"99")) + "Notiz.geadr2"
    Notiz$ = n$$
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,418,298)
    dlg.Caption = "Gesellschaftsfilialadresse-Ansprechpartner " + LTRIM$ ( STR$ (no%,"99"))
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(5,6,109,10)
    control.Caption = "Daten zum Ansprechpartner "
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(117,6,225,10)
    control.MaxLength = 35
    control.TextBinding = "ansprechname$"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(5,20,41,10)
    control.Caption = "Bereich"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(62,20,227,10)
    control.MaxLength = 20
    control.TextBinding = "bereich$"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(5,35,41,10)
    control.Caption = "PLZ"
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(62,35,47,10)
    control.MaxLength = 20
    control.TextBinding = "PLZ$"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(112,35,23,10)
    control.Caption = "Ort"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(136,35,206,10)
    control.MaxLength = 50
    control.TextBinding = "Ort$"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(5,48,41,10)
    control.Caption = "Strasse"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(62,48,280,10)
    control.MaxLength = 50
    control.TextBinding = "Strasse$"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(5,62,41,10)
    control.Caption = "Telefon 1"
 
    SET control = dlg.Add("DialogTextBox6","DialogTextBox")
    control.Move(62,62,150,10)
    control.MaxLength = 50
    control.TextBinding = "Telefon1$"
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(214,62,33,10)
    control.Caption = "Telefon 2"
 
    SET control = dlg.Add("DialogTextBox7","DialogTextBox")
    control.Move(250,62,162,10)
    control.MaxLength = 50
    control.TextBinding = "Telefon2$"
 
    SET control = dlg.Add("DialogLabel8","DialogLabel")
    control.Move(5,75,41,10)
    control.Caption = "Fax 1"
 
    SET control = dlg.Add("DialogTextBox8","DialogTextBox")
    control.Move(62,75,150,10)
    control.MaxLength = 50
    control.TextBinding = "Fax1$"
 
    SET control = dlg.Add("DialogLabel9","DialogLabel")
    control.Move(214,75,33,10)
    control.Caption = "Fax 2"
 
    SET control = dlg.Add("DialogTextBox9","DialogTextBox")
    control.Move(250,75,162,10)
    control.MaxLength = 50
    control.TextBinding = "Fax2$"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(5,88,41,10)
    control.Caption = "Handy 1"
 
    SET control = dlg.Add("DialogTextBox10","DialogTextBox")
    control.Move(62,88,150,10)
    control.MaxLength = 50
    control.TextBinding = "Handy1$"
 
    SET control = dlg.Add("DialogLabel11","DialogLabel")
    control.Move(214,88,33,10)
    control.Caption = "Handy 2"
 
    SET control = dlg.Add("DialogTextBox11","DialogTextBox")
    control.Move(250,88,162,10)
    control.MaxLength = 50
    control.TextBinding = "Handy2$"
 
    SET control = dlg.Add("DialogLabel12","DialogLabel")
    control.Move(5,100,41,10)
    control.Caption = "email 1"
 
    SET control = dlg.Add("DialogTextBox12","DialogTextBox")
    control.Move(62,100,150,10)
    control.MaxLength = 50
    control.TextBinding = "email1$"
 
    SET control = dlg.Add("DialogLabel13","DialogLabel")
    control.Move(214,100,33,10)
    control.Caption = "email 2"
 
    SET control = dlg.Add("DialogTextBox13","DialogTextBox")
    control.Move(250,100,162,10)
    control.MaxLength = 50
    control.TextBinding = "email2$"
 
    SET control = dlg.Add("DialogLabel14","DialogLabel")
    control.Move(5,113,41,10)
    control.Caption = "www 1"
 
    SET control = dlg.Add("DialogTextBox14","DialogTextBox")
    control.Move(62,113,150,10)
    control.MaxLength = 50
    control.TextBinding = "www1$"
 
    SET control = dlg.Add("DialogLabel15","DialogLabel")
    control.Move(214,113,34,10)
    control.Caption = "www 2"
 
    SET control = dlg.Add("DialogTextBox15","DialogTextBox")
    control.Move(250,113,162,10)
    control.MaxLength = 50
    control.TextBinding = "www2$"
 
    SET control = dlg.Add("DialogLabel18","DialogLabel")
    control.Move(5,126,41,10)
    control.Caption = "Notizen"
 
    SET control = dlg.Add("DialogTextBox18","DialogTextBox")
    control.Move(5,139,407,126)
    control.MultiLine = 1
    control.WantReturn = 1
    control.ScrollBars = 2
    control.MaxLength = 4000
    control.TextBinding = "Notiz$"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(184,272,63,14)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1
 
    DIALOG "Dialogname",req%
    REMOVE DIALOG ALL 
    MOUSE ON 
 
 
    REM *************************************************************
      ok% = 0
      IF bereich$ <> b$$ THEN ok% = - 1
      IF ansprechname$ <> a$$ THEN ok% = - 1
      IF Telefon1$ <> t1$$ THEN ok% = - 1
      IF Telefon2$ <> t2$$ THEN ok% = - 1
      p$ = pl$$
      IF plz$ <> pl$$ THEN ok% = - 1
      IF ort$ <> o$$ THEN ok% = - 1
      IF Strasse$ <> s$$ THEN ok% = - 1
      IF fax1$ <> f1$$ THEN ok% = - 1
      IF fax2$ <> f2$$ THEN ok% = - 1
      IF email1$ <> e1$$ THEN ok% = - 1
      IF email2$ <> e2$$ THEN ok% = - 1
      IF www1$ <> w1$$ THEN ok% = - 1
      IF www2$ <> w2$$ THEN ok% = - 1
      IF Notiz$ <> n$$ THEN ok% = - 1
      IF handy1$ <> h1$$ THEN ok% = - 1
      IF handy2$ <> h2$$ THEN ok% = - 1

       IF disabled%("GEADRFILIALEEDIT") OR ag$ = "j" THEN ok% = 0

      IF ok% = - 1 THEN 
        REQUEST "Es wurden Daten geÑndert, wollen Sie die énderungen speichern?","",130,req%
        IF req% = 1 THEN 
          b$$ = bereich$
          a$$ = ansprechname$
          t1$$ = Telefon1$
          t2$$ = Telefon2$
          pl$$ = plz$
          o$$ = Ort$
          s$$ = Strasse$
          f1$$ = Fax1$
          f2$$ = Fax2$
          e1$$ = email1$
          e2$$ = email2$
          w1$$ = www1$
          w2$$ = www2$
          n$$ = Notiz$
          h1$$ = Handy1$
          h2$$ = Handy2$
          STORE FILE "Geadr2"
         END IF 
      END IF 
 
    REM *************************************************************
 
 SELECT FORM KEY codege% FILE "geadr2" INDEX codege2.geadr2
 
 
 END SUB 
 


SUB SelFilADR(codege%)
  GCodeGE2% = codege%
  SELECT FORM KEY codege% FILE "geadr2" INDEX CodeGE2.geadr2
  IF notiz.geadr2 <> "" THEN 
    s2$ = "Notiz Æ"
  ELSE 
    s2$ = "Notiz"
  END IF 
  FORM 1
  CALL MNGEADR2()
 END SUB 


SUB WechFilForm()
  FILE "GEADR2"
  INDEX voncodege.GEADR2
  voncodege% = cuge%
  SELECT FIRST FILE "geadr" INDEX CodeGE.geadr
  SELECT FIRST FILE "geadr2" INDEX vonCodeGE.geadr2
  SELECT FORM FIRST FILE "geadr2" INDEX vonCodeGE.geadr2
  SELECT FORM KEY cuge% FILE "geadr" INDEX CodeGE.geadr
  FORM 2
  CALL MNGEADR2()
 END SUB 







 ' mode%=0      keine Abfrage der Optionen
 ' mode%=-1     Dialog mit Optionen wird angezeigt
 ' opt1%        Telefon/Fax aufnehmen Ja:-1/Nein:0
 ' opt2%        Briefanrede aufnehmen Ja:-1/Nein:0
 ' bei mode%=-1 werden opt1% und opt2% ignoriert
  
FUNCTION MakeGesAdr$(kn%,mode%,opt1%,opt2%)
 cfile$ = FILE 
 FILE "geadr"
 SELECT FIRST 
 codege% = kn%
 SELECT KEY codege% FILE "geadr" INDEX CodeGE.geadr
 lf$ = CHR$ (13) + CHR$ (10)
crgeadr1adr: 
 Adresse$ = Gesellschaft.geadr
 IF Gesellschaft2.geadr <> "" THEN 
   Adresse$ = Adresse$ + lf$ + Gesellschaft2.geadr
 END IF 
 Adresse$ = Adresse$ + lf$ + "z.Hd. " + Anrede.geadr + " " + vorname.geadr + " " + nachname.geadr + lf$
 Adresse$ = Adresse$ + Stra·e.geadr + lf$ + lf$ + plz.geadr + " " + ort.geadr + lf$ + lf$ + land.geadr + lf$ + lf$ + "Telefon: " + telefon1.geadr + lf$ + "Telefax: " + telefax.geadr
 REQUEST "Adresse aus dem Postanschriftsfeld Åbernehmen?","(Hauptgesellschaft)",130,reqpo%
 IF reqpo% = 1 THEN 
   Adresse$ = Postanschrift.geadr
 END IF 
 CREATE DIALOG "MakeAdr",0,0,273,200,title$,"MS Sans Serif",8
 ADD DIALOG "MakeAdr",4,0,0,272,175,0,""
 ADD DIALOG "MakeAdr",9,3,10,21,22,2
 ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse fÅr die öbergabe an die Textverarbeitung in der Zwischenablage bereitgestellt werden soll:"
 ADD DIALOG "MakeAdr",6,30,33,236,120,68,2,Adresse$,1800
 ADD DIALOG "MakeAdr",1,73,179,55,15,1,"&Weiter",1,1
 ADD DIALOG "MakeAdr",1,129,179,55,15,0,"&Abbrechen",0,0
 DIALOG "MakeAdr",req%
 REMOVE DIALOG "MakeAdr"
 IF req% = 0 THEN GOTO crgeadr1adr
 MakeGesAdr$ = Adresse$
 SELECT KEY codege% FILE "geadr" INDEX CodeGE.geadr
 FILE cfile$
 END FUNCTION 




 ' mode%=0      keine Abfrage der Optionen
 ' mode%=-1     Dialog mit Optionen wird angezeigt
 ' opt1%        Telefon/Fax aufnehmen Ja:-1/Nein:0
 ' opt2%        Briefanrede aufnehmen Ja:-1/Nein:0
 ' bei mode%=-1 werden opt1% und opt2% ignoriert
  
FUNCTION MakeGesAdr2$(kn%,mode%,opt1%,opt2%)
 cfile$ = FILE 
 FILE "geadr2"
 SELECT FIRST 
 codege% = kn%
 SELECT KEY codege% FILE "geadr2" INDEX CodeGE2.geadr2
 lf$ = CHR$ (13) + CHR$ (10)
crgeadr2adr: 
 Adresse$ = Gesellschaft2.geadr2
 IF Gesellschaft.geadr2 <> "" THEN 
   Adresse$ = Adresse$ + lf$ + Gesellschaft.geadr2
 END IF 
 Adresse$ = Adresse$ + lf$ + "z.Hd. " + Anrede.geadr2 + " " + vorname.geadr2 + " " + nachname.geadr2 + lf$
 Adresse$ = Adresse$ + Stra·e.geadr2 + lf$ + lf$ + plz.geadr2 + " " + ort.geadr2 + lf$ + lf$ + "Telefon: " + telefon1.geadr2 + lf$ + "Telefax: " + telefax.geadr2
 REQUEST "Adresse aus dem Postanschriftsfeld Åbernehmen?","Gesellschaftsfiliale",130,reqpo%
 IF reqpo% = 1 THEN 
   Adresse$ = Postanschrift.geadr2
 END IF 
 CREATE DIALOG "MakeAdr",0,0,273,200,title$,"MS Sans Serif",8
 ADD DIALOG "MakeAdr",4,0,0,272,175,0,""
 ADD DIALOG "MakeAdr",9,3,10,21,22,2
 ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse fÅr die öbergabe an die Textverarbeitung in der Zwischenablage bereitgestellt werden soll:"
 ADD DIALOG "MakeAdr",6,30,33,236,120,68,2,Adresse$,1800
 ADD DIALOG "MakeAdr",1,73,179,55,15,1,"&Weiter",1,1
 ADD DIALOG "MakeAdr",1,129,179,55,15,0,"&Abbrechen",0,0
 DIALOG "MakeAdr",req%
 REMOVE DIALOG "MakeAdr"
 IF req% = 0 THEN GOTO crgeadr2adr
 MakeGesAdr2$ = Adresse$
 SELECT KEY codege% FILE "geadr2" INDEX CodeGE2.geadr2
 FILE cfile$
 END FUNCTION 
 
 
 ' mode%=0      keine Abfrage der Optionen
 ' mode%=-1     Dialog mit Optionen wird angezeigt
 ' opt1%        Telefon/Fax aufnehmen Ja:-1/Nein:0
 ' opt2%        Briefanrede aufnehmen Ja:-1/Nein:0
 ' bei mode%=-1 werden opt1% und opt2% ignoriert
 
FUNCTION MakeMAAdr$(kn%,mode%,opt1%,opt2%)
 cfile$ = FILE 
 FILE "maadr"
 SELECT FIRST 
 codema% = kn%
 SELECT KEY codema% FILE "maadr" INDEX Codema.maadr
 lf$ = CHR$ (13) + CHR$ (10)
 
 Adresse$ = Anrede + lf$ + vorname + " " + Nachname + lf$
 Adresse$ = Adresse$ + Stra·e + lf$ + lf$ + plz + " " + ort + lf$ + lf$ + "Telefon: " + Telefon1 + lf$ + "Telefax: " + Telefax
 REM REQUEST "Adresse aus dem Postanschriftsfeld Åbernehmen?","",130,reqpo%
    DIM dlg AS Dialog
    DIM control AS DialogControl
crMAAdr: 
    opt% = 1
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,222,119)
    dlg.Caption = "Art der Adresse"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(2,8,219,90)
    control.Caption = " WÑhlen Sie eine Option "
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(6,20,159,10)
    control.Caption = "Postanschriftsfeld 1 nehmen"
    control.Bind("opt%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(6,32,214,9)
    control.Caption = "Postanschriftsfeld 2 nehmen"
    control.Bind("opt%")
    control.ValueOn = 2
 
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(59,100,43,16)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(105,100,42,16)
    control.Caption = "Abbruch"
    control.ReturnValue = 0

    DIALOG "Dialogname",req%
    REMOVE DIALOG "Dialogname"
    IF req% = 1 THEN 
      reqpo% = opt%
    ELSE 
      MakeMAAdr$ = ""
      GOTO madrend200920041
    END IF 
 ELSE 
   reqpo% = 1
 END IF 
 IF reqpo% = 1 THEN 
   Adresse$ = Postanschrift.maadr
 ELSE 
   Adresse$ = Postanschrift2.maadr
 END IF 
 CREATE DIALOG "MakeAdr",0,0,273,156,title$,"MS Sans Serif",8
 ADD DIALOG "MakeAdr",4,0,0,272,131,0,""
 ADD DIALOG "MakeAdr",9,3,10,21,22,2
 ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse fÅr die öbergabe an die Textverarbeitung in der Zwischenablage bereitgestellt werden soll:"
 ADD DIALOG "MakeAdr",6,30,33,236,66,68,2,Adresse$,1800
 ADD DIALOG "MakeAdr",1,73,135,55,15,1,"&Weiter",1,1
 ADD DIALOG "MakeAdr",1,129,135,55,15,0,"&Abbrechen",0,0
 DIALOG "MakeAdr",req%
 REMOVE DIALOG "MakeAdr"
 IF req% = 0 THEN GOTO crMAAdr
 MakeMAAdr$ = Adresse$
 SELECT KEY codema% FILE "maadr" INDEX Codema.maadr
madrend200920041: 
 FILE cfile$
 END FUNCTION 
 



SUB Lizensier1()
 title1$ = title$ + " Version: " + RIGHT$ (GBuildno$,GBuilnolen%) + "-" + PRGVersion$ + "/" + LTRIM$ ( STR$ ( FN sys(5),"999")) + " AP/ " + prv$
 REM CALL Fehler(title1$,"")
 IF NOT EXISTS (_netpath$ + "LICENSE.DLL") THEN 
   CALL Fehler("Fehler in Superbase-Runtime!","Bitte wenden Sie sich an Ihren HÑndler oder an die Hotline.")
   CALL EXIT()
 END IF 
 mp% = 0
 licfound% = CALL ("GetLicense",iAppID%,_netpath$ + "LICENSE.DLL")
 REM licfound% = 0
 IF licfound% = 1 THEN 
   DiskSize&% = CALL ("AccessItemL",0,0,0)'                                     ; == auf Manipulation testen ==
   lDiskSize&% = CALL ("AccessItemL",11,0,0)
   IF DiskSize&% <> lDiskSize&% THEN mp% = - 1'                                 ; Festplatte gewechselt
   IF CALL ("AccessItemI",12,0,0) <> FN sys(5) THEN mp% = - 1'                  ; andere Netzwerk-Version
   timeout% = CALL ("AccessItemL",9,0,0)
   SELECT FIRST LOCK FILE "config"
   tdt$ = qwono.config
   testtimeout% = VAL (tdt$)
   p$ = DATE$ (testtimeout%,"0dmmyyyy")
   IF testtimeout% <> timeout% AND qwono.config <> "" AND p$ <> "09092999" THEN mp% = - 1
   heute% = DAYS ( TODAY )
   IF testtimeout% < heute% THEN mp% = - 1
   IF ag$ <> "test9999999" THEN 
     IF timeout% - 30 > DAYS ( TODAY ) THEN 
       mp% = - 1'; Systemzeit manipuliert?
     END IF 
   ELSE 
     IF timeout% - 60 > DAYS ( TODAY ) THEN 
       mp% = - 1'; Systemzeit manipuliert?
     END IF 
   END IF 
   mp% = - 1
   IF mp% THEN 
     a% = CALL ("AccessItemL",9,1,0)'                                           ; AppLicense.Timeout = 0
     a% = CALL ("PutLicense",iAppID%,_netpath$ + "LICENSE.DLL")'                ; TimeOut sperren
   END IF 
 ELSE '                                                                         ; == Basisdaten schreiben ==
   SELECT FIRST LOCK FILE "CONFIG"
   p% = VAL (qwono.config)
   p$ = DATE$ (p%,"0dmmyyyy")
   timeout% = CALL ("AccessItemL",9,0,0)
   IF qwono.config <> "" AND p$ <> "09092999" AND timeout% < 1 THEN mp% = - 1
   IF ag$ <> "test9999999" THEN 
     tttod1% = DAYS ( TODAY ) + 30
   ELSE 
     tttod1% = DAYS ( TODAY ) + 60
   END IF 
   a% = CALL ("AccessItemI",8,1,0)'                                             ; AppLicense.Licensed = 0
   a% = CALL ("AccessItemL",9,1,tttod1%)'                          ; AppLicense.Timeout
   a% = CALL ("AccessItemL",10,1,0)'                                            ; AppLicense.SerialNo = 0
   a% = CALL ("AccessItemL",11,1, CALL ("AccessItemL",0,0,0))'                  ; AppLicense.SysParam = 0
   a% = CALL ("AccessItemI",12,1, FN sys(5))'                                   ; AppLicense.NetCount = 0
   a% = CALL ("PutLicense",iAppID%,_netpath$ + "LICENSE.DLL")
   IF qwono.config = "" OR p$ = "09092999" THEN 
     tttod1$ = STR$ (tttod1%,"00000000")
     qwono.config = STR$ (tttod1%,"00000000")
     STORE FILE "config"
     UNLOCK CURRENT FILE "config"
   ELSE 
     dw$ = STR$ ( TODAY ,"00000000")
     qwono.config = dw$
     STORE FILE "config"
     UNLOCK CURRENT FILE "config"
     mp% = - 1
   END IF 
   IF mp% THEN 
     a% = CALL ("AccessItemL",9,1, DAYS ( TODAY ) - 90)'                        ; AppLicense.Timeout = 0
     a% = CALL ("PutLicense",iAppID%,_netpath$ + "LICENSE.DLL")'                ; TimeOut sperren 
     mp% = - 1
     licfound% = 1
   END IF 
 END IF 
 timeout% = 0
 IF licfound% = 1 THEN 
   a% = CALL ("GetLicense",iAppID%,_netpath$ + "LICENSE.DLL")
   timeout% = CALL ("AccessItemL",9,0,0)
   pdemende$ = ""
   IF timeout% <= DAYS ( TODAY ) THEN 
     pdemende$ = DATE$ (timeout%,"0d.mm.yyyy")
     timeout% = - 1
   ELSE 
     pdemende$ = DATE$ (timeout%,"0d.mm.yyyy")
     timeout% = 0'         ; Probezeit abgelaufen ? 
   END IF 
 END IF 
 IF CALL ("AccessItemI",8,0,0) = 255 - FN sys(5) AND NOT mp% THEN 
   SELECT FIRST FILE "config"
   test1$ = maname.config
   test$ = MID$ (PWDecoded1$(test1$),7)
   testser$ = LEFT$ (PWDecoded1$(test1$),6)
   testserial&% = CALL ("AccessItemL",10,0,0)
   testSerie$ = STR$ (testserial&%,"000000")
   REM CALL Fehler(test$,Gserial$)
   REM CALL Fehler(testser$,testSerie$)
   IF testser$ = testSerie$ THEN 
     END SUB '     ; Lizensierung OK! - Austritt
   ELSE 
     licfound% = 0
     mp% = - 1
   END IF 
 ELSE 
   mp% = - 1
 END IF 
 REMOVE DIALOG ALL 
 IF licfound% = 0 OR mp% OR CALL ("AccessItemL",10,0,0) = 0 THEN 
   msg$ = "Registrieren"
 ELSE 
   msg$ = "Freischalten"
 END IF 
 cmReg$ = "&" + msg$
 msg$ = "Wenn Sie das Programm kÑuflich erworben haben oder erwerben wollen, klicken Sie auf die SchaltflÑche '" + msg$ + "'."
 IF NOT timeout% THEN 
   CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
   REM FILE GAdrDat$
   REM INDEX codeku.GAdrDat$
   REM SELECT FIRST LOCK 
   REM IF prioritÑt.GAdrDat$ = 3 THEN timeout% = - 1
   FILE "Supervis"
 END IF 
 IF timeout% THEN 
   CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
   FILE GAdrDat$
   INDEX codeku.GAdrDat$
   SELECT FIRST LOCK 
   prioritÑt.GAdrDat$ = 3
   STORE FILE GAdrDat$
   UNLOCK CURRENT FILE GAdrDat$
   UNLOCK FILE GADRDat$
   FILE "Supervis"
   HtlFirma$ = ReadConfig$(_projekt$,"HotlineFirma")
   HtlTelefon$ = ReadConfig$(_projekt$,"HotlinePhone")'                         ; Hotlinedaten aus
   HtlTelefax$ = ReadConfig$(_projekt$,"HotlineFax")'                           ; CODIEAPP.NET auslesen und
   IF HtlTelefon$ LIKE "leer" THEN HtlTelefon$ = "(0331) 28 00 28 1"'           ; notfalls auf Standardwerte
   IF HtlTelefax$ LIKE "leer" THEN HtlTelefax$ = "(0331) 28 00 28 2"'           ; setzen
   IF ag$ <> "test999999" THEN 
     CREATE DIALOG "Demo2",0,0,233,127,title1$,"MS Sans Serif",8'                  ; == Dialog fÅr Timeout erzeugen ==
     ADD DIALOG "Demo2",4,0,0,233,106,0,""
     ADD DIALOG "Demo2",9,4,8,20,22,3
     ADD DIALOG "Demo2",5,30,11,159,11,0,""
     ADD DIALOG "Demo2",5,30,25,158,29,0,""
     ADD DIALOG "Demo2",5,30,58,196,20,0,"Hotline (Mo - Do, 10:00 - 18:00, Fr 10:00-15:00):"
     ADD DIALOG "Demo2",5,30,78,30,10,0,"Telefon:"
     ADD DIALOG "Demo2",5,71,78,119,10,0,HtlTelefon$
     ADD DIALOG "Demo2",5,30,88,17,10,0,"Fax:"
     ADD DIALOG "Demo2",5,71,88,117,10,0,HtlTelefax$
     ADD DIALOG "Demo2",1,91,109,55,15,1,"&OK",1,2
   ELSE 
     CREATE DIALOG "Demo2",0,0,233,127,title1$,"MS Sans Serif",8'                  ; == Dialog fÅr Timeout erzeugen ==
     ADD DIALOG "Demo2",4,0,0,233,106,0,""
     ADD DIALOG "Demo2",9,4,8,20,22,3
     ADD DIALOG "Demo2",5,30,11,159,11,0,"Der Nutzungszeitraum von 60 Tagen ist abgelaufen."
     ADD DIALOG "Demo2",5,30,25,158,29,0,"Um das Programm weiter zu nutzen oder den Testzeitraum der Demo zu verlÑngern, setzen Sie sich bitte mit der Hotline in Verbindung."
     ADD DIALOG "Demo2",5,30,58,196,20,0,"Hotline (Mo - Do, 10:00 - 18:00 Fr 10:00-15:00):"
     ADD DIALOG "Demo2",5,30,78,30,10,0,"Telefon:"
     ADD DIALOG "Demo2",5,71,78,119,10,0,HtlTelefon$
     ADD DIALOG "Demo2",5,30,88,17,10,0,"Fax:"
     ADD DIALOG "Demo2",5,71,88,117,10,0,HtlTelefax$
     ADD DIALOG "Demo2",1,91,109,55,15,1,"&OK",1,2
   END IF 
 END IF 
 CREATE DIALOG "Demo",0,0,237,98,title1$,"MS Sans Serif",8'                      ; == Regist/Demo-Dialog erzeugen ==
 ADD DIALOG "Demo",4,0,0,236,74,0,""
 ADD DIALOG "Demo",9,4,11,22,22,4
 ADD DIALOG "Demo",5,31,13,192,10,0,""
 ADD DIALOG "Demo",5,31,25,198,18,0,""
 ADD DIALOG "Demo",5,31,45,198,24,0,msg$
 IF NOT timeout% THEN 
   REM ADD DIALOG "Demo",1,14,78,65,15,1,"&Programm starten",1,1
 ELSE 
   REM ADD DIALOG "Demo",1,14,78,65,15,1,"&Programm starten",1,2,"Demo2"
 END IF 
 ADD DIALOG "Demo",1,60,78,55,15,0,cmReg$,2,1
 ADD DIALOG "Demo",1,118,78,55,15,0,"&Beenden",0,0
 DIALOG "Demo",req%
 REMOVE DIALOG ALL 
 Gpdemende$ = pdemende$
 IF req% = 0 THEN CALL EXIT()
 
 IF req% = 2 THEN 
   tt% = CALL ("AccessItemL",10,0,0)
   REM CALL Fehler( STR$ (licfound%,"99") + " " + STR$ (mp%,"99"), STR$ (tt%,"99"))
   IF licfound% = 0 OR mp% = - 1 OR tt% = 0 THEN 
     SELECT FIRST LOCK FILE "config"
     GLizName$ = CALL ("AccessItemC",1,0,"")
     GLizFirma$ = CALL ("AccessItemC",2,0,"")
     Name$ = GLizName$
     Firma$ = GLizFirma$
     REM Name$ = TRIM$ ( CALL ("GetUserName"))
     REM Firma$ = TRIM$ ( CALL ("GetUserCompany"))
     IF anzag.config <> 0 THEN 
       ag1$ = LTRIM$ ( STR$ (anzag.config,"999999")) + " Agent"
     ELSE 
       ag1$ = "+"
     END IF 
     IF UCASE$ (TempletonImport.config) <> "TRUE" THEN 
       prgv$ = PRGVersion.config + " " + ag1$
     ELSE 
       prgv$ = PRGVersion.config + " " + ag1$ + " TImp"
     END IF 
     Htlfon$ = ReadConfig$(_projekt$,"HotlinePhone")'                  ; Hotlinedaten aus
     name$ = GLizName$
     Firma$ = GLizFirma$
     CREATE DIALOG "LIZENZ",0,0,350,185,title1$,"MS Sans Serif",8
     ADD DIALOG "LIZENZ",4,0,0,350,160,0,""
     ADD DIALOG "LIZENZ",9,8,10,19,21,3
     REM ADD DIALOG "LIZENZ",5,32,10,214,10,0,"Registrierung/Lizensierung: " + Htlfon$
     ADD DIALOG "LIZENZ",5,32,10,214,10,0,"Registrierung/Lizensierung: +49 331 242180"
     ADD DIALOG "LIZENZ",5,32,20,214,20,0,"Zur ordnungsgemÑ·en Lizensierung dieser Anwendung fÅllen Sie bitte die nachfolgenden Eingabefelder vollstÑndig aus."
     ADD DIALOG "LIZENZ",5,32,44,214,30,0,"Variante:" + title1$
     REM ADD DIALOG "LIZENZ",5,32,63,214,10,0,"Die Seriennummern werden Ihnen vom CODie-Team angesagt!"
     ADD DIALOG "LIZENZ",5,32,63,214,10,0,"Die Seriennummer wird Ihnen vom CODie-Team angesagt!"
     ADD DIALOG "LIZENZ",5,32,74,70,10,0,"Lizensierungsdaten:"
     ADD DIALOG "LIZENZ",5,32,93,23,10,0,"Name:"
     ADD DIALOG "LIZENZ",6,90,89,254,11,0,0,Name$,50
     ADD DIALOG "LIZENZ",5,32,108,24,10,0,"Firma:"
     ADD DIALOG "LIZENZ",6,90,104,254,11,0,0,Firma$,50
     ADD DIALOG "LIZENZ",5,32,123,55,10,0,"Seriennummer 1:"
     ADD DIALOG "LIZENZ",6,90,119,254,11,0,0,Seriennummer$,50
     REM ADD DIALOG "LIZENZ",5,32,136,55,10,0,"Seriennummer 2:"
     REM ADD DIALOG "LIZENZ",6,90,133,154,11,0,0,Seriennummer2$,50
     ADD DIALOG "LIZENZ",1,106,167,55,15,1,"&Weiter",1,1
     ADD DIALOG "LIZENZ",1,163,167,55,15,0,"&Abbruch",0,0
     REM ADD DIALOG "LIZENZ",1,150,167,55,15,0,"&Hilfe",2,2
     ok% = 0
     WHILE NOT ok%
       DIALOG "LIZENZ",req%
       Seriennummer$ = UCASE$ (Seriennummer$)
       Seriennummer2$ = LTRIM$ ( UCASE$ ( RIGHT$ (GBuildno$,GBuilnolen%)))
       SELECT CASE req%
       CASE 1
         fehler$ = ""
         IF Name$ = "" THEN fehler$ = fehler$ + ", Name"
         IF Firma$ = "" THEN fehler$ = fehler$ + ", Firma"
         IF Seriennummer2$ = "" OR Seriennummer$ = "" OR Seriennummer$ <> GSerial$ THEN 
           fehler$ = fehler$ + ", Seriennummer"
         ELSE 
           REM 010300-kxq-yac-12-3xa
           Seriennummero$ = Seriennummer$
           s$ = LEFT$ (Seriennummer$,6)
           Seriennummer$ = s$
           serial$ = MID$ (Seriennummero$,7)
           so$ = Seriennummero$
           a1$ = RIGHT$ (GBuildno$,GBuilnolen%)
           a2$ = RIGHT$ (Seriennummer2$,GBuilnolen%)
           a$ = CALL ("AccessItemC",1,1,name$)
           a$ = CALL ("AccessItemC",2,1,Firma$)
           REM IF VAL (Seriennummer$) = 0 OR LEFT$ (Seriennummer$,1) <> "0" OR LEN (Seriennummer$) < 4 OR LEN (Seriennummer$) > 6 OR LEFT$ (Seriennummer2$,GBuilnolen%) <> RIGHT$ (GBuildno$,GBuilnolen%) OR UCASE$ (serial$) <> UCASE$ (GSerial$) THEN 
           IF LEN (Seriennummer$) < 4 OR LEN (Seriennummer$) > 6 THEN 
             fehler$ = fehler$ + ", Seriennummer falsch"
           END IF 
         END IF 
         IF fehler$ <> "" THEN 
           REQUEST "Die Lizensierungsdaten sind noch nicht vollstÑndig oder fehlerhaft!","Es fehlen die Angaben: " + RIGHT$ (fehler$, LEN (fehler$) - 1),139,req1%
           Seriennummer$ = Seriennummero$
         ELSE 
           Seriennummer$ = Seriennummero$
           CREATE DIALOG "LIZENZ2",0,0,254,82,title1$,"MS Sans Serif",8
           ADD DIALOG "LIZENZ2",4,0,0,253,60,0,""
           ADD DIALOG "LIZENZ2",9,7,10,20,23,2
           ADD DIALOG "LIZENZ2",5,34,10,202,11,0,"Sind die eingegebenen Daten richtig?"
           ADD DIALOG "LIZENZ2",5,34,21,23,11,0,"Name:"
           ADD DIALOG "LIZENZ2",5,88,21,157,11,0,Name$
           ADD DIALOG "LIZENZ2",5,34,32,24,11,0,"Firma:"
           ADD DIALOG "LIZENZ2",5,88,32,157,11,0,Firma$
           ADD DIALOG "LIZENZ2",5,34,44,51,11,0,"Seriennummer:"
           ADD DIALOG "LIZENZ2",5,88,44,157,11,0,Seriennummer$
           ADD DIALOG "LIZENZ2",1,68,64,55,15,1,"&Weiter",1,1
           ADD DIALOG "LIZENZ2",1,125,64,55,15,0,"é&ndern",0,0
           DIALOG "LIZENZ2",req2%
           REMOVE DIALOG "LIZENZ2"
           IF req2% = 1 THEN ok% = - 1 ELSE ok% = 0
         END IF 
       CASE 2
         REM ** ? "Hilfetext zu LIZ1 anzeigen"
       CASE ELSE 
         ok% = - 1
         CALL EXIT()
       END SELECT 
     WEND 
     REMOVE DIALOG "LIZENZ"
     a$ = CALL ("AccessItemC",1,1,name$)
     a$ = CALL ("AccessItemC",2,1,Firma$)
     GLizName$ = CALL ("AccessItemC",1,0,"")
     GLizFirma$ = CALL ("AccessItemC",2,0,"")
     IF mp% THEN 
       REM normalerweise mu· hier eingetragen werden bis wann das Programm laufen soll
       REM also die Sache aus SER2 Åbernehmen
       atests$ = LTRIM$ ( MID$ (Seriennummer2$,9))
       IF atests$ <> "" THEN 
         REM CALL Fehler(atests$,"")
         xxxlz% = VAL (atests$) / 2
         a% = CALL ("AccessItemL",9,1, DAYS ( TODAY ) + xxxlz%)
         SELECT FIRST LOCK FILE "config"
         xxbis1% = TODAY 
         xxbis1% = DAYS ( TODAY + xxxlz%)
         dw$ = STR$ (xxbis1%,"00000000")
         qwono.config = dw$
         STORE FILE "config"
         UNLOCK FILE "config"
       ELSE 
         a% = CALL ("AccessItemL",9,1,0)
       END IF 
     ELSE 
       IF ag$ <> "test9999999" THEN 
         a% = CALL ("AccessItemL",9,1, DAYS ( TODAY ) + 30)
       ELSE 
         a% = CALL ("AccessItemL",9,1, DAYS ( TODAY ) + 60)
       END IF 
     END IF 
     Seriennummer$ = s$
     a% = CALL ("AccessItemL",10,1, VAL (Seriennummer$))
     a% = CALL ("AccessItemL",11,1, CALL ("AccessItemL",0,0,0))
     a% = CALL ("AccessItemI",12,1, FN sys(5))
     DiskSize% = CALL ("AccessItemL",0,0,0)
     lizcode$ = MakeCode$(Name$,DiskSize%, VAL (Seriennummer$),iAppID%)
     lizcode&% = VAL ( RIGHT$ (lizcode$,6))
     a% = CALL ("AccessItemL",7,1,lizcode&%)
     a% = CALL ("AccessItemI",8,1,0)
     a% = CALL ("PutLicense",iAppID%,_netpath$ + "LICENSE.DLL")
   END IF 
   IF CALL ("AccessItemI",8,0,0) <> 255 - FN sys(5) THEN 
     a% = CALL ("GetLicense",iAppID%,_netpath$ + "LICENSE.DLL")
     Seriennummer$ = STR$ ( CALL ("AccessItemL",10,0,0),"000000")
     name$ = CALL ("AccessItemC",1,0,"")
     firma$ = CALL ("AccessItemC",2,0,"")
     DiskSize% = CALL ("AccessItemL",0,0,0)
     lizcode$ = MakeCode$(Name$,DiskSize%, VAL (Seriennummer$),iAppID%)
     name$ = CALL ("AccessItemC",1,0,"")
     IF ag$ <> "test999999999" THEN 
       CREATE DIALOG "LIZENZ",0,0,350,156,title1$,"MS Sans Serif",8
       ADD DIALOG "LIZENZ",4,0,0,350,134,0,""
       ADD DIALOG "LIZENZ",9,8,12,20,23,2
       ADD DIALOG "LIZENZ",5,33,12,210,10,0,"Bitten geben Sie den Freischaltcode ein:"
       ADD DIALOG "LIZENZ",5,33,23,210,28,0,"Sollten Sie noch keinen Freischaltcode erhalten haben, kontaktieren Sie uns telefonisch 0331 242180."
       ADD DIALOG "LIZENZ",5,33,51,210,18,0,"Den Freischaltcode erhalten Sie dann von uns telefonisch, per Fax oder per Post."
       REM ADD DIALOG "LIZENZ",5,33,70,210,26,0,"Innerhalb der ersten 14 Tage nach Installation des Programmes, kînnen Sie das Programm auch ohne Eingabe des Freischaltcodes starten."
       ADD DIALOG "LIZENZ",5,33,102,63,11,0,"Lizensierungscode:"
       ADD DIALOG "LIZENZ",5,103,102,240,11,0,lizcode$
       ADD DIALOG "LIZENZ",6,103,115,235,11,0,0,fscode$,50
       ADD DIALOG "LIZENZ",5,33,118,50,10,0,"Freischaltcode:"
       ADD DIALOG "LIZENZ",1,115,139,55,15,1,"&Weiter",1,1
       ADD DIALOG "LIZENZ",1,172,139,55,15,0,"&Ende",0,0
       DIALOG "LIZENZ",req%
       REMOVE DIALOG "LIZENZ"
     ELSE 
       req% = 1
       fscode$ = "V"
     END IF 
     IF req% = 1 THEN 
       IF fscode$ LIKE "V" THEN CALL LizV(so$)
       lizcode&% = VAL ( RIGHT$ (lizcode$,6))
       fscode&% = VAL (fscode$)
       a% = CALL ("GetAppVersion",lizcode&%,fscode&%)
       IF a% = 1 THEN 
         dw% = DAYS ("09.09.2999")
         a% = CALL ("AccessItemI",8,1,255 - FN sys(5))
         a% = CALL ("AccessItemL",11,1, CALL ("AccessItemL",0,0,0))
         a% = CALL ("AccessItemI",12,1, FN sys(5))
         IF xxxlz% > 0 THEN 
           a% = CALL ("AccessItemL",9,1, DAYS ( TODAY ) + xxxlz%)'                          ; AppLicense.Timeout
         ELSE 
           a% = CALL ("AccessItemL",9,1, DAYS ( TODAY ) + 30)'                          ; AppLicense.Timeout
         END IF 
         a% = CALL ("AccessItemL",9,1,dw%)'                          ; AppLicense.Timeout
         a% = CALL ("PutLicense",iAppID%,_netpath$ + "LICENSE.DLL")
         CREATE DIALOG "LIZENZ",0,0,222,190,title1$,"MS Sans Serif",8
         ADD DIALOG "LIZENZ",4,0,0,222,168,0,""
         ADD DIALOG "LIZENZ",9,6,12,20,23,4
         ADD DIALOG "LIZENZ",5,30,12,182,8,0,"Herzlichen GlÅckwunsch!"
         ADD DIALOG "LIZENZ",5,30,20,182,8,0,"Das Programm wurde erfolgreich lizensiert."
         REM ADD DIALOG "LIZENZ",5,30,32,182,30,0,"Bitte notieren Sie sich die nachfolgenden Daten, um im Falle einer Neuinstallation die Software wieder freischalten zu kînnen."
         REM ADD DIALOG "LIZENZ",5,30,60,182,25,0,"Bedenken Sie aber bitte, da· der Freischaltcode nur fÅr diesen Computer gilt. Die Installation auf einen anderen Computer ist mit diesem Freischaltcode nicht mîglich."
         ADD DIALOG "LIZENZ",4,30,91,187,72,0,""
         ADD DIALOG "LIZENZ",4,30,91,187,18,0,""
         ADD DIALOG "LIZENZ",5,35,98,88,10,0,"Lizensierungsdaten"
         ADD DIALOG "LIZENZ",5,35,112,47,10,0,"Name:"
         ADD DIALOG "LIZENZ",5,90,112,125,10,0,Name$
         ADD DIALOG "LIZENZ",5,35,122,46,10,0,"Firma:"
         ADD DIALOG "LIZENZ",5,90,122,125,10,0,Firma$
         ADD DIALOG "LIZENZ",5,35,132,46,10,0,"Programm:"
         ADD DIALOG "LIZENZ",5,90,132,125,10,0,title$
         ADD DIALOG "LIZENZ",5,35,142,48,10,0,"Seriennummer:"
         ADD DIALOG "LIZENZ",5,90,142,125,10,0,Seriennummer$
         ADD DIALOG "LIZENZ",5,35,152,50,10,0,"Freischaltcode:"
         ADD DIALOG "LIZENZ",5,90,152,125,10,0,fscode$
         ADD DIALOG "LIZENZ",1,52,172,55,15,1,"&Weiter",1,1
         REM ADD DIALOG "LIZENZ",1,108,172,55,15,0,"&Drucken",2,1
         DIALOG "LIZENZ",req%
         REMOVE DIALOG "LIZENZ"
         SELECT FIRST LOCK FILE "config"
         REM Pa·wort.SUPERVIS = CALL (~crypt~,pawo$)
         REM CALL Fehler(so$,"")
         MAName.config = CALL ("crypt",so$)
         IF xxxlz% > 0 THEN 
           dw% = DAYS ( TODAY + xxxlz%)
         ELSE 
           dw% = DAYS ("09.09.2999")
         END IF 
         dw$ = STR$ (dw%,"00000000")
         qwono.config = dw$
         REM QWONo.config = PWDecoded1$(so$)
         STORE FILE "CONFIG"
         REM 160698
         CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
         FILE GAdrDat$
         INDEX codeku.GAdrDat$
         SELECT FIRST LOCK 
         prioritÑt.GAdrDat$ = 0
         STORE FILE GAdrDat$
         UNLOCK CURRENT FILE GADRDat$
         UNLOCK FILE GADRDat$
         FILE "Supervis"
         Gpdemende$ = ""
       ELSE 
         a% = CALL ("GetLicense",iAppID%,_netpath$ + "LICENSE.DLL")
         timeout% = CALL ("AccessItemL",9,0,0)
         IF timeout% <= DAYS ( TODAY ) THEN timeout% = - 1 ELSE timeout% = 0
         IF fscode$ <> "" OR timeout% THEN 
           IF timeout% THEN 
             a% = CALL ("AccessItemL",9,1,0)
             a% = CALL ("PutLicense",iAppID%,_netpath$ + "LICENSE.DLL")
             cmOK$ = "&Ende"
             msg$ = "Ein Fortfahren ohne Eingabe des richtigen Freischaltcodes ist nicht mehr mîglich."
           ELSE 
             cmOK$ = "&Weiter"
             CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
             FILE GAdrDat$
             INDEX codeku.GAdrDat$
             SELECT FIRST LOCK 
             IF prioritÑt.GAdrDat$ = 3 THEN cmOK$ = "&Ende"
             msg$ = "Bitte geben Sie beim nÑchsten Programmstart den korrekten Freischaltcode ein."
           END IF 
           CREATE DIALOG "LIZENZ",0,0,198,69,title1$,"MS Sans Serif",8
           ADD DIALOG "LIZENZ",4,0,0,198,45,0,""
           ADD DIALOG "LIZENZ",9,6,10,20,22,1
           ADD DIALOG "LIZENZ",5,34,9,155,10,0,"Der eingegebene Freischaltcode ist fehlerhaft!"
           ADD DIALOG "LIZENZ",5,34,20,156,20,0,msg$
           ADD DIALOG "LIZENZ",1,66,50,55,15,0,cmOK$,0,0
           DIALOG "LIZENZ"
           REMOVE DIALOG "LIZENZ"
           IF cmOK$ LIKE "*Ende*" THEN CALL EXIT()
         END IF 
       END IF 
     ELSE 
       CALL EXIT()
     END IF 
   END IF 
 END IF 
 END SUB 
 








 '      **************************************
 '      ** Routinen fÅr Formular "Stammdaten" **
 '      **************************************
 
SUB Stamm()
 IF disabled%("FIRMENSTAMM") THEN END SUB 
 DIM DokUeberg%(1)
 cuvc% = Codema.supervis
 CALL DFile(2,"access" + _fpw$)
 CALL DFile(2,"accode" + _fpw$)
 CALL DFile(3,"AGDIR" + _fpw$)
 CALL DFile(3,"BUDAY" + _fpw$)
 CALL DFile(3,"STAMM" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"STAMMHIS" + _fpw$)
staanf0812200202: 
 IF _projekt$ LIKE "IMMAK" THEN 
   GNOAGDIR% = - 1
 ELSE 
   CALL DFile(3,"MAADR" + _fpw$)
 END IF 
 _formend% = 0
 SET STATUS "Bereit"
 ON ERROR GOTO ErrorHandler
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   SUPERVISsub% = 0
   IF FORM <> "STAMM" THEN 
     SET HEADING title$ + " - Firmen-Stammdatenverwaltung"
     IF EXISTS (GPrjForm$ + "STAMM.sbv") THEN 
       OPEN FORM GPrjForm$ + "STAMM"
     ELSE 
       OPEN FORM GPrjForm$ + "STAMM"
     END IF 
     SET f = Superbase.Form
     SET STATUS "Firmen-Stammdatenverwaltung"
     FILE "STAMM"
     INDEX Firma1.stamm
     SELECT FIRST 
     CALL MNSTAMM()
     FORM 
   END IF 
   IF GNOAGDIR% THEN 
     IF _projekt$ LIKE "IMMAK" THEN 
     ELSE 
       f.direktionen.visible = 0
       f.direktionen.enabled = 0
     END IF 
   ELSE 
     f.direktionen.visible = - 1
     f.direktionen.enabled = - 1
   END IF 
   MENU ON 
   MOUSE ON 
   IF ag$ = "j" THEN 
     f.bearb.visible = - 1
     f.sichern.visible = - 1
     f.einstell.visible = - 1
   ELSE 
     f.bearb.visible = - 1
     f.sichern.visible = - 1
     f.einstell.visible = - 1
   END IF 
   IF GAgentDetail$ LIKE "TRUE" THEN 
     f.KopfKto.visible = - 1
     f.KopfKto.enabled = - 1
     f.FussKto.visible = - 1
     f.FussKto.enabled = - 1
 
     f.TextKopf.visible = - 1
     f.TextKopf.enabled = - 1
     f.TextFuss.visible = - 1
     f.TextFuss.enabled = - 1
   ELSE 
     f.KopfKto.visible = 0
     f.KopfKto.enabled = 0
     f.FussKto.visible = 0
     f.FussKto.enabled = 0
 
     f.TextKopf.visible = 0
     f.TextKopf.enabled = 0
     f.TextFuss.visible = 0
     f.TextFuss.enabled = 0
   END IF 
   REM 0843146451 grÑbner
   IF _projekt$ LIKE "IMMAK" THEN 
   ELSE 
     IF IIM.stamm = "j" THEN 
       f.iimdef.enabled = - 1
       f.iimdef.visible = - 1
     ELSE 
       f.iimdef.enabled = 0
       f.iimdef.visible = 0
     END IF 
     IF GAFSK$ LIKE "TRUE" THEN 
       f.uebprovtxt.enabled = - 1
       f.uebprovtxt.visible = - 1
       f.uebprov.enabled = - 1
       f.uebprov.visible = - 1
       f.afskpauschtxt.enabled = - 1
       f.afskpauschtxt.visible = - 1
       f.uebprovpausch.enabled = - 1
       f.uebprovpausch.visible = - 1
     ELSE 
       f.uebprovtxt.enabled = 0
       f.uebprovtxt.visible = 0
       f.uebprov.enabled = 0
       f.uebprov.visible = 0
       f.afskpauschtxt.enabled = 0
       f.afskpauschtxt.visible = 0
       f.uebprovpausch.enabled = 0
       f.uebprovpausch.visible = 0
     END IF 
   END IF 
   waehr$ = "WÑhrung: " + waehrung.stamm
   zweitwaehr$ = waehrung.stamm
   euro% = umrechnung.stamm
   ZWCodew% = codew.stamm
   IF oberfirma.stamm > 0 THEN 
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY oberfirma.stamm FILE "maadr" INDEX codema.maadr
     oberfirma$ = "oberste Ebene der Struktur: " + Nachname.maadr + "," + vorname.maadr
   END IF 
   FORM 
   CALL ClearKBDBuffer()
   IF _projekt$ LIKE "IMMAK" THEN 
   ELSE 
     IF letzteEUUmst.stamm <> "" THEN 
       f.euprot.visible = - 1
     ELSE 
       f.euprot.visible = 0
     END IF 
   END IF 
   afskuebprov$ = UebProvAG.stamm
   SET STATUS ""
   fseite% = PAGE 
   IF PAGE = 1 THEN 
     sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.stamm,",9999.0000"))
     st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.stamm,",9999.0000"))
   END IF 
   IF PAGE = 2 THEN 
     IF GELO% <> - 1 THEN 
       f.KDanE.visible = 0
       f.KDanE.enabled = 0
       f.VDanE.visible = 0
       f.VDanE.enabled = 0
       f.MDanE.visible = 0
       f.MDanE.enabled = 0
       f.GDanE.visible = 0
       f.GDanE.enabled = 0
     ELSE 
       f.KDanE.visible = - 1
       f.KDanE.enabled = - 1
       f.VDanE.visible = - 1
       f.VDanE.enabled = - 1
       f.MDanE.visible = - 1
       f.MDanE.enabled = - 1
       f.GDanE.visible = - 1
       f.GDanE.enabled = - 1
     END IF 
   END IF 
   IF PAGE = 4 THEN 
     sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.agdir,",9999.0000"))
     st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.agdir,",9999.0000"))
   END IF 
   ON ERROR GOTO w270120051
   IF GBVF$ LIKE "TRUE" THEN 
     f.fdate.visible = - 1
     f.fdate.enabled = - 1
     f.fdatetxt.visible = - 1
   ELSE 
     f.fdate.visible = 0
     f.fdate.enabled = 0
     f.fdatetxt.visible = 0
   END IF 
   XMLCSVExport$ = UCASE$ (ReadConfig$("PROVIS","XMLCSVExport"))
   XMLCSVExport$ = "TRUE"
   IF XMLCSVExport$ LIKE "TRUE" THEN 
     f.expxmlcsv.visible = - 1
     f.expxmlcsv.enabled = - 1
   ELSE 
     f.expxmlcsv.visible = 0
     f.expxmlcsv.enabled = 0
   END IF 
 
w270120051: 
   IF GintID% = 62 THEN 
     f.VMoldSuch.visible = 0
     f.VMoldSuch.enabled = 0
     f.BZwang0.visible = 0
     f.BZwang0.enabled = 0
     f.BZwang1.visible = 0
     f.BZwang1.enabled = 0
     f.IntVerw.visible = 0
     f.IntVerw.enabled = 0
     f.VertrArt.visible = 0
     f.VertrArt.enabled = 0
     f.nurEinh.visible = 0
     f.nurEinh.enabled = 0
     f.nurProv0.visible = 0
     f.nurProv0.enabled = 0
     f.nurProv1.visible = 0
     f.nurProv1.enabled = 0
   END IF 
   FORM 
   ON ERROR GOTO ErrorHandler
   SET STATUS sq$ + st$
   WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL SVPrev()
   CASE CrsRight%,PgDn%
     CALL SVNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   CALL ClearKBDBuffer()
   IF PAGE = 7 OR PAGE = 2 OR PAGE = 6 THEN 
     REM CALL Fehler("ACHTUNG: Es mÅssen zur DurchfÅhrung dieser Funktionen, alle anderen User das Programm verlassen haben!!!","")
     REM REQUEST "Haben alle anderen User das Programm verlassen?","",130,reqab%
     REM IF reqab% = 0 THEN SUPERVISsub% = 0
   END IF 
   ON ERROR GOTO ErrorHandler
   SELECT CASE SUPERVISsub%
   CASE 125
     _cuma% = GetCodeMA%(cuma%,Workstation%)
     IF _cuma% > 0 THEN 
       SELECT FIRST LOCK FILE "stamm"
       Oberfirma.stamm = _cuma%
       STORE FILE "stamm"
       SELECT FIRST FILE "maadr" INDEX codema.maadr
       SELECT KEY _cuma% FILE "maadr" INDEX codema.maadr
       oberfirma$ = "oberste Ebene der Struktur: " + Nachname.maadr + "," + vorname.maadr
     END IF 
   CASE 124
     REM Dokumente entschlÅsseln
     IF GDisDokSchu$ = "j" THEN 
       REM Dokumente entschlÅsseln
       CALL DokschuAlle(1)
     ELSE 
       CALL Fehler("Die Dokumente kînnen nicht entschlÅsselt werden, da Sie nicht die entsprechenden Berechtigungen besitzen!","")
     END IF 
   CASE 123
     REM Dokumente verschlÅsseln
     IF dokpass.stamm <> "" THEN 
       CALL DokschuAlle(0)
     ELSE 
       CALL Fehler("Es wurde in den Firmenstammdaten kein zentrales Passwort fÅr den Dokumentenschutz hinterlegt, deshalb kann diese Funktion nicht ausgefÅhrt werden!","")
     END IF 
   CASE 122
     REM Export in XML oder CSV Format
     
     m1$ = "!!!!!!!!!!!!!!!!  MACHEN SIE AUF JEDEM FALL VORHER EINE KOMPLEETE KOPIE DES CODIE-ORDNERS !!!!!!!!!!!!!!!!!!!!!!!!!!!!"
     CALL Fehler("Zum Export der Daten mÅssen énderungen in den Daten-Dateien vorgenommen werden, die nicht rÅckgÑngig gemacht werden kînnen! Wenn Sie den Export nur testen wollen, MöSSEN Sie den Export in einer Kopie von SmartPROVIS durchfÅhren!!!!",m1$)
     REQUEST "Haben Sie eine komplette Datensicherung durchgefÅhrt?","",135,reqab%
     IF reqab% <> 1 THEN 
       CALL Fehler("Der Export wird abgebrochen!!!!","Fertigen Sie bitte eine komplette Datensicherung des CODie-Ordners an!!!")
       GOTO e150720081
     END IF 
     IF oberfirma.stamm < 1 THEN 
       REM "oberste Ebene der Struktur: " + 
       CALL Fehler("Sie mÅssen vor dem Export erst noch die oberste Ebene der Struktur festlegen!(der Button Åber dem soeben gedrÅckten Export Button ), ","")
     ELSE 
       IF GDisDokSchu$ = "j" THEN 
         CALL Fehler("Zum exportieren aller Daten mÅssen die Dokumente entschlÅsselt werden!","")
         REQUEST "Soll der Dokumentenschutz jetzt aufgehoben werden?","",135,req%
         IF req% = 1 THEN 
           REM Dokumente entschlÅsseln
           CALL DokschuAlle(1)
         END IF 
       ELSE 
         CALL Fehler("Die Dokumente kînnen nicht entschlÅsselt werden, da Sie nicht die entsprechenden Berechtigungen besitzen!","")
       END IF 
       DIRECTORY _netpath$
       IF NOT PROGRAMFILE ("PExpXML") THEN LOAD "PExpXML.SBR", NEW 
       CALL ainhflen()
       OPEN FORM _netpath$ + "dummy2.sbv"
       WAIT FOR 2
       CALL Fehler("Das Programm mu· jetzt beendet werden, um alle geîffneten Dateien anzuschlie·en!","")
       CALL EXIT()
     END IF 
e150720081: 
   CASE 121
     IF NOT disabled%("FIRMADRAG1UMW") THEN 
       REM allen Adressen der betreuenden Agentur2 eine neu Agentur zuweisen 
       CALL Fehler("Sie haben jetzt die Mîglichkeit, allen Adressen der betreuenden Agentur 2 eine neue Adresse zuzuweisen!","Hierzu mÅssen Sie sich alleine im Programm befinden!")
       REQUEST "Wollen Sie jetzt diese Zuweisungen vornehmen?","",135,reqab%
       IF reqab% = 1 THEN 
         CALL ChangeMA("codema2")
       END IF 
     END IF 
   CASE 120
     IF NOT disabled%("FIRMADRAG2UMW") THEN 
       REM allen Adressen der betreuenden Agentur1 eine neu Agentur zuweisen
       CALL Fehler("Sie haben jetzt die Mîglichkeit, allen Adressen der betreuenden Agentur 1 eine neue Adresse zuzuweisen!","Hierzu mÅssen Sie sich alleine im Programm befinden!")
       REQUEST "Wollen Sie jetzt diese Zuweisungen vornehmen?","",135,reqab%
       IF reqab% = 1 THEN 
         CALL ChangeMA("codema")
       END IF 
     END IF 
   CASE 1
     CALL Fehler("ACHTUNG: Es mÅssen zur DurchfÅhrung dieser Funktionen, alle anderen User das Programm verlassen haben!!!","")
     REM REQUEST "Haben alle anderen User das Programm verlassen?","",130,reqab%
     reqab% = 1
     IF reqab% = 1 THEN 
       CALL Stamm2()
     END IF 
   CASE 2
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       BLANK FILE "STAMMHIS"
       a% = CopyRecord%("STAMM","STAMMHIS")
       codestamm.stammhis = SER ("STAMMHIS",1)
       STORE FILE "STAMMHIS"
       EinheitAusGeko% = EinheitAusGeko.stamm
       provverfold$ = provverf$
       SRRÅck$ = SRRÅck.stamm
       RealStorno% = RealStorno.stamm
       CourtNBold$ = CourtNB$
       ENTER 41,0
       ENTER END 
       GVertrArt$ = VertrArt.stamm
       GEinh% = 0
       IF nurEinh.stamm LIKE "j" THEN 
         GEinh% = - 1
       END IF 
       IF Verwaltung.config = - 1 OR ag$ LIKE "j" THEN 
         IF VertrArt.stamm = "j" THEN 
           CALL WriteConfig("PROVIS","FÑlligkeitsvorschau","TRUE")
           IF ag$ = "j" THEN 
             REM IntVerw.stamm = "j"
           ELSE 
             REM VertrArt.stamm = "n"
             REM CALL Fehler("Die Vertragsmasken mit kleiner FÑlligkeitsvorausschau sind nur fÅr die Agenturvariante aktivierbar!","")
           END IF 
         ELSE 
           CALL WriteConfig("PROVIS","FÑlligkeitsvorschau","FALSE")
         END IF 
       ELSE 
         IF VertrArt.stamm = "j" THEN 
           CALL Fehler("Die Vertragsmasken mit kleiner FÑlligkeitsvorausschau sind nur fÅr die Verwaltungs- und Agenturvariante aktivierbar!","")
           VertrArt.stamm = "n"
           CALL WriteConfig("PROVIS","FÑlligkeitsvorschau","FALSE")
         END IF 
       END IF 
       STORE FILE "stamm"
       IF ADRZwang.stamm = 1 THEN 
         GBerlimex% = - 1
       ELSE 
         GBerlimex% = 0
       END IF 
       IF Protall.stamm = 1 THEN 
         GZP% = - 1
       ELSE 
         GZP% = 0
       END IF 
       CALL SichConfig()
       REM ******************************************************************************************
       REM Testung, ob schwerwiegende énderungen in bei den Stammdaten gemacht wurden, die
       REM bewirken, da· sich das Programm kÅnfitig ander verhÑlt und deshalb eine
       REM Datensicherung erzwingen mÅssen
       sich% = 0
       f0$ = ""
       f1$ = ""
       f2$ = ""
       f3$ = ""
       f4$ = ""
       IF EinheitAusGeko% <> EinheitAusGeko.stamm THEN 
         sich% = - 1
         t0$ = "da jetzt u.U. auf der Provisionsliste andere Einheiten ausgewiesen werden als vormals!"
         t1$ = " Au·erdem bewirkt dies, da· vorherige Berechnungen evt. nicht mehr nachvollziehbar sind!"
         f0$ = "Sie haben den Parameter >>Einheiten aus der Kondition/Vertragsdatei fÅr die Provisionsliste verwenden<< geÑndert, dies hat fÅr kÅnftige und vormalige Abrechnungen erhebliche Auswirkungen, " + t0$ + t1$
       END IF 
       IF provverfold$ <> provverf$ THEN 
         f1$ = "Sie haben sich entschlossen das Provisionierungsverfahren umzustellen, dies hat erhebliche Auswirkungen auf kÅnftige Arbeitsweisen!"
         sich% = - 1
       END IF 
       IF SRRÅck$ <> SRRÅck.stamm THEN 
         f2$ = "Sie haben sich entschlossen, kÅnftig die Stornoreserve anders verrechnen zu lassen. Sie mÅssen jedoch bedenken, da· somit vorherige Berechnungen evt. nicht mehr nachvollziehbar sind!"
         sich% = - 1
       END IF 
       IF RealStorno% <> RealStorno.stamm THEN 
         t0$ = " Feldes >>FÑlligkeitsdatum<< in der Zahlunhseingangsmaske, Åber das man hier zusÑtzlich entscheidet, ob das Storno der vertragsabschlie·enden Agentur oder der Nachfolgeagentur angelastet wird!"
         t1$ = " Au·erdem bewirkt dies, da· vorherige Berechnungen evt. nicht mehr nachvollziehbar sind!"
         f3$ = "Sie haben sich entschlossen die negativen ZahlungseingÑnge fÅr gekÅndigte Agenturen grundsÑtzlich anders verarbeiten zu lassen, bitte beachten Sie hierfÅr auch die au·erordentliche Bedeutung des " + t0$ + t1$
         sich% = - 1
       END IF 
       IF CourtNBold$ <> CourtNB$ THEN 
         f4$ = "Sie haben den Parameter fÅr die Courtageberechnung geÑndert, dies hat fÅr kÅnftige und vormalige Abrechnungen erhebliche Auswirkungen, da somit vorherige Berechnungen evt. nicht mehr nachvollziehbar sind!"
         sich% = - 1
       END IF 
       IF sich% = - 1 THEN 
         CALL Fehler(f0$ + " " + f1$ + " " + f2$ + " " + f3$ + " " + f4$,"Aus diesem Grunde wird jetzt eine vollstÑndige Sicherung Ihrer Daten durchgefÅhrt!")
         CALL SichBackup()
         GOTO staanf0812200202
       END IF 
       REM ******************************************************************************************
 
       IF _projekt$ LIKE "IMMAK" THEN 
       ELSE 
         IF IIM.stamm = "j" THEN 
           f.iimdef.enabled = - 1
           f.iimdef.visible = - 1
         ELSE 
           f.iimdef.enabled = 0
           f.iimdef.visible = 0
         END IF 
       END IF 
       REQUEST "Daten wurden gesichert!"
     END IF 
   CASE 3
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       CALL SichConfig()
       REQUEST "Daten wurden gesichert!"
     END IF 
   CASE 4
     REM alle SRDauern der Vermittler auf -1 setzen
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       CALL SRMINUS1()
       REQUEST "Daten wurden gesichert!"
     END IF 
   CASE 5
     IF NOT disabled%("FIRMENSTAMMDIREK") THEN 
       ' Synchronisieren der Anzahl der Mitarbeter pro Direktion
       REQUEST "Einen Moment bitte, die Daten werden synchronisiert...!","",2
       MOUSE OFF 
       CALL DFile(3,"MAADR" + _fpw$)
       FILE "maadr"
       INDEX codeagdir.maadr
       SELECT FIRST 
       codeagdir% = codeagdir.maadr
       z% = RECCOUNT ("maadr")
       anz% = 0
       FOR i% = 1 TO z%
         IF codeagdir.maadr = codeagdir% THEN 
           anz% = anz% + 1
         ELSE 
           SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
           SELECT KEY codeagdir% LOCK FILE "AGDIR" INDEX codeAGDIR.AGDIR
           AnzahlAGs.agdir = anz%
           CALL QuickStore("agdir")
           anz% = 1
           codeagdir% = codeagdir.maadr
         END IF 
         SELECT NEXT FILE "maadr" INDEX codeagdir.maadr
       NEXT i%
       SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
       SELECT KEY codeagdir% LOCK FILE "AGDIR" INDEX codeAGDIR.AGDIR
       AnzahlAGs.agdir = anz%
       CALL QuickStore("agdir")
       FILE "agdir"
       SELECT FORM FIRST FILE "agdir" INDEX codeagdir.agdir
       MOUSE ON 
       FORM 3
     END IF 
   CASE 6
     CodeAGDIR% = CodeAGDir.AGDIR
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       GDirektion$ = direktion.agdir
       SELECT FORM FIRST FILE "agdir" INDEX codeagdir.agdir
       SELECT FORM KEY codeagdir% FILE "agdir" INDEX codeagdir.agdir
       FORM 4
     END IF 
   CASE 7
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       IF Direktion.agdir LIKE "<ohne Zuo*" THEN 
         CALL Fehler ("Sie kînne die Direktion <ohne Zuordnung> nicht Ñndern!","")
       ELSE 
         ENTER direktion.agdir,0
         ENTER END 
       END IF 
     END IF 
   CASE 8
     REM neue Direktion
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       FILE "AGDIR"
       INDEX nummer.agdir
       SELECT LAST 
       nr% = nummer.agdir
       BLANK FILE "AGDIR"
       codeagdir% = SER ("agdir",0)
       codeagdir.agdir = codeagdir%
       direktion.agdir = "NEU"
       nummer.agdir = nr% + 1
       AGIteration.agdir = 1
       CALL QuickStore("agdir")
       SELECT FIRST FILE "agdir"
       GDirektion$ = direktion.agdir
       SELECT FORM FIRST FILE "agdir" INDEX codeagdir.agdir
       SELECT FORM KEY codeagdir% FILE "agdir" INDEX codeagdir.agdir
       FORM 4
       ENTER direktion.agdir,0
       ENTER END 
     END IF 
   CASE 9
     SELECT FORM FIRST FILE "agdir" INDEX codeagdir.agdir
     FORM 3
   CASE 10
      REM Einheiten bei allen Agenturen eintragen
      IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
        REQUEST "Wollen Sie die Einheiten pro DM eintragen lassen?","",130,req1%
        IF req1% = 1 THEN 
          CALL DFile(3,"gekond" + _fpw$)
          FILE "gekond"
          IF RECCOUNT ("gekond") > 0 THEN 
            SELECT FIRST LOCK 
          ELSE 
            SELECT LAST 
          END IF 
          j% = RECCOUNT ("gekond")
          akver1% = 1
          CREATE DIALOG "ANPASSUNG",0,0,177,124,"Anpassung","MS Sans Serif",8
          ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Anpassung aller Einheiten:"
          ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, auf welchen Wert die"
          ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"Einheiten angepa·t werden soll."
          ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
          ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Einh./DM:"
 
          ADD DIALOG "ANPASSUNG",3,6,70,164,11,0,"nur Wert Åbernehmen",0,akver1%
          ADD DIALOG "ANPASSUNG",3,6,82,164,11,0,"Prozente(AP od. Court.)*Wert/100",1,akver1%
 
          ADD DIALOG "ANPASSUNG",1,34,100,50,16,1,"&OK",1,1
          ADD DIALOG "ANPASSUNG",1,86,100,50,16,0,"&Abbruch",0,0
          DIALOG "ANPASSUNG",req%
          REMOVE DIALOG "ANPASSUNG"
          anp% = VAL (anp$)
          anp$ = STR$ (anp%)
          i% = 0
          IF req% = 1 THEN 
            MOUSE OFF 
            IF akver1% = 0 THEN 
              WHILE NOT EOF ("gekond")
                i% = i% + 1
                DMEinheit.gekond = anp%
                STORE FILE "gekond"
                UNLOCK CURRENT FILE "gekond"
                UNLOCK FILE "gekond"
                SELECT NEXT LOCK FILE "gekond"
                SET STATUS STR$ (i%,"999999") + " DatensÑtze angepa·t von " + STR$ (j%,"999999")
              WEND 
            ELSE 
              WHILE NOT EOF ("gekond")
                i% = i% + 1
                IF apjn.gekond = "j" AND ap.gekond > 0 THEN 
                  DMEinheit.gekond = anp% * ap.gekond / 100
                  STORE FILE "gekond"
                  UNLOCK CURRENT FILE "gekond"
                  UNLOCK FILE "gekond"
                ELSE 
                  IF courtagejn.gekond = "j" AND courtage.gekond > 0 THEN 
                    DMEinheit.gekond = anp% * courtage.gekond / 100
                    STORE FILE "gekond"
                    UNLOCK CURRENT FILE "gekond"
                    UNLOCK FILE "gekond"
                  END IF 
                END IF 
                SELECT NEXT LOCK FILE "gekond"
                SET STATUS STR$ (i%,"999999") + " DatensÑtze angepa·t von " + STR$ (j%,"999999")
              WEND 
            END IF 
            MOUSE ON 
            REQUEST "Anpassung wurde beendet!"
          END IF 
        END IF 
      END IF 
   CASE 11
     REM WÑhrung Stamm
     IF MOD ("stamm") THEN 
       STORE FILE "stamm"
       UNLOCK CURRENT FILE "stamm"
     END IF 
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       CALL WaehrStamm()
     END IF 
     FORM 
   CASE 12
      IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
        BLANK FILE "STAMMHIS"
        a% = CopyRecord%("STAMM","STAMMHIS")
        codestamm.stammhis = SER ("STAMMHIS",1)
        STORE FILE "STAMMHIS"
        IF PAGE = 1 THEN 
          f.abbr.visible = - 1
          ENTER Firma1.STAMM,0
          ENTER END 
          IF MOD ("STAMM") THEN STORE FILE "STAMM"
          UNLOCK CURRENT FILE "stamm"
        END IF 
        IF PAGE = 6 THEN 
          f.abbr6.visible = - 1
          f.bearb6.visible = 0
          f.speich6.visible = - 1
          f.ende6.visible = 0
          f.euwaehr.visible = 0
          f.eustart.visible = 0
          ENTER EUBWSum.STAMM,0
          f.abbr6.visible = 0
          f.bearb6.visible = - 1
          f.speich6.visible = 0
          f.ende6.visible = - 1
          f.euwaehr.visible = - 1
          f.eustart.visible = - 1
          ENTER END 
          IF MOD ("STAMM") THEN STORE FILE "STAMM"
          UNLOCK CURRENT FILE "stamm"
        END IF 
        IF PAGE = 8 THEN 
          f.abbr6.visible = - 1
          f.bearb6.visible = 0
          f.speich6.visible = 0
          f.zur8.visible = 0
          f.konf8.visible = 0
          ENTER emailshost.stamm,0
          f.abbr6.visible = 0
          f.bearb6.visible = - 1
          f.speich6.visible = - 1
          f.zur8.visible = - 1
          f.konf8.visible = - 1
          ENTER END 
          GEMAIL% = EMAILJN.stamm
          IF GEMAIL% = - 1 THEN 
            GEMAILJNAuto% = EMAILJNAuto.stamm
            SELECT KEY GMACodeMA% FILE "Supervis" INDEX codema.supervis
            IF GEMAILJNAuto% = - 1 THEN 
              GEMAILJNAuto% = EMAILJNAuto.supervis
            END IF 
          END IF 
 
        END IF 
      END IF 
   CASE 13
      CALL FStore("STAMM"):f.abbr.visible = 0
   CASE 14
     REM Wettbewerb
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       FORM 5
     END IF 
   CASE 15
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       CALL RÅcksetzMAADR()
     END IF 
   CASE 16
     REM Euroumstellung
     IF NOT disabled%("FIRMENSTAMMEURO") THEN 
       euwaehr$ = "nur VertrÑge mit folgender WÑhrung umrechnen: " + euwaehr.stamm
       FORM 6
     END IF 
   CASE 17
     REM WÑhrungsauswahl fÅr Euroumstellung
     CALL WaehrStammEU()
   CASE 18
     REM Euroumstellung durchfÅhren
     REQUEST "Mîchten Sie die Euroumstellung jetzt durchfÅhren lassen?","",135,req%
     IF req% = 1 THEN 
       CALL EuroUmst()
     END IF 
   CASE 19
     CALL ShowLogEU()
   CASE 20
     REM Fremdeinheiten aller MA auf Null setzen
     CALL DFile(3,"Kgeadr" + _fpw$)
     CALL DFile(2,"OFFICE\dokma" + _fpw$)
     CALL DFile(3,"gekond" + _fpw$)
     CALL DFile(3,"maadr" + _fpw$)
     CALL DFile(3,"maadrgru" + _fpw$)
     CALL DFile(3,"vkond" + _fpw$)
     CALL DFile(3,"vprodukt" + _fpw$)
     CALL DFile(3,"AGDIR" + _fpw$)
     CALL DFile(3,"AUMSKTO" + _fpw$)
     CALL DFile(3,"MAAUSZ" + _fpw$)
     CALL DFile(3,"FOERKOND" + _fpw$)
     MOUSE OFF 
     CALL Fehler("Es werden jetzt die Fremdeinheiten aller Mitarbeiter auf 0 gesetzt, d.h. im Feld Einheiten des Mitarbeiters werden nur noch die Eigeneinheiten gefÅhrt!","")
     REQUEST "Wollen Sie jetzt diese Operation durchfÅhren lassen?","",135,req%
     IF req% = 1 THEN 
       UPDATE Einheiten.maadr = EigEinheiten.maadr WHERE codema.maadr > - 1
       END UPDATE 
       CLOSE FILE "maadr"
       CALL DFile(3,"maadr" + _fpw$)
     END IF 
     MOUSE ON 
   CASE 21
     REM IIM-Definitionen
     IF NOT disabled%("IIMDEFINITION") THEN 
       CALL IIMDefinition()
     END IF 
   CASE 22
     REM Automatikfunktionen Stammdaten
     IF NOT disabled%("STAMMAUTOMAT") THEN 
       CALL Fehler("ACHTUNG: Es mÅssen zur DurchfÅhrung dieser Funktionen, alle anderen User das Programm verlassen haben!!!","")
       IF MNdisabled%("VERTRBEARB") OR MNdisabled%("VERTRAGMASSECHANGE") THEN 
         f.massenaend.enabled = 0
       ELSE 
         f.massenaend.enabled = - 1
       END IF 
       FORM 7
     END IF 
   CASE 23
     REM automatische Sollstellung
     IF GSoll$ = "j" THEN 
       IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         IF GAFSK$ LIKE "TRUE" THEN 
           CALL Fehler("Diese Funktion darf bei Ihnen nicht benutzt werden!","")
         ELSE 
           CALL AutomatSoll()
         END IF 
       ELSE 
         CALL Fehler("Diese Funktion steht nur unter REALCash zur VerfÅgung!","")
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion kînnen Sie nur ausfÅhren, wenn Sie das RealCash-Sollstellungsmodul erworben haben!","")
     END IF 
   CASE 24
     REM automatische Sollstellung rÅckgÑngig
     IF GSoll$ = "j" THEN 
       IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         IF GAFSK$ LIKE "TRUE" THEN 
           CALL Fehler("Diese Funktion steht darf bei Ihnen nicht benutzt werden!","")
         ELSE 
           IF NOT disabled%("SOLLSTELLUNGRUECK") THEN 
             CALL AutomSollEnd()
           END IF 
         END IF 
       ELSE 
         CALL Fehler("Diese Funktion steht nur unter REALCash zur VerfÅgung!","")
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion kînnen Sie nur ausfÅhren, wenn Sie das RealCash-Sollstellungsmodul erworben haben!","")
     END IF 
   CASE 25
     REM CalcEuro / Einheit in EUR / Einh Åbernehmen
     MOUSE OFF 
     CALL DFile(3,"GEKOND" + _fpw$)
     CALL DFile(3,"GEKONDM" + _fpw$)
     FILE "gekond"
     UPDATE DMEinheit.gekond = EuroEinheit.gekond
     END UPDATE 
     CLOSE FILE "gekond"
     CALL DFile(3,"gekond" + _fpw$)
     FILE "gekondm"
     UPDATE DMEinheit.gekondm = EuroEinheit.gekondm
     END UPDATE 
     CLOSE FILE "gekondm"
     CALL DFile(3,"gekondm" + _fpw$)
     MOUSE ON 
   CASE 26
     REM AFSK öberprovision
         CALL DFile(3,"maadr" + _fpw$)
         wks1% = Workstation%
         ma% = GetCodeMA%(ma%,Wks1%)
         MOUSE OFF 
         IF ma% > 0 THEN 
           betr$ = ""
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY ma% FILE "maadr" INDEX codema.maadr
           betr$ = LEFT$ ( LTRIM$ (Nachname.maadr) + "," + LTRIM$ (Vorname.maadr),61)
           SELECT FIRST LOCK FILE "STAMM"
           UebProvAG.stamm = betr$
           CodeMAUebProv.stamm = ma%
           STORE FILE "stamm"
           MOUSE OFF 
         ELSE 
           REQUEST "Es wurde kein Betreuer ausgewÑhlt!","Soll <ohne Zuordnung> eingetragen werden?",130,req%
           IF req% = 1 THEN 
             MOUSE OFF 
             SELECT FIRST LOCK FILE "STAMM"
             UebProvAG.stamm = "<ohne Zuordnung>"
             CodeMAUebProv.stamm = 0
             STORE FILE "stamm"
             MOUSE OFF 
           END IF 
         END IF 
         afskuebprov$ = UebProvAG.stamm
         FORM 
   CASE 27
     IF NOT disabled%("REORGANISATION") THEN 
       CALL ReorgDB1()
     END IF 

   CASE 50
     REQUEST "Wollen Sie wirklich die Produktformeln aller Produkte","fÅr die Berechnung der Bewertungssume anpassen lassen?",130,req%
     IF req% = 1 THEN 
       CALL SichBackup()
       FORM 7
anpbw270420031: 
       CREATE DIALOG "ANPASSUNG",0,0,177,94,"Anpassung","MS Sans Serif",8
       ADD DIALOG "ANPASSUNG",5,6,6,166,10,0,"Produktformeln aller Produkte:"
       ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie den Anpassungswert ein,"
       ADD DIALOG "ANPASSUNG",5,6,30,166,8,0,"der in die Formeln eingetragen werden soll."
       ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,10
       ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Wert:"
       ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
       ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
       DIALOG "ANPASSUNG",dreq%
       REMOVE DIALOG "ANPASSUNG"
       anp% = VAL (anp$)
       REM anp$ = STR$ (anp%)
       anp$ = LTRIM$ (anp$)
       ok% = - 1
       FOR i% = 1 TO LEN (anp$)
         a$ = MID$ (anp$,i%,1)
         SELECT CASE a$
           CASE "0","1","2","3","4","5","6","7","8","9",","
           CASE ELSE 
             ok% = 0
         END SELECT 
       NEXT i%
       IF ok% = 0 AND dreq% = 1 THEN 
         CALL Fehler("Sie haben bei der Eingabe des Wertes einen Fehler gemacht!","Es sind nur die Ziffern 0 - 9und das Komma als Zeichen erlaubt!")
         GOTO anpbw270420031
       END IF 
       IF dreq% = 1 AND anp% <> 0 THEN 
         CALL DFile(3,"VProdukt" + _fpw$)
         cfile$ = FILE 
         FILE "VPRODUKT"
         INDEX codevp.vprodukt
         IF RECCOUNT ("vprodukt") > 0 THEN 
           SELECT FIRST LOCK 
         ELSE 
           SELECT LAST 
         END IF 
         i% = 0
         k% = 0
         j% = RECCOUNT ("vprodukt")
         WHILE NOT EOF ("VPRODUKT")
           i% = i% + 1
           SET STATUS STR$ (i%) + " DatensÑtze von " + STR$ (j%) + " angepasst"
           IF LTRIM$ (FormelBewertung.vprodukt) <> "" THEN 
             k% = k% + 1
             FormelBewertOld.vprodukt = FormelBewertung.vprodukt
             FBWénd.vprodukt = TODAY 
             f$ = "(" + FormelBewertung.vprodukt + ") *" + anp$
             FormelBewertung.vprodukt = f$
             REM CALL QuickStore("Vprodukt")
             CALL MATimeStamp("VPRODUKT")
             codevp% = codevp.vprodukt
             QCodeGEVA.vprodukt = STR$ (CodeGE.vprodukt,"000000") + STR$ (Codeva.vprodukt,"000000")
             QCodeGEVA$ = QCodeGEVA.vprodukt
             GesSpa.Vprodukt = Gesellschaft.vprodukt + Sparte.vprodukt
             CALL VFormelAusw()
             STORE FILE "VPRODUKT"
           END IF 
           SELECT NEXT LOCK FILE "Vprodukt"
         WEND 
         CALL Fehler("Es wurden " + LTRIM$ ( STR$ (k%,",999999")) + " Produkte angepasst von " + LTRIM$ ( STR$ (j%,",999999")),"")
       END IF 
     END IF 
   CASE 99
      IF NOT disabled%("FIRMENSTAMMWETT") THEN 
        ENTER Firma1.STAMM,0
        ENTER END 
      END IF 
   CASE 100
     REM Konfiguration bei allen MA eintragen
     REQUEST "Wollen Sie wirklich die EMAIL-Angaben","bei allen Mitarbeitern eintragen lassen",135,req%
     IF req% = 1 THEN 
       FILE "supervis"
       INDEX codema.supervis
       SELECT FIRST LOCK 
       WHILE NOT EOF ("Supervis")
         IF emailshost.stamm <> "" THEN emailshost.supervis = emailshost.stamm
         IF emailsport.stamm > 0 THEN emailsport.supervis = emailsport.stamm
         IF emailsUserID.stamm <> "" THEN emailsUserID.supervis = emailsUserId.stamm
         IF emailsAFirma.stamm <> "" THEN emailsAFirma.supervis = emailsAFirma.stamm

         IF emailphost.stamm <> "" THEN emailphost.supervis = emailphost.stamm
         IF emailpport.stamm > 0 THEN emailpport.supervis = emailpport.stamm
         IF emailPUserID.stamm <> "" THEN emailPUserID.supervis = emailPUserId.stamm
         IF emailPPasww.stamm <> "" THEN emailPPasww.supervis = emailPPasww.stamm
         EMAILPOP3JN.supervis = EMAILPOP3JN.stamm
         CALL QuickStore("supervis")
         SELECT NEXT LOCK FILE "supervis" INDEX codema.supervis
       WEND 
       REQUEST "Die Angaben wurden Åbernommen!",""
     END IF 
   CASE 101
     REM zur Agentur springen
     CodeAGDIR% = CodeAGDir.AGDIR
     GDirektion$ = direktion.agdir
     DIRECTORY _ppath$
     cuma% = codema.maadr
     CALL MAADR()
     OPEN FORM GPrjForm$ + "STAMM"
     SET f = Superbase.Form
     SET STATUS "Firmen-Stammdatenverwaltung"
     CALL MNSTAMM()
     MENU ON 
     IF NOT disabled%("FIRMENSTAMMEDIT") THEN 
       SELECT FORM FIRST FILE "agdir" INDEX codeagdir.agdir
       SELECT FORM KEY codeagdir% FILE "agdir" INDEX codeagdir.agdir
       FORM 4
     END IF 
   CASE 102
     REM VermittlerÅbersicht Direktion
     CALL MAADRLIST1()
   CASE 103
     CALL Fehler("ACHTUNG: Es mÅssen zur DurchfÅhrung dieser Funktionen, alle anderen User das Programm verlassen haben!!!","")
     REM BWVon bei allen Vermittlernkonditionen, die nicht abgeschlossen sind auf ein 
     REM bestimmtes Datum setzen
     CALL DFile(3,"GEKOND" + _fpw$)
     CALL DFile(3,"MAADR" + _fpw$)
     CalcDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
anfbw18092003: 
     CREATE DIALOG "STICHTAG",0,0,222,114,"neues BWVon-Datum","MS Sans Serif",8
     ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
     ADD DIALOG "STICHTAG",9,6,9,23,24,2
     ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Geben Sie hier das neue BWVon-Datum ein,"
     ADD DIALOG "STICHTAG",5,31,25,183,30,0,"das bei allen nicht abgeschlossenen Konditionen aller Vermittler eingetragen werden soll:"
     ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,CalcDate$,10
     ADD DIALOG "STICHTAG",5,30,74,58,10,0,"BWvon-Datum:"
     ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
     ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
     DIALOG "STICHTAG",req%
     REMOVE DIALOG "STICHTAG"
     IF req% = 1 THEN 
       IF DateOK%(CalcDate$) THEN 
         ok% = 1
         CalcDate% = DAYS (CalcDate$)
         CALL Fehler("Es wird jetzt bei allen nicht abgeschlossenen Konditionen ALLER Vermittler","das BWVon-Datum auf den " + CalcDate$ + " gesetzt!")
         REQUEST "Soll das BWVon-Datum wirklich gesetzt werden?","",135,req%
         IF req% = 1 THEN 
           REQUEST "Bitte etwas Geduld, die Operation wird gestartet","",2
           MOUSE OFF 
           FILE "GEKOND"
           UPDATE bwvon.gekond = CalcDate% WHERE bwbis.gekond < 1
           END UPDATE 
           CLOSE FILE "gekond"
           CALL DFile(3,"gekond" + _fpw$)
           MOUSE ON 
           CALL Fehler("Das BWVon-Datum aller nicht abgeschlossenen Konditionen aller Mitarbeiter wurde auf den " + CalcDate$ + " gesetzt!","")
         ELSE 
           CALL Fehler("Funktion BWVon Datum wurde abgebrochen!","")
         END IF 
       ELSE 
         ok% = 0
         CALL Fehler("Falsche Datumsangabe!","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
         GOTO anfbw18092003
       END IF 
     ELSE 
       CALL Fehler("Funktion BWVon Datum wurde abgebrochen!","")
     END IF 
   CASE 110
     REM Kundendokumente an ELO 26092003
     REQUEST "Sollen Dokumente, die bereits an ELO Åbergeben wurden?","erneut Åbergeben werden?",130,req%
     GDokDat$ = "DOKUMENT"
     CALL DFile(2,"OFFICE\ADRESSEN" + _fpw$)
     CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
       DELETE GMACodeDir$ + "ELOSend.ini"
     END IF 
     i% = 0
     k% = 0
     j% = RECCOUNT (GDokDat$)
     REDIM DokUeberg%(j%)
     SELECT FIRST LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WHILE NOT EOF (GDokDat$)
       i% = i% + 1
       lw$ = LEFT$ (_netpath$,2)
       datname$ = lw$ + Dateiname.GDokDat$
       IF EXISTS (datname$) THEN 
         IF ELOTrans.GDokDat$ <> 1 OR req% = 1 THEN 
           k% = k% + 1
           auto% = - 1
           REM CALL ADRDokSendELO(codedokGDokDat$,codeku.GDOkDat$,auto%)
           codeku% = Codeku.GDokDat$
           codedok% = Codedok.GDokDat$
           ansionoff$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))
           SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
           SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
           Typ$ = "K"
           REM IF ansionoff$ = "ON" THEN 
           Kunr$ = FN ansi(Kundennummer.GADRDat$)
           codedok$ = STR$ (CodeDok.GDokDat$,"000000")
           nname$ = FN ansi(Nachname.GADRDat$)
           vname$ = FN ansi(Vorname.GADRDat$)
           dokument$ = FN ansi(Dokument.GDokDat$)
           pfad$ = LEFT$ (_netpath$,2) + dateiname.GDokDat$
           erstelnr$ = STR$ (codema.GDokDat$,"000000")
           creator$ = FN ansi(Creator.GDokDat$)
           creatdat$ = DATE$ (erstellt_am.GDokDat$,"0dmmyyyy")
           DokTyp$ = FN ansi(Gruppe.GDokDat$)
           spgru$ = ""
           spar$ = ""
           anzblktxt$ = FN ansi("AnzahlDerBlîcke")
           ruecktxt$ = FN ansi("RÅckgabedateiname")
           REM WriteINIDes(topic$,item$,value$,datei$)
           REM IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
           anz$ = LTRIM$ ( STR$ (k%,"99999999"))
           block$ = "ELO-" + LTRIM$ ( STR$ (k%,"99999999"))
           CALL WriteINIDes("ELO",anzblktxt$,anz$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Art","K",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"KundenNr",Kunr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Nachname",nname$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"VertragsNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Gesellschaftsname","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"AgenturNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Agenturname","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Spartengruppe","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes(block$,"Sparte","",GMACodeDir$ + "ELOSend.ini")
           DokUeberg%(k%) = codedok%
         END IF 
       END IF 
       SET STATUS STR$ (i%) + " Dokumente geprÅft, an ELO Åbergeben: " + STR$ (k%) + " von gesamt: " + STR$ (j%)
       SELECT NEXT LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WEND 
     REM ***************************************************************************************************
     REM CALL Fehler("","")
     REM jetzt, da die ini-Datei alle Werte enthÑlt, die öbergabe an ELO auslîsen
     IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN DELETE GMACodeDir$ + "ELOerg.ini"
     a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     i% = 0
     ret% = - 1
     WHILE ret% = - 1
       IF NOT EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
         i% = i% + 1
         WAIT FOR 1
         IF i% > 15 THEN 
           CALL Fehler("Anscheinend kann keine Verbindung zu ELO hergestellt werden!","")
           REQUEST "Anscheinend kann keine Verbindung zu ELO hergestellt werden!","Wollen Sie weiter warten?",130,reqw%
           IF reqw% = 1 THEN 
             i% = 0
           ELSE 
             ret% = 1
           END IF 
         END IF 
       ELSE 
         ret% = 0
       END IF 
     WEND 
     IF ret% <> 0 THEN 
       IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN 
         a$ = ReadDesti$("ELO","RÅckgabewert0",GMACodeDir$ + "ELOerg.ini")
         b$ = ReadDesti$("ELO","RÅckgabetext0",GMACodeDir$ + "ELOerg.ini")
         CALL Fehler("Es wurde ein Fehler bei der ELO-Operation festgestellt:","RÅckgabewert0: " + a$ + "   RÅckgabetext0: " + b$)
       END IF 
     END IF 
     IF ret% = 0 THEN 
       FOR i% = 0 TO k%
         codedok% = DokUeberg%(i%)
         GMAName$ = LEFT$ (name.supervis,50)
         GMACodeMA% = CodeMA.supervis
         SELECT KEY codedok% LOCK FILE GDokDat$ INDEX codedok.GDokDat$
         ELOTrans.GDokDat$ = 1
         ELODatum.GDokDat$ = TODAY 
         ELOMA.GDokDat$ = GMACodeMA%
         ELOMAName.GDokDat$ = GMAName$
         CALL QuickStore(GDokDat$)
       NEXT i%
       CALL Fehler( STR$ (i%,",999999") + " Dokumente wurden an ELO Åbergeben","RÅckgabewert vom ERZEUGEN:" + LTRIM$ ( STR$ (ret%)))
     ELSE 
       CALL Fehler("RÅckgabewert vom ERZEUGEN: " + LTRIM$ ( STR$ (ret%)),"")
     END IF 
   CASE 111
     REQUEST "Sollen Dokumente, die bereits an ELO Åbergeben wurden?","erneut Åbergeben werden?",130,req%
     REM Vertragsdokumente an ELO 
     REM Kundendokumente an ELO 26092003
     GDokDat$ = "DOKKV"
     CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
     FILE GDokDat$
     INDEX codeku.GDokDat$
     CALL DFile(2,"OFFICE\ADRESSEN" + _fpw$)
     CALL DFile(3,"kvertrag" + _fpw$)
     CALL DFile(3,"geadr" + _fpw$)
     CALL DFile(3,"maadr" + _fpw$)
     CALL DFile(3,"sparten" + _fpw$)
     CALL DFile(3,"spgruppe" + _fpw$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
       DELETE GMACodeDir$ + "ELOSend.ini"
     END IF 
     i% = 0
     k% = 0
     j% = RECCOUNT (GDokDat$)
     REDIM DokUeberg%(j%)
     SELECT FIRST LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WHILE NOT EOF (GDokDat$)
       i% = i% + 1
       lw$ = LEFT$ (_netpath$,2)
       datname$ = lw$ + Dateiname.GDokDat$
       IF EXISTS (datname$) THEN 
         IF ELOTrans.GDokDat$ <> 1 OR req% = 1 THEN 
           k% = k% + 1
           auto% = - 1
           REM CALL ADRDokSendELO(codedokGDokDat$,codeku.GDOkDat$,auto%)
           
           codedok% = Codedok.GDokDat$
           SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
           codevt% = codeku.GDokDat$

           SELECT KEY codevt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
           codeku% = codeku.kvertrag
           SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
           codege% = codege.kvertrag
           SELECT KEY codege% FILE "GEADR" INDEX codege.geadr
           codema% = codema.kvertrag
           SELECT KEY codema% FILE "MAADR" INDEX codema.maadr
           codegrsp% = codegrsp.kvertrag
           SELECT KEY codegrsp% FILE "SPGRUPPE" INDEX codegrsp.SPGRUPPE
           codeva% = codeva.kvertrag
           SELECT KEY codeva% FILE "Sparten" INDEX codeva.sparten
           Typ$ = "V"
           REM IF ansionoff$ = "ON" THEN 
           IF vs_nr.kvertrag <> "" THEN 
             vsnr$ = vs_nr.kvertrag
           ELSE 
             vsnr$ = AntragsNr.kvertrag
           END IF 
           spgruppe$ = FN ansi(gruppe.spgruppe)
           sparte$ = FN ansi(sparte.sparten)
           AGnr$ = FN ansi(Agenturnr.MAADR)
           Aname$ = ""
           IF firmaname.maadr <> "" THEN 
             Aname$ = FN ansi(firmaname.maadr) + ", " + FN ansi(Nachname.MAADR)
           ELSE 
             Aname$ = FN ansi(Nachname.MAADR)
           END IF 
     
           IF vorname.maadr <> "" THEN 
              Aname$ = Aname$ + ", " + FN ansi(Vorname.MAADR)
           END IF 
           codedok$ = STR$ (CodeDok.DOKKV,"000000")
           gnname$ = ""
           IF gesellschaft2.geadr <> "" THEN 
             gnname$ = FN ansi(gesellschaft.geadr) + ", " + FN ansi(gesellschaft2.geADR)
           ELSE 
             gnname$ = FN ansi(gesellschaft.geadr)
           END IF 
           dokument$ = FN ansi(Dokument.DOKKV)
           pfad$ = LEFT$ (_netpath$,2) + dateiname.DOKKV
           erstelnr$ = STR$ (codema.DOKKV,"000000")
           creator$ = FN ansi(Creator.DOKKV)
           creatdat$ = DATE$ (erstellt_am.DOKKV,"0dmmyyyy")
           DokTyp$ = FN ansi(Gruppe.DOKKV)
           spgru$ = ""
           spar$ = ""
           anzblktxt$ = FN ansi("AnzahlDerBlîcke")
           ruecktxt$ = FN ansi("RÅckgabedateiname")
           REM WriteINIDes(topic$,item$,value$,datei$)
           IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
           CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Art","V",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","KundenNr",Kunr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","nachname",nname$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","VertragsNr",vsnr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Gesellschaftsname",Gnname$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","AgenturNr",AGnr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Agenturname",AName$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Spartengruppe",spgruppe$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Sparte",sparte$,GMACodeDir$ + "ELOSend.ini")

           DokUeberg%(k%) = codedok%
         END IF 
       END IF 
       SET STATUS STR$ (i%) + " Dokumente geprÅft, an ELO Åbergeben: " + STR$ (j%) + " von gesamt: " + STR$ (k%)
       SELECT NEXT LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WEND 
     REM ***************************************************************************************************
     REM CALL Fehler("","")
     REM jetzt, da die ini-Datei alle Werte enthÑlt, die öbergabe an ELO auslîsen
     IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN DELETE GMACodeDir$ + "ELOerg.ini"
     a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     i% = 0
     ret% = - 1
     WHILE ret% = - 1
       IF NOT EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
         i% = i% + 1
         WAIT FOR 1
         IF i% > 15 THEN 
           CALL Fehler("Anscheinend kann keine Verbindung zu ELO hergestellt werden!","")
           REQUEST "Anscheinend kann keine Verbindung zu ELO hergestellt werden!","Wollen Sie weiter warten?",130,reqw%
           IF reqw% = 1 THEN 
             i% = 0
           ELSE 
             ret% = 1
           END IF 
         END IF 
       ELSE 
         ret% = 0
       END IF 
     WEND 
     IF ret% <> 0 THEN 
       IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN 
         a$ = ReadDesti$("ELO","RÅckgabewert0",GMACodeDir$ + "ELOerg.ini")
         b$ = ReadDesti$("ELO","RÅckgabetext0",GMACodeDir$ + "ELOerg.ini")
         CALL Fehler("Es wurde ein Fehler bei der ELO-Operation festgestellt:","RÅckgabewert0: " + a$ + "   RÅckgabetext0: " + b$)
       END IF 
     END IF 
     IF ret% = 0 THEN 
       FOR i% = 0 TO k%
         codedok% = DokUeberg%(i%)
         GMAName$ = LEFT$ (name.supervis,50)
         GMACodeMA% = CodeMA.supervis
         SELECT KEY codedok% LOCK FILE GDokDat$ INDEX codedok.GDokDat$
         ELOTrans.GDokDat$ = 1
         ELODatum.GDokDat$ = TODAY 
         ELOMA.GDokDat$ = GMACodeMA%
         ELOMAName.GDokDat$ = GMAName$
         CALL QuickStore(GDokDat$)
       NEXT i%
       CALL Fehler( STR$ (i%,",999999") + " Dokumente wurden an ELO Åbergeben","RÅckgabewert vom ERZEUGEN:" + LTRIM$ ( STR$ (ret%)))
     ELSE 
       CALL Fehler("RÅckgabewert vom ERZEUGEN: " + LTRIM$ ( STR$ (ret%)),"")
     END IF 
   CASE 112
     REQUEST "Sollen Dokumente, die bereits an ELO Åbergeben wurden?","erneut Åbergeben werden?",130,req%
     REM Mitarbeiterdokumente an ELO 
     REM Kundendokumente an ELO 26092003
     GDokDat$ = "DOKMA"
     CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
     CALL DFile(3,"maadr" + _fpw$)
     FILE "maadr"
     INDEX codema.maadr
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
       DELETE GMACodeDir$ + "ELOSend.ini"
     END IF 
     FILE "DOKMA"
     INDEX codeku.GDokDat$
     i% = 0
     k% = 0
     j% = RECCOUNT (GDokDat$)
     REDIM DokUeberg%(j%)
     SELECT FIRST LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WHILE NOT EOF (GDokDat$)
       i% = i% + 1
       lw$ = LEFT$ (_netpath$,2)
       datname$ = lw$ + Dateiname.GDokDat$
       IF EXISTS (datname$) THEN 
         IF ELOTrans.GDokDat$ <> 1 OR req% = 1 THEN 
           k% = k% + 1
           auto% = - 1
           codedok% = codedok.GDokDat$
           codema% = codeku.GDokDat$

           SELECT KEY codema% FILE "MAADR" INDEX codema.MAADR
           Typ$ = "A"
           REM IF ansionoff$ = "ON" THEN 
           AGnr$ = FN ansi(Agenturnr.MAADR)
           codedok$ = STR$ (CodeDok.DOKMA,"000000")
           nname$ = ""
           IF firmaname.maadr <> "" THEN 
             nname$ = FN ansi(firmaname.maadr) + ", " + FN ansi(Nachname.MAADR)
           ELSE 
             nname$ = FN ansi(Nachname.MAADR)
           END IF 
     
           IF vorname.maadr <> "" THEN 
              nname$ = nname$ + ", " + FN ansi(Vorname.MAADR)
           END IF 
           REM vname$ = FN ansi(Vorname.MAADR)
           dokument$ = FN ansi(Dokument.DOKMA)
           pfad$ = LEFT$ (_netpath$,2) + dateiname.DOKMA
           erstelnr$ = STR$ (codema.DOKMA,"000000")
           creator$ = FN ansi(Creator.DOKMA)
           creatdat$ = DATE$ (erstellt_am.DOKMA,"0dmmyyyy")
           DokTyp$ = FN ansi(Gruppe.DOKMA)
           spgru$ = ""
           spar$ = ""
           anzblktxt$ = FN ansi("AnzahlDerBlîcke")
           ruecktxt$ = FN ansi("RÅckgabedateiname")
           REM WriteINIDes(topic$,item$,value$,datei$)
           IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
           CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Art","A",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","AgenturNr",AGnr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Agenturname",nname$,GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","VertragsNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Gesellschaftsname","",GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","AgenturNr","",GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","Agenturname","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Spartengruppe","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Sparte","",GMACodeDir$ + "ELOSend.ini")

           DokUeberg%(k%) = codedok%
         END IF 
       END IF 
       SET STATUS STR$ (i%) + " Dokumente geprÅft, an ELO Åbergeben: " + STR$ (j%) + " von gesamt: " + STR$ (k%)
       SELECT NEXT LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WEND 
     REM ***************************************************************************************************
     REM CALL Fehler("","")
     REM jetzt, da die ini-Datei alle Werte enthÑlt, die öbergabe an ELO auslîsen
     IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN DELETE GMACodeDir$ + "ELOerg.ini"
     a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     i% = 0
     ret% = - 1
     WHILE ret% = - 1
       IF NOT EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
         i% = i% + 1
         WAIT FOR 1
         IF i% > 15 THEN 
           CALL Fehler("Anscheinend kann keine Verbindung zu ELO hergestellt werden!","")
           REQUEST "Anscheinend kann keine Verbindung zu ELO hergestellt werden!","Wollen Sie weiter warten?",130,reqw%
           IF reqw% = 1 THEN 
             i% = 0
           ELSE 
             ret% = 1
           END IF 
         END IF 
       ELSE 
         ret% = 0
       END IF 
     WEND 
     IF ret% <> 0 THEN 
       IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN 
         a$ = ReadDesti$("ELO","RÅckgabewert0",GMACodeDir$ + "ELOerg.ini")
         b$ = ReadDesti$("ELO","RÅckgabetext0",GMACodeDir$ + "ELOerg.ini")
         CALL Fehler("Es wurde ein Fehler bei der ELO-Operation festgestellt:","RÅckgabewert0: " + a$ + "   RÅckgabetext0: " + b$)
       END IF 
     END IF 
     IF ret% = 0 THEN 
       FOR i% = 0 TO k%
         codedok% = DokUeberg%(i%)
         GMAName$ = LEFT$ (name.supervis,50)
         GMACodeMA% = CodeMA.supervis
         SELECT KEY codedok% LOCK FILE GDokDat$ INDEX codedok.GDokDat$
         ELOTrans.GDokDat$ = 1
         ELODatum.GDokDat$ = TODAY 
         ELOMA.GDokDat$ = GMACodeMA%
         ELOMAName.GDokDat$ = GMAName$
         CALL QuickStore(GDokDat$)
       NEXT i%
       CALL Fehler( STR$ (i%,",999999") + "Dokumente wurden an ELO Åbergeben","RÅckgabewert vom ERZEUGEN:" + LTRIM$ ( STR$ (ret%)))
     ELSE 
       CALL Fehler("RÅckgabewert vom ERZEUGEN: " + LTRIM$ ( STR$ (ret%)),"")
     END IF 
   CASE 113
     REQUEST "Sollen Dokumente, die bereits an ELO Åbergeben wurden?","erneut Åbergeben werden?",130,req%
     REM Gesellschaftsdokumente an ELO 
     GDokDat$ = "DOKGE"
     CALL DFile(3,"geadr" + _fpw$)
     FILE "geadr"
     INDEX codege.geadr
     CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
       DELETE GMACodeDir$ + "ELOSend.ini"
     END IF 
     FILE "dokge"
     INDEX codeku.dokge
     i% = 0
     k% = 0
     j% = RECCOUNT (GDokDat$)
     REDIM DokUeberg%(j%)
     SELECT FIRST LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WHILE NOT EOF (GDokDat$)
       i% = i% + 1
       lw$ = LEFT$ (_netpath$,2)
       datname$ = lw$ + Dateiname.GDokDat$
       IF EXISTS (datname$) THEN 
         IF ELOTrans.GDokDat$ <> 1 OR req% = 1 THEN 
           k% = k% + 1
           auto% = - 1
           REM CALL ADRDokSendELO(codedokGDokDat$,codeku.GDOkDat$,auto%)
           codege% = Codeku.GDokDat$
           codedok% = Codedok.GDokDat$
           ansionoff$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))
           SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
           SELECT KEY codege% FILE "GEADR" INDEX codege.GEADR
           Typ$ = "G"
           REM IF ansionoff$ = "ON" THEN 
           REM AGnr$ = FN ansi(Agenturnr.MAADR)
           codedok$ = STR$ (CodeDok.DOKGE,"000000")
           nname$ = ""
           IF gesellschaft2.geadr <> "" THEN 
             nname$ = FN ansi(gesellschaft.geadr) + ", " + FN ansi(gesellschaft2.geADR)
           ELSE 
             nname$ = FN ansi(gesellschaft.geadr)
           END IF 
           dokument$ = FN ansi(Dokument.DOKGE)
           pfad$ = LEFT$ (_netpath$,2) + dateiname.DOKGE
           erstelnr$ = STR$ (codema.DOKGE,"000000")
           creator$ = FN ansi(Creator.DOKGE)
           creatdat$ = DATE$ (erstellt_am.DOKGE,"0dmmyyyy")
           DokTyp$ = FN ansi(Gruppe.DOKGE)
           spgru$ = ""
           spar$ = ""
           anzblktxt$ = FN ansi("AnzahlDerBlîcke")
           ruecktxt$ = FN ansi("RÅckgabedateiname")
           REM WriteINIDes(topic$,item$,value$,datei$)
           IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
           CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Art","G",GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","AgenturNr",AGnr$,GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","Agenturname",nname$,GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","VertragsNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Gesellschaftsname",nname$,GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","AgenturNr","",GMACodeDir$ + "ELOSend.ini")
           REM CALL WriteINIDes("ELO-0","Agenturname","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Spartengruppe","",GMACodeDir$ + "ELOSend.ini")
           CALL WriteINIDes("ELO-0","Sparte","",GMACodeDir$ + "ELOSend.ini")
           DokUeberg%(k%) = codedok%
         END IF 
       END IF 
       SET STATUS STR$ (i%) + " Dokumente geprÅft, an ELO Åbergeben: " + STR$ (j%) + " von gesamt: " + STR$ (k%)
       SELECT NEXT LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WEND 
     REM ***************************************************************************************************
     REM CALL Fehler("","")
     REM jetzt, da die ini-Datei alle Werte enthÑlt, die öbergabe an ELO auslîsen
     IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN DELETE GMACodeDir$ + "ELOerg.ini"
     a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     i% = 0
     ret% = - 1
     WHILE ret% = - 1
       IF NOT EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
         i% = i% + 1
         WAIT FOR 1
         IF i% > 15 THEN 
           CALL Fehler("Anscheinend kann keine Verbindung zu ELO hergestellt werden!","")
           REQUEST "Anscheinend kann keine Verbindung zu ELO hergestellt werden!","Wollen Sie weiter warten?",130,reqw%
           IF reqw% = 1 THEN 
             i% = 0
           ELSE 
             ret% = 1
           END IF 
         END IF 
       ELSE 
         ret% = 0
       END IF 
     WEND 
     IF ret% <> 0 THEN 
       IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN 
         a$ = ReadDesti$("ELO","RÅckgabewert0",GMACodeDir$ + "ELOerg.ini")
         b$ = ReadDesti$("ELO","RÅckgabetext0",GMACodeDir$ + "ELOerg.ini")
         CALL Fehler("Es wurde ein Fehler bei der ELO-Operation festgestellt:","RÅckgabewert0: " + a$ + "   RÅckgabetext0: " + b$)
       END IF 
     END IF 
     IF ret% = 0 THEN 
       FOR i% = 0 TO k%
         codedok% = DokUeberg%(i%)
         GMAName$ = LEFT$ (name.supervis,50)
         GMACodeMA% = CodeMA.supervis
         SELECT KEY codedok% LOCK FILE GDokDat$ INDEX codedok.GDokDat$
         ELOTrans.GDokDat$ = 1
         ELODatum.GDokDat$ = TODAY 
         ELOMA.GDokDat$ = GMACodeMA%
         ELOMAName.GDokDat$ = GMAName$
         CALL QuickStore(GDokDat$)
       NEXT i%
       CALL Fehler( STR$ (i%,",999999") + "Dokumente wurden an ELO Åbergeben","RÅckgabewert vom ERZEUGEN:" + LTRIM$ ( STR$ (ret%)))
     ELSE 
       CALL Fehler("RÅckgabewert vom ERZEUGEN: " + LTRIM$ ( STR$ (ret%)),"")
     END IF 
   CASE 114
     REM BUDAY bearbeiten
     SELECT FIRST FILE "BUDAY" INDEX codebud.buday
     FORM 9
   CASE 115
     REM auf buday positionieren
     codebud% = codebud.buday
     SELECT FIRST FILE "BUDAY" INDEX codebud.buday
     SELECT FORM KEY codebud% LOCK FILE "BUDAY" INDEX codebud.buday
     FORM 
   CASE 117
     REM Datensicherung Buday
     STORE FILE "buday"
     ENTER END 
     codebud% = codebud.buday
     SELECT FIRST FILE "BUDAY" INDEX codebud.buday
     SELECT FORM KEY codebud% LOCK FILE "BUDAY" INDEX codebud.buday
     FORM 
   CASE 118
     codebud% = codebud.buday
     SELECT FIRST FILE "BUDAY" INDEX codebud.buday
     SELECT KEY codebud% LOCK FILE "BUDAY" INDEX codebud.buday
     FORM 
     ENTER BuchText.buday,0
   CASE 116
     REM komplette Datensicherung
     CALL Fehler("Sie erhalten jetzt die Mîglichkeit eine komplette Sicherung des gesamten CODie-Ordners, mit all seinen Unterordnern durchzufÅhren!","Dazu mÅssen alle Nutzer das Programm verlassen haben und sÑmtliche Dokumente geschlossen sein!")
     REQUEST "Haben alle anderen User das","Programm beendet und sind alle Dokumente geschlossen?",130,req%
     IF req% = 1 THEN 
       REQUEST "Soll jetzt die komplette Sicherung durchgefÅhrt werden?","",130,req%
       IF req% = 1 THEN 
         CLOSE ALL 
         CALL Fehler("WÑhrend der Datensicherung wird Ihnen der Dateiname der Datensicherung angezeigt!","Bitte kopieren Sie diese Datei auf einen anderen Rechner oder brennen Sie diese Datei auf CD!")
         a% = CALL ("ShellExecute",0,"open",_netpath$ + "autoback.exe","","",1)
         CALL Fehler("SmartPROVIS wird jetzt geschlossen!","Bitte starten Sie es nach der Beendigung der Datensicherung neu!")
         CALL EXIT()
       END IF 
     END IF 
   END SELECT 
 WEND 
 ENTER END 
 IF MOD ("stamm") THEN CALL QuickStore("Stamm")
 _formend% = 0
 END SUB 
 
SUB IIMDefinition()
    SELECT FIRST LOCK FILE "stamm"
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("Dialogname")
    SET dlg = Superbase.Dialogs.Dialogname
    dlg.Move(0,0,181,114)
    dlg.Caption = "IIM-Definitionen"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(5,8,53,9)
    control.Caption = "Custimer-ID"
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(64,8,108,12)
    control.MaxLength = 50
    control.TextBinding = "IIM_CustomerID.stamm"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(5,22,55,9)
    control.Caption = "Servername"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(64,22,108,11)
    control.MaxLength = 50
    control.TextBinding = "IIM_Server.stamm"
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(64,35,108,11)
    control.MaxLength = 50
    control.TextBinding = "IIM_DB.stamm"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(5,36,55,10)
    control.Caption = "Datenbankname"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(5,49,55,11)
    control.Caption = "DB-Login"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(64,49,108,11)
    control.MaxLength = 50
    control.TextBinding = "IIM_LOGIN.stamm"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(5,64,55,9)
    control.Caption = "DB-Passwort"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(64,64,108,11)
    control.MaxLength = 50
    control.TextBinding = "IIM_PWD.stamm"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(30,92,43,15)
    control.Default = 1
    control.Caption = "OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(76,92,42,15)
    control.Caption = "Abbrechen"
    control.ReturnValue = 0
    DIALOG "Dialogname",req%
    REMOVE DIALOG ALL 
    MOUSE ON 
    IF req% = 1 THEN 
      STORE FILE "stamm"
    END IF 
    UNLOCK CURRENT FILE "stamm"
    SELECT FIRST FILE "stamm"
  
 END SUB 
 
SUB MASollBWS()
        FILE "Maadr"
        INDEX codema.maadr
        SELECT FIRST LOCK 
        i% = 0
        WHILE NOT EOF ("maadr")
          i% = i% + 1
          SET STATUS STR$ (i%) + " énderungen bei Mitarbeiter eingetragen"
         GMaAnrede$ = Anrede.maadr
         GMaAnrede2$ = Anrede2.maadr
         GMaVorname$ = Vorname.maadr
         GMaVorname2$ = Vorname2.maadr
         GMaNachname$ = Nachname.maadr
         GMaNachname2$ = Nachname2.maadr
         GMaFirmaName$ = FirmaName.maadr
         GMaFirmaName2$ = FirmaName2.maadr
         GMaOrt$ = Ort.maadr
         GMaOrt2$ = Ort2.maadr
         GMaStrasse$ = Stra·e.maadr
         GMaStrasse2$ = Strasse2.maadr
         GMaPLZ$ = plz.maadr
         GMaPLZ2$ = plz2.maadr
 
          IF stufe.maadr > 0 AND nichtaktiv.maadr <> "j" THEN 
            s$ = STR$ (stufe.maadr,"00")
            feld$ = "Titel" + s$ + ".stamm"
            IstTitel.maadr = feld$$
            feld$ = "BWS" + s$ + ".stamm"
            SollBWS.maadr = feld$$
            feld$ = "BWSEU" + s$ + ".stamm"
            SollBWSEU.maadr = feld$$
            feld$ = "Squote" + s$ + ".stamm"
            SollQuote.maadr = feld$$
            feld$ = "MAAnz" + s$ + ".stamm"
            SollMAAnz.maadr = feld$$
            IstBWS.maadr = BWSGes.maadr + SBwsges.maadr
            istbwseu.maadr = VAL ( STR$ (IstBWS.maadr / umrechnung.stamm,"999999999.00"))
            CALL QuickStore("maadr")
          END IF 
          SELECT NEXT LOCK FILE "maadr" INDEX codema.maadr
        WEND 
        SET STATUS ""
 END SUB 
 
 
SUB WaehrStamm()
     REM WÑhrung Stamm
     ON ERROR GOTO w2105200101
     DIM Waehrung$( RECCOUNT ("waehrung"))
w2105200101: 
     ON ERROR GOTO w2105200102
     DIM Auswahl1$(1)
w2105200102: 
     ON ERROR GOTO ErrorHandler
     FILE "waehrung"
     
     INDEX Codew.waehrung
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("waehrung")
       Waehrung$(a%) = waehrung.waehrung + " (1Euro = " + STR$ (umrechnung.waehrung,",999999.000000") + " " + waehrung.waehrung + ")" + SPACE$ (120) + STR$ (CodeW.waehrung,"000000")
       a% = a% + 1
       SELECT NEXT 
     WEND 
     FILE "stamm"
     CREATE DIALOG "PREISLIS",0,0,190,164,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl WÑhrung"
      ADD DIALOG "PREISLIS",7,5,14,139,125,2,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        _cuwaehr% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY _cuwaehr% FILE "waehrung" INDEX codew.waehrung
        _cuwaehr% = CodeW.waehrung
        IF _cuwaehr% > 0 THEN cuwaehr% = _cuwaehr%
        
        SELECT FIRST LOCK FILE "stamm"
        CodeW.stamm = _cuwaehr%
        NUMBASE "z99999999.000000"
        euro% = umrechnung.waehrung
        Waehrung.stamm = waehrung.waehrung
        umrechnung.stamm = euro%
        zweitwaehr$ = waehrung.stamm
        euro% = umrechnung.stamm
        ZWCodew% = codew.stamm
        FOR i% = 1 TO 25
          feld1$ = "BWSEU" + STR$ (i%,"00") + ".stamm"
          feld2$ = "BWS" + STR$ (i%,"00") + ".stamm"
          feld1$$ = VAL ( STR$ (feld2$$ / umrechnung.stamm,"999999999.00"))
        NEXT i%
        STORE FILE "stamm"
        waehr$ = "WÑhrung: " + waehrung.stamm
        Upd$ = UCASE$ (ReadConfig$(_projekt$,"UPDATE"))
        IF upd$ <> "TRUE" THEN CALL MASollBWS()
        FILE "stamm"
      END IF 
      MOUSE ON 
      zweitwaehr$ = waehrung.stamm
      euro% = umrechnung.stamm
      ZWCodew% = codew.stamm
 END SUB 
 
 
SUB WaehrStammEU()
     REM WÑhrung Stamm
     ON ERROR GOTO w2105200101e
     DIM Waehrung$( RECCOUNT ("waehrung"))
w2105200101e: 
     ON ERROR GOTO w2105200102e
     DIM Auswahl1$(1)
w2105200102e: 
     ON ERROR GOTO ErrorHandler
     FILE "waehrung"
     
     INDEX Codew.waehrung
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("waehrung")
       Waehrung$(a%) = waehrung.waehrung + " (1Euro = " + STR$ (umrechnung.waehrung,",999999.000000") + " " + waehrung.waehrung + ")" + SPACE$ (120) + STR$ (CodeW.waehrung,"000000")
       a% = a% + 1
       SELECT NEXT 
     WEND 
     FILE "stamm"
     CREATE DIALOG "PREISLIS",0,0,190,164,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl WÑhrung"
      ADD DIALOG "PREISLIS",7,5,14,139,125,2,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        _cuwaehr% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY _cuwaehr% FILE "waehrung" INDEX codew.waehrung
        _cuwaehr% = CodeW.waehrung
        IF _cuwaehr% > 0 THEN cuwaehr% = _cuwaehr%
        
        SELECT FIRST LOCK FILE "stamm"
        EUCodeW.stamm = _cuwaehr%
        EUWaehr.stamm = waehrung.waehrung
        STORE FILE "stamm"
        euwaehr$ = "nur VertrÑge mit folgender WÑhrung umrechnen: " + euwaehr.stamm
        FILE "stamm"
      END IF 
      MOUSE ON 
 END SUB 
 
 
 
 
 
SUB MNSTAMM()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
SUB Stamm2()
 vueb$ = UCASE$ (ReadConfig$("PROVIS","ANTRAGSDATUMFUERPROVISIONSUEBERGABE"))
 vuebs$ = UCASE$ (ReadConfig$("PROVIS","ANTRAGSDATUMFUERSOLLUEBERGABE"))
 NoDattest$ = UCASE$ (ReadConfig$("PROVIS","KONDITIONSDATUMNICHTPRUEFEN"))
 zw$ = UCASE$ (ReadConfig$("PROVIS","ZWEITWAEHRUNG"))
 skipst$ = UCASE$ (ReadConfig$("PROVIS","SkipStorno"))
 KondTest$ = UCASE$ (ReadConfig$("PROVIS","KONDTEST"))
 ZEBRUTYES$ = UCASE$ (ReadConfig$("PROVIS","ZEBRUTYES"))
 NeuSuGeadr$ = UCASE$ (ReadConfig$("PROVIS","NeuSuGeadr"))
 IF NeuSuGeadr$ <> "j" THEN NeuSuGeadr$ = "n"
 REM lastkunr$ = ReadConfig$("NUMMERN","LASTKundennummer")
 REM lastagnr$ = ReadConfig$("AGNUMMERN","LASTAGNR")
 provverf$ = UCASE$ (ReadConfig$("PROVIS","PROVISVERFAHREN"))
 Geinh% = 0
 IF nureinh.stamm LIKE "j" THEN 
   Geinh% = - 1
   PrvVerfahr$ = ";ZAHLUNGSEINGANG"
 END IF 
 Wonr% = VAL (ReadConfig$("PROVIS","BUERO"))
 PPCS$ = UCASE$ (ReadConfig$("PROVIS","PPCS"))
 ipaddress$ = UCASE$ (ReadConfig$("PROVIS","IPADR"))
 portnumber% = VAL ( UCASE$ (ReadConfig$("PROVIS","PORTNO")))
 
 IF provverf$ = "ZAHLUNGSEINGANG" THEN 
 ELSE 
   provverf$ = ";ZAHLUNGSEINGANG"
 END IF 
 CourtNB$ = UCASE$ (ReadConfig$("PROVIS","COURTNACHBEITRAG"))
 IF CourtNB$ LIKE "TRUE" THEN 
 ELSE 
   CourtNB$ = "FALSE"
 END IF 
 FORM 2
 END SUB 
 
SUB SichConfig()
 IF _projekt$ LIKE "IMMAK" THEN 
   CALL WriteConfig("IMMAK","UPDATE",upd$)
 ELSE 
   CALL WriteConfig("PROVIS","ZEBRUTYES",ZEBRUTYES$)
   CALL WriteConfig("PROVIS","ANTRAGSDATUMFUERPROVISIONSUEBERGABE",vueb$)
   CALL WriteConfig("PROVIS","ANTRAGSDATUMFUERSOLLUEBERGABE",vuebs$)
   Gvueb$ = vueb$
   Gvuebs$ = vuebs$
   CALL WriteConfig("PROVIS","UPDATE",upd$)
   CALL WriteConfig("PROVIS","SkipStorno",skipst$)
   CALL WriteConfig("PROVIS","ZWEITWAEHRUNG",zw$)
   CALL WriteConfig("PROVIS","KONDTEST",KondTest$)
   Geinh% = 0
   IF nureinh.stamm LIKE "j" THEN 
     provverf$ = ";ZAHLUNGSEINGANG"
     Geinh% = - 1
   END IF 
   CALL WriteConfig("PROVIS","PROVISVERFAHREN",provverf$)
   CALL WriteConfig("PROVIS","COURTNACHBEITRAG",CourtNB$)
   REM CALL WriteConfig("NUMMERN","LASTKundennummer",lastkunr$)
   REM CALL WriteConfig("AGNUMMERN","LASTAGNR",lastagnr$)
   wonr$ = STR$ (wonr%,"000000")
   IF NeuSuGeadr$ <> "j" THEN NeuSuGeadr$ = "n"
   GNeuSuGeadr$ = NeuSuGeadr$
   IF GNeuSuGeadr$ LIKE "j" THEN 
     CALL WriteConfig("PROVIS","NeuSuGeadr","TRUE")
   ELSE 
     CALL WriteConfig("PROVIS","NeuSuGeadr","")
   END IF 
   CALL WriteConfig("PROVIS","BUERO",wonr$)
   CALL WriteConfig("PROVIS","PPCS",ppcs$)
   CALL WriteConfig("PROVIS","IPADR",ipaddress$)
   CALL WriteConfig("PROVIS","PORTNO", LTRIM$ ( STR$ (portnumber%,"99999")))
   CALL WriteConfig("PROVIS","KONDITIONSDATUMNICHTPRUEFEN",NoDatTest$)
   GKondNoDattes$ = NoDatTest$
   portnumber$ = LTRIM$ ( STR$ (portnumber%,"99999"))
   GPPCS$ = ppcs$
   REM Workstation% = wonr%
   PrvVerfahr$ = UCASE$ (ReadConfig$("PROVIS","PROVISVERFAHREN"))
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN GShowSpeziKond% = 0
 
   zweitwaehr$ = UCASE$ (ReadConfig$("PROVIS","ZWEITWAEHRUNG"))
   KonTest$ = UCASE$ (ReadConfig$("PROVIS","KONDTEST"))
   CourtNachBeitr$ = UCASE$ (ReadConfig$("PROVIS","COURTNACHBEITRAG"))
 END IF 
 END SUB 
 
SUB SichSTAMM()
  CALL DFile(3,"maadr" + _fpw$)
  IF MOD ("Stamm") THEN 
    FOR i% = 1 TO 25
      feld1$ = "BWSEU" + STR$ (i%,"00") + ".stamm"
      feld2$ = "BWS" + STR$ (i%,"00") + ".stamm"
      feld1$$ = VAL ( STR$ (feld2$$ / umrechnung.stamm,"999999999.00"))
    NEXT i%
    STORE FILE "stamm"
    UNLOCK CURRENT FILE "Stamm"
    CALL MASollBWS()
    SET STATUS ""
    FILE "stamm"
  END IF 
 END SUB 
 
SUB SRMINUS1()
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"gekondm" + _fpw$)
 REQUEST "Wollen Sie wirklich die SRDauer aller Mitarbeiter auf -1 setzen?","Funktion fortsetzen?",130,req%
 IF req% = 1 THEN 
   MOUSE OFF 
   UPDATE Haftung.gekond = - 1
   END UPDATE 
     CLOSE FILE "gekond"
     CALL DFile(3,"gekond" + _fpw$)
   MOUSE ON 
   REQUEST "Alle SRDauern aller Mitarbeiter wurden auf -1 gesetzt!"
 END IF 
 
 END SUB 
 
 
 REM *****************************************************************************************
 REM *                                                                                       *
 REM *              Erstellung DTAUS-Diskette                                                *
 REM *                                                                                       *
 REM******************************************************************************************
SUB dtaus()
  CALL DFile(3,"dtaus")
  OPEN GMACodeDir$ + "dtaus1.txt" FOR OUTPUT 
  dtaus_anz% = 0
  dtaus_sumdm% = 0
  dtaus_sumkn% = 0
  dtaus_sumblz% = 0
  dtaus_sumeuro% = 0
 
  SELECT FIRST FILE "dtaus"
 
  WHILE NOT EOF ("dtaus")
    IF satzart.dtaus = "A" THEN 
      REM Erster Datensatz
      ? STR$ (satzlaenge.dtaus,"0000");
      ? satzart.dtaus;
      ? a_kennzeichen.dtaus;
      ? STR$ (a_Bankleitzahl.dtaus,"00000000");
      ? "00000000";
      ? a_kundenname.dtaus;
      ? STR$ ( DAY ( TODAY ),"00"); STR$ ( MONTH ( TODAY ),"00"); MID$ ( STR$ ( YEAR ( TODAY ),"0000"),3,2);
      ? SPACE$ (4);
      ? STR$ (a_kontonummer.dtaus,"0000000000");
      ? STR$ (a_referenznr.dtaus,"0000000000");
      ? SPACE$ (47);
      IF a_waehrungknz.dtaus <> "1" THEN 
        ? " ";
      ELSE 
        ? a_waehrungknz.dtaus;
      END IF 
    ELSE IF satzart.dtaus = "C" THEN 
      dtaus_anz% = dtaus_anz% + 1
      REM ZwischensÑtze
      c_erwanz% = c_erwknz.dtaus
      IF c_erwanz% < 1 THEN 
        c_erwanz% = 0
      ELSE IF c_erwanz% > 2 THEN 
        c_erwanz% = 3
      END IF 
 
      REM c_erwknz.dtaus = erwanz%
      c_lenge% = 187 + (c_erwknz.dtaus * 29)
      ? STR$ (c_lenge%,"0000");
      ? satzart.dtaus;
      ? STR$ (c_bankleitzahl1.dtaus,"00000000");
      dtaus_sumblz% = dtaus_sumblz% + c_bankleitzahl2.dtaus
      ? STR$ (c_bankleitzahl2.dtaus,"00000000");
      dtaus_sumkn% = dtaus_sumkn% + c_kontonummer1.dtaus
      ? STR$ (c_kontonummer1.dtaus,"0000000000");
      ? STR$ (c_intkundennr.dtaus,"0000000000000");
      ? STR$ (c_textkey.dtaus,"00");
      ? STR$ (c_textkeyerg.dtaus,"000");
      ? SPACE$ (1);
      c_Betragdm% = 0
      dtaus_sumdm% = dtaus_sumdm% + c_Betragdm%
      
      ? STR$ (c_Betragdm%,"00000000000");
      ? STR$ (c_bankleitzahl3.dtaus,"00000000");
      ? STR$ (c_kontonummer2.dtaus,"0000000000");
      dtaus_sumeuro% = dtaus_sumeuro% + c_betrageuro.dtaus
      ? STR$ (c_betrageuro.dtaus,"00000000000");
      ? SPACE$ (3);
      ? c_name1.dtaus;
      ? SPACE$ (8);
      ? c_name2.dtaus;
      ? c_verwzweck;
      IF c_waehrungknz.dtaus <> "1" THEN 
        ? " ";
      ELSE 
        ? c_waehrungknz.dtaus;
      END IF 
      ? SPACE$ (2);
      ? STR$ (c_erwanz%,"00");
      IF c_erwanz% > 0 THEN 
        ? STR$ (c_erwteilknz1.dtaus,"00");
        ? c_inhalt1.dtaus;
      END IF 
      IF c_erwanz% > 1 THEN 
        ? STR$ (c_erwteilknz2.dtaus,"00");
        ? c_inhalt2.dtaus;
        ? SPACE$ (11);
      END IF 
      IF c_erwanz% > 2 THEN 
        ? STR$ (c_erwteilknz3.dtaus,"00");
        ? c_inhalt3.dtaus;
      END IF 
      ? "02";
      ? SPACE$ (27);
      ? "02";
      ? SPACE$ (27);
      ? "02";
      ? SPACE$ (27);
      ? SPACE$ (12);
    END IF 
   SELECT NEXT FILE "dtaus"
  WEND 
   
  ? "0128";
  ? "E";
  ? SPACE$ (5);
  ? STR$ (dtaus_anz%,"0000000");
  ? STR$ (dtaus_sumdm%,"0000000000000");
  ? "000"; STR$ (dtaus_sumkn%,"00000000000000");
  ? "000"; STR$ (dtaus_sumblz%,"00000000000000");
  ? STR$ (dtaus_sumeuro%,"0000000000000");
  ? SPACE$ (51);
      
  CLOSE OUTPUT 
  
  REM CALL Info("Bitte legen Sie eine leere Diskette in Laufwerk A:","")
 
  REM COPY "c:\dtaus1.txt" TO "a:\dtaus"
 
 okrep% = 0
 WHILE okrep% = 0
   CALL ORep("DTBEGL")
   BEFORE REPORT 
       SET REPORT PAGE "H_REPORT"
       OUTPUT REPORT PAGE 
   END REPORT 
 
   AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
   END SELECT 
   ON ERROR GOTO ErrDTBLGDruck
   dtausanz% = dtaus_anz%
   REM dtaussumdm% = dtaus_sumdm% / 100
   dtaussumdm% = dtaus_sumeuro% / 100
   dtaussumkn% = dtaus_sumkn%
   dtaussumblz% = dtaus_sumblz%
   nadtaus$ = Firma1.stamm
   blzdtaus$ = blz.stamm
   ktodtaus$ = Konto.stamm
   badtaus$ = Bank.stamm
   ort$ = Ort.stamm + ", den"
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   SET FIRST PAGE HEADING OFF 
   SELECT ;
       TO ASK 
ErrDTBLGDruck: 
   ON ERROR GOTO ErrorHandler
   REQUEST "Mîchten Sie den Ausdruck des DatentrÑgerbegleitscheines wiederholen?","",130,req5%
   IF req5% <> 1 THEN okrep% = 1
 WEND 
 CLOSE OUTPUT 
 WAIT FOR 3
 END SUB 
 
SUB TerLiSpez(codeaq%)
 ON ERROR GOTO ErrorHandler
 CALL DFile(2,"OFFICE\tvorlage" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 ON ERROR GOTO ErrorHandler
 req% = 1
 _cuaq% = codeaq%
 SELECT FIRST FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
 SELECT KEY codeaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
 SELECT FIRST FILE GAdrDat$ INDEX codeku.GAdrDat$
 SELECT KEY codeku.GAkquiDat$ FILE GAdrDat$ INDEX codeku.GAdrDat$
 SELECT FIRST FILE GTelDat$ INDEX codeku.GTelDat$
 SELECT KEY codeku.GAkquiDat$ FILE GTelDat$ INDEX codeku.GTelDat$
 SELECT FORM KEY codeaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
 knr% = CodeKU.GAdrDat$
 FORM 
 IF req% = 1 THEN 
     lastT1% = _cuaq%
     _continue% = 1
     IF _continue% <> 0 THEN 
       cudat$ = DATE$ ( TODAY ,"0d.mm.yyyy")
       datanz$ = DATE$ ( TODAY ,"0d.mm.yyyy")
       SET STATUS "Bereit"
       _formend% = 0
       WHILE _formend% = 0
         ON ERROR GOTO ErrorHandler
         REM vbezug$ = "Adre&sse"
         REM _vcodema% = vcodema%
         AQsub% = 0
         akmaske$ = GAkquiDat$
         IF ProjectJN$ = "TRUE" THEN akmaske$ = "AKQUIPRJ"
         ta% = 1
         IF GCODie% = - 1 THEN 
           IF GCODieRuf1% < 0 THEN 
             ta% = 0
           ELSE 
             ta% = 1
           END IF 
         END IF 
         IF UCASE$ ( FORM ) <> akmaske$ OR ta% = 1 THEN 
           SET HEADING title$ + " - Termine"
           IF EXISTS (GOFFForm$ + akmaske$ + ".sbv") THEN 
             OPEN FORM GOFFForm$ + akmaske$
           ELSE 
             OPEN FORM GOFFForm$ + akmaske$
           END IF 
           SET f = Superbase.Form
           SELECT FORM KEY _cuaq% INDEX codeaq.GAkquiDat$
           SET STATUS "Termine"
           CALL MNAKQUISE()
           MENU 5,4,0,"&Adresshistorie,F10","AQAdrHistT","Adresshistorie anzeigen/drucken"
           MENU ON 
           REM CALL Fehler("","")
         END IF 
         FILE GAkquiDat$
         CALL AKQUISEIntro1()
         SELECT FORM KEY _cuaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
         FORM 
         SET DISPLAY ON 
           
         
         ON ERROR GOTO ErrorHandler
         CALL AQButtUpdate()
         FORM 
         ON ERROR GOTO ErrorHandler
         SET STATUS "Bereit"
         IF NOT NEW (GAkquiDat$) THEN 
           MENU ON 
           MOUSE ON 
           f.suchen.enabled = - 1
           f.suchen.visible = - 1
           f.abbruch.enabled = 0
           f.abbruch.visible = 0
           f.abbruch2.enabled = 0
           f.abbruch2.visible = 0
           IF _projeKt$ LIKE "PROVIS" AND workstation% = 0 THEN 
             f.vertrag.enabled = - 1
             f.vertrag.visible = - 1
           ELSE 
             f.vertrag.enabled = 0
             f.vertrag.visible = 0
           END IF 
           IF _projekt$ LIKE "IMMAK" THEN 
             f.anfrage.visible = - 1
             f.anfrage.enabled = - 1
             f.angebot.visible = - 1
             f.angebot.enabled = - 1
           ELSE 
             f.anfrage.visible = 0
             f.anfrage.enabled = 0
             f.angebot.visible = 0
             f.angebot.enabled = 0
           END IF 
           ON ERROR GOTO ErrorHandler
           WAIT MOUSE OR KEY OR UPDATE OR MENU 
           GET k$
           SELECT CASE ASC (k$)
           CASE CrsLeft%,PgUp%
             CALL AQPrev()
           CASE CrsRight%,PgDn%
             CALL AQNext()
           END SELECT 
           IF k$ = CHR$ (27) THEN 
             IF PAGE > 1 THEN 
               FORM 1
             ELSE 
               _formend% = 1
             END IF 
           END IF 
         ELSE 
           AQsub% = 99
         END IF 
         SELECT CASE AQsub%
         CASE 101
           REM TerminÅbersicht Kunde 12082003
           codeku% = codeku.akquise
           codeaq% = codeaq.Akquise
           _cuaq% = codeaq%
           CALL KunTer1()
           knr% = codeku%
           GCodieruf2% = 0
           MOUSE OFF 
           SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
           SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
           IF UCASE$ ( FORM ) <> akmaske$ THEN 
             SET HEADING title$ + " - Termine"
             OPEN FORM GOFFForm$ + akmaske$
             SET f = Superbase.Form
             SET STATUS "Termine"
             CALL MNAKQUISE()
             MENU 6,3,1,"Liste erneut &anzeigen,F7","AQTermineO2","Suchliste erneut anzeigen"
             MENU ON 
             FORM 
             SET DISPLAY ON 
           END IF 
           MOUSE OFF 
           SELECT FIRST FILE "AKQUISE" INDEX codeaq.akquise
           SELECT FORM KEY codeaq% FILE "AKQUISE" INDEX codeaq.akquise
           FORM 
           CALL AKQUISEIntro1()
           MOUSE ON 
         CASE 100
           REM VertragsÅbersicht
           CALL DFile(3,"gekond" + _fpw$)
           CALL DFile(3,"kvertrag" + _fpw$)
           CALL DFile(3,"maadr" + _fpw$)
           CALL DFile(3,"sparten" + _fpw$)
           CALL DFile(3,"vorgang" + _fpw$)
           SELECT KEY codeku.GAkquiDat$ FILE GAdrDat$ INDEX codeku.GAdrDat$
           SELECT KEY codeku.GAkquiDat$ FILE "kvertrag" INDEX codeku.kvertrag
           CALL KVERTRAGGR()
 
         CASE 99
           IF ergdatuma$ = "TRUE" AND NOT ( NEW (GAkquiDat$) OR MOD (GAkquiDat$)) THEN 
             codeaq% = CodeAQ.GAkquiDat$
             
             SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX CodeAq.GAkquiDat$
             IF ergebnis.GAkquiDat$ <> "" THEN 
               ergebnis.GAkquiDat$ = ergebnis.GAkquiDat$ + CHR$ (13) + CHR$ (10) + DATE$ ( TODAY ) + " " + TIME$ ( NOW ,"hh.mm")
             ELSE 
               ergebnis.GAkquiDat$ = ergebnis.GAkquiDat$ + DATE$ ( TODAY ) + " " + TIME$ ( NOW ,"hh.mm")
             END IF 
             CALL QuickStore(GAkquiDat$)
           END IF 
           MOUSE ON 
           IF PAGE = 1 THEN 
             CALL ButDesabled()
             f.seite2.enabled = 0
             f.offenetermine.enabled = 0
             f.terminplan.enabled = 0
             f.sprache.enabled = 0
             f.brief.enabled = 0
             f.Telefon.enabled = 0
             f.mitarbeiter.enabled = 0
             f.bezug.enabled = 0
             f.aktion.enabled = 0
             f.kundeninfo.enabled = 0
             f.Monat.enabled = 0
             f.Juli.enabled = 0
             f.Jahr.enabled = 0
             f.W1.enabled = 0
             f.W2.enabled = 0
             f.W3.enabled = 0
             f.W4.enabled = 0
             f.W5.enabled = 0
             f.W6.enabled = 0
             f.vertrag.enabled = 0
             f.vertrag.visible = 0
           END IF 
           IF PAGE = 2 THEN 
             f.bearb2.enabled = 0
             f.abbruch2.enabled = - 1
             f.abbruch2.visible = - 1
             f.kundeninfo2.enabled = 0
             f.seite1.enabled = 0
           END IF 
           IF PAGE < 3 THEN 
             MENU OFF 
             ENTER datum.GAkquiDat$,0
             MENU ON 
           END IF 
             IF PAGE = 1 THEN 
               CALL ButEnabled()
               f.seite2.enabled = - 1
               f.offenetermine.enabled = - 1
               f.terminplan.enabled = - 1
               f.sprache.enabled = - 1
               f.brief.enabled = - 1
               f.Telefon.enabled = - 1
               f.mitarbeiter.enabled = - 1
               f.bezug.enabled = - 1
               f.aktion.enabled = - 1
               f.kundeninfo.enabled = - 1
               f.Monat.enabled = - 1
               f.Juli.enabled = - 1
               f.Jahr.enabled = - 1
               f.W1.enabled = - 1
               f.W2.enabled = - 1
               f.W3.enabled = - 1
               f.W4.enabled = - 1
               f.W5.enabled = - 1
               f.W6.enabled = - 1
               f.suchen.enabled = - 1
               f.suchen.visible = - 1
               IF _projeKt$ LIKE "PROVIS" THEN 
                 f.vertrag.enabled = - 1
                 f.vertrag.visible = - 1
               ELSE 
                 f.vertrag.enabled = 0
                 f.vertrag.visible = 0
               END IF 
             END IF 
           END IF 
           IF PAGE = 2 THEN 
             f.bearb2.enabled = - 1
             f.abbruch2.enabled = 0
             f.abbruch2.visible = 0
             f.kundeninfo2.enabled = - 1
             f.seite1.enabled = - 1
           END IF 
           IF PAGE = 3 THEN 
             GEMAILRAUS$ = EMAILRAUS.akquise
             ENTER emailto.GAkquiDat$,0
           END IF 
         END SELECT 
       WEND 
       IF art% = 2 THEN 
         SELECT FORM KEY _cuaq% INDEX codeaq.GAkquiDat$
         REM cuaq% = _cuaq%
       END IF 
     END IF 
     _formend% = 0
     IF art% = 1 THEN 
       cuaq% = 0
      _formend% = 0
     END IF 
     REM _formend% = 1
     IF NEW (GAkquiDat$) OR MOD (GAkquiDat$) AND CodeAQ.GAkquiDat$ <> 0 THEN CALL FStore(GAkquiDat$)
   END IF 
 
 END SUB 
 
 
SUB ADRPost(codeku%)
   SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
   Adrtemp$ = Postanschrift.GAdrDat$
   CREATE DIALOG "MakeAdr",0,0,273,156,title$,"MS Sans Serif",8
   ADD DIALOG "MakeAdr",4,0,0,272,131,0,""
   ADD DIALOG "MakeAdr",9,3,10,21,22,2
   ADD DIALOG "MakeAdr",5,29,11,233,19,0,"Bitte geben Sie an, wie die Adresse fÅr die öbergabe an die Textverarbeitung bereitgestellt werden soll:"
   ADD DIALOG "MakeAdr",6,30,33,236,86,68,2,Adrtemp$,1800
   ADD DIALOG "MakeAdr",1,73,135,55,15,0,"&Speichern",1,1
   ADD DIALOG "MakeAdr",1,129,135,55,15,0,"&Abbrechen",0,0
   DIALOG "MakeAdr",req%
   REMOVE DIALOG "MakeAdr"
   IF req% = 1 THEN 
     Postanschrift.GAdrDat$ = Adrtemp$
     CALL QuickStore(GAdrDat$)
   END IF 
 END SUB 
 
 
SUB ADRStatErw()
  f.ADRStatComboBox.List.Add("irgendwas")
 END SUB 
 
 
 
 
 REM suchen nach dokumenten
 REM codeku%=0 alle dokumente, #0 nur doks eines kunden
FUNCTION DokSuchen%(codeku%,befehl$)
    MOUSE OFF 
    GDokDat$ = "Dokument"
    opt1% = 1
    suna$ = ""
    DIM dokgruandi$(200)
    DIM prjgruandi$(200)
    DIM ersteller$(200)
    DIM Bearbeiter$(200)
    dokgruandi$(0) = "<ALLE>"
    prjgruandi$(0) = "<ALLE>"
    ersteller$(0) = "<ALLE>"
    bearbeiter$(0) = "<ALLE>"
    IF codeku% > 0 THEN 
      SELECT FIRST FILE GDokDat$ INDEX codeku.GDokDat$
      SELECT KEY codeku% FILE GDokDat$ INDEX codeku.GDokDat$
      WHILE NOT EOF (GDokDat$) AND codeku.GDokDat$ = codeku%
        projekt$ = Projekt.GDokDat$
        gru$ = gruppe.GDokDat$
        erst$ = creator.GDokDat$
        bearb$ = Bearbeiter.GDokDat$
        IF LTRIM$ (erst$) <> "" THEN 
          j% = 0
          vorh% = 0
          FOR i% = 1 TO 199
            IF ersteller$(i%) = erst$ THEN 
              vorh% = - 1
              i% = 200
            END IF 
            IF ersteller$(i%) = "" THEN 
              j% = i%
              i% = 200
            END IF 
          NEXT i%
          IF vorh% = 0 THEN 
            IF LTRIM$ (erst$) <> "" THEN ersteller$(j%) = erst$
          END IF 
        END IF 
 
        IF LTRIM$ (bearb$) <> "" THEN 
          j% = 0
          vorh% = 0
          FOR i% = 1 TO 199
            IF Bearbeiter$(i%) = bearb$ THEN 
              vorh% = - 1
              i% = 200
            END IF 
            IF Bearbeiter$(i%) = "" THEN 
              j% = i%
              i% = 200
            END IF 
          NEXT i%
          IF vorh% = 0 THEN 
            IF LTRIM$ (bearb$) <> "" THEN Bearbeiter$(j%) = bearb$
          END IF 
        END IF 
 
 
        IF LTRIM$ (projekt$) <> "" THEN 
          j% = 0
          vorh% = 0
          FOR i% = 1 TO 199
            IF prjgruandi$(i%) = projekt$ THEN 
              vorh% = - 1
              i% = 200
            END IF 
            IF prjgruandi$(i%) = "" THEN 
              j% = i%
              i% = 200
            END IF 
          NEXT i%
          IF vorh% = 0 THEN 
            prjgruandi$(j%) = projekt$
          END IF 
        END IF 
        IF LTRIM$ (gru$) <> "" THEN 
          j% = 0
          vorh% = 0
          FOR i% = 1 TO 199
            IF dokgruandi$(i%) = gru$ THEN 
              vorh% = - 1
              i% = 200
            END IF 
            IF dokgruandi$(i%) = "" THEN 
              j% = i%
              i% = 200
            END IF 
          NEXT i%
          IF vorh% = 0 THEN 
            dokgruandi$(j%) = gru$
          END IF 
        END IF 
        SELECT NEXT FILE GDokDat$
      WEND 
    ELSE 
      REM die Sachen direkt aus der Projektdatei und DokGruppen entnehmen
      a% = 1
      dokgruandi$(0) = "<ALLE>"
      dokgruandi$(1) = "allgemeine Schreiben"
      WHILE dokgruandi$(a%) <> "leer"
        a% = a% + 1
        dokgruandi$(a%) = FN ibm(ReadConfig$("Dokumentengruppen","Gruppe" + LTRIM$ ( STR$ (a%,"999999"))))
      WEND 
      a% = 1
      REM prjgruandi$(0) = "<ALLE>"
      REM SELECT FIRST FILE "project"
      REM WHILE NOT EOF ("project")
        REM prjgruandi$(a%) = name1.project
        REM a% = a% + 1
        REM SELECT NEXT FILE "project"
      REM WEND 
 
      a% = 1
      ersteller$(0) = "<ALLE>"
      SELECT FIRST FILE "supervis"
      WHILE NOT EOF ("supervis")
        ersteller$(a%) = name.supervis
        a% = a% + 1
        SELECT NEXT FILE "supervis"
      WEND 
 
      a% = 1
      bearbeiter$(0) = "<ALLE>"
      SELECT FIRST FILE "supervis"
      WHILE NOT EOF ("supervis")
        bearbeiter$(a%) = name.supervis
        a% = a% + 1
        SELECT NEXT FILE "supervis"
      WEND 
 
 
    END IF 
    MOUSE ON 
    seldokgr$ = "<ALLE>"
    selprj$ = "<ALLE>"
    selerst$ = "<ALLE>"
    selbearb$ = "<ALLE>"
 
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("ADRSUCH")
    SET dlg = Superbase.Dialogs.ADRSUCH
    dlg.Move(0,0,222,259)
    dlg.Caption = "Dokumentensuche"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,1,222,64)
    control.Caption = "Suche nach"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(30,19,106,11)
    control.Caption = "Dokumenten-Namen"
    control.Bind("opt1%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(30,33,106,11)
    control.Caption = "Dokumenten-Nummer"
    control.Bind("opt1%")
    control.ValueOn = 2
 
    IF codeku% > 0 THEN 
      SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
      control.Move(30,46,106,11)
      control.Caption = "alle Dokumente"
      control.Bind("opt1%")
      control.ValueOn = 3
    END IF 
 
    SET control = dlg.Add("DialogFrame2","DialogFrame")
    control.Move(0,65,222,124)
    control.Caption = "Filter"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(5,78,177,8)
    control.Caption = "Dokumentengruppen"
 
    SET control = dlg.Add("DialogComboBox1","DialogComboBox")
    control.Move(5,91,212,165)
    control.Style = 0
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("dokgruandi$","seldokgr$")
 
    REM SET control = dlg.Add("DialogLabel3","DialogLabel")
    REM control.Move(5,108,145,8)
    REM control.Caption = "Projekte"
 
    REM SET control = dlg.Add("DialogComboBox2","DialogComboBox")
    REM control.Move(5,118,212,134)
    REM control.Style = 0
    REM control.Sorted = 1
    REM control.ScrollBars = 2
    REM control.Bind("prjgruandi$","selprj$")
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(5,134,177,10)
    control.Caption = "Bearbeiter"
 
    SET control = dlg.Add("DialogComboBox6","DialogComboBox")
    control.Move(5,145,212,111)
    control.Style = 0
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("bearbeiter$","selbearb$")
 
    SET control = dlg.Add("DialogLabel8","DialogLabel")
    control.Move(5,161,177,10)
    control.Caption = "Ersteller"
 
    SET control = dlg.Add("DialogComboBox7","DialogComboBox")
    control.Move(5,172,212,85)
    control.Style = 0
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("ersteller$","selerst$")
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(20,202,133,10)
    control.Caption = "Dokument/Dokumenten-Nr:"
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(20,215,179,11)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "suna$"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(32,233,64,16)
    control.Default = 1
    control.Caption = "&Suche"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(97,233,64,16)
    control.Caption = "&Abbruch"
    control.ReturnValue = 0
    control.Cancel = 1
 
 
   
    DIALOG "ADRSUCH",req%
    REMOVE DIALOG "ADRSUCH"
 
    tfound% = 0
    MOUSE OFF 
    IF RECCOUNT ("Dokument") < 20000 THEN 
      REDIM AdrFound$( RECCOUNT ("Dokument"),1)
      REDIM AdrFound$( RECCOUNT ("Dokument"))
      zahl% = RECCOUNT ("Dokument")
    ELSE 
      REDIM AdrFound$(20000,1)
      REDIM AdrFound$(20000)
      zahl% = 20000
    END IF 
    REM CALL Fehler("","")
    IF req% = 1 THEN 
      FILE "Dokument"
      MOUSE OFF 
      fi% = 0
      IF seldokgr$ <> "<ALLE>" AND seldokgr$ <> "" THEN 
        SELECT WHERE FILE "DOKUMENT"
        IF codeku% = 0 THEN 
          IF befehl$ = "" THEN befehl$ = "select where codedok.dokument > 0 "
        ELSE 
          IF befehl$ = "" THEN befehl$ = "select where codeku.dokument = codeku%  "
        END IF 
        IF selprj$ <> "<ALLE>" AND selprj$ <> "" THEN 
          befehl$ = befehl$ + " and gruppe.dokument = seldokgr$ and Projekt.dokument = selprj$"
          fi% = - 1
        ELSE 
          befehl$ = befehl$ + " and gruppe.dokument = seldokgr$"
          fi% = - 1
        END IF 
      ELSE 
        IF selprj$ <> "<ALLE>" AND selprj$ <> "" THEN 
          SELECT WHERE FILE "DOKUMENT"
          IF codeku% = 0 THEN 
            IF befehl$ = "" THEN befehl$ = "select where codedok.dokument > 0 "
          ELSE 
            IF befehl$ = "" THEN befehl$ = "select where codeku.dokument = codeku%  "
          END IF 
          befehl$ = befehl$ + " and Projekt.dokument = selprj$"
          fi% = - 1
        END IF 
      END IF 
      IF selerst$ <> "<ALLE>" AND selerst$ <> "" THEN 
        befehl$ = befehl$ + " and Creator.dokument = selerst$"
        fi% = - 1
      END IF 
      IF selbearb$ <> "<ALLE>" AND selbearb$ <> "" THEN 
        befehl$ = befehl$ + " and Bearbeiter.dokument = selbearb$"
        fi% = - 1
      END IF 
      IF fi% = - 1 THEN 
        EXECUTE befehl$
      END IF 
      IF codeku% < 1 THEN 
        INDEX dokument.dokument
        SELECT FIRST 
      ELSE 
        INDEX codeku.dokument
        SELECT FIRST FILE "dokument" INDEX codeku.dokument
        SELECT KEY codeku% FILE "dokument" INDEX codeku.dokument
      END IF 
      
      IF GCODIE% = - 1 THEN 
        CALL SearchInitDo1("DOKUMENT")
      END IF 
 
      IF codeku% < 1 THEN WHILE NOT EOF ("Dokument")
      IF codeku% > 0 THEN WHILE NOT EOF ("Dokument") AND codeku.dokument = codeku%
        IF opt1% = 3 THEN 
              sok% = - 1
              IF GASP% AND Workstation% > 0 THEN 
                wks% = Workstation.GDOKDAT$
                FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                  wks% = VisOff%(ii%)
                  aa% = IsWksVisible%(wks%)
                  IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                    sok% = - 1
                    ii% = VisCount%
                  ELSE 
                    sok% = 0
                  END IF 
                NEXT ii%
              ELSE 
                sok% = - 1
              END IF 
              IF sok% THEN 
                AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                tfound% = tfound% + 1
                IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
              END IF 
        END IF 
 
        IF opt1% = 1 THEN 
          IF codeku% < 1 THEN 
            IF dokument.dokument LIKE suna$ + "*" OR dokument.dokument LIKE "*" + suna$ + "*" THEN 
              AdrFound$(tfound%) = dokument.dokument + SPACE$ (250) + STR$ (codedok.dokument,"000000")
              tfound% = tfound% + 1
              IF GCODIE% = - 1 THEN CALL SearchVorbDO1("DOKUMENT")
            END IF 
          ELSE 
            IF dokument.dokument LIKE suna$ + "*" OR dokument.dokument LIKE "*" + suna$ + "*" THEN 
              IF codeku.dokument = codeku% THEN 
                AdrFound$(tfound%) = dokument.dokument + SPACE$ (250) + STR$ (codedok.dokument,"000000")
                tfound% = tfound% + 1
                IF GCODIE% = - 1 THEN CALL SearchVorbDO1("DOKUMENT")
              END IF 
            END IF 
          END IF 
        ELSE 
          IF codeku% < 1 THEN 
            IF codedok.dokument = VAL (suna$) THEN 
              AdrFound$(tfound%) = dokument.dokument + SPACE$ (250) + STR$ (codedok.dokument,"000000")
              tfound% = tfound% + 1
              IF GCODIE% = - 1 THEN CALL SearchVorbDO1("DOKUMENT")
            END IF 
          ELSE 
            IF codedok.dokument = VAL (suna$) THEN 
              IF codeku.dokument = codeku% THEN 
                AdrFound$(tfound%) = dokument.dokument + SPACE$ (250) + STR$ (codedok.dokument,"000000")
                tfound% = tfound% + 1
                IF GCODIE% = - 1 THEN CALL SearchVorbDO1("DOKUMENT")
              END IF 
            END IF 
          END IF 
        END IF 
        MOUSE OFF 
        SELECT NEXT FILE "Dokument"
        SET STATUS Dokument.dokument
      WEND 
      AdrFound$(tfound%) = ""
      adrfound% = 0
      MOUSE ON 
      IF tfound% > 0 THEN 
        IF GCODIE% = - 1 THEN 
         c$ = "aa"
         REM CALL Fehler("","")
         req3% = CALL ("_SearchShow",c$)
         IF VAL (c$) <> 0 THEN 
           AdrSuche% = VAL (c$)
           adrfound% = VAL (c$)
           DokSuchen% = AdrSuche%
           REM MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
           ok% = 0
           SET STATUS "Dokument gefunden..."
         END IF 
       ELSE 
         MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
         CREATE DIALOG "ADRLISTE",0,0,440,197,title$,"MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,428,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,124,174,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,184,174,56,16,0,"&Abbrechen",0,0
      
         DIALOG "ADRLISTE",req3%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         REM 200999 Serienbrief
         IF req3% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           AdrSuche% = VAL ( RIGHT$ (LAuswahl$,6))
           DokSuchen% = AdrSuche%
           adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
           ok% = 0
           SET STATUS "Adresse gefunden..."
         ELSE 
           AdrSuche% = 0
           DokSuchen% = 0
         END IF 
       END IF 
      ELSE 
        AdrSuche% = 0
        DokSuchen% = 0
        CALL Fehler("Kein Dokument gefunden, das den Suchkriterien entsprach!","")
        MENU 4,2,0,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
      END IF 
      IF adrfound% > 0 THEN 
        SELECT FORM KEY adrfound% FILE "Dokument" INDEX codedok.dokument
        FORM 
      END IF 
    ELSE 
      DokSuchen% = 0
    END IF 
 END FUNCTION 
 
 
SUB DokSuchen1(codeku%,befehl$)
 IF NOT OPEN (GDokDat$) THEN CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
    opt1% = 1
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("ADRSUCH")
    SET dlg = Superbase.Dialogs.ADRSUCH
    dlg.Move(0,0,222,126)
    dlg.Caption = "Dokumentensuche"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,1,222,66)
    control.Caption = "Suche nach"
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(2,16,20,22)
    control.Icon = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(35,103,64,16)
    control.Default = 1
    control.Caption = "&Suche"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(30,19,106,11)
    control.Caption = "Dokumenten-Namen"
    control.Bind("opt1%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(30,33,106,11)
    control.Caption = "Dokumenten-Nummer"
    control.Bind("opt1%")
    control.ValueOn = 2
    IF codeku% > 0 THEN 
      SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
      control.Move(30,47,106,11)
      control.Caption = "alle Dokumente"
      control.Bind("opt1%")
      control.ValueOn = 3
    END IF 
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(23,72,133,9)
    control.Caption = "Dokument/Dokumenten-Nr:"
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(22,85,179,11)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "suna$"
 
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(100,103,64,16)
    control.Caption = "&Abbruch"
    control.ReturnValue = 0
    control.Cancel = 1
 
    DIALOG "ADRSUCH",req%
    REMOVE DIALOG "ADRSUCH"
 
    tfound% = 0
    MOUSE OFF 
    IF RECCOUNT (GDokDat$) < 20000 THEN 
      REDIM AdrFound$( RECCOUNT (GDokDat$),1)
      REDIM AdrFound$( RECCOUNT (GDokDat$))
      zahl% = RECCOUNT (GDokDat$)
    ELSE 
      REDIM AdrFound$(20000,1)
      REDIM AdrFound$(20000)
      zahl% = 20000
    END IF 
    REM CALL Fehler("","") 
    MOUSE OFF 
    SELECT WHERE FILE GDokDat$
    ggcodie% = GCodie%
    GCodie% = 0
    IF req% = 1 THEN 
      FILE GDokDat$
      IF codeku% < 1 THEN 
        INDEX dokument.GDokDat$
        SELECT WHERE dokument.GDokdat$ LIKE suna$ + "*"
        SELECT FIRST 
      ELSE 
        INDEX codeku.GDokDat$
        SELECT FIRST FILE GDokDat$
        SELECT KEY codeku% FILE GDokDat$ INDEX codeku.GDokDat$
        SELECT WHERE codeku.GDokDat$ = codeku%
        SELECT FIRST 
      END IF 
      
      IF GCODIE% = - 1 THEN 
        CALL SearchInitDo1(GDokDat$)
      END IF 
      
      IF codeku% < 1 THEN WHILE NOT EOF (GDokDat$)
      IF codeku% > 0 THEN WHILE NOT EOF (GDokDat$) AND codeku.GDokDat$ = codeku%
        MOUSE OFF 
        IF opt1% = 3 THEN 
              sok% = - 1
              IF GASP% AND Workstation% > 0 THEN 
                wks% = Workstation.GDOKDAT$
                FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                  wks% = VisOff%(ii%)
                  aa% = IsWksVisible%(wks%)
                  IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                    sok% = - 1
                    ii% = VisCount%
                  ELSE 
                    sok% = 0
                  END IF 
                NEXT ii%
              ELSE 
                sok% = - 1
              END IF 
              IF sok% THEN 
                AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                tfound% = tfound% + 1
                IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
              END IF 
        END IF 
        IF opt1% = 1 THEN 
          IF codeku% < 1 THEN 
            IF dokument.GDokDat$ LIKE suna$ + "*" OR dokument.GDokDat$ LIKE "*" + suna$ + "*" THEN 
              sok% = - 1
              IF GASP% AND Workstation% > 0 THEN 
                wks% = Workstation.GDOKDAT$
                FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                  wks% = VisOff%(ii%)
                  aa% = IsWksVisible%(wks%)
                  IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                    sok% = - 1
                    ii% = VisCount%
                  ELSE 
                    sok% = 0
                  END IF 
                NEXT ii%
              ELSE 
                sok% = - 1
              END IF 
              IF sok% THEN 
                AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                tfound% = tfound% + 1
                IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
              END IF 
            END IF 
          ELSE 
            IF dokument.GDokDat$ LIKE suna$ + "*" OR dokument.GDokDat$ LIKE "*" + suna$ + "*" THEN 
              IF codeku.GDokDat$ = codeku% THEN 
                sok% = - 1
                SELECT KEY codeku.GDokDat$ FILE GADRDat$ INDEX codeku.GADRDat$
                IF GASP% AND Workstation% > 0 THEN 
                  wks% = Workstation.GADRDat$
                  FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                    wks% = VisOff%(ii%)
                    aa% = IsWksVisible%(wks%)
                    IF aa% = - 1 AND Workstation.GADRDat$ = wks% THEN 
                      sok% = - 1
                      ii% = VisCount%
                    ELSE 
                      sok% = 0
                    END IF 
                  NEXT ii%
                ELSE 
                  sok% = - 1
                END IF 
                IF sok% THEN 
                  AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                  tfound% = tfound% + 1
                  IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
                END IF 
              END IF 
            END IF 
          END IF 
        END IF 
        IF opt1% = 2 THEN 
          IF codeku% < 1 THEN 
            IF codedok.GDokDat$ = VAL (suna$) THEN 
              sok% = - 1
              IF GASP% AND Workstation% > 0 THEN 
                wks% = Workstation.GDOKDAT$
                FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                  wks% = VisOff%(ii%)
                  aa% = IsWksVisible%(wks%)
                  IF aa% = - 1 AND Workstation.GDOKDAT$ = wks% THEN 
                    sok% = - 1
                    ii% = VisCount%
                  ELSE 
                    sok% = 0
                  END IF 
                NEXT ii%
              ELSE 
                sok% = - 1
              END IF 
              IF sok% THEN 
                AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                tfound% = tfound% + 1
                IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
              END IF 
            END IF 
          ELSE 
            IF codedok.GDokDat$ = VAL (suna$) THEN 
              IF codeku.GDokDat$ = codeku% THEN 
                sok% = - 1
                SELECT KEY codeku.GDokDat$ FILE GADRDat$ INDEX codeku.GADRDat$
                IF GASP% AND Workstation% > 0 THEN 
                  wks% = Workstation.GADRDat$
                  FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                    wks% = VisOff%(ii%)
                    aa% = IsWksVisible%(wks%)
                    IF aa% = - 1 AND Workstation.GADRDat$ = wks% THEN 
                      sok% = - 1
                      ii% = VisCount%
                    ELSE 
                      sok% = 0
                    END IF 
                  NEXT ii%
                ELSE 
                  sok% = - 1
                END IF 
                IF sok% THEN 
                  AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                  tfound% = tfound% + 1
                  IF GCODIE% = - 1 THEN CALL SearchVorbDO1(GDokDat$)
                END IF 
              END IF 
            END IF 
          END IF 
        END IF 
        MOUSE OFF 
        SELECT NEXT FILE GDokDat$
        SET STATUS Dokument.GDokDat$
      WEND 
      AdrFound$(tfound%) = ""
      adrfound% = 0
      MOUSE ON 
      IF tfound% > 0 THEN 
        IF GCODIE% = - 1 THEN 
         c$ = "aa"
         REM CALL Fehler("","")
         req3% = CALL ("_SearchShow",c$)
         IF VAL (c$) <> 0 THEN 
           AdrSuche% = VAL (c$)
           adrfound% = VAL (c$)
           DokSuchen% = AdrSuche%
           REM IF opt1% = 3 THEN 
             GDoksu1% = AdrSuche%
           REM END IF 
           REM MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
           ok% = 0
           SET STATUS "Dokument gefunden..."
         END IF 
       ELSE 
         MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
         CREATE DIALOG "ADRLISTE",0,0,440,197,title$,"MS Sans Serif",8
         REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
         ADD DIALOG "ADRLISTE",7,5,8,428,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRLISTE",1,124,174,56,16,1,"&OK",1,1
         ADD DIALOG "ADRLISTE",1,184,174,56,16,0,"&Abbrechen",0,0
      
         DIALOG "ADRLISTE",req3%
         MOUSE ON 
         REMOVE DIALOG "ADRLISTE"
         REM 200999 Serienbrief
         IF req3% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           AdrSuche% = VAL ( RIGHT$ (LAuswahl$,6))
           DokSuchen% = AdrSuche%
           adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
           ok% = 0
           IF opt1% = 3 THEN 
             GDoksu1% = adrfound%
           END IF 
           SET STATUS "Adresse gefunden..."
         ELSE 
           AdrSuche% = 0
           DokSuchen% = 0
         END IF 
       END IF 
      ELSE 
        AdrSuche% = 0
        DokSuchen% = 0
        CALL Fehler("Kein Dokument gefunden, das den Suchbedingungen entsprach!","")
        MENU 4,2,0,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
      END IF 
      IF adrfound% > 0 THEN 
        SELECT FIRST FILE GDokDat$ INDEX codedok.GDokDat$
        SELECT FORM KEY adrfound% FILE GDokDat$ INDEX codedok.GDokDat$
        FORM 
      END IF 
    ELSE 
      DokSuchen% = 0
      cudo% = 0
    END IF 
    GCodie% = ggcodie%
    SELECT WHERE FILE GDokDat$
 END SUB 
 
 
SUB DokSuchenold(codeku%)
    opt1% = 1
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("ADRSUCH")
    SET dlg = Superbase.Dialogs.ADRSUCH
    dlg.Move(0,0,222,126)
    dlg.Caption = "Dokumentensuche"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,1,222,56)
    control.Caption = "Suche nach"
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(2,16,20,22)
    control.Icon = 2
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(22,85,179,11)
    control.ScrollEnable = 2
    control.MaxLength = 50
    control.TextBinding = "suna$"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(30,19,106,11)
    control.Caption = "Dokumenten-Namen"
    control.Bind("opt1%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(30,33,106,11)
    control.Caption = "Dokumenten-Nummer"
    control.Bind("opt1%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(23,72,133,9)
    control.Caption = "Dokument/Dokumenten-Nr:"
 
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(35,103,64,16)
    control.Default = 1
    control.Caption = "&Suche"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(100,103,64,16)
    control.Caption = "&Abbruch"
    control.ReturnValue = 0
    control.Cancel = 1
 
    
    DIALOG "ADRSUCH",req%
    
    REMOVE DIALOG "ADRSUCH"
 
    tfound% = 0
    IF RECCOUNT (GDokDat$) < 20000 THEN 
      REDIM AdrFound$( RECCOUNT (GDokDat$))
      zahl% = RECCOUNT (GDokDat$)
    ELSE 
      REDIM AdrFound$(20000)
      zahl% = 20000
    END IF 
    REM FOR i% = 0 TO zahl% - 1
      REM AdrFound$(i%) = ""
    REM NEXT i%
    REM CALL Fehler("","")
    IF req% = 1 THEN 
      FILE GDokDat$
      INDEX dokument.GDokDat$
      SELECT FIRST 
      WHILE NOT EOF (GDokDat$)
        IF opt1% = 1 THEN 
          IF dokument.GDokDat$ LIKE suna$ + "*" OR dokument.GDokDat$ LIKE "*" + suna$ + "*" THEN 
            IF codeku% = 0 THEN 
              AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
              tfound% = tfound% + 1
            ELSE 
              IF codeku.GDokDat$ = codeku% THEN 
                AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                tfound% = tfound% + 1
              END IF 
            END IF 
          END IF 
        ELSE 
          IF codedok.GDokDat$ = VAL (suna$) THEN 
            IF codeku% = 0 THEN 
              AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
              tfound% = tfound% + 1
            ELSE 
              IF codeku.GDokDat$ = codeku% THEN 
                AdrFound$(tfound%) = dokument.GDokDat$ + SPACE$ (250) + STR$ (codedok.GDokDat$,"000000")
                tfound% = tfound% + 1
              END IF 
            END IF 
          END IF 
        END IF 
        SELECT NEXT FILE GDokDat$
      WEND 
      AdrFound$(tfound%) = ""
      adrfound% = 0
      IF tfound% > 0 THEN 
        MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
        CREATE DIALOG "ADRLISTE",0,0,440,197,title$,"MS Sans Serif",8
        REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
        ADD DIALOG "ADRLISTE",7,5,8,428,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
        ADD DIALOG "ADRLISTE",1,124,174,56,16,1,"&OK",1,1
        ADD DIALOG "ADRLISTE",1,184,174,56,16,0,"&Abbrechen",0,0
      
        DIALOG "ADRLISTE",req3%
        MOUSE ON 
        REMOVE DIALOG "ADRLISTE"
        REM 200999 Serienbrief
        IF req3% = 1 THEN 
          LAuswahl$ = LAuswahl1$(0)
          AdrSuche% = VAL ( RIGHT$ (LAuswahl$,6))
          adrfound% = VAL ( RIGHT$ (LAuswahl$,6))
          ok% = 0
          SET STATUS "Adresse gefunden..."
        ELSE 
          AdrSuche% = 0
        END IF 
      ELSE 
        cudo% = 0
        CALL Fehler("Kein Dokument gefunden, das den Suchbedingungen entsprach!","")
        MENU 4,2,0,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
      END IF 
      IF adrfound% > 0 THEN 
        SELECT FORM KEY adrfound% FILE GDokDat$ INDEX codedok.GDokDat$
        FORM 
      END IF 
    END IF 
 END SUB 
 
 
 
 
SUB DokKurzSuche()
 REM IF adrfound% <> 0 THEN 
   IF GCODIE% = - 1 THEN 
     c$ = "aa"
     req3% = CALL ("_SearchReShow",c$)
     IF VAL (c$) <> 0 THEN 
       AdrSuche% = VAL (c$)
       adrfound% = VAL (c$)
       DokSuchen% = AdrSuche%
       GDoksu1% = AdrSuche%
       adr% = AdrSuche%
       cudo% = AdrSuche%
       IF adrfound% <> 0 AND codeku.GDokDat$ = knr% THEN 
         cudo% = CodeDOK.GDokDat$
         SELECT KEY adrfound% FILE GDokDat$ INDEX codedok.GDokDat$
         IF UCASE$ ( FORM ) <> "DOKUMENT" THEN CALL DOKSRV1()
       END IF 
       REM MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
       ok% = 0
       SET STATUS "Dokument gefunden..."
     END IF 
   ELSE 
     prompt% = 0
     FOR a% = 0 TO tfound%
       IF AdrFound$(a%) <> "" AND VAL ( RIGHT$ (Adrfound$(a%),6)) = adrfound% THEN 
         IF prompt% = 0 THEN prompt% = a%
       END IF 
     NEXT a%
     codedok% = Codedok.GDokDat$
     LAuswahl$ = LAuswahl1$(0)
     AdrFound$ = LAuswahl$
     adrfound% = 1
     CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"MS Sans Serif",8
     REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
     ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(prompt%)
     ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
     ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
 
     DIALOG "ADRLISTE",req3%
     MOUSE ON 
     REMOVE DIALOG "ADRLISTE"
     IF req3% = 1 THEN 
       LAuswahl$ = LAuswahl1$(0)
       adr% = VAL ( RIGHT$ (LAuswahl$,6))
        adrfound% = adr%
       ok% = 0
       SET STATUS "Dokument gefunden..."
     ELSE 
       adr% = 0
     END IF 
   END IF 
   IF adr% <> 0 THEN codedok% = adr%
   SELECT FORM KEY codedok% FILE GDokDat$ INDEX Codedok.GDokDat$
   FORM 
   MOUSE ON 
 REM END IF 
 END SUB 
 
 REM Report aus Projekt-pfad
SUB PRep(prep$)
 test$ = GPrjForm$ + prep$ + ".sbv"
 IF EXISTS (GPrjForm$ + prep$ + ".sbv") THEN 
   abc$ = DIRECTORY :DIRECTORY GPrjForm$
   REPORT USING prep$
   DIRECTORY abc$
 ELSE 
   REPORT USING GPrjForm$ + prep$
 END IF 
 END SUB 
 
 REM Report aus office-pfad
SUB ORep(prep$)
 IF EXISTS (GOFFForm$ + prep$ + ".sbv") THEN 
   abc$ = DIRECTORY :DIRECTORY GOFFForm$
   REPORT USING prep$
   DIRECTORY abc$
 ELSE 
   REPORT USING GOFFForm$ + prep$
 END IF 
 END SUB 
 
 
SUB SearchInitADR()
 MOUSE OFF 
 GReShow% = 0
 GCODieRuf% = - 1
 GCODieRuf2% = 0
 MENU 1,9,1,"aus Termin-Suchliste &wÑhlen,F10","TERKurzSuche","Auflistung Termine"
           f1$ = "Kundennr."
           f2$ = FN ansi("Firma/Name")
           f3$ = "Zusatz/Vorname"
           f4$ = "Geburtsname/z.H"
           f5$ = "PLZ"
           f6$ = "Ort"
           f7$ = FN ansi("Stra·e")
           f8$ = "Geburtstag"
           f9$ = "Kunde seit"
           f10$ = "letzter Kontakt"
           f11$ = "Agentur1"
           f12$ = "Agentur2"
           f13$ = "EG-Name"
           f14$ = "Kind 1"
           f15$ = "Kind 2"
           f16$ = "Kind 3"
           f17$ = "T1"
           f18$ = "T2"
           f19$ = "Postanschrift"
           f20$ = "Briefanrede"
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchInitAD1()
 GReShow% = 0
 GCODieRuf% = - 1
           f1$ = "Kundennr"
           f2$ = FN ansi("Firma/Name"):f3$ = "Zusatz/Vorname":f4$ = "Geburtsname/z.H":f5$ = "PLZ":f6$ = "Ort":f7$ = FN ansi("Stra·e")
           f8$ = "Geburtstag":f9$ = "EG-Nachname":f10$ = "EG-Vorname":f11$ = "Kind 1":f12$ = "Kind 2"
           f13$ = "Kind 3":f14$ = "Kind 4":f15$ = "T1":f16$ = "T2":f17$ = "T3"
           f18$ = "T4":f19$ = "T5":f20$ = "Postanschrift"
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit1",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbAdr(datsu$)
               GGGcodeku$ = STR$ (codeku.datsu$,"000000")
               f1$ = FN ansi(Kundennummer.datsu$)
               f2$ = FN ansi(nachname.datsu$)
               f3$ = FN ansi(vorname.datsu$)
               f4$ = FN ansi(geburtsname.datsu$)
               f5$ = FN ansi(plz.datsu$)
               f6$ = FN ansi(ort.datsu$)
               f7$ = FN ansi(stra·e.datsu$)
               IF Geburtstag.datsu$ > 0 THEN 
                 f8$ = DATE$ (Geburtstag.datsu$,"yyyy/mm/0d")
               ELSE 
                 f8$ = ""
               END IF 
               IF Kunde_seit.datsu$ > 0 THEN 
                 f9$ = DATE$ (Kunde_seit.datsu$,"yyyy/mm/0d")
               ELSE 
                 f9$ = ""
               END IF 
               IF letzter_Kontakt.datsu$ > 0 THEN 
                 f10$ = DATE$ (letzter_Kontakt.datsu$,"yyyy/mm/0d")
               ELSE 
                 f10$ = ""
               END IF 
               codema% = codema.datsu$
               codema2% = codema2.datsu$
               SELECT FIRST FILE "maadr" INDEX codema.maadr
               SELECT KEY codema% FILE "maadr" INDEX codema.maadr
               f11$ = FN ansi(Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr)

               SELECT FIRST FILE "maadr" INDEX codema.maadr
               SELECT KEY codema2% FILE "maadr" INDEX codema.maadr
               f12$ = FN ansi(Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr)

               geb$ = ""
               IF EGGeburtstag.datsu$ > 0 THEN 
                 geb$ = DATE$ (EGGeburtstag.datsu$,"yyyy/mm/0d")
               END IF 
               f13$ = FN ansi(EGNachname.datsu$ + "," + EGvorname.datsu$ + " " + geb$)

               geb$ = ""
               IF k1Geburtstag.datsu$ > 0 THEN 
                 geb$ = DATE$ (k1Geburtstag.datsu$,"yyyy/mm/0d")
               END IF 
               f14$ = FN ansi(K1name.datsu$) + " " + geb$

               geb$ = ""
               IF k2Geburtstag.datsu$ > 0 THEN 
                 geb$ = DATE$ (k2Geburtstag.datsu$,"yyyy/mm/0d")
               END IF 
               f15$ = FN ansi(K2name.datsu$) + " " + geb$

               geb$ = ""
               IF k3Geburtstag.datsu$ > 0 THEN 
                 geb$ = DATE$ (k3Geburtstag.datsu$,"yyyy/mm/0d")
               END IF 
               f16$ = FN ansi(K3name.datsu$) + " " + geb$

               geb$ = ""
               IF k4Geburtstag.datsu$ > 0 THEN 
                 geb$ = DATE$ (k4Geburtstag.datsu$,"yyyy/mm/0d")
               END IF 
               REM f17$ = FN ansi(K4name.datsu$) + " " + geb$
               f17$ = ""
               f18$ = ""
               f19$ = LEFT$ ( FN ansi(Postanschrift.datsu$),250):
               f20$ = FN ansi(POSTBriefanrede.datsu$)
  END SUB 
 
SUB SearchVorbTel(datsu$)
                       IF f17$ = "" THEN 
                         f17$ = LTRIM$ (art.GTelDat$ + " " + nummer.GTelDat$)
                       ELSE 
                         IF f18$ = "" THEN 
                           f18$ = LTRIM$ (art.GTelDat$ + " " + nummer.GTelDat$)
                         ELSE 
                           IF f19$ = "" THEN 
                             REM f19$ = LTRIM$ (art.GTelDat$ + " " + nummer.GTelDat$)
                           ELSE 
                             IF f20$ = "" THEN 
                               REM f20$ = LTRIM$ (art.GTelDat$ + " " + nummer.GTelDat$)
                             END IF 
                           END IF 
                         END IF 
                       END IF 
 END SUB 
 
 
 
SUB SearchInitDo1(datsu$)
 GReShow% = 0
 REM CALL Fehler("DoInit","")
 GCODieRuf% = - 1
 GCODieRuf2% = - 1
 GCodieRuf3% = 0
 MENU 1,9,0,"aus Termin-Suchliste &wÑhlen,F10","TERKurzSuche","Auflistung Termine"
           f1$ = "Dokument"
           f2$ = "Dok.gruppe"
           f3$ = "Kunde"
           f4$ = "Bearbeiter"
           f5$ = "letzte Bearbeitung"
           f6$ = "Ersteller"
           f7$ = "Dateiname"
           f8$ = "erstellt am"
 
           f9$ = ""
           f10$ = ""
           f11$ = ""
           f12$ = ""
           f13$ = ""
           f14$ = ""
           f15$ = ""
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbDO1(datsu$)
               GGGcodeku$ = STR$ (codedok.datsu$,"000000")
               f1$ = FN ansi(Dokument.datsu$)
               f2$ = FN ansi(gruppe.datsu$)
               SELECT FIRST FILE GADRDat$ INDEX codeku.GADRDat$
               SELECT KEY codeku.datsu$ FILE GADRDat$ INDEX codeku.GADRDat$
               f3$ = FN ansi(Nachname.GADRDat$ + "," + Vorname.GADRDat$)
               f4$ = FN ansi(Bearbeiter.datsu$)
               f5$ = FN ansi( DATE$ (letzte_Bearbeit.datsu$,"yyyy/mm/0d"))
               f6$ = FN ansi(Creator.datsu$)
               IF dokpass.GDokDat$ = "" THEN 
                 f7$ = FN ansi(Dateiname.datsu$)
               ELSE 
                 f7$ = ""
               END IF 
               f8$ = FN ansi( DATE$ (erstellt_am.datsu$,"yyyy/mm/0d"))
               f9$ = ""
               f10$ = ""
               f11$ = ""
               f12$ = ""
               f13$ = ""
               f14$ = ""
               f15$ = ""
               f16$ = ""
               f17$ = "":f18$ = "":f19$ = "":f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 
 
 REM t$ = TIME$ (Uhrzeit.GAkquiDat$,"hh:mm") + ";" + erledigt_Termin.GAkquiDat$ + " |" + Bearbeiter.GAkquiDat$ + " |"
 REM Termine$(tfound%) = DATE$ (Termin.GAkquiDat$,"yyyy/mm/0d") + "; " + t$ + "; " + LEFT$ ( TRIM$ (nachname.GAkquiDat$)) + "/" + LEFT$ ( TRIM$ (notiz.GAkquiDat$),100) + SPACE$ (160) + STR$ (CodeAQ.GAkquiDat$,"000000")
 
SUB SearchInitAq1(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq1","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf1% = - 1
 GCODieRuf2% = 0
 GCodieRuf3% = 0
 MENU 1,9,1,"aus Termin-Suchliste &wÑhlen,F10","TERKurzSuche","Auflistung Termine"
           f1$ = "Aktion"
           f2$ = "Erf.Datum"
           f3$ = "Termin"
           f4$ = "Uhrzeit"
           f5$ = "Dauer"
           f6$ = "erledigt"
           f7$ = "Bearbeiter"
           f8$ = "Kunde"
           f9$ = "Notiz"
           f10$ = ""
           f11$ = ""
           f12$ = ""
           f13$ = ""
           f14$ = ""
           f15$ = ""
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbAq1(datsu$)
   IF NOT OPEN ("AKTIONEN") THEN CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 GCODieRuf1% = GCODieRuf1% - 1
               GGGcodeku$ = STR$ (codeaq.datsu$,"000000")
               text1$ = ""
               IF emailbetreff.akquise <> "" AND emailto.akquise <> "" THEN 
                 text1$ = "EMAIL"
                 IF EMAILRaus.akquise = "j" THEN 
                   text1$ = text1$ + " erledigt"
                 ELSE 
                   text1$ = text1$ + " offen"
                 END IF 
                 IF EMAILAutomat.akquise = "j" THEN 
                   text1$ = text1$ + " autom."
                 ELSE 
                   text1$ = text1$ + " manu."
                 END IF 
               END IF 
               code% = codeaq.datsu$
               SELECT KEY code% FILE "akquise" INDEX codeaq.akquise
               codeak% = codeak.akquise
               SELECT KEY codeak% FILE "AKTIONEN" INDEX codeak.aktionen
               bezak$ = bezeichnung.aktionen
               REM f1$ = text1$
               f1$ = FN ansi(bezak$)
               f2$ = FN ansi( DATE$ (Datum.datsu$,"yyyy/mm/0d"))
               f3$ = FN ansi( DATE$ (Termin.datsu$,"yyyy/mm/0d"))
               f4$ = FN ansi( TIME$ (Uhrzeit.datsu$,"hh:mm"))
               f5$ = FN ansi( LTRIM$ ( STR$ (dauer.datsu$,"999")))
               f6$ = FN ansi(erledigt_Termin.datsu$)
               f7$ = FN ansi(Bearbeiter.datsu$)
               f8$ = FN ansi(nachname.datsu$)
               f9$ = FN ansi( LEFT$ (notiz.datsu$,255))
               f10$ = ""
               f11$ = ""
               f12$ = ""
               f13$ = ""
               f14$ = ""
               f15$ = ""
               f16$ = ""
               f17$ = "":f18$ = "":f19$ = "":f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 
  REM tt$ = DATE$ (termin.tvorlage,"yyyy/mm/0d") + " " + TIME$ (uhrzeit.tvorlage,"hh:mm") + "  "
  REM TV$(tfound1%) = DATE$ (datum.tvorlage,"yyyy/mm/0d") + " " + TIME$ (zeit.tvorlage,"hh:mm") + "  " + tt$ + nn$ + " / " + LEFT$ (Notiz.tvorlage,100) + CHR$ (100) + STR$ (codeaq.tvorlage,"000000")
SUB SearchInitAq2(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq2","")
 GCODieRuf1% = - 1
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf2% = 0
 GCodieRuf3% = - 1
 MENU 1,9,1,"aus Termin-Suchliste &wÑhlen,F10","TERKurzSuche","Auflistung Termine"
           f1$ = "Aktion"
           f2$ = "VTermin"
           f3$ = "VUhrzeit"
           f4$ = "Termin"
           f5$ = "Uhrzeit"
           f6$ = "Kunde"
           f7$ = "Notiz"
           f8$ = "Ergebnis"
           f9$ = ""
           f10$ = ""
           f11$ = ""
           f12$ = ""
           f13$ = ""
           f14$ = ""
           f15$ = ""
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbAq2(datsu$)
  IF NOT OPEN ("AKTIONEN") THEN CALL DFile(2,"OFFICE\aktionen" + _fpw$)
   GCODieRuf1% = GCODieRuf1% - 1
   REM IF EMAILRaus.AKQUISE <> "j" AND EMAILAutomat.AkquiSE = "j" THEN 
               GGGcodeku$ = STR$ (codeaq.datsu$,"000000")
               code% = codeaq.datsu$
               SELECT KEY code% FILE "akquise" INDEX codeaq.akquise
               codeak% = codeak.akquise
               SELECT KEY codeak% FILE "AKTIONEN" INDEX codeak.aktionen
               bezak$ = bezeichnung.aktionen
               REM SELECT KEY code% FILE "akquise" INDEX codeaq.akquise
               text1$ = ""
               IF emailbetreff.akquise <> "" AND emailto.akquise <> "" THEN 
                 text1$ = "EMAIL"
                 IF EMAILRaus.akquise LIKE "j" THEN 
                   text1$ = text1$ + " erledigt"
                 ELSE 
                   text1$ = text1$ + " offen"
                 END IF 
                 REM t$ = EMAILAutomat.akquise
                 IF EMAILAutomat.akquise LIKE "j" THEN 
                   text1$ = text1$ + " autom."
                 ELSE 
                   text1$ = text1$ + " manu."
                 END IF 
               END IF 
               REM CALL Fehler(text1$,GGGcodeku$)
               REM f1$ = text1$
               f1$ = FN ansi(bezak$)
               f2$ = FN ansi( DATE$ (datum.datsu$,"yyyy/mm/0d"))
               f3$ = FN ansi( TIME$ (zeit.datsu$,"hh:mm"))
               f4$ = FN ansi( DATE$ (termin.datsu$,"yyyy/mm/0d"))
               f5$ = FN ansi( TIME$ (uhrzeit.datsu$,"hh:mm"))
               f6$ = FN ansi(nachname.datsu$)
               f7$ = FN ansi( LEFT$ (notiz.datsu$,255))
               f8$ = FN ansi( LEFT$ (Ergebnis.datsu$,255))
               f9$ = ""
               f10$ = ""
               f11$ = ""
               f12$ = ""
               f13$ = ""
               f14$ = ""
               f15$ = ""
               f16$ = ""
               f17$ = "":f18$ = "":f19$ = "":f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 
 
 
SUB SearchInitVe1(datsu$)
 GReShow% = 0
 REM CALL Fehler("DoInit","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 
 GCODieRuf% = - 1
 GCODieRuf2% = - 1
 GCodieRuf3% = 0
 REM MENU 1,9,0,"aus Termin-Suchliste &wÑhlen,F10","TERKurzSuche","Auflistung Termine"
           f1$ = "VN"
           f2$ = "Police-NR"
           f3$ = "Antragsnr"
           f4$ = "Inhouse"
           f5$ = "Gesellschaft"
           f6$ = "Sparte"
           f7$ = FN ansi("eingereicht Åber")
           f8$ = "Erfassung"
           f9$ = "Beginn"
           f10$ = "Ablauf"
           f11$ = "Policedatum"
           f12$ = "Beitrag"
           f13$ = "ZW"
           f14$ = "Vers.summe"
           f15$ = "Einheiten"
           f16$ = "Vermittler"
           f17$ = "Kennzeichen"
           f18$ = "Fabrikat"
           f19$ = "Typ"
           f20$ = ""
           REM f18$ = "ZVP4"
           REM f19$ = "ZVP5"
           REM f20$ = "ZVP6"
 SPath$ = GMACodeDir$
 IF EXISTS (GMACodeDir$ + "search.dat") THEN 
   DELETE GMACodeDir$ + "search.*"
   COPY _netpath$ + "local\search.dat",GMACodeDir$ + "search.dat"
   COPY _netpath$ + "local\search.idx",GMACodeDir$ + "search.idx"
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbVe1(datsu$)
               GGGcodeku$ = STR$ (lfdnr.datsu$,"000000")
               f1$ = FN ansi(VNehmer.datsu$)
               f2$ = FN ansi(VS_NR.datsu$)
               f3$ = FN ansi(ANTRAGSNR.datsu$)
               IF inhaus.datsu$ = 1 THEN 
                 f4$ = "J"
               ELSE 
                 f4$ = "N"
               END IF 
               f5$ = FN ansi(Gesellschaft.datsu$)
               f6$ = FN ansi(Sparte.datsu$)
               f7$ = ""
               IF MNdisabled%("SEEEINGBEI") THEN 
               ELSE 
                 f7$ = FN ansi(Eingereichtbei.kvertrag)
               END IF 

               f8$ = FN ansi( DATE$ (ErfasDatum.datsu$,"yyyy/mm/0d"))
               f9$ = FN ansi( DATE$ (VS_Beginn.datsu$,"yyyy/mm/0d"))
               f10$ = FN ansi( DATE$ (KÅndigung.datsu$,"yyyy/mm/0d"))
               f11$ = FN ansi( DATE$ (Policedatum.datsu$,"yyyy/mm/0d"))
               f12$ = LTRIM$ ( STR$ (Beitrag.datsu$,",999999999.00"))
               f13$ = FN ansi(ZW2Str$(ZW.datsu$))
               f14$ = LTRIM$ ( STR$ (Vsumme.datsu$,",999999999.00"))
               f15$ = LTRIM$ ( STR$ (Einheiten.datsu$,",9999999.0000"))
               SELECT FIRST FILE "maadr" INDEX codema.maadr
               SELECT KEY codema.datsu$ FILE "maadr" INDEX codema.maadr
               f16$ = FN ansi(Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr)
               REM f11$ = FN ansi(waehrung.datsu$)
               f17$ = FN ansi(Kennzeichen.datsu$)
               f18$ = FN ansi(Fabrikat.datsu$)
               f19$ = FN ansi(Typ_NR.datsu$)
               
               f20$ = ""
               REM f18$ = ""
               REM f19$ = ""
               REM f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 



 REM ******************  Suche fÅr ZahlungseingÑnge 27.01.2005 Anfang *****************************************************************
SUB SearchInitZE1(datsu$)
 GReShow% = 0
 REM CALL Fehler("DoInit","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 
 GCODieRuf% = - 1
 GCODieRuf2% = - 1
 GCodieRuf3% = 0

 REM x$ = gebuchtJN.zeingan1
 REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
 REM VS_Nr.zeingan1-FÑlligkeit.zeingan1 -bewertung.zeingan1-gebuchtJN.zeingan1
 REM  yy$ + "  " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")

 REM MENU 1,9,0,"aus Termin-Suchliste &wÑhlen,F10","TERKurzSuche","Auflistung Termine"
           
           f1$ = "VS-NR"
           f2$ = "Buchungsdatum"
           f3$ = FN ansi("FÑlligkeit")
           f4$ = "Betrag"
           f5$ = "Buchungstext"
           f6$ = "gebucht J/N"
           f7$ = "Gesellschaft"
           f8$ = "Sparte"
           f9$ = FN ansi("vertragsabschlie·ende Agentur")
           f10$ = "Vertrags Nehmer"
           f11$ = "Vertragsbeginn"
           f12$ = "Bewertungssumme"
           f13$ = "Beitrag"
           f14$ = "zahlweise"
           f15$ = "Proviionssperre J/N"
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 SPath$ = GMACodeDir$
 IF EXISTS (GMACodeDir$ + "search.dat") THEN 
   DELETE GMACodeDir$ + "search.*"
   COPY _netpath$ + "local\search.dat",GMACodeDir$ + "search.dat"
   COPY _netpath$ + "local\search.idx",GMACodeDir$ + "search.idx"
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbZE1(datsu$)
               GGGcodeku$ = STR$ (CodeAZ.datsu$,"000000")
               SELECT KEY codevt.datsu$ FILE "kvertrag" INDEX lfdnr.kvertrag
               f1$ = FN ansi(VS_Nr.kvertrag)
               f2$ = DATE$ (BuchungsDatum.datsu$,"yyyy/mm/0d")
               f3$ = DATE$ (FÑlligkeit.datsu$,"yyyy/mm/0d")
               f4$ = STR$ (Bewertung.datsu$,",99999999.00")
               f4$ = Waehrung.datsu$ + PAD$ (f4$,15)
               f5$ = FN ansi(Buchungstext.datsu$)
               f6$ = FN ansi(gebuchtJN.datsu$)

               f7$ = FN ansi(Gesellschaft.kvertrag)
               f8$ = FN ansi(Sparte.kvertrag)
               f9$ = FN ansi(Agentur.kvertrag)
               f10$ = FN ansi(VNehmer.kvertrag)
               f11$ = DATE$ (VS_Beginn.kvertrag,"yyyy/mm/0d")

               f12$ = STR$ (Bewertungssumme.kvertrag,",99999999.00")
               f12$ = Waehrung.kvertrag + PAD$ (f12$,15)
               f13$ = STR$ (Beitrag.kvertrag,",99999999.00")
               f13$ = Waehrung.kvertrag + PAD$ (f13$,15)
             SELECT CASE zw.kvertrag
               CASE 0
                 zw$ = "Einmalig"
               CASE 1
                 zw$ = "JÑhrlich"
               CASE 4
                 zw$ = "VierteljÑhrlich"
               CASE 2
                 zw$ = "HalbjÑhrlich"
               CASE 6
                 zw$ = "2monatlich"
               CASE 12
                 zw$ = "Monatlich"
             END SELECT 
               f14$ = FN ansi(zw$)
               IF ProvSperreJN.kvertrag LIKE "j" THEN 
                 pjn$ = "J"
               ELSE 
                 pjn$ = "N"
               END IF 
               f15$ = pjn$
               f16$ = ""
               f17$ = ""
               f18$ = ""
               f19$ = ""
               f20$ = ""
               REM f18$ = ""
               REM f19$ = ""
               REM f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 REM ******************  Suche fÅr ZahlungseingÑnge 27.01.2005 Ende   *****************************************************************
 
 REM ******************  Suche fÅr Gesellschaften 05.04.2009  *************************************************************************
SUB SearchInitGE1(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq1","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf1% = - 1
 GCODieRuf2% = 0
 GCodieRuf3% = 0
 MENU 2,6,1,"aus Suchliste &wÑhlen,F7","GESKurzSuche","Auflistung Geselschaften"
           
           f1$ = "Gesellschaft1"
           f2$ = "Gesellschaft2"
           f3$ = "PLZ"
           f4$ = "Ort"
           f5$ = "Strasse"
           f6$ = "Ansprechpartner"
           f7$ = "Land"
           f8$ = "Telefon1"
           f9$ = "Telefon2"
           f10$ = "Fax"
           f11$ = "EMAIL"
           f12$ = "WWW"
           f13$ = "Bank"
           f14$ = "BLZ"
           f15$ = "Konto"
           f16$ = "Swift"
           f17$ = "nicht anzeigen"
           f18$ = "eingereicht ueber"
           f19$ = "Postanschrift"
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbGE1(datsu$)
 GCODieRuf1% = GCODieRuf1% - 1
               GGGcodeku$ = STR$ (codege.datsu$,"000000")
               text1$ = ""
               f1$ = FN ansi(Gesellschaft.datsu$)
               IF NoAnzeige.geadr LIKE "j" THEN f1$ = f1$ + " ****"
               IF Inhaus.geadr = 1 THEN f1$ = f1$ + " ++++INHOUSE++++ "
               f2$ = FN ansi(Gesellschaft2.datsu$)
               f3$ = FN ansi(PLZ.datsu$)
               f4$ = FN ansi(Ort.datsu$)
               f5$ = FN ansi(Stra·e.datsu$)
               f6$ = FN ansi(Nachname.datsu$ + ", " + Vorname.datsu$)
               f7$ = FN ansi(Land.datsu$)
               f8$ = FN ansi(Telefon1.datsu$)
               f9$ = FN ansi(Telefon2.datsu$)
               f10$ = FN ansi(Telefax.datsu$)
               f11$ = FN ansi(email.datsu$)
               f12$ = FN ansi(www.datsu$)
               f13$ = FN ansi(K1Bank.datsu$)
               f14$ = FN ansi(K1BLZ.datsu$)
               f15$ = FN ansi(K1Konto.datsu$)
               f16$ = FN ansi(Swift.datsu$)
               f17$ = FN ansi(noAnzeige.datsu$)
               f18$ = FN ansi(eingueb.datsu$)
               f19$ = FN ansi(Postanschrift.datsu$)
               f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 

SUB SearchInitGE2(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq1","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf1% = - 1
 GCODieRuf2% = 0
 GCodieRuf3% = 0
 MENU 2,6,1,"aus Suchliste &wÑhlen,F7","GESKurzSuche","Auflistung Geselschaften"
           f1$ = "Gesellschaftsgruppe"
           f2$ = "Gesellschaft1"
           f3$ = "Gesellschaft2"
           f4$ = "PLZ"
           f5$ = "Ort"
           f6$ = "Strasse"
           f7$ = "Ansprechpartner"
           f8$ = "Land"
           f9$ = "Telefon1"
           f10$ = "Telefon2"
           f11$ = "Fax"
           f12$ = "EMAIL"
           f13$ = "WWW"
           f14$ = "Bank"
           f15$ = "BLZ"
           f16$ = "Konto"
           f17$ = "Swift"
           f18$ = "nicht anzeigen"
           f19$ = "eingereicht ueber"
           f20$ = "Postanschrift"
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbGE2(datsu$)
 GCODieRuf1% = GCODieRuf1% - 1
               GGGcodeku$ = STR$ (codege.datsu$,"000000")
               text1$ = ""
               f1$ = FN ansi(GEGRuppe.datsu$)
               f2$ = FN ansi(Gesellschaft.datsu$)
               IF NoAnzeige.geadr LIKE "j" THEN f2$ = f2$ + " ****"
               IF Inhaus.geadr = 1 THEN f2$ = f2$ + " ++++INHOUSE++++ "
               f3$ = FN ansi(Gesellschaft2.datsu$)
               f4$ = FN ansi(PLZ.datsu$)
               f5$ = FN ansi(Ort.datsu$)
               f6$ = FN ansi(Stra·e.datsu$)
               f7$ = FN ansi(Nachname.datsu$ + ", " + Vorname.datsu$)
               f8$ = FN ansi(Land.datsu$)
               f9$ = FN ansi(Telefon1.datsu$)
               f10$ = FN ansi(Telefon2.datsu$)
               f11$ = FN ansi(Telefax.datsu$)
               f12$ = FN ansi(email.datsu$)
               f13$ = FN ansi(www.datsu$)
               f14$ = FN ansi(K1Bank.datsu$)
               f15$ = FN ansi(K1BLZ.datsu$)
               f16$ = FN ansi(K1Konto.datsu$)
               f17$ = FN ansi(Swift.datsu$)
               f18$ = FN ansi(noAnzeige.datsu$)
               f19$ = FN ansi(eingueb.datsu$)
               f20$ = FN ansi(Postanschrift.datsu$)
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 

 REM ******************  Suche fÅr Gesellschaften 05.04.2009  Ende *************************************************************************
  

 REM ******************  Suche fÅr Sparten 05.04.2009  *************************************************************************
SUB SearchInitSp1(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq1","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf1% = - 1
 GCODieRuf2% = 0
 GCodieRuf3% = 0
 MENU 2,5,1,"aus Suchliste &wÑhlen,F7","SpKurzSuche","Auflistung Sparten"
           f1$ = "Sparte"
           f2$ = "Tarifinfo"
           f3$ = "VST"
           f4$ = "Spartentyp"
           f5$ = "Spartengruppe"
           f6$ = "Formular"
           f7$ = "GDV-Standard"
           f8$ = "Aktualisierung"
           f9$ = "GDV-Hauptsparte"
           f10$ = "GDV-Untersparte"
           f11$ = ""
           f12$ = ""
           f13$ = ""
           f14$ = ""
           f15$ = ""
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbSp1(datsu$)
 GCODieRuf1% = GCODieRuf1% - 1
               GGGcodeku$ = STR$ (codeva.datsu$,"000000")
               text1$ = ""
               f1$ = FN ansi(Sparte.datsu$)
               f2$ = FN ansi(Tarif.datsu$)
               f3$ = FN ansi( LTRIM$ ( STR$ (VST.datsu$,",999.00")))
               IF SparteIstSach.datsu$ = 0 THEN f4$ = "Sach"
               IF SparteIstSach.datsu$ = 1 THEN f4$ = "Leben"
               IF SparteIstSach.datsu$ = 2 THEN f4$ = "andere"
               f5$ = ""
               IF codegrsp.datsu$ > 0 THEN 
                 SELECT KEY codegrsp.sparten FILE "spgruppe" INDEX codegrsp.spgruppe
                 f5$ = FN ansi(Gruppe.spgruppe)
               END IF 
               f6$ = ""
               SELECT KEY Formular.datsu$ FILE "Formular" INDEX formular.formular
               f6$ = FN ansi(Formularname.formular)
               IF GDVStandardSpar.datsu$ = 1 THEN 
                 f7$ = "j"
               ELSE 
                 f7$ = "n"
               END IF 
               f8$ = GDVImport.datsu$
               f9$ = FN ansi( LTRIM$ ( STR$ (Hauptsparte.datsu$,"000")))
               f10$ = FN ansi( LTRIM$ ( STR$ (Untersparte.datsu$,"000")))
               f12$ = ""
               f13$ = ""
               f14$ = ""
               f15$ = ""
               f16$ = ""
               f17$ = "":f18$ = "":f19$ = "":f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 REM ******************  Suche fÅr Gesellschaften 05.04.2009  Ende *************************************************************************
  
 REM ******************  Suche fÅr Vermittler 05.04.2009  *************************************************************************
SUB SearchInitMA1(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq1","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf1% = - 1
 GCODieRuf2% = 0
 GCodieRuf3% = 0
 MENU 2,8,1,"aus Suchliste &wÑhlen,F7","MAKurzSuche","Auflistung Geselschaften"
           f1$ = "Verm-Nr."
           f2$ = "Firmen-Name"
           f3$ = "Nachname"
           f4$ = "Vorname"
           f5$ = "PLZ"
           f6$ = "Ort"
           f7$ = "Strasse"
           f8$ = "Land"
           f9$ = "Telefon1"
           f10$ = "Telefon2"
           f11$ = "EMAIL"
           f12$ = "Geburtstag"
           f13$ = "Bank"
           f14$ = "BLZ"
           f15$ = "Konto"
           f16$ = "IBAN"
           f17$ = "Swift"
           f18$ = "Kontoinhaber"
           
           f19$ = "Vorgaenger"
           f20$ = "Postanschrift"
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbMA1(datsu$)
 GCODieRuf1% = GCODieRuf1% - 1
               GGGcodeku$ = STR$ (codema.datsu$,"000000")
               text1$ = ""
               
               f1$ = FN ansi(Agenturnr.datsu$)
               IF NoAnzeige.maadr LIKE "j" THEN 
                 f1$ = FN ansi(Agenturnr.datsu$) + " * "
               END IF 
               IF inhaus.maadr = 1 THEN 
                 f1$ = FN ansi(Agenturnr.datsu$) + " *INH* "
               END IF 
               END IF 
               f2$ = FN ansi(FirmaName.datsu$)
               f3$ = FN ansi(Nachname.datsu$)
               REM CALL Fehler(f3$,"")
               f4$ = FN ansi(Vorname.datsu$)
               f5$ = FN ansi(PLZ.datsu$)
               f6$ = FN ansi(Ort.datsu$)
               f7$ = FN ansi(Stra·e.datsu$)
               f8$ = FN ansi(Land.datsu$)
               f9$ = FN ansi(Telefon1.datsu$)
               f10$ = FN ansi(Telefon2.datsu$)
 
               f11$ = FN ansi(email.datsu$)
               f12$ = ""
               IF geburtstag.datsu$ > 0 THEN 
                 f12$ = DATE$ (geburtstag.datsu$,"0d.mm.yyyy")
                 
               END IF 
               f13$ = FN ansi(K1Bank.datsu$)
               f14$ = FN ansi(K1BLZ.datsu$)
               f15$ = FN ansi(K1Konto.datsu$)
               f16$ = FN ansi(IBAN.datsu$)
               f17$ = FN ansi(Swift.datsu$)
               f18$ = FN ansi(Kontoinhaber.datsu$)
               f19$ = ""
               cuma% = CodeMA.MAADR
               IF VorgÑnger.MAADR <> 0 THEN 
                 cuma% = CodeMA.MAADR
                 IF EXISTS (VorgÑnger.MAADR,CodeMA.MAADR) THEN 
                   REM SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
                   SELECT KEY VorgÑnger.MAADR FILE "MAADR" INDEX CodeMA.MAADR
                   vorgaenger$ = Nachname.MAADR + ", " + LTRIM$ (Vorname.MAADR) + "," + LTRIM$ (Agenturnr.maadr) + ",Inf: " + Information.maadr
                   f19$ = FN ansi(vorgaenger$)
                 END IF 
                 REM SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
                 SELECT KEY cuma% FILE "MAADR" INDEX CodeMA.MAADR
               ELSE 
                 f19$ = "<keine Zuordnung>"
               END IF 
               f20$ = FN ansi(Postanschrift.datsu$)
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 REM ******************  Suche fÅr Vermittler 05.04.2009  Ende *************************************************************************
  
 REM ******************  Suche fÅr Vermittler 05.04.2009  *************************************************************************
SUB SearchInitMA2(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq1","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf1% = - 1
 GCODieRuf2% = 0
 GCodieRuf3% = 0
 MENU 2,5,1,"aus Suchliste &wÑhlen,F7","SuKurzSuche","Auflistung Geselschaften"
           f1$ = "Mitarbeiter-Nachname"
           f2$ = "Vorname"
           f3$ = "PLZ"
           f4$ = "Ort"
           f5$ = "Strasse"
           f6$ = "Land"
           f7$ = "Telefon1"
           f8$ = "Handy"
           f9$ = "Fax"
           f10$ = "email"
           f11$ = ""
           f12$ = ""
           f13$ = ""
           f14$ = ""
           f15$ = ""
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbMA2(datsu$)
 GCODieRuf1% = GCODieRuf1% - 1
               GGGcodeku$ = STR$ (codema.datsu$,"000000")
               text1$ = ""
               f1$ = FN ansi(Nachname.datsu$)
               f2$ = FN ansi(Vorname.datsu$)
               f3$ = FN ansi(PPLZ.datsu$)
               f4$ = FN ansi(POrt.datsu$)
               f5$ = FN ansi(PStrasse.datsu$)
               f6$ = FN ansi(PLand.datsu$)
               f7$ = FN ansi(PTelefon.datsu$)
               f8$ = FN ansi(PHandy.datsu$)
               f9$ = FN ansi(PFax.datsu$)
               f10$ = FN ansi(pemail.datsu$)
               f11$ = ""
               f12$ = ""
               f13$ = ""
               f14$ = ""
               f15$ = ""
               f16$ = ""
               f17$ = "":f18$ = "":f19$ = "":f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 REM ******************  Suche fÅr Vermittler 05.04.2009  Ende *************************************************************************
  

  
 REM ******************  Suche fÅr Telefon 12.04.2009  *************************************************************************
SUB SearchInitTelA(datsu$)
 GReShow% = 0
 REM CALL Fehler("SearchInitAq1","")
   IF GCODieRuf% = - 1 THEN 
     ret% = CALL ("_SearchClose")
     GCODieRuf% = 0
   END IF 
 GCODieRuf1% = - 1
 GCODieRuf2% = 0
 GCodieRuf3% = 0
 MENU 2,5,1,"aus Suchliste &wÑhlen,F7","SuKurzTel","Auflistung Telefon"
           f1$ = "Art Kommunikation"
           f2$ = "Nummer"
           f3$ = "Merkmal1"
           f4$ = "Merkmal2"
           f5$ = ""
           f6$ = ""
           f7$ = ""
           f8$ = ""
           f9$ = ""
           f10$ = ""
           f11$ = ""
           f12$ = ""
           f13$ = ""
           f14$ = ""
           f15$ = ""
           f16$ = ""
           f17$ = ""
           f18$ = ""
           f19$ = ""
           f20$ = ""
 IF GASP% THEN 
   SPath$ = _netpath$ + "\" + STR$ (GMACodeMA%,"00000000")
 ELSE 
   SPath$ = GMACodeDir$
 END IF 
 ret% = CALL ("_SearchInit",SPath$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
 END SUB 
  
SUB SearchVorbTelA(datsu$)
 GCODieRuf1% = GCODieRuf1% - 1
               GGGcodeku$ = STR$ (codetel.datsu$,"000000")
               text1$ = ""
               f1$ = FN ansi(Art.datsu$)
               f2$ = FN ansi(Nummer.datsu$)
               f3$ = FN ansi(Kart1.datsu$)
               f4$ = FN ansi(Kart2.datsu$)
               f5$ = ""
               f6$ = ""
               f7$ = ""
               f8$ = ""
               f9$ = ""
               f10$ = ""
               f11$ = ""
               f12$ = ""
               f13$ = ""
               f14$ = ""
               f15$ = ""
               f16$ = ""
               f17$ = "":f18$ = "":f19$ = "":f20$ = ""
               REM CALL Fehler("DoFill1","")
  ret% = CALL ("_SearchFill",GGGcodeku$,f1$,f2$,f3$,f4$,f5$,f6$,f7$,f8$,f9$,f10$,f11$,f12$,f13$,f14$,f15$,f16$,f17$,f18$,f19$,f20$)
  END SUB 
 
 REM ******************  Suche fÅr Vermittler 05.04.2009  Ende *************************************************************************
  
 







 
 
FUNCTION GetCodeMASU%(prompt%,wks%)
 DIM Agenturen$( RECCOUNT ("SUPERVIS") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 _pos% = CodeMA.supervis
 alle$ = "n"
AnfAlle200220021: 
 FILE "supervis"
 INDEX Nachname.supervis
 SELECT FIRST 
 REM Agenturen$(0) = "<keine Zuordnung>" + SPACE$ (120) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("supervis")
   sok% = - 1
   IF GASP% THEN 
     IF workstation% > 0 THEN 
       FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
         wks% = VisOff%(ii%)
         aa% = IsWksVisible%(wks%)
         IF aa% = - 1 AND CodeMa.supervis <> 0 AND workstation.supervis = wks% THEN 
           sok% = - 1
           ii% = VisCount%
         ELSE 
           sok% = 0
         END IF 
       NEXT ii%
     END IF 
   END IF 
   IF sok% THEN 
     IF GASP% THEN 
       SELECT FIRST FILE "filiale" INDEX filialnr.filiale
       SELECT KEY Workstation.supervis FILE "filiale" INDEX filialnr.filiale
       filab$ = Name.filiale
     END IF 
     IF nachname.supervis <> "" THEN 
       IF alle$ <> "j" THEN 
         test$ = PAD$ (Nachname.supervis + ", " + Vorname.supervis,40)
         Agenturen$(a%) = test$ + " "
       ELSE 
         test$ = PAD$ (Nachname.supervis + ", " + Vorname.supervis,30)
         IF NoAnzeige.supervis LIKE "j" THEN 
           Agenturen$(a%) = test$ + " " + 
         ELSE 
           Agenturen$(a%) = test$ + " " + 
         END IF 
       END IF 
       IF GASP% THEN 
         Agenturen$(a%) = Agenturen$(a%) + "    " + "   " + filab$
       END IF 
       Agenturen$(a%) = Agenturen$(a%) + SPACE$ (120) + STR$ (CodeMA.supervis,"000000")
       IF CodeMA.supervis = prompt% THEN prompt$ = Agenturen$(a%)
       a% = a% + 1
     END IF 
   END IF 
   SELECT NEXT 
 WEND 
 
 IF alle$ <> "j" THEN 
   IF GASP% THEN 
     CREATE DIALOG "MASUCH",0,0,380,284,"Agentur-/VermittlerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
   ELSE 
     CREATE DIALOG "MASUCH",0,0,308,284,"Agentur-/VermittlerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
   END IF 
 ELSE 
   IF GASP% THEN 
     CREATE DIALOG "MASUCH",0,0,380,284,"Agentur-/VermittlerÅbersicht aller Vermittler","Courier New",10
   ELSE 
     CREATE DIALOG "MASUCH",0,0,308,284,"Agentur-/VermittlerÅbersicht aller Vermittler","Courier New",10
   END IF 
 END IF 
 IF GASP% THEN 
   ADD DIALOG "MASUCH",4,0,0,380,263,0,""
 ELSE 
   ADD DIALOG "MASUCH",4,0,0,308,263,0,""
 END IF 
 ADD DIALOG "MASUCH",9,5,5,21,21,2
 ADD DIALOG "MASUCH",5,17,5,371,10,0,"Bitte wÑhlen Sie einen Mitarbeiter aus, dessen Zugriffsrechte Åbernommen werden sollen:"
 IF alle$ <> "j" THEN 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",5,37,15,300,10,0,"Mitarbeiter                               BÅro"
   ELSE 
     ADD DIALOG "MASUCH",5,37,15,250,10,0,"Mitarbeiter            "
   END IF 
 ELSE 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",5,37,15,300,10,0,"Mitarbeiter   BÅro    ausgeblendet"
   ELSE 
     ADD DIALOG "MASUCH",5,37,15,260,10,0,"Mitarbeiter    ausgeblendet"
   END IF 
 END IF 
 IF GASP% THEN 
   ADD DIALOG "MASUCH",7,7,27,368,229,2,2,Agenturen$,Auswahl$,prompt$
 ELSE 
   ADD DIALOG "MASUCH",7,7,27,298,229,2,2,Agenturen$,Auswahl$,prompt$
 END IF 
 ADD DIALOG "MASUCH",1,56,268,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,113,268,55,15,0,"&Abbrechen",0,0
 REM IF alle$ <> "j" THEN ADD DIALOG "MASUCH",1,173,268,65,15,0,"Alle anzeigen",2,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 IF req% = 2 THEN 
   REDIM Agenturen$( RECCOUNT ("supervis") + 1,1)
   REDIM Agenturen$( RECCOUNT ("supervis") + 1)
   alle$ = "j"
   REM GOTO AnfAlle200220021
 END IF 
 IF req% = 1 THEN 
   GetCodeMASU% = VAL ( RIGHT$ (Auswahl$(0),6))
 ELSE 
   GetCodeMASU% = 0
 END IF 
 IF GetCodeMASU% > 0 THEN 
   SELECT KEY GetCodeMASU% FILE "supervis" INDEX CodeMA.supervis
 END IF 
 FILE cfile$
 END FUNCTION 
 
SUB TERKurzSuche()
      IF GCODIE% = - 1 THEN 
       c$ = "aa"
       REM CALL Fehler("","")
       req3% = CALL ("_SearchReShow",c$)
       REM CALL Fehler( STR$ (req%),"")
       IF req3% = 3 THEN 
         req% = 2
       ELSE 
         IF VAL (c$) <> 0 THEN 
           req% = 1
           _cuaq% = VAL (c$)
           REM MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
           ok% = 0
           SET STATUS "Termine gefunden..."
         ELSE 
           IF req3% = 2 THEN 
             req% = 3
           ELSE 
             req% = 0
           END IF 
         END IF 
       END IF 
       aaaak% = aaaak% + 1
     ELSE 
       Superbase.Dialogs.Add("TERLISTE")
       SET dlg = Superbase.Dialogs.TERLISTE
       dlg.Move(0,0,440,297)
       dlg.Caption = "TerminÅbersicht"
       dlg.FontName = "MS Sans Serif"
       dlg.FontSize = 8
 
       SET control = dlg.Add("DialogListBox1","DialogListBox")
       control.Move(4,8,429,256)
       control.MultiSelect = 1
       control.ScrollBars = 2
       control.Bind("Termine$","Auswahl$","prompt$")
 
       SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
       control.Move(10,273,124,16)
       control.Default = 1
       control.Caption = "&zum einzelnen Termin springen"
       control.ReturnValue = 1
 
       SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
       control.Move(140,273,56,16)
       control.Caption = "&Drucken"
       control.ReturnValue = 2
 
       SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
       control.Move(201,273,56,16)
       control.Caption = "Dat&ei"
       control.ReturnValue = 3
 
       SET control = dlg.Add("DialogCommandButton6","DialogCommandButton")
       control.Move(261,273,56,16)
       control.Caption = "MS EXCEL"
       control.ReturnValue = 5
 
       SET control = dlg.Add("DialogCommandButton5","DialogCommandButton")
       control.Move(321,273,56,16)
       control.Caption = "Er&ledigen"
       control.ReturnValue = 4
 
       SET control = dlg.Add("DialogCommandButton4","DialogCommandButton")
       control.Move(381,273,56,16)
       control.Caption = "&Abbruch"
       control.ReturnValue = 0
       control.Cancel = 1
       DIALOG "TERLISTE",req%
       REMOVE DIALOG ALL 
     END IF 
     IF req% = 0 THEN 
       _formend% = 0
       GOTO e240520021
     END IF 
     IF req% = 1 THEN 
       ok% = 1
       IF GCODIE% <> - 1 THEN 
         _cuaq% = VAL ( RIGHT$ (Auswahl$(0),6))
       END IF 
       prompt$ = Auswahl$(0)
       lastTermin% = _cuaq%
       SELECT KEY _cuaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
       knr% = codeku.GAkquiDat$
       _vcodema% = codema.GAkquiDat$
       IF FORM LIKE "Akqui*" THEN 
           SELECT KEY _cuaq% FILE "Akquise" INDEX codeaq.akquise
           SELECT KEY codeku.akquise FILE "Adressen" INDEX codeku.adressen
           SELECT KEY codeku.akquise FILE "telefon" INDEX codeku.telefon
           CALL AKQUISEIntro()
           SELECT FORM KEY _cuaq% FILE "AKQUISE" INDEX codeaq.akquise
           FORM 
           SET DISPLAY ON 
           CALL AQButtUpdate()
       ELSE 
         CALL TerLiSpez(_cuaq%)
         _formend% = 0
       END IF 
       REM GOTO TLi260320003
     END IF 
     REM EXCEL-Datei erzeugen
     IF req% = 5 THEN 
       ON ERROR GOTO ErrorHandler
       IF OPEN ("AKQTMP1") THEN CLOSE FILE "AKQTMP1"
       IF EXISTS (GMACodeDir$ + "AKQTMP1.sbf") THEN 
         DELETE GMACodeDir$ + "AKQTMP1.*"
       END IF 
       COPY _netpath$ + "\OFFICE\AKQTMP1.*" TO GMACodeDir$
       OPEN FILE SHARE ,0GMACodeDir$ + "AKQTMP1;paris"
       FOR i% = 0 TO tfound% - 1
         SET STATUS STR$ (i%,"9999999")
         codeaq% = VAL ( RIGHT$ (Termine$(i%),6))
         SELECT KEY codeaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
         SELECT FIRST FILE GAdrDat$ INDEX codeku.GAdrDat$
         IF codeku.GAkquiDat$ > 0 AND EXISTS (codeku.GAkquiDat$,codeku.GADRDat$) THEN 
           SELECT KEY codeku.GAkquiDat$ FILE GAdrDat$ INDEX codeku.GAdrDat$
           BLANK FILE "AKQTMP1"
           ber.AKQTMP1 = LEFT$ (bearbeiter.GAkquiDat$,3)
           REM datum.AKQTMP1 = datum.GAkquiDat$
           REM notiz.AKQTMP1 = notiz.GAkquiDat$
           IF termin.GAkquiDat$ > 0 THEN termin.AKQTMP1 = termin.GAkquiDat$
           IF Uhrzeit.GAkquiDat$ > 0 THEN Uhrzeit.AKQTMP1 = Uhrzeit.GAkquiDat$
           Kunde.AKQTMP1 = LTRIM$ (nachname.GAkquiDat$)
           ergebnis.AKQTMP1 = ergebnis.GAkquiDat$
           REM tnr.akqtmp1 = terminnr.GAkquiDat$
           AkquiseTag.akqtmp1 = AkquiseTag.GAkquiDat$
           Ft1.akqtmp1 = Folgetermin1.GAkquiDat$
           IF Folgezeit1.GAkquiDat$ <> 0 THEN zeit1.akqtmp1 = Folgezeit1.GAkquiDat$
           Ft2.akqtmp1 = Folgetermin2.GAkquiDat$
           IF Folgezeit2.GAkquiDat$ <> 0 THEN zeit2.akqtmp1 = Folgezeit2.GAkquiDat$
           IF ErDatum.GAkquiDat$ > 0 THEN 
             VorlageTermin.akqtmp1 = ErDatum.GAkquiDat$
             IF ErZeit.GAkquiDat$ <> 0 THEN Vorlagezeit.akqtmp1 = ErZeit.GAkquiDat$
           END IF 
           ort.akqtmp1 = ort.GAkquiDat$
           az.akqtmp1 = az.GAkquiDat$
           bba.akqtmp1 = bba.GAkquiDat$
           sonstiges.akqtmp1 = sonstiges.GAkquiDat$
           STORE FILE "AKQTMP1"
         END IF 
       NEXT i%
       REM CALL Fehler("","")
       FILE "AKQTMP1"
       INDEX Termin.AKQTMP1
       IF RECCOUNT ("AKQTMP1") > 0 THEN 
         SELECT FIRST LOCK FILE "AKQTMP1"
       ELSE 
         SELECT LAST FILE "AKQTMP1"
       END IF 
       k% = 0
       WHILE NOT EOF ("AKQTMP1")
         k% = k% + 1
         nr.akqtmp1 = k%
         STORE FILE "AKQTMP1"
         SELECT NEXT LOCK 
       WEND 
       REM OPEN FIELDS Nr,AkquiseTag,Ber,Kunde,Termin,Uhrzeit,FT1,Zeit1,FT2,Zeit2,Vorlagedatum,Vorlagezeit,Ergebnis
       IF GRiese$ LIKE "TRUE" THEN 
         OPEN FIELDS Nr,AkquiseTag,Ber,Kunde,Ort,AZ,BBA,Sonstiges,Termin,Uhrzeit,FT1,Zeit1,FT2,Zeit2,VorlageTermin,Ergebnis
       ELSE 
         OPEN FIELDS Nr,AkquiseTag,Ber,Kunde,Ort,Termin,Uhrzeit,FT1,Zeit1,FT2,Zeit2,VorlageTermin,VorlageZeit,Ergebnis
       END IF 
       SELECT FIRST FILE "AKQTMP1"
       IF EXISTS (GMACodeDir$ + "AKQTMP1.xls") THEN 
         DELETE GMACodeDir$ + "AKQTMP1.xls"
       END IF 
       DIRECTORY GMACodeDir$:REM     
       ON ERROR GOTO TagestErrExc011
       Superbase.Converters.SBF.SourceFormat = "Superbase"
       Superbase.Converters.SBF.SourceFile = "AKQTMP1"
       Superbase.Converters.SBF.Descending = 0
       Superbase.Converters.SBF.Merge = 0
       Superbase.Converters.SBF.LogErrors = 0
       Superbase.Converters.SBF.MultiResponse = 0
       Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
       Superbase.Converters.XLS.DestFile = GMACodeDir$ + "AKQTMP1.XLS"
       Superbase.Converters.XLS.StartRow = 2
       Superbase.Converters.XLS.StartCol = 1
       Superbase.Converters.XLS.EndRow = - 1
       Superbase.Converters.XLS.EndCol = - 1
       Superbase.Converters.XLS.UseLabels = - 1
       Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
       WAIT FOR 3
       CALL Fehler("MS Excel-Termindatei wurde erstellt!",GMACodeDir$ + "AKQTMP1.XLS")
       IF EXISTS (GMACodeDir$ + "AKQTMP1.xls") THEN 
         a% = CALL ("ShellExecute",0,"open",GMACodeDir$ + "AKQTMP1.XLS","","",1)
       END IF 
       GOTO TagestErrExc021
TagestErrExc011: 
       ON ERROR GOTO ErrorHandler
       CALL Fehler("Es ist ein Fehler aufgetreten!","Bitte prÅfen Sie, ob die Datei " + GMACodeDir$ + "AKQTMP1.XLS in MS EXCEL geîffnet ist, ggf. bitte schlie·en und nochmal probieren!")
TagestErrExc021: 
       cdir$ = DIRECTORY 
     END IF 
     IF req% = 2 THEN 
       REM Drucken
       MOUSE OFF 
       IF OPEN ("AKQTMP") THEN 
         REM CLOSE FILE "AKQTMP"
         REMOVE FROM FILE "AKQTMP"
       ELSE 
         CALL DFile(2,"OFFICE\" + "AKQTMP" + _fpw$)
         REMOVE FROM FILE "AKQTMP"
       END IF 
       IF GCodieRuf3% = 0 THEN FOR i% = 0 TO tfound% - 1
       IF GCodieRuf3% = - 1 THEN FOR i% = 0 TO tfound1% - 1
         SET STATUS STR$ (i%,"9999999")
         IF GCodieRuf3% = - 1 THEN 
           codeaq% = VAL ( RIGHT$ (TV$(i%),6))
         ELSE 
           codeaq% = VAL ( RIGHT$ (Termine$(i%),6))
         END IF 
         SELECT KEY codeaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
         BLANK FILE "AKQTMP"
         codeku.AKQTMP = codeku.GAkquiDat$
         codeak.akqtmp = codeak.GAkquiDat$
         bearbeiter.AKQTMP = bearbeiter.GAkquiDat$
         codema.AKQTMP = codema.GAkquiDat$
         datum.AKQTMP = datum.GAkquiDat$
         notiz.AKQTMP = notiz.GAkquiDat$
         termin.AKQTMP = termin.GAkquiDat$
         erledigt_termin.AKQTMP = erledigt_termin.GAkquiDat$
         codeaq.AKQTMP = codeaq.GAkquiDat$
         Uhrzeit.AKQTMP = Uhrzeit.GAkquiDat$
         nachname.AKQTMP = nachname.GAkquiDat$
         ergebnis.AKQTMP = ergebnis.GAkquiDat$
         projekt.AKQTMP = projekt.GAkquiDat$
         codepr.AKQTMP = codepr.GAkquiDat$
         dauer.AKQTMP = dauer.GAkquiDat$
         DME.AKQTMP = dme.GAkquiDat$
         terminnr.akqtmp = terminnr.GAkquiDat$
         STORE FILE "AKQTMP"
       NEXT i%
       cdir$ = DIRECTORY 
       DIRECTORY _netpath$ + "OFFICE"
       CALL ORep("TERMINE2")
       HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
       END HEADING 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
       SET QUERY ON 
       SET QUERY LOCK ON 
       Ueberschr$ = "TerminÅbersicht Åber " + tart$ + " von: " + von$ + " bis: " + bis$ + " fÅr Mitarbeiter: " + ma$ + " und Aktion: " + ak$
       ON ERROR GOTO TD0104200011
       SELECT ;
       WHERE codeak.AKQTMP = codeak.aktionen AND CodeKU.AKQTMP = CodeKU.GAdrDat$
       ORDER Termin.AKQTMP,Uhrzeit.AKQTMP
       TO ASK 
       END SELECT 
TD0104200011: 
       ON ERROR GOTO ErrorHandler
       DIRECTORY cdir$
       MOUSE ON 
       REM GOTO TLi260320003
     END IF 
 
     IF req% = 3 THEN 
       CALL TagestExp(Termine$(),tfound%)
       GOTO TLi260320003
     END IF 
     REM markierte erledigen 04052001
     IF req% = 4 THEN 
       i% = 0
       MOUSE OFF 
       WHILE Auswahl$(i%) <> ""
         _cuaq% = VAL ( RIGHT$ (Auswahl$(i%),6))
         SELECT KEY _cuaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
         GErledTermin$ = erledigt_Termin.GAkquiDat$
         erledigt_Termin.GAkquiDat$ = "j"
         CALL QuickStore(GAkquiDat$)
         MOUSE OFF 
         i% = i% + 1
       WEND 
       MOUSE ON 
       REDIM Termine$(tfound%,1)
       REDIM Termine$(tfound%)
       REM FOR a% = 0 TO tfound% - 1
         REM Termine$(a%) = ""
       REM NEXT a%
       CALL Fehler("Termin(e) wurden als erledigt gekennzeichnet","")
       REM GOTO A060420001
     END IF 
   ELSE 
     CALL Fehler("Es wurden keine Termine gefunden, die den Auswahlkriterien entsprachen!","")
   END IF 
 END IF 
e240520021: 
 MOUSE ON 
 REM IF GCODieRuf% = - 1 THEN 
   REM ret% = CALL ("_SearchClose")
   REM GCODieRuf% = 0
 REM END IF 
 END SUB 
 
 
  
 
FUNCTION IsMASuper%(masuper%)
   REM IF masuper% = 1 OR masuper% = 105 OR masuper% = 68 THEN CALL Fehler( STR$ (masuper%),"")
   IF GMASuperCount% > 0 THEN 
     joo% = 0
     FOR i% = 0 TO GMASuperCount% - 1
       IF masuper% = GMASuper%(i%) THEN 
         joo% = - 1
         i% = GMASuperCount% + 1
       END IF 
     NEXT i%
   ELSE 
     joo% = 0
   END IF 
   IsMASuper% = joo%
 END FUNCTION 
 
 
 
 '      *********************************************************
 '      ** Routinen fÅr Formular "lokale Rechnereinstellungen" **
 '      *********************************************************
 
SUB LokalSetup()
 IF disabled%("LOCALSTAMMEDIT") THEN END SUB 
 cuvc% = Codema.supervis
 CALL DFile(2,"access" + _fpw$)
 CALL DFile(2,"accode" + _fpw$)
 _formend% = 0
 SET STATUS "Bereit"
 ON ERROR GOTO ErrorHandler
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   SUPERVISsub% = 0
   maske$ = "LOKSETUP"
   IF GASP% THEN 
     maske$ = "LOKSETUP"
   END IF 
   IF FORM <> maske$ THEN 
     SET HEADING title$ + " - lokale Rechnereinstellungen"
     IF EXISTS (GOFFForm$ + maske$ + ".sbv") THEN 
       OPEN FORM GOFFForm$ + maske$
     ELSE 
       OPEN FORM GOFFForm$ + maske$
     END IF 
     SET f = Superbase.Form
     SET STATUS "lokale Rechnereinstellungen"
     SofortFile$ = LCASE$ (ReadINI$("SYSTEM","SofortFileAuswahl"))
     vScanDir$ = UCASE$ (ReadINI$("SYSTEM","ScanUndImportVerzeichnis"))
     vCalcuvDir$ = UCASE$ (ReadINI$("SYSTEM","CalcuVitaVerzeichnis"))

     emailon$ = UCASE$ (ReadINI$("SYSTEM","EMAILON"))
     matagester$ = UCASE$ (ReadINI$("SYSTEM","MitarbeiterTagestermine"))
     AutoKeywo$ = UCASE$ (ReadINI$("SYSTEM","AutoKeyword"))
     AutoAnred$ = UCASE$ (ReadINI$("SYSTEM","AutoAnrede"))
     AutoTite$ = UCASE$ (ReadINI$("SYSTEM","AutoTitel"))
     AutoBeru$ = UCASE$ (ReadINI$("SYSTEM","AutoBeruf"))
     AutoHobby$ = UCASE$ (ReadINI$("SYSTEM","AutoHobbys"))
     AutoOrt1$ = UCASE$ (ReadINI$("SYSTEM","AutoOrt"))
     AutoPLZ1$ = UCASE$ (ReadINI$("SYSTEM","AutoPLZ"))
     AutoLand1$ = UCASE$ (ReadINI$("SYSTEM","AutoLand"))
     AutoFifo$ = UCASE$ (ReadINI$("SYSTEM","AutoFirmenformForm"))
     AutoFamst$ = UCASE$ (ReadINI$("SYSTEM","AutoFamilienStand"))
     AutoAnst$ = UCASE$ (ReadINI$("SYSTEM","AutoAnstellungsverh"))
     AutoNation1$ = UCASE$ (ReadINI$("SYSTEM","AutoNational"))
     AutoStaat1$ = UCASE$ (ReadINI$("SYSTEM","AutoStaat"))
     AutoErgA$ = ReadINI$("SYSTEM","ERGDATUMAUTOMAT")
     Wordend$ = ReadINI$("SYSTEM","WPSuffix")
     Textverarb$ = ReadINI$("SYSTEM","WordProc")
     REM NewSear$ = UCASE$ (ReadINI$("SYSTEM","NewSearch"))
     WiwoAnsi$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))
     Aufloesung$ = UCASE$ (ReadINI$("SYSTEM","Bildschirmaufloesung"))
 REM CALL WriteINI("SYSTEM","AutoTelefonart1",AutoKArt1$)
 REM CALL WriteINI("SYSTEM","AutoTelefonart2",AutoKArt2$)
     AutoKArt1F$ = UCASE$ (ReadINI$("SYSTEM","AutoTelefonart1"))
     AutoKArt2F$ = UCASE$ (ReadINI$("SYSTEM","AutoTelefonart2"))
     VistaF$ = UCASE$ (ReadINI$("SYSTEM","MSVista"))
     OldProdSu$ = UCASE$ (ReadINI$("SYSTEM","OldProdSu"))
     CALL MNProgramm()
     FORM 
   END IF 
   MENU ON 
   MOUSE ON 
   FORM 
   ON ERROR GOTO ErrorHandler
   CALL ClearKBDBuffer()
   MENU ON 
   WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL SVPrev()
   CASE CrsRight%,PgDn%
     CALL SVNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   CALL ClearKBDBuffer()
   SELECT CASE SUPERVISsub%
   CASE 1
     REM Export Adressen/Telefon/Termine eines Mitarbeiters nach Outlook
     GAdrDat$ = "ADRESSEN"
     GConDat$ = "CONNECT"
     GTelDat$ = "TELEFON"
     GAkquiDat$ = "AKQUISE"
     GDokDat$ = "DOKUMENT"
     CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
     CALL DFile(2,"OFFICE\" + "AKQUISE" + _fpw$)
     CALL DFile(2,"OFFICE\" + "AKTIONEN" + _fpw$)
     CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
     CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
     CALL DFile(2,"OFFICE\adrstat" + _fpw$)
     CALL DFile(2,"OFFICE\adrgrup" + _fpw$)
     CALL DFile(2,"color" + _fpw$)
     CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
     CALL DFile(2,"OFFICE\banken" + _fpw$)
     CALL DFile(3,"STAMM" + _fpw$)
     IF EXISTS (_netpath$ + "PROVIS\kvertrag.sbf") THEN CALL DFile(3,"KVERTRAG" + _fpw$)
     IF EXISTS (_netpath$ + "PROVIS\statukey.sbf") THEN CALL DFile(3,"STATUKEY" + _fpw$)
     IF EXISTS (_netpath$ + "PROVIS\vermoeg.sbf") THEN CALL DFile(3,"VERMOEG" + _fpw$)
     IF EXISTS (_netpath$ + "PROVIS\vorgang.sbf") THEN CALL DFile(3,"VORGANG" + _fpw$)
     IF EXISTS (_netpath$ + "PROVIS\maadr.sbf") THEN CALL DFile(3,"MAADR" + _fpw$)
     IF EXISTS (_netpath$ + "PROVIS\kukto.sbf") THEN CALL DFile(3,"KUKTO" + _fpw$)
     IF EXISTS (_netpath$ + "office\kvhis.sbf") THEN CALL DFile(2,"OFFICE\KVHIS" + _fpw$)
     codeku1% = codeku.GADRDat$
     FILE "ADRESSEN"
     SELECT FIRST 
     
     REM Export nach Outlook
     
     IF NOT disabled%("OUTLOOKEXPORT") THEN 
       REM CALL ADRExpOutl(codeku.GADRDat$)
       REM GOTO outlexp060920053
       t1$ = "Diese beiden Dateien dienen dann als Importdateien fÅr MS Outlook. (In MS Outlook MenÅ Datei/Importieren-Exportieren/Import aus anderen Programmen/Kommagetrennte Werte (Window))"
       t0$ = "Weiterhin werden alle nichterledigten Termine dieser Adressen in die Datei " + GMACodeDir$ + "outkal.csv exportiert."
       
       REM CALL Fehler("Es werden nachfolgend alle Adressen, die fÅr den Export markiert wurden in die Datei " + GMACodeDir$ + "outadr.csv exportiert.",t0$ + t1$)
       REQUEST "Sollen nur die Adressen und Termine eines","einzelnen Vermittlers exportiert werden?",130,req%
       IF req% = 1 THEN 
         IF GASP% THEN 
           wks1% = Workstation%
           a% = SelectOffice%("BÅro-Auswahl","",1,wks1%)
           MOUSE ON 
           IF a% <> - 1 THEN 
             zzz% = a%
             codema% = GetCodeMA%(cuma%,zzz%)
             IF codema% < 1 THEN 
               GOTO outlexp060920053
             END IF 
           ELSE 
             CALL Fehler("MS Outlook Export abgebrochen!","Sie haben keinen Mitarbeiter ausgewÑhlt")
             GOTO outlexp060920053
           END IF 
 
         ELSE 
           codema% = GetCodeMA%(0,Workstation%)
         END IF 
       ELSE 
         codema% = 0
         IF GASP% THEN 
           IF workstation% = 0 THEN 
             REQUEST "Sollen nur die Adressen und Termine eines","einzelnen BÅros exportiert werden?",130,req%
             wkswahl% = 0
             IF req% = 1 THEN 
               wks1% = Workstation%
               a% = SelectOffice%("BÅro-Auswahl","",1,wks1%)
               wkswahl% = a%
               IF wkswahl% = - 1 THEN 
                 CALL Fehler("MS Outlook Export abgebrochen!","Sie haben kein BÅro ausgewÑhlt")
                 GOTO outlexp060920053
               END IF 
             ELSE 
               codema% = 0
             END IF 
           ELSE 
             wks1% = Workstation%
             a% = SelectOffice%("BÅro-Auswahl","",1,wks1%)
             wkswahl% = a%
             IF wkswahl% = - 1 THEN 
               CALL Fehler("MS Outlook Export abgebrochen!","Sie haben kein BÅro ausgewÑhlt")
               GOTO outlexp060920053
             END IF 
           END IF 
            
         END IF 
       END IF 
       IF RECCOUNT (GAdrDat$) < 30000 THEN 
         REDIM ADRFound$( RECCOUNT (GAdrDat$))
       ELSE 
         REDIM ADRFound$(30000)
       END IF 
       FILE GAdrDat$
       INDEX fiimmak.GAdrDat$
       SELECT FIRST 
       SELECT KEY "j" FILE GAdrDat$ INDEX fiimmak.GAdrDat$
       a% = 0
       MOUSE OFF 
       WHILE NOT EOF (GAdrDat$) AND fiimmak.GAdrDat$ = "j"
         IF codema% > 0 THEN 
           IF codema.GAdrDat$ = codema% THEN 
             SET STATUS "Exportiere " + nachname.GAdrDat$
 
             ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
             a% = a% + 1
           END IF 
         ELSE 
           IF GASP% THEN 
               IF wkswahl% = 0 THEN 
                 SET STATUS "Exportiere " + nachname.GAdrDat$
                 ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
                 a% = a% + 1
               ELSE 
                 sok% = - 1
                 wks% = wkswahl%
                 FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                    wks% = VisOff%(ii%)
                    aa% = IsWksVisible%(wks%)
                    IF aa% = - 1 AND Workstation.GADRDat$ = wks% THEN 
                      sok% = - 1
                      ii% = VisCount%
                    ELSE 
                      sok% = 0
                    END IF 
                 NEXT ii%
                 IF sok% THEN 
                   SET STATUS "Exportiere " + nachname.GAdrDat$
                   ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
                   a% = a% + 1
                 END IF 
               END IF 
           ELSE 
             SET STATUS "Exportiere " + nachname.GAdrDat$
             ADRFound$(a%) = STR$ (codeku.GAdrDat$,"000000")
             a% = a% + 1
           END IF 
         END IF 
         SET STATUS STR$ (a%) + " Adressen gefunden (Suche in Adressen)"
         MOUSE OFF 
         SELECT NEXT FILE GAdrDat$ INDEX fiimmak.GAdrDat$
       WEND 
       ADRFound$(a%) = ""
       REM CALL Fehler("","")
       REQUEST "Es wurden jetzt die Adressen aus","der Adressdatei gesucht",2
       REM CALL ExpOutlook()
       IF a% > 0 THEN 
         CALL ADRExpOutl(0,a% - 1)
       ELSE 
         CALL Fehler("Es wurde keine Adressen fÅr den MS Outlook-Export gefunden!","Bitte prÅfen Sie,da· bei den betroffenen Adressen die Checkbox fÅr den Datenexport angekreuzt ist!")
       END IF 
     END IF 
outlexp060920053: 
     SELECT KEY kunr% FILE GADRDat$ INDEX codeku.GADRDat$
     MOUSE ON 
     SET STATUS ""

   CASE 99
   END SELECT 
 WEND 
 _formend% = 0
 END SUB 
 
SUB SaveLocSet()
 MATagest$ = matagester$
 AutoKeyword$ = AutoKeywo$
 AutoAnrede$ = AutoAnred$
 AutoTitel$ = AutoTite$
 AutoBeruf$ = AutoBeru$
 AutoHobbys$ = AutoHobby$
 AutoOrt$ = AutoOrt1$
 AutoPLZ$ = AutoPLZ1$
 AutoLand$ = AutoLand1$
 AutoFiForm$ = AutoFifo$
 AutoFStand$ = AutoFamst$
 AutoAnstell$ = AutoAnst$
 AutoNational$ = AutoNation1$
 AutoStaat$ = AutoStaat1$
 ergdatuma$ = AutoErgA$
 _WPSuffix$ = Wordend$
 REM GCODie$ = NewSear$
 AutoKArt1$ = AutoKArt1F$
 AutoKArt2$ = AutoKArt2F$
 Vista$ = VistaF$
 GScanDir$ = vScanDir$
 GCalcuvDir$ = vCalcuvDir$
 GEMAILon$ = emailon$
 REM GSofortfile$ = SofortFile$
 REM GOldProdSu$ = OldProdSu$
 REM CALL WriteINI("SYSTEM","OldProdSu",OldProdSu$)
 CALL WriteINI("SYSTEM","MitarbeiterTagestermine",matagester$)
 CALL WriteINI("SYSTEM","AutoKeyword",AutoKeywo$)
 CALL WriteINI("SYSTEM","AutoAnrede",AutoAnred$)
 CALL WriteINI("SYSTEM","AutoTitel",AutoTitel$)
 CALL WriteINI("SYSTEM","AutoBeruf",AutoBeru$)
 CALL WriteINI("SYSTEM","AutoHobbys",AutoHobby$)
 CALL WriteINI("SYSTEM","AutoOrt",AutoOrt1$)
 CALL WriteINI("SYSTEM","AutoPLZ",AutoPLZ1$)
 CALL WriteINI("SYSTEM","AutoLand",AutoLand1$)
 CALL WriteINI("SYSTEM","AutoFirmenformForm",AutoFifo$)
 CALL WriteINI("SYSTEM","AutoFamilienStand",AutoFamst$)
 CALL WriteINI("SYSTEM","AutoAnstellungsverh",AutoAnst$)
 CALL WriteINI("SYSTEM","AutoNational",AutoNation1$)
 CALL WriteINI("SYSTEM","AutoStaat",AutoStaat1$)
 CALL WriteINI("SYSTEM","ERGDATUMAUTOMAT",AutoErgA$)
 CALL WriteINI("SYSTEM","WPSuffix",Wordend$)
 CALL WriteINI("SYSTEM","WordProc",Textverarb$)
 REM CALL WriteINI("SYSTEM","NewSearch",NewSear$)
 CALL WriteINI("SYSTEM","WinWordAnsi",WiwoAnsi$)
 CALL WriteINI("SYSTEM","Bildschirmaufloesung",Aufloesung$)
 CALL WriteINI("SYSTEM","AutoTelefonart1",AutoKArt1$)
 CALL WriteINI("SYSTEM","AutoTelefonart2",AutoKArt2$)
 CALL WriteINI("SYSTEM","MSVista",Vista$)
 CALL WriteINI("SYSTEM","ScanUndImportVerzeichnis",vScanDir$)
 CALL WriteINI("SYSTEM","CalcuVitaVerzeichnis",vCalcuvDir$)
 REM CALL WriteINI("SYSTEM","SofortFileAuswahl",SofortFile$)
 CALL WriteINI("SYSTEM","EMAILON",emailon$)
 REM vScanDir$ = UCASE$ (ReadINI$("SYSTEM","ScanUndImportVerzeichnis"))
 ON ERROR GOTO f230220043
 cdir$ = DIRECTORY 
 IF GCodie% = - 1 AND GFPB% <> - 1 THEN 
   REGISTER _netpath$ + "CODieLIB.dll","_SBCreateDir","IF"
   a% = CALL ("_SBCreateDir",GScanDir$)
   REGISTER CLEAR "_SBCreateDir"
   REGISTER _netpath$ + "CODieLIB.dll","_SBSetCurrentDir","IF"
   a% = CALL ("_SBSetCurrentDir",GScanDir$)
   REGISTER CLEAR "_SBSetCurrentDir"
 ELSE 
   DIRECTORY GScanDir$
 END IF 
 GOTO f230220044
f230220043: 
 CALL Fehler("das >bevorzugte Import- und Scanverzeichnis ist fehlerhaft<, beachten Sie die 8.3 Konvention, d.h. der Verzeichnisname darf nur aus bis zu 8 Buchstaben bestehen","")
 GOTO f230220045
f230220044: 
 CALL Fehler("Zur Aktivierung der neuen Einstellungen mÅssen Sie das Programm neu starten!","")
 REQUEST "Mîchten Sie das Programm jetzt beenden?","",130,req%
 IF req% = 1 THEN 
   CALL EXIT()
 END IF 
f230220045: 
 ON ERROR GOTO ErrorHandler
 DIRECTORY cdir$
 END SUB 
 
 
 
 
SUB TagestExp1(Termine1$(),tfound1%)
 bez% = 1
   IF RECCOUNT ("Akquise") < 23000 THEN 
     DIM Termine$( RECCOUNT ("Akquise"))
   ELSE 
     DIM Termine$(23000)
   END IF 
   tfound1% = 0
 IF disabled%("AKQUISE") THEN END SUB 
 IF NOT AQFileOK%() THEN END SUB 
 IF title$ LIKE "*FACTURA*" OR title$ LIKE "*price*" THEN 
   CALL Fehler("Funktion wird in dieser Programm-Version nicht unterstÅtzt!","")
   END SUB 
 END IF 
 CALL DFile(2,"OFFICE\adressen" + _fpw$)
 CALL DFile(2,"OFFICE\dokument" + _fpw$)
 REM CALL DFile(2,"OFFICE\dokgrup" + _fpw$)
 CALL DFile(2,"OFFICE\akquise" + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\telefon" + _fpw$)
 CALL DFile(2,"OFFICE\connect" + _fpw$)
 _continue% = 1
 bezug% = bez%
 SET STATUS "Erzeuge Tagestermindatei fÅr den aktuellen Mitarbeiter"
 MOUSE OFF 
  
   CALL Server("LISTBOXINIT","TagesÅbersicht Mitarbeiter")
   cuaqtmp% = cuaq%
   MOUSE OFF 
   datum$ = TODAY 
   bezug% = 1
   IF bezug% = 1 THEN 
     tfound1% = 0
     INDEX QuickCodeMAZ.akquise
     scode$ = DATE$ ( DAYS (datum$),"0dmmyyyy") + STR$ (_vcodema%,"000000")
     SELECT FIRST 
     SELECT KEY scode$
     REM CALL Fehler("Test","")
     IF EXISTS (GMACodeDir$ + "termtmp.ini") THEN DELETE GMACodeDir$ + "termtmp.ini"
     OPEN GMACodeDir$ + "termtmp.ini" FOR OUTPUT 
     ? FN ansi("Termine fÅr den Mitarbeiter ") + FN ansi(Vorname.supervis) + " " + FN ansi(nachname.supervis) + FN ansi(" fÅr den ") + DATE$ ( DAYS (datum$),"0d.mm.yyyy")
     ? " "
     ? "Uhrzeit/Dauer"
     ? "-----------------------------------------------------------------------------------------------------------------------------------------------------------------------"
     FOR i% = 0 TO tfound1%
       _cuaq% = VAL ( RIGHT$ (Termine1$(i%),6))
      SELECT KEY _cuaq% FILE "Akquise" INDEX codeaq.akquise
     codeku% = codeku.akquise
     SELECT FIRST FILE "Adressen" INDEX codeku.adressen
     SELECT KEY codeku% FILE "Adressen" INDEX codeku.adressen
     IF ergebnis.akquise = "" THEN 
       entry$ = TIME$ (Uhrzeit.akquise,"hh:mm") + "/" + STR$ (Dauer.akquise,"99") + " [" + UCASE$ (erledigt_termin.AKQUISE) + "]: " + TRIM$ (nachname.adressen) + "," + TRIM$ (Vorname.adressen) + ", " + notiz.akquise
     ELSE 
       ab$ = CHR$ (13) + CHR$ (10) + "NOTIZ: " + notiz.akquise + CHR$ (13) + CHR$ (10) + "ERGEBNIS: " + ergebnis.akquise + CHR$ (13) + CHR$ (10)
       entry$ = TIME$ (Uhrzeit.akquise,"hh:mm") + "/" + STR$ (Dauer.akquise,"99") + " [" + UCASE$ (erledigt_termin.AKQUISE) + "]: " + TRIM$ (nachname.adressen) + "," + TRIM$ (Vorname.adressen) + ab$
     END IF 
     SET STATUS LEFT$ (entry$,50)
       ? FN ansi(entry$)
       Termine$(tfound1%) = entry$
       tfound% = tfound% + 1
       REM CALL Server("LISTBOXADD",entry$)
       REM tfound% = tfound% + 1
     NEXT i%
     ? " "
     ? " "
     ? FN ansi("Ende der TerminÅbersicht")
  
     CLOSE OUTPUT 
     Termine$(tfound1%) = ""
     caption$ = "Termine auf den Mitarbeiter bezogen"
   END IF 
 
     ww% = 1
     i% = 0
     MOUSE OFF 
     WHILE NOT EXISTS (GMACodeDir$ + "termtmp.ini") AND i% < 9990000
       i% = i% + 1
       IF i% = 10000 THEN 
         REQUEST "Die zu erstellende Datei " + GMACodeDir$ + "termtmp.ini wurde nicht gefunden!","Soll der Versuch Sie zu îffnen abgebrochen werden?",130,req%
         IF req% = 1 THEN 
           i% = 9991000
           ww% = 0
         END IF 
       END IF 
     WEND 
     MOUSE ON 
     dddddd$ = GMACodeDir$ + "termtmp.ini"
     IF EXISTS (GMACodeDir$ + "termtmp.ini") AND ww% > 0 THEN CALL "notepad.exe " + dddddd$
   ELSE 
     SET STATUS "Bereit"
     CALL Fehler("Es wurden keine Tagstermine fÅr den aktuellen Mitarbeiter gefunden !","")
   END IF 
   SET STATUS ""
 END SUB 
 
 
 
 
SUB AutoKart1(datei$)
 IF AutoKArt1$ LIKE "TRUE" AND nummer.telefon <> "" THEN CALL AutoKart1S(datei$)
 END SUB 
 
SUB AutoKart2(datei$)
 IF AutoKArt2$ LIKE "TRUE" AND nummer.telefon <> "" THEN CALL AutoKart2S(datei$)
 END SUB 
 
SUB AutoKart1S(datei$)
   codetel% = codetel.GTelDat$
   SELECT KEY codetel% LOCK FILE GTElDat$ INDEX Codetel.GTeldat$
   REM GAutoKArt1
   IF suchopt$ = "" THEN suchopt$ = "Nachname"
   DIM Auswahl$(1)
 
   Auswahl$ = KArt1.datei$
   prompt$ = KArt1.datei$
 IF prompt$ = "" THEN prompt$ = "FON"
 CREATE DIALOG "KEYWORD",0,0,70,130,"Merkmal 1","MS Sans Serif",8
 ADD DIALOG "KEYWORD",4,0,1,70,110,0,""
 REM ADD DIALOG "KEYWORD",9,4,12,21,24,2
 ADD DIALOG "KEYWORD",5,1,14,70,19,0,"Bitte wÑhlen Sie das Telefonmerkmal 1 aus:"
 ADD DIALOG "KEYWORD",7,5,38,50,70,0,2,GAutoKArt1$,Auswahl$,prompt$
 REM ADD DIALOG "KEYWORD",6,11,158,100,12,0,0,KW$,10
   ADD DIALOG "KEYWORD",1,5,113,55,15,1,"&OK",1,1
   REM ADD DIALOG "KEYWORD",1,113,98,55,15,0,"&Abbrechen",0,0
 DIALOG "KEYWORD",req%
 REMOVE DIALOG "KEYWORD"
 
 IF req% <> 0 THEN 
     IF kw$ = "" THEN 
       kw1$ = UCASE$ (Auswahl$(0))
       kw$ = kw1$
     ELSE 
       kw$ = UCASE$ (VSNRPack$(kw$))
       ok% = 0
       j% = 0
       FOR i% = 0 TO 49
         IF GAutoKArt1$(i%) = kw$ THEN 
           ok% = - 1
           i% = 50
         END IF 
         IF GAutoKArt1$(i%) = "" THEN 
           i% = 50
         END IF 
       NEXT i%
       IF ok% = 0 THEN 
         FOR i% = 0 TO 49
           IF GAutoKArt1$(i%) = "" THEN 
             j% = i%
             i% = 50
           END IF 
         NEXT i%
         GAutoKArt1$(j%) = kw$
         CALL WriteConfig("Telefonart1","Art" + LTRIM$ ( STR$ (j%,"99")),kw$)
       END IF 
     END IF 
     KArt1.datei$ = kw$
     STORE FILE GTELDat$
  END IF 
 
 END SUB 
 
SUB AutoKart2S(datei$)
   REM GAutoKArt1
   codetel% = codetel.GTelDat$
   SELECT KEY codetel% LOCK FILE GTElDat$ INDEX Codetel.GTeldat$
   IF suchopt$ = "" THEN suchopt$ = "Nachname"
   DIM Auswahl$(1)
 
   Auswahl$ = KArt2.datei$
   prompt$ = KArt2.datei$
 
  IF prompt$ = "" THEN prompt$ = "FIRMA"
  CREATE DIALOG "KEYWORD",0,0,70,130,"Merkmal 2","MS Sans Serif",8
  ADD DIALOG "KEYWORD",4,0,1,70,110,0,""
  REM ADD DIALOG "KEYWORD",9,4,12,21,24,2
  ADD DIALOG "KEYWORD",5,1,14,70,19,0,"Bitte wÑhlen Sie das Telefonmerkmal 2 aus:"
  ADD DIALOG "KEYWORD",7,5,38,50,70,0,2,GAutoKArt2$,Auswahl$,prompt$
  REM ADD DIALOG "KEYWORD",6,11,158,100,12,0,0,KW$,10
   ADD DIALOG "KEYWORD",1,5,113,55,15,1,"&OK",1,1
   REM ADD DIALOG "KEYWORD",1,113,98,55,15,0,"&Abbrechen",0,0
  DIALOG "KEYWORD",req%
  REMOVE DIALOG "KEYWORD"
 IF req% <> 0 THEN 
     IF kw$ = "" THEN 
       kw$ = UCASE$ (Auswahl$(0))
     ELSE 
       kw1$ = UCASE$ (VSNRPack$(kw$))
       kw$ = kw1$
       ok% = 0
       j% = 0
       FOR i% = 0 TO 49
         IF GAutoKArt2$(i%) = kw$ THEN 
           ok% = - 1
           i% = 50
         END IF 
         IF GAutoKArt2$(i%) = "" THEN 
           i% = 50
         END IF 
       NEXT i%
       IF ok% = 0 THEN 
         FOR i% = 0 TO 49
           IF GAutoKArt2$(i%) = "" THEN 
             j% = i%
             i% = 50
           END IF 
         NEXT i%
         GAutoKArt2$(j%) = kw$
         CALL WriteConfig("Telefonart2","Art" + LTRIM$ ( STR$ (j%,"99")), FN ibm(kw$))
       END IF 
     END IF 
     KArt2.datei$ = kw$
     STORE FILE GTELDat$
  END IF 
 
 END SUB 
 
  
  
 


FUNCTION GETKFZKeADR%(lfdnr%,ma%,ge%,spa%,cvp%,vone$,bise$,eingbei%)
 
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     REDIM G1Vertraege$(20000)
   ELSE 
     REDIM G1Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   IF viab% = 0 THEN 
     INDEX codeku.KVERTRAG
     SELECT FIRST 
     tVSNR$ = VSNRPack$(VSNR$)
     SELECT KEY codeku% FILE "KVERTRAG" INDEX codeku.KVERTRAG
     CALL Server("LISTBOXINIT","Vertragsauswahl")
     CALL Gauge(1,"Vertragsdatei wird durchsucht...")
     CALL Server("GAUGEENABLECANCEL","")
     zz% = RECCOUNT ("KVERTRAG")
     _prozt% = 0
     _proz2% = 0
     _anz% = zz%
     ii% = 0
     a% = 0
     WHILE codeku.KVERTRAG = codeku% AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1

       MOUSE OFF 
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "    " + PAD$ (Fabrikat.kvertrag,30) + "        " + von$ + " - " + bis$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               a% = a% + 1
             END IF 
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
             IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
             IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
               sok% = - 1
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.KVERTRAG) THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
               IF sok% THEN 
                 G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "    " + PAD$ (Fabrikat.kvertrag,30) + "        " + von$ + " - " + bis$
                 IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                   G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
                 END IF 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
                 IF a% = 0 THEN prompt$ = G1Vertraege$(0)
                 tmpZeile$ = G1Vertraege$(a%)
                 a% = a% + 1
               END IF 
             END IF 
           END IF 
         END IF 
       ELSE 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "    " + PAD$ (Fabrikat.kvertrag,30) + "        " + von$ + " - " + bis$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
       CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
       CALL Server("LISTBOXADD",tmpZeile$)
       SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
       SELECT NEXT FILE "KVERTRAG"
       ii% = ii% + 1
     WEND 
     CALL Gauge(0,"")
   ELSE 
     INDEX QuickKennz.KVERTRAG
     SELECT FIRST 
     tVSNR$ = VSNRPack$(VSNR$)
     SELECT KEY tvsnr$ FILE "KVERTRAG" INDEX QuickKennz.KVERTRAG

     CALL Server("LISTBOXINIT","Vertragsauswahl")
     CALL Gauge(1,"Vertragsdatei wird durchsucht...")
     CALL Server("GAUGEENABLECANCEL","")
     zz% = RECCOUNT ("KVERTRAG")
     _prozt% = 0
     _proz2% = 0
     _anz% = zz%
     ii% = 0
     a% = 0
     WHILE QuickKennz.KVERTRAG LIKE tvsnr$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
       MOUSE OFF 
       IF GASP% THEN 
         IF workstation% = 0 THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "    " + PAD$ (Fabrikat.kvertrag,30) + "        " + von$ + " - " + bis$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
            END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
             IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
             IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
               sok% = - 1
               IF GMASuperCount% > 0 THEN 
                 IF IsMASuper%(codema.KVERTRAG) THEN 
                 ELSE 
                   sok% = 0
                 END IF 
               END IF 
               IF sok% THEN 
                 G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "    " + PAD$ (Fabrikat.kvertrag,30) + "        " + von$ + " - " + bis$
                 IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                   G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
                 END IF 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
                 IF a% = 0 THEN prompt$ = G1Vertraege$(0)
                 tmpZeile$ = G1Vertraege$(a%)
                 a% = a% + 1
               END IF 
              END IF 
           END IF 
         END IF 
       ELSE 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QuickKennz.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "        " + PAD$ (Fabrikat.kvertrag,30) + "        " + von$ + " - " + bis$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
       CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
       CALL Server("LISTBOXADD",tmpZeile$)
 
       SELECT NEXT FILE "KVERTRAG"
       ii% = ii% + 1
       SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
     WEND 
     CALL Gauge(0,"")
   END IF 
   IF a% = 0 THEN 
     GETKFZKeADR% = 0
     CALL Fehler("Es wurde kein Vertrag mit diesem Suchmerkmal gefunden!","")
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,251,248,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,251,222,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem oder Ñhnlichem Kennzeichen gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Kennzeichen/Fabrikat                       von          bis"
         ADD DIALOG "ZEINLIST",7,6,68,239,155,2 + 128,2,G1Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,36,228,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,96,228,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,156,228,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETKFZKeADR% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETKFZKeADR% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETKFZKeADR% = VAL ( RIGHT$ (G1Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETKFZKeADR% = 0
 END IF 
 END FUNCTION 
 
 
FUNCTION GETKFZTypADR%(lfdnr%,ma%,ge%,spa%,cvp%,vone$,bise$,eingbei%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     REDIM G1Vertraege$(20000)
   ELSE 
     REDIM G1Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   INDEX CodeKU.KVERTRAG
   SELECT FIRST 
   tVSNR$ = VSNRPack$(VSNR$)
   IF viab% = 0 THEN SELECT KEY codeku% FILE "KVERTRAG" INDEX codeku.KVERTRAG

   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Vertragsdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   ii% = 0
   zz% = RECCOUNT ("KVERTRAG")
   _prozt% = 0
   _proz2% = 0
   _anz% = zz%

   a% = 0
   WHILE codeku.KVERTRAG = codeku% AND NOT EOF ("kvertrag") AND viab% = 0 AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1


     MOUSE OFF 
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF Fabrikat.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF Fabrikat.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF Fabrikat.kvertrag LIKE tvsnr$ + "*" THEN 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
          IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END SUB 
       END IF 
     END IF 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     SELECT NEXT FILE "KVERTRAG"
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
   


   WHILE NOT EOF ("kvertrag") AND viab% <> 0
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     MOUSE OFF 
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF Fabrikat.kvertrag LIKE tvsnr$ + "*" OR Fabrikat.kvertrag LIKE "*" + tvsnr$ + "*" THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF Fabrikat.kvertrag LIKE tvsnr$ + "*" OR Fabrikat.kvertrag LIKE "*" + tvsnr$ + "*" THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF Fabrikat.kvertrag LIKE tvsnr$ + "*" OR Fabrikat.kvertrag LIKE "*" + tvsnr$ + "*" THEN 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = PAD$ (Kennzeichen.KVERTRAG,10) + "  " + Fabrikat.kvertrag + "        " + von$ + " - " + bis$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     SELECT NEXT FILE "KVERTRAG"
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
   CALL Gauge(0,"")
   IF a% = 0 THEN 
     GETKFZTypADR% = 0
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,351,298,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,351,272,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem oder Ñhnlichen Namen gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Kennzeichen/Fabrikat                       von          bis"
         ADD DIALOG "ZEINLIST",7,36,68,305,205,2 + 128,2,G1Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,86,278,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,146,278,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,206,278,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETKFZTypADR% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETKFZTypADR% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETKFZTypADR% = VAL ( RIGHT$ (G1Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETKFZTypADR% = 0
 END IF 
 END FUNCTION 
 
 
 
 
 
FUNCTION GETTarifADR%(lfdnr%,ma%,ge%,spa%,cvp%,vone$,bise$,eingbei%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 4000 THEN 
     REDIM G1Vertraege$(24000)
   ELSE 
     c% = RECCOUNT ("KVERTRAG")
     REDIM G1Vertraege$(c%)
   END IF 
   a% = 0
   DIM Auswahl$(1)
   tVSNR$ = VSNRPack$(VSNR$)
   INDEX QTarif.KVERTRAG
   SELECT FIRST 
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX Qtarif.KVERTRAG

   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Vertragsdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   ii% = 0
   zz% = RECCOUNT ("KVERTRAG")
   _prozt% = 0
   _proz2% = 0
   _anz% = zz%

   WHILE QTarif.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     MOUSE OFF 
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF Qtarif.kvertrag LIKE tvsnr$ + "*" THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (tarif.kvertrag) + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF Qtarif.kvertrag LIKE tvsnr$ + "*" THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (tarif.kvertrag) + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF Qtarif.kvertrag LIKE tvsnr$ + "*" THEN 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (tarif.kvertrag) + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     SELECT NEXT FILE "KVERTRAG"
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
   CALL Gauge(0,"")

  
   IF a% = 0 THEN 
     GETRisiko% = 0
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,291,248,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,291,222,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem Risiko/Person gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,""
         ADD DIALOG "ZEINLIST",7,6,55,280,165,2 + 128,2,G1Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,56,228,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,116,228,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,176,228,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETTarifADR% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETTarifADR% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETTarifADR% = VAL ( RIGHT$ (G1Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETTarifADR% = 0
 END IF 
 END FUNCTION 
  
 
 
 
 
 
 
 
 
 
FUNCTION GETRisikoADR%(lfdnr%,ma%,ge%,spa%,cvp%,vone$,bise$,eingbei%)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 4000 THEN 
     REDIM G1Vertraege$(24000)
   ELSE 
     c% = RECCOUNT ("KVERTRAG") * 6
     REDIM G1Vertraege$(c%)
   END IF 
   a% = 0
   DIM Auswahl$(1)
   tVSNR$ = VSNRPack$(VSNR$)
   INDEX QzvP1Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP1Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP1Name.KVERTRAG
   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Vertragsdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   ii% = 0
   zz% = RECCOUNT ("KVERTRAG")
   _prozt% = 0
   _proz2% = 0
   _anz% = zz%
   WHILE QzvP1Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QzvP1Name.kvertrag LIKE tvsnr$ + "*" THEN 
           g$ = ""
           IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QzvP1Name.kvertrag LIKE tvsnr$ + "*" THEN 
             g$ = ""
             IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
             ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF QzvP1Name.kvertrag LIKE tvsnr$ + "*" THEN 
         g$ = ""
         IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
         ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
     SELECT NEXT FILE "KVERTRAG"
   WEND 
   INDEX QzvP2Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP2Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP2Name.KVERTRAG
   WHILE QzvP2Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF gasp% THEN 
       IF Workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF QzvP2Name.kvertrag LIKE tvsnr$ + "*" THEN 
           g$ = ""
           IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF QzvP2Name.kvertrag LIKE tvsnr$ + "*" THEN 
             g$ = ""
             IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
             ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF QzvP2Name.kvertrag LIKE tvsnr$ + "*" THEN 
         g$ = ""
         IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
         ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
   INDEX QzvP3Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP3Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP3Name.KVERTRAG
   WHILE QzvP3Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     MOUSE OFF 
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP3Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP3Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP3Geb.kvertrag,"0d.mm.yyyy")
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF sok% THEN 
               Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 


   INDEX QzvP4Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP4Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP4Name.KVERTRAG
   WHILE QzvP4Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     MOUSE OFF 
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP4Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP4Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP4Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 

   INDEX QzvP5Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP5Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP5Name.KVERTRAG

   WHILE QzvP5Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     MOUSE OFF 
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP5Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP5Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP5Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
          IF workstation% = 0 THEN 
            sok% = - 1
            IF GMASuperCount% > 0 THEN 
              IF IsMASuper%(codema.KVERTRAG) THEN 
              ELSE 
                sok% = 0
              END IF 
            END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
            IF sok% THEN 
              G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
              IF a% = 0 THEN prompt$ = G1Vertraege$(0)
              tmpZeile$ = G1Vertraege$(a%)
              a% = a% + 1
            END IF 
          ELSE 
            IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
              sok% = - 1
              IF GMASuperCount% > 0 THEN 
                IF IsMASuper%(codema.KVERTRAG) THEN 
                ELSE 
                  sok% = 0
                END IF 
              END IF 
              IF sok% THEN 
                G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
                IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                  G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
                END IF 
                G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
                IF a% = 0 THEN prompt$ = G1Vertraege$(0)
                tmpZeile$ = G1Vertraege$(a%)
                a% = a% + 1
              END IF 
            END IF 
          END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 

   INDEX QzvP6Name.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP6Name.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP6Name.KVERTRAG

   WHILE QzvP6Name.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     MOUSE OFF 
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP6Name.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP6Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP6Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 
 
 
 
   INDEX QzvP1vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP1vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP1vName.KVERTRAG
   WHILE QzvP1vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP1vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 
   INDEX QzvP2vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP2vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP2vName.KVERTRAG

   WHILE QzvP2vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP2vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 
   INDEX QzvP3vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP3vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP3vName.KVERTRAG
   WHILE QzvP3vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP3vName.kvertrag LIKE tvsnr$ + "*" THEN 
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       g$ = ""
       IF zvP3Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP3Geb.kvertrag,"0d.mm.yyyy")
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 
   INDEX QzvP4vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP4vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP4vName.KVERTRAG
   WHILE QzvP4vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP4vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP4Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP4Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 
   INDEX QzvP5vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP5vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP5vName.KVERTRAG
   WHILE QzvP5vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP5vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP5Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP5Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 
   INDEX QzvP6vName.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX QzvP6vName.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QzvP6vName.KVERTRAG
   WHILE QzvP6vName.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF QzvP6vName.kvertrag LIKE tvsnr$ + "*" THEN 
       g$ = ""
       IF zvP6Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP6Geb.kvertrag,"0d.mm.yyyy")
       ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
       IF gasp% THEN 
         IF workstation% = 0 THEN 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
             IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
               G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
             END IF 
             G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         ELSE 
           IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
               IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
                 G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
               END IF 
               G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       ELSE 
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
 
         IF eingbei% > 0 THEN 
           IF CodeEingGE.kvertrag <> eingbei% THEN sok% = 0
         END IF 

         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$
           IF EingereichtBei.kvertrag <> "" AND NOT MNdisabled%("SEEEINGBEI") THEN 
             G1Vertraege$(a%) = G1Vertraege$(a%) + "/eingereicht Åber: " + EingereichtBei.kvertrag
           END IF 
           G1Vertraege$(a%) = G1Vertraege$(a%) + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
   CALL Gauge(0,"")
 
 
 
 
anfsu270420031: 
   IF a% = 0 THEN 
     GETRisikoADR% = 0
     REQUEST "Es wurde kein Vertrag gefunden?","Wollen Sie die ausfÅhrliche Suche starten?",130,reqsu%
     IF reqsu% = 1 THEN 
       INDEX QzvP1Name.KVERTRAG
       SELECT FIRST FILE "KVERTRAG" INDEX QzvP1Name.KVERTRAG
       CALL Server("LISTBOXINIT","Vertragsauswahl")
       CALL Gauge(1,"Vertragsdatei wird durchsucht...")
       CALL Server("GAUGEENABLECANCEL","")
       ii% = 0
       zz% = RECCOUNT ("KVERTRAG")
       _prozt% = 0
       _proz2% = 0
       _anz% = zz%
       WHILE NOT EOF ("KVERTRAG") AND ServerReply$() <> "CANCEL"
         MOUSE OFF 
 
         _proz% = INT ((100 / _anz%) * _proz2%)
         IF _proz% > 100 THEN _proz% = 100
         IF _proz% < 2 THEN _proz% = 2
         IF _proz% <> _prozt% THEN 
           _prozt% = _proz%
           SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
           CALL Gauge(_proz%,"")
         END IF 
         _proz2% = _proz2% + 1
         ok% = 0
         IF QzvP1Name.kvertrag LIKE tVSNR$ + "*" OR QzvP1Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP1vName.kvertrag LIKE tVSNR$ + "*" OR QzvP1vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             G1Vertraege$(a%) = LTRIM$ (zvP1vName.kvertrag) + "/" + LTRIM$ (zvP1Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwsu270420031
         END IF 
         IF QzvP2Name.kvertrag LIKE tVSNR$ + "*" OR QzvP2Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP2vName.kvertrag LIKE tVSNR$ + "*" OR QzvP2vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           ok% = - 1
           IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
            IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             G1Vertraege$(a%) = LTRIM$ (zvP2vName.kvertrag) + "/" + LTRIM$ (zvP2Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwsu270420031
         END IF 
         IF QzvP3Name.kvertrag LIKE tVSNR$ + "*" OR QzvP3Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP3vName.kvertrag LIKE tVSNR$ + "*" OR QzvP3vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP3Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP3Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             G1Vertraege$(a%) = LTRIM$ (zvP3vName.kvertrag) + "/" + LTRIM$ (zvP3Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwsu270420031
         END IF 
         IF QzvP4Name.kvertrag LIKE tVSNR$ + "*" OR QzvP4Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP4vName.kvertrag LIKE tVSNR$ + "*" OR QzvP4vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP4Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP4Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             G1Vertraege$(a%) = LTRIM$ (zvP4vName.kvertrag) + "/" + LTRIM$ (zvP4Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwsu270420031
         END IF 
         IF QzvP5Name.kvertrag LIKE tVSNR$ + "*" OR QzvP5Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP5vName.kvertrag LIKE tVSNR$ + "*" OR QzvP5vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP5Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP5Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             G1Vertraege$(a%) = LTRIM$ (zvP5vName.kvertrag) + "/" + LTRIM$ (zvP5Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwsu270420031
         END IF 
         IF QzvP6Name.kvertrag LIKE tVSNR$ + "*" OR QzvP6Name.kvertrag LIKE "*" + tVSNR$ + "*" OR QzvP6vName.kvertrag LIKE tVSNR$ + "*" OR QzvP6vName.kvertrag LIKE "*" + tVSNR$ + "*" THEN 
           IF zvP6Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP6Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           IF gasp% THEN 
             IF workstation% = 0 THEN 
               ok% = - 1
               G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             ELSE 
               IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
                 ok% = - 1
                 G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               END IF 
             END IF 
           ELSE 
             ok% = - 1
             G1Vertraege$(a%) = LTRIM$ (zvP6vName.kvertrag) + "/" + LTRIM$ (zvP6Name.kvertrag) + "/" + g$ + "/" + vs_Nr.kvertrag + "/" + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           END IF 
           GOTO erwsu270420031
         END IF 
erwsu270420031: 
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ok% = - 1 THEN 
           IF sok% THEN 
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
         SELECT NEXT FILE "KVERTRAG"
         CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
         CALL Server("LISTBOXADD",tmpZeile$)
         ii% = ii% + 1
         SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
       WEND 
       CALL Gauge(0,"")
       IF a% > 0 THEN GOTO anfsu270420031
     END IF 
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,391,228,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,391,202,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleichem Risiko/Person gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,""
         ADD DIALOG "ZEINLIST",7,6,55,380,145,2 + 128,2,G1Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,96,208,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,156,208,55,15,0,"&Info",2,1
         ADD DIALOG "ZEINLIST",1,216,208,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1
           GETRisikoADR% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
         CASE 0
           GETRisikoADR% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GETRisikoADR% = VAL ( RIGHT$ (G1Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GETRisikoADR% = 0
 END IF 
 END FUNCTION 
 


FUNCTION GETFS24Nr%(lfdnr%,ma%,ge%,spa%,cvp%,vone$,bise$)
 MOUSE OFF 
 cfile$ = FILE 
 codeku% = codeku.kvertrag
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 req% = 1
 VSNR$ = eingab$
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 4000 THEN 
     REDIM G1Vertraege$(24000)
   ELSE 
     c% = RECCOUNT ("KVERTRAG") * 6
     REDIM G1Vertraege$(c%)
   END IF 
   a% = 0
   DIM Auswahl$(1)
   tVSNR$ = UCASE$ (VSNR$)
   IF Gfpb% <> - 1 THEN 
     INDEX FS24Satz_ID.KVERTRAG
     SELECT FIRST FILE "KVERTRAG" INDEX FS24Satz_ID.KVERTRAG
     SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX FS24Satz_ID.KVERTRAG
   END IF 
   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Vertragsdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
   ii% = 0
   zz% = RECCOUNT ("KVERTRAG")
   _prozt% = 0
   _proz2% = 0
   _anz% = zz%
  IF Gfpb% <> - 1 THEN 
   WHILE FS24Satz_ID.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF gasp% THEN 
       IF workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF FS24Satz_ID.kvertrag LIKE tvsnr$ + "*" THEN 
           g$ = ""
           IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (FS24Satz_ID.kvertrag) + " / " + vs_Nr.kvertrag + " / " + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000") IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF FS24Satz_ID.kvertrag LIKE tvsnr$ + "*" THEN 
             g$ = ""
             IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
             ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (FS24Satz_ID.kvertrag) + " / " + vs_Nr.kvertrag + " / " + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF FS24Satz_ID.kvertrag LIKE tvsnr$ + "*" THEN 
         g$ = ""
         IF zvP1Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP1Geb.kvertrag,"0d.mm.yyyy")
         ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (FS24Satz_ID.kvertrag) + " / " + vs_Nr.kvertrag + " / " + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
     SELECT NEXT FILE "KVERTRAG"
   WEND 
   CALL Gauge(0,"")
   INDEX FS24Satz_ID2.KVERTRAG
   SELECT FIRST FILE "KVERTRAG" INDEX FS24Satz_ID2.KVERTRAG
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX FS24Satz_ID2.KVERTRAG
   WHILE FS24Satz_ID2.kvertrag LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
     MOUSE OFF 
       _proz% = INT ((100 / _anz%) * _proz2%)
       IF _proz% > 100 THEN _proz% = 100
       IF _proz% < 2 THEN _proz% = 2
       IF _proz% <> _prozt% THEN 
         _prozt% = _proz%
         SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
         CALL Gauge(_proz%,"")
       END IF 
       _proz2% = _proz2% + 1
     IF gasp% THEN 
       IF Workstation% = 0 THEN 
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF FS24Satz_ID2.kvertrag LIKE tvsnr$ + "*" THEN 
           g$ = ""
           IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
           ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
           sok% = - 1
           IF GMASuperCount% > 0 THEN 
             IF IsMASuper%(codema.KVERTRAG) THEN 
             ELSE 
               sok% = 0
             END IF 
           END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
           IF sok% THEN 
             G1Vertraege$(a%) = LTRIM$ (FS24Satz_ID2.kvertrag) + " / " + vs_Nr.kvertrag + " / " + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = G1Vertraege$(0)
             tmpZeile$ = G1Vertraege$(a%)
             a% = a% + 1
           END IF 
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF FS24Satz_ID2.kvertrag LIKE tvsnr$ + "*" THEN 
             g$ = ""
             IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
             ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
             sok% = - 1
             IF GMASuperCount% > 0 THEN 
               IF IsMASuper%(codema.KVERTRAG) THEN 
               ELSE 
                 sok% = 0
               END IF 
             END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
             IF sok% THEN 
               G1Vertraege$(a%) = LTRIM$ (FS24Satz_ID2.kvertrag) + " / " + vs_Nr.kvertrag + " / " + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
               IF a% = 0 THEN prompt$ = G1Vertraege$(0)
               tmpZeile$ = G1Vertraege$(a%)
               a% = a% + 1
             END IF 
           END IF 
         END IF 
       END IF 
     ELSE 
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF FS24Satz_ID2.kvertrag LIKE tvsnr$ + "*" THEN 
         g$ = ""
         IF zvP2Geb.kvertrag > 0 THEN g$ = "Geb.dat.: " + DATE$ (zvP2Geb.kvertrag,"0d.mm.yyyy")
         ges$ = "/" + LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
         sok% = - 1
         IF GMASuperCount% > 0 THEN 
           IF IsMASuper%(codema.KVERTRAG) THEN 
           ELSE 
             sok% = 0
           END IF 
         END IF 
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
         IF sok% THEN 
           G1Vertraege$(a%) = LTRIM$ (FS24Satz_ID2.kvertrag) + " / " + vs_Nr.kvertrag + " / " + von$ + " - " + bis$ + ges$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = G1Vertraege$(0)
           tmpZeile$ = G1Vertraege$(a%)
           a% = a% + 1
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 ELSE 
   FILE "kvertrag"
   INDEX lfdnr.kvertrag
   FILE "spezkond"
   INDEX codevt.spezkond
   SELECT FIRST 
   codevtold% = 0
   codekeyold% = 0
   weit% = - 1
   WHILE weit% = - 1 AND ServerReply$() <> "CANCEL"
     _proz% = INT ((100 / _anz%) * _proz2%)
     IF _proz% > 100 THEN _proz% = 100
     IF _proz% < 2 THEN _proz% = 2
     IF _proz% <> _prozt% THEN 
       _prozt% = _proz%
       SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
       CALL Gauge(_proz%,"")
     END IF 
     _proz2% = _proz2% + 1
     codevt% = codevt.spezkond
     codekey% = codekey.spezkond
     IF codekey% <> codekeyold% THEN 
       codekeyold% = codekey%
       IF codevt% <> codevtold% THEN 
         SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
         SELECT KEY codevt% FILE "kvertrag" INDEX lfdnr.kvertrag
         ges$ = LTRIM$ (Gesellschaft.kvertrag) + " / " + LTRIM$ (sparte.kvertrag)
         IF vonFirmaAgentur.spezkond = "j" THEN 
           ges$ = " Prozente / " + ges$
         ELSE 
           ges$ = " Pauschale / " + ges$
         END IF 
         IF tstruk.spezkond = 1 THEN ges$ = " Struktur / " + ges$
         G1Vertraege$(a%) = vs_Nr.kvertrag + " / " + ges$ + SPACE$ (100) + STR$ (lfdnr.KVERTRAG,"000000")
         IF a% = 0 THEN prompt$ = G1Vertraege$(0)
         tmpZeile$ = G1Vertraege$(a%)
         a% = a% + 1
       END IF 
     ELSE 
       weit% = 0
     END IF 
     SELECT NEXT FILE "spezkond"
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"9999")) + " gefunden (" + VS_Nr.kvertrag + ".)")
     CALL Server("LISTBOXADD",tmpZeile$)
     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (a%,",999999")) + " von " + LTRIM$ ( STR$ (zz%,",999999")) + " gefunden / durchsucht: " + LTRIM$ ( STR$ (ii%,",999999"))
   WEND 
 END IF 
   CALL Gauge(0,"")
 
 
   IF a% > 0 THEN 
     MOUSE ON 
     lok% = - 1
     WHILE lok%
       CREATE DIALOG "ZEINLIST",0,0,391,328,"Vertrag suchen...","MS Sans Serif",8
       ADD DIALOG "ZEINLIST",4,0,0,391,202,0,""
       ADD DIALOG "ZEINLIST",9,8,11,25,24,2
       ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge gefunden."
       ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
       ADD DIALOG "ZEINLIST",5,35,58,198,10,0,""
       ADD DIALOG "ZEINLIST",7,6,55,380,245,2 + 128,2,G1Vertraege$,Auswahl$,prompt$
       ADD DIALOG "ZEINLIST",1,96,308,55,15,1,"&OK",1,1
       ADD DIALOG "ZEINLIST",1,156,308,55,15,0,"&Info",2,1
       ADD DIALOG "ZEINLIST",1,216,308,55,15,0,"&Abbrechen",0,0
       DIALOG "ZEINLIST",req%
       REMOVE DIALOG "ZEINLIST"
       SELECT CASE req%
       CASE 1
         GETFS24Nr% = VAL ( RIGHT$ (Auswahl$(0),6))
         lok% = 0
       CASE 0
         GETFS24Nr% = 0
         lok% = 0
       CASE 2
         CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
         prompt$ = Auswahl$(0)
       END SELECT 
     WEND 
     
   ELSE 
     GETFS24Nr% = VAL ( RIGHT$ (G1Vertraege$(0),6))
   END IF 
 ELSE 
   GETFS24Nr% = 0
 END IF 
 FILE "KVERTRAG"
 SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SET INDEX cindex$
 INDEX cindex$
 SET STATUS "Bereit"
 MOUSE ON 
 FILE cfile$
 END FUNCTION 
 



FUNCTION GetAntragADR%(lfdnr%,ma%,ge%,spa%,cvp%,vone$,bise$)
 MOUSE OFF 
 cfile$ = FILE 
 cuvt% = lfdnr.KVERTRAG
 FILE "KVERTRAG"
 cindex$ = INDEX 
 IF lfdnr% = 0 THEN 
   VSNR$ = ""
 ELSE 
   SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF FOUND ("KVERTRAG") THEN VSNR$ = VS_Nr.KVERTRAG ELSE VSNR$ = ""
 END IF 
 IF eingab$ = "" AND viab% <> 1 THEN 
   CREATE DIALOG "DZ2",0,0,191,87,"Vertrag suchen...","MS Sans Serif",8
   ADD DIALOG "DZ2",4,0,0,191,63,0,""
   ADD DIALOG "DZ2",9,5,10,21,22,2
   ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Antragsnummer des gesuchten Vertrages ein:"
   ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
   ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
   ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
   ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
   DIALOG "DZ2",req%
   REMOVE DIALOG "DZ2"
 ELSE 
   VSNR$ = eingab$
   req% = 1
 END IF 
 IF req% <> 0 AND VSNR$ <> "" THEN 
   REM 030699
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   DIM Auswahl$(1)
   INDEX QAntragsNr.KVERTRAG
   SELECT FIRST 
   tVSNR$ = VSNRPack$(VSNR$)
   SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QAntragsNr.KVERTRAG
   a% = 0
   WHILE QAntragsNr.KVERTRAG LIKE tVSNR$ + "*" AND NOT EOF ("kvertrag")
     MOUSE OFF 
     sok% = - 1
         IF ma% > 0 THEN 
           IF codema.kvertrag <> ma% THEN sok% = 0
         END IF 
         IF ge% > 0 THEN 
           IF codege.kvertrag <> ge% THEN sok% = 0
         END IF 
         IF spa% > 0 THEN 
           IF codeva.kvertrag <> spa% THEN sok% = 0
         END IF 
         IF cvp% > 0 THEN 
           IF codevp.kvertrag <> cvp% THEN sok% = 0
         END IF 
         IF DAYS (vone$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag < DAYS (vone$) THEN sok% = 0
           END IF 
         END IF 
         IF DAYS (bise$) > 0 THEN 
           IF erfasdatum.kvertrag > 0 THEN 
             IF erfasdatum.kvertrag > DAYS (bise$) THEN sok% = 0
           END IF 
         END IF 
     IF GASP% THEN 
       IF workstation% = 0 THEN 
         
         name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
         IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
         IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
         IF sok% THEN 
           Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
           IF a% = 0 THEN prompt$ = Vertraege$(0)
           a% = a% + 1
         END IF 
       ELSE 
         IF (IsWksVisible%(Workstation.KVERTRAG) = - 1) THEN 
           name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
           IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
           IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
           IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
           IF sok% THEN 
             Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
             IF a% = 0 THEN prompt$ = Vertraege$(0)
             a% = a% + 1
           END IF 
         END IF 
       END IF 
     ELSE 
       name$ = LTRIM$ (ANAchname.kvertrag) + "," + LTRIM$ (AVorname.kvertrag)
       IF LTRIM$ (kennzeichen.kvertrag) <> "" THEN name$ = name$ + "," + LTRIM$ (kennzeichen.kvertrag)
       IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
       IF sok% THEN 
         Vertraege$(a%) = PAD$ (AntragsNr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + name$ + SPACE$ (160) + STR$ (lfdnr.KVERTRAG,"000000")
         IF a% = 0 THEN prompt$ = Vertraege$(0)
         a% = a% + 1
       END IF 
     END IF 
     SELECT NEXT FILE "KVERTRAG"
   WEND 
   IF a% = 0 THEN 
     GetAntragADR% = 0
   ELSE 
     IF a% > 1 THEN 
       MOUSE ON 
       lok% = - 1
       WHILE lok%
         CREATE DIALOG "ZEINLIST",0,0,441,298,"Vertrag suchen...","MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,441,272,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus. Mit 'Info' erhalten Sie weitere Angaben zum gewÑhlten Vertrag."
         ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Antragsnummer                              von              bis"
         ADD DIALOG "ZEINLIST",7,3,68,430,205,2 + 128,2,Vertraege$,Auswahl$,prompt$
         IF MAKLER$ <> "TRUE" THEN 
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Abbrechen",0,0
         ELSE 
           ADD DIALOG "ZEINLIST",1,150,278,55,15,1,"&Kontoinfo",3,1
           ADD DIALOG "ZEINLIST",1,205,278,55,15,1,"&OK",1,1
           ADD DIALOG "ZEINLIST",1,260,278,55,15,0,"&Info",2,1
           ADD DIALOG "ZEINLIST",1,315,278,55,15,0,"&Abbrechen",0,0
         END IF 
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
         SELECT CASE req%
         CASE 1,3
           GetAntragADR% = VAL ( RIGHT$ (Auswahl$(0),6))
           lok% = 0
           IF req% = 3 THEN 
             kontoinf% = GetVertrag%
           ELSE 
             kontoinf% = 0
           END IF 
         CASE 0
           GetAntragADR% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
       WEND 
     ELSE 
       GetAntragADR% = VAL ( RIGHT$ (Vertraege$(0),6))
     END IF 
   END IF 
   FILE "KVERTRAG"
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SET INDEX cindex$
   INDEX cindex$
   SET STATUS "Bereit"
   MOUSE ON 
   FILE cfile$
 ELSE 
   GetAntragADR% = 0
 END IF 
 END FUNCTION 
 
 


  
 ' BMCHECKMAIL
 ' =====================================================================
 ' Zweck:       Testet auf neue Nachrichten fÅr aktuellen Nutzer
 ' Nutzung:     CALL BMCheckMail(t%)
 ' Hinweis:     Diese Routine wird ereignisgesteuert aufgerufen.
 ' =====================================================================
 ' 11.07.93 - Umwandlung in ereignisgesteuerte Routine
 
SUB BMCheckMail()
 IF UCASE$ ( FORM ) LIKE "AKQ*" THEN 
   END SUB 
 END IF 
 
 CALL DFile(2,"OFFICE\mail" + _fpw$)
 cfile$ = FILE 
 w% = 280:h% = 100
 di2$ = "NETMAIL"
 FILE "mail"
 INDEX codema.mail
 SELECT FIRST FILE "mail" INDEX codema.mail
 SELECT KEY GMAcodema% FILE "mail" INDEX codema.mail
 tfoundm% = 0
 SELECT KEY GMAcodema% FILE "Supervis" INDEX codema.supervis
 nn$ = Name.supervis
 DIM TM%( RECCOUNT ("mail"))
 DIM TM$( RECCOUNT ("mail"))
 WHILE GMAcodema% = codema.mail AND NOT EOF ("mail")
   IF gelîscht.mail <> 1 AND gelesen.mail <> 1 THEN 
     TM%(tfoundm%) = codemail.mail
     TM$(tfoundm%) = DATE$ (datum.mail,"0d.mm.yyyy") + " " + TIME$ (Zeit.mail,"hh:mm") + " " + LEFT$ (Absender,30) + "/" + nachricht.mail + SPACE$ (100) + STR$ (codemail.mail,"000000")
     tfoundm% = tfoundm% + 1
   END IF 
   SELECT NEXT 
 WEND 
 IF tfoundm% < 1 THEN 
   nomail% = 1
 END IF 
 IF tfoundm% > 1 THEN 
 
     prompt$ = TM$(0)
     DIM dlg1 AS Dialog
     DIM control1 AS DialogControl 
     GOTO BMCH100520002
BMCH100520001:  
     REDIM TM%( RECCOUNT ("mail"),1)
     REDIM TM$( RECCOUNT ("mail"),1)
     REDIM TM%( RECCOUNT ("MAIL"))
     REDIM TM$( RECCOUNT ("MAIL"))
     REM FOR a% = 0 TO RECCOUNT ("mail") - 1
       REM TM% = 0
       REM TM$ = ""
     REM NEXT a%
     FILE "MAIL"
     INDEX Codema.mail
     SELECT FIRST 
     SELECT KEY GMAcodema% FILE "mail" INDEX codema.mail
     tfoundm% = 0
 
      WHILE GMAcodema% = codema.mail AND NOT EOF ("mail")
       IF gelîscht.mail <> 1 AND gelesen.mail <> 1 THEN 
         TM%(tfoundm%) = codemail.mail
         TM$(tfoundm%) = DATE$ (datum.mail,"0d.mm.yyyy") + " " + TIME$ (Zeit.mail,"hh:mm") + " " + LEFT$ (Absender,30) + "/" + nachricht.mail + SPACE$ (100) + STR$ (codemail.mail,"000000")
         tfoundm% = tfoundm% + 1
       END IF 
       SELECT NEXT 
     WEND 
     REDIM Auswahl$(tfound1%)
BMCH100520002:   
     Superbase.Dialogs.Add("TERLISTE")
     SET dlg1 = Superbase.Dialogs.TERLISTE
     dlg1.Move(0,0,440,292)
     dlg1.Caption = "Nachrichten-öbersicht"
     dlg1.FontName = "MS Sans Serif"
     dlg1.FontSize = 8
 
     SET control1 = dlg1.Add("DialogLabel1","DialogLabel")
     control1.Move(3,3,255,9)
     control1.Caption = "Termin          Zeit   Name                          Notiz"
 
     SET control1 = dlg1.Add("DialogListBox1","DialogListBox")
     control1.Move(4,17,429,249)
     control1.MultiSelect = 1
     control1.ScrollBars = 2
     control1.Bind("TM$","Auswahl$","prompt$")
 
     SET control1 = dlg1.Add("DialogCommandButton1","DialogCommandButton")
     control1.Move(4,270,114,16)
     control1.Default = 1
     control1.Caption = "&Nachricht-Eintrag anzeigen"
     control1.ReturnValue = 1
 
     REM SET control1 = dlg1.Add("DialogCommandButton2","DialogCommandButton")
     REM control1.Move(121,270,56,16)
     REM control1.Caption = "&Drucken"
     REM control1.ReturnValue = 2
 
     REM SET control1 = dlg1.Add("DialogCommandButton3","DialogCommandButton")
     REM control1.Move(180,270,94,16)
     REM control1.Caption = "alle markierten Er&ledigen"
     REM control1.ReturnValue = 3
 
     SET control1 = dlg1.Add("DialogCommandButton4","DialogCommandButton")
     control1.Move(277,270,155,16)
     control1.Caption = "&öbersicht schlie·en"
     control1.ReturnValue = 0
     control1.Cancel = 1
  
     DIALOG "TERLISTE",req%
     REMOVE DIALOG ALL 
     IF req% = 0 THEN 
       GOTO BMCH04062000end
     END IF 
     IF req% = 1 THEN 
       codemail% = VAL ( RIGHT$ (Auswahl$(0),6))
       IF codemail% > 0 THEN CALL BMCheckEinz(codemail%)
       GOTO BMCH100520001
     END IF 
     GOTO BMCH100520001
 END IF 
 
 
 
 
 
 
 IF tfoundm% = 1 THEN 
   codemail% = TM%(0)
   CALL BMCheckEinz(codemail%)
 END IF 
 FILE cfile$
BMCH04062000end: 
 REM CALL Fehler("EE","")
 IF offBMCh% = 0 AND tfoundm% <> 1 THEN CALL CheckTermin()
 offBMCh% = 0
 END SUB 
 
SUB BMCheckEinz(codemail%)
 cfile$ = FILE 
     SELECT KEY vcodema% FILE "Supervis" INDEX codema.supervis
     nn$ = Name.supervis
     SELECT KEY codemail% LOCK FILE "mail" INDEX CodeMAIL.mail
     DIM dlg AS Dialog
     DIM control AS DialogControl
 
     Superbase.Dialogs.Add("DIALOG")
     SET dlg = Superbase.Dialogs.DIALOG
     dlg.Move(0,0,400,214)
     dlg.Caption = "Nachricht empfangen"
     dlg.FontName = "MS Sans Serif"
     dlg.FontSize = 8
 
     SET control = dlg.Add("DialogLabel1","DialogLabel")
     control.Move(4,4,120,10)
     control.Caption = "Nachricht gesendet von:"
 
     SET control = dlg.Add("DialogTextBox3","DialogTextBox")
     control.Move(4,16,118,12)
     control.ReadOnly = 1
     control.MaxLength = 20
     control.TextBinding = "absender.mail"
 
     SET control = dlg.Add("DialogLabel2","DialogLabel")
     control.Move(4,30,120,8)
     control.Caption = "Nachricht:"
 
     SET control = dlg.Add("DialogTextBox1","DialogTextBox")
     control.Move(4,40,392,64)
     control.MultiLine = 1
     control.ReadOnly = 1
     control.ScrollEnable = 3
     control.ScrollBars = 3
     control.MaxLength = 4000
     control.TextBinding = "nachricht.mail"
 
     SET control = dlg.Add("DialogLabel3","DialogLabel")
     control.Move(4,105,120,8)
     control.Caption = "Antwort:"
 
     SET control = dlg.Add("DialogTextBox2","DialogTextBox")
     control.Move(4,116,392,72)
     control.MultiLine = 1
     control.ScrollEnable = 3
     control.ScrollBars = 3
     control.MaxLength = 4000
     control.TextBinding = "antwort.mail"
 
     SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
     control.Move(229,193,36,16)
     control.Default = 1
     control.Caption = "Gelesen"
     control.ReturnValue = 1
 
     SET control = dlg.Add("DialogCommandButton4","DialogCommandButton")
     control.Move(268,193,36,16)
     control.Caption = "&Lîschen"
     control.ReturnValue = 2
 
     SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(306,193,52,16)
     control.Caption = "&Beantworten"
     control.ReturnValue = 3
 
     SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(360,193,36,16)
     control.Caption = "&Abbruch"
     control.ReturnValue = 0
     DIALOG "DIALOG",req%
     REMOVE DIALOG "DIALOG"
     IF req% = 1 THEN 
       
       gelesen.mail = 1
       DatumGelesen.mail = TODAY 
       ZeitGelesen.mail = NOW 
       STORE FILE "mail"
       UNLOCK CURRENT FILE "mail"
       UNLOCK FILE "mail"
     END IF 
     IF req% = 2 THEN 
       
       gelîscht.mail = 1
       DatumGelîscht.mail = TODAY 
       ZeitGelîscht.mail = NOW 
       STORE FILE "mail"
       UNLOCK CURRENT FILE "mail"
       UNLOCK FILE "mail"
     END IF 
     IF req% = 3 THEN 
       DatumAntwort.mail = TODAY 
       ZeitAntwort.mail = NOW 
       gelesen.mail = 1
       DatumGelesen.mail = TODAY 
       ZeitGelesen.mail = NOW 
       von% = codemavon.mail
       notiz$ = nachricht.mail
       antwort$ = antwort.mail
       STORE FILE "mail"
       UNLOCK CURRENT FILE "mail"
       UNLOCK FILE "mail"
       BLANK FILE "mail"
       codemail.mail = SER ("mail",1)
       codema.mail = von%
       codemavon.mail = GMAcodema%
       nachricht.mail = notiz$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + "ANTWORT: " + CHR$ (13) + CHR$ (10) + antwort$
       Datum.mail = TODAY 
       Zeit.mail = NOW 
       Absender.mail = nn$
       STORE FILE "mail"
       UNLOCK CURRENT FILE "mail"
       UNLOCK FILE "mail"
     END IF 
   
 END IF 
 FILE cfile$
 END SUB 
 
 
 ' CheckTermin
 ' =====================================================================
 ' Zweck:       Testet auf Termine fÅr den aktuellen Nutzer in der TVORLAGE - Datei
 ' Nutzung:     CALL CheckTermin()
 ' Hinweis:     Diese Routine wird ereignisgesteuert aufgerufen.
 ' =====================================================================  
 
SUB CheckTermin()
 CALL DFile(2,"OFFICE\Akquise" + _fpw$)
 CALL DFile(2,"OFFICE\tvorlage" + _fpw$)
 REM GCODIE% = 0
 GCODieRuf1% = 0
 cfile$ = FILE 
 IF EXISTS (GMAcodema%,codema.tvorlage) THEN 
   SELECT KEY GMAcodema% FILE "supervis" INDEX codema.supervis
   TName$ = Name.supervis
   FILE "TVORLAGE"
   INDEX DTVorlage.tvorlage
   SELECT FIRST 
   REDIM TV%( RECCOUNT ("tvorlage"),1)
   REDIM TV$( RECCOUNT ("tvorlage"),1)
   REDIM TV%( RECCOUNT ("TVORLAGE"))
   REDIM TV$( RECCOUNT ("TVORLAGE"))
   REM FOR i% = 0 TO RECCOUNT ("tvorlage") - 1
     REM TV%(i%) = 0
     REM TV$(i%) = ""
   REM NEXT i%
   REM CALL Fehler("","")
   dtv$ = STR$ (vcodema%,"000000") + "000000000000"
   SELECT FIRST FILE "tvorlage" INDEX DTVorlage.tvorlage
   SELECT KEY dtv$ FILE "tvorlage" INDEX DTVorlage.tvorlage
   tfound1% = 0
   IF offVlLi% = 0 THEN 
     WHILE codema.tvorlage = GMAcodema% AND Datum.tvorlage <= TODAY AND NOT EOF ("TVORLAGE")
       IF zeit.tvorlage <= NOW AND Datum.tvorlage <= TODAY THEN 
         IF EXISTS (codeaq.tvorlage,codeaq.Akquise) THEN 
           TV%(tfound1%) = codeaq.tvorlage
           nn$ = LEFT$ (Nachname.tvorlage,30)
           IF GCODie% <> - 1 THEN 
             l% = LEN (nn$)
             WHILE l% < 30
               nn$ = nn$ + " "
               l% = LEN (nn$)
             WEND 
           END IF 
           tt$ = DATE$ (termin.tvorlage,"0d.mm.yyyy") + " " + TIME$ (uhrzeit.tvorlage,"hh:mm") + "  "
           TV$(tfound1%) = DATE$ (datum.tvorlage,"0d.mm.yyyy") + " " + TIME$ (zeit.tvorlage,"hh:mm") + "  " + tt$ + nn$ + " / " + LEFT$ (Notiz.tvorlage,100) + CHR$ (100) + STR$ (codeaq.tvorlage,"000000")
           SELECT KEY GMAcodema% FILE "Supervis" INDEX codema.supervis
           SELECT KEY codeaq.tvorlage FILE "AKQUISE" INDEX codeaq.AKQUISE
           IF EMAILRaus.tvorlage <> "j" AND GCODie% = - 1 THEN 
             IF LTRIM$ (emailshost.supervis) <> "" THEN 
               IF EMAILRaus.AKQUISE <> "j" AND EMAILAutomat.AkquiSE = "j" THEN 
                 IF LTRIM$ (EMAILTO.AKQuise) <> "" THEN 
                    IF LTRIM$ (EMAILBETREFF.AKquise) <> "" THEN 
                      REM 10052003
                      IF Datum.tvorlage <= TODAY THEN CALL EMAILManSend(codeaq.tvorlage,0)
                    END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
           IF GCODIE% = - 1 THEN 
             IF GCodieRuf1% = 0 THEN CALL SearchInitAq2("tvorlage")
           END IF 
           IF GCODIE% = - 1 THEN CALL SearchVorbAq2("tvorlage")
           tfound1% = tfound1% + 1
         ELSE 
           SELECT CURRENT LOCK FILE "TVORLAGE"
           SELECT REMOVE FILE "TVORLAGE"
           SELECT PREVIOUS FILE "TVORLAGE"
         END IF 
       ELSE 
         IF Datum.tvorlage < TODAY THEN 
           IF EXISTS (codeaq.tvorlage,codeaq.Akquise) THEN 
             TV%(tfound1%) = codeaq.tvorlage
             nn$ = LEFT$ (Nachname.tvorlage,30)
             IF GCODie% <> - 1 THEN 
               l% = LEN (nn$)
               WHILE l% < 30
                 nn$ = nn$ + " "
                 l% = LEN (nn$)
               WEND 
             END IF 
             tt$ = DATE$ (termin.tvorlage,"0d.mm.yyyy") + " " + TIME$ (uhrzeit.tvorlage,"hh:mm") + "  "
             TV$(tfound1%) = DATE$ (datum.tvorlage,"0d.mm.yyyy") + " " + TIME$ (zeit.tvorlage,"hh:mm") + "  " + tt$ + nn$ + " / " + LEFT$ (Notiz.tvorlage,100) + CHR$ (100) + STR$ (codeaq.tvorlage,"000000")
             SELECT KEY GMAcodema% FILE "Supervis" INDEX codema.supervis
             SELECT KEY codeaq.tvorlage FILE "AKQUISE" INDEX codeaq.AKQUISE
             IF EMAILRaus.tvorlage <> "j" AND GCODie% = - 1 THEN 
               IF LTRIM$ (emailshost.supervis) <> "" THEN 
                 IF EMAILRaus.AKQUISE <> "j" AND EMAILAutomat.AkquiSE = "j" THEN 
                   IF LTRIM$ (EMAILTO.AKQuise) <> "" THEN 
                      IF LTRIM$ (EMAILBETREFF.AKquise) <> "" THEN 
                        REM 10052003
                        IF Datum.tvorlage <= TODAY THEN CALL EMAILManSend(codeaq.tvorlage,0)
                      END IF 
                   END IF 
                 END IF 
               END IF 
             END IF 
             IF GCODIE% = - 1 THEN 
               IF GCodieRuf1% = 0 THEN CALL SearchInitAq2("tvorlage")
             END IF 
             IF GCODIE% = - 1 THEN CALL SearchVorbAq2("tvorlage")
             tfound1% = tfound1% + 1
           ELSE 
             SELECT CURRENT LOCK FILE "TVORLAGE"
             SELECT REMOVE FILE "TVORLAGE"
             SELECT PREVIOUS FILE "TVORLAGE"
           END IF 
         END IF 
       END IF 
       SELECT NEXT FILE "TVORLAGE" INDEX DTVorlage.tvorlage
     WEND 
   ELSE 
     WHILE codema.tvorlage = GMAcodema% AND NOT EOF ("TVORLAGE")
       IF EXISTS (codeaq.tvorlage,codeaq.Akquise) THEN 
         TV%(tfound1%) = codeaq.tvorlage
         nn$ = LEFT$ (Nachname.tvorlage,30)
         IF GCODie% <> - 1 THEN 
           l% = LEN (nn$)
           WHILE l% < 30
             nn$ = nn$ + " "
             l% = LEN (nn$)
           WEND 
         END IF 
         tt$ = DATE$ (termin.tvorlage,"0d.mm.yyyy") + " " + TIME$ (uhrzeit.tvorlage,"hh:mm") + "  "
         TV$(tfound1%) = DATE$ (datum.tvorlage,"0d.mm.yyyy") + " " + TIME$ (zeit.tvorlage,"hh:mm") + "  " + tt$ + nn$ + " / " + LEFT$ (Notiz.tvorlage,100) + CHR$ (100) + STR$ (codeaq.tvorlage,"000000")
         SELECT KEY GMAcodema% FILE "Supervis" INDEX codema.supervis
         SELECT KEY codeaq.tvorlage FILE "AKQUISE" INDEX codeaq.AKQUISE
         IF EMAILRaus.tvorlage <> "j" AND GCODie% = - 1 THEN 
           IF LTRIM$ (emailshost.supervis) <> "" THEN 
             IF EMAILRaus.AKQUISE <> "j" AND EMAILAutomat.AkquiSE = "j" THEN 
               IF LTRIM$ (EMAILTO.AKQuise) <> "" THEN 
                 IF LTRIM$ (EMAILBETREFF.AKquise) <> "" THEN 
                   REM 10052003
                   IF Datum.tvorlage <= TODAY THEN CALL EMAILManSend(codeaq.tvorlage,0)
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
         IF GCODIE% = - 1 THEN 
           IF GCodieRuf1% = 0 THEN CALL SearchInitAq2("tvorlage")
         END IF 
         IF GCODIE% = - 1 THEN CALL SearchVorbAq2("tvorlage")
         tfound1% = tfound1% + 1
       ELSE 
         SELECT CURRENT LOCK FILE "TVORLAGE"
         SELECT REMOVE FILE "TVORLAGE"
         SELECT PREVIOUS FILE "TVORLAGE"
       END IF 
       SELECT NEXT FILE "TVORLAGE" INDEX DTVorlage.tvorlage
     WEND 
   END IF 
   REDIM Auswahl$(tfound1%)
 
   ok% = 1
   IF ter1anz% = 1 AND tfound1% < 1 THEN 
     CALL Fehler("Keine Vorlagetermine gefunden!","")
   END IF 
   IF tfound1% >= 1 THEN 
     
     prompt$ = TV$(0)
 
     DIM dlg1 AS Dialog
     DIM control1 AS DialogControl 
     GOTO TCH100520002
 
TCH100520001:  
 
     REDIM TV%( RECCOUNT ("tvorlage"),1)
     REDIM TV$( RECCOUNT ("tvorlage"),1)
     REDIM TV%( RECCOUNT ("tvorlage"))
     REDIM TV$( RECCOUNT ("tvorlage"))
     GCodieRuf1% = 0
     
     REM FOR a% = 0 TO RECCOUNT ("tvorlage") - 1
       REM TV% = 0
       REM TV$ = ""
     REM NEXT a%
     FILE "TVORLAGE"
     INDEX DTVorlage.tvorlage
     SELECT FIRST 
     dtv$ = STR$ (GMAcodema%,"000000") + "000000000000"
     SELECT KEY dtv$ FILE "tvorlage" INDEX DTVorlage.tvorlage
     tfound1% = 0
     IF offVlLi% = 0 THEN 
       WHILE codema.tvorlage = GMAcodema% AND Datum.tvorlage <= TODAY AND NOT EOF ("TVORLAGE")
         IF zeit.tvorlage <= NOW OR Datum.tvorlage < TODAY THEN 
           IF GCODIE% = - 1 THEN 
             IF GCodieRuf1% = 0 THEN CALL SearchInitAq2("tvorlage")
           END IF 
           TV%(tfound1%) = codeaq.tvorlage
           nn$ = LEFT$ (Nachname.tvorlage,30)
           IF GCODie% <> - 1 THEN 
             l% = LEN (nn$)
             WHILE l% < 30
               nn$ = nn$ + " "
               l% = LEN (nn$)
             WEND 
           END IF 
           tt$ = DATE$ (termin.tvorlage,"0d.mm.yyyy") + " " + TIME$ (uhrzeit.tvorlage,"hh:mm") + "  "
           TV$(tfound1%) = DATE$ (datum.tvorlage,"0d.mm.yyyy") + " " + TIME$ (zeit.tvorlage,"hh:mm") + "  " + tt$ + nn$ + " / " + LEFT$ (Notiz.tvorlage,100) + CHR$ (100) + STR$ (codeaq.tvorlage,"000000")
           SELECT KEY GMAcodema% FILE "Supervis" INDEX codema.supervis
           SELECT KEY codeaq.tvorlage FILE "AKQUISE" INDEX codeaq.AKQUISE
           IF EMAILRaus.tvorlage <> "j" AND GCODie% = - 1 THEN 
             IF LTRIM$ (emailshost.supervis) <> "" THEN 
               IF EMAILRaus.AKQUISE <> "j" AND EMAILAutomat.AkquiSE = "j" THEN 
                 IF LTRIM$ (EMAILTO.AKQuise) <> "" THEN 
                    IF LTRIM$ (EMAILBETREFF.AKquise) <> "" THEN 
                      REM 10052003
                      IF Datum.tvorlage <= TODAY THEN CALL EMAILManSend(codeaq.tvorlage,0)
                    END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
           IF GCODIE% = - 1 THEN CALL SearchVorbAq2("tvorlage")
           tfound1% = tfound1% + 1
         END IF 
         SELECT NEXT FILE "TVORLAGE" INDEX DTVorlage.tvorlage
       WEND 
     ELSE 
       WHILE codema.tvorlage = GMAcodema% AND NOT EOF ("TVORLAGE")
         IF GCODIE% = - 1 THEN 
           IF GCodieRuf1% = 0 THEN CALL SearchInitAq2("tvorlage")
         END IF 
         TV%(tfound1%) = codeaq.tvorlage
         nn$ = LEFT$ (Nachname.tvorlage,30)
         IF GCODie% <> - 1 THEN 
           l% = LEN (nn$)
           WHILE l% < 30
             nn$ = nn$ + " "
             l% = LEN (nn$)
           WEND 
         END IF 
         tt$ = DATE$ (termin.tvorlage,"0d.mm.yyyy") + " " + TIME$ (uhrzeit.tvorlage,"hh:mm") + "  "
         TV$(tfound1%) = DATE$ (datum.tvorlage,"0d.mm.yyyy") + " " + TIME$ (zeit.tvorlage,"hh:mm") + "  " + tt$ + nn$ + " / " + LEFT$ (Notiz.tvorlage,100) + CHR$ (100) + STR$ (codeaq.tvorlage,"000000")
         SELECT KEY GMAcodema% FILE "Supervis" INDEX codema.supervis
         SELECT KEY codeaq.tvorlage FILE "AKQUISE" INDEX codeaq.AKQUISE
         IF EMAILRaus.tvorlage <> "j" AND GCODie% = - 1 THEN 
           IF LTRIM$ (emailshost.supervis) <> "" THEN 
             IF EMAILRaus.AKQUISE <> "j" AND EMAILAutomat.AkquiSE = "j" THEN 
               IF LTRIM$ (EMAILTO.AKQuise) <> "" THEN 
                  IF LTRIM$ (EMAILBETREFF.AKquise) <> "" THEN 
                    REM 10052003
                    IF Datum.tvorlage <= TODAY THEN CALL EMAILManSend(codeaq.tvorlage,0)
                  END IF 
               END IF 
             END IF 
           END IF 
         END IF 
         IF GCODIE% = - 1 THEN CALL SearchVorbAq2("tvorlage")
         tfound1% = tfound1% + 1
         SELECT NEXT FILE "TVORLAGE" INDEX DTVorlage.tvorlage
       WEND 
     END IF 
     REDIM Auswahl$(tfound1%)
     aaaak% = 0
TCH100520002:   
     IF GCODIE% = - 1 THEN 
       c$ = "aa"
       REM CALL Fehler("","")
       IF aaaak% = 0 THEN 
         req3% = CALL ("_SearchShow",c$)
       ELSE 
         req3% = CALL ("_SearchReShow",c$)
       END IF 
       REM CALL Fehler( STR$ (req%),"")
       IF req3% = 3 THEN 
         REM drucken
         req% = 2
       ELSE 
         IF req3% > 3 THEN 
           REM alle Termine verschieben
           req% = 0
           minuteab% = req3%
         ELSE 
           IF VAL (c$) <> 0 THEN 
             req% = 1
             _cuaq% = VAL (c$)
             REM MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
             ok% = 0
             SET STATUS "Termine gefunden..."
           ELSE 
             req% = 5
           END IF 
         END IF 
       END IF 
       aaaak% = aaaak% + 1
     ELSE 
       Superbase.Dialogs.Add("TERLISTE")
       SET dlg1 = Superbase.Dialogs.TERLISTE
       dlg1.Move(0,0,440,292)
       dlg1.Caption = "Termin-Wiedervorlagen-öbersicht"
       dlg1.FontName = "MS Sans Serif"
       dlg1.FontSize = 8
 
       SET control1 = dlg1.Add("DialogLabel1","DialogLabel")
       control1.Move(3,3,255,9)
       control1.Caption = "VDatum       VZeit   Termin        Zeit    Name                          Notiz"
 
       SET control1 = dlg1.Add("DialogListBox1","DialogListBox")
       control1.Move(4,17,429,249)
       control1.MultiSelect = 1
       control1.ScrollBars = 2
       control1.Bind("TV$","Auswahl$","prompt$")
 
       SET control1 = dlg1.Add("DialogCommandButton1","DialogCommandButton")
       control1.Move(3,270,114,16)
       control1.Default = 1
       control1.Caption = "&Wiedervorlage-Eintrag anzeigen"
       control1.ReturnValue = 1
 
       SET control1 = dlg1.Add("DialogCommandButton2","DialogCommandButton")
       control1.Move(120,270,56,16)
       control1.Caption = "&Drucken"
       control1.ReturnValue = 2
 
       SET control1 = dlg1.Add("DialogCommandButton3","DialogCommandButton")
       control1.Move(179,270,94,16)
       control1.Caption = "alle markierten Er&ledigen"
       control1.ReturnValue = 3
       IF offVlLi% = 0 THEN 
 
        SET control1 = dlg1.Add("DialogTextBox1","DialogTextBox")
        control1.Move(275,271,19,14)
        control1.MaxLength = 3
        control1.TextBinding = "minuteab%"
 
        SET control1 = dlg1.Add("DialogLabel11","DialogLabel")
        control1.Move(296,274,123,14)
        control1.Caption = "Minuten bis zur wiederholten Anzeige"
 
         SET control1 = dlg1.Add("DialogCommandButton4","DialogCommandButton")
         control1.Move(418,270,20,16)
         control1.Caption = "&Ok"
         control1.ReturnValue = 0
       
       ELSE 
         SET control1 = dlg1.Add("DialogCommandButton4","DialogCommandButton")
         control1.Move(277,270,155,16)
         control1.Caption = "&öbersicht schlie·en"
         control1.ReturnValue = 0
         control1.Cancel = 1
       END IF 
       DIALOG "TERLISTE",req%
       REMOVE DIALOG ALL 
     END IF 
     REM &Abbrechen (in 10 Minuten wieder anzeigen)
     IF req% = 0 THEN 
       IF offVlLi% = 0 THEN 
         FOR i% = 0 TO tfound1% - 1
           t1% = TV%(i%)
           IF TV%(i%) > 0 THEN 
             SELECT FIRST FILE "TVORLAGE" INDEX codeaq.TVORLAGE
             t1% = TV%(i%)
             SELECT KEY TV%(i%) FILE "TVORLAGE" INDEX codeaq.TVORLAGE
             IF Datum.tvorlage <= TODAY THEN 
               SELECT FIRST FILE "TVORLAGE" INDEX codeaq.TVORLAGE
               SELECT KEY t1% LOCK FILE "TVORLAGE" INDEX codeaq.TVORLAGE
               t2% = codeaq.TVORLAGE
               zeit.tvorlage = NOW + (60000 * minuteab%)
               Datum.tvorlage = TODAY 
               DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
               STORE FILE "TVORLAGE"
               UNLOCK CURRENT FILE "tvorlage"
               UNLOCK FILE "tvorlage"
               REM t$ = TIME$ (z%,"hh:mm")
               SELECT FIRST FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
               SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
               erdatum.GAkquiDat$ = datum.tvorlage
               erzeit.GAkquiDat$ = zeit.tvorlage
               STORE FILE GAkquiDat$
               UNLOCK CURRENT FILE GAkquiDat$
               UNLOCK FILE GAkquiDat$
             END IF 
           END IF 
         NEXT i%
       ELSE 
         terfound1% = 0
       END IF 
     END IF 
 
     REM zum einzelnen Wiedervorlagetermin springen
     IF req% = 1 THEN 
       ok% = 1
       IF GCODie% <> - 1 THEN 
         _cuaq% = VAL ( RIGHT$ (Auswahl$(0),6))
         prompt$ = Auswahl$(0)
       END IF 
       
       lastTermin% = _cuaq%
       SELECT KEY _cuaq% FILE "TVORLAGE" INDEX codeaq.TVORLAGE
       REM knr% = codeku.TVORLAGE
       REM _vcodema% = codema.TVORLAGE
       CALL TerLiSpez(lastTermin%)
       REM CALL VorlTermEinz(_cuaq%)

       REM _formend% = 0
       GOTO TCH100520001
     END IF 
 
     REM alle Drucken
     IF req% = 2 THEN 
       REM Drucken
       CALL DFile(2,"OFFICE\aktionen" + _fpw$)
       CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
       MOUSE OFF 
       IF OPEN ("AKQTMP") THEN 
         REM CLOSE FILE "AKQTMP"
         REMOVE FROM FILE "AKQTMP"
       ELSE 
         CALL DFile(2,"OFFICE\" + "AKQTMP" + _fpw$)
         REMOVE FROM FILE "AKQTMP"
       END IF 
       FOR i% = 0 TO tfound1% - 1
         SET STATUS STR$ (i%,"9999999")
         codeaq% = VAL ( RIGHT$ (TV$(i%),6))
         SELECT KEY codeaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
         BLANK FILE "AKQTMP"
         VTermin.AKQTMP = ErDatum.GAkquidat$
         VZeit.AKQTMP = ErZeit.GAkquidat$
         codeku.AKQTMP = codeku.GAkquiDat$
         codeak.akqtmp = codeak.GAkquiDat$
         bearbeiter.AKQTMP = bearbeiter.GAkquiDat$
         codema.AKQTMP = codema.GAkquiDat$
         datum.AKQTMP = datum.GAkquiDat$
         notiz.AKQTMP = notiz.GAkquiDat$
         termin.AKQTMP = termin.GAkquiDat$
         erledigt_termin.AKQTMP = erledigt_termin.GAkquiDat$
         codeaq.AKQTMP = codeaq.GAkquiDat$
         Uhrzeit.AKQTMP = Uhrzeit.GAkquiDat$
         nachname.AKQTMP = nachname.GAkquiDat$
         ergebnis.AKQTMP = ergebnis.GAkquiDat$
         projekt.AKQTMP = projekt.GAkquiDat$
         codepr.AKQTMP = codepr.GAkquiDat$
         dauer.AKQTMP = dauer.GAkquiDat$
         DME.AKQTMP = dme.GAkquiDat$
         STORE FILE "AKQTMP"
         UNLOCK CURRENT FILE "akqtmp"
       NEXT i%
       cdir$ = DIRECTORY 
       DIRECTORY _netpath$ + "OFFICE"
       CALL ORep("TERMINE3")
       HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
       END HEADING 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
       SET QUERY ON 
       SET QUERY LOCK ON 
       Ueberschr$ = "Vorlagetermine Mitarbeiter: " + TName$
       ON ERROR GOTO chkter040620001
       SELECT ;
       WHERE codeak.AKQTMP = codeak.aktionen AND CodeKU.AKQTMP = CodeKU.GAdrDat$
       ORDER VTermin.AKQTMP,Vzeit.AKQTMP
       TO ASK 
       END SELECT 
chkter040620001: 
       ON ERROR GOTO ErrorHandler
       DIRECTORY cdir$
       MOUSE ON 
       GCodieRuf1% = 0
       GOTO TCH100520001
     END IF 
 
     REM alle markierten erledigen
     IF req% = 3 THEN 
       i% = 0
       WHILE Auswahl$(i%) <> ""
         _cuaq% = VAL ( RIGHT$ (Auswahl$(i%),6))
         IF _cuaq% > 0 THEN 
           SELECT FIRST FILE "TVORLAGE"
           SELECT KEY _cuaq% LOCK FILE "TVORLAGE" INDEX codeaq.TVORLAGE
           SELECT REMOVE FILE "TVORLAGE"
           SELECT KEY _cuaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           erledigt_Termin.GAkquiDat$ = "j"
           CALL QuickStore(GAkquiDat$)
         END IF 
         i% = i% + 1
       WEND 
     END IF 
   ELSE 
   END IF 
 
   
 
 
   IF tfound1% < - 1 THEN 
     DIM dlg AS Dialog
     DIM control AS DialogControl 
     FOR i% = 0 TO tfound1% - 1
       SELECT KEY TV%(i%) LOCK FILE "TVORLAGE" INDEX codeaq.tvorlage
       BELL 
       di2$ = "AA"
 
       Superbase.Dialogs.Add(di2$)
       SET dlg = Superbase.Dialogs(di2$)
       dlg.Move(0,0,389,292)
       dlg.Caption = "Termin am"
       dlg.FontName = "MS Sans Serif"
       dlg.FontSize = 8
 
       SET control = dlg.Add("DialogLabel1","DialogLabel")
       control.Move(4,4,273,10)
       control.Caption = "Kunde:"
 
       SET control = dlg.Add("DialogLabel2","DialogLabel")
       control.Move(4,16,274,12)
       control.CaptionBinding = "Nachname.tvorlage"
 
       SET control = dlg.Add("DialogLabel3","DialogLabel")
       control.Move(4,30,56,8)
       control.Caption = "Termin:"
 
       SET control = dlg.Add("DialogLabel8","DialogLabel")
       control.Move(153,30,56,8)
       control.Caption = "Vorlage:"
 
       SET control = dlg.Add("DialogTextBox5","DialogTextBox")
       control.Move(4,41,46,10)
       control.MaxLength = 20
       control.TextBinding = "Termin.tvorlage"
 
       SET control = dlg.Add("DialogTextBox3","DialogTextBox")
       control.Move(153,41,47,10)
       control.MaxLength = 20
       control.TextBinding = "Datum.tvorlage"
 
       SET control = dlg.Add("DialogTextBox6","DialogTextBox")
       control.Move(13,56,29,11)
       control.MaxLength = 20
       control.TextBinding = "UhrZeit.tvorlage"
 
       SET control = dlg.Add("DialogTextBox4","DialogTextBox")
       control.Move(158,56,30,11)
       control.MaxLength = 20
       control.TextBinding = "Zeit.tvorlage"
 
       SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
       control.Move(322,78,63,10)
       control.Caption = "Termin erledigt"
       control.Bind("erledigt_Termin.tvorlage")
       control.ValueOn = "j"
       control.ValueOff = "n"
 
       SET control = dlg.Add("DialogLabel4","DialogLabel")
       control.Move(4,81,56,8)
       control.Caption = "Notiz:"
 
       SET control = dlg.Add("DialogTextBox1","DialogTextBox")
       control.Move(2,92,384,63)
       control.MultiLine = 1
       control.ScrollEnable = 1
       control.ScrollBars = 2
       control.MaxLength = 4000
       control.TextBinding = "Notiz.tvorlage"
 
       SET control = dlg.Add("DialogLabel5","DialogLabel")
       control.Move(4,158,36,8)
       control.Caption = "Ergebnis:"
 
       SET control = dlg.Add("DialogTextBox2","DialogTextBox")
       control.Move(2,169,384,63)
       control.MultiLine = 1
       control.ScrollEnable = 1
       control.ScrollBars = 2
       control.MaxLength = 4000
       control.TextBinding = "Ergebnis.tvorlage"
 
       SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
       control.Move(2,235,109,16)
       control.Default = 1
       control.Caption = "&Vorlage nicht mehr anzeigen"
       control.ReturnValue = 1
 
       SET control = dlg.Add("DialogCommandButton4","DialogCommandButton")
       control.Move(116,235,109,16)
       control.Caption = "&Zum Termin springen"
       control.ReturnValue = 3
 
       SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
       control.Move(241,235,144,16)
       control.Caption = "&Neuen Vorlagetermin speichern"
       control.ReturnValue = 2
 
       SET control = dlg.Add("DialogCommandButton6","DialogCommandButton")
       control.Move(2,252,223,16)
       control.Caption = "Termin als erledigt kennzeichnen und Vorlage nicht mehr anzeigen"
       control.ReturnValue = 4
 
       SET control = dlg.Add("DialogCommandButton7","DialogCommandButton")
       control.Move(241,252,145,16)
       control.Caption = "Alle Angaben speichern"
       control.ReturnValue = 6
 
       SET control = dlg.Add("DialogCommandButton5","DialogCommandButton")
       control.Move(2,270,223,16)
       control.Caption = "Zum Termin springen und Vorlage lîschen"
       control.ReturnValue = 5
    
       SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
       control.Move(241,270,145,16)
       control.Caption = "&Abbrechen (in 5 Minuten wieder anzeigen)"
       control.ReturnValue = 0
       control.Cancel = 1
 
       DIALOG di2$,a%
       REMOVE DIALOG ALL 
       IF a% = 0 THEN 
         zeit.tvorlage = NOW + 300000
         Datum.tvorlage = TODAY 
         DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
         STORE FILE "TVORLAGE"
         UNLOCK CURRENT FILE "tvorlage"
         UNLOCK FILE "tvorlage"
         REM t$ = TIME$ (z%,"hh:mm")
         IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
           SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           erdatum.GAkquiDat$ = datum.tvorlage
           erzeit.GAkquiDat$ = zeit.tvorlage
           GErledTermin$ = erledigt_Termin.GAkquiDat$
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
         END IF 
         REM CALL Fehler(t$,"")
       END IF 
       IF a% = 1 THEN 
         REM lîschen
         FILE "TVorlage"
         SELECT KEY TV%(i%) LOCK FILE "TVorlage" INDEX codeaq.Tvorlage
         SELECT REMOVE FILE "TVorlage"
         IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
           SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           knr% = codeku.GAkquiDat$
           erdatum.GAkquiDat$ = ""
           erzeit.GAkquiDat$ = ""
           GErledTermin$ = erledigt_Termin.GAkquiDat$
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
         END IF 
       END IF 
       IF a% = 2 THEN 
         REM Neuen Vorlagetermin speichern
         DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
         STORE FILE "TVORLAGE"
         UNLOCK CURRENT FILE "tvorlage"
         IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
           SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           erdatum.GAkquiDat$ = datum.tvorlage
           erzeit.GAkquiDat$ = zeit.tvorlage
           GErledTermin$ = erledigt_Termin.GAkquiDat$
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
         END IF 
       END IF 
       IF a% = 3 THEN 
         REM zum Termin springen
         zeit.tvorlage = NOW + 300000
         Datum.tvorlage = TODAY 
         DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
         STORE FILE "TVORLAGE"
         UNLOCK CURRENT FILE "tvorlage"
         REM t$ = TIME$ (z%,"hh:mm")
         IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
           SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           knr% = codeku.GAkquiDat$
           _vcodema% = codema.GAkquiDat$
           erzeit.GAkquiDat$ = zeit.tvorlage
           GErledTermin$ = erledigt_Termin.GAkquiDat$
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
         END IF 
         REM 10042000                                             
         IF UCASE$ ( FORM ) <> GAkquiDat$ AND UCASE$ ( FORM ) <> "AKQUIPRJ" THEN 
           CALL TerLiSpez(TV%(i%))
         ELSE 
           _cuaq% = TV%(i%)
           IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
             SELECT FORM KEY TV%(i%) FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
             FORM 
             SET DISPLAY ON 
             CALL AKQUISEIntro1()
             CALL AQButtUpdate()
           ELSE 
             CALL Fehler("Leider gibt es diesen Termin nicht in der Termindatei!","Lîschen Sie diese Terminvorlage aus der Wiedervorlagedatei!")
           END IF 
         END IF 
       END IF 
       IF a% = 4 THEN 
         REM Termin als erledigt kennzeichnen und Vorlage nicht mehr anzeigen
         SELECT REMOVE FILE "TVorlage"
         IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
           SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           GErledTermin$ = erledigt_Termin.GAkquiDat$
           erledigt_Termin.GAkquiDat$ = "j"
           CALL QuickStore(GAkquiDat$)
         END IF 
       END IF 
       IF a% = 5 THEN 
         REM zum Termin springen und Vorlage nicht mehr anzeigen
         FILE "TVorlage"
         SELECT KEY TV%(i%) LOCK FILE "TVorlage" INDEX codeaq.Tvorlage
         SELECT REMOVE FILE "TVorlage"
         IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
           SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           knr% = codeku.GAkquiDat$
           erdatum.GAkquiDat$ = ""
           erzeit.GAkquiDat$ = ""
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
           _vcodema% = codema.GAkquiDat$
           IF UCASE$ ( FORM ) <> GAkquiDat$ AND UCASE$ ( FORM ) <> "AKQUIPRJ" THEN 
             CALL TerLiSpez(TV%(i%))
           ELSE 
             _cuaq% = TV%(i%)
             SELECT FORM KEY TV%(i%) FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
             FORM 
             SET DISPLAY ON 
             CALL AKQUISEIntro1()
             CALL AQButtUpdate()
           END IF 
         END IF 
       END IF 
       IF a% = 6 THEN 
         REM alle Angaben speichern
         DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
         STORE FILE "TVORLAGE"
         UNLOCK CURRENT FILE "tvorlage"
         IF EXISTS (TV%(i%),codeaq.GAkquiDat$) THEN 
           SELECT KEY TV%(i%) LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           termin.GAkquiDat$ = Termin.TVORLAGE
           Uhrzeit.GAkquiDat$ = Uhrzeit.TVORLAGE
           ERDATUM.GAkquiDat$ = Datum.TVORLAGE
           ErZeit.GAkquiDat$ = Zeit.TVORLAGE
           Notiz.GAkquiDat$ = Notiz.TVORLAGE
           Ergebnis.GAkquiDat$ = Ergebnis.TVORLAGE
           Nachname.GAkquiDat$ = Nachname.TVORLAGE
           Bearbeiter.GAkquiDat$ = Bearbeiter.TVORLAGE
           GErledTermin$ = erledigt_termin.GAkquiDat$
           erledigt_termin.GAkquiDat$ = erledigt_Termin.tvorlage
           CALL QuickStore(GAkquiDat$)
           IF erledigt_termin.GAkquiDat$ = "j" THEN 
             REMOVE FROM FILE "tvorlage" WHERE codeaq.tvorlage = TV%(i%)
           END IF 
         END IF 
       END IF 
     NEXT i%
   END IF 
 ELSE 
   IF terbyhand% = 1 THEN 
     CALL Fehler("Keine Wiedervorlagetermine gefunden!","")
   END IF 
 END IF 
ETCH100520002: 
 IF GCODieRuf1% < - 1 THEN 
   ret% = CALL ("_SearchClose"):REM CALL Fehler( STR$ (GCodieruf1%),"")
   GCODieRuf1% = 0
 END IF 
 FILE cfile$
 offVlLi% = 0
 END SUB 
  
 
SUB VorlTermEinz(codeaq%)
     DIM dlg AS Dialog
     DIM control AS DialogControl 
       SELECT KEY codeaq% LOCK FILE "TVORLAGE" INDEX codeaq.tvorlage
       BELL 
       di2$ = "AA"
 
       Superbase.Dialogs.Add(di2$)
       SET dlg = Superbase.Dialogs(di2$)
       dlg.Move(0,0,389,292)
       dlg.Caption = "Termin am"
       dlg.FontName = "MS Sans Serif"
       dlg.FontSize = 8
 
       SET control = dlg.Add("DialogLabel1","DialogLabel")
       control.Move(4,4,273,10)
       control.Caption = "Kunde:"
 
       SET control = dlg.Add("DialogLabel2","DialogLabel")
       control.Move(4,16,274,12)
       control.CaptionBinding = "Nachname.tvorlage"
 
       SET control = dlg.Add("DialogLabel3","DialogLabel")
       control.Move(4,30,56,8)
       control.Caption = "Termin:"
 
       SET control = dlg.Add("DialogLabel8","DialogLabel")
       control.Move(153,30,56,8)
       control.Caption = "Vorlage:"
 
       SET control = dlg.Add("DialogTextBox5","DialogTextBox")
       control.Move(4,41,46,10)
       control.MaxLength = 20
       control.TextBinding = "Termin.tvorlage"
 
       SET control = dlg.Add("DialogTextBox3","DialogTextBox")
       control.Move(153,41,47,10)
       control.MaxLength = 20
       control.TextBinding = "Datum.tvorlage"
 
       SET control = dlg.Add("DialogTextBox6","DialogTextBox")
       control.Move(13,56,29,11)
       control.MaxLength = 20
       control.TextBinding = "UhrZeit.tvorlage"
 
       SET control = dlg.Add("DialogTextBox4","DialogTextBox")
       control.Move(158,56,30,11)
       control.MaxLength = 20
       control.TextBinding = "Zeit.tvorlage"
 
       SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
       control.Move(322,78,63,10)
       control.Caption = "Termin erledigt"
       control.Bind("erledigt_Termin.tvorlage")
       control.ValueOn = "j"
       control.ValueOff = "n"
 
       SET control = dlg.Add("DialogLabel4","DialogLabel")
       control.Move(4,81,56,8)
       control.Caption = "Notiz:"
 
       SET control = dlg.Add("DialogTextBox1","DialogTextBox")
       control.Move(2,92,384,63)
       control.MultiLine = 1
       control.ScrollEnable = 1
       control.ScrollBars = 2
       control.MaxLength = 4000
       control.TextBinding = "Notiz.tvorlage"
 
       SET control = dlg.Add("DialogLabel5","DialogLabel")
       control.Move(4,158,36,8)
       control.Caption = "Ergebnis:"
 
       SET control = dlg.Add("DialogTextBox2","DialogTextBox")
       control.Move(2,169,384,63)
       control.MultiLine = 1
       control.ScrollEnable = 1
       control.ScrollBars = 2
       control.MaxLength = 4000
       control.TextBinding = "Ergebnis.tvorlage"
 
       SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
       control.Move(2,235,109,16)
       control.Default = 1
       control.Caption = "&Vorlage nicht mehr anzeigen"
       control.ReturnValue = 1
 
       SET control = dlg.Add("DialogCommandButton4","DialogCommandButton")
       control.Move(116,235,109,16)
       control.Caption = "&Zum Termin springen"
       control.ReturnValue = 3
 
       SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
       control.Move(241,235,144,16)
       control.Caption = "&Neuen Vorlagetermin speichern"
       control.ReturnValue = 2
 
       SET control = dlg.Add("DialogCommandButton6","DialogCommandButton")
       control.Move(2,252,223,16)
       control.Caption = "Termin als erledigt kennzeichnen und Vorlage nicht mehr anzeigen"
       control.ReturnValue = 4
 
       SET control = dlg.Add("DialogCommandButton7","DialogCommandButton")
       control.Move(241,252,145,16)
       control.Caption = "Alle Angaben speichern"
       control.ReturnValue = 6
 
       SET control = dlg.Add("DialogCommandButton5","DialogCommandButton")
       control.Move(2,270,223,16)
       control.Caption = "Zum Termin springen und Vorlage lîschen"
       control.ReturnValue = 5
    
       SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
       control.Move(241,270,145,16)
       control.Caption = "&Abbrechen (in 5 Minuten wieder anzeigen)"
       control.ReturnValue = 0
       control.Cancel = 1
 
       DIALOG di2$,a%
       REMOVE DIALOG ALL 
       
       IF a% = 0 THEN 
         IF Datum.tvorlage <= TODAY THEN 
           zeit.tvorlage = NOW + 300000
           zeit$ = TIME$ (zeit.tvorlage,"hh:mm")
           IF LEFT$ (zeit$,2) = "24" THEN zeit.tvorlage = 0
           Datum.tvorlage = TODAY 
           DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
           STORE FILE "TVORLAGE"
           UNLOCK CURRENT FILE "tvorlage"
           UNLOCK FILE "tvorlage"
           codeaq% = codeaq.tvorlage
           REM t$ = TIME$ (z%,"hh:mm")
           IF EXISTS (codeaq%,codeaq.GAkquiDat$) THEN 
             SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
             erdatum.GAkquiDat$ = datum.tvorlage
             erzeit.GAkquiDat$ = zeit.tvorlage
             STORE FILE GAkquiDat$
             UNLOCK CURRENT FILE GAkquiDat$
             UNLOCK FILE GAkquiDat$
           END IF 
         END IF 
         REM CALL Fehler(t$,"")
       END IF 
       IF a% = 1 THEN 
         REM lîschen
         FILE "TVorlage"
         SELECT KEY codeaq% LOCK FILE "TVorlage" INDEX codeaq.Tvorlage
         SELECT REMOVE FILE "TVorlage"
       END IF 
       IF a% = 2 THEN 
         REM Neuen Vorlagetermin speichern
         DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
         STORE FILE "TVORLAGE"
         UNLOCK CURRENT FILE "tvorlage"
         codeaq% = codeaq.tvorlage
         IF EXISTS (codeaq%,codeaq.GAkquiDat$) THEN 
           SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           erdatum.GAkquiDat$ = datum.tvorlage
           erzeit.GAkquiDat$ = zeit.tvorlage
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
         END IF 
       END IF 
       IF a% = 3 THEN 
         REM zum Termin springen
         IF zeit.tvorlage < NOW THEN zeit.tvorlage = NOW + 300000
         zeit$ = TIME$ (zeit.tvorlage,"hh:mm")
         IF LEFT$ (zeit$,2) = "24" THEN zeit.tvorlage = 0
         IF Datum.tvorlage < TODAY THEN Datum.tvorlage = TODAY 
         DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
         STORE FILE "TVORLAGE"
         UNLOCK CURRENT FILE "tvorlage"
         REM t$ = TIME$ (z%,"hh:mm")
         codeaq% = codeaq.tvorlage
         IF EXISTS (codeaq%,codeaq.GAkquiDat$) THEN 
           SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           knr% = codeku.GAkquiDat$
           _vcodema% = codema.GAkquiDat$
           erzeit.GAkquiDat$ = zeit.tvorlage
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
         END IF 
         REM 10042000    
         fo$ = UCASE$ ( FORM )
         IF UCASE$ ( FORM ) <> GAkquiDat$ AND UCASE$ ( FORM ) <> "AKQUIPRJ" THEN 
           CALL TerLiSpez(codeaq%)
         ELSE 
           REM _cuaq% = TV%(i%)
           CALL TerLiSpez(codeaq%)
 
           REM IF EXISTS (codeaq%,codeaq.GAkquiDat$) THEN 
             REM SELECT FORM KEY codeaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
             REM FORM 
             REM SET DISPLAY ON 
             REM CALL AKQUISEIntro1()
             REM CALL AQButtUpdate()
             REM WAIT MOUSE OR KEY OR MENU 
           REM END IF 
         END IF 
       END IF 
       IF a% = 4 THEN 
         REM Termin als erledigt kennzeichnen und Vorlage nicht mehr anzeigen
         codeaq% = codeaq.tvorlage
         SELECT REMOVE FILE "TVorlage"
         IF EXISTS (codeaq%,codeaq.GAkquiDat$) THEN 
           SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           GErledTermin$ = erledigt_Termin.GAkquiDat$
           erledigt_Termin.GAkquiDat$ = "j"
           CALL QuickStore(GAkquiDat$)
         END IF 
       END IF 
       IF a% = 5 THEN 
         REM zum Termin springen und Vorlage nicht mehr anzeigen
         FILE "TVorlage"
         codeaq% = codeaq.tvorlage
         SELECT KEY codeaq% LOCK FILE "TVorlage" INDEX codeaq.Tvorlage
         SELECT REMOVE FILE "TVorlage"
         IF EXISTS (codeaq%,codeaq.GAkquiDat$) THEN 
           SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           knr% = codeku.GAkquiDat$
           erdatum.GAkquiDat$ = ""
           erzeit.GAkquiDat$ = ""
           STORE FILE GAkquiDat$
           UNLOCK CURRENT FILE GAkquiDat$
           UNLOCK FILE GAkquiDat$
           _vcodema% = codema.GAkquiDat$
           IF UCASE$ ( FORM ) <> GAkquiDat$ AND UCASE$ ( FORM ) <> "AKQUIPRJ" THEN 
             CALL TerLiSpez(codeaq%)
           ELSE 
             _cuaq% = codeaq%
             SELECT FORM KEY codeaq% FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
             FORM 
             SET DISPLAY ON 
             CALL AKQUISEIntro1()
             CALL AQButtUpdate()
           END IF 
         END IF 
       END IF 
       IF a% = 6 THEN 
         REM alle Angaben speichern
         DTVorlage.TVORLAGE = STR$ (CodeMA.tvorlage,"000000") + DATE$ (Datum.tvorlage,"yyyymm0d") + TIME$ (Zeit.tvorlage,"hhmm")
         STORE FILE "TVORLAGE"
         UNLOCK CURRENT FILE "tvorlage"
         UNLOCK FILE "tvorlage"
         codeaq% = codeaq.tvorlage
         IF EXISTS (codeaq%,codeaq.GAkquiDat$) THEN 
           SELECT KEY codeaq% LOCK FILE GAkquiDat$ INDEX codeaq.GAkquiDat$
           termin.GAkquiDat$ = Termin.TVORLAGE
           Uhrzeit.GAkquiDat$ = Uhrzeit.TVORLAGE
           ERDATUM.GAkquiDat$ = Datum.TVORLAGE
           ErZeit.GAkquiDat$ = Zeit.TVORLAGE
           Notiz.GAkquiDat$ = Notiz.TVORLAGE
           Ergebnis.GAkquiDat$ = Ergebnis.TVORLAGE
           Nachname.GAkquiDat$ = Nachname.TVORLAGE
           Bearbeiter.GAkquiDat$ = Bearbeiter.TVORLAGE
           GErledTermin$ = erledigt_termin.GAkquiDat$
           erledigt_termin.GAkquiDat$ = erledigt_Termin.tvorlage
           CALL QuickStore(GAkquiDat$)
           IF erledigt_termin.GAkquiDat$ = "j" THEN 
             REMOVE FROM FILE "tvorlage" WHERE codeaq.tvorlage = codeaq%
           END IF 
         END IF 
       END IF 
   END IF 
 END SUB 
  


 '      **************************************
 '      ** Routinen fÅr Netzwerknachrichten **
 '      **************************************
 
 ' NETMAIL
 ' ======================================================================
 ' Zweck:       Nachrichten zwischen Mitarbeitern versenden
 ' Nutzung:     CALL NetMail()
 ' ======================================================================
SUB NetMail()
 IF disabled%("NETMAIL") THEN END SUB 
 CALL DFile(2,"OFFICE\mail" + _fpw$)
 CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKQUISE" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKTIONEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
 cfile$ = FILE 
 DIM Auswahl$(20000)
 DIM masucc%( RECCOUNT ("supervis"))
 DIM masubcc%( RECCOUNT ("supervis"))
 w% = 280:h% = 100
 d$ = "NETMAIL"
 FILE "mail"
 BLANK FILE "MAIL"
 SET STATUS "Datensatz neu angelegt..."
 MADEST$ = MALIST2$(0)
 
    DIM dlg AS Dialog
    DIM control AS DialogControl
    nn$ = ""
    bb$ = ""
anf120520032: 
 ok% = - 1
 WHILE ok%
anf100620031: 
    Superbase.Dialogs.Add("DIALOG")
    SET dlg = Superbase.Dialogs.DIALOG
    dlg.Move(0,0,452,381)
    dlg.Caption = "Nachricht senden"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(4,4,120,10)
    control.Caption = "Nachricht versenden an:"
 
    SET control = dlg.Add("DialogComboBox2","DialogComboBox")
    control.Move(4,14,400,248)
    control.Style = 0
    control.Bind("MALIST2$","MADEST$")
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(2,43,28,10)
    control.Caption = "CC:"
 
    SET control = dlg.Add("DialogCommandButton5","DialogCommandButton")
    control.Move(424,51,24,30)
    control.Caption = "..."
    control.ReturnValue = 4
    control.Cancel = 0
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(4,53,417,34)
    control.MultiLine = 1
    control.ScrollEnable = 3
    control.ScrollBars = 3
    control.MaxLength = 4000
    control.TextBinding = "CC.mail"
 
    IF GEMAIL% = - 1 THEN 
      SET control = dlg.Add("DialogLabel4","DialogLabel")
      control.Move(4,90,26,9)
      control.Caption = "BCC:"
 
      SET control = dlg.Add("DialogTextBox2","DialogTextBox")
      control.Move(4,100,417,34)
      control.MultiLine = 1
      control.ScrollEnable = 3
      control.ScrollBars = 3
      control.MaxLength = 4000
      control.TextBinding = "BCC.mail"
    
 
      SET control = dlg.Add("DialogCommandButton4","DialogCommandButton")
      control.Move(424,100,24,31)
      control.Caption = "..."
      control.ReturnValue = 3
      control.Cancel = 0
    END IF 
    IF GEMAIL% = - 1 THEN 
      SET control = dlg.Add("DialogTextBox3","DialogTextBox")
      control.Move(40,137,380,12)
      control.ScrollEnable = 2
      control.MaxLength = 250
      control.TextBinding = "Betreff.mail"
    
      SET control = dlg.Add("DialogLabel3","DialogLabel")
      control.Move(5,138,30,10)
      control.Caption = "Betreff: "
    END IF 


    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(5,151,400,8)
    control.Caption = "Nachricht: (ACHTUNG - einen Zeilenumbruch kînnen Sie Åber die Tastenkombination STRG+ENTER bewirken)"
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(4,161,448,196)
    control.MultiLine = 1
    control.ScrollEnable = 3
    control.ScrollBars = 3
    control.MaxLength = 4000
    control.TextBinding = "nachricht.mail"
    

    IF GEMAIL% = - 1 THEN 
      SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
      control.Move(101,364,83,14)
      REM control.Default = 1
      control.Caption = "Als &EMAIL Versenden"
      control.ReturnValue = 2
    END IF 
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(186,364,82,14)
    REM control.Default = 1
    control.Caption = "Im Netzwerk &versenden"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(270,364,36,14)
    control.Caption = "&Abbruch"
    control.ReturnValue = 0
    control.Cancel = 1
    DIALOG "DIALOG",a%
    REMOVE DIALOG ALL 

    SELECT CASE a%
      CASE 0
        ok% = 0
      CASE 1
        ok% = 0
      CASE 2
        IF Betreff.mail <> "" THEN 
          ok% = 0
        ELSE 
          CALL Fehler("Sie mÅssen die Betreff-Zeile ausfÅllen, um eine EMAIL zu versenden!","")
          GOTO anf100620031
        END IF 
      CASE 3
        REM BCC
        CREATE DIALOG "ACCESS",0,0,395,212,"BCC-Auswahl","MS Sans Serif",8
        ADD DIALOG "ACCESS",9,6,8,20,20,2
        ADD DIALOG "ACCESS",5,36,9,152,8,0,"Bitte markieren Sie die Mitarbeiter,"
        ADD DIALOG "ACCESS",5,36,17,152,10,0,"denen Sie eine Nachricht senden wollen:"
        ADD DIALOG "ACCESS",7,36,28,296,185,10,2,MALIST2$,Auswahl$
        ADD DIALOG "ACCESS",1,336,173,55,15,1,"&OK",1,1
        ADD DIALOG "ACCESS",1,336,191,55,15,0,"&Abbrechen",0,0
        DIALOG "ACCESS",req%
        REMOVE DIALOG "ACCESS"
        IF req% = 1 THEN 
          MOUSE OFF 
           ab% = 0
           WHILE Auswahl$(ab%) <> ""
             SELECT KEY Auswahl$(ab%) FILE "supervis" INDEX Name.SUPERVIS
             IF FOUND ("Supervis") THEN 
                 IF bcc.mail = "" THEN 
                   bcc.mail = name.supervis
                 ELSE 
                   bcc.mail = bcc.mail + ":" + name.supervis
                 END IF 
               REM CALL QuickStore("ACCESS")
             END IF 
             ab% = ab% + 1
           WEND 
      CASE 4
        REM CC 
        CREATE DIALOG "ACCESS",0,0,395,212,"CC-Auswahl","MS Sans Serif",8
        ADD DIALOG "ACCESS",9,6,8,20,20,2
        ADD DIALOG "ACCESS",5,36,9,152,8,0,"Bitte markieren Sie die Mitarbeiter,"
        ADD DIALOG "ACCESS",5,36,17,152,10,0,"denen Sie eine Nachricht senden wollen:"
        ADD DIALOG "ACCESS",7,36,28,296,185,10,2,MALIST2$,Auswahl$
        ADD DIALOG "ACCESS",1,336,173,55,15,1,"&OK",1,1
        ADD DIALOG "ACCESS",1,336,191,55,15,0,"&Abbrechen",0,0
        DIALOG "ACCESS",req%
        REMOVE DIALOG "ACCESS"
        IF req% = 1 THEN 
          MOUSE OFF 
           ab% = 0
           WHILE Auswahl$(ab%) <> ""
             SELECT KEY Auswahl$(ab%) FILE "supervis" INDEX Name.SUPERVIS
             IF FOUND ("Supervis") THEN 
                 IF cc.mail = "" THEN 
                   cc.mail = name.supervis
                 ELSE 
                   cc.mail = cc.mail + ":" + name.supervis
                 END IF 
               REM CALL QuickStore("ACCESS")
             END IF 
             ab% = ab% + 1
           WEND 
        END IF 
    END SELECT 
  WEND 
 
 IF a% = 1 THEN 
   REM als Netzwerknachricht versenden
   MOUSE OFF 
   n$ = Nachricht.mail
   SELECT FIRST FILE "supervis" INDEX codema.supervis
   SELECT KEY GMAcodema% FILE "supervis" INDEX codema.supervis
   absender.mail = name.supervis
   SELECT FIRST FILE "supervis" INDEX Name.SUPERVIS
   SELECT KEY MADEST$ FILE "supervis" INDEX Name.SUPERVIS
   codema.mail = codema.supervis
   codemavon.mail = GMAcodema%
   EmpfÑnger.mail = Name.supervis
   IF emailnummer.supervis <> "" THEN 
     MailTO.mail = emailnummer.supervis
   ELSE 
     MailTO.mail = ""
   END IF 
   Datum.mail = TODAY 
   Zeit.mail = NOW 
   codemail% = SER ("mail",1)
   codeMAIL.mail = codemail%
   IF LTRIM$ (cc.mail) <> "" THEN 
     IF RIGHT$ (cc.mail,1) <> ":" THEN 
       cc.mail = cc.mail + ":"
     END IF 
   END IF 
   IF LTRIM$ (bcc.mail) <> "" THEN 
     IF RIGHT$ (bcc.mail,1) <> ":" THEN 
       bcc.mail = bcc.mail + ":"
     END IF 
   END IF 
   CALL QuickStore("MAIL")
   SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
   REDIM masucc%( RECCOUNT ("supervis"))
   REDIM masubcc%( RECCOUNT ("supervis"))
   IF cc.mail <> "" THEN 
     pos% = INSTR (cc.mail,":")
     IF pos% > 0 THEN 
       laeng% = LEN (cc.mail)
       j% = 0
        FOR i% = 1 TO laeng%
         posold% = pos%
         cc$ = MID$ (cc.mail,i%,pos% - i%)
         pos% = INSTR (posold% + 1,cc.mail,":")
 
         IF pos% > 0 THEN 
           i% = posold%
         ELSE 
           i% = laeng% + 1
         END IF 
         REM CALL WriteINIDes("BCC","Z" + LTRIM$ ( STR$ (j%,"999")), FN ansi(CC$),datei$)
         SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
         masucc%(j%) = codema.supervis
         j% = j% + 1
 
       NEXT i%
     ELSE 
       cc$ = cc.mail
       SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
       masucc%(0) = codema.supervis
     END IF 
     SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
     FOR i% = 0 TO j% - 1
       BLANK DUPLICATE FILE "mail"
       codemail.mail = SER ("MAIL",1)
       codema.mail = masucc%(i%)
       bcc.mail = ""
       STORE FILE "MAIL"
       SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
     NEXT i%
   END IF 
   SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
   IF bcc.mail <> "" THEN 
     pos% = INSTR (bcc.mail,":")
     IF pos% > 0 THEN 
       laeng% = LEN (bcc.mail)
       j% = 0
        FOR i% = 1 TO laeng%
         posold% = pos%
         cc$ = MID$ (bcc.mail,i%,pos% - i%)
         pos% = INSTR (posold% + 1,bcc.mail,":")
 
         IF pos% > 0 THEN 
           i% = posold%
         ELSE 
           i% = laeng% + 1
         END IF 
         REM CALL WriteINIDes("BCC","Z" + LTRIM$ ( STR$ (j%,"999")), FN ansi(CC$),datei$)
         SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
         masubcc%(j%) = codema.supervis
         j% = j% + 1
 
       NEXT i%
     ELSE 
       cc$ = bcc.mail
       SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
       masubcc%(0) = codema.supervis
     END IF 
     SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
     FOR i% = 0 TO j% - 1
       BLANK DUPLICATE FILE "mail"
       codemail.mail = SER ("MAIL",1)
       codema.mail = masubcc%(i%)
       bcc.mail = ""
       STORE FILE "MAIL"
       SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
     NEXT i%
   END IF 
   MOUSE ON 
   REQUEST "Nachricht wurde gesendet","",2
 END IF 
 
 IF a% = 2 THEN 
   
   REM als EMAIL-Nachricht versenden
   MOUSE OFF 
   SELECT KEY GMAcodema% FILE "supervis" INDEX codema.supervis
   fehl$ = ""
   IF GCODIE% <> - 1 THEN 
     fehl$ = "Es wurde kein EMAIL-Versand eingerichtet! (lokale Rechnereinstellungen)" + CHR$ (13) + CHR$ (10)
   END IF 
   IF EMAILSHost.supervis = "" THEN 
     fehl$ = fehl$ + "Es wurde fÅr den User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-HOST! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
   END IF 
   IF EMAILNummer.supervis = "" THEN 
     fehl$ = fehl$ + "Es wurde fÅr den User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-keine EMAIL-Adresse! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
   END IF 
   absender.mail = name.supervis

   SELECT FIRST FILE "supervis" INDEX Name.SUPERVIS
   SELECT KEY MADEST$ FILE "supervis" INDEX Name.SUPERVIS
   IF EMAILSHost.supervis = "" THEN 
     fehl$ = fehl$ + "Es wurde fÅr den User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-HOST! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
   END IF 
   codema.mail = codema.supervis
   codemavon.mail = GMAcodema%
   IF empfÑnger.mail = "" THEN empfÑnger.mail = Name.supervis
   Datum.mail = TODAY 
   Zeit.mail = NOW 
   codemail% = SER ("mail",1)
   codeMAIL.mail = codemail%
   IF LTRIM$ (cc.mail) <> "" THEN 
     IF RIGHT$ (cc.mail,1) <> ":" THEN 
       cc.mail = cc.mail + ":"
     END IF 
   END IF 
   IF LTRIM$ (bcc.mail) <> "" THEN 
     IF RIGHT$ (bcc.mail,1) <> ":" THEN 
       bcc.mail = bcc.mail + ":"
     END IF 
   END IF 
   IF emailMAnummer.supervis <> "" THEN 
     MailTO.mail = emailMAnummer.supervis
   ELSE 
     MailTO.mail = emailnummer.supervis
   END IF 
   IF LTRIM$ (MailTO.mail) = "" THEN 
     fehl$ = fehl$ + "FÅr den Mitarbeiter " + name.supervis + " wurde keine EmpfÑnger-EMAIL-Adresse definiert!"
   END IF 
   CALL QuickStore("MAIL")
   IF fehl$ <> "" THEN 
     SELECT KEY codemail% LOCK FILE "MAIL" INDEX codemail.mail
     CALL Fehler(fehl$,"")
     GOTO anf120520032
   END IF 
 
 
   SELECT KEY codemail% LOCK FILE "MAIL" INDEX codemail.mail
   REDIM masucc%( RECCOUNT ("supervis"),1)
   REDIM masubcc%( RECCOUNT ("supervis"),1)
   REDIM masucc%( RECCOUNT ("supervis"))
   REDIM masubcc%( RECCOUNT ("supervis"))
   EMAILCC.mail = ""
   IF cc.mail <> "" THEN 
     pos% = INSTR (cc.mail,":")
     IF pos% > 0 THEN 
       laeng% = LEN (cc.mail)
       j% = 0
        FOR i% = 1 TO laeng%
         posold% = pos%
         cc$ = MID$ (cc.mail,i%,pos% - i%)
         pos% = INSTR (posold% + 1,cc.mail,":")
 
         IF pos% > 0 THEN 
           i% = posold%
         ELSE 
           i% = laeng% + 1
         END IF 
         REM CALL WriteINIDes("BCC","Z" + LTRIM$ ( STR$ (j%,"999")), FN ansi(CC$),datei$)
         SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
         IF EMAILMANUMMER.supervis <> "" THEN 
           EMAILCC.mail = EMAILCC.mail + EMAILMANUMMER.supervis + ":"
         ELSE 
           EMAILCC.mail = EMAILCC.mail + EMAILNUMMER.supervis + ":"
         END IF 
         IF EMAILSHost.supervis = "" THEN 
           fehl$ = fehl$ + "Es wurde fÅr den CC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-HOST! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
         END IF 
         IF EMAILNummer.supervis = "" AND EMAILMANummer.supervis = "" THEN 
           fehl$ = fehl$ + "Es wurde fÅr den CC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-keine EMAIL-Adresse! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
         END IF 
         masucc%(j%) = codema.supervis
         j% = j% + 1
 
       NEXT i%
     ELSE 
       cc$ = cc.mail
       SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
       IF EMAILMANUMMER.supervis <> "" THEN 
         EMAILCC.mail = EMAILCC.mail + EMAILMANUMMER.supervis + ":"
       ELSE 
         EMAILCC.mail = EMAILCC.mail + EMAILNUMMER.supervis + ":"
       END IF 
       IF EMAILSHost.supervis = "" THEN 
         fehl$ = fehl$ + "Es wurde fÅr den CC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-HOST! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
       END IF 
       IF EMAILNummer.supervis = "" AND EMAILMANummer.supervis = "" THEN 
         fehl$ = fehl$ + "Es wurde fÅr den CC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-keine EMAIL-Adresse! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
       END IF 
       masucc%(0) = codema.supervis
     END IF 
     IF fehl$ <> "" THEN 
       SELECT KEY codemail% LOCK FILE "MAIL" INDEX codemail.mail
       CALL Fehler(fehl$,"")
       GOTO anf120520032
     ELSE 
       CALL QuickStore("MAIL")
     END IF 
     SELECT KEY codemail% LOCK FILE "MAIL" INDEX codemail.mail
   END IF 
   SELECT KEY codemail% LOCK FILE "MAIL" INDEX codemail.mail
   EMAILBCC.mail = ""
   IF bcc.mail <> "" THEN 
     pos% = INSTR (bcc.mail,":")
     IF pos% > 0 THEN 
       laeng% = LEN (bcc.mail)
       j% = 0
        FOR i% = 1 TO laeng%
         posold% = pos%
         cc$ = MID$ (bcc.mail,i%,pos% - i%)
         pos% = INSTR (posold% + 1,bcc.mail,":")
 
         IF pos% > 0 THEN 
           i% = posold%
         ELSE 
           i% = laeng% + 1
         END IF 
         REM CALL WriteINIDes("BCC","Z" + LTRIM$ ( STR$ (j%,"999")), FN ansi(CC$),datei$)
         SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
         IF EMAILMANUMMER.supervis <> "" THEN 
           EMAILBCC.mail = EMAILBCC.mail + EMAILMANUMMER.supervis + ":"
         ELSE 
           EMAILBCC.mail = EMAILBCC.mail + EMAILNUMMER.supervis + ":"
         END IF 
         IF EMAILSHost.supervis = "" THEN 
           fehl$ = fehl$ + "Es wurde fÅr den BCC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-HOST! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
         END IF 
         IF EMAILNummer.supervis = "" AND EMAILMANummer.supervis = "" THEN 
           fehl$ = fehl$ + "Es wurde fÅr den BCC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-keine EMAIL-Adresse! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
         END IF 
         masubcc%(j%) = codema.supervis
         j% = j% + 1
 
       NEXT i%
     ELSE 
       cc$ = bcc.mail
       SELECT KEY cc$ FILE "supervis" INDEX Name.SUPERVIS
       IF EMAILMANUMMER.supervis <> "" THEN 
         EMAILBCC.mail = EMAILBCC.mail + EMAILMANUMMER.supervis + ":"
       ELSE 
         EMAILBCC.mail = EMAILBCC.mail + EMAILNUMMER.supervis + ":"
       END IF 
       IF EMAILSHost.supervis = "" THEN 
         fehl$ = fehl$ + "Es wurde fÅr den BCC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-HOST! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
       END IF 
       IF EMAILNummer.supervis = "" THEN 
         fehl$ = fehl$ + "Es wurde fÅr den BCC-User " + name.supervis + " der EMAIL-Versand nicht korrekt eingerichtet-keine EMAIL-Adresse! (Mitarbeiterverwaltung)" + CHR$ (13) + CHR$ (10)
       END IF 
       masubcc%(0) = codema.supervis
     END IF 
     IF fehl$ <> "" THEN 
       SELECT KEY codemail% LOCK FILE "MAIL" INDEX codemail.mail
       CALL Fehler(fehl$,"")
       GOTO anf120520032
     ELSE 
       CALL QuickStore("MAIL")
     END IF 
   END IF 
   IF fehl$ <> "" THEN 
   END IF 
   SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
   CALL Fehler("Die EMAIL mu· einer Adresse zugeordnet werden, um einen Termin zuhinterlegen!","Bitte wÑhlen Sie eine Adresse aus!")
   adr% = ADRSuche%(0)
   IF adr% <> 0 THEN 
     SELECT KEY adr% FILE "ADRESSEN" INDEX codeku.adressen
     knr% = adr%
     kunr% = adr%
     CALL AQRegMail(codemail%)
     SELECT KEY cuaq% FILE "AKQUISE" INDEX codeaq.akquise
     CALL EMAILManSend(codeaq.akquise,1)
   ELSE 
     SELECT KEY codemail% LOCK FILE "MAIL" INDEX codemail.mail
     CALL Fehler("Sie mÅssen eine Adresse zuordnen, um die EMAIL versenden zu kînnen!","")
     GOTO anf120520032
   END IF 
 
 
   MOUSE ON 
   REQUEST "Nachricht wurde gesendet","",2
 END IF 
 FILE cfile$
 END SUB 
  




SUB AQRegMail(codemail%)
 cfile$ = FILE 
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 SELECT KEY codemail% FILE "MAIL" INDEX codemail.mail
 DIM Aktionen$(300)
 FILE "AKTIONEN"
 INDEX CodeAK
 SELECT FIRST 
 a% = - 1
 WHILE NOT EOF ("AKTIONEN")
   a% = a% + 1
   Aktionen$(a%) = Bezeichnung.AKTIONEN + " (" + STR$ (CodeAK.AKTIONEN,"000000") + ")"
   SELECT NEXT 
 WEND 
 SELECT KEY 1
 Aktion$ = Bezeichnung.AKTIONEN + " (" + STR$ (CodeAK.AKTIONEN,"000000") + ")"
 DIM Mitarbeiter$(300)
 FILE "SUPERVIS"
 INDEX CodeMA
 SELECT FIRST 
 a% = - 1
 WHILE NOT EOF ("SUPERVIS")
   a% = a% + 1
   Mitarbeiter$(a%) = Nachname.SUPERVIS + ", " + Vorname.SUPERVIS + " (" + STR$ (CodeMA.SUPERVIS,"000000") + ")"
   SELECT NEXT 
 WEND 
 SELECT KEY vcodema% FILE "supervis" INDEX codema.supervis
 MANachname$ = Nachname.SUPERVIS + ", " + Vorname.SUPERVIS + " (" + STR$ (CodeMA.SUPERVIS,"000000") + ")"
 datum$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 Termin$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 Nachname$ = Nachname.GAdrDat$
 Vorname$ = Vorname.GAdrDat$
 Stra·e$ = Stra·e.GAdrDat$
 Ort$ = PLZ.GAdrDat$ + " " + Ort.GAdrDat$
 tmpku% = CodeKU.GAdrDat$
 RNotiz$ = "EMAIL an Mitarbeiter: " + Betreff.mail
    DIM dlg AS Dialog
    DIM control AS DialogControl
 ON ERROR GOTO dokt190520031
   GOTO dokt190520032
dokt190520031: 
   CALL Fehler("Die Werte fÅr Datum oder Uhrzeit scheinen falsch zu sein!","Bitte prÅfen")
dokt190520032: 
    Superbase.Dialogs.Add("AQREGISTER")
    SET dlg = Superbase.Dialogs.AQREGISTER
    dlg.Move(0,0,354,235)
    dlg.Caption = title$
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(5,8,40,12)
    control.MaxLength = 10
    control.TextBinding = "Datum$"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(49,8,40,12)
    control.MaxLength = 10
    control.TextBinding = "Termin$"
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(93,8,25,12)
    control.MaxLength = 5
    control.TextBinding = "Zeit$"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(130,8,24,12)
    control.MaxLength = 5
    control.TextBinding = "Dauer$"
    IF GADRDat$ LIKE "ADRESSEN" THEN 
      SET control = dlg.Add("DialogTextBox6","DialogTextBox")
      control.Move(185,8,40,12)
      control.MaxLength = 10
      control.TextBinding = "VTermin$"
 
      SET control = dlg.Add("DialogTextBox7","DialogTextBox")
      control.Move(235,8,25,12)
      control.MaxLength = 5
      control.TextBinding = "VZeit$"
    END IF 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(130,22,28,11)
    control.Caption = "Dauer"
    IF GADRDat$ LIKE "ADRESSEN" THEN 
      SET control = dlg.Add("DialogLabel19","DialogLabel")
      control.Move(185,22,45,13)
      control.Caption = "Vorlagetermin"
 
      SET control = dlg.Add("DialogLabel20","DialogLabel")
      control.Move(235,22,54,13)
      control.Caption = "Vorlagezeit"
    END IF 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(5,22,32,13)
    control.Caption = "Datum"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(49,22,28,13)
    control.Caption = "Termin"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(93,22,28,13)
    control.Caption = "Uhrzeit"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(5,36,123,12)
    control.Caption = "Zuordnung zur Aktion"
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(186,44,160,81)
    control.Caption = "Adresse"
 
    SET control = dlg.Add("DialogLabel8","DialogLabel")
    control.Move(190,59,39,12)
    control.Caption = "Nachname"
 
    SET control = dlg.Add("DialogLabel14","DialogLabel")
    control.Move(230,59,116,12)
    control.NoKeyboardEquivalent = 1
    control.CaptionBinding = "Nachname$"
 
    SET control = dlg.Add("DialogLabel9","DialogLabel")
    control.Move(190,69,32,12)
    control.Caption = "Vorname"
 
    SET control = dlg.Add("DialogLabel15","DialogLabel")
    control.Move(230,69,116,12)
    control.NoKeyboardEquivalent = 1
    control.CaptionBinding = "Vorname$"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(190,79,24,12)
    control.Caption = "Stra·e"
 
    SET control = dlg.Add("DialogLabel16","DialogLabel")
    control.Move(230,79,116,12)
    control.CaptionBinding = "Stra·e$"
 
    SET control = dlg.Add("DialogLabel11","DialogLabel")
    control.Move(190,89,19,12)
    control.Caption = "Ort"
 
    SET control = dlg.Add("DialogLabel17","DialogLabel")
    control.Move(230,89,116,12)
    control.CaptionBinding = "Ort$"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(190,104,152,14)
    control.Caption = "Auswahl"
    control.ReturnValue = 2
 
    SET control = dlg.Add("DialogComboBox1","DialogComboBox")
    control.Move(5,46,169,83)
    control.Style = 2
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("Aktionen$","Aktion$")
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(5,65,139,8)
    control.Caption = "Eintragen in den Kalender des Mitarbeiters"
 
    SET control = dlg.Add("DialogComboBox2","DialogComboBox")
    control.Move(5,76,169,90)
    control.Style = 2
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("Mitarbeiter$","MANachname$")
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(5,96,139,8)
    control.Caption = "Notiz"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(5,105,169,128)
    control.MultiLine = 1
    control.ScrollBars = 2
    control.MaxLength = 4000
    control.TextBinding = "RNotiz$"
 
    SET control = dlg.Add("DialogLabel12","DialogLabel")
    control.Move(186,133,162,29)
    control.Caption = "Wenn Sie diesen Termin nur zu Informationszwecken aufnehmen mîchten, markieren Sie bitte die Option 'Termin erledigt'."
 
    SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
    control.Move(186,165,76,12)
    control.Caption = "Termin erledigt"
    control.Bind("Terminerl$")
    control.ValueOn = "j"
    control.ValueOff = "n"
 
    SET control = dlg.Add("DialogLabel13","DialogLabel")
    control.Move(186,178,159,37)
    control.Caption = "Nach BetÑtigung der SchaltflÑche 'OK' wird der Eintrag in der Termindatei erzeugt."
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(186,217,78,15)
    control.Default = 1
    control.Caption = "&OK"
    control.ReturnValue = 1
 
 
 _ok% = 0
 WHILE _ok% = 0
   DIALOG "AQREGISTER",req%
   IF req% = 2 THEN 
     kunr% = ADRSuche%(0)
     IF kunr% <> 0 THEN 
       SELECT KEY kunr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       Nachname$ = Nachname.GAdrDat$
       Vorname$ = Vorname.GAdrDat$
       Stra·e$ = Stra·e.GAdrDat$
       Ort$ = PLZ.GAdrDat$ + " " + Ort.GAdrDat$
       tmpku% = CodeKU.GAdrDat$
     END IF 
   END IF 
   IF req% = 0 THEN _ok% = 2
   IF req% = 1 THEN _ok% = 1
 WEND 
 REMOVE DIALOG "AQREGISTER"
 IF _ok% = 1 THEN 
   FILE GAkquiDat$
   BLANK FILE GAkquiDat$
   cuaq% = SER (GAkquiDat$,1)
   codeaq.GAkquiDat$ = cuaq%
   codeKU.GAkquiDat$ = tmpku%
   CodeAK.GAkquiDat$ = VAL ( MID$ (Aktion$, LEN (Aktion$) - 6,6))
   CodeMA.GAkquiDat$ = VAL ( MID$ (MANachname$, LEN (MANachname$) - 6,6))
   SELECT KEY tmpku% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   nachname.GAkquiDat$ = LEFT$ ( TRIM$ (nachname.GAdrDat$) + "," + TRIM$ (vorname.GadrDat$),100)
   Wertung.GAkquiDat$ = 0
   Datum.GAkquiDat$ = Datum$
   Uhrzeit.GAkquiDat$ = zeit$
   Dauer.GAkquiDat$ = VAL (dauer$)
   CodeDOK.GAkquiDat$ = 0
   ErDatum.GAkquiDat$ = VTermin$
   ErZeit.GAkquiDat$ = VZeit$
   SELECT KEY codema.GAkquiDat$ LOCK FILE "supervis" INDEX codema.supervis
   Bearbeiter.GAkquiDat$ = nachname.supervis
   AnzTermine.supervis = AnzTermine.supervis + 1
   IF Terminerl$ LIKE "j" THEN 
     AnzTermineErl.supervis = AnzTermineErl.supervis + 1
   ELSE 
     AnzTermineUnErl.supervis = AnzTermineUnErl.supervis + 1
   END IF 
   STORE FILE "supervis"
   UNLOCK CURRENT FILE "Supervis"
   IF PROJECTJN$ = "TRUE" THEN 
     codepr.GAkquiDat$ = codeprdok%
     projekt.GAkquiDat$ = projektdok$
     codeprdok% = 0
     projektdok$ = ""
   END IF 
   notiz.GAkquiDat$ = rnotiz$
   termin.GAkquiDat$ = Termin$
   erledigt_Termin.GAkquiDat$ = Terminerl$
   TerminNr.GAkquiDat$ = AnzTermine.supervis
   REM 01032001
   GErledTermin$ = Terminerl$
   emailto.akquise = mailto.mail
   emailbetreff.akquise = Betreff.mail
   emailtext.akquise = nachricht.mail
   emailcc.akquise = emailcc.mail
   emailbcc.akquise = emailbcc.mail
   CALL FStore(GAkquiDat$)
 END IF 
 FILE cfile$
 ON ERROR GOTO ErrorHandler
 MOUSE ON 
 END SUB 
 
 

SUB SerienEMAIL()
   SELECT FIRST FILE "supervis"
   SELECT KEY GMACodeMA% FILE "Supervis" INDEX codema.supervis
 datei$ = GMACodeDir$ + "codietes.ini"
 IF EXISTS (datei$) THEN 
   ON ERROR GOTO mas240520031
   DELETE datei$
   GOTO mas240520032
mas240520031: 
   IF schalter% <> 0 THEN CALL fehler("Es konnte die temporÑre Datei " + datei$ + " nicht gelîscht werden, bitte prÅfen Sie, ob die Datei geîffnet ist und schlie·en Sie diese!,"")
mas240520032: 
   ON ERROR GOTO ErrorHandler
 END IF 
 datei1$ = GMACodeDir$ + "codietes.txt"
 IF EXISTS (datei1$) THEN 
   ON ERROR GOTO mas240520035
   DELETE datei1$
   GOTO mas240520036
mas240520035: 
   IF schalter% <> 0 THEN CALL fehler("Es konnte die temporÑre Datei " + datei1$ + " nicht gelîscht werden, bitte prÅfen Sie, ob die Datei geîffnet ist und schlie·en Sie diese!,"")
mas240520036: 
   ON ERROR GOTO ErrorHandler
 END IF 
 OPEN datei$ FOR OUTPUT 
 CLOSE OUTPUT 
 IF EmailShost.supervis <> "" THEN 
   UserID$ = EMAILSUserID.supervis
   AFirma$ = FN ansi(EMAILSAFirma.supervis)
   AName$ = FN ansi(EMAILSAName.supervis)
   ANUmmer$ = EMAILNummer.supervis
   
   REM BCC$ = EMAILSKopie.supervis
   Sen$ = EMAILSKopie.supervis
   REM char *HostPOP3, char *UserIDPOP3, char *PortPOP3, char*PasswortPOP3, char *POPCon
   REM ,Hpop3$,HPPort$,PUID$,Ppassw$,PJN$
   Hpop3$ = ""
   HPPort$ = ""
   PUID$ = ""
   PJN$ = EMAILPOP3JN.supervis
   IF EMAILPOP3JN.supervis = "TRUE" THEN 
     Hpop3$ = EMAILPHost.supervis
     HPPort$ = LTRIM$ ( STR$ (EMAILPPort.supervis,"999999"))
     IF HPPort$ = "" THEN HPPort$ = "110"
     PUID$ = EmailPUserID.supervis
     Ppassw$ = EMAILPPasww.supervis
   END IF 
   port$ = LTRIM$ ( STR$ (EMAILSPort.supervis,"999999"))
   IF port$ = "" THEN port$ = "25"
   IF EMAILSNummer.supervis <> "" THEN 
     Bersend$ = EMAILSNummer.supervis
   ELSE 
     Bersend$ = EMAILNummer.supervis
   END IF 
   Bersend1$ = EMAILSNummer1.supervis
   Text1$ = FN ansi(EMAILText1.supervis)

   Text2$ = FN ansi(EMAILText2.supervis)
   BAnrede$ = FN ansi(Briefanrede.GADRDat$)
   alltxt$ = GMACodeDir$ + "codietes.ini"
   TOM$ = EMAILNummer.supervis
   ok% = - 1
   IF ANUmmer$ = "" OR AName$ = "" THEN 
     ok% = 0
     CALL Fehler("Sie kînnen eine email nur versenden, wenn Sie einen Absendernamen und eine Absender - email-Nummer besitzen!","Siehe Stammdaten-Mitarbeiterverwaltung")
     GOTO end240520031
   END IF 
   Betreff$ = ""
   senber$ = UCASE$ (EMAILSErg.supervis)
   CALL WriteINIDes("EMAILSERVER","HOST",EMAILShost.supervis,datei$)
   CALL WriteINIDes("EMAILSERVER","PORT",port$,datei$)
   CALL WriteINIDes("EMAILSERVER","USERID",UserID$,datei$)
   CALL WriteINIDes("EMAILSERVER","ABSFirma",AFirma$,datei$)
   CALL WriteINIDes("EMAILSERVER","ABSName",AName$,datei$)
   CALL WriteINIDes("EMAILSERVER","ABSEMAIL",ANummer$,datei$)
   CALL WriteINIDes("EMAILSERVER","KOPIEANABSENDER",Sen$,datei$)
   CALL WriteINIDes("EMAILSERVER","BerSendenummer",BerSend$,datei$)
   CALL WriteINIDes("EMAILSERVER","BerSendenummer1",BerSend1$,datei$)
   CALL WriteINIDes("EMAILSERVER","TO",TOM$,datei$)
   CALL WriteINIDes("EMAILSERVER","SENDEBERICHT",senber$,datei$)
   CALL WriteINIDes("EMAILSERVER","Betreff",Betreff$,datei$)
   OPEN datei1$ FOR OUTPUT 
   ? FN ansi(emailtext.GAkquiDat$)
   CLOSE OUTPUT 
   j% = 0
   k% = 0
   SELECT FIRST FILE userfile$ INDEX codeku.userfile$
   WHILE NOT EOF (userfile$)
     codeku% = VAL (codeku.userfile$)
     SELECT FIRST FILE GTelDat$ INDEX codeku.GTelDat$
     SELECT KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
     WHILE NOT EOF (GTelDat$) AND codeku.GTelDat$ = codeku%
       ook% = 0
       IF nummer.GTelDat$ LIKE "*@*" THEN 
         IF GEMAILRAUS$ LIKE "<kein Filter>" THEN 
           ook% = - 1
           k% = k% + 1
         ELSE 
           IF KART2.GTELDAT$ = GEMAILRAUS$ THEN 
             ook% = - 1
             k% = k% + 1
           END IF 
         END IF 
       END IF 
       IF ook% = - 1 THEN 
         CALL WriteINIDes("BCC","Z" + LTRIM$ ( STR$ (k% - 1,"99999")), FN ansi(nummer.GTelDat$),datei$)
       END IF 
       SELECT NEXT FILE GTelDat$ INDEX codeku.GTelDat$
     WEND 
     SELECT NEXT FILE userfile$ INDEX codeku.userfile$
   WEND 
   REM hier jetzt das EMAIL-Programm aufrufen
   CALL Fehler("Serienemail","")
   IF ok% THEN 
     MOUSE OFF 
     Bersend$ = ""
     REM ret% = CALL ("_SendEMAILSerie",datei$,datei1$,schalter$,adresse$,Hpop3$,PUID$,HPPort$,Ppassw$,PJN$,Bersend$,Text1$,Text2$)
     IF NOT PROGRAMFILE ("PCLIB1") THEN LOAD _netPath$ + "PCLIB1.sbr", NEW 
     CALL EMAILform()
     qdatei$ = datei1$
     MOUSE ON 
   ELSE 
     ret% = 4
   END IF 
   IF Bersend$ <> "" AND ret% = - 1 THEN 
     adrser% = 0
     GMailBetreff$ = Bersend$
     GMailIn% = - 1
     SELECT FIRST FILE userfile$ INDEX codeku.userfile$
     knr% = CodeKU%
     textdatei% = DOKNeu%(0,"allgemeine Schreiben",0)
     IF EXISTS (textdatei%,CodeDOK.GDokDat$) AND textdatei% > 0 THEN 
       SELECT FIRST FILE GDokDat$ INDEX CodeDOK.GDokDat$
       SELECT KEY textdatei% FILE GDokDat$ INDEX CodeDOK.GDokDat$
       datei1$ = LEFT$ (_netpath$,2) + Dateiname.GDokDat$
       COPY qdatei$ TO datei1$
       SELECT FIRST FILE userfile$ INDEX codeku.userfile$
       WHILE NOT EOF (userfile$)
         codeku% = VAL (codeku.userfile$)
         IF codeku% <> knr% THEN 
           SELECT FIRST FILE GDokDat$ INDEX CodeDOK.GDokDat$
           SELECT KEY textdatei% FILE GDokDat$ INDEX CodeDOK.GDokDat$
           FILE GDokDat$
           BLANK DUPLICATE FILE GDokDat$
           codeku.GDokdat$ = codeku%
           codedok.GDokDat$ = SER (GDokDat$,1)
           CALL QuickStore(GDokDat$)
         END IF 
         FILE userfile$
         SELECT NEXT FILE userfile$ INDEX codeku.userfile$
       WEND 
     END IF 
   END IF 
end240520031: 
 CALL Fehler("Serien-EMAIL wurde beendet!","")
 GEMAILRAUS$ = ""
 GEMAILSer% = 0
 END SUB 




  
 
 REM Dokumente an ELO
 REM expELOdoc('K', KundenNr, DokumentenNr,Nachname,Vorname,Dokumentenname,Pfad,ErstellerNr,Erstellername,Datum,Dokumententyp,Spartengruppe,Sparte)
SUB DokSendELO(Typ$,Kunr$,codedok$,Nname$,vname$,Pfad$,erstelnr$,Creator$,creatdat$,DokTyp$,spgru$,spar$,auto%)
   ret% = - 1
   REM CALL Fehler(Typ$ + "-" + Kunr$ + "-" + codedok$ + "-" + Nname$ + "-" + vname$ + "-" + Pfad$ + "-" + erstelnr$ + "-" + creator$ + "-" + creatdat$ + "-" + doktyp$ + "-" + spgru$ + "-" + spar$,"")
   le$ = ""
   REM ret% = CALL ("expELOdoc",Typ$,Kunr$,codedok$,Nname$,vname$,Pfad$,erstelnr$,Creator$,creatdat$,DokTyp$,spgru$,spar$,le$,le$,le$,le$,le$,le$,le$)
   IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN DELETE GMACodeDir$ + "ELOerg.ini"
   a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
   i% = 0
   ret% = - 1
   WHILE ret% = - 1
     IF NOT EXISTS (GMACodeDir$ + "ELOSend.ini") THEN 
       i% = i% + 1
       WAIT FOR 1
       IF i% > 15 THEN 
         CALL Fehler("Anscheinend kann keine Verbindung zu ELO hergestellt werden!","")
         REQUEST "Anscheinend kann keine Verbindung zu ELO hergestellt werden!","Wollen Sie weiter warten?",130,reqw%
         IF reqw% = 1 THEN 
           i% = 0
         ELSE 
           ret% = 1
         END IF 
       END IF 
     ELSE 
       ret% = 0
     END IF 
   WEND 
   IF ret% <> 0 THEN 
     IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN 
       a$ = ReadDesti$("ELO","RÅckgabewert0",GMACodeDir$ + "ELOerg.ini")
       b$ = ReadDesti$("ELO","RÅckgabetext0",GMACodeDir$ + "ELOerg.ini")
       CALL Fehler("Es wurde ein Fehler bei der ELO-Operation festgestellt:","RÅckgabewert0: " + a$ + "   RÅckgabetext0: " + b$)
     END IF 
   END IF 
   IF ret% = 0 THEN 
     codedok% = VAL (codedok$)
     GMAName$ = LEFT$ (name.supervis,50)
     GMACodeMA% = CodeMA.supervis
     SELECT KEY codedok% LOCK FILE GDokDat$ INDEX codedok.GDokDat$
     ELOTrans.GDokDat$ = 1
     ELODatum.GDokDat$ = TODAY 
     ELOMA.GDokDat$ = GMACodeMA%
     ELOMAName.GDokDat$ = GMAName$
     CALL QuickStore(GDokDat$)
     REM CALL Fehler("Dokument wurde an ELO Åbergeben","RÅckgabewert vom ERZEUGEN:" + LTRIM$ ( STR$ (ret%)))
   ELSE 
     CALL Fehler("RÅckgabewert vom ERZEUGEN: " + LTRIM$ ( STR$ (ret%)),"")
   END IF 
 
 END SUB 
 

 



SUB ADRDokSendELO(codedok%,codeku%)
     REM 17092003
     ansionoff$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))
     SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
     SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
     Typ$ = "K"
     REM IF ansionoff$ = "ON" THEN 
     Kunr$ = FN ansi(Kundennummer.GADRDat$)
     codedok$ = STR$ (CodeDok.GDokDat$,"000000")
     nname$ = FN ansi(Nachname.GADRDat$)
     vname$ = FN ansi(Vorname.GADRDat$)
     dokument$ = FN ansi(Dokument.GDokDat$)
     pfad$ = LEFT$ (_netpath$,2) + dateiname.GDokDat$
     erstelnr$ = STR$ (codema.GDokDat$,"000000")
     creator$ = FN ansi(Creator.GDokDat$)
     creatdat$ = DATE$ (erstellt_am.GDokDat$,"0dmmyyyy")
     DokTyp$ = FN ansi(Gruppe.GDokDat$)
     spgru$ = ""
     spar$ = ""
     anzblktxt$ = FN ansi("AnzahlDerBlîcke")
     ruecktxt$ = FN ansi("RÅckgabedateiname")
     REM WriteINIDes(topic$,item$,value$,datei$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
     CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Art","K",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","KundenNr",Kunr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Nachname",nname$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","VertragsNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Gesellschaftsname","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","AgenturNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Agenturname","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Spartengruppe","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Sparte","",GMACodeDir$ + "ELOSend.ini")
     REM a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     REM expELOdoc('K', KundenNr, DokumentenNr,Nachname,Vorname,Dokumentenname,Pfad,ErstellerNr,Erstellername,Datum,Dokumententyp,Spartengruppe,Sparte)
     CALL DokSendELO(Typ$,Kunr$,codedok$,Nname$,vname$,Pfad$,erstelnr$,Creator$,creatdat$,DokTyp$,spgru$,spar$,auto%)
 END SUB 


 REM showELOdoc('K', KundenNr, DokumentenNr,leer,leer)
SUB DokShowELO(Typ$,Kunr$,codedok$,par1$,par2$)
   REM CALL Fehler("Jetzt an  an ELO zeigen lassen","")
   le$ = ""
   REM ret% = CALL ("showELOdoc",Typ$,Kunr$,codedok$,par1$,par2$)
   IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN DELETE GMACodeDir$ + "ELOerg.ini"
   a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
   APPACTIVATE "ELO"
   i% = 0
   ret% = - 1
   WHILE ret% = - 1
     IF NOT EXISTS (GMACodeDir$ + "ELOerg.ini") THEN 
       i% = i% + 1
       WAIT FOR 1
       IF i% > 15 THEN 
         CALL Fehler("Anscheinend kann keine Verbindung zu ELO hergestellt werden!","")
         REQUEST "Anscheinend kann keine Verbindung zu ELO hergestellt werden!","Wollen Sie weiter warten?",130,reqw%
         IF reqw% = 1 THEN 
           i% = 0
         ELSE 
           ret% = 1
         END IF 
       END IF 
     ELSE 
       ret% = 1
     END IF 
   WEND 
   IF ret% <> 0 THEN 
     IF EXISTS (GMACodeDir$ + "ELOerg.ini") THEN 
       r0$ = FN ansi("RÅckgabewert0")
       rtxt$ = FN ansi("RÅckgabetext0")
       a$ = ReadDesti$("ELO",r0$,GMACodeDir$ + "ELOerg.ini")
       GELOErg% = VAL (a$)
       b$ = ReadDesti$("ELO",rtxt$,GMACodeDir$ + "ELOerg.ini")
       IF GELOErg% > 0 THEN 
         CALL Fehler("Es wurde ein Fehler bei der ELO-Operation festgestellt:","RÅckgabewert0: " + a$ + "   RÅckgabetext0: " + b$)
       END IF 
     END IF 
   END IF 
   REM CALL Fehler("RÅckgabewert vom Zeigen: " + LTRIM$ ( STR$ (ret%)),"")
 END SUB 

SUB ADRDokShowELO(codedok%,codeku%)
     SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
     SELECT KEY codeku% FILE GADRDat$ INDEX codeku.GADRDat$
     Typ$ = "K"
     Kunr$ = Kundennummer.GADRDat$
     codedok$ = STR$ (CodeDok.GDokDat$,"000000")
     par1$ = ""
     par2$ = ""

     anzblktxt$ = FN ansi("AnzahlDerBlîcke")
     ruecktxt$ = FN ansi("RÅckgabedateiname")
     REM WriteINIDes(topic$,item$,value$,datei$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
     CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Action","showELOdoc",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Art","K",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","KundenNr",Kunr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
     r% = - 1
     CALL DokShowELO(Typ$,Kunr$,codedok$,par1$,par2$)
 END SUB 



SUB MADokSendELO(codedok%,codema%)
     REM 07102003
     GDokDat$ = "DOKMA"
     ansionoff$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))
     SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
     SELECT KEY codema% FILE "MAADR" INDEX codema.MAADR
     Typ$ = "A"
     REM IF ansionoff$ = "ON" THEN 
     AGnr$ = FN ansi(Agenturnr.MAADR)
     codedok$ = STR$ (CodeDok.DOKMA,"000000")
     nname$ = ""
     IF firmaname.maadr <> "" THEN 
       nname$ = FN ansi(firmaname.maadr) + ", " + FN ansi(Nachname.MAADR)
     ELSE 
       nname$ = FN ansi(Nachname.MAADR)
     END IF 
     
     IF vorname.maadr <> "" THEN 
        nname$ = nname$ + ", " + FN ansi(Vorname.MAADR)
     END IF 
     REM vname$ = FN ansi(Vorname.MAADR)
     dokument$ = FN ansi(Dokument.DOKMA)
     pfad$ = LEFT$ (_netpath$,2) + dateiname.DOKMA
     erstelnr$ = STR$ (codema.DOKMA,"000000")
     creator$ = FN ansi(Creator.DOKMA)
     creatdat$ = DATE$ (erstellt_am.DOKMA,"0dmmyyyy")
     DokTyp$ = FN ansi(Gruppe.DOKMA)
     spgru$ = ""
     spar$ = ""
     anzblktxt$ = FN ansi("AnzahlDerBlîcke")
     ruecktxt$ = FN ansi("RÅckgabedateiname")
     REM WriteINIDes(topic$,item$,value$,datei$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
     CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Art","A",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","AgenturNr",AGnr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Agenturname",nname$,GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","VertragsNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Gesellschaftsname","",GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","AgenturNr","",GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","Agenturname","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Spartengruppe","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Sparte","",GMACodeDir$ + "ELOSend.ini")
     REM a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     REM expELOdoc('K', KundenNr, DokumentenNr,Nachname,Vorname,Dokumentenname,Pfad,ErstellerNr,Erstellername,Datum,Dokumententyp,Spartengruppe,Sparte)
     CALL DokSendELO(Typ$,Kunr$,codedok$,Nname$,vname$,Pfad$,erstelnr$,Creator$,creatdat$,DokTyp$,spgru$,spar$,auto%)
 END SUB 
 
SUB GEDokSendELO(codedok%,codege%)
     REM 07102003
     GDokDat$ = "DOKGE"
     ansionoff$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))
     SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
     SELECT KEY codege% FILE "GEADR" INDEX codege.GEADR
     Typ$ = "G"
     REM IF ansionoff$ = "ON" THEN 
     REM AGnr$ = FN ansi(Agenturnr.MAADR)
     codedok$ = STR$ (CodeDok.DOKGE,"000000")
     nname$ = ""
     IF gesellschaft2.geadr <> "" THEN 
       nname$ = FN ansi(gesellschaft.geadr) + ", " + FN ansi(gesellschaft2.geADR)
     ELSE 
       nname$ = FN ansi(gesellschaft.geadr)
     END IF 
     dokument$ = FN ansi(Dokument.DOKGE)
     pfad$ = LEFT$ (_netpath$,2) + dateiname.DOKGE
     erstelnr$ = STR$ (codema.DOKGE,"000000")
     creator$ = FN ansi(Creator.DOKGE)
     creatdat$ = DATE$ (erstellt_am.DOKGE,"0dmmyyyy")
     DokTyp$ = FN ansi(Gruppe.DOKGE)
     spgru$ = ""
     spar$ = ""
     anzblktxt$ = FN ansi("AnzahlDerBlîcke")
     ruecktxt$ = FN ansi("RÅckgabedateiname")
     REM WriteINIDes(topic$,item$,value$,datei$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
     CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Art","G",GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","AgenturNr",AGnr$,GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","Agenturname",nname$,GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","VertragsNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Gesellschaftsname",nname$,GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","AgenturNr","",GMACodeDir$ + "ELOSend.ini")
     REM CALL WriteINIDes("ELO-0","Agenturname","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Spartengruppe","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Sparte","",GMACodeDir$ + "ELOSend.ini")
     REM a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     REM expELOdoc('K', KundenNr, DokumentenNr,Nachname,Vorname,Dokumentenname,Pfad,ErstellerNr,Erstellername,Datum,Dokumententyp,Spartengruppe,Sparte)
     CALL DokSendELO(Typ$,Kunr$,codedok$,Nname$,vname$,Pfad$,erstelnr$,Creator$,creatdat$,DokTyp$,spgru$,spar$,auto%)
 END SUB 
 

SUB KVDokSendELO(codedok%,codevt%,codeku%)
     REM 07102003
     GDokDat$ = "DOKKV"
     ansionoff$ = UCASE$ (ReadINI$("SYSTEM","WinWordAnsi"))
     SELECT KEY codedok% FILE GDokDat$ INDEX codedok.GDokDat$
     SELECT KEY codevt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     codeku% = codeku.kvertrag
     SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
     codege% = codege.kvertrag
     SELECT KEY codege% FILE "GEADR" INDEX codege.geadr
     codema% = codema.kvertrag
     SELECT KEY codema% FILE "MAADR" INDEX codema.maadr
     codegrsp% = codegrsp.kvertrag
     SELECT KEY codegrsp% FILE "SPGRUPPE" INDEX codegrsp.SPGRUPPE
     codeva% = codeva.kvertrag
     SELECT KEY codeva% FILE "Sparten" INDEX codeva.sparten
     Typ$ = "V"
     REM IF ansionoff$ = "ON" THEN 
     IF vs_nr.kvertrag <> "" THEN 
       vsnr$ = vs_nr.kvertrag
     ELSE 
       vsnr$ = AntragsNr.kvertrag
     END IF 
     spgruppe$ = FN ansi(gruppe.spgruppe)
     sparte$ = FN ansi(sparte.sparten)
     AGnr$ = FN ansi(Agenturnr.MAADR)
     Aname$ = ""
     IF firmaname.maadr <> "" THEN 
       Aname$ = FN ansi(firmaname.maadr) + ", " + FN ansi(Nachname.MAADR)
     ELSE 
       Aname$ = FN ansi(Nachname.MAADR)
     END IF 
     
     IF vorname.maadr <> "" THEN 
        Aname$ = Aname$ + ", " + FN ansi(Vorname.MAADR)
     END IF 
     codedok$ = STR$ (CodeDok.DOKKV,"000000")
     gnname$ = ""
     IF gesellschaft2.geadr <> "" THEN 
       gnname$ = FN ansi(gesellschaft.geadr) + ", " + FN ansi(gesellschaft2.geADR)
     ELSE 
       gnname$ = FN ansi(gesellschaft.geadr)
     END IF 
     dokument$ = FN ansi(Dokument.DOKKV)
     pfad$ = LEFT$ (_netpath$,2) + dateiname.DOKKV
     erstelnr$ = STR$ (codema.DOKKV,"000000")
     creator$ = FN ansi(Creator.DOKKV)
     creatdat$ = DATE$ (erstellt_am.DOKKV,"0dmmyyyy")
     DokTyp$ = FN ansi(Gruppe.DOKKV)
     spgru$ = ""
     spar$ = ""
     anzblktxt$ = FN ansi("AnzahlDerBlîcke")
     ruecktxt$ = FN ansi("RÅckgabedateiname")
     REM WriteINIDes(topic$,item$,value$,datei$)
     IF EXISTS (GMACodeDir$ + "ELOSend.ini") THEN DELETE GMACodeDir$ + "ELOSend.ini"
     CALL WriteINIDes("ELO",anzblktxt$,"1",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO",ruecktxt$,GMACodeDir$ + "ELOerg.ini",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Action","expELOdoc",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Art","V",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","KundenNr",Kunr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","nachname",nname$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Vorname",vname$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","DokumentenNr",codedok$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumentenname",dokument$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Dokumententyp",DokTyp$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Pfad",pfad$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerNr",erstelnr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","ErstellerName",creator$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Datum",creatdat$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","VertragsNr",vsnr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","GesellschaftsNr","",GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Gesellschaftsname",Gnname$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","AgenturNr",AGnr$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Agenturname",AName$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Spartengruppe",spgruppe$,GMACodeDir$ + "ELOSend.ini")
     CALL WriteINIDes("ELO-0","Sparte",sparte$,GMACodeDir$ + "ELOSend.ini")
     REM a% = CALL ("ShellExecute",0,"open",_netpath$ + GELOApp$,GMACodeDir$ + "ELOSend.ini","",1)
     REM expELOdoc('K', KundenNr, DokumentenNr,Nachname,Vorname,Dokumentenname,Pfad,ErstellerNr,Erstellername,Datum,Dokumententyp,Spartengruppe,Sparte)
     CALL DokSendELO(Typ$,Kunr$,codedok$,Nname$,vname$,Pfad$,erstelnr$,Creator$,creatdat$,DokTyp$,spgru$,spar$,auto%)
 END SUB 
 


SUB UebEMStamKonf(codema%)
 SELECT FIRST FILE "stamm"
 SELECT KEY codema% LOCK FILE "supervis" INDEX codema.supervis
 IF emailshost.stamm <> "" THEN emailshost.supervis = emailshost.stamm
 IF emailsport.stamm > 0 THEN emailsport.supervis = emailsport.stamm
 IF emailsUserID.stamm <> "" THEN emailsUserID.supervis = emailsUserId.stamm
 IF emailsAFirma.stamm <> "" THEN emailsAFirma.supervis = emailsAFirma.stamm
 
 IF emailphost.stamm <> "" THEN emailphost.supervis = emailphost.stamm
 IF emailpport.stamm > 0 THEN emailpport.supervis = emailpport.stamm
 IF emailPUserID.stamm <> "" THEN emailPUserID.supervis = emailPUserId.stamm
 IF emailPPasww.stamm <> "" THEN emailPPasww.supervis = emailPPasww.stamm
 EMAILPOP3JN.supervis = EMAILPOP3JN.stamm
 CALL QuickStore("supervis")
 FORM 
 END SUB 


SUB EMAILUsTest(codema%)
   REM SendEMAILTest(char *absenderemail,char *HostSMTP, char *UserIDSMTP, char *PortSMTP,
   REM  char * HostPOP3,char * UserIDPOP3,char * PortPOP3,char * PasswortPOP3,char * POPCon)
   REM SELECT FIRST FILE "Supervis" INDEX codema.supervis
   SELECT KEY codema% FILE "Supervis" INDEX codema.supervis
 
   REM SMTP
   Host$ = EMAILSHost.supervis
   UserID$ = EMAILSUserID.supervis
   ANUmmer$ = EMAILNummer.supervis
   port$ = LTRIM$ ( STR$ (EMAILSPort.supervis,"999999"))
   IF port$ = "" THEN port$ = "25"
   REM POP3
   Hpop3$ = ""
   HPPort$ = ""
   PUID$ = ""
   PJN$ = EMAILPOP3JN.supervis
   Ppassw$ = ""
   IF EMAILPOP3JN.supervis = "TRUE" THEN 
     Hpop3$ = EMAILPHost.supervis
     HPPort$ = LTRIM$ ( STR$ (EMAILPPort.supervis,"999999"))
     IF HPPort$ = "" THEN HPPort$ = "110"
     PUID$ = EmailPUserID.supervis
     Ppassw$ = EMAILPPasww.supervis
   END IF 
   ok% = - 1
   fehl$ = ""
   IF EMAILPOP3JN.supervis = "TRUE" THEN 
     IF LTRIM$ (HPOP3$) = "" THEN 
       ok% = 0
       fehl$ = fehl$ + "POP3 Host muss ausgefÅllt werden" + CHR$ (13) + CHR$ (10)
     END IF 
     IF LTRIM$ (PUID$) = "" THEN 
       ok% = 0
       fehl$ = fehl$ + "POP3 UserID muss ausgefÅllt werden" + CHR$ (13) + CHR$ (10)
     END IF 
     IF LTRIM$ (ANummer$) = "" THEN 
       ok% = 0
       fehl$ = fehl$ + "eigene EMAIL-Adresse muss fÅr POP3 ausgefÅllt werden" + CHR$ (13) + CHR$ (10)
     END IF 
   END IF 
   IF LTRIM$ (Host$) = "" THEN 
     ok% = 0
     fehl$ = fehl$ + "SMTP Host muss ausgefÅllt werden" + CHR$ (13) + CHR$ (10)
   END IF 
   IF LTRIM$ (UserID$) = "" THEN 
     ok% = 0
     fehl$ = fehl$ + "SMTP UserID muss ausgefÅllt werden" + CHR$ (13) + CHR$ (10)
   END IF 
   IF LTRIM$ (Host$) = "" THEN 
     ok% = 0
     fehl$ = fehl$ + "SMTP Host muss ausgefÅllt werden" + CHR$ (13) + CHR$ (10)
   END IF 
   IF ok% THEN 
     MOUSE OFF 
     REM ret% = CALL ("_SendEMAILTest",ANummer$,Host$,UserID$,port$,Hpop3$,PUID$,HPPort$,Ppassw$,PJN$)
     Gbodytxt$ = _netpath$ + STR$ (GMACodema%,"000000") + ".txt"
     IF EXISTS (Gbodytxt$) THEN DELETE Gbodytxt$
     X%% = MK_Init%%()
     X%% = MK_SendServer%%(Host$,port$,UserID$,Ppassw$,SendServer$)
     REM Absender
     X%% = MK_SendFrom%%(ANUmmer$,SendFrom$)
     REM antworten an
     X%% = MK_SendReply%%(ANUmmer$,SendReply$)
     REM 0=klein,1=gro·
     X%% = MK_Priority%%(1,Priority$)
     X%% = MK_SendTo%%(ANUmmer$,SendTo$)
     X%% = MK_XHeader%%("xxPower mailer",SendHeader$)
     REM X%% = MK_SendCC%%("technik@mis-software.de,service@mis-software.de",SendCC$)
     REM X%% = MK_SendBCC%%("ab@codie.com,send@codie.com",SendBCC$)
     X%% = MK_Subject%%("Test Email von CODie software products e.K.",SendSubject$)
     CALL MK_WriteBody0()' Text in Htmlformat . You must change the parameter to MK_Html%%(1,Html$)
     CALL MK_WriteBodyN("")
     CALL MK_WriteBodyN("")
     CALL MK_WriteBodyN(EMAILText1.supervis)
     CALL MK_WriteBodyN("")
     CALL MK_WriteBodyN("")
 
     CALL MK_WriteBodyN(EMAILText2.supervis)
 
     'CALL MK_WriteBody2()' Text NOT in Htmlformat . You must change the parameter to MK_Html%%(0,Html$)
     'X%% = MK_Attach%%( DIRECTORY + "\attach\email.pdf",AttachString$)
     'X%% = MK_Attach%%( DIRECTORY + "\attach\email_abc.pdf",AttachString$)
     X%% = MK_LogFile%%(GMACodeDir$ + "emailsend.log",LogDateiName$)
     X%% = MK_Html%%(0,Html$)
     MOUSE OFF 
     X%% = MK_SendGo%%(RetVal%%,RetVal$,SendHeader$,SendTo$,SendFrom$,SendReply$,Priority$,SendCC$,SendBCC$,SendSubject$,LogDateiName$,SendServer$,AttachString$,Html$)
     MOUSE ON 
     X%% = MK_InitReset%%()
 
     CALL Fehler(RetVal$,"")
     a% = CALL ("ShellExecute",0,"open",GMACodeDir$ + "emailsend.log","","",1)
     MOUSE ON 
     IF retval%% = 0 THEN CALL Fehler ("Es wurde eine Testemail an die Adresse " + ANummer$ + " gesendet!","Bitte prÅfen Sie, ob diese email angekommen ist!")
   ELSE 
     CALL Fehler(fehl$,"")
   END IF 
 END SUB 
 
 


SUB EMAILAbfrage(kw$)
 REM ***************************EMAIL-Abfrage*********************************
   optemail% = 1
   IF GEMAIL% = - 1 THEN 
     DIM dlg1 AS Dialog
     DIM control AS DialogControl 

     Superbase.Dialogs.Add("Dialogname")
     SET dlg1 = Superbase.Dialogs.Dialogname
     dlg1.Move(0,0,150,73)
     dlg1.Caption = "Art des Serienbriefes"
     dlg1.FontName = "MS Sans Serif"
     dlg1.FontSize = 8
 
     SET control = dlg1.Add("DialogFrame1","DialogFrame")
     control.Move(2,8,150,44)
     control.Caption = " WÑhlen Sie eine Option "
 
     SET control = dlg1.Add("DialogOptionButton1","DialogOptionButton")
     control.Move(6,20,114,10)
     control.Caption = "Serien-BRIEF"
     control.Bind("optemail%")
     control.ValueOn = 1
 
     SET control = dlg1.Add("DialogOptionButton2","DialogOptionButton")
     control.Move(6,32,114,9)
     control.Caption = "Serien-EMAIL"
     control.Bind("optemail%")
     control.ValueOn = 2
 
 
 
     SET control = dlg1.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(39,54,43,16)
     control.Default = 1
     control.Caption = "OK"
     control.ReturnValue = 1
 
     SET control = dlg1.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(85,54,42,16)
     control.Caption = "Abbruch"
     control.ReturnValue = 0
 
     DIALOG "Dialogname",reqemail%
     REMOVE DIALOG "Dialogname"
   END IF 
   GEMAILSer% = 0
   IF reqemail% = 0 THEN END SUB 
   IF optemail% = 2 THEN 
     GEMAILSer% = - 1
   ELSE 
     GEMAILSer% = 0
   END IF 
   IF GEMAILSer% = - 1 THEN 
     REDIM GBCC$(10000,1)
     DIM AutoKArt2$(20)
     i% = 0
     j% = 1
     AutoKArt2$(0) = "<kein Filter>"
     WHILE GAutoKArt2$(i%) <> ""
       AutoKArt2$(j%) = GAutoKArt2$(i%)
       i% = i% + 1
       j% = j% + 1
     WEND 
     kw$ = ""
     prompt$ = AutoKArt2$(0)
     CREATE DIALOG "KEYWORD",0,0,100,130,"EMAIL-Filter","MS Sans Serif",8
     ADD DIALOG "KEYWORD",4,0,1,100,110,0,""
     ADD DIALOG "KEYWORD",5,1,14,100,19,0,"Bitte wÑhlen Sie ein Merkmal als EMAIL-Filter aus:"
     ADD DIALOG "KEYWORD",7,5,38,80,70,0,2,AutoKArt2$,Auswahl$,prompt$
     ADD DIALOG "KEYWORD",1,20,113,55,15,1,"&OK",1,1
     DIALOG "KEYWORD",req%
     REMOVE DIALOG "KEYWORD"
     IF req% <> 0 THEN 
       IF kw$ = "" THEN 
         GEMAILRAUS$ = UCASE$ (Auswahl$(0))
       END IF 
     END IF 
   END IF 
 REM **************************************************************************** 
 END SUB 



SUB TerArtSpez()
     optemail% = 1
     DIM dlg1 AS Dialog
     DIM control AS DialogControl 
 
     Superbase.Dialogs.Add("Dialogname")
     SET dlg1 = Superbase.Dialogs.Dialogname
     dlg1.Move(0,0,150,73)
     dlg1.Caption = "Art der TerminÅbersicht"
     dlg1.FontName = "MS Sans Serif"
     dlg1.FontSize = 8
 
     SET control = dlg1.Add("DialogFrame1","DialogFrame")
     control.Move(2,8,147,44)
     control.Caption = " WÑhlen Sie eine Option "
 
     SET control = dlg1.Add("DialogOptionButton1","DialogOptionButton")
     control.Move(6,20,114,10)
     control.Caption = "nichterledigte"
     control.Bind("optemail%")
     control.ValueOn = 1
 
     SET control = dlg1.Add("DialogOptionButton2","DialogOptionButton")
     control.Move(6,32,114,9)
     control.Caption = "ALLE"
     control.Bind("optemail%")
     control.ValueOn = 2
 
 
 
     SET control = dlg1.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(39,54,43,16)
     control.Default = 1
     control.Caption = "OK"
     control.ReturnValue = 1
 
     SET control = dlg1.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(85,54,42,16)
     control.Caption = "Abbruch"
     control.ReturnValue = 0
 
     DIALOG "Dialogname",reqemail%
     REMOVE DIALOG "Dialogname"
   END IF 
   GEMAILSer% = 0
   IF reqemail% = 0 THEN GTERArtSpez% = 0
   IF optemail% = 2 THEN 
     GTERArtSpez% = 0
   ELSE 
     GTERArtSpez% = - 1
   END IF 
 END SUB 
 




 '***********************************************************************************
 'alle Termine eines Kunden in öbersichtsmaske anzeigen
 '***********************************************************************************
 
SUB KunTer1()
 MOUSE OFF 
 IF ( MOD ("akquise") OR NEW ("akquise")) THEN CALL QuickStore("akquise")
 knr% = codeku.akquise
 SELECT FIRST FILE "Adressen" INDEX codeku.adressen
 SELECT KEY knr% FILE "Adressen" INDEX codeku.adressen
 FILE "akquise"
 INDEX codeku.akquise
 
 
 _formend% = 0
 MOUSE ON 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "AKQ1PRJ" THEN 
     SET HEADING title$ + " - Termine"
     OPEN FORM GOFFFORM$ + "AKQ1PRJ"
     SET f = Superbase.Form
     CALL KunTer1Intro()
     CALL MNKunTer1()
     SET STATUS "TERMINE"
   END IF 
   MENU ON 
   MOUSE ON 
   FORMsub% = 0
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   IF FORMsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     REM CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     REM CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE FORMsub%
   CASE 1
     codeaq% = Codeaq.akquise
     SELECT KEY codeaq% FILE "AKQUISE" INDEX codeaq.akquise
     FORM 2
   CASE 2
   CASE 3
   CASE 99
     ENTER Datum.akquise,0
     REM ENTER END 
   REM MENU OFF 
   END SELECT 
   MENU ON 
 WEND 
 IF ( MOD ("AKQUISE") OR NEW ("AKQUISE")) THEN CALL FStore("AKQUISE")
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
  
 
SUB KunTer1Intro()
 MOUSE OFF 
 FILE "AKQUISE"
 INDEX CodeKU.AKQUISE
   SELECT FORM KEY knr% FILE "Adressen" INDEX CodeKU.Adressen
   SELECT FORM KEY knr% FILE "AKQUISE" INDEX CodeKU.AKQUISE
 SELECT FIRST 
 FORM 
 END SUB 
 
SUB MNKunTer1()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 




 
 '      ******************************************
 '      ** Routinen fÅr Kundenkonto **
 '      ******************************************
 
 
SUB KuKto()
 IF disabled%("KUKTO") THEN END SUB 
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 cuvt% = lfdnr.KVERTRAG
 FILE "KUKTO"
 SELECT KEY cuvt% INDEX CodeVT.KUKTO
 _continue% = 1
 IF NOT FOUND ("KUKTO") THEN 
   _continue% = 0
   REQUEST "Es wurden noch keine Kontoinformationen fÅr diesen Vertrag erfa·t!","Erfassung fortsetzen?",130,req%
   IF req% = 1 THEN 
     _continue% = 1
   END IF 
 END IF 
 IF _continue% = 1 THEN 
   _formend% = 0
   WHILE _formend% = 0
     ON ERROR GOTO ErrorHandler
     FORMsub% = 0
     IF UCASE$ ( FORM ) <> "KUKTO" THEN 
       OPEN FORM GPrjForm$ + "KUKTO"
       REM SET HEADING title$ + " - Nachbearbeitung"
       IF anrede.GAdrDat$ LIKE "Her*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
         kukn$ = LEFT$ (( LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Vorname.GAdrDat$)),60)
         SET HEADING "Kontoinformation von: " + kukn$
       ELSE 
         kukn$ = LEFT$ (( LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Geburtsname.GAdrDat$)),60)
         n% = LEN (kukn$)
         REM CALL Fehler( STR$ (n%,"999"),"")
         SET HEADING "Kontoinformation von: " + n$
       END IF 
       
       SET f = Superbase.Form
       CALL KuKtoIntro()
       IF _formend% = 1 THEN GOTO KuKto071099
       CALL MNKuKto()
       MENU ON 
       SET STATUS "Kontoinformation"
     END IF 
     FORM 
     MOUSE ON 
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     CALL ClearKBDBuffer()
     IF FORMsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
     GET k$
     IF k$ = CHR$ (27) THEN _formend% = 1
     Codekuko% = Codekuko.kukto
     SELECT CASE FORMsub%
     CASE 1
       CALL CreateRech(Codekuko%)
       FORM 
     CASE 2
       CALL CreateMahn(Codekuko%)
       FORM 
     CASE 3
       CALL KuKtoDruck()
     CASE 5
       codekuko% = codekuko.KuKto
       cuvt% = lfdnr.kvertrag
       FORM 2
       SELECT FORM KEY codekuko% FILE "KuKto" INDEX codekuko.KuKto
       FORM 
     CASE 6
       
       FORM 1
       SELECT FORM KEY cuvt% FILE "KUKTO" INDEX codevt.KUKTO
       FORM 
     CASE 99
       MENU OFF 
       REM CALL ButDesabled()
       f.neu.enabled = 0
       f.bearb.enabled = 0
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       REM 140697 f.druck.enabled = 0
       codekuko% = codekuko.KuKto
       ENTER FÑlligkeit.KuKto,0
       REM CALL ButEnabled()
       f.neu.enabled = - 1
       f.bearb.enabled = - 1
       f.abbruch.enabled = 0
       f.abbruch.visible = 0
       REM 140697 f.druck.enabled = - 1
       IF abbruch% = - 1 THEN 
         SELECT KEY codekuko% FILE "KuKto" INDEX codekuko.KuKto
         FORM 
         abbruch% = 0
       END IF 
       MENU ON 
     CASE 100
       REM Lîschen der Kontoinfo
       REQUEST "Wollen Sie diese Kontobuchung wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         codekuko% = codekuko.kukto
         cuvt% = codevt.kukto
         MOUSE OFF 
         REMOVE FROM FILE "kukto" WHERE codekuko.kukto = codekuko%
         REQUEST "Datensatz wurde gelîscht!"
         IF EXISTS (cuvt%,codevt.kukto) THEN 
           FORM 1
           SELECT FORM KEY cuvt% FILE "KUKTO" INDEX codevt.KUKTO
           FORM 
         ELSE 
           _formend% = 1
         END IF 
         MOUSE ON 
       END IF 
     END SELECT 
     FORMsub% = 0
KuKto071099: 
   WEND 
 END IF 
 _formend% = 0
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 cuvg% = 0
 vform% = - 1
 FILE "KVERTRAG"
 END SUB 
 
SUB KuKtoLoe()
 IF disabled%("KuKto") THEN END SUB 
       REQUEST "Wollen Sie diese Kontobuchung wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         codekuko% = codekuko.kukto
         cuvt% = codevt.kukto
         knr% = codeku.kukto
         MOUSE OFF 
         REMOVE FROM FILE "kukto" WHERE codekuko.kukto = codekuko%
         REQUEST "Datensatz wurde gelîscht!"
         IF EXISTS (knr%,codeku.KUKTO) THEN 
           FILE "KUKTO"
           FORM 2
           SELECT FORM KEY knr% FILE "KUKTO" INDEX codeku.KUKTO
         ELSE 
           _formend% = 1
         END IF 
         MOUSE ON 
       END IF 
 END SUB 
 
SUB KuKtoKU(codekuko%)
 IF disabled%("KuKto") THEN END SUB 
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"KuKto" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 cuvt% = lfdnr.KVERTRAG
 FILE "KuKto"
 SET INDEX quickcodeKU.KuKto
 INDEX quickcodeKU.KuKto
 SELECT KEY codekuko% INDEX Codekuko.KuKto
 _continue% = 1
 IF NOT FOUND ("KuKto") THEN 
   _continue% = 0
   REQUEST "Es wurden noch keine Kontoinformationen fÅr diesen Vertrag erfa·t!","Erfassung fortsetzen?",130,req%
   IF req% = 1 THEN 
     _continue% = 1
   END IF 
 END IF 
 IF _continue% = 1 THEN 
   _formend% = 0
   WHILE _formend% = 0
     ON ERROR GOTO ErrorHandler
     FORMsub% = 0
     IF UCASE$ ( FORM ) <> "KuKto" THEN 
       SET HEADING title$ + " - Kontoinformation"
       OPEN FORM GPrjForm$ + "KuKto"
       SET f = Superbase.Form
       SELECT FORM KEY codekuko% FILE "KuKto" INDEX codekuko.KuKto
       REM CALL VorgangIntro()
       CALL MNKuKto()
       MENU ON 
       SET STATUS "Kontoinformation"
     END IF 
     FORM 
     MOUSE ON 
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     CALL ClearKBDBuffer()
     IF FORMsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
     GET k$
     IF k$ = CHR$ (27) THEN _formend% = 1
     SELECT CASE FORMsub%
     CASE 1
 
     CASE 2
 
     CASE 3
 
     CASE 4
       knr% = Codeku.KuKto
       CALL KuKto1Druck()
     CASE 99
       MENU OFF 
       REM CALL ButDesabled()
       f.neu.enabled = 0
       f.bearb.enabled = 0
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       REM f.druck.enabled = 0
       codekuko% = codekuko.KuKto
       ENTER FÑlligkeit.KUKTO,0
       REM CALL ButEnabled()
       f.neu.enabled = - 1
       f.bearb.enabled = - 1
       f.abbruch.enabled = 0
       f.abbruch.visible = 0
       REM f.druck.enabled = - 1
       IF abbruch% = - 1 THEN 
         SELECT KEY codekuko% FILE "KuKto" INDEX codekuko.KuKto
         FORM 
         abbruch% = 0
       END IF 
       MENU ON 
     END SELECT 
     FORMsub% = 0
   WEND 
 END IF 
 _formend% = 0
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 cuvg% = 0
 vform% = - 1
 FILE "KVERTRAG"
 END SUB 
 
 
  
 
 
 
 
 ' KuKto Intro
 ' =======================================================================
 
SUB KuKtoIntro()
 FILE "KuKto"
 INDEX CodeVT.KuKto
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 REM SELECT FORM KEY cuvt% FILE "VORGANG" INDEX CodeVT
 IF NOT EXISTS (cuvt%,codevt.KuKto) THEN 
   CALL KuKtoNeu()
   END IF 
 END IF 
 SELECT FORM KEY cuvt% FILE "KuKto" INDEX CodeVT.KuKto
 FORM 
 END SUB 
 
 
 ' KuKto Neu
 ' =======================================================================
 
SUB KuKtoNeu()
 SELECT KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
 REM IF NEW ("VORGANG") OR MOD ("VORGANG") THEN CALL FStore("VORGANG")
 IF CodeVA.kvertrag < 1 OR CodeMA.kvertrag < 1 OR CodeGE.kvertrag < 1 OR inkart.kvertrag <> 1 THEN 
   CALL Fehler("Sie mÅssen fÅr den Vertrag eine Gesellschaft, eine Sparte, einen Mitarbeiter","und Vermittlerinkasso eingetragen haben, um Kontoinformationen erfassen zu kînnen!!!")
   _formend% = 1
 ELSE 
   BLANK FILE "KUKTO"
   SET STATUS "Datensatz neu angelegt..."
   FÑlligkeit.KuKto = TODAY 
   Codekuko.KuKto = SER ("KuKto",1)
   zero.kukto = 0
   CodeVT.KuKto = cuvt%
   Codeva.KuKto = Codeva.kvertrag
   CodeVP.Kukto = codevp.kvertrag
   verrechnet.kukto = "n"
   gesellschaft.KuKto = Gesellschaft.kvertrag
   sparte.KuKto = sparte.kvertrag
   CodeMA.KuKto = CodeMA.KVERTRAG
   CodeKU.KuKto = CodeKU.kvertrag
   codege.kukto = codege.kvertrag
   VS_NR.kukto = VS_NR.kvertrag
   Beitrag.kukto = Beitrag.kvertrag
   REM gezBetrag.kukto = Beitrag.kvertrag
   K1Bank.kukto = K1Bank.Kvertrag
   K1Konto.Kukto = K1Konto.kvertrag
   K1BLZ.Kukto = K1Blz.kvertrag
   manuell.kukto = "j"
   gedruckt.kukto = "n"
   mahnung.kukto = "n"
   anrede.kukto = anrede.GAdrDat$
   titel.kukto = titel.GAdrDat$
   nachname.kukto = nachname.GAdrDat$
   vorname.kukto = vorname.GAdrDat$
   geburtsname.kukto = geburtsname.GAdrDat$
   Stra·e.kukto = stra·e.GAdrDat$
   ort.kukto = ort.GAdrDat$
   plz.kukto = plz.GAdrDat$
   
   dtaus.kukto = "n"
   zweise$ = ZW2Str$(ZW.KVERTRAG)
   ZW.kukto = zweise$
   zart$ = Zahlart2Str$(Zahlart.KVERTRAG)
   Zahlart.kukto = zart$
   wannerstellt.kukto = TODAY 
   codew.kukto = codew.kvertrag
   umrechnung.kukto = umrechnung.kvertrag
   waehrung.kukto = waehrung.kvertrag
   Beitrag.kukto = Beitrag.kvertrag
   IF inkart.kvertrag = 1 THEN 
     Inkart.kukto = "Vermittlerinkasso"
   END IF 
   IF inkart.kvertrag = 2 THEN 
     Inkart.kukto = "Zentralinkasso"
   END IF 
   IF zart$ LIKE "Bankeinzug" AND inkart.kvertrag = 1 AND TRIM$ (k1Konto.kvertrag) <> "" AND TRIM$ (k1blz.kvertrag) <> "" THEN 
     IF manuell.kukto = "j" THEN 
       IF KuktoerlJN.stamm = "j" THEN 
         erledigtJaNein.kukto = "j"
         gezahltam.kukto = TODAY 
       ELSE 
         erledigtJaNein.kukto = "n"
       END IF 
     ELSE 
       erledigtJaNein.kukto = "j"
       gezahltam.kukto = TODAY 
     END IF 
   ELSE 
     erledigtJaNein.kukto = "n"
   END IF 
   HauptfÑlligkeit.kukto = STR$ (HauptfÑlligkeit.kvertrag,"00")
   CALL QuickStore("KuKto")
   SELECT FORM KEY cuvt% FILE "KUKTO" INDEX codevt.kukto
 FORM 
 END IF 
 END SUB 
 
 
 
 ' KuKto Neu1
 ' =======================================================================
 
SUB KuKtoNeu1()
 viab% = 1
 cfile$ = FILE 
 indab$ = INDEX 
 cuvt% = lfdnr.KVERTRAG
 akver1% = 1
 CREATE DIALOG "vsuch",0,0,175,166,title$,"MS Sans Serif",8
 ADD DIALOG "vsuch",9,6,6,24,22,2
 ADD DIALOG "vsuch",5,34,6,132,10,0,"Vertrag suchen"
 ADD DIALOG "vsuch",4,34,14,132,5,0,""
 ADD DIALOG "vsuch",5,34,22,132,26,0,"Bitte geben Sie an, Åber welche Infor- mation Sie den Vertrag suchen mîchten"
 REM ADD DIALOG "vsuch",3,34,49,154,10,0,"alle VertrÑge anzeigen",0,akVer1%
 ADD DIALOG "vsuch",5,34,45,175,26,0,"Standardsuche (schnell):"
 ADD DIALOG "vsuch",5,34,71,175,26,0,"erweiterte Suche (langsamer):"
 ADD DIALOG "vsuch",6,34,121,132,12,0,0,suna$,20
 ADD DIALOG "vsuch",3,41,57,148,10,0,"Vertrags&nummer",1,akVer1%
 ADD DIALOG "vsuch",3,41,83,132,10,0,"KFZ-&Kennzeichen",2,akVer1%
 ADD DIALOG "vsuch",3,41,95,132,10,0,"KFZ-&Typ",3,akVer1%
 ADD DIALOG "vsuch",5,34,111,175,10,0,"&Suchbegriff:"
 REM ADD DIALOG "vsuch",4,26,102,190,38,0,"Bitte den Suchbegriff eingeben"
 ADD DIALOG "vsuch",1,28,145,55,14,1,"&Weiter",1,1
 ADD DIALOG "vsuch",1,87,145,55,14,0,"&Abbruch",0,0
 DIALOG "vsuch",req%
 REMOVE DIALOG "vsuch"
 Eingabe$ = suna$
 IF req% = 1 THEN 
   IF akver1% = 0 THEN 
     a% = VERTRSuch%(CodeKU.KVERTRAG,cuvt%)
     IF a% <> 0 THEN cuvt% = a%
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   END IF 
   IF akver1% = 1 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GetVertrag%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde keine Vertragsnummer eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 2 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZKe%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein Kennzeichen eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 3 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZTyp%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein KFZ-Typ eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 ELSE 
   GOTO kuktoneu1end
 END IF 
 
 IF nvt% = 0 THEN GOTO kuktoneu1end
 
 
 
 
 SELECT KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
 SELECT KEY codeku.kvertrag FILE GAdrDat$ INDEX codeku.GAdrDat$
 REM IF NEW ("VORGANG") OR MOD ("VORGANG") THEN CALL FStore("VORGANG")
 IF CodeVA.kvertrag < 1 OR CodeMA.kvertrag < 1 OR CodeGE.kvertrag < 1 OR inkart.kvertrag <> 1 THEN 
   CALL Fehler("Sie mÅssen fÅr den Vertrag eine Gesellschaft, eine Sparte, einen Mitarbeiter","und Vermittlerinkasso eingetragen haben, um Kontoinformationen erfassen zu kînnen!!!")
   GOTO kuktoneu1end
 ELSE 
   BLANK FILE "KUKTO"
   SET STATUS "Datensatz neu angelegt..."
   FÑlligkeit.KuKto = TODAY 
   Codekuko.KuKto = SER ("KuKto",1)
   zero.kukto = 0
   CodeVT.KuKto = cuvt%
   Codeva.KuKto = Codeva.kvertrag
   gesellschaft.KuKto = Gesellschaft.kvertrag
   sparte.KuKto = sparte.kvertrag
   CodeMA.KuKto = CodeMA.KVERTRAG
   CodeKU.KuKto = CodeKU.kvertrag
   codege.kukto = codege.kvertrag
   VS_NR.kukto = VS_NR.kvertrag
   Beitrag.kukto = Beitrag.kvertrag
   gezBetrag.kukto = Beitrag.kvertrag
   K1Bank.kukto = K1Bank.Kvertrag
   K1Konto.Kukto = K1Konto.kvertrag
   K1BLZ.Kukto = K1Blz.kvertrag
   manuell.kukto = "j"
   gedruckt.kukto = "n"
   mahnung.kukto = "n"
   anrede.kukto = anrede.GAdrDat$
   titel.kukto = titel.GAdrDat$
   nachname.kukto = nachname.GAdrDat$
   vorname.kukto = vorname.GAdrDat$
   geburtsname.kukto = geburtsname.GAdrDat$
   Stra·e.kukto = stra·e.GAdrDat$
   ort.kukto = ort.GAdrDat$
   plz.kukto = plz.GAdrDat$
   
   dtaus.kukto = "n"
   zweise$ = ZW2Str$(ZW.KVERTRAG)
   ZW.kukto = zweise$
   zart$ = Zahlart2Str$(Zahlart.KVERTRAG)
   Zahlart.kukto = zart$
   wannerstellt.kukto = TODAY 
   Beitrag.kukto = Beitrag.kvertrag
   IF inkart.kvertrag = 1 THEN 
     Inkart.kukto = "Vermittlerinkasso"
   END IF 
   IF inkart.kvertrag = 2 THEN 
     Inkart.kukto = "Zentralinkasso"
   END IF 
   IF zart$ LIKE "Bankeinzug" AND inkart.kvertrag = 1 THEN 
     erledigtJaNein.kukto = "j"
     gezahltam.kukto = TODAY 
   ELSE 
     erledigtJaNein.kukto = "n"
   END IF 
   HauptfÑlligkeit.kukto = STR$ (HauptfÑlligkeit.kvertrag,"00")
   CALL QuickStore("KuKto")
   SELECT FORM KEY cuvt% FILE "KUKTO" INDEX codevt.kukto
 FORM 2
 END IF 
kuktoneu1end: 
 END SUB 
 
 
 
 
 
SUB MNKuKto()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
 
SUB KuKtoDruck()
 MOUSE OFF 
 cfile$ = FILE 
 cvnr% = CodeVT.KuKto
 cvg% = CodeKuKo.KuKto
 cfile$ = FILE 
 FILE "kukto"
 SELECT WHERE FILE "kukto"
 opt% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 IF opt% = 0 THEN opt% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 opt% = 3
SuDruKuktoBeg2: 
 CREATE DIALOG "ZEINSUCH",0,0,228,164,"ZahlungseingÑnge","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, welche InkassosÑtze Sie drucken mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des Inkassodatums einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,64,76,10,0,"Sortierung nach..."
 ADD DIALOG "ZEINSUCH",3,38,92,60,12,0,"FÑlligkeit",3,opt%
 
 ADD DIALOG "ZEINSUCH",2,150,62,41,11,0,"manuell?","j","n",manuell$
 ADD DIALOG "ZEINSUCH",2,150,72,67,11,0,"DTAUS erstellt?","j","n",dtaus$
 ADD DIALOG "ZEINSUCH",2,150,82,41,11,0,"erledigt?","j","n",erledigt$
 ADD DIALOG "ZEINSUCH",2,150,92,75,11,0,"Rechnung erstelllt?","j","n",gedruckt$
 ADD DIALOG "ZEINSUCH",2,150,102,75,11,0,"Mahnung erstelllt?","j","n",mahnung$
 
 ADD DIALOG "ZEINSUCH",5,38,112,96,9,0,"Inkassozeitraum (Pflicht):"
 ADD DIALOG "ZEINSUCH",5,58,125,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,124,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,125,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,124,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   beding$ = " FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$)"
   IF manuell$ = "j" THEN beding$ = beding$ + " AND manuell.kukto = manuell$"
   IF dtaus$ = "j" THEN beding$ = beding$ + " AND dtaus.kukto = dtaus$"
   IF erledigt$ = "j" THEN beding$ = beding$ + " AND erledigtjanein.kukto = erledigt$"
   IF gedruckt$ = "j" THEN beding$ = beding$ + " AND gedruckt.kukto = gedruckt$"
   IF mahnung$ = "j" THEN beding$ = beding$ + " AND mahnung.kukto = mahnung$"
   beding$ = beding$ + " "
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   REM filt$ = "Select where codekuko>0 and erledigtJaNein=" + CHR$ (34) + erledigt$ + CHR$ (34) + " and dtaus=" + CHR$ (34) + dtaus$ + CHR$ (34) + " and manuell=" + CHR$ (34) + manuell$ + CHR$ (34)
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto>=" + CHR$ (34) + von$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  von  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg2
     END IF 
   ELSE 
     von$ = "01.01.1990"
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto<=" + CHR$ (34) + bis$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  bis  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg2
     END IF 
   ELSE 
     bis$ = "30.12.2990"
   END IF 
 ELSE 
   GOTO ErrKuktoDruck:
 END IF 
 CALL PRep("KKUKTO")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeKuKO.KUKTO
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 
 ON ERROR GOTO ErrKuktoDruck
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SET FIRST PAGE HEADING OFF 
   IF EXISTS ("VREPORT.SBP") THEN DELETE "VREPORT.SBP"
   IF PROGRAMFILE ("VREPORT") THEN CLOSE PROGRAMFILE "VREPORT"
   OPEN "VREPORT.SBP" FOR OUTPUT 
   ? " SUB VReport(cvnr%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)"
   ? " SELECT ;"
   ? " WHERE CodeKU.GAdrDat$ = CodeKU.Kukto AND CodeVT.Kukto = lfdNr.KVERTRAG AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND codevt.kukto = cvnr% AND "
   ? " " + beding$
   ? " ORDER REPORT FÑlligkeit.KuKto"
   ? " TO ASK"
   ? " END SUB"
   CLOSE OUTPUT 
   LOAD "VREPORT.SBP", NEW 
   CALL VReport(cvnr%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)
   CLOSE PROGRAMFILE "VREPORT"
ErrKuktoDruck: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 FILE cfile$
 SELECT FORM KEY cvg% FILE "Kukto" INDEX Codekuko.Kukto
 MOUSE ON 
 END SUB 
 
 
SUB KuKtoDruckALL()
 MOUSE OFF 
 cfile$ = FILE 
 cvnr% = CodeVT.Kukto
 cvg% = CodeKuko.Kukto
 codeku% = codeku.GAdrDat$
 cfile$ = FILE 
 
 
 
 FILE "kukto"
 SELECT WHERE FILE "kukto"
 opt% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 IF opt% = 0 THEN opt% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
SuDruKuktoBeg1: 
 CREATE DIALOG "ZEINSUCH",0,0,228,164,"ZahlungseingÑnge","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, welche InkassosÑtze Sie drucken mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des Inkassodatums einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,64,76,10,0,"Sortierung nach..."
 ADD DIALOG "ZEINSUCH",3,38,72,95,12,0,"Vertrags-/Policennummer",1,opt%
 ADD DIALOG "ZEINSUCH",3,38,82,95,12,0,"Gesellschaft",2,opt%
 ADD DIALOG "ZEINSUCH",3,38,92,60,12,0,"FÑlligkeit",3,opt%
 
 ADD DIALOG "ZEINSUCH",2,150,62,41,11,0,"manuell?","j","n",manuell$
 ADD DIALOG "ZEINSUCH",2,150,72,67,11,0,"DTAUS erstellt?","j","n",dtaus$
 ADD DIALOG "ZEINSUCH",2,150,82,41,11,0,"erledigt?","j","n",erledigt$
 ADD DIALOG "ZEINSUCH",2,150,92,75,11,0,"Rechnung erstelllt?","j","n",gedruckt$
 ADD DIALOG "ZEINSUCH",2,150,102,75,11,0,"Mahnung erstelllt?","j","n",mahnung$
 
 ADD DIALOG "ZEINSUCH",5,38,112,96,9,0,"Inkassozeitraum (Pflicht):"
 ADD DIALOG "ZEINSUCH",5,58,125,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,124,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,125,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,124,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   beding$ = " FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$)"
   IF manuell$ = "j" THEN beding$ = beding$ + " AND manuell.kukto = manuell$"
   IF dtaus$ = "j" THEN beding$ = beding$ + " AND dtaus.kukto = dtaus$"
   IF erledigt$ = "j" THEN beding$ = beding$ + " AND erledigtjanein.kukto = erledigt$"
   IF gedruckt$ = "j" THEN beding$ = beding$ + " AND gedruckt.kukto = gedruckt$"
   IF mahnung$ = "j" THEN beding$ = beding$ + " AND mahnung.kukto = mahnung$"
   beding$ = beding$ + " "
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   REM filt$ = "Select where codekuko>0 and erledigtJaNein=" + CHR$ (34) + erledigt$ + CHR$ (34) + " and dtaus=" + CHR$ (34) + dtaus$ + CHR$ (34) + " and manuell=" + CHR$ (34) + manuell$ + CHR$ (34)
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto>=" + CHR$ (34) + von$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  von  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg1
     END IF 
   ELSE 
     von$ = "01.01.1990"
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto<=" + CHR$ (34) + bis$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  bis  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg1
     END IF 
   ELSE 
     bis$ = "30.12.2990"
   END IF 
 ELSE 
   GOTO ErrKuktoDruck1:
 END IF 
 CALL PRep("KKUKTO1")
 
 
 
 
 
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeKuKO.KUKTO
 AFTER GROUP CodeKuKO.KUKTO
     SET REPORT PAGE "F_CodeKuKO.K002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO ErrKuktoDruck1
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SET FIRST PAGE HEADING OFF 
 IF opt% = 1 THEN 
   IF EXISTS ("VREPORT.SBP") THEN DELETE "VREPORT.SBP"
   IF PROGRAMFILE ("VREPORT") THEN CLOSE PROGRAMFILE "VREPORT"
   OPEN "VREPORT.SBP" FOR OUTPUT 
   ? " SUB VReport(codeku%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)"
   ? " SELECT ;"
   ? " WHERE CodeKU.GAdrDat$ = CodeKU.KuKto AND CodeVT.KuKto = lfdNr.KVERTRAG AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeKU.KuKto = codeku% AND "
   ? " " + beding$
   ? " ORDER REPORT VS_NR.KuKto"
   ? " TO ASK"
   ? " END SUB"
   CLOSE OUTPUT 
   LOAD "VREPORT.SBP", NEW 
   CALL VReport(codeku%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)
   CLOSE PROGRAMFILE "VREPORT"
 END IF 
 IF opt% = 2 THEN 
   IF EXISTS ("VREPORT.SBP") THEN DELETE "VREPORT.SBP"
   IF PROGRAMFILE ("VREPORT") THEN CLOSE PROGRAMFILE "VREPORT"
   OPEN "VREPORT.SBP" FOR OUTPUT 
   ? " SUB VReport(codeku%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)"
   ? " SELECT ;"
   ? " WHERE CodeKU.GAdrDat$ = CodeKU.KuKto AND CodeVT.KuKto = lfdNr.KVERTRAG AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeKU.KuKto = codeku% AND "
   ? " " + beding$
   ? " ORDER REPORT Gesellschaft.KuKto"
   ? " TO ASK"
   ? " END SUB"
   CLOSE OUTPUT 
   LOAD "VREPORT.SBP", NEW 
   CALL VReport(codeku%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)
   CLOSE PROGRAMFILE "VREPORT"
 END IF 
 IF opt% = 3 THEN 
   IF EXISTS ("VREPORT.SBP") THEN DELETE "VREPORT.SBP"
   IF PROGRAMFILE ("VREPORT") THEN CLOSE PROGRAMFILE "VREPORT"
   OPEN "VREPORT.SBP" FOR OUTPUT 
   ? " SUB VReport(codeku%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)"
   ? " SELECT ;"
   ? " WHERE CodeKU.GAdrDat$ = CodeKU.KuKto AND CodeVT.KuKto = lfdNr.KVERTRAG AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeKU.KuKto = codeku% AND "
   ? " " + beding$
   ? " ORDER REPORT FÑlligkeit.KuKto"
   ? " TO ASK"
   ? " END SUB"
   CLOSE OUTPUT 
   LOAD "VREPORT.SBP", NEW 
   CALL VReport(codeku%,von$,bis$,manuell$,dtaus$,erledigt$,gedruckt$,mahnung$)
   CLOSE PROGRAMFILE "VREPORT"
 END IF 
ErrKuktoDruck1: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 FILE cfile$
 SELECT FORM KEY cvg% FILE "Kukto" INDEX Codekuko.Kukto
 MOUSE ON 
 END SUB 
 
 
 
SUB VStUebers()
  
   cv% = lfdnr.kvertrag
   vstatus% = 0
   kunr% = codeku.GAdrDat$
   vstatusnr% = CodeVStatus.kvertrag
   vstatustxt$ = VStatusTxT.kvertrag
   DIM Waehrung$(25,1)
   REDIM Waehrung$(25)
   REM FOR i% = 1 TO 20
     REM Waehrung$(i%) = ""
   REM NEXT i%
   
   a% = 0
   Waehrung$(0) = "Filter deaktivieren"
   Waehrung$(1) = "lebend" + SPACE$ (90) + "01"
   Waehrung$(2) = "leben/kurzfristig/unterjÑhrig" + SPACE$ (90) + "02"
   Waehrung$(3) = "ruhend/Anwartschaft" + SPACE$ (90) + "03"
   Waehrung$(4) = "storniert" + SPACE$ (90) + "04"
   Waehrung$(5) = "ruhend/beitragsfrei" + SPACE$ (90) + "05"
   Waehrung$(6) = "beitragsfrei" + SPACE$ (90) + "06"
   Waehrung$(7) = "beitragsfrei durch Leistung" + SPACE$ (90) + "07"
   Waehrung$(8) = "Beitragsstundung" + SPACE$ (90) + "08"
   Waehrung$(9) = "Sonstiges" + SPACE$ (90) + "09"
   Waehrung$(10) = "Altvertrag" + SPACE$ (90) + "10"
   Waehrung$(11) = "Fremdvertrag" + SPACE$ (90) + "11"
   Waehrung$(12) = "Antrag" + SPACE$ (90) + "12"
   Waehrung$(13) = "storniert durch Dynamisierung" + SPACE$ (90) + "13"
   Waehrung$(14) = "Bestandteil eines BÅndelungsvertrages" + SPACE$ (90) + "14"
   Waehrung$(15) = "Antragswiderruf" + SPACE$ (90) + "15"
   Waehrung$(16) = "Policenwiderspruch" + SPACE$ (90) + "16"
   Waehrung$(17) = "Antragsablehnung" + SPACE$ (90) + "20"
   Waehrung$(18) = "KÅnd.wg.Nichtzahlung" + SPACE$ (90) + "21"
   REM 1=lebend
   REM 2=leben/kurzfristig/unterjÑhrig
   REM 3=ruhend/Anwartschaft
   REM 4=storniert
   REM 5=ruhend/beitragsfrei
   REM 6=beitragsfrei
   REM 7=beitragsfrei durch Leistung
   REM 8=Beitragsstundung
   REM 9=Sonstiges 
   REM 10=Altvertrag
   REM 11=Fremdvertrag
   REM 12=Antrag
   REM 13=storniert durch Dynamisierung 
   REM 14=Bestandteil eines BÅndelungsvertrages 
       a% = 14
     DIM Auswahl1$(1)
     FILE "kvertrag"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,204,"Vertragsstatus","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,177,0," Auswahl Vertragsstatus"
      ADD DIALOG "PREISLIS",7,5,14,169,165,0,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,185,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,185,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "Kvertrag"
        GCodeVStatus% = VAL ( RIGHT$ (Auswahl1$(0),2))
        IF (GCodeVStatus% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),laenge1% - 2)
          ausw1$ = TRIM$ (ausw$)
          vstatusu$ = "Filter: " + ausw1$
        ELSE 
          vstatusu$ = "Filter: deaktiviert"
        END IF 
      END IF 
      bef$ = "Select where Codeku.kvertrag = kunr%"
      IF GCodeVStatus% > 0 THEN 
        bef$ = bef$ + " AND CodeVstatus.kvertrag = GCodeVStatus%"
      END IF 
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.kvertrag = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.kvertrag = GCodeGE%"
      END IF 
      IF MNdisabled%("VERTRINHAUSSEE") THEN 
        bef$ = bef$ + " and inhaus.kvertrag<>1"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 FORM 
 
 END SUB 
 
SUB GesFilt()
   cv% = lfdnr.kvertrag
   kunr% = codeku.GAdrDat$
   codeku% = codeku.GAdrDat$
   a% = RECCOUNT ("geadr")
   DIM Waehrung$(a%,1)
   DIM Waehrung%(a%,1)
   REDIM Waehrung$(a%)
   REDIM Waehrung%(a%)
   REM FOR i% = 1 TO a%
     REM Waehrung$(i%) = ""
     REM Waehrung%(i%) = 0
   REM NEXT i%
   FILE "kvertrag"
   INDEX codeku.kvertrag
   SELECT WHERE 
   SELECT FIRST 
   SELECT KEY codeku% FILE "Kvertrag" INDEX codeku.kvertrag
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   WHILE NOT EOF ("kvertrag") AND codeku.kvertrag = codeku%
     IF codege.kvertrag > 0 THEN 
       codege% = codege.kvertrag
       j% = - 1
       FOR i% = 0 TO a%
         IF Waehrung%(i%) = codege% THEN i% = a% + 5000
       NEXT i%
       b% = a% + 5000
       sok% = - 1
       IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
       IF i% < b% AND sok% = - 1 THEN 
         a% = a% + 1
         Waehrung%(a%) = codege%
         SELECT FIRST FILE "geadr" INDEX codege.geadr
         SELECT KEY codege% FILE "geadr" INDEX codege.geadr
         REM IF gesellschaft.geadr LIKE "Colo*" THEN CALL Fehler(gesellschaft.geadr, STR$ (codege.geadr,"000000"))
         Waehrung$(a%) = Gesellschaft.geadr + SPACE$ (90) + STR$ (codege%,"000000")
       END IF 
     END IF 
     SELECT NEXT FILE "Kvertrag" INDEX codeku.kvertrag
   WEND 
   
   DIM Auswahl1$(1)
     FILE "kvertrag"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,184,"Gesellschaft","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,157,0," Auswahl Gesellschaft"
      ADD DIALOG "PREISLIS",7,5,14,169,145,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,165,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,165,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "Kvertrag"
        GCodeGE% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeGE% = 999999 THEN GCodeGE% = 0
        IF (GCodeGE% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          
          gesfi$ = "Ges: " + ausw1$
        ELSE 
          gesfi$ = "Gesellschaft Filter: "
        END IF 
      END IF 
      bef$ = "Select where Codeku.kvertrag = kunr%"
      IF GCodeVStatus% > 0 THEN 
        bef$ = bef$ + " AND CodeVstatus.kvertrag = GCodeVStatus%"
      END IF 
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.kvertrag = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.kvertrag = GCodeGE%"
      END IF 
      IF MNdisabled%("VERTRINHAUSSEE") THEN 
        bef$ = bef$ + " and inhaus.kvertrag<>1"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 FORM 
 
 END SUB 
 
SUB SparteFilt()
   cv% = lfdnr.kvertrag
   kunr% = codeku.GAdrDat$
   codeku% = codeku.GAdrDat$
   a% = RECCOUNT ("sparten")
   DIM Waehrung$(a%,1)
   DIM Waehrung%(a%,1)
   REDIM Waehrung$(a%)
   REDIM Waehrung%(a%)
   REM FOR i% = 1 TO a%
     REM Waehrung$(i%) = ""
     REM Waehrung%(i%) = 0
   REM NEXT i%
   FILE "kvertrag"
   INDEX codeku.kvertrag
   SELECT WHERE 
   SELECT FIRST 
   SELECT KEY codeku% FILE "Kvertrag" INDEX codeku.kvertrag
   a% = 0
   Waehrung%(a%) = 999999
   Waehrung$(a%) = " kein Filter"
   WHILE NOT EOF ("kvertrag") AND codeku.kvertrag = codeku%
     codeva% = codeva.kvertrag
     j% = - 1
     FOR i% = 0 TO a%
       IF Waehrung%(i%) = codeva% THEN i% = a% + 5
     NEXT i%
     b% = a% + 5
     sok% = - 1
     IF MNdisabled%("VERTRINHAUSSEE") AND inhaus.kvertrag = 1 THEN sok% = 0
     IF i% < b% AND sok% = - 1 THEN 
       a% = a% + 1
       Waehrung%(a%) = codeva%
       SELECT FIRST FILE "sparten" INDEX codeva.sparten
       SELECT KEY codeva% FILE "sparten" INDEX codeva.sparten
       Waehrung$(a%) = sparte.sparten + SPACE$ (90) + STR$ (codeva%,"000000")
     END IF 
     SELECT NEXT FILE "Kvertrag" INDEX codeku.kvertrag
   WEND 
   
   DIM Auswahl1$(1)
     FILE "kvertrag"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,184,"Sparte","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,157,0," Auswahl Sparte"
      ADD DIALOG "PREISLIS",7,5,14,169,145,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,165,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,165,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "Kvertrag"
        GCodeVA% = VAL ( RIGHT$ (Auswahl1$(0),6))
        IF GCodeVA% = 999999 THEN GCodeVA% = 0
        IF (GCodeVA% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),50)
          ausw1$ = TRIM$ (ausw$)
          sparfi$ = "Sparte: " + ausw1$
        ELSE 
          sparfi$ = "Sparte Filter: "
        END IF 
      END IF 
      bef$ = "Select where codeku.kvertrag = kunr%"
      IF GCodeVStatus% > 0 THEN 
        bef$ = bef$ + " AND CodeVstatus.kvertrag = GCodeVStatus%"
      END IF 
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.kvertrag = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.kvertrag = GCodeGE%"
      END IF 
      IF MNdisabled%("VERTRINHAUSSEE") THEN 
        bef$ = bef$ + " and inhaus.kvertrag<>1"
      END IF 
      EXECUTE bef$
 MOUSE ON 
 SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 FORM 
 
 END SUB 
 
 
 '      *************************************************
 '      ** Routinen fÅr Zahlungsabgleich Kunden**
 '      *************************************************
 
SUB EINGANGKU()
 IF disabled%("EINGANG") THEN END SUB 
 GCodeGE% = 0
 CALL DFile(3,"KUKTO" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"dtaus" + _fpw$)
 CALL DFile(3,"inkstamm" + _fpw$)
 CALL DFile(3,"stamm" + _fpw$)
 CALL DFile(3,"Fonds" + _fpw$)
 FILE "KUKTO"
 INDEX codekuko.kukto
 SELECT WHERE FILE "kukto"
 SELECT FIRST 
 _formend% = 0
 kumask$ = "ZEKUKTO1"
 IF GLundWrigg$ = "TRUE" THEN 
   kumask$ = "RZEKUKTO"
 END IF 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> kumASK$ THEN 
     SET HEADING title$ + " - ZahlungseingÑnge Kunden"
     OPEN FORM GPrjForm$ + kumASK$
     SET f = Superbase.Form
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     lAussenstand$ = ""
     eingbei$ = ""
     CALL ZEINIntroKU()
     CALL MNEINGANGKU()
     CALL KuKtoSuch()
     SET STATUS "ZahlungseingÑnge Kunden"
   END IF 
   MENU ON 
   MOUSE ON 
   ZEINsub% = 0
   IF RECCOUNT ("KUKTO") > 0 THEN CALL ZEINUpdateKU()
   CALL ClearKBDBuffer()
   FORM 
   f.suchen.visible = - 1
   f.suchen.enabled = - 1
   f.uebersicht.enabled = - 1
   f.abbruch.visible = 0
   f.abbruch.enabled = 0
   
   IF ZEINsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN 
     IF PAGE = 1 THEN 
       _formend% = 1
     ELSE 
       FORM 1
     END IF 
   END IF 
   SELECT CASE ZEINsub%
   CASE 1
       CALL FaelList()
   CASE 5
       codekuko% = codekuko.KuKto
       cuvt% = lfdnr.kvertrag
       FORM 2
       SELECT FORM KEY codekuko% FILE "KuKto" INDEX codekuko.KuKto
       FORM 
   CASE 6
       FORM 1
       SELECT FORM KEY 0 FILE "kukto" INDEX zero.kukto
       FORM 
   CASE 7
       SELECT WHERE FILE "kukto"
       SELECT FORM KEY 0 FILE "kukto" INDEX zero.kukto
       GCodeGE% = 0
       filtbut$ = "kein Filter gesetzt"
       FORM 
   CASE 8
         codekuko% = codekuko.KuKto
         GetVertrag% = codevt.kukto
         SELECT KEY GetVertrag% FILE "Kvertrag" INDEX lfdnr.kvertrag
         cuvt% = GetVertrag%
         knr% = Codeku.kvertrag
         SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
         CALL KVERTRAG()
         OPEN FORM GPrjForm$ + kumask$
         SET f = Superbase.Form
         SET STATUS "ZahlungseingÑnge Kunden"
         FORM 2
         SELECT FORM KEY codekuko% FILE "KuKto" INDEX codekuko.KuKto
         CALL ZEINIntroKU()
         CALL MNEINGANGKU()
         FORM 2
   CASE 9
         IF (kumask$ = "ZEKUKTO") THEN 
           kumask$ = "ZEKUKTO1"
         ELSE 
           kumask$ = "ZEKUKTO"
         END IF 
         OPEN FORM GPrjForm$ + kumASK$
         SET f = Superbase.Form
         CALL ZEINIntroKU()
   CASE 10
         REM DTAUS erstellen
         CALL CreateDTAUS()
   CASE 11
         REM Rechnungen drucken
         REM erledigtJaNein.KUKTO <> "j" AND gedruckt.KUKTO <> "j" AND dtaus.KUKTO <> "j"  
         CALL CreateRech(0)
   CASE 12
         REM mAHNUNGEN drucken
         REM erledigtJaNein.KUKTO <> "j" AND gedruckt.KUKTO = "j" AND dtaus.KUKTO <> "j"
         CALL CreateMahn(0)
   CASE 13
         CALL MahnKUKTO()
   CASE 14
         CALL KuKtoSuch()
   CASE 15
         CALL RecKUKTO()
   CASE 16
         CALL GESKUKTO()
   CASE 100
       REM Lîschen der Kontoinfo
       REQUEST "Wollen Sie diese Kontobuchung wirklich lîschen?","",130,req%
       IF req% = 1 THEN 
         codekuko% = codekuko.kukto
         cuvt% = codevt.kukto
         MOUSE OFF 
         REMOVE FROM FILE "kukto" WHERE codekuko.kukto = codekuko%
         REQUEST "Datensatz wurde gelîscht!"
         IF RECCOUNT ("kukto") > 0 THEN 
           FORM 1
           SELECT FORM KEY cuvt% FILE "KUKTO" INDEX codevt.KUKTO
           FORM 
         ELSE 
           _formend% = 1
         END IF 
         MOUSE ON 
       END IF 
 END SELECT 
   MENU ON 
 WEND 
 VQCodeGEVA$ = ""
 GCodeGE% = 0
 GCodeVA% = 0
 SELECT WHERE FILE "KUKTO"
 _formend% = 0
 END SUB 
  
 REM 041199
SUB CreateDTAUS()
 REQUEST "Mîchten Sie eine Bankeinzug - DTAUS - Diskette erstellen?","",130,req%
 SELECT FIRST FILE "STAMM"
 IF req% = 1 THEN 
   SELECT WHERE FILE "kukto"
   von$ = ReadConfig$("PROVIS","ZEINvon")
   IF von$ = "leer" THEN von$ = ""
   bis$ = ReadConfig$("PROVIS","ZEINbis")
   IF bis$ = "leer" THEN bis$ = ""
   dtcount% = VAL (ReadConfig$("PROVIS","DTAUS")) + 1
   opt% = 1
DTDruKuktoBeg: 
   CREATE DIALOG "ZEINSUCH",0,0,228,164,"DTAUS - Diskette - Filterdialog","MS Sans Serif",8
   ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
   ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
   ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, fÅr welchen Zeitraum Sie die Diskette erstellen mîchten."
   ADD DIALOG "ZEINSUCH",5,38,30,184,34,0,"Es werden alle die DatensÑtze Åbernommen, die in dem Zeitraum liegen ,mit Bankeinzug gekennzeichnet sind und noch nicht auf eine DTAUS geschrieben wurden!"
   ADD DIALOG "ZEINSUCH",5,38,107,96,9,0,"Inkassozeitraum:"
   ADD DIALOG "ZEINSUCH",5,38,64,76,10,0,"Selektieren nach..."
   ADD DIALOG "ZEINSUCH",3,38,72,120,12,0,"alle InkassosÑtze",1,opt%
   ADD DIALOG "ZEINSUCH",3,38,82,170,12,0,"nur automatisch erzeugte InkassosÑtze",2,opt%
   ADD DIALOG "ZEINSUCH",3,38,92,170,12,0,"nur manuell erzeugte InkassosÑtze",3,opt%
   ADD DIALOG "ZEINSUCH",5,58,120,17,11,0,"vom"
   ADD DIALOG "ZEINSUCH",6,78,119,41,11,0,0,von$,20
   ADD DIALOG "ZEINSUCH",5,130,120,13,10,0,"bis"
   ADD DIALOG "ZEINSUCH",6,144,119,41,11,0,0,bis$,20
   ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
   ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
   DIALOG "ZEINSUCH",req2%
   REMOVE DIALOG "ZEINSUCH"
   IF req2% <> 1 THEN END SUB 
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto>=" + CHR$ (34) + von$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  von  ist falsch!","Bitte korrigieren!")
       GOTO DTDruKuktoBeg
     END IF 
   ELSE 
     von$ = "01.01.1990"
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto<=" + CHR$ (34) + bis$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  bis  ist falsch!","Bitte korrigieren!")
       GOTO DTDruKuktoBeg
     END IF 
   ELSE 
     bis$ = "01.01.2990"
   END IF 
   IF opt% = 2 THEN manuell$ = "n"
   IF opt% = 3 THEN manuell$ = "j"
 IF req2% > 0 THEN 
   CALL Fehler("Es wird jetzt zunÑchst eine Kontroll-Liste gedruckt, die Ihnen anzeigt, welche DatensÑtze in die DTAUS Åbernommen werden!","")
   okrep% = 0
   WHILE okrep% = 0
     CALL PRep("GESKUKTO")
     BEFORE REPORT 
       SET REPORT PAGE "H_REPORT"
       OUTPUT REPORT PAGE 
     END REPORT 
 
     HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
     END HEADING 
   
     GROUP nachname.KUKTO
     AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
     END SELECT 
     ON ERROR GOTO Err0411GDruck
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     SET FIRST PAGE HEADING OFF 
     IF opt% < 2 THEN 
       SELECT ;
        WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND dtaus.kukto <> "j" AND zahlart = "Bankeinzug"
          ORDER REPORT VS_NR.kukto
          TO ASK 
     ELSE 
       SELECT ;
        WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND dtaus.kukto <> "j" AND zahlart = "Bankeinzug" AND manuell.kukto = manuell$
          ORDER REPORT VS_NR.kukto
          TO ASK 
     END IF 
Err0411GDruck: 
    ON ERROR GOTO ErrorHandler
   REQUEST "Mîchten Sie den Ausdruck der Kontrolliste wiederholen?","",130,req5%
   IF req5% <> 1 THEN okrep% = 1
  WEND 
  REQUEST "Mîchten Sie die Bankeinzug - Diskette erstellen?","",130,req4%
  IF req4% <> 1 THEN END SUB 
 END IF 
 
 
 
   MOUSE OFF 
   REM DTAUS
   REMOVE FROM FILE "DTAUS"
   FILE "kukto"
   SELECT WHERE FILE "kukto"
   INDEX fÑlligkeit.kukto
   IF opt% < 2 THEN 
     SELECT WHERE fÑlligkeit >= DAYS (von$) AND fÑlligkeit <= DAYS (bis$) AND dtaus <> "j" AND zahlart = "Bankeinzug"
   ELSE 
     SELECT WHERE fÑlligkeit >= DAYS (von$) AND fÑlligkeit <= DAYS (bis$) AND dtaus <> "j" AND zahlart = "Bankeinzug" AND manuell.kukto = manuell$
   END IF 
   a% = 0
   BLANK FILE "DTAUS"
   satzlaenge.DTAUS = 128
   satzart.DTAUS = "A"
   A_Kennzeichen.DTAUS = "LK"
   A_Bankleitzahl = VAL (blz.stamm)
   A_Kundenname.DTAUS = UCASE$ ( LEFT$ (Firma1.stamm,27))
   A_Datum.DTAUS = TODAY 
   A_Kontonummer = VAL (Konto.stamm)
   REM Kennzeichen fÅr EURO
   A_Waehrungknz.dtaus = "1"
   STORE FILE "DTAUS"
   FILE "KUKTO"
   SELECT FIRST LOCK 
   WHILE NOT EOF ("kukto")
     IF waehrung.kukto LIKE "EUR*" THEN 
       ok% = - 1
     ELSE 
       ok% = 0
       a$ = "Die WÑhrung des Betrages zum Vertrag " + VS_nr.kukto + " lautet nicht EUR sondern " + waehrung.kukto
       b$ = "PrÅfen Sie, ob der Vertrag auf EURO umgestellt wurde und erfassen Sie ggf. den Betrag in der erforderlichen WÑhrung neu!"
     END IF 
     IF ok% = - 1 THEN 
       a% = a% + 1
       SET STATUS STR$ (a%,"999999") + " DatensÑtze Åbernommen!"
       BLANK FILE "DTAUS"
       satzart.DTAUS = "C"
       C_Bankleitzahl1.DTAUS = VAL (blz.stamm)
       C_Bankleitzahl2.DTAUS = VAL (k1blz .kukto)
       C_Kontonummer1.DTAUS = VAL (k1Konto.kukto)
       C_Textkey.DTAUS = 05
       REM C_BetragDM = Beitrag.kukto * 100
       C_BetragEuro = Beitrag.kukto * 100
       REM Kennzeichen fÅr EURO
       C_Waehrungknz.dtaus = "1"
       C_Bankleitzahl3.DTAUS = VAL (blz.stamm)
       C_Kontonummer2.DTAUS = VAL (Konto.stamm)
       C_Name1.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(nachname.kukto),27))
       C_Name2.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(Firma1.stamm),27))
       IF GLundWrigg$ = "TRUE" OR UEBERWTXT.kukto <> "" THEN 
         IF UEBERWTXT.kukto <> "" THEN 
           C_VerwZweck.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(UEBERWTXT.kukto),27))
         ELSE 
           C_VerwZweck.DTAUS = LEFT$ ( UCASE$ ("IHRE " + VSNRPack1$(sparte.kukto)),27)
         END IF 
       ELSE 
         C_VerwZweck.DTAUS = LEFT$ ( UCASE$ ("IHRE " + VSNRPack1$(sparte.kukto)),27)
       END IF 
       C_ErwKnz.DTAUS = 03
       C_ErwTeilKnz1.DTAUS = 02
       C_Inhalt1.DTAUS = LEFT$ ( UCASE$ (VSNRPack$(VS_nr.kukto)),27)
       C_ErwTeilKnz2.DTAUS = 02
       IF UEBERWTXT.stamm <> "" THEN 
         C_Inhalt2.DTAUS = UCASE$ ( LEFT$ (VSNRPack1$(UEBERWTXT.stamm),27))
       ELSE 
         C_Inhalt2.DTAUS = "PRAEMIE"
       END IF 
       C_ErwTeilKnz3.DTAUS = 02
       C_Inhalt3.DTAUS = "XX"
       STORE FILE "DTAUS"
       FILE "Kukto"
       dtaus.kukto = "j"
       erledigtJaNein.kukto = "j"
       Workstation.kukto = Workstation%
       QWoNo.kukto = STR$ (Workstation%,"000000") + STR$ (codekuko.kukto,"000000")
       RecStatus.kukto = "c"
       STORE FILE "kukto"
     ELSE 
       CALL Fehler(a$,b$)
     END IF 
     SELECT NEXT LOCK FILE "kukto"
   WEND 
   MOUSE ON 
   IF EXISTS (GMACodeDir$ + "dtaus1.txt") THEN DELETE GMACodeDir$ + "dtaus1.txt"
   CALL dtaus()
   GOTO a0605200302
a0605200301: 
   CALL Fehler("Es trat beim kopieren der Datei" + GMACodeDir$ + "dtaus1.txt ein Fehler auf!","Bitte prÅfen Sie, ob Diskette formatiert ist bzw. der Schreibschutz entfernt wurde oder legen Sie eine andere leere Diskette ein!")
a0605200302: 
   CALL Info("Bitte legen Sie eine leere Diskette in Laufwerk A:","Zur Sicherheit wir eine Kopie der Datei unter " + GMACodeDir$ + "dtaus1.txt gespeichert (falls Ihre Diskette kaputt ist)")
   MOUSE OFF 
   ON ERROR GOTO a0605200301
   IF EXISTS ("a:\dtaus1.txt") THEN DELETE "a:\dtaus1.txt"
   COPY GMACodeDir$ + "dtaus1.txt" TO "a:\dtaus1.txt"
   d2$ = DATE$ ( TODAY ,"yyyymm0d")
   IF dtcount% > 999 THEN dtcount% = 1
   CALL WriteConfig("PROVIS","DTAUS", STR$ (dtcount%,"000"))
   ON ERROR GOTO a0605200303
   d2$ = d2$ + "." + STR$ (dtcount%,"000")
   COPY GMACodeDir$ + "dtaus1.txt" TO _netpath$ + "DTAUS\" + d2$
   GOTO a0605200304
a0605200303: 
   CALL Fehler("Es trat ein Fehler beim kopieren der Datei " + GMACodeDir$ + "dtaus1.txt nach " + _netpath$ + "DTAUS\" + d2$ + " auf!","")
a0605200304: 
   ON ERROR GOTO ErrorHandler
 
   MOUSE ON 
   CALL Fehler("Die DTAUS-Diskette wurde erstellt!","Es wurden " + STR$ (a%,"999999") + " DatensÑtze Åbernommen!")
 END IF 
 SELECT WHERE FILE "kukto"
 END SUB 
 
 
 
 
SUB GESKUKTO()
 REM 031199
 filter$ = WHERE 
 FILE "kukto"
 SELECT WHERE FILE "kukto"
 REM opt% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 IF opt% = 0 THEN opt% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 opt% = 4
SuDruKuktoBeg: 
 CREATE DIALOG "ZEINSUCH",0,0,228,164,"ZahlungseingÑnge","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,139,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, welche InkassosÑtze Sie drucken mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des Inkassodatums einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,62,76,10,0,"Sortierung nach..."
 ADD DIALOG "ZEINSUCH",3,38,70,95,12,0,"Vertrags-/Policennummer",1,opt%
 ADD DIALOG "ZEINSUCH",3,38,80,60,12,0,"Name",2,opt%
 ADD DIALOG "ZEINSUCH",3,38,90,60,12,0,"FÑlligkeit",3,opt%
 ADD DIALOG "ZEINSUCH",3,38,100,60,12,0,"Gesellschaft",4,opt%
 IF GLundWrigg$ = "TRUE" THEN 
   ADD DIALOG "ZEINSUCH",2,150,62,41,11,0,"manuell?","j","n",manuell$
   ADD DIALOG "ZEINSUCH",2,150,62,41,11,0,"Abruf?","j","n",abruf$
 END IF 
 ADD DIALOG "ZEINSUCH",2,150,70,67,11,0,"DTAUS erstellt?","j","n",dtaus$
 ADD DIALOG "ZEINSUCH",2,150,80,41,11,0,"erledigt?","j","n",erledigt$
 ADD DIALOG "ZEINSUCH",2,150,90,75,11,0,"Rechnung erstelllt?","j","n",gedruckt$
 ADD DIALOG "ZEINSUCH",2,150,100,75,11,0,"Mahnung erstelllt?","j","n",mahnung$
 
 ADD DIALOG "ZEINSUCH",5,38,112,96,9,0,"Inkassozeitraum (Pflicht):"
 ADD DIALOG "ZEINSUCH",5,58,125,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,124,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,125,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,124,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,143,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,143,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   ge% = GetGesKukto%()
   
   SELECT WHERE FILE "kukto"
   IF ge% > 0 THEN 
     GCodeGE% = ge%
     ge$ = LTRIM$ ( STR$ (ge%,"9999999"))
     filt$ = ""
     filt$ = "codege.kukto=" + ge$
     beding$ = filt$ + " AND FÑlligkeit >= DAYS (von$) AND FÑlligkeit <= DAYS (bis$)"
   ELSE 
     beding$ = "FÑlligkeit >= DAYS (von$) AND FÑlligkeit <= DAYS (bis$)"
   END IF 
   IF GLundWrigg$ = "TRUE" THEN beding$ = beding$ + " AND abruf = abruf$"
   IF GLundWrigg$ = "TRUE" THEN beding$ = beding$ + " AND manuell = manuell$"
   beding$ = beding$ + " AND dtaus = dtaus$"
   beding$ = beding$ + " AND erledigtjanein = erledigt$"
   beding$ = beding$ + " AND gedruckt = gedruckt$"
   beding$ = beding$ + " AND mahnung = mahnung$"
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   REM filt$ = "Select where codekuko>0 and erledigtJaNein=" + CHR$ (34) + erledigt$ + CHR$ (34) + " and dtaus=" + CHR$ (34) + dtaus$ + CHR$ (34) + " and manuell=" + CHR$ (34) + manuell$ + CHR$ (34)
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto>=" + CHR$ (34) + von$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  von  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg
     END IF 
   ELSE 
     von$ = "01.01.1990"
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
       REM filt$ = filt$ + " And FÑlligkeit.kukto<=" + CHR$ (34) + bis$ + CHR$ (34)
     ELSE 
       CALL Fehler("Datumsangabe  bis  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg
     END IF 
   ELSE 
     bis$ = "01.01.2990"
   END IF 
 ELSE 
   GOTO ErrKuktoGDruck:
 END IF 
 FILE "kukto"
 CALL PRep("GESKUKTO")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 IF opt% = 1 THEN 
   GROUP VS_NR.kukto
 END IF 
 IF opt% = 2 THEN 
   GROUP nachname.kukto
 END IF 
 IF opt% = 3 THEN 
   GROUP FÑlligkeit.kukto
 END IF 
 IF opt% = 4 THEN 
   GROUP Gesellschaft.kukto
 END IF 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 REM ON ERROR GOTO ErrKuktoGDruck
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SET FIRST PAGE HEADING OFF 
 REM WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND manuell.kukto = manuell$ AND dtaus.kukto = dtaus$ AND erledigtjanein.kukto = erledigt$ AND gedruckt.kukto = gedruckt$ AND mahnung.kukto = mahnung$
 IF opt% = 1 THEN 
   EXECUTE "select ; where " + beding$ + " ORDER REPORT VS_NR.kukto TO ASK"
 END IF 
 IF opt% = 2 THEN 
   EXECUTE "select ; where " + beding$ + " ORDER REPORT nachname.kukto TO ASK"
 END IF 
 IF opt% = 3 THEN 
   EXECUTE "select ; where " + beding$ + " ORDER REPORT FÑlligkeit,Gesellschaft,Sparte TO ASK"
 END IF 
 IF opt% = 4 THEN 
   EXECUTE "select ; where " + beding$ + " ORDER REPORT Gesellschaft,Sparte,FÑlligkeit TO ASK"
 END IF 
ErrKuktoGDruck: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
 
SUB MahnKUKTO()
 REM 031199
 FILE "kukto"
 SELECT WHERE FILE "kukto"
 opt% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 IF opt% = 0 THEN opt% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 optm&% = 4
SuDruMahnBeg1: 
 
    optm% = 4
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("ZEINSUCH")
    SET dlg = Superbase.Dialogs.ZEINSUCH
    dlg.Move(0,0,288,177)
    dlg.Caption = "ZahlungseingÑnge"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,1,288,152)
    control.Caption = ""
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(5,9,280,23)
    control.Caption = "Bitte wÑhlen Sie aus, welche nicht erledigten InkassosÑtze Sie drucken mîchten."
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(9,11,23,22)
    control.Icon = 2
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(5,32,280,24)
    control.Caption = "Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des Inkassodatums einschrÑnken."
 
    SET control = dlg.Add("DialogFrame3","DialogFrame")
    control.Move(134,60,151,53)
    control.Caption = "Ausgabe"
 
    SET control = dlg.Add("DialogOptionButton4","DialogOptionButton")
    control.Move(138,72,84,12)
    control.Caption = "angemahnt"
    control.Bind("optm%")
    control.ValueOn = 4
 
    SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
    control.Move(138,88,104,11)
    control.Caption = "anzumahnen"
    control.Bind("optm%")
    control.ValueOn = 5
 
    SET control = dlg.Add("DialogFrame2","DialogFrame")
    control.Move(4,60,129,53)
    control.Caption = "Sortierung nach"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(7,70,96,13)
    control.Caption = "Vertrags-/Policennummer"
    control.Bind("opt%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(7,84,60,12)
    control.Caption = "Name"
    control.Bind("opt%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
    control.Move(7,97,60,11)
    control.Caption = "FÑlligkeit"
    control.Bind("opt%")
    control.ValueOn = 3
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(40,121,96,9)
    control.Caption = "Inkassozeitraum: "
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(82,134,41,11)
    control.MaxLength = 20
    control.TextBinding = "von$"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(148,134,41,11)
    control.MaxLength = 20
    control.TextBinding = "bis$"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(62,135,17,11)
    control.Caption = "vom"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(134,135,13,10)
    control.Caption = "bis"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(72,160,55,15)
    control.Default = 1
    control.Caption = "&OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(130,160,55,15)
    control.Caption = "&Abbrechen"
    control.ReturnValue = 0
    control.Cancel = 1
 
 
 
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
     ELSE 
       CALL Fehler("Datumsangabe  von  ist falsch!","Bitte korrigieren!")
       GOTO SuDruMahnBeg1
     END IF 
   ELSE 
     von$ = "01.01.1990"
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
     ELSE 
       CALL Fehler("Datumsangabe  bis  ist falsch!","Bitte korrigieren!")
       GOTO SuDruMahnBeg1
     END IF 
   ELSE 
     bis$ = "01.01.2990"
   END IF 
 ELSE 
   GOTO ErrMahnGDruck:
 END IF 
 CALL PRep("MANKUKTO")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 IF opt% = 1 THEN 
   GROUP VS_NR.kukto
 END IF 
 IF opt% = 2 THEN 
   GROUP nachname.kukto
 END IF 
 IF opt% = 3 THEN 
   GROUP FÑlligkeit.kukto
 END IF 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO ErrMahnGDruck
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SET FIRST PAGE HEADING OFF 
 IF GCodeGE% = 0 THEN 
   IF opt% = 1 AND optm% = 4 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits angemahnt)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND mahnung = "j" AND erledigtJaNein <> "j"
     ORDER REPORT VS_NR.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 2 AND optm% = 4 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits angemahnt)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND mahnung = "j" AND erledigtJaNein <> "j"
     ORDER REPORT nachname.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 3 AND optm% = 4 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits angemahnt)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND mahnung = "j" AND erledigtJaNein <> "j"
     ORDER REPORT FÑlligkeit.kukto
     TO ASK 
     END SELECT 
   END IF 
 
   IF opt% = 1 AND optm% = 5 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (anzumahnen)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j"
     ORDER REPORT VS_NR.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 2 AND optm% = 5 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (anzumahnen)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j"
     ORDER REPORT nachname.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 3 AND optm% = 5 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (anzumahnen)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j"
     ORDER REPORT FÑlligkeit.kukto
     TO ASK 
     END SELECT 
   END IF 
 ELSE 
   IF opt% = 1 AND optm% = 4 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits angemahnt)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND mahnung = "j" AND erledigtJaNein <> "j" AND Codege.kukto = GCodege%
     ORDER REPORT VS_NR.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 2 AND optm% = 4 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits angemahnt)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND mahnung = "j" AND erledigtJaNein <> "j" AND Codege.kukto = GCodege%
     ORDER REPORT nachname.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 3 AND optm% = 4 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits angemahnt)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND mahnung = "j" AND erledigtJaNein <> "j" AND Codege.kukto = GCodege%
     ORDER REPORT FÑlligkeit.kukto
     TO ASK 
     END SELECT 
   END IF 
 
   IF opt% = 1 AND optm% = 5 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (anzumahnen)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j" AND Codege.kukto = GCodege%
     ORDER REPORT VS_NR.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 2 AND optm% = 5 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (anzumahnen)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j" AND Codege.kukto = GCodege%
     ORDER REPORT nachname.kukto
     TO ASK 
     END SELECT 
   END IF 
   IF opt% = 3 AND optm% = 5 THEN 
     tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (anzumahnen)"
     SELECT ;
     WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j" AND Codege.kukto = GCodege%
     ORDER REPORT FÑlligkeit.kukto
     TO ASK 
     END SELECT 
   END IF 
 END IF 
 
ErrMahnGDruck: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
 
 
 
 
SUB RecKUKTO()
 REM 031199
 FILE "kukto"
 SELECT WHERE FILE "kukto"
 opt% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 IF opt% = 0 THEN opt% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 optm% = 1
SuDruKuktoBeg2: 
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("ZEINSUCH")
    SET dlg = Superbase.Dialogs.ZEINSUCH
    dlg.Move(0,0,288,177)
    dlg.Caption = "ZahlungseingÑnge"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,1,288,152)
    control.Caption = ""
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(5,9,280,23)
    control.Caption = "Bitte wÑhlen Sie aus, welche nicht erledigten InkassosÑtze Sie drucken mîchten."
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(9,11,23,22)
    control.Icon = 2
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(5,32,280,24)
    control.Caption = "Sie kînnen die zu druckende Datenmenge durch die wahlfreie Angabe des Inkassodatums einschrÑnken."
 
    SET control = dlg.Add("DialogFrame3","DialogFrame")
    control.Move(134,60,151,53)
    control.Caption = "Ausgabe"
 
    SET control = dlg.Add("DialogOptionButton4","DialogOptionButton")
    control.Move(138,72,84,12)
    control.Caption = "Rechnung gedruckt"
    control.Bind("optm%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
    control.Move(138,88,104,11)
    control.Caption = "Rechnung nicht gedruckt"
    control.Bind("optm%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogFrame2","DialogFrame")
    control.Move(4,60,129,53)
    control.Caption = "Sortierung nach"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(7,70,96,13)
    control.Caption = "Vertrags-/Policennummer"
    control.Bind("opt%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(7,84,60,12)
    control.Caption = "Name"
    control.Bind("opt%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
    control.Move(7,97,60,11)
    control.Caption = "FÑlligkeit"
    control.Bind("opt%")
    control.ValueOn = 3
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(40,121,96,9)
    control.Caption = "Inkassozeitraum: "
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(82,134,41,11)
    control.MaxLength = 20
    control.TextBinding = "von$"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(148,134,41,11)
    control.MaxLength = 20
    control.TextBinding = "bis$"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(62,135,17,11)
    control.Caption = "vom"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(134,135,13,10)
    control.Caption = "bis"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(72,160,55,15)
    control.Default = 1
    control.Caption = "&OK"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(130,160,55,15)
    control.Caption = "&Abbrechen"
    control.ReturnValue = 0
    control.Cancel = 1
  
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF von$ <> "" THEN 
     IF DateOK%(von$) THEN 
     ELSE 
       CALL Fehler("Datumsangabe  von  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg2
     END IF 
   ELSE 
     von$ = "01.01.1990"
   END IF 
   IF bis$ <> "" THEN 
     IF DateOK%(bis$) THEN 
     ELSE 
       CALL Fehler("Datumsangabe  bis  ist falsch!","Bitte korrigieren!")
       GOTO SuDruKuktoBeg2
     END IF 
   ELSE 
     bis$ = "01.01.2990"
   END IF 
 ELSE 
   GOTO ErrRecGDruck:
 END IF 
 CALL PRep("RECKUKTO")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 IF opt% = 1 THEN 
   GROUP VS_NR.kukto
 END IF 
 IF opt% = 2 THEN 
   GROUP nachname.kukto
 END IF 
 IF opt% = 3 THEN 
   GROUP FÑlligkeit.kukto
 END IF 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 REM ON ERROR GOTO ErrKuktoGDruck
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SET FIRST PAGE HEADING OFF 
 IF opt% = 1 AND optm% = 1 THEN 
   tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits gedruckt)"
   SELECT ;
    WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND gedruckt = "j" AND erledigtJaNein <> "j"
      ORDER REPORT VS_NR.kukto
      TO ASK 
 END IF 
 IF opt% = 2 AND optm% = 1 THEN 
   tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits gedruckt)"
   SELECT ;
    WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND gedruckt = "j" AND erledigtJaNein <> "j"
      ORDER REPORT nachname.kukto
      TO ASK 
 END IF 
 IF opt% = 3 AND optm% = 1 THEN 
   tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (bereits gedruckt)"
   SELECT ;
   WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND gedruckt = "j" AND erledigtJaNein <> "j"
   ORDER REPORT FÑlligkeit.kukto
      TO ASK 
 END IF 
 
 IF opt% = 1 AND optm% = 2 THEN 
   tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (noch nicht gedruckt)"
   SELECT ;
    WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j"
      ORDER REPORT VS_NR.kukto
      TO ASK 
 END IF 
 IF opt% = 2 AND optm% = 2 THEN 
   tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (noch nicht gedruckt)"
   SELECT ;
    WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j"
      ORDER REPORT nachname.kukto
      TO ASK 
 END IF 
 IF opt% = 3 AND optm% = 2 THEN 
   tit1$ = "Zeitraum von " + von$ + " bis " + bis$ + " (noch nicht gedruckt)"
   SELECT ;
   WHERE FÑlligkeit.kukto >= DAYS (von$) AND FÑlligkeit.kukto <= DAYS (bis$) AND beitrag <> gezBetrag AND mahnung <> "j" AND erledigtJaNein <> "j"
      ORDER REPORT FÑlligkeit.kukto
      TO ASK 
 END IF 
 
ErrRecGDruck: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
 
 
 
 
 
SUB MNEINGANGKU()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
SUB ZEINIntroKU()
 MOUSE OFF 
 FILE "KUKTO"
 INDEX CodeKUKo.KUKTO
 REM 020798 SELECT FORM LAST 
 FORM 
 END SUB 
 
SUB ZEINUpdateKU()
 SELECT KEY CodeVT.KUKTO FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 REM kondart% = kondart.zeingan1
 SELECT KEY CodeMA.KUKTO FILE "MAADR" INDEX CodeMA.MAADR
 SELECT KEY CodeGE.KUKTO FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY CodeVA.KUKTO FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY CodeKU.KUKTO FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 lGesellschaft$ = Gesellschaft.GEADR
 lAgentur$ = Nachname.MAADR + ", " + Vorname.MAADR + ", " + Agenturnr.maadr
 lSparte$ = Sparte.SPARTEN
 lKunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 eingbei$ = EingereichtBei.kvertrag
 IF eingbei$ = "" THEN 
   eingbei$ = "eingereicht Åber"
 END IF 
 IF MNdisabled%("SEEEINGBEI") THEN 
   eingbei$ = ""
 END IF 
 REM waehr$ = "WÑhrung: " + waehrung.zeingan1
 FORM 
 END SUB 
 
 
 
 
 
SUB FldUpdate22(Feldname$,NewFormat$)
 REM CALL GaugeUpdate()
 REM CALL Server("UPDFILE", FILE )
 REM CALL Server("UPDFIELD",Feldname$)
 IndexTyp$ = FIELDINFO$ (Feldname$,3)
 IF IndexTyp$ LIKE "IX*" THEN REMOVE INDEX Feldname$$
 MODIFY Feldname$$,Feldname$ + ";" + NewFormat$
 IF IndexTyp$ = "IXD" THEN 
   CALL Server("UPDSTATUS","Indexanpassung")
   CREATE INDEX ON Feldname$$
 END IF 
 IF IndexTyp$ = "IXU" THEN 
   CALL Server("UPDSTATUS","Indexanpassung")
   CREATE INDEX ON Feldname$$ UNIQUE 
 END IF 
 END SUB 
 
 
 
 
 
 ' Serienbrief an Gesellschaften
 ' =================================================================================
 
SUB GESerie()
 gesser% = 1
 SET STATUS ""
 IF OPEN ("adrtemp") THEN 
   REM CLOSE FILE "ADRTEMP"
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "ADRTEMP"
 FILE "GEadr"
 INDEX Gesellschaft.geadr
 SELECT FIRST 
 MOUSE OFF 
 a% = 0
 b% = RECCOUNT ("GEADR")
 IF b% > 20000 THEN 
   b% = 20000
   REDIM AdrFound$(20000,1)
   REDIM AdrFound$(20000)
 ELSE 
   REDIM AdrFound$( RECCOUNT ("GEADR"),1)
   REDIM ADRFound$( RECCOUNT ("GEADR"))
 END IF 
 
 REM FOR a% = 0 TO b%
   REM AdrFound$(a%) = ""
 REM NEXT a%
 a% = 0
 gnab$ = "Sie erhalten zusÑtzlich die Mîglichkeit Gesellschaftsadressen, die in der Kunden-Adressdatei schon vorhanden sind, aktualisieren zu lassen"
 gnab$ = gnab$ + " Bedenken Sie jedoch, da· dann aus der Adressdatei der Gesellschaften die Felder Åbernommen werden und evt.énderungen, die Sie nur in der Kunden-Adress-Datei"
 gnab$ = gnab$ + " vorgenommen haben, verloren gehen! "
 gnab0$ = "Es werden jetzt alle Gesellschaftsadressen, die in der Kunden-Adressdatei noch nicht vorhanden sind, in diese Åbernommen! "
 gnab0$ = gnab0$ + "Als Kennzeichen erhalten diese Adresse in der Kundennummer das Kennzeichen <G> und weiterhin einen Eintrag im Feld Gesellschaftsadresse=j. öber diese Felder kînnen Sie im Adress-Suche-Dialog suchen!"
 gnab0$ = gnab0$ + gnab$
 REM CALL Fehler(gnab0$,gnab$)
 REM REQUEST "Mîchten Sie die énderungen in den Adressen der Gesellschaftsdatei","in die Kunden-Adressdatei Åbernehmen?",130,req1%
    DIM dlg1 AS Dialog
    DIM control1 AS DialogControl
 
    Superbase.Dialogs.Add("LHELP")
    SET dlg1 = Superbase.Dialogs.LHELP
    dlg1.Move(0,0,302,159)
    dlg1.Caption = "Hilfe"
    dlg1.FontName = "MS Sans Serif"
    dlg1.FontSize = 8
 
    SET control1 = dlg1.Add("DialogFrame2","DialogFrame")
    control1.Move(0,3,301,135)
    control1.Caption = ""
 
    SET control1 = dlg1.Add("DialogIcon1","DialogIcon")
    control1.Move(6,17,22,21)
    control1.Icon = 2
 
    SET control1 = dlg1.Add("DialogLabel1","DialogLabel")
    control1.Move(6,41,291,92)
    control1.CaptionBinding = "gnab0$"
 
    SET control1 = dlg1.Add("DialogCommandButton3","DialogCommandButton")
    control1.Move(125,143,55,14)
    control1.Caption = "&OK"
    control1.ReturnValue = 0
  
    DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("TLISTE")
    SET dlg = Superbase.Dialogs.TLISTE
    dlg.Move(0,0,288,67)
    dlg.Caption = "Adressaktualisierungen"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame2","DialogFrame")
    control.Move(0,2,286,46)
    control.Caption = ""
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(30,16,255,23)
    control.Caption = "Mîchten Sie die énderungen in den Adressen der Gesellschaftsdatei, in die Kunden-Adressdatei Åbernehmen?"
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(6,16,22,20)
    control.Icon = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(58,49,55,15)
    control.Default = 1
    control.Caption = "&Ja"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(114,49,55,15)
    control.Caption = "&Nein"
    control.ReturnValue = 0
 
    SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
    control.Move(170,49,55,15)
    control.Caption = "&Hilfe"
    control.ReturnValue = 0
    control.NestedDialogName = "LHELP"
 
 
  
 
 SET STATUS ""
 DIALOG "TLISTE",req1%
 REMOVE DIALOG ALL 
 i% = 0
 j% = RECCOUNT ("Geadr")
 SELECT FIRST FILE "GEADR"
 WHILE NOT EOF ("GEADR")
   
   i% = i% + 1
   SET STATUS "Bearbeite Adresse der Gesellschaft:" + gesellschaft.geadr + "    " + STR$ (i%,"999999") + " von " + STR$ (j%,"99999")
   MOUSE OFF 
   codeku% = codeku.geadr
   codege% = codege.geadr
   IF NOT EXISTS (codeku%,codeku.GAdrDat$) THEN 
     MOUSE OFF 
     CALL GeadrZuADR(codege%,0)
     MOUSE OFF 
     SELECT KEY codege% FILE "geadr" INDEX codege.geadr
   ELSE 
     IF req1% = 1 THEN 
       MOUSE OFF 
       CALL GeadrZuADR(codege%,codeku%)
       MOUSE OFF 
     END IF 
   END IF 
   MOUSE OFF 
   codeku% = codeku.geadr
   BLANK FILE "adrtemp"
   codeadrt% = SER ("ADRTEMP",1)
   codeadrt.adrtemp = codeadrt%
   codeku.adrtemp = codeku.geadr
   Anrede.adrtemp = Anrede.geadr
   Name1.adrtemp = Gesellschaft.geadr
   Name2.adrtemp = Vermittlernr.geadr
   zuHaenden.adrtemp = Anrede.geadr + " " + Vorname.geadr + " " + Nachname.geadr
   Strasse.adrtemp = Stra·e.geadr
   PLZ.adrtemp = PLZ.geadr
   Ort.adrtemp = Ort.geadr
   land.adrtemp = land.geadr
   Telart1.adrtemp = "Telefon1"
   Telnr1.adrtemp = Telefon1.geadr
   Telart2.adrtemp = "Telefon2"
   Telnr2.adrtemp = Telefon2.geadr
   Telart2.adrtemp = "Fax"
   Telnr2.adrtemp = Telefax.geadr
   FaxJN3.adrtemp = "j"
   IF postanschrift.geadr <> "" THEN 
     Postanschrift.adrtemp = Postanschrift.geadr
   ELSE 
       p$ = ""
       p$ = p$ + LTRIM$ (gesellschaft.geadr) + CHR$ (13) + CHR$ (10)
       p$ = p$ + Stra·e.geadr + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + plz.geadr + " " + Ort.geadr + CHR$ (13) + CHR$ (10) + land.geadr + CHR$ (13) + CHR$ (10)
       Postanschrift.adrtemp = p$
   END IF 
   STORE FILE "adrtemp"
   AdrFound$(a%) = Gesellschaft.geadr + STR$ (codeadrt%,"000000")
   a% = a% + 1
   FILE "GEADR"
   SELECT NEXT FILE "GEADR"
 WEND 
 REM CALL Fehler("Ser","")
 MOUSE ON 
 gesser% = 1
 CALL SerieNeu1("ADRTEMP")
 
 END SUB 
 
 'Aufnahme GEADR in Adressen
 'stat%=0 Neuaufnahme
 'stat%=codeku% Test auf Vorhandensein der Geadr in Adressen und Felder aktualisieren
 
SUB GeadrZuADR(codege%,stat%)
     MOUSE OFF 
     SELECT KEY codege% FILE "geadr" INDEX codege.geadr
     IF stat% = 0 THEN 
       BLANK FILE GAdrDat$
       codeku% = SER (GAdrDat$,1)
       codeku.GAdrDat$ = codeku%
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LastKunr.stamm + 1
       LastKunr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       MOUSE OFF 
       REM IF proserv$ <> "TRUE" THEN Kundennummer.GAdrDat$ = "K" + LTRIM$ ( STR$ (nnum%,"999999"))
       Kundennummer.GAdrDat$ = "<G>" + LTRIM$ ( STR$ (nnum%,"999999"))
     ELSE 
       codeku% = stat%
       SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
       codeku% = codeku.GAdrDat$
       REMOVE FROM FILE GTelDat$ WHERE codeku.GTelDat$ = codeku%
     END IF 
     
     Anrede.GAdrDat$ = "Gesellschaft"
     Nachname.GAdrDat$ = Gesellschaft.geadr
     SET STATUS "Bearbeite Adresse " + Gesellschaft.geadr
     Vorname.GAdrDat$ = LEFT$ ((anrede.geadr + " " + vorname.geadr + " " + nachname.geadr),50)
     Briefanrede = "Sehr geehrte Damen und Herren"
     ort.GAdrDat$ = Ort.geadr
     plz.GAdrDat$ = plz.geadr
     stra·e.GAdrDat$ = stra·e.geadr
     Land.GADRDat$ = Land.geadr
     AAGesellschaft.GAdrDat$ = "j"
     AAKunde.GAdrDat$ = "n"
     AAMakler.GAdrDat$ = "n"
     AAMitarbeiter.GAdrDat$ = "n"
     AAInteressent.GAdrDat$ = "n"
     AALieferant.GAdrDat$ = "n"
     FIPrivat.GAdrDat$ = "n"
     FIATEC.GAdrDat$ = "j"
     FIIMMAK.GAdrDat$ = "n"
     BerProtok.GADRDat$ = "n"
     notiz.GAdrDat$ = Notiz.geadr
     IF postanschrift.geadr <> "" AND Postanschrift.GAdrDat$ = "" THEN 
       Postanschrift.GAdrDat$ = postanschrift.geadr
     ELSE 
       IF Postanschrift.geadr = "" AND stra·e.geadr <> "" AND ort.geadr <> "" AND Postanschrift.GAdrDat$ = "" THEN 
         p$ = ""
         p$ = p$ + LTRIM$ (gesellschaft.geadr) + CHR$ (13) + CHR$ (10)
         p$ = p$ + Stra·e.geadr + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + plz.geadr + " " + Ort.geadr + CHR$ (13) + CHR$ (10) + land.geadr + CHR$ (13) + CHR$ (10)
         Postanschrift.GAdrDat$ = p$
       END IF 
     END IF 
     CALL QuickStore(GAdrDat$)
     MOUSE OFF 
     REM posta$ = Postanschrift.GAdrDat$
    REM IF NOT EXISTS (codeku%,codeku.GTelDat$) THEN 
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "Telefon1:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = Telefon1.geadr
     FonOderFax.GTelDat$ = "n"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "Telefon2:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = Telefon2.geadr
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     FonOderFax.GTelDat$ = "n"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     STORE FILE GTelDat$
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "Telefax:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = Telefax.geadr
     FonOderFax.GTelDat$ = "j"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "email:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = email.geadr
     FonOderFax.GTelDat$ = "n"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
     abf$ = "t"
     FOR i% = 1 TO 16
       abt$ = "t" + LTRIM$ ( STR$ (i%,"99")) + ".geadr"
       abb$ = "b" + LTRIM$ ( STR$ (i%,"99")) + ".geadr"
       aba$ = "a" + LTRIM$ ( STR$ (i%,"99")) + ".geadr"
       IF abt$$ <> "" THEN 
         BLANK FILE GTelDat$
         codeku.GTelDat$ = codeku%
         art.GTelDat$ = abb$$ + " " + aba$$
         codetel.GTelDat$ = SER (GTelDat$)
         Nummer.GTelDat$ = abt$$
         FonOderFax.GTelDat$ = "n"
         Workstation.GTelDat$ = Workstation%
         QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
         RecStatus.GTelDat$ = "c"
         Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
         Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
         STORE FILE GTelDat$
       END IF 
     NEXT i%
 
     FILE "Geadr"
     SELECT KEY codege% LOCK FILE "geadr" INDEX codege.geadr
     codeku.geadr = codeku%
     Postanschrift.geadr = p$
     STORE FILE "Geadr"
     MOUSE OFF 
 END SUB 
 
 
 ' Serienbrief an Agenturen
 ' =================================================================================
 
SUB MASerie()
 maser% = 1
 IF OPEN ("adrtemp") THEN 
   REM CLOSE FILE "ADRTEMP"
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 ELSE 
   CALL DFile(2,"OFFICE\adrtemp" + _fpw$)
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "ADRTEMP"
 FILE "MAADR"
 INDEX Nachname.MAADR
 SELECT FIRST 
 MOUSE OFF 
 a% = 0
 b% = RECCOUNT ("MAADR")
 IF b% > 20000 THEN 
   b% = 20000
   REDIM AdrFound$(20000,1)
   REDIM AdrFound$(20000)
 ELSE 
   REDIM AdrFound$( RECCOUNT ("MAADR"),1)
   REDIM AdrFound$( RECCOUNT ("MAADR"))
 END IF 
 FOR a% = 0 TO b%
   AdrFound$(a%) = ""
 NEXT a%
 a% = 0
 
 REM 29032000
 gnab$ = "Sie erhalten zusÑtzlich die Mîglichkeit Agenturadressen, die in der Kunden-Adressdatei schon vorhanden sind, aktualisieren zu lassen"
 gnab$ = gnab$ + " Bedenken Sie jedoch, da· dann aus der Adressdatei der Agenturen die Felder Åbernommen werden und evt.énderungen, die Sie nur in der Kunden-Adress-Datei"
 gnab$ = gnab$ + " vorgenommen haben, verloren gehen! "
 gnab0$ = "Es werden jetzt alle Agenturadressen, die in der Kunden-Adressdatei noch nicht vorhanden sind, in diese Åbernommen! "
 gnab0$ = gnab0$ + "Als Kennzeichen erhalten diese Adressen in der Kundennummer das Kennzeichen <M> und weiterhin einen Eintrag im Feld Agenturadresse=j. öber diese Felder kînnen Sie im Adress-Suche-Dialog suchen!"
 REM CALL Fehler(gnab0$,gnab$)
 gnab0$ = gnab0$ + CHR$ (13) + CHR$ (13) + gnab$
 gnab1$ = "Mîchten Sie die énderungen in den Adressen der Agenturdatei, in die Kunden-Adressdatei Åbernehmen?"
 
    DIM dlg1 AS Dialog
    DIM control1 AS DialogControl
 
    Superbase.Dialogs.Add("LHELP")
    SET dlg1 = Superbase.Dialogs.LHELP
    dlg1.Move(0,0,302,159)
    dlg1.Caption = "Hilfe"
    dlg1.FontName = "MS Sans Serif"
    dlg1.FontSize = 8
 
    SET control1 = dlg1.Add("DialogFrame2","DialogFrame")
    control1.Move(0,3,301,135)
    control1.Caption = ""
 
    SET control1 = dlg1.Add("DialogIcon1","DialogIcon")
    control1.Move(6,17,22,21)
    control1.Icon = 2
 
    SET control1 = dlg1.Add("DialogLabel1","DialogLabel")
    control1.Move(6,41,291,92)
    control1.CaptionBinding = "gnab0$"
 
    SET control1 = dlg1.Add("DialogCommandButton3","DialogCommandButton")
    control1.Move(125,143,55,14)
    control1.Caption = "&OK"
    control1.ReturnValue = 0
  
     DIM dlg AS Dialog
    DIM control AS DialogControl
 
    Superbase.Dialogs.Add("TLISTE")
    SET dlg = Superbase.Dialogs.TLISTE
    dlg.Move(0,0,288,67)
    dlg.Caption = "Adressaktualisierungen"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame2","DialogFrame")
    control.Move(0,2,286,46)
    control.Caption = ""
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(30,16,255,23)
    control.Caption = "Mîchten Sie die énderungen in den Adressen der Agenturdatei, in die Kunden-Adressdatei Åbernehmen?"
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(6,16,22,20)
    control.Icon = 2
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(58,49,55,15)
    control.Default = 1
    control.Caption = "&Ja"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(114,49,55,15)
    control.Caption = "&Nein"
    control.ReturnValue = 0
 
    SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
    control.Move(170,49,55,15)
    control.Caption = "&Hilfe"
    control.ReturnValue = 0
    control.NestedDialogName = "LHELP"
 
 
  
 
 
 DIALOG "TLISTE",req1%
 REMOVE DIALOG ALL 
 
 
 REM REQUEST "Mîchten Sie die énderungen in den Adressen der Agenturdatei","in die Kunden-Adressdatei Åbernehmen?",130,req1%
 SELECT FIRST FILE "maadr"
 WHILE NOT EOF ("MAADR")
   MOUSE OFF 
   IF nachname.maadr <> "<ohne Zuordnung>" AND nachname.maadr <> "NEU" THEN 
     codeku% = codeku.MAADR
     codema% = codema.MAADR
     IF NOT EXISTS (codeku%,codeku.GAdrDat$) THEN 
       CALL MAADRZuADR(codema%,0)
       SELECT KEY codema% FILE "MAADR" INDEX codema.MAADR
     ELSE 
       IF req1% = 1 THEN 
         CALL MAADRZuADR(codema%,codeku%)
       END IF 
     END IF 
     codeku% = codeku.MAADR
     BLANK FILE "adrtemp"
     codeadrt% = SER ("ADRTEMP",1)
     codeadrt.adrtemp = codeadrt%
     Kundennummer.adrtemp = Agenturnr.maadr
     codeku.adrtemp = codeku.MAADR
     Anrede.adrtemp = Anrede.MAADR
     Name1.adrtemp = Vorname.MAADR
     Name2.adrtemp = Nachname.MAADR
     zuHaenden.adrtemp = Anrede.MAADR + " " + Vorname.MAADR + " " + Nachname.MAADR
     Strasse.adrtemp = Stra·e.MAADR
     PLZ.adrtemp = PLZ.MAADR
     Ort.adrtemp = Ort.MAADR
     Telart1.adrtemp = "Telefon1"
     Telnr1.adrtemp = Telefon1.MAADR
     Telart2.adrtemp = "Telefon2"
     Telnr2.adrtemp = Telefon2.MAADR
     Telart2.adrtemp = "Fax"
     Telnr2.adrtemp = Telefax.MAADR
     FaxJN3.adrtemp = "j"
     Postanschrift.adrtemp = Postanschrift.maadr
     STORE FILE "adrtemp"
     AdrFound$(a%) = Nachname.MAADR + ", " + Vorname.MAADR + ", " + Agenturnr.maadr + STR$ (codeadrt%,"000000")
     a% = a% + 1
   END IF 
   FILE "MAADR"
   SELECT NEXT FILE "MAADR"
 WEND 
 MOUSE ON 
 REM CALL Fehler("","")
 CALL SerieNeu1("ADRTEMP")
 
 END SUB 
 
 'Aufnahme MAADR in Adressen
 'stat%=0 Neuaufnahme
 'stat%=codeku% Test auf Vorhandensein der Geadr in Adressen und Felder aktualisieren
 
SUB MAADRZuADR(codema%,stat%)
 
     SELECT KEY codema% FILE "MAADR" INDEX codema.MAADR
     IF stat% = 0 THEN 
       BLANK FILE GAdrDat$
       codeku% = SER (GAdrDat$,1)
       codeku.GAdrDat$ = codeku%
       SELECT FIRST LOCK FILE "stamm"
       nnum% = LastKunr.stamm + 1
       LastKunr.stamm = nnum%
       STORE FILE "Stamm"
       UNLOCK CURRENT FILE "stamm"
       SELECT FIRST FILE "Stamm"
       MOUSE OFF 
       REM IF proserv$ <> "TRUE" THEN Kundennummer.GAdrDat$ = "K" + LTRIM$ ( STR$ (nnum%,"999999"))
       Kundennummer.GAdrDat$ = "<A>" + LTRIM$ ( STR$ (nnum%,"999999"))
 
     ELSE 
       codeku% = stat%
       SELECT KEY codeku% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
       codeku% = codeku.GAdrDat$
       REM REMOVE FROM FILE GTelDat$ WHERE codeku.GTelDat$ = codeku%
     END IF 
     
     Anrede.GAdrDat$ = Anrede.maadr
     Nachname.GAdrDat$ = Nachname.maadr
     Vorname.GAdrDat$ = Vorname.maadr
     SET STATUS "In Arbeit: " + Nachname.maadr
     Geburtsname.GAdrDat$ = "Agenturnr: " + Agenturnr.maadr
     IF anrede.maadr LIKE "Herr*" THEN 
       Briefanrede = "Sehr geehrter Herr " + Nachname.maadr
     ELSE 
       Briefanrede = "Sehr geehrte Frau " + Nachname.maadr
     END IF 
     ort.GAdrDat$ = Ort.MAADR
     plz.GAdrDat$ = plz.MAADR
     stra·e.GAdrDat$ = stra·e.MAADR
     K1Bank.GAdrDat$ = K1Bank.maadr
     K1Konto.GAdrDat$ = K1Konto.maadr
     K1BLZ.GAdrDat$ = K1BLZ.maadr
     Geburtstag.GAdrDat$ = Geburtstag.maadr
     Kunde_seit.GAdrDat$ = MAseit.maadr
     beruf.GAdrDat$ = Beruf.maadr
     AAGesellschaft.GAdrDat$ = "n"
     AAKunde.GAdrDat$ = "n"
     AAMakler.GAdrDat$ = "n"
     AAMitarbeiter.GAdrDat$ = "j"
     AAInteressent.GAdrDat$ = "n"
     AALieferant.GAdrDat$ = "n"
     FIPrivat.GAdrDat$ = "n"
     FIATEC.GAdrDat$ = "j"
     FIIMMAK.GAdrDat$ = "n"
     BerProtok.GADRDat$ = "n"
     notiz.GAdrDat$ = Notiz.MAADR
     IF postanschrift.maadr <> "" AND Postanschrift.GAdrDat$ = "" THEN 
       Postanschrift.GAdrDat$ = postanschrift.maadr
     END IF 
     IF Postanschrift.GAdrDat$ = "" THEN 
       REM CALL Fehler("","NeuPost% = - 1")
       p$ = ""
       IF anrede.GAdrDat$ LIKE "Herr*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
         p$ = Anrede.GAdrDat$ + " "
         IF LTRIM$ (Titel.GAdrDat$) <> "" THEN 
           p$ = p$ + " " + LTRIM$ (Titel.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + CHR$ (13) + CHR$ (10)
         END IF 
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (Vorname.GAdrDat$) + " " + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10)
         IF _projekt$ LIKE "FACTURA" THEN 
         ELSE 
           p$ = p$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
         END IF 
       ELSE 
         p$ = LTRIM$ (Anrede.GAdrDat$) + " " + LTRIM$ (titel.GAdrDat$) + CHR$ (13) + CHR$ (10)
         IF Geburtsname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (nachname.GAdrDat$) + CHR$ (13) + CHR$ (10) + LTRIM$ (geburtsname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + LTRIM$ (Nachname.GAdrDat$) + CHR$ (13) + CHR$ (10)
         END IF 
         IF vorname.GAdrDat$ <> "" THEN 
           p$ = p$ + LTRIM$ (Vorname.GAdrDat$) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10)
         ELSE 
           p$ = p$ + CHR$ (13) + CHR$ (10)
         END IF 
         p$ = p$ + Stra·e.GAdrDat$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + plz.GAdrDat$ + " " + Ort.GAdrDat$ + CHR$ (13) + CHR$ (10)
         IF land.GAdrDat$ <> "" THEN p$ = p$ + CHR$ (13) + CHR$ (10) + Land.GAdrDat$
         IF _projekt$ LIKE "FACTURA" THEN 
         ELSE 
           p$ = p$ + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + CHR$ (13) + CHR$ (10) + briefanrede.GAdrDat$
         END IF 
       END IF 
       Postanschrift.GAdrDat$ = p$
     END IF 
 
 
 
     CALL QuickStore(GAdrDat$)
     posta$ = Postanschrift.GAdrDat$
     MOUSE OFF 
    IF NOT EXISTS (codeku%,codeku.GTelDat$) THEN 
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "Telefon1:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = Telefon1.MAADR
     FonOderFax.GTelDat$ = "n"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "Telefon2:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = Telefon2.MAADR
     FonOderFax.GTelDat$ = "n"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "Telefax:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = Telefax.MAADR
     FonOderFax.GTelDat$ = "j"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
     BLANK FILE GTelDat$
     codeku.GTelDat$ = codeku%
     art.GTelDat$ = "email:"
     codetel.GTelDat$ = SER (GTelDat$)
     Nummer.GTelDat$ = email.MAADR
     FonOderFax.GTelDat$ = "n"
     Workstation.GTelDat$ = Workstation%
     QWoNo.GTelDat$ = STR$ (Workstation%,"000000") + STR$ (codetel.GTelDat$,"000000")
     RecStatus.GTelDat$ = "c"
     Qart.GTelDat$ = VSNRPack$(art.GTelDat$)
     Qnummer.GTelDat$ = VSNRPack$(nummer.GTelDat$)
     STORE FILE GTelDat$
    END IF 
     abf$ = "t"
 
     FILE "MAADR"
     SELECT KEY codema% LOCK FILE "MAADR" INDEX codema.MAADR
     Postanschrift.maadr = postanschrift.GAdrDat$
     codeku.MAADR = codeku%
     CALL QuickStore("MAADR")
 END SUB 
 
 
 
 
 ' QuickCode-Erzeugung fÅr Versicherungsnummer
 ' =======================================================================
 
FUNCTION VSNRPack$(VSNR$)
 tVSNR$ = ""
 FOR a% = 1 TO LEN (VSNR$)
   tC$ = UCASE$ ( MID$ (VSNR$,a%,1))
         x% = ASC ( LEFT$ ( UCASE$ (tC$),1))
         SELECT CASE x%
           CASE 142
             tC$ = "AE"
           CASE 153
             tC$ = "OE"
           CASE 154
             tC$ = "UE"
         END SELECT 
         IF tc$ LIKE "·" THEN tc$ = "SS"
   SELECT CASE tC$
   CASE "A" TO "Z","0" TO "9"
     tVSNR$ = tVSNR$ + tC$
   END SELECT 
 NEXT a%
 VSNRPack$ = tVSNR$
 END FUNCTION 
  
FUNCTION VSNRPackNum$(VSNR$)
 tVSNR$ = ""
 null% = - 1
 FOR a% = 1 TO LEN (VSNR$)
   tC$ = UCASE$ ( MID$ (VSNR$,a%,1))
   SELECT CASE tC$
     CASE "0"
       IF null% <> - 1 THEN 
         tVSNR$ = tVSNR$ + tC$
       END IF 
     CASE "1" TO "9"
       null% = 0
       tVSNR$ = tVSNR$ + tC$
     CASE "a" TO "z","A" TO "Z"
       IF null% <> - 1 THEN 
         tVSNR$ = tVSNR$ + tC$
       END IF 
   END SELECT 
 NEXT a%
 VSNRPackNum$ = tVSNR$
 END FUNCTION 
 
FUNCTION VSNRPack1$(VSNR$)
 tVSNR$ = ""
 FOR a% = 1 TO LEN (VSNR$)
   tC$ = UCASE$ ( MID$ (VSNR$,a%,1))
         x% = ASC ( LEFT$ ( UCASE$ (tC$),1))
         SELECT CASE x%
           CASE 142
             tC$ = "AE"
           CASE 153
             tC$ = "OE"
           CASE 154
             tC$ = "UE"
         END SELECT 
         IF tc$ LIKE "·" THEN tc$ = "SS"
   SELECT CASE tC$
   CASE "A" TO "Z","0" TO "9"
     tVSNR$ = tVSNR$ + tC$
   END SELECT 
 NEXT a%
 VSNRPack1$ = tVSNR$
 END FUNCTION 
 
 
 
 
 '      ******************************************
 '      ** Routinen fÅr Vertragsnachbearbeitung **
 '      ******************************************
 
 
SUB Vorgang()
 IF disabled%("VORGANG") THEN END SUB 
 CALL DFile(3,"VORGANG" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 cuvt% = lfdnr.KVERTRAG
 indexKVer$ = INDEX 
 FILE "KVERTRAG"
 INDEX lfdnr.kvertrag
 FILE "vorgang"
 SELECT KEY cuvt% INDEX CodeVT.VORGANG
 test22% = lfdnr.kvertrag
 _continue% = 1
 IF NOT FOUND ("VORGANG") THEN 
   _continue% = 0
   REM IF ag$ <> "j" THEN 
     
     REQUEST "Es wurden noch keine VorgÑnge fÅr diesen Vertrag erfa·t!","Erfassung fortsetzen?",130,req%
     IF req% = 1 THEN 
       IF disabled%("VORGANGNEU") THEN 
         _continue% = 0
       ELSE 
         _continue% = 1
       END IF 
     END IF 
   REM ELSE 
     REM CALL Fehler ("Es wurden keine VorgÑnge fÅr diesen Vertrag erfa·t!","")
   REM END IF 
 END IF 
 IF _continue% = 1 THEN 
   _formend% = 0
   WHILE _formend% = 0
     ON ERROR GOTO ErrorHandler
     FORMsub% = 0
     IF UCASE$ ( FORM ) <> "VORGANG" THEN 
       IF EXISTS (GPrjForm$ + "VORGANG.sbv") THEN 
         OPEN FORM GPrjForm$ + "VORGANG"
       ELSE 
         OPEN FORM GPrjForm$ + "VORGANG"
       END IF 
       REM OPEN FORM "VORGANG"
       REM SET HEADING title$ + " - Nachbearbeitung"
       IF anrede.GAdrDat$ LIKE "Her*" OR anrede.GAdrDat$ LIKE "Fr*" OR anrede.GAdrDat$ LIKE "Fam*" OR anrede.GAdrDat$ LIKE "Ehe*" THEN 
         n$ = LEFT$ (( LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Vorname.GAdrDat$)),60)
         SET HEADING "VorgÑnge von: " + n$
       ELSE 
         n$ = LEFT$ (( LTRIM$ (nachname.GAdrDat$) + "," + LTRIM$ (Geburtsname.GAdrDat$)),60)
         n% = LEN (n$)
         REM CALL Fehler( STR$ (n%,"999"),"")
         SET HEADING "VorgÑnge von: " + n$
       END IF 
       
       SET f = Superbase.Form
       CALL VorgangIntro()
       IF _formend% = 1 THEN GOTO endvorg230597
       abfo$ = FORM 
       REM CALL MNVORGANG()
       MENU ON 
       SET STATUS "Vertragsnachbearbeitung"
     END IF 
     CALL MNVORGANG()
     FORM 
     MOUSE ON 
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     CALL ClearKBDBuffer()
     MENU ON 
   IF PAGE = 1 THEN 
     sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.kvertrag,",9999.0000"))
     SET STATUS sq$
   END IF 
     IF FORMsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
     GET k$
     IF k$ = CHR$ (27) THEN _formend% = 1
     SELECT CASE FORMsub%
     CASE 1
       CALL VorgangSuchen()
     CASE 2
       CALL VorgangNext()
     CASE 3
       CALL VorgangPrev()
     CASE 4
       CALL VORGDruck()
     CASE 5
       codevg1% = codevg.vorgang
       Gcuvg% = codevg.vorgang
       cuvt% = lfdnr.kvertrag
       REM FORM 2
       CALL VorgangEinz(codevg1%)
       REM SELECT FORM KEY codevg1% FILE "vorgang" INDEX codevg.vorgang
       REM SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
       REM SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
       REM FORM 
     CASE 6
       
       FORM 1
       SELECT FORM KEY cuvt% FILE "vorgang" INDEX codevt.vorgang
       FORM 
     CASE 99
       IF NOT disabled%("VORGANGBEARB") THEN 
       codevg1% = codevg.vorgang
       cuvt% = lfdnr.kvertrag
       REM FORM 2
       CALL VorgangEinz(codevg1%)
         REM 140697 f.druck.enabled = - 1
         IF abbruch% = - 1 THEN 
           SELECT KEY codevg% FILE "vorgang" INDEX codevg.vorgang
           FORM 
           abbruch% = 0
         END IF 
         MENU ON 
       END IF 
     END SELECT 
     FORMsub% = 0
endvorg230597: 
   WEND 
 END IF 
 _formend% = 0
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 cuvg% = 0
 vform% = - 1
 FILE "KVERTRAG"
 INDEX indexKVer$
 END SUB 
 

SUB VorNoteBig(fnam$,dd$)
   notizn$ = fnam$ + "." + dd$
   LÑnge$ = FIELDINFO$ (notizn$,4)
   lÑnge% = VAL (LÑnge$)
   inh$ = notizn$$
   SET EDIT SELECT OFF 
   SET EDIT SELECT ON 
   nr$ = n$ + " VS-Nr: " + VS_NR.vorgang
   CREATE DIALOG GTelDat$,0,0,443,253,"Notiz","MS Sans Serif",8
   ADD DIALOG GTelDat$,5,5,6,56,10,0,"Kunde:"
   ADD DIALOG GTelDat$,5,62,6,380,9,128,nr$
   ADD DIALOG GTelDat$,5,5,22,165,10,0,"Notiz: zum Zeilenumbruch Strg+Enter drÅcken"
   REM ADD DIALOG GTelDat$,6,5,32,430,200,4,0,inh$
   ADD DIALOG GTelDat$,6,5,32,430,200,4,3,inh$,lÑnge%
   ADD DIALOG GTelDat$,1,170,235,55,15,1,"&OK",1,1
   ADD DIALOG GTelDat$,1,237,235,55,15,0,"&Drucken",2,2
   DIALOG GTelDat$,req%
   REMOVE DIALOG ALL 
   IF inh$ <> notizn$$ THEN 
     REM es wurde geÑndert
     IF NOT disabled%("VORGANGBEARB") THEN 
       REQUEST "énderungen speichern?","",130,req%
       IF req% = 1 THEN 
         SELECT CURRENT LOCK FILE dd$
         notizn$$ = LEFT$ (inh$,lÑnge%)
         CALL QuickStore(dd$)
       END IF 
     END IF 
   END IF 
   IF req% = 2 THEN 
     PRINT ;
     ? inh$
     DISPLAY ;
   END IF 
   SET EDIT SELECT ON 
 END SUB 
 


SUB VorgangKU(codevg%)
 IF disabled%("VORGANG") THEN END SUB 
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 cuvt% = lfdnr.KVERTRAG
 FILE "vorgang"
 SET INDEX quickcodeKU.vorgang
 INDEX quickcodeKU.vorgang
 SELECT KEY codevg% INDEX CodeVG.VORGANG
 _continue% = 1
 IF NOT FOUND ("VORGANG") THEN 
   _continue% = 0
   REQUEST "Es wurden noch keine VorgÑnge fÅr diesen Vertrag erfa·t!","Erfassung fortsetzen?",130,req%
   IF req% = 1 THEN 
     _continue% = 1
   END IF 
 END IF 
 IF _continue% = 1 THEN 
   _formend% = 0
   WHILE _formend% = 0
     ON ERROR GOTO ErrorHandler
     FORMsub% = 0
     IF UCASE$ ( FORM ) <> "VORGANG" THEN 
       SET HEADING title$ + " - Nachbearbeitung"
       REM OPEN FORM "VORGANG"
       IF EXISTS (GPrjForm$ + "VORGANG.sbv") THEN 
         OPEN FORM GPrjForm$ + "VORGANG"
       ELSE 
         OPEN FORM GPrjForm$ + "VORGANG"
       END IF 
       SET f = Superbase.Form
       SELECT FORM KEY codevg% FILE "Vorgang" INDEX codevg.vorgang
       REM CALL VorgangIntro()
       CALL MNVORGANG1()
       MENU ON 
       SET STATUS "Vertragsnachbearbeitung"
     END IF 
     FORM 
     MOUSE ON 
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     CALL ClearKBDBuffer()
     IF FORMsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
     GET k$
     IF k$ = CHR$ (27) THEN _formend% = 1
     SELECT CASE FORMsub%
     CASE 1
       CALL VorgangSuchen()
     CASE 2
       CALL VorgangNextKU(codeku.vorgang)
     CASE 3
       CALL VorgangPrevKU(codeku.vorgang)
     CASE 4
       knr% = Codeku.vorgang
       CALL VORG1Druck()
     CASE 99
       MENU OFF 
       CALL ButDesabled()
       REM f.druck.enabled = 0
       codevg% = codevg.vorgang
       ENTER Datum.VORGANG,0
       CALL ButEnabled()
       REM f.druck.enabled = - 1
       IF abbruch% = - 1 THEN 
         SELECT KEY codevg% FILE "vorgang" INDEX codevg.vorgang
         FORM 
         abbruch% = 0
       END IF 
       MENU ON 
     END SELECT 
     FORMsub% = 0
   WEND 
 END IF 
 _formend% = 0
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 cuvg% = 0
 vform% = - 1
 FILE "KVERTRAG"
 END SUB 
 
 
  
 
 
 
 
 ' VORGANG Intro
 ' =======================================================================
 
SUB VorgangIntro()
 FILE "VORGANG"
 INDEX CodeVT.VORGANG
 SELECT FIRST FILE "kvertrag"
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 REM SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 REM SELECT FORM KEY cuvt% FILE "VORGANG" INDEX CodeVT
 IF NOT EXISTS (cuvt%,codevt.VORGANG) THEN 
   CALL VorgangNeu()
   END IF 
 END IF 
 SELECT FORM KEY cuvt% FILE "VORGANG" INDEX CodeVT.vorgang
 FORM 
 END SUB 
 
 
 ' Vorgang Neu
 ' =======================================================================
 
SUB VorgangNeu()
 REM IF NEW ("VORGANG") OR MOD ("VORGANG") THEN CALL FStore("VORGANG")
 test22% = lfdnr.kvertrag
 IF cuvt% > 0 THEN 
   SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 END IF 
 IF Codeku.kvertrag < 1 OR CodeMA.kvertrag < 1 OR CodeGE.kvertrag < 1 THEN 
   CALL Fehler("Sie mÅssen fÅr den Vertrag eine Gesellschaft, eine Sparte und einen Mitarbeiter","eingetragen haben, um einen Nachbearbeitungstermin erfassen zu kînnen!!!")
   _formend% = 1
 ELSE 
   BLANK FORM 
   SET STATUS "Datensatz neu angelegt..."
   Datum.VORGANG = TODAY 
   CodeVG.VORGANG = SER ("VORGANG",1)
   CodeVT.VORGANG = cuvt%
   schadenjn.vorgang = "j"
   CodeMA.VORGANG = CodeMA.KVERTRAG
   CodeKU.Vorgang = CodeKU.kvertrag
   workstation.vorgang = workstation.kvertrag
   CALL QuickStore("vorgang")
 FORM 2
 END IF 
 FORMsub% = 99
 END SUB 
 
 
 ' Vorgang Sichern
 ' =======================================================================
 
SUB VorgangSichern()
   IF zahlung1 <> 0 OR zahlung2 <> 0 OR zahlung3 <> 0 OR zahlung4 <> 0 OR zahlung5 <> 0 OR zahlung6 <> 0 OR zahlung7 <> 0 THEN 
     gezahlt.vorgang = zahlung1 + zahlung2 + zahlung3 + zahlung4 + zahlung5 + zahlung6 + zahlung7 
   END IF 
   CALL FStore("VORGANG")
   CALL AQNRegister()
 END SUB 
 
 
 ' VORGANG Eintrag zurÅck
 ' =======================================================================
 
SUB VorgangPrev()
 IF MOD ("VORGANG") OR NEW ("VORGANG") THEN CALL FStore("VORGANG")
 cuvg% = CodeVG.VORGANG
 SELECT FORM PREVIOUS INDEX CodeVT.VORGANG
 IF CodeVT.VORGANG <> cuvt% THEN 
   REQUEST "Dateianfang erreicht!","",2
   SELECT FORM KEY cuvg% INDEX CodeVG.VORGANG
 END IF 
 FORM 
 END SUB 
 
SUB VorgangPrevKU(codeku%)
 FILE "Vorgang"
 IF MOD ("VORGANG") OR NEW ("VORGANG") THEN CALL FStore("VORGANG")
 cuvg% = CodeVG.VORGANG
 codeku$ = STR$ (codeku%,"000000")
 SELECT FORM PREVIOUS INDEX QuickCodeKU.VORGANG
 IF CodeKU.VORGANG <> codeku% THEN 
   REQUEST "Dateianfang erreicht!","",2
    SELECT FORM KEY codeku$ INDEX QuickCodeKU.VORGANG
 END IF 
 FORM 
 END SUB 
  
 ' Vorgang Eintrag vor
 ' =======================================================================
SUB VorgangNext()
 IF MOD ("VORGANG") OR NEW ("VORGANG") THEN CALL FStore("VORGANG")
 cuvg% = CodeVG.VORGANG
 SELECT FORM NEXT INDEX CodeVT.VORGANG
 IF CodeVT.VORGANG <> cuvt% THEN 
   REQUEST "Dateianfang erreicht!","",2
   SELECT FORM KEY cuvg% INDEX CodeVG.VORGANG
 END IF 
 FORM 
 END SUB 
  
 
 
SUB VorgangNextKU(codeku%)
 FILE "Vorgang"
 IF MOD ("VORGANG") OR NEW ("VORGANG") THEN CALL FStore("VORGANG")
 cuvg% = CodeVG.VORGANG
 codeku$ = STR$ (codeku%,"000000")
 SELECT FORM NEXT INDEX QuickCodeKU.VORGANG
 IF Codeku.VORGANG <> codeku% THEN 
   REQUEST "Dateiende erreicht!","",2
   SELECT FORM KEY codeku$ INDEX QuickCodeKU.VORGANG
 END IF 
 FORM 
 END SUB 
 
 
 ' VORGANG lîschen
 ' =======================================================================
 
SUB VorgangLoeschen()
 IF disabled%("VORGANGLOE") THEN END SUB 
 cuvg% = CodeVG.VORGANG
 REQUEST "Vorgang wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   d$ = FILE 
   FILE "vorgang"
   SELECT FIRST 
   SELECT KEY cuvg% LOCK FILE "VORGANG" INDEX CodeVG.VORGANG
   SELECT REMOVE FILE "VORGANG"
   SELECT KEY cuvt% FILE "VORGANG" INDEX CodeVT.VORGANG
   IF NOT FOUND ("VORGANG") THEN 
     CALL Fehler("Keine weiteren Daten vorhanden!","")
     _formend% = 1
   END IF 
   FILE d$
   FORM 
 END IF 
 FORM 
 END SUB 
 
 
 ' Vorgang Suchen
 ' =======================================================================
 ' 12.09.95  - neue Variante/Umstellung REQ25 auf Dialogauswahl
 
SUB VorgangSuchen()
 a% = VORGSuchen%(CodeVT.VORGANG)
 IF a% <> 0 THEN 
   SELECT FORM KEY a% FILE "VORGANG" INDEX CodeVG.VORGANG
   FORM 
 ELSE 
   CALL Fehler("Keine weiteren VorgÑnge gefunden!","")
 END IF 
 END SUB 
 
 REM 220597
SUB VorgSuchKund()
 codeku1% = CodeKU.GAdrDat$
 codeku% = CodeKU.GAdrDat$
 codeku$ = STR$ (Codeku%,"000000") + "*"
 a% = VORGSuchKU%(CodeKU.GAdrDat$)
 IF a% <> 0 THEN 
   FILE "Vorgang"
   INDEX QuickCodeKU.vorgang
   SELECT WHERE QuickCodeKU.vorgang LIKE codeku$
   SELECT FORM KEY a% FILE "VORGANG" INDEX CodeVG.VORGANG
   cuvt% = CodeVT.vorgang
   codevg% = a%
   CALL VorgangKU(codevg%)
   SELECT WHERE FILE "Vorgang"
 ELSE 
   CALL Fehler("Keine VorgÑnge gefunden!","")
 END IF 
 SELECT FORM KEY codeku1% FILE GAdrDat$ INDEX codeku.GAdrDat$
 FORM 
 END SUB 
  
 ' VorgÑnge aus Vorgangsdatei suchen
 ' =======================================================================
 ' 12.09.95 
 
FUNCTION VORGSuchen%(vnr%)
 MOUSE OFF 
 cfile$ = FILE 
 cvorg% = CodeVG.VORGANG
 FILE "VORGANG"
 INDEX QuickCode.VORGANG
 sq$ = STR$ (vnr%,"000000") + "000000"
 SELECT FIRST 
 SELECT KEY sq$ FILE "VORGANG" INDEX QuickCode.VORGANG
 DIM VORGListe$( RECCOUNT ("VORGANG"))
 DIM Auswahl$(0)
 a% = 0
 WHILE CodeVT.VORGANG = vnr% AND NOT EOF ("VORGANG")
   VORGListe$(a%) = DATE$ (Datum,"0d.mm.yyyy") + " [" + IF (erledigt LIKE "j","j","n") + "] " + IF ( LEN (Beschreibung) > 30, LEFT$ (Beschreibung,30) + "...",Beschreibung) + SPACE$ (80) + STR$ (CodeVG,"000000")
   IF CodeVG = cvorg% THEN prompt$ = VORGListe$(a%)
   a% = a% + 1
   SELECT NEXT 
 WEND 
 CREATE DIALOG "VORGSU",0,0,216,168,title$,"MS Sans Serif",8
 ADD DIALOG "VORGSU",9,4,9,22,22,2
 ADD DIALOG "VORGSU",5,28,9,178,10,0,"Liste aller bekannten VorgÑnge zum aktuellen Vertrag"
 ADD DIALOG "VORGSU",4,28,19,178,5,0,""
 ADD DIALOG "VORGSU",5,28,27,178,20,0,"Bitte wÑhlen Sie aus der Liste den Vorgang aus, den Sie bearbeiten mîchten:"
 ADD DIALOG "VORGSU",7,28,50,178,89,0,2,VORGListe$,Auswahl$,prompt$
 ADD DIALOG "VORGSU",1,49,147,55,15,1,"&OK",1,1
 ADD DIALOG "VORGSU",1,106,147,55,15,0,"&Abbrechen",0,0
 DIALOG "VORGSU",req%
 REMOVE DIALOG "VORGSU"
 IF req% = 1 THEN 
   VORGSuchen% = VAL ( RIGHT$ (Auswahl$(0),6))
 ELSE 
   VORGSuchen% = 0
 END IF 
 FILE cfile$
 SELECT KEY cvorg% FILE "VORGANG" INDEX CodeVG.VORGANG
 MOUSE ON 
 END FUNCTION 
 
 
 
FUNCTION VORGSuchKU%(codeku%)
 CALL DFile(3,"VORGANG" + _fpw$)
 MOUSE OFF 
 cfile$ = FILE 
 REM cvorg% = CodeVG.VORGANG
 FILE "VORGANG"
 INDEX QuickCodeKU.VORGANG
 SELECT WHERE 
 sq$ = STR$ (codeku%,"000000") + "000000"
 SELECT FIRST 
 SELECT KEY sq$ FILE "VORGANG" INDEX QuickCodeKU.VORGANG
 DIM VORGListe$( RECCOUNT ("VORGANG"))
 DIM Auswahl$(0)
 a% = 0
 WHILE Codeku.VORGANG = codeku% AND NOT EOF ("VORGANG")
   VORGListe$(a%) = DATE$ (Datum,"0d.mm.yyyy") + " [" + IF (erledigt LIKE "j","j","n") + "] " + IF ( LEN (Kurznotiz) > 30, LEFT$ (Kurznotiz,30) + "...",Kurznotiz) + SPACE$ (80) + STR$ (CodeVG,"000000")
   
   a% = a% + 1
   SELECT NEXT 
 WEND 
 CREATE DIALOG "VORGSU",0,0,216,168,title$,"MS Sans Serif",8
 ADD DIALOG "VORGSU",9,4,9,22,22,2
 ADD DIALOG "VORGSU",5,28,9,178,10,0,"Liste aller bekannten VorgÑnge zum Kunden"
 ADD DIALOG "VORGSU",4,28,19,178,5,0,""
 ADD DIALOG "VORGSU",5,28,27,178,20,0,"Bitte wÑhlen Sie aus der Liste den Vorgang aus, den Sie bearbeiten mîchten:"
 ADD DIALOG "VORGSU",7,28,50,178,89,0,2,VORGListe$,Auswahl$,prompt$
 ADD DIALOG "VORGSU",1,29,147,55,15,1,"&OK",1,1
 ADD DIALOG "VORGSU",1,86,147,55,15,0,"&Abbrechen",0,0
 ADD DIALOG "VORGSU",1,144,147,55,15,1,"&Drucken",2,1
 DIALOG "VORGSU",req%
 REMOVE DIALOG "VORGSU"
 IF req% = 1 THEN 
   VORGSuchKU% = VAL ( RIGHT$ (Auswahl$(0),6))
   cvg% = VORGSuchKU%
 ELSE 
   IF req% = 2 THEN 
     knr% = Codeku.GAdrDat$
     SELECT KEY cvg% FILE "vorgang" INDEX codevg.vorgang
     CALL VORG1Druck()
   ELSE 
     VORGSuchKU% = 0
   END IF 
 END IF 
 FILE cfile$
 SELECT KEY cvorg% FILE "VORGANG" INDEX CodeVG.VORGANG
 MOUSE ON 
 END FUNCTION 
 
 
 
 
 
 ' Liste aller VorgÑnge des aktuellen Vertrages ausgeben
 ' =======================================================================
 ' 12.09.95 
 
SUB VORG1Druck()
 MOUSE OFF 
 cfile$ = FILE 
 cvnr% = CodeVT.VORGANG
 cvg% = CodeVG.VORGANG
 knr% = Codeku.GAdrDat$
 CALL PRep("BVORGANG")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
  
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
 GROUP lfdNr.KVERTRAG
 BEFORE GROUP lfdNr.KVERTRAG
     SET REPORT PAGE "H_lfdNr.KVER002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO ErrVorg1Druck
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SELECT ;
     WHERE CodeVT.VORGANG = lfdNr.KVERTRAG AND CodeKU.KVERTRAG = knr% AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeKU.GAdrDat$ = knr% AND CodeVG.VORGANG = cvg%
     ORDER REPORT Gesellschaft.KVERTRAG,Sparte.KVERTRAG,Agentur.KVERTRAG,ProviAb.KVERTRAG,QuickCodeKU.VORGANG
     TO ASK 
 
ErrVorg1Druck: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 FILE cfile$
 SELECT FORM KEY cvg% FILE "VORGANG" INDEX CodeVG.VORGANG
 MOUSE ON 
 END SUB 
 
 
SUB VORGDruck()
 MOUSE OFF 
 cfile$ = FILE 
 cvnr% = CodeVT.VORGANG
 cvg% = CodeVG.VORGANG
 cfile$ = FILE 
 CALL PRep("KVORGANG")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 GROUP CodeVG.VORGANG
 BEFORE GROUP CodeVG.VORGANG
     SET REPORT PAGE "H_CodeVG.VOR002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO ErrVorgDruck
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SELECT ;
     WHERE CodeKU.GAdrDat$ = CodeKU.VORGANG AND CodeVT.VORGANG = lfdNr.KVERTRAG AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND codevt.vorgang = cvnr%
     ORDER REPORT Datum.VORGANG
     TO ASK 
ErrVorgDruck: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 FILE cfile$
 SELECT FORM KEY cvg% FILE "VORGANG" INDEX CodeVG.VORGANG
 MOUSE ON 
 END SUB 
 
 
SUB VORGDruckALL()
 MOUSE OFF 
 cfile$ = FILE 
 cvnr% = CodeVT.VORGANG
 cvg% = CodeVG.VORGANG
 codeku% = codeku.GAdrDat$
 cfile$ = FILE 
 CALL PRep("KVORGAN1")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 GROUP CodeVG.VORGANG
 BEFORE GROUP CodeVG.VORGANG
     SET REPORT PAGE "H_CodeVG.VOR002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO ErrVorgDruck
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SELECT ;
     WHERE CodeKU.GAdrDat$ = CodeKU.VORGANG AND CodeVT.VORGANG = lfdNr.KVERTRAG AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeKU.VORGANG = codeku%
     ORDER REPORT Datum.VORGANG
     TO ASK 
ErrVorgDruck: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 FILE cfile$
 SELECT FORM KEY cvg% FILE "VORGANG" INDEX CodeVG.VORGANG
 MOUSE ON 
 END SUB 
 
  
 ' GEKOND Vorgang ???
 ' =======================================================================
 
SUB TIVORGANG()
 cuvg% = CodeVG.VORGANG
 _formend% = 1
 END SUB 
 
 
SUB AgenturNeu()
 knr% = codeku.GAdrDat$
 IF MOD (GAdrDat$) OR NEW (GAdrDat$) THEN CALL QuickStore(GAdrDat$)
 prompt% = Codema.GAdrDat$
 codema% = GetCodeMA%(prompt%,Workstation%)
 IF codema% > 0 THEN 
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
   SELECT FIRST FILE GAdrDat$ INDEX codeku.GAdrDat$
   SELECT KEY knr% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
   codema.GAdrDat$ = codema%
   AGNachname.GAdrDat$ = Nachname.maadr
   AGVorname.GAdrDat$ = Vorname.maadr
   AGAGNr.gadrdat$ = Agenturnr.maadr
   miab$ = LTRIM$ (vorname.maadr) + "," + Agenturnr.maadr
   agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   IF gasp% <> - 1 THEN 
     agent$ = LTRIM$ (Nachname.maadr) + LTRIM$ (vorname.maadr) + "," + Agenturnr.maadr
   END IF 
   CALL QuickStore(GAdrDat$)
   REM SELECT KEY codema% FILE "maadr" INDEX codema.maadr
   FORM 
 ELSE 
   IF GASP% <> - 1 THEN 
     SELECT KEY knr% LOCK FILE GAdrDat$ INDEX codeku.GAdrDat$
     codema.GAdrDat$ = 0
     AGNachname.GAdrDat$ = ""
     AGVorname.GAdrDat$ = ""
     CALL QuickStore(GAdrDat$)
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     miab$ = LTRIM$ (vorname.maadr) + "," + Agenturnr.maadr
     agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
     FORM 
   END IF 
 END IF 
 END SUB 
 
SUB AgenturNeu1()
 'weist einer ex. Adresse einen neuen Mitarbeiter zu
 'Jan: neu -----------
 IF Workstation.GADRDat$ <> Workstation% AND workstation% > 0 THEN 
                IF gasp% THEN 
                  wks% = Workstation.GADRDat$
                  FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
                    wks% = VisOff%(ii%)
                    aa% = IsWksVisible%(wks%)
                    IF aa% = - 1 AND Workstation.GADRDat$ = wks% THEN 
                      sok% = - 1
                      ii% = VisCount%
                    ELSE 
                      sok% = 0
                    END IF 
                  NEXT ii%
                ELSE 
                  sok% = - 1
                END IF 
    IF sok% <> - 1 THEN 
      CALL Fehler("Diese Adresse gehîrt zu einem anderen BÅro!","Sie haben keine Berechtigung zum VerÑndern dieser Adresse.")
      END SUB 
    END IF 
    
 END IF 
 'Jan ende -----------
 
 knr% = codeku.GADRDat$
 IF MOD (GADRDat$) OR NEW (GADRDat$) THEN CALL QuickStore(GADRDat$)
 prompt$ = STR$ (Codema.GADRDat$,"000000")
 IF workstation% = 0 THEN 
   IF BZwang.stamm = 0 THEN 
     a% = SelectOffice%("VorgÑnger-Auswahl","",1,0)
     IF a% <> - 1 THEN 
       zzz% = a%
       wks% = zzz%
       REM codema% = VAL (GetWkscodema$(prompt$,wks%))
       codema% = GetCodeMA%(_cuma%,Wks%)
     ELSE 
       CALL Fehler("BÅroauswahl abgebrochen!","")
       codema% = 0
     END IF 
   ELSE 
     codema% = GetCodeMA%(_cuma%,0)
   END IF 
 ELSE 
   REM codema% = VAL (GetWkscodema$(prompt$,Workstation.GADRDat$))
   wks1% = Workstation%
   codema% = GetCodeMA%(ma%,Wks1%)
 END IF 
 IF codema% <> 0 THEN 
   SELECT KEY knr% LOCK FILE GADRDat$ INDEX codeku.GADRDat$
   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
   codema.GADRDat$ = codema%
   AGNachname.GADRDat$ = LEFT$ (Nachname.maadr,30)
   AGVorname.GADRDat$ = LEFT$ (Vorname.maadr,30)
   AGAGNr.GADRDat$ = LEFT$ (Agenturnr.maadr,20)
   REM 06092001
   Workstation.GADRDat$ = Workstation.maadr
   'Jan: modi -------------
   'Workstation.GADRDat$ = Workstation.maadr
   'Jan ende --------------   
   STORE FILE GADRDat$
   UNLOCK CURRENT FILE GAdrDat$
   UNLOCK FILE GAdrDat$
   'Jan neu -----------------------
   REM CALL WriteTo(GADRDat$)
   'Jan ende -----------------------   
   SELECT KEY codema% FILE "maadr" INDEX codema.maadr
   SELECT KEY workstation.GADRDat$ FILE "Filiale" INDEX Filialnr.filiale
   SELECT KEY knr% LOCK FILE GADRDat$ INDEX codeku.GADRDat$
   miab$ = "BÅro: " + LTRIM$ (GetWksName$(Workstation.GADRDat$))
   IF gasp% <> - 1 THEN 
     agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   ELSE 
     agent$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + LTRIM$ (Agenturnr.maadr)
   END IF 
   IF codema2.GADRDat$ > 0 THEN 
     SELECT KEY codema2.GADRDat$ FILE "maadr" INDEX codema.maadr
     agent2$ = LTRIM$ (Nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + "," + Agenturnr.maadr + "," + LTRIM$ (Agenturnr.maadr)
   ELSE 
     agent2$ = "<ohne Zuordnung>"
   END IF 
   FORM 
 END IF 
 END SUB 
 
 REM ***************************************************************************************************
 REM Stornowarnungen in KVERTRAG erfassen
 REM ***************************************************************************************************
SUB Stornowarn(lfdNr%)
 IF disabled%("VERTRSTOWA") THEN END SUB 
 SELECT KEY lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
 StorWarnJN$ = StorWarnJN.kvertrag

 StorWarnJNold$ = StorWarnJN.kvertrag
 IF StorWarnDatGes.kvertrag > 0 THEN 
   StorWarnDatGes$ = DATE$ (StorWarnDatGes.kvertrag,"0d.mm.yyyy")
 ELSE 
   StorWarnDatGes$ = ""
 END IF 
 IF StorWarnDatMA.kvertrag > 0 THEN 
   StorWarnDatMA$ = DATE$ (StorWarnDatMA.kvertrag,"0d.mm.yyyy")
 ELSE 
   StorWarnDatMA$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 END IF 
 StorWarnGrund$ = StorWarnGrund.kvertrag
 StorWarnMasn$ = StorWarnMasn.kvertrag
 StorWarnErg$ = StorWarnErg.kvertrag
 StorWarnHis$ = StorWarnHist.kvertrag

 IF Fremdvertrag.kvertrag LIKE "j" OR Altvertrag.kvertrag LIKE "j" AND (StorWarnDatGes$ = "") THEN 
   CALL Fehler("FÅr Fremd- und AltvertrÑge ist die Option Stornowarnung nicht aktivierbar","")
   END SUB 
 END IF 

    DIM dlg AS Dialog
    DIM control AS DialogControl
anfd041120031: 
    Superbase.Dialogs.Add("Stornowarnung")
    SET dlg = Superbase.Dialogs.Stornowarnung
    dlg.Move(0,0,353,322)
    IF disabled1%("VERTRSTOWAEDIT") THEN 
      dlg.Caption = "Stornowarnung - Die Bearbeitung wurde fÅr Sie gesperrt!!!"
    ELSE 
      dlg.Caption = "Stornowarnung"
    END IF 
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogCheckBox1","DialogCheckBox")
    control.Move(6,3,80,14)
    IF disabled1%("VERTRSTOWAEDIT") THEN control.Enabled = 0
    control.Caption = "Stornowarnung J/N"
    control.Bind("StorWarnJN$")
    control.ValueOn = "j"
    control.ValueOff = "n"
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(7,22,104,11)
    control.Caption = "Stornowarndatum Gesellschaft"
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(112,22,44,11)
    IF disabled1%("VERTRSTOWAEDIT") THEN control.Enabled = 0
    control.MaxLength = 10
    control.TextBinding = "StorWarnDatGes$"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(160,22,91,11)
    control.Caption = "Stornowarndatum Vermittler"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(252,22,44,11)
    IF disabled1%("VERTRSTOWAEDIT") THEN control.Enabled = 0
    control.MaxLength = 10
    control.TextBinding = "StorWarnDatMA$"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(6,36,122,12)
    control.Caption = "Stornowarnung Grund"
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(6,49,340,51)
    IF disabled1%("VERTRSTOWAEDIT") THEN control.ReadOnly = 1
    control.MultiLine = 1
    control.WantReturn = 1
    control.ScrollBars = 3
    control.MaxLength = 400
    control.TextBinding = "StorWarnGrund$"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(6,102,123,11)
    control.Caption = "Stornowarnung Ma·nahme"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(6,115,340,51)
    IF disabled1%("VERTRSTOWAEDIT") THEN control.ReadOnly = 1
    control.MultiLine = 1
    control.WantReturn = 1
    control.ScrollBars = 3
    control.MaxLength = 400
    control.TextBinding = "StorWarnMasn$"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(6,170,124,11)
    control.Caption = "Stornowarnung Ergebnis"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(6,183,340,51)
    IF disabled1%("VERTRSTOWAEDIT") THEN control.ReadOnly = 1
    control.MultiLine = 1
    control.WantReturn = 1
    control.ScrollBars = 3
    control.MaxLength = 100
    control.TextBinding = "StorWarnErg$"
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(5,236,124,12)
    control.Caption = "Stornowarnung Historie"
 
    SET control = dlg.Add("DialogTextBox6","DialogTextBox")
    control.Move(5,249,340,50)
    control.MultiLine = 1
    control.ReadOnly = 1
    control.WantReturn = 1
    control.ScrollBars = 3
    control.MaxLength = 4000
    control.TextBinding = "StorWarnHis$"
    IF disabled1%("VERTRSTOWAEDIT") OR Fremdvertrag.kvertrag LIKE "j" OR Altvertrag.kvertrag LIKE "j" THEN 
    ELSE 
      SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
      control.Move(13,305,64,14)
      control.Default = 1
      control.Caption = "OK"
      control.ReturnValue = 1
    END IF 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(78,305,63,14)
    control.Caption = "Abbruch"
    control.ReturnValue = 0
 
    IF disabled1%("VERTRSTOWAEDIT") OR Fremdvertrag.kvertrag LIKE "j" OR Altvertrag.kvertrag LIKE "j" THEN 
    ELSE 
      SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
      control.Move(142,305,202,14)
      control.Caption = "Stornowarnsatz in Buchungsdatei erzeugen"
      control.ReturnValue = 2
    END IF 
    DIALOG "Stornowarnung",req%
    REMOVE DIALOG "Stornowarnung"
    IF req% = 1 OR req% = 2 THEN 
      IF LTRIM$ (StorWarnDatGes$) <> "" THEN 
        IF DateOK%(StorWarnDatGes$) THEN 
        ELSE 
          CALL Fehler("Stornowarndatum Gesellschaft ist falsch","")
          GOTO anfd041120031
        END IF 
      END IF 
      IF LTRIM$ (StorWarnDatMA$) <> "" THEN 
        IF DateOK%(StorWarnDatMA$) THEN 
        ELSE 
          CALL Fehler("Stornowarndatum Mitarbeiter ist falsch","")
          GOTO anfd041120031
        END IF 
      END IF 
      IF DAYS (StorWarnDatMA$) < TODAY AND StorWarnJN$ LIKE "j" THEN 
        CALL Fehler("Das <Stornowarndatum Vermittler> mit dem die Stornowarnung auf der Buchungsliste erscheint,","darf nicht kleiner HEUTE sein!")
        GOTO anfd041120031
      END IF 
      IF DAYS (StorWarnDatGes$) > TODAY AND StorWarnJN$ LIKE "j" THEN 
        CALL Fehler("Das <Stornowarndatum Gesellschaft>","darf nicht grîsser HEUTE sein!")
        GOTO anfd041120031
      END IF 
      StorWarnJN.kvertrag = StorWarnJN$
      StorWarnDatGes.kvertrag = StorWarnDatGes$
      StorWarnDatMA.kvertrag = StorWarnDatMA$
      StorWarnGrund.kvertrag = StorWarnGrund$
      StorWarnMasn.kvertrag = StorWarnMasn$
      StorWarnErg.kvertrag = StorWarnErg$
      CALL QuickStore("KVERTRAG")
      IF StorWarnJN$ = "j" AND StorWarnJNold$ <> StorWarnJN$ THEN 
        IF Fremdvertrag.kvertrag LIKE "j" OR Altvertrag.kvertrag LIKE "j" THEN 
        ELSE 
          REQUEST "Mîchten Sie eine Stornowarnung in der Buchungsdatei eintragen lassen?","",130,req%
          IF req% = 1 THEN req% = 2
        END IF 
      END IF 
      IF req% = 2 THEN 
        buchdat1$ = StorWarnDatMA$
anfstowrn051120031: 
        REM buchdat1$ = DATE$ ( TODAY ,"0d.mm.yyyy")
        CREATE DIALOG "STICHTAG",0,0,222,114,"Buchungsdatum","MS Sans Serif",8
        ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
        ADD DIALOG "STICHTAG",9,6,9,23,24,2
        ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, mit welchem Datum"
        ADD DIALOG "STICHTAG",5,31,25,183,10,0,"der Stornowarnsatz erzeugt werden soll:"
        ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,buchdat1$,10
        ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Buchungsdatum:"
        ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
        ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
        DIALOG "STICHTAG",req2%
        REMOVE DIALOG "STICHTAG"
        IF req2% = 1 THEN 
          IF DateOK%(buchdat1$) THEN 
            IF DAYS (StorWarnDatMA$) < TODAY THEN 
              CALL Fehler("Das <Stornowarndatum Vermittler> mit dem die Stornowarnung auf der Buchungsliste erscheint,","darf nicht kleiner HEUTE sein!")
              GOTO anfstowrn051120031
            END IF 
          ELSE 
            GOTO anfstowrn051120031
          END IF 
        ELSE 
          GOTO endstw051120031
        END IF 
        REM Buchungssatz erzeugen
        SELECT KEY lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
        IF StorWarnHis$ = "" THEN 
          StorWarnHist.kvertrag = LEFT$ (StorWarnDatGes$ + "/" + buchdat1$ + "  " + StorWarnGrund$ + CHR$ (13) + CHR$ (10),4000)
        ELSE 
          IF LEN (StorWarnHist.kvertrag) >= 3900 THEN 
            StorWarnHist.kvertrag = ""
          END IF 
          StorWarnHist.kvertrag = LEFT$ (StorWarnDatGes$ + "/" + buchdat1$ + "  " + StorWarnGrund$ + CHR$ (13) + CHR$ (10) + StorWarnHist.kvertrag,4000)
        END IF 
        STORE FILE "kvertrag"
        IF euro1% = 0 THEN euro1% = 1
        IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
             CALL DFile(3,"buchung" + _fpw$)
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
             BLANK FILE "BUCHUNG"
             CodeBU.BUCHUNG = SER ("BUCHUNG",1)
             codew.buchung = codew%
             Agentur.buchung = Nachname.maadr + "," + Vorname.maadr
             umrechnung.buchung = euro1%
             waehrung.buchung = waehrung$
             Betrag.BUCHUNG = 0.00001
             SR.Buchung = 0
             Einheiten.Buchung = 0
             BetragEU.buchung = 0
             srEU.buchung = 0
             Nachname.BUCHUNG = Nachname.GAdrDat$
             Vorname.Buchung = Vorname.GAdrDat$
             Sparte.BUCHUNG = Sparte.SPARTEN
             Gesellschaft.BUCHUNG = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG = Bewertungssumme.KVERTRAG
             BewertungssumEU.BUCHUNG = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
 
             IF gafsk$ LIKE "TRUE" THEN 
               butxt$ = LEFT$ ("Stornowarnung Grund: " + StorWarnGrund$,100)
             ELSE 
               butxt$ = LEFT$ ("Stornowarnung zum " + StorWarnDatGes$ + " zum Vertr. " + VS_NR.KVERTRAG + " Grund: " + StorWarnGrund$,100)
             END IF 
             REM butxt$ = LEFT$ ("Stornowarnung zum " + StorWarnDatGes$ + " zum Vertr. " + VS_NR.KVERTRAG + " Grund: " + StorWarnGrund$,100)
             Buchungstext.BUCHUNG = butxt$
             CodeMA.BUCHUNG = CodeMA.MAADR
             CodeKU.BUCHUNG = CodeKU.KVERTRAG
             CodeVT.BUCHUNG = lfdnr.KVERTRAG
             Datum.BUCHUNG = buchdat1$
             REM 210597
             REM KÅndigung.Buchung = KÅndigung.KVERTRAG
             vtagentur.buchung = Nachname.maadr + "," + Vorname.maadr
             vtcodema.buchung = codema.maadr
             VS_Nr.buchung = VS_NR.kvertrag
             CALL QuickStore("BUCHUNG")
        ELSE 
             CALL DFile(3,"buchung1" + _fpw$)
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
             BLANK FILE "BUCHUNG1"
             CodeBU.BUCHUNG1 = SER ("BUCHUNG1",1)
             codew.buchung1 = codew%
             umrechnung.buchung1 = euro1%
             waehrung.buchung1 = waehrung$
             Agentur.buchung1 = Nachname.maadr + "," + Vorname.maadr
             Betrag.BUCHUNG1 = 0.00001
             SR.Buchung1 = 0
             Einheiten.Buchung1 = 0
             BetragEU.buchung1 = 0
             srEU.buchung1 = 0
             vtagentur.buchung1 = Nachname.maadr + "," + Vorname.maadr
             vtcodema.buchung1 = codema.maadr
             VS_Nr.buchung1 = VS_NR.kvertrag
             Nachname.BUCHUNG1 = Nachname.GAdrDat$
             Vorname.Buchung1 = Vorname.GAdrDat$
             Sparte.BUCHUNG1 = Sparte.SPARTEN
             Gesellschaft.BUCHUNG1 = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG1 = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG1 = Bewertungssumme.KVERTRAG
             
             BewertungssumEU.BUCHUNG1 = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
             IF GAFSK$ LIKE "TRUE" THEN 
               butxt$ = LEFT$ ("Stornowarnung zum " + StorWarnDatGes$ + " Grund: " + StorWarnGrund$,100)
             ELSE 
               butxt$ = LEFT$ ("Stornowarnung zum " + StorWarnDatGes$ + " zum Vertr. " + VS_NR.KVERTRAG + " Grund: " + StorWarnGrund$,100)
             END IF 
             Buchungstext.BUCHUNG1 = butxt$
             CodeMA.BUCHUNG1 = CodeMA.MAADR
             CodeKU.BUCHUNG1 = CodeKU.KVERTRAG
             CodeVT.BUCHUNG1 = lfdnr.KVERTRAG
             Datum.BUCHUNG1 = buchdat1$
             REM 210597
             REM KÅndigung.Buchung1 = KÅndigung.KVERTRAG
             CALL QuickStore("BUCHUNG1")
        END IF 
      END IF 
    END IF 
endstw051120031: 
 END SUB 



SUB AutoSpartS(codeva%)
   SELECT KEY codeva% LOCK FILE "sparten" INDEX Codeva.Sparten
   REM GAutoKArt1
   DIM Auswahl$(1)
 
   Auswahl$ = Spartenart.sparten
   prompt$ = Spartenart.sparten
 IF prompt$ = "" THEN prompt$ = "FON"
 CREATE DIALOG "KEYWORD",0,0,120,130,"Spartenart","MS Sans Serif",8
 ADD DIALOG "KEYWORD",4,0,1,120,110,0,""
 REM ADD DIALOG "KEYWORD",9,4,12,21,24,2
 ADD DIALOG "KEYWORD",5,1,14,120,19,0,"Bitte wÑhlen Sie eine Spartenart aus:"
 ADD DIALOG "KEYWORD",7,5,38,100,70,0,2,GSpartenart$,Auswahl$,prompt$
 REM ADD DIALOG "KEYWORD",6,11,158,100,12,0,0,KW$,10
   ADD DIALOG "KEYWORD",1,5,113,55,15,1,"&OK",1,1
   ADD DIALOG "KEYWORD",1,60,113,55,15,0,"&Abbrechen",0,0
 DIALOG "KEYWORD",req%
 REMOVE DIALOG "KEYWORD"
 
 IF req% <> 0 THEN 
     IF kw$ = "" THEN 
       kw1$ = Auswahl$(0)
       kw$ = kw1$
     ELSE 
       kw$ = VSNRPack$(kw$)
       ok% = 0
       j% = 0
       FOR i% = 0 TO 49
         IF GSpartenart$(i%) = kw$ THEN 
           ok% = - 1
           i% = 50
         END IF 
         IF GSpartenart$(i%) = "" THEN 
           i% = 50
         END IF 
       NEXT i%
       IF ok% = 0 THEN 
         FOR i% = 0 TO 49
           IF GSpartenart$(i%) = "" THEN 
             j% = i%
             i% = 50
           END IF 
         NEXT i%
         GSpartenart$(j%) = kw$
         CALL WriteConfig("Spartenart","Art" + LTRIM$ ( STR$ (j%,"99")),kw$)
       END IF 
     END IF 
     Spartenart.sparten = kw$
     STORE FILE "Sparten"
  END IF 
 
 END SUB 
 

