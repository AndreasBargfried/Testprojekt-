 
  CALL main()' plib1.sbr
 
 '      ************************************
 '      ** Routinen fÅr Formular KVERTRAG **
 '      ************************************
 ' 04.02.95  - Auswahlliste zur Fehlervermeidung entfernt
 '             - Test, ob Vertragsbearbeitung mîglich ist
  

 
 
 REM Vertragsmasken anzeigen Anfang
 
SUB KVProbe()
 codevaProbe% = codeva.sparten
 IF disabled%("KVERTRAG") THEN END SUB 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vorgang" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"KVFAEL" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
  CALL DFile(3,"kvpsp" + _fpw$)
 END IF 
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 _formend% = 0
 SET STATUS "Probeanzeige von Vertragsformularen"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   vform% = 0
   vform1$ = Formular.SPARTEN
   vform% = VAL ( RIGHT$ (vform1$,3))
   VForm$ = "VERTR000"
   IF vform1$ <> "" THEN VForm$ = vform1$
   IF GVertrArt$ = "j" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "W" + test$
   END IF 
   IF GLundWrigg$ = "TRUE" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "R" + test$
   END IF 
   IF GAFSK$ = "TRUE" THEN 
     test$ = MID$ (VForm1$,2)
     VForm1$ = "K" + test$
   END IF 
   vform$ = vform1$
   END IF 
   IF UCASE$ ( FORM ) <> UCASE$ (VForm$) THEN 
     IF GDieMakler$ LIKE "TRUE" THEN 
       IF VForm1$ LIKE "VERTR018" THEN vform1$ = "VERTR028"
     END IF 
     IF EXISTS (GPrjForm$ + VForm1$ + ".sbv") THEN 
       OPEN FORM GPrjForm$ + vform1$
     ELSE 
       IF EXISTS (GPrjForm$ + vform1$ + ".sbv") THEN 
         OPEN FORM GPrjForm$ + vform1$
       ELSE 
         OPEN FORM GPrjForm$ + "VERTR000"
         vform% = 0
 
 END IF 
     END IF 
     SET f = Superbase.Form
   END IF 
   MOUSE ON 
   VERTRsub% = 0
   f.suchen.visible = - 1
   f.suchen.enabled = 0
   f.abbruch.enabled = 0
   f.abbruch.visible = 0
   f.abbruch2.enabled = 0
   f.abbruch2.visible = 0
   f.neu.enabled = 0
   f.bearb.enabled = 0
   f.suchen.enabled = 0
   f.links1.enabled = 0
   f.rechts1.enabled = 0
   f.konditionen.enabled = 0
   f.status.enabled = 0
   f.nachbearb.enabled = 0
   f.zahlweise.enabled = 0
   f.zahlart.enabled = 0
   f.sichern.enabled = 0
   f.bearb2.enabled = 0
   f.sichern2.enabled = 0
   f.gdv.enabled = 0
   f.zahlungseingang.enabled = 0
   f.vbuch.enabled = 0
   f.windok.enabled = 0
   f.bank.enabled = 0
   f.tel.enabled = 0
 
   WAIT MOUSE OR KEY OR MENU 
 WEND 
 cuvt% = 0
 _formend% = 0
 SELECT KEY codevaProbe% FILE "sparten" INDEX codeva.sparten
 END SUB 
  
 
 
 
 
 
 
  
 ' KVERTRAG Kopieren
 ' =======================================================================
 
SUB VERTRKopdyn()
 IF disabled%("VERTRNeu") THEN END SUB 
 FILE "KVERTRAG"
 lfdnrab% = lfdnr.kvertrag
 lfdnrtotalab% = lfdnrtotal.kvertrag
 SELECT KEY lfdnrab% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
 lfdnrtotal.kvertrag = lfdnrtotal.kvertrag + 1
 CALL QuickStore("Kvertrag")
 BLANK DUPLICATE 
 lfdnr% = SER ("KVERTRAG",1)
 lfdnr.KVERTRAG = lfdnr%
 lfdnrtotal.kvertrag = lfdnrtotalab%
 REM VS_NR.KVERTRAG = VS_NR.KVERTRAG + "@"
 proviab.kvertrag = 0
 BewertcalcDat.kvertrag = 0
 BewertEinmDat.kvertrag = 0
 BewertEinm.kvertrag = 0
 
 letzteProvi = 0:gez_Abschlu·.KVERTRAG = "":gez_Pauschale.KVERTRAG = ""
 TZRate.KVERTRAG = 0:letztePflege.KVERTRAG = 0:Pool.KVERTRAG = 0:Mahnung.KVERTRAG = "n"
 CALL FStore("KVERTRAG")
 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
 SELECT KEY lfdnrab% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
 VS_NR.KVERTRAG = VS_NR.KVERTRAG + " DYN"
 CALL FStore("KVERTRAG")
 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
 SELECT KEY lfdnr% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
   IF EXISTS (lfdnr%,codevt.KVFAEL) THEN 
     SELECT FIRST FILE "KVFAEL" INDEX codevt.kvfael
     SELECT KEY lfdnr% LOCK FILE "KVFAEL" INDEX codevt.kvfael
     BewertcalcDat.kvfael = 0:letzteProvi.KVFAEL = 0:gez_Abschlu·.KVFAEL = "":gez_Pauschale.KVFAEL = ""
     TZRate.KVFAEL = 0:letztePflege.KVFAEL = 0:Pool.KVFAEL = 0:Mahnung.KVFAEL = "n"
     STORE FILE "KVFAEL"
     UNLOCK CURRENT FILE "KVFAEL"
   END IF 
 REM CALL Fehler("Fonds kopieren","")
 REM Fonds bei Standardabrechnung Åbertragen
 IF EXISTS (lfdnrab%,codevt.fonds) THEN 
   FILE "Fonds"
   INDEX codevt.fonds
   SELECT FIRST 
   SELECT KEY lfdnrab% FILE "Fonds" INDEX codevt.fonds
   codefo% = 0
   DIM fondarr%(10000)
   i% = 0
   WHILE NOT EOF ("Fonds") AND codevt.fonds = lfdnrab%
     IF codevt.fonds = lfdnrab% THEN 
       fondarr%(i%) = codefo.fonds
       i% = i% + 1
     END IF 
     SELECT NEXT FILE "fonds" INDEX codevt.fonds
   WEND 
   REM CALL Fehler("Fonds kopieren","")
   FILE "fonds"
   INDEX codefo.fonds
   SELECT FIRST 
   FOR j% = 0 TO i% - 1
     SET STATUS "Fondszahlungen kopieren " + STR$ (j%,"999999")
     SELECT FIRST 
     SELECT KEY fondarr%(j%) FILE "Fonds" INDEX codefo.fonds
     BLANK DUPLICATE 
     codefo.fonds = SER ("Fonds",1)
     codevt.fonds = lfdnr%
     STORE FILE "Fonds"
   NEXT j%
 END IF 
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   IF EXISTS (lfdnrab%,codevt.spezkond) THEN 
     FILE "spezkond"
     INDEX codevt.spezkond
     SELECT FIRST 
     SELECT KEY lfdnrab% FILE "spezkond" INDEX codevt.spezkond

     codefo% = 0
     DIM fondarr%(10000)
     i% = 0
     WHILE NOT EOF ("spezkond") AND codevt.spezkond = lfdnrab%
       IF codevt.spezkond = lfdnrab% THEN 
         fondarr%(i%) = codekey.spezkond
         i% = i% + 1
       END IF 
       SELECT NEXT FILE "spezkond" INDEX codevt.spezkond
     WEND 
     REM CALL Fehler("Fonds kopieren","")
     FILE "spezkond"
     INDEX codekey.spezkond
     SELECT FIRST 
     FOR j% = 0 TO i% - 1
       SET STATUS "spezkond kopieren " + STR$ (j%,"999999")
       SELECT FIRST 
       SELECT KEY fondarr%(j%) FILE "spezkond" INDEX codekey.spezkond
       BLANK DUPLICATE 
       codekey.spezkond = SER ("spezkond",1)
       codevt.spezkond = lfdnr%
       QCodeVTMA.spezkond = STR$ (codevt.spezkond,"000000") + STR$ (codema.spezkond,"000000")
       QCodeGEVAMA.spezkond = STR$ (codege.spezkond,"000000") + STR$ (codeva.spezkond,"000000") + STR$ (codema.spezkond,"000000")
       STORE FILE "spezkond"
     NEXT j%

   END IF 
 END IF 
 FILE "kvertrag"
 SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 CALL VERTRUpdate()
 SET INDEX CodeKU.KVERTRAG
 INDEX codeku.kvertrag
 SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 FORM 
 MOUSE ON 
 MENU ON 
 END SUB 
 
  
 
 
 
  
 
 ' KVERTRAG Suchen (kundenbezogen) mit Auswahl nach Vertragsnummer/KFZKennz/ KFZTyp/
 ' ================================================================================= 
SUB VERTRSuchen1()
 viab% = 0
 cfile$ = FILE 
 cindex$ = INDEX 
 cuvt% = lfdnr.KVERTRAG
 akver1% = 0
  CREATE DIALOG "vsuch",0,0,175,166,title$,"MS Sans Serif",8
 ADD DIALOG "vsuch",9,6,6,24,22,2
 ADD DIALOG "vsuch",5,34,6,132,10,0,"Vertrag suchen"
 ADD DIALOG "vsuch",4,34,14,132,5,0,""
 ADD DIALOG "vsuch",5,34,22,132,26,0,"Bitte geben Sie an, Åber welche Infor- mation Sie den Vertrag suchen mîchten"
 REM ADD DIALOG "vsuch",3,34,49,154,10,0,"alle VertrÑge anzeigen",0,akVer1%
 ADD DIALOG "vsuch",5,34,42,175,26,0,"Standardsuche (schnell):"
 ADD DIALOG "vsuch",5,34,75,175,26,0,"erweiterte Suche (langsamer):"
 ADD DIALOG "vsuch",6,34,121,132,12,0,0,Eingabe$,20
 ADD DIALOG "vsuch",3,41,51,154,10,0,"alle VertrÑge anzeigen",0,akVer1%
 ADD DIALOG "vsuch",3,41,63,148,10,0,"Vertrags&nummer",1,akVer1%
 ADD DIALOG "vsuch",3,41,84,132,10,0,"KFZ-&Kennzeichen",2,akVer1%
 ADD DIALOG "vsuch",3,41,96,132,10,0,"KFZ-&Typ",3,akVer1%
 ADD DIALOG "vsuch",5,34,111,175,10,0,"&Suchbegriff:"
 REM ADD DIALOG "vsuch",4,26,102,190,38,0,"Bitte den Suchbegriff eingeben"
 ADD DIALOG "vsuch",1,28,145,55,14,1,"&Weiter",1,1
 ADD DIALOG "vsuch",1,87,145,55,14,0,"&Abbruch",0,0
 DIALOG "vsuch",req%
 REMOVE DIALOG "vsuch"
 IF req% = 1 THEN 
   IF akver1% = 0 THEN 
     a% = VERTRSuch%(CodeKU.KVERTRAG,cuvt%)
     IF a% <> 0 THEN cuvt% = a%
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     
   END IF 
   IF akver1% = 1 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GetVerab%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde keine Vertragsnummer eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 2 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZKe%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein Kennzeichen eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 3 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZTyp%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein KFZ-Typ eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 END IF 
 SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 knr% = codeku.kvertrag
 FILE cfile$
 SET INDEX cindex$
 INDEX cindex$
 IF akver1% > 1 AND nvt% <> 0 THEN 
   FORM 2
 ELSE 
   FORM 
 END IF 
 SET STATUS "Bereit"
 END SUB 
 
 ' KVERTRAG Suchen (kundenbezogen)
 ' =======================================================================
 
FUNCTION VERTRSuch%(kunr%,prompt%)
 cfile$ = FILE 
 vt% = lfdnr.KVERTRAG
 IF EXISTS (kunr%,CodeKU.KVERTRAG) THEN 
   SET STATUS "Vertragsdatei wird durchsucht..."
   DIM Auswahl$(1)
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM VListe$(10000)
   ELSE 
     DIM VListe$( RECCOUNT ("KVERTRAG"))
   END IF 
   FILE "KVERTRAG"
   INDEX CodeKU.KVERTRAG
   SELECT FIRST 
   SELECT KEY kunr%
   a% = 0
   WHILE NOT EOF ("KVERTRAG") AND kunr% = CodeKU.KVERTRAG
     SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
     tGesellschaft$ = IF ( FOUND ("GEADR"), LTRIM$ ( LEFT$ (Gesellschaft.GEADR,10)),"<keine Zuordnung>")
     IF FOUND ("SPARTEN") THEN 
       REM tSparte$ = Sparte.SPARTEN"
       codegrsp% = Codegrsp.sparten
       SELECT KEY codegrsp% FILE "SPGRUPPE" INDEX codegrsp.spgruppe
       tSparte$ = LTRIM$ (gruppe.spgruppe) + "," + LTRIM$ (Sparte.SPARTEN)
     ELSE 
       tSparte$ = "<keine Zuordnung>,<keine Zuordnung>"
     END IF 
     tAgentur$ = IF ( FOUND ("MAADR"), LTRIM$ ( LEFT$ (Nachname.MAADR,10)) + ", " + LEFT$ (Vorname.MAADR,1) + ".","<keine Zuordnung>")
     tDatum$ = IF (VS_Beginn.KVERTRAG <> 0, DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy"),"__.__.____")
     abzusatz$ = ""
     IF kennzeichen.kvertrag <> "" OR fabrikat <> "" THEN 
       abzusatz$ = ",(" + TRIM$ (kennzeichen.kvertrag) + "," + TRIM$ (fabrikat.kvertrag) + ")"
     END IF 
     IF zvp1name.kvertrag <> "" THEN abzusatz$ = ",mitvers.:" + LTRIM$ (zvp1name.kvertrag)
 
     VListe$(a%) = VS_Nr.KVERTRAG + ", " + tGesellschaft$ + ", " + tSparte$ + ", " + tDatum$ + abzusatz$ + "," + tAgentur$ + SPACE$ (80) + STR$ (lfdnr.KVERTRAG,"000000")
     REM andi 2.11.95 
     REM Original IF lfdnr.KVERTRAG = prompt% THEN prompt$ = VListe$(a%)
     IF prompt$ = "" THEN 
       prompt$ = VListe$(0)
     ELSE 
       IF lfdnr.KVERTRAG = prompt% THEN prompt$ = VListe$(a%)
     END IF 
     a% = a% + 1
     SELECT NEXT FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
   WEND 
    CREATE DIALOG "GETVERTRAG",0,0,405,224,"VertragsÅbersicht","MS Sans Serif",8
    ADD DIALOG "GETVERTRAG",4,0,0,403,201,0,""
    ADD DIALOG "GETVERTRAG",9,6,11,23,22,2
    ADD DIALOG "GETVERTRAG",5,36,12,202,12,0,"Bitte wÑhlen Sie den Vertrag, den Sie bearbeiten mîchten:"
    ADD DIALOG "GETVERTRAG",5,36,25,202,11,0,"Police-Nr., Gesellschaft ,Spartengruppe, Sparte, Beginn, Agentur"
    ADD DIALOG "GETVERTRAG",7,8,37,392,161,2,2,VListe$,Auswahl$,prompt$
    ADD DIALOG "GETVERTRAG",1,129,206,55,16,1,"&OK",1,1
    ADD DIALOG "GETVERTRAG",1,186,206,55,16,0,"&Abbrechen",0,0
   SET STATUS "Bitte wÑhlen Sie einen Vertrag aus..."
   DIALOG "GETVERTRAG",req%
   SET STATUS "Bereit"
   REMOVE DIALOG "GETVERTRAG"
   IF req% = 1 THEN 
     VERTRSuch% = VAL ( RIGHT$ (Auswahl$(0),6))
   ELSE 
     VERTRSuch% = 0
   END IF 
 ELSE 
   REQUEST "keine VertrÑge fÅr angegebenen Kunden gefunden!"
   VERTRSuch% = 0
 END IF 
 FILE cfile$
 SELECT KEY vt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 END FUNCTION 
 
 
 
 
 
 
 ' KVERTRAG lîschen
 ' =======================================================================
 
 
 
 ' KVERTRAG Zusatz
 ' =======================================================================
 
SUB VERTRZusatz()
 FORM 2
 END SUB 
 
 
 
 ' VertragsÅbersicht fÅr aktuellen Kunden drucken
 ' =======================================================================
SUB VGRNeu()
 CALL DruckVertr(knr%,0)
 END SUB 
 
SUB VLIST2()
 CALL LIST2(CodeKU.KVERTRAG)
 END SUB 
 
 
 
  
 
 ' Vertragsinformationen anzeigen
 ' =======================================================================
 
SUB VINFO(lfdnr%)
 MOUSE OFF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 cvt% = lfdnr.KVERTRAG
 cfile$ = FILE 
 FILE "KVERTRAG"
 cindex$ = INDEX 
 MOUSE OFF 
 SELECT KEY lfdnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF FOUND ("KVERTRAG") THEN 
   SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   IF FOUND (GAdrDat$) THEN 
     Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
   ELSE 
     Kunde$ = "<keine Zuordnung>"
   END IF 
   SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
   IF FOUND ("GEADR") THEN 
     Gesellschaft$ = Gesellschaft.GEADR
   ELSE 
     Gesellschaft$ = "<keine Zuordnung>"
   END IF 
   SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
   IF FOUND ("SPARTEN") THEN 
     Sparte$ = Sparte.SPARTEN
   ELSE 
     Sparte$ = "<keine Zuordnung>"
   END IF 
   IF VS_Beginn.KVERTRAG > 0 THEN 
     von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
   ELSE 
     von$ = "__.__.____"
   END IF 
   IF KÅndigung.KVERTRAG > 0 THEN 
     bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
   ELSE 
     bis$ = "__.__.____"
   END IF 
   Vertrag$ = VS_Nr.KVERTRAG
   VStatus$ = "zur Zeit nicht verfÅgbar"
   CREATE DIALOG "VINFO",0,0,265,191,"Vertragsinfo","MS Sans Serif",8
   ADD DIALOG "VINFO",4,0,0,265,190,0,""
   ADD DIALOG "VINFO",9,5,9,24,25,4
   ADD DIALOG "VINFO",5,33,9,200,11,0,"Informationen zum Vertrag " + VS_Nr.KVERTRAG + "        +++"
   ADD DIALOG "VINFO",5,33,24,49,10,0,"Kunde:"
   ADD DIALOG "VINFO",5,88,24,174,10,128,Kunde$
   ADD DIALOG "VINFO",5,33,34,49,10,0,"Gesellschaft:"
   ADD DIALOG "VINFO",5,88,34,173,10,128,Gesellschaft$
   ADD DIALOG "VINFO",5,33,44,48,10,0,"Sparte:"
   ADD DIALOG "VINFO",5,88,44,173,10,128,Sparte$
   ADD DIALOG "VINFO",5,33,54,45,9,0,"Laufzeit:"
   ADD DIALOG "VINFO",5,88,54,173,10,0,"vom " + von$ + " bis " + bis$
   ADD DIALOG "VINFO",4,33,70,226,35,0,"Provisions-Status"
   ADD DIALOG "VINFO",5,36,80,220,19,0,VStatus$
   ADD DIALOG "VINFO",4,33,120,226,35,0,"Vertrags-Status"
   ADD DIALOG "VINFO",5,36,130,220,19,0,VStatusTXT.kvertrag
   ADD DIALOG "VINFO",1,110,161,57,16,1,"&OK",1,1
   DIALOG "VINFO",req%
   REMOVE DIALOG "VINFO"
 ELSE 
   REM CALL Fehler("Der angegebene Vertrag konnte nicht gefunden werden!","")
   REQUEST "Vertrag nicht gefunden!"
 END IF 
 FILE "KVERTRAG"
 SELECT KEY cvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SET INDEX cindex$
 INDEX cindex$
 FILE cfile$
 MOUSE ON 
 END SUB 
 
 
 ' Gesamtbeitrag fÅr GebÑudeversicherung berechnen
 ' =======================================================================
 
SUB GebGesamt()
 cfile$ = FILE 
 FILE "KVERTRAG"
 ok% = 0
 REM -- Berechnung bei leeren Feldern unterdrÅcken (zur manuellen Eingabe
 REM -- des Gesamtbeitrages
 IF F_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF FKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF LW_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF LWKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF ST_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF STKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF ED_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF EDVANDA_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF EDKBU_Beitrag.KVERTRAG <> 0 THEN ok% = - 1
 IF ok% THEN 
   Gesamtbeitrag = F_Beitrag + FKBU_Beitrag + LW_Beitrag + LWKBU_Beitrag + ST_Beitrag + STKBU_Beitrag + ED_Beitrag + EDVANDA_Beitrag + EDKBU_Beitrag
   FORM 
 END IF 
 FILE cfile$
 END SUB 
 
 
  
 
  
 
 
 
 ' Status eines Vertrages anzeigen und Ñndern
 ' =======================================================================
 ' 05.09.95 
  
SUB VStatus(vnr%)
 IF disabled%("VERTRSTATUS") THEN END SUB 
 MOUSE OFF 
 cuv% = lfdnr.KVERTRAG
 cfile$ = FILE 
 CALL DFile(3,"BUCHUNG" + _fpw$)
 SELECT KEY vnr% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF FOUND ("KVERTRAG") THEN 
   REM -- Stornoreserve ermitteln --
   sr% = GetSR%(vnr%)
   CREATE DIALOG "VSTATUS",0,0,350,163,"Vertragsstatus","MS Sans Serif",8
   IF Storno.KVERTRAG <> 0 THEN 
     Storno$ = LTRIM$ ( DATE$ (KÅndigung,"0d.mm.yyyy"))
     IF vorzeitig.KVERTRAG LIKE "j" THEN 
       Storno$ = Storno$ + CHR$ (13) + "(vorzeitig)"
     END IF 
   ELSE 
     Storno$ = "nicht gekÅndigt"
   END IF 
   ADD DIALOG "VSTATUS",9,6,8,20,22,4
   ADD DIALOG "VSTATUS",4,35,3,192,19,0,""
   ADD DIALOG "VSTATUS",5,37,10,169,9,0,"Status des Vertrages " + VS_NR.KVERTRAG
   ADD DIALOG "VSTATUS",5,37,24,69,10,0,"verprovisioniert seit:"
   ADD DIALOG "VSTATUS",5,148,24,65,11,0, IF (ProviAb.KVERTRAG > 0, LTRIM$ ( DATE$ (ProviAb.KVERTRAG,"0d.mm.yyyy")),"nicht aktiviert")
   ADD DIALOG "VSTATUS",5,37,34,73,10,0,"letzte Bearbeitung am:"
   ADD DIALOG "VSTATUS",5,148,34,73,10,0, LTRIM$ ( DATE$ (letzteBearb.KVERTRAG,"0d.mm.yyyy"))
   ADD DIALOG "VSTATUS",5,37,44,111,10,0,"letzte Provisionszahlung:"
   ADD DIALOG "VSTATUS",5,148,44,65,11,0, IF (letzteProvi.KVERTRAG > 0, LTRIM$ ( DATE$ (letzteProvi.KVERTRAG,"dd.mm.yyyy")),"keine Angaben")
   ADD DIALOG "VSTATUS",5,37,54,111,10,0,"Stornoreserve:"
   ADD DIALOG "VSTATUS",5,148,54,65,11,0, LTRIM$ ( STR$ (GetSR%(vnr%),",9999999.00"))
   ADD DIALOG "VSTATUS",5,37,64,73,10,0,"Stornierung:"
   ADD DIALOG "VSTATUS",5,148,64,65,20,0,Storno$
   ADD DIALOG "VSTATUS",4,35,85,192,19,0,""
   ADD DIALOG "VSTATUS",5,37,92,85,10,0,"Zahlungeingangskontrolle"
   ADD DIALOG "VSTATUS",5,37,106,111,10,0,"PrÅfung der ZahlungseingÑnge:"
   ADD DIALOG "VSTATUS",5,147,106,70,10,0, IF (check.KVERTRAG = "j","aktiviert","deaktiviert")
   ADD DIALOG "VSTATUS",5,37,116,104,9,0,"zahlbare Provision:"
   ADD DIALOG "VSTATUS",5,147,116,66,11,0, LTRIM$ ( STR$ (Pool.KVERTRAG,",9999999.00"))
   REM ADD DIALOG "VSTATUS",5,17,136,270,9,0,"um den Status von lebend... auf Antrag zu Ñndern -> Button Deaktivieren drÅcken"
   REM ADD DIALOG "VSTATUS",5,17,144,270,9,0,"um den Status von lebend... auf ruhend..., beitragsfrei...,storniert... zu Ñndern"
   REM ADD DIALOG "VSTATUS",5,17,152,270,9,0,"- > Button Stornieren drÅcken"
   
   ADD DIALOG "VSTATUS",1,235,6,95,15,1,"&OK",1,1
 
   REM IF vstatus% > 0 THEN ADD DIALOG "VSTATUS",1,235,23,55,15,0,"&Abbrechen",0,0
   REM IF NOT MNdisabled%("VERTRDEAKTIVIEREN") AND ProviAb.KVERTRAG > 0 THEN 
     REM IF vstatus% > 0 THEN ADD DIALOG "VSTATUS",1,235,46,55,15,0,"&Deaktivieren",3,1
   REM END IF 
   REM IF NOT MNdisabled%("VERTRSTORNO") AND ProviAb.KVERTRAG > 0 THEN 
     REM IF vstatus% > 0 THEN ADD DIALOG "VSTATUS",1,235,63,55,15,0,"&Stornieren",4,1
   REM END IF 
   ADD DIALOG "VSTATUS",1,235,23,95,15,0,"&Abbrechen",0,0
   IF NOT MNdisabled%("VERTRDEAKTIVIEREN") AND ProviAb.KVERTRAG > 0 THEN 
     ADD DIALOG "VSTATUS",1,235,46,95,15,0,"Vertrag &Deaktivieren",3,1
   END IF 
   IF NOT MNdisabled%("VERTRSTORNO") AND ProviAb.KVERTRAG > 0 THEN 
     ADD DIALOG "VSTATUS",1,235,63,95,15,0,"Vertrag &Stornieren",4,1
   END IF 
   solsst$ = sollst.kvertrag
   IF GSoll$ = "j" AND UCASE$ (sollst.kvertrag) <> "J" THEN 
     IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
       ADD DIALOG "VSTATUS",1,235,80,95,15,0,"Sollstellung aktivieren",6,1
     END IF 
   END IF 
   IF GSoll$ = "j" AND sollst.kvertrag = "j" THEN 
     IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
       ADD DIALOG "VSTATUS",1,235,80,95,15,0,"Sollstellung deaktivieren",5,1
       SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
       SELECT KEY lfdnr.kvertrag FILE "kvskond" INDEX codevt.kvskond

       SELECT FIRST FILE "VPGEKOND" INDEX codekey.vpgekond
       SELECT KEY codeko.kvskond FILE "VPGEKOND" INDEX codekey.vpgekond
       anzcour% = 0
       anzcour% = AnzCourtZahlung.vpgekond
       IF AnzCourtZahlung.KVERTRAG > 0 THEN 
         anzcour% = AnzCourtZahlung.KVERTRAG
       END IF 
       IF anzcour% > 0 AND CourtageJN.vpgekond = "j" AND Courtage.vpgekond > 0 THEN 
         ADD DIALOG "VSTATUS",5,37,136,154,9,0,"Anzahl zu zahlender Courtagen fÅr Sollstellung:"
         ADD DIALOG "VSTATUS",5,197,136,66,11,0, LTRIM$ ( STR$ (anzcour%,"999"))
       END IF 
     END IF 
   END IF 
   DIALOG "VSTATUS",req%
   REMOVE DIALOG "VSTATUS"
   SELECT CASE req%
   CASE 0
     REM RÅckschreiben, der vorhergehenden Statusinfos
     REM vstatus% = 2
   CASE 3
     REM 290799
     vstatus% = CodeVStatus.kvertrag
     REM IF vstatus% > 4 AND vstatus% < 13 THEN 
       REM vstatus% = 0
       CALL VERTRDeak()
     REM ELSE 
       REM CALL Fehler("ungÅltige Auswahl","")
       REM vstatus% = 2
     REM END IF 
   CASE 4
     vstatus% = CodeVStatus.kvertrag
     REM IF vstatus% > 0 AND vstatus% < 5 THEN 
       REM vstatus% = 0
       CALL VERTRStorno()
     REM ELSE 
       REM CALL Fehler("ungÅltige Auswahl","")
       REM vstatus% = 2
     REM END IF 
    CASE 5
      REM Sollstellung deaktivieren
      REQUEST "Sollstellung wirklich deaktivieren?","",130,req%
      IF req% = 1 THEN 
        tvn% = lfdnr.KVERTRAG
        SELECT KEY tvn% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
        sollst.kvertrag = "n"
        CALL QuickStore("KVERTRAG")
        IF EXISTS (tvn%,codevt.kvskond) THEN 
          FILE "kvskond"
          INDEX codevt.kvskond
          SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
          REMOVE FROM FILE "kvskond" WHERE codevt.kvskond = tvn%
        END IF 
        IF EXISTS (tvn%,codevt.zeinvor) THEN 
          FILE "zeinvor"
          INDEX codevt.zeinvor
          SELECT FIRST FILE "zeinvor" INDEX codevt.zeinvor
          REMOVE FROM FILE "zeinvor" WHERE codevt.zeinvor = tvn%
        END IF 
      END IF 
    CASE 6
      REM Sollstellung aktivieren
      DIM KVKond$( RECCOUNT ("VPGEKOND"))
               REM *******************************************************************************************
               REM *   Einbeziehung der Produktkonditionen                                                   *
               REM *******************************************************************************************
               IF PrvVerfahr$ = "ZAHLUNGSEINGANG" AND GSoll$ LIKE "j" AND GAFSK$ <> "TRUE" THEN 
                 cfile$ = FILE 
                 alfdnr% = lfdnr.kvertrag
                 acodevp% = codevp.kvertrag
                 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF EXISTS (codevp.kvertrag,codevp.VPGEKOND) THEN 
                   zwtext$ = "an Hand derer die Sollstellung fÅr den Vertrag berechnet werden kann! BEACHTEN SIE, DASS VERTRéGE IN DER WéHRUNG DM NICHT IN DIE SOLLSTELLUNG öBERNOMMEN WERDEN KôNNEN!"
                   CALL Fehler("Sie erhalten jetzt die Mîglichkeit eine Produktkondition auszuwÑhlen,",zwtext$)
 
                   REQUEST "Wollen Sie den Vertrag an die Sollstellung Åbergeben ? ","",130,req1ab%
                   FILE "VPGEKOND"
                   INDEX codevp.VPGEKOND
                   SELECT FIRST 
                   SELECT KEY codevp.kvertrag FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   IF codew.kvertrag = 1 OR req1ab% <> 1 THEN 
                     IF codew.kvertrag = 1 THEN 
                       CALL Fehler("Der Vertrag kann nicht an die Sollstellung Åbergeben werden, da er noch in der WÑhrung DM gefÅhrt wird!","")
                     END IF 
                     GOTO endprodi190320041
                   END IF 
                   IF Bewertungssumme.kvertrag <= 0 THEN 
                     CALL Fehler("Der Vertrag kann nicht an die Sollstellung Åbergeben werden, da die Bewertungssumme <= 0 ist!","")
                     GOTO endprodi190320041
                   END IF 
                   a% = 0
                   gefunden% = 0
                   WHILE NOT EOF ("VPGEKOND") AND codevp.VPGEKOND = codevp.kvertrag
                     ok% = - 1
                     gefunden% = gefunden% + 1
                     IF bwvon.VPGEKOND > 0 THEN 
                       IF Gvuebs$ LIKE "TRUE" THEN 
                         IF Antragsdatum.kvertrag < bwvon.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       ELSE 
                         IF VS_Beginn.kvertrag < bwvon.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       END IF 
                     END IF 
                     IF bwbis.VPGEKOND > 0 THEN 
                       IF Gvuebs$ LIKE "TRUE" THEN 
                         IF Antragsdatum.kvertrag > bwbis.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       ELSE 
                         IF VS_Beginn.kvertrag > bwbis.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       END IF 
                     END IF 
                     IF ok% = 0 THEN 
                       fehl% = fehl% + 1
                       GOTO nextkond18032004
                     END IF 
                     IF ok% THEN 
                       KVKond$(a%) = "BWVon:" + DATE$ (bwvon.VPGEKOND,"0d.mm.yyyy") + " "
                       IF bwbis.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "BWBis:" + DATE$ (bwbis.VPGEKOND,"0d.mm.yyyy") + " "
                       END IF 
 
                       REM w110920051
                       IF (APKVMonatjn.VPGEKOND = "j" AND KVMonatFakt.VPGEKOND > 0) OR (APPfMonatjn.VPGEKOND = "j" AND PflMonatFakt.VPGEKOND > 0) THEN 
                         IF APKVMonatjn.VPGEKOND = "j" AND KVMonatFakt.VPGEKOND > 0 THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP-KV:Anz.Netto-BeitrÑge=" + LTRIM$ ( STR$ (KVMonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                         IF APPfMonatjn.VPGEKOND = "j" AND PflMonatFakt.VPGEKOND > 0 THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Pflegepflicht-BeitrÑge=" + LTRIM$ ( STR$ (PflMonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                         GOTO w110920052
                       END IF 

                       IF Monatjn.VPGEKOND = "j" AND MonatFakt.VPGEKOND > 0 THEN 
                         IF MonatBrutto.vpgekond = "j" THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Brutto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         ELSE 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Netto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                       END IF 
 
                       IF Pauschalejn.VPGEKOND = "j" AND Pauschale.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:Pauschale=" + LTRIM$ ( STR$ (Pauschale.VPGEKOND,"9999.0000")) + " " + Waehrung.kvertrag
                       END IF 
                   
                       IF apjn.VPGEKOND = "j" AND ap.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:" + LTRIM$ ( STR$ (ap.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       IF courtagejn.VPGEKOND = "j" AND courtage.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "Courtage:" + LTRIM$ ( STR$ (courtage.VPGEKOND,"9999.0000")) + " "
                         IF AnzCourtZahlung.vpgekond > 0 OR AnzCourtZahlung.kvertrag > 0 THEN 
                           anzcou% = 0
                           anzcou% = AnzCourtZahlung.vpgekond
                           REM IF AnzCourtZahlung.kvertrag > 0 THEN anzcou% = AnzCourtZahlung.kvertrag
                           KVKond$(a%) = KVKond$(a%) + "-Anzahl: " + LTRIM$ ( STR$ (anzcou%,"999.")) + "/  "
                         END IF 
                       END IF 
                       zus$ = ""
                       IF VDjn.VPGEKOND = "j" THEN 
                         IF VS_Dauer.kvertrag < 1 THEN 
                           CALL Fehler("Sie kînnen den Vertrag " + VS_NR.kvertrag + " nicht mittels den Konditionen zur Vertragslaufzeit and die Sollstellung Åbergeben,","da keine Laufzeit eingetragen wurde!")
                           GOTO endprodi190320041
                         ELSE 
                           ok% = 0
                           IF VS_Dauer.kvertrag <= VD5Dauer.VPGEKOND AND VD5Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD5AP.VPGEKOND,"9999.0000")) + " "
                             IF VD5SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD5SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD5HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD4Dauer.VPGEKOND AND VD4Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD4AP.VPGEKOND,"9999.0000")) + " "
                             IF VD4SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD4SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD4HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD3Dauer.VPGEKOND AND VD3Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD3AP.VPGEKOND,"9999.0000")) + " "
                             IF VD3SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD3SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD3HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD2Dauer.VPGEKOND AND VD2Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD2AP.VPGEKOND,"9999.0000")) + " "
                             IF VD2SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD2SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD2HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD1Dauer.VPGEKOND AND VD1Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD1AP.VPGEKOND,"9999.0000")) + " "
                             IF VD1SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD1SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD1HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF ok% = - 1 THEN 
                             KVKond$(a%) = KVKond$(a%) + zus$ + " "
                           ELSE 
                             CALL Fehler("Sie kînnen den Vertrag " + VS_NR.kvertrag + " nicht mittels den Konditionen zur Vertragslaufzeit and die Sollstellung Åbergeben,","da keine gÅltige Kondition eingetragen wurde!")
                             GOTO endprodi190320041
                           END IF 
                         END IF 
                       END IF 
w110920052: 
                       IF pflegejn.VPGEKOND = "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Pflege:" + LTRIM$ ( STR$ (pflegeProvi.VPGEKOND,"99.0000")) + " "
                       END IF 
                       IF srjn.VPGEKOND = "j" AND vdjn.vpgekond <> "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Storno:" + LTRIM$ ( STR$ (sr.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       KVKond$(a%) = KVKond$(a%) + SPACE$ (100) + STR$ (codekey.VPGEKOND,"000000")
                       IF bwstart% >= bwvon.vpgekond THEN 
                         IF bwbis.vpgekond > 0 THEN 
                           IF bwstart% <= bwbis.vpgekond THEN prompt$ = KVKond$(a%)
                         ELSE 
                           prompt$ = KVKond$(a%)
                         END IF 
                       END IF 
                       a% = a% + 1
                     END IF 
nextkond18032004:                     
                     SELECT NEXT FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   WEND 
                   IF a% = 0 AND fehl% > 0 THEN 
                     req% = 0
                     text1$ = "es wurden insgesamt " + LTRIM$ ( STR$ ("gefunden")) + "Konditionen gefunden,davon enthÑlt keine Kondition in den Feldern BWVON und/oder BWBIS einen Eintrag der mit"
                     CALL Fehler(text1$,"dem Provisionierungsbeginn des Vertrages harmonisiert")
                   ELSE 
                     KVKond$(a%) = ""
                     prompt$ = KVKond$(0)
                     CREATE DIALOG "MASUCH",0,0,358,288,"Sollstellungskonditionen","MS Sans Serif",8
                     ADD DIALOG "MASUCH",4,0,0,358,263,0,""
                     ADD DIALOG "MASUCH",9,9,11,21,21,2
                     ADD DIALOG "MASUCH",5,37,11,151,10,0,"Bitte wÑhlen Sie eine Kondition:"
                     ADD DIALOG "MASUCH",7,7,27,348,229,2,2,KVKond$,Auswahl$,prompt$
                     ADD DIALOG "MASUCH",1,100,268,55,15,1,"&OK",1,1
                     ADD DIALOG "MASUCH",1,160,268,55,15,0,"&Abbrechen",0,0
                     MOUSE ON 
                     DIALOG "MASUCH",req%
                     REMOVE DIALOG "MASUCH"
                   END IF 
                   IF req% = 1 THEN 
                     dDate$ = "0"
                     CodeKey% = VAL ( RIGHT$ (Auswahl$(0),6))
                     IF CodeKey% <> 0 THEN 
                       IF NOT EXISTS (cuvt%,codevt.kvskond) THEN 
                         BLANK FILE "KVSKOND"
                         CodeKey1% = SER ("KVSKOND",1)
                         CodeKey.kvskond = CodeKey1%
                         Codevt.KVSKOND = cuvt%
                         CodeKO.KVSKOND = CodeKey%
                         erledigt.KVSKOND = "n"
                         test1% = TODAY - 60
                         jetztlos% = 0
                         STORE FILE "KVSKOND"
                         UNLOCK CURRENT FILE "KVSKOND"
                         SELECT FIRST FILE "VPGEKOND" INDEX codekey.vpgekond
                         SELECT KEY codekey% FILE "VPGEKOND" INDEX codekey.vpgekond
                         IF CourtageJN.vpgekond LIKE "j" AND Courtage.vpgekond > 0 THEN 
                           REM hier mu· jetzt entschieden werden, ob AnzCourtZahlung.KVERTRAG einen Wert erhÑlt
                           anzcour% = 0
                           anzcour% = AnzCourtZahlung.vpgekond
                           anzcourold% = AnzCourtZahlung.vpgekond
                           IF anzcour% > 0 THEN 
                             SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
                             SELECT KEY cuvt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
                             t2$ = "Die Anzahl, die Sie eintragen wird beim Vertrag hinterlegt (wenn >0), ansonsten wird der durch die Sollstellungskondition vorgegebene Wert verwendet!"
                             CALL Fehler("Sie erhalten jetzt die Mîglichkeit, die Anzahl der zu zahlenden Courtagen (fÅr diesen Vertrag) genauer zu spezifizieren! ",t2$)
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellung","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie die Anzahl der"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Courtagen an:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,anzcour%,3
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Anzahl:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               IF anzcour% > 0 AND anzcour% <> anzcourold% THEN 
                                 AnzCourtZahlung.kvertrag = anzcour%
                                 STORE FILE "kvertrag"
                                 UNLOCK CURRENT FILE "kvertrag"
                               END IF 
                             END IF 
                           END IF 
                         END IF 
                         IF vs_beginn.kvertrag < test1% THEN 
                           atext$ = "ob die Zahlungen bis jetzt erfolgt sind und Sie die Sollstellung erst ab heutigem Datum generieren lassen wollen!"
                           CALL Fehler("Der Vertragsbeginn liegt mehr als 2 Monate zurÅck! Sie mÅssen selbst entscheiden, ob Sie die Sollstellung von Vertragsbeginn an erzeugen lassen mîchten oder,",atext$)
                           REQUEST "Sollstellung ab Vertragsbeginn generieren?","",135,req1234%
                           IF req1234% <> 1 THEN 
                             REM in kvskond verschiedene Sachen als erledigt kennzeichnen
 
                             dDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
                             _day% = DAY ( TODAY )
                             _month% = MONTH ( TODAY )
                             _year% = YEAR ( TODAY )
                             _day% = 1
                             dDate% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
                             dDate$ = DATE$ (dDate%,"0d.mm.yyyy")
datsoll180320041: 
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsbeginn","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, ab wann die"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellung beginnen soll:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,dDATE$,10
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Beginndatum:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               ELSE 
                                 GOTO datsoll180320041
                               END IF 
                             END IF 
                             SELECT KEY codekey% FILE "vpgekond" INDEX codekey.vpgekond
                             jetztlos% = 0
                           END IF 
                         END IF 
                       ELSE 
                         SELECT KEY cuvt% LOCK FILE "KVSKOND" INDEX codevt.KVSKOND
                         CodeKO.KVSKOND = CodeKey%
                         Codevt.KVSKOND = cuvt%
                         erledigt.KVSKOND = "n"
                         test1% = TODAY - 60
                         STORE FILE "KVSKOND"
                         UNLOCK CURRENT FILE "KVSKOND"
                         IF vs_beginn.kvertrag < test1% THEN 
                           atext$ = "ob die Zahlungen bis jetzt erfolgt sind und Sie die Sollstellung erst ab heutigem Datum generieren lassen wollen!"
                           CALL Fehler("Der Vertragsbeginn liegt mehr als 2 Monate zurÅck! Sie mÅssen selbst entscheiden, ob Sie die Sollstellung von Vertragsbeginn an erzeugen lassen mîchten oder,",atext$)
                           REQUEST "Sollstellung ab Vertragsbeginn generieren?","",135,req1234%
                           IF req1234% <> 1 THEN 
                             REM in kvskond verschiedene Sachen als erledigt kennzeichnen
 
                             dDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
datsoll180320042: 
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsbeginn","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, ab wann die"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellung beginnen soll:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,dDATE$,10
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Beginndatum:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               IF DateOK%(dDATE$) THEN 
                               ELSE 
                                 GOTO datsoll180320042
                               END IF 
                             END IF 
                             SELECT KEY codekey% FILE "vpgekond" INDEX codekey.vpgekond
                           END IF 
                         END IF 
                       END IF 
                       SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
                       sollst.kvertrag = "j"
                       STORE FILE "KVERTRAG"
                       UNLOCK FILE "KVERTRAG"
                       REQUEST "Wollen Sie jetzt gleich die Sollstellung ermitteln lassen?","",130,req1soll%
                       IF req1soll% = 1 THEN 
                         CALL Sollstellung(cuvt%,1,dDate$)
                       END IF 
                     END IF 
                   END IF 
                 END IF 
                 FILE cfile$
               END IF 
endprodi190320041: 
               REM ***********************Ende Produktkonditionen ********************************************  



    CASE 555
      REM Anzeige Sollstellungskonditionen
      REM CALL VPKondanz(codevp.kvertrag)
        codevp% = codevp.kvertrag
        IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
          IF EXISTS (codevp%,codevp.vpgekond) THEN 
            CALL VPGekond(codevp%)
          ELSE 
            REQUEST "Es existieren noch keine Konditionen fÅr dieses Produkt!","Neue Kondition anlegen?",130,req%
            IF req% = 1 THEN 
              CALL VPGekondNeu(codevp%)
              CALL VPGekond(codevp%)
            END IF 
          END IF 
        END IF 
   END SELECT 
 ELSE 
   REQUEST "nicht gefunden"
 END IF 
 FILE cfile$
 SELECT FORM KEY cuv% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF FORM <> "" THEN FORM 
 MOUSE ON 
 END SUB 
 
 'Sollstellungskonditionen aus dem Vertrag heraus einsehen
SUB ViewSoll()
        codevp% = codevp.kvertrag
        IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
          IF EXISTS (codevp%,codevp.vpgekond) THEN 
            CALL VPGekond(codevp%)
          ELSE 
            REQUEST "Es existieren noch keine Konditionen fÅr dieses Produkt!","Neue Kondition anlegen?",130,req%
            IF req% = 1 THEN 
              CALL VPGekondNeu(codevp%)
              CALL VPGekond(codevp%)
            END IF 
          END IF 
        END IF 
 END SUB 
 
SUB ViewSoll1(codevp%)
        REM codevp% = codevp.kvertrag
        IF NOT disabled%("SOLLSTELLUNGKOND") THEN 
          IF EXISTS (codevp%,codevp.vpgekond) THEN 
            CALL VPGekond(codevp%)
          ELSE 
            REQUEST "Es existieren noch keine Konditionen fÅr dieses Produkt!","Neue Kondition anlegen?",130,req%
            IF req% = 1 THEN 
              CALL VPGekondNeu(codevp%)
              CALL VPGekond(codevp%)
            END IF 
          END IF 
        END IF 
 END SUB 
 
 
 ' Vertrag aus Abrechnung nehmen
 ' =======================================================================
 ' 06.09.95 
 
SUB VERTRDeak()
 CALL DFile(3,"VKOND" + _fpw$)
 CREATE DIALOG "VDEAKTIV",0,0,235,132,title$,"MS Sans Serif",8
 ADD DIALOG "VDEAKTIV",9,9,12,22,24,2
 ADD DIALOG "VDEAKTIV",5,40,11,186,9,0,"Vertrag deaktivieren"
 ADD DIALOG "VDEAKTIV",4,40,20,186,5,0,""
 ADD DIALOG "VDEAKTIV",5,40,28,185,22,0,"Mit dieser Funktion kînnen Sie einen Vertrag aus der Provisionsabrechnung herausnehmen."
 ADD DIALOG "VDEAKTIV",5,40,51,185,18,0,"Klicken Sie auf " + CHR$ (34) + "Ja" + CHR$ (34) + ", wenn der Vertrag nicht mehr bei der Provisionsberechnung berÅcksichtigt werden soll."
 ADD DIALOG "VDEAKTIV",5,40,70,184,27,0,"Sie kînnen den Vertrag (nach erfolgter Korrektur der Vertragsdaten) erneut Åber den Button <Abrechnung> an die Vertragsabrechnung Åbergeben."
 ADD DIALOG "VDEAKTIV",1,58,107,55,15,0,"&Ja",1,1
 ADD DIALOG "VDEAKTIV",1,116,107,55,15,1,"&Nein",0,0
 DIALOG "VDEAKTIV",req%
 REMOVE DIALOG "VDEAKTIV"
 tvn% = lfdnr.KVERTRAG
 IF req% = 1 THEN 
   tvn% = lfdnr.KVERTRAG
   SELECT KEY tvn% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   cstatusold% = Codevstatus.kvertrag
   ProviAb.KVERTRAG = 0
   BewertcalcDat.kvertrag = 0
   KuenCourt1.kvertrag = ""
   VertragAktiv.kvertrag = "n"
   vorzeitig.kvertrag = ""
   IF GAFSK$ LIKE "TRUE" THEN 
     AFSKPAUJN.kvertrag = "n"
     AFSKPAUEUR.kvertrag = 0
     AFSKPAUDAT.kvertrag = 0
     REM QAFSKPAUDAT.kvertrag = "n" + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
     IF AFSKPauschDat.kvertrag < 1 THEN 

     END IF 
     IF AFSKPAUDAT.kvertrag < 1 THEN 
       QAFSKPAUDAT.kvertrag = AFSKPAUJN.kvertrag + "00000000"
     ELSE 
       QAFSKPAUDAT.kvertrag = AFSKPAUJN.kvertrag + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
     END IF 
     REM 15092005
     IF EXISTS (lfdnr.kvertrag,codevt.kvpsp) THEN 
       codevt% = lfdnr.kvertrag
       MOUSE OFF 
       datei$ = FILE 
       FILE "KVPSP"
       REMOVE FROM FILE "KVPSP" WHERE codevt.kvpsp = codevt%
       FILE datei$
     END IF 
     IF EXISTS (lfdnr.kvertrag,codevt.afspsp) THEN 
       REM CALL Fehler("Es wurden DatensÑtze aus der PSP - Datei gelîscht!","Sie mÅssen jetzt manuell kontrollieren , welche/r Zahlungseingang/e kÅnstlich erzeugt wurde/n und diese/n ggf. von Hand lîschen!")
       fi$ = FILE 
       codevt% = lfdnr.kvertrag
                     FILE "AFSPSP"
                     INDEX codevt.afspsp
                     SELECT FIRST 
                     SELECT KEY codevt% LOCK FILE "afspsp" INDEX codevt.afspsp
                     ok% = 1
                     MOUSE OFF 
                     codesutold% = 0
                     WHILE ok% = 1
                       IF codevt.afspsp = codevt% AND codesut.afspsp <> codesutold% THEN 
                         codesutold% = codesut.afspsp
                         IF codeaz.afspsp > 0 THEN 
                           REM das ist der erzeugt Zahlungseingang, der kann gelîscht werden, da er ja neu erzeugt wird
                           codeaz% = codeaz.afspsp
                           FILE "zeingan1"
                           INDEX codeaz.zeingan1
                           SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
                           IF codeaz.zeingan1 = codeaz% THEN 
                             SELECT REMOVE FILE "zeingan1"
                           END IF 
                         END IF 
                         codeaz.afspsp = 0
                         STORE FILE "afspsp"
                         UNLOCK FILE "afspsp"
                       ELSE 
                         ok% = 0
                       END IF 
                       FILE "afspsp"
                       SELECT NEXT LOCK FILE "afspsp" INDEX codevt.afspsp
                     WEND 
       FILE fi$
     END IF 
   END IF 
   REM ******************************************************************************************************************
   IF StatusZOK.kvertrag = "ESTORNO" OR StatusZOK.kvertrag = "MSTORNO" THEN 
     CALL ZentrAGZaehl(codema.kvertrag,StatusZOK.kvertrag,Bewertungssumme.kvertrag,Volumen.kvertrag,0,KÅndigung.KVERTRAG,1)
   END IF 
   REM ******************************************************************************************************************
   KÅndigung.kvertrag = 0
   storno.kvertrag = 0
   DynJN.kvertrag = "N"
   VStatusTXT.kvertrag = "Antrag"
   CodeVStatus.kvertrag = 12
   REM 210597
   TatsKuenDat.kvertrag = 0
   REM 140497
   letzteProvi = 0:gez_Abschlu·.KVERTRAG = "":gez_Pauschale.KVERTRAG = ""
   TZRate.KVERTRAG = 0:letztePflege.KVERTRAG = 0:Pool.KVERTRAG = 0:Mahnung.KVERTRAG = "n"
   REM 030697
   codeko.kvertrag = 0
   sollst.kvertrag = "n"
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     IF EXISTS (lfdnr.kvertrag,codevt.zeingang) THEN 
       SELECT FIRST FILE "zeingang" INDEX codevt.zeingang
       SELECT KEY lfdnr.kvertrag FILE "zeingang" INDEX codevt.zeingang
       pool% = 0
       codevt% = lfdnr.kvertrag
       WHILE NOT EOF ("zeingang") AND codevt.zeingang = codevt%
         IF codevt.zeingang = codevt% THEN 
           pool% = pool% + Betrageu.zeingang
         ELSE 
           GOTO w041020061
         END IF 
         SELECT NEXT FILE "zeingang" INDEX codevt.zeingang
       WEND 
w041020061: 
       pool$ = STR$ (pool%,"99999999.00")
       pool.kvertrag = VAL (pool$)
     END IF 
   END IF 
   CALL QuickStore("KVERTRAG")
   REM 110397 Lîschung der EintrÑge in der Buchungsdatei
   REM 230897
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     CALL DFile(3,"buchung" + _fpw$)
     FILE "Buchung"
     INDEX codevt.buchung
     SELECT FIRST 
     REM 060497
     SELECT KEY tvn% FILE "buchung" INDEX codevt.buchung
     WHILE NOT EOF ("Buchung") AND codevt.buchung = tvn%
       srb% = sr.buchung
       einheit% = einheiten.buchung
       volumen% = Volumen.buchung
       ma% = Codema.buchung
       IF (srb% <> 0 OR einheit% <> 0 OR volumen% <> 0) AND (cstatusold% <> 4) THEN 
         ma% = Codema.buchung
         vcodema% = vtcodema.buchung
         FILE "maadr"
         INDEX codema.maadr
         SELECT FIRST 
         SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
         IF srb% <> 0 THEN 
           Stornoreserve.maadr = stornoreserve.maadr - srb%
           StornoreserveEU.maadr = VAL ( STR$ (stornoreserve.maadr / umrechnung.buchung,"999999999.00"))
         END IF 
         IF einheit% <> 0 THEN 
           Einheiten.maadr = einheiten.maadr - einheit%
           IF ma% = vcodema% THEN 
             EigEinheiten.maadr = Eigeinheiten.maadr - einheit%
             EinheitGes.maadr = EinheitGes.maadr - einheit%
           ELSE 
             sEinheitGes.maadr = sEinheitGes.maadr - einheit%
           END IF 
         END IF 
         IF volumen% <> 0 THEN 
           gesvolumen.maadr = Gesvolumen.maadr - volumen%
           IF ma% = vcodema% THEN 
             eigvolumen.maadr = eigvolumen.maadr - volumen%
           END IF 
         END IF 
         REM Workstation.maadr = Workstation%
         REM QWoNo.maadr = STR$ (Workstation%,"000000") + STR$ (codema.maadr,"000000")
         RecStatus.maadr = "c"
         STORE FILE "maadr"
         UNLOCK CURRENT FILE "maadr"
       END IF 
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       betr% = Betrag.buchung * - 1
       IF Provision.buchung = "j" THEN 
         zusatz% = 0
       ELSE 
         zusatz% = 1
       END IF 
       IF vtcodema.buchung = codema.buchung THEN 
         eigen% = 1
       ELSE 
         eigen% = 0
       END IF 
       PSpAll$ = ""
       PSpAllSeit% = 0
       PROVSpEig$ = ""
       PSpESeit% = 0
       REM Vertrag wurde vorher schon storniert -> dadurch wurde schon alles runtergerechnet, bevor er deaktiviert wird 
     IF cstatusold% <> 4 THEN 
       datumz% = Datum.buchung
       codew1% = codew.buchung
       waehrung1$ = waehrung.buchung
       euro1% = umrechnung.buchung
       srb% = srb% * - 1
       IF Einheiten.buchung > 0 THEN 
         einheit% = Einheiten.buchung * - 1
       ELSE 
         einheit% = Einheiten.buchung
       END IF 
       CALL ZentrKTO(ma%,datumz%,betr%,srb%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,einheit%)
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       IF zusatz% = 0 THEN 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         AuszProvABGes.maadr = AuszProvABGes.maadr + betr%
         AuszProvABGesEU.maadr = VAL ( STR$ (AuszProvABGes.maadr / euro1%,"999999999.00"))
       ELSE 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         zusAuszahl.maadr = zusAuszahl.maadr + betr%
         zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
         aktZusB.maadr = aktZusB.maadr + betr%
         aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
       END IF 
       STORE FILE "maadr"
       UNLOCK CURRENT FILE "maadr"
     END IF 
       FILE "Buchung"
       SELECT NEXT FILE "Buchung" INDEX codevt.buchung
     WEND 
     REM 019798 REMOVE FROM FILE "Buchung" WHERE codevt.buchung = tvn%
     FILE "Buchung"
     INDEX codevt.buchung
     SELECT FIRST 
loebu010798: 
     IF EXISTS (tvn%,codevt.buchung) THEN 
       SELECT FIRST FILE "Buchung" INDEX codevt.buchung
       SELECT KEY tvn% LOCK FILE "Buchung" INDEX codevt.buchung
       SELECT REMOVE FILE "Buchung"
       SELECT FIRST FILE "Buchung"
       GOTO loebu010798
     END IF 
 
      
     REM 010798 REMOVE FROM FILE "VKOND" WHERE codevt.vkond = tvn%
     FILE "vkond"
     INDEX codevt.VKOND
     SELECT FIRST 
loevk010798: 
     IF EXISTS (tvn%,codevt.VKOND) THEN 
       SELECT FIRST FILE "VKOND" INDEX codevt.VKOND
       SELECT KEY tvn% LOCK FILE "VKOND" INDEX codevt.VKOND
       SELECT REMOVE FILE "VKOND"
       SELECT FIRST FILE "VKOND"
       GOTO loevk010798
     END IF 
 
   ELSE 
     IF EXISTS (tvn%,codevt.kvskond) THEN 
       MOUSE OFF 
       FILE "kvskond"
       INDEX codevt.kvskond
       SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
       REMOVE FROM FILE "kvskond" WHERE codevt.kvskond = tvn%
       CLOSE FILE "kvskond"
       CALL DFile(3,"kvskond" + _fpw$)
       FILE "kvskond"
       INDEX codevt.kvskond
     END IF 
     IF EXISTS (tvn%,codevt.zeinvor) THEN 
       MOUSE OFF 
       FILE "zeinvor"
       INDEX codevt.zeinvor
       SELECT FIRST FILE "zeinvor" INDEX codevt.zeinvor
       REMOVE FROM FILE "zeinvor" WHERE codevt.zeinvor = tvn%
       CLOSE FILE "zeinvor"
       CALL DFile(3,"zeinvor" + _fpw$)
       FILE "zeinvor"
       INDEX codevt.zeinvor
     END IF 
     CALL DFile(3,"zeingan1" + _fpw$)
     FILE "zeingan1"
     INDEX codevt.zeingan1
     CALL DFile(3,"buchung1" + _fpw$)
     IF EXISTS (tvn%,codevt.spezkond) THEN 
       MOUSE OFF 
       FILE "spezkond"
       INDEX codevt.spezkond
       SELECT FIRST FILE "spezkond" INDEX codevt.spezkond
       SELECT KEY tvn% LOCK FILE "spezkond" INDEX codevt.spezkond
       WHILE NOT EOF ("Spezkond") AND codevt.spezkond = tvn%
         einmaligerfolgt.spezkond = "n"
         EinmDatum.spezkond = 0
         STORE FILE "spezkond"
         UNLOCK CURRENT 
         SELECT NEXT LOCK FILE "spezkond" INDEX codevt.spezkond
       WEND 
     END IF 
     FILE "Buchung1"
     INDEX codevt.buchung1
     SELECT FIRST 
     REM 060497
     SET STATUS "RÅckrechnung Einheiten/Volumen fÅr Mitarbeiter"
     SELECT FIRST FILE "buchung1" INDEX codevt.buchung1
     SELECT KEY tvn% FILE "buchung1" INDEX codevt.buchung1
     WHILE NOT EOF ("Buchung1") AND codevt.buchung1 = tvn%
       MOUSE OFF 
       IF provision.buchung1 <> "j" THEN GOTO w201220041
       srb% = sr.buchung1
       einheit% = einheiten.buchung1
       volumen% = Volumen.buchung1
       ma% = Codema.buchung1
       IF srb% <> 0 OR einheit% <> 0 OR volumen% <> 0 THEN 
         ma% = Codema.buchung1
         vcodema% = vtcodema.buchung1
         FILE "maadr"
         INDEX codema.maadr
         SELECT FIRST 
         SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
         IF srb% <> 0 THEN 
           Stornoreserve.maadr = stornoreserve.maadr - srb%
           StornoreserveEU.maadr = VAL ( STR$ (stornoreserve.maadr / Umrechnung.buchung1,"999999999.00"))
         END IF 
         IF einheit% <> 0 THEN 
           Einheiten.maadr = einheiten.maadr - einheit%
           IF ma% = vcodema% THEN 
             EigEinheiten.maadr = Eigeinheiten.maadr - einheit%
             EinheitGes.maadr = EinheitGes.maadr - einheit%
           ELSE 
             sEinheitGes.maadr = sEinheitGes.maadr - einheit%
           END IF 
         END IF 
         IF volumen% <> 0 THEN 
           gesvolumen.maadr = Gesvolumen.maadr - volumen%
           IF ma% = vcodema% THEN 
             eigvolumen.maadr = eigvolumen.maadr - volumen%
           END IF 
         END IF 
         REM Workstation.maadr = Workstation%
         REM QWoNo.maadr = STR$ (Workstation%,"000000") + STR$ (codema.maadr,"000000")
         RecStatus.maadr = "c"
         STORE FILE "maadr"
         UNLOCK CURRENT FILE "maadr"
       END IF 
       MOUSE ON 
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       betr% = Betrag.buchung1 * - 1
       IF Provision.buchung1 = "j" THEN 
         zusatz% = 0
       ELSE 
         zusatz% = 1
       END IF 
       IF vtcodema.buchung1 = codema.buchung1 THEN 
         eigen% = 1
       ELSE 
         eigen% = 0
       END IF 
       PSpAll$ = ""
       PSpAllSeit% = 0
       PROVSpEig$ = ""
       PSpESeit% = 0
       datumz% = Datum.buchung1
       codew1% = codew.buchung1
       waehrung1$ = waehrung.buchung1
       euro1% = umrechnung.buchung1
       srb% = srb% * - 1
       IF einheiten.buchung1 > 0 THEN 
         einheit% = einheiten.buchung1 * - 1
       ELSE 
         einheit% = einheiten.buchung1
       END IF 
       CALL ZentrKTO(ma%,datumz%,betr%,srb%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,einheit%)

       SELECT FIRST FILE "maadr" INDEX codema.maadr
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       IF zusatz% = 0 THEN 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         AuszProvABGes.maadr = AuszProvABGes.maadr + betr%
         AuszProvABGesEU.maadr = VAL ( STR$ (AuszProvABGes.maadr / euro1%,"999999999.00"))
       ELSE 
         AuszahlAB.maadr = AuszahlAB.maadr + betr%
         AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
         zusAuszahl.maadr = zusAuszahl.maadr + betr%
         zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
         aktZusB.maadr = aktZusB.maadr + betr%
         aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
       END IF 
       STORE FILE "maadr"
       UNLOCK CURRENT FILE "maadr"
 
 
w201220041:       
       FILE "Buchung1"
       SELECT NEXT FILE "Buchung1" INDEX codevt.buchung1
     WEND 
     IF EXISTS (tvn%,codevt.kvfael) AND GAFSK$ = "TRUE" THEN 
       MOUSE OFF 
       SELECT FIRST FILE "KVFAEL" INDEX codevt.kvfael
       SELECT KEY tvn% LOCK FILE "KVFAEL" INDEX codevt.kvfael
       REM REMOVE FROM FILE "KVFAEL" WHERE codevt.kvfael = tvn%
       gezProv.kvfael = 0
       gezProvEU.kvfael = 0
       gezProvAnz.kvfael = 0
       TgezProvAnz.kvfael = 0
       StornoBetrag.kvfael = 0
       StornoBetrEU.kvfael = 0
       StornoDat.kvfael = 0
       gez_Abschlu·.kvfael = "n"
       gezahltam.kvfael = 0
       VMProv.kvfael = 0
       erledigt.kvfael = "n"
       abserledigt.kvfael = "n"
       autokuend.kvfael = "n"
       REM faelligam.kvfael = 0
       erwProvAnz.kvfael = 0
       gezProvAnz.kvfael = 0
       STORE FILE "kvfael"
       UNLOCK CURRENT FILE "KVFAEL"
     END IF 
     SET STATUS "RÅcksetzen Zahlungseingangsdatei"
     IF EXISTS (tvn%,codevt.Zeingan1) THEN 
       MOUSE OFF 
       SELECT WHERE FILE "zeingan1"
       abc% = 1
       SELECT FIRST FILE "Zeingan1" INDEX codevt.Zeingan1
       REM SET STATUS "vor while und lock"
       SELECT KEY tvn% FILE "Zeingan1" INDEX codevt.Zeingan1
       ErrZAB% = 0
       ON ERROR GOTO ErrorHandler
       SELECT CURRENT LOCK FILE "Zeingan1" INDEX codevt.Zeingan1
       WHILE NOT EOF ("Zeingan1") AND codevt.Zeingan1 = tvn%
         IF tvn% = codevt.zeingan1 THEN 
           SET STATUS "in while"
           gebuchtJN.zeingan1 = "N"
           gebuchtJNT.zeingan1 = "N"
           STORE FILE "zeingan1"
           UNLOCK CURRENT FILE "Zeingan1"
           SET STATUS "in while nach unlock"
         END IF 
         IF EXISTS (tvn%,codevt.Zeingan1) THEN 
           SELECT NEXT LOCK FILE "Zeingan1" INDEX codevt.Zeingan1
         ELSE 
           SELECT LAST FILE "Zeingan1" INDEX codevt.Zeingan1
         END IF 
         SET STATUS "in while nach select next"
       WEND 
       ErrZAB% = 0
     END IF 
     SET STATUS ""
     REM 019798 REMOVE FROM FILE "Buchung" WHERE codevt.buchung = tvn%
     FILE "Buchung1"
     INDEX codevt.buchung1
     SELECT FIRST 
     IF EXISTS (tvn%,codevt.buchung1) THEN 
       SELECT FIRST FILE "Buchung1" INDEX codevt.buchung1
       SELECT KEY tvn% LOCK FILE "Buchung1" INDEX codevt.buchung1
     ELSE 
       SELECT LAST 
     END IF 
     REQUEST "Sollen die BuchungssÑtze gelîscht werden?","",130,req%
loebu0107981: 
     MOUSE OFF 
     ErrZAB% = 0
     REM CALL Fehler("Test","")
     IF GAFSK$ LIKE "TRUE" THEN 
       
       IF req% <> 1 THEN GOTO loe020120051
     END IF 
     IF EXISTS (tvn%,codevt.buchung1) AND codevt.buchung1 = tvn% AND NOT EOF ("buchung1") THEN 
       MOUSE OFF 
       SET STATUS "lîschen in buchung1"
       IF provision.buchung1 = "j" THEN 
         SELECT REMOVE FILE "buchung1"
         SELECT FIRST FILE "buchung1"
         IF RECCOUNT ("buchung1") > 0 THEN 
           SELECT FIRST FILE "Buchung1" INDEX codevt.buchung1
           SELECT KEY tvn% LOCK FILE "Buchung1" INDEX codevt.buchung1
         ELSE 
           SELECT LAST FILE "buchung1"
         END IF 
       ELSE 
         SELECT NEXT LOCK FILE "buchung1"
       END IF 
       MOUSE OFF 
       REM SELECT FIRST 
       GOTO loebu0107981
     END IF 
 
loe020120051:      
     REM 010798 REMOVE FROM FILE "VKOND" WHERE codevt.vkond = tvn%
     FILE "vkond"
     INDEX codevt.VKOND
     SELECT FIRST 
loevk0107982: 
     ErrZAB% = 0
     IF EXISTS (tvn%,codevt.VKOND) THEN 
       SET STATUS "in vkond"
       SELECT FIRST FILE "VKOND" INDEX codevt.VKOND
       SELECT KEY tvn% LOCK FILE "VKOND" INDEX codevt.VKOND
       SELECT REMOVE FILE "VKOND"
       SELECT FIRST FILE "VKOND" INDEX codevt.VKOND
       GOTO loevk0107982
     END IF 
   END IF 
   FILE "kvertrag"
   SET STATUS "Vertrag wurde deaktiviert"
   END IF 
   FILE "kvertrag"
   SET STATUS "Vertrag wurde deaktiviert"
 ELSE 
   SET STATUS "Bereit"
   vstatus% = 2
 END IF 
 SELECT FORM KEY tvn% FILE "kvertrag" INDEX lfdnr.kvertrag
 FORM 
 cuvt% = tvn%
 ErrZAB% = 0
 END SUB 
 
 ' Vertrag stornieren
 ' =======================================================================
 ' 220697
 
SUB VERTRStorno()
 vnr% = lfdnr.KVERTRAG

 cfile$ = FILE 
 MOUSE OFF 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"buchtemp" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"foerkond" + _fpw$)
 MOUSE ON 
 IF Storno.KVERTRAG = 1 OR Storno.KVERTRAG = 2 THEN 
   CREATE DIALOG "STORNO",0,0,189,87,title$,"MS Sans Serif",8
   ADD DIALOG "STORNO",9,6,7,22,22,3
   ADD DIALOG "STORNO",5,32,8,145,10,0,"Der aktuelle Vertrag wurde bereits storniert!"
   ADD DIALOG "STORNO",5,32,19,149,48,0,"Falls Sie énderungen an den Stornodaten vornehmen wollen, bearbeiten Sie bitte die entsprechenden BuchungssÑtze in der Buchungsdatei (Funktion Nachbearbeitung von BuchungssÑtzen)."
   ADD DIALOG "STORNO",1,66,65,55,15,1,"&OK",0,0
   DIALOG "STORNO",req%
   REMOVE DIALOG "STORNO"
 ELSE 
   einheit$ = "n"
   srkont$ = "n"
   srno$ = "n"
datok170698: 
   REM 130199
   stornowert% = 0
   SELECT KEY vnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
     IF ( TODAY - Antragsdatum.kvertrag) > 365 THEN 
       opt% = 2
     ELSE 
       opt% = 1
     END IF 
     Einhwert% = Einheiten.kvertrag
     CREATE DIALOG "STORNO",0,0,202,290,title$,"MS Sans Serif",8
     ADD DIALOG "STORNO",4,0,0,202,183,0,""
     REM ADD DIALOG "STORNO",9,8,14,20,21,2
     ADD DIALOG "STORNO",5,13,8,63,10,0,"Vertrag stornieren"
     ADD DIALOG "STORNO",4,13,15,151,5,0,""
     ADD DIALOG "STORNO",5,13,20,149,16,0,"Bitte geben Sie an, ob und wie der Vertrag storniert werden soll."
     ADD DIALOG "STORNO",3,13,38,108,10,0,"Vertrag nicht stornieren",0,stornowert%
     ADD DIALOG "STORNO",3,13,50,108,10,0,"vollstÑndige RÅckbuchung",1,stornowert%
     ADD DIALOG "STORNO",3,13,62,108,10,0,"anteilige RÅckbuchung",2,stornowert%
     ADD DIALOG "STORNO",3,13,86,108,10,0,"ohne RÅckbuchung",3,stornowert%
     ADD DIALOG "STORNO",3,13,98,128,10,0,"alle Buchungen ab Datum stornieren",4,stornowert%
     ADD DIALOG "STORNO",5,42,74,23,10,0,"Anteil:"
     ADD DIALOG "STORNO",6,67,73,22,11,0,0,StornoAnteil.KVERTRAG,20
     ADD DIALOG "STORNO",6,142,98,43,11,0,0,stordat1$,10
     
 
     ADD DIALOG "STORNO",5,93,74,22,9,0,"% "
     REM ADD DIALOG "STORNO",5,93,90,22,9,0,"% oder"
     REM ADD DIALOG "STORNO",6,121,89,50,11,0,0,StornoBetrag.KVERTRAG,20
     REM ADD DIALOG "STORNO",5,174,90,12,9,0,"DM"
 
     ADD DIALOG "STORNO",5,5,118,90,10,0,"Vertragsablaufdatum:"
     ADD DIALOG "STORNO",6,80,118,43,11,0,0,KÅndigung.KVERTRAG,10
     ADD DIALOG "STORNO",2,142,118,44,11,0,"vorzeitig?","j","n",vorzeitig.KVERTRAG
     ADD DIALOG "STORNO",5,5,136,140,10,0,"Buchungsdatum des Stornodatensatzes:"
     ADD DIALOG "STORNO",6,142,136,43,11,0,0,buchdat1$,10
 
     ADD DIALOG "STORNO",5,5,150,125,10,0,"Provisionsberechnung erfolgt bis zum:"
     ADD DIALOG "STORNO",6,142,150,43,11,0,0,TatsKuenDat.KVERTRAG,10
     einheit$ = "j"
     srkont$ = ""
     ADD DIALOG "STORNO",2,4,170,120,11,0,"Einheitenkonto runterrechnen ? ","j","n",einheit$
     ADD DIALOG "STORNO",6,122,170,43,11,0,0,Einhwert%,10

     ADD DIALOG "STORNO",4,0,185,202,50,0,"Optionen Stornokonto"
     REM ADD DIALOG "STORNO",2,4,195,184,11,0,"Stornokono anteilig runterrechnen?","j","n",srkont$
     REM ADD DIALOG "STORNO",2,4,207,184,11,0,"Storno komplett aus dem Stornokonto entnehmen?","j","n",srkont$
     optab% = 1
     ADD DIALOG "STORNO",3,4,195,183,10,0,"Stornokonto anteilig runterrechnen",1,optab%
     ADD DIALOG "STORNO",3,4,207,185,10,0,"Storno komplett aus dem Stornokonto entnehmen",2,optab%
     ADD DIALOG "STORNO",3,4,219,195,10,0,"Storno komplett aus der laufenden Provision entnehmen",3,optab%


     REM ADD DIALOG "STORNO",2,34,165,144,11,0,"evt. Stornores. nicht auszahlen ?","j","n",srno$
 
     ADD DIALOG "STORNO",4,0,240,202,30,0,""
     ADD DIALOG "STORNO",3,39,245,153,10,0,"Einjahresstorno",1,opt%
     ADD DIALOG "STORNO",3,39,257,155,10,0,"Mehrjahresstorno",2,opt%
 
     ADD DIALOG "STORNO",1,37,272,55,15,1,"&OK",1,1
     ADD DIALOG "STORNO",1,96,272,55,15,0,"&Abbrechen",0,0
     DIALOG "STORNO",req%
     REMOVE DIALOG "STORNO"
     IF optab% = 1 OR optab% = 2 THEN 
       srkont$ = "j"
     ELSE 
       srkont$ = "n"
     END IF 
   ELSE 
     stornowert% = 3
     IF KÅndigung.kvertrag > 0 THEN 
       kkuend$ = KÅndigung.kvertrag
     ELSE 
       kkuend$ = TODAY 
     END IF 
     
     vorzeitig$ = "j"
     CREATE DIALOG "STORNO",0,0,192,200,title$,"MS Sans Serif",8
     ADD DIALOG "STORNO",4,0,0,192,168,0,""
     ADD DIALOG "STORNO",9,8,14,20,21,2
     ADD DIALOG "STORNO",5,33,14,63,10,0,"Vertrag stornieren"
     ADD DIALOG "STORNO",4,33,21,151,5,0,""
     ADD DIALOG "STORNO",5,33,30,149,16,0,"Bitte geben Sie an, ob und wie der Vertrag storniert werden soll."
     ADD DIALOG "STORNO",5,33,60,149,36,0,"Sollen BetrÑge zurÅckgebucht werden,mÅssen Sie diese beim Zahlungseingang mit negativem Vorzeichen erfassen!"
     REM ADD DIALOG "STORNO",3,33,54,108,10,0,"Vertrag nicht stornieren",0,stornowert%
     IF GAFSK$ <> "TRUE" THEN 
       ADD DIALOG "STORNO",3,33,102,98,10,0,"ohne RÅckbuchung",3,stornowert%
     END IF 
     ADD DIALOG "STORNO",5,34,121,25,10,0,"Ablauf:"
     ADD DIALOG "STORNO",6,61,120,43,11,0,0,kkuend$,10
     ADD DIALOG "STORNO",2,113,120,44,11,0,"vorzeitig?","j","n",vorzeitig$
     ADD DIALOG "STORNO",1,37,172,55,15,1,"&OK",1,1
     ADD DIALOG "STORNO",1,96,172,55,15,0,"&Abbrechen",0,0
     DIALOG "STORNO",req%
     REMOVE DIALOG "STORNO"
     IF req% = 1 THEN 
       KÅndigung.KVERTRAG = kkuend$
       vorzeitig.KVERTRAG = vorzeitig$
       IF StorWarnJN.kvertrag = "j" THEN StorWarnJN.kvertrag = "c"
     END IF 
   END IF 
   REM DIALOG "STORNO",req%
   REM REMOVE DIALOG "STORNO"
   DATEBASE "0d.mm.yyyy"
   REM IF req% <> 1 THEN vstatus% = 2
   IF req% <> 1 THEN vstatus% = 0
   IF req% = 1 THEN 
     lfdnr% = lfdnr.kvertrag
     sto% = storno.kvertrag
     IF storno.kvertrag > 0 AND storno.kvertrag <> 3 THEN 
       IF Proviab.kvertrag > 0 THEN 
         CALL Fehler("Der Vertrag wurde schon storniert!","Wenn Sie Korrekturen vornehmen wollen, mÅssen Sie den Vertrag zunÑcht deaktivieren und dann neu berechnen lassen. Danach kînnen Sie den Vertrag erneut stornieren!")
         GOTO EndStorno
       ELSE 
         IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
           REMOVE FROM FILE "Buchung" WHERE codevt.buchung = lfdnr%
           CLOSE FILE "Buchung"
           CALL DFile(3,"Buchung" + _fpw$)
         ELSE 
           REMOVE FROM FILE "Buchung1" WHERE codevt.buchung1 = lfdnr%
           CLOSE FILE "Buchung1"
           CALL DFile(3,"Buchung1" + _fpw$)
         END IF 

       END IF 
     ELSE 
       IF proviab.kvertrag < 1 THEN 
         IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
           REMOVE FROM FILE "Buchung" WHERE codevt.buchung = lfdnr%
           CLOSE FILE "Buchung"
           CALL DFile(3,"Buchung" + _fpw$)
         ELSE 
           REMOVE FROM FILE "Buchung1" WHERE codevt.buchung1 = lfdnr%
           CLOSE FILE "Buchung1"
           CALL DFile(3,"Buchung1" + _fpw$)
         END IF 
       END IF 
     END IF 
     REM 190398
     MOUSE OFF 
     IF buchdat1$ = "" THEN buchdat1$ = TODAY 
     IF NOT DateOK%(buchdat1$) THEN GOTO datok170698
     IF stordat1$ <> "" THEN 
       IF NOT DateOK%(stordat1$) THEN GOTO datok170698
     END IF 
     IF stornowert% = 4 AND stordat1$ = "" THEN 
       CALL Fehler("Sie haben die  Option >alle Buchungen ab Datum stornieren< gewÑhlt, haben aber vergessen das Datumsfeld auszufÅllen!","")
     END IF 
     kÅnd% = KÅndigung.KVERTRAG
     IF KÅndigung.KVERTRAG < 1 THEN 
       KÅndigung.KVERTRAG = TODAY 
       kÅnd% = TODAY 
     END IF 
     kÅnd$ = KÅndigung.KVERTRAG
     REM CALL Fehler(kÅnd$,"")
     REM 230699
     IF NOT DateOK%( DATE$ (kÅnd%)) THEN GOTO datok170698
     REM 210597
     tkÅnd% = TatsKuenDat.KVERTRAG
     IF TatsKuenDat.KVERTRAG < 1 THEN 
       REM TatsKuenDat.KVERTRAG = TODAY 
       TatsKuenDat.KVERTRAG = kÅnd%
       REM tkÅnd% = TODAY 
       tkÅnd% = kÅnd%
     END IF 
     IF NOT DateOK%( DATE$ (tkÅnd%)) THEN GOTO datok170698
     IF TatsKuenDat.KVERTRAG < Proviab.kvertrag THEN 
       CALL Fehler ("Das Datum der Provisionsberechnung bis zum: " + DATE$ (tkÅnd%,"0d.mm.yyyy"),"mu· >= dem Datum der Provisionsberechnung ab:" + DATE$ (proviab.kvertrag,"0d.mm.yyyy") + "sein!")
       GOTO datok170698
     END IF 
       IF ProviAb.kvertrag > 0 AND ProviAb.kvertrag <= TODAY THEN 
         IF DAYS (KÅnd$) > 0 THEN 
           IF DAYS (KÅnd$) >= TODAY THEN 
             VertragAktiv.kvertrag = "j"
           ELSE 
             VertragAktiv.kvertrag = "n"
           END IF 
         ELSE 
           VertragAktiv.kvertrag = "j"
         END IF 
       ELSE 
         VertragAktiv.kvertrag = "n"
       END IF 
       IF TatsKuenDat.kvertrag > 0 THEN 
         IF TatsKuenDat.kvertrag >= TODAY THEN 
           VertragAktiv.kvertrag = "j"
         ELSE 
           VertragAktiv.kvertrag = "n"
         END IF 
       END IF 
     Storno.KVERTRAG = stornowert%
     CodeVStatus.kvertrag = 4
     VStatusTXT.kvertrag = "storniert"
     REM *************************************************************************************************************
     REM        fÅr Stornoverrechnung
     IF opt% = 1 THEN 
       StatusZOK.kvertrag = "ESTORNO"
     ELSE 
       StatusZOK.kvertrag = "MSTORNO"
     END IF 
     CALL ZentrAGZaehl(codema.kvertrag,StatusZOK.kvertrag,Bewertungssumme.kvertrag,Volumen.kvertrag,0,KÅndigung.KVERTRAG,0)
     REM *************************************************************************************************************
     CALL QuickStore("KVERTRAG")
     
     IF stornowert% = 1 OR stornowert% = 2 OR stornowert% = 4 THEN 
       SET STATUS "Stornobuchung wird durchgefÅhrt..."
       REMOVE FROM FILE "BUCHTEMP"
       REM - Provisionen in Datei BUCHTEMP Åbernehmen
       FILE "Stamm"
       SELECT FIRST 
       FILE "BUCHUNG"
       INDEX CodeVT.BUCHUNG
       SELECT FIRST 
       SELECT KEY vnr% FILE "BUCHUNG" INDEX CodeVT.BUCHUNG
       WHILE CodeVT.BUCHUNG = vnr% AND NOT EOF ("BUCHUNG")
         MOUSE OFF 
         SET STATUS "Stornobuchung wird durchgefÅhrt...(Zahlung vom " + DATE$ (Datum.BUCHUNG,"0d.mm.yyyy") + ")"
         ok% = - 1
         IF stornowert% = 4 THEN 
           IF datum.buchung < stordat1$ THEN ok% = 0
         ELSE 
           ok% = - 1
         END IF 
         IF ok% = - 1 THEN 
           BLANK FILE "BUCHTEMP"
           CodeBU.BUCHTEMP = SER ("BUCHTEMP",1)
           CodeVT.BUCHTEMP = CodeVT.BUCHUNG
           CodeMA.BUCHTEMP = CodeMA.BUCHUNG
           codew.Buchtemp = 3
           umrechnung.buchtemp = 1
           waehrung.buchtemp = "EUR"
           codeW% = 3
           euro1% = 1
           waehrung$ = "EUR"
           QuickCode.BUCHTEMP = CodeMA.BUCHTEMP * 1000000 + CodeVT.BUCHTEMP
           IF Storno.KVERTRAG = 1 OR stornowert% = 4 THEN 
             Betrag.BUCHTEMP = BetragEU.BUCHUNG
             IF einheit$ = "j" THEN 
               REM 01112005 
               REM 
               IF EinheitSach.stamm = "j" THEN 
                 IF codema.buchung = codema.kvertrag THEN 
                   IF Einhwert% <> 0 THEN 
                     Einheiten.buchtemp = Einhwert%
                   ELSE 
                     Einheiten.buchtemp = Einheiten.Buchung
                   END IF 
                 END IF 
               ELSE 
                 IF Einhwert% <> 0 THEN 
                   Einheiten.buchtemp = Einhwert%
                 ELSE 
                   Einheiten.buchtemp = Einheiten.Buchung
                 END IF 
               END IF 
             END IF 
             REM IF srkont$ = "j" THEN SR.buchtemp = SR.Buchung
             SR.buchtemp = SREU.Buchung
           END IF 
           IF stornowert% <> 4 THEN 
             IF Storno.KVERTRAG = 2 THEN 
               Betrag.BUCHTEMP = BetragEU.Buchung / 100 * StornoAnteil.KVERTRAG
               IF einheit$ = "j" THEN 
                 IF EinheitSach.stamm = "j" THEN 
                   IF codema.buchung = codema.kvertrag THEN 
                     IF Einhwert% <> 0 THEN 
                       Einheiten.BUCHTEMP = Einhwert% / 100 * StornoAnteil.KVERTRAG
                     ELSE 
                       Einheiten.BUCHTEMP = Einheiten.Buchung / 100 * StornoAnteil.KVERTRAG
                     END IF 
                   END IF 
                 ELSE 
                   IF Einhwert% <> 0 THEN 
                     Einheiten.BUCHTEMP = Einhwert% / 100 * StornoAnteil.KVERTRAG
                   ELSE 
                     Einheiten.BUCHTEMP = Einheiten.Buchung / 100 * StornoAnteil.KVERTRAG
                   END IF 
                 END IF 
               END IF 
               REM IF srkont$ = "j" THEN SR.BUCHTEMP = SR.Buchung / 100 * StornoAnteil.KVERTRAG
               SR.BUCHTEMP = SREU.Buchung / 100 * StornoAnteil.KVERTRAG
             END IF 
           END IF 
           CALL QuickStore("BUCHTEMP")
         END IF 
         SELECT NEXT FILE "BUCHUNG" INDEX CodeVT.BUCHUNG
       WEND 
       REM CALL Fehler("Storno1","")
       REM - Summen aus BUCHTEMP bilden - und irgendwie mit AUMSATZ verrechnen
 
       IF RECCOUNT ("BUCHTEMP") <> 0 THEN 
         FILE "BUCHTEMP"
         INDEX QuickCode.BUCHTEMP
         SELECT FIRST 
         WHILE NOT EOF ("BUCHTEMP")
           quickcode% = QuickCode.BUCHTEMP
           summe% = 0
           SummeEinh% = 0
           SummeSR% = 0
           codematmp% = CodeMA.BUCHTEMP
           SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
           SELECT KEY CodeMAtmp% LOCK FILE "MAADR" INDEX CodeMA.MAADR
           SET STATUS "Stornobuchung wird durchgefÅhrt...(Agentur " + Nachname.MAADR + ", " + Vorname.MAADR + ")"
           WHILE QuickCode.BUCHTEMP = quickcode% AND NOT EOF ("BUCHTEMP")
             Summe% = Summe% + Betrag.BUCHTEMP
             IF einheit$ = "j" THEN SummeEinh% = SummeEinh% + Einheiten.BUCHTEMP
             REM IF srkont$ = "j" THEN SummeSR% = SummeSR% + SR.Buchtemp
             SummeSR% = SummeSR% + SR.Buchtemp
             SELECT NEXT FILE "BUCHTEMP" INDEX QuickCode.BUCHTEMP
           WEND 
           REM CALL Fehler("Storno2","")
           IF summe% <> 0 THEN 
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             BLANK FILE "BUCHUNG"
             CodeBU.BUCHUNG = SER ("BUCHUNG",1)
             codew.buchung = 3
             umrechnung.buchung = 1
             waehrung.buchung = "EUR"
             REM 06052003
             IF optab% = 1 THEN 
               srkont$ = "j"
               REM anteilig aus SR und Prov
               sr1% = stornoreserve.maadr
               sr2% = Stornoab.maadr
               IF stornoreserve.maadr >= Stornoab.maadr AND StornoVerrech.maadr <> "j" THEN 
                 REM auf dem Stornoreservekonto ist ein Guthaben
                 SR.Buchung = 0 - SummeSR%
               ELSE 
                 REM auf dem Stornoreservekonto ist kein oder weniger Guthaben
                 CALL Fehler("Das Guthaben des Stornoreserve-Konto des Mitarbeiter " + Nachname.maadr,"ist kleiner als das Betrag der SR-Auszahlungsschwelle")
                 REQUEST "Soll trotzdem der Betrag aus der SR genommen werden?","",135,req%
                 IF req% = 1 THEN 
                   SR.Buchung = 0 - SummeSR%
                 ELSE 
                   SR.Buchung = 0
                   Summe% = Summe% + SummeSR%
                 END IF 
               END IF 
             END IF 
             IF optab% = 2 THEN 
               REM komplett aus Storno
               srkont$ = "j"
               IF stornoreserve.maadr >= Stornoab.maadr AND StornoVerrech.maadr <> "j" THEN 
                 SummeSR% = Summe% + SummeSR%
                 SR.Buchung = 0 - SummeSR%
                 Summe% = 0
               ELSE 
                 CALL Fehler("Das Guthaben des Stornoreserve-Konto des Mitarbeiter " + Nachname.maadr,"ist kleiner als das Betrag der SR-Auszahlungsschwelle")
                 REQUEST "Soll trotzdem der Betrag aus der SR genommen werden?","",135,req%
                 IF req% = 1 THEN 
                   SummeSR% = Summe% + SummeSR%
                   SR.Buchung = 0 - SummeSR%
                   Summe% = 0
                 ELSE 
                   SR.Buchung = 0
                   Summe% = Summe% + SummeSR%
                 END IF 
               END IF 
             END IF 
             IF optab% = 3 THEN 
               REM komplett aus der Provision
               SR.Buchung = 0
               Summe% = Summe% + SummeSR%
             END IF 
             IF einheit$ = "j" THEN Einheiten.Buchung = 0 - SummeEinh%
             Betrag.BUCHUNG = 0 - Summe%
             BetragEU.buchung = VAL ( STR$ (Betrag.Buchung / umrechnung.buchung,"999999999.00"))
             NettoEU.buchung = BetragEU.buchung
             srEU.buchung = VAL ( STR$ (SR.buchung / umrechnung.buchung,"999999999.00"))
             Nachname.BUCHUNG = Nachname.GAdrDat$
             Vorname.Buchung = Vorname.GAdrDat$
             Sparte.BUCHUNG = Sparte.SPARTEN
             Gesellschaft.BUCHUNG = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG = Bewertungssumme.KVERTRAG
             BewertungssumEU.BUCHUNG = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
             Buchungstext.BUCHUNG = "StornorÅckbuch.zum " + DATE$ (kÅnd%,"0d.mm.yyyy") + " zum Vertr. " + VS_NR.KVERTRAG
             IF KÅndigung.maadr > 0 AND StornoNachf.maadr = "j" THEN 
               Nachf% = Nachfolger.maadr
               IF DAYS (buchdat1$) >= KÅndigung.maadr THEN 
                 SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
                 SELECT KEY Nachf% LOCK FILE "MAADR" INDEX CodeMA.MAADR
                 CodeMA.BUCHUNG = codema.maadr
                 agentur.buchung = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
                 SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
                 SELECT KEY CodeMAtmp% LOCK FILE "MAADR" INDEX CodeMA.MAADR
               END IF 
             ELSE 
               CodeMA.BUCHUNG = CodeMA.MAADR
               agentur.buchung = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
             END IF 
             CodeKU.BUCHUNG = CodeKU.KVERTRAG
             CodeVT.BUCHUNG = lfdnr.KVERTRAG
             REM 210597
             REM Datum.BUCHUNG = KÅndigung.KVERTRAG
             REM 170698
             REM IF TatsKuenDat.KVERTRAG >= KÅndigung.KVERTRAG THEN 
               REM Datum.BUCHUNG = TODAY 
             REM ELSE 
               REM Datum.BUCHUNG = KÅndigung.KVERTRAG
             REM END IF 
             Datum.BUCHUNG = buchdat1$
             REM 210597
             KÅndigung.Buchung = KÅndigung.KVERTRAG
             CALL QuickStore("BUCHUNG")
             REM 220697
             IF srkont$ = "j" OR einheit$ = "j" THEN 
               FILE "maadr"
               SELECT FIRST 
               SELECT KEY CodeMAtmp% LOCK FILE "MAADR" INDEX CodeMA.MAADR
               IF srkont$ = "j" THEN 
                 IF stornoreserve.maadr > Stornoab.maadr AND StornoVerrech.maadr <> "j" THEN 
                   Stornoreserve.maadr = Stornoreserve.maadr - SummeSR%
                   StornoreserveEU.maadr = VAL ( STR$ (Stornoreserve.maadr / umrechnung.stamm,"999999999.00"))
                 END IF 
               END IF 
               IF einheit$ = "j" THEN 
                 REM 01112005
                 IF codema.maadr = codema.kvertrag THEN 
                   EigEinheiten.maadr = EigEinheiten.maadr - SummeEinh%
                   Einheiten.maadr = Einheiten.maadr - SummeEinh%
                 ELSE 
                   Einheiten.maadr = Einheiten.maadr - SummeEinh%
                 END IF 
               END IF 
               CALL QuickStore("maadr")
               FILE "Buchtemp"
             END IF 
           END IF 
           REM CALL Fehler("REMOVE FROM FILE BUCHTEMP WHERE QuickCode.BUCHTEMP = QuickCode%","")
           SELECT FIRST FILE "BUCHTEMP" INDEX QuickCode.BUCHTEMP
           REMOVE FROM FILE "BUCHTEMP" WHERE QuickCode.BUCHTEMP = quickcode%
           SELECT WHERE FILE "BUCHTEMP"
           SELECT FIRST FILE "BUCHTEMP" INDEX QuickCode.BUCHTEMP
         WEND 
       END IF 
     ELSE 
       IF stornowert% = 3 THEN 
         IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
             CALL DFile(3,"buchung" + _fpw$)
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             BLANK FILE "BUCHUNG"
             CodeBU.BUCHUNG = SER ("BUCHUNG",1)
             codew.buchung = 3
             umrechnung.buchung = 1
             waehrung.buchung = "EUR"
             Betrag.BUCHUNG = 0
             SR.Buchung = 0
             Einheiten.Buchung = 0
             BetragEU.buchung = 0
             NettoEU.buchung = BetragEU.buchung
 
             srEU.buchung = 0
             Nachname.BUCHUNG = Nachname.GAdrDat$
             Vorname.Buchung = Vorname.GAdrDat$
             Sparte.BUCHUNG = Sparte.SPARTEN
             Gesellschaft.BUCHUNG = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG = Bewertungssumme.KVERTRAG
             BewertungssumEU.BUCHUNG = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
             Buchungstext.BUCHUNG = "StornorÅckbuch.zum " + DATE$ (kÅnd%,"0d.mm.yyyy") + " zum Vertr. " + VS_NR.KVERTRAG
             CodeMA.BUCHUNG = CodeMA.MAADR
             CodeKU.BUCHUNG = CodeKU.KVERTRAG
             CodeVT.BUCHUNG = lfdnr.KVERTRAG
             Datum.BUCHUNG = buchdat1$
             REM 210597
             KÅndigung.Buchung = KÅndigung.KVERTRAG
             CALL QuickStore("BUCHUNG")
         ELSE 
           IF GAFSK$ <> "TRUE" THEN 
             REQUEST "Wollen Sie einen Storno-Buchungssatz mit NULL-Werten erzeugen lassen?","",130,req1%
           ELSE 
             req1% = 0
             codevt% = codevt.kvfael
             IF EXISTS (codevt%,codevt.kvfael) THEN 
               IF gez_Abschlu·.kvfael = "j" THEN 
                 codevt% = codevt.kvfael
                 CALL AFSKHandStor(codevt%)
               END IF 
             END IF 
           END IF 
           IF req1% = 1 THEN 
             CALL DFile(3,"buchung1" + _fpw$)
             SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
             SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
             SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
             BLANK FILE "BUCHUNG1"
             CodeBU.BUCHUNG1 = SER ("BUCHUNG1",1)
             codew.buchung1 = 3
             umrechnung.buchung1 = 1
             waehrung.buchung1 = "EUR"
             Agentur.buchung1 = Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr
             Betrag.BUCHUNG1 = 0
             SR.Buchung1 = 0
             Einheiten.Buchung1 = 0
             BetragEU.buchung1 = 0
             NettoEU.buchung1 = BetragEU.buchung1
 
             srEU.buchung1 = 0
             Nachname.BUCHUNG1 = Nachname.GAdrDat$
             Vorname.Buchung1 = Vorname.GAdrDat$
             Sparte.BUCHUNG1 = Sparte.SPARTEN
             Gesellschaft.BUCHUNG1 = Gesellschaft.GEADR
             VS_Beginn.BUCHUNG1 = VS_Beginn.KVERTRAG
             Bewertungssumme.BUCHUNG1 = Bewertungssumme.KVERTRAG
             BewertungssumEU.BUCHUNG1 = VAL ( STR$ (Bewertungssumme.KVERTRAG / euro1%,"999999999.00"))
             REM 210597
             Buchungstext.BUCHUNG1 = "StornorÅckbuch.zum " + DATE$ (kÅnd%,"0d.mm.yyyy") + " zum Vertr. " + VS_NR.KVERTRAG
             CodeMA.BUCHUNG1 = CodeMA.MAADR
             CodeKU.BUCHUNG1 = CodeKU.KVERTRAG
             CodeVT.BUCHUNG1 = lfdnr.KVERTRAG
             Datum.BUCHUNG1 = buchdat1$
             REM 210597
             KÅndigung.Buchung1 = KÅndigung.KVERTRAG
             CALL QuickStore("BUCHUNG1")
           END IF 
         END IF 
       END IF 
     END IF 
   END IF 
 END IF 
EndStorno: 
 FILE cfile$
 SET STATUS "Bereit"
 IF FORM <> "" THEN FORM 
 MOUSE ON 
 END SUB 
 
  
  
   
 
 ' Auswahl Gesellschaft
 ' =======================================================================
 ' 13.07.94  - in SUB geÑndert
 
SUB SGeadr()
 IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
 cuge% = CodeGE.kvertrag
 cuvt% = lfdnr.kvertrag
 SELECT KEY vcodema% FILE "SUPERVIS" INDEX CodeMA.supervis
 IF ProviAb > 1 AND MNdisabled%("SUPERVISOR") THEN 
   REQUEST "Die Gesellschaft kann nach erfolgter Provisionierung","nicht mehr geÑndert werden!",0
 ELSE 
   rep% = GetCodeGE%(cuge%)
   IF rep% <> 0 THEN 
     MOUSE OFF 
     SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     CodeGE.kvertrag = rep%
     CALL FStore("KVERTRAG")
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     FORM 
   END IF 
 END IF 
 MOUSE ON 
 END SUB 
 
 
 ' Auswahl Sparte
 ' =======================================================================
 ' 13.07.94  - in SUB geÑndert
 
SUB SCodeva()
 IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
 SELECT KEY vcodema% FILE "SUPERVIS" INDEX CodeMA.supervis
 IF ProviAb > 1 AND MNdisabled%("SUPERVISOR") THEN 
   REQUEST "Die Sparte kann nach erfolgter Provisionierung","nicht mehr geÑndert werden!",0
 ELSE 
   cuva% = CodeVA.kvertrag
   cuvt% = lfdnr.kvertrag
   rep% = GetCodeVA%(cuva%)
   IF rep% <> 0 THEN 
     MOUSE OFF 
     SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     CodeVA.kvertrag = rep%
     CALL FStore("KVERTRAG")
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     FORM 
   END IF 
 END IF 
 MOUSE ON 
 END SUB 
 
 
 ' Auswahl Agentur 
 ' =======================================================================
 ' 13.07.94  - in SUB geÑndert
 
SUB SMaadr()
 IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
 SELECT KEY vcodema% FILE "SUPERVIS" INDEX CodeMA.supervis
 IF ProviAb > 1 AND MNdisabled%("SUPERVISOR") THEN 
   REQUEST "Die Agentur kann nach erfolgter Provisionierung","nicht mehr geÑndert werden!",0
 ELSE 
   cuma% = CodeMA.kvertrag
   cuvt% = lfdnr.kvertrag
   IF Gfsc% <> - 1 THEN 
    IF GNeuSuGeadr$ = "j" THEN GCodieRuf1% = 0
    _cuma% = GetCodeMA%(cuma%,Workstation%)
    IF GNeuSuGeadr$ = "j" THEN GCODieRuf% = - 1
   ELSE 
      CALL MASuFS24()
      _cuma% = GCodeMA%
   END IF 
   IF _cuma% <> 0 THEN 
     MOUSE OFF 
     SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     CodeMA.kvertrag = _cuma%
     CALL MATimeStamp("KVERTRAG")
     CALL FStore("KVERTRAG")
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     FORM 
   END IF 
 END IF 
 MOUSE ON 
 END SUB 
 
 
  
 
  
 
 
 ' Mahnliste fÅr fehlende ZahlungseingÑnge
 ' ====================================================================== 
  
SUB MAHNLIST()
 MOUSE OFF 
 IF disabled%("MAHNLIST") THEN END SUB 
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 cuge% = CodeGE.GEADR
 DIM Gesellschaft$( RECCOUNT ("GEADR"))
 a% = 0
 GAdrDat$ = "ADRESSEN"
 FILE "GEADR"
 INDEX CodeGE.GEADR
 prompt$ = "ZZZZZZZ"
 SELECT FIRST 
 WHILE NOT EOF ("GEADR")
   Gesellschaft$(a%) = Gesellschaft.GEADR + SPACE$ (120) + STR$ (CodeGE.GEADR,"000000")
   IF FORM LIKE "*geadr*" THEN 
     IF CodeGE.GEADR = cuge% THEN prompt$ = Gesellschaft$(a%)
     opt% = 2
   ELSE 
     opt% = 1
     IF Gesellschaft$(a%) < prompt$ THEN prompt$ = Gesellschaft$(a%)
   END IF 
   a% = a% + 1
   SELECT NEXT 
 WEND 
 Auswahl$ = prompt$
 MOUSE ON 
 CREATE DIALOG "GELIST",0,0,195,148,title$,"MS Sans Serif",8
 ADD DIALOG "GELIST",4,0,0,195,123,0,""
 ADD DIALOG "GELIST",9,5,10,20,23,2
 ADD DIALOG "GELIST",5,30,11,158,24,0,"Ausgabe der Mahnliste"
 ADD DIALOG "GELIST",5,30,24,156,26,0,"Bitte wÑhlen Sie aus, ob Sie die Daten einer einzelnen oder aller Gesellschaften ausgeben wollen."
 ADD DIALOG "GELIST",5,30,54,44,10,0,"Ausgabe fÅr"
 ADD DIALOG "GELIST",3,30,64,98,12,0,"alle Gesellschaften",1,opt%
 ADD DIALOG "GELIST",3,30,76,154,12,0,"einzelne Gesellschaft",2,opt%
 ADD DIALOG "GELIST",8,40,90,145,150,259,2,Auswahl$,Gesellschaft$
 ADD DIALOG "GELIST",3,30,104,98,12,0,"eingereicht Åber",3,opt%
 ADD DIALOG "GELIST",1,40,125,55,15,1,"&OK",1,1
 ADD DIALOG "GELIST",1,96,125,55,15,0,"&Abbrechen",0,0
 DIALOG "GELIST",req%
 REMOVE DIALOG "GELIST"
 IF req% = 1 THEN 
   
   REQUEST "Mîchte Sie auch die bereits stornierten VertrÑge einbeziehen?","",130,reqst%
   MOUSE OFF 
   IF opt% = 3 THEN 
     eingbei% = 0
     eingbei% = GetCodeGEE%(0)
   END IF 
   IF opt% <> 3 THEN 
     CALL PRep("BMAHN1")
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
  
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
     ueberschr$ = ""
     GROUP Gesellschaft.GEADR,Pool.KVERTRAG AS "PoolSumme%"
     BEFORE GROUP Gesellschaft.GEADR
     SET REPORT PAGE "H_Gesellscha002"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER GROUP Gesellschaft.GEADR
     SET REPORT PAGE "F_Gesellscha002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   ELSE 
     CALL PRep("BMAHN2")
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
  
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
     GROUP EingereichtBei.KVERTRAG,Pool.KVERTRAG AS "PoolSumme%"
     BEFORE GROUP EingereichtBei.KVERTRAG
     SET REPORT PAGE "H_Eingereich002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP EingereichtBei.KVERTRAG
     SET REPORT PAGE "F_Eingereich002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   END IF 
   SET QUERY ON 
   SET QUERY LOCK OFF 
   ON ERROR GOTO ErrorMAHNLIST
   IF reqst% = 1 THEN 
     IF opt% = 1 THEN 
       SELECT ;
         WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND Pool.KVERTRAG < 0 AND Check.KVERTRAG LIKE "j"
         ORDER REPORT Kunde$,Sparte.SPARTEN
         TO ASK 
     END IF 
     IF opt% = 2 THEN 
       SELECT ;
      WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND Pool.KVERTRAG < 0 AND Check.KVERTRAG LIKE "j" AND CodeGE.KVERTRAG = VAL ( RIGHT$ (Auswahl$,6))
       ORDER REPORT Kunde$,Sparte.SPARTEN
       TO ASK 
     END IF 
     IF opt% = 3 THEN 
       SELECT ;
      WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeMA.KVERTRAG = CodeMA.MAADR AND Pool.KVERTRAG < 0 AND Check.KVERTRAG LIKE "j" AND CodeEingGE.KVERTRAG = eingbei%
      ORDER REPORT Kunde$,Sparte.sparten
      TO ASK 
     END IF 
   ELSE 
     IF opt% = 1 THEN 
       SELECT ;
         WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND Pool.KVERTRAG < 0 AND Check.KVERTRAG LIKE "j" AND storno.kvertrag < 1
         ORDER REPORT Kunde$,Sparte.SPARTEN
         TO ASK 
     END IF 
     IF opt% = 2 THEN 
       SELECT ;
  WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND Pool.KVERTRAG < 0 AND Check.KVERTRAG LIKE "j" AND CodeGE.KVERTRAG = VAL ( RIGHT$ (Auswahl$,6)) AND 
       storno.kvertrag < 1
       ORDER REPORT Kunde$,Sparte.SPARTEN
       TO ASK 
     END IF 
     IF opt% = 3 THEN 
       SELECT ;
  WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeMA.KVERTRAG = CodeMA.MAADR AND Pool.KVERTRAG < 0 AND Check.KVERTRAG LIKE "j" AND CodeEingGE.KVERTRAG = eingbei% AND 
       storno.kvertrag < 1
       ORDER REPORT Kunde$,Sparte.SPARTEN
       TO ASK 
     END IF 
   END IF 
 END IF 
ErrorMAHNLIST: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 SELECT KEY cuge% FILE "GEADR" INDEX CodeGE.GEADR
 FORM 
 MOUSE ON 
 END SUB 
 
 
  
 
 '      ***********************************************************
 '      ** Routinen fÅr Formular "MAADR" - Mitarbeiter/Agenturen **
 '      ***********************************************************
 
SUB MAADR()
 IF disabled%("MAADR") THEN END SUB 
 CALL DFile(3,"Kgeadr" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 CALL DFile(3,"AUMSATZ" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(2,"OFFICE\dokma" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"MAVORG" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"AGDIR" + _fpw$)
 CALL DFile(3,"AUMSKTO" + _fpw$)
 CALL DFile(3,"MAAUSZ" + _fpw$)
 CALL DFile(3,"MAADRAG" + _fpw$)
 CALL DFile(3,"MAKREDIT" + _fpw$)
 CALL DFile(3,"MAKREBUC" + _fpw$)
 CALL DFile(3,"FOERKOND" + _fpw$)
 CALL DFile(3,"statukey" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
   CALL DFile(3,"MABETREU" + _fpw$)
 END IF 
 DIM Titel$(25)
 DIM Auswahl1$(1)
BMAADR041196: 
 FILE "maadr"
 INDEX nachname.maadr
 SELECT FIRST 
 IF RECCOUNT ("maadr") < 1 THEN CALL MADRNeu()
 codematest% = 0
 IF NOT EXISTS ("<ohne Zuordnung>",nachname.maadr) THEN 
   BLANK FILE "maadr"
   codema.maadr = 0
   nachname.maadr = "<ohne Zuordnung>"
   STORE FILE "maadr"
   UNLOCK CURRENT 
   REDIM Agenturen$( RECCOUNT ("maadr") + 5)
 ELSE 
   SELECT FIRST FILE "maadr" INDEX nachname.maadr
   SELECT KEY "<ohne Zuordnung>" LOCK FILE "maadr" INDEX nachname.maadr
   IF codema.maadr <> 0 THEN 
     codema.maadr = 0
     STORE FILE "maadr"
   END IF 
 END IF 
  maske$ = "MAADRN"
  IF GASP% THEN 
    maske$ = "ASPMADRN"
  END IF 

 REM GAgentDetail$ = "TRUE"

  IF GAgentDetail$ = "TRUE" THEN 
    maske$ = "MAADR"
    IF GASP% THEN 
      maske$ = "ASPMAADR"
    END IF 
  END IF 
  IF GAFSK$ LIKE "TRUE" THEN 
    IF GAgentDetail$ = "TRUE" THEN 
      maske$ = "AFSMAADR"
    ELSE 
      maske$ = "AFSMAADR"
    END IF 
  END IF 
  IF Gfsc% = - 1 THEN 
    maske$ = "MAADRF"
  END IF 
 _formend% = 0
    DIM dlg AS Dialog
    DIM control AS DialogControl 
mabe03012001: 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   
   IF UCASE$ ( FORM ) <> maske$ THEN 
     MADRsub% = 0
     SET HEADING title$ + " - Vermittler/Agentur" + " [" + maske$ + "]"
     IF GASP% THEN 
       SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.Maadr) + ")"
     END IF 
     REM OPEN FORM "maadr"
       IF EXISTS (GPrjForm$ + maske$ + ".sbv") THEN 
         OPEN FORM GPrjForm$ + maske$
       ELSE 
         OPEN FORM GPrjForm$ + maske$
       END IF 
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\agentur.pdf"
     IF title$ LIKE "*Agentur*" THEN 
       SET FORM OFF sp$
       SET FORM OFF sn$
       SET FORM OFF suname$
       SET FORM OFF kond$
       SET FORM OFF neu$
       SET FORM OFF s2ma$
     END IF 
     f.seite2.enabled = - 1
     f.seite2.visible = - 1
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       f.foerder.enabled = - 1
       f.foerder.visible = - 1
     ELSE 
       f.foerder.enabled = 0
       f.foerder.visible = 0
     END IF 
     CALL MADRIntro()
     IF gasp% <> - 1 OR workstation% = 0 THEN 
       CALL MNMADR()
     ELSE 
       CALL MNProgramm()
       CALL MNHilfe(2)
     END IF 
     END IF 
     CALL MADRUpdate()
     MENU ON 
     SET STATUS "Vermittlerverwaltung"
   END IF 
   
   MOUSE ON 
   REM IF bearb11$ <> "j" THEN SELECT FORM FIRST 
   FORM 
 
   CALL ClearKBDBuffer()
       f.seite2.enabled = - 1
       f.seite2.visible = - 1
       IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         f.foerder.enabled = - 1
         f.foerder.visible = - 1
       ELSE 
         f.foerder.enabled = 0
         f.foerder.visible = 0
       END IF 
 
       IF ag$ = "j" THEN 
         f.dok.visible = 0
         f.dok.enabled = 0
       ELSE 
         f.dok.visible = - 1
         f.dok.enabled = - 1
       END IF 
   f.suchen.visible = - 1
   f.abbruch.visible = 0
   f.abbruch.enabled = 0
   f.suchen.enabled = - 1
   f.bearb2.enabled = - 1
   f.sichern2.enabled = - 1
   f.abbruch2.visible = 0
   f.abbruch2.enabled = 0
   REM f.sichern4.enabled = 0
   REM f.abbruch4.visible = 0
   REM f.abbruch4.enabled = 0
   REM f.sichern5.enabled = 0
   REM f.abbruch5.visible = 0
   REM f.abbruch5.enabled = 0
   REM f.sichern6.enabled = 0
   REM f.abbruch6.visible = 0
   REM f.abbruch6.enabled = 0
   REM f.zurueck2.enabled = - 1
   f.seite2.enabled = - 1
   IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
     f.foerder.enabled = - 1
     f.foerder.visible = - 1
   ELSE 
     f.foerder.enabled = 0
     f.foerder.visible = 0
   END IF 
 
   REM  f.seite2.enabled = 0
   REM  f.seite2.visible = 0
   REM f.bearb3.visible = 0
   REM f.bearb3.enabled = 0
   REM f.sichern3.visible = 0
   REM f.sichern3.enabled = 0
   REM f.abbruch3.visible = 0
   REM f.abbruch3.enabled = 0
 
   f.maser.enabled = - 1
   IF bearb11$ = "j" THEN 
     fehl11$ = "Fehlerliste"
     f.fehlerli.visible = - 1
     f.fehlerli.enabled = - 1
   ELSE 
     fehl11$ = "Test auf GÅltigkeit"
     f.fehlerli.visible = - 1
     f.fehlerli.enabled = - 1
   END IF 
   IF ag$ = "j" THEN 
     f.neu.enabled = 0
     f.neu.visible = 0
     f.bearb.enabled = 0
     f.bearb.visible = 0
     f.bearb2.enabled = 0
     f.bearb2.visible = 0
     f.seite2.enabled = 0
     f.seite2.visible = 0
       f.foerder.enabled = 0
       f.foerder.visible = 0
     f.sichern.enabled = 0
     f.sichern.visible = 0
     f.fehlerli.visible = 0
     f.fehlerli.enabled = 0
     f.konditionen.enabled = 0
     f.konditionen.visible = 0
     f.kuendigung.enabled = 0
     f.kuendigung.visible = 0
     f.vuebern.enabled = 0
     f.vuebern.visible = 0
     f.mukonueb.enabled = 0
     f.mukonueb.visible = 0
     f.seite2.visible = 0
     f.seite2.enabled = 0
       f.foerder.enabled = 0
       f.foerder.visible = 0
     f.links1.enabled = - 1
     f.rechts1.enabled = - 1
   ELSE 
     f.neu.enabled = - 1
     f.neu.visible = - 1
     f.bearb.enabled = - 1
     f.bearb.visible = - 1
     f.bearb2.enabled = - 1
     f.bearb2.visible = - 1
     REM f.seite2.enabled = - 1
     REM f.seite2.visible = - 1
     f.sichern.enabled = - 1
     f.sichern.visible = - 1
     f.fehlerli.visible = - 1
     f.fehlerli.enabled = - 1
     f.konditionen.enabled = - 1
     f.konditionen.visible = - 1
     f.kuendigung.enabled = - 1
     f.kuendigung.visible = - 1
     f.vuebern.enabled = - 1
     f.vuebern.visible = - 1
     f.mukonueb.enabled = - 1
     f.mukonueb.visible = - 1
   END IF 
   IF GNOAGDIR% THEN 
     f.dircom.visible = 0
     f.direktion.visible = 0
     f.dircom.enabled = 0
     f.direktion.enabled = 0
     f.dirtext.visible = 0
   ELSE 
     f.dircom.visible = - 1
     f.direktion.visible = - 1
     f.dircom.enabled = - 1
     f.direktion.enabled = - 1
     f.dirtext.visible = - 1
 
   END IF 
   ON ERROR GOTO e080920041
   IF Geinh% = - 1 AND nurProv.stamm = "j" THEN 
     f.dochprov.visible = - 1
     f.dochprov.enabled = - 1
   ELSE 
     f.dochprov.visible = 0
     f.dochprov.enabled = 0
   END IF 
e080920041: 
   ON ERROR GOTO ErrorHandler
   ON ERROR GOTO e120920051
   IF GKredit% = - 1 THEN 
     f.kredite.visible = - 1
     f.kredite.enabled = - 1
     REM f.buchung.visible = - 1
     REM f.buchung.enabled = - 1
 
   ELSE 
     f.kredite.visible = 0
     f.kredite.enabled = 0
   END IF 
e120920051: 
   ON ERROR GOTO ErrorHandler
   IF GASP% THEN 
     IF Workstation% > 0 THEN 
       f.links1.enabled = 0
       f.links1.visible = 0
       f.rechts1.enabled = 0
       f.rechts1.visible = 0

       f.LabelSRKtoAuto.enabled = 0
       f.LabelSRKtoAuto.visible = 0
       f.SRAutoBerech.enabled = 0
       f.SRAutoBerech.visible = 0
     ELSE 
       f.LabelSRKtoAuto.enabled = - 1
       f.LabelSRKtoAuto.visible = - 1
       f.SRAutoBerech.enabled = - 1
       f.SRAutoBerech.visible = - 1
     END IF 
   END IF 
   sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.MAADR,",9999.0000"))
   st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.MAADR,",9999.0000"))
   IF workstation% = 0 THEN 
     SET STATUS "Anzahl Mitarbeiter: " + STR$ ( RECCOUNT ("maadr"),",99999") + sq$ + st$
   ELSE 
     SET STATUS "Vermittlermaske"
   END IF 
   MENU OFF 
   MENU ON 
   CALL MADRUpdate()
   ON ERROR GOTO w230820061
   IF workstation% = 0 THEN 
     f.buchung.enabled = - 1
     f.buchung.visible = - 1
   ELSE 
     f.buchung.enabled = - 1
     f.buchung.visible = - 1
   END IF 
w230820061: 
   ON ERROR GOTO ErrorHandler 
   IF GBVF$ LIKE "TRUE" THEN 
     f.maser.visible = 0
     f.maser.enabled = 0
   END IF 
   FORM 
   Gnichtaktiv$ = nichtaktiv.maadr
   IF ag$ <> "j" THEN 
       f.dok.visible = - 1
       f.dok.enabled = - 1
   END IF 
   MENU ON 
   IF MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") OR MNdisabled%("VERTRINHAUSSEE") THEN 
     f.inhaus.enabled = 0
   ELSE 
     f.inhaus.enabled = - 1
   END IF 
   IF MADRsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE FOR 600
   REM ** Tastaturabfrage
   GET k$
   IF GASP% THEN 
     IF Workstation% = 0 THEN 
       SELECT CASE ASC (k$)
       CASE CrsLeft%,PgUp%
         CALL MAADRPrev()
         CALL MADRUpdate()
       CASE CrsRight%,PgDn%
         CALL MAADRNext()
         CALL MADRUpdate()
       END SELECT 
     END IF 
   ELSE 
     SELECT CASE ASC (k$)
     CASE CrsLeft%,PgUp%
       CALL MAADRPrev()
       CALL MADRUpdate()
     CASE CrsRight%,PgDn%
       CALL MAADRNext()
       CALL MADRUpdate()
     END SELECT 
   END IF 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE MADRsub%
   CASE 204
     CALL CreBuMaMon()
     MADRsub% = 0
   CASE 203
     REM Abrechnungen
     IF ag$ <> "j" AND workstation% = 0 THEN 
       CALL AbrechMA(codema.maadr)
     ELSE 
       CALL Fehler("Diese Funktion steht in der Agenturversion und BÅroversion nicht zur VerfÅgung","")
     END IF 
     MADRsub% = 0
   CASE 202
      REM Buchungen
     IF ag$ <> "j" AND workstation% = 0 THEN 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         IF disabled%("VBUCHUNG") THEN 
         ELSE 
           CALL ABuchung(codema.maadr,"BUCHUNG")
         END IF 
       ELSE 
         IF disabled%("VBUCHUNG") THEN 
         ELSE 
           CALL ABuchung(codema.maadr,"BUCHUNG1")
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion steht in der Agenturversion und BÅroversion nicht zur VerfÅgung","")
     END IF 
     MADRsub% = 0
   CASE 201
     REM Vertragssuche
     cuma% = codema.maadr
     CALL UnisuKv(cuma%,"codema")
     MADRsub% = 0
   CASE 200
     codemaab% = codema.maadr
     IF NOT EXISTS (codemaab%,codema.makredit) THEN 
       REQUEST "Es existiert noch kein Eintag in der Kreditdatei?","Wollen Sie einen neuen Eintag anlegen?",130,req%
       IF req% = 1 THEN 
         CALL MAKredtNeu()
         CALL MAKREDIT()
       END IF 
     ELSE 
       CALL MAKREDIT()
     END IF 
     cuma% = codemaab%
     CALL MADRUpdate()
     MADRsub% = 0
   CASE 1
     codema1% = CodeMA.maadr
     IF NOT disabled%("MAADRKONDUEBERSICHT") THEN 
       IF nachname.maadr <> "<ohne Zuordnung>" THEN 
         IF NOT disabled%("KONDITIONVIEW") THEN 
           cuma% = CodeMA.maadr
           SELECT FORM KEY codema% FILE "maadr" INDEX codema.maadr
           CALL GEKONDA()
         END IF 
       ELSE 
         CALL Fehler ("FÅr die Agentur <ohne Zuordnung> kînnen keine Konditionen erfa·t werden!","")
       END IF 
     END IF 
     MOUSE OFF 
     cuma% = codema1%
     CALL MADRUpdate()
     MADRsub% = 0
   CASE 2
     REM 251196 Test CALL VVPEUniRep(0,codema.maadr,0,0,0,0,0,0,1, - 1)
     codema1% = CodeMA.maadr
     IF NOT OPEN ("kvertrag") THEN CALL DFile(3,"kvertrag" + _fpw$)
     IF EXISTS (codema.maadr,codema.kvertrag) THEN 
       IF NOT disabled%("MAADRVERTRUEBERSICHT") THEN 
         maab% = CodeMA.maadr
         CALL VertrUniRep(0,codema.maadr,0,0,0,0,0,0,1, - 1,tarif%)
         SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
         REM CALL LIST6()
         CALL MADRUpdate()
       END IF 
     ELSE 
       CALL Fehler("Es kann leider keine VertragsÅbersicht angezeigt werden, da fÅr diesen Vermittler keine VertrÑge existieren!","")
     END IF 
     cuma% = codema1%
     CALL MADRUpdate()
     MADRsub% = 0
   CASE 3
     maab% = CodeMA.maadr
     IF workstation% > 0 THEN 
       CALL Fehler("Diese Funktion ist externen BÅros nicht erlaubt!","")
       GOTO w060220061
     END IF 
     IF bearb11$ = "j" THEN 
       FOR i% = 0 TO tfoundadr%
         IF AdrFound$(i%) <> "" AND VAL ( RIGHT$ (Adrfound$(i%),6)) = adrfound% THEN 
           prompt% = i%
         END IF 
       NEXT i%
       LAuswahl1$(0) = LAuswahl$
       AdrFound$ = LAuswahl$
       CREATE DIALOG "ADRSTICHW",0,0,250,260,"Fehlerliste","MS Sans Serif",8
       ADD DIALOG "ADRSTICHW",7,5,6,240,225,2,2,AdrFound$,Lauswahl1$,AdrFound$(prompt%)
       ADD DIALOG "ADRSTICHW",1,43,242,55,16,1,"&Bearbeiten",1,1
       ADD DIALOG "ADRSTICHW",1,103,242,55,16,0,"&Abbrechen",0,0
       DIALOG "ADRSTICHW",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRSTICHW"
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         maab% = VAL ( RIGHT$ (LAuswahl$,6))
         adrfound% = codema%
         bearb11$ = "j"
         SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
         FORM 
       END IF 
     ELSE 
       codema1ab% = codema.maadr
       a$ = "alle Mitarbeiter ohne Nachnamen+Vornamen, Mitteilung fÅr kein VorgÑnger od. keine Kondition, Mitteilung aller Mitarbeiter deren VorgÑnger nicht mehr existiert(dort wird dann der VorgÑnger auf <ohne Zurdnung>gesetzt)!"
       CALL Fehler("Folgende Schritte werden durchgefÅhrt: Lîschen aller Konditionen fÅr die kein Mitarbeiter oder keine Gesellschaft und Sparte existiert",a$)
       REQUEST "Start PrÅfung"
       MOUSE OFF 
       FILE "gekond"
       INDEX codema.gekond
       SELECT FIRST 
       SET STATUS "PrÅfung auf Konditionen, fÅr die kein Mitarbeiter existiert"
       REMOVE FROM FILE "gekond" WHERE codema.gekond < 1
       SET STATUS "PrÅfung auf Konditionen, fÅr die kein Produkt existiert"
       REMOVE FROM FILE "gekond" WHERE codege.gekond < 1 AND codeva.gekond < 1
       SELECT FIRST 
       FILE "MAADR"
       REMOVE FROM FILE "maadr" WHERE codema.maadr < 1
       SET STATUS "PrÅfung auf Mitarbeiter ohne Nachname und Vorname"
       REMOVE FROM FILE "maadr" WHERE nachname.maadr = "" AND vorname.maadr = ""
       INDEX nachname.maadr
       SELECT FIRST LOCK 
       REDIM AdrFound$(3 * RECCOUNT ("maadr"))
       a% = 0
       found1% = 0
       
       WHILE NOT EOF ("maadr")
         codema1% = codema.maadr
         codemaold% = codema.maadr
         IF vorgÑnger.maadr < 1 THEN 
           AdrFound$(a%) = "KEIN VORGéNGER DEFINIERT    - " + Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr + SPACE$ (120) + STR$ (codema,"000000")
           a% = a% + 1
         END IF 
         IF NOT EXISTS (codema1%,codema.gekond) THEN 
           AdrFound$(a%) = "keine Konditionen definiert - " + Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr + SPACE$ (120) + STR$ (codema,"000000")
           a% = a% + 1
         END IF 
         IF NOT EXISTS (vorgÑnger.maadr,codema.maadr) AND vorgÑnger.maadr > 0 THEN 
           AdrFound$(a%) = "VORGéNGER gelîscht    - " + Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr + SPACE$ (120) + STR$ (codema,"000000")
           a% = a% + 1
           vorgÑnger.maadr = 0
           STORE FILE "maadr"
           UNLOCK CURRENT FILE "maadr"
         END IF 
         SET STATUS "PrÅfe " + nachname.maadr + ", " + vorname.maadr
       SELECT NEXT LOCK 
       WEND 
       tfoundadr% = a%
       AdrFound$(a%) = ""
       SET STATUS ""
       REQUEST "Ende der PrÅfung"
       MOUSE ON 
       IF a% > 0 THEN 
         bearb11$ = "n"
         LAuswahl$ = AdrFound$(0)
         LAuswahl1$(0) = LAuswahl$
         CREATE DIALOG "ADRSTICHW",0,0,250,260,"Fehlerliste","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,240,230,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,43,242,55,16,1,"&Bearbeiten",1,1
         ADD DIALOG "ADRSTICHW",1,103,242,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           codema% = VAL ( RIGHT$ (LAuswahl$,6))
           maab% = codema%
           adrfound% = codema%
           bearb11$ = "j"
           SELECT FORM KEY codema% FILE "maadr" INDEX codema.maadr
           FORM 
         END IF 
       ELSE 
         CALL Fehler("Keine Fehler gefunden!","")
       END IF 
       SELECT FORM KEY codema1ab% FILE "maadr" INDEX codema.maadr
     END IF 
     SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
w060220061: 
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 4
     IF NOT disabled%("MAADRKONDEINRICHTEN") THEN 
       IF nachname.maadr <> "<ohne Zuordnung>" THEN 
         maab% = codema.maadr
         IF vorgÑnger.maadr > 0 THEN 
           maab% = codema.maadr
           CALL VORKONDUebern()
           SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
           cuko% = 0
         ELSE 
           CALL Fehler("Geben Sie bitte erst einen VorgÑnger an!","")
         END IF 
         SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
       ELSE 
         CALL Fehler ("FÅr die Agentur <ohne Zuordnung> kînnen keine Konditionen Åbernommen werden!","")
       END IF 
       MADRsub% = 0
       CALL MADRUpdate()
     END IF 
     MADRsub% = 0
 
   CASE 5
     IF NOT disabled%("MAADRKONDEINRICHTEN") THEN 
       IF nachname.maadr <> "<ohne Zuordnung>" THEN 
         maab% = codema.maadr
         IF vorgÑnger.maadr > 0 THEN 
           CALL GEKONDUebern()
           cuko% = 0
         ELSE 
           CALL Fehler("Geben Sie bitte erst einen VorgÑnger an!","")
         END IF 
         SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
       ELSE 
         CALL Fehler ("FÅr die Agentur <ohne Zuordnung> kînnen keine Konditionen Åbernommen werden!","")
       END IF 
       MADRsub% = 0
       CALL MADRUpdate()
     END IF 
     MADRsub% = 0
   CASE 6
     REM VorgÑnger auswÑhlen
     IF ag$ <> "j" THEN 
       IF codema.maadr > 0 THEN 
         IF NOT disabled%("MAADRSTRUBEARB") THEN 
         GMaAnrede$ = Anrede.maadr
         GMaAnrede2$ = Anrede2.maadr
         GMaVorname$ = Vorname.maadr
         GMaVorname2$ = Vorname2.maadr
         GMaNachname$ = Nachname.maadr
         GMaNachname2$ = Nachname2.maadr
         GMaFirmaName$ = FirmaName.maadr
         GMaFirmaName2$ = FirmaName2.maadr
         GMaOrt$ = Ort.maadr
         GMaOrt2$ = Ort2.maadr
         GMaStrasse$ = Stra·e.maadr
         GMaStrasse2$ = Strasse2.maadr
         GMaPLZ$ = plz.maadr
         GMaPLZ2$ = plz2.maadr
           maab% = codema.maadr
           CALL VorgNeu(codema.maadr)
           IF GASP% THEN CALL ReadHiera()
           'CALL Vorgaenger()
           'CALL StruAll()
           MADRsub% = 0
           SELECT KEY maab% FILE "maadr" INDEX codema.maadr
           CALL MADRUpdate()
         END IF 
       ELSE 
         CALL Fehler("FÅr diesen Mitarbeiter kînnen Sie keinen VorgÑnger erfassen!","")
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion steht unter der Agenturvariante nicht zur VerfÅgung","")
     END IF 
     MADRsub% = 0
   CASE 7
     IF NOT disabled%("MAADRLIST") THEN 
       codema% = codema.maadr
       IF codema% > 0 THEN 
         CALL StruDruck(codema%)
         SELECT KEY codema% FILE "maadr" INDEX codema.maadr
         MADRsub% = 0
         ON ERROR GOTO we020520021
         IF GASP% THEN CALL ReadHiera()
we020520021: 
         ON ERROR GOTO ErrorHandler
         CALL MADRUpdate()
       ELSE 
         CALL Fehler("FÅr den Vermittler <ohne Zuordnung> kann ein solcher Ausdruck nicht vorgenommen werden! Bitte selektieren Sie Åber den Button <Suchen>","den/die jenige(n) Vermittler/Firma fÅr den/die der Ausdruck der Strukturen erfolgen soll.")
       END IF 
     END IF 
     MADRsub% = 0
   CASE 8
     REM Provisionen drucken
     IF NOT disabled%("MAADRKTODRU") THEN 
       codema% = codema.maadr
       REM CALL ProvMADruck(codema%)
       SELECT KEY codema% FILE "maadr" INDEX codema.maadr
       MADRsub% = 0
       CALL MADRUpdate()
     END IF 
     MADRsub% = 0
   CASE 10
     REM Agenturgruppe zuweisen
     IF NOT disabled%("MAADRAGGRUPPE") THEN 
       codema% = codema.maadr
       CALL MaGruppe1Stich()
       MADRsub% = 0
       SELECT KEY codema% FILE "maadr" INDEX codema.maadr
       CALL MADRUpdate()
     END IF 
     MADRsub% = 0
   CASE 117
     REM Vorschuss anweisen
     FILE "maadr"
     SELECT CURRENT LOCK FILE "maadr"
     IF Vorschangewiese.maadr <> 1 THEN 
       ProvSumUberweis.maadr = ProvSum.maadr + VorschVorschlag.maadr
       Vorschangewiese.maadr = 1
     ELSE 
       ProvSumUberweis.maadr = ProvSum.maadr
       Vorschangewiese.maadr = 0
     END IF 
     STORE FILE "maadr"
     CALL MADRUpdate()
     MADRsub% = 0
   CASE 22
     REM Dokumentenverwaltung
     IF codema.maadr > 0 THEN 
       codema% = codema.maadr
       GADRDat$ = "MAADR"
       GADRUni$ = "MAADR"
       GDokDat$ = "DOKMA"
       CALL ADRDokUni("codema.maadr")
     ELSE 
       CALL Fehler("Dokumente sind fÅr diesen Mitarbeiter nicht verfÅgbar!","")
     END IF 
     GADRDat$ = "ADRESSEN"
     GDokDat$ = "DOKUMENT"
     MADRsub% = 0
   CASE 24
     REM manuelle Stornoauszahlung
     codema% = codema.maadr
     ok% = - 1
     IF disabled%("MAADRBEARB") OR ag$ = "j" OR disabled%("MAADRMANSTORNO") THEN 
       ok% = 0
     END IF 
     IF nachname.maadr <> "<ohne Zuordnung>" AND ok% = - 1 THEN 
testbw1908200101: 
       buchtext$ = "manuelle Auszahlung SR"
       bDat$ = DATE$ ( TODAY ,"0d.mm.yyyy")
       srspalte$ = "j"
       CREATE DIALOG "Konto1",0,0,221,200,"Stornoreserve","MS Sans Serif",8
       ADD DIALOG "Konto1",9,6,7,24,22,2
       ADD DIALOG "Konto1",5,34,8,170,9,0,"SR-Zahlung:"
       ADD DIALOG "Konto1",4,34,14,176,5,0,""
       ADD DIALOG "Konto1",5,34,22,175,16,0,"Wenn Sie einen negativen Betrag eingeben, wird das SR Konto reduziert und"
       ADD DIALOG "Konto1",5,34,40,175,32,0,"ein Buchungssatz mit positivem Auszahlungsbetrag fÅr den Vermittler erzeugt."
       ADD DIALOG "Konto1",5,34,62,175,16,0,"Wenn Sie einen positiven Betrag eingeben, wird das SR Konto erhîht und"
       ADD DIALOG "Konto1",5,34,84,175,32,0,"ein Buchungssatz mit negativem Auszahlungsbetrag fÅr den Vermittler erzeugt."
       ADD DIALOG "Konto1",5,34,111,25,10,0,"Betrag:"
       ADD DIALOG "Konto1",6,70,111,45,11,0,0,Betrag$,10
       ADD DIALOG "Konto1",5,34,123,25,10,0,"Datum:"
       ADD DIALOG "Konto1",6,70,123,45,11,0,0,bDat$,10
       ADD DIALOG "Konto1",5,34,136,45,10,0,"Buchungstext:"
       ADD DIALOG "Konto1",6,34,147,185,11,0,0,buchtext$,60
       ADD DIALOG "Konto1",2,34,162,148,11,0,"Buchung in der SR-Spalte","j","n",srspalte$
       ADD DIALOG "Konto1",1,50,180,55,15,1,"&Weiter",1,1
       ADD DIALOG "Konto1",1,110,180,55,15,0,"&Abbruch",0,0
       DIALOG "Konto1",req%
       REMOVE DIALOG "Konto1"
       IF req% = 1 THEN 
         ON ERROR GOTO testbw1908200101
         wert% = VAL (Betrag$)
         ON ERROR GOTO ErrorHandler
         SELECT FIRST FILE "STAMM"
         SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
         ok% = - 1
         IF wert% <> 0 THEN 
           IF wert% < 0 THEN 
             REM Reduzierung sr konto, PrÅfung ob ausgezahlt werden darf
             IF StornoAb.maadr <> 0 THEN 
               IF Stornoreserve.maadr >= StornoAb.maadr THEN 
                 Stornoreserve.maadr = Stornoreserve.maadr + wert%
                 StornoreserveEU.maadr = VAL ( STR$ (Stornoreserve.maadr / umrechnung.stamm,"999999999.00"))
                 STORE FILE "maadr"
                 UNLOCK CURRENT FILE "maadr"
               ELSE 
                 REQUEST "SR-Konto ist < SR-Auszahlungsschwelle!","Trotzdem auszahlen?",130,req1%
                 IF req1% = 1 THEN 
                   Stornoreserve.maadr = Stornoreserve.maadr + wert%
                   StornoreserveEU.maadr = VAL ( STR$ (Stornoreserve.maadr / umrechnung.stamm,"999999999.00"))
 
                   STORE FILE "maadr"
                   UNLOCK CURRENT FILE "maadr"
                 ELSE 
                   ok% = 0
                 END IF 
               END IF 
             ELSE 
               REQUEST "In SR-Auszahlungsschwelle ist nichts eingetragen!","Trotzdem auszahlen?",130,req1%
               IF req1% = 1 THEN 
                 Stornoreserve.maadr = Stornoreserve.maadr + wert%
                 StornoreserveEU.maadr = VAL ( STR$ (Stornoreserve.maadr / umrechnung.stamm,"999999999.00"))
 
                 STORE FILE "maadr"
                 UNLOCK CURRENT FILE "maadr"
               ELSE 
                 ok% = 0
               END IF 
             END IF 
           ELSE 
             Stornoreserve.maadr = Stornoreserve.maadr + wert%
             StornoreserveEU.maadr = VAL ( STR$ (Stornoreserve.maadr / umrechnung.stamm,"999999999.00"))
 
             STORE FILE "maadr"
             UNLOCK CURRENT FILE "maadr"
           END IF 
         ELSE 
           ok% = 0
         END IF 
         REM ************** jetzt Buchungssatz erzeugen!! ***************************
         SELECT FIRST FILE "stamm"
         IF ok% = - 1 THEN 
           IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
             CALL DFile(3,"buchung1" + _fpw$)
             SET STATUS "Buchung wird gespeichert"
             BLANK FILE "BUCHUNG1"
             CodeBU.buchung1 = SER ("buchung1",1)
             CodeMA.buchung1 = codema%
             ma% = CodeMA.buchung1
             Datum.buchung1 = bdat$
             Buchungstext.buchung1 = buchtext$
             datumz% = Datum.buchung1
             IF srspalte$ <> "j" THEN 
               REM als normale Buchung
               sr% = 0
               betr% = wert% * - 1
               Betrag.buchung1 = betr%
             ELSE 
               REM komplett in der SR-Spalte ausweisen
               sr.buchung1 = wert%
               sr% = wert%
               betr% = sr% * - 1
               Betrag.buchung1 = betr%
             END IF 
             VTCodema.buchung1 = codema%
             codew1% = codew.stamm
             Codew.buchung1 = codew.stamm
             euro1% = umrechnung.stamm
             umrechnung.buchung1 = umrechnung.stamm
             waehrung1$ = waehrung.stamm
             waehrung.buchung1 = waehrung1$
             CALL FStore("buchung1")
             zusatz% = 1
             eigen% = 1
             PSpAll$ = ""
             PSpAllSeit% = 0
             PROVSpEig$ = ""
             PSpESeit% = 0
             CALL ZentrKTO(ma%,datumz%,betr%,sr%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
             SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
             AuszahlAB.maadr = AuszahlAB.maadr + betr%
             AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
             AuszProvABGes.maadr = AuszProvABGes.maadr + betr%
             AuszProvABGesEU.maadr = VAL ( STR$ (AuszProvABGes.maadr / euro1%,"999999999.00"))
             zusAuszahl.maadr = zusAuszahl.maadr + betr%
             zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
             aktZusB.maadr = aktZusB.maadr + betr%
             aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
             STORE FILE "maadr"
             UNLOCK CURRENT FILE "maadr"
           ELSE 
             CALL DFile(3,"buchung" + _fpw$)
             SET STATUS "Buchung wird gespeichert"
             BLANK FILE "BUCHUNG"
             CodeBU.buchung = SER ("buchung",1)
             CodeMA.buchung = codema%
             ma% = CodeMA.buchung
             Datum.buchung = bdat$
             Buchungstext.buchung = buchtext$
             datumz% = Datum.buchung
             IF srspalte$ <> "j" THEN 
               REM als normale Buchung
               sr% = 0
               betr% = wert% * - 1
               Betrag.buchung = betr%
             ELSE 
               REM komplett in der SR-Spalte ausweisen
               sr.buchung = wert%
               sr% = wert%
               betr% = sr% * - 1
               Betrag.buchung = betr%
             END IF 
             VTCodema.buchung = codema%
             codew1% = codew.stamm
             Codew.buchung = codew.stamm
             euro1% = umrechnung.stamm
             umrechnung.buchung = umrechnung.stamm
             waehrung1$ = waehrung.stamm
             waehrung.buchung = waehrung1$
             CALL FStore("buchung")
             zusatz% = 1
             eigen% = 1
             PSpAll$ = ""
             PSpAllSeit% = 0
             PROVSpEig$ = ""
             PSpESeit% = 0
             CALL ZentrKTO(ma%,datumz%,betr%,sr%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
             SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
             AuszahlAB.maadr = AuszahlAB.maadr + betr%
             AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
             AuszProvABGes.maadr = AuszProvABGes.maadr + betr%
             AuszProvABGesEU.maadr = VAL ( STR$ (AuszProvABGes.maadr / euro1%,"999999999.00"))
             zusAuszahl.maadr = zusAuszahl.maadr + betr%
             zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
             aktZusB.maadr = aktZusB.maadr + betr%
             aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
             STORE FILE "maadr"
             UNLOCK CURRENT FILE "maadr"
           END IF 
         END IF 
         REM ************** Ende  Buchungssatz erzeugen!! ***************************
       END IF 
     ELSE 
       IF ag$ <> "j" THEN 
         CALL Fehler("fÅr die Agentur <ohne Zuordnung>  ist diese Funktion nicht durchfÅhrbar!","")
       ELSE 
         CALL Fehler("Diese Funktion steht unter der Agenturvariante nicht zur VerfÅgung","")
       END IF 
     END IF 
     MADRsub% = 0
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     CALL MADRUpdate()
   CASE 26
     REM Foerderprovisionen
     codema% = codema.maadr
     IF GAFSK$ LIKE "TRUE" THEN 
       IF nachname.maadr LIKE "<ohne*" THEN 
         CALL Fehler("FÅr diese Agentur kînnen keine zu betreuenden Agenturen erfa·t werden!","")
       ELSE 
         REM CALL MABetrKond(codema%)
         maab% = codema.maadr
         wks1% = Workstation%
         ma% = MakGetCodeMA%(ma%,Wks1%)
         MOUSE OFF 
         IF ma% > 0 THEN 
           betr$ = ""
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY ma% FILE "maadr" INDEX codema.maadr
           betr$ = LEFT$ ( LTRIM$ (Nachname.maadr) + "," + LTRIM$ (Vorname.maadr),61)
           SELECT FIRST FILE "maadr" INDEX codema.maadr
           SELECT KEY maab% LOCK FILE "maadr" INDEX codema.maadr
           Maklerbetreuer.maadr = betr$
           CodeMABetreu.maadr = ma%
           CALL QuickStore("maadr")
           MOUSE OFF 
         ELSE 
           REQUEST "Es wurde kein Betreuer ausgewÑhlt!","Soll <ohne Zuordnung> eingetragen werden?",130,req%
           IF req% = 1 THEN 
             MOUSE OFF 
             SELECT FIRST FILE "maadr" INDEX codema.maadr
             SELECT KEY maab% LOCK FILE "maadr" INDEX codema.maadr
             Maklerbetreuer.maadr = "<ohne Zuordnung>"
             CodeMABetreu.maadr = 0
             CALL QuickStore("maadr")
             MOUSE OFF 
           END IF 
         END IF 
         SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
         codema% = maab%
       END IF 
     ELSE 
       IF nachname.maadr LIKE "<ohne*" THEN 
         CALL Fehler("FÅr diese Agentur kann keine Fîrderprovision erfa·t werden!","")
       ELSE 
         IF NOT disabled%("FOERKOND") THEN 
           CALL FoerdKond(codema%)
         END IF 
       END IF 
     END IF 
     
     MADRsub% = 0
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     CALL MADRUpdate()
     MOUSE ON 
   CASE 27
     REM Titel zuweisen
     codema% = codema.maadr
     feld$ = "Titel"
     FOR i% = 1 TO 25
       feld$ = "Titel" + STR$ (i%,"00") + ".stamm"
       IF LTRIM$ (feld$$) <> "" THEN 
         Titel$(i% - 1) = STR$ (i%,"00") + " " + feld$$
       ELSE 
         i% = 26
       END IF 
     NEXT i%
     IF LTRIM$ (Titel$(0)) <> "" THEN 
       prompt$ = IstTitel.maadr
       CREATE DIALOG "PREISLIS",0,0,190,164,title$,"MS Sans Serif",8
       ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl Titel"
       ADD DIALOG "PREISLIS",7,5,14,179,125,2,2,Titel$,Auswahl1$,prompt$
       ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
       ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
       DIALOG "PREISLIS",req%
       REMOVE DIALOG "PREISLIS"
       IF req% = 1 THEN 
         SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
         IstTitel.maadr = MID$ (Auswahl1$(0),4)
         STORE FILE "maadr"
         UNLOCK CURRENT FILE "maadr"
       END IF 
     ELSE 
       CALL Fehler("Es wurden unter Firmen-Stammdaten/Stammdaten fÅr den Wettbewerb keine Vermittler-Titel, wie z.B. Gebietsleiter etc., hinterlegt!","")
     END IF 
      MADRsub% = 0
      SELECT KEY codema% FILE "maadr" INDEX codema.maadr
      CALL MADRUpdate()
   CASE 28
     REM BÅro zuweisen
     ok% = - 1
     IF disabled%("MAADRCHANGEOFF") THEN 
       ok% = 0
     END IF 
     _cuma% = codema.maadr
     IF workstation% = 0 AND ok% = - 1 THEN 
       _cuma% = codema.maadr
       REM rep% = VAL (GetWkscodema$( STR$ (_cuma%,"000000"),Workstation%))
       wsold% = Workstation.maadr
       wsneu% = SelectOffice%("BÅro-Auswahl","",1,0)
       REM CALL Fehler("","")
       IF wsneu% <> - 1 THEN 
         SELECT KEY _cuma% LOCK FILE "maadr" INDEX codema.maadr
         Workstation.maadr = wsneu%
         CALL QuickStore("maadr")
         REQUEST "BÅro wurde zugewiesen!"
         REQUEST "Nachfolgend mÅssen jetzt die Daten in den Adressen,","Terminen, Dokumenten und VertrÑgen angepa·t werden!"
         MOUSE OFF 
         CALL DFile(3,"KVERTRAG" + _fpw$)
         CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
         CALL DFile(2,"OFFICE\" + "BCKONTAK" + _fpw$)
         CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
         CALL DFile(2,"OFFICE\" + "AKQUISE" + _fpw$)
         CALL DFile(2,"OFFICE\" + "AKQUIBCK" + _fpw$)
         CALL DFile(2,"OFFICE\" + "DOKBCK" + _fpw$)
         CALL DFile(2,"OFFICE\" + "DOKMA" + _fpw$)
         CALL DFile(2,"OFFICE\" + "CONBCK" + _fpw$)
         CALL DFile(2,"OFFICE\" + "CONNECT" + _fpw$)
         CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
         CALL DFile(2,"OFFICE\" + "TELBCK" + _fpw$)
         j% = 1
anfanp160320021: 
         anp$ = "ADRESSEN"
         FILE anp$
         INDEX codema.anp$
         SELECT FIRST 
         IF RECCOUNT (anp$) > 0 THEN 
           SELECT KEY _cuma% LOCK FILE anp$ INDEX codema.anp$
         ELSE 
           SELECT LAST 
         END IF 
         ok% = - 1
         i% = 0
         WHILE NOT EOF (anp$) AND codema.anp$ = _cuma%
           IF codema.anp$ = _cuma% THEN 
             i% = i% + 1
             Workstation.anp$ = wsneu%
             CALL QuickStore(anp$)
             SET STATUS STR$ (i%,"999999") + " DatensÑtze in " + anp$ + " umgestellt"
             IF EXISTS (codeku.anp$,codeku.kvertrag) THEN 
               FILE "KVERTRAG"
               INDEX codeku.kvertrag
               SELECT FIRST 
               SELECT KEY codeku.anp$ LOCK FILE "kvertrag" INDEX codeku.kvertrag
               WHILE NOT EOF ("KVERTRAG") AND codeku.kvertrag = codeku.anp$
                 Workstation.kvertrag = wsneu%
                 QWoNo.kvertrag = STR$ (Workstation%,"000000") + STR$ (lfdnr.kvertrag,"000000")
                 CALL QuickStore("KVERTRAG")
                 SELECT NEXT LOCK FILE "kvertrag" INDEX codeku.kvertrag
               WEND 
             END IF 
             IF EXISTS (codeku.anp$,codeku.akquise) THEN 
               FILE "akquise"
               INDEX codeku.akquise
               SELECT FIRST 
               SELECT KEY codeku.anp$ LOCK FILE "akquise" INDEX codeku.akquise
               WHILE NOT EOF ("akquise") AND codeku.akquise = codeku.anp$
                 Workstation.akquise = wsneu%
                 CALL QuickStore("akquise")
                 SELECT NEXT LOCK FILE "akquise" INDEX codeku.akquise
               WEND 
             END IF 
             IF EXISTS (codeku.anp$,codeku.telefon) THEN 
               FILE "telefon"
               INDEX codeku.telefon
               SELECT FIRST 
               SELECT KEY codeku.anp$ LOCK FILE "telefon" INDEX codeku.telefon
               WHILE NOT EOF ("telefon") AND codeku.telefon = codeku.anp$
                 Workstation.telefon = wsneu%
                 CALL QuickStore("telefon")
                 SELECT NEXT LOCK FILE "telefon" INDEX codeku.telefon
               WEND 
             END IF 
 
             IF EXISTS (codeku.anp$,codeku.dokument) THEN 
               FILE "dokument"
               INDEX codeku.dokument
               SELECT FIRST 
               SELECT KEY codeku.anp$ LOCK FILE "dokument" INDEX codeku.dokument
               WHILE NOT EOF ("dokument") AND codeku.dokument = codeku.anp$
                 Workstation.dokument = wsneu%
                 CALL QuickStore("dokument")
                 SELECT NEXT LOCK FILE "dokument" INDEX codeku.dokument
               WEND 
             END IF 
           END IF 
           FILE anp$
           SELECT NEXT LOCK FILE anp$ INDEX codema.anp$
         WEND 
         anp$ = "DOKMA"
         FILE anp$
         INDEX codema.anp$
         SELECT FIRST 
         IF RECCOUNT (anp$) > 0 THEN 
           SELECT KEY _cuma% LOCK FILE anp$ INDEX codema.anp$
         ELSE 
           SELECT LAST 
         END IF 
         ok% = - 1
         i% = 0
         WHILE NOT EOF (anp$) AND codema.anp$ = _cuma%
           IF codema.anp$ = _cuma% THEN 
             i% = i% + 1
             Workstation.anp$ = wsneu%
             CALL QuickStore(anp$)
             SET STATUS STR$ (i%,"999999") + " DatensÑtze in " + anp$ + " umgestellt"
           END IF 
           SELECT NEXT LOCK FILE anp$ INDEX codema.anp$
         WEND 
 
         anp$ = "BCKONTAK"
         GADRDat$ = "BCKONTAK"
         GConDat$ = "CONBCK"
         GTelDat$ = "TELBCK"
         GAkquiDat$ = "AKQUIBCK"
         GDokDat$ = "DOKBCK"
         CALL DFile(2,"OFFICE\" + anp$ + _fpw$)
         FILE anp$
         INDEX codema.anp$
         SELECT FIRST 
         IF RECCOUNT (anp$) > 0 THEN 
           SELECT KEY _cuma% LOCK FILE anp$ INDEX codema.anp$
         ELSE 
           SELECT LAST 
         END IF 
         ok% = - 1
         i% = 0
         WHILE NOT EOF (anp$) AND codema.anp$ = _cuma%
           IF codema.anp$ = _cuma% THEN 
             i% = i% + 1
             Workstation.anp$ = wsneu%
             CALL QuickStore(anp$)
             SET STATUS STR$ (i%,"999999") + " DatensÑtze in " + anp$ + " umgestellt"
           END IF 
             IF EXISTS (codeku.anp$,codeku.akquibck) THEN 
               FILE "akquibck"
               INDEX codeku.akquibck
               SELECT FIRST 
               SELECT KEY codeku.anp$ LOCK FILE "akquibck" INDEX codeku.akquibck
               WHILE NOT EOF ("akquibck") AND codeku.akquibck = codeku.anp$
                 Workstation.akquibck = wsneu%
                 CALL QuickStore("akquibck")
                 SELECT NEXT LOCK FILE "akquibck" INDEX codeku.akquibck
               WEND 
             END IF 
             IF EXISTS (codeku.anp$,codeku.telbck) THEN 
               FILE "telbck"
               INDEX codeku.telbck
               SELECT FIRST 
               SELECT KEY codeku.anp$ LOCK FILE "telbck" INDEX codeku.telbck
               WHILE NOT EOF ("telbck") AND codeku.telbck = codeku.anp$
                 Workstation.telbck = wsneu%
                 CALL QuickStore("telbck")
                 SELECT NEXT LOCK FILE "telbck" INDEX codeku.telbck
               WEND 
             END IF 
 
             IF EXISTS (codeku.anp$,codeku.dokbck) THEN 
               FILE "dokbck"
               INDEX codeku.dokbck
               SELECT FIRST 
               SELECT KEY codeku.anp$ LOCK FILE "dokbck" INDEX codeku.dokbck
               WHILE NOT EOF ("dokbck") AND codeku.dokbck = codeku.anp$
                 Workstation.dokbck = wsneu%
                 CALL QuickStore("dokbck")
                 SELECT NEXT LOCK FILE "dokbck" INDEX codeku.dokbck
               WEND 
             END IF 
           FILE anp$
           SELECT NEXT LOCK FILE anp$ INDEX codema.anp$
         WEND 
 
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion kann nur von der Zentale vorgenommen werden!","")
     END IF 
     GAdrDat$ = "ADRESSEN"
     GConDat$ = "CONNECT"
     GTelDat$ = "TELEFON"
     GAkquiDat$ = "AKQUISE"
     GDokDat$ = "DOKUMENT"
     MOUSE ON 
     SELECT KEY _cuma% LOCK FILE "maadr" INDEX codema.maadr
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 29
     REM GDV Agenturnummer zuweisen
     codema% = codema.maadr
     IF codema% > 0 THEN 
       CALL MAGdvAgent(codema%,0,"")
       REM MAGdvAgent(codematmp%,vonwo%,Agenturnummer$)
     ELSE 
       CALL Fehler("FÅr diese Agentur kînnen keine GDV Agenturnummern erfa·t werden!","")
     END IF 
       _cuma% = codema%
     SELECT KEY _cuma% FILE "maadr" INDEX codema.maadr
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 30
     REM öbertragung Vermittler in Mitarbeiterdatei
     MENU OFF 
     codema1% = codema.maadr
     ok% = - 1
     REQUEST "Soll dieser Vermittler in die Mitarbeiterdatei eingetragen werden?","",130,req%
     IF req% = 0 THEN ok% = 0
     IF ok% = - 1 THEN 
       IF disabled%("MAADRBEARB") OR disabled%("SUPERVIS") OR disabled%("STAMMDATENHAUPTMASKE") OR disabled%("SETUP") THEN 
         ok% = 0
       END IF 
     END IF 
     IF codema1% < 1 OR nachname.maadr LIKE "<ohne Zuordnung>" THEN 
       ok% = 0
       CALL Fehler("<ohne Zuordnung> kann nicht als Mitarbeiter eingetragen werden!","")
     END IF 
     IF ok% = - 1 THEN 
       IF NOT EXISTS (nachname.maadr,nachname.supervis) THEN 
         BLANK FILE "supervis"
         SET STATUS "Datensatz neu angelegt..."
         CodeMA% = SER ("supervis",1)
         Codema.supervis = Codema%
         Workstation.supervis = Workstation.maadr
         Nachname.supervis = Nachname.maadr
         Vorname.supervis = Vorname.maadr
         Pstrasse.supervis = stra·e.maadr
         Port.supervis = Ort.maadr
         Pplz.supervis = plz.maadr
         PLand.supervis = Land.maadr
         PTelefon.supervis = Telefon1.maadr
         PHandy.supervis = Telefon1.maadr
         Pfax.supervis = Telefax.maadr
         Pemail.supervis = email.maadr
         NoAnzeigeJN.supervis = "j"
         Pa·wort.supervis = "#+~·Åî"
         IF vorname.maadr <> "" THEN 
           Name.supervis = Vorname.maadr + " " + Nachname.maadr
         ELSE 
           Name.supervis = Nachname.maadr
         END IF 
         STORE FILE "supervis"
         UNLOCK CURRENT FILE "supervis"
         CALL Fehler("Der Vermittler wurde als Mitarbeiter eingetragen!","Bitte wechseln Sie in die Mitarbeiterverwaltung und legen Sie die Mitarbeiterrechte und das Passwort fest!")
       ELSE 
         SELECT FIRST FILE "Supervis" INDEX nachname.supervis
         SELECT KEY nachname.maadr FILE "Supervis" INDEX nachname.supervis
         IF vorname.supervis = Vorname.maadr THEN 
           CALL Fehler("Es ist bereits ein Mitarbeiter " + nachname.supervis + " " + vorname.supervis + " vorhanden!","")
           REQUEST "Wollen Sie trotzdem den Vermittler","nocheinmal als Mitarbeiter eintragen lassen?",130,req%
           IF req% = 1 THEN 
             BLANK FILE "supervis"
             SET STATUS "Datensatz neu angelegt..."
             CodeMA% = SER ("supervis",1)
             Codema.supervis = Codema%
             Workstation.supervis = Workstation.maadr
             Nachname.supervis = Nachname.maadr + "#"
             Vorname.supervis = Vorname.maadr
             Pstrasse.supervis = stra·e.maadr
             Port.supervis = Ort.maadr
             Pplz.supervis = plz.maadr
             PLand.supervis = Land.maadr
             PTelefon.supervis = Telefon1.maadr
             PHandy.supervis = Telefon1.maadr
             Pfax.supervis = Telefax.maadr
             Pemail.supervis = email.maadr
             NoAnzeigeJN.supervis = "j"
             Pa·wort.supervis = "#+~·Åî"
             IF vorname.maadr <> "" THEN 
               Name.supervis = Vorname.maadr + " " + Nachname.maadr + "#"
             ELSE 
               Name.supervis = Vorname.maadr + "#"
             END IF 
             STORE FILE "supervis"
             UNLOCK CURRENT FILE "supervis"
             CALL Fehler("Der Vermittler wurde als Mitarbeiter eingetragen!","Bitte wechseln Sie in die Mitarbeiterverwaltung und legen Sie die Mitarbeiterrechte und das Passwort fest!")
           END IF 
         ELSE 
           BLANK FILE "supervis"
           SET STATUS "Datensatz neu angelegt..."
           CodeMA% = SER ("supervis",1)
           Codema.supervis = Codema%
           Workstation.supervis = Workstation.maadr
           Nachname.supervis = Nachname.maadr
           Vorname.supervis = Vorname.maadr
           IF vorname.maadr <> "" THEN 
             Name.supervis = Vorname.maadr + " " + Nachname.maadr
           ELSE 
             Name.supervis = Nachname.maadr
           END IF 
           POrt.supervis = Ort.maadr
           PPLZ.supervis = PLZ.maadr
           PStrasse.supervis = Stra·e.maadr
           PLand.supervis = Land.maadr
           PTelefon.supervis = Telefon1.maadr
           PHandy.supervis = Telefon1.maadr
           Pfax.supervis = Telefax.maadr
           Pemail.supervis = email.maadr
           NoAnzeigeJN.supervis = "j"
           STORE FILE "supervis"
           UNLOCK CURRENT FILE "supervis"
           CALL Fehler("Der Vermittler wurde als Mitarbeiter eingetragen!","Bitte wechseln Sie in die Vermittlerverwaltung und legen Sie die Mitarbeiterrechte und das Passwort fest!")
         END IF 
       END IF 
     END IF 
     _cuma% = codema1%
     SELECT KEY _cuma% FILE "maadr" INDEX codema.maadr
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 31
     IF disabled%("AGENTNOTIZ2") THEN 
     ELSE 
       f.sichern2.enabled = - 1
       FORM 2
     END IF 
     MADRsub% = 0
   CASE 32
     IF MOD ("MAADR") THEN CALL QuickStore("MAADR")
     FORM 1
     MADRsub% = 0
   CASE 33
     REM generiere Postanschrift2
     cuma% = codema.maadr
     SELECT KEY cuma% LOCK FILE "maadr" INDEX codema.maadr
     P1$ = ""
     IF firmaName2.maadr <> "" THEN p1$ = firmaName2.maadr + CHR$ (13) + CHR$ (10)
     IF Anrede2.maadr <> "" THEN p1$ = p1$ + anrede2.maadr + " "
     IF Vorname2.maadr <> "" THEN p1$ = p1$ + Vorname2.maadr + " "
     p1$ = p1$ + NachName2.maadr + CHR$ (13) + CHR$ (10)
     p1$ = p1$ + Strasse2.maadr + CHR$ (13) + CHR$ (10)
     p1$ = p1$ + plz2.maadr + " " + Ort2.maadr + CHR$ (13) + CHR$ (10) + land2.maadr + CHR$ (13) + CHR$ (10)
     Postanschrift2.maadr = p1$
     STORE FILE "MAADR"
     REQUEST "Postanschrift 2 wurde neu erstellt!","",2
     FORM 
     MADRsub% = 0
   CASE 34
     REM generiere Postanschrift1
     cuma% = codema.maadr
     SELECT KEY cuma% LOCK FILE "maadr" INDEX codema.maadr
     P1$ = ""
     IF firmaName.maadr <> "" THEN p1$ = firmaName.maadr + CHR$ (13) + CHR$ (10)
     IF Anrede.maadr <> "" THEN p1$ = p1$ + anrede.maadr + " "
     IF Vorname.maadr <> "" THEN p1$ = p1$ + Vorname.maadr + " "
     p1$ = p1$ + NachName.maadr + CHR$ (13) + CHR$ (10)
     p1$ = p1$ + Stra·e.maadr + CHR$ (13) + CHR$ (10)
     p1$ = p1$ + plz.maadr + " " + Ort.maadr + CHR$ (13) + CHR$ (10) + land.maadr + CHR$ (13) + CHR$ (10)
     Postanschrift.maadr = p1$
     STORE FILE "MAADR"
     REQUEST "Postanschrift 1 wurde neu erstellt!","",2
     FORM 
     MADRsub% = 0
   CASE 35
     REM edit seite 2
     GMaAnrede$ = Anrede.maadr
     GMaAnrede2$ = Anrede2.maadr
     GMaVorname$ = Vorname.maadr
     GMaVorname2$ = Vorname2.maadr
     GMaNachname$ = Nachname.maadr
     GMaNachname2$ = Nachname2.maadr
     GMaFirmaName$ = FirmaName.maadr
     GMaFirmaName2$ = FirmaName2.maadr
     GMaOrt$ = Ort.maadr
     GMaOrt2$ = Ort2.maadr
     GMaStrasse$ = Stra·e.maadr
     GMaStrasse2$ = Strasse2.maadr
     GMaPLZ$ = plz.maadr
     GMaPLZ2$ = plz2.maadr
     GMALand$ = Land.maadr
     GMALand2$ = Land2.maadr

     f.bearb2.enabled = 0
     f.abbruch2.visible = - 1
     f.abbruch2.enabled = - 1
     f.zurueck2.enabled = 0
     f.po1.enabled = 0
     f.po2.enabled = 0
     ENTER DebitorKto.MAADR,0
     f.bearb2.enabled = - 1
     f.abbruch2.visible = 0
     f.abbruch2.enabled = 0
     f.zurueck2.enabled = - 1
     f.po1.enabled = - 1
     f.po2.enabled = - 1
     MADRsub% = 0
   CASE 99
     MENU OFF 
     ok% = - 1
     IF disabled%("MAADRBEARB") THEN 
       ok% = 0
     END IF 
     IF nachname.maadr <> "<ohne Zuordnung>" AND ok% = - 1 THEN 
         REDIM Agenturen$( RECCOUNT ("maadr") + 5)
         Agenturen$( RECCOUNT ("maadr") + 5) = ""
         IF RECCOUNT ("maadr") = 0 THEN CALL MADRNeu()
         CALL ButDesabled()
         f.konditionen.enabled = 0
         f.kuendigung.enabled = 0
         f.vertragsuebersicht.enabled = 0
         f.sperre.enabled = 0
         f.vorgaenger.enabled = 0
         f.fehlerli.enabled = 0
         f.vuebern.enabled = 0
         f.mukonueb.enabled = 0
         f.strudruck.enabled = 0
         f.bearb2.enabled = 0
         f.sichern2.enabled = - 1
         f.abbruch2.visible = - 1
         f.abbruch2.enabled = - 1
         REM f.sichern4.enabled = - 1
         REM f.abbruch4.visible = - 1
         REM f.abbruch4.enabled = - 1
         REM f.sichern5.enabled = - 1
         REM f.abbruch5.visible = - 1
         REM f.abbruch5.enabled = - 1
         REM f.sichern6.enabled = - 1
         REM f.abbruch6.visible = - 1
         REM f.abbruch6.enabled = - 1
         GMaAnrede$ = Anrede.maadr
         GMaAnrede2$ = Anrede2.maadr
         GMaVorname$ = Vorname.maadr
         GMaVorname2$ = Vorname2.maadr
         GMaNachname$ = Nachname.maadr
         GMaNachname2$ = Nachname2.maadr
         GMaFirmaName$ = FirmaName.maadr
         GMaFirmaName2$ = FirmaName2.maadr
         GMaOrt$ = Ort.maadr
         GMaOrt2$ = Ort2.maadr
         GMaStrasse$ = Stra·e.maadr
         GMaStrasse2$ = Strasse2.maadr
         GMaPLZ$ = plz.maadr
         GMaPLZ2$ = plz2.maadr
         GMaLand$ = Land.maadr
         GMaLand2$ = Land2.maadr
         f.zurueck2.enabled = 0
         f.seite2.enabled = 0
         f.foerder.enabled = 0
         f.maser.enabled = 0
         f.c1.enabled = 0
         f.dircom.enabled = 0
         IF PAGE = 1 THEN ENTER Anrede.MAADR,0
         IF PAGE = 2 THEN ENTER schufa.maadr,0
         IF PAGE = 4 THEN ENTER AKonto01.aumskto,0
         IF PAGE = 6 THEN ENTER PROVSperreEig.maadr,0
           f.seite2.enabled = - 1
           f.seite2.visible = - 1
           f.foerder.enabled = - 1
           f.foerder.visible = - 1
           f.dok.visible = - 1
           f.dok.enabled = - 1
         END IF 
         f.c1.enabled = - 1
         f.dircom.enabled = - 1
         f.bearb2.enabled = - 1
         f.sichern2.enabled = 0
         f.abbruch2.visible = 0
         f.abbruch2.enabled = 0
         REM f.sichern4.enabled = 0
         REM f.abbruch4.visible = 0
         REM f.abbruch4.enabled = 0
         REM f.sichern5.enabled = 0
         REM f.abbruch5.visible = 0
         REM f.abbruch5.enabled = 0
         REM f.sichern6.enabled = 0
         REM f.abbruch6.visible = 0
         REM f.abbruch6.enabled = 0
         f.zurueck2.enabled = - 1
         REM f.seite2.enabled = - 1
         f.maser.enabled = - 1
         f.konditionen.enabled = - 1
         f.kuendigung.enabled = - 1
         f.vertragsuebersicht.enabled = - 1
         f.sperre.enabled = - 1
         f.vorgaenger.enabled = - 1
         f.fehlerli.enabled = - 1
         f.vuebern.enabled = - 1
         f.mukonueb.enabled = - 1
         f.strudruck.enabled = - 1
         CALL ButEnabled()
         IF GASP% THEN 
           IF Workstation% > 0 THEN 
             f.links1.enabled = 0
             f.links1.visible = 0
             f.rechts1.enabled = 0
             f.rechts1.visible = 0
           END IF 
         END IF 
     ELSE 
       IF ok% = - 1 THEN CALL Fehler ("Die Agentur <ohne Zuordnung> darf und kann nicht geÑndert werden!","")
     END IF 
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 100
     CALL MAADRPrev()
     CALL MADRUpdate()
     MADRsub% = 0
   CASE 101
     CALL MAADRNext()
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 102
     IF GNeuSuGeadr$ = "j" THEN GCodieRuf1% = 0
     IF gfsc% = - 1 OR GASP% <> - 1 OR VMoldSuch.stamm = "j" THEN 
       CALL MASuFS24()
     ELSE 
       CALL MADRSuchen()
     END IF 
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 103
     IF NOT disabled%("MAADRSERIE") THEN 
       IF GASP% = - 1 AND GBVF$ LIKE "TRUE" THEN 
         IF workstation% = 0 THEN 
           CALL MASerie()
           MADRsub% = 0
           CALL MADRUpdate()
         ELSE 
           CALL Fehler("Diese Funktion ist externen BÅros nicht erlaubt!","")
         END IF 
       ELSE 
         CALL MASerie()
         MADRsub% = 0
         CALL MADRUpdate()
       END IF 
     END IF 
     maser% = 0
     MADRsub% = 0
   CASE 104
     IF NOT disabled%("MAADRKUEND") THEN 
       CALL MAADRKnd()
     END IF 
     MADRsub% = 0
     CALL MADRUpdate()
   CASE 105
     IF NOT disabled%("MAADRNEU") THEN 
       CALL MADRNeu()
       CALL MADRUpdate()
     ELSE 
       MADRsub% = 0
     END IF 
   CASE 106
     IF NOT disabled%("MAADRSPERRE") THEN 
       IF ag$ <> "j" THEN 
         CALL MAADRSperre()
       ELSE 
         CALL Fehler("Diese Funktion steht unter der Agenturvariante nicht zur VerfÅgung","")
       END IF 
       MADRsub% = 0
       CALL MADRUpdate()
     END IF 
     MADRsub% = 0
   CASE 107
     codema% = codema.maadr
     IF codema.maadr > 0 AND NOT disabled%("MAADRDIREKTION") THEN 
       codema% = codema.maadr
       codeagdirold% = codeagdir.maadr
 
       codeagdir% = GETDirektion%()
       IF codeagdir% <> - 1 THEN 
        IF codeagdirold% <> codeagdir% OR LTRIM$ (Agenturnr.maadr) = "" THEN 
         SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
         SELECT KEY codeagdir% FILE "AGDIR" INDEX codeAGDIR.AGDIR
         SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
         direktion.maadr = direktion.agdir
         IF codeagdir% <> 0 THEN 
           nr$ = STR$ (nummer.agdir,"000")
         ELSE 
           nr$ = "000"
         END IF 
         IF agiteration.agdir > 0 THEN 
           agnr% = AGNummer.agdir + agiteration.agdir
         ELSE 
           agnr% = AGNummer.agdir + 1
         END IF 
         anzag% = AnzahlAGs.agdir + 1
         Agenturnr.maadr = nr$ + "." + STR$ (agnr%,"000000")
         codeagdir.maadr = codeagdir%
         CALL QuickStore("maadr")
         SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
         SELECT KEY codeagdirold% LOCK FILE "AGDIR" INDEX codeAGDIR.AGDIR
         AnzahlAGs.agdir = AnzahlAGs.agdir - 1
         CALL QuickStore("agdir")
         SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
         SELECT KEY codeagdir% LOCK FILE "AGDIR" INDEX codeAGDIR.AGDIR
         AGNummer.agdir = agnr%
         AnzahlAGs.agdir = anzag%
         CALL QuickStore("agdir")
        ELSE 
         SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
         SELECT KEY codeagdir% FILE "AGDIR" INDEX codeAGDIR.AGDIR
         SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
         direktion.maadr = direktion.agdir
         CALL QuickStore("maadr")
        END IF 
       END IF 
     ELSE 
       IF codema% = 0 THEN CALL Fehler("Sie kînnen dem Vermittler <ohne Zuordnung> keine Direktion zuordnen!","")
     END IF 
     MADRsub% = 0
     SELECT KEY codema% FILE "maadr" INDEX codema.maadr
     CALL MADRUpdate()
     MADRsub% = 0
 
   CASE 108
     IF NOT disabled%("MAADRDETAIL") THEN 
       REM FORM 2
       CALL MADetail()
     END IF 
     MADRsub% = 0
     CALL MADRUpdate()
     MADRsub% = 0
   CASE 115
     REM Anzeige der Statistikseite
     IF NOT disabled%("MAADRSTATISTIK") THEN 
       REM FORM 5
       codema% = codema.maadr
       OPEN FORM GPrjForm$ + "STMAADR"
       CALL MNProgramm()
       SELECT KEY codema% FILE "maadr" INDEX codema.maadr
       FORM 
       _formend% = 0
       CALL ClearKBDBuffer()
       MENU ON 
       WHILE _formend% = 0
         ON ERROR GOTO ErrorHandler
         WAIT MOUSE OR KEY 
         IF k$ = CHR$ (27) THEN _formend% = 1
       WEND 
       _formend% = 0
     END IF 
     MADRsub% = 0
   CASE 116
       codema1% = codema.maadr
       IF GASP% AND workstation% > 0 THEN 
         CALL Fehler("Diese Funktion ist fÅr externe BÅros nicht zugÑnglich!","")
       ELSE 
         REM Button Druck 
         Superbase.Dialogs.Add("ADRFilter")
         SET dlg = Superbase.Dialogs.ADRFilter
         dlg.Move(0,0,320,136)
         dlg.Caption = title$
         dlg.FontName = "MS Sans Serif"
         dlg.FontSize = 8
 
         SET control = dlg.Add("DialogFrame2","DialogFrame")
         control.Move(0,6,320,110)
         control.Caption = "Druckoptionen"

         SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
         control.Move(5,19,228,13)
         control.Caption = "Vermittler - Liste"
         control.Bind("opt%")
         control.ValueOn = 0
         IF NOT disabled1%("KONDITIONVIEW") THEN 
           SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
           control.Move(5,35,228,13)
           control.Caption = "aktueller Vermittler - Konditionsliste (Kurzliste)"
           control.Bind("opt%")
           control.ValueOn = 1

           SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
           control.Move(5,48,311,14)
           control.Caption = "aktueller Vermittler - Konditionsliste (Langliste)"
           control.Bind("opt%")
           control.ValueOn = 2

           IF PrvVerfahr$ LIKE "Zahlungseingang" THEN 
             SET control = dlg.Add("DialogOptionButton6","DialogOptionButton")
             control.Move(5,61,311,14)
             control.Caption = "alle Vermittler - Fîrderkonditionsliste"
             control.Bind("opt%")
             control.ValueOn = 5
           END IF 
         END IF 
 




         SET control = dlg.Add("DialogOptionButton4","DialogOptionButton")
         control.Move(5,77,301,12)
         control.Caption = "aktueller Vermittler - VertragsÅbersicht"
         control.Bind("opt%")
         control.ValueOn = 3
 

         SET control = dlg.Add("DialogOptionButton40","DialogOptionButton")
         control.Move(5,93,301,12)
         control.Caption = "Vermittler/Struktur - SummenÅbersicht XLS"
         control.Bind("opt%")
         control.ValueOn = 6
 



         SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
         control.Move(96,118,48,15)
         control.Default = 1
         control.Caption = "&Weiter"
         control.ReturnValue = 1
 
         SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
         control.Move(148,118,48,15)
         control.Caption = "&Abbruch"
         control.ReturnValue = 0
         control.Cancel = 1
         DIALOG "ADRFilter",req%
         REMOVE DIALOG ALL 
         IF req% = 1 THEN 
           IF opt% = 6 THEN 
             REM StrukturÅbersicht mit Zahlen
             CALL StatisStrMA()
           END IF 
           IF opt% = 5 THEN 
             REM Vermittler-Liste FôP
             CALL KONDFOE()
           END IF 
           IF opt% = 0 THEN 
             REM Vermittler-Liste
             CALL MAADRLIST()
           END IF 

           IF opt% = 1 THEN 
             REM Konditionsliste aktueller Vermittler - Kurzform
             CALL KLIST()
           END IF 
           IF opt% = 2 THEN 
             REM Konditionsliste aktueller Vermittler - Langform
             CALL KLIST2()
           END IF 
           IF opt% = 3 THEN 
             REM Vertragsliste
             IF NOT disabled%("MAADRVERTRUEBERSICHT") THEN 
               maab% = CodeMA.maadr
               CALL VertrUniRep(0,codema.maadr,0,0,0,0,0,0,1, - 1,tarif%)
               SELECT FORM KEY maab% FILE "maadr" INDEX codema.maadr
               REM CALL LIST6()
               CALL MADRUpdate()
             END IF 
           END IF 
         END IF 
       END IF 
     MADRsub% = 0
     SELECT KEY codema1% FILE "maadr" INDEX codema.maadr
     CALL MADRUpdate()
     MADRsub% = 0
  END SELECT 
   MENU ON 
   REM CALL BMCheckMail()
 WEND 
 IF workstation% = 0 THEN 
   REQUEST "Wollen Sie die Daten abschlie·end prÅfen lassen?","",130,req%
   IF req% = 1 THEN 
       REQUEST "Start PrÅfung"
       MOUSE OFF 
       FILE "maadr"
       INDEX nachname.maadr
       SELECT FIRST LOCK 
       REDIM AdrFound$(3 * RECCOUNT ("maadr"))
       a% = 0
       found1% = 0
       WHILE NOT EOF ("maadr")
         codema1% = codema.maadr
         codemaold% = codema.maadr
         IF vorgÑnger.maadr < 1 THEN 
           AdrFound$(a%) = "KEIN VORGéNGER DEFINIERT    - " + Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr + SPACE$ (120) + STR$ (codema,"000000")
           a% = a% + 1
         END IF 
         IF NOT EXISTS (codema1%,codema.gekond) THEN 
           AdrFound$(a%) = "keine Konditionen definiert - " + Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr + SPACE$ (120) + STR$ (codema,"000000")
           a% = a% + 1
         END IF 
         IF NOT EXISTS (vorgÑnger.maadr,codema.maadr) AND vorgÑnger.maadr > 0 THEN 
           AdrFound$(a%) = "VORGéNGER gelîscht    - " + Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr + SPACE$ (120) + STR$ (codema,"000000")
           a% = a% + 1
           vorgÑnger.maadr = 0
           STORE FILE "maadr"
           UNLOCK CURRENT FILE "maadr"
         END IF 
         SET STATUS "PrÅfe " + nachname.maadr + ", " + vorname.maadr
       SELECT NEXT LOCK 
       WEND 
       tfoundadr% = a%
       AdrFound$(a%) = ""
       SET STATUS ""
       REQUEST "Ende der PrÅfung"
       MOUSE ON 
       IF a% > 0 THEN 
         bearb11$ = "n"
         LAuswahl$ = AdrFound$(0)
         LAuswahl1$(0) = LAuswahl$
         CREATE DIALOG "ADRSTICHW",0,0,250,260,"Fehlerliste","MS Sans Serif",8
         ADD DIALOG "ADRSTICHW",7,5,6,240,230,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
         ADD DIALOG "ADRSTICHW",1,43,242,55,16,1,"&Bearbeiten",1,1
         ADD DIALOG "ADRSTICHW",1,103,242,55,16,0,"&Abbrechen",0,0
         DIALOG "ADRSTICHW",req5%
         MOUSE ON 
         REMOVE DIALOG "ADRSTICHW"
         IF req5% = 1 THEN 
           LAuswahl$ = LAuswahl1$(0)
           codema% = VAL ( RIGHT$ (LAuswahl$,6))
           maab% = codema%
           adrfound% = codema%
           bearb11$ = "j"
           SELECT FORM KEY codema% FILE "maadr" INDEX codema.maadr
           FORM 
           CALL MADRUpdate()
           _formend% = 0
           GOTO mabe03012001
         END IF 
       ELSE 
         CALL Fehler("Keine Fehler gefunden!","")
       END IF 
     END IF 
  END IF 
 _formend% = 0
 REM cuma% = 0
 END SUB 
 


SUB KONDFOE()
 CALL PRep("KONDFOE")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
 GROUP CodeMA.MAADR
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SELECT ;
     WHERE CodeMA.MAADR = vonCodeMA.FOERKOND
     ORDER REPORT Nachname.MAADR,BWvon.FOERKOND
     TO ASK 
 END SELECT 
 END SUB 
 



SUB SyncMA2()
 codema% = codema.maadr
 CALL Fehler("öbertrÑgt fÅr alle Vermittler die Adresse und Kommunikationsdaten auf die NotizV-Seite, bei denen Name und Vorname auf der NotizV-Seite LEER sind oder der Name=>Neu< lautet!","")
 FILE "maadr"
 SELECT FIRST LOCK 
 WHILE NOT EOF ("maadr")
     IF ( LTRIM$ (nachname2.maadr) = "" OR LTRIM$ (nachname2.maadr) LIKE "Neu") AND LTRIM$ (vorname2.maadr) = "" THEN 
       Anrede2.maadr = anrede.maadr
       firmaName2.maadr = firmaName.maadr
       nachname2.maadr = nachname.maadr
       vorname2.maadr = vorname.maadr
       ort2.maadr = ort.maadr
       strasse2.maadr = stra·e.maadr
       plz2.maadr = plz.maadr
       land2.maadr = land.maadr
     END IF 
     IF Briefanrede2.maadr = "" THEN Briefanrede2.maadr = Briefanrede1.maadr
     IF TelefonMA2.maadr = "" THEN TelefonMA2.maadr = Telefon1.maadr
     IF FaxMa2.maadr = "" THEN FaxMa2.maadr = TeleFax.maadr
     IF Handyma2.maadr = "" THEN Handyma2.maadr = Telefon2.maadr
     IF emailma2.maadr = "" THEN emailma2.maadr = email.maadr
     IF Postanschrift2.maadr = "" THEN Postanschrift2.maadr = Postanschrift.maadr
     STORE FILE "maadr"
     SELECT NEXT LOCK FILE "maadr"
  WEND 
  CALL Fehler("","")
  SELECT FIRST FILE "maadr" INDEX codema.maadr
  SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 END SUB 




SUB MKVorgWechs()
 codemaold% = codema.maadr
 IF disabled%("MAADRVORGWECHS") THEN GOTO endvorwe291120041
 CALL Fehler("ACHTUNG komplette Sonderfunktion, die zum Wechseln einer VorgÑngeragentur bei einer Gruppe anderer Agenturen dient!","Es erfolgen keine PrÅfungen!")
 REQUEST "Wollen Sie einen VorgÑnger bei mehreren Vermittlern auswechseln?","",130,req%
 IF req% <> 1 THEN GOTO endvorwe291120041
  REM kopieren von
  CALL Fehler("Suchen Sie jetzt die VorgÑngeragentur aus, die ausgewechselt werden soll!","")
  CALL MASuFS24()
  vorgold% = GCodema%
  IF vorgold% < 1 THEN GOTO endvorwe291120041
  CALL Fehler("Suchen Sie jetzt die NEUE VorgÑngeragentur aus, die eingetragen werden soll!","")
  CALL MASuFS24()
  vorgneu% = GCodema%
  IF vorgneu% < 1 THEN GOTO endvorwe291120041 


   bis$ = TODAY 
nochmal291120042: 
   CREATE DIALOG "Konto1",0,0,221,145,title$,"MS Sans Serif",8
   ADD DIALOG "Konto1",9,6,7,24,22,2
   ADD DIALOG "Konto1",5,34,8,170,9,0,"VorgÑngerwechsel:"
   ADD DIALOG "Konto1",4,34,14,176,5,0,""
   ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie das Datum ein, zu dem der ALTE VorgÑnger abgeschlossen werden soll"
   REM ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
   ADD DIALOG "Konto1",5,34,80,63,28,0,"Abschlussdatum ALTER VorgÑnger"
   ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
   REM ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
   REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
   ADD DIALOG "Konto1",1,50,124,55,15,1,"&Weiter",1,1
   ADD DIALOG "Konto1",1,110,124,55,15,0,"&Abbruch",0,0
   DIALOG "Konto1",req1%
   REMOVE DIALOG "Konto1"
   IF req1% < 1 THEN GOTO endvorwe291120041 
   IF DateOK%(bis$) THEN 
   ELSE 
     GOTO nochmal291120042
   END IF 
   bis% = DAYS (bis$)
   von% = bis% + 1

  tex1$ = "WÑhlen Sie jetzt die Agenturen aus, denen der neue VorgÑnger zugewiesen werden soll! In der Auswahlliste werden Ihnen nur die Agenturen angezeigt, die den ALTEN VorgÑnger besa·en!"
  CALL Fehler(text1$,"Duch drÅcken der STRG-Taste+Mausclick oder Shift+Ende kînnen Sie mehrere oder alle Agenturen wÑhlen!")
  MOUSE OFF 
  FILE "maadr"
  INDEX agenturnr.maadr
  SELECT FIRST FILE "maadr" INDEX agenturnr.maadr
  a% = 0
  IF RECCOUNT ("maadr") > 20000 THEN 
    REDIM Agenturen$(20000,1)
    REDIM Agenturen$(20000)
  ELSE 
    REDIM Agenturen$( RECCOUNT ("maadr"),1)
    REDIM Agenturen$( RECCOUNT ("maadr"))
  END IF 
  WHILE NOT EOF ("maadr")
    IF vorgÑnger.maadr = vorgold% THEN 
      Agenturen$(a%) = Agenturnr.maadr + "," + nachname.maadr + ", " + vorname.maadr + ", " + firmaname.maadr + SPACE$ (120) + STR$ (CodeMA.maadr,"000000")
      a% = a% + 1
    END IF 
    SELECT NEXT FILE "maadr" INDEX agenturnr.maadr
  WEND 
  prompt$ = Agenturen$(0)
  CREATE DIALOG "MASUCH",0,0,380,284,"Vermittlersuche","Courier New",10
  ADD DIALOG "MASUCH",4,0,0,380,263,0,""
  ADD DIALOG "MASUCH",9,5,5,21,21,2
  ADD DIALOG "MASUCH",5,37,15,260,10,0,"Name/Nachname,Vorname"
  ADD DIALOG "MASUCH",5,37,5,151,10,0,"Bitte wÑhlen Sie die Vermittler aus:"
  ADD DIALOG "MASUCH",7,7,27,368,229,10,2,Agenturen$,Auswahl$,prompt$
  ADD DIALOG "MASUCH",1,116,268,55,15,1,"&OK",1,1
  ADD DIALOG "MASUCH",1,182,268,55,15,0,"&Abbrechen",0,0
  MOUSE ON 
  DIALOG "MASUCH",req%
  REMOVE DIALOG "MASUCH"
  IF req% = 0 THEN GOTO endvorwe291120041

  REM Eintragen des neue VorgÑnger bei den ausgewÑhlten Agenturen
  WHILE Auswahl$(kzu%) <> ""
    lcuma% = VAL ( RIGHT$ (Auswahl$(kzu%),6))
    SELECT FIRST FILE "maadr" INDEX codema.maadr
    SELECT KEY lcuma% FILE "maadr" INDEX codema.maadr
    SET STATUS "Eintragen des neuen VorgÑngers bei " + Nachname.maadr + "," + Agenturnr.maadr
    REM jetzt hier die Eintragung vornehmen
    SELECT FIRST FILE "mavorg" INDEX codema.mavorg
    SELECT KEY lcuma% LOCK FILE "mavorg" INDEX codema.mavorg
    WHILE NOT EOF ("mavorg") AND codema.mavorg = lcuma%
      IF CodeVMA.mavorg = vorgold% THEN 
        IF bis.mavorg < 1 THEN 
          bis.mavorg = bis%
          STORE FILE "mavorg"
        END IF 
      END IF 
      SELECT NEXT LOCK FILE "mavorg" INDEX codema.mavorg
    WEND 
    SELECT FIRST FILE "maadr" INDEX codema.maadr
    SELECT KEY vorgneu% FILE "maadr" INDEX codema.maadr
    BLANK FILE "mavorg"
    codekey.mavorg = SER ("MAVORG",1)
    codema.mavorg = lcuma%
    codevma.mavorg = vorgneu%
    NameVMA.mavorg = Nachname.maadr
    AgenturnrVMA.mavorg = Agenturnr.maadr
    aktiviert.mavorg = "j"
    von.mavorg = von%
    CALL QuickStore("MAVORG")
    SELECT FIRST FILE "maadr" INDEX codema.maadr
    SELECT KEY lcuma% LOCK FILE "maadr" INDEX codema.maadr
    IF codema.mavorg = lcuma% THEN 
      GMaAnrede$ = Anrede.maadr
      GMaAnrede2$ = Anrede2.maadr
      GMaVorname$ = Vorname.maadr
      GMaVorname2$ = Vorname2.maadr
      GMaNachname$ = Nachname.maadr
      GMaNachname2$ = Nachname2.maadr
      GMaFirmaName$ = FirmaName.maadr
      GMaFirmaName2$ = FirmaName2.maadr
      GMaOrt$ = Ort.maadr
      GMaOrt2$ = Ort2.maadr
      GMaStrasse$ = Stra·e.maadr
      GMaStrasse2$ = Strasse2.maadr
      GMaPLZ$ = plz.maadr
      GMaPLZ2$ = plz2.maadr
      vorgÑnger.maadr = vorgneu%
      CALL QuickStore("maadr")
    END IF 
    kzu% = kzu% + 1
  WEND 
endvorwe291120041: 
 MOUSE ON 
 END SUB 

 
 ' MAADR Intro 
 ' =======================================================================
 
SUB MADRIntro()
 FILE "maadr"
 INDEX Nachname.maadr
 IF title$ LIKE "*Agentur*" THEN 
   cuma% = VAL (ReadConfig$("PROVIS","Agentur"))
   IF cuma% = 0 THEN 
     DIM Agenturen$( RECCOUNT ("maadr"))
     a% = 0
     FILE "maadr"
     INDEX Nachname.MAADR
     SELECT FIRST 
     prompt$ = Nachname.MAADR + ", " + Vorname.MAADR + SPACE$ (100) + "(" + STR$ (CodeMA.MAADR,"000000") + ")"
     WHILE NOT EOF ("MAADR")
       IF nachname.maadr <> "" THEN 
         Agenturen$(a%) = Nachname.MAADR + ", " + Vorname.MAADR + SPACE$ (100) + "(" + STR$ (CodeMA.MAADR,"000000") + ")"
         a% = a% + 1
       END IF 
       SELECT NEXT 
     WEND 
     DIM Auswahl$(50)
     CREATE DIALOG "AGENTUR",0,0,258,214,"Agenturauswahl","MS Sans Serif",8
     ADD DIALOG "AGENTUR",4,0,0,258,188,0,""
     ADD DIALOG "AGENTUR",9,8,12,21,21,3
     ADD DIALOG "AGENTUR",5,36,14,214,10,0,"FÅr dieses Programm wurde die zu bearbeitende Agentur"
     ADD DIALOG "AGENTUR",5,36,24,214,10,0,"noch nicht festgelegt."
     ADD DIALOG "AGENTUR",5,36,40,214,8,0,"Bitte wÑhlen Sie aus der unteren Liste die Agentur aus, die mit"
     ADD DIALOG "AGENTUR",5,36,50,214,10,0,"diesem Programm bearbeitet werden soll."
     ADD DIALOG "AGENTUR",5,36,64,214,11,0,"Eine nachtrÑgliche énderung der Agentur ist nicht mîglich!"
     ADD DIALOG "AGENTUR",5,36,80,37,10,0,"A&genturen:"
     ADD DIALOG "AGENTUR",7,36,90,216,90,2,2,Agenturen$,Auswahl$,prompt$
     ADD DIALOG "AGENTUR",1,66,192,55,14,1,"OK",1,1
     ADD DIALOG "AGENTUR",1,125,192,53,14,0,"&Abbrechen",0,0
     DIALOG "AGENTUR",req%
     REMOVE DIALOG "AGENTUR"
     IF req% <> 0 THEN 
       cuma% = VAL ( MID$ (Auswahl$(0), LEN (Auswahl$(0)) - 6,6))
       CALL WriteConfig("PROVIS","Agentur", STR$ (cuma%,"000000"))
     ELSE 
       _formend% = 1
     END IF 
   END IF 
   SELECT FORM KEY cuma% FILE "maadr" INDEX CodeMA.maadr
 ELSE 
   IF cuma% <> 0 THEN SELECT KEY cuma% FILE "MAADR" INDEX CodeMA.MAADR ELSE SELECT FIRST 
 END IF 
 SET INDEX Nachname.maadr
 INDEX Nachname.maadr
 FORM 
 END SUB 
 
 
 ' MAADR Neu
 ' =======================================================================
 
SUB MADRNeu()
 CALL DFile(3,"AGDIR" + _fpw$)
 FILE "maadr"
 IF MOD ("MAADR") AND Nachname.maadr <> "" AND codema.maadr > 0 THEN 
   CALL FStore("maadr")
 END IF 
 IF fsmax% > 0 THEN 
   IF RECCOUNT ("MAADR") > fsmax% THEN 
     CALL Fehler("In dieser Version kînnen maximal " + LTRIM$ ( STR$ (fsmax%,"99999")) + " Agenturen erfa·t werden!","")
     END SUB 
   END IF 
 END IF 
 IF GASP% THEN 
    'Jan: neu ---------------- 
    IF (Workstation% <> 0) THEN 
        CALL Fehler("Diese Funktion ist nur fÅr zentrale Mitarbeiter verfÅgbar.","")
        END SUB 
    END IF 
 
 
 
     a% = SelectOffice%("BÅro-Auswahl","",1,0)
     IF a% <> - 1 THEN 
       zzz% = a%
       wks% = zzz%'Aaarg ... Spaghetti-Code 
       REM codema$ = GetWkscodema$("",wks%)
       REM rep$ = codema$
     ELSE 
       CALL Fehler("Es wurde kein BÅro gewÑhlt!","")
       rep$ = ""
       wks% = a%
       MADRSub% = 0
       END SUB 
     END IF 
 
 
 
    'Jan ende ----------------   
 END IF 
 IF RECCOUNT ("AGDIR") > 1 AND GNOAGDIR% <> - 1 AND Gfsc% <> - 1 THEN 
   codeagdir% = GETDirektion%()
 ELSE 
   codeagdir% = 0
 END IF 
         IF RECCOUNT ("AGDIR") > 0 THEN 
           SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
           SELECT KEY codeagdir% FILE "AGDIR" INDEX codeAGDIR.AGDIR
         ELSE 
           BLANK FILE "AGDIR"
           codeagdir.agdir = 0
           direktion.agdir = "<ohne Zuordnung>"
           STORE FILE "agdir"
           SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
         END IF 
         SELECT KEY codema% FILE "maadr" INDEX codema.maadr
         IF Gfsc% <> - 1 THEN 
           IF codeagdir% > 0 THEN 
             nr$ = STR$ (nummer.agdir,"000")
           ELSE 
             nr$ = "000"
           END IF 
           IF AGIteration.agdir > 0 THEN 
             agnr% = AGNummer.agdir + AGIteration.agdir
           ELSE 
             agnr% = AGNummer.agdir + 1
           END IF 
           anzag% = AnzahlAGs.agdir + 1
         END IF 
 BLANK FILE "maadr"
 SET STATUS "Datensatz neu angelegt..."
 CodeMA% = SER ("maadr",1)
 codema.maadr = codema%
 nachname.maadr = "NEU"
 direktion.maadr = direktion.agdir
 IF Gfsc% <> - 1 THEN Agenturnr.maadr = nr$ + "." + STR$ (agnr%,"000000")
 codeagdir.maadr = codeagdir%
 StornoVerrech.maadr = "n"
 'Jan: neu ---------------- 
 Workstation.maadr = wks%
 'Jan ende ----------------  
 CALL QuickStore("maadr")
 IF Gfsc% <> - 1 THEN 
         SELECT FIRST FILE "AGDIR" INDEX codeAGDIR.AGDIR
         SELECT KEY codeagdir% LOCK FILE "AGDIR" INDEX codeAGDIR.AGDIR
         AGNummer.agdir = agnr%
         AnzahlAGs.agdir = anzag%
         CALL QuickStore("agdir")
 END IF 
 REDIM Agenturen$( RECCOUNT ("maadr") + 5)
 Agenturen$( RECCOUNT ("maadr") + 5) = ""
 MOUSE ON 
 SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
 MADRsub% = 99
 CALL MADRUpdate()
 END SUB 
 
SUB MAADRSperre()
 CALL DSSperre("CodeMA","MAADR")
 END SUB 
 
 
 ' MAADR Knopf/Feldbeschriftungen
 ' =======================================================================
 
SUB MADRUpdate()
 cuma% = CodeMA.MAADR
 IF VorgÑnger.MAADR <> 0 THEN 
   cuma% = CodeMA.MAADR
   IF EXISTS (VorgÑnger.MAADR,CodeMA.MAADR) THEN 
     SELECT KEY VorgÑnger.MAADR FILE "MAADR" INDEX CodeMA.MAADR
     vorgaenger$ = Nachname.MAADR + ", " + LTRIM$ (Vorname.MAADR) + "," + LTRIM$ (Agenturnr.maadr) + ",Inf: " + Information.maadr
   ELSE 
     CALL Fehler("Der als VorgÑnger eingetragene Vermittler existiert nicht mehr","er wurde wahrscheinlich gelîscht. Bitte neuen VorgÑnger eintragen!")
     SELECT KEY cuma% LOCK FILE "maadr" INDEX codema.maadr
     VorgÑnger.MAADR = 0
     STORE FILE "maadr"
     UNLOCK CURRENT FILE "maadr"
     vorgaenger$ = "<ohne Zuordnung>"
   END IF 
   SELECT FORM KEY cuma% FILE "MAADR" INDEX CodeMA.MAADR
 ELSE 
   vorgaenger$ = "<keine Zuordnung>"
 END IF 
 ON ERROR GOTO w260120051a
 IF Vorschangewiese.maadr = 1 THEN 
   vorschan$ = "Vorschuss rÅckgÑngig"
 ELSE 
   vorschan$ = "Vorschuss anweisen"
 END IF 
w260120051a: 
 ON ERROR GOTO ErrorHandler
 IF notiz2.maadr <> "" THEN 
   notiz$ = "NotizV Æ"
 ELSE 
   notiz$ = "NotizV"
 END IF 
 ON ERROR GOTO w260120051
 IF EXISTS (cuma%,codema.makredit) THEN 
   kredite$ = "Kredite Æ"
 ELSE 
   kredite$ = "Kredite"
 END IF 
w260120051: 
 ON ERROR GOTO w260120052
 IF prvverfahr$ LIKE "Zahlungseingang" THEN 
   dat$ = "Buchung1"
 ELSE 
   dat$ = "Buchung"
 END IF 
 IF NOT OPEN (dat$) THEN 
   CALL DFile(3,dat$ + _fpw$)
 END IF 
 IF EXISTS (cuma%,codema.dat$) THEN 
   buchu$ = "Buchungen Æ"
 ELSE 
   buchu$ = "Buchungen"
 END IF 
w260120052: 
 ON ERROR GOTO ErrorHandler
 IF EXISTS (cuma%,codema.maadrag) THEN 
   gdvagnr$ = "GDV-GeschÑftsstelle/Vermittler-Nr. Æ"
 ELSE 
   gdvagnr$ = "GDV-GeschÑftsstelle/Vermittler-Nr."
 END IF 
 IF GAFSK$ LIKE "TRUE" THEN 
     foerder$ = "Maklerbetreuer: " + Maklerbetreuer.maadr
 ELSE 
   IF EXISTS (cuma%,voncodema.foerkond) THEN 
     foerder$ = "Fîrderprovision Æ"
   ELSE 
     foerder$ = "Fîrderprovision"
   END IF 
 END IF 
 IF EXISTS (cuma%,codema.gekond) THEN 
   kond$ = "Konditionen Æ"
 ELSE 
   kond$ = "Konditionen"
 END IF 
 IF EXISTS (codema.maadr,codeku.dokma) THEN 
   doks$ = "Dokumente Æ"
 ELSE 
   doks$ = "Dokumente"
 END IF 
 IF KÅndigung.MAADR <> 0 THEN 
   kndg$ = "KÅndi&gung Æ"
 ELSE 
   kndg$ = "KÅndi&gung"
 END IF 
 IF Sperre.MAADR <> 0 THEN 
   IF MNdisabled%("DATALOCK") THEN 
     MAADRLock$ = "gesperrt"
   ELSE 
     SELECT KEY Sperre.MAADR FILE "SUPERVIS" INDEX CodeMA.SUPERVIS
     MAADRLock$ = "gesperrt durch " + Name.SUPERVIS
   END IF 
   IF GASP% <> - 1 THEN MENU 2,6,2
 ELSE 
   MAADRLock$ = "freier Zugriff"
   IF GASP% <> - 1 THEN MENU 2,6,1
 END IF 
 IF DLeblauf.maadr <> "" THEN DLeblauf$ = "ÆÆÆ" ELSE DLeblauf$ = "..."
 IF dschufa.maadr <> "" THEN dschufa$ = "ÆÆÆ" ELSE dschufa$ = "..."
 IF dpsa.maadr <> "" THEN dpsa$ = "ÆÆÆ" ELSE dpsa$ = "..."
 IF davad.maadr <> "" THEN davad$ = "ÆÆÆ" ELSE davad$ = "..."
 IF dpol.maadr <> "" THEN dpol$ = "ÆÆÆ" ELSE dpol$ = "..."
 IF dgew.maadr <> "" THEN dgew$ = "ÆÆÆ" ELSE dgew$ = "..."
 IF dgwa.maadr <> "" THEN dgwa$ = "ÆÆÆ" ELSE dgwa$ = "..."
 IF dhauptber.maadr <> "" THEN dhauptber$ = "ÆÆÆ" ELSE dhauptber$ = "..."
 IF dhnot.maadr <> "" THEN dhnot$ = "ÆÆÆ" ELSE dhnot$ = "..."
 IF dbernot.maadr <> "" THEN dbernot$ = "ÆÆÆ" ELSE dbernot$ = "..."
 IF dbwb.maadr <> "" THEN dbwb$ = "ÆÆÆ" ELSE dbwb$ = "..."
 IF d34c.maadr <> "" THEN d34c$ = "ÆÆÆ" ELSE d34c$ = "..."
 IF GASP% THEN 
   IF nachname.maadr LIKE "<ohne*" THEN 
   ELSE 
     SELECT FIRST FILE "lfiliale" INDEX FILIALNR.lfiliale
     SELECT KEY workstation.maadr FILE "lfiliale" INDEX FILIALNR.lfiliale
     mabuero$ = "BÅro: " + name.lfiliale
   END IF 
 END IF 

 ON ERROR GOTO a1002053 
 IF Information.maadr LIKE "vertr*" THEN 
   f.information.Backcolor = 2
 ELSE 
   f.information.Backcolor = 190
 END IF 
a1002053: 
 ON ERROR GOTO ErrorHandler 

 END SUB 
 
 
 ' MAADR Suchen
 ' =======================================================================
 ' 02.07.94  - Requester durch "SPACE$-Dialog" ersetzt
 
SUB MADRSuchen()
 FILE "maadr"
 _cuma% = CodeMA.MAADR
 
 IF ( MOD ("MAADR") OR NEW ("MAADR")) AND nachname.maadr <> "" THEN CALL FStore("MAADR")
 SELECT WHERE 
 IF GASP% THEN 
   'Jan: modi ---------------------
   wks1% = workstation%
   IF workstation% > 0 THEN 
     wks1% = workstation%
     rep% = GetCodeMA%(cuma%,Workstation%)
   ELSE 
     sok% = - 1
     IF GMASuperCount% > 0 THEN 
       req% = 0
     ELSE 
       IF ADRSchnell.stamm = 1 AND BZwang.stamm = 0 THEN 
         req% = 1
       ELSE 
         REQUEST "Mîchten Sie die BÅrostruktur zur Suche benutzen?","",130,req%
       END IF 
     END IF 
     IF req% = 1 THEN 
       a% = SelectOffice%("VorgÑnger-Auswahl","",1,0)
       IF a% <> - 1 THEN 
         zzz% = a%
         wks% = zzz%'Aaarg ... Spaghetti-Code 
         codema% = VAL (GetWkscodema$("",wks%))
         rep% = codema%
       ELSE 
         CALL Fehler("Es wurde kein BÅro gewÑhlt!","")
         rep% = 0
       END IF 
     ELSE 
       rep% = GetCodeMA%(_cuma%,Wks1%)
     END IF 
   END IF 
   'Jan ende ----------------------
   IF rep% <> 0 THEN 
      _cuma% = rep%
      'Jan: neu -----------------
      SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
      'Jan ende -----------------
      SELECT KEY rep% FILE "MAADR" INDEX CodeMA.MAADR
      SET INDEX Nachname.MAADR
      INDEX Nachname.MAADR
      'Jan: neu --------------- 
      SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.Maadr) + ")"
      'Jan ende ---------------   
   ELSE 
 
   END IF 
 ELSE 
   SELECT FIRST FILE "MAADR"
 rep% = GetCodeMA%(_cuma%,Wks1%)
   _cuma% = rep%
 END IF 
 _cuma% = rep%
 GCodeMA% = _cuma%
 SELECT KEY _cuma% FILE "MAADR" INDEX CodeMA.MAADR
 SET INDEX Nachname.MAADR
 INDEX Nachname.MAADR
 FORM 
 END SUB 
 
FUNCTION GetCodeMA%(prompt%,wks%)
 REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
 REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
 REDIM Auswahl$( RECCOUNT ("MAADR") + 1,1)
 REDIM Auswahl$( RECCOUNT ("MAADR") + 1)
 cfile$ = FILE 
 _pos% = CodeMA.MAADR
 alle$ = "n"
AnfAlle200220021: 
 FILE "MAADR"
 INDEX Nachname.MAADR
 SELECT FIRST 
 REM Agenturen$(0) = "<keine Zuordnung>" + SPACE$ (120) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 zei$ = ""
 WHILE NOT EOF ("MAADR")
   sok% = - 1
   IF GASP% THEN 
     IF workstation% > 0 THEN 
       FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
         wks% = VisOff%(ii%)
         aa% = IsWksVisible%(wks%)
         naab$ = Nachname.maadr + "/" + vorname.maadr
         IF aa% = - 1 AND CodeMa.Maadr <> 0 AND workstation.maadr = wks% THEN 
           REM CALL Fehler(naab$,"aa: " + STR$ (aa%))
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.MAADR <> 0 AND Sperre.MAADR <> vcodema% THEN sok% = 0
           END IF 
           sok% = - 1
           IF alle$ = "n" THEN 
             IF NoAnzeige.maadr LIKE "j" THEN sok% = 0
           END IF 
           
           ii% = VisCount%
         ELSE 
           sok% = 0
         END IF 
       NEXT ii%
     END IF 
   END IF 
   IF alle$ = "n" THEN 
     IF NoAnzeige.maadr LIKE "j" THEN sok% = 0
   END IF 
   IF GMASuperCount% > 0 AND sok% THEN 
     IF IsMASuper%(codema.MAADR) THEN 
     ELSE 
       sok% = 0
       END IF 
     END IF 
   END IF 
   IF wks% > 0 THEN 
     IF workstation.maadr <> wks% THEN sok% = 0
   END IF 
   IF inhaus% = 1 THEN 
     IF inhaus.maadr <> 1 THEN sok% = 0
   END IF 
   IF sok% THEN 
     IF agenturnr.maadr <> "" THEN 
       agnr$ = TRIM$ (Agenturnr.maadr)
     ELSE 
       agnr$ = ""
     END IF 
     IF GASP% THEN 
       SELECT FIRST FILE "filiale" INDEX filialnr.filiale
       SELECT KEY Workstation.maadr FILE "filiale" INDEX filialnr.filiale
       filab$ = Name.filiale
     END IF 
     IF nachname.maadr <> "" THEN 
       IF alle$ <> "j" THEN 
         IF firmaname.maadr <> "" THEN 
           firma$ = "/" + LTRIM$ (firmaname.maadr)
         ELSE 
           firma$ = ""
         END IF 
         IF GAFSK$ LIKE "TRUE" THEN 
           IF inhaus.maadr = 1 THEN 
             test$ = PAD$ ( LTRIM$ (Nachname.MAADR) + " *INH*, " + LTRIM$ (Vorname.MAADR) + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",50)
           ELSE 
             test$ = PAD$ ( LTRIM$ (Nachname.MAADR) + ", " + LTRIM$ (Vorname.MAADR) + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",50)
           END IF 
         ELSE 
           IF inhaus.maadr = 1 THEN 
             test$ = PAD$ ( LTRIM$ (Nachname.MAADR) + " *INH*, " + LTRIM$ (Vorname.MAADR) + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",60)
           ELSE 
           test$ = PAD$ ( LTRIM$ (Nachname.MAADR) + ", " + LTRIM$ (Vorname.MAADR) + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",60)
           END IF 
         END IF 
         
         IF GAFSK$ LIKE "TRUE" THEN 
           Agenturen$(a%) = test$ + " " + PAD$ (agnr$,15) + "   " + Maklerbetreuer.maadr
         ELSE 
           IF Gfsc% <> - 1 THEN 
             Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000")
           ELSE 
             Agenturen$(a%) = PAD$ (agnr$,20) + "     " + test$
           END IF 
         END IF 
       ELSE 
         IF firmaname.maadr <> "" THEN 
           firma$ = "/" + LTRIM$ (firmaname.maadr)
         ELSE 
           firma$ = ""
         END IF 
         IF GAFSK$ LIKE "TRUE" THEN 
           IF inhaus.maadr = 1 THEN 
             test$ = PAD$ (Nachname.MAADR + " *INH*, " + Vorname.MAADR + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",40)
           ELSE 
             test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",40)
           END IF 
         ELSE 
           IF inhaus.maadr = 1 THEN 
             test$ = PAD$ (Nachname.MAADR + " *INH*, " + Vorname.MAADR + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",40)
           ELSE 
             test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",40)
           END IF 
         END IF 
         
         IF NoAnzeige.maadr LIKE "j" THEN 
           IF GAFSK$ LIKE "TRUE" THEN 
             Agenturen$(a%) = test$ + " " + PAD$ (agnr$,15) + " * " + Maklerbetreuer.maadr
           ELSE 
             IF gfsc% <> - 1 THEN 
               Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000") + "            *"
             ELSE 
               Agenturen$(a%) = PAD$ (agnr$,20) + "     " + test$ + "            *"
             END IF 
           END IF 
         ELSE 
           IF GAFSK$ LIKE "TRUE" THEN 
             Agenturen$(a%) = test$ + " " + PAD$ (agnr$,15) + "   " + Maklerbetreuer.maadr
           ELSE 
             IF gfsc% <> - 1 THEN 
               Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000") + "             "
             ELSE 
               Agenturen$(a%) = PAD$ (agnr$,20) + "     " + test$ + "             "
             END IF 
           END IF 
         END IF 
       END IF 
       IF GASP% THEN 
         Agenturen$(a%) = Agenturen$(a%) + "    " + "   " + filab$
       END IF 
       Agenturen$(a%) = Agenturen$(a%) + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
       IF CodeMA.MAADR = prompt% THEN prompt$ = Agenturen$(a%)
       IF GCODIE% = - 1 AND GNeuSuGeadr$ = "j" THEN 
         IF GCodieRuf1% = 0 THEN 
           REM CALL Fehler("","")
           CALL SearchInitMA1("MAADR")
         END IF 
       END IF 
       IF GCODIE% = - 1 AND GNeuSuGeadr$ = "j" THEN CALL SearchVorbMA1("MAADR")
       a% = a% + 1
     END IF 
   END IF 
   REM SET STATUS nachname.maadr + "," + vorname.maadr + " eingelesen"
   IF gasp% = - 1 AND GBVF$ LIKE "TRUE" THEN 
     SELECT CASE zei$
       CASE ""
         zei$ = "/"
       CASE "/"
         zei$ = "-"
       CASE "-"
         zei$ = "\"
       CASE "\"
         zei$ = "-"
     END SELECT 
     IF zei$ = "-" THEN zei$ = "/"
     SET STATUS zei$
   ELSE 
     SET STATUS nachname.maadr + "," + vorname.maadr + " eingelesen"
   END IF 
   SELECT NEXT FILE "maadr"
 WEND 
 prompt$ = agprompt$
 IF GCODIE% = - 1 AND GNeuSuGeadr$ = "j" THEN 
     REM CALL Fehler("","")
     IF alle$ = "n" THEN 
       req3% = CALL ("_SearchShow",c$)
       GCODieRuf% = - 1
     ELSE 
      req3% = CALL ("_SearchReShow",c$)
     END IF 
     IF VAL (c$) <> 0 THEN 
       GetCodeMA% = VAL (c$)
       IF GetCodeMA% > 0 THEN 
         cuma% = GetCodeMA%
       END IF 
     ELSE 
       IF req3% = 2 THEN 
         REM alle anzeigen
         GCodieRuf1% = 0
         REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
         REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
         alle$ = "j"
         inhaus% = 0
         GOTO AnfAlle200220021 
       END IF 
       IF req3% = 29 THEN 
         GCodieRuf1% = 0
         REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
         REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
         alle$ = "n"
         inhaus% = 1
         GOTO AnfAlle200220021 
       END IF 
     END IF 
 ELSE 
   REM ************************************************************************************************************************************
   IF alle$ <> "j" THEN 
     IF GASP% THEN 
       CREATE DIALOG "MASUCH",0,0,480,284,"Agentur-/VermittlerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
     ELSE 
       CREATE DIALOG "MASUCH",0,0,480,284,"Agentur-/VermittlerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
     END IF 
   ELSE 
     IF GASP% THEN 
       CREATE DIALOG "MASUCH",0,0,480,284,"Agentur-/VermittlerÅbersicht aller Vermittler","Courier New",10
     ELSE 
       CREATE DIALOG "MASUCH",0,0,480,284,"Agentur-/VermittlerÅbersicht aller Vermittler","Courier New",10
     END IF 
   END IF 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",4,0,0,480,263,0,""
   ELSE 
     ADD DIALOG "MASUCH",4,0,0,480,263,0,""
   END IF 
   ADD DIALOG "MASUCH",9,5,5,21,21,2
   ADD DIALOG "MASUCH",5,37,5,151,10,0,"Bitte wÑhlen Sie einen Vermittler aus:"
   IF alle$ <> "j" THEN 
     IF GASP% THEN 
       ADD DIALOG "MASUCH",5,37,15,390,10,0,"Vermittler                                             Agenturnummer          Stufe       BÅro"
     ELSE 
       IF GAFSK$ LIKE "TRUE" THEN 
         ADD DIALOG "MASUCH",5,37,15,310,10,0,"Vermittler                                        Agenturnummer    Maklerbetreuer"
       ELSE 
         ADD DIALOG "MASUCH",5,37,15,310,10,0,"Vermittler                                        Agenturnummer        Stufe"
       END IF 
     END IF 
   ELSE 
     IF GASP% THEN 
       ADD DIALOG "MASUCH",5,37,15,390,10,0,"Vermittler                                       Agenturnummer       Stufe    ausgeblendet   BÅro"
     ELSE 
       IF GAFSK$ LIKE "TRUE" THEN 
         ADD DIALOG "MASUCH",5,37,15,330,10,0,"Vermittler                           Agenturnummer   Maklerbetreuer"
       ELSE 
         ADD DIALOG "MASUCH",5,37,15,330,10,0,"Vermittler                                       Agenturnummer       Stufe    ausgebl."
       END IF 
     END IF 
   END IF 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",7,7,27,470,229,10,2,Agenturen$,Auswahl$,prompt$
   ELSE 
     ADD DIALOG "MASUCH",7,7,27,470,229,10,2,Agenturen$,Auswahl$,prompt$
   END IF 
   ADD DIALOG "MASUCH",1,56,268,55,15,1,"&OK",1,1
   IF inhaus% <> 1 THEN ADD DIALOG "MASUCH",1,113,268,85,15,0,"Inhouse - Vermittler",3,0
   IF alle$ <> "j" THEN ADD DIALOG "MASUCH",1,199,268,65,15,0,"Alle anzeigen",2,0
   ADD DIALOG "MASUCH",1,265,268,55,15,0,"&Abbrechen",0,0
   MOUSE ON 
   DIALOG "MASUCH",req%
   REMOVE DIALOG "MASUCH"
   MOUSE OFF 
   IF req% = 3 THEN 
     REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
     REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
     alle$ = "n"
     inhaus% = 1
     GOTO AnfAlle200220021 
   END IF 
   IF req% = 2 THEN 
     REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
     REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
     alle$ = "j"
     inhaus% = 0
     GOTO AnfAlle200220021
   END IF 
   IF req% = 1 THEN 
     GetCodeMA% = VAL ( RIGHT$ (Auswahl$(0),6))
     cuma% = GetCodeMA%
     prompt$ = Auswahl$(0)
     agprompt$ = prompt$
   ELSE 
     GetCodeMA% = 0
   END IF 
   REM ************************************************************************************************************************************
 END IF 
 
 IF GetCodeMA% > 0 THEN 
   SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
   SELECT KEY GetCodeMA% FILE "MAADR" INDEX CodeMA.MAADR
 END IF 
 FILE cfile$
 END FUNCTION 
 
SUB MAKurzSuche()
 cuma% = codema.maadr
 IF MOD ("MAADR") OR NEW ("MAADR") THEN CALL FStore("MAADR")
 
   IF GCODIE% = - 1 THEN 
     REM CALL Fehler("","")
     req3% = CALL ("_SearchReShow",c$)
     IF VAL (c$) <> 0 THEN 
       GetCodeMA% = VAL (c$)
       IF GetCodeMA% > 0 THEN 
         cuma% = GetCodeMA%
         SELECT KEY cuma% INDEX codema.MAADR
         SET INDEX ALL 
         INDEX nachname.MAADR
         FORM 
         MOUSE ON 
       END IF 
     END IF 
   END IF 
  
 END SUB 


 REM Suche eines Maklerbetreuers
FUNCTION MakGetCodeMA%(prompt%,wks%)
 REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
 REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 _pos% = CodeMA.MAADR
 alle$ = "n"
AnfAlle020920031: 
 FILE "MAADR"
 INDEX MaklBetreuer.MAADR
 SELECT FIRST 
 SELECT KEY "j" FILE "MAADR" INDEX MaklBetreuer.maadr
 REM Agenturen$(0) = "<keine Zuordnung>" + SPACE$ (120) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR") AND MaklBetreuer.maadr = "j"
   sok% = - 1
   IF GASP% THEN 
     IF workstation% > 0 THEN 
       FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
         wks% = VisOff%(ii%)
         aa% = IsWksVisible%(wks%)
         naab$ = Nachname.maadr + "/" + vorname.maadr
         IF aa% = - 1 AND CodeMa.Maadr <> 0 AND workstation.maadr = wks% THEN 
           REM CALL Fehler(naab$,"aa: " + STR$ (aa%))
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.MAADR <> 0 AND Sperre.MAADR <> vcodema% THEN sok% = 0
           END IF 
           sok% = - 1
           IF alle$ = "n" THEN 
             IF NoAnzeige.maadr LIKE "j" THEN sok% = 0
           END IF 
           
           ii% = VisCount%
         ELSE 
           sok% = 0
         END IF 
       NEXT ii%
     END IF 
   END IF 
   IF alle$ = "n" THEN 
     IF NoAnzeige.maadr LIKE "j" THEN sok% = 0
   END IF 
   IF GMASuperCount% > 0 AND sok% THEN 
     IF IsMASuper%(codema.MAADR) THEN 
     ELSE 
       sok% = 0
       END IF 
     END IF 
   END IF 
   IF MaklBetreuer.maadr <> "j" THEN sok% = 0

   IF sok% THEN 
     IF agenturnr.maadr <> "" THEN 
       agnr$ = TRIM$ (Agenturnr.maadr)
     ELSE 
       agnr$ = ""
     END IF 
     IF GASP% THEN 
       SELECT FIRST FILE "filiale" INDEX filialnr.filiale
       SELECT KEY Workstation.maadr FILE "filiale" INDEX filialnr.filiale
       filab$ = Name.filiale
     END IF 
     IF nachname.maadr <> "" THEN 
       IF alle$ <> "j" THEN 
         IF firmaname.maadr <> "" THEN 
           firma$ = "/" + LTRIM$ (firmaname.maadr)
         ELSE 
           firma$ = ""
         END IF 
         IF GAFSK$ LIKE "TRUE" THEN 
           test$ = PAD$ ( LTRIM$ (Nachname.MAADR) + ", " + LTRIM$ (Vorname.MAADR) + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",50)
         ELSE 
           test$ = PAD$ ( LTRIM$ (Nachname.MAADR) + ", " + LTRIM$ (Vorname.MAADR) + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", " + LTRIM$ (Stra·e.maadr),60)
         END IF 
         IF GAFSK$ LIKE "TRUE" THEN 
           Agenturen$(a%) = test$ + " " + PAD$ (agnr$,15)
         ELSE 
           Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000")
         END IF 
       ELSE 
         IF firmaname.maadr <> "" THEN 
           firma$ = "/" + LTRIM$ (firmaname.maadr)
         ELSE 
           firma$ = ""
         END IF 
         IF GAFSK$ LIKE "TRUE" THEN 
           test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", ",40)
         ELSE 
           test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", " + LTRIM$ (Stra·e.maadr),50)
         END IF 
         IF NoAnzeige.maadr LIKE "j" THEN 
           IF GAFSK$ LIKE "TRUE" THEN 
             Agenturen$(a%) = test$ + " " + PAD$ (agnr$,15) + " * "
           ELSE 
             Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000") + "            *"
           END IF 
         ELSE 
           IF GAFSK$ LIKE "TRUE" THEN 
             Agenturen$(a%) = test$ + " " + PAD$ (agnr$,15)
           ELSE 
             Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000") + "             "
           END IF 
         END IF 
       END IF 
       IF GASP% THEN 
         Agenturen$(a%) = Agenturen$(a%) + "    " + "   " + filab$
       END IF 
       Agenturen$(a%) = Agenturen$(a%) + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
       IF CodeMA.MAADR = prompt% THEN prompt$ = Agenturen$(a%)
       a% = a% + 1
     END IF 
   END IF 
   SET STATUS nachname.maadr + "," + vorname.maadr + " eingelesen"
   SELECT NEXT FILE "maadr"
 WEND 
 prompt$ = agprompt$
 IF alle$ <> "j" THEN 
   IF GASP% THEN 
     CREATE DIALOG "MASUCH",0,0,440,284,"MaklerbetreuerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
   ELSE 
     CREATE DIALOG "MASUCH",0,0,374,284,"MaklerbetreuerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
   END IF 
 ELSE 
   IF GASP% THEN 
     CREATE DIALOG "MASUCH",0,0,440,284,"MaklerbetreuerÅbersicht aller Vermittler","Courier New",10
   ELSE 
     CREATE DIALOG "MASUCH",0,0,374,284,"MaklerbetreuerÅbersicht aller Vermittler","Courier New",10
   END IF 
 END IF 
 IF GASP% THEN 
   ADD DIALOG "MASUCH",4,0,0,440,263,0,""
 ELSE 
   ADD DIALOG "MASUCH",4,0,0,368,263,0,""
 END IF 
 ADD DIALOG "MASUCH",9,5,5,21,21,2
 ADD DIALOG "MASUCH",5,37,5,151,10,0,"Bitte wÑhlen Sie einen Maklerbetreuer aus:"
 IF alle$ <> "j" THEN 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",5,37,15,390,10,0,"Vermittler                                       Agenturnummer          Stufe       BÅro"
   ELSE 
     IF GAFSK$ LIKE "TRUE" THEN 
       ADD DIALOG "MASUCH",5,37,15,310,10,0,"Vermittler                                  Agenturnummer"
     ELSE 
       ADD DIALOG "MASUCH",5,37,15,310,10,0,"Vermittler                                  Agenturnummer              Stufe"
     END IF 
   END IF 
 ELSE 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",5,37,15,390,10,0,"Vermittler                                 Agenturnummer       Stufe    ausgeblendet   BÅro"
   ELSE 
     IF GAFSK$ LIKE "TRUE" THEN 
       ADD DIALOG "MASUCH",5,37,15,330,10,0,"Vermittler                     Agenturnummer"
     ELSE 
       ADD DIALOG "MASUCH",5,37,15,330,10,0,"Vermittler                                 Agenturnummer       Stufe    ausgebl."
     END IF 
   END IF 
 END IF 
 IF GASP% THEN 
   ADD DIALOG "MASUCH",7,7,27,458,229,2,1,Agenturen$,Auswahl$,prompt$
 ELSE 
   ADD DIALOG "MASUCH",7,7,27,358,229,2,1,Agenturen$,Auswahl$,prompt$
 END IF 
 ADD DIALOG "MASUCH",1,56,268,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,113,268,55,15,0,"&Abbrechen",0,0
 IF alle$ <> "j" THEN ADD DIALOG "MASUCH",1,173,268,65,15,0,"Alle anzeigen",2,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 MOUSE OFF 
 IF req% = 2 THEN 
   REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
   REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
   alle$ = "j"
   GOTO AnfAlle020920031
 END IF 
 IF req% = 1 THEN 
   MakGetCodeMA% = VAL ( RIGHT$ (Auswahl$(0),6))
   cuma% = GetCodeMA%
   prompt$ = Auswahl$(0)
   agprompt$ = prompt$
 ELSE 
   MakGetCodeMA% = 0
 END IF 
 IF MakGetCodeMA% > 0 THEN SELECT KEY MakGetCodeMA% FILE "MAADR" INDEX CodeMA.MAADR
 FILE cfile$
 END FUNCTION 
 


SUB MADRSuList()
 DIM Auswahl$(1)
 cfile$ = FILE 
 _pos% = CodeMA.MAADR
 alle$ = "n"
 
 GOTO AnfWeit130520032
AnfAlle130520011: 
 FILE "MAADR"
 INDEX Nachname.MAADR
 SELECT FIRST 
 REM Agenturen$(0) = "<keine Zuordnung>" + SPACE$ (120) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   sok% = - 1
   IF GASP% THEN 
     IF workstation% > 0 THEN 
       FOR ii% = 0 TO VisCount% - 1' Fall externes BÅro
         wks% = VisOff%(ii%)
         aa% = IsWksVisible%(wks%)
         IF aa% = - 1 AND CodeMa.Maadr <> 0 AND workstation.maadr = wks% THEN 
           IF MNdisabled%("DATALOCK") THEN 
             IF Sperre.MAADR <> 0 AND Sperre.MAADR <> vcodema% THEN sok% = 0
           END IF 
           IF alle$ = "n" THEN 
             IF NoAnzeige.maadr LIKE "j" THEN sok% = 0
           END IF 
           sok% = - 1
           ii% = VisCount%
         ELSE 
           sok% = 0
         END IF 
       NEXT ii%
     END IF 
   END IF 
   IF alle$ = "n" THEN 
     IF NoAnzeige.maadr LIKE "j" THEN sok% = 0
   END IF 
   IF GMASuperCount% > 0 AND sok% THEN 
     IF IsMASuper%(codema.MAADR) THEN 
     ELSE 
       sok% = 0
       END IF 
     END IF 
   END IF 
   IF sok% THEN 
     IF agenturnr.maadr <> "" THEN 
       agnr$ = TRIM$ (Agenturnr.maadr)
     ELSE 
       agnr$ = ""
     END IF 
     IF GASP% THEN 
       SELECT FIRST FILE "filiale" INDEX filialnr.filiale
       SELECT KEY Workstation.maadr FILE "filiale" INDEX filialnr.filiale
       filab$ = Name.filiale
     END IF 
     IF nachname.maadr <> "" THEN 
       IF alle$ <> "j" THEN 
         IF firmaname.maadr <> "" THEN 
           firma$ = "/" + LTRIM$ (firmaname.maadr)
         ELSE 
           firma$ = ""
         END IF 
         test$ = PAD$ ( LTRIM$ (Nachname.MAADR) + ", " + LTRIM$ (Vorname.MAADR) + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", " + LTRIM$ (Stra·e.maadr),60)
         Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000")
       ELSE 
         IF firmaname.maadr <> "" THEN 
           firma$ = "/" + LTRIM$ (firmaname.maadr)
         ELSE 
           firma$ = ""
         END IF 
         test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR + LTRIM$ (firma$) + ", " + LTRIM$ (plz.maadr) + " " + LTRIM$ (ort.maadr) + ", " + LTRIM$ (Stra·e.maadr),50)
         IF NoAnzeige.maadr LIKE "j" THEN 
           Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000") + "            *"
         ELSE 
           Agenturen$(a%) = test$ + " " + PAD$ (agnr$,20) + STR$ (stufe.maadr,"000") + "             "
         END IF 
       END IF 
       IF GASP% THEN 
         Agenturen$(a%) = Agenturen$(a%) + "    " + "   " + filab$
       END IF 
       Agenturen$(a%) = Agenturen$(a%) + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
       IF CodeMA.MAADR = prompt% THEN prompt$ = Agenturen$(a%)
       a% = a% + 1
     END IF 
   END IF 
   SET STATUS nachname.maadr + "," + vorname.maadr + " eingelesen"
   SELECT NEXT FILE "maadr"
 WEND 
AnfWeit130520032: 
 prompt$ = agprompt$
 IF alle$ <> "j" THEN 
   IF GASP% THEN 
     CREATE DIALOG "MASUCH",0,0,440,284,"Agentur-/VermittlerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
   ELSE 
     CREATE DIALOG "MASUCH",0,0,368,284,"Agentur-/VermittlerÅbersicht ohne die ausgeblendeten Mitarbeiter","Courier New",10
   END IF 
 ELSE 
   IF GASP% THEN 
     CREATE DIALOG "MASUCH",0,0,440,284,"Agentur-/VermittlerÅbersicht aller Vermittler","Courier New",10
   ELSE 
     CREATE DIALOG "MASUCH",0,0,368,284,"Agentur-/VermittlerÅbersicht aller Vermittler","Courier New",10
   END IF 
 END IF 
 IF GASP% THEN 
   ADD DIALOG "MASUCH",4,0,0,440,263,0,""
 ELSE 
   ADD DIALOG "MASUCH",4,0,0,368,263,0,""
 END IF 
 ADD DIALOG "MASUCH",9,5,5,21,21,2
 ADD DIALOG "MASUCH",5,37,5,151,10,0,"Bitte wÑhlen Sie einen Vermittler aus:"
 IF alle$ <> "j" THEN 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",5,37,15,390,10,0,"Vermittler                                       Agenturnummer          Stufe       BÅro"
   ELSE 
     ADD DIALOG "MASUCH",5,37,15,310,10,0,"Vermittler                                  Agenturnummer              Stufe"
   END IF 
 ELSE 
   IF GASP% THEN 
     ADD DIALOG "MASUCH",5,37,15,390,10,0,"Vermittler                                 Agenturnummer       Stufe    ausgeblendet   BÅro"
   ELSE 
     ADD DIALOG "MASUCH",5,37,15,330,10,0,"Vermittler                                 Agenturnummer       Stufe    ausgebl."
   END IF 
 END IF 
 IF GASP% THEN 
   ADD DIALOG "MASUCH",7,7,27,458,229,2,2,Agenturen$,Auswahl$,prompt$
 ELSE 
   ADD DIALOG "MASUCH",7,7,27,358,229,2,2,Agenturen$,Auswahl$,prompt$
 END IF 
 ADD DIALOG "MASUCH",1,56,268,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,113,268,55,15,0,"&Abbrechen",0,0
 IF alle$ <> "j" THEN ADD DIALOG "MASUCH",1,173,268,65,15,0,"Alle anzeigen",2,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 MOUSE OFF 
 IF req% = 2 THEN 
   REDIM Agenturen$( RECCOUNT ("MAADR") + 1,1)
   REDIM Agenturen$( RECCOUNT ("MAADR") + 1)
   alle$ = "j"
   GOTO AnfAlle130520011
 END IF 
 IF req% = 1 THEN 
   GetCodeMA% = VAL ( RIGHT$ (Auswahl$(0),6))
   prompt$ = Auswahl$(0)
   agprompt$ = prompt$
 ELSE 
   GetCodeMA% = 0
 END IF 
 IF GetCodeMA% > 0 THEN SELECT KEY GetCodeMA% FILE "MAADR" INDEX CodeMA.MAADR
 FILE cfile$
 END SUB 



SUB MAADRNext()
 IF FileChanged%("maadr") = 1 THEN CALL FStore("maadr")
 FILE "MAADR"
 SET INDEX Nachname.maadr
 INDEX Nachname.maadr
 IF GMASuperCount% > 0 THEN 
   CALL Fehler("Diese Funktion ist fÅr Sie gesperrt, bitte nutzen Sie den Button Suchen!","")
 ELSE 
   CALL PSelectNext()
   IF GASP% THEN 
     'Jan: neu --------------- 
     SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.Maadr) + ")"
     'Jan ende ---------------    
   END IF 
   FORM 
 END IF 
 MOUSE ON 
 END SUB 
 
SUB MAADRPrev()
 IF FileChanged%("maadr") = 1 THEN CALL FStore("maadr")
 FILE "MAADR"
 SET INDEX nachname.maadr
 INDEX Nachname.maadr
 IF GMASuperCount% > 0 THEN 
   CALL Fehler("Diese Funktion ist fÅr Sie gesperrt, bitte nutzen Sie den Button Suchen!","")
 ELSE 
 MOUSE OFF 
   CALL PSelectPrev()
   IF GASP% THEN 
     'Jan: neu --------------- 
     SET HEADING title$ + " - BÅro (" + GetWksName$(Workstation.Maadr) + ")"
     'Jan ende ---------------    
   END IF 
   FORM 
 END IF 
 MOUSE ON 
 END SUB 
 
SUB MAADRLoeschen()
 IF nachname.maadr <> "<ohne Zuordnung>" THEN 
   IF disabled%("MAADRLOESCHEN") THEN END SUB 
   IF ag$ = "j" THEN 
     CALL Fehler("Diese Funktion ist fÅr SmartPROVIS Agentur gesperrt!","")
     END SUB 
   END IF 
   MOUSE OFF 
   CALL DFile(3,"gekond" + _fpw$)
   CALL DFile(3,"kvertrag" + _fpw$)
   cuma% = CodeMA.MAADR
   Dateien$ = ""
   ok% = 1
   IF EXISTS (cuma%,CodeMA.KVERTRAG) THEN 
     ok% = 0
     Dateien$ = Dateien$ + ", VertrÑge"
   END IF 
   IF EXISTS (cuma%,CodeMA.GEKOND) THEN 
     REM ok% = 0
     REM Dateien$ = Dateien$ + ", Konditionen"
   END IF 
   IF EXISTS (cuma%,VorgÑnger.maadr) AND ok% = 1 THEN 
     ok% = 2
   END IF 
   MOUSE ON 
   IF ok% = 0 THEN 
     Dateien$ = RIGHT$ (Dateien$, LEN (Dateien$) - 2)
     CALL Fehler("Lîschen nicht mîglich!","Es existieren VerknÅpfungen zu den Dateien: " + Dateien$ + ".")
     SET STATUS "Datensatz konnte nicht gelîscht werden"
   ELSE 
     IF ok% = 1 THEN 
       MOUSE OFF 
       REQUEST "Wollen Sie die aktuelle Agentur wirklich lîschen?","",135,req%
       IF req% = 1 THEN 
         IF EXISTS (cuma%,codema.mavorg) THEN 
           SET STATUS "Lîschen der VorgÑnger"
           REMOVE FROM FILE "MAVORG" WHERE codema.mavorg = cuma%
         END IF 
         IF EXISTS (cuma%,codema.gekond) THEN 
           SET STATUS "Lîschen der Konditionen"
           REMOVE FROM FILE "GEKOND" WHERE codema.gekond = cuma%
         END IF 
         FILE "maadr"
         SELECT KEY cuma% LOCK FILE "MAADR" INDEX CodeMA.MAADR
         SELECT REMOVE FILE "MAADR"
         SET STATUS "Datensatz wurde gelîscht"
         REDIM Agenturen$( RECCOUNT ("maadr") + 5)
         Agenturen$( RECCOUNT ("maadr") + 5) = ""
       END IF 
     ELSE 
       IF ok% = 2 THEN 
         CALL Fehler("Der Vermittler kann nicht gelîscht werden, da er bei anderen Vermittlern als VorgÑnger eingetragen wurde!","")
       END IF 
     END IF 
   END IF 
 ELSE 
 CALL Fehler ("Die Agentur <ohne Zuordnung> kann nicht gelîscht werden!","")
 END IF 
 FORM 
 MOUSE ON 
 FORM 
 END SUB 
 
 
 ' Mitarbeiter kÅndigen
 ' =======================================================================
    
SUB MAADRKnd()
 MOUSE OFF 
 DIM Agenturen$( RECCOUNT ("MAADR") + 1)
 Agenturen$(0) = "<keine Zuordnung>" + SPACE$ (80) + "000000"
 cfile$ = FILE 
 FILE "MAADR"
 cuag% = CodeMA.MAADR
 Nachfolger1% = Nachfolger.MAADR
 cindex$ = INDEX 
 INDEX CodeMA.MAADR
 SELECT FIRST 
 a% = 1
 prompt$ = ""
 WHILE NOT EOF ("MAADR")
   Agenturen$(a%) = Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,6) + SPACE$ (80) + STR$ (CodeMA.MAADR,"000000")
   IF Nachfolger1% = CodeMA.MAADR THEN prompt$ = Agenturen$(a%)
   SELECT NEXT FILE "MAADR" INDEX CodeMA.MAADR
   a% = a% + 1
 WEND 
 SELECT KEY cuma% LOCK FILE "MAADR" INDEX CodeMA.MAADR
 IF KÅndigung = 0 THEN 
   prompt$ = Agenturen$(0)
   opt% = 1
 ELSE 
   IF prompt$ = "" THEN 
     prompt$ = Agenturen$(0)
     opt% = 1
   ELSE 
     IF Nachfolger1% < 1 THEN 
       opt% = 1
     ELSE 
       opt% = 2
     END IF 
   END IF 
 END IF 
 Auswahl$ = prompt$
 Agentur$ = Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,6)
 MOUSE ON 
   opt1% = PausUVzahl.maadr
   CREATE DIALOG "KNDG",0,0,211,277,"KÅndigung","MS Sans Serif",8
   ADD DIALOG "KNDG",4,0,0,211,261,0,""
   ADD DIALOG "KNDG",9,3,14,21,23,2
   ADD DIALOG "KNDG",5,25,13,172,25,0,"Bitte geben Sie nachfolgend alle Daten an, die zur ordnungsgemÑ·en KÅndigung der aktuellen Agentur benîtigt werden:"
   ADD DIALOG "KNDG",4,0,38,277,37,0,""
   ADD DIALOG "KNDG",5,30,47,54,11,0,"Agentur:"
   ADD DIALOG "KNDG",5,86,46,100,13,0,Agentur$
   ADD DIALOG "KNDG",5,30,58,60,10,0,"KÅndigung zum:"
   ADD DIALOG "KNDG",6,86,57,41,12,0,0,KÅndigung.maadr,20
   ADD DIALOG "KNDG",4,0,70,277,188,0,""
   ADD DIALOG "KNDG",5,30,79,159,13,0,"Weiterhin anfallende Provisionen..."
   ADD DIALOG "KNDG",3,30,91,55,11,0,"weiterzahlen",1,opt%
   ADD DIALOG "KNDG",3,30,103,147,11,0,"der nachfolgenden Agentur gutschreiben",2,opt%
   ADD DIALOG "KNDG",8,76,115,114,66,259,2,Auswahl$,Agenturen$
   ADD DIALOG "KNDG",5,41,116,27,8,0,"Agentur"
     ADD DIALOG "KNDG",5,45,131,162,25,0,"aber die nachstehend angekreuzten Provisionen der gekÅndigten Agentur weiter zahlen"
     ADD DIALOG "KNDG",2,45,151,143,11,0,"AP weiterzahlen","j","n",KuenAP.MAADR
     ADD DIALOG "KNDG",2,45,161,143,11,0,"1.Courtage zahlen","j","n",KuenCourt1.MAADR
     ADD DIALOG "KNDG",2,45,171,143,11,0,"alle Courtagen zahlen","j","n",KuenCourtAlle.MAADR
     ADD DIALOG "KNDG",2,45,181,143,11,0,"Pflege weiterzahlen","j","n",KuenPflege.MAADR
     
   IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
     ADD DIALOG "KNDG",2,45,191,143,11,0,"Spezial.prov weiterzahlen","j","n",KuenSpezi.MAADR
     REM ADD DIALOG "KNDG",2,55,181,143,11,0,"Fîrderprov. weiterzahlen","j","n",KuenFoerd.MAADR
   END IF 
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
     ADD DIALOG "KNDG",2,30,191,143,14,0,"Stornos der Nachfolgeragentur anlasten","j","n",StornoNachf.maadr
   END IF 
   ADD DIALOG "KNDG",5,45,203,162,25,0,"falls irgend eine Weiterzahlung angekreuzt wurde, dann folgenderma·en mit den Provisionen aus der Struktur verfahren:"
   ADD DIALOG "KNDG",3,45,230,160,11,0,"Provisionen aus Struktur weiterzahlen",0,opt1%
   ADD DIALOG "KNDG",3,45,240,160,11,0,"Provisionen aus Struktur NICHT weiterzahlen",1,opt1%
   ADD DIALOG "KNDG",1,50,260,55,15,0,"&OK",1,1
   ADD DIALOG "KNDG",1,106,260,55,15,0,"&Abbrechen",0,0
   DIALOG "KNDG",req%
   REMOVE DIALOG "KNDG"
 IF req% = 1 THEN 
   PausUVzahl.maadr = opt1%
   IF KÅndigung.maadr <> 0 THEN 
     IF opt% = 1 THEN Nachfolger.maadr = 0 ELSE Nachfolger.maadr = VAL ( RIGHT$ (Auswahl$,6))
   ELSE 
     Nachfolger.maadr = 0
   END IF 
   IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
     IF opt% = 1 AND KÅndigung.maadr <> 0 THEN 
       KuenAP.MAADR = "n"
       KuenCourt1.MAADR = "n"
       KuenCourtAlle.MAADR = "n"
       REM KuenDynamik.MAADR = "n"
       KuenFoerd.MAADR = "n"
       KuenSpezi.MAADR = "n"
       KuenPflege.MAADR = "n"
     END IF 
   END IF 
   REM Workstation.maadr = Workstation%
   REM QWoNo.maadr = STR$ (Workstation%,"000000") + STR$ (codema.maadr,"000000")
   RecStatus.maadr = "c"
   STORE FILE "MAADR"
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
 
 ' Strukturaufbau VorgÑnger
 ' =======================================================================
 
SUB VorgaengerOld()
 CALL DFile(3,"vkond" + _fpw$)
 IF disabled%("VORGAENGER") THEN END SUB 
 IF ag$ = "j" THEN 
   CALL Fehler("Diese Funktion ist fÅr SmartPROVIS Agentur gesperrt!","")
   END SUB 
 END IF 
 _cuma% = CodeMA.MAADR
 VorgÑnger% = VorgÑnger.MAADR
 IF ( MOD ("MAADR") OR NEW ("MAADR")) AND nachname.maadr <> "" THEN CALL FStore("MAADR")
 ok% = - 1
 IF EXISTS (_cuma%,CodeMA.VKOND) AND VorgÑnger% > 0 THEN 
   REM 250198 ok% = 0
   a$ = "Zuweisung eines neuen VorgÑnger:!"
   b$ = "Auswirkungen:" + CHR$ (13) + CHR$ (10)
   b$ = b$ + "1. Alle VertrÑge, die bereits an die Provisionsabrechnung Åbergeben wurden, werden zu den Konditionen des öbergabezeitpunktes weiterhin berechnet (also mit den Konditionen des alten VorgÑngers)."
   b$ = b$ + CHR$ (13) + CHR$ (10) + "2. Alle VertrÑge die nach der Wahl des neuen VorgÑngers an die Provisionsabrechnung Åbergeben werden, werden mit den daraus resultierenden Konditionen berechnet"
   REM b$ = b$ + CHR$ (10) + CHR$ (13) + "ACHTUNG beachten Sie, da· die neue VorgÑngeragentur (und ihre VorgÑnger) auch mindestens die Konditionen zu Produkten mit einem entsprechenden ~Bewertungszeitraum von~ besitzen mu·, wie die aktuelle Agentur!!!"
   CALL Fehler(a$,b$)
   a$ = "Zu Beachten bei den Konditionen:"
   b$ = "ACHTUNG beachten Sie, da· die neue VorgÑngeragentur (und ihre VorgÑnger) auch mindestens die Konditionen zu Produkten mit einem entsprechenden ~Bewertungszeitraum von~ besitzen mu·, wie die aktuelle Agentur!!!"
   CALL Fehler(a$,b$)
   REQUEST "Neuen VorgÑnger wirklich erfassen?","",130,reqv%
   IF reqv% = 0 THEN ok% = 0
 ELSE 
   REM IF EXISTS (_cuma%,CodeMA.gekond) AND VorgÑnger% > 0 THEN 
     REM ok% = 0
     REM a$ = "Sie versuchen dieser Agentur einen anderen VorgÑnger zuzuweisen! Dies ist nicht mîglich, da fÅr diese Agentur bereits  Konditionen definiert wurden,"
     REM b$ = "die in AbhÑngigkeit zum VorgÑnger stehen! Sie mÅssen zuerst die Konditionen dieser Agentur lîschen, dann Åbernehmen Sie die Konditionen der neuen VorgÑngeragentur und passen diese entsprechend an!"
     REM CALL Fehler(a$,b$)
   END IF 
 END IF 
 IF ok% = 0 THEN GOTO vend130199
 
 
 DIM Agenturen$( RECCOUNT ("MAADR"))
 DIM Auswahl$(1)
 FILE "MAADR"
 INDEX Nachname.MAADR
 SELECT FIRST 
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   test$ = PAD$ (Nachname.MAADR + ", " + Vorname.MAADR,40)
   Agenturen$(a%) = test$ + "   " + PAD$ (Agenturnr.maadr,20) + STR$ (stufe.maadr,"000") + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
   IF CodeMA.MAADR = VorgÑnger% THEN prompt$ = Agenturen$(a%)
   SELECT NEXT 
   a% = a% + 1
 WEND 
 REM CREATE DIALOG "MASUCH",0,0,308,288,"Strukturaufbau","MS Sans Serif",8
 CREATE DIALOG "MASUCH",0,0,308,288,"Strukturaufbau","MS Sans Serif",7
 ADD DIALOG "MASUCH",4,0,0,308,263,0,""
 ADD DIALOG "MASUCH",9,5,5,21,21,2
 ADD DIALOG "MASUCH",5,37,5,151,10,0,"Bitte wÑhlen Sie einen VorgÑnger aus:"
 ADD DIALOG "MASUCH",5,37,15,300,10,0,"Vermittler                        Agenturnummer       Stufe"
 ADD DIALOG "MASUCH",7,7,27,298,229,2,2,Agenturen$,Auswahl$,prompt$
 ADD DIALOG "MASUCH",1,86,268,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,143,268,55,15,0,"&Abbrechen",0,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 IF req% = 1 THEN 
   vorgÑnger% = VAL ( RIGHT$ (Auswahl$(0),6))
   IF vorgÑnger% > 0 THEN 
     SELECT KEY vorgÑnger% FILE "maadr" INDEX CodeMA.maadr
     stufe% = stufe.maadr
     SELECT KEY _cuma% LOCK FILE "maadr" INDEX CodeMA.maadr
     VorgÑnger.maadr = VAL ( RIGHT$ (Auswahl$(0),6))
     IF vorgÑnger% <> _cuma% THEN 
       stufe.maadr = stufe% + 1
     ELSE 
       stufe.maadr = 1
     END IF 
     s$ = STR$ (stufe.maadr,"00")
     feld$ = "Titel" + s$ + ".stamm"
     IstTitel.maadr = feld$$
     feld$ = "BWS" + s$ + ".stamm"
     SollBWS.maadr = feld$$
     feld$ = "Squote" + s$ + ".stamm"
     SollQuote.maadr = feld$$
     feld$ = "MAAnz" + s$ + ".stamm"
     SollMAAnz.maadr = feld$$
     IstBWS.maadr = BWSGes.maadr + SBwsges.maadr
     istbwseu.maadr = IstBWS.maadr / umrechnung.stamm
     CALL FStore("maadr")
   END IF 
   IF KonTest$ <> "FALSE" THEN CALL KondTestKo()
 END IF 
vend130199: 
 FILE "MAADR"
 SELECT KEY _cuma% FILE "MAADR" INDEX CodeMA.MAADR
 SET INDEX Nachname.MAADR
 INDEX Nachname.MAADR
 FORM 
 END SUB 
 
 
 ' MAADRLIST Ausgabe einer öbersicht der Agenturen
 ' ====================================================================== 
  
SUB MAADRLIST()
 MOUSE OFF 
 IF disabled%("MAADRLIST") THEN END SUB 
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 cuma% = CodeMA.MAADR
 DIM Mitarbeiter$( RECCOUNT ("MAADR"))
 a% = 0
 FILE "MAADR"
 INDEX CodeMA.MAADR
 prompt$ = "ZZZZZZZ"
 SELECT FIRST FILE "maadr"
 REQUEST "Nur die aktiven Mitarbeiter ausdrucken?","",130,reqakt%
 WHILE NOT EOF ("MAADR")
   IF reqakt% = 1 THEN 
     IF NoAnzeige <> "j" THEN 
       IF nachname.maadr <> "<ohne Zuordnung>" THEN 
         REM nur aktive Mitarbeiter anzeigen NoAnzeige<>"j"
         sok% = - 1
         IF gasp% THEN 
           IF workstation% > 0 THEN 
             IF workstation.maadr <> workstation% THEN sok% = 0
           END IF 
         END IF 
         IF sok% = - 1 THEN 
           Mitarbeiter$(a%) = Nachname.MAADR + IF (Vorname.MAADR <> "",", " + Vorname.MAADR,"") + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
           IF FORM LIKE "*maadr*" THEN 
             IF CodeMA.MAADR = cuma% THEN prompt$ = Mitarbeiter$(a%)
             opt% = 2
           ELSE 
             opt% = 1
             IF Mitarbeiter$(a%) < prompt$ THEN prompt$ = Mitarbeiter$(a%)
           END IF 
           a% = a% + 1
         END IF 
       END IF 
     END IF 
   ELSE 
     IF nachname.maadr <> "<ohne Zuordnung>" THEN 
       sok% = - 1
       IF gasp% THEN 
         IF workstation% > 0 THEN 
           IF workstation.maadr <> workstation% THEN sok% = 0
         END IF 
       END IF 
       IF sok% = - 1 THEN 
         Mitarbeiter$(a%) = Nachname.MAADR + IF (Vorname.MAADR <> "",", " + Vorname.MAADR,"") + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
         IF FORM LIKE "*maadr*" THEN 
           IF CodeMA.MAADR = cuma% THEN prompt$ = Mitarbeiter$(a%)
           opt% = 2
         ELSE 
           opt% = 1
           IF Mitarbeiter$(a%) < prompt$ THEN prompt$ = Mitarbeiter$(a%)
         END IF 
         a% = a% + 1
       END IF 
     END IF 
   END IF 
   SELECT NEXT FILE "maadr"
 WEND 
 Auswahl$ = prompt$
 opt% = 1
 MOUSE ON 
 CREATE DIALOG "MALIST",0,0,195,136,title$,"MS Sans Serif",8
 ADD DIALOG "MALIST",4,0,0,195,111,0,""
 ADD DIALOG "MALIST",9,5,10,20,23,2
 ADD DIALOG "MALIST",5,30,11,158,24,0,"Ausgabe der VermittlerÅbersicht"
 IF reqakt% = 1 THEN 
   ADD DIALOG "MALIST",5,30,24,156,26,0,"Bitte wÑhlen Sie aus, ob Sie die Daten eines einzelnen oder aller aktiven Vermittler ausgeben wollen."
 ELSE 
   ADD DIALOG "MALIST",5,30,24,156,26,0,"Bitte wÑhlen Sie aus, ob Sie die Daten eines einzelnen oder aller Vermittler ausgeben wollen."
 END IF 
 ADD DIALOG "MALIST",5,30,54,44,10,0,"Ausgabe fÅr"
 IF reqakt% = 1 THEN 
   ADD DIALOG "MALIST",3,30,64,98,12,0,"alle aktiven Vermittler",1,opt%
 ELSE 
   ADD DIALOG "MALIST",3,30,64,98,12,0,"alle Vermittler",1,opt%
 END IF 
 ADD DIALOG "MALIST",3,30,76,154,12,0,"einzelner Vermittler",2,opt%
 ADD DIALOG "MALIST",8,40,90,145,50,259,2,Auswahl$,Mitarbeiter$
 ADD DIALOG "MALIST",1,40,113,55,15,1,"&OK",1,1
 ADD DIALOG "MALIST",1,96,113,55,15,0,"&Abbrechen",0,0
 DIALOG "MALIST",req%
 REMOVE DIALOG "MALIST"
 IF req% = 1 THEN 
   MOUSE OFF 
   CALL PRep("LMAADR")
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
   SET QUERY ON 
   SET QUERY LOCK OFF 
   ON ERROR GOTO ErrorMAADRLIST
   IF opt% = 1 THEN 
     IF reqakt% = 1 THEN 
       ueberschr$ = "VermitllerÅbersicht (nur aktive)"
       IF gasp% THEN 
         IF workstation% > 0 THEN 
           SELECT ;
           ORDER REPORT Nachname.MAADR
           WHERE NoAnzeige.maadr <> "j" AND nachname.maadr <> "<ohne Zuordnung>" AND workstation.maadr = workstation%
           TO ASK 
         ELSE 
           SELECT ;
           ORDER REPORT Nachname.MAADR
           WHERE NoAnzeige.maadr <> "j" AND nachname.maadr <> "<ohne Zuordnung>"
           TO ASK 
         END IF 
       ELSE 
         SELECT ;
         ORDER REPORT Nachname.MAADR
         WHERE NoAnzeige.maadr <> "j" AND nachname.maadr <> "<ohne Zuordnung>"
         TO ASK 
       END IF 
     ELSE 
       ueberschr$ = "VermitllerÅbersicht (alle)"
       IF gasp% THEN 
         IF workstation% > 0 THEN 
           SELECT ;
           ORDER REPORT Nachname.MAADR
           WHERE nachname.maadr <> "<ohne Zuordnung>" AND workstation.maadr = workstation%
           TO ASK 
         ELSE 
           SELECT ;
           ORDER REPORT Nachname.MAADR
           WHERE nachname.maadr <> "<ohne Zuordnung>"
           TO ASK 
         END IF 
       ELSE 
         SELECT ;
         ORDER REPORT Nachname.MAADR
         WHERE nachname.maadr <> "<ohne Zuordnung>"
         TO ASK 
       END IF 
     END IF 
   ELSE 
     ueberschr$ = "einzelner Vermittler"
     SELECT ;
       ORDER REPORT Nachname.MAADR
       WHERE CodeMA.MAADR = VAL ( RIGHT$ (Auswahl$,6))
       TO ASK 
   END IF 
 END IF 
ErrorMAADRLIST: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 SELECT FORM KEY cuma% FILE "MAADR" INDEX CodeMA.MAADR
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' MAADRLIST Ausgabe einer öbersicht der Agenturen einer Direktion
 ' ====================================================================== 
  
SUB MAADRLIST1()
 MOUSE OFF 
 IF disabled%("MAADRLIST") THEN END SUB 
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 cuma% = CodeMA.MAADR
 DIM Mitarbeiter$( RECCOUNT ("MAADR"))
 a% = 0
 FILE "MAADR"
 INDEX CodeMA.MAADR
 codeagdir% = CodeAgDir.agdir
 direktion$ = Direktion.agdir
 prompt$ = "ZZZZZZZ"
 SELECT FIRST 
 REQUEST "Nur die aktiven Mitarbeiter ausdrucken?","",130,reqakt%
 WHILE NOT EOF ("MAADR")
   IF reqakt% = 1 THEN 
     IF NoAnzeige <> "j" THEN 
       IF codeagdir.maadr = codeagdir% THEN 
         REM nur aktive Mitarbeiter anzeigen NoAnzeige<>"j"
         Mitarbeiter$(a%) = Nachname.MAADR + IF (Vorname.MAADR <> "",", " + Vorname.MAADR,"") + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
         IF FORM LIKE "*maadr*" THEN 
           IF CodeMA.MAADR = cuma% THEN prompt$ = Mitarbeiter$(a%)
           opt% = 2
         ELSE 
           opt% = 1
           IF Mitarbeiter$(a%) < prompt$ THEN prompt$ = Mitarbeiter$(a%)
         END IF 
         a% = a% + 1
       END IF 
     END IF 
   ELSE 
     IF codeagdir.maadr = codeagdir% THEN 
       Mitarbeiter$(a%) = Nachname.MAADR + IF (Vorname.MAADR <> "",", " + Vorname.MAADR,"") + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
       IF FORM LIKE "*maadr*" THEN 
         IF CodeMA.MAADR = cuma% THEN prompt$ = Mitarbeiter$(a%)
         opt% = 2
       ELSE 
         opt% = 1
         IF Mitarbeiter$(a%) < prompt$ THEN prompt$ = Mitarbeiter$(a%)
       END IF 
       a% = a% + 1
     END IF 
   END IF 
   SELECT NEXT 
 WEND 
 Auswahl$ = prompt$
 opt% = 1
 MOUSE ON 
 CREATE DIALOG "MALIST",0,0,195,136,title$,"MS Sans Serif",8
 ADD DIALOG "MALIST",4,0,0,195,111,0,""
 ADD DIALOG "MALIST",9,5,10,20,23,2
 ADD DIALOG "MALIST",5,30,11,158,24,0,"Ausgabe der VermittlerÅbersicht"
 IF reqakt% = 1 THEN 
   ADD DIALOG "MALIST",5,30,24,156,26,0,"Bitte wÑhlen Sie aus, ob Sie die Daten eines einzelnen oder aller aktiven Vermittler ausgeben wollen."
 ELSE 
   ADD DIALOG "MALIST",5,30,24,156,26,0,"Bitte wÑhlen Sie aus, ob Sie die Daten eines einzelnen oder aller Vermittler ausgeben wollen."
 END IF 
 ADD DIALOG "MALIST",5,30,54,44,10,0,"Ausgabe fÅr"
 IF reqakt% = 1 THEN 
   ADD DIALOG "MALIST",3,30,64,98,12,0,"alle aktiven Vermittler",1,opt%
 ELSE 
   ADD DIALOG "MALIST",3,30,64,98,12,0,"alle Vermittler",1,opt%
 END IF 
 ADD DIALOG "MALIST",3,30,76,154,12,0,"einzelner Vermittler",2,opt%
 ADD DIALOG "MALIST",8,40,90,145,50,259,2,Auswahl$,Mitarbeiter$
 ADD DIALOG "MALIST",1,40,113,55,15,1,"&OK",1,1
 ADD DIALOG "MALIST",1,96,113,55,15,0,"&Abbrechen",0,0
 DIALOG "MALIST",req%
 REMOVE DIALOG "MALIST"
 IF req% = 1 THEN 
   MOUSE OFF 
   CALL PRep("LMAADR")
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
   SET QUERY ON 
   SET QUERY LOCK OFF 
   ON ERROR GOTO ErrorMAADRLIST
   IF opt% = 1 THEN 
     IF reqakt% = 1 THEN 
       ueberschr$ = "VermitllerÅbersicht Direktion: " + direktion$ + " (nur aktive)"
       SELECT ;
         ORDER REPORT Nachname.MAADR
         WHERE NoAnzeige.maadr <> "j" AND codeagdir.maadr = codeagdir%
         TO ASK 
     ELSE 
       ueberschr$ = "VermitllerÅbersicht Direktion: " + direktion$ + " (alle)"
       SELECT ;
         ORDER REPORT Nachname.MAADR
         WHERE codeagdir.maadr = codeagdir%
         TO ASK 
     END IF 
   ELSE 
     ueberschr$ = "einzelner Vermittler Direktion: " + direktion$
     SELECT ;
       ORDER REPORT Nachname.MAADR
       WHERE CodeMA.MAADR = VAL ( RIGHT$ (Auswahl$,6))
       TO ASK 
   END IF 
 END IF 
ErrorMAADRLIST: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 REM SELECT FORM KEY cuma% FILE "MAADR" INDEX CodeMA.MAADR
 REM FORM 
 MOUSE ON 
 END SUB 
 




 ' wird von MAADRLIST() genutzt
 ' ====================================================================== 
 
FUNCTION GetVorg$(vorg%)
 IF vorg% = 0 OR vorg% = CodeMA.MAADR THEN 
   GetVorg$ = "kein VorgÑnger"
 ELSE 
   cuma% = CodeMA.MAADR
   SELECT KEY vorg% FILE "MAADR" INDEX CodeMA.MAADR
   GetVorg$ = Nachname.MAADR + IF (Vorname.MAADR <> "",", " + Vorname.MAADR,"")
   SELECT KEY cuma% FILE "MAADR" INDEX CodeMA.MAADR
 END IF 
 END FUNCTION 
 
 
 
 '      **************************************
 '      ** Routinen fÅr Formular "SPGRUPPE" **
 '      **************************************
 
SUB SPGRUPPE()
 
 IF disabled%("SPARTEN") THEN END SUB 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 _formend% = 0
 DIRECTORY _ppath$
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "SPGRUPPE" THEN 
     SET HEADING title$ + " - Sparten"
     REM OPEN FORM "SPGRUPPE"
       IF EXISTS (GPrjForm$ + "SPGRUPPE.sbv") THEN 
         OPEN FORM GPrjForm$ + "SPGRUPPE"
       ELSE 
         OPEN FORM GPrjForm$ + "SPGRUPPE"
       END IF 
     SET f = Superbase.Form
     FILE "spgruppe"
     SELECT WHERE 
     CALL MNSPGRUPPE()
     SET STATUS "Spartengruppen"
     MENU ON 
     INDEX gruppe.spgruppe
     SELECT FIRST 
     SELECT FORM KEY codegrsp.spgruppe FILE "sparten" INDEX codegrsp.sparten
   END IF 
   IF _codegrsp% <> - 1 THEN 
     INDEX gruppe.spgruppe
     SELECT FIRST 
     SELECT KEY _codegrsp% FILE "spgruppe" INDEX codegrsp.spgruppe
     SELECT FORM KEY _codegrsp% FILE "sparten" INDEX codegrsp.sparten
   END IF 
   FORM 
   MOUSE ON 
   IF ag$ = "j" THEN 
     f.neu.visible = 0
     f.bearb.visible = 0
   ELSE 
     f.neu.visible = - 1
     f.bearb.visible = - 1
   END IF 
   f.abbruch.enabled = 0
   f.abbruch.visible = 0
   f.suchen.enabled = - 1
   f.suchen.visible = - 1
   CALL ClearKBDBuffer()
   sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.spgruppe,",9999.0000"))
   st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.spgruppe,",9999.0000"))
   SET STATUS sq$ + st$
     IF GRSPARTEsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   SELECT CASE GRSPARTEsub%
   CASE 1
     CALL LIST8SPGR()
   CASE 2
     cuva% = codeva.sparten
     _codegrsp% = codegrsp.spgruppe
     IF gruppe.spgruppe <> "" THEN IF NEW ("SPGRUPPE") OR MOD ("SPGRUPPE") THEN CALL FStore("SPGRUPPE")
     CALL CODEVA()
   CASE 3
     _codegrsp% = - 1
     datei$ = "spgruppe":CALL PSelectPrev()
   CASE 4
     _codegrsp% = - 1
     datei$ = "spgruppe":CALL PSelectNext()
   CASE 5
     _codegrsp% = - 1
     CALL SPGRNeu()
     GRSPARTEsub% = 99
   CASE 6
     REM Synchronisation mit Vertragsdatei
     _codegrsp% = codegrsp.spgruppe
     CALL SyncGrSp()
     FILE "spgruppe"
   CASE 99
     
     MENU OFF 
     IF RECCOUNT ("spgruppe") = 0 THEN 
       BLANK FILE "spgruppe"
       CodeGRSp% = SER ("spgruppe",1)
       CodeGRSp.spgruppe = CodeGRSp%
       gruppe.spgruppe = " NEU"
       STORE 
       SELECT KEY CodeGRSp% LOCK FILE "spgruppe" INDEX CodeGRSp.spgruppe
     END IF 
     IF codegrsp.spgruppe <> 0 THEN 
       CALL ButDesabled()
       f.vertragsuebersicht.enabled = 0
       ENTER gruppe.spgruppe,0
       f.vertragsuebersicht.enabled = - 1
       CALL ButEnabled()
       GRSPARTEsub% = 0
     ELSE 
       CALL Fehler("Die Spartengruppe <ohne Zuordnung> kînen Sie nicht Ñndern!","")
       GRSPARTEsub% = 0
     END IF 
 
   END SELECT 
   MENU ON 
   IF GRSPARTEsub% <> 99 THEN GRSPARTEsub% = 0
 WEND 
 IF gruppe.spgruppe <> "" THEN IF NEW ("SPGRUPPE") OR MOD ("SPGRUPPE") THEN CALL FStore("SPGRUPPE")
 _formend% = 0
 END SUB 
 
 

SUB SyncGrSp()
 IF disabled%("SPARTEN") OR disabled%("SPARTENEDIT") OR disabled%("SPARTENEDIT") OR disabled%("VERTRBEARB") OR disabled%("PRODUKTEDIT") THEN END SUB 
 MOUSE OFF 
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(3,"VPRODUKT" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 t1$ = "Von dieser Operation sind alle VertragsdatensÑtze und Produkte betroffen! Ziel ist es alle Namen und VerknÅpfungen zwischen der Spartendatei, der Spartengruppendatei, der Produktdatei und der Vertragsdatei zu aktualisieren!!"
 CALL Fehler(t1$,"Bitte sorgen Sie dafÅr, da· Sie als einziger User im Programm sind!")
 REQUEST "Sollen die Anpassungen vorgenommen werden?","",135,req%
 IF req% <> 1 THEN GOTO endsync090420051
 REQUEST "Sind Sie als einziger User im Programm angemeldet?","",135,req%
 IF req% <> 1 THEN GOTO endsync090420051
 MOUSE OFF 
 FILE "kvertrag"
 INDEX codeva.kvertrag
 FILE "spgruppe"
 INDEX codegrsp.spgruppe
 SELECT FIRST FILE "spgruppe" INDEX codegrsp.spgruppe
 REM  SELECT KEY 1 FILE "spagruppe" INDEX codegrsp.spgruppe
 FILE "vprodukt"
 INDEX codeva.vprodukt
 FILE "Sparten"
 INDEX codegrsp.sparten
 WHILE NOT EOF ("spgruppe")
   codegrsp% = codegrsp.spgruppe
   gruppe$ = gruppe.spgruppe
   SELECT FIRST FILE "sparten" INDEX codegrsp.sparten
   SELECT KEY codegrsp% FILE "sparten" INDEX codegrsp.sparten
   MOUSE OFF 
   k% = 0
   j% = RECCOUNT ("kvertrag")
   WHILE NOT EOF ("Sparten") AND codegrsp.sparten = codegrsp%
     codeva% = codeva.sparten
     sparte$ = sparte.sparten
     IF EXISTS (codeva%,codeva.kvertrag) THEN 
       SELECT FIRST FILE "kvertrag" INDEX codeva.kvertrag
       SELECT KEY codeva% LOCK FILE "kvertrag" INDEX codeva.kvertrag
       WHILE NOT EOF ("kvertrag") AND codeva.kvertrag = codeva%
         k% = k% + 1
         codegrsp.kvertrag = codegrsp%
         Sparte.kvertrag = Sparte$
         Spartengruppe.kvertrag = gruppe$
         STORE FILE "kvertrag"
         SET STATUS gruppe$ + "/" + sparte$ + "/" + STR$ (k%,",999999")
         SELECT NEXT LOCK FILE "kvertrag" INDEX codeva.kvertrag
       WEND 
     END IF 
     IF EXISTS (codeva%,codeva.vprodukt) THEN 
       SELECT FIRST FILE "vprodukt" INDEX codeva.vprodukt
       SELECT KEY codeva% LOCK FILE "vprodukt" INDEX codeva.vprodukt
       i% = 0
       WHILE NOT EOF ("vprodukt") AND codeva.vprodukt = codeva%
         i% = i% + 1
         SET STATUS STR$ (i%,",99999999") + " vprodukt"
         codegrsp.vprodukt = codegrsp%
         gruppe.vprodukt = gruppe$
         sparte.vprodukt = sparte$
         GesSpa.Vprodukt = Gesellschaft.vprodukt + Sparte.vprodukt
         STORE FILE "vprodukt"
         SELECT NEXT LOCK FILE "vprodukt" INDEX codeva.vprodukt
       WEND 
     END IF 

     IF EXISTS (codeva%,codeva.gekond) THEN 
       i% = 0
       SELECT FIRST LOCK FILE "gekond" INDEX codeva.gekond
       SELECT KEY codeva% LOCK FILE "gekond" INDEX codeva.gekond
       lfdnrold% = 0
       WHILE NOT EOF ("gekond") AND codeva.gekond = codeva%
         
         lfdnr% = lfdnr.gekond
         i% = i% + 1
         SET STATUS STR$ (i%,",99999999") + " gekond"
         IF codeva.gekond = codeva% THEN 
           REM IF lfdnr% = lfdnrold% THEN BREAK 
           lfdnrold% = lfdnr.gekond
           codegrsp.gekond = codegrsp%
           gruppe.gekond = gruppe$
           sparte.gekond = sparte$
           QuickCodeGes.gekond = STR$ (CodeMA.gekond,"000000") + UCASE$ (gesellschaft.gekond) + UCASE$ (sparte.gekond)
           QuickCodeGes$ = STR$ (CodeMA.gekond,"000000") + UCASE$ (gesellschaft.gekond) + UCASE$ (sparte.gekond)
           STORE FILE "gekond"
         END IF 
         SELECT NEXT LOCK FILE "gekond" INDEX codeva.gekond
       WEND 
     END IF 
w090120071: 
     SELECT NEXT FILE "sparten"
   WEND 
   SELECT NEXT FILE "spgruppe"
 WEND 
 MOUSE OFF 
 i% = 0
 j% = RECCOUNT ("kvertrag")
 FILE "vprodukt"
 INDEX codevp.vprodukt
 FILE "kvertrag"
 INDEX lfdnr.kvertrag
 IF RECCOUNT ("kvertrag") > 0 THEN 
   SELECT FIRST LOCK FILE "kvertrag"
   WHILE NOT EOF ("KVERTRAG")
     i% = i% + 1
     SET STATUS STR$ (i%,",999999") + " von " + STR$ (j%,",999999")
     IF codevp.kvertrag > 0 THEN 
       SELECT KEY codevp.kvertrag FILE "vprodukt" INDEX codevp.vprodukt
       DirektVSKZ.kvertrag = DirektVSKZ.vprodukt
       STORE FILE "kvertrag"
     END IF 
     SELECT NEXT LOCK FILE "kvertrag"
   WEND 
 END IF 
 MOUSE ON 
 CALL Fehler("Synchronisation beendet","")
endsync090420051: 
 MOUSE ON 
 END SUB 


 ' SPARTEN Neu
 ' =======================================================================
 
SUB SPGRNeu()
 IF gruppe.spgruppe <> "" THEN IF NEW ("spgruppe") OR MOD ("spgruppe") THEN CALL FStore("spgruppe")
 BLANK FILE "spgruppe"
 SET STATUS "Datensatz neu angelegt..."
 _codeGRSP% = SER ("spgruppe",1)
 codeGRSP.spgruppe = _codegrsp%
 gruppe.spgruppe = " NEU"
   Workstation.spgruppe = Workstation%
   QWoNo.spgruppe = STR$ (Workstation%,"000000") + STR$ (codegrsp.spgruppe,"000000")
   RecStatus.spgruppe = "c"
 STORE FILE "spgruppe"
 SELECT FORM KEY _codeGRSP% FILE "spgruppe" INDEX codeGRSP.spgruppe
 FORM 
 GRSPARTEsub% = 99
 END SUB 
 
 
 ' SPARTEN Suchen
 ' =======================================================================
 
SUB SPGRSuchen()
 REM SET QUERY ON 
 REM SET INDEX ALL 
 _codegrsp% = codegrsp.spgruppe
 IF MOD ("spgruppe") OR NEW ("spgruppe") THEN CALL FStore("spgruppe")
 rep% = GetCodeGR%(_codegrsp%)
 _codegrsp% = rep%
      SELECT KEY _codegrsp% FILE "spgruppe" INDEX codegrsp.spgruppe
     SELECT FORM KEY _codegrsp% FILE "sparten" INDEX codegrsp.sparten
 REM SET INDEX ALL 
 REM INDEX gruppe.spgruppe
 FORM 
 _codegrsp% = - 1
 END SUB 
 
FUNCTION GetCodeGR%(prompt%)
 DIM Sparten$( RECCOUNT ("spgruppe") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 _pos% = Codegrsp.spgruppe
 FILE "spgruppe"
 INDEX gruppe.spgruppe
 SELECT FIRST 
 REM Sparten$(0) = "<keine Zuordnung>" + SPACE$ (55) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("spgruppe")
   IF LTRIM$ (gruppe.spgruppe) <> "" THEN 
     Sparten$(a%) = gruppe.spgruppe + SPACE$ (150) + STR$ (Codegrsp.spgruppe,"000000")
     IF CodeVA.SPARTEN = prompt% THEN prompt$ = Sparten$(a%)
     a% = a% + 1
   END IF 
   SELECT NEXT 
 WEND 
 CREATE DIALOG "MASUCH",0,0,190,264,"SpartengruppenÅbersicht","MS Sans Serif",8
 ADD DIALOG "MASUCH",4,0,0,190,237,0,""
 ADD DIALOG "MASUCH",9,9,11,21,21,2
 ADD DIALOG "MASUCH",5,37,11,151,9,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
 ADD DIALOG "MASUCH",7,7,27,175,201,2,2,Sparten$,Auswahl$,prompt$
 ADD DIALOG "MASUCH",1,40,245,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,97,245,55,15,0,"&Abbrechen",0,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 IF req% = 1 THEN 
   GetCodeGR% = VAL ( RIGHT$ (Auswahl$(0),6))
 ELSE 
   GetCodeGR% = 0
 END IF 
 SELECT KEY GetCodeGR% FILE "spgruppe" INDEX Codegrsp.spgruppe
 FILE cfile$
 END FUNCTION 
 
FUNCTION GetCodeMAGR$(prompt$)
 GetCodeMAGR$ = ""
 DIM Sparten$( RECCOUNT ("maadrgru") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 
 FILE "maadrgru"
 INDEX magruppe.maadrgru
 SELECT FIRST 
 REM Sparten$(0) = "<keine Zuordnung>" + SPACE$ (55) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("maadrgru")
   IF LTRIM$ (magruppe.maadrgru) <> "" THEN 
     Sparten$(a%) = magruppe.maadrgru
     a% = a% + 1
   END IF 
   SELECT NEXT 
   
 WEND 
 CREATE DIALOG "MASUCH",0,0,190,264,"Vermittlergruppen","MS Sans Serif",8
 ADD DIALOG "MASUCH",4,0,0,190,237,0,""
 ADD DIALOG "MASUCH",9,9,11,21,21,2
 ADD DIALOG "MASUCH",5,37,11,151,9,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
 ADD DIALOG "MASUCH",7,7,27,175,205,2,2,Sparten$,Auswahl$,prompt$
 ADD DIALOG "MASUCH",1,40,245,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,97,245,55,15,0,"&Abbrechen",0,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 IF req% = 1 THEN 
   GetCodeMAGR$ = Auswahl$(0)
 ELSE 
   GetCodeMAGR$ = ""
 END IF 
 
 FILE cfile$
 END FUNCTION 
  
FUNCTION GetCodeGEGR$(prompt$)
 GetCodeGEGR$ = ""
 DIM Sparten$( RECCOUNT ("gegrup") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 
 FILE "gegrup"
 INDEX keyword.gegrup
 SELECT FIRST 
 REM Sparten$(0) = "<keine Zuordnung>" + SPACE$ (55) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("gegrup")
   IF LTRIM$ (keyword.gegrup) <> "" THEN 
     Sparten$(a%) = keyword.gegrup
     a% = a% + 1
   END IF 
   SELECT NEXT 
   
 WEND 
 CREATE DIALOG "MASUCH",0,0,190,264,"Gesellschaftsgruppen","MS Sans Serif",8
 ADD DIALOG "MASUCH",4,0,0,190,237,0,""
 ADD DIALOG "MASUCH",9,9,11,21,21,2
 ADD DIALOG "MASUCH",5,37,11,151,9,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
 ADD DIALOG "MASUCH",7,7,27,175,205,2,2,Sparten$,Auswahl$,prompt$
 ADD DIALOG "MASUCH",1,40,245,55,15,1,"&OK",1,1
 ADD DIALOG "MASUCH",1,97,245,55,15,0,"&Abbrechen",0,0
 MOUSE ON 
 DIALOG "MASUCH",req%
 REMOVE DIALOG "MASUCH"
 IF req% = 1 THEN 
   GetCodeGEGR$ = Auswahl$(0)
 ELSE 
   GetCodeGEGR$ = ""
 END IF 
 
 FILE cfile$
 END FUNCTION 
  
 
 ' SPARTEN lîschen
 ' =======================================================================
 
SUB SPGRLoeschen()
 IF disabled%("SPARTENLOESCHEN") THEN END SUB 
 MOUSE OFF 
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"gekondm" + _fpw$)
 FILE "spgruppe"
 codeGRsp% = codegrsp.spgruppe
 Dateien$ = ""
 ok% = 1
 
 IF EXISTS (codegrsp%,Codegrsp.sparten) THEN 
   ok% = 0
   Dateien$ = Dateien$ + ", Sparten"
 END IF 
 MOUSE ON 
 IF ok% = 0 THEN 
   Dateien$ = RIGHT$ (Dateien$, LEN (Dateien$) - 2)
   CALL Fehler("Lîschen nicht mîglich!","Es existieren VerknÅpfungen zu den Dateien: " + Dateien$ + ".")
   SET STATUS "Datensatz konnte nicht gelîscht werden"
 ELSE 
   MOUSE OFF 
   REQUEST "Wollen Sie die Spartengruppe " + CHR$ (34) + gruppe.spgruppe + CHR$ (34) + " wirklich lîschen?","",135,req%
   IF req% = 1 THEN 
     SELECT KEY codegrsp% LOCK FILE "spgruppe" INDEX Codegrsp.spgruppe
     SELECT REMOVE FILE "spgruppe"
     SET STATUS "Datensatz wurde gelîscht"
   END IF 
 END IF 
 _codegrsp% = codegrsp.spgruppe
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
 
 
 
 '      *************************************
 '      ** Routinen fÅr Formular "SPARTEN" **
 '      *************************************
 
SUB CODEVA()
 IF disabled%("SPARTEN") THEN END SUB 
 CALL DFile(3,"Kgeadr" + _fpw$)
 CALL DFile(3,"FONDS" + _fpw$)
 CALL DFile(3,"TARIF" + _fpw$)
 CALL DFile(3,"VPRODUKT" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"statukey" + _fpw$)
 IF RECCOUNT ("sparten") = 0 THEN 
   BLANK FILE "sparten"
   SET STATUS "Datensatz neu angelegt..."
   codeva% = SER ("sparten",1)
   codeva.sparten = codeva%
   sparte.sparten = "NEU"
   formular.sparten = "VERTR000"
   Vertragsart.sparten = "VERTR000"
   codegrsp.sparten = 0
   Workstation.sparten = Workstation%
   QWoNo.sparten = STR$ (Workstation%,"000000") + STR$ (codeva.sparten,"000000")
   RecStatus.sparten = "c"
   STORE FILE "sparten"
 END IF 
 IF NOT EXISTS ("<ohne Zuordnung>",Sparte.sparten) THEN 
   BLANK FILE "sparten"
   codeva.sparten = 0
   sparte.sparten = "<ohne Zuordnung>"
   codegrsp.sparten = 0
   Workstation.sparten = 0
   QWoNo.sparten = STR$ (Workstation.sparten,"000000") + STR$ (codeva.sparten,"000000")
   STORE FILE "sparten"
   UNLOCK CURRENT FILE "sparten"
   UNLOCK FILE "sparten"
 END IF 
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "SPARTEN" THEN 
     SET HEADING title$ + " - Sparten"
     REM OPEN FORM "SPARTEN"
       IF EXISTS (GPrjForm$ + "SPARTEN.sbv") THEN 
         OPEN FORM GPrjForm$ + "SPARTEN"
       ELSE 
         OPEN FORM GPrjForm$ + "SPARTEN"
       END IF 
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\sparten.pdf"
     FILE "sparten"
     CALL MNCODEVA()
     SET STATUS "Sparten/Vertragsarten"
     MENU ON 
     INDEX sparte.sparten
     IF codevaProbe% = 0 THEN 
       SELECT FIRST 
     ELSE 
       SELECT FIRST FILE "sparten" INDEX codeva.sparten
       SELECT KEY codevaProbe% FILE "sparten" INDEX codeva.sparten
       cuva% = codevaProbe%
       codevaProbe% = 0
     END IF 
   END IF 
   IF cuva% <> 0 THEN 
     CALL SpartenIntro()
   END IF 
   FORM 
   MOUSE ON 
   f.abbruch.enabled = 0
   f.abbruch.visible = 0
   f.suchen.enabled = - 1
   f.suchen.visible = - 1
   CALL ClearKBDBuffer()
   IF formular.sparten = "VERTR022" OR formular.sparten = "VERTR023" AND LPZ$ = "TRUE" THEN 
     f.tmplimp.visible = - 1
     f.tmplimp.enabled = - 1
   ELSE 
     f.tmplimp.visible = 0
     f.tmplimp.enabled = 0
   END IF 
   IF ag$ = "j" THEN 
     f.neu.enabled = 0
     f.neu.visible = 0
     f.bearb.enabled = 0
     f.bearb.visible = 0
     f.sichern.enabled = 0
     f.sichern.visible = 0
     f.tmplimp.visible = 0
     f.tmplimp.enabled = 0
     REM f.formelenabled = 0
     REM f.formel.visible = 0
   END IF 
   IF GAFSK$ = "TRUE" OR Geurofin% = - 1 THEN 
     f.afskimp.enabled = - 1
     f.afskimp.visible = - 1
     IF Geurofin% = - 1 THEN 
       afskimp$ = "Import Eurofinanz"
     END IF 
     IF GAFSK$ = "TRUE" THEN 
       f.afskimp1.enabled = - 1
       f.afskimp1.visible = - 1
       f.afskimp2.enabled = - 1
       f.afskimp2.visible = - 1
     END IF 
   ELSE 
     f.afskimp.enabled = 0
     f.afskimp.visible = 0
     f.afskimp1.enabled = 0
     f.afskimp1.visible = 0
     f.afskimp2.enabled = 0
     f.afskimp2.visible = 0
   END IF 
   
   IF iim.stamm LIKE "j" THEN 
     f.xmlexp.enabled = - 1
     f.xmlexp.visible = - 1
   ELSE 
     f.xmlexp.enabled = 0
     f.xmlexp.visible = 0
   END IF 
   GButtonBez$ = "alle VertrÑge mit PROV = N"
   sq$ = " Schadensquote: " + LTRIM$ ( STR$ (Schadquote.Sparten,",9999.0000"))
   st$ = " Stornoquote: " + LTRIM$ ( STR$ (Stornoquote.Sparten,",9999.0000"))
   SET STATUS sq$ + st$
   IF Spartenart.sparten <> "" THEN 
     spartenart$ = Spartenart.sparten
   ELSE 
     spartenart$ = "<ohne Zuordnung>"
   END IF 
   IF MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") OR MNdisabled%("VERTRINHAUSSEE") THEN 
     f.inhaus.enabled = 0
   ELSE 
     f.inhaus.enabled = - 1
   END IF 
   IF inhaus.sparten = 1 THEN 
     f.gdv.enabled = 0
     f.gdv.visible = 0
     f.lgdvhaupt.visible = 0
     f.lgdvunter.visible = 0
     f.gdvhaupt.visible = 0
     f.gdvhaupt.enabled = 0
     f.gdvunter.visible = 0
     f.gdvunter.enabled = 0
     f.GDVStandardSpar.visible = 0
     f.GDVStandardSpar.enabled = 0
     f.lgdvakt.visible = 0
   ELSE 
     f.gdv.enabled = - 1
     f.gdv.visible = - 1
     f.lgdvhaupt.visible = - 1
     f.lgdvunter.visible = - 1
     f.gdvhaupt.visible = - 1
     f.gdvhaupt.enabled = - 1
     f.gdvunter.visible = - 1
     f.gdvunter.enabled = - 1
     f.GDVStandardSpar.visible = - 1
     f.GDVStandardSpar.enabled = - 1
     f.lgdvakt.visible = - 1
   END IF 
   IF EXISTS (codeva.sparten,codeva.kvertrag) OR Hauptsparte.sparten <> 0 OR Untersparte.sparten <> 0 OR GDVStandardSpar.sparten = 1 OR GDVImport.sparten LIKE "j" THEN 
     REM OR Untersparte.sparten <> 0 OR GDVStandardSpar.sparte = 1 OR GDVImport.sparten LIKE "j"
     f.inhaus.enabled = 0
   ELSE 
     f.inhaus.enabled = - 1
   END IF 
   FORM 
   IF SPARTEsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU FOR 600
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     REM CALL PSelectPrevVA()
     SPARTEsub% = 103
   CASE CrsRight%,PgDn%
     REM CALL PSelectNextVA()
     SPARTEsub% = 102
   END SELECT 
   IF k$ = CHR$ (27) THEN 
     IF PAGE = 1 THEN _formend% = 1
     IF PAGE > 1 THEN FORM 1
   END IF 
   SELECT CASE SPARTEsub%
   CASE 1
     IF NOT OPEN ("kvertrag") THEN CALL DFile(3,"kvertrag" + _fpw$)
     IF EXISTS (codeva.sparten,codeva.kvertrag) THEN 
       CALL LIST8()
     ELSE 
       CALL Fehler("Es kann leider keine VertragsÅbersicht angezeigt werden, da fÅr diese Sparte keine VertrÑge existieren!","")
     END IF 
     SPARTEsub% = 0
   CASE 2
     datei$ = "sparten":CALL PSelectPrev():cuva% = CodeVA.sparten
     SPARTEsub% = 0
   CASE 3
     datei$ = "sparten":CALL PSelectNext():cuva% = CodeVA.sparten
     SPARTEsub% = 0
   CASE 4
     IF disabled%("FONDIMPORT") THEN 
     ELSE 
       IF disabled%("TEMPLTIMPORT") THEN 
       ELSE 
         REM * Templeton Import - Programm laden"
         ON ERROR GOTO weit260200ab
         IF NOT PROGRAMFILE ("TEMPLETO") THEN LOAD _netpath$ + "TEMPLETO.SBR", NEW 
         GOTO weit2602002ab
weit260200ab: 
         ON ERROR GOTO ErrorHandler
         CALL Fehler("Dateifehler","Die Datei TEMPLETO.SBR konnte nicht im Pfad " + _netpath$ + "gefunden werden.")
         GOTO weit2602001ab
weit2602002ab: 
         ON ERROR GOTO ErrorHandler
         REM * GDV - Form aufrufen * 
         test$ = DIRECTORY 
         CALL TempletonImp()
         DIRECTORY test$
weit2602001ab: 
         ON ERROR GOTO ErrorHandler
       END IF 
     END IF 
     SPARTEsub% = 0
   CASE 5
     REM AFSK Import
     IF disabled%("FONDIMPORT") THEN 
     ELSE 
       IF GAFSK$ LIKE "TRUE" THEN 
         REM * Templeton Import - Programm laden"
         ON ERROR GOTO weit260200ab1
         DIRECTORY _netpath$
         REM IF PROGRAMFILE ("AFSFOPSP") THEN CLOSE PROGRAMFILE "AFSFOPSP"
         REM IF PROGRAMFILE ("AFSPFLEG") THEN CLOSE PROGRAMFILE "AFSPFLEG"
         IF NOT PROGRAMFILE ("AFSFOIMP") THEN LOAD _netpath$ + "AFSFOIMP.SBR", NEW 
         GOTO weit2602002ab2
weit260200ab1: 
         ON ERROR GOTO ErrorHandler
         CALL Fehler("Dateifehler","Die Datei AFSFOIMP.SBR konnte nicht im Pfad " + _netpath$ + "gefunden werden.")
         GOTO weit2602001ab3
weit2602002ab2: 
         ON ERROR GOTO ErrorHandler
         REM * AFSKFoImp - Form aufrufen * 
         test$ = DIRECTORY 
         CALL AFSKFoImp()
         DIRECTORY test$
weit2602001ab3: 
         ON ERROR GOTO ErrorHandler
       ELSE 
         IF Geurofin% = - 1 THEN 
           ON ERROR GOTO weit130404ab1
           IF NOT PROGRAMFILE ("EUROFIMP") THEN LOAD _netpath$ + "EUROFIMP.SBR", NEW 
           GOTO weit1304042ab2
weit130404ab1: 
           ON ERROR GOTO ErrorHandler
           CALL Fehler("Dateifehler","Die Datei EUROFIMP.SBR konnte nicht im Pfad " + _netpath$ + "gefunden werden.")
           GOTO weit1304041ab3
weit1304042ab2: 
           ON ERROR GOTO ErrorHandler
           REM * AFSKFoImp - Form aufrufen * 
           test$ = DIRECTORY 
           CALL EUROFIMP()
           DIRECTORY test$
weit1304041ab3: 
           ON ERROR GOTO ErrorHandler 
         END IF 
     END IF 
     SPARTEsub% = 0
   CASE 6
     REM Statistik
     IF disabled%("SPARTENSTATISTIK") THEN 
     ELSE 
       FORM 2
     END IF 
     SPARTEsub% = 0
   CASE 7
     REM Spartenart auswÑhlen
     CALL AutoSpartS(codeva.sparten)
     SPARTEsub% = 0
   CASE 8
     REM Import AFSK-PSP
     IF disabled%("FONDIMPORT") THEN 
     ELSE 
         ON ERROR GOTO weit300305ab1
         DIRECTORY _netpath$
         IF PROGRAMFILE ("AFSFOIMP") THEN CLOSE PROGRAMFILE "AFSFOIMP"
         IF PROGRAMFILE ("AFSPFLEG") THEN CLOSE PROGRAMFILE "AFSPFLEG"
weit300305ab1: 
         ON ERROR GOTO ErrorHandler
         DIRECTORY _netpath$
         IF NOT PROGRAMFILE ("AFSFOPSP") THEN LOAD "AFSFOPSP.SBR", NEW 
         GOTO weit300305ab2
  
         ON ERROR GOTO ErrorHandler
         CALL Fehler("Dateifehler","Die Datei AFSFOPSP.SBR konnte nicht im Pfad " + _netpath$ + "gefunden werden.")
         GOTO weit300305ab3
weit300305ab2: 
         ON ERROR GOTO ErrorHandler
         REM * AFSKFoImp - Form aufrufen * 
         test$ = DIRECTORY 
         CALL AFSKFoPSP()
         DIRECTORY test$
weit300305ab3: 
         ON ERROR GOTO ErrorHandler
      END IF 

         SPARTEsub% = 0
 

   CASE 9
     REM Import AFSK-Pflege
     IF disabled%("FONDIMPORT") THEN 
     ELSE 
         ON ERROR GOTO weit030805ab1
         DIRECTORY _netpath$
         IF PROGRAMFILE ("AFSFOIMP") THEN CLOSE PROGRAMFILE "AFSFOIMP"
         IF PROGRAMFILE ("AFSFOPSP") THEN CLOSE PROGRAMFILE "AFSFOPSP"
weit030805ab1: 
         ON ERROR GOTO ErrorHandler
         DIRECTORY _netpath$
         IF NOT PROGRAMFILE ("AFSPFLEG") THEN LOAD "AFSPFLEG.SBR", NEW 
         GOTO weit030805ab2
         ON ERROR GOTO ErrorHandler
         CALL Fehler("Dateifehler","Die Datei AFSPFLEG.SBR konnte nicht im Pfad " + _netpath$ + "gefunden werden.")
         GOTO weit030805ab3
weit030805ab2: 
         ON ERROR GOTO ErrorHandler
         REM * AFSKFoImp - Form aufrufen * 
         test$ = DIRECTORY 
         CALL AFSPFLEG()
         DIRECTORY test$
weit030805ab3: 
         ON ERROR GOTO ErrorHandler
     END IF 
         SPARTEsub% = 0
   CASE 99
    IF codeva.sparten = 0 THEN 
      CALL Fehler("Die Sparte <ohne Zuordnung> darf nicht bearbeitet werden, um eine neue Sparte anzulegen drÅcken Sie bitte auf den Button NEU !","")
      GOTO e091120051
    END IF 
    IF NOT disabled%("SPARTENEDIT") THEN 
     MENU OFF 
     REDIM vprodukt$( RECCOUNT ("VPRODUKT") + 5)
     vprodukt$( RECCOUNT ("VPRODUKT") + 5) = ""
     IF RECCOUNT ("sparten") = 0 THEN CALL CODEVANeu()
     _codegrspold% = codegrsp.sparten
     _spartold$ = Sparte.sparten
     CALL ButDesabled()
     f.vertragsuebersicht.enabled = 0
     f.probe.enabled = 0
     f.tmplimp.visible = 0
     f.tmplimp.enabled = 0
     f.afskimp.enabled = 0
     f.afskimp1.enabled = 0
     f.afskimp2.enabled = 0
     f.xmlexp.enabled = 0
     ENTER sparte.sparten,0
     f.vertragsuebersicht.enabled = - 1
     f.probe.enabled = - 1
     CALL ButEnabled()
     IF GAFSK$ = "TRUE" THEN 
       f.afskimp.enabled = - 1
       f.afskimp.visible = - 1
       f.afskimp1.enabled = - 1
       f.afskimp1.visible = - 1
       f.afskimp2.enabled = - 1
       f.afskimp2.visible = - 1
     ELSE 
       f.afskimp.enabled = 0
       f.afskimp.visible = 0
       f.afskimp1.enabled = 0
       f.afskimp1.visible = 0
       f.afskimp2.enabled = 0
       f.afskimp2.visible = 0
     END IF 
     IF iim.stamm LIKE "j" THEN 
       f.xmlexp.enabled = - 1
       f.xmlexp.visible = - 1
     ELSE 
       f.xmlexp.enabled = 0
       f.xmlexp.visible = 0
     END IF 
    END IF 
e091120051: 
    SPARTEsub% = 0
   CASE 100
     codeva% = codeva.sparten
     CALL KVProbe()
     SELECT FORM KEY codeva% FILE "Sparten" INDEX codeva.sparten
     FORM 
     SPARTEsub% = 0
   CASE 101
     CALL CODEVASuchen()
     SPARTEsub% = 0
   CASE 102
     CALL PSelectNextVA()
     SPARTEsub% = 0
   CASE 103
     CALL PSelectPrevVA()
     SPARTEsub% = 0
   CASE 104
     IF NOT disabled%("SPARTENNEW") THEN 
      REDIM vprodukt$( RECCOUNT ("VPRODUKT") + 5)
       vprodukt$( RECCOUNT ("VPRODUKT") + 5) = ""
       CALL CODEVANeu()
       SPARTEsub% = 99
     ELSE 
       SPARTEsub% = 0
     END IF 
   CASE 105
     REM Druck Spartenliste
     codeva% = codeva.sparten
     CALL LSPART()
     SELECT FIRST FILE "Sparten" INDEX codeva.sparten
     SELECT KEY codeva% FILE "Sparten" INDEX codeva.sparten
     SPARTEsub% = 0
   CASE 106
     REM Sparte suchen und zum Vertrag springen
     codeva% = codeva.sparten
     CALL UnisuKv(codeva%,"codeva")
     SELECT FIRST FILE "Sparten" INDEX codeva.sparten
     SELECT KEY codeva% FILE "Sparten" INDEX codeva.sparten
     SPARTEsub% = 0
   END SELECT 
   MENU ON 

   REM CALL BMCheckMail()
 WEND 
 IF sparte.sparten <> "" THEN IF NEW ("SPARTEN") OR MOD ("SPARTEN") THEN CALL FStore("SPARTEN")
 _codegrsp% = codegrsp.sparten
 IF GAFSK$ LIKE "TRUE" THEN 
   REM IF PROGRAMFILE ("AFSFOIMP") THEN CLOSE PROGRAMFILE "AFSFOIMP"
   REM IF PROGRAMFILE ("AFSFOPSP") THEN CLOSE PROGRAMFILE "AFSFOPSP"
   REM IF PROGRAMFILE ("AFSPFLEG") THEN CLOSE PROGRAMFILE "AFSPFLEG"
 END IF 
 _formend% = 0
 END SUB 
 
SUB LSPART()
 CALL PRep("LSPART")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY ON 
 SET QUERY LOCK OFF 
 ueberschr$ = "Spartenliste"
 ON ERROR GOTO endlisp090920033
 SELECT ;
     ORDER REPORT Sparte.SPARTEN
     WHERE sparte.sparten <> "<ohne Zuordnung>" AND CodeGrSp.SPARTEN = CodeGrSp.SPGRUPPE
     TO ASK 
 END SELECT 
endlisp090920033: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 



SUB SpartenIntro()
 IF RECCOUNT ("sparten") > 0 THEN 
   SELECT KEY cuva% LOCK FILE "sparten" INDEX codeva.sparten
 ELSE 
   BLANK FILE "sparten"
   SET STATUS "Datensatz neu angelegt..."
   codeva% = SER ("sparten",1)
   codeva.sparten = codeva%
   sparte.sparten = "NEU"
   formular.sparten = "VERTR000"
   Vertragsart.sparten = "VERTR000"
   codegrsp.sparten = 0
   Workstation.sparten = Workstation%
   QWoNo.sparten = STR$ (Workstation%,"000000") + STR$ (codeva.sparten,"000000")
   RecStatus.sparten = "c"
   STORE FILE "sparten"
 END IF 
 FORM 
 END SUB 
 
 
 ' SPARTEN Neu
 ' =======================================================================
 
SUB CODEVANeu()
 FILE "sparten"
 IF Sparte.sparten <> "" THEN IF NEW ("sparten") OR MOD ("sparten") THEN CALL FStore("sparten")
 IF MNdisabled%("VERTRINHAUSEDIT") OR MNdisabled%("VERTRINHAUSNEW") OR MNdisabled%("VERTRINHAUSSEE") THEN 
   inhaus% = 0
 ELSE 
   REQUEST "Mîchten Sie eine Inhouse-Sparte erfassen?","",135,inhaus%
 END IF 
 BLANK FILE "sparten"
 SET STATUS "Datensatz neu angelegt..."
 codeva% = SER ("sparten",1)
 inhaus.sparten = inhaus%
 codeva.sparten = codeva%
 sparte.sparten = "NEU"
 formular.sparten = "VERTR000"
 Vertragsart.sparten = "VERTR000"
 codegrsp.sparten = 0
   Workstation.sparten = Workstation%
   QWoNo.sparten = STR$ (Workstation%,"000000") + STR$ (codeva.sparten,"000000")
   RecStatus.sparten = "c"
 STORE FILE "sparten"
 SELECT FORM KEY codeva% FILE "sparten" INDEX codeva.sparten
 FORM 
 cuva% = codeva%
 SELECT KEY codeva% LOCK FILE "sparten" INDEX codeva.sparten
 SPARTEsub% = 99
 END SUB 
 
 
 ' SPARTEN Suchen
 ' =======================================================================
 
SUB CODEVASuchen()
 IF GNeuSuGeadr$ = "j" THEN GCodieRuf1% = 0
 SET QUERY ON 
 SET INDEX ALL 
 cuva% = codeva.sparten
 IF MOD ("SPARTEN") OR NEW ("SPARTEN") THEN CALL FStore("SPARTEN")
 rep% = GetCodeVA%(cuva%)
 IF GNeuSuGeadr$ = "j" THEN GCODieRuf% = - 1
 IF rep% <> 0 THEN cuva% = rep%
 SELECT FIRST FILE "sparten" INDEX codeva.sparten
 SELECT KEY cuva% FILE "sparten" INDEX codeva.sparten
 SET INDEX ALL 
 REM SET INDEX sparte.sparten
 FORM 
 END SUB 
 
 
 ' SPARTEN lîschen
 ' =======================================================================
 
SUB CODEVALoeschen()
 IF disabled%("SPARTENLOESCHEN") THEN END SUB 
 MOUSE OFF 
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"gekondm" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"vpgekond" + _fpw$)
 cuva% = CodeVA.SPARTEN
 Dateien$ = ""
 ok% = 1
 IF EXISTS (cuva%,CodeVA.KVERTRAG) THEN 
   ok% = 0
   Dateien$ = Dateien$ + ", VertrÑge"
 END IF 
 MOUSE ON 
 IF ok% = 0 THEN 
   Dateien$ = RIGHT$ (Dateien$, LEN (Dateien$) - 2)
   CALL Fehler("Lîschen nicht mîglich!","Es existieren VerknÅpfungen zu den Dateien: " + Dateien$ + ".")
   SET STATUS "Datensatz konnte nicht gelîscht werden"
 ELSE 
   MOUSE OFF 
   CALL Fehler("Es werden jetzt die Sparte " + sparte.SPARTEN + ", die zugehîrigen Produkte und die zugehîrigen Konditionen  gelîscht!","")
   REQUEST "Wollen Sie die Sparte " + CHR$ (34) + LEFT$ (sparte.SPARTEN,15) + CHR$ (34) + " wirklich lîschen?","",135,req%
   IF req% = 1 THEN 
     MOUSE OFF 
     SELECT KEY cuva% LOCK FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT REMOVE FILE "SPARTEN"
     FILE "vprodukt"
     INDEX codeva.vprodukt
     SELECT FIRST FILE "vprodukt" INDEX codeva.vprodukt
     SELECT KEY cuva% FILE "vprodukt" INDEX codeva.vprodukt
     DIM loeVP%( RECCOUNT ("vprodukt"))
     a% = 0
     WHILE NOT EOF ("vprodukt") AND codeva.vprodukt = cuva%
       IF codeva.vprodukt = cuva% THEN 
         loeVP%(a%) = codevp.vprodukt
         a% = a% + 1
       END IF 
       SELECT NEXT FILE "vprodukt"
     WEND 
     IF a% > 0 THEN 
       FOR i% = 0 TO a% - 1
         codevp% = loeVP%(i%)
         REMOVE FROM FILE "vpgekond" WHERE codevp.vpgekond = codevp%
         IF EXISTS (codevp%,codevp.gekond) THEN 
           REMOVE FROM FILE "gekond" WHERE codevp.gekond = codevp%
           REQUEST "Konditionen wurden in der Konditionsdatei gelîscht!"
         END IF 
         IF EXISTS (codevp%,codevp.gekondm) THEN 
           REMOVE FROM FILE "gekondm" WHERE codevp.gekondm = codevp%
           REQUEST "Konditionen wurden in der Muster-Konditionsdatei gelîscht!"
         END IF 
       NEXT i%
     END IF 
     REMOVE FROM FILE "vprodukt" WHERE codeva.vprodukt = cuva%
     cuva% = 0
     MOUSE ON 
     CALL Fehler("Daten wurde gelîscht","")
     SET STATUS "Datensatz wurde gelîscht"
   END IF 
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
FUNCTION GetCodeVA%(prompt%)
 IF NOT OPEN ("SPGRUPPE") THEN CALL DFile(3,"SPGRUPPE" + _fpw$)
 DIM Sparten$( RECCOUNT ("SPARTEN") + 1)
 DIM Auswahl$(1)
 cfile$ = FILE 
 _pos% = CodeVA.SPARTEN
 alle$ = "n"
 inhouse% = 0
w120920091: 
 FILE "SPARTEN"
 INDEX Sparte.SPARTEN
 SELECT FIRST 
 REM Sparten$(0) = "<keine Zuordnung>" + SPACE$ (100) + "000000"
 a% = 0
 prompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("SPARTEN")
   sok% = - 1
   IF alle$ = "n" THEN 
     sok$ = NoAnzeige.sparten
     IF NoAnzeige.sparten LIKE "j" THEN sok% = 0
   END IF 
   IF inhouse% = 1 THEN 
     IF Inhaus.sparten <> 1 THEN sok% = 0
   END IF 
   IF sok% = - 1 THEN 
     Sparten$(a%) = Sparte.SPARTEN
     IF NoAnzeige.Sparten LIKE "j" THEN Sparten$(a%) = Sparten$(a%) + " ****,"
     REM + ",                [GDV-Hauptnr: " + STR$ (Hauptsparte.sparten,"000") + ",GDV-Unternr: " + STR$ (Untersparte.sparten,"000") + "]"
     IF inhaus.sparten = 1 THEN Sparten$(a%) = Sparten$(a%) + " ++++INHOUSE++++ "
     Sparten$(a%) = Sparten$(a%) + SPACE$ (250) + STR$ (CodeVA.SPARTEN,"000000")
     IF CodeVA.SPARTEN = prompt% THEN prompt$ = Sparten$(a%)
   
     IF GCODIE% = - 1 AND GNeuSuGeadr$ = "j" THEN 
       IF GCodieRuf1% = 0 THEN CALL SearchInitSp1("SPARTEN")

     END IF 
     IF GCODIE% = - 1 AND GNeuSuGeadr$ = "j" THEN CALL SearchVorbSp1("SPARTEN")
     a% = a% + 1
   END IF 
   SELECT NEXT FILE "SPARTEN" INDEX Sparte.SPARTEN
   
 WEND 
 IF GCODIE% = - 1 AND GNeuSuGeadr$ = "j" THEN 
   GetCodeVA% = 0
   c$ = "aa"
   REM CALL Fehler("","")
   req3% = CALL ("_SearchShow",c$)
   IF VAL (c$) <> 0 THEN 
     GetCodeVA% = VAL (c$)
   END IF 
 ELSE 
   CREATE DIALOG "MASUCH",0,0,390,364,"SpartenÅbersicht","MS Sans Serif",8
   ADD DIALOG "MASUCH",4,0,0,390,337,0,""
   ADD DIALOG "MASUCH",9,9,11,21,21,2
   ADD DIALOG "MASUCH",5,37,11,151,9,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
   ADD DIALOG "MASUCH",7,27,27,345,301,2,2,Sparten$,Auswahl$,prompt$
   ADD DIALOG "MASUCH",1,98,345,55,15,1,"&OK",1,1
   IF inhouse% <> 1 THEN ADD DIALOG "MASUCH",1,153,345,81,15,0,"Inhouse-Sparten",3,0
   IF alle$ <> "j" THEN ADD DIALOG "MASUCH",1,234,345,61,15,0,"Alle anzeigen",2,0
   ADD DIALOG "MASUCH",1,295,345,55,15,0,"&Abbrechen",0,0
   MOUSE ON 
   DIALOG "MASUCH",req%
   REMOVE DIALOG "MASUCH"
     IF req% = 3 THEN 
       REDIM Sparten$( RECCOUNT ("Sparten") + 1,1)
       REDIM Sparten$( RECCOUNT ("Sparten") + 1)
       alle$ = "n"
       inhouse% = 1
       GOTO w120920091
     END IF 
     IF req% = 2 THEN 
       REDIM Sparten$( RECCOUNT ("Sparten") + 1,1)
       REDIM Sparten$( RECCOUNT ("Sparten") + 1)
       alle$ = "j"
       inhouse% = 0
       GOTO w120920091
     END IF 


   IF req% = 1 THEN 
     GetCodeVA% = VAL ( RIGHT$ (Auswahl$(0),6))
   ELSE 
     GetCodeVA% = 0
   END IF 
   SELECT KEY _pos% FILE "SPARTEN" INDEX CodeVA.SPARTEN
 END IF 
 FILE cfile$
 END FUNCTION 
 
 
 
 
 
 
 ' Vertrag in Verprovisionierung aufnehmen
 ' ========================================================================
 
SUB PROVISION()
 IF disabled%("PROVISION") THEN END SUB 
 IF disabled%("VERTRBEARB") THEN END SUB 
 IF inhaus.kvertrag = 1 THEN 
   CALL Fehler("Inhouse - VertrÑge kînnen nicht an die Abrechnung Åbergeben werden!,"")
   END SUB 
 END IF 
 cfile$ = FILE 
 cuvt% = lfdnr.KVERTRAG
 DIM KVKond$(100)
 ok% = 2
 Haftvertrag% = SRHaftung.kvertrag
 IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
 IF ProviAb > 0 OR Fremdvertrag.KVERTRAG LIKE "j" OR Altvertrag.KVERTRAG LIKE "j" THEN 
   SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   IF CodeVStatus.kvertrag = 1 OR CodeVStatus.kvertrag = 2 THEN vstatus% = 0
   CALL VStat()
   
 ELSE 
   CALL DFile(3,"gekond" + _fpw$)
   CALL DFile(3,"vpgekond" + _fpw$)
   CALL DFile(3,"vkond" + _fpw$)
   ok% = 1
   IF Bewertungssumme.KVERTRAG <= 0 THEN 
     REM ok% = 0
     IF GSoll$ LIKE "j" AND GAFSK$ <> "TRUE" THEN 
       CALL Fehler("WARNUNG! Bitte prÅfen Sie die Bewertungssumme. Sie ist zur Zeit <= 0!","Der Vertrag kann zwar abgerechnet werden, aber eine Sollstellung ist nicht mîglich!")
     ELSE 
       CALL Fehler("WARNUNG!","Bitte prÅfen Sie die Bewertungssumme. Sie ist zur Zeit <= 0! Der Vertrag kann aber trotzdem abgerechnet werden!")
     END IF 
   END IF 
   REM 030697
   IF zw.kvertrag = 55 THEN 
     ok% = 0
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie erst die Zahlweise ein.")
   END IF 
 
   END IF 
   IF Beitrag.KVERTRAG = 0 THEN 
     CALL Fehler("WARNUNG Vertrag solte noch nicht verprovisioniert werden!","Bitte geben Sie den Beitrag > 0 ein.")
     REM ok% = 0
   END IF 
   IF CodeGE.KVERTRAG = 0 THEN 
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Gesellschaft aus.")
     ok% = 0
   END IF 
   IF CodeMA.KVERTRAG = 0 THEN 
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Agentur aus.")
     ok% = 0
   END IF 
   IF CodeVA.KVERTRAG = 0 THEN 
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Sparte aus.")
     ok% = 0
   END IF 
   IF DAYS (VS_Beginn.KVERTRAG) = 0 THEN 
     ok% = 0
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie den Vertragsbeginn an.")
   END IF 
   IF ok% = 1 THEN 
     REQUEST "Vertrag in monatliche Abrechnung Åbernehmen?","",130,erg%
     IF erg% = 1 THEN 
       REM 160996 ProviAb$ = DATE$ ( TODAY ,"dd.mm.yy")
       IF Gvueb$ = "TRUE" THEN 
         ProviAb$ = DATE$ (Antragsdatum.KVERTRAG,"0d.mm.yyyy")
       ELSE 
         ProviAb$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       END IF 
       ZahlungJN$ = "n"
wied101299001: 
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         CREATE DIALOG "SETPROVI",0,0,201,132,title$ + " Standard","MS Sans Serif",8
         ADD DIALOG "SETPROVI",4,0,0,201,109,0,""
         ADD DIALOG "SETPROVI",9,7,10,20,20,2
         ADD DIALOG "SETPROVI",5,30,11,162,26,0,"Bitte geben Sie an, ab wann der Vertrag innerhalb der monatlichen Provisionsberechnung berÅcksichtigt werden soll."
         ADD DIALOG "SETPROVI",6,90,40,52,12,0,0,ProviAb$,10
         ADD DIALOG "SETPROVI",5,30,42,56,8,0,"Berechnung ab:"
         ADD DIALOG "SETPROVI",5,30,64,160,24,0,"Sollen die Provisionen fÅr diesen Vertrag abhÑngig von den ZahlungseingÑngen der Gesellschaften ausgezahlt werden?"
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN ZahlungJN$ = "j"
         ADD DIALOG "SETPROVI",2,30,91,143,14,0,"ZahlungseingÑnge &prÅfen","j","n",ZahlungJN$
         ADD DIALOG "SETPROVI",1,40,113,55,15,1,"&OK",1,1
         ADD DIALOG "SETPROVI",1,100,113,55,15,0,"&Abbrechen",0,0
         DIALOG "SETPROVI",req%
         REMOVE DIALOG ALL 
       ELSE 
         CREATE DIALOG "SETPROVI",0,0,201,132,title$ + " RealCash","MS Sans Serif",8
         ADD DIALOG "SETPROVI",4,0,0,201,109,0,""
         ADD DIALOG "SETPROVI",9,7,10,20,20,2
         ADD DIALOG "SETPROVI",5,30,11,162,26,0,"Bitte geben Sie an, ab wann der Vertrag innerhalb der monatlichen Provisionsberechnung berÅcksichtigt werden soll."
         ADD DIALOG "SETPROVI",6,90,40,52,12,0,0,ProviAb$,10
         ADD DIALOG "SETPROVI",5,30,42,56,8,0,"Berechnung ab:"
         ADD DIALOG "SETPROVI",5,30,64,160,24,0,"Die Provisionen fÅr diesen Vertrag werden abhÑngig von den ZahlungseingÑngen der Gesellschaften berechnet!"
         IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN ZahlungJN$ = "j"
         REM ADD DIALOG "SETPROVI",2,30,91,143,14,0,"ZahlungseingÑnge &prÅfen","j","n",ZahlungJN$
         ADD DIALOG "SETPROVI",1,40,113,55,15,1,"&OK",1,1
         ADD DIALOG "SETPROVI",1,100,113,55,15,0,"&Abbrechen",0,0
         DIALOG "SETPROVI",req%
         REMOVE DIALOG ALL 
       END IF 
       IF req% = 1 THEN 
         bwbezug$ = ReadConfig$("PROVIS","Bewertungszeitraum")
         tt$ = LEFT$ (ProviAb$,2)
         tt% = VAL (tt$)
         IF tt% > 28 THEN 
           texttmp$ = "Dies wird bei VertrÑgen, die abrechnungstechnisch in dem Monat Februar vorkommen zu Problemen fÅhren, da der Februar teilweise nur 28 Tage hat. Bitte Ñndern Sie das Datum!"
           CALL Fehler("Sie wollen den Vertrag an die Provisionsabrecnung Åbergeben, allerdings haben Sie im Datum bei der Tagesangabe einen Wert grî·er 28 angegeben",texttmp$)
           GOTO wied101299001
         END IF 
         IF bwbezug$ LIKE "leer" OR bwbezug$ LIKE "Provisionierungsbeginn" THEN 
           BWStart$ = ProviAb$
         ELSE 
           BWStart$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         END IF 
         IF DateOK%(BWStart$) THEN 
           kond% = GetKond%(cuvt%, DAYS (BWStart$),0)
           IF kond% = 0 THEN 
             IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
             CALL Fehler(fehlnach$,"")
             SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
             ProviAb.kvertrag = 0
             CodeKO.KVERTRAG = 0
             REM kondition.KVERTRAG = SelKond%
             CALL FStore("KVERTRAG")
 
             REM ### ToDo: Fehlerliste anzeigen
           ELSE 
             doprov% = EditKond%(kond%,0)
             IF doprov% = 1 THEN 
               SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
               ProviAb.kvertrag = DAYS (ProviAb$)
               Check.KVERTRAG = ZahlungJN$
               CodeKO.KVERTRAG = kond%
               REM 22.08.2003
               REM CALL Fehler("22.08.2003","")
               IF GAFSK$ LIKE "TRUE" THEN 
                 REM CALL Fehler("22.08.2003","")
                 SELECT FIRST FILE "vkond" INDEX codevk.vkond
                 SELECT KEY kond% FILE "vkond" INDEX codevk.vkond
                 IF EXISTS (codeko.vkond,lfdnr.gekond) THEN 
                   SELECT FIRST FILE "GEKOND" INDEX lfdnr.gekond
                   SELECT KEY codeko.vkond FILE "GEKOND" INDEX lfdnr.gekond
                   IF AFSKPauschDat.kvertrag < 1 THEN 
                     AFSKPauschDat.kvertrag = 0
                   END IF 
                   IF AFSKPauschJN.gekond = "j" THEN 
                     AFSKPauschJN.kvertrag = "j"
                     IF AFSKPauschDat.kvertrag < 1 THEN 
                       QAFSKPAUMADAT.kvertrag = AFSKPauschJN.kvertrag + "00000000"
                       AFSKPAUsch.kvertrag = AFSKPAUsch.gekond
                     END IF 
                     IF AFSKPauschDat.kvertrag > 0 THEN 
                       QAFSKPAUMADAT.kvertrag = AFSKPauschJN.kvertrag + DATE$ (AFSKPauschDat.kvertrag,"yyyymm0d")
                     END IF 
                   ELSE 
                     AFSKPauschJN.kvertrag = "n"
                     QAFSKPAUMADAT.kvertrag = "n00000000"
                   END IF 
                 ELSE 
                   AFSKPauschJN.kvertrag = "n"
                   QAFSKPAUMADAT.kvertrag = "n00000000"
                 END IF 
               END IF 
               REM kondition.KVERTRAG = SelKond%
               REM 201299
               CodeVStatus.kvertrag = 1
               VStatusTxT.kvertrag = "lebend"
               IF ProviAb.kvertrag > 0 AND ProviAb.kvertrag <= TODAY THEN 
                 IF KÅndigung.kvertrag > 0 THEN 
                   IF KÅndigung.kvertrag >= TODAY THEN 
                     VertragAktiv.kvertrag = "j"
                   ELSE 
                       VertragAktiv.kvertrag = "n"
                   END IF 
                 ELSE 
                   VertragAktiv.kvertrag = "j"
                 END IF 
               ELSE 
                 VertragAktiv.kvertrag = "n"
               END IF 
               IF TatsKuenDat.kvertrag > 0 THEN 
                 IF TatsKuenDat.kvertrag >= TODAY THEN 
                   VertragAktiv.kvertrag = "j"
                 ELSE 
                   VertragAktiv.kvertrag = "n"
                 END IF 
               END IF 
               REQUEST "Vertrag wird ab sofort in die Provisionierung","mit einbezogen!",2
               REM CALL Fehler("Hier Pool einfÅgen","")
               IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" AND ZahlungJN$ LIKE "j" THEN 
                 IF EXISTS (lfdnr.kvertrag,codevt.zeingang) THEN 
                   SELECT FIRST FILE "zeingang" INDEX codevt.zeingang
                   SELECT KEY lfdnr.kvertrag FILE "zeingang" INDEX codevt.zeingang
                   pool% = 0
                   codevt% = lfdnr.kvertrag
                   WHILE NOT EOF ("zeingang") AND codevt.zeingang = codevt%
                     IF codevt.zeingang = codevt% THEN 
                       pool% = pool% + Betrageu.zeingang
                     ELSE 
                       GOTO w041020062
                     END IF 
                     SELECT NEXT FILE "zeingang" INDEX codevt.zeingang
                   WEND 
w041020062: 
                   pool$ = STR$ (pool%,"99999999.00")
                   pool.kvertrag = VAL (pool$)
                 END IF 
               END IF 
 
               CALL FStore("KVERTRAG")
               SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
               IF GAFSK$ = "TRUE" AND EXISTS (codevp.kvertrag,codevp.vpgekond) THEN 
                 SELECT KEY lfdnr.kvertrag LOCK FILE "KVFAEL" INDEX codevt.kvfael
                 codevt1% = lfdnr.kvertrag
                 fÑlligam.kvfael = ProviAB.kvertrag
                 IF erwProvAnz.kvfael = 0 THEN 
                   erwProvAnz.kvfael = 4
                 END IF 
                 IF VMProv.kvfael = 0 THEN 
                   IF EXISTS (codevp.kvertrag,codevp.vpgekond) THEN 
                     REM ************ Auswahl der VPKonditionen fÅr AFSK *******************************************
 
                   CALL Fehler("Sie erhalten jetzt die Mîglichkeit eine AFSK-Produktkondition auszuwÑhlen,","an Hand derer die AFSK-Sollstellung fÅr den Vertrag berechnet werden kann!")
                   REQUEST "Wollen Sie den Vertrag an die AFSK-Sollstellung Åbergeben ? ","",130,req1ab%
                   FILE "VPGEKOND"
                   INDEX codevp.VPGEKOND
                   SELECT FIRST 
                   SELECT KEY codevp.kvertrag FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   IF codew.kvertrag = 1 OR req1ab% <> 1 THEN 
                     IF codew.kvertrag = 1 THEN 
                       CALL Fehler("Der Vertrag kann nicht an die AFSK-Sollstellung Åbergeben werden, da er noch in der WÑhrung DM gefÅhrt wird!","")
                     END IF 
                     GOTO endprodi06032002
                   END IF 
                   a% = 0
                   gefunden% = 0
                   WHILE NOT EOF ("VPGEKOND") AND codevp.VPGEKOND = codevp.kvertrag
                     ok% = - 1
                     gefunden% = gefunden% + 1
                     IF bwvon.VPGEKOND > 0 THEN 
                       IF VS_Beginn.kvertrag < bwvon.VPGEKOND THEN 
                         ok% = 0
                       END IF 
                     END IF 
                     IF bwbis.VPGEKOND > 0 THEN 
                       IF VS_Beginn.kvertrag > bwbis.VPGEKOND THEN 
                         ok% = 0
                       END IF 
                     END IF 
                     IF ok% = 0 THEN 
                       fehl% = fehl% + 1
                       GOTO nextkond20060201
                     END IF 
                     IF ok% THEN 
                       KVKond$(a%) = "BWVon:" + DATE$ (bwvon.VPGEKOND,"0d.mm.yyyy") + " "
                       IF bwbis.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "BWBis:" + DATE$ (bwbis.VPGEKOND,"0d.mm.yyyy") + " "
                       END IF 
                       IF AFSPSPJN.vpgekond <> "j" THEN 
                         IF courtagejn.VPGEKOND = "j" AND CoAnzBeitr.VPGEKOND > 0 THEN 
                           KVKond$(a%) = KVKond$(a%) + "Courtage Anzahl BeitrÑge:" + LTRIM$ ( STR$ (CoAnzBeitr.VPGEKOND,"9999.00")) + " "
                         END IF 
                         KVKond$(a%) = KVKond$(a%) + SPACE$ (100) + STR$ (codekey.VPGEKOND,"000000")
                         IF bwstart% >= bwvon.vpgekond THEN 
                           IF bwbis.vpgekond > 0 THEN 
                             IF bwstart% <= bwbis.vpgekond THEN prompt$ = KVKond$(a%)
                           ELSE 
                             prompt$ = KVKond$(a%)
                           END IF 
                         END IF 
                       ELSE 
                         REM psp Kondition
                         KVKond$(a%) = KVKond$(a%) + "AFSProvSoll:" + LTRIM$ ( STR$ (AFSPSolBeitrSu.vpgekond,"999.0000")) + "+" + LTRIM$ ( STR$ (AFSPSollMB.vpgekond,"999.0000")) + " MB/"
                         KVKond$(a%) = KVKond$(a%) + "AFSTilg 100%:" + LTRIM$ ( STR$ (AFSTMB.vpgekond,"999.0000")) + " MB/ 50%: " + LTRIM$ ( STR$ (AFSTMBProz.vpgekond,"999.0000")) + "%/ "
             KVKond$(a%) = KVKond$(a%) + "VMProvSoll:" + LTRIM$ ( STR$ (AFSVBSumProz.vpgekond,"999.0000")) + " %/Vorab: " + LTRIM$ ( STR$ (AFSVProzRate.vpgekond,"999.0000")) + "%/danach: " + LTRIM$ ( STR$ (AFSVProBei.vpgekond,"999.0000")) + "%"
                         KVKond$(a%) = KVKond$(a%) + SPACE$ (100) + STR$ (codekey.VPGEKOND,"000000")
                       END IF 
                       a% = a% + 1
                     END IF 
nextkond20060201:                     
                     SELECT NEXT FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   WEND 
                   IF a% = 0 AND fehl% > 0 THEN 
                     req% = 0
                     text1$ = "es wurden insgesamt " + LTRIM$ ( STR$ ("gefunden")) + "Konditionen gefunden,davon enthÑlt keine Kondition in den Feldern BWVON und/oder BWBIS einen Eintrag der mit"
                     CALL Fehler(text1$,"dem Provisionierungsbeginn des Vertrages harmonisiert")
                   ELSE 
                     KVKond$(a%) = ""
                     prompt$ = KVKond$(0)
                     CREATE DIALOG "MASUCH",0,0,558,288,"Sollstellungskonditionen","MS Sans Serif",8
                     ADD DIALOG "MASUCH",4,0,0,558,263,0,""
                     ADD DIALOG "MASUCH",9,9,11,21,21,2
                     ADD DIALOG "MASUCH",5,37,11,151,10,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
                     ADD DIALOG "MASUCH",7,7,27,548,229,2,2,KVKond$,Auswahl$,prompt$
                     ADD DIALOG "MASUCH",1,200,268,55,15,1,"&OK",1,1
                     ADD DIALOG "MASUCH",1,260,268,55,15,0,"&Abbrechen",0,0
                     MOUSE ON 
                     DIALOG "MASUCH",req%
                     REMOVE DIALOG "MASUCH"
                   END IF 
                   codekey% = 0
                   IF req% = 1 THEN 
                     CodeKey% = VAL ( RIGHT$ (Auswahl$(0),6))
                   END IF 
 
                     REM *******************************************************************************************
                     SELECT FIRST FILE "vpgekond" INDEX CodeKey.vpgekond
                     SELECT KEY CodeKey% FILE "vpgekond" INDEX CodeKey.vpgekond
                     IF AFSPSPJN.vpgekond <> "j" THEN 
                       IF CoAnzBvB.vpgekond LIKE "j" THEN 
                         erwProvAnz.kvfael = CoAnzBeitr.vpgekond
                         VMProv.kvfael = CoAnzBeitr.vpgekond * Beitrag.kvertrag
                         VMProvEu.kvfael = VAL ( STR$ (VMProv.kvfael / umrechnung.kvertrag,"999999999.00"))
                       ELSE 
                         CoAnzBeitr% = CoAnzBeitr.vpgekond
                         erwProvAnz.kvfael = CoAnzBeitr.vpgekond
                         VMProv.kvfael = CoAnzBeitr.vpgekond * NettoBeitrag.kvertrag
                         VMProvEu.kvfael = VAL ( STR$ (VMProv.kvfael / umrechnung.kvertrag,"999999999.00"))
                       END IF 
                     ELSE 
                       IF CodeKey% <> 0 THEN 
                         IF NOT EXISTS (cuvt%,codevt.kvskond) THEN 
                           BLANK FILE "KVSKOND"
                           CodeKey1% = SER ("KVSKOND",1)
                           CodeKey.kvskond = CodeKey1%
                           Codevt.KVSKOND = lfdnr.kvertrag
                           CodeKO.KVSKOND = CodeKey%
                           erledigt.KVSKOND = "n"
                           test1% = TODAY - 60
                           jetztlos% = 0
                           AFSPSolBeitrSu.kvskond = AFSPSolBeitrSu.vpgekond
                           AFSPSollMB.kvskond = AFSPSollMB.vpgekond
                           AFSTMB.kvskond = AFSTMB.vpgekond
                           AFSTMBProz.kvskond = AFSTMBProz.vpgekond
                           AFSVBSumProz.kvskond = AFSVBSumProz.vpgekond
                           AFSVProzRate.kvskond = AFSVProzRate.vpgekond
                           AFSVProBei.kvskond = AFSVProBei.vpgekond
                           AFSPSPJN.kvskond = AFSPSPJN.vpgekond
                           STORE FILE "KVSKOND"
                         ELSE 
                           SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
                           SELECT KEY lfdnr.kvertrag LOCK FILE "kvskond" INDEX codevt.kvskond
                           CodeKO.KVSKOND = CodeKey%
                           erledigt.KVSKOND = "n"
                           test1% = TODAY - 60
                           jetztlos% = 0
                           AFSPSolBeitrSu.kvskond = AFSPSolBeitrSu.vpgekond
                           AFSPSollMB.kvskond = AFSPSollMB.vpgekond
                           AFSTMB.kvskond = AFSTMB.vpgekond
                           AFSTMBProz.kvskond = AFSTMBProz.vpgekond
                           AFSVBSumProz.kvskond = AFSVBSumProz.vpgekond
                           AFSVProzRate.kvskond = AFSVProzRate.vpgekond
                           AFSVProBei.kvskond = AFSVProBei.vpgekond
                           AFSPSPJN.kvskond = AFSPSPJN.vpgekond
                           STORE FILE "KVSKOND"
                         END IF 
                       END IF 
                     END IF 
                   END IF 
                 END IF 
                 STORE FILE "KVFAEL"
                 UNLOCK CURRENT FILE "KVFAEL"
                 SELECT KEY codevt1% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
                 IF AFSKPAUJN.vpgekond LIKE "j" AND GAFSK$ LIKE "TRUE" THEN 
                   AFSKPAUJN.kvertrag = "j"
                   AFSKPAUEUR.kvertrag = AFSKPAUEUR.vpgekond
                   REM QAFSKPAUDAT.kvertrag = "j" + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
                   IF AFSKPAUDAT.kvertrag < 1 THEN 
                     QAFSKPAUDAT.kvertrag = AFSKPAUJN.kvertrag + "00000000"
                   ELSE 
                     QAFSKPAUDAT.kvertrag = AFSKPAUJN.kvertrag + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
                   END IF 
                   STORE FILE "KVERTRAG"
                   UNLOCK CURRENT FILE "KVERTRAG"
                 ELSE 
                   REM CALL Fehler("eventuell Erzeugung PSP, wenn Vertrag in AFSPSP existiert","")
                   IF EXISTS (lfdnr.kvertrag,codevt.AFSPSP) THEN 
                     dir$ = DIRECTORY 
                     ddat$ = FILE 
                     ddind$ = INDEX 
                     codevt% = lfdnr.kvertrag
                     REM CALL Fehler("Es existieren DatensÑtze in afspsp, d.h. die mu· man jetzt der Reihe nach auswerten und die PSP erzeugen und daraus den ZE","15092005")
                     ON ERROR GOTO ErrorHandler
                     REM erzeugen einer temporÑren AFSPSP - Datei
                     IF EXISTS (GMACodeDir$ + "AFSPSPTM.SBF") THEN 
                       DELETE GMACodeDir$ + "AFSPSPTM.*"
                     END IF 
                     COPY _netpath$ + "PROVIS\AFSPSPTM.*" TO GMACodeDir$
                     IF EXISTS (GMACodeDir$ + "AFSPSPTM.SB!") THEN 
                        DELETE GMACodeDir$ + "AFSPSPTM.SB!"
                     END IF 
                     OPEN FILE GMACodeDir$ + "AFSPSPTM;paris"


                     ON ERROR GOTO weit150905ab1
                     DIRECTORY _netpath$
                     IF PROGRAMFILE ("AFSFOIMP") THEN CLOSE PROGRAMFILE "AFSFOIMP"
                     IF PROGRAMFILE ("AFSPFLEG") THEN CLOSE PROGRAMFILE "AFSPFLEG"
weit150905ab1: 
                     ON ERROR GOTO ErrorHandler
                     DIRECTORY _netpath$
                     IF NOT PROGRAMFILE ("AFSFOPSP") THEN LOAD "AFSFOPSP.SBR", NEW 
                     GOTO weit150905ab2
  
                     ON ERROR GOTO ErrorHandler
                     CALL Fehler("Dateifehler","Die Datei AFSFOPSP.SBR konnte nicht im Pfad " + _netpath$ + "gefunden werden.")
weit150905ab2: 
                     ON ERROR GOTO ErrorHandler
                     FILE "AFSPSP"
                     INDEX codevt.afspsp
                     SELECT FIRST 
                     SELECT KEY codevt% LOCK FILE "afspsp" INDEX codevt.afspsp
                     ok% = 1
                     MOUSE OFF 
                     codesutold% = 0
                     WHILE ok% = 1
                       IF codevt.afspsp = codevt% AND codesut.afspsp <> codesutold% THEN 
                         codesutold% = codesut.afspsp

                         BLANK FILE "afspsptm"
                         a% = CopyRecord%("afspsp","afspsptm")
                         codeaz.afspsptm = 0
                         STORE FILE "afspsptm"
                       ELSE 
                         ok% = 0
                       END IF 
                       SELECT NEXT LOCK FILE "afspsp" INDEX codevt.afspsp
                     WEND 
                     FILE "AFSPSP"
                     INDEX codesut.afspsp
                     FILE "AFSPSPTM"
                     INDEX codesut.afspsptm
                     SELECT FIRST LOCK FILE "AFSPSPTM" INDEX codesut.afspsptm
                     ok% = 1
                     REM CALL Fehler("Jetzt wurden die Vertrags-PSP nach afspsptm kopiert","Jetzt soll berechnet werden!!?  VerarbIPSP(codeimp%,dateia$)")
                     MOUSE OFF 
                     dateia$ = "afspsptm"
                     WHILE ok% = 1
                       codesut1% = codesut.afspsptm
                       SELECT KEY codesut1% LOCK FILE "AFSPSP" INDEX codesut.afspsp
                       REM CALL Fehler(VS_NR.dateia$, STR$ (status_.dateia$,"00"))
                       CALL VerarbIPSP(codeimp%,dateia$)
                       FILE "afspsptm"
                       INDEX codesut.afspsptm
                       SELECT FIRST FILE "afspsptm" INDEX codesut.afspsptm
                       SELECT KEY codesut1% FILE "afspsptm" INDEX codesut.afspsptm
                       ON ERROR GOTO ErrorHandler
                       IF EOF ("afspsptm") THEN 
                         ok% = 0
                       ELSE 
                         SELECT NEXT LOCK FILE "afspsptm" INDEX codesut.afspsptm
                         IF EOF ("afspsptm") THEN ok% = 0
                       END IF 
                     WEND 
                     MOUSE ON 
                     DIRECTORY dir$
                     FILE ddat$
                     INDEX ddind$$
                     CLOSE FILE "afspsptm"
                   END IF 
                 END IF 
               ELSE 
                 SELECT KEY cuvt% LOCK FILE "KVFAEL" INDEX codevt.kvfael
                 erledigt.kvfael = "j"
                 STORE FILE "KVFAEL"
                 UNLOCK CURRENT FILE "KVFAEL"
                 SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
                 IF GAFSK$ LIKE "TRUE" THEN 
                   AFSKPAUJN.kvertrag = "n"
                   AFSKPAUEUR.kvertrag = 0
                   AFSKPAUDAT.kvertrag = 0
                   QAFSKPAUDAT.kvertrag = "n" + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
                 END IF 
                 STORE FILE "KVERTRAG"
                 UNLOCK CURRENT FILE "KVERTRAG"
               END IF 
 
               REM *******************************************************************************************
               REM *   Einbeziehung der Produktkonditionen                                                   *
               REM *******************************************************************************************
               IF PrvVerfahr$ = "ZAHLUNGSEINGANG" AND GSoll$ LIKE "j" AND GAFSK$ <> "TRUE" THEN 
                 cfile$ = FILE 
                 alfdnr% = lfdnr.kvertrag
                 acodevp% = codevp.kvertrag
                 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
                 IF EXISTS (codevp.kvertrag,codevp.VPGEKOND) THEN 
                   zwtext$ = "an Hand derer die Sollstellung fÅr den Vertrag berechnet werden kann! BEACHTEN SIE, DASS VERTRéGE IN DER WéHRUNG DM NICHT IN DIE SOLLSTELLUNG öBERNOMMEN WERDEN KôNNEN!"
                   CALL Fehler("Sie erhalten jetzt die Mîglichkeit eine Produktkondition auszuwÑhlen,",zwtext$)
        
                   REQUEST "Wollen Sie den Vertrag an die Sollstellung Åbergeben ? ","",130,req1ab%
                   IF req1ab% = 0 THEN GOTO endprodi06032002
                   alle$ = "n"
AnfAlle300920071: 
                   FILE "VPGEKOND"
                   INDEX codevp.VPGEKOND
                   SELECT FIRST 
                   SELECT KEY codevp.kvertrag FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   IF codew.kvertrag = 1 OR req1ab% <> 1 THEN 
                     IF codew.kvertrag = 1 THEN 
                       CALL Fehler("Der Vertrag kann nicht an die Sollstellung Åbergeben werden, da er noch in der WÑhrung DM gefÅhrt wird!","")
                     END IF 
                     GOTO endprodi06032002
                   END IF 
                   IF Bewertungssumme.kvertrag <= 0 THEN 
                     CALL Fehler("Der Vertrag kann nicht an die Sollstellung Åbergeben werden, da die Bewertungssumme <= 0 ist!","")
                     GOTO endprodi06032002
                   END IF 
                   a% = 0
                   gefunden% = 0
                   CodeEingGE% = CodeEingGE.kvertrag
                   IF CodeEingGE% = 0 THEN alle$ = "j"
                   IF CodeEingGE% > 0 THEN 
                     WHILE NOT EOF ("VPGEKOND") AND codevp.VPGEKOND = codevp.kvertrag
                       IF CodeEingGE.vpgekond = CodeEingGE% THEN 
                         gefunden% = gefunden% + 1
                       END IF 
                       SELECT NEXT FILE "VPGEKOND" INDEX codevp.VPGEKOND
                     WEND 
                     IF gefunden% = 0 THEN alle$ = "j"
                   END IF 
                   gefunden% = 0
                   FILE "VPGEKOND"
                   INDEX codevp.VPGEKOND
                   SELECT FIRST 
                   SELECT KEY codevp.kvertrag FILE "VPGEKOND" INDEX codevp.VPGEKOND

                   WHILE NOT EOF ("VPGEKOND") AND codevp.VPGEKOND = codevp.kvertrag
                     ok% = - 1
                     IF alle$ = "n" THEN 
                       IF CodeEingGE.vpgekond <> CodeEingGE% THEN GOTO nextkond25032002
                     END IF 
                     gefunden% = gefunden% + 1
                     IF bwvon.VPGEKOND > 0 THEN 
                       IF Gvuebs$ LIKE "TRUE" THEN 
                         IF Antragsdatum.kvertrag < bwvon.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       ELSE 
                         IF VS_Beginn.kvertrag < bwvon.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       END IF 
                     END IF 
                     IF bwbis.VPGEKOND > 0 THEN 
                       IF Gvuebs$ LIKE "TRUE" THEN 
                         IF Antragsdatum.kvertrag > bwbis.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       ELSE 
                         IF VS_Beginn.kvertrag > bwbis.VPGEKOND THEN 
                           REM ok% = 0
                         END IF 
                       END IF 
                     END IF 
                     IF ok% = 0 THEN 
                       fehl% = fehl% + 1
                       GOTO nextkond25032002
                     END IF 
                     IF ok% THEN 
                       KVKond$(a%) = "BWVon:" + DATE$ (bwvon.VPGEKOND,"0d.mm.yyyy") + " "
                       IF bwbis.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "BWBis:" + DATE$ (bwbis.VPGEKOND,"0d.mm.yyyy") + " "
                       END IF 
 
                       IF (APKVMonatjn.VPGEKOND = "j" AND KVMonatFakt.VPGEKOND > 0) OR (APPfMonatjn.VPGEKOND = "j" AND PflMonatFakt.VPGEKOND > 0) THEN 
                         IF APKVMonatjn.VPGEKOND = "j" AND KVMonatFakt.VPGEKOND > 0 THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP-KV:Anz.Netto-BeitrÑge=" + LTRIM$ ( STR$ (KVMonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                         IF APPfMonatjn.VPGEKOND = "j" AND PflMonatFakt.VPGEKOND > 0 THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Pflegepflicht-BeitrÑge=" + LTRIM$ ( STR$ (PflMonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                         GOTO w110920051
                       END IF 

                       IF Monatjn.VPGEKOND = "j" AND MonatFakt.VPGEKOND > 0 THEN 
                         IF MonatBrutto.vpgekond = "j" THEN 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Brutto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         ELSE 
                           KVKond$(a%) = KVKond$(a%) + "AP:Anz.Netto-BeitrÑge=" + LTRIM$ ( STR$ (MonatFakt.VPGEKOND,"9999.0000")) + " "
                         END IF 
                       END IF 
 
                       IF Pauschalejn.VPGEKOND = "j" AND Pauschale.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:Pauschale=" + LTRIM$ ( STR$ (Pauschale.VPGEKOND,"9999.0000")) + " " + Waehrung.kvertrag
                       END IF 
                   
                       IF apjn.VPGEKOND = "j" AND ap.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "AP:" + LTRIM$ ( STR$ (ap.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       IF courtagejn.VPGEKOND = "j" AND courtage.VPGEKOND > 0 THEN 
                         KVKond$(a%) = KVKond$(a%) + "Courtage:" + LTRIM$ ( STR$ (courtage.VPGEKOND,"9999.0000")) + " "
                         IF AnzCourtZahlung.vpgekond > 0 OR AnzCourtZahlung.kvertrag > 0 THEN 
                           anzcou% = 0
                           anzcou% = AnzCourtZahlung.vpgekond
                           IF AnzCourtZahlung.kvertrag > 0 THEN anzcou% = AnzCourtZahlung.kvertrag
                           KVKond$(a%) = KVKond$(a%) + "-Anzahl: " + LTRIM$ ( STR$ (anzcou%,"999.")) + "/ "
                         END IF 
                       END IF 
                       zus$ = ""
                       IF VDjn.VPGEKOND = "j" THEN 
                         IF VS_Dauer.kvertrag < 1 THEN 
                           CALL Fehler("Sie kînnen den Vertrag " + VS_NR.kvertrag + " nicht mittels den Konditionen zur Vertragslaufzeit and die Sollstellung Åbergeben,","da keine Laufzeit eingetragen wurde!")
                           GOTO endprodi06032002
                         ELSE 
                           ok% = 0
                           IF VS_Dauer.kvertrag <= VD5Dauer.VPGEKOND AND VD5Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD5AP.VPGEKOND,"9999.0000")) + " "
                             IF VD5SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD5SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD5HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD4Dauer.VPGEKOND AND VD4Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD4AP.VPGEKOND,"9999.0000")) + " "
                             IF VD4SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD4SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD4HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD3Dauer.VPGEKOND AND VD3Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD3AP.VPGEKOND,"9999.0000")) + " "
                             IF VD3SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD3SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD3HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD2Dauer.VPGEKOND AND VD2Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD2AP.VPGEKOND,"9999.0000")) + " "
                             IF VD2SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD2SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD2HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF VS_Dauer.kvertrag <= VD1Dauer.VPGEKOND AND VD1Dauer.VPGEKOND > 0 THEN 
                             zus$ = "AP:" + LTRIM$ ( STR$ (VD1AP.VPGEKOND,"9999.0000")) + " "
                             IF VD1SR.VPGEKOND <> 0 THEN 
                               zus$ = zus$ + "Storno:" + LTRIM$ ( STR$ (VD1SR.VPGEKOND,"9999.0000")) + " /Haftung " + STR$ (VD1HZ.VPGEKOND,"999")
                             END IF 
                             ok% = - 1
                           END IF 
                           IF ok% = - 1 THEN 
                             KVKond$(a%) = KVKond$(a%) + zus$ + " "
                           ELSE 
                             CALL Fehler("Sie kînnen den Vertrag " + VS_NR.kvertrag + " nicht mittels den Konditionen zur Vertragslaufzeit and die Sollstellung Åbergeben,","da keine gÅltige Kondition eingetragen wurde!")
                             GOTO endprodi06032002 
                           END IF 
                         END IF 
                       END IF 
w110920051: 
                       IF pflegejn.VPGEKOND = "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Pflege:" + LTRIM$ ( STR$ (pflegeProvi.VPGEKOND,"99.0000")) + " "
                       END IF 
                       IF srjn.VPGEKOND = "j" AND vdjn.vpgekond <> "j" THEN 
                         KVKond$(a%) = KVKond$(a%) + "Storno:" + LTRIM$ ( STR$ (sr.VPGEKOND,"9999.0000")) + " "
                       END IF 
                       IF EingereichtBei.vpgekond <> "" THEN 
                         KVKond$(a%) = KVKond$(a%) + "/eingereicht Åber: " + LTRIM$ (EingereichtBei.vpgekond)
                       END IF 
                       IF LTRIM$ (notiz.vpgekond) <> "" THEN 
                         KVKond$(a%) = KVKond$(a%) + "/" + LTRIM$ (notiz.vpgekond) + SPACE$ (100) + STR$ (codekey.VPGEKOND,"000000")
                       ELSE 
                         KVKond$(a%) = KVKond$(a%) + SPACE$ (100) + STR$ (codekey.VPGEKOND,"000000")
                       END IF 
                       IF bwstart% >= bwvon.vpgekond THEN 
                         IF bwbis.vpgekond > 0 THEN 
                           IF bwstart% <= bwbis.vpgekond THEN prompt$ = KVKond$(a%)
                         ELSE 
                           prompt$ = KVKond$(a%)
                         END IF 
                       END IF 
                       a% = a% + 1
                     END IF 
nextkond25032002:                     
                     SELECT NEXT FILE "VPGEKOND" INDEX codevp.VPGEKOND
                   WEND 
                   IF a% = 0 AND fehl% > 0 THEN 
                     req% = 0
                     text1$ = "es wurden insgesamt " + LTRIM$ ( STR$ ("gefunden")) + "Konditionen gefunden,davon enthÑlt keine Kondition in den Feldern BWVON und/oder BWBIS einen Eintrag der mit"
                     CALL Fehler(text1$,"dem Provisionierungsbeginn des Vertrages harmonisiert")
                   ELSE 
                     KVKond$(a%) = ""
                     prompt$ = KVKond$(0)
                     CREATE DIALOG "MASUCH",0,0,458,288,"Sollstellungskonditionen","MS Sans Serif",8
                     ADD DIALOG "MASUCH",4,0,0,458,263,0,""
                     ADD DIALOG "MASUCH",9,9,11,21,21,2
                     ADD DIALOG "MASUCH",5,37,11,151,10,0,"Bitte wÑhlen Sie aus der folgenden Liste aus:"
                     ADD DIALOG "MASUCH",7,7,27,448,229,2,2,KVKond$,Auswahl$,prompt$
                     ADD DIALOG "MASUCH",1,100,268,55,15,1,"&OK",1,1
                     IF alle$ <> "j" THEN ADD DIALOG "MASUCH",1,160,268,61,15,0,"Alle anzeigen",2,0
                     ADD DIALOG "MASUCH",1,230,268,55,15,0,"&Abbrechen",0,0
                     MOUSE ON 
                     DIALOG "MASUCH",req%
                     REMOVE DIALOG "MASUCH"
                   END IF 
                   IF req% = 2 THEN 
                     REDIM KVKond$( RECCOUNT ("GEADR") + 1,1)
                     REDIM KVKond$( RECCOUNT ("GEADR") + 1)
                     alle$ = "j"
                     GOTO AnfAlle300920071
                   END IF 
                   IF req% = 1 THEN 
                     dDate$ = "0"
                     CodeKey% = VAL ( RIGHT$ (Auswahl$(0),6))
                     IF CodeKey% <> 0 THEN 
                       IF NOT EXISTS (cuvt%,codevt.kvskond) THEN 
                         BLANK FILE "KVSKOND"
                         CodeKey1% = SER ("KVSKOND",1)
                         CodeKey.kvskond = CodeKey1%
                         Codevt.KVSKOND = cuvt%
                         CodeKO.KVSKOND = CodeKey%
                         erledigt.KVSKOND = "n"
                         test1% = TODAY - 60
                         jetztlos% = 0
                         STORE FILE "KVSKOND"
                         UNLOCK CURRENT FILE "KVSKOND"
                         IF vs_beginn.kvertrag < test1% THEN 
                           atext$ = "ob die Zahlungen bis jetzt erfolgt sind und Sie die Sollstellung erst ab heutigem Datum generieren lassen wollen!"
                           CALL Fehler("Der Vertragsbeginn liegt mehr als 2 Monate zurÅck! Sie mÅssen selbst entscheiden, ob Sie die Sollstellung von Vertragsbeginn an erzeugen lassen mîchten oder,",atext$)
                           REQUEST "Sollstellung ab Vertragsbeginn generieren?","",135,req1234%
                           IF req1234% <> 1 THEN 
                             REM in kvskond verschiedene Sachen als erledigt kennzeichnen
 
                             dDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
                             _day% = DAY ( TODAY )
                             _month% = MONTH ( TODAY )
                             _year% = YEAR ( TODAY )
                             _day% = 1
                             dDate% = DAYS ( STR$ (_day%,"00") + "." + STR$ (_month%,"00") + "." + STR$ (_year%,"9999"))
                             dDate$ = DATE$ (dDate%,"0d.mm.yyyy")
datsoll1811200101: 
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsbeginn","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, ab wann die"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellung beginnen soll:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,dDATE$,10
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Beginndatum:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               ELSE 
                                 GOTO datsoll1811200101
                               END IF 
                             END IF 
                             SELECT KEY codekey% FILE "vpgekond" INDEX codekey.vpgekond
                             jetztlos% = 0
                           END IF 
                         END IF 
                       ELSE 
                         SELECT KEY cuvt% LOCK FILE "KVSKOND" INDEX codevt.KVSKOND
                         CodeKO.KVSKOND = CodeKey%
                         Codevt.KVSKOND = cuvt%
                         erledigt.KVSKOND = "n"
                         test1% = TODAY - 60
                         STORE FILE "KVSKOND"
                         UNLOCK CURRENT FILE "KVSKOND"
                         IF vs_beginn.kvertrag < test1% THEN 
                           atext$ = "ob die Zahlungen bis jetzt erfolgt sind und Sie die Sollstellung erst ab heutigem Datum generieren lassen wollen!"
                           CALL Fehler("Der Vertragsbeginn liegt mehr als 2 Monate zurÅck! Sie mÅssen selbst entscheiden, ob Sie die Sollstellung von Vertragsbeginn an erzeugen lassen mîchten oder,",atext$)
                           REQUEST "Sollstellung ab Vertragsbeginn generieren?","",135,req1234%
                           IF req1234% <> 1 THEN 
                             REM in kvskond verschiedene Sachen als erledigt kennzeichnen
 
                             dDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
datsoll1811200102: 
                             CREATE DIALOG "STICHTAG",0,0,222,114,"Sollstellungsbeginn","MS Sans Serif",8
                             ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
                             ADD DIALOG "STICHTAG",9,6,9,23,24,2
                             ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, ab wann die"
                             ADD DIALOG "STICHTAG",5,31,25,183,10,0,"Sollstellung beginnen soll:"
                             ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,dDATE$,10
                             ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Beginndatum:"
                             ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
                             ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
                             DIALOG "STICHTAG",req54321%
                             REMOVE DIALOG "STICHTAG"
                             IF req54321% = 1 THEN 
                               IF DateOK%(dDATE$) THEN 
                               ELSE 
                                 GOTO datsoll1811200102
                               END IF 
                             END IF 
                             SELECT KEY codekey% FILE "vpgekond" INDEX codekey.vpgekond
                           END IF 
                         END IF 
                       END IF 
                       SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
                       sollst.kvertrag = "j"
                       STORE FILE "KVERTRAG"
                       UNLOCK FILE "KVERTRAG"
                       REQUEST "Wollen Sie jetzt gleich die Sollstellung ermitteln lassen?","",130,req1soll%
                       IF req1soll% = 1 THEN 
                         CALL Sollstellung(cuvt%,1,dDate$)
                       END IF 
                     END IF 
                   END IF 
                 END IF 
                 FILE cfile$
               END IF 
endprodi06032002: 
               REM ***********************Ende Produktkonditionen ******************************************** 
 
               REM 07102000 weder Agentur noch Verwaltung
               IF iAppID% <> 55 AND iAppID% <> 43 THEN 
                 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
                   foo$ = FORM 
                   IF foo$ LIKE "*ertr*" THEN 
                     REQUEST "Mîchten Sie den Vertrag gleich berechnen lassen?","",130,req%
                   ELSE 
                     req% = 0
                   END IF 
                   IF req% = 1 THEN 
                     IF ProvSperreJN.kvertrag LIKE "j" THEN 
                       CALL Fehler("Auf dem Vertrag liegt eine Provisionssperre, deshalb kînnen die BuchungssÑtze nicht erzeugt werden!","")
                     ELSE 
                       CALL BUKOREinz()
                       SELECT FIRST FILE "Kvertrag"
                       SELECT FORM KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
                     END IF 
                     CALL VERTRUpdate()
                     FORM 
                   END IF 
                 ELSE 
                   REM RealCash
                   REM CALL Fehler("RealCash-Aufruf ZE Verrechnung","")
                   rr$ = UCASE$ (ReadINI$("SYSTEM","SofortRech"))
                   IF EXISTS (lfdnr.kvertrag,codevt.zeingan1) AND rr$ LIKE "TRUE" THEN 
                     foo$ = FORM 
                     IF foo$ LIKE "*ertr*" THEN 
                       REQUEST "Mîchten Sie die ZahlungseingÑnge des Vertrages gleich verrechnen lassen?","",130,req%
                     ELSE 
                       req% = 0
                     END IF 
                     IF req% = 1 THEN 
                       IF ProvSperreJN.kvertrag LIKE "j" THEN 
                         CALL Fehler("Auf dem Vertrag liegt eine Provisionssperre, deshalb kînnen die BuchungssÑtze nicht erzeugt werden!","")
                       ELSE 
                         GVertrID% = lfdnr.kvertrag
                         CALL PROVBUZEIN()
                       END IF 
                     END IF 
                   END IF 
                 END IF 
               ELSE 
                 CALL Fehler ("Sorry die restlichen Funktionen werden erst aktiviet, wenn Sie SmartPROVIS mit Provisionabrechnung erworben haben!","Bei Fragen oder WÅnschen info@codie.com   !")
               END IF 
             ELSE 
               SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
               ProviAb.kvertrag = 0
               CodeKO.KVERTRAG = 0
               IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
               REM kondition.KVERTRAG = SelKond%
               CALL FStore("KVERTRAG")
               CALL Fehler("Auswahl abgebrochen!","")
             END IF 
           END IF 
         ELSE 
           REM CALL Fehler("Datum im falschen Format!","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
         END IF 
       END IF 
     ELSE 
       ok% = 0
     END IF 
   ELSE 
     ok% = 0
   END IF 
 END IF 
 IF ok% = 0 THEN 
   REM 270799
   IF vstatus% = 2 THEN 
     REM d.h., die Routine wurde Åber den Button Status aufgerufen, bei Abbruch mÅssen die alten
     REM Statuseintragungen wieder vorgenommen werden
     SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     VStatusTxT.kvertrag = vstatustxt$
     CodeVStatus.kvertrag = vstatusnr%
     CALL QuickStore("Kvertrag")
     vstatus% = 0
   END IF 
 END IF 
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 CALL VERTRUpdate()
 FILE cfile$
 MOUSE ON 
 END SUB 
 
SUB PROVIDyn(proviab$,lz%)
 IF disabled%("PROVISION") THEN END SUB 
 cfile$ = FILE 
 cuvt% = lfdnr.KVERTRAG
 IF MOD ("KVERTRAG") OR NEW ("KVERTRAG") THEN CALL FStore("KVERTRAG")
 IF ProviAb > 0 OR Fremdvertrag.KVERTRAG LIKE "j" OR Altvertrag.KVERTRAG LIKE "j" THEN 
   SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   CALL VStat()
 ELSE 
   CALL DFile(3,"gekond" + _fpw$)
   CALL DFile(3,"vkond" + _fpw$)
   ok% = 1
   IF Bewertungssumme.KVERTRAG <= 0 THEN 
     ok% = 0
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie die Bewertungssumme ein.")
   END IF 
   REM 030697
   IF zw.kvertrag = 55 THEN 
     ok% = 0
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie erst die Zahlweise ein.")
   END IF 
 
   END IF 
   IF Beitrag.KVERTRAG <= 0 THEN 
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie den Beitrag ein.")
     ok% = 0
   END IF 
   IF CodeGE.KVERTRAG = 0 THEN 
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Gesellschaft aus.")
     ok% = 0
   END IF 
   IF CodeMA.KVERTRAG = 0 THEN 
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Agentur aus.")
     ok% = 0
   END IF 
   IF CodeVA.KVERTRAG = 0 THEN 
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte wÑhlen Sie eine Sparte aus.")
     ok% = 0
   END IF 
   IF DAYS (VS_Beginn.KVERTRAG) = 0 THEN 
     ok% = 0
     CALL Fehler("Vertrag kann noch nicht verprovisioniert werden!","Bitte geben Sie den Vertragsbeginn an.")
   END IF 
   IF ok% = 1 THEN 
     REM REQUEST "Vertrag in monatliche Abrechnung Åbernehmen?","",130,erg%
     erg% = 1
     IF erg% = 1 THEN 
       REM 160996 ProviAb$ = DATE$ ( TODAY ,"dd.mm.yy")
       REM 110798 ProviAb$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
       ZahlungJN$ = "n"
       REM CREATE DIALOG "SETPROVI",0,0,201,132,title$,"MS Sans Serif",8
       REM ADD DIALOG "SETPROVI",4,0,0,201,109,0,""
       REM ADD DIALOG "SETPROVI",9,7,10,20,20,2
       REM ADD DIALOG "SETPROVI",5,30,11,162,26,0,"Bitte geben Sie an, ab wann der Vertrag innerhalb der monatlichen Provisionsberechnung berÅcksichtigt werden soll."
       REM ADD DIALOG "SETPROVI",6,90,40,52,12,0,0,ProviAb$,10
       REM ADD DIALOG "SETPROVI",5,30,42,56,8,0,"Berechnung ab:"
       REM ADD DIALOG "SETPROVI",5,30,64,160,24,0,"Sollen die Provisionen fÅr diesen Vertrag abhÑngig von den ZahlungseingÑngen der Gesellschaften ausgezahlt werden?"
       REM ADD DIALOG "SETPROVI",2,30,91,143,14,0,"ZahlungseingÑnge &prÅfen","j","n",ZahlungJN$
       REM ADD DIALOG "SETPROVI",1,40,113,55,15,1,"&OK",1,1
       REM ADD DIALOG "SETPROVI",1,100,113,55,15,0,"&Abbrechen",0,0
       REM DIALOG "SETPROVI",req%
       REM REMOVE DIALOG ALL 
       req% = 1
       IF req% = 1 THEN 
         bwbezug$ = ReadConfig$("PROVIS","Bewertungszeitraum")
         IF bwbezug$ LIKE "leer" OR bwbezug$ LIKE "Provisionierungsbeginn" THEN 
           BWStart$ = ProviAb$
         ELSE 
           BWStart$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
         END IF 
         IF DateOK%(BWStart$) THEN 
           REM kond% = GetKond%(cuvt%, DAYS (BWStart$),0)
           kond% = 1
           IF kond% = 0 THEN 
             IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
             CALL Fehler(fehlnach$,"")
             SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
             ProviAb.kvertrag = 0
             CodeKO.KVERTRAG = 0
             REM kondition.KVERTRAG = SelKond%
             CALL FStore("KVERTRAG")
 
             REM ### ToDo: Fehlerliste anzeigen
           ELSE 
             REM doprov% = EditKond%(kond%)
             doprov% = 1
             IF doprov% = 1 THEN 
               SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
               ProviAb.kvertrag = DAYS (ProviAb$)
               Check.KVERTRAG = ZahlungJN$
               IF lz% <> 0 THEN vs_dauer.kvertrag = lz%
               REM CodeKO.KVERTRAG = kond%
               REM kondition.KVERTRAG = SelKond%
               REM REQUEST "Vertrag wird ab sofort in die Provisionierung","mit einbezogen!",2
               CALL FStore("KVERTRAG")
             ELSE 
               SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
               ProviAb.kvertrag = 0
               CodeKO.KVERTRAG = 0
               IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
               REM kondition.KVERTRAG = SelKond%
               CALL FStore("KVERTRAG")
               CALL Fehler("Auswahl abgebrochen!","")
             END IF 
           END IF 
         ELSE 
           CALL Fehler("Datum im falschen Format!","Bitte geben Sie das Datum in der Form 'tt.mm.jj' ein.")
         END IF 
       END IF 
     END IF 
   END IF 
 END IF 
 FILE cfile$
 MOUSE ON 
 END SUB 
  
 
 
 '      ***********************************
 '      ** Routinen fÅr Zahlungsabgleich **
 '      ***********************************
 
SUB EINGANG(codevt%)
 IF disabled%("EINGANG") THEN END SUB 
 CALL DFile(3,"ZEINGANG" + _fpw$)
 MOUSE OFF 
 REMOVE FROM FILE "Zeingang" WHERE codevt.zeingang < 1
 MOUSE ON 
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(3,"GEADR" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 FILE "ZEINGANG"
 _formend% = 0
 IF codevt% = 0 THEN maske$ = "EINGANG"
 IF codevt% > 0 THEN maske$ = "EINGANGN"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - ZahlungseingÑnge"
     OPEN FORM GPrjForm$ + maske$
     SET f = Superbase.Form
     SET FORM OFF Uebers$
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     lAussenstand$ = ""
     eingbei$ = ""
     CALL ZEINIntro(codevt%)
     CALL MNEINGANG()
     SET STATUS "ZahlungseingÑnge"
   END IF 
   MENU ON 
   MOUSE ON 
   ZEINsub% = 0
   IF RECCOUNT ("zeingang") > 0 THEN CALL ZEINUpdate(codevt%)
   CALL ClearKBDBuffer()
   FORM 
   f.suchen.visible = - 1
   f.suchen.enabled = - 1
   f.uebersicht.enabled = - 1
   f.abbruch.visible = 0
   f.abbruch.enabled = 0
   FORM 
   IF ZEINsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZEINsub%
   CASE 1
     REM PrÅfung der Daten
     MOUSE OFF 
     CALL DFile(3,"BUCHUNG" + _fpw$)
     CALL DFile(3,"KVERTRAG" + _fpw$)
     FILE "zeingang"
     INDEX codevt.zeingang
     IF RECCOUNT ("zeingang") > 0 THEN 
       SELECT FIRST LOCK 
     ELSE 
       SELECT LAST 
     END IF 
     ok% = - 1
     WHILE NOT EOF ("Zeingang")
       codevt% = Codevt.zeingang
       IF EXISTS (codevt,lfdnr.kvertrag) THEN 
         SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
           pool% = (pool.kvertrag * 100)
           pool1$ = STR$ (pool%,"999999999999")
           poolges% = ( VAL (pool1$)) / 100
           pool.kvertrag = poolges%
           CALL QuickStore("KVERTRAG")
           SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
           IF pool.kvertrag >= 0 AND UCASE$ (Mahnung.KVERTRAG) LIKE "J" THEN 
             Mahnung.KVERTRAG = "n"
             CALL QuickStore("KVERTRAG")
             UPDATE Mahnung.BUCHUNG = "n" WHERE CodeVT.BUCHUNG = codevt% AND Mahnung.BUCHUNG LIKE "j"
             END UPDATE 
             CLOSE FILE "BUCHUNG"
             CALL DFile(3,"BUCHUNG" + _fpw$)
             CALL Info("Alle Buchungen des Vertrages " + VS_NR.KVERTRAG + " konnten aus der Mahnliste entfernt werden.","")
           END IF 
         END IF 
         vs$ = VS_NR.kvertrag
         codege% = Codege.kvertrag
         IF vs$ <> VS_NR.zeingang THEN ok% = 0
         IF vS$ = "" THEN 
           vs$ = "*FEHLER keine Policenr*"
           CALL Fehler("Es wurde ein Zahlungseingang zu einem Vertrag ohne Policenr gefunden!","Er ehÑlt die Policenr:*FEHLER keine Policenr*")
           ok% = 0
         END IF 
         SELECT CURRENT LOCK FILE "zeingang"
         VS_NR.zeingang = vs$
         CodeGE.zeingang = codege%
         CALL QuickStore("Zeingang")
         
       ELSE 
         CALL Fehler ("Der Kundenvertrag zu einem Zahlungseingang konnte nicht gefunden werden!","Er wurde wahrscheinlich gelîscht! Die ZahlungseingÑnge zu diesem Vertrag werden jetzt ebenfalls gelîscht!")
         REMOVE FROM FILE "zeingang" WHERE Codevt.zeingang = codevt%
         ok% = 0
       END IF 
       SELECT NEXT LOCK FILE "Zeingang"
     WEND 
     IF ok% = - 1 THEN 
       CALL Fehler("Es wurden keine Fehler gefunden!","")
     ELSE 
       CALL Fehler("Es wurden Fehler gefunden und beseitigt!","")
     END IF 
     MOUSE ON 
   CASE 2
     IF disabled%("BUCHUNG") THEN END SUB 
     IF ag$ <> "j" THEN 
       DIRECTORY _ppath$
       CALL MAHNLIST()
     ELSE 
       CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
     END IF 
   CASE 99
     MENU OFF 
     IF RECCOUNT ("ZEINGANG") = 0 THEN CALL ZEINNeu()
     IF PAGE = 1 THEN 
       f.neu.enabled = 0
       f.bearb.enabled = 0
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       f.suchen.visible = 0
       f.suchen.enabled = 0
       f.zurueck.enabled = 0
       f.loeschen.enabled = 0
       f.uebersicht.enabled = 0
       f.testguel.enabled = 0
       zbetragold% = betrag.zeingang
       ENTER VS_Nr.ZEINGANG,0
       f.neu.enabled = - 1
       f.bearb.enabled = - 1
       f.abbruch.enabled = 0
       f.abbruch.visible = 0
       f.suchen.visible = - 1
       f.suchen.enabled = - 1
       f.zurueck.enabled = - 1
       f.loeschen.enabled = - 1
       f.uebersicht.enabled = - 1
       f.testguel.enabled = - 1
     END IF 
   END SELECT 
   MENU ON 
 WEND 
 REM CALL ZEINBuchung( - 1)
 REM 110397 CALL ZEINBuchung(0)
 _formend% = 0
 END SUB 
  
SUB BetrBrut()
 REM ZE-Maske RealCash
 IF Bewertung.zeingan1 <> 0 AND BetragBrut.zeingan1 = 0 THEN 
   BetragBrut.zeingan1 = Bewertung.zeingan1
 END IF 
 IF mwst.zeingan1 = 0 THEN mwst.zeingan1 = 0
 IF BetragBrut.zeingan1 <> 0 THEN 
   IF mwst.zeingan1 <> 0 THEN 
     Bewertung.zeingan1 = VAL ( STR$ (BetragBrut.zeingan1 / (100 + MwSt.zeingan1) * 100,"999999999.00"))
   ELSE 
     Bewertung.zeingan1 = BetragBrut.zeingan1
   END IF 
 END IF 
 IF mwst.zeingan1 = 0 THEN 
   Bewertung.zeingan1 = BetragBrut.zeingan1
 END IF 
 END SUB 
 
 
SUB BetrNett()
 REM ZE-Maske RealCash
 IF mwst.zeingan1 = 0 THEN mwst.zeingan1 = 0
 IF mwst.zeingan1 = 0 AND BetragBrut.zeingan1 = 0 THEN 
   BetragBrut.zeingan1 = Bewertung.zeingan1
 END IF 
 IF Bewertung.zeingan1 <> 0 THEN 
   IF mwst.zeingan1 <> 0 THEN 
     BetragBrut.zeingan1 = VAL ( STR$ ((Bewertung.zeingan1 * (100 + MWST.zeingan1) / 100),"999999999.00"))
   ELSE 
     BetragBrut.zeingan1 = Bewertung.zeingan1
   END IF 
 END IF 
 IF Bewertung.zeingan1 < ZahlBertrMin.zeingan1 AND ZahlBertrMin.zeingan1 <> 0 THEN 
   CALL Fehler("Der eingegebene Wert(Brutto) " + STR$ (BetragBrut.zeingan1,",999999.00") + " ist kleiner als der im Produkt oder Sparte definierte Mindestwert " + STR$ (ZahlBertrMin.zeingan1,",999999.00"),"")
 END IF 
 IF Bewertung.zeingan1 > ZahlBertrMax.zeingan1 AND ZahlBertrMax.zeingan1 <> 0 THEN 
   CALL Fehler("Der eingegebene Wert(Brutto) " + STR$ (BetragBrut.zeingan1,",999999.00") + " ist grî·er als der im Produkt oder Sparte definierte Maximalwert " + STR$ (ZahlBertrMax.zeingan1,",999999.00"),"")
 END IF 
 END SUB 
 
 

 
SUB ZEINIntro(codevt%)
 MOUSE OFF 
 FILE "ZEINGANG"
 INDEX CodeAZ.ZEINGANG
 IF codevt% < 1 THEN 
   INDEX CodeAZ.zeingang
   SELECT FORM LAST 
 ELSE 
   INDEX codevt.zeingang
   SELECT FIRST FILE "zeingang" INDEX codevt.zeingang
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "zeingang" INDEX codevt.zeingang
   IF codeko.kvertrag > 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
   waehr$ = "WÑhrung: " + waehrung.zeingang
 END IF 
 
 FORM 
 END SUB 
 
SUB ZEINUpdate(codevt%)
 codevt% = codevt.zeingang
 codeaz% = codeaz.zeingang
 IF codevt.zeingang > 0 THEN 
   SELECT FORM KEY CodeVT.zeingang FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   REM SELECT FORM KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
   SELECT FORM KEY codevt% FILE "zeingang" INDEX codevt.zeingang
 END IF 
 SELECT KEY codeaz% FILE "zeingang" INDEX codeaz.zeingang
 SELECT KEY CodeVT.ZEINGANG FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
 SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 lGesellschaft$ = Gesellschaft.GEADR
 lAgentur$ = Nachname.MAADR + ", " + Vorname.MAADR + ", " + Agenturnr.maadr
 lSparte$ = Sparte.SPARTEN
 lKunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 lAussenstand$ = LTRIM$ ( STR$ (pool.kvertrag,",999999999.00")) + " " + waehrung.kvertrag
 IF pool.kvertrag < 0 THEN 
   vausgut$ = "Aussenstand:"
 ELSE 
   vausgut$ = "Guthaben:"
 END IF 
 eingbei$ = EingereichtBei.kvertrag
 IF eingbei$ = "" THEN 
   eingbei$ = "eingereicht Åber"
 END IF 
 IF MNdisabled%("SEEEINGBEI") THEN 
     eingbei$ = "wurde ausgeblendet"
     f.eingbei.enabled = 0
 END IF 
 waehr$ = "WÑhrung: " + waehrung.zeingang
 FORM 
 END SUB 
 
SUB ZEINList1()
 FILE "zeingang"
 opt% = 1
 GOTO zeli1211962
zeli1211961: 
   CALL Fehler("Ein Datum ist nicht richtig eingegeben worden!","Geben Sie das Datum in der Form dd.mm.jjjj ein!")
zeli1211962: 
 ON ERROR GOTO ErrorHandler
 CREATE DIALOG "UEBERNAHME",0,0,250,102,"öbersicht","MS Sans Serif",8
 ADD DIALOG "UEBERNAHME",4,0,0,250,81,0,""
 ADD DIALOG "UEBERNAHME",9,6,14,22,22,2
 ADD DIALOG "UEBERNAHME",5,37,14,141,10,0,"Bitte wÑhlen Sie die öbersicht aus"
 ADD DIALOG "UEBERNAHME",3,37,27,137,9,0,"sortiert nach Policenummer",1,opt%
 ADD DIALOG "UEBERNAHME",3,37,38,137,11,0,"sortiert nach Eingangsdatum",2,opt%
 ADD DIALOG "UEBERNAHME",3,37,51,193,11,0,"sortiert nach Eingangsdatum mit Datumseingrenzung",3,opt%
 ADD DIALOG "UEBERNAHME",6,119,64,41,12,0,0,von$,10
 ADD DIALOG "UEBERNAHME",6,180,64,41,12,0,0,bis$,10
 ADD DIALOG "UEBERNAHME",5,46,64,70,10,0,"Eingangsdatum von:"
 ADD DIALOG "UEBERNAHME",5,162,65,17,10,0,"&bis:"
 ADD DIALOG "UEBERNAHME",1,59,84,55,15,1,"&OK",1,1
 ADD DIALOG "UEBERNAHME",1,117,84,55,15,0,"&Abbrechen",0,0
 DIALOG "UEBERNAHME",reqa%
 REMOVE DIALOG ALL 
 IF reqa% = 1 THEN 
   MOUSE OFF 
    
     ON ERROR GOTO zeli1211961
     IF von$ <> "" THEN 
       von1% = DAYS (von$)
     ELSE 
       von1% = DAYS ("01.01.1980")
     END IF 
     IF bis$ <> "" THEN 
       bis1% = DAYS (bis$)
     ELSE 
       bis1% = DAYS ("30.12.2099")
     END IF 
     ON ERROR GOTO ErrorHandler
   
   IF opt% = 1 THEN 
     INDEX VS_NR.zeingang
   ELSE 
     INDEX Datum.zeingang
   END IF 
   SELECT FIRST 
   IF RECCOUNT ("zeingang") > 30000 THEN 
     REDIM AdrFound$(30000)
   ELSE 
     REDIM AdrFound$( RECCOUNT ("zeingang"))
   END IF 
   IF opt% < 3 THEN 
     WHILE NOT EOF ("zeingang")
      IF datum.zeingang >= von1% AND datum.zeingang <= bis1% THEN 
       SELECT KEY CodeVT.ZEINGANG FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
       SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
       SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
       SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
       SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       lGes$ = TRIM$ (Gesellschaft.GEADR)
       lAgentur$ = TRIM$ (Nachname.MAADR) + ", " + TRIM$ (Vorname.MAADR) + ", " + Agenturnr.maadr
       lSp$ = TRIM$ (Sparte.SPARTEN)
       lK$ = TRIM$ (Nachname.GAdrDat$) + ", " + TRIM$ (Vorname.GAdrDat$)
       l% = LEN (VS_NR)
       IF opt% = 1 THEN 
         REM nach Policenr. sortiert 070897
         ab% = 30 - l%
 AdrFound$(a%) = VS_NR + SPACE$ (ab%) + "    " + DATE$ (datum.zeingang,"0d.mm.yyyy") + "    " + STR$ (betrag.zeingang,"99999999999.00") + "    " + lk$ + "  " + lGes$ + "  " + lsp$ + "   " + lagentur$ + SPACE$ (80) + STR$ (codeaz.zeingang,"000000")
       ELSE 
         REM nach Datum sortiert
 AdrFound$(a%) = DATE$ (datum.zeingang,"0d.mm.yyyy") + "    " + VS_NR + SPACE$ (24 - l%) + "     " + STR$ (betrag.zeingang,"99999999999.00") + "    " + lk$ + "  " + lGes$ + "  " + lsp$ + "   " + lagentur$ + SPACE$ (80) + STR$ (codeaz.zeingang,"000000")
       END IF 
       a% = a% + 1
       SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
     END IF 
     IF a% > 29998 THEN 
       CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
       SELECT LAST FILE "zeingang"
     ELSE 
       SELECT NEXT FILE "zeingang"
     END IF 
     WEND 
   ELSE 
     SELECT KEY von1% FILE "zeingang" INDEX datum.zeingang
     IF von1% <> bis1% THEN 
       WHILE NOT EOF ("zeingang") AND datum.zeingang >= von1% AND datum.zeingang <= bis1%
     ELSE 
       WHILE NOT EOF ("zeingang") AND datum.zeingang = von1%
     END IF 
         SELECT KEY CodeVT.ZEINGANG FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
         SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
         SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
         SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
         SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
         lGes$ = TRIM$ (Gesellschaft.GEADR)
         lAgentur$ = TRIM$ (Nachname.MAADR) + ", " + TRIM$ (Vorname.MAADR) + ", " + Agenturnr.maadr
         lSp$ = TRIM$ (Sparte.SPARTEN)
         lK$ = TRIM$ (Nachname.GAdrDat$) + ", " + TRIM$ (Vorname.GAdrDat$)
         l% = LEN (VS_NR)
 AdrFound$(a%) = DATE$ (datum.zeingang,"0d.mm.yyyy") + "    " + VS_NR + SPACE$ (24 - l%) + "     " + STR$ (betrag.zeingang,"99999999999.00") + "     " + lk$ + "  " + lGes$ + "  " + lsp$ + "   " + lagentur$ + SPACE$ (80) + STR$ (codeaz.zeingang,"000000")
         a% = a% + 1
         SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
     IF a% > 29998 THEN 
       CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
       SELECT LAST FILE "zeingang"
     ELSE 
      SELECT NEXT FILE "zeingang"
     END IF 
       WEND 
   END IF 
   SET STATUS ""
   AdrFound$(a%) = ""
   LAuswahl$ = AdrFound$(0)
   LAuswahl1$(0) = LAuswahl$
   CREATE DIALOG "ADRSTICHW",0,0,424,262,"ZahlungseingÑnge","MS Sans Serif",8
   ADD DIALOG "ADRSTICHW",7,5,6,419,234,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
   ADD DIALOG "ADRSTICHW",1,152,243,55,16,1,"&OK",1,1
   ADD DIALOG "ADRSTICHW",1,212,243,55,16,0,"&Abbrechen",0,0
   DIALOG "ADRSTICHW",req5%
   MOUSE ON 
   REMOVE DIALOG "ADRSTICHW"
   IF req5% = 1 THEN 
     LAuswahl$ = LAuswahl1$(0)
     scodema% = VAL ( RIGHT$ (LAuswahl$,6))
     SELECT FIRST 
     SELECT FORM KEY scodema% FILE "zeingang" INDEX codeaz.zeingang
     SELECT KEY CodeVT.ZEINGANG FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
     SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     lGesellschaft$ = TRIM$ (Gesellschaft.GEADR)
     lAgentur$ = TRIM$ (Nachname.MAADR) + ", " + TRIM$ (Vorname.MAADR) + ", " + Agenturnr.maadr
     lSparte$ = TRIM$ (Sparte.SPARTEN)
     lKunde$ = TRIM$ (Nachname.GAdrDat$) + ", " + TRIM$ (Vorname.GAdrDat$)
     eingbei$ = EingereichtBei.kvertrag
     IF eingbei$ = "" THEN 
       eingbei$ = "eingereicht Åber"
     END IF 
     IF MNdisabled%("SEEEINGBEI") THEN 
       eingbei$ = "wurde ausgeblendet"
     END IF 
   END IF 
 END IF 
 FORM 
 END SUB 
 
SUB ZEINNeu()
 FILE "zeingang"
 REM IF NEW ("ZEINGANG") OR MOD ("ZEINGANG") THEN CALL FStore("ZEINGANG")
 lVSNR$ = VS_Nr.ZEINGANG + " (" + DATE$ (Datum.ZEINGANG,"0d.mm.yyyy") + "/" + LTRIM$ ( STR$ (Betrag.ZEINGANG,",999999999.00")) + ")"
 f$ = FORM 
 VS_Nr$ = VS_Nr.zeingang
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 CodeAZ% = SER ("ZEINGANG",1)
 CodeAZ.ZEINGANG = CodeAZ%
 Datum.ZEINGANG = DATE$ ( TODAY ,"dd.mm.yyyy")
 IF f$ LIKE "EINGANG" THEN 
   VS_Nr.zeingang = VS_Nr$
 END IF 
 CALL QuickStore("zeingang")
 SELECT KEY codeaz% LOCK FILE "zeingang" INDEX codeaz.zeingang
 REM CALL ZEingWaehrung("zeingang")
 REM SELECT KEY codeaz% LOCK FILE "zeingang" INDEX codeaz.zeingang
 lKunde$ = ""
 lGesellschaft$ = ""
 lSparte$ = ""
 lAgentur$ = ""
 eingbei$ = ""
 FORM 
 ZEINsub% = 99
 SET EDIT SELECT ON 
 END SUB 
 
 ' Zahlungseingang sichern
 ' =======================================================================
 ' 19.09.95  automatischer Abgleich mit Mahnliste
 
SUB ZEINSichern()
 REM CALL Fehler("","")
 cuzein% = CodeAZ.ZEINGANG
 cuvnr% = CodeVT.ZEINGANG
 IF cuvnr% < 1 THEN END SUB 
 betrag% = Betrag.ZEINGANG
 datum% = datum.zeingang
 gebucht.ZEINGANG = "j"
 CALL QuickStore("ZEINGANG")
 differenz% = betrag% - zbetragold%
 SELECT KEY cuvnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SET STATUS "Abgleich mit Mahnliste..."
 pool% = (Pool.KVERTRAG + differenz%) * 100
 pool1$ = STR$ (pool%,"999999999999")
 poolges% = ( VAL (pool1$)) / 100
 pool.kvertrag = poolges%
 
 IF Poolges% < 0 THEN Mahnung.KVERTRAG = "j"
 CALL QuickStore("KVERTRAG")
 IF Mahnung.KVERTRAG LIKE "j" THEN 
   MOUSE OFF 
   IF Pool.KVERTRAG >= 0 THEN 
     REM 221199
     SELECT KEY cuvnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     Mahnung.KVERTRAG = "n"
     CALL QuickStore("KVERTRAG")
     CALL DFile(3,"BUCHUNG" + _fpw$)
     datum$ = " #ZE:" + DATE$ (datum%,"0d.mm.yyyy")
     UPDATE Buchungstext.buchung = Buchungstext.buchung + datum$:Mahnung.BUCHUNG = "n":Datum.buchung = datum% WHERE CodeVT.BUCHUNG = cuvnr% AND Mahnung.BUCHUNG LIKE "j"
     END UPDATE 
     CLOSE FILE "BUCHUNG"
     CALL DFile(3,"BUCHUNG" + _fpw$)
     CALL Info("Alle Buchungen des Vertrages " + VS_NR.KVERTRAG + " konnten aus der Mahnliste entfernt werden.","")
   ELSE 
     CALL Info("Zur Information:","Es fehlen noch " + LTRIM$ ( STR$ (0 - Pool.KVERTRAG,",9999999.00")) + " " + waehrung.kvertrag + " zur Auszahlung der in der Mahnliste enthaltenen Provisionen!")
   END IF 
   MOUSE ON 
 ELSE 
   REM CALL FStore("ZEINGANG")
 END IF 
 SELECT KEY cuzein% LOCK FILE "ZEINGANG" INDEX CodeAZ.ZEINGANG
 IF UCASE$ ( FORM ) LIKE "EINGANGN" THEN 
   CALL ZEINIntro(codevt.zeingang)
 END IF 
 FORM 
 END SUB 
 
SUB EinZein1N()
 codeaz% = codeaz.zeingang
 SELECT KEY codeaz% FILE "zeingang" INDEX codeaz.zeingang
 SELECT FORM KEY codeaz% FILE "zeingang" INDEX codeaz.zeingang
 Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 FORM 
 IF UCASE$ ( FORM ) LIKE "EINGANGN" THEN 
   REM CALL ZEINIntro(codevt.zeingang)
 END IF 
 END SUB 
 
 
    
SUB ZEINTest()
 MOUSE OFF 
 REM CALL Fehler("ZEINTest","")
 SET STATUS "PrÅfung..."
 codeaz1% = codeaz.zeingang
 IF MOD ("zeingang") THEN 
   STORE FILE "zeingang"
   UNLOCK CURRENT FILE "zeingang"
   SELECT KEY codeaz1% LOCK FILE "Zeingang" INDEX codeaz.zeingang
 END IF 
 REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
 DIM Auswahl$(1)
 cfile$ = FILE 
 FILE "KVERTRAG"
 INDEX QuickVSNR.KVERTRAG
 SELECT FIRST 
 VSNR$ = VS_Nr.ZEINGANG
 tVSNR$ = VSNRPack$(VSNR$)
 SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX QuickVSNR.KVERTRAG
 a% = 0
 WHILE QuickVSNR.KVERTRAG LIKE tVSNR$ + "*" AND NOT EOF ("KVERTRAG")
   IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
   IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
   Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + CHR$ (9) + "  " + von$ + " - " + bis$ + SPACE$ (6) + STR$ (lfdnr.KVERTRAG,"000000")
   IF a% = 0 THEN prompt$ = Vertraege$(0)
   a% = a% + 1
   SELECT NEXT 
 WEND 
 IF a% = 0 THEN 
   sel% = 0
 ELSE 
   IF a% > 1 THEN 
     MOUSE ON 
     CREATE DIALOG "ZEINLIST",0,0,251,198,title$,"MS Sans Serif",8
     ADD DIALOG "ZEINLIST",4,0,0,251,172,0,""
     ADD DIALOG "ZEINLIST",9,8,11,25,24,2
     ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
     ADD DIALOG "ZEINLIST",5,35,31,168,20,0,"Bitte wÑhlen Sie den Vertrag aus, fÅr den diese Zahlung gilt."
     ADD DIALOG "ZEINLIST",5,10,58,198,10,0,"Vertrags-/Policennummer                       von              bis"
     ADD DIALOG "ZEINLIST",7,10,68,225,105,2 + 128,2,Vertraege$,Auswahl$,prompt$
     ADD DIALOG "ZEINLIST",1,68,178,55,15,1,"&OK",1,1
     ADD DIALOG "ZEINLIST",1,128,178,55,15,0,"&Abbrechen",0,0
     DIALOG "ZEINLIST",req%
     REMOVE DIALOG "ZEINLIST"
     IF req% = 1 THEN 
       sel% = VAL ( RIGHT$ (Auswahl$(0),6))
     ELSE 
       sel% = 0
     END IF 
   ELSE 
     sel% = VAL ( RIGHT$ (Vertraege$(0),6))
   END IF 
 END IF 
 IF sel% <> 0 THEN 
   SELECT KEY sel% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   codevt.zeingang = sel%
   checked% = 0
   IF check.KVERTRAG <> "j" THEN 
     SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
     VertrInfo$ = gesellschaft.GEADR + "/" + Sparte.Sparten
     SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX COdeKU.GAdrDat$
     Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
     CREATE DIALOG "CHECKEIN",0,0,272,175,title$,"MS Sans Serif",8
     ADD DIALOG "CHECKEIN",4,0,0,272,140,0,""
     ADD DIALOG "CHECKEIN",9,7,12,22,22,2
     ADD DIALOG "CHECKEIN",5,34,13,180,22,0,"Der ausgewÑhlte Vertrag wurde noch nicht fÅr die Zahlungseingangskontrolle aktiviert."
     ADD DIALOG "CHECKEIN",5,34,36,28,12,0,"Vertrag:"
     ADD DIALOG "CHECKEIN",5,66,36,149,11,0,VS_NR.KVERTRAG
     ADD DIALOG "CHECKEIN",5,66,46,149,11,0,Kunde$
     ADD DIALOG "CHECKEIN",5,66,56,180,29,0,VertrInfo$
     ADD DIALOG "CHECKEIN",5,34,90,180,29,0,"Mîchten Sie, da· alle berechneten Provisionen dieses Vertrages mit dem Zahlungseingang der Gesellschaft abgeglichen werden?"
     ADD DIALOG "CHECKEIN",1,73,154,55,15,1,"&Ja",1,1
     ADD DIALOG "CHECKEIN",1,132,154,55,15,0,"&Nein",0,0
     DIALOG "CHECKEIN",req%
     REMOVE DIALOG "CHECKEIN"
     IF req% = 1 THEN 
       checked% = - 1
       check.KVERTRAG = "j"
     ELSE 
       check.KVERTRAG = "n"
       checked% = 0
     END IF 
     CALL QuickStore("KVERTRAG")
   ELSE 
     checked% = - 1
   END IF 
   IF checked% THEN 
     VS_NR.ZEINGANG = VS_Nr.KVERTRAG
     CodeVT.ZEINGANG = sel%
     CodeGE.ZEINGANG = CodeGE.KVERTRAG
     Waehrung.zeingang = Waehrung.kvertrag
     CodeW.zeingang = Codew.kvertrag
     Umrechnung.zeingang = Umrechnung.kvertrag
     CodeEingGE.zeingang = CodeEingGE.kvertrag
     EingereichtBei.zeingang = EingereichtBei.kvertrag
     CALL QuickStore("zeingang")
     SELECT KEY codeaz1% LOCK FILE "Zeingang" INDEX codeaz.zeingang
     CALL ZEINUpdate(codevt%)
     FORM 
   ELSE 
     VS_NR.ZEINGANG = ""
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     eingbei$ = ""
   END IF 
 ELSE 
   CALL Fehler("Es konnte kein Vertrag mit dieser Nummer gefunden werden!","Bitte geben Sie korrekte Vertragsnummer ein.")
 END IF 
 SET STATUS "Bereit"
 MOUSE ON 
 FILE cfile$
 END SUB 
 
 
 
      
 ' ZEINGANG Eintrag zurÅck
 ' =======================================================================
 
SUB ZEINPrev()
 IF MOD ("ZEINGANG") OR NEW ("ZEINGANG") THEN CALL FStore("ZEINGANG")
 cuaz% = CodeAZ.ZEINGANG
 SELECT FORM PREVIOUS 
 IF EOF ("ZEINGANG") THEN 
   REQUEST "Dateianfang erreicht!","",2
   SELECT FORM KEY cuaz% INDEX CodeAZ.ZEINGANG
 END IF 
 FORM 
 END SUB 
 
 
 ' ZEINGANG vor
 ' =======================================================================
 
SUB ZEINNext()
 IF MOD ("ZEINGANG") OR NEW ("ZEINGANG") THEN CALL FStore("ZEINGANG")
 cuaz% = CodeAZ.ZEINGANG
 SELECT FORM NEXT 
 IF EOF ("ZEINGANG") THEN 
   REQUEST "Dateiende erreicht!","",2
   SELECT FORM KEY cuaz% INDEX CodeAZ.ZEINGANG
 END IF 
 FORM 
 END SUB 
  
 
 ' ZEINGANG lîschen
 ' =======================================================================
 ' 05.09.95  - Korrektur des Vertragspools beim Lîschen gebuchter
 '               ZahlungseingÑnge
 
SUB ZEINLoe1Norm()
  CALL ZEINLoeschen(codevt.zeingang)
 END SUB 

SUB ZEINLoeschen(codevt%)
 IF disabled%("ZEINLoeschen") THEN END SUB 
 cuaz% = CodeAZ.ZEINGANG
 codevt% = codevt.zeingang
 IF cuaz% < 1 THEN END SUB 
 IF gebucht.ZEINGANG = "j" THEN 
   REQUEST "Der Zahlungseingang wurde bereits verbucht!","Trotzdem lîschen?",135,req%
 ELSE 
   REQUEST "Datensatz wirklich lîschen?","",135,req%
 END IF 
 MOUSE OFF 
 IF req% = 1 THEN 
   SELECT FIRST FILE "zeingang" INDEX codeaz.zeingang
   SELECT KEY cuaz% LOCK FILE "ZEINGANG" INDEX CodeAZ.ZEINGANG
   REM -- Vertragspool anpassen --
   IF gebucht.ZEINGANG = "j" THEN 
     SELECT FIRST FILE "zeingang" INDEX codeaz.zeingang
     SELECT KEY CodeVT.ZEINGANG LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     pool% = (Pool.KVERTRAG - Betrag.ZEINGANG) * 100
     pool1$ = STR$ (pool%,"999999999999")
     poolges% = ( VAL (pool1$)) / 100
     pool.kvertrag = poolges%
     
     CALL QuickStore("KVERTRAG")
   END IF 
   SELECT FIRST FILE "zeingang" INDEX codeaz.zeingang
   SELECT KEY cuaz% LOCK FILE "ZEINGANG" INDEX CodeAZ.ZEINGANG
   SELECT REMOVE FILE "ZEINGANG"
 ELSE 
   SELECT FIRST FILE "zeingang" INDEX codeaz.zeingang
   SELECT FORM KEY cuaz% FILE "ZEINGANG" INDEX CodeAZ.ZEINGANG
 END IF 
 IF EXISTS (codevt%,codevt.zeingang) THEN 
   SELECT KEY codevt% FILE "Zeingang" INDEX codevt.zeingang
 ELSE 
   IF FORM LIKE "EINGANGN" THEN 
     REQUEST "Es existieren keine weiteren ZahlungseingÑnge!"
     _formend% = - 1
   ELSE 
     IF RECCOUNT ("zeingang") > 0 THEN 
       SELECT LAST FILE "zeingang" INDEX codeaz.zeingang
     ELSE 
       REQUEST "Es existieren keine weiteren ZahlungseingÑnge!"
       _formend% = - 1
     END IF 
   END IF 
 END IF 
 IF _formend% <> - 1 THEN CALL ZEINUpdate(codevt%)
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' Zahlungseingang suchen
 ' =======================================================================
 
SUB ZEINSuchen()
 cuzein% = CodeAZ.ZEINGANG
 opt&% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 IF opt&% = 0 THEN opt&% = 1
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 CREATE DIALOG "ZEINSUCH",0,0,228,176,"ZahlungseingÑnge","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,151,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Buchungssatz suchen mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu durchsuchende Datenmenge durch die wahlfreie Angabe des Buchungsdatums einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,64,76,10,0,"Suche Åber..."
 ADD DIALOG "ZEINSUCH",3,58,74,149,12,0,"Vertrags-/Policennummer",1,opt&%
 ADD DIALOG "ZEINSUCH",3,58,86,148,12,0,"Gesellschaft",2,opt&%
 ADD DIALOG "ZEINSUCH",3,58,98,148,12,0,"eingereicht Åber",3,opt&%
 ADD DIALOG "ZEINSUCH",5,38,119,96,9,0,"Buchungszeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,132,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,131,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,132,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,131,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",1,54,155,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,155,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"ZahlungseingÑnge","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten BuchungssÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN ok% = 0
   END IF 
   IF opt&% = 2 THEN 
     GCodieRuf1% = 0
     suge% = GetCodeGE%(0)
     GCODieRuf% = - 1
     IF suge% = 0 THEN ok% = 0
   END IF 
   IF opt&% = 3 THEN 
     eingbei% = 0
     eingbei% = GetCodeGEE%(0)
     IF eingbei% < 1 THEN ok% = 0
   END IF 
   IF ok% THEN 
     REM -- Suche durchfÅhren
     cfile$ = FILE 
     IF von$ = "" THEN von% = DAYS ("1.1.1980") ELSE von% = DAYS (von$)
     IF bis$ = "" THEN bis% = DAYS ("31.12.2020") ELSE bis% = DAYS (bis$)
     DIM Auswahl$(1)
     IF RECCOUNT ("ZEINGANG") > 1000 THEN 
       DIM Buchungen$( RECCOUNT ("ZEINGANG"))
     ELSE 
       DIM Buchungen$(1000)
     END IF 
     FILE "ZEINGANG"
     MOUSE OFF 
     IF opt&% = 1 THEN 
       INDEX QuickVSNR.ZEINGANG
       SELECT FIRST 
       sVSNR$ = VSNRPack$(VSNR$)
       SELECT KEY sVSNR$ FILE "ZEINGANG" INDEX QuickVSNR.ZEINGANG
       a% = 0
       WHILE QuickVSNR.ZEINGANG LIKE sVSNR$ + "*" AND NOT EOF ("ZEINGANG")
         IF Datum.ZEINGANG >= von% AND Datum.ZEINGANG <= bis% THEN 
           Buchungen$(a%) = PAD$ (VS_Nr.ZEINGANG,30) + CHR$ (9) + PAD$ ( DATE$ (Datum.ZEINGANG,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + LTRIM$ ( STR$ (Betrag.ZEINGANG,",99999999.00")) + SPACE$ (20) + STR$ (CodeAZ.ZEINGANG,"000000")
           a% = a% + 1
         END IF 
         SELECT NEXT FILE "ZEINGANG" INDEX QuickVSNR.ZEINGANG
       WEND 
     END IF 
     IF opt&% = 2 THEN 
       INDEX CodeGE.ZEINGANG
       SELECT FIRST 
       SELECT KEY suge% FILE "ZEINGANG" INDEX CodeGE.ZEINGANG
       a% = 0
       WHILE CodeGE.ZEINGANG = suge% AND NOT EOF ("ZEINGANG")
         IF Datum.ZEINGANG >= von% AND Datum.ZEINGANG <= bis% THEN 
           Buchungen$(a%) = PAD$ (VS_Nr.ZEINGANG,30) + CHR$ (9) + PAD$ ( DATE$ (Datum.ZEINGANG,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + LTRIM$ ( STR$ (Betrag.ZEINGANG,",99999999.00")) + SPACE$ (20) + STR$ (CodeAZ.ZEINGANG,"000000")
           a% = a% + 1
         END IF 
         SELECT NEXT FILE "ZEINGANG" INDEX CodeGE.ZEINGANG
       WEND 
     END IF 
     IF opt&% = 3 THEN 
       INDEX CodeEingGE.ZEINGANG
       SELECT FIRST 
       SELECT KEY eingbei% FILE "ZEINGANG" INDEX CodeEingGE.ZEINGANG
       a% = 0
       WHILE CodeEingGE.ZEINGANG = eingbei% AND NOT EOF ("ZEINGANG")
         IF Datum.ZEINGANG >= von% AND Datum.ZEINGANG <= bis% THEN 
           Buchungen$(a%) = PAD$ (VS_Nr.ZEINGANG,30) + CHR$ (9) + PAD$ ( DATE$ (Datum.ZEINGANG,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + LTRIM$ ( STR$ (Betrag.ZEINGANG,",99999999.00")) + SPACE$ (20) + STR$ (CodeAZ.ZEINGANG,"000000")
           a% = a% + 1
         END IF 
         SELECT NEXT FILE "ZEINGANG" INDEX CodeEingGE.ZEINGANG
       WEND 
     END IF 
     IF a% <> 0 THEN 
       REM -- Prompt ermitteln
       prompt$ = Buchungen$(0)
       FOR b% = 1 TO a% - 1
         IF Buchungen$(b%) < prompt$ THEN prompt$ = Buchungen$(b%)
       NEXT b%
       IF opt&% = 1 THEN 
         caption$ = "Suche Åber Vertrags-/Policennummer..."
       ELSE 
         caption$ = "Suche Åber Gesellschaft..."
       END IF 
       MOUSE ON 
       CREATE DIALOG "DZ3",0,0,229,280,caption$,"MS Sans Serif",8
       ADD DIALOG "DZ3",4,0,0,229,255,0,""
       ADD DIALOG "DZ3",5,36,11,179,9,0,"Bitte wÑhlen Sie den gesuchten Zahlungseingang aus:"
       ADD DIALOG "DZ3",9,8,12,21,23,2
       ADD DIALOG "DZ3",5,6,27,209,9,0,"Vertragsnummer                   Datum                        Betrag"
       ADD DIALOG "DZ3",7,6,40,215,207,130,2,Buchungen$,Auswahl$,prompt$
       ADD DIALOG "DZ3",1,58,260,55,15,1,"&OK",1,1
       ADD DIALOG "DZ3",1,116,260,55,15,0,"&Abbrechen",0,0
       DIALOG "DZ3",req3%
       REMOVE DIALOG "DZ3"
       IF req3% = 1 THEN 
         cuzein% = VAL ( RIGHT$ (Auswahl$(0),6))
       END IF 
     ELSE 
       CALL Fehler("Es konnten keine entsprechenden ZahlungseingÑnge gefunden werden!","")
     END IF 
     FILE cfile$
   END IF 
 END IF 
 SELECT FORM KEY cuzein% FILE "ZEINGANG" INDEX CodeAZ.ZEINGANG
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' Aktivierung/Deaktivierung der Zahlungseingangskontrolle fÅr
 ' VertrÑge eines festgelegten Zeitraumes
 ' =======================================================================
 ' 25.10.95/AB
  
SUB ZEDeaktiv()
 IF disabled%("ZEINLoeschen") THEN END SUB 
 cfile$ = FILE 
 CALL DFile(3,"kvertrag" + _fpw$)
 von$ = cdat$
 bis$ = cdat$
 akVer$ = "n"
 CREATE DIALOG "Vzur",0,0,221,162,title$,"MS Sans Serif",8
 ADD DIALOG "Vzur",9,6,6,24,22,2
 ADD DIALOG "Vzur",5,34,8,170,9,0,"énderung der VertragsÅberwachung:"
 ADD DIALOG "Vzur",4,34,14,176,5,0,""
 ADD DIALOG "Vzur",5,34,22,175,33,0,"Bitte geben Sie ein, fÅr welchen Vertragsabschlu·- zeitraum (Vertragsbeginn) Sie die VertragsÅberwachung deaktivieren/aktivieren mîchten."
 ADD DIALOG "Vzur",5,45,63,12,8,0,"von"
 ADD DIALOG "Vzur",6,64,62,45,11,0,0,von$,10
 ADD DIALOG "Vzur",5,113,63,12,8,0,"bis"
 ADD DIALOG "Vzur",6,126,62,46,11,0,0,bis$,10
 ADD DIALOG "Vzur",5,34,85,175,33,0,"WÑhlen Sie aus, ob die entsprechenden VertrÑge aktiviert oder deaktiviert werden sollen."
 ADD DIALOG "Vzur",3,34,108,154,11,0,"ZahlungseingansÅberwachung deaktivieren","n",akVer$
 ADD DIALOG "Vzur",3,34,121,148,11,0,"ZahlungseingansÅberwachung aktivieren","j",akVer$
 ADD DIALOG "Vzur",1,53,141,55,15,1,"&Weiter",1,1
 ADD DIALOG "Vzur",1,113,141,55,15,0,"&Abbruch",0,0
 DIALOG "Vzur",req%
 REMOVE DIALOG "Vzur"
 MOUSE ON 
 IF req% = 1 THEN 
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "1.1.75" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
   FILE "Kvertrag"
   MOUSE OFF 
   IF akVer$ = "n" THEN 
     SET STATUS "ZahlungseingangsÅberwachung deaktivieren"
     UPDATE check.kvertrag = akver$ WHERE VS_Beginn.kvertrag >= DAYS (vondat$) AND VS_Beginn.kvertrag <= DAYS (bisdat$)
     END UPDATE 
     CLOSE FILE "KVERTRAG"
     CALL DFile(3,"KVERTRAG" + _fpw$)
   ELSE 
     SET STATUS "ZahlungseingangsÅberwachung aktivieren"
     UPDATE check.kvertrag = akver$ WHERE VS_Beginn.kvertrag >= DAYS (vondat$) AND VS_Beginn.kvertrag <= DAYS (bisdat$)
     END UPDATE 
     CLOSE FILE "KVERTRAG"
     CALL DFile(3,"KVERTRAG" + _fpw$)
   END IF 
   REQUEST "Bearbeitung beendet!"
 END IF 
 MOUSE ON 
 FILE cfile$
 SET STATUS ""
 END SUB 
 
 
 
 
 
 ' Verrechnung der ZahlungseingÑnge in der Vertragsdatei
 ' =======================================================================
 ' Parameter:   dask% - Abfrage vor Verrechnung anzeigen?
 '                 -1 = Abfrage anzeigen
 '                  0 = Abrechnung ohne Abfrage durchfÅhren
 
 
 
SUB ZEINBuchung(dask%)
 REM CALL DFile(3,"ZEINGANG" + _fpw$)
 MOUSE OFF 
 FILE "ZEINGANG"
 INDEX gebucht.ZEINGANG
 SELECT FIRST 
 SELECT KEY "" FILE "ZEINGANG" INDEX gebucht.ZEINGANG
 IF FOUND ("ZEINGANG") THEN 
   ok% = - 1
   IF dask% THEN 
     CREATE DIALOG "ZBuchung",0,0,255,107,"Zahlungseingang","MS Sans Serif",8
     ADD DIALOG "ZBuchung",4,0,0,254,84,0,""
     ADD DIALOG "ZBuchung",9,6,8,24,24,2
     ADD DIALOG "ZBuchung",5,38,9,210,19,0,"Im Zahlungseingang befinden sich BuchungssÑtze, die noch nicht verrechnet worden sind!"
     ADD DIALOG "ZBuchung",5,38,28,210,34,0,"Sie kînnen die Verrechnung jetzt oder zu einem spÑteren Zeitpunkt durchfÅhren lassen. Beim öbergehen der Verrechnung wird diese automatisch bei der nÑchsten Provisionsrechnung durchgefÅhrt."
     ADD DIALOG "ZBuchung",5,38,65,208,11,0,"Soll der Abgleich jetzt durchgefÅhrt werden?"
     ADD DIALOG "ZBuchung",1,70,88,55,15,1,"&Ja",1,1
     ADD DIALOG "ZBuchung",1,128,88,55,15,0,"&Nein",0,0
     DIALOG "ZBuchung",req%
     REMOVE DIALOG "ZBuchung"
     IF req% = 0 THEN ok% = 0
   END IF 
   IF ok% THEN 
     MOUSE OFF 
     FILE "ZEINGANG"
     INDEX gebucht.ZEINGANG
     SELECT FIRST LOCK 
     msg$ = "BuchungssÑtze werden abgeglichen!"
     SET STATUS msg$
     CALL Server("LOADMESSAGE","")
     CALL Server("MESSAGE","Bitte warten!" + CHR$ (13) + "Die Buchungsdatei wird mit der Vertragsdatei abgeglichen.")
     lok% = - 1
     WHILE lok%
       SELECT KEY CodeVT.ZEINGANG LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
       Pool% = (Pool.KVERTRAG + Betrag.ZEINGANG) * 100
       pool1$ = STR$ (pool%,"999999999999")
       poolges% = ( VAL (pool1$)) / 100
       pool.kvertrag = poolges%
       CALL QuickStore("KVERTRAG")
       gebucht.ZEINGANG = "j"
       CALL QuickStore("ZEINGANG")
       REM SET INDEX gebucht.ZEINGANG
       REM INDEX gebucht.ZEINGANG
       SELECT KEY "" LOCK FILE "ZEINGANG" INDEX gebucht.ZEINGANG
       IF NOT FOUND ("ZEINGANG") THEN lok% = 0
     WEND 
     CALL Server("UNLOADMESSAGE","")
     SET STATUS "Bereit"
   END IF 
 END IF 
 MOUSE ON 
 END SUB 
 
 
    
 
 
 
 '      **************************************
 '      ** Routinen fÅr Formular "BUCHUNG"  **
 '      ** (Zusatzbuchungen/Kontenkorrektur **
 '      **************************************
 '      13.10.94 
 
SUB ZBUCHUNG()
 IF disabled%("ZBUCHUNG") THEN END SUB 
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   ZBsub% = 0
   IF UCASE$ ( FORM ) <> "BUCHUNG" THEN 
     SET HEADING title$ + " - Buchungsdatei"
     OPEN FORM GPrjForm$ + "BUCHUNG"
     SET f = Superbase.Form
     FILE "BUCHUNG"
     INDEX CodeBU.BUCHUNG
     SELECT FORM LAST 
     CALL MNZBUCHUNG()
     MENU ON 
     SET STATUS "Buchungsdatei"
   END IF 
   REM CALL ZBUpdate()
   MOUSE ON 
   SELECT KEY CodeMA.buchung FILE "MAADR" INDEX CodeMA.maadr
   IF FOUND ("MAADR") THEN maadr$ = Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr ELSE maadr$ = "<keine Zuordnung>"
   IF GAgentDetail$ = "TRUE1" THEN 
     f.neu.visible = 0
     f.bearb.visible = 0
     f.saveit.visible = 0
     f.bmaadr.visible = 0
   ELSE 
     f.neu.visible = - 1
     f.bearb.visible = - 1
     f.saveit.visible = - 1
     f.bmaadr.visible = - 1
   END IF 
   FORM 
   CALL ClearKBDBuffer()
   IF ZBsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL BUPrev()
   CASE CrsRight%,PgDn%
     CALL BUNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZBsub%
   CASE 99
     MENU OFF 
     ENTER Datum.BUCHUNG,0
     MENU ON 
   END SELECT 
   ZBsub% = 0
 WEND 
 _formend% = 0
 END SUB 
 
SUB BUNeu()
 FILE "BUCHUNG"
 _cma% = CodeMA.BUCHUNG
 IF Buchungstext.BUCHUNG <> "" THEN 
   IF NEW ("BUCHUNG") OR MOD ("BUCHUNG") THEN CALL FStore("BUCHUNG")
 END IF 
 _cma% = GetCodeMA%(_cma%,Workstation%)
 IF _cma% <> 0 THEN 
   BLANK 
   SET STATUS "Datensatz neu angelegt..."
   Buchungstext.BUCHUNG = "Zusatzbuchung:"
   CodeMA.BUCHUNG = _cma%
   CodeBU.buchung = SER ("buchung",1)
   datum.buchung = TODAY 
   CALL FStore("BUCHUNG")
   ZBsub% = 99
 END IF 
 FORM 
 END SUB 
  
SUB BUNext()
 IF FileChanged%("BUCHUNG") = 1 THEN CALL FStore("BUCHUNG")
 SET INDEX CodeBU.BUCHUNG
 INDEX CodeBU.BUCHUNG
 CALL PSelectNext()
 FORM 
 END SUB 
 
SUB BUPrev()
 IF FileChanged%("BUCHUNG") = 1 THEN CALL FStore("BUCHUNG")
 SET INDEX CodeBU.BUCHUNG
 INDEX CodeBU.BUCHUNG
 CALL PSelectPrev()
 FORM 
 END SUB 
 
SUB BUSichern()
 CALL FStore("BUCHUNG")
 END SUB 
 
SUB BULoeschen()
 IF disabled%("BULoeschen") THEN END SUB 
 cubu% = CodeBU.BUCHUNG
 REQUEST "Buchungssatz wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   SELECT KEY cubu% LOCK FILE "BUCHUNG" INDEX CodeBU.BUCHUNG
   SELECT REMOVE FILE "BUCHUNG"
   SELECT NEXT FILE "BUCHUNG"
   FORM 
 END IF 
 FORM 
 END SUB 
 
SUB BUSuchen()
 _cubu% = CodeBU.BUCHUNG
 bu% = FindBuchung%(CodeMA.BUCHUNG)
 IF bu% <> 0 THEN 
   SELECT KEY bu% FILE "BUCHUNG" INDEX CodeBU.BUCHUNG
 END IF 
 END SUB 
 
 

 ' Buchungen in Buchungsdatei suchen
 ' =======================================================================
 ' 11.09.95  - Umstellung auf QuickCode
 ' 01.08.2004 Erweiterung
 
FUNCTION FindBuchung%(_ma%)
 cuge% = CodeMA.BUCHUNG
 cubu% = CodeBU.BUCHUNG
 von% = 0
 bis% = 0
 DIM LAgenturen$( RECCOUNT ("MAADR"))
 FILE "MAADR"
 INDEX CodeMA.MAADR
 SELECT FIRST 
 a% = 0
 fprompt$ = "ZZZZZZZZZZZZZZ"
 aprompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   LAgenturen$(a%) = Nachname.MAADR + ", " + Vorname.MAADR + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
   IF CodeMA.MAADR = _ma% THEN aprompt$ = LAgenturen$(a%)
   IF LAgenturen$(a%) < fprompt$ THEN fprompt$ = LAgenturen$(a%)
   a% = a% + 1
   SELECT NEXT FILE "MAADR" INDEX CodeMA.MAADR
 WEND 
 MOUSE ON 
 IF aprompt$ = "" THEN Auswahl$ = fprompt$ ELSE Auswahl$ = aprompt$
 CREATE DIALOG "BUSU",0,0,248,173,"Buchungssatz suchen","MS Sans Serif",8
 ADD DIALOG "BUSU",4,0,0,248,148,0,""
 ADD DIALOG "BUSU",9,10,16,21,21,2
 ADD DIALOG "BUSU",5,43,16,194,10,0,"Bitte wÑhlen Sie die Agentur und weitere Optionen aus:"
 ADD DIALOG "BUSU",5,43,30,194,24,0,"Mit der SchaltflÑche " + CHR$ (34) + "Liste" + CHR$ (34) + " kînnen Sie einen Buchungssatz aus der letzten Ergebnisliste auswÑhlen."
 ADD DIALOG "BUSU",5,43,59,29,10,0,"Agentur:"
 ADD DIALOG "BUSU",8,43,71,142,68,256 + 3,2,Auswahl$,LAgenturen$
 ADD DIALOG "BUSU",2,43,95,173,11,0,"nur Zusatzbuchungen suchen",1,0,opt%
 ADD DIALOG "BUSU",5,43,113,63,10,0,"Buchungszeitraum:"
 ADD DIALOG "BUSU",6,61,126,41,12,0,0,von$,10
 ADD DIALOG "BUSU",6,130,126,41,12,0,0,bis$,10
 ADD DIALOG "BUSU",5,43,128,17,10,0,"von:"
 ADD DIALOG "BUSU",5,115,128,14,10,0,"bis:"
 REM ADD DIALOG "BUSU",1,33,153,55,15,0,"&Liste",2,1
 ADD DIALOG "BUSU",1,50,153,55,15,1,"&OK",1,1
 ADD DIALOG "BUSU",1,107,153,55,15,0,"&Abbrechen",0,0
 
 DIALOG "BUSU",req%
 REMOVE DIALOG "BUSU"
 IF req% = 1 THEN 
   MOUSE OFF 
   SET STATUS "Suche BuchungssÑtze..."
   IF RECCOUNT ("BUCHUNG") > 20000 THEN 
     REDIM BSatz$(20000,1)
     REDIM BSatz$(20000)
     brec% = 20000
   ELSE 
     REDIM BSatz$( RECCOUNT ("BUCHUNG"),1)
     REDIM BSatz$( RECCOUNT ("BUCHUNG"))
     brec% = RECCOUNT ("BUCHUNG")
   END IF 
   REM FOR a% = 0 TO brec%:BSatz$(a%) = "":NEXT a%
   IF von$ = "" THEN 
     von% = DAYS ("1.1.1980")
   ELSE 
    von% = DAYS (von$)
   END IF 
   IF bis$ = "" THEN 
     bis% = DAYS ( TODAY )
   ELSE 
    bis% = DAYS (bis$)
  END IF 
  vondat$ = DATE$ (von%,"0d.mm.yyyy")
  bisdat$ = DATE$ (bis%,"0d.mm.yyyy")
  _ma% = VAL ( RIGHT$ (Auswahl$,6))
   IF _ma% > 0 THEN 
     
     SELECT KEY _ma% FILE "MAADR" INDEX CodeMA.MAADR
     caption$ = "BuchungssÑtze von " + Nachname.MAADR + ", " + Vorname.MAADR
   ELSE 
     caption$ = "BuchungssÑtze alle Mitarbeiter "
   END IF 
   IF _ma% > 0 THEN 
     FILE "BUCHUNG"
     INDEX QuickCode.BUCHUNG
     SELECT FIRST 
     qc$ = STR$ (_ma%,"000000") + DATE$ (von%,"yyyymm0d")
     SELECT KEY qc$ FILE "BUCHUNG" INDEX QuickCode.BUCHUNG
     a% = 0
     WHILE CodeMA.BUCHUNG = _ma% AND Datum.BUCHUNG <= bis% AND NOT EOF ("BUCHUNG")
       ok% = 1
       IF opt% = 1 AND Provision.BUCHUNG LIKE "j" THEN ok% = 0
       IF ok% = 1 THEN 
         SET STATUS "Suche BuchungssÑtze...(" + LTRIM$ ( STR$ (a%,"99999999")) + " gefunden)"
         BSatz$(a%) = DATE$ (Datum.BUCHUNG,"0d.mm.yyyy") + "   " + LTRIM$ ( STR$ (Betrag.BUCHUNG,"-,99999999.00")) + "   " + Buchungstext.BUCHUNG + SPACE$ (120) + STR$ (CodeBU.BUCHUNG,"00000000")
         a% = a% + 1
       END IF 
       SELECT NEXT FILE "BUCHUNG" INDEX QuickCode.BUCHUNG
     WEND 
   ELSE 
     FILE "BUCHUNG"
     INDEX Datum.BUCHUNG
     SELECT FIRST 
     REM qc$ = DATE$ (von%,"yyyymm0d")
     SELECT KEY von% FILE "BUCHUNG" INDEX Datum.BUCHUNG
     a% = 0
     WHILE Datum.BUCHUNG <= bis% AND NOT EOF ("BUCHUNG")
       ok% = 1
       IF opt% = 1 AND Provision.BUCHUNG LIKE "j" THEN ok% = 0
       IF ok% = 1 THEN 
         SET STATUS "Suche BuchungssÑtze...(" + LTRIM$ ( STR$ (a%,"99999999")) + " gefunden)"
         BSatz$(a%) = DATE$ (Datum.BUCHUNG,"0d.mm.yyyy") + "   " + LTRIM$ ( STR$ (Betrag.BUCHUNG,"-,99999999.00")) + "   " + Buchungstext.BUCHUNG + SPACE$ (120) + STR$ (CodeBU.BUCHUNG,"00000000")
         a% = a% + 1
       END IF 
       SELECT NEXT FILE "BUCHUNG" INDEX Datum.BUCHUNG
     WEND 
   END IF 
   IF a% = 0 THEN 
     CALL Fehler("Keine BuchungssÑtze gefunden!","")
   ELSE 
     MOUSE ON 
     CREATE DIALOG "BUliste",0,0,346,293,caption$,"MS Sans Serif",8
     ADD DIALOG "BUliste",4,0,0,344,268,0,""
     ADD DIALOG "BUliste",9,6,9,20,21,2
     ADD DIALOG "BUliste",5,33,11,219,9,0,"Bitte wÑhlen Sie den gewÅnschen Buchungssatz aus der Liste aus:"
     ADD DIALOG "BULISTe",7,33,24,303,237,0,2,BSatz$,Auswahl$,BSatz$(0)
     
     ADD DIALOG "BUliste",1,172,273,55,14,0,"&Abbrechen",0,0
     ADD DIALOG "BUliste",1,231,273,54,14,1,"Druck",2,1
     ADD DIALOG "BUliste",1,113,273,54,14,1,"&OK",1,1
     DIALOG "BUListe",req%
     REMOVE DIALOG "BULISTE"
     IF req% = 1 THEN 
       _cubu% = VAL ( RIGHT$ (Auswahl$(0),8))
       FindBuchung% = _cubu%
     ELSE 
       FindBuchung% = 0
     END IF 
     IF req% = 2 THEN 
       IF opt% = 1 THEN 
         allprov$ = "n"
         CALL LISTPRVEs(vondat$,bisdat$,allprov$,1,"LISTPRVE",0)
       ELSE 
         allprov$ = "j"
         CALL LISTPRVEs(vondat$,bisdat$,allprov$,1,"LISTPRVE",0)
       END IF 
     END IF 
   END IF 
 END IF 
 IF req% = 2 THEN 
   IF BSatz$(0) = "" THEN 
     CALL Fehler("Keine BuchungssÑtze in Ergebnisliste!","")
   ELSE 
     CREATE DIALOG "BUliste",0,0,366,293,"Auswahl Buchungssatz","MS Sans Serif",8
     ADD DIALOG "BUliste",4,0,0,364,268,0,""
     ADD DIALOG "BUliste",9,6,9,20,21,2
     ADD DIALOG "BUliste",5,33,11,219,9,0,"Bitte wÑhlen Sie den gewÅnschen Buchungssatz aus der Liste aus:"
     ADD DIALOG "BULISTe",7,33,24,323,237,2,2,BSatz$,Auswahl$,BSatz$(0)
     ADD DIALOG "BUliste",1,123,273,54,14,1,"&OK",1,1
     ADD DIALOG "BUliste",1,182,273,55,14,0,"&Abbrechen",0,0
     DIALOG "BUListe",req%
     REMOVE DIALOG "BULISTE"
     IF req% = 1 THEN 
       _cubu% = VAL ( RIGHT$ (Auswahl$(0),8))
       FindBuchung% = _cubu%
     ELSE 
       FindBuchung% = 0
     END IF 
   END IF 
 END IF 
 FILE "BUCHUNG"
 INDEX CodeBU.BUCHUNG
 SELECT KEY cubu% FILE "BUCHUNG" INDEX CodeBU.BUCHUNG
 MOUSE ON 
 END FUNCTION 
 
 
 
 'Ausgabe Provisionsliste spezial fÅr alle Agenturen mit Euro und Bewertungssumme
SUB LISTPRVEs(von$,bis$,allprov$,bewert%,repname$,reqtdru%)
 IF reqtdru% = 0 THEN 
   dat$ = "Buchung"
   CALL PRep(repname$)
 ELSE 
   dat$ = "B1"
   repname1$ = LEFT$ (repname$,1) + "1" + MID$ (repname$,3)
   CALL PRep(repname1$)
 END IF 
 FILE dat$
 REM CALL PRep(repname$)
 REPORT ON BetragEU.dat$ AS "SSumAgentur%",SREU.dat$ AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%",BewertungssumEU.dat$ AS "SSumBEW%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung in EURO "
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.dat$ AS "SumAgentur%",SREU.dat$ AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.dat$ AS "SumEinh%",BewertungssumEU.dat$ AS "SumBEW%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.dat$
 BEFORE GROUP Datum.dat$
   IF reqtdru% = 0 THEN 
     SET REPORT PAGE "H_Datum.BUCH003"
   ELSE 
     SET REPORT PAGE "H_Datum.B1003"
   END IF 
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPROVL010820041
   IF allProv$ = "j" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
   IF allProv$ = "n" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Provision.dat$ <> "j"
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Provision.dat$ <> "j" AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
ErrPROVL010820041: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 
 
 
 
 
 
 '      *****************************************
 '      ** Routinen fÅr Programmteil "BUCHUNG" **
 '      *****************************************
 
SUB BUCHUNG()
 IF disabled%("BUCHUNG") THEN END SUB 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vorgang" + _fpw$)
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"aumskto" + _fpw$)
 IF PRVCHECKLISTE$ = "TRUE" THEN CALL DFile(3,"buchmon" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF title$ LIKE "*Agentur*" THEN 
   CALL Fehler("Diese Funktion kann in der Agenturvariante nicht genutzt werden!","")
   END SUB 
 END IF 
 SET STATUS "Buchungen/Provisionierung"
 opt% = 1
 IF MAKLER$ = "TRUE" THEN 
   CALL DFile(3,"STAMM" + _fpw$)
   CALL DFile(3,"INKSTAMM" + _fpw$)
   CALL DFile(3,"KUKTO" + _fpw$)
   FILE "INKSTAMM"
   INDEX InkDatum.inkstamm
   SELECT LAST 
   datlastink$ = DATE$ (inkDatum,"0d.mm.yyyy")
   IF LTRIM$ (datlastink$) = "" THEN datlastink$ = "keine Angaben"
 END IF 
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
   IF GASP% THEN 
     IF workstation% = 0 THEN 
       CREATE DIALOG "BUCHUNG",0,0,289,220,"Buchungsdatei/Provisionsrechnung","MS Sans Serif",8
       ADD DIALOG "BUCHUNG",9,8,8,22,22,2
       ADD DIALOG "BUCHUNG",5,25,9,124,10,0,"Bitte wÑhlen Sie die Funktion, die Sie"
       ADD DIALOG "BUCHUNG",5,25,19,73,9,0,"durchfÅhren mîchten:"
       ADD DIALOG "BUCHUNG",4,25,29,178,82,0,""
       ADD DIALOG "BUCHUNG",5,29,39,70,9,0,"Buchungsfunktionen:"
       ADD DIALOG "BUCHUNG",4,25,109,178,102,0,""
       ADD DIALOG "BUCHUNG",5,29,119,107,10,0,"Listen/öbersichten:"
       ADD DIALOG "BUCHUNG",3,29,49,153,10,0,"monatliche Provisionsbuchung",1,opt%
       IF PRVCHECKLISTE$ <> "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrekturbuchung",2,opt%
       IF PRVCHECKLISTE$ = "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrektur letzte Abrechnung",2,opt%
       ADD DIALOG "BUCHUNG",3,29,69,153,10,0,"Erfassung von zusÑtzlichen Buchung",5,opt%
       ADD DIALOG "BUCHUNG",3,29,79,155,10,0,"Nachbearbeitung von BuchungssÑtzen",9,opt%
       ADD DIALOG "BUCHUNG",3,29,89,155,10,0,"Vorausberechnungen fÅr Mitarbeiter",10,opt%
       IF GPKCO$ = "TRUE" THEN ADD DIALOG "BUCHUNG",3,29,99,155,10,0,"Vorausberechnungen fÅr Firma",11,opt%
 
       ADD DIALOG "BUCHUNG",3,29,129,153,10,0,"Ausgabe der Provisionsabrechnung",6,opt%
       ADD DIALOG "BUCHUNG",3,29,139,163,10,0,"Provisionsabrechnung fÅr eine einzelne Agentur",3,opt%

       ADD DIALOG "BUCHUNG",3,29,149,153,10,0,"Statistik neu hochrechnen",200,opt%

       ADD DIALOG "BUCHUNG",3,29,159,153,10,0,"Summenliste Produktion Agenturen",100,opt%
       ADD DIALOG "BUCHUNG",3,29,169,153,10,0,"Produktionsstatistiken gesamt",300,opt%
       ADD DIALOG "BUCHUNG",3,29,179,153,10,0,"Produktionsstatistiken monatlich",301,opt%
       ADD DIALOG "BUCHUNG",3,29,189,153,10,0,"Export Provision nach MS Excel",202,opt%
       IF GUeberweislist$ LIKE "TRUE" THEN ADD DIALOG "BUCHUNG",3,29,199,153,10,0,"ProvisionsÅberweisungsliste",302,opt%

       IF PRVCHECKLISTE$ = "TRUE" THEN ADD DIALOG "BUCHUNG",1,208,35,75,16,0,"Vorschlagsliste",4,0
       IF MAKLER$ = "TRUE" THEN 
         ADD DIALOG "BUCHUNG",1,208,5,75,16,0,"Inkasso durchfÅhren",5,0
         ADD DIALOG "BUCHUNG",5,215,23,70,9,0,"letztes Inkasso:"
         ADD DIALOG "BUCHUNG",5,215,33,70,9,0,datlastink$
       END IF 
       ADD DIALOG "BUCHUNG",1,208,55,75,16,0,"&Kopf-/Fu·zeile",2,0
       ADD DIALOG "BUCHUNG",1,208,75,74,15,0,"&Fehlerprotokoll",3,0
       ADD DIALOG "BUCHUNG",1,208,105,75,16,1,"&OK",1,1
       ADD DIALOG "BUCHUNG",1,208,125,74,15,0,"&Abbrechen",0,0
       DIALOG "BUCHUNG",req%
       REMOVE DIALOG "BUCHUNG"
     ELSE 
       CREATE DIALOG "BUCHUNG",0,0,289,178,"Buchungsdatei/Provisionsrechnung","MS Sans Serif",8
       ADD DIALOG "BUCHUNG",9,8,8,22,22,2
       ADD DIALOG "BUCHUNG",5,25,9,124,10,0,"Bitte wÑhlen Sie die Funktion, die Sie"
       ADD DIALOG "BUCHUNG",5,25,19,73,9,0,"durchfÅhren mîchten:"
       ADD DIALOG "BUCHUNG",4,25,29,178,82,0,""
       ADD DIALOG "BUCHUNG",5,29,39,70,9,0,"Buchungsfunktionen:"
       ADD DIALOG "BUCHUNG",4,25,109,178,62,0,""
       ADD DIALOG "BUCHUNG",5,29,119,67,10,0,"Listen/öbersichten:"
       REM ADD DIALOG "BUCHUNG",3,29,49,153,10,0,"monatliche Provisionsbuchung",1,opt%
       REM IF PRVCHECKLISTE$ <> "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrekturbuchung",2,opt%
       REM IF PRVCHECKLISTE$ = "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrektur letzte Abrechnung",2,opt%
       REM ADD DIALOG "BUCHUNG",3,29,69,153,10,0,"Erfassung von zusÑtzlichen Buchung",5,opt%
       REM ADD DIALOG "BUCHUNG",3,29,79,155,10,0,"Nachbearbeitung von BuchungssÑtzen",9,opt%
       ADD DIALOG "BUCHUNG",3,29,89,155,10,0,"Vorausberechnungen fÅr Mitarbeiter",10,opt%
       REM IF GPKCO$ = "TRUE" THEN ADD DIALOG "BUCHUNG",3,29,99,155,10,0,"Vorausberechnungen fÅr Firma",11,opt%
 
       REM ADD DIALOG "BUCHUNG",3,29,129,153,10,0,"Ausgabe der Provisionsabrechnung",6,opt%
       ADD DIALOG "BUCHUNG",3,29,139,163,10,0,"Provisionsabrechnung fÅr eine einzelne Agentur",3,opt%
 
       REM ADD DIALOG "BUCHUNG",3,29,149,153,10,0,"Statistik neu hochrechnen",200,opt%
 
       ADD DIALOG "BUCHUNG",3,29,159,153,10,0,"Summenliste Produktion Agenturen",100,opt%
 
       REM IF PRVCHECKLISTE$ = "TRUE" THEN ADD DIALOG "BUCHUNG",1,208,35,75,16,0,"Vorschlagsliste",4,0
       IF MAKLER$ = "TRUE" THEN 
         REM ADD DIALOG "BUCHUNG",1,208,5,75,16,0,"Inkasso durchfÅhren",5,0
         REM ADD DIALOG "BUCHUNG",5,215,23,70,9,0,"letztes Inkasso:"
         REM ADD DIALOG "BUCHUNG",5,215,33,70,9,0,datlastink$
       END IF 
       ADD DIALOG "BUCHUNG",1,208,55,75,16,0,"&Kopf-/Fu·zeile",2,0
       REM ADD DIALOG "BUCHUNG",1,208,75,74,15,0,"&Fehlerprotokoll",3,0
       ADD DIALOG "BUCHUNG",1,208,105,75,16,1,"&OK",1,1
       ADD DIALOG "BUCHUNG",1,208,125,74,15,0,"&Abbrechen",0,0
       DIALOG "BUCHUNG",req%
       REMOVE DIALOG "BUCHUNG"
     END IF 
   ELSE 
     CREATE DIALOG "BUCHUNG",0,0,289,219,"Buchungsdatei/Provisionsrechnung","MS Sans Serif",8
     ADD DIALOG "BUCHUNG",9,8,8,22,22,2
     ADD DIALOG "BUCHUNG",5,25,9,124,10,0,"Bitte wÑhlen Sie die Funktion, die Sie"
     ADD DIALOG "BUCHUNG",5,25,19,73,9,0,"durchfÅhren mîchten:"
     ADD DIALOG "BUCHUNG",4,25,29,178,82,0,""
     ADD DIALOG "BUCHUNG",5,29,39,70,9,0,"Buchungsfunktionen:"
     ADD DIALOG "BUCHUNG",4,25,109,178,102,0,""
     ADD DIALOG "BUCHUNG",5,29,119,67,10,0,"Listen/öbersichten:"
     ADD DIALOG "BUCHUNG",3,29,49,153,10,0,"monatliche Provisionsbuchung",1,opt%
     IF PRVCHECKLISTE$ <> "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrekturbuchung",2,opt%
     IF PRVCHECKLISTE$ = "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrektur letzte Abrechnung",2,opt%
     ADD DIALOG "BUCHUNG",3,29,69,153,10,0,"Erfassung von zusÑtzlichen Buchung",5,opt%
     ADD DIALOG "BUCHUNG",3,29,79,155,10,0,"Nachbearbeitung von BuchungssÑtzen",9,opt%
     ADD DIALOG "BUCHUNG",3,29,89,155,10,0,"Vorausberechnungen fÅr Mitarbeiter",10,opt%
     IF GPKCO$ = "TRUE" THEN ADD DIALOG "BUCHUNG",3,29,99,155,10,0,"Vorausberechnungen fÅr Firma",11,opt%
 
     ADD DIALOG "BUCHUNG",3,29,129,153,10,0,"Ausgabe der Provisionsliste - alle Agenturen",6,opt%
     ADD DIALOG "BUCHUNG",3,29,139,163,10,0,"Provisionsliste fÅr eine einzelne Agentur",3,opt%
 
     ADD DIALOG "BUCHUNG",3,29,149,153,10,0,"Statistik neu hochrechnen",200,opt%
 
     ADD DIALOG "BUCHUNG",3,29,159,153,10,0,"Summenliste Produktion Agenturen",100,opt%

     ADD DIALOG "BUCHUNG",3,29,169,153,10,0,"Produktionsstatistiken gesamt",300,opt%
     ADD DIALOG "BUCHUNG",3,29,179,153,10,0,"Produktionsstatistiken monatlich",301,opt%
     ADD DIALOG "BUCHUNG",3,29,189,153,10,0,"Export Provision nach MS Excel",202,opt%
     IF GUeberweislist$ LIKE "TRUE" THEN ADD DIALOG "BUCHUNG",3,29,199,153,10,0,"ProvisionsÅberweisungsliste",302,opt%



     IF PRVCHECKLISTE$ = "TRUE" THEN ADD DIALOG "BUCHUNG",1,208,35,75,16,0,"Vorschlagsliste",4,0
     IF MAKLER$ = "TRUE" THEN 
       ADD DIALOG "BUCHUNG",1,208,5,75,16,0,"Inkasso durchfÅhren",5,0
       ADD DIALOG "BUCHUNG",5,215,23,70,9,0,"letztes Inkasso:"
       ADD DIALOG "BUCHUNG",5,215,33,70,9,0,datlastink$
     END IF 
     ADD DIALOG "BUCHUNG",1,208,55,75,16,0,"&Kopf-/Fu·zeile",2,0
     ADD DIALOG "BUCHUNG",1,208,75,74,15,0,"&Fehlerprotokoll",3,0
     ADD DIALOG "BUCHUNG",1,208,105,75,16,1,"&OK",1,1
     ADD DIALOG "BUCHUNG",1,208,125,74,15,0,"&Abbrechen",0,0
     DIALOG "BUCHUNG",req%
     REMOVE DIALOG "BUCHUNG"
   END IF 
 ELSE 
 
 END IF 
 IF req% = 1 THEN 
   SELECT CASE opt%
   CASE 302
     CALL CreBuMaMon()
   CASE 301
     REM Prodstatistik monatl
     CALL SUFP4mon()
   CASE 300
     REM Prodstatistik gesamt
     CALL SUFP1()
   CASE 202
     CALL ExpProvli()
   CASE 200
     CALL StatistMen()
   CASE 1
     REM 170897
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       IF PRVCHECKLISTE$ = "TRUE" THEN 
         REQUEST "Wollen Sie eine neue Abrechnung starten?","Dadurch wird die vorhergehende Abrechnung abgeschlossen!",130,req1ab1%
         IF req1ab1% = 1 THEN 
           zwtext$ = "Sie erhalten anschlie·end die Mîglichkeit diejenigen VertrÑge festzulegen, die tatsÑchlich ausgezahlt werden sollen!"
           CALL Fehler("Es wird jetzt zunÑchst eine Liste der jenigen VertrÑge erstellt, die diesen Monat zur Auszahlung gelangen kînnen!",zwtext$)
           CALL DFile(3,"buchmon" + _fpw$)
           REMOVE FROM FILE "buchmon"
           REM erzeugen einer Vertragsvorschlagsliste zur Provisionsberechnung
           CALL ProvCheck()
           CALL CheckAbgl()
         END IF 
 
       ELSE 
         REM CALL PROVBUCHUNG(0)
         REQUEST "Soll im Anschlu· and die Provisionsberechnung","die Statistik neu hochgerechnet werden?",135,Greqstati%
         CALL PROVBUCHUNG(0)
         IF Greqstati% = 1 THEN 
           CALL StatistRefr(0)
           CREATE DIALOG "PROT",0,0,244,154,title$,"MS Sans Serif",8
           ADD DIALOG "PROT",4,0,0,244,130,0,""
           ADD DIALOG "PROT",9,6,9,22,22,2
           ADD DIALOG "PROT",5,35,13,194,10,0,"WÑhrend der zuletzt durchgefÅhrten Aktion wurde eine"
           ADD DIALOG "PROT",5,35,23,194,10,0,"Protokolldatei erstellt, in der eventuelle Fehler und Zusatz-"
           ADD DIALOG "PROT",5,35,33,194,10,0,"information gespeichert wurden."
           ADD DIALOG "PROT",5,35,53,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Ja" + CHR$ (34) + ", wenn Sie das Protokoll einsehen und"
           ADD DIALOG "PROT",5,35,63,194,10,0,"eventuell drucken wollen."
           ADD DIALOG "PROT",5,35,83,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Nein" + CHR$ (34) + ", wenn Sie das Protokoll nicht"
           ADD DIALOG "PROT",5,35,93,194,10,0,"einsehen mîchten."
           ADD DIALOG "PROT",5,35,113,194,10,0,"Wollen Sie das Protokoll einsehen?"
           ADD DIALOG "PROT",1,118,134,55,15,0,"&Nein",0,0
           ADD DIALOG "PROT",1,62,134,55,15,1,"&Ja",1,1
           DIALOG "PROT",req%
           REMOVE DIALOG "PROT"
           IF req% = 1 THEN CALL ShowLog()
         END IF 
 
       END IF 
     ELSE 
       CALL PROVBUZEIN()
     END IF 
   CASE 2
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       IF PRVCHECKLISTE$ <> "TRUE" THEN 
         CALL BUKORREKTUR()
       ELSE 
         CALL Fehler("Es erfolgt die Korrektur der letzten Abrechnung!","Hierzu werden die erzeugten BuchungssÑtze gelîscht!")
         REQUEST "Wollen Sie die Korrektur durchfÅhren?","",130,req1ab2%
         IF req1ab2% = 1 THEN 
           FILE "buchung"
           INDEX codebumon.buchung
           SELECT FIRST 
           FILE "kvertrag"
           INDEX lfdnr.kvertrag
           SELECT FIRST 
           FILE "buchmon"
           INDEX codebumon.buchmon
           SELECT WHERE FILE "buchmon"
           SELECT FIRST 
           codevt% = codevt.buchmon
           WHILE NOT EOF ("buchmon")
             codebumon$ = codebumon.buchmon
             codevt% = codevt.buchmon
             IF EXISTS (codebumon$,codebumon.buchung) THEN 
               ok% = 1
               SELECT FIRST FILE "Buchung"
               IF EXISTS (codebumon$,codebumon.buchung) THEN 
                 SELECT KEY codebumon$ LOCK FILE "buchung" INDEX codebumon.buchung
               ELSE 
                 SELECT LAST 
                 ok% = 0
               END IF 
               WHILE NOT EOF ("Buchung") AND ok% = 1
                 FILE "Buchung"
                 IF codevt.buchung = codevt% AND codebumon.buchmon = codebumon$ THEN 
                   srb% = sr.buchung
                   einheit% = einheiten.buchung
                   IF srb% <> 0 OR einheit% <> 0 THEN 
                     ma% = Codema.buchung
                     FILE "maadr"
                     INDEX codema.maadr
                     SELECT FIRST 
                     SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
                     IF srb% <> 0 THEN Stornoreserve.maadr = stornoreserve.maadr - srb%
                     IF einheit% <> 0 THEN Einheiten.maadr = einheiten.maadr - einheit%
                     REM Workstation.maadr = Workstation%
                     REM QWoNo.maadr = STR$ (Workstation%,"000000") + STR$ (codema.maadr,"000000")
                     RecStatus.maadr = "c"
                     STORE FILE "maadr"
                   END IF 
                 END IF 
                 FILE "Buchung"
                 IF EXISTS (codebumon$,codebumon.buchung) THEN 
                   SELECT REMOVE FILE "Buchung"
                 END IF 
                 SELECT FIRST FILE "Buchung"
                 IF EXISTS (codebumon$,codebumon.buchung) THEN 
                   SELECT KEY codebumon$ LOCK FILE "buchung" INDEX codebumon.buchung
                 ELSE 
                   SELECT LAST FILE "Buchung"
                   ok% = 0
                 END IF 
               WEND 
               REM REMOVE FROM FILE "buchung" WHERE codebumon.buchung = codebumon$
               FILE "kvertrag"
               SELECT FIRST FILE "kvertrag"
               SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
               letzteprovi.kvertrag = letzteProvi.buchmon
               REM 281199
               CALL QuickStore("kvertrag")
               
             END IF 
             FILE "buchmon"
             SELECT NEXT FILE "buchmon" INDEX codebumon.buchmon
           WEND 
           t$ = "Es wird jetzt zunÑchst eine Liste der jenigen VertrÑge erstellt, die diesen Monat zur Auszahlung gelangen kînnen!"
           CALL Fehler(t$,"Sie erhalten anschlie·end die Mîglichkeit diejenigen VertrÑge festzulegen,die tatsÑchlich ausgezahlt werden sollen!")
           CALL DFile(3,"buchmon" + _fpw$)
           REMOVE FROM FILE "buchmon"
           REM erzeugen einer Vertragsvorschlagsliste zur Provisionsberechnung
           CALL ProvCheck()
           CALL CheckAbgl()
         END IF 
       END IF 
     ELSE 
       CALL BUKORREKZE()
     END IF 
   CASE 3
      IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL UEBERSAG1()
     ELSE 
       CALL UEBERSAG1Z()
     END IF 
   CASE 4
      IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL UEBERSAG2()
     ELSE 
       CALL UEBERSAG2Z()
     END IF 
   CASE 5
     CALL ZUSATZBU()
   CASE 6
      IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL PROVILIST()
     ELSE 
       CALL PROVILISTZ()
     END IF 
   CASE 7
     CALL DRCONFIG()
   CASE 8
     CALL ShowLog()
   CASE 9
     CALL ZBUCHUNG()
   CASE 10
     'Vorausberechnung fÅr Alle
     CALL Vorausber(0)
   CASE 11
     'Vorausberechnung fÅr Firma
     CALL Vorausber(1)
   CASE 100
     REM Summenliste alle Agenturen
     CALL SummAlleAgent()
   END SELECT 
 END IF 
 _formend% = 0
 IF req% = 2 THEN CALL DRCONFIG()
 IF req% = 3 THEN CALL ShowLog()
 IF req% = 4 THEN CALL CheckAbgl()
 IF req% = 5 THEN CALL Inkasso()
 SET HEADING title$ + " - HauptÅbersicht"
 SET STATUS "Bereit"
 END SUB 
 
 
 ' Kopf- und Fu·zeilen bearbeiten
 ' =======================================================================
 
SUB DRCONFIG()
 Kopfzeile$ = ""
 FOR z% = 1 TO 10
   in$ = ReadConfig$("PROVIS","Header" + LTRIM$ ( STR$ (z%,"99")))
   IF in$ <> "" AND in$ <> "leer" THEN 
     IF Kopfzeile$ = "" THEN 
       Kopfzeile$ = in$
     ELSE 
       Kopfzeile$ = Kopfzeile$ + CHR$ (13) + CHR$ (10) + in$
     END IF 
   END IF 
 NEXT z%
 Fu·zeile$ = ""
 FOR z% = 1 TO 10
   in$ = ReadConfig$("PROVIS","Footer" + LTRIM$ ( STR$ (z%,"99")))
   IF in$ <> "" AND in$ <> "leer" THEN 
     IF Fu·zeile$ = "" THEN 
       Fu·zeile$ = in$
     ELSE 
       Fu·zeile$ = Fu·zeile$ + CHR$ (13) + CHR$ (10) + in$
     END IF 
   END IF 
 NEXT z%
 
 CREATE DIALOG "DRCONFIG",0,0,260,177,"Kopf-/Fu·zeile bearbeiten","Arial",10
 ADD DIALOG "DRCONFIG",9,5,11,20,22,2
 ADD DIALOG "DRCONFIG",5,33,14,213,9,0,"&Kopfzeile:"
 ADD DIALOG "DRCONFIG",6,33,25,220,67,68,2,Kopfzeile$,4000
 ADD DIALOG "DRCONFIG",5,33,100,213,9,0,"&Fu·zeile:"
 ADD DIALOG "DRCONFIG",6,33,112,220,35,68,2,Fu·zeile$,4000
 ADD DIALOG "DRCONFIG",1,140,158,55,14,0,"&OK",1,1
 ADD DIALOG "DRCONFIG",1,198,158,55,14,0,"&Abbrechen",0,0
 DIALOG "DRCONFIG",req%
 REMOVE DIALOG "DRCONFIG"
 IF req% = 1 THEN 
   MOUSE OFF 
   REM Kopfzeile$ = FN ansi(Kopfzeile$)
   ok% = 1
   start% = 1
   ende% = 0
   WHILE ok% > 0
     ende% = INSTR (start%,kopfzeile$, CHR$ (13) + CHR$ (10))
     IF ende% <> 0 THEN 
       CALL WriteConfig("PROVIS","Header" + LTRIM$ ( STR$ (ok%,"999")), MID$ (Kopfzeile$,start%,ende% - start%))
       ok% = ok% + 1
       start% = ende% + 2
     ELSE 
       IF start% < LEN (Kopfzeile$) THEN 
         CALL WriteConfig("PROVIS","Header" + LTRIM$ ( STR$ (ok%,"999")), MID$ (Kopfzeile$,start%, LEN (Kopfzeile$) - start% + 1))
         ok% = ok% + 1
       END IF 
       FOR z% = ok% TO 10 STEP 1
         CALL WriteConfig("PROVIS","Header" + LTRIM$ ( STR$ (z%,"999")),"")
       NEXT z%
       ok% = 0
     END IF 
   WEND 
   ok% = 1
   start% = 1
   ende% = 0
   WHILE ok% > 0
     ende% = INSTR (start%,fu·zeile$, CHR$ (13) + CHR$ (10))
     IF ende% <> 0 THEN 
       CALL WriteConfig("PROVIS","Footer" + LTRIM$ ( STR$ (ok%,"999")), MID$ (Fu·zeile$,start%,ende% - start%))
       ok% = ok% + 1
       start% = ende% + 2
     ELSE 
       IF start% < LEN (Fu·zeile$) THEN 
         CALL WriteConfig("PROVIS","Footer" + LTRIM$ ( STR$ (ok%,"999")), MID$ (Fu·zeile$,start%, LEN (Fu·zeile$) - start% + 1))
         ok% = ok% + 1
       END IF 
       FOR z% = ok% TO 10 STEP 1
         CALL WriteConfig("PROVIS","Footer" + LTRIM$ ( STR$ (z%,"999")),"")
       NEXT z%
       ok% = 0
     END IF 
   WEND 
 END IF 
 MOUSE ON 
 END SUB 
 
 
 
 
 
  
 
 
SUB MNBUCHK()
 MENU CLEAR 
 CALL MNProgramm()
 CALL MNHilfe(2)
 END SUB 
 
SUB BUCHKIntro()
 MOUSE OFF 
 FILE "BUCHMON"
 INDEX CodeBU.BUCHMON
 REM 020798 SELECT FORM LAST 
 FORM 
 END SUB 
 
SUB BUCHKUpdate()
 SELECT KEY CodeVT.BUCHMON FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 REM kondart% = kondart.zeingan1
 REM SELECT KEY CodeMA.BUCHMON FILE "MAADR" INDEX CodeMA.MAADR
 REM SELECT KEY CodeGE.BUCHMON FILE "GEADR" INDEX CodeGE.GEADR
 REM SELECT KEY CodeVA.BUCHMON FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY CodeKU.BUCHMON FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 lGesellschaft$ = Gesellschaft.GEADR
 lAgentur$ = Nachname.MAADR + ", " + Vorname.MAADR + ", " + Agenturnr.maadr
 lSparte$ = Sparte.SPARTEN
 lKunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 eingbei$ = EingereichtBei.kvertrag
 IF eingbei$ = "" THEN 
   eingbei$ = "eingereicht Åber"
 END IF 
 IF MNdisabled%("SEEEINGBEI") THEN 
     eingbei$ = "wurde ausgeblendet"
 END IF 
 REM waehr$ = "WÑhrung: " + waehrung.zeingan1
 FORM 
 END SUB 
 
 
SUB ChangeCheck(CodeBU%)
 FILE "buchmon"
 SELECT KEY codebu% LOCK FILE "buchmon" INDEX CodeBU.BUCHMON
 IF ausgewÑhlt.buchmon LIKE "j" THEN 
   ausgewÑhlt.buchmon = "n"
 ELSE 
   ausgewÑhlt.buchmon = "j"
 END IF 
 STORE FILE "buchmon"
 FORM 
 
 END SUB 
 
SUB BuchmonSuch()
 REM 281199
 DIM Waehrung$(6,1)
 REDIM Waehrung$(6)
   REM FOR i% = 0 TO 5
     REM Waehrung$(i%) = ""
   REM NEXT i%
   
   a% = 0
   Waehrung$(0) = "kein Filter"
   Waehrung$(1) = "Gesellschaft"
   Waehrung$(2) = "Sparte"
   Waehrung$(3) = "Nachname"
   Waehrung$(4) = "Gesellschaft und Sparte"
   Waehrung$(5) = "Mitarbeiter"
 a% = 5
     DIM Auswahl1$(1)
     FILE "Buchmon"
 
     CREATE DIALOG "PREISLIS",0,0,190,184,"Suche","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,157,0," Filterwahl"
      ADD DIALOG "PREISLIS",7,5,14,169,145,0,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,37,165,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,165,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        SELECT WHERE FILE "Buchmon"
        such$ = "kein Filter gesetzt"
        IF Auswahl1$(0) = "Gesellschaft" THEN 
          ge% = 0
          ge% = GetCodeGE%(ge%)
          IF ge% > 0 THEN 
            SELECT KEY ge% FILE "GEADR" INDEX codege.geadr
            ausw1$ = gesellschaft.geadr
            such$ = "Filter Ges.: " + ausw1$
            bef$ = "select WHERE Gesellschaft.buchmon = " + CHR$ (34) + ausw1$ + CHR$ (34)
            EXECUTE bef$
          ELSE 
            such$ = "Filter: "
          END IF 
        END IF 
        IF Auswahl1$(0) = "Sparte" THEN 
          spa% = 0
          spa% = GetCodeVA%(spa%)
          IF spa% > 0 THEN 
            SELECT KEY spa% FILE "Sparten" INDEX codeva.sparten
            ausw1$ = sparte.sparten
            such$ = "Filter Sparte: " + ausw1$
            bef$ = "select WHERE Sparte.buchmon = " + CHR$ (34) + ausw1$ + CHR$ (34)
            EXECUTE bef$
 
          ELSE 
            such$ = "Filter: "
          END IF 
        END IF 
        IF Auswahl1$(0) = "Nachname" THEN 
          ku% = 0
          ku% = ADRSuche%(ku%)
          ku1% = ku%
          IF ku1% > 0 THEN 
            SELECT KEY ku1% FILE GAdrDat$ INDEX codeku.GAdrDat$
            ausw1$ = Nachname.GAdrDat$
            such$ = "Filter Kunde: " + ausw1$
            bef$ = "select WHERE codeku.buchmon = " + STR$ (ku1%,"000000")
            EXECUTE bef$
          ELSE 
            such$ = "Filter: "
          END IF 
        END IF 
        IF Auswahl1$(0) = "Gesellschaft und Sparte" THEN 
          ge% = 0
          ge% = GetCodeGE%(ge%)
          spa% = 0
          spa% = GetCodeVA%(spa%)
          IF ge% > 0 AND spa% > 0 THEN 
            SELECT KEY ge% FILE "GEADR" INDEX codege.geadr
            ausw0$ = gesellschaft.geadr
            ausw1$ = gesellschaft.geadr
            SELECT KEY spa% FILE "Sparten" INDEX codeva.sparten
            ausw1$ = ausw1$ + "/" + sparte.sparten
            ausw2$ = sparte.sparten
            such$ = "Filter Ges.+Sparte: " + ausw1$
            bef$ = "select WHERE sparte.buchmon = " + CHR$ (34) + ausw2$ + CHR$ (34) + " AND Gesellschaft.buchmon = " + CHR$ (34) + ausw0$ + CHR$ (34)
            EXECUTE bef$
            REM SELECT WHERE Sparte.buchmon = ausw2$ AND Gesellschaft.buchmon = ausw0$
          ELSE 
            such$ = "Filter: "
          END IF 
        END IF 
        IF Auswahl1$(0) = "Mitarbeiter" THEN 
          ma% = 0
          ma% = GetCodeMA%(ma%,Workstation%)
          
          IF ma% > 0 THEN 
            SELECT KEY ma% FILE "MAADR" INDEX codema.MAADR
            ausw1$ = Nachname.maadr
            such$ = "Filter Mitarb.: " + ausw1$
            bef$ = "select WHERE codema.buchmon = " + STR$ (ma%,"000000")
            EXECUTE bef$
          ELSE 
            such$ = "Filter: "
          END IF 
        END IF 
      END IF 
 
 MOUSE ON 
 REM SELECT FORM KEY kunr% FILE "Kvertrag" INDEX codeku.kvertrag
 SELECT FORM FIRST 
 FORM 
 
 END SUB 
 
 
 
 
 
 
 
 
 
 
 
SUB CHKVER()
 CALL PRep("CHKVER")
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP Gesellschaft.BUCHMON
 GROUP Sparte.BUCHMON
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 ON ERROR GOTO eab281199002
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SET FIRST PAGE HEADING OFF 
 filt$ = WHERE 
 IF filt$ <> "" THEN 
   bef$ = "SELECT ; WHERE CodeMA.BUCHMON = CodeMA.MAADR AND " + filt$ + " ORDER REPORT Datum.BUCHMON TO ASK "
 ELSE 
   bef$ = "SELECT ; WHERE CodeMA.BUCHMON = CodeMA.MAADR ORDER REPORT Datum.BUCHMON TO ASK "
 END IF 
 EXECUTE bef$
 REM SELECT ; WHERE CodeMA.BUCHMON = CodeMA.MAADR
     REM ORDER REPORT Datum.BUCHMON
     REM TO ASK 
 
eab281199002: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
 
 
 
 
 
  
 
 
 ' KontoÅbersicht einzeln *** Andi 21.9.95
 ' =======================================================================
 
SUB UEBERSAG1()
 IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF RECCOUNT ("Buchung") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 REM SET MENU OFF 
 IF _help% = 1 THEN CALL DemoInfo(9)
 ma% = GetCodeMA%(cuma%,Workstation%)
 IF ma% <> 0 THEN 
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   
   FILE "buchung"
   allProv$ = "n"
   CREATE DIALOG "Konto1",0,0,221,185,title$,"MS Sans Serif",8
   ADD DIALOG "Konto1",9,6,7,24,22,2
   ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
   ADD DIALOG "Konto1",4,34,14,176,5,0,""
   ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
   ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
   ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
   ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
   ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
   ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
   ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
   ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnliste sind)"
   IF GAFSK$ LIKE "TRUE" THEN 
   ELSE 
     ADD DIALOG "Konto1",2,10,138,194,11,0,"nur BuchungssÑtze einer vertragsabschlie·enen Agentur","j","n",incAg$
   END IF 
   ADD DIALOG "Konto1",1,50,164,55,15,1,"&Weiter",1,1
   ADD DIALOG "Konto1",1,110,164,55,15,0,"&Abbruch",0,0
   DIALOG "Konto1",req%
   REMOVE DIALOG "Konto1"
 
   IF req% = 1 THEN 
     Gdruvonma% = 0
     IF incAg$ = "j" THEN 
       a$ = "Sie erhalten jetzt die Mîglichkeit die jenige vertragsabschlie·ende Agentur auszuwÑhlen von der Sie die BuchungssÑtze fÅr " + name$
       CALL Fehler(a$,"angezeigt bekommen wollen, um festzustellen was " + name$ + " an der vertragsabschlie·enden Agentur verdient hat.")
       ma1% = GetCodeMA%(cuma%,Workstation%)
       IF ma1% <> 0 THEN 
         Gdruvonma% = ma1%
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY ma1% FILE "maadr" INDEX codema.maadr
         name1$ = vorname.maadr + " " + nachname.maadr
         REM CALL Fehler("Provisionsliste ","")
       ELSE 
         Gdruvonma% = 0
       END IF 
     END IF 
     IF von$ = "" THEN vondat$ = "1.1.1980" ELSE vondat$ = von$
     IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ,"0d.mm.yyyy") ELSE bisdat$ = bis$
     IF eurosupport$ = "TRUE" THEN 
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
       IF DruInEur.stamm = 1 THEN 
         req1% = 1
       ELSE 
         CALL Fehler(t1$,t2$)
         REQUEST "öbersicht in EURO drucken?","",130,req1%
       END IF 
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
     END IF 
     IF RepType% = 0 THEN 
 
 
     i% = 0
     DIM Keyword$(50)
     IF Gdruvonma% = 0 THEN 
       Keyword$(i%) = "Liste01 - Gesell., Sparte, Kunde, VSNR, BWS, VS-Beginn, Vertr.Agentur, Einheiten, Provision, SR"
       i% = i% + 1
       Keyword$(i%) = "Liste02 - Gesell., Sparte, Kunde, VSNR, VS-Beginn, Vertr.Agentur, Einheiten, Provision, SR"
       i% = i% + 1
       Keyword$(i%) = "Liste03 - Gesell., Kunde, VSNR, Einheiten, Provision, SR"
       i% = i% + 1
       Keyword$(i%) = "Liste04 - wie Liste01 ,aber nur Stornos"
       i% = i% + 1
       Keyword$(i%) = "Liste05 - wie Liste01 ,mit MWST,Netto,Brutto"
       i% = i% + 1
       Keyword$(i%) = ""
       i% = i% + 1
     ELSE 
       Keyword$(i%) = "Liste01 - Gesell., Sparte, Kunde, VSNR, BWS, VS-Beginn, Vertr.Agentur, Einheiten, Provision, SR"
       i% = i% + 1
       Keyword$(i%) = "Liste04 - wie Liste01 ,aber nur Stornos"
       i% = i% + 1
       Keyword$(i%) = "Liste05 - wie Liste01 ,mit MWST,Netto,Brutto"
       i% = i% + 1
       Keyword$(i%) = ""
       i% = i% + 1
     END IF 
 
 
     CREATE DIALOG "KEYWORD",0,0,433,200,"Wahl der Listenart","MS Sans Serif",8
     ADD DIALOG "KEYWORD",4,0,1,433,176,0,""
     ADD DIALOG "KEYWORD",9,4,12,21,24,2
     ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie die Provisionslistenart aus:"
     ADD DIALOG "KEYWORD",7,31,38,388,122,2,2,Keyword$,Auswahl$,prompt$
     ADD DIALOG "KEYWORD",1,200,182,55,15,1,"&OK",1,1
     ADD DIALOG "KEYWORD",1,256,182,55,15,0,"&Abbrechen",0,0
     DIALOG "KEYWORD",req%
     REMOVE DIALOG "KEYWORD"
     IF req% = 0 THEN END SUB 
     reqli1% = 0
       a$ = LEFT$ (Auswahl$(0),7)
       SELECT CASE UCASE$ (a$)
         CASE "LISTE99"
           reqli1% = 1
         CASE "LISTE05"
             reqtdru% = 1
             CALL GenerateB1(vondat$,bisdat$)
             CALL L9STPRVE1(von$,bis$,allprov$,1,ma%,"L9STPRVE",reqtdru%)
             GOTO Ueend1811984
         CASE "LISTE01"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROV")
           ELSE 
             reqtdru% = 1
             CALL GenerateB1(vondat$,bisdat$)
             CALL LISTPRVE1(von$,bis$,allprov$,1,ma%,"LISTPRVE",reqtdru%)
             GOTO Ueend1811984
           END IF 
         CASE "LISTE02"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROB")
           ELSE 
             CALL LISTPRVE1(von$,bis$,allprov$,0,ma%,"LISTPRBE",0)
             GOTO Ueend1811984 
           END IF 
         CASE "LISTE03"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROE")
           ELSE 
             REM 161298
             CALL LISTPRVE1(von$,bis$,allprov$,0,ma%,"LISTPRBF",0)
             GOTO Ueend1811984
           END IF 
         CASE "LISTE04"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROV")
           ELSE 
             CALL LISTPRVE1(von$,bis$,"c",1,ma%,"LISTPRVE",0)
             GOTO Ueend1811984
           END IF 
       END SELECT 
 
 
 
 
       REM REQUEST "Soll die Kurzliste ausgegeben werden?","",130,reqli1%
       reqli1% = 0
       IF reqli1% = 1 THEN 
         IF eu% = 0 THEN 
           CALL PRep("LISTPROX")
         ELSE 
         END IF 
       ELSE 
       END IF 
       REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
         SET REPORT PAGE "F_REPORT"
         OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
       SET REPORT PAGE "H_PAGE"
        OUTPUT REPORT PAGE 
       END HEADING 
 GROUP QNameCodema.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG AS "SumEinh%"
 BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG
 BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
 END GROUP 
  
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
     ELSE 
       CALL PRep("LISTPRO2")
       REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
         SET REPORT PAGE "F_REPORT"
         OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"dd.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
         SET REPORT PAGE "H_PAGE"
         OUTPUT REPORT PAGE 
       END HEADING 
 
       GROUP QNameCodema.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG AS "SumEinh%"
       BEFORE GROUP QNameCodema.MAADR
       SET REPORT PAGE "H_QNameCodem002"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       AFTER GROUP QNameCodema.MAADR
       SET REPORT PAGE "F_QNameCodem002"
       OUTPUT REPORT PAGE 
       EJECT REPORT 
       END GROUP 
 
       GROUP Datum.BUCHUNG
         BEFORE GROUP Datum.BUCHUNG
         SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
         SET REPORT PAGE "F_SELECT"
         OUTPUT REPORT PAGE 
       END SELECT 
     END IF 
 
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     vondat% = DAYS (vondat$)
     bisdat% = DAYS (bisdat$)
     
     MOUSE OFF 
     ON ERROR GOTO ErrUEBERSAG1
     IF allProv$ = "j" THEN 
       REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
       IF req1d% <> 1 THEN 
         SELECT ;
         WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$)
         ORDER REPORT nachname.maadr,Datum.BUCHUNG,kunde$
         TO ASK 
       ELSE 
         SELECT ;
         WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$) AND (Betrag.buchung <> 0 OR sr.buchung <> 0)
         ORDER REPORT nachname.maadr,Datum.BUCHUNG,kunde$
         TO ASK 
       END IF 
    ELSE 
       REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
       IF req1d% <> 1 THEN 
         SELECT ;
         WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$) AND mahnung.buchung <> "j"
         ORDER REPORT nachname.maadr,Datum.BUCHUNG,kunde$
         TO ASK 
       ELSE 
         SELECT ;
         WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$) AND mahnung.buchung <> "j" AND (Betrag.buchung <> 0 OR sr.buchung <> 0)
         ORDER REPORT nachname.maadr,Datum.BUCHUNG,kunde$
         TO ASK 
       END IF 
     END IF 
ErrUEBERSAG1: 
    ON ERROR GOTO ErrorHandler
    END IF 
 END IF 
Ueend1811984: 
 MOUSE ON 
 END SUB 
 
SUB DruckProvi(coma%,von$,bis$)
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 IF coma% > 0 THEN 
   SELECT KEY coma% FILE "maadr" INDEX codema.maadr
   agentur$ = Nachname.maadr + ", " + Vorname.maadr
   title$ = "KontoÅbersicht fÅr " + agentur$
 END IF 
 
         MOUSE OFF 
         REM Drucken
         FormatPrint$ = "A4h"
         title2$ = title$ + Header$
         CALL VPEINI(title2$,FormatPrint$)
         cPage% = CALL ("VpeGetCurrentPage",hdoc%)
         cPageold% = cPage%
         b% = 1
         vzeil% = mTop%
         CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
         CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 16 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
         CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
         obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
         CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
         obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
         vzeil% = obBottom% + 10
         ueberpos% = vzeil%
         CALL VTransp(0)
         CALL VSetPen(0,0)
         zeilenabstand% = 40
         zeilenoffset% = 40
         i% = 1
         aa% = a%
         FOR i% = 0 TO aa%
           obBottom% = vzeil%
           GetVertrag% = VAL ( RIGHT$ (Vertraege$(i%),6))
           SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
           cuvt% = GetVertrag%
           knr% = Codeku.kvertrag
           SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
           knr$ = Kundennummer.GAdrDat$
           name$ = Nachname.GAdrDat$ + " ," + Vorname.GAdrDat$
           Ort$ = plz.GAdrDat$ + "-" + ort.GAdrDat$ + " ," + stra·e.GAdrDat$
           SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
           mitarb$ = Nachname.maadr + ", " + Vorname.maadr
           a% = vzeil%
           cPage% = CALL ("VpeGetCurrentPage",hdoc%)
           cPageold% = cPage%
           ok% = - 1
VTUebersi150697: 
           czeile% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Kundennummer: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + knr$)
           a% = vzeil%
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + name$ + ", " + ort$)
           CALL VWrite(mleft%,a%,460,"['Arial' S 8 B C BLACK]" + "Name: ")
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Betreuung durch: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + mitarb$)
           a% = vzeil%
           ges$ = LTRIM$ (Gesellschaft.kvertrag)
           spa$ = LTRIM$ (sparte.kvertrag)
           agentur$ = LTRIM$ (Agentur.kvertrag)
           Statu1$ = " / Status: " + LTRIM$ (VstatusTXT.kvertrag)
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Ges./Sparte/Agentur: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + Ges$ + "/" + spa$ + "/" + agentur$ + statu1$)
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Antragsdatum: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy"))
           CALL VPrint(mleft% + 420,a%,"['Arial' S 8 B C BLACK]" + "Vertragsbeginn: ")
           CALL VWrite(mleft% + 640,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy"))
           CALL VPrint(mleft% + 800,a%,"['Arial' S 8 B C BLACK]" + "Ablauf: ")
           CALL VWrite(mleft% + 950,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (KÅndigung.kvertrag,"0d.mm.yyyy"))
           CALL VPrint(mleft% + 1200,a%,"['Arial' S 8 B C BLACK]" + "Dauer: ")
           CALL VWrite(mleft% + 1300,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + STR$ (VS_Dauer.kvertrag,"99"))
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Bewertungssumme: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + STR$ (BewertungsSumme.Kvertrag,",99999999.00") + "  Volumen: " + STR$ (Volumen.kvertrag,",99999999.00"))
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Policenr: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + VS_NR.kvertrag + "  Versicherungssumme: " + STR$ (VSumme.Kvertrag,",99999999.00") + "  Beitrag:" + STR$ (Beitrag.kvertrag,",99999999.00"))
           a% = vzeil%
           SELECT CASE zw.kvertrag
             CASE 0
               zw$ = "Zahlweise: Einmalig"
               SumBei% = SumBei% + Beitrag.kvertrag
             CASE 1
               zw$ = "Zahlweise: JÑhrlich"
               SumBei% = SumBei% + Beitrag.kvertrag
             CASE 4
               zw$ = "Zahlweise: VierteljÑhrlich"
               SumBei% = SumBei% + 4 * Beitrag.kvertrag
             CASE 2
               zw$ = "Zahlweise: HalbjÑhrlich"
               SumBei% = SumBei% + 2 * Beitrag.kvertrag
             CASE 6
                 zw$ = "Zahlweise: 2monatlich"
                 SumBei% = SumBei% + 6 * Beitrag.kvertrag
             CASE 12
               zw$ = "Zahlweise: Monatlich"
               SumBei% = SumBei% + 12 * Beitrag.kvertrag
           END SELECT 
           SumBew% = SumBew% + BewertungsSumme.kvertrag
           SumVS% = SumVS% + VSumme.kvertragCALLVWrite(mleft%,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + "verprovisioniert seit: " + DATE$ (Proviab.kvertrag,"0d.mm.yyyy") + "       " + zw$)
           IF LTRIM$ (notiz.kvertrag) <> "" THEN 
             a% = vzeil%
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Notiz: ")
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + LTRIM$ (notiz.kvertrag))
           END IF 
           a% = vzeil% + 5
           CALL VLine(mleft% - 7,a%,mright%,a%)
           vzeil% = vzeil% + 25
           SET STATUS "VertrÑge bearbeitet: " + STR$ (i%,"9999999") + "  von insgesamt: " + STR$ (aa%,"999999999")
 
           IF obBottom% >= mBottom% THEN 
             CALL VTransp(0)
             CALL VBox(mleft% - 7,czeile%,mright%,obBottom% + 550)
             CALL VLine(mleft% - 7,mtop%,mleft% - 7,czeile%)
             CALL VLine(mright%,mtop%,mright%,czeile%)
             CALL VLine(mleft% - 7,czeile%,mright%,czeile%)
             a% = CALL ("VpePageBreak",hdoc%)
             REM CALL VTransp(1)
             vzeil% = ueberpos%
             a% = vzeil%
             obbottom% = vzeil%
             GOTO VTUebersi150697
           END IF 
 
         NEXT i%
         vzeil% = vzeil% + 10
         CALL VLine(mleft% - 7,mtop%,mleft% - 7,vzeil%)
         CALL VLine(mright%,mtop%,mright%,vzeil%)
         CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
         vzeil% = vzeil% + 20
         ss1$ = STR$ (aa%,",9999999999") + "   Summe BeitrÑge: " + STR$ (SumBei%,",9999999999.00") + "   Summe Bewertung: " + STR$ (SumBew%,",9999999999.00")
         ss2$ = "Summe Vers.summen: " + STR$ (SumVS%,",9999999999.00")
         CALL VPrint(mleft%,vzeil% + 10,"['Arial' S 9 B C BLACK]Anzahl VertrÑge: " + ss1$)
         CALL VPrint(mleft%,vzeil% + 45,"['Arial' S 9 B C BLACK]" + ss2$)
         CALL VPrint(mleft%,vzeil% + 100,"['Arial' S 15 B C BLACK]Ende der Liste")
         cPage% = CALL ("VpeGetCurrentPage",hdoc%)
 
         FOR b% = 1 TO cPage%
           vzeil% = mTop%
           a% = CALL ("VpeGotoPage",hdoc%,b%)
           CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
           CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 16 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
           CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
           obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
           CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
         NEXT b%
         a% = CALL ("VpeGotoPage",hdoc%,1)
         MOUSE ON 
         CALL VPrevDoc()
         REM Nach dem Drucken, Drucker auf A4 hoch setzen
         REM c$ = PRINTER :d$ = PRINTER (0):SET PRINTER c$,d$,1,9
 
         ON ERROR GOTO adrdr170920021
         IF PRINTER (1) = 1 OR PRINTER (1) = 2 THEN 
           c$ = PRINTER :d$ = PRINTER (0)
           SET PRINTER c$,d$,1,9
           REM PRINT CURRENT PAGE 
           GOTO endruck170920021
         END IF 
         
adrdr170920021: 
         MOUSE ON 
         REM c$ = PRINTER :d$ = PRINTER (0)
         ON ERROR GOTO endruck170920021
         SET PRINTER 
         REM PRINT CURRENT PAGE 
         FORM 
endruck170920021: 
         ON ERROR GOTO ErrorHandler 
 
         lok% = 0
         GOTO VTUebersi150697END 
       END SELECT 
     WEND 
 
 
 END SUB 
 
 
 
 
 ' KontoÅbersicht alle Agenturen ***** Andi 21.9.95
 ' =======================================================================
 
SUB UEBERSAG2()
 IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF RECCOUNT ("Buchung") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 REM CREATE DIALOG "Konto1",0,0,187,108,"KontoÅbersicht","MS Sans Serif",8
 REM  ADD DIALOG "Konto1",5,6,3,170,9,0,"KontoÅbersicht fÅr alle Agenturen:"
 REM ADD DIALOG "Konto1",5,6,19,167,9,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum"
 REM ADD DIALOG "Konto1",5,6,28,98,8,0,"Sie eine öbersicht wÅnschen."
 REM ADD DIALOG "Konto1",5,6,37,174,10,0,"Wenn Sie keine Angaben zum Buchungszeitraum ein-"
 REM ADD DIALOG "Konto1",5,6,47,160,9,0,"tragen, werden sÑmtliche VorgÑnge ausgegeben."
 REM ADD DIALOG "Konto1",6,6,60,46,13,0,0,von$,8
 REM ADD DIALOG "Konto1",6,58,60,46,13,0,0,bis$,8
 REM ADD DIALOG "Konto1",5,53,62,5,13,0,"-"
 REM ADD DIALOG "Konto1",5,6,74,14,8,0,"von"
 REM ADD DIALOG "Konto1",5,58,74,12,8,0,"bis"
 REM ADD DIALOG "Konto1",1,80,89,49,15,0,"&Weiter",1,1
 REM ADD DIALOG "Konto1",1,130,89,51,15,0,"&Abbruch",0,0
 REM DIALOG "Konto1",req%
 REM REMOVE DIALOG "Konto1"
 
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 
 IF req% = 1 THEN 
   DIRECTORY _ppath$
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
     IF RepType% = 0 THEN 
       REQUEST "Soll die Bewertungssumme pro Vertrag mit ausgegeben werden?","",130,reqli%
       IF reqli% = 1 THEN 
         CALL PRep("LISTPROV")
       ELSE 
         CALL PRep("LISTPROB")
       END IF 
       REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
        SET REPORT PAGE "F_REPORT"
        OUTPUT REPORT PAGE 
       END REPORT 
       REM andi 2.11.95
       REM Header$ = "KontoÅbersicht " + nachname.maadr
       Header$ = "KontoÅbersicht "
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
        SET REPORT PAGE "H_PAGE"
        OUTPUT REPORT PAGE 
       END HEADING 
       GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.MAADR
        SET REPORT PAGE "H_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
       END GROUP 
       AFTER GROUP CodeMA.MAADR
        SET REPORT PAGE "F_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
        EJECT REPORT 
       END GROUP 
       GROUP Datum.BUCHUNG
       BEFORE GROUP Datum.BUCHUNG
       SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
     ELSE 
       CALL PRep("LISTPRO2")
       REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
         SET REPORT PAGE "F_REPORT"
         OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
         SET REPORT PAGE "H_PAGE"
         OUTPUT REPORT PAGE 
       END HEADING 
       GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.MAADR
         SET REPORT PAGE "H_CodeMA.MAA002"
         OUTPUT REPORT PAGE 
       END GROUP 
       AFTER GROUP CodeMA.MAADR
        SET REPORT PAGE "F_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
        EJECT REPORT 
       END GROUP 
       GROUP Datum.BUCHUNG
         BEFORE GROUP Datum.BUCHUNG
         SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
         SET REPORT PAGE "F_SELECT"
         OUTPUT REPORT PAGE 
       END SELECT 
     END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   MOUSE OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrUEBERSAG2
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.buchung >= vondat% AND Datum.buchung <= bisdat%
       ORDER REPORT Nachname.MAADR,Nachname.BUCHUNG
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.buchung >= vondat% AND Datum.buchung <= bisdat% AND mahnung.buchung <> "j"
       ORDER REPORT Nachname.MAADR,Nachname.BUCHUNG
       TO ASK 
   END IF 
ErrUEBERSAG2: 
   ON ERROR GOTO ErrorHandler 
 END IF 
 MOUSE ON 
 END SUB 
 
 
 ' Zusatzbuchungen
 ' =======================================================================
 
SUB ZUSATZBU()
 IF disabled%("BUCHUNGBEARB") THEN END SUB 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
    DIM dlg AS Dialog
    DIM control AS DialogControl 
 MOUSE OFF 
 DIM LAgenturen$( RECCOUNT ("MAADR"))
 FILE "MAADR"
 INDEX CodeMA.MAADR
 SELECT FIRST 
 a% = 0
 fprompt$ = "ZZZZZZZZZZZZZZ"
 aprompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   LAgenturen$(a%) = Nachname.MAADR + ", " + Vorname.MAADR + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
   IF CodeMA.MAADR = _ma% THEN aprompt$ = LAgenturen$(a%)
   IF LAgenturen$(a%) < fprompt$ THEN fprompt$ = LAgenturen$(a%)
   a% = a% + 1
   SELECT NEXT FILE "MAADR" INDEX CodeMA.MAADR
 WEND 
 IF aprompt$ = "" THEN Auswahl$ = fprompt$ ELSE Auswahl$ = aprompt$
   FILE "Waehrung"
   INDEX waehrung.waehrung
   SELECT FIRST 
   WHILE NOT EOF ("WAEHRUNG")
     IF UCASE$ (waehrung.waehrung) = zweitwaehr$ THEN 
       euro1% = umrechnung.waehrung
       codew1% = codew.waehrung
       waehrung1$ = waehrung.waehrung
       wbez1$ = WaehrungBezeich.waehrung
     END IF 
   SELECT NEXT 
   WEND 
 
 ok% = 1
 SELECT FIRST FILE "stamm"
 WHILE ok% = 1
   SET STATUS "Zusatzbuchungen"
   MOUSE ON 
   BLANK FILE "BUCHUNG"
   SET STATUS "Datensatz neu angelegt..."
   Datum.BUCHUNG = TODAY 
   Buchungstext.BUCHUNG = "Zusatzbuchung:"

   
    Superbase.Dialogs.Add("ZBUCHUNG")
    SET dlg = Superbase.Dialogs.ZBUCHUNG
    dlg.Move(0,0,225,209)
    dlg.Caption = "Zusatzbuchung"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,0,225,182)
    control.Caption = ""
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(6,12,20,23)
    control.Icon = 2
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(40,14,176,22)
    control.Caption = "Bitte wÑhlen Sie eine Agentur und fÅllen Sie die Felder Buchungstext und Betrag aus:"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(74,41,139,10)
    control.CaptionBinding = "waehr$"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(40,41,29,10)
    control.Caption = "Agentur:"
 
    SET control = dlg.Add("DialogComboBox1","DialogComboBox")
    control.Move(40,52,174,195)
    control.Style = 2
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("LAgenturen$","Auswahl$")
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(82,72,42,12)
    control.MaxLength = 10
    control.TextBinding = "Datum.buchung"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(20,73,25,13)
    control.Caption = "Datum"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(82,86,60,11)
    control.MaxLength = 20
    control.TextBinding = "Betrag.buchung"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(20,85,52,9)
    control.Caption = "Brutto - Betrag"
 
 
 
 
    SET control = dlg.Add("DialogTextBox6","DialogTextBox")
    control.Move(82,100,60,11)
    control.MaxLength = 20
    control.TextBinding = "MWSTBetragEU.buchung"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(20,100,52,11)
    control.Caption = "MWSt - Betrag"
 
 
 
    SET control = dlg.Add("DialogTextBox7","DialogTextBox")
    control.Move(162,100,40,11)
    control.MaxLength = 7
    control.TextBinding = "MWSTProz.buchung"
 
    SET control = dlg.Add("DialogLabel11","DialogLabel")
    control.Move(145,100,17,11)
    control.Caption = "in % "
 
 
 
 
 
    SET control = dlg.Add("DialogTextBox8","DialogTextBox")
    control.Move(82,114,60,11)
    control.MaxLength = 20
    control.TextBinding = "NettoEU.buchung"
 
    SET control = dlg.Add("DialogLabel12","DialogLabel")
    control.Move(20,114,52,9)
    control.Caption = "Netto - Betrag"
 
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(82,130,132,40)
    control.MultiLine = 1
    control.ScrollBars = 2
    control.MaxLength = 4000
    control.TextBinding = "Buchungstext.buchung"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(20,132,52,9)
    control.Caption = "Buchungstext"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(50,186,55,15)
    control.Caption = "&Buchen"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(108,186,54,15)
    control.Caption = "&Abbrechen"
    control.ReturnValue = 0
    control.Cancel = 1
 
 
 
 
   DIALOG "ZBUCHUNG",req%
   REMOVE DIALOG "ZBUCHUNG"



   MOUSE OFF 
   REM 211299
   IF req% = 1 THEN 
     SET STATUS "Buchung wird gespeichert"
     CodeBU.buchung = SER ("buchung",1)
     CodeMA.BUCHUNG = VAL ( RIGHT$ (Auswahl$,6))
     ma% = CodeMA.BUCHUNG
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY ma% FILE "maadr" INDEX codema.maadr
     VTAgentur.buchung = LEFT$ (Nachname.maadr + "," + vorname.maadr,100)
     datumz% = Datum.BUCHUNG
     betr% = Betrag.BUCHUNG
     VTCodema.buchung = ma%
     Codew.buchung = codew.stamm
     umrechnung.buchung = umrechnung.stamm
     waehrung.buchung = waehrung.stamm
     Betrageu.buchung = VAL ( STR$ (Betrag.buchung / umrechnung.buchung,"99999999.00"))
     IF MWSTBetragEU.buchung = 0 AND NettoEu.buchung = 0 THEN NettoEu.buchung = BetragEU.buchung
     CALL FStore("BUCHUNG")
     zusatz% = 1
     eigen% = 1
     PSpAll$ = ""
     PSpAllSeit% = 0
     PROVSpEig$ = ""
     PSpESeit% = 0
     CALL ZentrKTO(ma%,datumz%,betr%,0,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
     SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
     AuszahlAB.maadr = AuszahlAB.maadr + betr%
     AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
     zusAuszahl.maadr = zusAuszahl.maadr + betr%
     zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
     aktZusB.maadr = aktZusB.maadr + betr%
     aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
     STORE FILE "maadr"
     UNLOCK CURRENT FILE "maadr"
   ELSE 
     ok% = 0
   END IF 
   MOUSE ON 
 WEND 
 END SUB 
  
  
SUB B3MASuchen():REM Agentur suchen
 ma% = CodeMA.buchung
 cuma% = GetCodeMA%(ma%,Workstation%)
 IF cuma% <> 0 THEN 
   codema.buchung = cuma%
   SELECT KEY cuma% FILE "maadr" INDEX codema.maadr
   FORM 
 END IF 
 END SUB 
 
 
SUB GenerateB1(vondat$,bisdat$)
     FILE "buchung"
     INDEX Datum.buchung
     SELECT FIRST FILE "buchung"
     CALL DFile(3,"b1" + _fpw$)
     FILE "b1"
     INDEX datum.b1
     IF RECCOUNT ("B1") > 0 THEN 
       SELECT FIRST FILE "b1"
       anfangd$ = DATE$ (datum.b1,"0d.mm.yyyy")
       SELECT LAST FILE "b1"
       ended$ = DATE$ (datum.b1,"0d.mm.yyyy")
       T1$ = "Die temporÑre Datei enthÑlt Daten im Zeitraum:" + anfangd$ + " - " + ended$
       REQUEST t1$,"Soll sie neu erzeugt werden?",135,req1neu%
       IF req1neu% = 0 THEN GOTO buaufb2110200301
     END IF 
     REMOVE FROM FILE "B1"
     REM temporÑre Druckdatei verwenden
     CALL Fehler("Bitte warten Sie einen Moment, es wird eine temporÑre Druckdatei generiert!","")
     MOUSE OFF 
     DIRECTORY _ppath$
     ON ERROR GOTO ErrorHandler
     IF EXISTS (_ppath$ + "BU1.FSV") THEN 
       DELETE _ppath$ + "BU1.FSV"
     END IF 
     FILE "buchung"
     INDEX Datum.buchung
     SELECT FIRST FILE "buchung" INDEX Datum.buchung
     REM SELECT WHERE Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$)
     SELECT FIRST FILE "buchung" INDEX Datum.buchung
 
     SELECT KEY DAYS (vondat$) FILE "buchung" INDEX Datum.buchung
     i% = 0
     startzeit% = NOW 
    'Feldnamen der Quelldatei ermitteln  
     source$ = "Buchung"
     dest$ = "B1"
     FILE source$
     fieldno% = FILEINFO (source$,1)
     DIM sourceNames$(fieldno%)
     FILLARRAY sourceNames$,1
     REM FOR i%% = 0 TO fieldno% - 1
      REM sourceNames$(i%%) = UCASE$ (sourceNames$(i%%))
     REM NEXT i%%
     DIM sourceSet AS Set 
     REDIM sourceNames$(fieldno% - 1)
     sourceSet.AddArray("sourceNames$")
    
    
     'Feldnamen der Zieldatei ermitteln  
     FILE dest$
     fieldno% = FILEINFO (dest$,1)
     DIM destNames$(fieldno%)
     FILLARRAY destNames$,1
     REM FOR i%% = 0 TO fieldno% - 1
       REM destNames$(i%%) = UCASE$ (destNames$(i%%))
     REM NEXT i%%
 
     DIM destSet AS Set
     REDIM destNames$(fieldno% - 1)
     destSet.AddArray("destNames$")
    
     destSet.Intersect(sourceSet)
 
     fieldno% = destSet.Elements.Count'Grî·e der Schnittmenge der Felder
     DIM copyNames$(fieldno% - 1)
     FOR i%% = 1 TO fieldno%
        copyNames$(i%% - 1) = destSet.Elements(i%%)
     NEXT i%%
 
 
 
 
     WHILE NOT EOF ("Buchung")
       IF Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$) THEN 
         i% = i% + 1
         SET STATUS "bearbeitetes Datum: " + DATE$ (Datum.BUCHUNG,"0d.mm.yyyy") + "     " + STR$ (i%,",99999999") + " DatensÑtze Åbernommen / Zeit: " + TIME$ ( NOW - startzeit%,"hh:mm:ss")
         BLANK FILE "B1"
         REM a% = BuCopyRecord%("Buchung","B1")
         FOR j% = 0 TO fieldno% - 1
           destfield$ = copyNames$(j%) + "." + dest$
           sourcefield$ = copyNames$(j%) + "." + source$
           destfield$$ = sourcefield$$
         NEXT j%
         STORE FILE "B1"
       END IF 
       SELECT NEXT FILE "buchung" INDEX Datum.buchung
     WEND 
     endzeit% = NOW 
     gesamtzeit% = (endzeit% - startzeit%)
     CALL Fehler("Erzeugen B1.SBF beendet   -  Start: " + TIME$ (startzeit%,"hh:mm:ss") + " / Ende: " + TIME$ (endzeit%,"hh:mm:ss"),"Gesamt: " + TIME$ (gesamtzeit%,"hh:mm:ss"))
 
     ON ERROR GOTO ErrorHandler
     REM CALL Fehler("Erzeugen B1.SBF beendet","")
buaufb2110200301: 
 END SUB 

 
 ' Ausgabe Provisionsliste *** Andi 21.9.95
 ' =======================================================================
 
SUB PROVILIST()
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"b1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF disabled%("PROVISIONSLISTE") THEN END SUB 
 MOUSE OFF 
 SET STATUS "Ausgabe wird vorbereitet..."
 Kopfzeile$ = ""
 IF RECCOUNT ("Buchung") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 FOR z% = 1 TO 10
   in$ = ReadConfig$("PROVIS","Header" + LTRIM$ ( STR$ (z%,"99")))
   IF in$ <> "" AND in$ <> "leer" THEN 
     IF Kopfzeile$ = "" THEN 
       Kopfzeile$ = in$
     ELSE 
       Kopfzeile$ = Kopfzeile$ + CHR$ (13) + CHR$ (10) + in$
     END IF 
   END IF 
 NEXT z%
 Fu·zeile$ = ""
 FOR z% = 1 TO 10
   in$ = ReadConfig$("PROVIS","Footer" + LTRIM$ ( STR$ (z%,"99")))
   IF in$ <> "" AND in$ <> "leer" THEN 
     IF Fu·zeile$ = "" THEN 
       Fu·zeile$ = in$
     ELSE 
       Fu·zeile$ = Fu·zeile$ + CHR$ (13) + CHR$ (10) + in$
     END IF 
   END IF 
 NEXT z%
 FILE "buchung"
 INDEX CodeBU.buchung
 SELECT LAST 
 WHILE NOT EOF ("buchung") AND Provision.BUCHUNG <> "j"
   SELECT PREVIOUS 
 WEND 
 IF datum.Buchung > 20 THEN cdat$ = DATE$ (Datum.BUCHUNG)
 ccc% = DAYS (cdat$)
 cdat$ = DATE$ (ccc%,"0d.mm.yyyy")
 
 von$ = cdat$
 bis$ = cdat$
 IF LTRIM$ (von$) = "" THEN von$ = "01.01.1980"
 REM IF LTRIM$ (bis$) = "" THEN 
   bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 REM END IF 
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnliste sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 MOUSE ON 

 IF req% = 1 THEN 
   MOUSE OFF 
   REM REQUEST "TemporÑre Druckdatei verwenden?","",130,reqtdru%
   IF von$ = "" THEN vondat$ = "1.1.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ,"0d.mm.yyyy") ELSE bisdat$ = bis$
   IF eurosupport$ = "TRUE" THEN 
     t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
     t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
     IF DruInEur.stamm = 1 THEN 
       req1% = 1
     ELSE 
       CALL Fehler(t1$,t2$)
       REQUEST "öbersicht in EURO drucken?","",130,req1%
     END IF 
     IF req1% = 1 THEN 
       eu% = 1
       drwaehr$ = " in Euro"
     ELSE 
       eu% = 0
       drwaehr$ = " in allen WÑhrungen"
     END IF 
   END IF 
   REM CALL GenerateB1(vondat$,bisdat$)

   IF RepType% = 0 THEN 
     REM REQUEST "Soll die Kurzliste ausgegeben werden?","",130,reqli1%
     i% = 0
     DIM Keyword$(50)
     Keyword$(i%) = "Liste01 - Gesell., Sparte, Kunde, VSNR, BWS, VS-Beginn, Vertr.Agentur, Einheiten, Provision, SR"
     i% = i% + 1
     Keyword$(i%) = "Liste02 - Gesell., Sparte, Kunde, VSNR, VS-Beginn, Vertr.Agentur, Einheiten, Provision, SR"
     i% = i% + 1
     Keyword$(i%) = "Liste03 - Gesell., Kunde, VSNR, BWS, VS-Beginn, Einheiten, Vertr.Agentur, Provision, SR"
     i% = i% + 1
     Keyword$(i%) = "Liste04 - Kurzliste Gesell.,Sparte, Kunde, VSNR, VS-Beginn, Einheiten, Provision, SR"
     i% = i% + 1
     Keyword$(i%) = "Liste05 - Gesell., Kunde, VSNR, BWS, VS-Beginn, Vertr.Agentur, Provision, SR"
     i% = i% + 1
     Keyword$(i%) = "Liste06 - wie Liste01, aber nur die StornodatensÑtze"
     i% = i% + 1
     Keyword$(i%) = "Liste07 - wie Liste01 mit MWST,Brutto,Netto"
     i% = i% + 1
     Keyword$(i%) = ""
     i% = i% + 1

 
 
 
     CREATE DIALOG "KEYWORD",0,0,433,200,"Wahl der Listenart","MS Sans Serif",8
     ADD DIALOG "KEYWORD",4,0,1,433,176,0,""
     ADD DIALOG "KEYWORD",9,4,12,21,24,2
     ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie die Provisionslistenart aus:"
     ADD DIALOG "KEYWORD",7,31,38,388,122,2,2,Keyword$,Auswahl$,prompt$
     ADD DIALOG "KEYWORD",1,180,182,55,15,1,"&OK",1,1
     ADD DIALOG "KEYWORD",1,236,182,55,15,0,"&Abbrechen",0,0
     DIALOG "KEYWORD",req%
     REMOVE DIALOG "KEYWORD"
     IF req% = 0 THEN END SUB 
     reqli1% = 0
     reqtdru% = 0
       a$ = LEFT$ (Auswahl$(0),7)
       SELECT CASE UCASE$ (a$)
         CASE "LISTE99"
           reqli1% = 1
         CASE "LISTE07"
             reqtdru% = 1
             CALL GenerateB1(vondat$,bisdat$)
             CALL L9STPRVE(vondat$,bisdat$,allprov$,1,"L9STPRVE",reqtdru%)
             GOTO EndDMLi1811982
         CASE "LISTE01"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROV")
           ELSE 
             reqtdru% = 1
             CALL GenerateB1(vondat$,bisdat$)
             CALL LISTPRVE(vondat$,bisdat$,allprov$,1,"LISTPRVE",reqtdru%)
             GOTO EndDMLi1811982
           END IF 
         CASE "LISTE02"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROB")
           ELSE 
             REM 161298
             CALL LISTPRVE(vondat$,bisdat$,allprov$,0,"LISTPRBE",reqtdru%)
             GOTO EndDMLi1811982
           END IF 
         CASE "LISTE03"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROH")
           ELSE 
             REM 161298
             CALL LISTPRVE(vondat$,bisdat$,allprov$,0,"LISTPROI",reqtdru%)
             GOTO EndDMLi1811982
           END IF 
         CASE "LISTE04"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROF")
           ELSE 
             REM 161298
             CALL LISTPRVE(vondat$,bisdat$,allprov$,0,"LISTPROG",reqtdru%)
             GOTO EndDMLi1811982
           END IF 
         CASE "LISTE05"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROC")
           ELSE 
             REM 161298
             CALL LISTPRVE(vondat$,bisdat$,allprov$,0,"LISTPROD",reqtdru%)
             GOTO EndDMLi1811982
           END IF 
         CASE "LISTE06"
           IF eu% = 0 THEN 
             CALL PRep("LISTPROV")
           ELSE 
             CALL LISTPRVE(vondat$,bisdat$,"c",1,"LISTPRVE",reqtdru%)
             GOTO EndDMLi1811982
           END IF 
       END SELECT 
 
     REM "Kurzliste"
     IF reqli1% = 1 THEN 
       CALL PRep("LISTPROX")
     END IF 
     REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     REM andi 2.11.95
     REM Header$ = "KontoÅbersicht " + nachname.maadr
     Header$ = "Provisionsabrechnung in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP QNameCodema.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG AS "SumEinh%"
     BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   ELSE 
     CALL PRep("LISTPRO2")
     REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrPROVLIST
   IF allProv$ = "j" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.buchung >= vondat% AND Datum.buchung <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.BUCHUNG,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.buchung >= vondat% AND Datum.buchung <= bisdat% AND (Betrag.buchung <> 0 OR sr.buchung <> 0)
       ORDER REPORT Nachname.MAADR,Datum.BUCHUNG,Kunde$
       TO ASK 
     END IF 
   ELSE 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.buchung >= vondat% AND Datum.buchung <= bisdat% AND Mahnung.BUCHUNG <> "j"
       ORDER REPORT Nachname.MAADR,Datum.BUCHUNG,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.buchung >= vondat% AND Datum.buchung <= bisdat% AND Mahnung.BUCHUNG <> "j" AND (Betrag.buchung <> 0 OR sr.buchung <> 0)
       ORDER REPORT Nachname.MAADR,Datum.BUCHUNG,Kunde$
       TO ASK 
     END IF 
   END IF 
ErrPROVLIST: 
   ON ERROR GOTO ErrorHandler
 END IF 
EndDMLi1811982: 
 MOUSE ON 
 END SUB 
  
 
  
  
SUB AddLogInfo()
 _ge% = CodeGE.GEADR
 _va% = CodeVA.SPARTEN
 _ma% = CodeMA.KVERTRAG
 _ku% = CodeKU.GAdrDat$
 SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
 IF NOT FOUND ("GEADR") THEN Gesellschaft$ = "<nicht gefunden>" ELSE Gesellschaft$ = Gesellschaft.GEADR
 SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
 IF NOT FOUND ("SPARTEN") THEN Sparten$ = "<nicht gefunden>" ELSE Sparten$ = Sparte.SPARTEN
 SELECT KEY _ma% FILE "MAADR" INDEX CodeMA.MAADR
 IF NOT FOUND ("MAADR") THEN Agentur$ = "<nicht gefunden>" ELSE Agentur$ = Nachname.MAADR + ", " + Vorname.MAADR
 SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 IF NOT FOUND (GAdrDat$) THEN Kunde$ = "<nicht gefunden>" ELSE Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 CALL WriteLog("    Vertrag: " + VS_Nr.KVERTRAG + " " + Sparten$ + "/" + Gesellschaft$)
 CALL WriteLog("    Beginn : " + DATE$ (ProviAb.KVERTRAG,"0d.mm.yyyy"))
 CALL WriteLog("    Kunde  : " + Kunde$)
 CALL WriteLog("    Agentur: " + Agentur$)
 CALL WriteLog("")
 SELECT KEY _ge% FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY _va% FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY _ma% FILE "MAADR" INDEX CodeMA.MAADR
 SELECT KEY _ku% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 END SUB 
 
 
  
 
 
 
 
SUB old_RegProvis(remark$,ma%,provi%,sr%,Haftung%)
 cfile$ = FILE 
 FILE "kvertrag"
 _lfdnr% = lfdnr.KVERTRAG
 SELECT KEY _lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY ma% FILE "maadr" INDEX CodeMA.MAADR
 REM -- Bearbeitung bei letzter Agentur in der Struktur
 IF (CodeMA.maadr = vorgÑnger.maadr) OR (VorgÑnger.MAADR < 1) THEN 
   letzteProvi.kvertrag = cdate%
   IF remark$ LIKE "TZ (*" THEN 
     TZRate.KVERTRAG = TZRate.KVERTRAG + 1
   END IF 
 END IF 
 
 REM -- Einmalzahlungen registrieren --
 IF remark$ LIKE "Abschlu*" OR remark$ LIKE "VD*" THEN gezAbschlu·% = 1
 IF remark$ LIKE "Pflege*" THEN gezPflege% = 1
 IF remark$ LIKE "Pauschal*" THEN gezPauschale% = 1
 IF CodeMA.MAADR = VorgÑnger.MAADR OR VorgÑnger.MAADR < 1 THEN 
   IF gezAbschlu·% = 1 THEN gez_Abschlu·.kvertrag = "j"
   IF gezPflege% = 1 THEN letztePflege.kvertrag = cdate%
   IF gezPauschale% = 1 THEN gez_Pauschale.kvertrag = "j"
 END IF 
   
 CALL QuickStore("KVERTRAG")
 FILE "buchung"
 BLANK 
 CodeBU.buchung = SER ("buchung",1)
 Datum.buchung = cdate%
 CodeVT.buchung = lfdnr.kvertrag
 IF KÅndigung.MAADR <= cdate% AND Nachfolger.MAADR <> 0 THEN 
   CodeMA.buchung = Nachfolger.MAADR
   Buchungstext.buchung = remark$ + " (Umbuchung von " + Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + ".)"
 ELSE 
   CodeMA.buchung = ma%
   Buchungstext.buchung = remark$
 END IF 
 SRBetrag% = ((provi% - vertrprov%) / 100) * sr%
 Betrag.buchung = provi% - vertrprov% - SRBetrag%
 Gesamtbetrag.BUCHUNG = provi%
 Bewertungssumme.BUCHUNG = Bewertungssumme.KVERTRAG
 Volumen.BUCHUNG = Volumen.KVERTRAG
 KÅndigung.BUCHUNG = KÅndigung.KVERTRAG
 VS_Beginn.BUCHUNG = VS_Beginn.KVERTRAG
 CodeKU.BUCHUNG = CodeKU.KVERTRAG
 SELECT KEY CodeVA.kvertrag FILE "SPARTEN" INDEX CodeVA.SPARTEN
 Sparte.BUCHUNG = Sparte.SPARTEN
 SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 Nachname.BUCHUNG = Nachname.GAdrDat$
 Vorname.BUCHUNG = Vorname.GAdrDat$
 SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
 Gesellschaft.BUCHUNG = Gesellschaft.GEADR
 Provision.buchung = "j"
 IF sr% = 0 THEN 
   SRgezahlt.buchung = "j"
   SR.buchung = 0
 ELSE 
   SRAuszahlung.buchung = Haftung%
   SR.buchung = SRBetrag%
 END IF 
 
 REM -- Zahlungseingang prÅfen --
 IF check.KVERTRAG = "j" THEN 
   _lfdnr% = lfdnr.KVERTRAG
   SELECT KEY _lfdnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   pool% = (Pool.KVERTRAG - Betrag.BUCHUNG) * 100
   pool1$ = STR$ (pool%,"999999999999")
   poolges% = ( VAL (pool1$)) / 100
   pool.kvertrag = poolges%
   IF Pool.KVERTRAG < 0 THEN 
     Mahnung.KVERTRAG = "j"
     Mahnung.BUCHUNG = "j"
     CALL WriteLog("  fehlender Zahlungseingang von Gesellschaft")
     CALL AddLogInfo()
   END IF 
   CALL QuickStore("KVERTRAG")
 END IF 
 CALL QuickStore("buchung")
 vertrprov% = provi%
 END SUB 
 
  
  
 
 ' Listendruck Kundenliste, Vertragsliste
 ' =======================================================================
 
SUB PROLIST()
 IF disabled%("PROLIST") THEN END SUB 
 sel% = 1
 DIM Listen$(180)
 maxList% = 17
 i% = 0
 Listen$(0) = "VertragsÅbersicht Kunden-Gesamt (verprovisioniert,nicht storniert)" + SPACE$ (120) + "000000"
 i% = i% + 1
 Listen$(1) = "VertragsÅbersicht Kunden-Auswahl (verprovisioniert,nicht storniert)" + SPACE$ (120) + "000001"
 i% = i% + 1
 Listen$(2) = "VertragsÅbersicht Gesellschaften (gesamt)" + SPACE$ (120) + "000002"
 i% = i% + 1
 Listen$(3) = "VertragsÅbersicht Gesellschaften (Auswahl)" + SPACE$ (120) + "000003"
 i% = i% + 1
 Listen$(4) = "VertragsÅbersicht Agenturen (gesamt)" + SPACE$ (120) + "000004"
 i% = i% + 1
 Listen$(5) = "VertragsÅbersicht Agenturen (Auswahl)" + SPACE$ (120) + "000005"
 i% = i% + 1
 Listen$(6) = "Provisionsliste" + SPACE$ (120) + "000006"
 i% = i% + 1
 Listen$(7) = "KontenÅbersicht Agenturen (gesamt)" + SPACE$ (120) + "000007"
 i% = i% + 1
 Listen$(8) = "KontenÅbersicht Agenturen (Auswahl)" + SPACE$ (120) + "000008"
 i% = i% + 1
 Listen$(9) = "VertrÑge ohne Abschlu·" + SPACE$ (120) + "000009"
 i% = i% + 1
 Listen$(10) = "Geburtstagsliste" + SPACE$ (120) + "000010"
 i% = i% + 1
 Listen$(11) = "VertragsÅbersicht FremdvertrÑge" + SPACE$ (120) + "000011"
 i% = i% + 1
 Listen$(12) = "Listengenerator (VertrÑge)" + SPACE$ (120) + "000012"
 i% = i% + 1
 Listen$(13) = "Listengenerator (Konditionen)" + SPACE$ (120) + "000013"
 i% = i% + 1
 Listen$(14) = "VertrÑge ohne Abschlu· (keine Versicherungsnummer)" + SPACE$ (120) + "000014"
 i% = i% + 1
 Listen$(15) = "Mitarbeiter-/AgenturÅbersicht" + SPACE$ (120) + "000015"
 i% = i% + 1
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
   Listen$(16) = "Mahnliste - ausstehende ZahlungseingÑnge(Standard-Abrechnungsverfahren)" + SPACE$ (120) + "000016"
   i% = i% + 1
 END IF 
 
 REM Listen$(17) = "Abgleichsliste fÅr die Umstellung auf PROVIS Real Cash" + SPACE$ (120) + "000017"
 prompt$ = Listen$(0)
 REM FOR a% = 0 TO i%
   REM Listen$(a%) = Listen$(a%) + SPACE$ (120) + STR$ (a%,"000000")
   REM IF Listen$(a%) < prompt$ THEN prompt$ = Listen$(a%)
 REM NEXT a%
 CREATE DIALOG "LISTDR",0,0,343,237,"Listendruck","MS Sans Serif",8
 ADD DIALOG "LISTDR",4,0,0,342,212,0,""
 ADD DIALOG "LISTDR",5,40,13,244,20,0,"Bitte wÑhlen Sie die Liste aus, die Sie auf den Drucker bzw. auf den Bildschirm ausgeben lassen mîchten:"
 ADD DIALOG "LISTDR",9,8,14,20,21,2
 ADD DIALOG "LISTDR",7,40,35,292,175,2,2,Listen$,Auswahl$,prompt$
 ADD DIALOG "LISTDR",1,85,215,60,15,1,"&OK",1,1
 ADD DIALOG "LISTDR",1,148,215,60,15,0,"&Abbrechen",0,0
 ADD DIALOG "LISTDR",1,210,215,60,15,0,"&Kopf-/Fu·zeilen",2,1
 DIALOG "LISTDR",req%
 REMOVE DIALOG "LISTDR"
 IF req% = 1 THEN 
   rep% = VAL ( RIGHT$ (Auswahl$(0),6))
   SELECT CASE rep%
   CASE 0
     REM VertragsÅbersicht Kunden-Gesamt (verprovisioniert,nicht storniert)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL LIST1()
   CASE 1
     REM VertragsÅbersicht Kunden-Auswahl (verprovisioniert,nicht storniert)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
     CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
     CALL DFile(3,"sparten" + _fpw$)
     CALL DFile(3,"geadr" + _fpw$)
     CALL DFile(3,"geadr2" + _fpw$)
     CALL DFile(3,"maadr" + _fpw$)
     CALL DFile(3,"maadrgru" + _fpw$)
     CALL DFile(3,"kvertrag" + _fpw$)
     CALL DFile(3,"vorgang" + _fpw$)
     CALL DFile(3,"vkond" + _fpw$)
     adr% = ADRSuche%(0)
     REM CALL LIST2(0)
     CALL LIST2(adr%)
   CASE 2
     REM VertragsÅbersicht Gesellschaften (gesamt)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL LIST3()
   CASE 3
     REM VertragsÅbersicht Gesellschaften (Auswahl)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL DFile(3,"geadr" + _fpw$)
     REM codege% = GetCodeGE%(cuge%)
     CALL LIST4()
   CASE 4
     REM VertragsÅbersicht Agenturen (gesamt)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL LIST5()
   CASE 5
     REM VertragsÅbersicht Agenturen (Auswahl)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL DFile(3,"maadr" + _fpw$)
     REM codema% = GetCodeMA%(cuma%,Workstation%)
     CALL LIST6()
   CASE 6
     REM Provisionsliste
      IF disabled%("BUCHUNG") THEN END SUB 
      IF ag$ <> "j" THEN 
        IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         DIRECTORY _ppath$
         CALL PROVILIST()
       ELSE 
         DIRECTORY _ppath$
         CALL PROVILISTZ()
       END IF 
     ELSE 
       CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
     END IF 
   CASE 7
      REM KontenÅbersicht Agenturen (gesamt)
      IF disabled%("BUCHUNG") THEN END SUB 
      IF ag$ <> "j" THEN 
        IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         DIRECTORY _ppath$
         CALL UEBERSAG2()
       ELSE 
         DIRECTORY _ppath$
         CALL UEBERSAG2Z()
       END IF 
     ELSE 
       CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
     END IF 
   CASE 8
      REM KontenÅbersicht Agenturen (Auswahl)
      IF disabled%("BUCHUNG") THEN END SUB 
      IF ag$ <> "j" THEN 
        IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         DIRECTORY _ppath$
         CALL UEBERSAG1()
       ELSE 
         DIRECTORY _ppath$
         CALL UEBERSAG1Z()
       END IF 
     ELSE 
       CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
     END IF 
   CASE 9
     REM VertrÑge ohne Abschlu·
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL LIST7(0)
   CASE 10
     REM Geburtstagsliste
     ccdir$ = DIRECTORY 
     GAdrDat$ = "ADRESSEN"
     GConDat$ = "CONNECT"
     GTelDat$ = "TELEFON"
     GAkquiDat$ = "AKQUISE"
     GDokDat$ = "DOKUMENT"
     CALL GEBLISTE()
     DIRECTORY ccdir$
 
   CASE 11
     REM VertragsÅbersicht FremdvertrÑge
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL LIST9()
   CASE 12
     REM Listengenerator (VertrÑge)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL VertrUniRep(0,0,0,0,0,0,0,0,1, - 1,tarif%)
   CASE 13
     REM Listengenerator (Konditionen)
     IF disabled%("GEKOND") THEN END SUB 
     IF ag$ <> "j" THEN 
       DIRECTORY _ppath$
       IF NOT disabled%("DATALOCK") THEN CALL GekondUniRep(0,0,0,1,1)
     ELSE 
       CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
     END IF 
   CASE 14
     REM VertrÑge ohne Abschlu· (keine Versicherungsnummer)
     IF disabled%("KVERTRAG") THEN END SUB 
     DIRECTORY _ppath$
     CALL LIST10()
   CASE 15
     REM Mitarbeiter-/AgenturÅbersicht
     IF disabled%("MAADR") THEN END SUB 
     DIRECTORY _ppath$
     CALL MAADRLIST()
   CASE 16
     REM Mahnliste - ausstehende ZahlungseingÑnge(Standard-Abrechnungsverfahren)
     IF disabled%("BUCHUNG") THEN END SUB 
     IF ag$ <> "j" THEN 
       DIRECTORY _ppath$
       CALL MAHNLIST()
     ELSE 
       CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
     END IF 
   CASE 17
     REM Abgleichsliste fÅr EinfÅhrung von Real Cash
     IF disabled%("BUCHUNG") THEN END SUB 
     IF ag$ <> "j" THEN 
       DIRECTORY _ppath$
       CALL VertrAbgleich()
     ELSE 
       CALL Fehler ("Funktion gesperrt in SmartPROVIS Agentur!","")
     END IF 
   CASE 18
     REM Provisionsliste nur Storno (Standard)

   END CASE 
 END IF 
 IF req% = 2 THEN CALL DRCONFIG()
 FORM 
 END SUB 
 
 
 
 ' Liste 1 (alle VertrÑge aller Kunden)
 ' =======================================================================
 
SUB LIST1()
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL PRep("LIST1")
 Ueberschr$ = "(alle Kunden)"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
 HEADING 
   SET REPORT PAGE "H_PAGE"
   OUTPUT REPORT PAGE 
 END HEADING 
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
 AFTER SELECT 
   SET REPORT PAGE "F_SELECT"
   OUTPUT REPORT PAGE 
 END SELECT 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 MOUSE OFF 
 ON ERROR GOTO ErrLIST1
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND inhaus.kvertrag <> 1
   ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$
   ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
   TO ASK 
 END IF 
ErrLIST1: 
 ON ERROR GOTO ErrorHandler
 MOUSE ON 
 DIRECTORY dir1$
 END SUB 
 
 
 ' Liste 2 (alle VertrÑge ausgewÑhlter Kunden)
 ' =======================================================================
 
SUB LIST2(knr%)
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SET STATUS "Bereit"
 nachname$ = ""
 ablistart% = 0
 cfile$ = FILE 
 FILE GAdrDat$
 IF knr% = 0 THEN 
   ablistart% = 1
   opt% = 1
   CREATE DIALOG "SADR",0,0,132,111,caption$,"MS Sans Serif",8
   ADD DIALOG "SADR",4,4,4,70,102,0," Suchen nach "
   ADD DIALOG "SADR",6,6,89,63,13,0,0,suna$,30
   ADD DIALOG "SADR",3,6,15,48,11,0,"Nachname",1,opt%
   ADD DIALOG "SADR",3,6,27,40,11,0,"Vorname",2,opt%
   ADD DIALOG "SADR",3,6,38,34,11,0,"Stra·e",3,opt%
   ADD DIALOG "SADR",3,6,50,26,11,0,"Ort",4,opt%
   ADD DIALOG "SADR",3,6,62,51,12,0,"Postleitzahl",5,opt%
   ADD DIALOG "SADR",3,6,75,56,11,0,"Telefon/FAX",6,opt%
   ADD DIALOG "SADR",1,78,70,50,16,1,"&Suchen",1,1
   ADD DIALOG "SADR",1,78,89,50,16,0,"&Abbruch",0,0
   DIALOG "SADR",req%
   REMOVE DIALOG ALL 
   IF req% = 1 THEN 
     SELECT CASE opt%
     CASE 1
       feld$ = "nachname." + GAdrDat$
     CASE 2
       feld$ = "vorname." + GAdrDat$
     CASE 3
       feld$ = "Stra·e." + GAdrDat$
     CASE 4
       feld$ = "Ort." + GAdrDat$
     CASE 5
       feld$ = "PLZ." + GAdrDat$
     CASE 6
       feld$ = "Telefon1." + GAdrDat$
     END SELECT 
     FILE GAdrDat$
     suna$ = "*" + suna$ + "*"
     INDEX feld$$
     SET STATUS "Suche Adressen..."
     SELECT KEY suna$ INDEX feld$$
     REQUEST "Auswahl","Nummer, Nachname, Vorname",20,req%,knr%,72,codeku.GAdrDat$,nachname.GAdrDat$,vorname.GAdrDat$ INDEX nachname.GAdrDat$ WHERE feld$$ LIKE suna$
     IF req% <> 1 THEN 
       ok% = 0
     END IF 
   ELSE 
     ok% = 0
   END IF 
 END IF 
 IF ok% = 0 THEN 
   SELECT KEY knr% INDEX codeku.GAdrDat$
   IF ablistart% = 1 THEN 
     CALL PRep("LIST1")
   ELSE 
     CALL PRep("LISTKU1")
     REQUEST "Sollen auch die stornierten VertrÑge ausgegeben werden?","",130,req1801%
     REPORT ON IF (ZW.KVERTRAG > 0,ZW.KVERTRAG * Beitrag.KVERTRAG,Beitrag.KVERTRAG) AS "sumbeitr%"
      AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
     END REPORT 
   END IF 
   Ueberschr$ = "(" + Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ + ")"
   SELECT FIRST FILE "supervis" INDEX codema.supervis
   SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
   fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
   HEADING 
   SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
   END FOOTING 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   MOUSE OFF 
   ON ERROR GOTO ErrLIST2
   IF req1801% = 1 THEN 
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       SELECT ;
       WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeKU.GAdrDat$ = knr% AND proviab.kvertrag > 0 AND inhaus.kvertrag <> 1
       ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeKU.GAdrDat$ = knr% AND proviab.kvertrag > 0
       ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
       TO ASK 
     END IF 
   ELSE 
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       SELECT ;
       WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeKU.GAdrDat$ = knr% AND storno.kvertrag < 1 AND proviab.kvertrag > 0 AND inhaus.kvertrag <> 1
       ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeKU.GAdrDat$ = knr% AND storno.kvertrag < 1 AND proviab.kvertrag > 0
       ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
       TO ASK 
     END IF 
   END IF 
ErrLIST2: 
     ON ERROR GOTO ErrorHandler
 END IF 
 MOUSE ON 
 FILE cfile$
 DIRECTORY dir1$
 END SUB 
 
 
 ' Liste 3 (alle VertrÑge aller Gesellschaften)
 ' =======================================================================
 
SUB LIST3()
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL PRep("LIST2")
 Ueberschr$ = "(alle Gesellschaften)"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
  
 HEADING 
   SET REPORT PAGE "H_PAGE"
   OUTPUT REPORT PAGE 
 END HEADING 
 FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
 END FOOTING 
 AFTER SELECT 
   SET REPORT PAGE "F_SELECT"
   OUTPUT REPORT PAGE 
 END SELECT 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 MOUSE OFF 
 ON ERROR GOTO ErrLIST3
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND inhaus.kvertrag <> 1
   ORDER Gesellschaft.GEADR,sparte.SPARTEN
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$
   ORDER Gesellschaft.GEADR,sparte.SPARTEN
   TO ASK 
 END IF 
ErrLIST3: 
   ON ERROR GOTO ErrorHandler
 MOUSE ON 
 DIRECTORY dir1$
 END SUB 
 
 
 ' Liste 4 (alle VertrÑge einer ausgewÑhlten Gesellschaft)
 ' =======================================================================
 
SUB LIST4()
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 IF FORM LIKE "GEADR" THEN 
   cfile$ = "GEADR"
   cuge% = CodeGE.GEADR
 ELSE 
   cfile$ = ""
   cuge% = 0
 END IF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 req% = 1
 IF cuge% = 0 THEN cuge% = GetCodeGE%(cuge%)
 IF cuge% <> 0 THEN 
   SELECT KEY cuge% FILE "geadr" INDEX codege.geadr
   CALL PRep("LIST2")
   Ueberschr$ = "(" + Gesellschaft.geadr + ")"
   SELECT FIRST FILE "supervis" INDEX codema.supervis
   SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
   fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
   END FOOTING 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   MOUSE OFF 
   ON ERROR GOTO ErrLIST41 
   IF MNdisabled%("VERTRINHAUSSEE") THEN 
     SELECT ;
     WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeGE.KVERTRAG = cuge% AND inhaus.kvertrag <> 1
     ORDER Gesellschaft.GEADR,sparte.SPARTEN
     TO ASK 
   ELSE 
     SELECT ;
     WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeGE.KVERTRAG = cuge%
     ORDER Gesellschaft.GEADR,sparte.SPARTEN
     TO ASK 
   END IF 
ErrLIST41: 
     ON ERROR GOTO ErrorHandler
 END IF 
 IF cfile$ LIKE "GEADR" THEN 
   FILE "GEADR"
   INDEX CodeGE.GEADR
   SELECT KEY cuge% FILE "GEADR" INDEX CodeGE.GEADR
 END IF 
 FORM 
 MOUSE ON 
 DIRECTORY dir1$
 END SUB 
 
 
 ' Liste 5 (alle VertrÑge aller Agenturen)
 ' =======================================================================
 
SUB LIST5()
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL PRep("LIST3")
 Ueberschr$ = "(alle Agenturen)"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
 HEADING 
   SET REPORT PAGE "H_PAGE"
   OUTPUT REPORT PAGE 
 END HEADING 
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
 AFTER SELECT 
   SET REPORT PAGE "F_SELECT"
   OUTPUT REPORT PAGE 
 END SELECT 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 MOUSE OFF 
 ON ERROR GOTO ErrLIST5
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND inhaus.kvertrag <> 1
   ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$
   ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN
   TO ASK 
 END IF 
ErrLIST5: 
   ON ERROR GOTO ErrorHandler
 MOUSE ON 
 DIRECTORY dir1$
 END SUB 
 
 
 ' Liste 6 (alle VertrÑge einer ausgewÑhlten Agentur)
 ' =======================================================================
 
SUB LIST6()
 IF disabled%("MAADRVERTRUEBERSICHT") THEN END SUB 
 IF FORM LIKE "MAADR" THEN 
   cfile$ = "MAADR"
   cuma% = CodeMA.MAADR
 ELSE 
   cfile$ = ""
   cuma% = 0
 END IF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 req% = 1
 IF cuma% = 0 THEN cuma% = GetCodeMA%(cuma%,Workstation%)
 IF cuma% <> 0 THEN 
   SELECT KEY cuma% FILE "maadr" INDEX CodeMA.maadr
   RepMode% = IF (ReadConfig$("PROVIS","ProServ") LIKE "true",1,0)
   IF RepMode% = 1 THEN 
     CALL PRep("LPROSERV")
     Header$ = "(" + Nachname.maadr + ", " + Vorname.MAADR + ")"
     REPORT ON Kartenanzahl.KVERTRAG AS "sumKarten%",Bewertungssumme.KVERTRAG AS "sumSumme%"
     AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
     END REPORT 
     HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
     END HEADING 
     AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
     END SELECT 
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     MOUSE OFF 
     ON ERROR GOTO ErrLIST61
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       SELECT ;
       WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeMA.KVERTRAG = cuma% AND inhaus.kvertrag <> 1
       ORDER kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeMA.KVERTRAG = cuma%
       ORDER kunde$
       TO ASK 
     END IF 
ErrLIST61: 
     IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
   ELSE 
     CALL PRep("LIST3")
     Ueberschr$ = "(" + Nachname.maadr + ")"
     SELECT FIRST FILE "supervis" INDEX codema.supervis
     SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
     fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
     HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
     END HEADING 
     FOOTING 1
       SET REPORT PAGE "F_PAGE"
       OUTPUT REPORT PAGE 
     END FOOTING 
     AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
     END SELECT 
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     MOUSE OFF 
     ON ERROR GOTO ErrLIST62
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       SELECT ;
       WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeMA.KVERTRAG = cuma% AND inhaus.kvertrag <> 1
       ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeMA.KVERTRAG = cuma%
       ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN
       TO ASK 
     END IF 
ErrLIST62: 
       IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
   END IF 
   IF cfile$ LIKE "MAADR" THEN 
     FILE "MAADR"
     INDEX CodeMA.MAADR
     SELECT KEY cuma% FILE "MAADR" INDEX CodeMA.MAADR
   END IF 
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' Konditionsliste fÅr aktuelle Agentur
 ' =======================================================================
 
SUB KLIST()
 MOUSE OFF 
 SET STATUS "Ausgabe der Konditionsliste"
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 _ma% = CodeMA.MAADR
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" AND GEinh% = 0 THEN 
   CALL PRep("KONDLIST")
 ELSE 
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" AND GEinh% = - 1 THEN 
     CALL PRep("KONDLIS2")
   ELSE 
     CALL PRep("KONDLIS1")
   END IF 
 END IF 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
  
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 

 GROUP CodeMA.MAADR
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO ErrKLIST
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.GEKOND AND CodeVA.GEKOND = codeva.SPARTEN AND CodeGE.GEKOND = CodeGE.GEADR AND CodeMA.MAADR = _ma% AND inhaus.kvertrag <> 1
   ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN,BWvon.GEKOND
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.GEKOND AND CodeVA.GEKOND = codeva.SPARTEN AND CodeGE.GEKOND = CodeGE.GEADR AND CodeMA.MAADR = _ma%
   ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN,BWvon.GEKOND
   TO ASK 
 END IF 
ErrKLIST: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 MOUSE ON 
 SET STATUS "Bereit"
 END SUB 
 
 

 ' Konditionsliste fÅr alle Agenturen
 ' =======================================================================
 
SUB KLISTAll()
 MOUSE OFF 
 SET STATUS "Ausgabe der Konditionsliste"
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 REM _ma% = CodeMA.MAADR
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" AND GEinh% = 0 THEN 
   CALL PRep("KONDLIST")
 ELSE 
   IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" AND GEinh% = - 1 THEN 
     CALL PRep("KONDLIS2")
   ELSE 
     CALL PRep("KONDLIS1")
   END IF 
 END IF 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
  
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 

 GROUP CodeMA.MAADR
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 ON ERROR GOTO ErrKLIST
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.GEKOND AND CodeVA.GEKOND = codeva.SPARTEN AND CodeGE.GEKOND = CodeGE.GEADR AND inhaus.kvertrag <> 1
   ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN,BWvon.GEKOND
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.MAADR = CodeMA.GEKOND AND CodeVA.GEKOND = codeva.SPARTEN AND CodeGE.GEKOND = CodeGE.GEADR
   ORDER REPORT Nachname.MAADR,Gesellschaft.GEADR,sparte.SPARTEN,BWvon.GEKOND
   TO ASK 
 END IF 
ErrKLIST: 
 IF test% = 0 THEN ON ERROR GOTO ErrorHandler ELSE ON ERROR 
 MOUSE ON 
 SET STATUS "Bereit"
 END SUB 
 


SUB KLIST2()
 IF NOT MNdisabled%("DATALOCK") THEN 
   CALL GekondUniRep(CodeMA.MAADR,0,0,1,1)
 ELSE 
   CALL GekondUniRep(CodeMA.MAADR,0,0,2,0)
 END IF 
 END SUB 
 
SUB KLIST3()
 IF NOT MNdisabled%("DATALOCK") THEN 
   CALL GekondUniRep(CodeMA.GEKOND,CodeGE.GEKOND,CodeVA.GEKOND,1,1)
 ELSE 
   CALL GekondUniRep(CodeMA.GEKOND,CodeGE.GEKOND,CodeVA.GEKOND,1,0)
 END IF 
 END SUB 
 
SUB KLIST2All()
 IF NOT MNdisabled%("DATALOCK") THEN 
   CALL GekondUniRep(0,0,0,1,1)
 ELSE 
   CALL GekondUniRep(0,0,0,2,0)
 END IF 
 END SUB 
 
  
 
 ' Liste 7 (VertrÑge ohne Provisionszuordnung)
 ' =======================================================================
 ' 09.12.94  - Ausschlu· von FremdvertrÑgen
 
SUB LIST7(codeku%)
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 FILE "Kvertrag"
 INDEX codeku.kvertrag
 SELECT WHERE codeku.kvertrag = codeku%
 CALL PRep("LIST1")
 IF codeku% = 0 THEN 
   Ueberschr$ = "(VertrÑge ohne Abschlu· aller Kunden)"
 ELSE 
   SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
   c% = codeku%
   Ueberschr$ = "(VertrÑge ohne Abschlu·) " + nachname.GAdrDat$
 END IF 
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
 HEADING 
   SET REPORT PAGE "H_PAGE"
   OUTPUT REPORT PAGE 
 END HEADING 
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
 AFTER SELECT 
   SET REPORT PAGE "F_SELECT"
   OUTPUT REPORT PAGE 
 END SELECT 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 MOUSE OFF 
 ON ERROR GOTO ErrLIST7
 k$ = "KVERTRAG"
 IF codeku% = 0 THEN 
   IF MNdisabled%("VERTRINHAUSSEE") THEN 
     SELECT ;
     WHERE CodeMA.k$ = CodeMA.MAADR AND CodeGE.k$ = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND ProviAb.KVERTRAG < 1 AND Fremdvertrag.KVERTRAG <> "j" AND Altvertrag.KVERTRAG <> "j" AND inhaus.k$ <> 1
     ORDER Kunde$,gesellschaft.geadr
     TO ASK 
   ELSE 
     SELECT ;
     WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND ProviAb.KVERTRAG < 1 AND Fremdvertrag.KVERTRAG <> "j" AND Altvertrag.KVERTRAG <> "j"
     ORDER Kunde$,gesellschaft.geadr
     TO ASK 
   END IF 
 ELSE 
   IF MNdisabled%("VERTRINHAUSSEE") THEN 
     SELECT ;
     WHERE Codeku = c% AND CodeMA.K$ = CodeMA.MAADR AND CodeGE.K$ = CodeGE.GEADR AND CodeVA.K$ = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GADRDat$ AND ProviAb.K$ < 1 AND Fremdvertrag.K$ <> "j" AND Altvertrag.K$ <> "j" AND inhaus.K$ <> 1
     ORDER Kunde$,gesellschaft.geadr
     TO ASK 
   ELSE 
     SELECT ;
     WHERE Codeku = c% AND CodeMA.K$ = CodeMA.MAADR AND CodeGE.K$ = CodeGE.GEADR AND CodeVA.K$ = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GADRDat$ AND ProviAb.K$ < 1 AND Fremdvertrag.K$ <> "j" AND Altvertrag.K$ <> "j"
     ORDER Kunde$,gesellschaft.geadr
     TO ASK 
   END IF 
 END IF 
ErrLIST7: 
   ON ERROR GOTO ErrorHandler
 MOUSE ON 
 DIRECTORY dir1$
 SELECT WHERE FILE "Kvertrag"
 END SUB 
 
 
 ' Liste 8 (VertragsÅbersicht der aktuellen Sparte)
 ' =======================================================================
 
SUB LIST8()
 cuva% = CodeVA.SPARTEN
 CALL VertrUniRep(0,0,CodeVA.SPARTEN,0,4,0,0,0,1, - 1,tarif%)
 FILE "SPARTEN"
 SELECT KEY cuva% FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SET INDEX Sparte.SPARTEN
 INDEX Sparte.SPARTEN
 FORM 
 END SUB 
 
SUB LIST8SPGR()
 _codegrsp% = CodeGrsp.SPGRUPPE
 CALL VertrUniRep(0,0,0,0,5,0,0,0,1,CodeGrSp.spgruppe,tarif%)
 FILE "SPGRUPPE"
 SELECT KEY _codegrsp% FILE "SPGRUPPE" INDEX CodeGrsp.SPGRUPPE
 SET INDEX Gruppe.SPGRUPPE
 INDEX Gruppe.SPGRUPPE
 FORM 
 END SUB 
 
 ' Liste 9 (öbersicht Åber alle FremdvertrÑge)
 ' =======================================================================
 
SUB LIST9()
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL PRep("LIST1")
 Ueberschr$ = "(FremdvertrÑge)"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
 HEADING 
   SET REPORT PAGE "H_PAGE"
   OUTPUT REPORT PAGE 
 END HEADING 
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
 AFTER SELECT 
   SET REPORT PAGE "F_SELECT"
   OUTPUT REPORT PAGE 
 END SELECT 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 MOUSE OFF 
 k$ = "KVERTRAG"
 IF test% <> 0 THEN ON ERROR GOTO ErrLIST9
   IF MNdisabled%("VERTRINHAUSSEE") THEN 
     SELECT ;
     WHERE Fremdvertrag.K$ LIKE "j" AND CodeMA.K$ = CodeMA.MAADR AND CodeGE.K$ = CodeGE.GEADR AND CodeVA.K$ = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND inhaus.k$ <> 1
     ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
     TO ASK 
   ELSE 
     SELECT ;
     WHERE Fremdvertrag.KVERTRAG LIKE "j" AND CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$
     ORDER Nachname.GAdrDat$,gesellschaft.geadr,sparte.SPARTEN
     TO ASK 
   END IF 
ErrLIST9: 
   IF test% <> 0 THEN ON ERROR GOTO ErrorHandler
 MOUSE ON 
 END SUB 
 
 
 ' Liste 10 (VertrÑge ohne Abschlu· - keine Versicherungsnummer
 ' =======================================================================
 ' 17.07.95 
 
SUB LIST10()
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL PRep("LIST1")
 Ueberschr$ = "(VertrÑge ohne Abschlu·)"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
 HEADING 
   SET REPORT PAGE "H_PAGE"
   OUTPUT REPORT PAGE 
 END HEADING 
  FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
  END FOOTING 
 AFTER SELECT 
   SET REPORT PAGE "F_SELECT"
   OUTPUT REPORT PAGE 
 END SELECT 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 MOUSE OFF 
 ON ERROR GOTO ErrLIST10
 k$ = "KVERTRAG"
 IF MNdisabled%("VERTRINHAUSSEE") THEN 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND VS_Nr.KVERTRAG = "" AND Fremdvertrag.KVERTRAG <> "j" AND Altvertrag.KVERTRAG <> "j" AND inhaus.k$ <> 1
   ORDER Kunde$,gesellschaft.geadr,sparte.SPARTEN
   TO ASK 
 ELSE 
   SELECT ;
   WHERE CodeMA.KVERTRAG = CodeMA.MAADR AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND VS_Nr.KVERTRAG = "" AND Fremdvertrag.KVERTRAG <> "j" AND Altvertrag.KVERTRAG <> "j"
   ORDER Kunde$,gesellschaft.geadr,sparte.SPARTEN
   TO ASK 
 END IF 
ErrLIST10: 
   ON ERROR GOTO ErrorHandler
 MOUSE ON 
 END SUB 
 
 
 ' Vertragsinformationen
 ' =======================================================================
 
SUB VERTRINFO()
anfs141120031: 
 cuivt% = 0
 CALL DFile(2,"OFFICE\KVHIS" + _fpw$)
 IF EXISTS (_netpath$ + "PROVIS\statukey.sbf") THEN CALL DFile(3,"STATUKEY" + _fpw$)
 CALL DFile(3,"VProdukt" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 IF gfsc% = - 1 THEN CALL DFile(3,"fs24imp" + _fpw$)
 IF disabled%("VERTRAGSUCHE") THEN END SUB 
 okma% = 0
 IF gasp% THEN 
   IF workstation% > 0 THEN 
     IF NOT EXISTS (workstation%,workstation.kvertrag) THEN 
       CALL Fehler("Es existieren noch keine VertrÑge fÅr Ihr BÅro!","")
       GOTO endsu141120031
     ELSE 
       IF GMASuperCount% > 0 THEN 
         FOR i% = 0 TO GMASuperCount% - 1
           IF EXISTS (GMASuper%(i%),codema.kvertrag) THEN 
             SELECT FIRST FILE "Kvertrag" INDEX codema.kvertrag
             SELECT KEY GMASuper%(i%) FILE "Kvertrag" INDEX codema.kvertrag
             cuivt% = lfdnr.kvertrag
             okma% = - 1
             i% = GMASuperCount% + 1
           END IF 
         NEXT i%
         IF okma% <> - 1 THEN 
           CALL Fehler("Es existieren noch keine VertrÑge fÅr die Sie eine Einsichtberechtigung haben!","")
           GOTO endsu141120031 
         END IF 
       ELSE 
         SELECT FIRST FILE "Kvertrag" INDEX workstation.kvertrag
         SELECT KEY workstation% FILE "Kvertrag" INDEX workstation.kvertrag
         cuivt% = lfdnr.kvertrag
       END IF 
     END IF 
   END IF 
 END IF 
 REM IF MNdisabled%("DATALOCK") THEN 
   REM CALL Fehler("Der Zugriff auf diese Funktion ist gesperrt!","Bitte rufen Sie die Vertragsverwaltung Åber die Adre·verwaltung auf.")
   REM END SUB 
 END IF 
 CALL DFile(3,"WKNR" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"Tarif" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vorgang" + _fpw$)
 CALL DFile(3,"FONDS" + _fpw$)
 CALL DFile(3,"Kgeadr" + _fpw$)
 CALL DFile(3,"WAEHRUNG" + _fpw$)
 CALL DFile(3,"KUKTO" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
   CALL DFile(3,"AFSKSUT" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SET MENU OFF 
 FILE "KVERTRAG"
 _formend% = 0
 askonerror% = 0
     IF MNdisabled%("VERTRINHAUSSEE") THEN 
       bef$ = "Select where inhaus.kvertrag<>1"
       EXECUTE bef$
     END IF 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "IVERTRAG" THEN 
     REM OPEN FORM "IVERTRAG"
     IF EXISTS (GPrjForm$ + "IVERTRAG.sbv") THEN 
       OPEN FORM GPrjForm$ + "IVERTRAG"
     ELSE 
       OPEN FORM GPrjForm$ + "IVERTRAG"
     END IF 
     SET HEADING title$ + " - Vertragsinformationen"
     CALL MNVERTRI()
     INDEX VS_NR.KVERTRAG




     IF cuivt% <> 0 THEN 
       SELECT FORM KEY cuivt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     ELSE 
       SELECT FORM FIRST 
     END IF 
     SET STATUS "Vertragsinformationen"
     FORM 
     GAppName$ = _netpath$ + "DOC\kvertrag.pdf"
   END IF 
   okma% = 0
   IF GASP% AND workstation% > 0 THEN 
     IF GMASuperCount% > 0 THEN 
       FOR i% = 0 TO GMASuperCount% - 1
         IF GMASuper%(i%) = codema.kvertrag THEN 
           okma% = - 1
           i% = GMASuperCount% + 1
         END IF 
       NEXT i%
       IF okma% = 0 THEN GOTO anfs141120031
     ELSE 
       IF workstation.kvertrag <> workstation% THEN GOTO anfs141120031
     END IF 
   ELSE 
     IF GMASuperCount% > 0 THEN 
       sok% = 0
       WHILE NOT EOF ("KVERTRAG") AND sok% = 0
         REM IF workstation.cfile$ = 83 THEN CALL Fehler("83","")
         IF IsMASuper%(codema.KVERTRAG) <> - 1 THEN 
           SELECT NEXT FILE "KVERTRAG"
         ELSE 
           sok% = - 1
         END IF 
       WEND 
       IF sok% = 0 THEN 
         CALL Fehler("Es wurden noch keine VertrÑge erfa·t, in die Sie Einblick nehmen dÅrfen!","")
         END SUB 
       END IF 
     END IF 
   END IF 
   MOUSE ON 
   MENU ON 
   VIsub% = 0
   CALL VIUpdate()
   CALL ClearKBDBuffer()
   WAIT MOUSE OR KEY OR MENU 
    REM ** Tastencodes
   GET k$
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   
 WEND 
 _formend% = 0
endsu141120031: 
 END SUB 
 
 
 ' IVERTRAG Maskenupdate
 ' =======================================================================
 
SUB VIUpdate()
 SELECT KEY CodeMA.kvertrag FILE "maadr" INDEX CodeMA.maadr
 IF FOUND ("MAADR") THEN maadr$ = Nachname.maadr + ", " + LEFT$ (Vorname.MAADR,1) + "." ELSE maadr$ = "<keine Zuordnung>"
 SELECT KEY CodeVA.kvertrag FILE "sparten" INDEX CodeVA.sparten
 IF FOUND ("SPARTEN") THEN sparte$ = Sparte.sparten ELSE sparte$ = "<keine Zuordnung>"
 SELECT KEY CodeGE.kvertrag FILE "GEADR" INDEX CodeGE.geadr
 IF FOUND ("GEADR") THEN geadr$ = Gesellschaft.geadr ELSE geadr$ = "<keine Zuordnung>"
 SELECT KEY CodeKU.kvertrag FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 REM IF FOUND (GAdrDat$) THEN Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$ ELSE Kunde$ = "<keine Zuordnung>"
 SELECT KEY lfdnr.kvertrag FILE "VORGANG" INDEX CodeVT.VORGANG
 Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 Zahlart$ = Zahlart2Str$(Zahlart.KVERTRAG)
 FILE "KVERTRAG"
 FORM 
 END SUB 
  
 
 ' Vertrag suchen (Info)
 ' =======================================================================
 ' 17.04.95  - Umstellung auf QUICKVSNR
 ' 10.05.95  - Umstellung auf FUNCTION GetVertrag%...
 
SUB VISuchen()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 cuvt% = lfdnr.KVERTRAG
 nvt% = GetVertrag%(lfdnr.KVERTRAG)
 IF nvt% <> 0 THEN cuvt% = nvt%
 SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SET INDEX QuickVSNR.KVERTRAG
 INDEX QuickVSNR.KVERTRAG
 MOUSE ON 
 SET STATUS "Bereit"
 END SUB 
 
 REM andi 23.04.2003
SUB VISuchen1()
 CALL DFile(3,"geadr" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"vprodukt" + _fpw$)
 CALL DFile(3,"spezkond" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 viab% = 1
 cfile$ = FILE 
 indab$ = INDEX 
 codevt% = lfdnr.KVERTRAG
 akver1% = 1

 ma% = 0
 ge% = 0
 spa% = 0
 cvp% = 0
 eingbei% = 0

 IF FORM LIKE "IVERTRAG" THEN 
   GCodeGE% = 0
   GCodeVA% = 0
   GCodeVP% = 0
   GCodeMA% = 0
   GCodeEingGE% = 0
 END IF 

 IF GCodeGE% <> 0 THEN ge% = GCodeGE%
 IF GCodeVA% <> 0 THEN spa% = GCodeVA%
 IF GCodeVP% <> 0 THEN cvp% = GCodeVP%
 IF GCodeMA% <> 0 THEN ma% = GCodema%
 IF GCodeEingGE% <> 0 THEN eingbei% = GCodeEingGE%

 GDatumVON% = 0
 GDatumBis% = 0
 GSuFromAdr% = 0


  DIM dlg AS Dialog
  DIM control AS DialogControl
 
 ok% = - 1
 WHILE ok%
 
    IF ma% = 0 THEN 
      dVermittler$ = "alle"
    ELSE 
      SELECT KEY ma% FILE "MAADR" INDEX CodeMA.MAADR
      dVermittler$ = Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + "."
    END IF 
    IF spa% = 0 THEN 
      dSparte$ = "alle"
    ELSE 
      SELECT KEY spa% FILE "SPARTEN" INDEX CodeVA.SPARTEN
      dsparte$ = Sparte.SPARTEN
    END IF 
    IF ge% = 0 THEN 
      dGes$ = "alle"
    ELSE 
      SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
      dGes$ = Gesellschaft.GEADR
      REM ** Gesellschaft auswÑhlen
    END IF 
 
    IF eingbei% = 0 THEN 
      deingbei$ = "alle"
    ELSE 
      SELECT KEY eingbei% FILE "GEADR" INDEX CodeGE.GEADR
      deingbei$ = Gesellschaft.GEADR
    END IF 

    IF cvp% = 0 THEN 
      dprodukt$ = "alle"
    ELSE 
      SELECT KEY cvp% FILE "Vprodukt" INDEX codevp.vprodukt
      dprodukt$ = gesellschaft.vprodukt + "/" + sparte.vprodukt
    END IF 
 
    REM IF GVSupersuch% = 0 THEN 
    Superbase.Dialogs.Add("vsuch")
    SET dlg = Superbase.Dialogs.vsuch
    dlg.Move(0,0,378,209)
    dlg.Caption = title$
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame6","DialogFrame")
    control.Move(0,1,378,181)
    control.Caption = "Vertragssuche"
 
    SET control = dlg.Add("DialogFrame4","DialogFrame")
    control.Move(148,11,230,77)
    control.Caption = "Filter"
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(2,166,142,11)
    control.MaxLength = 30
    control.TextBinding = "suna$"


    
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(153,24,41,11)
    control.Caption = "Vermittler"
 
    SET control = dlg.Add("DialogLabel8","DialogLabel")
    control.Move(197,24,157,11)
    control.CaptionBinding = "dVermittler$"
 
    SET control = dlg.Add("DialogCommandButton3","DialogCommandButton")
    control.Move(357,24,17,9)
    control.Default = 1
    control.Caption = "..."
    control.ReturnValue = 5
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(153,36,41,10)
    control.Caption = "Gesellschaft"
 
    SET control = dlg.Add("DialogLabel9","DialogLabel")
    control.Move(197,36,157,10)
    control.CaptionBinding = "dGes$"
 
    SET control = dlg.Add("DialogCommandButton4","DialogCommandButton")
    control.Move(357,36,17,8)
    control.Default = 1
    control.Caption = "..."
    control.ReturnValue = 2
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(153,48,41,11)
    control.Caption = "Sparte"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(197,48,157,11)
    control.CaptionBinding = "dSparte$"
 
    SET control = dlg.Add("DialogCommandButton5","DialogCommandButton")
    control.Move(357,48,17,9)
    control.Default = 1
    control.Caption = "..."
    control.ReturnValue = 3
 
    SET control = dlg.Add("DialogLabel7","DialogLabel")
    control.Move(153,60,41,10)
    control.Caption = "Produkt"
 
    SET control = dlg.Add("DialogLabel11","DialogLabel")
    control.Move(197,60,157,10)
    control.CaptionBinding = "dProdukt$"
 
    SET control = dlg.Add("DialogCommandButton6","DialogCommandButton")
    control.Move(357,60,17,10)
    control.Default = 1
    control.Caption = "..."
    control.ReturnValue = 4

    IF NOT MNdisabled%("SEEEINGBEI") THEN 
      SET control = dlg.Add("DialogLabel18","DialogLabel")
      control.Move(153,72,41,10)
      control.Caption = "eing.Åber"
 
      SET control = dlg.Add("DialogLabel12","DialogLabel")
      control.Move(197,72,157,10)
      control.CaptionBinding = "deingbei$"
 
      SET control = dlg.Add("DialogCommandButton27","DialogCommandButton")
      control.Move(357,72,17,10)
      control.Default = 1
      control.Caption = "..."
      control.ReturnValue = 55
    END IF 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(2,17,142,23)
    control.Caption = "Bitte geben Sie an, Åber welche Infor- mation Sie den Vertrag suchen mîchten"
 
    SET control = dlg.Add("DialogFrame2","DialogFrame")
    control.Move(2,39,142,111)
    control.Caption = "Standardsuche (schnell):"
 
    SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
    control.Move(9,52,99,10)
    control.Caption = "Vertrags&nummer"
    control.Bind("akVer1%")
    control.ValueOn = 1
 
    SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
    control.Move(9,64,99,11)
    control.Caption = "Antragsnummer"
    control.Bind("akVer1%")
    control.ValueOn = 6
 
    SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
    control.Move(9,91,132,9)
    control.Caption = "KFZ-&Kennzeichen"
    control.Bind("akVer1%")
    control.ValueOn = 2
 
    SET control = dlg.Add("DialogOptionButton4","DialogOptionButton")
    control.Move(9,101,132,10)
    control.Caption = "KFZ-&Fabrikat"
    control.Bind("akVer1%")
    control.ValueOn = 3
 
    SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
    control.Move(9,112,132,11)
    control.Caption = "Risiko/versicherte Person"
    control.Bind("akVer1%")
    control.ValueOn = 4
 
    SET control = dlg.Add("DialogOptionButton6","DialogOptionButton")
    control.Move(9,124,132,10)
    control.Caption = "Tarifinfo"
    control.Bind("akVer1%")
    control.ValueOn = 5
 
    IF Gfsc% = - 1 THEN 
      SET control = dlg.Add("DialogOptionButton7","DialogOptionButton")
      control.Move(9,136,132,9)
      control.Caption = "FS24 - Referenz"
      control.Bind("akVer1%")
      control.ValueOn = 7
    END IF 
    IF Gfpb% = - 1 THEN 
      SET control = dlg.Add("DialogOptionButton7","DialogOptionButton")
      control.Move(9,136,132,9)
      control.Caption = "Spezialistenprovisionen"
      control.Bind("akVer1%")
      control.ValueOn = 7
    END IF 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(8,78,106,10)
    control.Caption = "erweiterte Suche (langsamer):"
 
    SET control = dlg.Add("DialogFrame5","DialogFrame")
    control.Move(148,89,230,47)
    control.Caption = "Vertragserfassungsdatum"
 
    SET control = dlg.Add("DialogTextBox4","DialogTextBox")
    control.Move(172,107,52,11)
    control.MaxLength = 10
    control.TextBinding = "von$"
 
    SET control = dlg.Add("DialogTextBox5","DialogTextBox")
    control.Move(245,107,52,11)
    control.MaxLength = 10
    control.TextBinding = "bis$"
 
    SET control = dlg.Add("DialogLabel32","DialogLabel")
    control.Move(154,108,16,10)
    control.Caption = "von"
 
    SET control = dlg.Add("DialogLabel13","DialogLabel")
    control.Move(226,108,16,10)
    control.Caption = "bis"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(2,153,139,11)
    control.Caption = "&Suchbegriff:"
 
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(127,188,54,13)
    control.Default = 1
    control.Caption = "&Weiter"
    control.ReturnValue = 66
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(185,188,56,13)
    control.Caption = "&Abbruch"
    control.ReturnValue = 0
    control.Cancel = 1
  
    DIALOG "vsuch",dreq%
    REMOVE DIALOG "vsuch"

    

    SELECT CASE dreq%
      CASE 0
        req% = 0
        ok% = 0
        nvtab% = 0
        GOTO end160520031
      CASE 66
        IF von$ = "" THEN von$ = "01.01.0001"
        IF bis$ = "" THEN bis$ = "31.12.2999"
        IF DateOK%(von$) THEN 
          ok% = 1
          IF DateOK%(bis$) THEN 
            ok% = 1
          ELSE 
            ok% = - 1
            CALL Fehler("Falsche Datumsangabe bei ...bis: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
          END IF 
        ELSE 
          ok% = - 1
          CALL Fehler("Falsche Datumsangabe bei ...von: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
        END IF 
        ok% = 0
        req% = 1
      CASE 5
        wks1% = Workstation%
        REM ma% = GetCodeMA%(ma%,Wks1%)
        ma1% = GetCodeMA%(ma%,Wks1%)
        IF Gasp% = - 1 AND workstation% > 0 THEN 
          IF ma% <> 0 AND ma1% = 0 THEN 
          ELSE 
            IF ma1% > 0 THEN ma% = ma1%
          END IF 
        ELSE 
          ma% = ma1%
        END IF 
      CASE 2
        ge% = GetCodeGE%(ge%)
        cvp% = 0
      CASE 55
        eingbei% = GetCodeGEE%(ge%)
        cvp% = 0
      CASE 3
        spa% = GetCodeVA%(spa%)
        cvp% = 0
      CASE 4
        cvp% = GetVprodukt%(0,0,0)
        ge% = 0
        spa% = 0
    END SELECT 

 WEND 

 IF suna$ = "" THEN 
   IF LTRIM$ (von$) <> "" OR LTRIM$ (bis$) <> "" THEN 
     suna$ = "*"
   END IF 
 END IF 
 Eingabe$ = suna$

 IF LTRIM$ (von$) = "" THEN 
   vongen$ = "1.1.0001"
 ELSE 
   vongen$ = von$
   vongen% = DAYS (vongen$)
 END IF 
 IF LTRIM$ (bis$) = "" THEN 
   bisgen$ = "31.12.5000"
 ELSE 
   bisgen$ = bis$
   bisgen% = DAYS (bisgen$)
 END IF 

 IF req% = 1 THEN 
   REDIM G1Vertraege$(1,1)
   IF akver1% = 0 THEN 
     a% = VERTRSuch%(CodeKU.KVERTRAG,cuvt%)
     IF a% <> 0 THEN cuvt% = a%
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   END IF 
   IF akver1% = 1 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GetVertrADR%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,vongen$,bisgen$,eingbei%)
       REM IF nvt% <> 0 THEN cuvt% = nvt%
       IF nvt% <> 0 THEN 
         cuvt% = nvt%
         REM Suchergebnis in die Datei KVHIS eintragen
         BLANK FILE "KVHIS"
         codekey.KVhis = SER ("KVHIS",1)
         codema.kvhis = GMACodeMA%
         lfdnr.kvhis = cuvt%
         SELECT FIRST FILE "Kvertrag" INDEX lfdnr.kvertrag
         SELECT KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
         SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
         SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
         name.kvhis = LEFT$ (VS_NR.kvertrag + "  /  " + Gesellschaft.kvertrag + "/" + Sparte.kvertrag + "/" + Nachname.adressen + "/" + Vorname.adressen,200)
         QCodeMAKey.kvhis = STR$ (GMACodeMA%,"000000") + STR$ (codekey.kvhis,"000000")
         timestamp$ = DATE$ ( TODAY ,"yymmdd") + STR$ ( HRS ( NOW ) * 100 + MINS ( NOW ),"0000")
         timestamp% = VAL (timestamp$)
         Timestamp.kvhis = timestamp%
         STORE FILE "kvHIS"
       ELSE 
         REQUEST "kein Vertrag gefunden!","",2
         cuvt% = 0
         nvt% = 0
         codevt% = 0
       END IF 
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde keine Vertragsnummer eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 

   IF akver1% = 7 THEN 
     REM Suche FS24Referenz
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETFS24Nr%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,von$,bis$)
 
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein FS24-Referenz eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 
   IF akver1% = 6 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       GCodema% = ma%
       GCodeGE% = ge%
       GCodeVA% = spa%
       GCodeVP% = cvp%
       GCodeEingGE% = eingbei%
       GSuFromAdr% = - 1
       IF von$ <> "" THEN GDatumVON% = DAYS (von$)
       IF bis$ <> "" THEN GDatumBis% = DAYS (bis$)
       IF von$ = "01.01.0001" THEN GDatumVON% = 0
       IF bis$ = "31.12.2999" THEN GDatumBIS% = 0
       nvt% = GetAntrag%(lfdnr.KVERTRAG)
       GCodema% = 0
       GCodeGE% = 0
       GCodeVA% = 0
       GCodeVP% = 0
       GDatumVON% = 0
       GDatumBis% = 0
       GSuFromAdr% = 0
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde keine Antragsnummer eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 
 
   IF akver1% = 2 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZKeADR%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,von$,bis$,eingbei%)
 
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein Kennzeichen eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 3 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZTypADR%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,von$,bis$,eingbei%)
 
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein KFZ-Typ eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   REM 181199
   IF akver1% = 4 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETRisikoADR%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,von$,bis$,eingbei%)
 
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein Risiko eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   REM GETTarifInfo%
   IF akver1% = 5 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETTarifADR%(lfdnr.kvertrag,ma%,ge%,spa%,cvp%,von$,bis$,eingbei%)
 
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde keine Tarifinfo eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 ELSE 
   nvt% = codevt%

 END IF 

 REM CALL VAn280403()
 IF nvt% = 0 THEN 
   cuvt% = 0
   nvt% = codevt%
 END IF 

 IF nvt% > 0 THEN SELECT FORM KEY nvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 nvtab% = nvt%
 IF nvt% = 0 THEN 
   REM CALL Fehler("Es wurde kein Vertrag gefunden","")
 END IF 
 END IF 
 FORM 
end160520031: 
 FILE cfile$
 INDEX indab$
 SET STATUS "Bereit"
 END SUB 
 

SUB VAn280403()
 lok% = - 1
 prompt$ = Gprompt$
 WHILE lok%


         CREATE DIALOG "ZEINLIST",0,0,570,348,title$,"Courier New",9
         ADD DIALOG "ZEINLIST",4,0,0,570,332,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
         ADD DIALOG "ZEINLIST",5,35,31,168,20,0,"Bitte wÑhlen Sie den Vertrag aus, fÅr den diese Zahlung gilt."
         ADD DIALOG "ZEINLIST",5,35,58,400,10,0,"Vertrags-/Policennummer      von         bis       erfasst              Kunde"
         ADD DIALOG "ZEINLIST",7,5,68,555,255,2 + 128,1,G1Vertraege$,Auswahl$,prompt$
         
         ADD DIALOG "ZEINLIST",1,228,332,55,15,1,"Info",2,1
         ADD DIALOG "ZEINLIST",1,173,332,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,283,332,55,15,0,"&Abbrechen",0,0
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"

         SELECT CASE req%
         CASE 1,3
           cuvt% = VAL ( RIGHT$ (Auswahl$(0),6))
           REM lok% = 0
           IF req% = 3 THEN 
             kontoinf% = cuvt%
           ELSE 
             kontoinf% = 0
           END IF 
         CASE 0
           
           cuvt% = 0
           lok% = 0
         CASE 2
           CALL VINFO( VAL ( RIGHT$ (Auswahl$(0),6)))
           prompt$ = Auswahl$(0)
         END SELECT 
         IF cuvt% <> 0 AND req% <> 2 THEN 
           SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
           prompt$ = Auswahl$(0)
           CALL VINFBearb()
         END IF 
  WEND 
 END SUB 

 
 REM andi 26.10.95
SUB VTSuchen1()
 viab% = 1
 cfile$ = FILE 
 indab$ = INDEX 
 cuvt% = lfdnr.KVERTRAG
 akver1% = 1
 CREATE DIALOG "vsuch",0,0,175,166,title$,"MS Sans Serif",8
 ADD DIALOG "vsuch",9,6,6,24,22,2
 ADD DIALOG "vsuch",5,34,6,132,10,0,"Vertrag suchen"
 ADD DIALOG "vsuch",4,34,14,132,5,0,""
 ADD DIALOG "vsuch",5,34,22,132,26,0,"Bitte geben Sie an, Åber welche Infor- mation Sie den Vertrag suchen mîchten"
 REM ADD DIALOG "vsuch",3,34,49,154,10,0,"alle VertrÑge anzeigen",0,akVer1%
 ADD DIALOG "vsuch",5,34,45,175,26,0,"Standardsuche (schnell):"
 ADD DIALOG "vsuch",5,34,71,175,26,0,"erweiterte Suche (langsamer):"
 ADD DIALOG "vsuch",6,34,121,132,12,0,0,Eingabe$,20
 ADD DIALOG "vsuch",3,41,57,148,10,0,"Vertrags&nummer",1,akVer1%
 ADD DIALOG "vsuch",3,41,83,132,10,0,"KFZ-&Kennzeichen",2,akVer1%
 ADD DIALOG "vsuch",3,41,95,132,10,0,"KFZ-&Typ",3,akVer1%
 ADD DIALOG "vsuch",5,34,111,175,10,0,"&Suchbegriff:"
 REM ADD DIALOG "vsuch",4,26,102,190,38,0,"Bitte den Suchbegriff eingeben"
 ADD DIALOG "vsuch",1,28,145,55,14,1,"&Weiter",1,1
 ADD DIALOG "vsuch",1,87,145,55,14,0,"&Abbruch",0,0
 DIALOG "vsuch",req%
 REMOVE DIALOG "vsuch"
 IF req% = 1 THEN 
   IF akver1% = 0 THEN 
     a% = VERTRSuch%(CodeKU.KVERTRAG,cuvt%)
     IF a% <> 0 THEN cuvt% = a%
     SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   END IF 
   IF akver1% = 1 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GetVertrag%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde keine Vertragsnummer eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 2 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZKe%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein Kennzeichen eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
   IF akver1% = 3 THEN 
     IF eingabe$ <> "" THEN 
       eingab$ = eingabe$
       nvt% = GETKFZTyp%(lfdnr.KVERTRAG)
       IF nvt% <> 0 THEN cuvt% = nvt%
       eingab$ = ""
     ELSE 
       CALL Fehler("Es wurde kein KFZ-Typ eingegeben!","Vertrag kann nicht gesucht werden!")
     END IF 
   END IF 
 END IF 
 SELECT FORM KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF nvt% = 0 THEN 
   CALL Fehler("Es wurde kein Vertrag gefunden","")
 END IF 
 END IF 
 FORM 
 FILE cfile$
 INDEX indab$
 SET STATUS "Bereit"
 END SUB 
 
 
 
 
 
 
 ' Vertrag aus Infomodus heraus bearbeiten
 ' =======================================================================
 ' 18.09.95  - öbergang in KVERTRAG korrigiert
 
SUB VINFBearb()
 ON ERROR GOTO ErrorHandler
 cuvt% = lfdnr.KVERTRAG
 REM knr% = Codeku.GAdrDat$
 knr% = Codeku.Kvertrag
 lfdnr% = lfdnr.KVERTRAG
 SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
 REM CALL KVERTRAG()
 IF cuvt% <> 0 THEN 
   ok% = 0
   IF GMASuperCount% > 0 THEN 
     SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
     SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
     IF IsMASuper%(codema.GADRDAT$) <> - 1 THEN 
       ok% = 0
       cuvt% = 0
       lfdnr% = 0
     ELSE 
       ok% = - 1
     END IF 
   ELSE 
     ok% = - 1
   END IF 
   IF ok% = - 1 THEN 
         REM cuvt% = nvt%
         REM Suchergebnis in die Datei KVHIS eintragen
         ON ERROR GOTO w151020043
         BLANK FILE "KVHIS"
         codekey.KVhis = SER ("KVHIS",1)
         codema.kvhis = GMACodeMA%
         lfdnr.kvhis = cuvt%
         SELECT FIRST FILE "Kvertrag" INDEX lfdnr.kvertrag
         SELECT KEY cuvt% FILE "Kvertrag" INDEX lfdnr.kvertrag
         SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
         SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
         name.kvhis = LEFT$ (VS_NR.kvertrag + "  /  " + Gesellschaft.kvertrag + "/" + Sparte.kvertrag + "/" + Nachname.adressen + "/" + Vorname.adressen,200)
         QCodeMAKey.kvhis = STR$ (GMACodeMA%,"000000") + STR$ (codekey.kvhis,"000000")
         timestamp$ = DATE$ ( TODAY ,"yymmdd") + STR$ ( HRS ( NOW ) * 100 + MINS ( NOW ),"0000")
         timestamp% = VAL (timestamp$)
         Timestamp.kvhis = timestamp%
         STORE FILE "kvHIS"
 GOTO w151020044
w151020043: 
 CALL Fehler("Beim Speichern in der KVHIS - Datei ist ein Fehler aufgetreten!","Bitte diese Datei reorganisieren!")
w151020044: 
 ON ERROR GOTO ErrorHandler 
 END IF 
 IF lfdnr% <> 0 THEN CALL KVERTRAGneu(lfdnr%)
 END SUB 
 
 
SUB VIKunde()
 SET STATUS "anderen Kunden zuweisen..."
 FILE "KVERTRAG"
 cuknr% = codeku.KVERTRAG
 adr% = ADRSuche%(cuknr%)
 IF adr% <> 0 THEN 
   cuivt% = lfdnr.KVERTRAG
   SELECT KEY cuivt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   CodeKU.KVERTRAG = adr%
   CALL QuickStore("KVERTRAG")
   SET INDEX VS_NR.KVERTRAG
   INDEX VS_NR.KVERTRAG
   CALL VIUpdate()
 END IF 
 FORM 
 MOUSE ON 
 END SUB 
 
 
 
 
  
  
 
 
 ' FremdvertrÑge
 ' =======================================================================
 
SUB FRVERTR()
 IF disabled%("FRVERTR") THEN END SUB 
 IF MNdisabled%("DATALOCK") THEN 
   CALL Fehler("Der Zugriff auf diese Funktion ist gesperrt!","Bitte rufen Sie die Vertragsverwaltung Åber die Adre·verwaltung auf.")
   END SUB 
 END IF 
 MOUSE OFF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vorgang" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SET STATUS "Suche FremdvertrÑge..."
 FILE "kvertrag"
 REM -- FremdvertrÑge vorhanden
 IF NOT EXISTS ("j",Fremdvertrag.KVERTRAG) THEN 
   REQUEST "Keine FremdvertrÑge gefunden!","",0
   _formend% = 1
 ELSE 
   SET STATUS "Positionierung auf ersten Fremdvertrag..."
   SELECT WHERE Fremdvertrag.kvertrag = "j"
   INDEX Fremdvertrag.KVERTRAG
   SELECT FORM FIRST 
   _formend% = 0
 END IF 
 SET STATUS "Bereit"
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "IVERTRAG" THEN 
     REM OPEN FORM "IVERTRAG"
     IF EXISTS (GPrjForm$ + "IVERTRAG.sbv") THEN 
       OPEN FORM GPrjForm$ + "IVERTRAG"
     ELSE 
       OPEN FORM GPrjForm$ + "IVERTRAG"
     END IF 
     SET FORM OFF overv$
     CALL MNFRVERTR()
     FORM 
     SET STATUS "FremdvertrÑge"
   END IF 
 
   CALL VIUpdate()
   CALL ClearKBDBuffer()
   MOUSE ON 
   WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
 WEND 
 _formend% = 0
 SELECT WHERE FILE "kvertrag"
 SET STATUS "Bereit"
 MOUSE ON 
 END SUB 
 
 
 '      **************************************
 '      ** Routinen fÅr Formular "ADRESSEN" **  
 '      **************************************
 
SUB ADRsub3()
 REM 160996
 GCodeVStatus% = 0
 CALL KVERTRAGGR()
 END SUB 
 
 
 ' VertragsÅbersicht fÅr aktuellen Kunden drucken Andi 21.9.95
 ' =======================================================================
 
SUB VLIST1()
 cuku% = CodeKU.GAdrDat$
 _Index$ = INDEX 
 SELECT KEY CodeKU.GAdrDat$ FILE "KVERTRAG" INDEX CodeKU.KVERTRAG
 IF FOUND ("KVERTRAG") THEN 
   REM REQUEST "VertrÑge mit Vertragsnotiz ausgeben?","",130,req%
   req% = 0
   IF req% = 1 THEN 
   ELSE 
     CALL VertrUniRep(cuku%,0,0,0,4,0,0,0,1, - 1,tarif%)
   END IF 
 ELSE 
   CALL Fehler("Es wurden noch keine VertrÑge fÅr den aktuellen Kunden erfa·t!","")
 END IF 
 FILE GAdrDat$
 SELECT FIRST FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 SELECT KEY cuku% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 SET INDEX nachname.GAdrDat$
 INDEX nachname.GAdrDat$
 END SUB 
 
 
 
 ' ProvisionsÅbersicht fÅr aktuellen Kunden
 ' =======================================================================
 
SUB VLIST3(eu%)
 cfile$ = FILE 
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 REM SET MENU OFF 
 ku% = CodeKU.GAdrDat$
 abname$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 REM SELECT KEY ma% FILE "maadr" INDEX codema.maadr
 FILE "buchung"
 
 von$ = cdat$
 bis$ = cdat$
 allProv$ = "j"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 MOUSE ON 
 IF req% = 1 THEN 
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
   IF RepType% = 0 THEN 
     IF eu% = 0 THEN 
       CALL PRep("LISTPROK")
       REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
 
       HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
       END HEADING 
 
       GROUP CodeMA.BUCHUNG,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.BUCHUNG
       SET REPORT PAGE "H_CodeMA.BUC002"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       AFTER GROUP CodeMA.BUCHUNG
       SET REPORT PAGE "F_CodeMA.BUC002"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       GROUP Datum.BUCHUNG
       BEFORE GROUP Datum.BUCHUNG
       SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
       Header$ = "ProvisionsÅbersicht Kunden: " + abname$ + " in " + Waehrung.stamm
     ELSE 
       CALL PRep("LISTPRKE")
       REM REPORT USING "LISTPRKE"
       REPORT ON BetragEU.BUCHUNG AS "SSumAgentur%",SREU.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
 
       HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
       END HEADING 
 
       GROUP CodeMA.BUCHUNG,BetragEU.BUCHUNG AS "SumAgentur%",SREU.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.BUCHUNG
       SET REPORT PAGE "H_CodeMA.BUC002"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       AFTER GROUP CodeMA.BUCHUNG
       SET REPORT PAGE "F_CodeMA.BUC002"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       GROUP Datum.BUCHUNG
       BEFORE GROUP Datum.BUCHUNG
       SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
       Header$ = "ProvisionsÅbersicht Kunden: " + abname$ + " (in Euro)"
     END IF 
     GOTO vlist39811181
 
     REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     REM 270497
     REM Header$ = "KontoÅbersicht " + nachname.maadr
     Header$ = "ProvisionsÅbersicht " + nachname.GAdrDat$ + " in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"dd.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.BUCHUNG,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     REM GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     REM BEFORE GROUP CodeMA.MAADR
     BEFORE GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     REM AFTER GROUP CodeMA.MAADR
     AFTER GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
 
vlist39811181: 
   ELSE 
     CALL PRep("LISTPRO2")
     REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrVLIST3
   IF allProv$ = "j" THEN 
    SELECT ;
     WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND CodeKU.BUCHUNG = ku% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$)
     ORDER REPORT Datum.BUCHUNG
     TO ASK 
   ELSE 
    REM 220697
    SELECT ;
     WHERE CodeKU.BUCHUNG = ku% AND CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$) AND mahnung.buchung <> "j" AND (betrag.buchung <> 0 OR sr.buchung <> 0)
     ORDER REPORT nachname.maadr,Datum.BUCHUNG
     TO ASK 
  END IF 
ErrVLIST3: 
   ON ERROR GOTO ErrorHandler
 END IF 
 MOUSE ON 
 FILE cfile$
 DIRECTORY dir1$
 END SUB 
 
 ' öbersicht fÅr aktuellen Kunden fÅr einen Vertrag 
 REM 220697
SUB VLIST3a(lfdnr%,eu%)
 cfile$ = FILE 
 dir1$ = DIRECTORY 
 DIRECTORY _ppath$
 IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 REM SET MENU OFF 
 ku% = CodeKU.GAdrDat$
 ablfdnr% = lfdnr%
 abname$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 REM SELECT KEY ma% FILE "maadr" INDEX codema.maadr
 FILE "buchung"
 
 von$ = cdat$
 bis$ = cdat$
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 MOUSE ON 
 IF req% = 1 THEN 
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
   IF RepType% = 0 THEN 
    IF eu% = 0 THEN 
     CALL PRep("LISTPROK")
     REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP CodeMA.BUCHUNG,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "H_CodeMA.BUC002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "F_CodeMA.BUC002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
     Header$ = "ProvisionsÅbersicht fÅr nachfolgenden Vertrag in " + waehrung.kvertrag
   ELSE 
     CALL PRep("LISTPRKE")
     REPORT ON BetragEU.BUCHUNG AS "SSumAgentur%",SREU.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP CodeMA.BUCHUNG,BetragEU.BUCHUNG AS "SumAgentur%",SREU.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "H_CodeMA.BUC002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "F_CodeMA.BUC002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
     Header$ = "ProvisionsÅbersicht fÅr nachfolgenden Vertrag (in Euro)"
   END IF 
 GOTO vlist3970427
 
 
 
 
 
 
 
 
     REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     REM 270497
     REM Header$ = "KontoÅbersicht " + nachname.maadr
     Header$ = "ProvisionsÅbersicht " + nachname.GAdrDat$ + " in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.BUCHUNG,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     REM GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     REM BEFORE GROUP CodeMA.MAADR
     BEFORE GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     REM AFTER GROUP CodeMA.MAADR
     AFTER GROUP CodeMA.BUCHUNG
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
 
vlist3970427:   
   ELSE 
     CALL PRep("LISTPRO2")
     REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   END IF 
 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrVLIST3
   IF allProv$ = "j" THEN 
    SELECT ;
     WHERE CodeVT.BUCHUNG = ablfdnr% AND CodeMA.BUCHUNG = CodeMA.MAADR AND CodeKU.BUCHUNG = ku% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$)
     ORDER REPORT Datum.BUCHUNG
     TO ASK 
   ELSE 
    REM 130597
    SELECT ;
     WHERE CodeVT.BUCHUNG = ablfdnr% AND CodeMA.BUCHUNG = CodeMA.MAADR AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$) AND mahnung.buchung <> "j" AND (betrag.buchung <> 0 OR sr.buchung <> 0)
     ORDER REPORT nachname.maadr,Datum.BUCHUNG
     TO ASK 
  END IF 
ErrVLIST3: 
   ON ERROR GOTO ErrorHandler
 END IF 
 MOUSE ON 
 FILE cfile$
 DIRECTORY dir1$
 END SUB 
  
 
 
 
 ' ProvisionsÅbersicht fÅr aktuellen Vertrag
 ' =======================================================================
SUB VLIST4()
 CALL DruckVertr(knr%,1)
 END SUB 
 
SUB VLIST4old()
 cfile$ = FILE 
 IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 REM SET MENU OFF 
 cv% = lfdnr.KVERTRAG
 FILE "buchung"
 
 von$ = cdat$
 bis$ = cdat$
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 MOUSE ON 
 IF req% = 1 THEN 
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
   IF RepType% = 0 THEN 
     CALL PRep("LISTPROV")
     REPORT ON Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   ELSE 
     CALL PRep("LISTPRO2")
     REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.BUCHUNG
     BEFORE GROUP Datum.BUCHUNG
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrVLIST4 
   IF allProv$ = "j" THEN 
     SELECT ;
     WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND CodeVT.BUCHUNG = cv% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$)
     ORDER REPORT Datum.BUCHUNG
     TO ASK 
   ELSE 
     SELECT ;
     WHERE CodeMA.BUCHUNG = CodeMA.MAADR AND CodeVT.BUCHUNG = cv% AND Datum.BUCHUNG >= DAYS (vondat$) AND Datum.BUCHUNG <= DAYS (bisdat$) AND mahnung.buchung <> "j"
     ORDER REPORT Datum.BUCHUNG
     TO ASK 
   END IF 
ErrVLIST4: 
   ON ERROR GOTO ErrorHandler
 END IF 
 MOUSE ON 
 FILE cfile$
 END SUB 
 
 
SUB FiltIntro()
  
   DIM Waehrung$(25,2)
   REDIM Waehrung$(25)
   
   a% = 0
   Waehrung$(0) = "Filter deaktivieren"
   Waehrung$(1) = "lebend" + SPACE$ (90) + "01"
   Waehrung$(2) = "leben/kurzfristig/unterjÑhrig" + SPACE$ (90) + "02"
   Waehrung$(3) = "ruhend/Anwartschaft" + SPACE$ (90) + "03"
   Waehrung$(4) = "storniert" + SPACE$ (90) + "04"
   Waehrung$(5) = "ruhend/beitragsfrei" + SPACE$ (90) + "05"
   Waehrung$(6) = "beitragsfrei" + SPACE$ (90) + "06"
   Waehrung$(7) = "beitragsfrei durch Leistung" + SPACE$ (90) + "07"
   Waehrung$(8) = "Beitragsstundung" + SPACE$ (90) + "08"
   Waehrung$(9) = "Sonstiges" + SPACE$ (90) + "09"
   Waehrung$(10) = "Altvertrag" + SPACE$ (90) + "10"
   Waehrung$(11) = "Fremdvertrag" + SPACE$ (90) + "11"
   Waehrung$(12) = "Antrag" + SPACE$ (90) + "12"
   Waehrung$(13) = "storniert durch Dynamisierung" + SPACE$ (90) + "13"
   Waehrung$(14) = "Bestandteil eines BÅndelungsvertrages" + SPACE$ (90) + "14"
   Waehrung$(15) = "Antragswiderruf" + SPACE$ (90) + "15"
   Waehrung$(16) = "Policenwiderspruch" + SPACE$ (90) + "16"
   Waehrung$(17) = "Antragsablehnung" + SPACE$ (90) + "20"
   Waehrung$(18) = "KÅnd.wg.Nichtzahlung" + SPACE$ (90) + "21"
   REM Antragswiderruf
   REM Policenwiderspruch
      IF MNdisabled%("VERTRINHAUSSEE") THEN 
        bef$ = "Select where Codeku.kvertrag = knr% and inhaus.kvertrag<>1"
      ELSE 
        bef$ = "Select where Codeku.kvertrag = knr%"
      END IF 
      IF GCodeVStatus% > 0 THEN 
        bef$ = bef$ + " AND CodeVstatus.kvertrag = GCodeVStatus%"
      END IF 
      IF GCodeVA% > 0 THEN 
        bef$ = bef$ + " AND CodeVA.kvertrag = GCodeVA%"
      END IF 
      IF GCodeGE% > 0 THEN 
        bef$ = bef$ + " AND CodeGE.kvertrag = GCodeGE%"
      END IF 
      IF GCodeVStatus% > 0 OR GCodeVA% > 0 OR GCodeGE% > 0 THEN 
        EXECUTE bef$
      END IF 
      SELECT FORM KEY knr% FILE "kvertrag" INDEX codeku.kvertrag
      REM SELECT KEY knr% FILE "kvertrag" INDEX codeku.kvertrag
      FORM 
      IF GCodeVStatus% > 0 THEN 
        vstatusu$ = "Filter: " + TRIM$ ( LEFT$ (Waehrung$(GCodeVStatus%),40))
      ELSE 
        vstatusu$ = "Vertragsstatus-Filter"
      END IF 
      IF GCodeVA% > 0 THEN 
        SELECT KEY gcodeva% FILE "Sparten" INDEX codeva.sparten
        sparfi$ = "Sparte: " + LEFT$ (sparte.sparten)
      ELSE 
        sparfi$ = "Sparten-Filter "
      END IF 
      IF GCodeGE% > 0 THEN 
        SELECT KEY gcodege% FILE "geadr" INDEX codege.geadr
        gesfi$ = "Ges.:" + gesellschaft.geadr
      ELSE 
        gesfi$ = "Gesellschafts-Filter"
      END IF 
      FORM 
 
 END SUB 
 REM gesfi$ = "Gesellschafts-Filter"
 REM sparfi$ = "Sparten-Filter "
 REM gesfi$ = "Gesellschafts-Filter"
 
 



 REM 130597
SUB ReorgDB1()
 IF NOT disabled%("REORGANISATION") THEN 
   CALL ReorgDB()
 END IF 
  
 REM 150697 REQUEST "Wollen Sie die KonditionsÅbergaben der VertrÑge neu erstellen lassen?","Danach mu· ein Buchungskorrekturlauf gefahren werden!",130,req%
 req% = 0
 IF req% = 1 THEN 
   CALL DFile(3,"vkond" + _fpw$)
   REMOVE FROM FILE "Vkond"
   CALL VKONDAkt()
   CALL Fehler("Sie sollten das Fehlerprotokoll grÅndlich auswerten, die Fehler beheben und anschlie·end Åber den Button Buchung eine Korrekturbuchung vornehmen,","um den gesamten Vertragsbestand neu berechnen zu lassen!")
 END IF 
 END SUB 
 
SUB ADRCOPY()
 cfile$ = FILE 
 FILE GAdrDat$
 COPY FROM Anrede,Vorname,Nachname,Stra·e,PLZ,Ort
 FILE cfile$
 END SUB 
 
  
 ' ADRESSEN
 ' =======================================================================
 
SUB MNADRESSEN()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"&Drucken..."
 IF GASP% <> - 1 OR workstation% = 0 THEN 
   MENU 1,1;1,1,"allg. Kundendaten","ADRDrucken","Druckausgabe"
 END IF 
 IF GASP% <> - 1 THEN 
   MENU 1,1;2,1,"VertragsÅbersicht","VLIST1","VertrÑge eines Kunden ausdrucken"
   MENU 1,1;3,1,"ProvisionsÅbersicht","VLIST3abku","Provisionen aus VertrÑgen des aktuellen Kunden"
 END IF 
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","ADRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
   MENU 2,3,0,"&Duplizieren,Ctrl+D","ADRKopieren",""
   MENU 2,4,1,"&Kopieren in Zwischenablage,F11","ADRKopWin","Adresse in Zwischenablage kopieren"
   MENU 2,5,0,"&Lîschen"
   
 ELSE 
   MENU 2,1,1,"&Neu,F2","ADRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","MStore",""
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
   MENU 2,3,1,"&Duplizieren,Ctrl+D","ADRKopieren",""
   MENU 2,4,1,"&Kopieren in Zwischenablage,F11","ADRKopWin","Adresse in Zwischenablage kopieren"
   IF GASP% THEN 
     IF NOT MNdisabled%("ADRLoeschen") THEN 
       IF Workstation% = 0 THEN 
         MENU 2,5,1,"&Lîschen","ADRLoesch1",""
       ELSE 
         MENU 2,5,0,"&Lîschen"
       END IF 
     ELSE 
       MENU 2,5,0,"&Lîschen"
     END IF 
   ELSE 
     IF NOT MNdisabled%("ADRLoeschen") THEN 
       MENU 2,5,1,"&Lîschen","ADRLoesch1",""
     ELSE 
       MENU 2,5,0,"&Lîschen"
     END IF 
   END IF 
   
 END IF 
 MENU 2,6,1,"Adressen - S&uchen,F3","ADRSuchen",""
 MENU 2,7,1,"Sperren","ADRSperre","aktuelle Adresse fÅr den Zugriff durch andere Mitarbeiter Sperren"
 IF GASP% THEN 
   IF Workstation% = 0 THEN 
     IF MNdisabled%("ADRDOKTERMMOVE") THEN 
       MENU 2,8,0,"Alle Dokumente und Termine einer anderen Adresse zuweisen","ADRUmweis","Alle Dokumente und Termine einer anderen Adresse zuweisen"
     ELSE 
       MENU 2,8,1,"Alle Dokumente und Termine einer anderen Adresse zuweisen","ADRUmweis","Alle Dokumente und Termine einer anderen Adresse zuweisen"
     END IF 
   ELSE 
     MENU 2,8,0,"Alle Dokumente und Termine einer anderen Adresse zuweisen","ADRUmweis","Alle Dokumente und Termine einer anderen Adresse zuweisen"
   END IF 
 ELSE 
   IF MNdisabled%("ADRDOKTERMMOVE") THEN 
     MENU 2,8,0,"Alle Dokumente und Termine einer anderen Adresse zuweisen","ADRUmweis","Alle Dokumente und Termine einer anderen Adresse zuweisen"
   ELSE 
     MENU 2,8,1,"Alle Dokumente und Termine einer anderen Adresse zuweisen","ADRUmweis","Alle Dokumente und Termine einer anderen Adresse zuweisen"
   END IF 
 END IF 
 
 MENU 2,9,1,"einzelne Adresse in Terminen aktualisieren","ADRAkquiAkt","Adresse in Terminen aktualisieren"
 MENU 2,10,1,"alle Adressen in Terminen aktualisieren","ADRAkquiAktG","Adressen in Terminen aktualisieren"
 IF GADRDat$ LIKE "ADRESSEN" THEN 
   MENU 2,11,1,"VertrÑge - Suchen,F5","ADRVertrSu","VertrÑge Suchen "
 ELSE 
   MENU 2,11,0,"VertrÑge - Suchen,F5","ADRVertrSu","VertrÑge Suchen "
 END IF 
 IF MNdisabled%("ADRREN2000") THEN 
   MENU 2,12,0,"Export akt.Adresse+VertrÑge nach Rendite2000","ADRExpR2000","Export nach Rendite2000"
 ELSE 
   MENU 2,12,1,"Export akt.Adresse+VertrÑge nach Rendite2000","ADRExpR2000","Export nach Rendite2000"
 END IF 
 IF MNdisabled%("ADRKMUONL") THEN 
   MENU 2,13,0,"Export akt.Adresse fÅr KMU-EU-Beratungsprotokoll","ADRExpONL","Export akt.Adresse fÅr ONLINE-Beratungsprotokoll"
 ELSE 
   MENU 2,13,1,"Export akt.Adresse fÅr KMU-EU-Beratungsprotokoll","ADRExpONL","Export akt.Adresse fÅr ONLINE-Beratungsprotokoll"
 END IF 

 IF MNdisabled%("ADRCALCU") THEN 
   MENU 2,14,0,"Export akt.Adresse fÅr CalcuVita","ADRExpCalcuV","Export akt.Adresse fÅr ONLINE-Beratungsprotokoll"
 ELSE 
   MENU 2,14,1,"Export akt.Adresse fÅr CalcuVita","ADRExpCalcuV","Export akt.Adresse fÅr ONLINE-Beratungsprotokoll"
 END IF 

 IF workstation% > 0 OR MNdisabled%("MAADR") OR MNdisabled%("MAADRNEU") OR MNdisabled%("MAADRBEARB") THEN 
   MENU 2,15,0,"Adresse als Vermittler eintragen","ADRTOMAADR",""
 ELSE 
   MENU 2,15,1,"Adresse als Vermittler eintragen","ADRTOMAADR",""
 END IF 

 MENU 3,0,1,"&Optionen","",""
 MENU 3,1,1,"&Termine","AKQUISE2",""
 MENU 3,2,1,"Telefon/&Fax","ADRTelefon1",""
 MENU 3,3,1,"Fil&ter...","",""
 MENU 3,3;1,1,"normal","ADRFilter1",""
 MENU 3,3;2,1,"erweitert","ADRFilter2",""
 
 IF GASP% THEN 
   IF Workstation% = 0 THEN 
     IF MNdisabled%("ADREXPORT") THEN 
       MENU 3,4,0,"Adressen &exportieren","ADRExport","Adressen nach dBase exportieren"
     ELSE 
       MENU 3,4,1,"Adressen &exportieren","ADRExport","Adressen nach dBase exportieren"
     END IF 
     MENU 3,5,1,"Adressen aus IMPOADR.DBF &importieren","ADRImport","Adressen aus dBase-Datei importieren"
   ELSE 
     MENU 3,4,0,"Adressen &exportieren","ADRExport","Adressen nach dBase exportieren"
     MENU 3,5,0,"Adressen aus IMPOADR.DBF &importieren","ADRImport","Adressen aus dBase-Datei importieren"
   END IF 
 ELSE 
   IF MNdisabled%("ADREXPORT") THEN 
     MENU 3,4,0,"Adressen &exportieren","ADRExport","Adressen nach dBase exportieren"
   ELSE 
     MENU 3,4,1,"Adressen &exportieren","ADRExport","Adressen nach dBase exportieren"
   END IF 
   IF MNdisabled%("ADRIMPORT") THEN 
     MENU 3,5,0,"Adressen aus IMPOADR.DBF &importieren","ADRImport","Adressen aus dBase-Datei importieren"
   ELSE 
     MENU 3,5,1,"Adressen aus IMPOADR.DBF &importieren","ADRImport","Adressen aus dBase-Datei importieren"
   END IF 
 END IF 
 MENU 3,6,1,"aus Suchliste &wÑhlen,F7","ADRKurzSuche","Auflistung aller vorher gesuchten Adressen"
 REM CALL MNDOK(4)
 CALL MNHilfe(4)
 END SUB 
 

  

 REM Synchronisation der Adressdatei mit der Vermittlerdatei, um die Vermittlernamen in Adressen zu aktualisieren
SUB ADRVerSync()
 IF disabled%("ADRSYNCVM") THEN END SUB 
 CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKQUISE" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKTIONEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 CALL DFile(2,"OFFICE\adrgrup" + _fpw$)
  codema% = codema.maadr
  CALL Fehler("Synchronisation der Adressdatei mit der Vermittlerdatei, um die Vermittlernamen in den Adressen zu aktualisieren!","Hierzu mÅssen Sie sich alleine im Programm befinden, da von den énderungen alle Adressen betroffen sind!")
  REQUEST "Soll die Synchronisation durchgefÅhrt werden?","",135,req%
  IF req% <> 1 THEN END SUB 
  REQUEST "Befinden Sie sich allein im Programm?","",135,req%
  IF req% = 1 THEN 
    MOUSE OFF 
    i% = 0
    j% = RECCOUNT (GADRDat$)
    MOUSE OFF 
    FILE "maadr"
    INDEX codema.maadr
    FILE GADRDat$
    INDEX codeku.GADRDat$
    SELECT FIRST LOCK 
    WHILE NOT EOF (gadrdat$)
      i% = i% + 1
      codema% = codema.gadrdat$
      codema2% = codema2.GADRDat$
      IF codema% > 0 THEN 
        SELECT FIRST FILE "maadr" INDEX codema.maadr
        SELECT KEY codema% FILE "maadr" INDEX codema.maadr
        AGNachname.gadrdat$ = Nachname.maadr
        AGVorname.gadrdat$ = vorname.maadr
        AGAGNr.gadrdat$ = Agenturnr.maadr
      ELSE 
        AGNachname.gadrdat$ = "<ohne Zuordnung>"
        AGVorname.gadrdat$ = ""
        AGAGNr.gadrdat$ = ""
      END IF 
      IF codema2% > 0 THEN 
        SELECT FIRST FILE "maadr" INDEX codema.maadr
        SELECT KEY codema2% FILE "maadr" INDEX codema.maadr
        Agentur2.gadrdat$ = Nachname.maadr + "," + Vorname.maadr
        Agenturnr2.gadrdat$ = Agenturnr.maadr
      ELSE 
        Agentur2.gadrdat$ = "<ohne Zuordnung>"
        Agenturnr2.gadrdat$ = ""
      END IF 
      STORE FILE gadrdat$
      MOUSE OFF 
      SET STATUS STR$ (i%,",9999999") + " synchronisiert / von " + STR$ (j%,",9999999")
      SELECT NEXT LOCK FILE gadrdat$ INDEX codeku.gadrdat$
    WEND 
    CALL Fehler("Synchronisation der Adressdatei mit der Vermittlerdatei abgeschlossen","")
  END IF 
  SELECT FIRST FILE "maadr" INDEX codema.maadr
  SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 END SUB 

 
SUB ADRUmweis()
 IF disabled%("ADRDOKTERMMOVE") THEN END SUB 
 REQUEST "Wollen Sie die Dokumente und Termine wirklich ","einer anderen Adresse zuweisen?",130,req%
 IF req% = 0 THEN GOTO endumw990310
 SET STATUS "Adresse suchen"
 codear% = codeku.GAdrDat$
 nachname$ = LEFT$ ( TRIM$ (nachname.GAdrDat$) + "," + TRIM$ (vorname.GadrDat$),100)
 FILE GAdrDat$
 
 adr% = ADRSuche%(0)
 IF adr% <> 0 AND adr% <> codear% THEN 
   IF EXISTS (codear%,codeku.GAkquiDat$) THEN 
     FILE GAkquiDat$
     INDEX codeku.GAkquiDat$
     SELECT FIRST 
     SELECT KEY codear% LOCK FILE GAkquiDat$ INDEX codeku.GAkquiDat$
     WHILE NOT EOF (GAkquiDat$) AND codeku.GAkquiDat$ = codear%
       codeku.GAkquiDat$ = adr%
       nachname.GAkquiDat$ = nachname$
       SET STATUS "Umweisung Termin " + DATE$ (termin.GAkquiDat$,"0d.mm.yyyy")
       CALL QuickStore(GAkquiDat$)
       SELECT FIRST 
       SELECT KEY codear% LOCK FILE GAkquiDat$ INDEX codeku.GAkquiDat$
     WEND 
   END IF 
   SET STATUS ""
   IF EXISTS (codear%,codeku.GDokDat$) THEN 
     FILE GDokDat$
     INDEX codeku.GDokDat$
     SELECT FIRST 
     SELECT KEY codear% LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WHILE NOT EOF (GDokDat$) AND codeku.GDokDat$ = codear%
       codeku.GDokDat$ = adr%
       SET STATUS "Umweisung Dokument " + dokument.GDokDat$
       CALL QuickStore(GDokDat$)
       SELECT FIRST 
       SELECT KEY codear% LOCK FILE GDokDat$ INDEX codeku.GDokDat$
     WEND 
 
   END IF 
   SET STATUS ""
   CALL Fehler("Umweisung der Termine und Dokumente beendet!","")
 END IF 
 FILE GAdrDat$
 SELECT FORM KEY adr% FILE GAdrDat$ INDEX codeku.GAdrDat$
 FORM 
 CALL ADRFeldnamen()
endumw990310: 
 REM CALL BMCheckMail()
 MOUSE ON 
 END SUB 
 
 
 
 
 REM 261099
SUB VLIST3abku()
     IF eurosupport$ = "TRUE" THEN 
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
       IF DruInEur.stamm = 1 THEN 
         req1% = 1
       ELSE 
         CALL Fehler(t1$,t2$)
         REQUEST "öbersicht in EURO drucken?","",130,req1%
       END IF 
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
     END IF 
     CALL VLIST3(eu%)
 END SUB 
 
 
 
 ' Umschaltung der Maskenvarianten
 
SUB ADRM1()
 knr% = CodeKU.GAdrDat$
 CLOSE FORM 
 cdir$ = DIRECTORY 
 DIRECTORY _netpath$ + "PROVIS"
 REM DELETE "ADRESSEN.SBV"
 COPY "ADR1.SBV" TO "ADRESSEN.SBV"
 DIRECTORY cdir$
 END SUB 
 
 
SUB ADRM2()
 knr% = CodeKU.GAdrDat$
 CLOSE FORM 
 cdir$ = DIRECTORY 
 DIRECTORY _netpath$ + "PROVIS"
 REM DELETE "ADRESSEN.SBV"
 COPY "ADR2.SBV" TO "ADRESSEN.SBV"
 DIRECTORY cdir$
 END SUB 
 
 
 ' VERTRéGE
 ' =======================================================================
 ' 31.07.94  - MenÅpunkt Optionen entfernt
 REM 140596
SUB LIST7a()
  CALL LIST7(codeku.kvertrag)
 END SUB 
 
SUB MNVERTR()
 MENU CLEAR 
 CALL MNProgramm()
 IF GASP% AND Workstation% > 0 THEN 
   MENU 1,1,0,"Drucken...","VLIST4"
 ELSE 
   MENU 1,1,1,"Drucken...","VLIST4"
 END IF 
 REM MENU 1,1;1,1,"VertrÑge des aktuellen Kunden","VLIST2"
 REM MENU 1,1;2,1,"VertrÑge ohne Abschlu·","LIST7a"
 REM MENU 1,1;3,1,"ProvisionsÅbersicht akt. Kunde","VLIST3","Provisionen aus VertrÑgen des aktuellen Kunden"
 REM MENU 1,1;4,1,"ProvisionsÅbersicht akt. Vertrag","VLIST4","Provisionen fÅr aktuellen Vertrag"
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","VERTRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Duplizieren,Ctrl+D","VERTRKopieren","Vertrag duplizieren"
   MENU 2,3,0,"&Verwerfen,Ctrl+RckT","UNDO",""
   MENU 2,4,0,"&Lîschen","VERTRLoeschen",""
 ELSE 
   IF GASP% AND Workstation% > 0 THEN 
     MENU 2,1,0,"&Duplizieren,Ctrl+D","VERTRKopieren","Vertrag duplizieren"
     MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
     MENU 2,3,0,"&Lîschen","VERTRLoeschen",""
   ELSE 
     REM MENU 2,1,1,"&Neu,F2","VERTRNeu","einen neuen Datensatz erfassen"
     REM MENU 2,2,1,"S&ichern,F4","MStore",""
     MENU 2,1,1,"&Duplizieren,Ctrl+D","VERTRKopieren","Vertrag duplizieren"
     MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
     MENU 2,3,1,"&Lîschen","VERTRLoeschen",""
   END IF 
 END IF 
 MENU 2,4,1,"S&uchen,F6","VERTRSuchen1()",""
 REM MENU 2,7,1,"Gesellschaft auswÑhlen,Ctrl+G","SGeadr"
 IF GASP% AND Workstation% > 0 THEN 
   MENU 2,5,0,"Agentur auswÑhlen,Ctrl+A","SMaadr"
 ELSE 
   MENU 2,5,1,"zur Agentur,Ctrl+A","SelMaadrM"
   MENU 2,6,1,"zum Produkt,Ctrl+P","SelProdM"
   MENU 2,7,1,"zur Gesellschaft,Ctrl+G","SelGesM"
   IF MNdisabled%("SEEEINGBEI") THEN 
     MENU 2,8,0,"zur Einreichungs-Gesellschaft,Ctrl+E","SelEingGes"
   ELSE 
     MENU 2,8,1,"zur Einreichungs-Gesellschaft,Ctrl+E","SelEingGes"
   END IF 
   MENU 2,9,1,"zur Sparte,Ctrl+S","SelSpaM"
   MENU 2,10,1,"zur TerminÅbersicht,Ctrl+T","SelTerM"
   MENU 2,11,1,"zum Kunden,Ctrl+K","SelADRM"
   MENU 2,12,1,"zum Tarif,Ctrl+T","SelTarif"
 END IF 
 

 REM MENU 2,9,1,"Sparte auswÑhlen,Ctrl+S","SCodeva"
 MENU 3,0,1,"&Optionen"
 MENU 3,1,1,"&Termin erfassen","AQVRegister","zum aktuellen Kunden einen Termin erfassen"
 IF ag$ = "j" OR (GASP% AND Workstation% > 0) THEN 
   MENU 3,2,0,"Vertrags&status","VStat","Informationen zum aktuellen Vertrag"
   MENU 3,3,0,"Vertrag &deaktivieren","VERTRDeak","Vertrag aus Provisionsberechnung herausnehmen"
   MENU 3,4,0,"Vertrag &stornieren","VERTRStorno","Vertrag stornieren"
 ELSE 
   MENU 3,2,1,"Vertrags&status","VStat","Informationen zum aktuellen Vertrag"
   MENU 3,3,1,"Vertrag &deaktivieren","VERTRDeak","Vertrag aus Provisionsberechnung herausnehmen"
   MENU 3,4,1,"Vertrag &stornieren","VERTRStorno","Vertrag stornieren"
   IF GSoll$ = "j" THEN 
     MENU 3,5,1,"Sollstellungskonditionen","ViewSoll",""
   END IF 
 END IF 
 REM MENU 4,0,1,"Do&kumente"
 REM MENU 4,1,1,"an Kunden","VDOKKunde","Dokument fÅr Kunden erstellen"
 REM MENU 4,2,1,"an Gesellschaft","VDOKGesellsch","Dokument fÅr Gesellschaft erstellen"
 REM CALL MNDOK(4)
 CALL MNHilfe(4)
 END SUB 
 
SUB SelTerM()
 cuvt% = lfdnr.KVERTRAG
 kunr% = codeku.kvertrag
 SELECT FIRST FILE "Adressen" INDEX codeku.adressen
 SELECT KEY kunr% FILE "Adressen" INDEX codeku.adressen
 GCodieRuf1% = 0
     REM CALL TerArtSpez()
     GTERArtSpez% = 0
     CALL AQAdrHist(1)

 lfdnr% = cuvt%
 END SUB 


SUB SelADRM()
     cuvt% = lfdnr.KVERTRAG
     knr% = Codeku.kvertrag
     CALL ADRESSEN()
     lfdnr% = cuvt%
     SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
     SELECT KEY lfdnr% FILE "kvertrag" INDEX lfdnr.kvertrag
     
 END SUB 

SUB SelSpaM()
     cuvt% = lfdnr.KVERTRAG
     codevaprobe% = codeva.kvertrag
     CALL CODEVA()
     codevaprobe% = 0
     lfdnr% = cuvt%
 END SUB 


SUB SelGesM()
  cuvt% = lfdnr.KVERTRAG
  cuge% = Codege.kvertrag
  CALL GEADR()
  cuge% = 0
  lfdnr% = cuvt%
 END SUB 

SUB SelEingGes()
  cuvt% = lfdnr.KVERTRAG
  cuge% = CodeEingGE.kvertrag
  CALL GEADR()
  cuge% = 0
  lfdnr% = cuvt%
 END SUB 

SUB SelProdM()
  Gcodevp% = codevp.kvertrag
  CALL VProdukt1()
  Gcodevp% = 0
 END SUB 

SUB SelMaadrM()
  cuvt% = lfdnr.KVERTRAG
  cuma% = Codema.kvertrag
  CALL MAADR()
  cuma% = 0
  lfdnr% = cuvt%
 END SUB 

SUB SelTarif()
  IF codetarif.kvertrag > 0 THEN 
    cuvt% = lfdnr.KVERTRAG
    GCodeTarif% = codetarif.kvertrag
     IF NOT disabled%("TARIFMASKE") THEN 
       CALL Tarife()
     END IF 
  END IF 
  lfdnr% = cuvt%
  GCodeTarif% = 0
 END SUB 


SUB MNVERTRGR()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken...","VGRNeu"
 MENU 2,0,1,"&Daten","",""
     MENU 2,1,1,"zur TerminÅbersicht,Ctrl+T","SelTerM"
 REM MENU 1,1;1,1,"VertrÑge des aktuellen Kunden","VLIST2"
 REM MENU 1,1;2,1,"VertrÑge ohne Abschlu·","LIST7a"
 IF ag$ = "j" THEN 
   REM MENU 1,1;3,0,"ProvisionsÅbersicht akt. Kunde","VLIST3","Provisionen aus VertrÑgen des aktuellen Kunden"
   REM MENU 1,1;4,0,"ProvisionsÅbersicht akt. Vertrag","VLIST4","Provisionen fÅr aktuellen Vertrag"
 ELSE 
   REM MENU 1,1;3,1,"ProvisionsÅbersicht akt. Kunde","VLIST3","Provisionen aus VertrÑgen des aktuellen Kunden"
   REM MENU 1,1;4,1,"ProvisionsÅbersicht akt. Vertrag","VLIST4","Provisionen fÅr aktuellen Vertrag"
 END IF 
 CALL MNHilfe(3)
 END SUB 
  
 
 
 
 ' vertragsbezogene Dokumentenerstellung fÅr Kunden
 ' =======================================================================
 ' 12.09.95 
 
SUB VDOKKunde()
 SET STATUS "Dokumentenverwaltung (Dokumente an Kunden)"
 cuvt% = lfdnr.KVERTRAG
 cuvt1% = lfdnr.KVERTRAG
 IF FORM LIKE "VORG*" THEN 
   Gcuvg% = codevg.vorgang
 END IF 
 CALL VERTRSync()
     REM Dokverw. von VertrÑge
     REM GDokDat$ = "DOKKV"
     SELECT FIRST FILE "MAADR" INDEX codema.maadr
     SELECT KEY codema.kvertrag FILE "MAADR" INDEX codema.maadr
     SELECT FIRST FILE "GEADR" INDEX codege.geadr
     SELECT KEY codege.kvertrag FILE "GEADR" INDEX codege.geadr
     opt% = 1
     DIM dlg AS Dialog
     DIM control AS DialogControl 
     Superbase.Dialogs.Add("Dialogname")
     SET dlg = Superbase.Dialogs.Dialogname
     dlg.Move(0,0,222,83)
     dlg.Caption = "Art der Adresse"
     dlg.FontName = "MS Sans Serif"
     dlg.FontSize = 8
 
     SET control = dlg.Add("DialogFrame1","DialogFrame")
     control.Move(2,8,219,54)
     control.Caption = " WÑhlen Sie eine Option "
 
     SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
     control.Move(6,20,159,10)
     control.Caption = "Adresse der Kunden verwenden"
     control.Bind("opt%")
     control.ValueOn = 1
 
     SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
     control.Move(6,32,214,9)
     control.Caption = "Adresse der Gesellschaft verwenden"
     control.Bind("opt%")
     control.ValueOn = 2
 
     SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
     control.Move(6,44,200,10)
     control.Caption = "Adresse des Vermittler verwenden"
     control.Bind("opt%")
     control.ValueOn = 3
 
 
     SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(59,64,43,16)
     control.Default = 1
     control.Caption = "OK"
     control.ReturnValue = 1
 
     SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(105,64,42,16)
     control.Caption = "Abbruch"
     control.ReturnValue = 0
 
     DIALOG "Dialogname",req%
     REMOVE DIALOG "Dialogname"
     IF req% = 1 THEN 
       IF opt% = 1 THEN 
         GBanMA% = 0:GBanGE% = 0
         Adresse$ = MakeAdr$(CodeKU.GAdrDat$, - 1,0,0)
         COPY FROM Adresse$
         REM CALL DOKUMENT("Dokumente an Kunden",cuvt%)
       END IF 
       IF opt% = 2 THEN 
         GBanMA% = 0:GBanGE% = 1
         Adresse$ = MakeGesAdr$(Codege.geadr,0,0,0)
         COPY FROM Adresse$
         REM CALL DOKUMENT("Dokumente an Gesellschaften",cuvt%)
       END IF 
       IF opt% = 3 THEN 
         GBanMA% = 1:GBanGE% = 0
         Adresse$ = MakeMAAdr$(codema.maadr,mode%,opt1%,opt2%)
         COPY FROM Adresse$
         REM CALL DOKUMENT("allgemeine Schreiben",cuvt%)
       END IF 
       REM COPY FROM Adresse$
     END IF 
 CALL DOKUMENT("Dokumente an Kunden",cuvt%)
 SET STATUS ""
 cuvt% = cuvt1%
 Gcuvg% = 0
 END SUB 
 
 ' vertragsbezogene Dokumentenerstellung fÅr Gesellschaften
 ' =======================================================================
 ' 12.09.95 
 
SUB VDOKGesellsch()
 SET STATUS "Dokumentenverwaltung (Dokumente an Gesellschaften)"
 cuvt% = lfdnr.KVERTRAG
 cuvt1% = lfdnr.KVERTRAG
 GBanGE% = 1
 CALL VERTRSync()
     REM Dokverw. von VertrÑge
     REM GDokDat$ = "DOKKV"
     SELECT FIRST FILE "MAADR" INDEX codema.maadr
     SELECT KEY codema.kvertrag FILE "MAADR" INDEX codema.maadr
     SELECT FIRST FILE "GEADR" INDEX codege.geadr
     SELECT KEY codege.kvertrag FILE "GEADR" INDEX codege.geadr
     opt% = 1
     DIM dlg AS Dialog
     DIM control AS DialogControl 
     Superbase.Dialogs.Add("Dialogname")
     SET dlg = Superbase.Dialogs.Dialogname
     dlg.Move(0,0,222,83)
     dlg.Caption = "Art der Adresse"
     dlg.FontName = "MS Sans Serif"
     dlg.FontSize = 8
 
     SET control = dlg.Add("DialogFrame1","DialogFrame")
     control.Move(2,8,219,54)
     control.Caption = " WÑhlen Sie eine Option "
 
     SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
     control.Move(6,20,159,10)
     control.Caption = "Adresse der Kunden verwenden"
     control.Bind("opt%")
     control.ValueOn = 1
 
     SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
     control.Move(6,32,214,9)
     control.Caption = "Adresse der Gesellschaft verwenden"
     control.Bind("opt%")
     control.ValueOn = 2
 
     SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
     control.Move(6,44,200,10)
     control.Caption = "Adresse des Vermittler verwenden"
     control.Bind("opt%")
     control.ValueOn = 3
 
 
     SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
     control.Move(59,64,43,16)
     control.Default = 1
     control.Caption = "OK"
     control.ReturnValue = 1
 
     SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
     control.Move(105,64,42,16)
     control.Caption = "Abbruch"
     control.ReturnValue = 0
 
     DIALOG "Dialogname",req%
     REMOVE DIALOG "Dialogname"
     IF req% = 1 THEN 
       IF opt% = 1 THEN 
         GBanMA% = 0:GBanGE% = 0
         Adresse$ = MakeAdr$(CodeKU.GAdrDat$, - 1,0,0)
         COPY FROM Adresse$
         REM CALL DOKUMENT("Dokumente an Kunden",cuvt%)
       END IF 
       IF opt% = 2 THEN 
         GBanMA% = 0:GBanGE% = 1
         Adresse$ = MakeGesAdr$(Codege.geadr,0,0,0)
         COPY FROM Adresse$
         REM CALL DOKUMENT("Dokumente an Gesellschaften",cuvt%)
       END IF 
       IF opt% = 3 THEN 
         GBanMA% = 1:GBanGE% = 0
         Adresse$ = MakeMAAdr$(codema.maadr,mode%,opt1%,opt2%)
         COPY FROM Adresse$
         REM CALL DOKUMENT("allgemeine Schreiben",cuvt%)
       END IF 
       REM COPY FROM Adresse$
     END IF 
 CALL DOKUMENT("Dokumente an Gesellschaften",cuvt%)
 SET STATUS ""
 cuvt% = cuvt1%
 END SUB 
  
 ' korrekte Positionierung der verknÅpften Datei zur DatenÅbergabe an
 ' die Dokumentenverwaltung
 ' =======================================================================
 ' 13.09.95 
  
SUB VERTRSync()
 REM SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
 SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 SELECT KEY lfdnr.KVERTRAG FILE "KVFAEL" INDEX CodeVT.KVFAEL
 IF GCodeGE2% > 0 THEN 
   SELECT KEY GCodeGE2% FILE "GEADR2" INDEX codege2.geadr2
 END IF 
 

 IF FORM LIKE "VORGA*" THEN 
   REM SELECT KEY Gcuvg% FILE "VORGANG" INDEX CodeVG.VORGANG
 ELSE 
   SELECT KEY lfdnr.KVERTRAG FILE "VORGANG" INDEX CodeVT.VORGANG
 END IF 
 END SUB 
 
 
 
SUB VStat()
 CALL VStatus(lfdnr.KVERTRAG)
 END SUB 
 
 ' VERTRéGE (Info)
 ' =======================================================================
 
SUB MNVERTRI()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 MENU 1,1;1,1,"VertrÑge des aktuellen Kunden","VLIST2"
 MENU 1,1;2,1,"VertrÑge ohne Abschlu·","LIST7"
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,0,"&Neu,F2","VERTRNeu","einen neuen Datensatz erfassen"
 REM MENU 2,2,0,"S&ichern,F4","MStore",""
 MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
 MENU 2,3,0,"&Lîschen,Del","VERTRLoeschen",""
 MENU 2,4,1,"S&uchen,F6","VISuchen1()",""
 MENU 3,0,1,"&Optionen","",""
 MENU 3,1,0,"&Stapelverarbeitung","VIStapel",""
 MENU 3,2,1,"anderen &Kunden zuweisen","VIKunde",""
 CALL MNHilfe(4)
 END SUB 
 
 
SUB MNFRVERTR()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 MENU 1,1;1,1,"VertrÑge des aktuellen Kunden","VLIST2"
 MENU 1,1;2,1,"VertrÑge ohne Abschlu·","LIST7"
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,0,"&Neu,F2","VERTRNeu","einen neuen Datensatz erfassen"
 REM MENU 2,2,0,"S&ichern,F4","MStore",""
 MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
 MENU 2,3,0,"&Lîschen,Del","VERTRLoeschen",""
 MENU 2,4,0,"S&uchen,F6","FRSuchen()",""
 CALL MNHilfe(3)
 END SUB 
 
  
 
 ' Vertragsnachbearbeitung
 ' =======================================================================
 
SUB MNVORGANG()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 MENU 1,1;1,1,"VorgÑnge des aktuellen Vertrages","VORGDruck","Auflistung aller VorgÑnge zum aktuellen Vertrag"
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","VorgangNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
   MENU 2,3,0,"&Lîschen,Del","VorgangLoeschen",""
 ELSE 
   MENU 2,1,1,"&Neu,F2","VorgangNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","MStore",""
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
   MENU 2,3,1,"&Lîschen,Del","VorgangLoeschen",""
 END IF 
 MENU 2,4,1,"S&uchen,F6","VorgangSuchen",""

 IF PAGE = 1 THEN 
   MENU 3,0,1,"Do&kumente"
   MENU 3,1,1,"an Kunden","VDOKKunde","Dokument fÅr Kunden erstellen"
   MENU 3,2,1,"an Gesellschaft","VDOKGesellsch","Dokument fÅr Gesellschaft erstellen"
   CALL MNHilfe(4)
 ELSE 
   CALL MNHilfe(3)
 END IF 
 END SUB 
 
SUB MNVORGANG1()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 MENU 1,1;1,1,"VorgÑnge zu VertrÑgen des Kunden","VORG1Druck","Auflistung aller VorgÑnge zum aktuellen Kunden"
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","VorgangNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
   MENU 2,3,0,"&Lîschen,Del","VorgangLoeschen",""
 ELSE 
   MENU 2,1,1,"&Neu,F2","VorgangNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","MStore",""
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
   MENU 2,3,1,"&Lîschen,Del","VorgangLoeschen",""
 END IF 
 MENU 2,4,1,"S&uchen,F6","VorgangSuchen",""
 CALL MNHilfe(3)
 END SUB 
  
 ' Mitarbeiteradressen MAADR
 ' =======================================================================
 
SUB MNMADR()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 MENU 1,1;1,1,"VermittlerÅbersicht","MAADRLIST","Ausgabe einer VermittlerÅbersicht"
 MENU 1,1;2,1,"VertragsÅbersicht","LIST6"
 IF disabled1%("KONDITIONVIEW") OR ag$ = "j" THEN 
   MENU 1,1;3,0,"KonditionsÅbersicht (kurz)","KLIST","allgemeine KonditionsÅbersicht"
   MENU 1,1;4,0,"KonditionsÅbersicht (lang)","KLIST2","ausfÅhrliche KonditionsÅbersicht"
 ELSE 
   MENU 1,1;3,1,"KonditionsÅbersicht (kurz)","KLIST","allgemeine KonditionsÅbersicht"
   MENU 1,1;4,1,"KonditionsÅbersicht (lang)","KLIST2","ausfÅhrliche KonditionsÅbersicht"
 END IF 
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","MADRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
 ELSE 
   MENU 2,1,1,"&Neu,F2","MADRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","MStore",""
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 END IF 
 IF MNdisabled%("MAADRLOESCHEN") OR ag$ = "j" THEN 
   MENU 2,3,0,"&Lîschen,Del","MAADRLoeschen",""
 ELSE 
   MENU 2,3,1,"&Lîschen,Del","MAADRLoeschen",""
 END IF 

 MENU 2,4,1,"S&uchen,F6","MADRSuchen",""
 MENU 2,5,1,"Sper&ren","MAADRSperre","Agenturdaten fÅr den Zugriff durch andere Mitarbeiter sperren"
 MENU 2,6,1,"&Kopieren in Zwischenablage,F11","ADRMAKopWin","Adresse in Zwischenablage kopieren"
 REM MENU 2,7,1,"Suchliste,F7","MADRSuList",""
 MENU 2,7,1,"Duplizieren","MADRDupli",""
 MENU 3,0,1,"&Optionen","",""
 IF MNdisabled%("MAADRKONDEINRICHTEN") OR ag$ = "j" OR Workstation% > 0 THEN 
   MENU 3,1,0,"SR neu hochrechnen","SRNeuBerech",""
 ELSE 
   MENU 3,1,1,"SR neu hochrechnen","SRNeuBerech",""
   IF MNdisabled%("MAADRLIST") OR ag$ = "j" THEN 
     MENU 3,2,0,"VermittlerÅbersicht - Export SR und SR Auto nach MS Excel","SRExpExcel",""
   ELSE 
     MENU 3,2,1,"VermittlerÅbersicht - Export SR und SR Auto nach MS Excel","SRExpExcel",""
   END IF 
   IF MNdisabled%("ADRSYNCVM") THEN 
     MENU 3,3,0,"Synchronisation Vermittlernamen in der Adressdatei","ADRVerSync",""
   ELSE 
     MENU 3,3,1,"Synchronisation Vermittlernamen in der Adressdatei","ADRVerSync",""
   END IF 
   MENU 3,4,1,"AusfÅllen Vermittleradresse und Postanschrift2 in NotizV, falls  in LEER!","SyncMA2",""
   IF workstation% = 0 THEN MENU 3,5,1,"Statistik Åber Vermittler und seine Struktur!","StatisStrMA",""
   REM IF workstation% = 0 THEN MENU 3,6,1,"Statistik Åber Vermittler und seine Struktur einzeln!","StatisStrMAEin",""
   REM IF GBVF$ LIKE "TRUE" THEN 
     REM MENU 3,4,1,"fÅr BuchungssÑtze mit SR Zahlung, SR korrigieren","SRKorrBerech",""
   REM END IF 
 END IF 
 CALL MNHilfe(4)
 END SUB 
 
 REM Export der SR, SR auto und Einheiten nachnExcel
SUB SRExpExcel()
 CALL Fehler("Es werden nachfolgend eine MS Exceldatei fÅr alle Vermittler nach " + _netpath$ + "SRMAADR.XLS exportiert, die die Einheiten, SR und SR Auto enthÑlt","")
 REQUEST "Soll die Datei erzeugt werden?","",135,req%
 IF req% <> 1 THEN GOTO end020920052
 dir$ = DIRECTORY 
 DIRECTORY _netpath$
 IF EXISTS (_netpath$ + "SRMAADR.XLS") THEN DELETE _netpath$ + "SRMAADR.XLS"
 MOUSE OFF 
                                         
 OPEN FIELDS CodeMA,Agenturnr,Anrede,Nachname,Stra·e,PLZ,Ort,Geburtstag,Telefon1,Telefax,Einheiten,EigEinheiten,StornoreserveEU,SRAutoBerech 
 Superbase.Converters.SBF.SourceFormat = "Superbase":REM        ExportFile
 Superbase.Converters.SBF.SourceFile = "MAADR"
 Superbase.Converters.SBF.Descending = 0
 Superbase.Converters.SBF.Merge = 0
 Superbase.Converters.SBF.LogErrors = 0
 Superbase.Converters.SBF.MultiResponse = 0
 Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
 Superbase.Converters.XLS.DestFile = _netpath$ + "SRMAADR.XLS"
 Superbase.Converters.XLS.StartRow = 2
 Superbase.Converters.XLS.StartCol = 1
 Superbase.Converters.XLS.EndRow = - 1
 Superbase.Converters.XLS.EndCol = - 1
 Superbase.Converters.XLS.UseLabels = - 1
 Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
 WAIT FOR 10
 MOUSE ON 
  IF EXISTS (_netpath$ + "SRMAADR.XLS") THEN 
    a% = CALL ("ShellExecute",0,"open",_netpath$ + "SRMAADR.XLS","","",1)
  ELSE 
    CALL Fehler("igendwas ist schiefgegangen","codie anrufen!")
  END IF 
  CLOSE FIELDS 
  DIRECTORY dir$
end020920052: 
 END SUB 
 
 REM geht die Buchungsdatei durch, bei den BuchungssÑtzen, die *SR Zahlung im Text haben und provision<>"j" -A den Wert aus SR
 REM mit der DR des Vermittlers verrechnen,da das bei der Anlage des Buchungssatzes schief gegangen ist + provision = "j"
 REM au·erdem fÅr die BuchungssÑtze, die im Buchungstext NEG haben und provision <> "j" -> provision="j" setzen
SUB SRKorrBerech()
 CALL Fehler("nur fÅr Stefan!!! - bei den BuchungssÑtzen die durch BetÑtigung des SR Buttons in der Buchungsmaske erstellt wurden, die Stornoreserve des Mitarbeiters aktualisieren","")
 REQUEST "SR verrechnen lassen?","",135,req%
 IF req% = 0 THEN GOTO end020920051
 CALL DeleteLogF("BVF-SR.TXT")
 CALL CreateLogF("BVF-SR.TXT")
 dd$ = "buchung1"
 CALL DFile(3,dd$ + _fpw$)
 FILE "maadr"
 INDEX codema.maadr
 FILE "Buchung1"
 INDEX codebu.buchung1
 SELECT FIRST LOCK FILE "buchung1" INDEX codebu.buchung1
 i% = 0
 j% = RECCOUNT (dd$)
 g% = 0
 WHILE NOT EOF ("buchung1")
   i% = i% + 1
   logtxt$ = ""
   IF buchungstext.dd$ LIKE "*SR Zahlung*" AND provision.dd$ <> "j" THEN 
     g% = g% + 1
     codema% = codema.dd$
     sr% = sr.dd$
     provision.dd$ = "j"
     FS24Satz_ID.dd$ = "SRVER"
     STORE FILE dd$
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
     srold% = StornoreserveEU.maadr
     StornoreserveEU.maadr = StornoreserveEU.maadr + sr%
     Stornoreserve.maadr = Stornoreserve.maadr + sr%
     STORE FILE "maadr"
     srtext$ = " alte SR-Summe: " + LTRIM$ ( STR$ (srold%,",999999.00")) + "  zu verrechnende SR " + LTRIM$ ( STR$ (sr%,",999999.00")) + " neue SR-Summe: " + LTRIM$ ( STR$ (StornoreserveEU.maadr,",999999.00"))
     logtxt$ = Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr + "   " + Buchungstext.dd$ + "    " + DATE$ (Datum.dd$,"0d.mm.yyyy") + srtext$
     CALL WriteLogF("BVF-SR.TXT",logtxt$)
   ELSE 
     IF buchungstext.dd$ LIKE "*NEG" AND provision.dd$ <> "j" THEN 
       provision.dd$ = "j"
       FS24Satz_ID.dd$ = "NEG"
       STORE FILE dd$
     END IF 
   END IF 
   SET STATUS STR$ (i%,",999999999") + " bearbeitet / " + STR$ (g%,",999999") + " verrechnet / von " + STR$ (j%,",999999999")
   SELECT NEXT LOCK FILE "buchung1" INDEX codebu.buchung1
 WEND 
 CALL Fehler("Verarbeitung beendet", STR$ (i%,",999999999") + " bearbeitet / " + STR$ (g%,",999999") + " verrechnet / von " + STR$ (j%,",999999999"))
 logtxt$ = "Verarbeitung beendet" + STR$ (i%,",999999999") + " bearbeitet / " + STR$ (g%,",999999") + " verrechnet / von " + STR$ (j%,",999999999")
 CALL WriteLogF("BVF-SR.TXT",logtxt$)
end020920051: 
 CALL CloseLogF("BVF-SR.TXT")
 CALL ShowLogF("BVF-SR.TXT")

 END SUB 


SUB SRNeuBerech()
 CALL Fehler("Sie erhalten hier die Mîglichkeit die SR in das Feld <SR Auto>, fÅr einen <von> - <bis> Zeitraum, fÅr einen oder alle Vermittler - an Hand der Buchungsdatei hochrechnenzu lassen!","Diese Operation kann einige Zeit dauern!")
 REQUEST "Mîchten Sie die SR hochrechnen lassen?","",135,req%
 IF req% = 0 THEN GOTO end230620051
 MOUSE OFF 
 start1% = NOW 
 ma% = - 1
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
   dd$ = "buchung"
 ELSE 
   dd$ = "buchung1"
 END IF 
 CALL DFile(3,dd$ + _fpw$)
 REQUEST "Mîchten Sie die SR fÅr einen einzelnen Vermittler (JA)","oder alle (NEIN) hochrechnen lassen",130,req%
 FILE "maadr"
 INDEX codema.maadr
 IF req% = 1 THEN 
   ma% = GetCodeMA%(_cuma%,0)
   IF ma% < 1 THEN GOTO end230620051
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
   srautoberech.maadr = 0
   STORE FILE "maadr"
 ELSE 
   UPDATE srautoberech.maadr = 0
   END UPDATE 
 END IF 
 FILE dd$
 IF ma% = - 1 THEN 
   INDEX codebu.dd$
   SELECT FIRST 
 ELSE 
   INDEX codema.dd$
   SELECT FIRST 
   SELECT KEY ma% FILE dd$ INDEX codema.dd$
 END IF 
   REQUEST "Mîchten Sie ein Datum zur Begrenzung eingeben?","",130,reqd%
   IF reqd% = 0 THEN 
     Calcdate1$ = "01.01.0001"
     CalcDate1% = DAYS (CalcDate1$)
     CalcdateB$ = "31.12.2999"
     CalcDateB% = DAYS (CalcDateB$)
     GOTO w040420061
   END IF 
g2012200501: 
   CalcDate1$ = DATE$ ( TODAY ,"0d.mm.yyyy")
   CalcDateB$ = DATE$ ( TODAY ,"0d.mm.yyyy")
   CREATE DIALOG "ANSCHLUSS",0,0,191,92,"SR Auto hochrechnen","MS Sans Serif",8
   ADD DIALOG "ANSCHLUSS",4,0,0,191,68,0,""
   ADD DIALOG "ANSCHLUSS",9,9,12,21,23,2
   ADD DIALOG "ANSCHLUSS",5,38,12,144,40,0,"Bitte geben Sie den von-bis Zeitraum ein, fÅr den die <SR Auto> berechnet werden soll."
   ADD DIALOG "ANSCHLUSS",5,18,52,23,10,0,"von:"
   ADD DIALOG "ANSCHLUSS",5,95,52,23,10,0,"bis:"
   ADD DIALOG "ANSCHLUSS",6,38,51,40,11,0,0,CalcDate1$,10
   ADD DIALOG "ANSCHLUSS",6,110,51,40,11,0,0,CalcDateB$,10
   ADD DIALOG "ANSCHLUSS",1,34,72,55,14,1,"&OK",1,1
   DIALOG "ANSCHLUSS",req%
   REMOVE DIALOG "ANSCHLUSS"
 
   IF NOT DateOK%(CalcDate1$) THEN 
     GOTO g2012200501
   ELSE 
     CalcDate1% = DAYS (CalcDate1$)
   END IF 
   IF NOT DateOK%(CalcDateB$) THEN 
     GOTO g2012200501
   ELSE 
     CalcDateB% = DAYS (CalcDateB$)
   END IF 
w040420061: 
 i% = 0
 k% = 0
 j% = RECCOUNT (dd$)
 WHILE NOT EOF (dd$)
   i% = i% + 1
   SET STATUS STR$ (i%,",99999999") + " von " + STR$ (j%,",99999999") + " mit sr<>0 " + STR$ (k%,",99999999") + " Buchungen verarbeitet"
   IF sreu.dd$ <> 0 AND datum.dd$ >= CalcDate1% AND datum.dd$ <= CalcDateB% THEN 
     k% = k% + 1
     codema% = codema.dd$
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY codema% LOCK FILE "maadr" INDEX codema.maadr
     sreu$ = STR$ (sreu.dd$,"9999999.00")
     srautoberech% = srautoberech.maadr
     srautoberech% = srautoberech% + VAL (sreu$)
     srautoberech$ = STR$ (srautoberech%,"9999999.00")
     srautoberech.maadr = VAL (srautoberech$)
     STORE FILE "maadr"
   END IF 
   SELECT NEXT FILE dd$
   IF ma% <> - 1 THEN 
     IF codema.dd$ <> ma% THEN GOTO end291129951
   END IF 
 WEND 
end291129951: 
 end1% = NOW 
 diff1% = end1% - start1%
 dauer$ = TIME$ (diff1%,"hh:mm:ss")
 IF ma% > 0 THEN 
   CALL Fehler("ENDE: SR-Konto Auto fÅr Vermittler " + nachname.maadr + " wurde neu berechnet! Siehe Feld: SR-Konto Auto, Dauer: " + dauer$, STR$ (i%,",99999999") + " von " + STR$ (j%,",99999999") + " mit sr<>0 " + STR$ (k%,",99999999"))
 ELSE 
   CALL Fehler("ENDE: SR-Konto Auto fÅr alle Vermittler wurde neu berechnet! Siehe Feld: SR-Konto Auto, Dauer: " + dauer$, STR$ (i%,",99999999") + " von " + STR$ (j%,",99999999") + " mit sr<>0 " + STR$ (k%,",99999999"))
 END IF 
end230620051: 
 END SUB 


SUB MADRDupli()
 REM Vermittler duplizieren
 MOUSE OFF 
 FILE "MAADR"
 COPY FROM nachname,stra·e,plz,ort,telefon1,telefax,telefon2,btx,geburtstag,k1konto,k1blz,k1bank,anrede,notiz,beruf,agenturnr,workstation,MAGRUPPE,CodemaGR,Postanschrift,Direktion,codeagdir,stufe,FirmaName,Steuernummer,Kontoinhaber,Kostenstelle,email
 BLANK FILE "maadr"
 codema% = SER ("MAADR",1)
 codema.maadr = codema%
 COPY TO nachname,stra·e,plz,ort,telefon1,telefax,telefon2,btx,geburtstag,k1konto,k1blz,k1bank,anrede,notiz,beruf,agenturnr,workstation,MAGRUPPE,CodemaGR,Postanschrift,Direktion,codeagdir,stufe,FirmaName,Steuernummer,Kontoinhaber,Kostenstelle,email
 Agenturnr.maadr = Agenturnr.maadr + " #"
 CALL QuickStore("maadr")
 cuma% = codema%
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 CALL Fehler("Datensatz wurde dupliziert!","")
 END SUB 



 ' GEADR Gesellschaften
 ' =======================================================================
 
SUB MNGEADR()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 IF PrvVerfahr$ LIKE "STANDARD" THEN MENU 1,1;1,1,"Mahnliste","MAHNLIST","öbersicht Åber ausstehende ZahlungseingÑnge"
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","GEADRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
 ELSE 
   MENU 2,1,1,"&Neu,F2","GEADRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","MStore",""
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 END IF 
 IF MNdisabled%("GEADRLOESCHEN") OR ag$ = "j" OR Workstation% > 0 THEN 
   MENU 2,3,0,"&Lîschen,Del","GEADRLoeschen",""
 ELSE 
   MENU 2,3,1,"&Lîschen,Del","GEADRLoeschen",""
 END IF 
 MENU 2,4,1,"S&uchen,F6","GEADRSuchen",""
 MENU 2,5,1,"&Kopieren in Zwischenablage,F11","ADRGesKopWin","Adresse in Zwischenablage kopieren"
 CALL MNHilfe(3)
 END SUB 
 
 
SUB MNBGEADR()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 IF MNdisabled%("GEADRLOESCHEN") OR ag$ = "j" THEN 
   MENU 2,4,0,"&Lîschen,Del","BGEADRLoesch",""
 ELSE 
   MENU 2,4,1,"&Lîschen,Del","BGEADRLoesch",""
 END IF 
 CALL MNHilfe(3)
 END SUB 
 
 ' GEKOND Konditionen
 ' =======================================================================
 
SUB MNGEKOND()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"Drucken..."
 MENU 1,1;1,1,"KonditionsÅbersicht (kurz)","KLIST","allgemeine KonditionsÅbersicht"
 MENU 1,1;2,1,"KonditionsÅbersicht (lang)","KLIST3","ausfÅhrliche KonditionsÅbersicht"
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,1,"&Neu,F2","GEKONDNeu","einen neuen Datensatz erfassen"
 REM MENU 2,2,1,"S&ichern,F4","MStore",""
 MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 IF GASP% THEN 
   IF Workstation% > 0 THEN 
     MENU 2,3,0,"&Lîschen,Del","GEKONDLoeschen","aktuelle Kondition lîschen"
     MENU 2,4,0,"leere Konditionen aller Mitarbeiter lîchen","GEKONDLoeSuch","leere Kondition lîschen"
     MENU 2,5,0,"nicht benutzte Konditionen dieser Gesellschaft lîchen","GekoLoeGE",""
     MENU 2,6,0,"nicht benutzte Konditionen dieses Produktes lîchen","GekoLoeVP",""
   ELSE 
     MENU 2,3,1,"&Lîschen,Del","GEKONDLoeschen","aktuelle Kondition lîschen"
     MENU 2,4,1,"leere Konditionen aller Mitarbeiter lîchen","GEKONDLoeSuch","leere Kondition lîschen"
     MENU 2,5,1,"nicht benutzte Konditionen dieser Gesellschaft lîchen","GekoLoeGE",""
     MENU 2,6,1,"nicht benutzte Konditionen dieses Produktes lîchen","GekoLoeVP",""
   END IF 
 ELSE 
   IF MNdisabled%("GEKONDLOESCHEN") THEN 
     MENU 2,3,0,"&Lîschen,Del","GEKONDLoeschen","aktuelle Kondition lîschen"
     MENU 2,4,0,"leere Konditionen aller Mitarbeiter lîchen","GEKONDLoeSuch","leere Kondition lîschen"
      MENU 2,5,0,"nicht benutzte Konditionen dieser Gesellschaft lîchen","GekoLoeGE",""
     MENU 2,6,0,"nicht benutzte Konditionen dieses Produktes lîchen","GekoLoeVP",""
   ELSE 
     MENU 2,3,1,"&Lîschen,Del","GEKONDLoeschen","aktuelle Kondition lîschen"
     MENU 2,4,1,"leere Konditionen aller Mitarbeiter lîchen","GEKONDLoeSuch","leere Kondition lîschen"
     MENU 2,5,1,"nicht benutzte Konditionen dieser Gesellschaft lîchen","GekoLoeGE",""
     MENU 2,6,1,"nicht benutzte Konditionen dieses Produktes lîchen","GekoLoeVP",""
   END IF 
 END IF 
 MENU 2,7,1,"S&uchen,F6","GEKONDSuchen",""
 MENU 2,8,3
 MENU 2,10,1,"&Gesellschaft auswÑhen,Ctrl+G","MASGeadr"
 MENU 2,11,1,"&Sparte auswÑhlen,Ctrl+S","MASCodeva"
 MENU 3,0,1,"Bewe&gen","",""
 MENU 3,1,1,"&NÑchster,BildAb","GEKONDNext","nÑchster Datensatz"
 MENU 3,2,1,"&Vorheriger,BildAuf","GEKONDPrev",""
 MENU 4,0,1,"&Musteragentur","",""
 MENU 4,1,1,"&Bearbeiten","GEKONDM()",""
 MENU 4,2,1,"&öbernehmen","GEKONDUebern",""
 MENU 5,0,1,"&Anpassung","",""
 REM ANPASSUNG4pf
 IF GASP% THEN 
   IF Workstation% = 0 THEN 
     MENU 5,1,1,"&aktuelle Kondition","ANPASSUNG",""
     MENU 5,2,1,"a&lle Konditionen des Mitarbeiters","ANPASSUNG3",""
     MENU 5,3,1,"alle nicht abgeschlossenen Konditionen des Mitarbeiters","ANPASSUNG3A1",""
     MENU 5,4,1,"Konditionen aller Mitarbeiter fÅr dieses Produkt","ANPASSUNG4",""
     MENU 5,5,1,"alle nicht abgeschlossenen Konditionen aller Mitarbeiter fÅr dieses Produkt","ANPASSUNG4A1",""
     MENU 5,6,1,"alle Konditionen aller Mitarbeiter aller Produkte","ANPASSUNG5",""
     MENU 5,7,1,"alle nicht abgeschlossenen Konditionen aller Mitarbeiter aller Produkte","ANPASSUNG5A1",""
     MENU 5,8,1,"Stornoreserve aktuelle Kondition","ANPASSUNGS",""
     MENU 5,9,1,"alle Stornoreserven aller Konditionen des Mitarbeiters","ANPASSUNG3S",""
     MENU 5,10,1,"alle Stornoreserven aller nicht abgeschlossenen Konditionen des Mitarbeiters","ANPASSUNG3S1",""
     MENU 5,11,1,"Stornoreserve aller Mitarbeiter fÅr dieses Produkt","ANPASSUNG4S",""
     MENU 5,12,1,"Stornores. aller Mitarb. fÅr dieses Produkt aller nicht abgeschl. Konditionen","ANPASSUNG4S1",""
     MENU 5,13,1,"bei allen Konditionen des Mitarbeiters das Feld DM/Einheit auf einen Wert setzen","GekoDMEinh",""
     MENU 5,14,1,"Pflege aller Mitarbeiter fÅr dieses Produkt auf festen Wert setzen","ANPASSUNG4P",""
     MENU 5,15,1,"Pflege dieses Mitarbeiters fÅr alle Produkte auf festen Wert setzen","ANPASSUNG3P",""
     MENU 5,16,1,"Kond.aller Mitarbeiter fÅr dieses Prod.-Pflege aktivieren und aus AP Åbernehmen","ANPASSUNG4pf",""
   END IF 
 ELSE 
     MENU 5,1,1,"&aktuelle Kondition","ANPASSUNG",""
     MENU 5,2,1,"a&lle Konditionen des Mitarbeiters","ANPASSUNG3",""
     MENU 5,3,1,"alle nicht abgeschlossenen Konditionen des Mitarbeiters","ANPASSUNG3A1",""
     MENU 5,4,1,"Konditionen aller Mitarbeiter fÅr dieses Produkt","ANPASSUNG4",""
     MENU 5,5,1,"alle nicht abgeschlossenen Konditionen aller Mitarbeiter fÅr dieses Produkt","ANPASSUNG4A1",""
     MENU 5,6,1,"alle Konditionen aller Mitarbeiter alle Produkte","ANPASSUNG5",""
     MENU 5,7,1,"alle nicht abgeschlossenen Konditionen aller Mitarbeiter aller Produkte","ANPASSUNG5A1",""
     MENU 5,8,1,"Stornoreserve aktuelle Kondition","ANPASSUNGS",""
     MENU 5,9,1,"alle Stornoreserven aller Konditionen des Mitarbeiters","ANPASSUNG3S",""
     MENU 5,10,1,"alle Stornoreserven aller nicht abgeschlossenen Konditionen des Mitarbeiters","ANPASSUNG3S1",""
     MENU 5,11,1,"Stornoreserve aller Mitarbeiter fÅr dieses Produkt","ANPASSUNG4S",""
     MENU 5,12,1,"Stornores. aller Mitarb. fÅr dieses Produkt aller nicht abgeschl. Konditionen","ANPASSUNG4S1",""
     MENU 5,13,1,"bei allen Konditionen des Mitarbeiters das Feld DM/Einheit auf einen Wert setzen","GekoDMEinh",""
     MENU 5,14,1,"Pflege aller Mitarbeiter fÅr dieses Produkt auf festen Wert setzen","ANPASSUNG4P",""
     MENU 5,15,1,"Pflege dieses Mitarbeiters fÅr alle Produkte auf festen Wert setzen","ANPASSUNG3P",""
     MENU 5,16,1,"Kond.aller Mitarbeiter fÅr dieses Prod.-Pflege aktivieren und aus AP Åbernehmen","ANPASSUNG4pf",""
 END IF 
 CALL MNHilfe(6)
 END SUB 
 
 
 ' GEKONDM Musterkonditionen
 ' =======================================================================
 
SUB MNGEKONDM()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,1,"&Neu,F2","GEKONDMNeu","einen neuen Datensatz erfassen"
 REM MENU 2,2,1,"S&ichern,F4","MStore",""
 MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 IF MNdisabled%("GEKONDMLoeschen") OR Workstation% > 0 THEN 
   MENU 2,3,0,"&Lîschen,Del","GEKONDMDel","Musterkondition lîschen"
 ELSE 
   MENU 2,3,1,"&Lîschen,f(","GEKONDMDel","Musterkondition lîschen"
 END IF 
 MENU 2,4,1,"S&uchen,F6","GEKONDMSuchen",""
 MENU 3,0,1,"Bewe&gen","",""
 MENU 3,1,1,"&NÑchster,BildAb","PSelectNext","nÑchster Datensatz"
 MENU 3,2,1,"&Vorheriger,BildAuf","PSelectPrev",""
 CALL MNHilfe(4)
 END SUB 
 
 
 ' SPARTEN
 ' =======================================================================
 
SUB MNCODEVA()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"&Drucken..."
 MENU 1,1;1,1,"VertragsÅbersicht","LIST8","Auflistung der VertrÑge dieser Sparte"
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","CODEVANeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
 ELSE 
   MENU 2,1,1,"&Neu,F2","CODEVANeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","MStore",""
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 END IF 
 IF MNdisabled%("SPARTENLOESCHEN") OR ag$ = "j" OR Workstation% > 0 THEN 
   MENU 2,3,0,"&Lîschen,Del","CODEVALoeschen",""
 ELSE 
   MENU 2,3,1,"&Lîschen,Del","CODEVALoeschen","aktuelle Sparte lîschen"
 END IF 
 MENU 2,4,1,"S&uchen,F6","CODEVASuchen",""
 MENU 3,0,1,"Bewe&gen","",""
 MENU 3,1,1,"&NÑchster,BildAb","PSelectNextVA","nÑchster Datensatz"
 MENU 3,2,1,"&Vorheriger,BildAuf","PSelectPrevVA",""
 MENU 3,3,1,"&Erster","SelectFirst",""
 MENU 3,4,1,"&Letzter","SelectLast",""
 MENU 4,0,1,"&Optionen","",""
 IF MNdisabled%("SPARTENEDIT") OR MNdisabled%("VERTRBEARB") OR MNdisabled%("PRODUKTEDIT") THEN 
   MENU 4,1,0,"Synchronisation Sparten-Spart.gruppen-Produkte-VertrÑge","SyncGrSp",""
 ELSE 
   MENU 4,1,1,"Synchronisation Sparten-Spart.gruppen-Produkte-VertrÑge","SyncGrSp",""
 END IF 
 CALL MNHilfe(5)
 END SUB 
 
SUB MNSPGRUPPE()
  MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,1,"&Drucken..."
 MENU 1,1;1,1,"VertragsÅbersicht","LIST8SPGR","Auflistung der VertrÑge dieser Sparte"
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","SPGRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","MStore",""
   MENU 2,2,0,"&Verwerfen,Ctrl+RckT","UNDO",""
 ELSE 
   MENU 2,1,1,"&Neu,F2","SPGRNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","MStore",""
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 END IF 
 IF MNdisabled%("SPARTENLOESCHEN") OR ag$ = "j" OR Workstation% > 0 THEN 
   MENU 2,3,0,"&Lîschen,Del","SPGRLoeschen",""
 ELSE 
   MENU 2,3,1,"&Lîschen,Del","SPGRLoeschen","aktuelle Spartengruppe lîschen"
 END IF 
 MENU 2,4,1,"S&uchen,F6","SPGRSuchen",""
 MENU 3,0,1,"Bewe&gen","",""
 MENU 3,1,1,"&NÑchster,BildAb","PSelectNext","nÑchster Datensatz"
 MENU 3,2,1,"&Vorheriger,BildAuf","PSelectPrev",""
 MENU 3,3,1,"&Erster","SelectFirst",""
 MENU 3,4,1,"&Letzter","SelectLast",""
 CALL MNHilfe(4)
 
 END SUB 
 ' Zahlungseingang
 ' =======================================================================
 
SUB MNEINGANG()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,0,"&Drucken..."
 MENU 1,1;1,0,"öbersicht ZahlungseingÑnge","ZEINList1","Ausgabe des Zahlungseingangsbericht"
 MENU 2,0,1,"&Daten","",""
 IF ag$ = "j" THEN 
   MENU 2,1,0,"&Neu,F2","ZEINNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,0,"S&ichern,F4","ZEINSichern","Zahlungseingang sichern"
   MENU 2,1,0,"&Verwerfen,Ctrl+RckT","UNDO","letzte énderung verwerfen"
 ELSE 
   MENU 2,1,1,"&Neu,F2","ZEINNeu","einen neuen Datensatz erfassen"
   REM MENU 2,2,1,"S&ichern,F4","ZEINSichern","Zahlungseingang sichern"
   MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO","letzte énderung verwerfen"
 END IF 
 IF MNdisabled%("ZEINLOESCHEN") OR ag$ = "j" OR Workstation% > 0 THEN 
   MENU 2,3,0,"&Lîschen,Del","ZEINLoe1Norm","aktuellen Datensatz lîschen"
   MENU 2,4,0,"&VertragsÅberwachung deaktivieren","ZEDeaktiv","VertragsÅberwachung deaktivieren"
 ELSE 
   MENU 2,3,1,"&Lîschen,Del","ZEINLoe1Norm","aktuellen Datensatz lîschen"
   MENU 2,4,1,"&VertragsÅberwachung deaktivieren,F8","ZEDeaktiv","VertragsÅberwachung deaktivieren"
 END IF 
 MENU 2,5,1,"S&uchen,F6","ZEINSuchen","Zahlungseingang suchen"
 CALL MNHilfe(3)
 END SUB 
 
SUB MNEINGANG1()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 1,1,0,"&Drucken..."
 MENU 1,1;1,0,"öbersicht ZahlungseingÑnge","ZEINList2","Ausgabe des Zahlungseingangsbericht"
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,1,"&Neu,F2","ZEINNeu1","einen neuen Datensatz erfassen"
 REM MENU 2,2,1,"S&ichern,F4","ZEINSich1","Zahlungseingang sichern"
 MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO","letzte énderung verwerfen"
 IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
   IF MNdisabled%("ZEINLOESCHEN") OR Workstation% > 0 THEN 
     MENU 2,3,0,"&Lîschen,Del","ZEINLoesch1","aktuellen Datensatz lîschen"
     MENU 2,4,0,"&VertragsÅberwachung deaktivieren","ZEDeaktiv","VertragsÅberwachung deaktivieren"
   ELSE 
     MENU 2,3,1,"&Lîschen,Del","ZEINLoesch1","aktuellen Datensatz lîschen"
     MENU 2,4,1,"&VertragsÅberwachung deaktivieren,F8","ZEDeaktiv","VertragsÅberwachung deaktivieren"
   END IF 
   MENU 2,5,1,"S&uchen,F6","ZEINSuch1","Zahlungseingang suchen"
   MENU 2,6,1,"ZE-Datum(Erfassungs-/Buchungsdatum) setzen","ZEIN1SET","ZE Datum setzen"
   MENU 2,7,1,"FÑlligkeitsdatum setzen","ZEIN1SETF","ZE Datum setzen"
 ELSE 
   IF MNdisabled%("ZEINLOESCHEN") OR Workstation% > 0 THEN 
     MENU 2,3,0,"&Lîschen,Del","ZEINLoesch1","aktuellen Datensatz lîschen"
   ELSE 
     MENU 2,3,1,"&Lîschen,Del","ZEINLoesch1","aktuellen Datensatz lîschen"
   END IF 
   MENU 2,4,1,"S&uchen,F6","ZEINSuch1","Zahlungseingang suchen"
   MENU 2,5,1,"ZE-Datum(Erfassungs-/Buchungsdatum) setzen","ZEIN1SET","ZE Datum setzen"
   MENU 2,6,1,"FÑlligkeitsdatum setzen","ZEIN1SETF","ZE Datum setzen"
 END IF 
 CALL MNHilfe(3)
 END SUB 
 
SUB ZEIN1SET()
   IF GZEDat% = 0 THEN 
     CalcDate1$ = DATE$ ( TODAY ,"0d.mm.yyyy")
   ELSE 
     CalcDate1$ = DATE$ (GZEDat%,"0d.mm.yyyy")
   END IF 
   CREATE DIALOG "ANSCHLUSS",0,0,191,92,"generelles ZE Datum","MS Sans Serif",8
   ADD DIALOG "ANSCHLUSS",4,0,0,191,68,0,""
   ADD DIALOG "ANSCHLUSS",9,9,12,21,23,2
   ADD DIALOG "ANSCHLUSS",5,38,12,144,20,0,"Bitte geben Sie ein, mit welchem Datum die ZE erfa·t werden sollen:"
   ADD DIALOG "ANSCHLUSS",5,38,42,33,10,0,"Datum:"
   ADD DIALOG "ANSCHLUSS",6,73,41,51,11,0,0,CalcDate1$,10
   ADD DIALOG "ANSCHLUSS",1,64,72,55,14,1,"&OK",1,1
   DIALOG "ANSCHLUSS",req%
   REMOVE DIALOG "ANSCHLUSS"

   IF DateOK%(CalcDate1$) THEN 
     GZEDat% = DAYS (CalcDate1$)
   ELSE 
     GZEDat% = 0
   END IF 
 END SUB 
   
SUB ZEIN1SETF()
   IF GZEDatF% = 0 THEN 
     CalcDate1$ = DATE$ ( TODAY ,"0d.mm.yyyy")
   ELSE 
     CalcDate1$ = DATE$ (GZEDatF%,"0d.mm.yyyy")
   END IF 
   CREATE DIALOG "ANSCHLUSS",0,0,191,92,"generelles FÑlligkeits Datum","MS Sans Serif",8
   ADD DIALOG "ANSCHLUSS",4,0,0,191,68,0,""
   ADD DIALOG "ANSCHLUSS",9,9,12,21,23,2
   ADD DIALOG "ANSCHLUSS",5,38,12,144,30,0,"Bitte geben Sie ein, mit welchem FÑlligkeitsdatum die ZE erfa·t werden sollen:"
   ADD DIALOG "ANSCHLUSS",5,38,42,33,10,0,"Datum:"
   ADD DIALOG "ANSCHLUSS",6,73,41,51,11,0,0,CalcDate1$,10
   ADD DIALOG "ANSCHLUSS",1,64,72,55,14,1,"&OK",1,1
   DIALOG "ANSCHLUSS",req%
   REMOVE DIALOG "ANSCHLUSS"
 
   IF DateOK%(CalcDate1$) THEN 
     GZEDatF% = DAYS (CalcDate1$)
   ELSE 
     GZEDatF% = 0
   END IF 
 END SUB 
 
 ' ZBUCHUNG
 ' =======================================================================
  
SUB MNZBUCHUNG()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,1,"&Neu,F2","BUNeu","einen neuen Datensatz erfassen"
 REM MENU 2,2,1,"S&ichern,F4","BUSichern",""
 MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 IF Workstation% > 0 THEN 
   MENU 2,3,0,"&Lîschen,Del","BULoeschen",""
 ELSE 
   MENU 2,3,1,"&Lîschen,Del","BULoeschen",""
 END IF 
 MENU 2,4,1,"S&uchen,F6","BUSuchen()",""
 CALL MNHilfe(3)
 END SUB 
 
SUB MNZBUCHUNG1()
 MENU CLEAR 
 CALL MNProgramm()
 MENU 2,0,1,"&Daten","",""
 MENU 2,1,1,"&Neu,F2","BUNeu1","einen neuen Datensatz erfassen"
 REM MENU 2,2,1,"S&ichern,F4","BUSichern1",""
 MENU 2,2,1,"&Verwerfen,Ctrl+RckT","UNDO",""
 IF Workstation% > 0 THEN 
   REM MENU 2,3,0,"&Lîschen,Del","BULoesch1",""
 ELSE 
   REM MENU 2,3,1,"&Lîschen,Del","BULoesch1",""
 END IF 
 REM MENU 2,4,1,"S&uchen,F6","BUSuchen1",""
 CALL MNHilfe(3)
 END SUB 
 
 ' Umstellung der Konditionen auf neue Struktur
 ' (Erzeugung VKOND.SBF)
 ' =======================================================================
 ' 01.10.94 
 
SUB VKONDAkt()
 MOUSE OFF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL CreateLog()
 CALL WriteLog("")
 CALL WriteLog("====================================")
 CALL WriteLog("Konditionsumstellung vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
 CALL WriteLog("====================================")
 CALL WriteLog("")
 REMOVE FROM FILE "VKOND"
 FILE "KVERTRAG"
 IF PROGRAMFILE ("UPDATE") THEN up% = 1
 SET STATUS "Bereit"
 INDEX lfdnr.KVERTRAG
 tmax% = RECCOUNT ("KVERTRAG")
 cuvt% = lfdnr.KVERTRAG
 cp% = 0
 lp% = 0
 a% = 0
 IF up% = 1 THEN CALL Server("UPDGAUGE","0")
 CALL Server("LOADMESSAGE","")
 CALL Server("MESSAGE","Bitte warten... Die Konditionsdaten werden in die geÑnderte Struktur Åbernommen. (Dieser Vorgang kann bei grî·eren DatenbestÑnden einige Zeit in Anspruch nehmen.)")
 lc$ = "|"
 SELECT FIRST 
 WHILE NOT EOF ("KVERTRAG")
   cvt% = lfdnr.KVERTRAG
   a% = a% + 1
   cp% = INT (100 / tmax% * a%)
   IF up% = 1 THEN 
     IF lp% <> cp% THEN 
       CALL Server("UPDGAUGE", LTRIM$ ( STR$ (cp%,"999")))
       lp% = cp%
     END IF 
   ELSE 
     IF lc$ = "|" THEN 
       lc$ = "/"
     ELSE 
       IF lc$ = "/" THEN 
         lc$ = "-"
       ELSE 
         IF lc$ = "-" THEN 
           lc$ = "\"
         ELSE 
           IF lc$ = "\" THEN 
             lc$ = "|"
           END IF 
         END IF 
       END IF 
     END IF 
     SET STATUS "Verarbeitung: " + LTRIM$ ( STR$ (cp%,"9999")) + "% " + lc$
   END IF 
   IF ProviAb.KVERTRAG > 0 THEN 
     kond% = GetKond%(lfdnr.KVERTRAG,0, - 1)
     SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     SELECT KEY cvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     CodeKO.KVERTRAG = kond%
     CALL QuickStore("KVERTRAG")
     IF kond% = 0 THEN 
         REM SELECT KEY cvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
         REM abfile$ = FILE 
         REM FILE GAdrDat$
         REM INDEX codeku.GAdrDat$
         REM SELECT codeku.kvertrag FILE GAdrDat$ INDEX codeku.GAdrDat$
         REM CALL WriteLog( STR$ (cvt%,"000000") + " " + LEFT$ (nachname) + " keine Kondition")
         REM CALL AddLogInfo()
         REM FILE abfile$
       REM SET STATUS "Fehlerbehebung..."
       REM IF EXISTS (cvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cvt%
     END IF 
   END IF 
   SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT KEY cvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   SELECT NEXT FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 WEND 
 CALL Server("UNLOADMESSAGE","")
 CALL CloseLog()
 SELECT KEY cuvt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 END SUB 
 
 
 ' Aktualisierung der VKOND mit aktuellen Konditionen
 ' =======================================================================
 
FUNCTION GetKond%(vt%,ProviAb%,logging%)
 cfile$ = FILE 
 SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY vt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF ProviAb% = 0 THEN 
   bwbezug$ = ReadConfig$("PROVIS","Bewertungszeitraum")
     IF bwbezug$ LIKE "leer" OR bwbezug$ LIKE "Provisionierungsbeginn" THEN 
     BWStart% = DAYS (ProviAb.KVERTRAG)
   ELSE 
     BWStart% = DAYS (VS_Beginn.KVERTRAG)
   END IF 
 ELSE 
   BWStart% = ProviAb%
 END IF 
 bwstart$ = DATE$ (bwstart%,"0d.mm.yyyy")
 FILE "GEKOND"
 
 REM ### Andi Anfang
 SELECT WHERE 
 INDEX QuickCode.gekond
 SELECT FIRST 
 REM ### Andi Ende
 codema% = CodeMA.kvertrag
 codege% = CodeGE.kvertrag
 codeva% = CodeVA.kvertrag
 REM ###andi anfang
 FILE "maadr"
 INDEX Codema.maadr
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 nameorig$ = nachname.maadr + " " + Vorname.maadr + " " + Agenturnr.maadr
 ma$ = LTRIM$ (nachname.maadr)
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 FILE "geadr"
 INDEX CodeGE.geadr
 SELECT FIRST FILE "geadr" INDEX codege.geadr
 SELECT KEY codege% FILE "geadr" INDEX codege.geadr
 ge$ = LTRIM$ (Gesellschaft.geadr)
 SELECT FIRST FILE "geadr" INDEX codege.geadr
 FILE "sparten"
 INDEX CodeVA.sparten
 SELECT FIRST 
 SELECT KEY Codeva% FILE "Sparten" INDEX codeva.sparten
 sparte$ = LTRIM$ (sparte.sparten)
 SELECT FIRST FILE "Sparten" INDEX codeva.sparten
 FILE "GEKOND"
 beschreibung$ = ma$ + "," + ge$ + "," + sparte$
 REM ### andi ende
 FirstKond% = 0
 LastKond% = 0
 ok% = 1
 
 
    cfile$ = FILE 
    IF NOT OPEN ("mavorg") THEN CALL DFile(3,"mavorg" + _fpw$)
    FILE "mavorg"
    INDEX codema.mavorg
    SELECT FIRST FILE "mavorg" INDEX codema.mavorg
    SELECT KEY codema% FILE "mavorg" INDEX codema.mavorg
    i% = 0
    ex% = - 1
    IF NOT EXISTS (codema%,codema.gekond) THEN 
      ex% = 0
    ELSE 
      WHILE NOT EOF ("mavorg") AND codema.mavorg = codema%
        IF BWStart% >= von.mavorg THEN 
          i% = i% + 1
        END IF 
        fehlbis% = 0
        IF bis.mavorg > 1 THEN 
          testbis$ = DATE$ (bis.mavorg,"0d.mm.yyyy")
          teststart$ = DATE$ (bwstart%,"0d.mm.yyyy")
          REM CALL Fehler("bwstart " + teststart$,"bis.mavorg " + testbis$)
          IF BWStart% > bis.mavorg THEN 
            i% = i% - 1
           fehlbis% = - 1
          END IF 
        END IF 
        SELECT NEXT FILE "mavorg" INDEX codema.mavorg
      WEND 
    END IF 
    IF i% = 0 THEN 
      ok% = 0
      GetKond% = 0
      IF ex% = - 1 THEN 
        IF fehlbis% = 0 THEN 
          fehlnach$ = "Das Datum des Provisionierungsbeginn des Vertrages " + teststart$ + " liegt vor dem Datum BWVon des Vermittlers (" + DATE$ (von.mavorg,"0d.mm.yyyy") + " in der Maske VORGéNGER)"
        ELSE 
          fehlnach$ = "Das Datum des Provisionierungsbeginn des Vertrages " + teststart$ + " liegt nach dem Datum BWBIS des Vermittlers (" + testbis$ + " in der Maske VORGéNGER)"
        END IF 
      ELSE 
        fehlnach$ = "Es existieren keine Konditionen fÅr die Agentur " + nameorig$
      END IF 
      GFehl$ = fehlnach$
      REM CALL Fehler(t$," liegt vor dem Datum BWVon des Vermittlers (" + DATE$ (von.mavorg,"0d.mm.yyyy") + ")")
    END IF 
    FILE cfile$
 
    
 
 ff% = 0
 WHILE CodeMA% <> 0 AND ok% = 1
   nameorig$ = nachname.maadr + " " + Vorname.maadr + " " + Agenturnr.maadr
   FILE "GEKOND"
   INDEX QuickCode.gekond
   SELECT FIRST 
 
   SCode$ = STR$ (CodeMA%,"000000") + STR$ (CodeGE%,"000000") + STR$ (CodeVA%,"000000")
anfko020720051: 
   kondfound% = 1
   SELECT KEY codema% FILE "maadr" INDEX CodeMA.MAADR
   SELECT KEY SCode$ FILE "gekond" INDEX QuickCode.gekond
   IF FOUND ("GEKOND") THEN 
     notfound% = 1
     WHILE notfound% = 1 AND QuickCode.GEKOND = SCode$ AND NOT EOF ("GEKOND")
 
       REM -------------------------------
       REM -- Bewertungszeitraum ermitteln
       REM -------------------------------
 
       IF DAYS (BWvon.GEKOND) < 1 THEN BWvon% = DAYS ("1.1.1980") ELSE BWvon% = DAYS (BWvon.GEKOND)
       IF DAYS (BWbis.GEKOND) < 1 THEN BWbis% = DAYS ("31.12.2300") ELSE BWbis% = DAYS (BWbis.GEKOND)
       REM 130597
       IF BWStart% >= BWvon% AND BWStart% <= BWbis% THEN 
         notfound% = 0
       ELSE 
         SELECT NEXT FILE "gekond" INDEX QuickCode.GEKOND
       END IF 
     WEND 
     REM 08122004
     IF notfound% = 1 THEN 
       tag$ = DATE$ (BWStart%)
       fehlnach$ = "Es wurden keine Konditionen fÅr " + beschreibung$ + " im Zeitraum " + tag$ + "/ fÅr die Agentur oder VorgÑnger: " + nachname.maadr + ", " + Agenturnr.maadr + " definiert"
       IF logging% THEN 
         tag$ = DATE$ (BWStart%)
         CALL WriteLog("!" + fehlnach$)
         CALL AddLogInfo()
       END IF 
       ok% = 0
       kondfound% = 0
     END IF 
   ELSE 
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       fehlnach$ = ""
       IF FirmaEinhTab.stamm = "j" AND FirmaEurEinh.stamm = 0 THEN 
         fehlnach$ = "Es wurde in den Firmenstammdaten kein Basiswert fÅr Euro/Einheit der Firma definiert!"
       ELSE 
         IF RIGHT$ (scode$,6) <> "999999" THEN 
           scode$ = STR$ (CodeMA%,"000000") + "999999999999"
           SELECT FIRST FILE "GEKOND" INDEX QuickCode.gekond
           GOTO anfko020720051
         END IF 
       END IF 
     END IF 
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       fehlnach$ = ""
         IF RIGHT$ (scode$,6) <> "999999" THEN 
           scode$ = STR$ (CodeMA%,"000000") + "999999999999"
           SELECT FIRST FILE "GEKOND" INDEX QuickCode.gekond
           GOTO anfko020720051
         END IF 
     END IF 
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" AND fehlnach$ <> "" THEN 
     ELSE 
       fehlnach$ = "Es wurden keine Konditionen fÅr " + beschreibung$ + "/ fÅr die Agentur oder VorgÑnger: " + nachname.maadr + ", " + Agenturnr.maadr + " definiert"
     END IF 
     IF GAFSK$ LIKE "TRUE" THEN 
       REM CALL TWriteLogOk(Nachname.adressen + " " + Vorname.adressen + " / VS_NR " + VS_NR.KVERTRAG + " " + fehlnach$)
     END IF 
     kondfound% = 0
     IF logging% THEN 
       CALL WriteLog("!" + fehlnach$)
       CALL AddLogInfo()
     END IF 
   END IF 
   lf% = lfdnr.kvertrag
   IF kondfound% = 1 THEN 
     REM ** Eintrag in VKOND erstellen
     BLANK FILE "VKOND"
     CodeVK.VKOND = SER ("VKOND",1)
     CodeKO.VKOND = lfdnr.GEKOND
     IF FirstKond% = 0 THEN 
       FirstKond% = CodeVK.VKOND
     END IF 
     CodeVT.VKOND = vt%
     CodeMA.VKOND = codema%
     nÑchsteKond.VKOND = 0
     n1$ = nachname.maadr
     _vk% = CodeVK.VKOND
     CALL QuickStore("VKOND")
     IF LastKond% <> 0 THEN 
       SELECT KEY LastKond% LOCK FILE "VKOND" INDEX CodeVK.VKOND
       nÑchsteKond.VKOND = _vk%
       REM 08122004
       lastkondold% = lastkond%
       CALL QuickStore("VKOND")
     END IF 
     LastKond% = _vk%
     REM 08122004
     IF lastkondold% = lastkond% THEN 
       ok% = 0
     END IF 
   ELSE 
     ok% = 0
   END IF 
   SELECT KEY codema% FILE "maadr" INDEX CodeMA.MAADR
 
  REM *********  VorgÑngerfindung ALT *********************************************************
   'IF VorgÑnger.MAADR = 0 OR VorgÑnger.MAADR = CodeMA.MAADR THEN 
   '  CodeMA% = 0
   'ELSE 
   '  CodeMA% = VorgÑnger.MAADR
   'END IF 
  REM *********  VorgÑngerfindung ALT Ende **************************************************** 
 
 
  REM *********  VorgÑngerfindung NEU Anfang ************************************************** 
    cfile$ = FILE 
    FILE "mavorg"
    INDEX codema.mavorg
    SELECT FIRST FILE "mavorg" INDEX codema.mavorg
    SELECT KEY codema% FILE "mavorg" INDEX codema.mavorg
    name$ = nachname.maadr + " " + Vorname.maadr + " " + Agenturnr.maadr
    nichtinv% = 0
    IF NOT EXISTS (codema%,codema.mavorg) THEN 
      ff% = 1
      nichtinv% = 1
      GOTO fe081220041
    END IF 
    WHILE NOT EOF ("mavorg") AND codema.mavorg = codema%
      IF BWStart% >= von.mavorg THEN 
        IF bis.mavorg > 0 THEN 
          IF bwstart% <= bis.mavorg THEN 
            ff% = 0
            codema% = codevma.mavorg
            IF codema.maadr = codevma.mavorg THEN codema% = 0
            SELECT LAST FILE "mavorg" INDEX codema.mavorg
          ELSE 
            ff% = ff% + 1
            codemaolold% = codema%
            REM CALL Fehler("vermutlich Fehler","")
            bis% = bis.mavorg
            nameorig$ = NameVMA.mavorg
          END IF 
        ELSE 
          ff% = 0
          codema% = codevma.mavorg
          IF codema.maadr = codevma.mavorg THEN codema% = 0
          SELECT LAST FILE "mavorg" INDEX codema.mavorg
        END IF 
      ELSE 
        REM 08122004
        ff% = ff% + 1
      END IF 
      SELECT NEXT FILE "mavorg" INDEX codema.mavorg
    WEND 
fe081220041: 
    FILE cfile$
    IF ff% > 0 THEN 
      IF nichtinv% = 0 THEN 
        IF codemaolold% = codema% THEN 
          a1$ = DATE$ (bwstart%,"0d.mm.yyyy")
          a2$ = DATE$ (bis%,"0d.mm.yyyy")
          ff1$ = "FEHLER aufgetreten! Vermutlich ist in der Mitarbeiter - VorgÑnger-Datei ein Datum im Feld BWBis eingetragen (" + a2$ + "), das vor dem Provisionierungsbeginn-Datum " + a1$ + " (Antrags - oder Vertragsbeginn - Datum)des Vertrages liegt!"
          ff2$ = " PrÅfen Sie beim Mitarbeiter " + nameorig$ + " die Eintragungen, die in der VorgÑngerdatei bei dem VorgÑnger " + name$ + " stehen! Vergleichen Sie die EintrÑge in der VorgÑngerdatei aller an dem Vertrag beteiligten Mitarbeiter!"
          REM CALL Fehler(ff1$,ff2$)
          fehlnach$ = ff1$ + ff2$ + ", " + Agenturnr.maadr
          ok% = 0
        ELSE 
          REM 08122004
          a1$ = DATE$ (bwstart%,"0d.mm.yyyy")
          a2$ = DATE$ (bis%,"0d.mm.yyyy")
          ff1$ = "FEHLER aufgetreten! Vermutlich ist in der Mitarbeiter - VorgÑnger-Datei ein Datum im Feld BWBis eingetragen (" + a2$ + "), das vor dem Provisionierungsbeginn-Datum " + a1$ + " (Antrags - oder Vertragsbeginn - Datum)des Vertrages liegt!"
          ff2$ = " PrÅfen Sie beim Mitarbeiter " + nameorig$ + " die Eintragungen, die in der VorgÑngerdatei bei dem VorgÑnger " + name$ + " stehen! Vergleichen Sie die EintrÑge in der VorgÑngerdatei aller an dem Vertrag beteiligten Mitarbeiter!"
          REM CALL Fehler(ff1$,ff2$)
          fehlnach$ = ff1$ + ff2$ + ", " + Agenturnr.maadr
          ok% = 0
        ELSE 
          a1$ = DATE$ (bwstart%,"0d.mm.yyyy")
          a2$ = DATE$ (bis%,"0d.mm.yyyy")
          ff1$ = "Es existiert kein Eintrag in der VorgÑngerdatei"
          ff2$ = " PrÅfen Sie beim Mitarbeiter " + nameorig$ + " die Eintragungen, die in der VorgÑngerdatei bei dem VorgÑnger " + name$ + " stehen! Vergleichen Sie die EintrÑge in der VorgÑngerdatei aller an dem Vertrag beteiligten Mitarbeiter!"
          fehlnach$ = ff1$ + ff2$ + ", " + Agenturnr.maadr
          ok% = 0
        END IF 
      END IF 
    END IF 
  REM *********  VorgÑngerfindung NEU Ende **************************************************** 
 
 WEND 
 IF ok% = 1 THEN 
   GetKond% = FirstKond%
 ELSE 
   REM EintrÑge wieder lîschen
   IF FirstKond% <> 0 THEN 
     ok% = 1
     WHILE ok% = 1
       IF EXISTS (FirstKond%,CodeVK.VKOND) THEN 
         SELECT KEY FirstKond% LOCK FILE "VKOND" INDEX CodeVK.VKOND
       ELSE 
         SELECT LAST 
       END IF 
       IF EXISTS (FirstKond%,CodeVK.VKOND) THEN 
         SET STATUS "Korrektur"
         _nkond% = nÑchsteKond.VKOND
         SELECT REMOVE FILE "VKOND"
         FirstKond% = _nkond%
         SET STATUS "Bereit"
       ELSE 
         ok% = 0
       END IF 
     WEND 
   END IF 
   GetKond% = 0
 END IF 
 END FUNCTION 
  


FUNCTION GetKondSpez%(vt%,ProviAb%,logging%,codema%)
 cfile$ = FILE 
 SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY vt% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 IF ProviAb% = 0 THEN 
   bwbezug$ = ReadConfig$("PROVIS","Bewertungszeitraum")
     IF bwbezug$ LIKE "leer" OR bwbezug$ LIKE "Provisionierungsbeginn" THEN 
     BWStart% = DAYS (ProviAb.KVERTRAG)
   ELSE 
     BWStart% = DAYS (VS_Beginn.KVERTRAG)
   END IF 
 ELSE 
   BWStart% = ProviAb%
 END IF 
 FILE "GEKOND"
 
 REM ### Andi Anfang
 SELECT WHERE 
 INDEX QuickCode.gekond
 SELECT FIRST 
 REM ### Andi Ende
 REM codema% = CodeMA.kvertrag
 codege% = CodeGE.kvertrag
 codeva% = CodeVA.kvertrag
 REM ###andi anfang
 FILE "maadr"
 INDEX Codema.maadr
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 SELECT KEY codema% FILE "maadr" INDEX codema.maadr
 nameorig$ = nachname.maadr + " " + Vorname.maadr + " " + Agenturnr.maadr
 ma$ = LTRIM$ (nachname.maadr)
 SELECT FIRST FILE "maadr" INDEX codema.maadr
 FILE "geadr"
 INDEX CodeGE.geadr
 SELECT FIRST FILE "geadr" INDEX codege.geadr
 SELECT KEY codege% FILE "geadr" INDEX codege.geadr
 ge$ = LTRIM$ (Gesellschaft.geadr)
 SELECT FIRST FILE "geadr" INDEX codege.geadr
 FILE "sparten"
 INDEX CodeVA.sparten
 SELECT FIRST 
 SELECT KEY Codeva% FILE "Sparten" INDEX codeva.sparten
 sparte$ = LTRIM$ (sparte.sparten)
 SELECT FIRST FILE "Sparten" INDEX codeva.sparten
 FILE "GEKOND"
 beschreibung$ = ma$ + "," + ge$ + "," + sparte$
 REM ### andi ende
 FirstKond% = 0
 LastKond% = 0
 ok% = 1
 
 
    cfile$ = FILE 
    CALL DFile(3,"mavorg" + _fpw$)
    FILE "mavorg"
    INDEX codema.mavorg
    SELECT FIRST FILE "mavorg" INDEX codema.mavorg
    SELECT KEY codema% FILE "mavorg" INDEX codema.mavorg
    i% = 0
    WHILE NOT EOF ("mavorg") AND codema.mavorg = codema%
      IF BWStart% >= von.mavorg THEN 
        i% = i% + 1
      END IF 
      fehlbis% = 0
      IF bis.mavorg > 1 THEN 
        testbis$ = DATE$ (bis.mavorg,"0d.mm.yyyy")
        teststart$ = DATE$ (bwstart%,"0d.mm.yyyy")
        REM CALL Fehler("bwstart " + teststart$,"bis.mavorg " + testbis$)
        IF BWStart% > bis.mavorg THEN 
          i% = i% - 1
          fehlbis% = - 1
        END IF 
      END IF 
      SELECT NEXT FILE "mavorg" INDEX codema.mavorg
    WEND 
    IF i% = 0 THEN 
      ok% = 0
      GetKondSpez% = 0
      IF fehlbis% = 0 THEN 
        fehlnach$ = "Das Datum des Provisionierungsbeginn des Vertrages " + teststart$ + " liegt vor dem Datum BWVon des Vermittlers (" + DATE$ (von.mavorg,"0d.mm.yyyy") + " in der Maske VORGéNGER)"
      ELSE 
        fehlnach$ = "Das Datum des Provisionierungsbeginn des Vertrages " + teststart$ + " liegt nach dem Datum BWBIS des Vermittlers (" + testbis$ + " in der Maske VORGéNGER)"
      END IF 
      GFehl$ = fehlnach$
      REM CALL Fehler(t$," liegt vor dem Datum BWVon des Vermittlers (" + DATE$ (von.mavorg,"0d.mm.yyyy") + ")")
    END IF 
    FILE cfile$
 
    
 
 ff% = 0
 CALL Fehler("Struktur Spezialistenprov","")
 WHILE CodeMA% <> 0 AND ok% = 1
   nameorig$ = nachname.maadr + " " + Vorname.maadr + " " + Agenturnr.maadr
   FILE "GEKOND"
   INDEX QuickCode.gekond
   SELECT FIRST 
   SCode$ = STR$ (CodeMA%,"000000") + STR$ (CodeGE%,"000000") + STR$ (CodeVA%,"000000")
anfko290820051: 
   kondfound% = 1
   SELECT KEY codema% FILE "maadr" INDEX CodeMA.MAADR
   SELECT KEY SCode$ FILE "gekond" INDEX QuickCode.gekond
   IF FOUND ("GEKOND") THEN 
     notfound% = 1
     WHILE notfound% = 1 AND QuickCode.GEKOND = SCode$ AND NOT EOF ("GEKOND")
 
       REM -------------------------------
       REM -- Bewertungszeitraum ermitteln
       REM -------------------------------
 
       IF DAYS (BWvon.GEKOND) < 1 THEN BWvon% = DAYS ("1.1.1980") ELSE BWvon% = DAYS (BWvon.GEKOND)
       IF DAYS (BWbis.GEKOND) < 1 THEN BWbis% = DAYS ("31.12.2300") ELSE BWbis% = DAYS (BWbis.GEKOND)
       REM 130597
       IF BWStart% >= BWvon% AND BWStart% <= BWbis% THEN 
         notfound% = 0
       ELSE 
         SELECT NEXT FILE "gekond" INDEX QuickCode.GEKOND
       END IF 
     WEND 
     IF notfound% = 1 THEN 
       tag$ = DATE$ (BWStart%)
       fehlnach$ = "Es wurden keine Konditionen fÅr " + beschreibung$ + " im Zeitraum " + tag$ + "/ fÅr die Agentur oder VorgÑnger: " + nachname.maadr + " definiert"
       IF logging% THEN 
         tag$ = DATE$ (BWStart%)
         CALL WriteLog("!" + fehlnach$)
         CALL AddLogInfo()
       END IF 
       ok% = 0
       kondfound% = 0
     END IF 
   ELSE 
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       fehlnach$ = ""
       IF FirmaEinhTab.stamm = "j" AND FirmaEurEinh.stamm = 0 THEN 
         fehlnach$ = "Es wurde in den Firmenstammdaten kein Basiswert fÅr Euro/Einheit der Firma definiert!"
       ELSE 
         IF RIGHT$ (scode$,6) <> "999999" THEN 
           scode$ = STR$ (CodeMA%,"000000") + "999999999999"
           SELECT FIRST FILE "GEKOND" INDEX QuickCode.gekond
           GOTO anfko290820051
         END IF 
       END IF 
     END IF 
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" AND fehlnach$ <> "" THEN 
     ELSE 
       fehlnach$ = "Es wurden keine Konditionen fÅr " + beschreibung$ + "/ fÅr die Agentur oder VorgÑnger: " + nachname.maadr + ", " + Agenturnr.maadr + " definiert"
     END IF 

     REM fehlnach$ = "Es wurden keine Konditionen fÅr " + beschreibung$ + "/ fÅr die Agentur oder VorgÑnger: " + nachname.maadr + " definiert"
     IF GAFSK$ LIKE "TRUE" THEN 
       CALL TWriteLogOk(Nachname.adressen + " " + Vorname.adressen + " / VS_NR " + VS_NR.KVERTRAG + " " + fehlnach$)
     END IF 
     kondfound% = 0
     IF logging% THEN 
       CALL WriteLog("!" + fehlnach$)
       CALL AddLogInfo()
     END IF 
   END IF 
   IF kondfound% = 1 THEN 
     REM ** Eintrag in vkond1 erstellen
     BLANK FILE "vkond1"
     CodeVK.vkond1 = SER ("vkond1",1)
     CodeKO.vkond1 = lfdnr.GEKOND
     IF FirstKond% = 0 THEN 
       FirstKond% = CodeVK.vkond1
     END IF 
     CodeVT.vkond1 = vt%
     CodeMA.vkond1 = codema%
     nÑchsteKond.vkond1 = 0
     n1$ = nachname.maadr
     _vk% = CodeVK.vkond1
     CALL QuickStore("vkond1")
     IF LastKond% <> 0 THEN 
       SELECT KEY LastKond% LOCK FILE "vkond1" INDEX CodeVK.vkond1
       nÑchsteKond.vkond1 = _vk%
       CALL QuickStore("vkond1")
     END IF 
     LastKond% = _vk%
   ELSE 
     ok% = 0
   END IF 
   SELECT KEY codema% FILE "maadr" INDEX CodeMA.MAADR
 
  REM *********  VorgÑngerfindung ALT *********************************************************
   'IF VorgÑnger.MAADR = 0 OR VorgÑnger.MAADR = CodeMA.MAADR THEN 
   '  CodeMA% = 0
   'ELSE 
   '  CodeMA% = VorgÑnger.MAADR
   'END IF 
  REM *********  VorgÑngerfindung ALT Ende **************************************************** 
 
 
  REM *********  VorgÑngerfindung NEU Anfang ************************************************** 
    cfile$ = FILE 
    FILE "mavorg"
    INDEX codema.mavorg
    SELECT FIRST FILE "mavorg" INDEX codema.mavorg
    SELECT KEY codema% FILE "mavorg" INDEX codema.mavorg
    name$ = nachname.maadr + " " + Vorname.maadr + " " + Agenturnr.maadr
    WHILE NOT EOF ("mavorg") AND codema.mavorg = codema%
      IF BWStart% >= von.mavorg THEN 
        IF bis.mavorg > 0 THEN 
          IF bwstart% <= bis.mavorg THEN 
            ff% = 0
            codema% = codevma.mavorg
            IF codema.maadr = codevma.mavorg THEN codema% = 0
            SELECT LAST FILE "mavorg" INDEX codema.mavorg
          ELSE 
            ff% = ff% + 1
            codemaolold% = codema%
            REM CALL Fehler("vermutlich Fehler","")
            bis% = bis.mavorg
            nameorig$ = NameVMA.mavorg
          END IF 
        ELSE 
          ff% = 0
          codema% = codevma.mavorg
          IF codema.maadr = codevma.mavorg THEN codema% = 0
          SELECT LAST FILE "mavorg" INDEX codema.mavorg
        END IF 
      END IF 
      SELECT NEXT FILE "mavorg" INDEX codema.mavorg
    WEND 
    FILE cfile$
    IF ff% > 0 THEN 
      IF codemaolold% = codema% THEN 
        a1$ = DATE$ (bwstart%,"0d.mm.yyyy")
        a2$ = DATE$ (bis%,"0d.mm.yyyy")
        ff1$ = "FEHLER aufgetreten! Vermutlich ist in der Mitarbeiter - VorgÑnger-Datei ein Datum im Feld BWBis eingetragen (" + a2$ + "), das vor dem Provisionierungsbeginn-Datum " + a1$ + " (Antrags - oder Vertragsbeginn - Datum)des Vertrages liegt!"
        ff2$ = " PrÅfen Sie beim Mitarbeiter " + nameorig$ + " die Eintragungen, die in der VorgÑngerdatei bei dem VorgÑnger " + name$ + " stehen! Vergleichen Sie die EintrÑge in der VorgÑngerdatei aller an dem Vertrag beteiligten Mitarbeiter!"
        CALL Fehler(ff1$,ff2$)
        fehlnach$ = ff1$ + ff2$
        ok% = 0
      END IF 
    END IF 
  REM *********  VorgÑngerfindung NEU Ende **************************************************** 
 
 WEND 
 IF ok% = 1 THEN 
   GetKondSpez% = FirstKond%
 ELSE 
   REM EintrÑge wieder lîschen
   IF FirstKond% <> 0 THEN 
     ok% = 1
     WHILE ok% = 1
       IF EXISTS (FirstKond%,CodeVK.vkond1) THEN 
         SELECT KEY FirstKond% LOCK FILE "vkond1" INDEX CodeVK.vkond1
       ELSE 
         SELECT LAST 
       END IF 
       IF EXISTS (FirstKond%,CodeVK.vkond1) THEN 
         SET STATUS "Korrektur"
         _nkond% = nÑchsteKond.vkond1
         SELECT REMOVE FILE "vkond1"
         FirstKond% = _nkond%
         SET STATUS "Bereit"
       ELSE 
         ok% = 0
       END IF 
     WEND 
   END IF 
   GetKondSpez% = 0
 END IF 
 END FUNCTION 
 
  





SUB ADRLoesch1()
 cuku% = CodeKU.GAdrDat$
 IF title$ LIKE "*DEMO*" AND RECCOUNT (GAdrDat$) >= 10 THEN 
   CALL DemoInfo()
   END SUB 
 END IF 
 CALL DFile(3,"kvertrag" + _fpw$)
 _ok% = 0
 IF disabled%("ADRLoeschen") THEN END SUB 
 IF ag$ = "j" THEN 
   CALL Fehler("Diese Funktion ist fÅr SmartPROVIS Agentur gesperrt!","")
   END SUB 
 END IF 
 maskeab$ = FORM 
 IF FORM LIKE "BCKONTAK*" THEN 
 ELSE 
   FILE "Kvertrag"
   IF EXISTS (cuku%,codeku.kvertrag) THEN 
     CALL Fehler("Adresse kann nicht gelîscht werden","Es existieren noch VertrÑge")
     _ok% = - 1
   END IF 
 END IF 
 IF _ok% <> - 1 THEN 
 FILE GAdrDat$
 REQUEST "Adresse wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   SELECT KEY cuku% LOCK FILE GAdrDat$ INDEX CodeKU.GAdrDat$
   daten$ = "Adresse:" + nachname.GAdrDat$ + "/" + geburtsname.GAdrDat$ + "/" + vorname.GAdrDat$ + "/" + ort.GAdrDat$ + " - " + plz.GAdrDat$ + "/" + stra·e.GAdrDat$
   CALL LoeschProt(cuku%,Daten$)
   SELECT REMOVE FILE GAdrDat$
   FILE GTelDat$
   INDEX codeku.GTelDat$
   SELECT FIRST 
   IF EXISTS (cuku%,codeku.GTelDat$) THEN 
     REMOVE FROM FILE GTelDat$ WHERE codeku.GTelDat$ = cuku%
   END IF 
   IF EXISTS (cuku%,codeku.GAkquiDat$) THEN 
     REMOVE FROM FILE GAkquiDat$ WHERE codeku.GAkquiDat$ = cuku%
   END IF 
   FILE GAdrDat$
   CALL ADRNext()
   codeku% = codeku.GAdrDat$
   SELECT FORM KEY codeku% FILE GTelDat$ INDEX codeku.GTelDat$
   FORM 
 END IF 
 END IF 
 FORM 
 END SUB 
 
 
 ' universeller Reportgenerator fÅr VertragsÅbersichten
 ' ======================================================================
 ' ku%   Kundennummer (CodeKU) oder 0 fÅr alle
 ' ma%   Agenturnummer (CodeMA) oder 0 fÅr alle
 ' spa%  Spartennummer (CodeVA) oder 0 fÅr alle
 ' ge%   Gesellschaftsnummer (CodeGE) oder 0 fÅr alle
 ' spgr% Spartengruppennummer (CodeGRSP) oder -1 fÅr alle
 ' so%   Sortierung: 1=Kunde, 2=Agentur, 3=Gesellschaft, 4=Sparte 5=Spartengruppe
 ' von%  Anfangsdatum oder 0 fÅr alle
 ' bis%  Enddatum oder 0 fÅr Open End
 ' bart% Berichtsart: 0=alle "normalen" VertrÑge
 '                    1=VertrÑge mit Bezug auf Ablaufdatum
 '                    2=VertrÑge ohne Abschlu·
 '                    3=FremdvertrÑge
 '                    4=FremdvertrÑge mit Bezug auf Ablaufdatum
 '                    5=AltvertrÑge
 ' dask% 0=ohne Abfrage ausfÅhren, 1=Optionen editierbar
 
SUB VertrUniRep(ku%,ma%,spa%,ge%,so%,von%,bis%,bart%,dask%,spgr%,tarif%)
 DIM dlg AS Dialog
 DIM control AS DialogControl
 CALL DFile(2,"OFFICE\" + "ADRE1" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKQUI1" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELADR1" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKADR1" + _fpw$)
 
 CALL DFile(2,"OFFICE\" + "BCKONTAK" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKQUIBCK" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELBCK" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKBCK" + _fpw$)
 CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
 CALL DFile(2,"OFFICE\" + "AKQUISE" + _fpw$)
 CALL DFile(2,"OFFICE\" + "TELEFON" + _fpw$)
 CALL DFile(2,"OFFICE\" + "DOKUMENT" + _fpw$)
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 CALL DFile(2,"OFFICE\adrgrup" + _fpw$)
 abruf$ = "n"
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 FILE GAdrDat$
 INDEX codeku.GAdrDat$
 SELECT FIRST 
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 FILE "Sparten"
 INDEX codeva.sparten
 SELECT FIRST 
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 FILE "geadr"
 INDEX codege.geadr
 SELECT FIRST 
 CALL DFile(3,"maadr" + _fpw$)
 FILE "maadr"
 INDEX codema.maadr
 SELECT FIRST 
 CALL DFile(3,"maadrgru" + _fpw$)
 FILE "maadrgru"
 INDEX magruppe.maadrgru
 SELECT FIRST 
 CALL DFile(3,"kvertrag" + _fpw$)
 FILE "Kvertrag"
 INDEX lfdnr.kvertrag
 SELECT FIRST FILE "Kvertrag"
 SELECT WHERE FILE "Kvertrag"
 CALL DFile(3,"spgruppe" + _fpw$)
 FILE "spgruppe"
 INDEX Codegrsp.SPGRUPPE
 SELECT FIRST 
 CALL DFile(3,"GEGRUP" + _fpw$)

 
 IF PrvVerfahr$ LIKE "ZAHLUNGSEINGANG" THEN 
   CALL DFile(3,"zeingan1" + _fpw$)
 END IF 
   DIM Waehrung$(25,1)
   REDIM Waehrung$(25)
   REM FOR i% = 1 TO 20
     REM Waehrung$(i%) = ""
   REM NEXT i%
   
   a% = 0
   Waehrung$(0) = "Filter deaktiviert"
   Waehrung$(1) = "alle nicht stornierten,nicht FremdvertrÑge,nicht AltvertrÑge" + SPACE$ (90) + "17"
   Waehrung$(2) = "alle nicht stornierten und FremdvertrÑge,nicht AltvertrÑge" + SPACE$ (90) + "18"
   Waehrung$(3) = "lebend" + SPACE$ (90) + "01"
   Waehrung$(4) = "leben/kurzfristig/unterjÑhrig" + SPACE$ (90) + "02"
   Waehrung$(5) = "ruhend/Anwartschaft" + SPACE$ (90) + "03"
   Waehrung$(6) = "storniert" + SPACE$ (90) + "04"
   Waehrung$(7) = "ruhend/beitragsfrei" + SPACE$ (90) + "05"
   Waehrung$(8) = "beitragsfrei" + SPACE$ (90) + "06"
   Waehrung$(9) = "beitragsfrei durch Leistung" + SPACE$ (90) + "07"
   Waehrung$(10) = "Beitragsstundung" + SPACE$ (90) + "08"
   Waehrung$(11) = "Sonstiges" + SPACE$ (90) + "09"
   Waehrung$(12) = "Altvertrag" + SPACE$ (90) + "10"
   Waehrung$(13) = "Fremdvertrag" + SPACE$ (90) + "11"
   Waehrung$(14) = "Antrag" + SPACE$ (90) + "12"
   Waehrung$(15) = "storniert durch Dynamisierung" + SPACE$ (90) + "13"
   Waehrung$(16) = "Bestandteil eines BÅndelungsvertrages" + SPACE$ (90) + "14"
   Waehrung$(17) = "Antragswiderruf" + SPACE$ (90) + "15"
   Waehrung$(18) = "Policenwiderspruch" + SPACE$ (90) + "16"
   Waehrung$(19) = "Antragsablehnung" + SPACE$ (90) + "20"
   Waehrung$(20) = "KÅnd.wg.Nichtzahlung" + SPACE$ (90) + "21"
   DIM Auswahl1$(1)
 doit% = 1
 incAltV$ = "n"
 incFremd$ = "n"
 incAntr$ = "n"
 incPolice$ = "n"
 incStorno$ = "n"
 IF dask% = 1 THEN 
 IF GASP% THEN 
   DIM office$(VisCount%)'eins mehr fÅr <Alle BÅros>
   REM IF workstation% = 0 THEN 
     REM ShowOther% = - 1
   REM ELSE 
     FOR i% = 0 TO VisCount% - 1
       office$(i%) = VisNames$(i%)
     NEXT i%
     REM IF GPPCS$ LIKE "TRUE" THEN 
     IF Workstation% > 0 THEN 
       office$(VisCount%) = "<Alle BÅros>"
       selOff$ = office$(VisCount% - 1)'sis
       REM selOff$ = "<Alle BÅros>"
     ELSE 
       office$(VisCount%) = "<Alle BÅros>"
       selOff$ = office$(VisCount%)'sis 
       REM selOff$ = "<Alle BÅros>"
     END IF 
     REM ShowOther% = - 1
     IF ShowOther% <> - 1 THEN 
        FOR i% = 0 TO VisCount% - 1
            IF VisOff%(i%) = ShowOther% THEN 
                selOff$ = VisNames$(i%)
                i% = VisCount%
            END IF 
        NEXT i%
     END IF 
   REM END IF 
 END IF 
   IF so% = 0 THEN so% = 1
anfuni230420031: 
   ok% = - 1
   Agr$ = "alle"
   Geg$ = "alle"
   WHILE ok%
     GCodieRuf1% = 0
     IF ku% = 0 THEN 
       vKunde$ = "alle"
     ELSE 
       SELECT KEY ku% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       vkunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
     END IF 
     IF ma% = 0 THEN 
       Agentur$ = "alle"
     ELSE 
       SELECT KEY ma% FILE "MAADR" INDEX CodeMA.MAADR
       agentur$ = Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + "."
     END IF 
     IF spa% = 0 THEN 
       vSparte$ = "alle"
     ELSE 
       SELECT KEY spa% FILE "SPARTEN" INDEX CodeVA.SPARTEN
       vsparte$ = Sparte.SPARTEN
     END IF 
     IF spgr% = - 1 THEN 
       vSpGR$ = "alle"
     ELSE 
       SELECT KEY spgr% FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
       vspGr$ = Gruppe.SPGRUPPE
     END IF 
     IF ge% = 0 THEN 
       Gesellschaft$ = "alle"
     ELSE 
       SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
       Gesellschaft$ = Gesellschaft.GEADR
       REM ** Gesellschaft auswÑhlen
     END IF 
 
     SELECT CASE bart%'                                        ; öberschrift festlegen
     CASE 0
       st$ = "VertragsÅbersicht"
     CASE 1
       st$ = "Ablauf von VertrÑgen"
     CASE 2
       st$ = "VertrÑge ohne Abschlu·"
     CASE 3
       st$ = "FremdvertrÑge"
     CASE 4
       st$ = "Ablauf von FremdvertrÑgen"
     CASE 5
       st$ = "AltvertrÑge"
     END SELECT 
     REMOVE DIALOG ALL 
 
     IF GASP% THEN 
       IF FORM LIKE "MAADR*" OR FORM LIKE "ASPMA*" THEN 
         CREATE DIALOG "BVERTRAG",0,0,250,337,title$ + " - " + st$,"MS Sans Serif",8
       ELSE 
         CREATE DIALOG "BVERTRAG",0,0,400,337,title$ + " - " + st$,"MS Sans Serif",8
       END IF 
     ELSE 
       CREATE DIALOG "BVERTRAG",0,0,250,337,title$ + " - " + st$,"MS Sans Serif",8
     END IF 
     ADD DIALOG "BVERTRAG",4,1,1,244,83,0,"Filter"
     ADD DIALOG "BVERTRAG",5,3,10,34,9,0,"Kunde"
     ADD DIALOG "BVERTRAG",5,61,10,167,9,0,vKunde$
     ADD DIALOG "BVERTRAG",1,228,10,14,9,0,"...",2,1

     ADD DIALOG "BVERTRAG",5,3,20,35,10,0,"Vermittler"
     ADD DIALOG "BVERTRAG",5,61,20,167,10,0,Agentur$
     ADD DIALOG "BVERTRAG",1,228,20,14,10,0,"...",3,1

     ADD DIALOG "BVERTRAG",5,3,30,65,10,0,"Vermittler-Gruppe"
     ADD DIALOG "BVERTRAG",5,61,30,167,10,0,AGr$
     ADD DIALOG "BVERTRAG",1,228,30,14,10,0,"...",7,1

     ADD DIALOG "BVERTRAG",5,3,40,43,10,0,"Gesellschaft"
     ADD DIALOG "BVERTRAG",5,61,40,167,10,0,Gesellschaft$
     ADD DIALOG "BVERTRAG",1,228,40,14,10,0,"...",4,1

     ADD DIALOG "BVERTRAG",5,3,50,63,10,0,"Gesellsch-Gruppe"
     ADD DIALOG "BVERTRAG",5,61,50,167,10,0,GeG$
     ADD DIALOG "BVERTRAG",1,228,50,14,10,0,"...",8,1


     ADD DIALOG "BVERTRAG",5,3,60,24,10,0,"Sparte"
     ADD DIALOG "BVERTRAG",5,61,60,167,10,0,vSparte$
     ADD DIALOG "BVERTRAG",1,228,60,14,10,0,"...",5,1

     ADD DIALOG "BVERTRAG",5,3,70,49,9,0,"Spartengruppe"
     ADD DIALOG "BVERTRAG",5,61,70,167,9,0,vSpGr$
     ADD DIALOG "BVERTRAG",1,228,70,14,9,0,"...",6,1

     ADD DIALOG "BVERTRAG",4,5,88,163,75,0,"Zeitraum"
     ADD DIALOG "BVERTRAG",5,9,103,155,16,0,"Bitte wÑhlen Sie den Zeitraum aus, fÅr den Sie die VertragsÅbersicht wÅnschen."
     ADD DIALOG "BVERTRAG",5,9,124,155,16,0,"Sie kînnen die Datumsfelder auch freilassen, um alle VertrÑge anzeigen zu lassen."
     ADD DIALOG "BVERTRAG",6,28,146,41,11,0,0,von$,20
     ADD DIALOG "BVERTRAG",6,96,146,41,11,0,0,bis$,20
     ADD DIALOG "BVERTRAG",5,9,147,16,10,0,"von"
     ADD DIALOG "BVERTRAG",5,80,147,13,10,0,"bis"
     ADD DIALOG "BVERTRAG",4,170,88,75,74,0,"Sortierreihenfolge"
     ADD DIALOG "BVERTRAG",3,177,99,64,11,0,"Kunde",1,so%
     ADD DIALOG "BVERTRAG",3,177,112,64,11,0,"Vermittler",2,so%
     ADD DIALOG "BVERTRAG",3,177,124,64,10,0,"Gesellschaft",3,so%
     ADD DIALOG "BVERTRAG",3,177,136,64,11,0,"Sparte",4,so%
     ADD DIALOG "BVERTRAG",3,177,148,64,12,0,"Spartengruppe",5,so%
     IF GLundWrigg$ = "TRUE" THEN 
       ADD DIALOG "BVERTRAG",2,94,197,90,11,0,"Abruf Lund-Wriggers","j","n",abruf$
     END IF 
     REM ADD DIALOG "BVERTRAG",4,5,166,240,55,0,"provisionstechnische Optionen"
     REM ADD DIALOG "BVERTRAG",2,10,175,80,11,0,"FremdvertrÑge","j","n",incFremd$
     REM ADD DIALOG "BVERTRAG",2,94,175,70,11,0,"policierte VertrÑge","j","n",incPolice$
     IF GSoll$ LIKE "j" THEN 
       IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",2,10,175,160,11,0,"nur VertrÑge der Sollst.Åberw.","j","n",incSoll$
     END IF 
     REM ADD DIALOG "BVERTRAG",2,94,185,130,11,0,"stornierte,vormals policierte VertrÑge","j","n",incStorno$
     REM ADD DIALOG "BVERTRAG",2,10,185,80,11,0,"AltvertrÑge","j","n",incAltV$
     REM ADD DIALOG "BVERTRAG",2,10,195,80,11,0,"AntrÑge","j","n",incAntr$
 
     ADD DIALOG "BVERTRAG",5,80,198,130,10,0,"Wiedervorlage Monat"
     ADD DIALOG "BVERTRAG",6,153,197,13,11,0,0,WMon$,2
     ADD DIALOG "BVERTRAG",5,173,198,18,10,0,"Jahr"
     ADD DIALOG "BVERTRAG",6,193,197,22,11,0,0,WJahr$,4
     IF workstation% = 0 THEN 
       IF MNdisabled%("VERTRINHAUSSEE") THEN 
       ELSE 
         ADD DIALOG "BVERTRAG",2,10,208,160,11,0,"nur Inhouse-VertrÑge zeigen","j","n",incexpInt$
       END IF 
     END IF 
     IF GASP% THEN 
       ff$ = FORM 
       IF FORM LIKE "MAADR*" OR FORM LIKE "ASPMA*" THEN 
       ELSE 
         ADD DIALOG "BVERTRAG",4,268,219,123,95,0,"BÅro:"
         ADD DIALOG "BVERTRAG",8,270,229,115,95,259,2,selOff$,office$
       END IF 
     END IF 
     REM 191099/2
     ADD DIALOG "BVERTRAG",4,5,224,249,95,0,"Optionen zum Vertragsstatus"
     ADD DIALOG "BVERTRAG",7,10,234,235,80,0,2,Waehrung$,Auswahl1$,"Filter deaktiviert"
     ADD DIALOG "BVERTRAG",1,66,322,55,14,1,"&OK",1,1
     ADD DIALOG "BVERTRAG",1,124,322,55,14,0,"&Abbrechen",0,0
     DIALOG "BVERTRAG",dreq%
     SELECT CASE dreq%
     CASE 1
       doit% = 1
       ok% = 0
     CASE 2
       ku% = ADRSuche%(ku%)
     CASE 3
       REM ma% = GetCodeMA%(ma%,Workstation%)
       IF workstation% = 0 THEN 
         IF BZwang.stamm = 0 THEN 
           IF GASP% = - 1 THEN 
             a% = SelectOffice%("VorgÑnger-Auswahl","",1,0)
           ELSE 
             a% = 0
           END IF 
           IF a% <> - 1 THEN 
             zzz% = a%
             wks% = zzz%
             REM codema% = VAL (GetWkscodema$(prompt$,wks%))
             ma% = GetCodeMA%(_cuma%,Wks%)
           ELSE 
             CALL Fehler("BÅroauswahl abgebrochen!","")
             ma% = 0
           END IF 
         ELSE 
           ma% = GetCodeMA%(_cuma%,0)
         END IF 
       ELSE 
         REM codema% = VAL (GetWkscodema$(prompt$,Workstation.GADRDat$))
         wks1% = Workstation%
         ma% = GetCodeMA%(ma%,Wks1%)
       END IF 
       IF gasp% = - 1 AND workstation% > 0 AND ma% < 1 THEN 
         CALL Fehler("Sie kînnen nur die VertrÑge eines Vermittler anzeigen lassen!","")
         REMOVE DIALOG ALL 
         GOTO end100120061
       END IF 
     CASE 4
       ge% = GetCodeGE%(ge%)
     CASE 5
       spa% = GetCodeVA%(spa%)
     CASE 6
       spgr% = GetCodeGR%(spgr%)
     CASE 7
       REM Vermittlergruppe
       AGr1$ = GetCodeMAGR$(AGR$)
       IF agr1$ <> "" THEN agr$ = agr1$
     CASE 8
       REM Gesellschaftsgruppe
       Gag1$ = GetCodeGEGR$(Gag$)
       IF Gag1$ <> "" THEN 
         IF gag1$ LIKE "<ohne Zuordnung>" THEN gag1$ = "alle"
         geg$ = gag1$
       END IF 
     CASE 0
       ok% = 0
       doit% = 0
     END SELECT 
     REM REMOVE DIALOG "BVERTRAG"
     REMOVE DIALOG ALL 
   WEND 
 END IF 
 cdir$ = DIRECTORY 
 IF doit% = 1 THEN 
 
        CodeVStatus% = VAL ( RIGHT$ (Auswahl1$(0),2))
        IF (CodeVStatus% > 0) THEN 
          laenge1% = LEN (Auswahl1$(0))
          ausw$ = LEFT$ (Auswahl1$(0),laenge1% - 2)
          ausw1$ = TRIM$ (ausw$)
          
          vstatusu$ = "Filter: " + ausw1$
          REM SELECT WHERE CodeVstatus.kvertrag = CodeVStatus%
        END IF 
 
   IF dask% = 0 THEN 
     IF von% <> 0 THEN von$ = DAYS (von%) ELSE von$ = ""
     IF bis% <> 0 THEN bis$ = DAYS (bis%) ELSE bis$ = ""
   END IF 
   IF DateOK%(von$) THEN 
     IF DateOK%(bis$) THEN 
       req% = - 1
       REM IF PrvVerfahr$ LIKE "ZAHLUNGSEINGANG" THEN 
         REM REQUEST "Standardliste(JA) oder Liste mit SRHaftung und ZahlungseingÑnge (NEIN)?","",130,req%
         IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR*" THEN 
           opt% = 0
         ELSE 
           opt% = 4
         END IF 
         Superbase.Dialogs.Add("ADRFilter")
         SET dlg = Superbase.Dialogs.ADRFilter
         dlg.Move(0,0,320,121)
         dlg.Caption = title$
         dlg.FontName = "MS Sans Serif"
         dlg.FontSize = 8
 
         SET control = dlg.Add("DialogFrame2","DialogFrame")
         control.Move(0,6,320,92)
         control.Caption = "Druckoptionen"
         IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR*" THEN 
           SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
           control.Move(5,19,228,13)
           control.Caption = "Standard - VertragsÅbersicht"
           control.Bind("opt%")
           control.ValueOn = 0

           SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
           control.Move(5,33,300,13)
           control.Caption = "Standard - VertragsÅbersicht ohne Kund.nr,Agentur,Spartengruppe,LZ und Summen..."
           control.Bind("opt%")
           control.ValueOn = 5
         ELSE 
           SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
           control.Move(5,19,228,13)
           control.Caption = "Standard - VertragsÅbersicht mit vers.Person1/Risikoort"
           control.Bind("opt%")
           control.ValueOn = 0
 
           SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
           control.Move(5,35,228,13)
           control.Caption = "Standard - VertragsÅbersicht mit Angaben zum VN"
           control.Bind("opt%")
           control.ValueOn = 4
         END IF 
         SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
         control.Move(5,48,311,14)
         control.Caption = "öbersicht aller VertrÑge mit SRHaftung"
         control.Bind("opt%")
         control.ValueOn = 1
         IF PrvVerfahr$ LIKE "ZAHLUNGSEINGANG" THEN 
           IF workstation% = 0 THEN 
             SET control = dlg.Add("DialogOptionButton4","DialogOptionButton")
             control.Move(5,64,301,12)
             control.Caption = "öbersicht aller VertrÑge mit SRHaftung - zu denen ZahlungseingÑnge vorhanden sind"
             control.Bind("opt%")
             control.ValueOn = 3
           END IF 
         END IF 

         SET control = dlg.Add("DialogOptionButton14","DialogOptionButton")
         control.Move(5,80,301,12)
         control.Caption = "VertrÑge-Lebensversicherung-Ablaufleistung"
         control.Bind("opt%")
         control.ValueOn = 6

         SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
         control.Move(96,103,48,15)
         control.Default = 1
         control.Caption = "&Weiter"
         control.ReturnValue = 1
 
         SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
         control.Move(148,103,48,15)
         control.Caption = "&Abbruch"
         control.ReturnValue = 0
         control.Cancel = 1
         DIALOG "ADRFilter",req%
         REMOVE DIALOG ALL 
         IF req% = 0 THEN GOTO anfuni230420031
       REM END IF 
       DIRECTORY GPrjForm$
       FILE "KVERTRAG"
       SELECT FIRST FILE "supervis" INDEX codema.supervis
       SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
       fussma1$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
       REM -- Quelle fÅr Reportausgabe erzeugen --
       IF EXISTS ("VREPORT.SBP") THEN DELETE "VREPORT.SBP"
       IF PROGRAMFILE ("VREPORT") THEN CLOSE PROGRAMFILE "VREPORT"
       MOUSE OFF 
       OPEN "VREPORT.SBP" FOR OUTPUT 
       ? " SUB VReport()"
       REM ? "   DEBUG ASK"
       IF opt% = 6 THEN 
         ? "  CALL PRep(" + CHR$ (34) + "BVBE4" + CHR$ (34) + ")"
         ? "   REPORT ON subew% AS " + CHR$ (34) + "BeitrSum%" + CHR$ (34) + ",BewSum%  AS " + CHR$ (34) + "anz%" + CHR$ (34)
         ? "   BEFORE REPORT"
         ? "   SET REPORT PAGE " + CHR$ (34) + "H_REPORT" + CHR$ (34)
         ? "   OUTPUT REPORT PAGE"
         ? "   END REPORT"
         ? "   AFTER REPORT "
         ? "   EJECT REPORT "
         ? "   SET REPORT PAGE " + CHR$ (34) + "F_REPORT" + CHR$ (34)
         ? "   OUTPUT REPORT PAGE"
         ? "   END REPORT"
       END IF 
       IF opt% = 3 THEN 
         REM öbersicht aller VertrÑge mit SRHaftung - zu denen ZahlungseingÑnge vorhanden sind
         REM ? "   REPORT USING " + CHR$ (34) + "BVERTRAG" + CHR$ (34)
         REM ? "   REPORT USING " + CHR$ (34) + "BVBE1" + CHR$ (34)
         ? "  CALL PRep(" + CHR$ (34) + "BVBE1" + CHR$ (34) + ")"
         ? "   REPORT ON lfdnr.KVERTRAG AS " + CHR$ (34) + "anzZ%" + CHR$ (34) + ",BewertungEU.ZEINGAN1 AS " + CHR$ (34) + "summeZ1%" + CHR$ (34)
         ? "   AFTER REPORT "
         ? "   SET REPORT PAGE " + CHR$ (34) + "F_REPORT" + CHR$ (34)
         ? "   OUTPUT REPORT PAGE"
         ? "   END REPORT"
       END IF 
       IF opt% = 1 THEN 
         REM öbersicht aller VertrÑge mit SRHaftung
         REM ? "REPORT USING " + CHR$ (34) + "BVBE2" + CHR$ (34)
         ? "  CALL PRep(" + CHR$ (34) + "BVBE2" + CHR$ (34) + ")"
         ? "REPORT ON lfdnr.KVERTRAG AS " + CHR$ (34) + "anzV%" + CHR$ (34)
         ? "AFTER REPORT "
         ? "SET REPORT PAGE " + CHR$ (34) + "F_REPORT" + CHR$ (34)
         ? "OUTPUT REPORT PAGE"
         ? "END REPORT"
       END IF 
       IF opt% = 0 OR opt% = 5 THEN 
         REM Standard - VertragsÅbersichtt
         testfo$ = FORM 
         fstpa% = 0
         IF FORM LIKE "ADRESS*" OR FORM LIKE "ASPADR*" THEN 
           REQUEST "Soll auf der 1.Seite die komplette Kundenadresse gedruckt werden?","",135,fstpa%
         END IF 
         IF opt% = 0 THEN ? "   REPORT USING " + CHR$ (34) + "BV" + CHR$ (34)
         IF opt% = 5 THEN ? "   REPORT USING " + CHR$ (34) + "BV3" + CHR$ (34)
         ? "   REPORT ON Bewertungssumme.KVERTRAG AS " + CHR$ (34) + "BewSum%" + CHR$ (34) + ",subew% AS " + CHR$ (34) + "BeitrSum%" + CHR$ (34) + ",Bewertungssum$ AS " + CHR$ (34) + "anz%" + CHR$ (34)
         IF fstpa% = 1 THEN 
           ? "   BEFORE REPORT"
           ? "   SET REPORT PAGE " + CHR$ (34) + "H_REPORT" + CHR$ (34)
           ? "   OUTPUT REPORT PAGE"
           ? "   END REPORT"
         END IF 
         ? "   AFTER REPORT"
         ? "   SET REPORT PAGE " + CHR$ (34) + "F_REPORT" + CHR$ (34)
         ? "   OUTPUT REPORT PAGE"
         ? "   END REPORT"
       END IF 
       IF opt% = 4 THEN 
         REM ? "   REPORT USING " + CHR$ (34) + "BVBE3" + CHR$ (34)
         ? "  CALL PRep(" + CHR$ (34) + "BVBE3" + CHR$ (34) + ")"
         ? "   REPORT ON Bewertungssumme.KVERTRAG AS " + CHR$ (34) + "BewSum%" + CHR$ (34) + ",subew% AS " + CHR$ (34) + "BeitrSum%" + CHR$ (34) + ",Bewertungssum$ AS " + CHR$ (34) + "anz%" + CHR$ (34)
         ? "   AFTER REPORT"
         ? "   SET REPORT PAGE " + CHR$ (34) + "F_REPORT" + CHR$ (34)
         ? "   OUTPUT REPORT PAGE"
         ? "   END REPORT"
       END IF 
       IF von$ = "" THEN v$ = "01.01.1980" ELSE v$ = von$
       IF bis$ = "" THEN b$ = "31.12.2299" ELSE b$ = bis$
       IF von$ = "" AND bis$ <> "" THEN Header$ = "(bis " + bis$ + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = "(ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = "(vom " + von$ + " bis " + bis$ + ")"
       IF incexpInt$ = "j" THEN 
         Header$ = "öbersicht Inhouse-VertrÑge "
       ELSE 
         IF incSoll$ = "j" THEN 
           Header$ = "öbersicht der VertrÑge der SollstellungsÅberwachung "
         ELSE 
           IF von$ = "" AND bis$ = "" THEN Header$ = "(GesamtÅbersicht)"
         END IF 
       END IF 
       IF incPolice$ = "j" THEN Header$ = Header$ + " policierte VertrÑge/"
       IF incAntr$ = "j" AND incFremd$ = "j" AND incAltV$ <> "j" THEN Header$ = Header$ + " FremdvertrÑge/AntrÑge"
       IF incAntr$ = "j" AND incFremd$ <> "j" AND incAltV$ = "j" THEN Header$ = Header$ + " AntrÑge /AltvertrÑge"
       IF incAntr$ = "j" AND incFremd$ = "j" AND incAltV$ = "j" THEN Header$ = Header$ + " FremdvertrÑge /AntrÑge/AltvertrÑge"
       IF incAntr$ = "j" AND incFremd$ <> "j" AND incAltV$ <> "j" THEN Header$ = Header$ + " AntrÑge"
       IF incAntr$ <> "j" AND incFremd$ = "j" AND incAltV$ <> "j" THEN Header$ = Header$ + " FremdvertrÑge"
       IF incAntr$ <> "j" AND incFremd$ = "j" AND incAltV$ = "j" THEN Header$ = Header$ + " FremdvertrÑge /AltvertrÑge"
       IF incAntr$ <> "j" AND incFremd$ <> "j" AND incAltV$ = "j" THEN Header$ = Header$ + " AltvertrÑge"
       IF incStorno$ = "j" THEN Header$ = Header$ + "/Stornierte"
       IF vkunde$ <> "alle" AND opt% <> 6 THEN Header$ = header$ + "/" + vkunde$
       IF agentur$ <> "alle" THEN Header$ = header$ + "/" + agentur$
       IF agr$ <> "alle" THEN Header$ = header$ + "/" + agr$
       IF gesellschaft$ <> "alle" THEN Header$ = header$ + "/" + gesellschaft$
       IF geg$ <> "alle" THEN Header$ = header$ + "/" + geg$
       IF vsparte$ <> "alle" THEN Header$ = header$ + "/" + vsparte$
       IF vspgr$ <> "alle" THEN Header$ = header$ + "/" + vspgr$

       REM 191099/3
       IF CodeVStatus% > 0 THEN header$ = Header$ + "/" + "Vertr.status: " + vstatusu$
       IF opt% = 3 THEN 
         Header$ = header$ + " mit SRHaftung und ZE"
       END IF 
       IF opt% = 1 THEN 
         Header$ = header$ + " mit SRHaftung"
       END IF 
       ? "   Ueberschr$=" + CHR$ (34) + Header$ + CHR$ (34)
       ? "   HEADING"
       ? "   SET REPORT PAGE " + CHR$ (34) + "H_PAGE" + CHR$ (34)
       ? "   OUTPUT REPORT PAGE"
       ? "   END HEADING"

       ? "   FOOTING 1"
       ? "   SET REPORT PAGE " + CHR$ (34) + "F_PAGE" + CHR$ (34)
       ? "   OUTPUT REPORT PAGE"
       ? "   END FOOTING"

       ? "   fussma$=" + CHR$ (34) + fussma1$ + CHR$ (34)

       IF opt% = 3 THEN 
         ? "   GROUP lfdnr.KVERTRAG,Bewertung.ZEINGAN1 AS " + CHR$ (34) + "sumzah%" + CHR$ (34)
         ? "   BEFORE GROUP lfdnr.KVERTRAG"
         ? "   SET REPORT PAGE" + CHR$ (34) + "H_lfdnr.KVER002" + CHR$ (34)
         ? "   OUTPUT REPORT PAGE "
         ? "   END GROUP "
         ? "   AFTER GROUP lfdnr.KVERTRAG"
         ? "   SET REPORT PAGE" + CHR$ (34) + "F_lfdnr.KVER002" + CHR$ (34)
         ? "   OUTPUT REPORT PAGE "
         ? "   END GROUP "
       END IF 
       IF opt% = 6 THEN 
         ? " GROUP Nachname.ADRESSEN, subew% AS " + CHR$ (34) + "BeitrSumKU%" + CHR$ (34) + ",BewSum% AS " + CHR$ (34) + "anzku%" + CHR$ (34)"
         ? "BEFORE GROUP Nachname.ADRESSEN"
         ? "EJECT REPORT"
         ? "SET REPORT PAGE " + CHR$ (34) + "H_Nachname.A002" + CHR$ (34)
         ? "OUTPUT REPORT PAGE "
         ? "END GROUP "
         ? ""
         ? "AFTER GROUP Nachname.ADRESSEN"
         ? "SET REPORT PAGE " + CHR$ (34) + "F_Nachname.A002" + CHR$ (34)
         ? "OUTPUT REPORT PAGE "
         ? "END GROUP"
       END IF 
       ? "   AFTER SELECT"
       ? "   SET REPORT PAGE " + CHR$ (34) + "F_SELECT" + CHR$ (34)
       ? "   OUTPUT REPORT PAGE"
       ? "   END SELECT"
       ? "   SET QUERY ON"
       ? "   SET QUERY LOCK OFF"
       IF opt% = 6 THEN ? "SET FIRST PAGE HEADING OFF"
       ? "   MOUSE OFF"
       IF fstpa% = 1 THEN 
         ? "  SET FIRST PAGE HEADING OFF"
       END IF 
       ? "   ON ERROR GOTO ErrVREP"
       ? "   SELECT ;"
       ? "   WHERE "
       IF MNdisabled%("DATALOCK") THEN 
         ? "   (Sperre.GAdrDat$=0 OR Sperre.GAdrDat$=" + LTRIM$ ( STR$ (vcodema%,"999999")) + " AND ";
         ? "   Sperre.MAADR=0 OR Sperre.MAADR=" + LTRIM$ ( STR$ (vcodema%,"999999")) + " AND "
         ? "   CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND ";
         ? "   VTNext.KVERTRAG < 1 AND CodeGrSp.KVERTRAG = CodeGrSp.SPGRUPPE)"
       ELSE 
         ? "   (CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND ";
         ? "   VTNext.KVERTRAG < 1 AND CodeGrSp.KVERTRAG = CodeGrSp.SPGRUPPE)"
       END IF 
       REM ? "   CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND ";
       REM ? "   VTNext.KVERTRAG < 1 AND CodeGrSp.KVERTRAG = CodeGrSp.SPGRUPPE"
       filt$ = ""
       IF von$ <> "" THEN filt$ = filt$ + " AND VS_Beginn.KVERTRAG>=days(" + CHR$ (34) + v$ + CHR$ (34) + ")"
       IF bis$ <> "" THEN filt$ = filt$ + " AND VS_Beginn<=days(" + CHR$ (34) + b$ + CHR$ (34) + ")"
       IF ku% <> 0 THEN filt$ = filt$ + " AND CodeKU=" + LTRIM$ ( STR$ (ku%,"999999"))
       REM filt$ = filt$ + ")"
       IF GASP% THEN 
         Show1% = 0
         IF ma% <> 0 THEN 
           filt$ = filt$ + " AND CodeMA=" + LTRIM$ ( STR$ (ma%,"999999"))
           Show1% = - 1
         ELSE 
           IF Show1% <> - 1 THEN 
             IF selOff$ <> "<Alle BÅros>" THEN 
               zz% = 0
               FOR i% = 0 TO VisCount% - 1
                 IF VisNames$(i%) = selOff$ THEN 
                   Show1% = VisOff%(i%)
                   i% = VisCount%'und raus
                 END IF 
               NEXT i%
               sh$ = STR$ (Show1%,"99999")
               sh% = VAL (sh$)
               filt$ = filt$ + " AND Workstation.KVERTRAG=" + LTRIM$ ( STR$ (sh%,"99999999"))
             ELSE 
               zz% = 0
               gefunden% = 0
               IF workstation% = 0 THEN 
                 filt$ = filt$ + " AND (Workstation.KVERTRAG <> -1)"
               ELSE 
                 FOR i% = 0 TO VisCount% - 1
                   Show1% = VisOff%(i%)
                   gefunden% = Show1%
                   IF zz% = 0 THEN 
                     zz% = zz% + 1
                     REM filt$ = "(" + filt$ + ")"
                     filt$ = filt$ + " AND (Workstation.KVERTRAG=" + LTRIM$ ( STR$ (Show1%,"99999999"))
                   ELSE 
                     filt$ = filt$ + " OR Workstation.KVERTRAG=" + LTRIM$ ( STR$ (Show1%,"99999999"))
                   END IF 
                 NEXT i%
                 IF gefunden% > 0 THEN 
                   filt$ = filt$ + " AND WORKSTATION.KVERTRAG<>0)"
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
       ELSE 
         IF ma% <> 0 THEN 
           filt$ = filt$ + " AND CodeMA=" + LTRIM$ ( STR$ (ma%,"999999"))
         END IF 
       END IF 
       IF ge% <> 0 THEN filt$ = filt$ + " AND CodeGE=" + LTRIM$ ( STR$ (ge%,"999999"))
       
       IF geg$ <> "alle" THEN 
         REM gef$ = "GEGruppe.geadr"
         filt$ = filt$ + " AND GEGruppe.geadr like " + CHR$ (34) + geg$ + CHR$ (34)
       END IF 
       IF Agr$ <> "alle" THEN 
         REM gef$ = "GEGruppe.geadr"
         filt$ = filt$ + " AND MAGruppe.maadr like " + CHR$ (34) + Agr$ + CHR$ (34)
       END IF 
       IF spa% <> 0 THEN filt$ = filt$ + " AND CodeVA=" + LTRIM$ ( STR$ (spa%,"999999"))
       IF spgr% <> - 1 THEN filt$ = filt$ + " AND CodeGRSP=" + LTRIM$ ( STR$ (spgr%,"999999"))
 
       IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND (ProviAB <> 0 OR Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       REM 110799 
       IF incStorno$ = "n" THEN 
         REM 22052002 kÅn$ = "((KÅndigung > TODAY OR KÅndigung < 1) AND Storno < 1)"
         kÅn$ = "((TatsKuenDat > TODAY OR TatsKuenDat < 1) AND Storno < 1)"
       ELSE 
         REM 22052002 kÅn$ = " (Storno > 1 or (KÅndigung < TODAY AND KÅndigung > 1))"
         kÅn$ = " (Storno > 1 or (TatsKuenDat < TODAY AND TatsKuenDat > 1))"
       END IF 
       IF abruf$ = "j" THEN 
         filt$ = filt$ + "AND ABRUF.KVERTRAG = " + CHR$ (34) + "j" + CHR$ (34)
       END IF 
       IF incPolice$ = "j" AND incStorno$ = "j" THEN 
         kk$ = " OR CodeVstatus =4 OR CodeVstatus = 13  OR CodeVstatus > 20 OR Storno > 1"
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND (ProviAB <> 0 OR CodeVstatus =4 OR CodeVstatus = 13 OR CodeVstatus > 20 OR Storno > 1 OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND (ProviAB <> 0 OR CodeVstatus =4 OR CodeVstatus = 13  OR CodeVstatus > 20 OR Storno > 1)"
 
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + ") OR (CodeVstatus =4 OR CodeVstatus = 13  OR CodeVstatus > 20 OR Storno > 1)"
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + ")" + kk$
 
 
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + kk$
         IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " or proviab <>0 " + kk$ + ")"
         IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + kk$
       
       ELSE 
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND " + kÅn$ + " AND (ProviAB <> 0 OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND " + kÅn$ + " AND (ProviAB <> 0)"
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + ")"
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + ")"
 
         IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34)
         IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND " + kÅn$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " or proviab <>0 )"
         IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34)
       
         IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (ProviAB < 1 OR Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
         IF incPolice$ = "n" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (ProviAB < 1 OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
         IF incPolice$ = "n" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND " + kÅn$ + " AND Altvertrag = " + CHR$ (34) + "j" + CHR$ (34)
         IF incPolice$ = "n" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (ProviAB < 1)"
         IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND " + kÅn$ + " AND Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34)
         IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND " + kÅn$ + " AND (Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
         IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (ProviAB < 1 OR Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       END IF 
       REM 191099/4
       IF CodeVStatus% > 0 THEN 
         IF CodeVStatus% < 17 OR CodeVStatus% = 20 OR CodeVStatus% = 21 THEN 
           filt$ = filt$ + " AND CodeVstatus=" + LTRIM$ ( STR$ (CodevStatus%,"99"))
         ELSE 
           IF CodeVStatus% = 17 THEN 
             filt$ = filt$ + " AND CodeVstatus <> 04 AND CodeVstatus <> 13 AND CodeVstatus <> 10 AND CodeVstatus <> 11 AND CodeVstatus < 20"
           END IF 
           IF CodeVStatus% = 18 THEN 
             filt$ = filt$ + " AND CodeVstatus <> 04 AND CodeVstatus <> 13 AND CodeVstatus <> 10  AND CodeVstatus < 20"
           END IF 
         END IF 
       END IF 
       IF tarif% > 0 THEN filt$ = filt$ + " AND CodeTarif=" + LTRIM$ ( STR$ (tarif%,"999999"))
       IF VAL (WMon$) > 0 OR VAL (WJahr$) > 0 THEN 
         IF VAL (WMon$) > 0 THEN 
           filt$ = filt$ + " AND WMon=" + WMon$
         END IF 
         IF VAL (WJahr$) > 0 THEN 
           filt$ = filt$ + " AND WJahr=" + WJahr$
         END IF 
       END IF 
 
       IF incexpInt$ LIKE "j" THEN 
         filt$ = filt$ + " AND Inhaus=1"
       END IF 
 
       IF GSoll$ LIKE "j" THEN 
         IF incsoll$ = "j" THEN 
           filt$ = filt$ + " AND Sollst=" + CHR$ (34) + incSoll$ + CHR$ (34)
         END IF 
       END IF 
       REM 221299 
       IF opt% = 1 THEN 
         filt$ = filt$ + " and SRHaftung.kvertrag > 0"
       END IF 
       IF opt% = 2 THEN 
         REM filt$ = filt$ + " and lfdnr.KVERTRAG <> CodeVT.ZEINGAN1"
       END IF 
       IF opt% = 3 THEN 
         filt$ = filt$ + " and lfdnr.KVERTRAG = CodeVT.ZEINGAN1 and SRHaftung.kvertrag > 0"
       END IF 
       IF MNdisabled%("VERTRINHAUSSEE") THEN filt$ = filt$ + " and inhaus.kvertrag <> 1"
       IF filt$ = "" THEN filt$ = filt$ + " AND lfdnr > 0"
       ? filt$
       SELECT CASE so%
       CASE 1
         ord$ = "Kunde$,sparte.Sparten,Gesellschaft.GEADR"
       CASE 2
         ord$ = "Nachname.MAADR,sparte.Sparten,Gesellschaft.GEADR"
       CASE 3
         ord$ = "Gesellschaft.GEADR,sparte.Sparten"
       CASE 4
         ord$ = "sparte.Sparten,Nachname.maadr"
       CASE 5
         ord$ = "gruppe.spgruppe,sparte.Sparten,kunde$"
       END SELECT 
       IF opt% = 2 THEN 
         ord$ = "VS_Beginn.kvertrag,Gesellschaft.kvertrag,Sparte.kvertrag,VS_Nr.kvertrag"
       END IF 
       IF opt% = 3 THEN 
         ord$ = "VS_Beginn.kvertrag,Gesellschaft.kvertrag,Sparte.kvertrag,VS_Nr.kvertrag,BuchungsDatum.zeingan1"
       END IF 
       ? "   ORDER REPORT " + ord$
       ? "   TO ASK"
       ? "ErrVREP:"
       ? "   IF test% = 1 THEN ON ERROR ELSE ON ERROR GOTO ErrorHandler"
       ? "   MOUSE ON"
       ? " END SUB"
       CLOSE OUTPUT 
  
       REM CALL Fehler("VREPORT.SBP","2")
       FILE "KVERTRAG"
       LOAD "VREPORT.SBP", NEW 
       REM WAIT FOR 2
       CALL VReport()
       CLOSE PROGRAMFILE "VREPORT"
     ELSE 
       CALL Fehler("Datum (bis) im falschen Format!","Bitte geben Sie das Datum in der Form 'tt.mm.jj' ein.")
     END IF 
   ELSE 
     CALL Fehler("Datum (von) im falschen Format!","Bitte geben Sie das Datum in der Form 'tt.mm.jj' ein.")
   END IF 
 END IF 
end100120061: 
 MOUSE ON 
 DIRECTORY cdir$
 END SUB 
 
  
 
 
 ' VertrUniRep mit VPE======================================================================
 ' ku%   Kundennummer (CodeKU) oder 0 fÅr alle
 ' ma%   Agenturnummer (CodeMA) oder 0 fÅr alle
 ' spa%  Spartennummer (CodeVA) oder 0 fÅr alle
 ' ge%   Gesellschaftsnummer (CodeGE) oder 0 fÅr alle
 ' spgr% Spartengruppennummer (CodeGRSP) oder -1 fÅr alle
 ' so%   Sortierung: 1=Kunde, 2=Agentur, 3=Gesellschaft, 4=Sparte 5=Spartengruppe
 ' von%  Anfangsdatum oder 0 fÅr alle
 ' bis%  Enddatum oder 0 fÅr Open End
 ' bart% Berichtsart: 0=alle "normalen" VertrÑge
 '                    1=VertrÑge mit Bezug auf Ablaufdatum
 '                    2=VertrÑge ohne Abschlu·
 '                    3=FremdvertrÑge
 '                    4=FremdvertrÑge mit Bezug auf Ablaufdatum
 '                    5=AltvertrÑge
 ' dask% 0=ohne Abfrage ausfÅhren, 1=Optionen editierbar
 
SUB VVPEUniRep(ku%,ma%,spa%,ge%,so%,von%,bis%,bart%,dask%,spgr%)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 doit% = 1
 incAltV$ = "n"
 incFremd$ = "n"
 incAntr$ = "n"
 incPolice$ = "j"
 IF dask% = 1 THEN 
   IF so% = 0 THEN so% = 1
   ok% = - 1
   WHILE ok%
     IF ku% = 0 THEN 
       vKunde$ = "alle"
     ELSE 
       SELECT KEY ku% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       vkunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
     END IF 
     IF ma% = 0 THEN 
       Agentur$ = "alle"
     ELSE 
       SELECT KEY ma% FILE "MAADR" INDEX CodeMA.MAADR
       agentur$ = Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + "."
     END IF 
     IF spa% = 0 THEN 
       vSparte$ = "alle"
     ELSE 
       SELECT KEY spa% FILE "SPARTEN" INDEX CodeVA.SPARTEN
       vsparte$ = Sparte.SPARTEN
     END IF 
     IF spgr% = - 1 THEN 
       vSpGR$ = "alle"
     ELSE 
       SELECT KEY spgr% FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
       vspGr$ = Gruppe.SPGRUPPE
     END IF 
     IF ge% = 0 THEN 
       Gesellschaft$ = "alle"
     ELSE 
       SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
       Gesellschaft$ = Gesellschaft.GEADR
       REM ** Gesellschaft auswÑhlen
     END IF 
 
     SELECT CASE bart%'                                        ; öberschrift festlegen
     CASE 0
       st$ = "VertragsÅbersicht"
     CASE 1
       st$ = "Ablauf von VertrÑgen"
     CASE 2
       st$ = "VertrÑge ohne Abschlu·"
     CASE 3
       st$ = "FremdvertrÑge"
     CASE 4
       st$ = "Ablauf von FremdvertrÑgen"
     CASE 5
       st$ = "AltvertrÑge"
     END SELECT 
     REMOVE DIALOG ALL 
     CREATE DIALOG "BVERTRAG",0,0,442,300,"Auswahlschema","MS Sans Serif",8
     ADD DIALOG "BVERTRAG",4,5,6,240,77,0," Bedingung = Filter 1 "
     ADD DIALOG "BVERTRAG",5,8,19,34,9,0,"Kunde"
     ADD DIALOG "BVERTRAG",5,57,19,167,9,0,vKunde$
     ADD DIALOG "BVERTRAG",1,228,19,14,9,0,"...",2,1
     ADD DIALOG "BVERTRAG",5,8,30,28,10,0,"Agentur"
     ADD DIALOG "BVERTRAG",5,57,30,167,10,0,Agentur$
     ADD DIALOG "BVERTRAG",1,228,30,14,10,0,"...",3,1
     ADD DIALOG "BVERTRAG",5,8,41,42,10,0,"Gesellschaft"
     ADD DIALOG "BVERTRAG",5,57,41,167,10,0,Gesellschaft$
     ADD DIALOG "BVERTRAG",1,228,41,14,10,0,"...",4,1
     ADD DIALOG "BVERTRAG",5,8,52,24,10,0,"Sparte"
     ADD DIALOG "BVERTRAG",5,57,52,167,10,0,vSparte$
     ADD DIALOG "BVERTRAG",1,228,52,14,10,0,"...",5,1
     ADD DIALOG "BVERTRAG",5,8,64,49,9,0,"Spartengruppe"
     ADD DIALOG "BVERTRAG",5,57,64,167,9,0,vSpGr$
     ADD DIALOG "BVERTRAG",1,228,64,14,9,0,"...",6,1
     ADD DIALOG "BVERTRAG",4,246,6,195,77,0,"Bedingung <> Filter 2 "
     ADD DIALOG "BVERTRAG",5,250,19,28,9,0,"Kunde"
     ADD DIALOG "BVERTRAG",5,289,19,133,9,0,novKunde$
     ADD DIALOG "BVERTRAG",1,426,19,12,9,0,"...",20,1
     ADD DIALOG "BVERTRAG",5,250,30,32,10,0,"Agentur"
     ADD DIALOG "BVERTRAG",5,289,30,133,10,0,noAgentur$
     ADD DIALOG "BVERTRAG",1,426,30,12,10,0,"...",30,1
     ADD DIALOG "BVERTRAG",5,250,41,36,10,0,"Gesellsch."
     ADD DIALOG "BVERTRAG",5,289,41,133,10,0,noGesellschaft$
     ADD DIALOG "BVERTRAG",1,426,41,12,10,0,"...",40,1
     ADD DIALOG "BVERTRAG",5,250,52,35,10,0,"Sparte"
     ADD DIALOG "BVERTRAG",5,289,52,133,10,0,novSparte$
     ADD DIALOG "BVERTRAG",1,426,52,12,10,0,"...",50,1
     ADD DIALOG "BVERTRAG",5,250,64,36,9,0,"Spartengr"
     ADD DIALOG "BVERTRAG",5,289,64,133,9,0,novSpGr$
     ADD DIALOG "BVERTRAG",1,426,64,12,9,0,"...",60,1
     ADD DIALOG "BVERTRAG",4,5,88,163,75,0,"Zeitraum"
     ADD DIALOG "BVERTRAG",5,9,102,155,16,0,"Bitte wÑhlen Sie den Zeitraum aus, fÅr den Sie die VertragsÅbersicht wÅnschen."
     ADD DIALOG "BVERTRAG",5,9,124,155,16,0,"Sie kînnen die Datumsfelder auch freilassen, um alle VertrÑge anzeigen zu lassen."
     ADD DIALOG "BVERTRAG",6,28,145,41,11,0,0,von$,20
     ADD DIALOG "BVERTRAG",6,96,145,41,11,0,0,bis$,20
     ADD DIALOG "BVERTRAG",5,9,147,16,9,0,"von"
     ADD DIALOG "BVERTRAG",5,80,147,13,9,0,"bis"
     ADD DIALOG "BVERTRAG",4,170,88,75,75,0,"Sortierreihenfolge"
     ADD DIALOG "BVERTRAG",3,177,99,64,11,0,"Kunde",1,so%
     ADD DIALOG "BVERTRAG",3,177,112,64,11,0,"Agentur",2,so%
     ADD DIALOG "BVERTRAG",3,177,124,64,10,0,"Gesellschaft",3,so%
     ADD DIALOG "BVERTRAG",3,177,136,64,11,0,"Sparte",4,so%
     ADD DIALOG "BVERTRAG",3,177,148,64,12,0,"Spartengruppe",5,so%
     ADD DIALOG "BVERTRAG",4,246,88,195,163,0,"Bedingungen  fÅr VertÑge"
     ADD DIALOG "BVERTRAG",6,329,97,69,11,128,0,Tarif$,30
     ADD DIALOG "BVERTRAG",5,250,99,32,9,0,"Tarifinfo"
     ADD DIALOG "BVERTRAG",5,250,110,68,10,0,"Vertragssumme von:"
     ADD DIALOG "BVERTRAG",6,329,110,69,10,0,0,VSumVon%,12
     ADD DIALOG "BVERTRAG",5,250,121,68,10,0,"Vertragssumme bis:"
     ADD DIALOG "BVERTRAG",6,329,121,69,10,0,0,VSumBis%,12
     ADD DIALOG "BVERTRAG",5,250,132,76,10,0,"Bewertungssumme von:"
     ADD DIALOG "BVERTRAG",6,329,132,69,10,0,0,BewertVon%,12
     ADD DIALOG "BVERTRAG",5,250,144,76,9,0,"Bewertungssumme bis:"
     ADD DIALOG "BVERTRAG",6,329,144,69,9,0,0,BewertBis%,12
     ADD DIALOG "BVERTRAG",5,250,155,76,9,0,"Volumen von:"
     ADD DIALOG "BVERTRAG",6,329,155,69,9,0,0,VolVon%,12
     ADD DIALOG "BVERTRAG",5,250,166,76,8,0,"Volumen bis:"
     ADD DIALOG "BVERTRAG",6,329,166,69,10,0,0,VolBis%,12
     ADD DIALOG "BVERTRAG",5,250,177,76,10,0,"Beitrag von:"
     ADD DIALOG "BVERTRAG",6,329,177,69,10,0,0,BeitragVon%,12
     ADD DIALOG "BVERTRAG",5,250,188,76,9,0,"Beitrag bis:"
     ADD DIALOG "BVERTRAG",6,329,188,69,10,0,0,BeitragBis%,12
     ADD DIALOG "BVERTRAG",4,5,166,239,85,0,"Bedingungen Kunde"
     ADD DIALOG "BVERTRAG",5,8,177,54,10,0,"Einkommen von:"
     ADD DIALOG "BVERTRAG",6,61,177,69,10,0,0,EinkVon%,12
     ADD DIALOG "BVERTRAG",5,133,177,69,10,0,"Anzahl VertrÑge von:"
     ADD DIALOG "BVERTRAG",6,205,177,35,10,0,0,AnVerVon%,4
     ADD DIALOG "BVERTRAG",5,8,188,52,8,0,"Einkommen bis:"
     ADD DIALOG "BVERTRAG",6,61,188,69,10,0,0,EinkBis%,12
     ADD DIALOG "BVERTRAG",5,133,188,69,8,0,"Anzahl VertrÑge bis:"
     ADD DIALOG "BVERTRAG",6,205,188,35,10,0,0,AnzVertrBis%,4
     ADD DIALOG "BVERTRAG",5,8,198,48,10,0,"geboren von:"
     ADD DIALOG "BVERTRAG",6,61,199,69,11,0,0,gebVon$,10
     ADD DIALOG "BVERTRAG",5,8,209,44,11,0,"geboren bis:"
     ADD DIALOG "BVERTRAG",6,61,211,69,10,0,0,gebBis$,10
     ADD DIALOG "BVERTRAG",4,5,252,239,45,0,"Vertragsarten"
     ADD DIALOG "BVERTRAG",2,12,264,102,11,0,"FremdvertrÑge","j","n",incFremd$
     ADD DIALOG "BVERTRAG",2,119,264,115,11,0,"policierte VertrÑge","j","n",incPolice$
     ADD DIALOG "BVERTRAG",2,12,273,189,11,0,"AltvertrÑge","j","n",incAltV$
     ADD DIALOG "BVERTRAG",2,12,283,189,11,0,"AntrÑge","j","n",incAntr$
     ADD DIALOG "BVERTRAG",4,246,252,134,45,0,"Ausgabeziel"
     ADD DIALOG "BVERTRAG",3,249,265,59,11,0,"Auswahlliste",1,ziel%
     ADD DIALOG "BVERTRAG",3,310,265,64,11,0,"Export dBASE",3,ziel%
     ADD DIALOG "BVERTRAG",3,249,278,59,11,0,"Druckliste",2,ziel%
     ADD DIALOG "BVERTRAG",3,310,278,64,11,0,"Export MSEXCEL",4,ziel%
     ADD DIALOG "BVERTRAG",1,383,257,55,15,1,"&OK",1,1
     ADD DIALOG "BVERTRAG",1,383,275,55,14,0,"&Abbrechen",0,0
     DIALOG "BVERTRAG",dreq%
     SELECT CASE dreq%
     CASE 1
       doit% = 1
       ok% = 0
     CASE 2
       ku% = ADRSuche%(ku%)
     CASE 3
       ma% = GetCodeMA%(ma%,Workstation%)
     CASE 4
       ge% = GetCodeGE%(ge%)
     CASE 5
       spa% = GetCodeVA%(spa%)
     CASE 6
       spgr% = GetCodeGR%(spgr%)
     CASE 0
       ok% = 0
       doit% = 0
     END SELECT 
     REMOVE DIALOG "BVERTRAG"
   WEND 
 END IF 
 IF doit% = 1 THEN 
   IF dask% = 0 THEN 
     IF von% <> 0 THEN von$ = DAYS (von%) ELSE von$ = ""
     IF bis% <> 0 THEN bis$ = DAYS (bis%) ELSE bis$ = ""
   END IF 
   IF DateOK%(von$) THEN 
     IF DateOK%(bis$) THEN 
       cdir$ = DIRECTORY 
       DIRECTORY _ppath$
       FILE "KVERTRAG"
       REM Berechnung: REPORT ON Bewertungssumme.KVERTRAG AS " + CHR$ (34) + "BewSum%" + CHR$ (34) + ",ZW.KVERTRAG * Beitrag.KVERTRAG AS " + CHR$ (34) + "BeitrSum%" + CHR$ (34)
       REM Header erzeugen
       IF von$ = "" THEN v$ = "01.01.1980" ELSE v$ = von$
       IF bis$ = "" THEN b$ = "31.12.2099" ELSE b$ = bis$
       IF von$ = "" AND bis$ <> "" THEN Header$ = "(bis " + bis$ + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = "(ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = "(vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = "(GesamtÅbersicht)"
 
       REM Header fÅr die Art der zu druckenden VertrÑge
       IF incPolice$ = "j" THEN Header$ = Header$ + " policierte VertrÑge/"
       IF incAntr$ = "j" AND incFremd$ = "j" AND incAltV$ <> "j" THEN Header$ = Header$ + " FremdvertrÑge/AntrÑge"
       IF incAntr$ = "j" AND incFremd$ <> "j" AND incAltV$ = "j" THEN Header$ = Header$ + " AntrÑge /AltvertrÑge"
       IF incAntr$ = "j" AND incFremd$ = "j" AND incAltV$ = "j" THEN Header$ = Header$ + " FremdvertrÑge /AntrÑge/AltvertrÑge"
       IF incAntr$ = "j" AND incFremd$ <> "j" AND incAltV$ <> "j" THEN Header$ = Header$ + " AntrÑge"
       IF incAntr$ <> "j" AND incFremd$ = "j" AND incAltV$ <> "j" THEN Header$ = Header$ + " FremdvertrÑge"
       IF incAntr$ <> "j" AND incFremd$ = "j" AND incAltV$ = "j" THEN Header$ = Header$ + " FremdvertrÑge /AltvertrÑge"
       IF incAntr$ <> "j" AND incFremd$ <> "j" AND incAltV$ = "j" THEN Header$ = Header$ + " AltvertrÑge"
       IF vkunde$ <> "alle" THEN Header$ = header$ + "/" + vkunde$
       IF agentur$ <> "alle" THEN Header$ = header$ + "/" + agentur$
       IF gesellschaft$ <> "alle" THEN Header$ = header$ + "/" + gesellschaft$
       IF vsparte$ <> "alle" THEN Header$ = header$ + "/" + vsparte$
       IF vspgr$ <> "alle" THEN Header$ = header$ + "/" + vspgr$
 
       REM PrÅfung auf Zugriffsberechtigung
       REM IF MNdisabled%("DATALOCK") THEN 
         REM  Sperre.GAdrDat$=0 OR Sperre.GAdrDat$=" + LTRIM$ ( STR$ (vcodema%,"999999")) + " AND ";
         REM  Sperre.MAADR=0 OR Sperre.MAADR=" + LTRIM$ ( STR$ (vcodema%,"999999")) + " AND "
       REM END IF 
       REM Setzen Standardfilter fÅr relationale Beziehungen zw. Vertrag,Adr,Sparte, Gesel., Sp.grup
       REM CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeVA.KVERTRAG = CodeVA.SPARTEN AND CodeGE.KVERTRAG = CodeGE.GEADR AND CodeMA.KVERTRAG = CodeMA.MAADR AND"
       REM VTNext.KVERTRAG < 1 AND CodeGrSp.KVERTRAG = CodeGrSp.SPGRUPPE";
 
       REM Erzeugung Filter
       filt$ = "lfdnr<>0"
       IF von$ <> "" THEN filt$ = filt$ + " AND VS_Beginn.KVERTRAG>=days(" + CHR$ (34) + v$ + CHR$ (34) + ")"
       IF bis$ <> "" THEN filt$ = filt$ + " AND VS_Beginn<=days(" + CHR$ (34) + b$ + CHR$ (34) + ")"
       IF ku% <> 0 THEN filt$ = filt$ + " AND CodeKU=" + LTRIM$ ( STR$ (ku%,"999999"))
       IF ma% <> 0 THEN filt$ = filt$ + " AND CodeMA=" + LTRIM$ ( STR$ (ma%,"999999"))
       IF ge% <> 0 THEN filt$ = filt$ + " AND CodeGE=" + LTRIM$ ( STR$ (ge%,"999999"))
       IF spa% <> 0 THEN filt$ = filt$ + " AND CodeVA=" + LTRIM$ ( STR$ (spa%,"999999"))
       IF spgr% <> - 1 THEN filt$ = filt$ + " AND CodeGRSP=" + LTRIM$ ( STR$ (spgr%,"999999"))
 
       IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND (ProviAB <> 0 OR Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$
       IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND (ProviAB <> 0 OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND (ProviAB <> 0)"
       IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + ")"
       IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + ")"
 
       IF incPolice$ = "j" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34)
       IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " or proviab <> 0)"
       IF incPolice$ = "j" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34)
 
       IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND (ProviAB < 1 OR Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       IF incPolice$ = "n" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (ProviAB < 1 OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       IF incPolice$ = "n" AND incFremd$ = "n" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND Altvertrag = " + CHR$ (34) + "j" + CHR$ (34)
       IF incPolice$ = "n" AND incFremd$ = "n" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Fremdvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (ProviAB < 1)"
       IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "n" THEN filt$ = filt$ + " AND Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34)
       IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "j" AND incAntr$ = "n" THEN filt$ = filt$ + " AND (Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + " OR Altvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
       IF incPolice$ = "n" AND incFremd$ = "j" AND incAltV$ = "n" AND incAntr$ = "j" THEN filt$ = filt$ + " AND Altvertrag <> " + CHR$ (34) + "j" + CHR$ (34) + " AND (ProviAB < 1 OR Fremdvertrag = " + CHR$ (34) + "j" + CHR$ (34) + ")"
  
 
       REM ? filt$
 
       REM Erzeugung Sortierreihenfolge
       SELECT CASE so%
       CASE 1
         ord$ = "Kunde$,sparte.Sparten,Gesellschaft.GEADR"
       CASE 2
         ord$ = "Nachname.MAADR,sparte.Sparten,Gesellschaft.GEADR"
       CASE 3
         ord$ = "Gesellschaft.GEADR,sparte.Sparten"
       CASE 4
         ord$ = "sparte.Sparten,Nachname.maadr"
       CASE 5
         ord$ = "gruppe.spgruppe,sparte.Sparten,kunde$"
       END SELECT 
       REM ************************************
       REM * 251196 Aufruf der Ausgaberoutine *
       REM ************************************
        
     ELSE 
       CALL Fehler("Datum (bis) im falschen Format!","Bitte geben Sie das Datum in der Form 'tt.mm.jj' ein.")
     END IF 
   ELSE 
     CALL Fehler("Datum (von) im falschen Format!","Bitte geben Sie das Datum in der Form 'tt.mm.jj' ein.")
   END IF 
 END IF 
 MOUSE ON 
 END SUB 
 
 
 
 
 
 
 ' universeller Reportgenerator fÅr Konditionslisten
 ' ======================================================================
 ' ma%   Agenturnummer (CodeMA) oder 0 fÅr alle
 ' sp%   Spartennummer (CodeVA) oder 0 fÅr alle
 ' ge%   Gesellschaftsnummer (CodeGE) oder 0 fÅr alle
 ' so%   Sortierung: 1=Mitarbeiter, 2=Gesellschaft, 3=Sparte
 ' dask% 0=ohne Abfrage ausfÅhren, 1=Optionen editierbar
 
 
SUB GekondUniRep(ma%,ge%,sp%,so%,dask%)
 cfile$ = FILE 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 ok% = - 1
 IF dask% = 1 THEN 
   WHILE ok%
     IF ma% = 0 THEN 
       Agentur$ = "alle"
     ELSE 
       SELECT KEY ma% FILE "MAADR" INDEX CodeMA.MAADR
       Agentur$ = Nachname.MAADR + ", " + Vorname.MAADR
     END IF 
     IF ge% = 0 THEN 
       Gesellschaft$ = "alle"
     ELSE 
       SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
       Gesellschaft$ = Gesellschaft.GEADR
     END IF 
     IF sp% = 0 THEN 
       Sparte$ = "alle"
     ELSE 
       SELECT KEY sp% FILE "SPARTEN" INDEX CodeVA.SPARTEN
       Sparte$ = Sparte.SPARTEN
     END IF 
     IF so% = 0 THEN so% = 1
     opt% = so%
     CREATE DIALOG "BGEKOND",0,0,241,183,"Konditionsliste","MS Sans Serif",8
     ADD DIALOG "BGEKOND",4,0,0,241,160,0,""
     ADD DIALOG "BGEKOND",9,5,11,20,23,2
     ADD DIALOG "BGEKOND",5,36,12,198,36,0,"Um den Inhalt der Konditionsliste auf bestimmte Gesellschaften oder Sparten einzuschrÑnken, kînnen Sie vor dem Start die gewÅnschte Gesellschaft und Sparte jetzt auswÑhlen."
     ADD DIALOG "BGEKOND",4,36,49,200,47,0,""
     ADD DIALOG "BGEKOND",5,39,57,45,10,0,"&Agentur:"
     ADD DIALOG "BGEKOND",5,87,57,129,10,0,Agentur$
     ADD DIALOG "BGEKOND",1,220,57,13,10,0,"...",2,1
     ADD DIALOG "BGEKOND",5,39,69,45,10,0,"&Gesellschaft:"
     ADD DIALOG "BGEKOND",5,87,69,129,10,0,Gesellschaft$
     ADD DIALOG "BGEKOND",1,220,69,13,10,0,"...",3,1
     ADD DIALOG "BGEKOND",5,39,81,44,10,0,"&Sparte:"
     ADD DIALOG "BGEKOND",5,87,81,129,10,0,Sparte$
     ADD DIALOG "BGEKOND",1,220,81,13,10,0,"...",4,1
     ADD DIALOG "BGEKOND",4,36,95,200,57,0,""
     ADD DIALOG "BGEKOND",5,39,102,38,11,0,"Sor&tierung:"
     ADD DIALOG "BGEKOND",3,39,114,55,11,0,"Agentur",1,opt%
     ADD DIALOG "BGEKOND",3,39,126,55,11,0,"Gesellschaft",2,opt%
     ADD DIALOG "BGEKOND",3,39,138,55,11,0,"Sparte",3,opt%
     ADD DIALOG "BGEKOND",1,56,164,55,15,1,"OK",1,1
     ADD DIALOG "BGEKOND",1,113,164,55,15,0,"Abbrechen",0,0
     DIALOG "BGEKOND",req%
     REMOVE DIALOG "BGEKOND"
     SELECT CASE req%
     CASE 0
       ok% = 0
     CASE 1
       ok% = 2
     CASE 2
       ma% = GetCodeMA%(ma%,Workstation%)
     CASE 3
       ge% = GetCodeGE%(ge%)
     CASE 4
       sp% = GetCodeVA%(sp%)
     END SELECT 
   WEND 
 END IF 
 IF ok% <> 0 THEN 
   MOUSE OFF 
   filt$ = "CodeVA.GEKOND = CodeVA.SPARTEN AND CodeGE.GEKOND = CodeGE.GEADR AND CodeMA.GEKOND = CodeMA.MAADR"
   IF ma% <> 0 THEN filt$ = filt$ + " AND CodeMA.GEKOND=" + LTRIM$ ( STR$ (ma%,"999999"))
   IF ge% <> 0 THEN filt$ = filt$ + " AND CodeGE.GEKOND=" + LTRIM$ ( STR$ (ge%,"999999"))
   IF sp% <> 0 THEN filt$ = filt$ + " AND CodeVA.GEKOND=" + LTRIM$ ( STR$ (sp%,"999999"))
   SELECT CASE opt%
   CASE 1
     ord$ = "Agent$,Gesellschaft.GEADR,Sparte.SPARTEN"
   CASE 2
     ord$ = "Gesellschaft.GEADR,Sparte.SPARTEN,Agentur$"
   CASE 3
     ord$ = "Sparte.SPARTEN,Gesellschaft.GEADR,Agentur$"
   END SELECT 
   CALL PRep("BGEKOND")
   Ueberschr$ = "KonditionsÅbersicht"
 SELECT FIRST FILE "supervis" INDEX codema.supervis
 SELECT KEY GMACodeMA% FILE "supervis" INDEX codema.supervis
 fussma$ = "gedruckt durch: " + Name.supervis + " am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " um " + TIME$ ( NOW ,"hh:mm") + " Uhr"
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
   FOOTING 1
     SET REPORT PAGE "F_PAGE"
     OUTPUT REPORT PAGE 
   END FOOTING 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   ON ERROR GOTO ErrUniGEKOND
   EXECUTE "SELECT ; WHERE " + filt$ + " ORDER REPORT " + ord$ + " TO ASK"
ErrUniGEKOND: 
   IF test% = 1 THEN ON ERROR ELSE ON ERROR GOTO ErrorHandler 
 END IF 
 MOUSE ON 
 FILE cfile$
 SET STATUS "Bereit"
 END SUB 
 
 
 ' Umsetzung ZW.KVERTRAG in Klartext
 ' ======================================================================
  
FUNCTION ZW2Str$(zw%)
 REM 030697
 ZW2Str$ = IF (ZW% = 1,"jÑhrlich", IF (ZW% = 2,"halbjÑhrlich", IF (ZW% = 4,"vierteljÑhrlich", IF (ZW% = 6,"2monatlich", IF (ZW% = 12,"monatlich", IF (ZW% = 0,"einmalig", IF (ZW% = 55,"<keine Zuordnung>","FEHLER!")))))))
 END FUNCTION 
 
 
FUNCTION Zahlart2Str$(za%)
 Zahlart2Str$ = IF (ZA% = 1,"Bankeinzug", IF (ZA% = 2,"öberweisung", IF (ZA% = 3,"Dauerauftrag", IF (ZA% = 4,"Scheck","<keine Zuordnung>"))))
 END FUNCTION 
 
 
 ' Zusatzroutine fÅr PROSERVICE
 ' Kartenverwaltung im Vertragsformular (VERTRAG9.SBV)
 ' ======================================================================
 
SUB ADD1()
 Bewertungssumme.KVERTRAG = Kartenanzahl.KVERTRAG * Kartenwert.KVERTRAG
 IF Vertragssumme.KVERTRAG = 0 THEN Vertragssumme.KVERTRAG = Bewertungssumme.KVERTRAG
 IF Beitrag.KVERTRAG = 0 THEN Beitrag.KVERTRAG = Bewertungssumme.KVERTRAG
 IF VS_Nr.KVERTRAG = "" THEN VS_Nr.KVERTRAG = "K" + LTRIM$ ( STR$ (lfdnr.KVERTRAG,"000000"))
 FORM 
 END SUB 
 
 
 ' ======================================================================
 ' Zusatzprogramm fÅr Bossert & Tretow
 ' öbernahme aller VertrÑge in die Abrechnung
 ' ======================================================================
 ' 22.12.95 
 
SUB BOSSERT()
 IF disabled%("PROVISION") THEN END SUB 
 CREATE DIALOG "BOSSERT",0,0,238,128,title$,"MS Sans Serif",8
 ADD DIALOG "BOSSERT",9,5,5,20,22,2
 ADD DIALOG "BOSSERT",5,29,6,179,9,0,"öbernahme aller VertrÑge in die Provisionsabrechnung"
 ADD DIALOG "BOSSERT",4,29,16,203,5,0,""
 ADD DIALOG "BOSSERT",5,29,26,202,25,0,"Mit dieser Funktion werden alle noch nicht abgerechneten VertrÑge anhand der Standardkonditionen in die Provisionsabrechnung Åbernommen."
 ADD DIALOG "BOSSERT",5,29,52,200,31,0,"Fehler, die wÑhrend der öbernahme auftreten, werden in einer Protokolldatei gespeichert, die nach Abschlu· der öbernahme eingesehen und gedruckt werden kann."
 ADD DIALOG "BOSSERT",5,29,88,134,10,0,"Wollen Sie jetzt die öbernahme starten?"
 ADD DIALOG "BOSSERT",1,61,104,55,15,0,"&Ja",1,1
 ADD DIALOG "BOSSERT",1,117,104,55,15,1,"&Nein",0,0
 DIALOG "BOSSERT",req%
 REMOVE DIALOG "BOSSERT"
 IF req% <> 1 THEN END SUB 
 CALL CreateLog()
 CALL WriteLog("automatische öbernahme in Provisionierung " + DATE$ (cdate%,"0d.mm.yyyy"))
 CALL WriteLog("===================================================")
 CALL WriteLog("")
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vorgang" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 FILE "KVERTRAG"
 INDEX lfdnr.KVERTRAG
 SELECT FIRST LOCK 
 _pc% = 0
 _pmax% = RECCOUNT ("KVERTRAG")
 CALL Gauge(1,"öbernahme der VertrÑge lÑuft...")
 WHILE NOT EOF ("KVERTRAG")
   _pc% = _pc% + 1
   _proz% = 100 / _pmax% * _pc%
   IF _proz% > 100 THEN _proz% = 100
   IF _proz% < 2 THEN _proz% = 2
   CALL Gauge(_proz%,"")
   CALL Server("GaugeMessage","öbernahme der VertrÑge lÑuft... " + LTRIM$ ( STR$ (_pc%,"999999")) + " von " + LTRIM$ ( STR$ (_pmax%,"999999")))
   cuvt% = lfdnr.KVERTRAG
   REM ** Vertrag auf "Provisionierbarkeit" prÅfen **
   REM ** Stufe 1 / PrÅfung auf auszuschlie·ende VertrÑge
   ok% = 1
   IF Altvertrag.KVERTRAG LIKE "j" THEN ok% = 0
   IF Fremdvertrag.KVERTRAG LIKE "j" THEN ok% = 0
   REM ** Stufe 2 / PrÅfung auf fehlende Angaben **
   IF Bewertungssumme.KVERTRAG <= 0 THEN 
     ok% = 0
     CALL WriteLog("Bewertungssumme fehlt")
   END IF 
   IF Beitrag.KVERTRAG <= 0 THEN 
     ok% = 0
     CALL WriteLog("Beitrag fehlt")
   END IF 
   IF CodeGE.KVERTRAG = 0 THEN 
     ok% = 0
     CALL WriteLog("keine Gesellschaft ausgewÑhlt")
   END IF 
   SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
   IF CodeGE.KVERTRAG <> CodeGE.GEADR THEN 
     ok% = 0
     CALL WriteLog("die dem Vertrag zugeordnete Gesellschaft fehlt in der Gesellschaftsdatei")
   END IF 
   IF CodeMA.KVERTRAG = 0 THEN 
     ok% = 0
     CALL WriteLog("kein Mitarbeiter ausgewÑhlt")
   END IF 
   SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
   IF CodeMA.KVERTRAG <> CodeMA.MAADR THEN 
     ok% = 0
     CALL WriteLog("die dem Vertrag zugeordnete Agentur fehlt in der Agenturdatei")
   END IF 
   IF CodeVA.KVERTRAG = 0 THEN 
     ok% = 0
     CALL WriteLog("keine Sparte ausgewÑhlt")
   END IF 
   SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
   IF CodeVA.KVERTRAG <> CodeVA.SPARTEN THEN 
     ok% = 0
     CALL WriteLog("die dem Vertrag zugeordnete Sparte fehlt in der Spartendatei")
   END IF 
   IF DAYS (VS_Beginn.KVERTRAG) = 0 THEN 
     ok% = 0
     CALL WriteLog("es wurde kein Vertragsbeginn angegeben")
   END IF 
   IF ok% = 1 THEN 
     REM ** ProviAb$ automatisch generieren (aus Vertragsbeginn) ** 
     ProviAb$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     ZahlungJN$ = "n"
     bwbezug$ = ReadConfig$("PROVIS","Bewertungszeitraum")
     IF bwbezug$ LIKE "leer" OR bwbezug$ LIKE "Provisionierungsbeginn" THEN 
       BWStart$ = ProviAb$
     ELSE 
       BWStart$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     END IF 
     IF DateOK%(BWStart$) THEN 
       kond% = GetKond%(cuvt%, DAYS (BWStart$),0)
       IF kond% = 0 THEN 
         IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
         CALL WriteLog(fehlnach$)
         SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
         ProviAb.kvertrag = 0
         CodeKO.KVERTRAG = 0
         CALL FStore("KVERTRAG")
       ELSE 
         REM doprov% = EditKond%(kond%)
         doprov% = 1
         IF doprov% = 1 THEN 
           SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
           ProviAb.kvertrag = DAYS (ProviAb$)
           Check.KVERTRAG = "n"
           CodeKO.KVERTRAG = kond%
           REM kondition.KVERTRAG = SelKond%
           REM REQUEST "Vertrag wird ab sofort in die Provisionierung","mit einbezogen!",2
           CALL FStore("KVERTRAG")
         ELSE 
           SELECT KEY cuvt% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
           ProviAb.kvertrag = 0
           CodeKO.KVERTRAG = 0
           IF EXISTS (cuvt%,CodeVT.VKOND) THEN REMOVE FROM FILE "VKOND" WHERE CodeVT.VKOND = cuvt%
           REM kondition.KVERTRAG = SelKond%
           CALL FStore("KVERTRAG")
           REM CALL Fehler("Auswahl abgebrochen!","")
         END IF 
       END IF 
     ELSE 
       CALL WriteLog("Formatfehler bei Datumsangaben")
     END IF 
   END IF 
   IF ok% = 0 THEN 
     CALL AddLogInfo()
     CALL WriteLog("=========================================================")
   END IF 
   SELECT NEXT LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 WEND 
 CALL Gauge(0,"")
 CALL CloseLog()
 FILE cfile$
 MOUSE ON 
 END SUB 
 
 
 
SUB PROVISInfo()
 CALL About()
 END SUB 
 
 
SUB VertKondKorr()
 REM 020799
 inhaus% = 0
 IF disabled%("GENERATOR") THEN END SUB 
 GAppName$ = _netpath$ + "DOC\kvertrag.pdf"
 REM 070298
 VertKokor% = 1
 IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
   CALL DFile(3,"Buchung1" + _fpw$)
   SELECT WHERE FILE "Buchung1"
 ELSE 
   CALL DFile(3,"Buchung" + _fpw$)
   SELECT WHERE FILE "Buchung"
 END IF 
 CALL DFile(2,"OFFICE\adrstat" + _fpw$)
 SELECT WHERE FILE "adrstat"
 CALL DFile(2,"OFFICE\adrgrup" + _fpw$)
 SELECT WHERE FILE "adrgrup"
 CALL DFile(3,"GEGRUP" + _fpw$)
 CALL DFile(3,"Kgeadr" + _fpw$)
 CALL DFile(3,"statukey" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 SELECT WHERE FILE "Sparten"
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 SELECT WHERE FILE "geadr"
 CALL DFile(3,"tarif" + _fpw$)
 SELECT WHERE FILE "tarif"
 CALL DFile(3,"maadr" + _fpw$)
 SELECT WHERE FILE "maadr"
 CALL DFile(3,"maadrgru" + _fpw$)
 SELECT WHERE FILE "maadrgru"
 CALL DFile(3,"kvertrag" + _fpw$)
 SELECT WHERE FILE "kvertrag"
 CALL DFile(3,"vprodukt" + _fpw$)
 SELECT WHERE FILE "vprodukt"
 CALL DFile(3,"tarif" + _fpw$)
 SELECT WHERE FILE "tarif"
 CALL DFile(3,"vorgang" + _fpw$)
 SELECT WHERE FILE "vorgang"
 CALL DFile(3,"vkond" + _fpw$)
 SELECT WHERE FILE "vkond"
 CALL DFile(3,"formular" + _fpw$)
 SELECT WHERE FILE "formular"
 CALL DFile(3,"spgruppe" + _fpw$)
 SELECT WHERE FILE "spgruppe"
 
 CALL DFile(3,"KVEXEXP" + _fpw$)
 CALL DFile(3,"STATUKEY" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
   CALL DFile(3,"AFSKSUT" + _fpw$)
 END IF 
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 SELECT WHERE FILE GAdrDat$
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 SELECT WHERE FILE GAkquiDat$
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 SELECT WHERE FILE "aktionen"
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 SELECT WHERE FILE GTelDat$
 CALL DFile(2,"OFFICE\" + GDokDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GConDat$ + _fpw$)
 CALL DFile(2,"OFFICE\banken" + _fpw$)
 CALL DFile(2,"OFFICE\tvorlage" + _fpw$)
 CALL DFile(3,"GEGRUP" + _fpw$)
 FILE "ADRESSEN"
 INDEX codeku.adressen
 FILE "kvertrag"
 INDEX Codeku.kvertrag
 REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000,1)
     REDIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"),1)
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
 
   DIM Waehrung$(25,1)
   REDIM Waehrung$(25)
   REM FOR i% = 1 TO 20
     REM Waehrung$(i%) = ""
   REM NEXT i%
   DirektVSKZ$ = ""
   a% = 0
   Waehrung$(0) = "Filter deaktiviert"
   Waehrung$(1) = "alle nicht stornierten,nicht Fremdvertr.,nicht Altvertr." + SPACE$ (90) + "17"
   Waehrung$(2) = "alle nicht stornierten,alle Fremdvertr.,nicht Altvertr." + SPACE$ (90) + "18"
   Waehrung$(3) = "lebend" + SPACE$ (90) + "01"
   Waehrung$(4) = "leben/kurzfristig/unterjÑhrig" + SPACE$ (90) + "02"
   Waehrung$(5) = "ruhend/Anwartschaft" + SPACE$ (90) + "03"
   Waehrung$(6) = "storniert" + SPACE$ (90) + "04"
   Waehrung$(7) = "ruhend/beitragsfrei" + SPACE$ (90) + "05"
   Waehrung$(8) = "beitragsfrei" + SPACE$ (90) + "06"
   Waehrung$(9) = "beitragsfrei durch Leistung" + SPACE$ (90) + "07"
   Waehrung$(10) = "Beitragsstundung" + SPACE$ (90) + "08"
   Waehrung$(11) = "Sonstiges" + SPACE$ (90) + "09"
   Waehrung$(12) = "Altvertrag" + SPACE$ (90) + "10"
   Waehrung$(13) = "Fremdvertrag" + SPACE$ (90) + "11"
   Waehrung$(14) = "Antrag" + SPACE$ (90) + "12"
   Waehrung$(15) = "storniert durch Dynamisierung" + SPACE$ (90) + "13"
   Waehrung$(16) = "Bestandteil eines BÅndelungsvertrages" + SPACE$ (90) + "14"
   Waehrung$(17) = "Antragswiderruf" + SPACE$ (90) + "15"
   Waehrung$(18) = "Policenwiderspruch" + SPACE$ (90) + "16"
   Waehrung$(19) = "Antragsablehnung" + SPACE$ (90) + "20"
   Waehrung$(20) = "KÅnd.wg.Nichtzahlung" + SPACE$ (90) + "21"
   DIM Auswahl1$(1)
   REM Auswahl1$(0) = "Filter deaktiviert"
   Auswahl4$ = "Filter deaktiviert"

   DIM intstu1$( RECCOUNT ("statukey") + 1)
   FILE "statukey"
   INDEX statuskey.statukey
   SELECT FIRST 
   intstu1$(0) = "<kein Filter>"
   i% = 0
   WHILE NOT EOF ("statukey")
     i% = i% + 1
     intstu1$(i%) = STR$ (statuskey.statukey,"00") + " - " + keyword.statukey
     SELECT NEXT FILE "statukey"
   WEND 
   selIntVStatus$ = "<kein Filter>"
 DIM Auswahl$(1)
 SELECT WHERE FILE "KVERTRAG"
 SELECT FIRST 
 IF GASP% THEN 
     DIM office$(VisCount%)'eins mehr fÅr <Alle BÅros>
     FOR i% = 0 TO VisCount% - 1
       office$(i%) = VisNames$(i%)
     NEXT i%
     IF Workstation% > 0 THEN 
       office$(VisCount%) = "<Alle BÅros>"
       selOff$ = office$(VisCount% - 1)'sis
     ELSE 
       office$(VisCount%) = "<Alle BÅros>"
       selOff$ = office$(VisCount%)'sis 
     END IF 
     ShowOther% = - 1
     IF ShowOther% <> - 1 THEN 
        FOR i% = 0 TO VisCount% - 1
            IF VisOff%(i%) = ShowOther% THEN 
                selOff$ = VisNames$(i%)
                i% = VisCount%
            END IF 
        NEXT i%
     END IF 
 END IF 
VertKond140697anf: 
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     REDIM Vertraege$(20000,1)
     REDIM Vertraege$(20000)
   ELSE 
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"),1)
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
 a% = 0
 ok% = - 1
 SELECT WHERE FILE "KVERTRAG"
 SELECT FIRST 
 WHILE ok%
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     REDIM Vertraege$(20000,1)
     REDIM Vertraege$(20000)
   ELSE 
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"),1)
     REDIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
   provab% = 0
   IF ku% = 0 THEN 
     vKunde$ = "alle"
   ELSE 
     SELECT FIRST FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     SELECT KEY ku% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     vkunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
   END IF 



 


   IF ma1% = 0 THEN 
     Agentur1$ = ""
   ELSE 
     SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
     SELECT KEY ma1% FILE "MAADR" INDEX CodeMA.MAADR
     agentur1$ = Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + "."
   END IF 
   IF ma% = 0 THEN 
     Agentur$ = "alle"
   ELSE 
     SELECT FIRST FILE "MAADR" INDEX CodeMA.MAADR
     SELECT KEY ma% FILE "MAADR" INDEX CodeMA.MAADR
     agentur$ = Nachname.MAADR + ", " + LEFT$ (Vorname.MAADR,1) + "."
   END IF 
   IF spa% = 0 THEN 
     vSparte$ = "alle"
   ELSE 
     SELECT FIRST FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY spa% FILE "SPARTEN" INDEX CodeVA.SPARTEN
     vsparte$ = Sparte.SPARTEN
   END IF 
   IF spgr% < 1 THEN 
     vSpGR$ = "alle"
   ELSE 
     SELECT FIRST FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
     SELECT KEY spgr% FILE "SPGRUPPE" INDEX Codegrsp.SPGRUPPE
     vspGr$ = Gruppe.SPGRUPPE
   END IF 
   IF ge% = 0 THEN 
     Gesellschaft$ = "alle"
   ELSE 
     SELECT FIRST FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY ge% FILE "GEADR" INDEX CodeGE.GEADR
     Gesellschaft$ = Gesellschaft.GEADR
     REM ** Gesellschaft auswÑhlen
   END IF 
 
   IF eingueber% = 0 THEN 
     eingueber$ = "alle"
   ELSE 
     SELECT FIRST FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY eingueber% FILE "GEADR" INDEX CodeGE.GEADR
     eingueber$ = Gesellschaft.GEADR
     REM ** Gesellschaft auswÑhlen
   END IF 



   IF cvp% = 0 THEN 
     vprodukt$ = "alle"
   ELSE 
     SELECT KEY cvp% FILE "Vprodukt" INDEX codevp.vprodukt
     vprodukt$ = gesellschaft.vprodukt + "/" + sparte.vprodukt
   END IF 
   IF ctar% = 0 THEN 
     vTarif$ = "alle"
   ELSE 
     SELECT KEY ctar% FILE "Tarif" INDEX codetarif.tarif
     vtarif$ = Tarif.Tarif
   END IF 
   IF vADRGRUP$ = "" OR vADRGRUP$ = "alle" THEN 
     vADRGRUP$ = "alle"
   END IF 
   IF magr$ = "" OR magr$ = "alle" THEN 
     magr$ = "alle"
   ELSE 
     SELECT KEY magr$ FILE "maadrgru" INDEX magruppe.maadrgru
     maGr$ = magruppe.maadrgru
   END IF 
   IF vGesGRUP$ = "" OR vGesGRUP$ = "alle" THEN 
     vGesGRUP$ = "alle"
   END IF 
 
   bart% = 0
   st$ = "VertragsÅbersicht"
   
   REMOVE DIALOG ALL 
   so% = 1
   so1% = 1
   inc% = 1
   REM 191099/5
   
     CREATE DIALOG "BVERTRAG",0,0,446,405,title$ + " - " + st$,"MS Sans Serif",8
     ADD DIALOG "BVERTRAG",4,5,6,431,88,0,"Filter"

     ADD DIALOG "BVERTRAG",5,250,15,43,22,0,"Adr.Gruppe"
     ADD DIALOG "BVERTRAG",5,290,15,100,10,0,vADRGRUP$
     ADD DIALOG "BVERTRAG",1,411,15,14,10,0,"...",11,1
 
     ADD DIALOG "BVERTRAG",5,250,26,43,22,0,"Produkt"
     ADD DIALOG "BVERTRAG",5,290,26,100,10,0,vProdukt$
     ADD DIALOG "BVERTRAG",1,411,26,14,10,0,"...",9,1
 
     ADD DIALOG "BVERTRAG",5,250,37,24,10,0,"Tarif"
     ADD DIALOG "BVERTRAG",5,290,37,150,10,0,vTarif$
     ADD DIALOG "BVERTRAG",1,411,37,14,10,0,"...",10,1
 
 
     ADD DIALOG "BVERTRAG",5,250,48,43,22,0,"Ges.Gruppe"
     ADD DIALOG "BVERTRAG",5,290,48,120,10,0,vGesGRUP$
     ADD DIALOG "BVERTRAG",1,411,48,14,10,0,"...",12,1

     IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",1,238,63,193,14,1,"VertrÑge, die nicht an die Abrechnung Åbergeben wurden",28,1
     IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",1,238,78,193,14,1,"abgerechnete VertrÑge ohne BuchungssÑtze",29,1



     ADD DIALOG "BVERTRAG",5,8,15,34,9,0,"Kunde"
     ADD DIALOG "BVERTRAG",5,57,15,167,9,0,vKunde$
     ADD DIALOG "BVERTRAG",1,218,15,14,9,0,"...",2,1


     ADD DIALOG "BVERTRAG",5,8,26,43,10,0,"Vermittler"
     ADD DIALOG "BVERTRAG",5,57,26,167,10,0,Agentur$
     ADD DIALOG "BVERTRAG",1,218,26,14,10,0,"...",3,1

     ADD DIALOG "BVERTRAG",5,8,37,49,9,0,"Verm.Gruppe"
     ADD DIALOG "BVERTRAG",5,57,37,167,9,0,magr$
     ADD DIALOG "BVERTRAG",1,218,37,14,9,0,"...",7,1

     ADD DIALOG "BVERTRAG",5,8,48,43,10,0,"Gesellschaft"
     ADD DIALOG "BVERTRAG",5,57,48,167,10,0,Gesellschaft$
     ADD DIALOG "BVERTRAG",1,218,48,14,10,0,"...",4,1

     IF MNdisabled%("SEEEINGBEI") THEN 
     ELSE 
       ADD DIALOG "BVERTRAG",5,8,59,43,10,0,"einger.Åber"
       ADD DIALOG "BVERTRAG",5,57,59,167,10,0,eingueber$
       ADD DIALOG "BVERTRAG",1,218,59,14,10,0,"...",33,1
     END IF 
 
 
     ADD DIALOG "BVERTRAG",5,8,70,24,10,0,"Sparte"
     ADD DIALOG "BVERTRAG",5,57,70,167,10,0,vSparte$
     ADD DIALOG "BVERTRAG",1,218,70,14,10,0,"...",5,1

     ADD DIALOG "BVERTRAG",5,8,81,49,9,0,"Spartengruppe"
     ADD DIALOG "BVERTRAG",5,57,81,167,9,0,vSpGr$
     ADD DIALOG "BVERTRAG",1,218,81,14,9,0,"...",6,1

     REM ADD DIALOG "BVERTRAG",5,8,81,49,9,0,"Verm.Gruppe"
     REM ADD DIALOG "BVERTRAG",5,57,81,167,9,0,magr$
     REM ADD DIALOG "BVERTRAG",1,218,81,14,9,0,"...",7,1

     ADD DIALOG "BVERTRAG",4,5,96,164,135,0,"Zeitraum"
     ADD DIALOG "BVERTRAG",5,9,104,155,16,0,"Bitte wÑhlen Sie den Zeitraum aus, fÅr den Sie die VertragsÅbersicht wÅnschen."
     ADD DIALOG "BVERTRAG",5,9,125,155,16,0,"Vertragsbeginn / Antragsdatum / Provision ab / Erfassung am / Policedatum"
     ADD DIALOG "BVERTRAG",5,9,170,155,16,0,"Vertragsablaufdatum"
     ADD DIALOG "BVERTRAG",6,28,146,41,11,0,0,von$,20
     ADD DIALOG "BVERTRAG",6,86,146,41,11,0,0,bis$,20
     ADD DIALOG "BVERTRAG",6,153,146,11,11,0,0,dauer$,2
     ADD DIALOG "BVERTRAG",6,28,186,41,11,0,0,ablvon$,20
     ADD DIALOG "BVERTRAG",6,86,186,41,11,0,0,ablbis$,20
     ADD DIALOG "BVERTRAG",5,9,147,16,10,0,"von"
     ADD DIALOG "BVERTRAG",5,71,147,13,10,0,"bis"
     ADD DIALOG "BVERTRAG",5,9,187,16,10,0,"von"
     ADD DIALOG "BVERTRAG",5,71,187,13,10,0,"bis"
     ADD DIALOG "BVERTRAG",5,131,147,20,10,0,"Dauer"

     ADD DIALOG "BVERTRAG",4,170,96,75,64,0,"Art des Datums"
     ADD DIALOG "BVERTRAG",3,177,106,64,11,0,"Vertragsdatum",1,so%
     ADD DIALOG "BVERTRAG",3,177,117,64,11,0,"Antragsdatum",2,so%
     IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",3,177,128,64,11,0,"Provision ab",3,so%
     ADD DIALOG "BVERTRAG",3,177,139,64,11,0,"Erfassungsdatum",4,so%
     ADD DIALOG "BVERTRAG",3,177,150,64,11,0,"Policedatum",5,so%
     IF GASP% THEN 
          ADD DIALOG "BVERTRAG",5,250,87,130,10,0,"BÅro"
          ADD DIALOG "BVERTRAG",8,250,97,144,245,259,2,selOff$,office$
     END IF 
     IF GASP% THEN 
       REM "Negativ-Agentur"
       ADD DIALOG "BVERTRAG",5,250,117,100,10,0,"Negativ-Agentur"
       REM ADD DIALOG "BVERTRAG",8,250,97,144,245,259,2,selOff$,office$
       ADD DIALOG "BVERTRAG",5,320,117,167,10,0,Agentur1$
       ADD DIALOG "BVERTRAG",1,380,115,14,10,0,"...",31,1
     ELSE 
       REM "Negativ-Agentur"
       ADD DIALOG "BVERTRAG",5,250,125,100,10,0,"Negativ-Agentur"
       REM ADD DIALOG "BVERTRAG",8,250,97,144,245,259,2,selOff$,office$
       ADD DIALOG "BVERTRAG",5,320,125,167,10,0,Agentur1$
       ADD DIALOG "BVERTRAG",1,380,123,14,10,0,"...",31,1
     END IF 
     IF GLundWrigg$ = "TRUE" THEN 
       ADD DIALOG "BVERTRAG",2,260,97,74,11,0,"Abruf Lund-Wriggers ","j","n",abruf$
     END IF 
     IF GASP% OR GLundWrigg$ = "TRUE" THEN 
     ELSE 
       ADD DIALOG "BVERTRAG",5,250,111,130,10,0,"Vertrags-Agenturnr.:"
       ADD DIALOG "BVERTRAG",6,320,111,71,11,0,0,GDVAgentNR$,20
     END IF 
     ADD DIALOG "BVERTRAG",4,170,162,75,69,0,"Sortierreihenfolge"
     ADD DIALOG "BVERTRAG",3,177,173,64,11,0,"Gesellschaft",1,so1%
     ADD DIALOG "BVERTRAG",3,177,184,64,11,0,"Sparte",2,so1%
     ADD DIALOG "BVERTRAG",3,177,195,75,11,0,"Vermittler",3,so1%
     ADD DIALOG "BVERTRAG",3,177,206,64,11,0,"Gesell+Sparte",4,so1%
     ADD DIALOG "BVERTRAG",3,177,217,64,11,0,"Kunde",5,so1%
 
     ADD DIALOG "BVERTRAG",4,5,285,240,75,0,"Optionen"
     ADD DIALOG "BVERTRAG",4,5,230,240,55,0,"Suche Åber Vetragsnr/KFZ-Kennzeichen/KFZ-Typ"
     ADD DIALOG "BVERTRAG",3,10,240,64,11,0,"nichts auswÑhlen",0,akver1%
     ADD DIALOG "BVERTRAG",3,10,250,64,11,0,"Vertragsnummer",1,akver1%
     ADD DIALOG "BVERTRAG",3,10,260,67,11,0,"KFZ-Kennzeichen",2,akver1%
     ADD DIALOG "BVERTRAG",3,10,270,64,11,0,"KFZ-Typ",3,akver1%
     ADD DIALOG "BVERTRAG",5,100,260,64,10,0,"&Suchbegriff:"
     ADD DIALOG "BVERTRAG",6,100,270,71,11,0,0,eingabe$,20
 
     REM ADD DIALOG "BVERTRAG",2,10,295,74,11,0,"Polic.akt.Vertr.","j","n",incP$
     REM ADD DIALOG "BVERTRAG",2,10,305,64,11,0,"AntrÑge","j","n",incA$
     REM ADD DIALOG "BVERTRAG",2,10,315,64,11,0,"FremdvertrÑge","j","n",incF$
     REM ADD DIALOG "BVERTRAG",2,10,325,74,11,0,"stornierte VertrÑge""j","n",incS$
     REM ADD DIALOG "BVERTRAG",2,94,295,64,11,0,"AltvertrÑge","j","n",incT$
     
 
     IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",2,10,295,70,11,0,"Dynamisierung","j","n",incDyn$
     ADD DIALOG "BVERTRAG",2,10,305,150,11,0,"nicht erledigte Nachbearbeitungstermine","j","n",incNachbearb$
     IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",2,10,315,150,11,0,"VertrÑge ohne eingetragenen Mitarbeiter","j","n",incMA$
     ADD DIALOG "BVERTRAG",2,10,325,65,11,0,"Stornowarnung","j","n",incSW$
     ADD DIALOG "BVERTRAG",2,77,325,74,11,0,"Stor.Datum einbez.","j","n",incStoWaDat$
     ADD DIALOG "BVERTRAG",2,10,335,84,11,0,"Provisionssperre J/N","j","n",incProvSperr$
     ADD DIALOG "BVERTRAG",2,130,335,112,11,0,"kein Vertragsberatungsprotokoll","j","n",incBrProtok$
     IF NOT MNdisabled%("VERTRINHAUSSEE") THEN 
       REM ADD DIALOG "BVERTRAG",2,10,345,84,11,0,"Inhouse-Vertrag J/N","j","n",Inhaus$
       ADD DIALOG "BVERTRAG",4,5,360,280,25,0,"Optionen zur Anzeige von Inhouse-VertrÑgen"
       ADD DIALOG "BVERTRAG",3,10,370,64,11,0,"nicht anzeigen",0,inhaus%
       ADD DIALOG "BVERTRAG",3,77,370,64,11,0,"auch anzeigen",1,inhaus%
       ADD DIALOG "BVERTRAG",3,143,370,124,11,0,"nur Inhouse-VertrÑge anzeigen",2,inhaus%
     END IF 

     ADD DIALOG "BVERTRAG",2,160,295,64,11,0,"ZW einmalig","j","n",incZWeinm$
     ADD DIALOG "BVERTRAG",2,160,305,64,11,0,"ZW ratierlich","j","n",incZWratierl$

     REM 21102006 Direktversicherung
     ADD DIALOG "BVERTRAG",4,160,315,80,20,0,"Direktversicherung"
     ADD DIALOG "BVERTRAG",3,161,323,20,10,0,"ja","j",DirektVSKZ$
     ADD DIALOG "BVERTRAG",3,182,323,25,10,0,"nein","n",DirektVSKZ$
     ADD DIALOG "BVERTRAG",3,210,323,25,10,0,"egal","",DirektVSKZ$


     REM ADD DIALOG "BVERTRAG",2,160,315,70,11,0,"Maklerauftrag J/N","j","n",incMaklauf$

     REM ADD DIALOG "BVERTRAG",2,247,157,70,11,0,"Summenliste","j","n",incSum$
 
     ADD DIALOG "BVERTRAG",5,250,156,130,10,0,"Wiedervorlage Monat"
     ADD DIALOG "BVERTRAG",6,323,155,13,11,0,0,WMon$,2
     ADD DIALOG "BVERTRAG",5,343,156,18,10,0,"Jahr"
     ADD DIALOG "BVERTRAG",6,363,155,22,11,0,0,WJahr$,4
     IF GSoll$ LIKE "j" THEN 
       IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",2,250,135,150,11,0,"VertrÑge in SollstellungsÅberwachung","j","n",incSoll$
     END IF 
     REM IF workstation% = 0 THEN ADD DIALOG "BVERTRAG",2,250,145,150,11,0,"Inhouse-Vertrag","j","n",incexpInt$
 
     ADD DIALOG "BVERTRAG",4,247,172,197,35,0,"Optionen zum Vertragsstatus"
     REM ADD DIALOG "BVERTRAG",7,250,186,190,145,0,2,Waehrung$,Auswahl1$,"Filter deaktiviert"
     ADD DIALOG "BVERTRAG",8,250,186,190,145,3,2,Auswahl4$,Waehrung$
     

     ADD DIALOG "BVERTRAG",4,247,210,197,35,0,"Optionen zum internen Vertragsstatus"
     ADD DIALOG "BVERTRAG",8,250,224,190,145,3,2,selIntVStatus$,intstu1$

     ADD DIALOG "BVERTRAG",4,247,250,197,110,0,"Optionen der Kundenadressen"
     ADD DIALOG "BVERTRAG",2,250,260,70,11,0,"Maklerauftrag J/N","j","n",incMaklauf$
     ADD DIALOG "BVERTRAG",2,250,270,70,11,0,"Vollmacht J/N","j","n",incVollm$
     ADD DIALOG "BVERTRAG",2,250,280,80,11,0,"Generalvollmacht J/N","j","n",incGVollm$
     ADD DIALOG "BVERTRAG",2,250,290,70,11,0,"KV Pflicht J/N","j","n",incKVPfl$
     ADD DIALOG "BVERTRAG",2,250,300,70,11,0,"RV Pflicht J/N","j","n",incRVPfl$
     ADD DIALOG "BVERTRAG",2,250,310,115,11,0,"kein Beratungsprotokoll-Adresse","j","n",incKBProt$
     IF FORM LIKE "STAMM" THEN 
       ADD DIALOG "BVERTRAG",4,247,323,197,26,0,"MassenÑnderung"
       incMasse$ = "j"
       ADD DIALOG "BVERTRAG",2,250,333,180,11,0,"VertrÑge zur MassenÑnderung vorbereiten","j","n",incMasse$
     END IF 
     REM ADD DIALOG "BVERTRAG",1,222,329,110,14,1,"&Kunden-Adressen ausgeben",30,1
     ADD DIALOG "BVERTRAG",1,46,389,55,14,1,"&OK",1,1
     ADD DIALOG "BVERTRAG",1,218,389,55,14,0,"Negativsuche",32,1
     ADD DIALOG "BVERTRAG",1,104,389,55,14,0,"&Abbrechen",0,0
     ADD DIALOG "BVERTRAG",1,162,389,55,14,0,"&Statistik",8,1
   REM if incp$<>"j" and inca$<>"j" and incf$<>"j" and incs$<>"j" and incT$<>"j" and incNachbearb$<>"j" and incMA$<>"j" and incDyn$<>"j" and incZWeinm$<>"j" and incZWratierl<>"j" then  
   DIALOG "BVERTRAG",dreq%
   REMOVE DIALOG ALL 
   negativsu% = 0
   IF dauer$ <> "" THEN 
     dauer% = VAL (dauer$)
   ELSE 
     dauer% = 0
   END IF 
   IF von$ = "" THEN 
     vongen$ = "1.1.0001"
     vongen% = DAYS (vongen$)
   ELSE 
     vongen$ = von$
     vongen% = DAYS (vongen$)
   END IF 
   IF bis$ = "" THEN 
     bisgen$ = "31.12.5000"
     bisgen% = DAYS (bisgen$)
   ELSE 
     bisgen$ = bis$
     bisgen% = DAYS (bisgen$)
   END IF 
   IF ablvon$ = "" THEN 
     ablvongen$ = "1.1.0001"
     ablvongen% = DAYS (ablvongen$)
   ELSE 
     ablvongen$ = ablvon$
     ablvongen% = DAYS (ablvongen$)
   END IF 
   IF ablbis$ = "" THEN 
     ablbisgen$ = "31.12.5000"
     ablbisgen% = DAYS (ablbis$)
   ELSE 
     ablbisgen$ = ablbis$
     ablbisgen% = DAYS (ablbis$)
   END IF 
   SELECT CASE dreq%
   CASE 33
     REM eingereicht Åber
     eingueber% = GetCodeGEE%(eingueber%)
   CASE 1
     doit% = 1
     IF DateOK%(von$) THEN 
       ok% = 1
       IF DateOK%(bis$) THEN 
         ok% = 1
       ELSE 
         ok% = - 1
         CALL Fehler("Falsche Datumsangabe bei ...bis: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
       END IF 
     ELSE 
       ok% = - 1
       CALL Fehler("Falsche Datumsangabe bei ...von: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
     END IF 
   CASE 2
     ku% = ADRSuche%(ku%)
     ku1% = ku%
   CASE 3
      wks1% = Workstation%
      REM ma% = GetCodeMA%(ma%,Wks1%)
      IF workstation% = 0 THEN 
        IF GASP% = - 1 THEN 
          IF BZwang.stamm = 0 THEN 
            bb% = SelectOffice%("BÅro-Auswahl","",1,0)
            IF bb% <> - 1 THEN 
              zzz% = bb%
              wks% = zzz%
              ma% = VAL (GetWkscodema$(prompt$,wks%))
              REM ma% = GetCodeMA%(_cuma%,Wks%)
            ELSE 
              CALL Fehler("BÅroauswahl abgebrochen!","")
               ma% = 0
             END IF 
          ELSE 
            ma% = GetCodeMA%(_cuma%,0)
          END IF 
        ELSE 
          ma% = GetCodeMA%(_cuma%,0)
        END IF 
      ELSE 
        REM codema% = VAL (GetWkscodema$(prompt$,Workstation.GADRDat$))
        wks1% = Workstation%
        ma% = GetCodeMA%(ma%,Wks1%)
      END IF 
   CASE 4
     ge% = GetCodeGE%(ge%)
   CASE 5
     spa% = GetCodeVA%(spa%)
   CASE 6
     spgr% = GetCodeGR%(spgr%)
   CASE 7
     magr$ = GetCodeMAGR$(magr$)
   CASE 8
     doit% = 1
     IF DateOK%(von$) THEN 
       ok% = 1
       IF DateOK%(bis$) THEN 
         ok% = 1
       ELSE 
         ok% = - 1
         CALL Fehler("Falsche Datumsangabe bei ...bis: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
       END IF 
     ELSE 
       ok% = - 1
       CALL Fehler("Falsche Datumsangabe bei ...von: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
     END IF 
   CASE 9
     REM Produkt auswÑhlen
     IF GOldProdSu$ LIKE "TRUE" THEN 
       cvp% = GetVprodukt%(0,0,0)
     ELSE 
       cvp% = NewGetCodeVP%()
     END IF 
   CASE 10
     REM Tarif auswÑhlen
     ctar% = GetCodeTarif%(0,0)
   CASE 11
     REM ADRGruppe wÑhlen
       b% = 1
       IF z% < RECCOUNT (GAdrDat$) THEN 
         z% = RECCOUNT (GAdrDat$)
       END IF 
       IF z% < RECCOUNT (datei$) + 5 THEN 
         z% = RECCOUNT (datei$) + 5
       END IF 
       IF z% > 20000 THEN z% = 20000
       REDIM AdrFound$(z%)
       REM FOR i% = 0 TO z% - 1
         REM AdrFound$(i%) = ""
       REM NEXT i%
       REM CALL DFile(3,datei1$ + _fpw$)
       datei1$ = "ADRGRUP"
       FILE datei1$
       INDEX keyword.datei1$
       SELECT FIRST 
       a% = 0
       SELECT WHERE keyword.datei1$ <> ""
       SELECT FIRST 
       AdrFound$(0) = "<keinen Filter setzen>"
       WHILE NOT EOF (datei1$)
         AdrFound$(b%) = keyword
         b% = b% + 1
         SELECT NEXT 
       WEND 
       AdrFound$(b%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRLISTE",0,0,340,197,"Adress-Gruppe wÑhlen","MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
       DIALOG "ADRLISTE",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         vADRGRUP$ = LAuswahl$
         IF LAuswahl$ = "<keinen Filter setzen>" THEN vADRGRUP$ = "alle"
       ELSE 
         vADRGRUP$ = "alle"
       END IF 
   CASE 12
     REM GEGrup wÑhlen
       b% = 1
       IF z% < RECCOUNT ("GEGRUP") THEN 
         z% = RECCOUNT ("GEGRUP")
       END IF 
       IF z% < RECCOUNT (datei$) + 5 THEN 
         z% = RECCOUNT (datei$) + 5
       END IF 
       IF z% > 20000 THEN z% = 20000
       REDIM AdrFound$(z%)
       REM FOR i% = 0 TO z% - 1
         REM AdrFound$(i%) = ""
       REM NEXT i%
       REM CALL DFile(3,datei1$ + _fpw$)
       datei1$ = "GEGRUP"
       FILE datei1$
       INDEX keyword.datei1$
       SELECT FIRST 
       a% = 0
       SELECT WHERE keyword.datei1$ <> ""
       SELECT FIRST 
       AdrFound$(0) = "<keinen Filter setzen>"
       WHILE NOT EOF (datei1$)
         AdrFound$(b%) = keyword
         b% = b% + 1
         SELECT NEXT 
       WEND 
       AdrFound$(b%) = ""
       LAuswahl$ = AdrFound$(0)
       LAuswahl1$(0) = LAuswahl$
       CREATE DIALOG "ADRLISTE",0,0,340,197,"Gesellschafts-Gruppe wÑhlen","MS Sans Serif",8
       REM CREATE DIALOG "ADRLISTE",0,0,340,197,title$,"Courier New",8
       ADD DIALOG "ADRLISTE",7,5,8,328,161,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
       ADD DIALOG "ADRLISTE",1,74,174,56,16,1,"&OK",1,1
       ADD DIALOG "ADRLISTE",1,134,174,56,16,0,"&Abbrechen",0,0
       DIALOG "ADRLISTE",req5%
       MOUSE ON 
       REMOVE DIALOG "ADRLISTE"
       IF req5% = 1 THEN 
         LAuswahl$ = LAuswahl1$(0)
         vGESGRUP$ = LAuswahl$
         IF LAuswahl$ = "<keinen Filter setzen>" THEN vGESGRUP$ = "alle"
       ELSE 
         vGESGRUP$ = "alle"
       END IF 

   CASE 28
     REM VertrÑge, die nicht an die Abrechnung Åbergeben wurden
     provab% = 1
     ok% = 1
   CASE 29
     REM abgerechnete VertrÑge ohne BuchungssÑtze
     provab% = 2
     ok% = 1
   CASE 30
     REM nur Adressen ausgeben
     ok% = 1
   CASE 31
      REM Negativsuche Agentur
      wks1% = Workstation%
      ma1% = GetCodeMA%(ma1%,Wks1%)
   CASE 32
     REM Negativsuche
     doit% = 1
     negativsu% = - 1
     IF DateOK%(von$) THEN 
       ok% = 1
       IF DateOK%(bis$) THEN 
         ok% = 1
       ELSE 
         ok% = - 1
         CALL Fehler("Falsche Datumsangabe bei ...bis: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
       END IF 
     ELSE 
       ok% = - 1
       CALL Fehler("Falsche Datumsangabe bei ...von: !","Bitte geben Sie das Datum in der Form 'tt.mm.jjjj' ein.")
     END IF 
   CASE 0
     ok% = 0
     doit% = 0
   END SELECT 
   REM REMOVE DIALOG "BVERTRAG"
   IF GASP% THEN 
     REM ShowOther% = - 1'sis
     show1% = 0
     IF selOff$ <> "<Alle BÅros>" THEN 
        FOR i% = 0 TO VisCount% - 1
            IF VisNames$(i%) = selOff$ THEN 
                Show1% = VisOff%(i%)
                i% = VisCount%'und raus
            END IF 
        NEXT i%
     END IF 
   END IF 
   REM  REMOVE DIALOG ALL 
 WEND 
 IF dreq% = 0 THEN GOTO VertKond140697end
 REM Auswertung der gesetzten Filter
 MOUSE OFF 
 SET STATUS "VertrÑge gefunden: " + STR$ (a%,"9999999")
 REM 05092002
 IF GCODieRuf% = - 1 THEN 
   ret% = CALL ("_SearchClose"):REM CALL Fehler("","")
   GCODieRuf% = 0
   GCODieRuf1% = 0
 END IF 
 IF GCODieRuf1% < - 1 THEN 
   ret% = CALL ("_SearchClose"):REM CALL Fehler("","")
   GCODieRuf1% = 0
 END IF 
       IF EXISTS (GMACodeDir$ + "search.dat") OR EXISTS (GMACodeDir$ + "search.idx") THEN 
         IF (GASP% = - 1 OR GTerminal% = - 1) AND GMACodeDir$ <> "C:\" AND GMACodeDir$ <> "c:\" THEN 
           DELETE GMACodeDir$ + "search.*"
         ELSE 
           DELETE GMACodeDir$ + "search.*"
         END IF 
         IF EXISTS (_netpath$ + "local\search.dat") AND EXISTS (_netpath$ + "local\search.idx") THEN 
           COPY _netpath$ + "local\search.dat",GMACodeDir$ + "search.dat"
           COPY _netpath$ + "local\search.idx",GMACodeDir$ + "search.idx"
         ELSE 
           GCodie% = 0
         END IF 
       ELSE 
         IF EXISTS (_netpath$ + "local\search.dat") AND EXISTS (_netpath$ + "local\search.idx") THEN 
           COPY _netpath$ + "local\search.dat",GMACodeDir$ + "search.dat"
           COPY _netpath$ + "local\search.idx",GMACodeDir$ + "search.idx"
         ELSE 
           GCodie% = 0
         END IF 
       END IF 
 FILE "Kvertrag"
 IF InHaus% = 2 THEN 
   INDEX InHaus.kvertrag
   GOTO w230820094
 ELSE 
 END IF 

 IF RECCOUNT ("KVERTRAG") < 15000 THEN 
   nurdatsu% = 2
   IF so1% = 1 THEN INDEX Gesellschaft.kvertrag
   IF so1% = 2 THEN INDEX Sparte.kvertrag
   IF so1% = 3 THEN INDEX Agentur.kvertrag
   IF so1% = 4 THEN INDEX QuickGesSpart.kvertrag
   IF so1% = 5 THEN INDEX ANachname.kvertrag
   REM IF so1% = 6 THEN INDEX Policedatum.kvertrag
 ELSE 
     nurdatsu% = 0
     IF ku1% > 0 THEN 
       INDEX codeku.kvertrag
     ELSE 
       IF ma% > 0 THEN 
         INDEX codema.kvertrag
       ELSE 
         IF ge% > 0 THEN 
           INDEX codege.kvertrag
         ELSE 
           IF spa% > 0 THEN 
             INDEX codeva.kvertrag
           ELSE 
             IF spgr% > 0 THEN 
               INDEX Codegrsp.kvertrag
             ELSE 
               IF cvp% > 0 THEN 
                 INDEX CodeVP.kvertrag
               ELSE 
                 IF ctar% > 0 THEN 
                   INDEX CodeTarif.kvertrag
                 ELSE 
                   IF so% = 1 THEN 
                     nurdatsu% = - 1
                     INDEX vs_beginn.kvertrag
                   ELSE 
                     IF so% = 2 THEN 
                       nurdatsu% = - 1
                       INDEX Antragsdatum.kvertrag
                     ELSE 
                       IF so% = 3 THEN 
                         nurdatsu% = - 1
                         INDEX ProviAB.kvertrag
                       ELSE 
                         IF so% = 4 THEN 
                           nurdatsu% = - 1
                           INDEX erfasdatum.kvertrag
                         ELSE 
                           nurdatsu% = - 1
                           INDEX Policedatum.kvertrag
                         END IF 
                       END IF 
                     END IF 
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
     REM alle noch nicht an die Abrechnung Åbergebenen VertrÑge
     REM IF provab% = 1 THEN filt$ = filt$ + " AND ProviAB.kvertrag<1"
     REM alle  an die Abrechnung Åbergebenen VertrÑge ohne BuchungssÑtze
     REM IF provab% = 2 THEN filt$ = filt$ + " AND ProviAB.kvertrag>0"
 END IF 

w230820094: 

 i% = 0
 z% = RECCOUNT ("Kvertrag")
 wi% = 0
 REM CALL Server("LISTBOXINIT","Vertragsauswahl")
 REM CALL Gauge(1,"Vertragsdatei wird durchsucht...")
 REM CALL Server("GAUGEENABLECANCEL","")
 REM _prozt% = 0
 REM _proz2% = 0
 REM _anz% = RECCOUNT ("kvertrag")
 filt$ = "SELECT WHERE lfdnr>0"
 REM 191099/6
 
 
 
   REM Waehrung$(0) = "Filter deaktiviert"
   REM Waehrung$(1) = "alle nicht stornierten,nicht Fremdvertr.,nicht Altvertr." + SPACE$ (90) + "17"
   REM Waehrung$(2) = "alle nicht stornierten,alle Fremdvertr.,nicht Altvertr." + SPACE$ (90) + "18"
   REM Waehrung$(3) = "lebend" + SPACE$ (90) + "01"
   REM Waehrung$(4) = "leben/kurzfristig/unterjÑhrig" + SPACE$ (90) + "02"
   REM Waehrung$(5) = "ruhend/Anwartschaft" + SPACE$ (90) + "03"
   REM Waehrung$(6) = "storniert" + SPACE$ (90) + "04"
   REM Waehrung$(7) = "ruhend/beitragsfrei" + SPACE$ (90) + "05"
   REM Waehrung$(8) = "beitragsfrei" + SPACE$ (90) + "06"
   REM Waehrung$(9) = "beitragsfrei durch Leistung" + SPACE$ (90) + "07"
   REM Waehrung$(10) = "Beitragsstundung" + SPACE$ (90) + "08"
   REM Waehrung$(11) = "Sonstiges" + SPACE$ (90) + "09"
   REM Waehrung$(12) = "Altvertrag" + SPACE$ (90) + "10"
   REM Waehrung$(13) = "Fremdvertrag" + SPACE$ (90) + "11"
   REM Waehrung$(14) = "Antrag" + SPACE$ (90) + "12"
   REM Waehrung$(15) = "storniert durch Dynamisierung" + SPACE$ (90) + "13"
   REM Waehrung$(16) = "Bestandteil eines BÅndelungsvertrages" + SPACE$ (90) + "14"
   REM Waehrung$(17) = "Antragswiderruf" + SPACE$ (90) + "15"
   REM Waehrung$(18) = "Policenwiderspruch" + SPACE$ (90) + "16"
 
 
 
   CodeVStatus% = VAL ( RIGHT$ (Auswahl4$,2))
 
 IF RECCOUNT ("KVERTRAG") < 15000 THEN 
   IF (CodeVStatus% > 0) THEN 
     IF negativsu% = 0 THEN 
       laenge1% = LEN (Auswahl4$)
       ausw$ = LEFT$ (Auswahl4$,laenge1% - 2)
       ausw1$ = TRIM$ (ausw$)
       vstatusu$ = "Filter: " + ausw1$
       REM SELECT WHERE CodeVstatus.kvertrag = CodeVStatus%
       REM filt$ = filt$ + " AND CodeVstatus.kvertrag = " + LTRIM$ ( STR$ (CodeVStatus%,"99"))
       IF CodeVStatus% < 17 OR CodeVStatus% = 20 OR CodeVStatus% = 21 THEN 
         filt$ = filt$ + " AND CodeVstatus=" + LTRIM$ ( STR$ (CodevStatus%,"99"))
       ELSE 
         IF CodeVStatus% = 17 THEN 
           filt$ = filt$ + " AND CodeVstatus <> 04 AND CodeVstatus <> 13 AND CodeVstatus <> 10  AND CodeVstatus <> 11 AND CodeVstatus <> 15  AND CodeVstatus <> 16 AND CodeVstatus < 20 "
         END IF 
         IF CodeVStatus% = 18 THEN 
           filt$ = filt$ + " AND CodeVstatus <> 04 AND CodeVstatus <> 13 AND CodeVstatus <> 10  AND CodeVstatus <> 15  AND CodeVstatus <> 16 AND CodeVstatus < 20 "
         END IF 
       END IF 
     ELSE 
       IF CodeVStatus% < 17 OR CodeVStatus% = 20 OR CodeVStatus% = 21 THEN 
         filt$ = filt$ + " AND CodeVstatus<>" + LTRIM$ ( STR$ (CodevStatus%,"99"))
       ELSE 
         IF CodeVStatus% = 17 THEN 
           filt$ = filt$ + " AND (CodeVstatus = 04 OR CodeVstatus = 13 OR CodeVstatus = 10 OR CodeVstatus = 11  OR CodeVstatus = 15  OR CodeVstatus = 16 OR CodeVstatus >= 20 ) "
         END IF 
         IF CodeVStatus% = 18 THEN 
           filt$ = filt$ + " AND CodeVstatus = 04 AND CodeVstatus = 13 AND CodeVstatus = 10  OR CodeVstatus = 11 OR CodeVstatus >= 20 "
         END IF 
       END IF 
     END IF 
   END IF 
   IF negativsu% <> - 1 THEN 
     IF ku1% > 0 THEN filt$ = filt$ + " AND Codeku.kvertrag=" + LTRIM$ ( STR$ (ku1%,"999999"))
     IF ma% > 0 THEN filt$ = filt$ + " AND CodeMA.kvertrag=" + LTRIM$ ( STR$ (ma%,"999999"))
     IF ge% > 0 THEN filt$ = filt$ + " AND CodeGE.kvertrag=" + LTRIM$ ( STR$ (ge%,"999999"))
     IF spa% > 0 THEN filt$ = filt$ + " AND CodeVA.kvertrag=" + LTRIM$ ( STR$ (spa%,"999999"))
     IF spgr% > 0 THEN filt$ = filt$ + " AND Codegrsp.kvertrag=" + LTRIM$ ( STR$ (spgr%,"999999"))
     IF cvp% > 0 THEN filt$ = filt$ + " AND CodeVP.kvertrag=" + LTRIM$ ( STR$ (cvp%,"999999"))
     IF ctar% > 0 THEN filt$ = filt$ + " AND CodeTarif.kvertrag=" + LTRIM$ ( STR$ (ctar%,"999999"))
     REM alle noch nicht an die Abrechnung Åbergebenen VertrÑge
     IF provab% = 1 THEN filt$ = filt$ + " AND ProviAB.kvertrag<1"
     REM alle  an die Abrechnung Åbergebenen VertrÑge ohne BuchungssÑtze
     IF provab% = 2 THEN filt$ = filt$ + " AND ProviAB.kvertrag>0"
     IF InHaus% < 1 THEN 
       filt$ = filt$ + " and InHaus.kvertrag <> 1"
     END IF 
     IF InHaus% = 2 THEN 
       filt$ = filt$ + " and InHaus.kvertrag = 1"
     END IF 
   ELSE 
     REM vtok% = 0
     IF ku1% > 0 THEN filt$ = filt$ + " AND Codeku.kvertrag<>" + LTRIM$ ( STR$ (ku1%,"999999"))
     IF ma% > 0 THEN filt$ = filt$ + " AND CodeMA.kvertrag<>" + LTRIM$ ( STR$ (ma%,"999999"))
     IF ge% > 0 THEN filt$ = filt$ + " AND CodeGE.kvertrag<>" + LTRIM$ ( STR$ (ge%,"999999"))
     IF spa% > 0 THEN filt$ = filt$ + " AND CodeVA.kvertrag<>" + LTRIM$ ( STR$ (spa%,"999999"))
     IF spgr% > 0 THEN filt$ = filt$ + " AND Codegrsp.kvertrag<>" + LTRIM$ ( STR$ (spgr%,"999999"))
     IF cvp% > 0 THEN filt$ = filt$ + " AND CodeVP.kvertrag<>" + LTRIM$ ( STR$ (cvp%,"999999"))
     IF ctar% > 0 THEN filt$ = filt$ + " AND CodeTarif.kvertrag<>" + LTRIM$ ( STR$ (ctar%,"999999"))
     REM alle noch nicht an die Abrechnung Åbergebenen VertrÑge
     IF provab% = 1 THEN filt$ = filt$ + " AND ProviAB.kvertrag>0"
     REM alle  an die Abrechnung Åbergebenen VertrÑge ohne BuchungssÑtze
     IF provab% = 2 THEN filt$ = filt$ + " AND ProviAB.kvertrag<1"
     IF InHaus% < 1 THEN 
       filt$ = filt$ + " and InHaus.kvertrag = 1"
     END IF 
     IF InHaus% = 2 THEN 
       filt$ = filt$ + " and InHaus.kvertrag <> 1"
     END IF 
   END IF 
   SELECT WHERE FILE "KVERTRAG"
   EXECUTE filt$
 END IF 
 
 
 statuskey% = 0
 IF selIntVStatus$ <> "<kein Filter>" THEN 
   statuskey% = VAL ( LEFT$ (selIntVStatus$,2))
 END IF 

 FILE "KVERTRAG"
 iind$ = INDEX 
 IF RECCOUNT ("KVERTRAG") < 15000 THEN 
   SELECT FIRST FILE "KVERTRAG" INDEX iind$
   IF InHaus% = 2 THEN 
     IF negativsu% <> - 1 THEN 
       SELECT KEY 1 FILE "KVERTRAG" INDEX iind$
     ELSE 
       SELECT KEY 0 FILE "KVERTRAG" INDEX iind$
     END IF 
   END IF 
 ELSE 
   SELECT FIRST FILE "KVERTRAG" INDEX iind$
  IF InHaus% = 2 THEN 
    IF negativsu% <> - 1 THEN 
      SELECT KEY 1 FILE "KVERTRAG" INDEX iind$
    ELSE 
      SELECT KEY 0 FILE "KVERTRAG" INDEX iind$
    END IF 
  ELSE 
   IF negativsu% = 0 THEN 
     IF ku1% > 0 THEN 
       SELECT KEY ku1% FILE "KVERTRAG" INDEX iind$
     ELSE 
       IF ma% > 0 THEN 
         SELECT KEY ma% FILE "KVERTRAG" INDEX iind$
       ELSE 
         IF ge% > 0 THEN 
           SELECT KEY ge% FILE "KVERTRAG" INDEX iind$
         ELSE 
           IF spa% > 0 THEN 
             SELECT KEY spa% FILE "KVERTRAG" INDEX iind$
           ELSE 
             IF spgr% > 0 THEN 
               SELECT KEY spgr% FILE "KVERTRAG" INDEX iind$
             ELSE 
               IF cvp% > 0 THEN 
                 SELECT KEY cvp% FILE "KVERTRAG" INDEX iind$
               ELSE 
                 IF ctar% > 0 THEN 
                   SELECT KEY ctar% FILE "KVERTRAG" INDEX iind$
                 ELSE 
                   IF provab% = 1 THEN 
                     SELECT FIRST FILE "KVERTRAG" INDEX iind$
                   ELSE 
                     IF provab% = 2 THEN 
                       SELECT KEY 1 FILE "KVERTRAG" INDEX iind$
                     ELSE 
                       IF so% > 0 THEN 
                         SELECT KEY vongen% FILE "KVERTRAG" INDEX iind$
                       ELSE 
                         SELECT FIRST FILE "KVERTRAG" INDEX iind$
                       END IF 
                     END IF 
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
   END IF 
  END IF 
 END IF 

 IF incMA$ = "j" THEN 
   REM incP$ = "j"
   REM incA$ = "j"
 END IF 
 ON ERROR GOTO ErrorHandler
 IF GCODIE% = - 1 AND dreq% <> 8 THEN 
   CALL SearchInitVe1(GDokDat$)
 END IF 
 CALL Gauge(0,"")
 IF RECCOUNT ("KVERTRAG") < 15000 THEN 
   CALL Server("LISTBOXINIT","Vertragsauswahl")
   CALL Gauge(1,"Vertragsdatei wird durchsucht...")
   CALL Server("GAUGEENABLECANCEL","")
 END IF 
 _prozt% = 0
 _proz2% = 0
 _anz% = RECCOUNT ("kvertrag")
 IF RECCOUNT ("KVERTRAG") > 15000 THEN 
   REQUEST "Ihre Vertragsdatei ist sehr gro·! Mîchten Sie alle 1000 ","DatensÑtze einen Unterbrechungspunkt setzen?",130,requnt%
 END IF 

 REM Stornowarnung -> Datum abfragen - START
 IF incSW$ = "j" THEN 
   IF incStoWaDat$ = "j" THEN 
     stowadatvon% = 0
     stowadatbis% = 0
     stowadatvon$ = ""
     stowadatbis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
w061120081: 
     CREATE DIALOG "TLISTE",0,0,307,76,title$,"MS Sans Serif",8
     ADD DIALOG "TLISTE",4,0,0,306,114,0,""
     ADD DIALOG "TLISTE",5,10,11,290,22,0,"Bitte geben Sie den Zeitraum des Stornowarnungsdatum der Gesellschaft ein:"
     ADD DIALOG "TLISTE",5,84,35,12,8,0,"von"
     ADD DIALOG "TLISTE",6,99,34,45,11,0,0,stowadatvon$,10
     ADD DIALOG "TLISTE",5,152,35,12,8,0,"bis"
     ADD DIALOG "TLISTE",6,166,34,45,11,0,0,stowadatbis$,10
     ADD DIALOG "TLISTE",1,99,55,55,15,1,"&Weiter",1,1
     ADD DIALOG "TLISTE",1,155,55,55,15,0,"&Abbrechen",0,0
     DIALOG "TLISTE",req%
     REMOVE DIALOG "TLISTE"
     IF req% = 1 THEN 
       IF NOT DateOK%(stowadatvon$) THEN 
         CALL Fehler("Bitte geben Sie ein gÅltiges Datum fÅr VON ein!","")
         GOTO w061120081
       END IF 
       IF NOT DateOK%(stowadatbis$) THEN 
         CALL Fehler("Bitte geben Sie ein gÅltiges Datum fÅr BIS ein!","")
         GOTO w061120081
       END IF 
       stowadatvon% = DAYS (stowadatvon$)
       stowadatbis% = DAYS (stowadatbis$)
     END IF 
   END IF 
 END IF 
 REM Stornowarnung -> Datum abfragen - ENDE


 IF nurdatsu% <> - 1 THEN WHILE NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL"
 IF nurdatsu% = - 1 THEN WHILE NOT EOF ("kvertrag") AND ServerReply$() <> "CANCEL" AND iind$$ <= bisgen%
   IF RECCOUNT ("KVERTRAG") < 15000 THEN 
     IF ServerReply$() LIKE "CANCEL" THEN GOTO raus011120031
     _proz% = INT ((100 / _anz%) * _proz2%)
     IF _proz% > 100 THEN _proz% = 100
     IF _proz% < 2 THEN _proz% = 2
     IF _proz% <> _prozt% THEN 
       _prozt% = _proz%
       SET STATUS "erweiterte Suche... " + STR$ (_prozt%,"999") + " %"
       CALL Gauge(_proz%,"")
     END IF 
     _proz2% = _proz2% + 1
   END IF 
   codeku% = codeku.kvertrag
   SELECT KEY codeku% FILE "ADRESSEN" INDEX codeku.adressen
   REM CALL Fehler( STR$ (codeku%,"99999"),"")
   lfdnr% = lfdnr.kvertrag
   vtok% = 0
   IF incSoll$ <> "j" AND incp$ <> "j" AND inca$ <> "j" AND abruf$ <> "j" AND incF$ <> "j" AND incS$ <> "j" AND incT$ <> "j" AND incMA$ <> "j" AND incNachbearb$ <> "j" OR vADRGRUP$ = "alle" THEN vtok% = 1
   IF negativsu% = - 1 THEN vtok% = 0
   REM Anfang
   REM **********************************************************************************************************************************************************************************************************
   generellstop% = 0
   IF RECCOUNT ("KVERTRAG") >= 15000 THEN 
     IF ku1% > 0 THEN 
       IF Codeku.kvertrag = ku1% THEN 
         vtok% = 1
       ELSE 
         vtok% = 0
         generellstop% = - 1
         GOTO endwend230520021 
       END IF 
     ELSE 
       IF ma% > 0 THEN 
         IF CodeMA.kvertrag = ma% THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           generellstop% = - 1
           GOTO endwend230520021 
         END IF 
       ELSE 
         IF ge% > 0 THEN 
           IF CodeGE.kvertrag = ge% THEN 
             vtok% = 1
           ELSE 
             vtok% = 0
             generellstop% = - 1
             GOTO endwend230520021 
           END IF 
         ELSE 
           IF spa% > 0 THEN 
             IF CodeVA.kvertrag = spa% THEN 
               vtok% = 1
             ELSE 
               vtok% = 0
               generellstop% = - 1
               GOTO endwend230520021 
             END IF 
           ELSE 
             IF spgr% > 0 THEN 
               IF Codegrsp.kvertrag = spgr% THEN 
                 vtok% = 1
               ELSE 
                 vtok% = 0
                 generellstop% = - 1
                 GOTO endwend230520021 
               END IF 
             ELSE 
               IF cvp% > 0 THEN 
                 IF CodeVP.kvertrag = cvp% THEN 
                   vtok% = 1
                 ELSE 
                   vtok% = 0
                   generellstop% = - 1
                   GOTO endwend230520021 
                 END IF 
               ELSE 
                 IF ctar% > 0 THEN 
                   IF CodeTarif.kvertrag = ctar% THEN 
                     vtok% = 1
                   ELSE 
                     vtok% = 0
                     generellstop% = - 1
                     GOTO endwend230520021 
                   END IF 
                 ELSE 
                   IF provab% = 1 THEN 
                     IF ProviAB.kvertrag < 1 THEN 
                       vtok% = 1
                     ELSE 
                       vtok% = 0
                       generellstop% = - 1
                       GOTO endwend230520021 
                     END IF 
                   ELSE 
                     IF provab% = 2 THEN 
                       IF ProviAB.kvertrag > 0 THEN 
                         vtok% = 1
                       ELSE 
                         vtok% = 0
                         generellstop% = - 1
                         GOTO endwend230520021 
                       END IF 
                     END IF 
                   END IF 
                 END IF 
               END IF 
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
     REM Status
       IF (CodeVStatus% > 0) THEN 
         laenge1% = LEN (Auswahl4$)
         ausw$ = LEFT$ (Auswahl4$,laenge1% - 2)
         ausw1$ = TRIM$ (ausw$)
         vstatusu$ = "Filter: " + ausw1$
         IF CodeVStatus% < 17 THEN 
           IF CodeVstatus.kvertrag = CodevStatus% THEN 
             vtok% = 1
           ELSE 
             vtok% = 0
             GOTO endwend230520021 
           END IF 
         ELSE 
           IF CodeVStatus% = 17 THEN 
             IF CodeVstatus <> 04 AND CodeVstatus <> 13 AND CodeVstatus <> 10 AND CodeVstatus <> 11 AND CodeVstatus <> 15 AND CodeVstatus <> 16 AND CodeVstatus < 20 THEN 
               vtok% = 1
             ELSE 
               vtok% = 0
               GOTO endwend230520021 
             END IF 
           END IF 
           IF CodeVStatus% = 18 THEN 
             IF CodeVstatus <> 04 AND CodeVstatus <> 13 AND CodeVstatus <> 10 AND CodeVstatus <> 15 AND CodeVstatus <> 16 AND CodeVstatus < 20 THEN 
               vtok% = 1
             ELSE 
               vtok% = 0
               GOTO endwend230520021 
             END IF 
           END IF 
         END IF 
       END IF 
     END IF 
     REM Status
   END IF 
   REM ***********************************************************************************************************************************************************************************************************
 
       IF MNdisabled%("VERTRINHAUSSEE") THEN 
         IF inhaus.kvertrag = 1 THEN 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 
       IF LTRIM$ (GDVAgentNR$) <> "" THEN 
         IF GDVAgentNR.kvertrag LIKE GDVAgentNR$ THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 

       SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
       SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
       IF vADRGRUP$ <> "alle" THEN 
         REM SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
         IF ADRGruppe.adressen = vADRGRUP$ THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 
       REM 15092005 - Maklerauftrag
       IF incMaklauf$ LIKE "j" AND vtok% <> 0 THEN 
         IF AAMakler.adressen LIKE "j" THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 
       IF incVollm$ LIKE "j" AND vtok% <> 0 THEN 
         IF Vollmacht.adressen LIKE "j" THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 
       IF incGVollm$ LIKE "j" AND vtok% <> 0 THEN 
         IF GeneralVollmach.adressen LIKE "j" THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 
       IF incKVPfl$ LIKE "j" AND vtok% <> 0 THEN 
         IF KVPflicht.adressen LIKE "j" THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 
       IF incRVPfl$ LIKE "j" AND vtok% <> 0 THEN 
         IF RVPflicht.adressen LIKE "j" THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 
       IF incKBProt$ LIKE "j" AND vtok% <> 0 THEN 
         IF BerProtok.adressen LIKE "j" THEN 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 




       REM policierte VertrÑge
       IF incSoll$ = "j" AND vtok% <> 0 THEN 
         IF sollst.kvertrag LIKE "j" THEN 
           vtok% = 1
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 



       IF incexpInt$ = "j" AND vtok% <> 0 THEN 
       END IF 

       IF incP$ = "j" AND vtok% <> 0 THEN 
         REM 22052002 IF proviab.kvertrag > 0 AND UCASE$ (Altvertrag.kvertrag) <> "J" AND UCASE$ (Fremdvertrag.kvertrag) <> "J" AND (KÅndigung.kvertrag > TODAY OR KÅndigung.kvertrag < 1) THEN 
         IF proviab.kvertrag > 0 AND UCASE$ (Altvertrag.kvertrag) <> "J" AND UCASE$ (Fremdvertrag.kvertrag) <> "J" AND (TatsKuenDat.kvertrag > TODAY OR TatsKuenDat.kvertrag < 1) THEN 
           vtok% = 1
           GOTO abhier091101001
         ELSE 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 
       
       REM Antrag
       IF incA$ = "j" AND vtok% <> 0 THEN 
         REM 22052002 IF proviab.kvertrag < 1 AND UCASE$ (Altvertrag.kvertrag) <> "J" AND UCASE$ (Fremdvertrag.kvertrag) <> "J" AND (KÅndigung.kvertrag > TODAY OR KÅndigung.kvertrag < 1) THEN 
         IF proviab.kvertrag < 1 AND UCASE$ (Altvertrag.kvertrag) <> "J" AND UCASE$ (Fremdvertrag.kvertrag) <> "J" THEN 
           vtok% = 1
           GOTO abhier091101001
         ELSE 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 
       IF abruf$ = "j" AND vtok% <> 0 THEN 
         IF UCASE$ (abruf.kvertrag) = "J" THEN 
           vtok% = 1
           GOTO abhier091101001
         ELSE 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 
       REM Fremdvertrag
       IF incF$ = "j" AND vtok% <> 0 THEN 
         IF UCASE$ (Fremdvertrag.kvertrag) = "J" THEN 
           vtok% = 1
           REM GOTO abhier091101001
         ELSE 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 
       REM stornierter Vertrag
       IF incS$ = "j" AND vtok% <> 0 THEN 
         IF storno.kvertrag > 0 THEN 
           vtok% = 1
           GOTO abhier091101001
         ELSE 
           IF (KÅndigung.kvertrag > 0 AND KÅndigung.kvertrag < TODAY ) OR (TatsKuenDat.kvertrag > 0 AND TatsKuenDat.kvertrag < TODAY ) THEN 
             vtok% = 1
             GOTO abhier091101001
           END IF 
         END IF 
       END IF 
       REM Altvertrag
       IF incT$ = "j" AND vtok% <> 0 THEN 
         IF UCASE$ (Altvertrag.kvertrag) = "J" THEN 
           vtok% = 1
           REM GOTO abhier091101001
         ELSE 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 
        
       REM Vertrag ohne Mitarbeiter
       IF incMA$ = "j" AND vtok% <> 0 THEN 
         IF codema.kvertrag < 1 THEN 
           vtok% = 1
           REM GOTO abhier091101001
         ELSE 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
       END IF 
 
  


   REM Ende
   IF dreq% <> 8 THEN 
     SELECT FIRST FILE GAdrDat$ INDEX codeku.GAdrDat$
     SELECT KEY codeku% FILE GAdrDat$ INDEX codeku.GAdrDat$
     nachn$ = LEFT$ (Nachname.GAdrDat$)
   END IF 
   REM CALL Fehler(nachn$,"")
   IF incNachbearb$ = "j" THEN 
     IF EXISTS (lfdnr%,codevt.vorgang) THEN 
       FILE "vorgang"
       INDEX codevt.vorgang
       SELECT FIRST 
       SELECT KEY lfdnr% FILE "Vorgang" INDEX codevt.vorgang
       ffff% = 0
       aaook% = - 1
       WHILE NOT EOF ("Vorgang") AND codevt.vorgang = lfdnr% AND aaook% = - 1
         IF UCASE$ (erledigt.vorgang) <> "J" THEN 
           ffff% = ffff% + 1
           vtok% = 1
           aaook% = 0
           REM GOTO abhier091101001
         END IF 
         SELECT NEXT 
       WEND 
       IF ffff% = 0 THEN vtok% = 0
       IF vtok% = 1 THEN 
         GOTO abhier091101001
       END IF 
     ELSE 
       vtok% = 0
     END IF 
     FILE "kvertrag"
   END IF 
 
abhier091101001: 
   REM Vertragsnr,Kennz
   IF akver1% > 0 AND eingabe$ <> "" THEN 
     IF akver1% = 1 THEN 
       IF eingabe$ <> "" THEN 
         eingab$ = eingabe$
         REM nvt% = GetVertrag%(lfdnr.KVERTRAG)
         tVSNR$ = VSNRPack$(eingab$)
         IF QuickVSNR.KVERTRAG LIKE tVSNR$ + "*" THEN 
           
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
         
       END IF 
     END IF 
     IF akver1% = 2 THEN 
       IF eingabe$ <> "" THEN 
         eingab$ = eingabe$
         REM nvt% = GETKFZKe%(lfdnr.KVERTRAG)
         tVSNR$ = VSNRPack$(eingab$)
         IF QuickKennz.KVERTRAG LIKE tVSNR$ + "*" THEN 
           
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
         
       END IF 
     END IF 
     IF akver1% = 3 THEN 
       IF eingabe$ <> "" THEN 
         eingab$ = eingabe$
         REM nvt% = GETKFZTyp%(lfdnr.KVERTRAG)
         REM 07ab
         tVSNR$ = VSNRPack$(eingab$)
         IF Fabrikat.kvertrag LIKE tvsnr$ + "*" THEN 
           
         ELSE 
           vtok% = 0
           GOTO endwend230520021
         END IF 
         
       END IF 
     END IF 
   END IF 
 
 
   IF dauer% > 0 THEN 
     IF vs_dauer.kvertrag <> dauer% THEN vtok% = 0
   END IF 
   REM Vertragsdatum
   IF so% = 1 THEN 
     von1$ = DATE$ (vs_Beginn.kvertrag,"0d.mm.yyyy")
   END IF 
   IF so% = 2 THEN 
     von1$ = DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy")
   END IF 
   IF so% = 3 THEN 
     von1$ = DATE$ (ProviAB.kvertrag,"0d.mm.yyyy")
   END IF 
   IF so% = 4 THEN 
     von1$ = DATE$ (ErfasDatum.kvertrag,"0d.mm.yyyy")
   END IF 
   IF so% = 5 THEN 
     von1$ = DATE$ (PoliceDatum.kvertrag,"0d.mm.yyyy")
   END IF 

   IF vGESGRUP$ <> "alle" THEN 
     SELECT FIRST FILE "GEADR" INDEX codege.geadr
     SELECT KEY codege.kvertrag FILE "geadr" INDEX codege.geadr
     IF gegruppe.geadr LIKE vGESGRUP$ THEN 
     ELSE 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 

   IF von$ <> "" THEN 
     IF so% = 1 THEN 
       IF vs_Beginn.kvertrag < vongen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 2 THEN 
       IF Antragsdatum.kvertrag < vongen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 3 THEN 
       IF Proviab.kvertrag < vongen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 4 THEN 
       IF ErfasDatum.kvertrag < vongen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 5 THEN 
       IF PoliceDatum.kvertrag < vongen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
   END IF 
   IF bis$ <> "" THEN 
     IF so% = 1 THEN 
       IF vs_Beginn.kvertrag > bisgen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 2 THEN 
       IF Antragsdatum.kvertrag > bisgen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 3 THEN 
       IF Proviab.kvertrag > bisgen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 4 THEN 
       IF ErfasDatum.kvertrag > bisgen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF so% = 5 THEN 
       IF PoliceDatum.kvertrag > bisgen% THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
   END IF 

   REM 31.08.2005
   IF statuskey% > 0 THEN 
     IF statuskey.kvertrag <> statuskey% THEN 
         vtok% = 0
         GOTO endwend230520021 
     END IF 
   END IF 

   kÅnd$ = LTRIM$ ( DATE$ (KÅndigung.kvertrag,"0d.mm.yyyy"))
   IF kÅnd$ <> "" THEN kÅnd% = DAYS (kÅnd$)
   neun% = DAYS ("1.1.1980")
   REM IF vs_nr.kvertrag LIKE "123" THEN CALL Fehler(kÅnd$,ablvon$ + " " + ablbis$)
   IF ablvon$ <> "" THEN 
     IF KÅndigung.kvertrag < ablvongen% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF ablbis$ <> "" THEN 
     REM 190499
     IF KÅndigung.kvertrag > ablbisgen% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
     IF KÅndigung.kvertrag < 1 THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF incDyn$ = "j" THEN 
     IF Dynamik.kvertrag = 0 THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF incMA$ = "j" THEN 
     IF codema.kvertrag > 0 THEN 
       vtok% = 0
       GOTO endwend230520021
     ELSE 
     END IF 
   END IF 
   IF incZWeinm$ = "j" THEN 
     IF zw.kvertrag > 0 THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF incZWratierl$ = "j" THEN 
     IF zw.kvertrag = 0 THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF incBrProtok$ = "j" THEN 
     IF BerProtok.kvertrag LIKE "J" THEN 
       vtok% = 0
       GOTO endwend230520021 
     ELSE 
     END IF 
   END IF 

   IF incProvSperr$ = "j" THEN 
     IF ProvSperreJN.kvertrag LIKE "J" THEN 
     ELSE 
       vtok% = 0
       GOTO endwend230520021 
     END IF 
   END IF 

   IF eingueber% > 0 THEN 
     IF codeEingGe.kvertrag <> eingueber% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 


   SELECT CASE inhaus%
   CASE 0
     REM keine InhausvertrÑge anzeigen
         IF InHaus.kvertrag = 1 THEN 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
   CASE 1
     REM auch InhausvertrÑge anzeigen
   CASE 2
     REM nur InhausvertrÑge anzeigen
         IF InHaus.kvertrag <> 1 THEN 
           vtok% = 0
           GOTO endwend230520021 
         END IF 
   END SELECT 




   IF ku1% <> 0 THEN 
     IF codeku.kvertrag <> ku1% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF UCASE$ (magr$) <> "ALLE" THEN 
     codemaab% = codema.kvertrag
     IF EXISTS (codemaab%,codema.maadr) THEN 
       SELECT KEY codemaab% FILE "maadr" INDEX codema.maadr
       IF MAGruppe.maadr <> magr$ THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     ELSE 
       vtok% = 0
     END IF 
 
   END IF 
   Show2% = 0
   IF ma% <> 0 THEN 
     Show2% = - 1
     IF codema.kvertrag <> ma% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF ge% <> 0 THEN 
     IF codege.kvertrag <> ge% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   
   IF spa% <> 0 THEN 
     IF codeva.kvertrag <> spa% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
   IF spgr% <> 0 THEN 
     IF codegrsp.kvertrag <> spgr% THEN 
       vtok% = 0
       GOTO endwend230520021
     END IF 
   END IF 
 

   IF DirektVSKZ$ <> "" THEN 
     IF DirektVSKZ$ = "n" THEN 
       IF DirektVSKZ.kvertrag = "j" THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF DirektVSKZ$ = "j" THEN 
       IF DirektVSKZ.kvertrag <> "j" THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     END IF 
   END IF 



   IF provab% = 2 THEN 
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       IF EXISTS (lfdnr.kvertrag,codevt.buchung1) THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     ELSE 
       IF EXISTS (lfdnr.kvertrag,codevt.buchung) THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
   END IF 
   IF WMon$ <> "" OR WJahr$ <> "" THEN 
     IF WMon$ <> "" THEN 
       IF WMon.kvertrag <> VAL (WMon$) THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
     IF WJahr$ <> "" THEN 
       IF WJahr.kvertrag > 0 AND WJahr.kvertrag <> VAL (WJahr$) THEN 
         vtok% = 0
         GOTO endwend230520021
       END IF 
     END IF 
   END IF 
 
   REM 191099/7
   IF GASP% THEN 
     IF Workstation% > 0 AND show2% = 0 THEN 
       IF selOff$ <> "<Alle BÅros>" THEN 
 
         IF workstation.kvertrag <> Show1% THEN 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       ELSE 
         gefunden% = 0
         FOR i% = 0 TO VisCount% - 1' Fall externes BÅro
            IF VisOff%(i%) = workstation.kvertrag THEN 
              gefunden% = - 1
              i% = VisCount%
            END IF 
         NEXT i%
         IF gefunden% = 0 THEN 
           vtok% = 0
           GOTO endwend230520021
         END IF 
       END IF 
     END IF 
   END IF 
   IF ma1% <> 0 THEN 
     REM "Negativ-Agentur"
     IF codema.kvertrag = ma1% THEN vtok% = 0
   END IF 
   IF GMASuperCount% > 0 THEN 
     IF IsMASuper%(codema.kvertrag) <> - 1 THEN vtok% = 0
   END IF 
   IF show1% <> 0 THEN 
     IF workstation.kvertrag <> show1% THEN vtok% = 0
   END IF 
 
 
 
       IF vs_nr.kvertrag LIKE "567*" THEN 
        REM CALL Fehler("1234","")
      END IF 
      REM Stornowarnung
     IF vtok% <> 0 THEN 
       IF incSW$ = "j" THEN 
         IF StorWarnJN.kvertrag = "j" THEN 
           vtok% = 1
           REM Stornowarnung -> Datum abfragen
           IF incStoWaDat$ = "j" THEN 
             REM CALL Fehler("Stornowarnung -> Datum abfragen","")
             IF StorWarnDatGes.kvertrag > 0 THEN 
               IF StorWarnDatGes.kvertrag >= stowadatvon% AND StorWarnDatGes.kvertrag <= stowadatbis% THEN 
               ELSE 
                 vtok% = 0
               END IF 
             ELSE 
               vtok% = 0
             END IF 
           END IF 
         ELSE 
           vtok% = 0
         END IF 
       END IF 
     ELSE 
       IF negativsu% = - 1 THEN 
         IF incSW$ = "j" THEN 
           IF StorWarnJN.kvertrag = "j" THEN 
             vtok% = 1
           ELSE 
             vtok% = 0
           END IF 
         END IF 
       END IF 
     END IF 
endwend230520021: 
   IF negativsu% = - 1 THEN 
     suerg% = 0
   ELSE 
     suerg% = 1
   END IF 
   IF GMASuperCount% > 0 THEN 
     IF IsMASuper%(codema.KVERTRAG) <> - 1 THEN 
       vtok% = 0
       suerg% = 1
     END IF 
   END IF 
   IF vtok% = suerg% THEN 
     SELECT FIRST FILE GAdrDat$ INDEX codeku.GAdrDat$
     SELECT KEY codeku.kvertrag FILE GAdrDat$ INDEX codeku.GAdrDat$
     nachn$ = nachname.Gadrdat$ + "," + vorname.gadrdat$
     vs$ = TRIM$ ( PAD$ (VS_Nr.KVERTRAG,38))
     IF LEN (vs$) > 7 AND LEN (vs$) < 16 THEN vs$ = vs$ + CHR$ (9)
     IF LEN (vs$) < 7 THEN vs$ = vs$ + CHR$ (9) + CHR$ (9)
     zw$ = CHR$ (9) + CHR$ (9) + CHR$ (9) + CHR$ (9) + SPACE$ (30)
     x% = 1
     IF knr1% <> 0 THEN 
       daten1$ = LEFT$ (nachn$,20) + "/" + vs$ + CHR$ (9) + "/" + LEFT$ (Gesellschaft.kvertrag) + "/" + LEFT$ (Sparte.kvertrag) + "/" + LEFT$ (Agentur.kvertrag)
       x% = 0
     END IF 
     IF ma% <> 0 THEN 
       daten1$ = LEFT$ (Agentur.kvertrag) + "/" + vs$ + CHR$ (9) + LEFT$ (nachn$,20) + "/" + LEFT$ (Gesellschaft.kvertrag) + "/" + LEFT$ (Sparte.kvertrag)
       x% = 0
     END IF 
     IF ge% <> 0 THEN 
       daten1$ = LEFT$ (gesellschaft.kvertrag) + "/" + LEFT$ (sparte.kvertrag) + "/" + LEFT$ (Agentur.kvertrag) + "/" + vs$ + CHR$ (9) + LEFT$ (nachn$,20)
       x% = 0
     END IF 
     IF spa% <> 0 THEN 
       daten1$ = LEFT$ (Sparte.kvertrag) + "/" + LEFT$ (gesellschaft.kvertrag) + "/" + LEFT$ (Agentur.kvertrag) + vs$ + CHR$ (9) + LEFT$ (nachn$,20) + "/"
       x% = 0
     END IF 
     IF x% = 1 THEN 
       daten1$ = vs$ + CHR$ (9) + LEFT$ (nachn$,20) + CHR$ (9) + "/" + LEFT$ (Gesellschaft.kvertrag) + "/" + LEFT$ (Sparte.kvertrag) + "/" + LEFT$ (Agentur.kvertrag)
     END IF 
     IF akver1% = 2 THEN 
       daten1$ = LEFT$ (Kennzeichen.kvertrag) + "              " + daten1$
     END IF 
     IF akver1% = 3 THEN 
       daten1$ = LEFT$ (Fabrikat.kvertrag) + "              " + daten1$
     END IF 
     IF LEN (daten1$) < 58 THEN daten1$ = daten1$ + CHR$ (9)
     IF LEN (daten1$) < 47 THEN daten1$ = daten1$ + CHR$ (9)
     IF LEN (daten1$) < 44 THEN daten1$ = daten1$ + CHR$ (9)
     IF LEN (daten1$) < 38 THEN daten1$ = daten1$ + CHR$ (9)
     IF LEN (daten1$) < 30 THEN daten1$ = daten1$ + CHR$ (9)
     IF LEN (daten1$) < 20 THEN daten1$ = daten1$ + CHR$ (9)
     Laenge% = LEN (daten1$)
     daten1$ = daten1$ + " (" + von1$ + " - " + bis1$ + ")"
     Vertraege$(a%) = daten1$ + zw$ + STR$ (lfdnr.KVERTRAG,"000000")
     IF GCODIE% = - 1 AND dreq% <> 8 THEN CALL SearchVorbVe1("KVERTRAG")
     IF a% = 0 THEN prompt$ = Vertraege$(0)
     a% = a% + 1
   END IF 
 
   REM CALL Fehler( STR$ (i%),"")
   IF i% >= 1000 AND requnt% = 1 THEN 
     REM CALL Fehler("","")
     reqsu% = 1
     iber% = i% / 1000
     teix$ = "Es wurden bereits " + STR$ (i%,",99999999") + " DatensÑtze durchsucht"
     SELECT CASE iber%
       CASE 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20
         REQUEST teix$,"Wollen Sie die Suche fortsetzen?",130,reqsu%
       CASE 21,22,23,24,25,6,27,28,29,30,31,32,33,34,35,36,37
         REQUEST teix$,"Wollen Sie die Suche fortsetzen?",130,reqsu%
       CASE 38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59
         REQUEST teix$,"Wollen Sie die Suche fortsetzen?",130,reqsu%
       CASE 60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80
         REQUEST teix$,"Wollen Sie die Suche fortsetzen?",130,reqsu%
       CASE 81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99
         REQUEST teix$,"Wollen Sie die Suche fortsetzen?",130,reqsu%
     END SELECT 
     IF reqsu% <> 1 THEN GOTO raus011120031
   END IF 
   i% = i% + 1
   
   IF nurdatsu% <> - 1 THEN 
     SET STATUS "VertrÑge bearbeitet: " + STR$ (i%,",999999999") + "  von insgesamt: " + STR$ (z%,",999999999") + "    VertrÑge gefunden: " + STR$ (a%,"9999999")
   ELSE 
     zigdatu% = iind$$
     SET STATUS "VertrÑge bearbeitet: " + STR$ (i%,",999999999") + "  von insgesamt: " + STR$ (z%,",999999999") + "    VertrÑge gefunden: " + STR$ (a%,"9999999") + " Datum: " + DATE$ (zigdatu%,"0d.mm.yyyy")
   END IF 
   wi% = wi% + 1
   IF RECCOUNT ("KVERTRAG") < 15000 THEN 
     CALL Server("GaugeMessage","Vertragsdatei wird durchsucht... " + TRIM$ ( STR$ (a%,"999999999")) + " gefunden " + TRIM$ ( STR$ (wi%,"9999")))
     CALL Server("LISTBOXADD",daten1$)
   END IF 
   FILE "KVERTRAG"
   IF generellstop% <> - 1 THEN 
     SELECT NEXT FILE "KVERTRAG" INDEX iind$$
   ELSE 
     IF negativsu% = - 1 THEN 
       SELECT NEXT FILE "KVERTRAG" INDEX iind$$
     ELSE 
       SELECT LAST FILE "KVERTRAG"
       GOTO raus011120031
     END IF 
   END IF 
 WEND 
raus011120031: 
 tfoundadr% = a%
 SELECT WHERE FILE "kvertrag"
 REM CALL Fehler("Anzahl gefundener VertrÑge: ", STR$ (a%,"9999999"))
 CALL Gauge(0,"")
 SET STATUS ""
 MOUSE ON 
 IF a% = 0 THEN 
   GetVertrag% = 0
   CALL Fehler("Es wurden keine VertrÑge gefunden,die den Auswahlkriterien entsprachen!","Bitte Ñndern Sie die Auswahl!")
   FILE "Kvertrag"
   SELECT FIRST 
   GOTO VertKond140697anf
 ELSE 
   IF a% > 0 THEN 
     MOUSE ON 
     lok% = - 1
     kkkk% = 0
     WHILE lok%
       IF GCODIE% = - 1 AND dreq% <> 8 THEN 
         c$ = "aa"
         REM CALL Fehler("Suchergebnisanzeige","")
         req3% = 0
         IF kkkk% = 0 THEN 
           req3% = CALL ("_SearchShow",c$)
         ELSE 
           req3% = CALL ("_SearchReShow",c$)
         END IF 
 
         REM CALL Fehler("Suchergebnisanzeige",c$ + incMasse$)
         IF incMasse$ = "j" AND c$ <> "" AND NOT disabled%("VERTRBEARB") AND NOT disabled%("VERTRAGMASSECHANGE") THEN 
           REM MassenÑnderung
           CALL Fehler("Sie haben die Option gewÑhlt, alle gefunden VertrÑge zu Ñndern!","Es besteht die Mîglichkeit das Ablaufdatum, den Vertragswiedervorlage-Monat und/oder das Vertragswiedervorlage-Jahr zu Ñndern!")
           Ablauf$ = "n"
           WMona$ = "n"
           WJahra$ = "n"
w270320072: 
           CREATE DIALOG "KNDG",0,0,321,110,"VertragsÑnderung","MS Sans Serif",8
           ADD DIALOG "KNDG",9,3,14,21,23,2
           ADD DIALOG "KNDG",5,25,13,172,25,0,"Bitte kreuzen Sie die Felder an, die geÑndert werden sollen:"
 
           ADD DIALOG "KNDG",2,20,43,100,11,0,"Vertragsablaufdatum","j","n",Ablauf$
           ADD DIALOG "KNDG",6,130,43,41,11,0,0,AblaufF$,10
           ADD DIALOG "KNDG",2,20,55,105,11,0,"Vertragswiedervorlage-Monat","j","n",WMona$
           ADD DIALOG "KNDG",6,130,55,15,11,0,0,WMonatF$,2
           ADD DIALOG "KNDG",2,20,67,105,11,0,"Vertragswiedervorlage-Jahr","j","n",WJahra$
           ADD DIALOG "KNDG",6,130,67,25,11,0,0,WJahrF$,4
 
           ADD DIALOG "KNDG",1,100,85,55,15,1,"&OK",1,1
           ADD DIALOG "KNDG",1,156,85,55,15,0,"&Abbrechen",0,0
           DIALOG "KNDG",req%
           REMOVE DIALOG "KNDG"
           IF req% = 1 THEN 
             IF Ablauf$ = "j" THEN 
               IF DateOK%(AblaufF$) THEN 
                 AblaufF% = DAYS (AblaufF$)
                 IF ablaufF% < TODAY THEN 
                   CALL Fehler("Das Vertragsablaufdatum mu· grî·er HEUTE sein!","")
                   GOTO w270320072
                 END IF 
               ELSE 
                 CALL Fehler("Das Datum ist verkehrt, bitte geben Sie es in der Form dd.mm.yyyy ein!","")
                 GOTO w270320072
               END IF 
             END IF 
             IF WMona$ = "j" THEN 
               WMonatF% = VAL (WMonatF$)
               IF WMonatF% > 0 AND WMonatF% < 13 THEN 
               ELSE 
                 CALL Fehler("Sie haben beim Wiedervorlage-Monat einen falschen Wert eingegeben!","Der Wert muss >= 1 und <= 12 sein.")
                 GOTO w270320072
               END IF 
             END IF 
             IF WJahra$ = "j" THEN 
               WJahrF% = VAL (WJahrF$)
               jahr% = YEAR ( TODAY )
               jahr$ = STR$ (jahr%,"0000")
               IF WJahrF% >= jahr% THEN 
               ELSE 
                 CALL Fehler("Sie haben beim Wiedervorlage-Jahr einen falschen Wert eingegeben!","Der Wert muss >= " + jahr$ + " sein!")
                 GOTO w270320072 
               END IF 
             END IF 
             FILE "kvertrag"
             INDEX lfdnr.kvertrag
             FOR i% = 0 TO a% - 1
               IF Vertraege$(i%) <> "" THEN 
                 SET STATUS STR$ (i%) + " von " + STR$ (a%) + " DatensÑtze geÑndert"
                 codevt% = VAL ( RIGHT$ (Vertraege$(i%),6))
                 SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
                 SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
                 IF Ablauf$ = "j" THEN 
                   KÅndigung.kvertrag = AblaufF%
                 END IF 
                 IF WMona$ = "j" THEN 
                   WMon.kvertrag = WMonatF%
                 END IF 
                 IF WJahra$ = "j" THEN 
                   WJahr.kvertrag = WJahrF%
                 END IF 
                 CALL QuickStore("kvertrag")
               END IF 
             NEXT i%
             CALL Fehler("Die énderungen wurden durchgefÅhrt!","Es wurden " + LTRIM$ ( STR$ (a%,",99999999")) + " DatensÑtze geÑndert!")
           END IF 
           c$ = ""
         END IF 
 
         IF VAL (c$) <> 0 THEN 
           GetVertrag% = VAL (c$)
           req% = 1
           REM MENU 4,2,1,"aus Suchliste &wÑhlen,F7","DokKurzSuche","Auflistung aller vorher gesuchten Dokumente"
           ok% = 0
           SET STATUS "Dokument gefunden..."
         ELSE 
           IF req3% = 2 THEN 
             req% = 3
           ELSE 
             IF req3% = 3 THEN 
               REM drucken
               req% = 2
             ELSE 
               IF req3% = 4 THEN 
                 REM export excel
                 req% = 4
               ELSE 
                 req% = 0
               END IF 
             END IF 
           END IF 
         END IF 
       ELSE 
         CREATE DIALOG "ZEINLIST",0,0,440,330,"Vertrag suchen..." + STR$ (a%,",9999999"),"MS Sans Serif",8
         ADD DIALOG "ZEINLIST",4,0,0,438,300,0,""
         ADD DIALOG "ZEINLIST",9,8,11,25,24,2
         ADD DIALOG "ZEINLIST",5,35,15,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus."
         REM ADD DIALOG "ZEINLIST",5,6,28,398,10,0,"Vertrags-/Policennummer                         Kunde/Gesellschaft/Sparte/Agentur            von      bis"
         ADD DIALOG "ZEINLIST",7,6,38,425,255,2 + 128,2,Vertraege$,Auswahl$,prompt$
         ADD DIALOG "ZEINLIST",1,36,310,55,15,1,"&OK",1,1
         ADD DIALOG "ZEINLIST",1,93,310,55,15,0,"&Abbrechen",0,0
         IF MNdisabled%("VERTRDRUCK") THEN 
         ELSE 
           ADD DIALOG "ZEINLIST",1,149,310,55,15,0,"&Drucken",2,0
           ADD DIALOG "ZEINLIST",1,205,310,95,15,0,"Adressen exportieren",3,0
           ADD DIALOG "ZEINLIST",1,301,310,125,15,0,"VertrÑge nach MS EXCEL exportieren",4,0
 
           REM ADD DIALOG "ZEINLIST",1,306,310,55,15,0,"&Summenliste",3,0
         END IF 
         DIALOG "ZEINLIST",req%
         REMOVE DIALOG "ZEINLIST"
       END IF 
       kkkk% = kkkk% + 1
       a% = tfoundadr%
       SELECT CASE req%
       CASE 4
         REM VertrÑge nach EXCEL exportieren
         ON ERROR GOTO end300320041
         CALL DFile(3,"KVEXEXP" + _fpw$)
         CALL DFile(3,"AGDIR" + _fpw$)
         FILE "agdir"
         INDEX codeagdir.agdir
         FILE "KVEXEXP"
         SELECT FIRST 
         IF RECCOUNT ("KVEXEXP") > 0 THEN REMOVE FROM FILE "KVEXEXP"
         CALL Fehler("Export nach MS Excel","")
         FOR i% = 0 TO a%
            IF Vertraege$(i%) <> "" THEN 
              SET STATUS STR$ (i%) + " von " + STR$ (a%) + " DatensÑtze kopiert"
              codevt% = VAL ( RIGHT$ (Vertraege$(i%),6))
              SELECT KEY codevt% FILE "kvertrag" INDEX lfdnr.kvertrag
              SELECT FIRST FILE "maadr" INDEX codema.maadr
              SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
              SELECT FIRST FILE "AGDIR" INDEX codeagdir.agdir
              SELECT KEY codeagdir.maadr FILE "AGDIR" INDEX codeagdir.agdir
              SELECT FIRST FILE "ADRESSEN" INDEX codeku.adressen
              SELECT KEY codeku.kvertrag FILE "ADRESSEN" INDEX codeku.adressen
              SELECT FIRST FILE "sparten" INDEX codeva.sparten
              SELECT KEY codeva.kvertrag FILE "sparten" INDEX codeva.sparten
              SELECT FIRST FILE "spgruppe" INDEX codegrsp.spgruppe
              SELECT KEY codegrsp.sparten FILE "spgruppe" INDEX codegrsp.spgruppe
              IF GASP% = - 1 THEN 
                SELECT FIRST FILE "filiale" INDEX filialnr.filiale
                SELECT KEY workstation.kvertrag FILE "filiale" INDEX filialnr.filiale
              END IF 
              BLANK FILE "KVEXEXP"
              REM axxxa% = CopyRecord%("KVERTRAG","KVEXEXP")
              VNehmer.KVexexp = VNehmer.kvertrag

              IF Inhaus.kvertrag = 1 THEN 
                inhouse.kvexexp = "J"
              ELSE 
                inhouse.kvexexp = "N"
              END IF 
              Gesellschaft.kvexexp = Gesellschaft.kvertrag
              Sparte.kvexexp = Sparte.kvertrag
              IF MNdisabled%("SEEEINGBEI") THEN 
              ELSE 
                Eingereicht_Bei.kvexexp = EingereichtBei.kvertrag
              END IF 
              VS_NR.kvexexp = VS_NR.kvertrag
              Direktion.kvexexp = Direktion.agdir
              Einheiten.kvexexp = STR$ (Einheiten.kvertrag,",999999.0000")
              VStatus.kvexexp = VStatusTxT.kvertrag
              IF Antragsdatum.kvertrag > 0 THEN Antragsdatum.kvexexp = DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy")
              IF VS_Beginn.kvertrag > 0 THEN VS_Beginn.kvexexp = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
              IF KÅndigung.kvertrag > 0 THEN Kuendigung.kvexexp = DATE$ (KÅndigung.kvertrag,"0d.mm.yyyy")
              IF beitrag.kvertrag > 0 THEN Beitrag.kvexexp = LTRIM$ ( STR$ (Beitrag.kvertrag,",99999999.00"))
              IF Bewertungssumme.kvertrag > 0 THEN Bewertungssumme.kvexexp = LTRIM$ ( STR$ (Bewertungssumme.kvertrag,",9999999999"))
              IF VSumme.kvertrag > 0 THEN VSUmme.kvexexp = LTRIM$ ( STR$ (VSUmme.kvertrag,",9999999999"))
              Waehrung.kvexexp = Waehrung.kvertrag
              Kennzeichen.kvexexp = Kennzeichen.kvertrag
              Fabrikat.kvexexp = Fabrikat.kvertrag
              Typ_Nr.kvexexp = Typ_Nr.kvertrag
              zwtxt.KVEXEXP = ZW2Str$(ZW.KVERTRAG)
              SRHaftung.kvexexp = LTRIM$ ( STR$ (SRHaftung.kvertrag,"999"))
              Postanschrift.kvexexp = Postanschrift.adressen
              POSTBriefanrede.kvexexp = POSTBriefanrede.adressen
              Vermittler.kvexexp = Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr
              PostanVermittle.kvexexp = Postanschrift.maadr
              Agenturnr.kvexexp = Agenturnr.maadr
              spartenart.kvexexp = spartenart.sparten
              spartengruppe.kvexexp = gruppe.spgruppe
              IF GASP% = - 1 THEN Buero.kvexexp = Name.filiale
              ProvSperreJN.kvexexp = ProvSperreJN.kvertrag
              IF ProvSperreVom.kvertrag > 0 THEN ProvSperreVom.kvexexp = DATE$ (ProvSperreVom.kvertrag,"0d.mm.yyyy")
              BerProtok.kvexexp = BerProtok.kvertrag
              IF BerProtokVom.kvertrag > 0 THEN BerProtokVom.kvexexp = DATE$ (BerProtokVom.kvertrag,"0d.mm.yyyy")
              REM IF vs_Beginn.KVEXEXP < 1 THEN vs_Beginn.KVEXEXP = 1
              REM CALL Fehler("Export0 nach Excel","")
              IF EXISTS (codeku.kvertrag,codeku.telefon) THEN 
                SELECT FIRST FILE "telefon" INDEX Qcodekutel.telefon
                Qcodekutel$ = STR$ (codeku.kvertrag,"000000") + "000000"
                SELECT KEY Qcodekutel$ FILE "telefon" INDEX Qcodekutel.telefon
                itel% = 0
                WHILE NOT EOF ("telefon") AND codeku.telefon = codeku.kvertrag AND itel% < 5
                  itel% = itel% + 1
                  IF codeku.telefon = codeku.kvertrag AND itel% < 5 THEN 
                    feldt$ = "Tel" + STR$ (itel%,"0") + ".kvexexp"
                    feldt$$ = Art.telefon + " " + nummer.telefon
                  END IF 
                  SELECT NEXT FILE "telefon" INDEX Qcodekutel.telefon
                WEND 
              END IF 
              Nachname.kvexexp = Nachname.adressen
              Vorname.kvexexp = Vorname.adressen
              Ort.kvexexp = Ort.adressen
              Plz.kvexexp = plz.adressen
              Strasse.kvexexp = Stra·e.adressen
              STORE FILE "KVEXEXP"
            END IF 
         NEXT i%
         REM CALL Fehler("Export0 nach Excel","Zwischendatei beendet")
         dateiname1$ = "*.xls"
w190420061: 
         REQUEST "Speichern als MS Excel-Datei..."," ",27,req%,dateiname1$
         IF req% <> 0 AND LTRIM$ (dateiname1$) = "" THEN 
           CALL Fehler("Bitte fÅllen Sie den Dateinamen korrekt aus (maximal 8 Zeichen vor dem Punkt, danach XLS)","")
           GOTO w190420061
         END IF 
         IF req% <> 0 THEN 
           FILE "KVEXEXP"
           INDEX vnehmer.kvexexp
           SELECT FIRST FILE "KVEXEXP"
           MOUSE OFF 
           msg$ = "öbergabe der Daten an die MS Excel-Datei!"
           SET STATUS msg$
           REM CALL Fehler("","")
           ON ERROR GOTO VexpEx170420021
           REM EXPORT FILE "KVEXEXP" TO dateiname1$
           Superbase.Converters.SBF.SourceFormat = "Superbase":REM Menu:  ExportFile
           Superbase.Converters.SBF.SourceFile = "KVEXEXP"
           Superbase.Converters.SBF.Descending = 0
           Superbase.Converters.SBF.Merge = 0
           Superbase.Converters.SBF.LogErrors = 0
           Superbase.Converters.SBF.MultiResponse = 0
           Superbase.Converters.XLS.DestFormat = "Microsoft Excel"
           Superbase.Converters.XLS.DestFile = dateiname1$
           Superbase.Converters.XLS.StartRow = 2
           Superbase.Converters.XLS.StartCol = 1
           Superbase.Converters.XLS.EndRow = - 1
           Superbase.Converters.XLS.EndCol = - 1
           Superbase.Converters.XLS.UseLabels = - 1
           Superbase.Converters.XLS.Convert(Superbase.Converters.SBF)
           MOUSE ON 
           a% = CALL ("ShellExecute",0,"open",dateiname1$,"","",1)
VexpEx170420021: 
           ON ERROR GOTO ErrorHandler
           WAIT FOR 2
           CLOSE FILE "KVEXEXP"
           CALL Fehler("Ausgabe nach MS Excel ist beendet!","")
           MOUSE ON 
         END IF 
       CASE 1
         REM in den Vertrag springen
         IF GCODIE% = - 1 THEN 
         ELSE 
           GetVertrag% = VAL ( RIGHT$ (Auswahl$(0),6))
           prompt$ = Auswahl$(0)
         END IF 
         SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
         cuvt% = GetVertrag%
         knr% = Codeku.kvertrag
         SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
         REM CALL KVERTRAG()
         lfdnr% = lfdnr.kvertrag
         REM SELECT WHERE FILE "kvertrag"
         CALL KVERTRAGneu(lfdnr%)
         REM mit Abfrage gestalten CALL VertrKond()
       CASE 3
         REM Adressen exportieren
         ON ERROR GOTO ErrorHandler
         REDIM AdrFound$(a%,1)
         REDIM AdrFound$(a%)
         REM Ñu·ere Schleife fÅr die gefundenen VertrÑge
         FOR i% = 0 TO a%
            IF Vertraege$(i%) <> "" THEN 
              codevt% = VAL ( RIGHT$ (Vertraege$(i%),6))
              SELECT KEY codevt% FILE "kvertrag" INDEX lfdnr.kvertrag
              REM innere Schleife, um festzustelen, ob die codeku schon im array existiert
              REM b% ist der Platzhalter wo die codeku hin soll
              b% = 0
              FOR j% = 0 TO a%
                IF AdrFound$(j%) <> "" THEN 
                     codeku% = VAL ( RIGHT$ (AdrFound$(j%),6))
                  IF AdrFound$(j%) = STR$ (codeku.kvertrag,"000000") THEN 
                    j% = a% + 1
                  END IF 
                ELSE 
                  AdrFound$(j%) = STR$ (codeku.kvertrag,"000000")
                  b% = 1
                  j% = a% + 1
                END IF 
              NEXT j%
              IF b% > 0 THEN 
                REM codeku wurde eingetragen
                SELECT KEY codeku.kvertrag FILE "adressen" INDEX codeku.adressen
                REM CALL Fehler(vorname.adressen + " " + nachname.adressen, STR$ (codeku.adressen))
              END IF 
            END IF 
         NEXT i%
         CALL Fehler("AUFRUF DER SERIENBRIEFVERARBEITUNG","")
         adrser% = 1
         CALL SerieNeu1("ADRESSEN")
       CASE 0
         lok% = 0
       CASE 2
         MOUSE OFF 
         REM Drucken
         IF eurosupport$ = "TRUE" THEN 
           t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
           t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
           IF DruInEur.stamm = 1 THEN 
             req% = 1
           ELSE 
             CALL Fehler(t1$,t2$)
             REQUEST "öbersicht in EURO drucken?","",130,req%
           END IF 
           IF req% = 1 THEN 
             eu% = 1
             drwaehr$ = " in EUR"
           ELSE 
             eu% = 0
             drwaehr$ = " in allen WÑhrungen"
           END IF 
         END IF 
         REQUEST "Telefonnummern des Kunden ebenfalls drucken?","",135,ktel%
         IF dreq% <> 8 THEN 
           FormatPrint$ = "A4h"
           REM 981117 Euroabfrage
           title2$ = "VertragsÅbersicht entsprechend der festgelegten Kriterien"
           
           
           title2$ = title2$ + drwaehr$
           CALL VPEINI(title2$,FormatPrint$)
           cPage% = CALL ("VpeGetCurrentPage",hdoc%)
           cPageold% = cPage%
           b% = 1
           vzeil% = mTop%
           CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
           CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
           CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
           obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
           CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
           obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
           vzeil% = obBottom% + 10
           ueberpos% = vzeil%
           CALL VTransp(0)
           CALL VSetPen(0,0)
           zeilenabstand% = 40
           zeilenoffset% = 40
           i% = 1
           aa% = a%
           SumBei% = 0
           SumBew% = 0
           SumVS% = 0
           SUMEinh% = 0
           FOR i% = 0 TO aa% - 1
             SET STATUS "Summen berechnen " + STR$ (i%,"99999999") + " von " + STR$ (aa%,"9999999999")
             GetVertrag% = VAL ( RIGHT$ (Vertraege$(i%),6))
             SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
             IF eu% = 1 THEN 
               euro% = umrechnung.kvertrag
               waehr$ = " Euro"
             ELSE 
               euro% = 1
               waehr$ = waehrung.kvertrag
             END IF 
             SELECT CASE zw.kvertrag
               CASE 0
                 SumBei% = SumBei% + VAL ( STR$ (Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 1
                 SumBei% = SumBei% + VAL ( STR$ (Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 4
                 SumBei% = SumBei% + VAL ( STR$ (4 * Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 6
                 SumBei% = SumBei% + VAL ( STR$ (6 * Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 2
                 SumBei% = SumBei% + VAL ( STR$ (2 * Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 12
                 SumBei% = SumBei% + VAL ( STR$ (12 * Beitrag.kvertrag / euro%,"999999999.00"))
             END SELECT 
             SumBew% = SumBew% + VAL ( STR$ (BewertungsSumme.kvertrag / euro%,"999999999.00"))
             SumVS% = SumVS% + VAL ( STR$ (VSumme.kvertrag / euro%,"999999999.00"))
             SUMEinh% = SUMEinh% + Einheiten.kvertrag
           NEXT i%
           FOR i% = 0 TO aa% - 1
             obBottom% = vzeil%
             GetVertrag% = VAL ( RIGHT$ (Vertraege$(i%),6))
             SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
             cuvt% = GetVertrag%
             knr% = Codeku.kvertrag
             IF eu% = 1 THEN 
               euro% = umrechnung.kvertrag
               waehr$ = " Euro"
             ELSE 
               euro% = 1
               waehr$ = waehrung.kvertrag
             END IF 
             SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
             knr$ = Kundennummer.GAdrDat$
             name$ = Nachname.GAdrDat$ + " ," + Vorname.GAdrDat$
             Ort$ = plz.GAdrDat$ + "-" + ort.GAdrDat$ + " ," + stra·e.GAdrDat$
             SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
             mitarb$ = Nachname.maadr + ", " + Vorname.maadr
             IF EXISTS (codeku.kvertrag,codeku.telefon) THEN 
               SELECT FIRST FILE "Telefon" INDEX codeku.telefon
               SELECT KEY codeku.kvertrag FILE "Telefon" INDEX codeku.telefon
             END IF 
             a% = vzeil%
             cPage% = CALL ("VpeGetCurrentPage",hdoc%)
             cPageold% = cPage%
             ok% = - 1
VertKorrDr140697: 
             czeile% = vzeil%
             REM CALL Fehler("","")
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Kundennummer: ")
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + knr$)
             a% = vzeil%
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + name$ + ", " + ort$)
             CALL VWrite(mleft%,a%,460,"['Arial' S 8 B C BLACK]" + "Name: ")
             a% = vzeil%
             IF EXISTS (codeku.kvertrag,codeku.telefon) AND ktel% = 1 THEN 
               WHILE NOT EOF ("Telefon") AND codeku.telefon = codeku.kvertrag
                 CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + art.telefon + " ")
                 CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + nummer.telefon)
                 a% = vzeil%
                 SELECT NEXT FILE "Telefon" INDEX codeku.telefon
               WEND 
             END IF 
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Betreuung durch: ")
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + mitarb$)
             a% = vzeil%
             ges$ = LTRIM$ (Gesellschaft.kvertrag)
             spa$ = LTRIM$ (sparte.kvertrag)
             agentur$ = LTRIM$ (Agentur.kvertrag)
             Statu1$ = " / Status: " + LTRIM$ (VstatusTXT.kvertrag)
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Ges./Sparte/Agentur: ")
             CALL VWrite(mleft% + 290,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + Ges$ + "/" + spa$ + "/" + agentur$ + statu1$)
             a% = vzeil%
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Antragsdatum: ")
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy"))
             CALL VPrint(mleft% + 420,a%,"['Arial' S 8 B C BLACK]" + "Vertragsbeginn: ")
             CALL VWrite(mleft% + 640,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy"))
             CALL VPrint(mleft% + 800,a%,"['Arial' S 8 B C BLACK]" + "Ablauf: ")
             CALL VWrite(mleft% + 950,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (KÅndigung.kvertrag,"0d.mm.yyyy"))
             CALL VPrint(mleft% + 1200,a%,"['Arial' S 8 B C BLACK]" + "Dauer: ")
             CALL VWrite(mleft% + 1300,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + STR$ (VS_Dauer.kvertrag,"99"))
             a% = vzeil%
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Bewertungssumme: ")
             textt1$ = "      Einheiten: " + LTRIM$ ( STR$ (Einheiten.kvertrag,"9999999.0000"))
  CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + STR$ (BewertungsSumme.Kvertrag / euro%,",99999999.00") + waehr$ + "   Volumen: " + STR$ (Volumen.kvertrag,",99999999.00") + "  SRH: " + STR$ (SRHaftung.kvertrag,",999") + textt1$)
             a% = vzeil%
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Policenr: ")
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + VS_NR.kvertrag)
             CALL VWrite(mleft% + 570,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + "  Versicherungssumme: " + STR$ (VSumme.Kvertrag / euro%,",99999999.00") + waehr$ + "   Beitrag:" + STR$ (Beitrag.kvertrag / euro%,",99999999.00") + waehr$)
 
             a% = vzeil%
             SELECT CASE zw.kvertrag
               CASE 0
                 
                 zw$ = "Zahlweise: Einmalig"
                 REM SumBei% = SumBei% + Beitrag.kvertrag / euro%
               CASE 1
                 zw$ = "Zahlweise: JÑhrlich"
                 REM SumBei% = SumBei% + Beitrag.kvertrag / euro%
               CASE 4
                 zw$ = "Zahlweise: VierteljÑhrlich"
                 REM SumBei% = SumBei% + 4 * Beitrag.kvertrag / euro%
               CASE 2
                 zw$ = "Zahlweise: HalbjÑhrlich"
                 REM SumBei% = SumBei% + 2 * Beitrag.kvertrag / euro%
               CASE 6
                 zw$ = "Zahlweise: 2monatlich"
                 REM SumBei% = 6 * Beitrag.kvertrag
               CASE 12
                 zw$ = "Zahlweise: Monatlich"
                 REM SumBei% = SumBei% + 12 * Beitrag.kvertrag / euro%
             END SELECT 
             REM SumBew% = SumBew% + BewertungsSumme.kvertrag / euro%
             REM SumVS% = SumVS% + VSumme.kvertrag / euro%
             IF GSoll$ LIKE "j" THEN 
               IF sollst.kvertrag LIKE "j" THEN zw$ = zw$ + "      SollstellungsÅberwachung"
             END IF 
             CALL VWrite(mleft%,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + "verprovisioniert seit: " + DATE$ (Proviab.kvertrag,"0d.mm.yyyy") + "       " + zw$)
             IF LTRIM$ (notiz.kvertrag) <> "" THEN 
               a% = vzeil%
               CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Notiz: ")
               CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + LTRIM$ (notiz.kvertrag))
             END IF 
             a% = vzeil% + 5
             CALL VLine(mleft% - 7,a%,mright%,a%)
             vzeil% = vzeil% + 25
             SET STATUS "VertrÑge bearbeitet: " + STR$ (i%,"9999999") + "  von insgesamt: " + STR$ (aa%,"999999999")
 
             IF obBottom% >= mBottom% THEN 
               CALL VTransp(0)
               CALL VBox(mleft% - 7,czeile%,mright%,obBottom% + 550)
               CALL VLine(mleft% - 7,mtop%,mleft% - 7,czeile%)
               CALL VLine(mright%,mtop%,mright%,czeile%)
               CALL VLine(mleft% - 7,czeile%,mright%,czeile%)
               a% = CALL ("VpePageBreak",hdoc%)
               REM CALL VTransp(1)
               vzeil% = ueberpos%
               a% = vzeil%
               obbottom% = vzeil%
               GOTO VertKorrDr140697
             END IF 
 
           NEXT i%
           vzeil% = vzeil% + 10
           CALL VLine(mleft% - 7,mtop%,mleft% - 7,vzeil%)
           CALL VLine(mright%,mtop%,mright%,vzeil%)
           CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
           vzeil% = vzeil% + 20
           ss1$ = STR$ (aa%,",9999999999") + "   Summe BeitrÑge: " + LTRIM$ ( STR$ (SumBei%,",9999999999.00")) + "   Summe Bewertung: " + LTRIM$ ( STR$ (SumBew%,",9999999999.00"))
           ss2$ = "Summe Vers.summen: " + LTRIM$ ( STR$ (SumVS%,",9999999999.00")) + "             Summe Einheiten: " + LTRIM$ ( STR$ (SUMEinh%,",9999999999.0000"))
           CALL VPrint(mleft%,vzeil% + 10,"['Arial' S 8 B C BLACK]Anzahl VertrÑge: " + ss1$)
           CALL VPrint(mleft%,vzeil% + 45,"['Arial' S 8 B C BLACK]" + ss2$)
           CALL VPrint(mleft%,vzeil% + 100,"['Arial' S 12 B C BLACK]Ende der Liste")
           cPage% = CALL ("VpeGetCurrentPage",hdoc%)
 
           FOR b% = 1 TO cPage%
             vzeil% = mTop%
             a% = CALL ("VpeGotoPage",hdoc%,b%)
             CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
             CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
             CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
             obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
             CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
           NEXT b%
           a% = CALL ("VpeGotoPage",hdoc%,1)
           MOUSE ON 
           CALL Fehler("Bitte nach dem Ausdruck eine Taste drÅcken!","")
           CALL VPrevDoc()
           WAIT MOUSE OR KEY OR MENU 
           REM APPACTIVATE "Vertrags"
           CALL Fehler("Ausdruck wurde beendet!","Um fortzufahren bitte auf den OK-Button drÅcken!")
           REM APPACTIVATE "VertragsÅbersicht in EUR"
           REM Nach dem Drucken, Drucker auf A4 hoch setzen
           REM c$ = PRINTER :d$ = PRINTER (0):SET PRINTER c$,d$,1,9
 
         ON ERROR GOTO adrdr170920022
         IF PRINTER (1) = 1 OR PRINTER (1) = 2 THEN 
           c$ = PRINTER :d$ = PRINTER (0)
           SET PRINTER c$,d$,1,9
           REM PRINT CURRENT PAGE 
           GOTO endruck170920022
         END IF 
         
adrdr170920022: 
         MOUSE ON 
         REM c$ = PRINTER :d$ = PRINTER (0)
         ON ERROR GOTO endruck170920022
         SET PRINTER 
         REM PRINT CURRENT PAGE 
         FORM 
endruck170920022: 
         ON ERROR GOTO ErrorHandler 
 
           lok% = 0
           REM GOTO VertKond140697end
         ELSE 
           REM Statistik 090298
           opt% = 1
           CREATE DIALOG "ADRFilter",0,0,109,110,title$,"MS Sans Serif",8
           ADD DIALOG "ADRFilter",4,4,1,101,77,0," Statistik nach "
           ADD DIALOG "ADRFilter",3,8,20,69,12,0,"Agentursicht",1,opt%
           ADD DIALOG "ADRFilter",3,8,39,69,12,0,"Gesellschaftssicht",2,opt%
           REM ADD DIALOG "ADRFilter",3,8,36,22,12,0,"Ort",3,opt%
           REM ADD DIALOG "ADRFilter",3,8,48,29,12,0,"PLZ",4,opt%
           ADD DIALOG "ADRFilter",1,4,92,50,15,1,"&Weiter",1,1
           ADD DIALOG "ADRFilter",1,56,92,50,15,0,"&Abbruch",0,0
           DIALOG "ADRFilter",req%
           REMOVE DIALOG ALL 
           IF req% > 0 THEN 
             CALL Fehler("Bitte nach der Ausgabe des Berichtes irgendeine Taste betÑtigen, um die Steuerung an das Programm zurÅckzugeben!","")
             REQUEST "Einheiten addieren(JA) oder Volumen addieren(Nein)?","",130,einhadd%
             IF OPEN ("statist") THEN CLOSE FILE "statist"
             CALL DFile(3,"statist" + _fpw$)
             REMOVE FROM FILE "Statist"
             IF OPEN ("statist2") THEN CLOSE FILE "statist2"
             CALL DFile(3,"statist2" + _fpw$)
             REMOVE FROM FILE "Statist2"
             FOR i% = 0 TO a% - 1
               GetVertrag% = VAL ( RIGHT$ (Vertraege$(i%),6))
               SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
               SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
               FILE "Statist"
               SET STATUS "Schreibe Datensatz: " + STR$ (i%,"9999999") + " von :" + STR$ (a%,"9999999")
               BLANK FILE "STATIST"
               Gesellschaft.statist = Gesellschaft.kvertrag
               codege.statist = codege.kvertrag
               Spartengruppe.statist = Spartengruppe.kvertrag
               codeva.statist = codeva.kvertrag
               Sparte.statist = Sparte.kvertrag
               umrechnung.statist = umrechnung.kvertrag
               waehrung.statist = waehrung.kvertrag
               AGNachname.statist = Nachname.maadr
               AGVorname.statist = Vorname.maadr
               Agenturnr.statist = Agenturnr.maadr
               IF codemagr.maadr < 1 THEN 
                 MAGruppe.statist = "<ohne Zourdnung>"
                 codemagr.statist = 0
               ELSE 
                 MAGruppe.statist = magruppe.maadr
                 codemagr.statist = codemagr.maadr
               END IF 
 
               IF eu% = 1 THEN 
                 euro% = umrechnung.kvertrag
                 waehr$ = " Euro"
               ELSE 
                 euro% = 1
                 waehr$ = waehrung.kvertrag
               END IF 
               codema.statist = Codema.maadr
               bewertung.statist = VAL ( STR$ (Bewertungssumme.kvertrag / euro%,"999999999.00"))
               IF einhadd% = 0 THEN 
                 Volumen.statist = Volumen.kvertrag
               ELSE 
                 Volumen.statist = Einheiten.kvertrag
               END IF 
               VSumme.statist = VAL ( STR$ (Vsumme.kvertrag / euro%,"999999999.00"))
               codegrsp.statist = codegrsp.kvertrag
               SumBei% = 0
               SELECT CASE zw.kvertrag
                 CASE 0
                   zw$ = "Zahlweise: Einmalig"
                   SumBei% = Beitrag.kvertrag
                 CASE 1
                   zw$ = "Zahlweise: JÑhrlich"
                   SumBei% = Beitrag.kvertrag
                 CASE 4
                   zw$ = "Zahlweise: VierteljÑhrlich"
                   SumBei% = 4 * Beitrag.kvertrag
                 CASE 6
                   zw$ = "Zahlweise: 2monatlich"
                   SumBei% = 6 * Beitrag.kvertrag
                 CASE 2
                   zw$ = "Zahlweise: HalbjÑhrlich"
                   SumBei% = 2 * Beitrag.kvertrag
                 CASE 12
                   zw$ = "Zahlweise: Monatlich"
                   SumBei% = 12 * Beitrag.kvertrag
               END SELECT 
               Jahresbeitrag.statist = VAL ( STR$ (SumBei% / euro%,"999999999.00"))
               QMAGR.statist = MAGruppe + AGNachname + Agenturnr + Gesellschaft + SpartenGruppe + Sparte
               QGes.statist = Gesellschaft + SpartenGruppe + Sparte + MAGruppe + AGNachname + Agenturnr
               QCode.statist = STR$ (codemagr.statist,"000000") + STR$ (codema.statist,"000000") + STR$ (codege.statist,"000000") + STR$ (codeva.statist,"000000")
               qcmagrag.statist = STR$ (codemagr.statist,"000000") + STR$ (codema.statist,"000000")
               qcmge.statist = STR$ (codemagr.statist,"000000") + STR$ (codema.statist,"000000") + STR$ (codege.statist,"000000")
               qGesSpa.statist = STR$ (codege.statist,"000000") + STR$ (codeva.statist,"000000")
               qGesSpaMAGr.statist = STR$ (codege.statist,"000000") + STR$ (codeva.statist,"000000") + STR$ (codemagr.statist,"000000")
               qGesAll.statist = STR$ (codege.statist,"000000") + STR$ (codeva.statist,"000000") + STR$ (codemagr.statist,"000000") + STR$ (codema.statist,"000000")
               STORE 
             NEXT i%
             REM AGENTURSICHT
 
             IF opt% = 1 THEN 
               REM s1B%:s1V%:s1Bei%:s1Vol%:anz1%  Summen +Anzahl Gesamt                                                
               REM s2B%:s2V%:s2Bei%:s2Vol%:anz2%  Summen + Anzahl nach Agenturgruppe                                     
               REM s3B%:s3V%:s3Bei%:s3Vol%:anz3%  Summen + Anzahl jeder zugehîrigen Agentur                              
               REM s4B%:s4V%:s4Bei%:s4Vol%:anz4%  Summen + Anzahl der Agenturgruppe fÅr VertrÑge einer Gesellschaft      
               REM s5B%:s5V%:s5Bei%:s5Vol%:anz5%  Summen + Anzahl der Agentur fÅr VertrÑge einer Gesellschaft            
               REM s6B%:s6V%:s6Bei%:s6Vol%:anz6%  Summen + Anzahl der Agenturgruppe fÅr VertrÑge jeder Spartengruppe diese Gesellschaft
               REM s7B%:s7V%:s7Bei%:s7Vol%:anz7%  Summen + Anzahl der Agentur fÅr VertrÑge jeder Spartengruppe diese Gesellschaft
               REM s8B%:s8V%:s8Bei%:s8Vol%:anz8%  Summen + Anzahl der Agenturgruppe fÅr VertrÑge jeder Sparte dieser Spartengruppe in der Gesellschaft 
               REM s9B%:s9V%:s9Bei%:s9Vol%:anz9%  Summen + Anzahl der Agentur fÅr VertrÑge jeder Sparte dieser Spartengruppe in der Gesellschaft 
 
               s1B% = 0:s1V% = 0:s1Bei% = 0:s1Vol% = 0:anz1% = 0
               s2B% = 0:s2V% = 0:s2Bei% = 0:s2Vol% = 0:anz2% = 0
               s3B% = 0:s3V% = 0:s3Bei% = 0:s3Vol% = 0:anz3% = 0
               s4B% = 0:s4V% = 0:s4Bei% = 0:s4Vol% = 0:anz4% = 0
               s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
               s6B% = 0:s6V% = 0:s6Bei% = 0:s6Vol% = 0:anz6% = 0
               s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
               s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
               s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
               FILE "STATIST"
               INDEX codemagr.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               i% = 0
               
               REM CALL Fehler("STATIST","")
               codemagr% = codemagr.statist
               QCode$ = qcode.statist
               qcmagrag$ = qcmagrag.statist
               qcmge$ = qcmge.statist
               SELECT FIRST 
               
               REM ALLE VERTRéGE
               WHILE NOT EOF ("Statist")
                 i% = i% + 1
                 anz1% = anz1% + 1:s1B% = s1B% + Bewertung.statist:s1V% = s1V% + VSumme.statist:s1Bei% = s1Bei% + Jahresbeitrag.statist:s1Vol% = s1Vol% + Volumen.statist
                 SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 1 von 5: " + STR$ (i%,"99999999")
                 FILE "STATIST"
                 SELECT NEXT FILE "STATIST"
               WEND 
 
               REM ALLE AGENTURGRUPPEN
               FILE "Statist2"
               BLANK FILE "Statist2"
               codest2% = SER ("STATIST2")
               codest2.statist2 = codest2%
               STORE FILE "Statist2"
               SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
               CALL StoreStatist2(0,0,"","","","","","",0,"",0,"",0,1)
               FILE "Statist"
               INDEX codemagr.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               SELECT KEY codemagr% FILE "statist" INDEX codemagr.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE codemagr.statist = codemagr% AND NOT EOF ("statist")
                   i% = i% + 1
                   anz2% = anz2% + 1:s2B% = s2B% + Bewertung.statist:s2V% = s2V% + VSumme.statist:s2Bei% = s2Bei% + Jahresbeitrag.statist:s2Vol% = s2Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 2 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(codemagr%,0,"","","",agruppeold$,"","",0,"",0,"",0,2)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 s2B% = 0:s2V% = 0:s2Bei% = 0:s2Vol% = 0:anz2% = 0
               WEND 
 
               REM ALLE AGENTURGRUPPEN-AGENTUREN
               FILE "Statist"
               INDEX qcmagrag.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               qcmagrag$ = qcmagrag.statist
               SELECT KEY qcmagrag$ FILE "statist" INDEX qcmagrag.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE qcmagrag.statist = qcmagrag$ AND NOT EOF ("statist")
                   i% = i% + 1
                   anz3% = anz3% + 1:s3B% = s3B% + Bewertung.statist:s3V% = s3V% + VSumme.statist:s3Bei% = s3Bei% + Jahresbeitrag.statist:s3Vol% = s3Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 3 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,"","",0,"",0,"",0,3)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 qcmagrag$ = qcmagrag.statist
                 s3B% = 0:s3V% = 0:s3Bei% = 0:s3Vol% = 0:anz3% = 0
               WEND 
               REM CALL Fehler("GES","")
               REM ALLE AGENTURGRUPPEN-AGENTUREN-GESELLSCHAFTEN
               FILE "Statist"
               INDEX qcmge.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               qcmge$ = qcmge.statist
               SELECT KEY qcmge$ FILE "statist" INDEX qcmge.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE qcmge.statist = qcmge$ AND NOT EOF ("statist")
                   i% = i% + 1
                   anz4% = anz4% + 1:s4B% = s4B% + Bewertung.statist:s4V% = s4V% + VSumme.statist:s4Bei% = s4Bei% + Jahresbeitrag.statist:s4Vol% = s4Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 4 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,"",ges$,codege%,"",0,"",0,4)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 qcmge$ = qcmge.statist
                 s4B% = 0:s4V% = 0:s4Bei% = 0:s4Vol% = 0:anz4% = 0
               WEND 
 
               REM ALLE AGENTURGRUPPEN-AGENTUREN-GESELLSCHAFTEN-SPARTEN
               FILE "Statist"
               INDEX qcode.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               qcode$ = qcode.statist
               SELECT KEY qcode$ FILE "statist" INDEX qcode.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE qcode.statist = qcode$ AND NOT EOF ("statist")
                   i% = i% + 1
                   anz5% = anz5% + 1:s5B% = s5B% + Bewertung.statist:s5V% = s5V% + VSumme.statist:s5Bei% = s5Bei% + Jahresbeitrag.statist:s5Vol% = s5Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 5 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,"",ges$,codege%,"",0,sp$,codeva%,5)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 qcode$ = qcode.statist
                 s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
               WEND 
               REM ANFANG AUSDRCK STATISTIK
               CALL Fehler("ANFANG AUSDRUCK STATISTIK","")
               FILE "STATIST2"
               INDEX qmagr.statist2
               SELECT FIRST 
               REM 981117 Statist druck 1
               FormatPrint$ = "A4q"
               title2$ = "Statistik nach Agenturgruppe/Agentur/Gesellschaft/Sparte"
               CALL VPEINI(title2$,FormatPrint$)
               cPage% = CALL ("VpeGetCurrentPage",hdoc%)
               cPageold% = cPage%
               b% = 1
               vzeil% = mTop%
 
               IF eu% = 1 THEN 
                 waehr$ = " in Euro"
               ELSE 
                 waehr$ = ""
               END IF 
               title2$ = title2$ + waehr$
               CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
               CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
               CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
               a% = vzeil% + 10
               CALL VPrint(mleft% + 900,a%,"['Arial' S 6 B C BLACK]" + "Bewertung")
               REM Einheitenabfrage
               IF einhadd% = 0 THEN 
                 CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Volumen")
               ELSE 
                 CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Einheiten")
               END IF 
               CALL VPrint(mleft% + 1670,a%,"['Arial' S 6 B C BLACK]" + "VS-Summe")
               CALL VPrint(mleft% + 2050,a%,"['Arial' S 6 B C BLACK]" + "Jahresbeitrag")
               CALL VPrint(mleft% + 2450,a%,"['Arial' S 6 B C BLACK]" + "Anzahl")
               obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
               CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
               obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
               vzeil% = obBottom% + 10
               ueberpos% = vzeil%
               CALL VTransp(0)
               CALL VSetPen(0,0)
               zeilenabstand% = 40
               zeilenoffset% = 40
               aa% = RECCOUNT ("STATIST2")
               i% = 1
               aa% = a%
               SumBei% = 0
               SumBew% = 0
               SumVS% = 0
               REM CALL Fehler("AUSDRUCK","")
               seitenumbr$ = "J"
               WHILE NOT EOF ("STATIST2")
                 i% = i% + 1
                 obBottom% = vzeil%
                 magruppe$ = magruppe.statist
                 agnr$ = LEFT$ (agenturnr) + ", "
                 IF agnr$ <> "" THEN 
                   agname$ = agnr$ + agnachname + ", " + agvorname
                 ELSE 
                   agname$ = agnachname + ", " + agvorname
                 END IF 
                 ges$ = gesellschaft
                 sp$ = sparte
                 a% = vzeil%
                 cPage% = CALL ("VpeGetCurrentPage",hdoc%)
                 cPageold% = cPage%
                 ok% = - 1
VertKorrDr150298: 
                 czeile% = vzeil%
                 CALL VAlign(1)
                 IF magruppe = "" THEN 
                   CALL VPrint(mleft%,a%,"['Arial' S 6 B C BLACK]" + "Gesamt")
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s1b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s1vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s1v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s1bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz1,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                 END IF 
 
                 IF magruppe <> "" AND codema < 1 THEN 
                   CALL VPrint(mleft% + 30,a%,"['Arial' S 6 B C BLACK]" + "AGGruppe: " + MAGRUPPE)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s2b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s2vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s2v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s2bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz2,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                 END IF 
 
                 IF magruppe <> "" AND codema > 0 AND gesellschaft = "" THEN 
                    a% = vzeil%
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                   CALL VPrint(mleft% + 60,a%,"['Arial' S 6 B C BLACK]" + "Agentur: " + AGName$)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s3b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s3vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s3v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s3bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz3,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                 END IF 
 
                 IF magruppe <> "" AND codema > 0 AND gesellschaft <> "" AND sparte = "" THEN 
                    a% = vzeil%
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                   CALL VPrint(mleft% + 90,a%,"['Arial' S 6 B C BLACK]" + "Gesellschaft: " + gesellschaft)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s4b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s4vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s4v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s4bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz4,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
 
                 END IF 
 
                 IF magruppe <> "" AND codema > 0 AND gesellschaft <> "" AND sparte <> "" THEN 
                   CALL VPrint(mleft% + 120,a%,"['Arial' S 6 B C BLACK]" + sparte)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s5b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s5vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s5v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s5bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz5,",99999"))
                   a% = vzeil%
                 END IF 
                 CALL VAlign(0)
                 REM a% = vzeil% + 5
                 REM CALL VLine(mleft% - 7,a%,mright%,a%)
                 REM vzeil% = vzeil% + 25
                 SET STATUS "DatensÑtze bearbeitet: " + STR$ (i%,"9999999")
 
                 IF obBottom% >= mBottom% THEN 
                   CALL VTransp(0)
                   CALL VBox(mleft% - 7,czeile%,mright%,obBottom% + 550)
                   CALL VLine(mleft% - 7,mtop%,mleft% - 7,czeile%)
                   CALL VLine(mright%,mtop%,mright%,czeile%)
                   CALL VLine(mleft% - 7,czeile%,mright%,czeile%)
                   a% = CALL ("VpePageBreak",hdoc%)
                   REM CALL VTransp(1)
                   vzeil% = ueberpos%
                   seitenumbr$ = "J"
                   a% = vzeil%
                   obbottom% = vzeil%
                   GOTO VertKorrDr150298
                 END IF 
                 SELECT NEXT 
               WEND 
               vzeil% = vzeil% + 10
               CALL VLine(mleft% - 7,mtop%,mleft% - 7,vzeil%)
               CALL VLine(mright%,mtop%,mright%,vzeil%)
               CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
               vzeil% = vzeil% + 20
               CALL VPrint(mleft%,vzeil% + 100,"['Arial' S 15 B C BLACK]Ende der Liste")
               cPage% = CALL ("VpeGetCurrentPage",hdoc%)
 
               FOR b% = 1 TO cPage%
                 vzeil% = mTop%
                 a% = CALL ("VpeGotoPage",hdoc%,b%)
                 CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
                 CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
                 CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
                 a% = vzeil% + 10
                 CALL VPrint(mleft% + 900,a%,"['Arial' S 6 B C BLACK]" + "Bewertung")
                 IF einhadd% = 0 THEN 
                   CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Volumen")
                 ELSE 
                   CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Einheiten")
                 END IF 
                 CALL VPrint(mleft% + 1670,a%,"['Arial' S 6 B C BLACK]" + "VS-Summe")
                 CALL VPrint(mleft% + 2050,a%,"['Arial' S 6 B C BLACK]" + "Jahresbeitrag")
                 CALL VPrint(mleft% + 2450,a%,"['Arial' S 6 B C BLACK]" + "Anzahl")
                 obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
                 CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
               NEXT b%
               a% = CALL ("VpeGotoPage",hdoc%,1)
               MOUSE ON 
               CALL VPrevDoc()
               REM Nach dem Drucken, Drucker auf A4 hoch setzen
               REM c$ = PRINTER :d$ = PRINTER (0):SET PRINTER c$,d$,1,9
 
         ON ERROR GOTO adrdr170920023
         IF PRINTER (1) = 1 OR PRINTER (1) = 2 THEN 
           c$ = PRINTER :d$ = PRINTER (0)
           SET PRINTER c$,d$,1,9
           REM PRINT CURRENT PAGE 
           GOTO endruck170920023
         END IF 
         
adrdr170920023: 
         MOUSE ON 
         REM c$ = PRINTER :d$ = PRINTER (0)
         ON ERROR GOTO endruck170920023
         SET PRINTER 
         REM PRINT CURRENT PAGE 
         FORM 
endruck170920023: 
         ON ERROR GOTO ErrorHandler 
 
               REM lok% = 0
               REM ENDE AUSDRUCK STATISTIK
               WAIT KEY 
             END IF 
 
             REM Gesellschaftssicht
             IF opt% = 2 THEN 
               s1B% = 0:s1V% = 0:s1Bei% = 0:s1Vol% = 0:anz1% = 0
               s2B% = 0:s2V% = 0:s2Bei% = 0:s2Vol% = 0:anz2% = 0
               s3B% = 0:s3V% = 0:s3Bei% = 0:s3Vol% = 0:anz3% = 0
               s4B% = 0:s4V% = 0:s4Bei% = 0:s4Vol% = 0:anz4% = 0
               s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
               s6B% = 0:s6V% = 0:s6Bei% = 0:s6Vol% = 0:anz6% = 0
               s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
               s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
               s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
               FILE "STATIST"
               INDEX codege.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               i% = 0
               
               REM CALL Fehler("STATIST","")
 
               QGesSpa$ = QGesSpa.statist
               qGesSpaMAGr$ = qGesSpaMAGr.statist
               qgesall$ = qgesall.statist
               SELECT FIRST 
               
               REM ALLE VERTRéGE
               WHILE NOT EOF ("Statist")
                 i% = i% + 1
                 anz1% = anz1% + 1:s1B% = s1B% + Bewertung.statist:s1V% = s1V% + VSumme.statist:s1Bei% = s1Bei% + Jahresbeitrag.statist:s1Vol% = s1Vol% + Volumen.statist
                 SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 1 von 5: " + STR$ (i%,"99999999")
                 FILE "STATIST"
                 SELECT NEXT FILE "STATIST"
               WEND 
 
               FILE "Statist2"
               BLANK FILE "Statist2"
               codest2% = SER ("STATIST2")
               codest2.statist2 = codest2%
               STORE FILE "Statist2"
               SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
               CALL StoreStatist2(0,0,"","","","","","",0,"",0,"",0,1)
               REM ALLE GESELLSCHAFTEN
               FILE "Statist"
               INDEX codege.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               SELECT KEY codege% FILE "statist" INDEX codege.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE codege.statist = codege% AND NOT EOF ("statist")
                   i% = i% + 1
                   anz2% = anz2% + 1:s2B% = s2B% + Bewertung.statist:s2V% = s2V% + VSumme.statist:s2Bei% = s2Bei% + Jahresbeitrag.statist:s2Vol% = s2Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 2 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(0,0,"","","","","",ges$,codege%,"",0,"",0,2)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 s2B% = 0:s2V% = 0:s2Bei% = 0:s2Vol% = 0:anz2% = 0
               WEND 
 
               REM ALLE GES-Sparten
               FILE "Statist"
               INDEX qGesSpa.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               qcmagrag$ = qcmagrag.statist
               qGesSpa$ = qGesSpa.statist
               SELECT KEY qGesSpa$ FILE "statist" INDEX qGesSpa.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE qGesSpa.statist = qGesSpa$ AND NOT EOF ("statist")
                   i% = i% + 1
                   anz3% = anz3% + 1:s3B% = s3B% + Bewertung.statist:s3V% = s3V% + VSumme.statist:s3Bei% = s3Bei% + Jahresbeitrag.statist:s3Vol% = s3Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 3 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(0,0,"","","","","",ges$,codege%,"",0,sp$,codeva%,3)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 qcmagrag$ = qcmagrag.statist
                 qGesSpa$ = qGesSpa.statist
                 s3B% = 0:s3V% = 0:s3Bei% = 0:s3Vol% = 0:anz3% = 0
               WEND 
               REM CALL Fehler("GES","")
               REM ALLE Ges-Spa-AGENTURGRUPPEN
               FILE "Statist"
               INDEX qGesSpaMAGr.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               qcmge$ = qcmge.statist
               qGesSpaMAGr$ = qGesSpaMAGr.statist
               SELECT KEY qGesSpaMAGr$ FILE "statist" INDEX qGesSpaMAGr.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE qGesSpaMAGr.statist = qGesSpaMAGr$ AND NOT EOF ("statist")
                   i% = i% + 1
                   anz4% = anz4% + 1:s4B% = s4B% + Bewertung.statist:s4V% = s4V% + VSumme.statist:s4Bei% = s4Bei% + Jahresbeitrag.statist:s4Vol% = s4Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 4 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 REM 01092004
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(codemagr%,0,"","","",agruppeold$,"",ges$,codege%,"",0,sp$,codeva%,4)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 qcmge$ = qcmge.statist
                 qGesSpaMAGr$ = qGesSpaMAGr.statist
                 s4B% = 0:s4V% = 0:s4Bei% = 0:s4Vol% = 0:anz4% = 0
               WEND 
 
               REM ALLE GESELLSCHAFTEN-SPARTEN-AGENTURGRUPPEN-AGENTUREN
               FILE "Statist"
               INDEX qGesAll.statist
               SELECT FIRST 
               agruppeold$ = magruppe.statist
               agn$ = AGNachname.statist
               agv$ = agvorname.statist
               agnr$ = agenturnr.statist
               ges$ = gesellschaft.statist
               spgr$ = Spartengruppe.statist
               sp$ = sparte.statist
               codege% = codege.statist
               codema% = codema.statist
               codeva% = codeva.statist
               codemagr% = codemagr.statist
               qcode$ = qcode.statist
               qGesAll$ = qGesAll.statist
               SELECT KEY qGesAll$ FILE "statist" INDEX qGesAll.statist
               i% = 0
               WHILE NOT EOF ("Statist")
                 FILE "STATIST"
                 WHILE qGesAll.statist = qGesAll$ AND NOT EOF ("statist")
                   i% = i% + 1
                   anz5% = anz5% + 1:s5B% = s5B% + Bewertung.statist:s5V% = s5V% + VSumme.statist:s5Bei% = s5Bei% + Jahresbeitrag.statist:s5Vol% = s5Vol% + Volumen.statist
                   SET STATUS "Anzahl verarbeiteter DatensÑtze, Durchlauf 5 von 5: " + STR$ (i%,"99999999")
                   FILE "STATIST"
                   SELECT NEXT FILE "STATIST"
                 WEND 
                 FILE "Statist2"
                 BLANK FILE "Statist2"
                 codest2% = SER ("STATIST2")
                 codest2.statist2 = codest2%
                 STORE FILE "Statist2"
                 SELECT KEY codest2% LOCK FILE "Statist2" INDEX codest2.statist2
                 CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,"",ges$,codege%,"",0,sp$,codeva%,5)
                 REM CALL StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,ges$,codege%,spgr$,codespgr%,sp$,codeva%,2)
                 FILE "Statist"
                 agruppeold$ = magruppe.statist
                 agn$ = AGNachname.statist
                 agv$ = agvorname.statist
                 agnr$ = agenturnr.statist
                 ges$ = gesellschaft.statist
                 spgr$ = Spartengruppe.statist
                 sp$ = sparte.statist
                 codege% = codege.statist
                 codema% = codema.statist
                 codeva% = codeva.statist
                 codemagr% = codemagr.statist
                 qcode$ = qcode.statist
                 qGesAll$ = qGesAll.statist
                 s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
               WEND 
               REM ANFANG AUSDRCK STATISTIK
               FILE "STATIST2"
               INDEX qmgesag.statist2
               SELECT FIRST 
               FormatPrint$ = "A4q"
               title2$ = "Statistik nach Gesellschaft/Sparte/Agenturgruppe/Agentur"
               CALL VPEINI(title2$,FormatPrint$)
               cPage% = CALL ("VpeGetCurrentPage",hdoc%)
               cPageold% = cPage%
               b% = 1
               vzeil% = mTop%
               CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
               CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
               CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
               a% = vzeil% + 10
               CALL VPrint(mleft% + 900,a%,"['Arial' S 6 B C BLACK]" + "Bewertung")
               IF einhadd% = 0 THEN 
                 CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Volumen")
               ELSE 
                 CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Einheiten")
               END IF 
               CALL VPrint(mleft% + 1670,a%,"['Arial' S 6 B C BLACK]" + "VS-Summe")
               CALL VPrint(mleft% + 2050,a%,"['Arial' S 6 B C BLACK]" + "Jahresbeitrag")
               CALL VPrint(mleft% + 2450,a%,"['Arial' S 6 B C BLACK]" + "Anzahl")
               obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
               CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
               obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
               vzeil% = obBottom% + 10
               ueberpos% = vzeil%
               CALL VTransp(0)
               CALL VSetPen(0,0)
               zeilenabstand% = 40
               zeilenoffset% = 40
               aa% = RECCOUNT ("STATIST2")
               i% = 1
               aa% = a%
               SumBei% = 0
               SumBew% = 0
               SumVS% = 0
               REM CALL Fehler("AUSDRUCK","")
               seitenumbr$ = "J"
               WHILE NOT EOF ("STATIST2")
                 i% = i% + 1
                 obBottom% = vzeil%
                 magruppe$ = magruppe.statist
                 agnr$ = LEFT$ (agenturnr) + ", "
                 IF agnr$ <> "" THEN 
                   agname$ = agnr$ + agnachname + ", " + agvorname
                 ELSE 
                   agname$ = agnachname + ", " + agvorname
                 END IF 
                 ges$ = gesellschaft
                 sp$ = sparte
                 a% = vzeil%
                 cPage% = CALL ("VpeGetCurrentPage",hdoc%)
                 cPageold% = cPage%
                 ok% = - 1
VertKorrDr190298: 
                 czeile% = vzeil%
                 CALL VAlign(1)
                 IF Gesellschaft = "" THEN 
                   CALL VPrint(mleft%,a%,"['Arial' S 6 B C BLACK]" + "Gesamt")
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s1b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s1vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s1v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s1bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz1,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                 END IF 
 
                 IF Gesellschaft <> "" AND codeva < 1 THEN 
                   CALL VPrint(mleft% + 30,a%,"['Arial' S 6 B C BLACK]" + "Gesellschaft: " + Gesellschaft)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s2b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s2vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s2v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s2bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz2,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                 END IF 
 
                 IF Gesellschaft <> "" AND codeva > 0 AND magruppe = "" THEN 
                    a% = vzeil%
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                   CALL VPrint(mleft% + 60,a%,"['Arial' S 6 B C BLACK]" + "Sparte: " + Sparte)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s3b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s3vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s3v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s3bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz3,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                 END IF 
 
                 IF Gesellschaft <> "" AND codeva > 0 AND magruppe <> "" AND codema < 1 THEN 
                    a% = vzeil%
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
                   CALL VPrint(mleft% + 90,a%,"['Arial' S 6 B C BLACK]" + "AG-Gruppe: " + magruppe)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s4b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s4vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s4v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s4bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz4,",99999"))
                    a% = vzeil% + 5
                    CALL VLine(mleft% - 7,a%,mright%,a%)
                    vzeil% = vzeil% + 15
                    a% = vzeil%
 
                 END IF 
 
                 IF Gesellschaft <> "" AND codeva > 0 AND magruppe <> "" AND codema > 0 THEN 
                   CALL VPrint(mleft% + 120,a%,"['Arial' S 6 B C BLACK]" + "Agentur: " + agname$)
                   CALL VWrite(mleft% + 800,a%,1190,"['Arial' S 6 B C BLACK]" + STR$ (s5b,",999999999.00"))
                   CALL VWrite(mleft% + 1200,a%,1590,"['Arial' S 6 B C BLACK]" + STR$ (s5vol,",999999999.00"))
                   CALL VWrite(mleft% + 1600,a%,1990,"['Arial' S 6 B C BLACK]" + STR$ (s5v,",999999999.00"))
                   CALL VWrite(mleft% + 2000,a%,2390,"['Arial' S 6 B C BLACK]" + STR$ (s5bei,",999999999.00"))
                   CALL VWrite(mleft% + 2400,a%,2690,"['Arial' S 6 B C BLACK]" + STR$ (anz5,",99999"))
                   a% = vzeil%
                 END IF 
                 CALL VAlign(0)
                 REM a% = vzeil% + 5
                 REM CALL VLine(mleft% - 7,a%,mright%,a%)
                 REM vzeil% = vzeil% + 25
                 SET STATUS "DatensÑtze bearbeitet: " + STR$ (i%,"9999999")
 
                 IF obBottom% >= mBottom% THEN 
                   CALL VTransp(0)
                   CALL VBox(mleft% - 7,czeile%,mright%,obBottom% + 550)
                   CALL VLine(mleft% - 7,mtop%,mleft% - 7,czeile%)
                   CALL VLine(mright%,mtop%,mright%,czeile%)
                   CALL VLine(mleft% - 7,czeile%,mright%,czeile%)
                   a% = CALL ("VpePageBreak",hdoc%)
                   REM CALL VTransp(1)
                   vzeil% = ueberpos%
                   seitenumbr$ = "J"
                   a% = vzeil%
                   obbottom% = vzeil%
                   GOTO VertKorrDr190298
                 END IF 
                 SELECT NEXT 
               WEND 
               vzeil% = vzeil% + 10
               CALL VLine(mleft% - 7,mtop%,mleft% - 7,vzeil%)
               CALL VLine(mright%,mtop%,mright%,vzeil%)
               CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
               vzeil% = vzeil% + 20
               CALL VPrint(mleft%,vzeil% + 100,"['Arial' S 15 B C BLACK]Ende der Liste")
               cPage% = CALL ("VpeGetCurrentPage",hdoc%)
 
               FOR b% = 1 TO cPage%
                 vzeil% = mTop%
                 a% = CALL ("VpeGotoPage",hdoc%,b%)
                 CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
                 CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
                 CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
                 a% = vzeil% + 10
                 CALL VPrint(mleft% + 900,a%,"['Arial' S 6 B C BLACK]" + "Bewertung")
                 IF einhadd% = 0 THEN 
                   CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Volumen")
                 ELSE 
                   CALL VPrint(mleft% + 1300,a%,"['Arial' S 6 B C BLACK]" + "Einheiten")
                 END IF 
                 CALL VPrint(mleft% + 1670,a%,"['Arial' S 6 B C BLACK]" + "VS-Summe")
                 CALL VPrint(mleft% + 2050,a%,"['Arial' S 6 B C BLACK]" + "Jahresbeitrag")
                 CALL VPrint(mleft% + 2450,a%,"['Arial' S 6 B C BLACK]" + "Anzahl")
                 obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
                 CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
               NEXT b%
               a% = CALL ("VpeGotoPage",hdoc%,1)
               MOUSE ON 
               CALL VPrevDoc()
               REM Nach dem Drucken, Drucker auf A4 hoch setzen
               REM c$ = PRINTER :d$ = PRINTER (0):SET PRINTER c$,d$,1,9
 
         ON ERROR GOTO adrdr170920024
         IF PRINTER (1) = 1 OR PRINTER (1) = 2 THEN 
           c$ = PRINTER :d$ = PRINTER (0)
           SET PRINTER c$,d$,1,9
           REM PRINT CURRENT PAGE 
           GOTO endruck170920024
         END IF 
         
adrdr170920024: 
         MOUSE ON 
         REM c$ = PRINTER :d$ = PRINTER (0)
         ON ERROR GOTO endruck170920024
         SET PRINTER 
         REM PRINT CURRENT PAGE 
         FORM 
endruck170920024: 
         ON ERROR GOTO ErrorHandler 
 
               REM lok% = 0
               REM ENDE AUSDRUCK STATISTIK
               WAIT KEY 
             END IF 
  
             END IF 
           END IF 
         END IF 
       CASE 3
         
           REM CALL Fehler("Summenliste","")
           i% = 1
           aa% = a%
           SumBei% = 0
           SumBew% = 0
           SumVS% = 0
           FOR i% = 0 TO aa% - 1
             SET STATUS "Summen berechnen " + STR$ (i%,"99999999") + " von " + STR$ (aa%,"9999999999")
             GetVertrag% = VAL ( RIGHT$ (Vertraege$(i%),6))
             SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
             IF eu% = 1 THEN 
               euro% = umrechnung.kvertrag
               waehr$ = " Euro"
             ELSE 
               euro% = 1
               waehr$ = waehrung.kvertrag
             END IF 
             SELECT CASE zw.kvertrag
               CASE 0
                 SumBei% = VAL ( STR$ (SumBei% + Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 1
                 SumBei% = SumBei% + VAL ( STR$ (Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 4
                 SumBei% = SumBei% + VAL ( STR$ (4 * Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 6
                 SumBei% = SumBei% + VAL ( STR$ (6 * Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 2
                 SumBei% = SumBei% + VAL ( STR$ (2 * Beitrag.kvertrag / euro%,"999999999.00"))
               CASE 12
                 SumBei% = SumBei% + VAL ( STR$ (12 * Beitrag.kvertrag / euro%,"999999999.00"))
             END SELECT 
             SumBew% = SumBew% + VAL ( STR$ (BewertungsSumme.kvertrag / euro%,"999999999.00"))
             SumVS% = SumVS% + VAL ( STR$ (VSumme.kvertrag / euro%,"999999999.00"))
           NEXT i%
           CALL Fehler("Summenliste","")
 
 
       END SELECT 
     WEND 
end300320041: 
     ON ERROR GOTO ErrorHandler
   END IF 
 END IF 
 REDIM Vertraege$(1,1)
 REDIM Vertraege$(a%)
 REM FOR i% = 0 TO a%
   REM Vertraege$(i%) = ""
 REM NEXT i%
 GOTO VertKond140697anf
VertKond140697end: 
 VertKokor% = 0
 IF OPEN ("STATIST") THEN CLOSE FILE "Statist"
 IF OPEN ("STATIST2") THEN CLOSE FILE "Statist2"
 IF OPEN ("ADRTEMP") THEN 
   REM CLOSE FILE "ADRTEMP"
   IF RECCOUNT ("adrtemp") > 0 THEN REMOVE FROM FILE "adrtemp"
 END IF 
 SELECT WHERE FILE "KVERTRAG"
 SELECT WHERE FILE "vprodukt"
 GAppName$ = _netpath$ + "DOC\provis.pdf"
 MOUSE ON 
 END SUB 
 




SUB StoreStatist2(codemagr%,codema%,agn$,agv$,agnr$,agruppeold$,agold$,gesold$,codege%,spgruppeold$,codespgr%,spold$,codeva%,par%)
    FILE "Statist2"
    Gesellschaft.statist2 = gesold$
    codege.statist2 = codege%
    codemagr.statist2 = codemagr%
    Spartengruppe.statist2 = spgruppeold$
    codeva.statist2 = codeva%
    Sparte.statist2 = Spold$
    AGNachname.statist2 = AGN$
    AGVorname.statist2 = AGV$
    Agenturnr.statist2 = Agnr$
    MAGruppe.statist2 = agruppeold$
    codema.statist2 = Codema%
    bewertung.statist2 = Bewertung.statist
    Volumen.statist2 = Volumen.statist
    VSumme.statist2 = Vsumme.statist
    codegrsp.statist2 = codegrsp%
    Jahresbeitrag.statist2 = Jahresbeitrag.statist
    QMAGR.statist2 = MAGruppe.statist + AGNachname.statist + Agenturnr.statist + Gesellschaft.statist + SpartenGruppe.statist + Sparte.statist
    QMAGR.statist2 = agruppeold$ + AGN$ + Agnr$ + gesold$ + spold$
    QMGESAG.statist2 = gesold$ + spold$ + agruppeold$ + AGN$ + Agnr$
    REM QGes.statist2 = Gesellschaft.statist + SpartenGruppe.statist + Sparte.statist + MAGruppe.statist + AGNachname.statist + Agenturnr.statist
    REM QGes.statist2 = agruppeold$ + AGN$ + Agnr$ + gesold$ + spold$
    codemagr.statist2 = codemagr%
    
    s1B.statist2 = s1B%:s1V.statist2 = s1v%:s1Bei.statist2 = s1Bei%:s1Vol.statist2 = s1Vol%:anz1.statist2 = anz1%
    IF par% = 1 THEN 
      s1B% = 0:s1V% = 0:s1Bei% = 0:s1Vol% = 0:anz1% = 0
    END IF 
    IF par% = 2 THEN 
      s2B.statist2 = s2B%:s2V.statist2 = s2v%:s2Bei.statist2 = s2Bei%:s2Vol.statist2 = s2Vol%:anz2.statist2 = anz2%
      s2B% = 0:s2V% = 0:s2Bei% = 0:s2Vol% = 0:anz2% = 0
      s3B% = 0:s3V% = 0:s3Bei% = 0:s3Vol% = 0:anz3% = 0
      s4B% = 0:s4V% = 0:s4Bei% = 0:s4Vol% = 0:anz4% = 0
      s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
      s6B% = 0:s6V% = 0:s6Bei% = 0:s6Vol% = 0:anz6% = 0
      s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
      s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    IF par% = 3 THEN 
      s3B.statist2 = s3B%:s3V.statist2 = s3v%:s3Bei.statist2 = s3Bei%:s3Vol.statist2 = s3Vol%:anz3.statist2 = anz3%
      s3B% = 0:s3V% = 0:s3Bei% = 0:s3Vol% = 0:anz3% = 0
      s4B% = 0:s4V% = 0:s4Bei% = 0:s4Vol% = 0:anz4% = 0
      s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
      s6B% = 0:s6V% = 0:s6Bei% = 0:s6Vol% = 0:anz6% = 0
      s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
      s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    IF par% = 4 THEN 
      s4B.statist2 = s4B%:s4V.statist2 = s4v%:s4Bei.statist2 = s4Bei%:s4Vol.statist2 = s4Vol%:anz4.statist2 = anz4%
      s4B% = 0:s4V% = 0:s4Bei% = 0:s4Vol% = 0:anz4% = 0
      s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
      s6B% = 0:s6V% = 0:s6Bei% = 0:s6Vol% = 0:anz6% = 0
      s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
      s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    IF par% = 5 THEN 
      s5B.statist2 = s5B%:s5V.statist2 = s5v%:s5Bei.statist2 = s5Bei%:s5Vol.statist2 = s5Vol%:anz5.statist2 = anz5%
      s5B% = 0:s5V% = 0:s5Bei% = 0:s5Vol% = 0:anz5% = 0
      s6B% = 0:s6V% = 0:s6Bei% = 0:s6Vol% = 0:anz6% = 0
      s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
      s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    IF par% = 6 THEN 
      s6B.statist2 = s6B%:s6V.statist2 = s6v%:s6Bei.statist2 = s6Bei%:s6Vol.statist2 = s6Vol%:anz6.statist2 = anz6%
      s6B% = 0:s6V% = 0:s6Bei% = 0:s6Vol% = 0:anz6% = 0
      s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
      s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    IF par% = 7 THEN 
      s7B.statist2 = s7B%:s7V.statist2 = s7v%:s7Bei.statist2 = s7Bei%:s7Vol.statist2 = s7Vol%:anz7.statist2 = anz7%
      s7B% = 0:s7V% = 0:s7Bei% = 0:s7Vol% = 0:anz7% = 0
      s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    IF par% = 8 THEN 
      s8B.statist2 = s8B%:s8V.statist2 = s8v%:s8Bei.statist2 = s8Bei%:s8Vol.statist2 = s8Vol%:anz8.statist2 = anz8%
      s8B% = 0:s8V% = 0:s8Bei% = 0:s8Vol% = 0:anz8% = 0
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    IF par% = 9 THEN 
      s9B.statist2 = s9B%:s9V.statist2 = s9V%:s9Bei.statist2 = s9Bei%:s9Vol.statist2 = s9Vol%:anz9.statist2 = anz9%
      s9B% = 0:s9V% = 0:s9Bei% = 0:s9Vol% = 0:anz9% = 0
    END IF 
    STORE FILE "STATIST2"
 END SUB 
 
SUB VTUebersi(cuma%)
 DIM Auswahl$(1)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"vorgang" + _fpw$)
 CALL DFile(3,"vkond" + _fpw$)
 CALL DFile(3,"formular" + _fpw$)
 CALL DFile(3,"spgruppe" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(2,"OFFICE\" + GAkquiDat$ + _fpw$)
 CALL DFile(2,"OFFICE\aktionen" + _fpw$)
 CALL DFile(2,"OFFICE\" + GTelDat$ + _fpw$)
 REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
 FILE "Vkond"
 INDEX codema.vkond
 SELECT FIRST 
 i% = 0
 z% = RECCOUNT ("Kvertrag")
 SELECT KEY cuma% FILE "Vkond" INDEX codema.vkond
 WHILE NOT EOF ("vkond") AND codema.vkond = cuma%
   codevt% = codevt.vkond
   FILE "Kvertrag"
   INDEX lfdnr.kvertrag
   SELECT FIRST 
   SELECT KEY codevt% FILE "Kvertrag" INDEX lfdnr.kvertrag
   SELECT KEY codeku.kvertrag FILE GAdrDat$ INDEX codeku.GAdrDat$
   nachn$ = LEFT$ (Nachname.GAdrDat$)
   vs$ = TRIM$ ( PAD$ (VS_Nr.KVERTRAG,38))
   IF LEN (vs$) > 7 AND LEN (vs$) < 16 THEN vs$ = vs$ + CHR$ (9)
   IF LEN (vs$) < 7 THEN vs$ = vs$ + CHR$ (9) + CHR$ (9)
   zw$ = CHR$ (9) + CHR$ (9) + CHR$ (9) + CHR$ (9) + SPACE$ (30)
   daten1$ = vs$ + CHR$ (9) + LEFT$ (nachn$,20) + CHR$ (9) + "/" + LEFT$ (Gesellschaft.kvertrag) + "/" + LEFT$ (Sparte.kvertrag) + "/" + LEFT$ (Agentur.kvertrag)
   IF LEN (daten1$) < 58 THEN daten1$ = daten1$ + CHR$ (9)
   IF LEN (daten1$) < 47 THEN daten1$ = daten1$ + CHR$ (9)
   IF LEN (daten1$) < 44 THEN daten1$ = daten1$ + CHR$ (9)
   IF LEN (daten1$) < 38 THEN daten1$ = daten1$ + CHR$ (9)
   IF LEN (daten1$) < 30 THEN daten1$ = daten1$ + CHR$ (9)
   IF LEN (daten1$) < 20 THEN daten1$ = daten1$ + CHR$ (9)
   Laenge% = LEN (daten1$)
   von1$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
   bis1$ = DATE$ (KÅndigung.kvertrag,"0d.mm.yyyy")
   daten1$ = daten1$ + " (" + von1$ + " - " + bis1$ + ")"
   Vertraege$(a%) = daten1$ + zw$ + STR$ (lfdnr.KVERTRAG,"000000")
   IF a% = 0 THEN prompt$ = Vertraege$(0)
   a% = a% + 1
   i% = i% + 1
   SET STATUS "VertrÑge bearbeitet: " + STR$ (i%,"9999999") + "  von insgesamt: " + STR$ (z%,"999999999") + "    VertrÑge gefunden: " + STR$ (a%,"9999999")
   FILE "Vkond"
   SELECT NEXT 
 WEND 
 IF a% = 0 THEN 
   GetVertrag% = 0
   CALL Fehler("Es wurden keine VertrÑge gefunden","")
   FILE "Kvertrag"
   SELECT FIRST 
 ELSE 
   IF a% > 0 THEN 
     MOUSE ON 
     lok% = - 1
     WHILE lok%
       CREATE DIALOG "ZEINLIST",0,0,440,330,"Vertrag suchen...","MS Sans Serif",8
       ADD DIALOG "ZEINLIST",4,0,0,438,300,0,""
       ADD DIALOG "ZEINLIST",9,8,11,25,24,2
       ADD DIALOG "ZEINLIST",5,35,15,205,20,0,"Bitte wÑhlen Sie den von Ihnen gesuchten Vertrag aus."
       REM ADD DIALOG "ZEINLIST",5,6,28,398,10,0,"Vertrags-/Policennummer                         Kunde/Gesellschaft/Sparte/Agentur            von      bis"
       ADD DIALOG "ZEINLIST",7,6,38,425,255,2 + 128,2,Vertraege$,Auswahl$,prompt$
       ADD DIALOG "ZEINLIST",1,126,310,55,15,1,"&OK",1,1
       ADD DIALOG "ZEINLIST",1,186,310,55,15,0,"&Abbrechen",0,0
       ADD DIALOG "ZEINLIST",1,246,310,55,15,0,"&Drucken",2,0
       DIALOG "ZEINLIST",req%
       REMOVE DIALOG "ZEINLIST"
       SELECT CASE req%
       CASE 1
         GetVertrag% = VAL ( RIGHT$ (Auswahl$(0),6))
         prompt$ = Auswahl$(0)
         SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
         cuvt% = GetVertrag%
         knr% = Codeku.kvertrag
         SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
         CALL KVERTRAG()
         REM mit Abfrage gestalten CALL VertrKond()
       CASE 0
         lok% = 0
       CASE 2
         MOUSE OFF 
         REM Drucken
         REQUEST "Einheiten drucken(JA) oder Volumen drucken(Nein)?","",130,einhadd%
         FormatPrint$ = "A4h"
         title2$ = "VertragsÅbersicht"
         CALL VPEINI(title2$,FormatPrint$)
         cPage% = CALL ("VpeGetCurrentPage",hdoc%)
         cPageold% = cPage%
         b% = 1
         vzeil% = mTop%
         CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
         CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
         CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
         obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
         CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
         obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
         vzeil% = obBottom% + 10
         ueberpos% = vzeil%
         CALL VTransp(0)
         CALL VSetPen(0,0)
         zeilenabstand% = 40
         zeilenoffset% = 40
         i% = 1
         aa% = a%
         FOR i% = 0 TO aa%
           obBottom% = vzeil%
           GetVertrag% = VAL ( RIGHT$ (Vertraege$(i%),6))
           SELECT KEY GetVertrag% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
           cuvt% = GetVertrag%
           knr% = Codeku.kvertrag
           SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
           knr$ = Kundennummer.GAdrDat$
           name$ = Nachname.GAdrDat$ + " ," + Vorname.GAdrDat$
           Ort$ = plz.GAdrDat$ + "-" + ort.GAdrDat$ + " ," + stra·e.GAdrDat$
           SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
           mitarb$ = Nachname.maadr + ", " + Vorname.maadr
           a% = vzeil%
           cPage% = CALL ("VpeGetCurrentPage",hdoc%)
           cPageold% = cPage%
           ok% = - 1
VTUebersi150697: 
           czeile% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Kundennummer: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + knr$)
           a% = vzeil%
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + name$ + ", " + ort$)
           CALL VWrite(mleft%,a%,460,"['Arial' S 8 B C BLACK]" + "Name: ")
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Betreuung durch: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + mitarb$)
           a% = vzeil%
           ges$ = LTRIM$ (Gesellschaft.kvertrag)
           spa$ = LTRIM$ (sparte.kvertrag)
           Statu1$ = " / Status: " + LTRIM$ (VstatusTXT.kvertrag)
           agentur$ = LTRIM$ (Agentur.kvertrag)
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Ges./Sparte/Agentur: ")
           CALL VWrite(mleft% + 290,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + Ges$ + "/" + spa$ + "/" + agentur$ + statu1$)
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Antragsdatum: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (Antragsdatum.kvertrag,"0d.mm.yyyy"))
           CALL VPrint(mleft% + 420,a%,"['Arial' S 8 B C BLACK]" + "Vertragsbeginn: ")
           CALL VWrite(mleft% + 640,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy"))
           CALL VPrint(mleft% + 800,a%,"['Arial' S 8 B C BLACK]" + "Ablauf: ")
           CALL VWrite(mleft% + 950,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + DATE$ (KÅndigung.kvertrag,"0d.mm.yyyy"))
           CALL VPrint(mleft% + 1200,a%,"['Arial' S 8 B C BLACK]" + "Dauer: ")
           CALL VWrite(mleft% + 1300,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + STR$ (VS_Dauer.kvertrag,"99"))
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Bewertungssumme: ")
           IF einhadd% = 0 THEN 
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + STR$ (BewertungsSumme.Kvertrag,",99999999.00") + "  Volumen: " + STR$ (Volumen.kvertrag,",99999999.00"))
           ELSE 
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + STR$ (BewertungsSumme.Kvertrag,",99999999.00") + "  Einheiten: " + STR$ (Einheiten.kvertrag,",999999.0000"))
           END IF 
           a% = vzeil%
           CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Policenr: ")
           CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + VS_NR.kvertrag)
           CALL VWrite(mleft% + 570,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + "  Versicherungssumme: " + STR$ (VSumme.Kvertrag,",99999999.00") + "  Beitrag:" + STR$ (Beitrag.kvertrag,",99999999.00"))
           a% = vzeil%
           SELECT CASE zw.kvertrag
             CASE 0
               zw$ = "Zahlweise: Einmalig"
               SumBei% = SumBei% + Beitrag.kvertrag
             CASE 1
               zw$ = "Zahlweise: JÑhrlich"
               SumBei% = SumBei% + Beitrag.kvertrag
             CASE 4
               zw$ = "Zahlweise: VierteljÑhrlich"
               SumBei% = SumBei% + 4 * Beitrag.kvertrag
             CASE 2
               zw$ = "Zahlweise: HalbjÑhrlich"
               SumBei% = SumBei% + 2 * Beitrag.kvertrag
             CASE 6
               zw$ = "Zahlweise: 2monatlich"
               SumBei% = SumBei% + 6 * Beitrag.kvertrag
             CASE 12
               zw$ = "Zahlweise: Monatlich"
               SumBei% = SumBei% + 12 * Beitrag.kvertrag
           END SELECT 
           SumBew% = SumBew% + BewertungsSumme.kvertrag
           SumVS% = SumVS% + VSumme.kvertrag
           CALL VWrite(mleft%,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + "verprovisioniert seit: " + DATE$ (Proviab.kvertrag,"0d.mm.yyyy") + "       " + zw$)
           IF LTRIM$ (notiz.kvertrag) <> "" THEN 
             a% = vzeil%
             CALL VPrint(mleft%,a%,"['Arial' S 8 B C BLACK]" + "Notiz: ")
             CALL VWrite(mleft% + 270,a%,mright% - 3,"['Arial' S 8 B C BLACK]" + LTRIM$ (notiz.kvertrag))
           END IF 
           a% = vzeil% + 5
           CALL VLine(mleft% - 7,a%,mright%,a%)
           vzeil% = vzeil% + 25
           SET STATUS "VertrÑge bearbeitet: " + STR$ (i%,"9999999") + "  von insgesamt: " + STR$ (aa%,"999999999")
 
           IF obBottom% >= mBottom% THEN 
             CALL VTransp(0)
             CALL VBox(mleft% - 7,czeile%,mright%,obBottom% + 550)
             CALL VLine(mleft% - 7,mtop%,mleft% - 7,czeile%)
             CALL VLine(mright%,mtop%,mright%,czeile%)
             CALL VLine(mleft% - 7,czeile%,mright%,czeile%)
             a% = CALL ("VpePageBreak",hdoc%)
             REM CALL VTransp(1)
             vzeil% = ueberpos%
             a% = vzeil%
             obbottom% = vzeil%
             GOTO VTUebersi150697
           END IF 
 
         NEXT i%
         vzeil% = vzeil% + 10
         CALL VLine(mleft% - 7,mtop%,mleft% - 7,vzeil%)
         CALL VLine(mright%,mtop%,mright%,vzeil%)
         CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
         vzeil% = vzeil% + 20
         ss1$ = STR$ (aa%,",9999999999") + "   Summe BeitrÑge: " + STR$ (SumBei%,",9999999999.00") + "   Summe Bewertung: " + STR$ (SumBew%,",9999999999.00")
         ss2$ = "Summe Vers.summen: " + STR$ (SumVS%,",9999999999.00")
         CALL VPrint(mleft%,vzeil% + 10,"['Arial' S 9 B C BLACK]Anzahl VertrÑge: " + ss1$)
         CALL VPrint(mleft%,vzeil% + 45,"['Arial' S 9 B C BLACK]" + ss2$)
         CALL VPrint(mleft%,vzeil% + 100,"['Arial' S 15 B C BLACK]Ende der Liste")
         cPage% = CALL ("VpeGetCurrentPage",hdoc%)
 
         FOR b% = 1 TO cPage%
           vzeil% = mTop%
           a% = CALL ("VpeGotoPage",hdoc%,b%)
           CALL VLine(mleft% - 7,vzeil%,mright%,vzeil%)
           CALL VWrite(mleft%,vzeil% + 10,1610,"['Arial' S 10 B C BLACK]" + title2$ + " vom " + DATE$ ( TODAY ,"0d.mm.yyyy"))
           CALL VWrite(mleft% + 10,vzeil%,1000,"['Arial' S 8 B]Seite " + LTRIM$ ( STR$ (b%,"999")) + " von " + LTRIM$ ( STR$ (cPage%,"999")))
           obBottom% = CALL ("VpeGet",hdoc%,VBOTTOM%)
           CALL VLine(mleft% - 7,obBottom% + 10,mright%,obBottom% + 10)
         NEXT b%
         a% = CALL ("VpeGotoPage",hdoc%,1)
         MOUSE ON 
         CALL VPrevDoc()
         REM Nach dem Drucken, Drucker auf A4 hoch setzen
         REM c$ = PRINTER :d$ = PRINTER (0):SET PRINTER c$,d$,1,9
 
         ON ERROR GOTO adrdr170920026
         IF PRINTER (1) = 1 OR PRINTER (1) = 2 THEN 
           c$ = PRINTER :d$ = PRINTER (0)
           SET PRINTER c$,d$,1,9
           REM PRINT CURRENT PAGE 
           GOTO endruck170920026
         END IF 
         
adrdr170920026: 
         MOUSE ON 
         REM c$ = PRINTER :d$ = PRINTER (0)
         ON ERROR GOTO endruck170920026
         SET PRINTER 
         REM PRINT CURRENT PAGE 
         FORM 
endruck170920026: 
         ON ERROR GOTO ErrorHandler 
 
         lok% = 0
         GOTO VTUebersi150697END 
       END SELECT 
     WEND 
   END IF 
 END IF 
 REDIM Vertraege$(a%,1)
 REDIM Vertraege$(a%)
 REM FOR i% = 0 TO a%
   REM Vertraege$(i%) = ""
 REM NEXT i%
VTUebersi150697END: 
 END SUB 
 
 
 
 
  
  
 
  
  
 
  
 
  
 
  
 
 '      *************************************************
 '      ** Routinen fÅr Zahlungsabgleich Gesellschaften**
 '      *************************************************
 ' wenn codevt%=0 dann so wie immer
 ' wenn codevt%>0 dann Zahlungseingang von Gesellschaft aus
SUB EINGANG1(codevt%)
 IF disabled%("EINGANG") THEN END SUB 
 CALL DFile(3,"ZEINGAN1" + _fpw$)
 MOUSE OFF 
 REM 260698 REMOVE FROM FILE "Zeingan1" WHERE codevt.zeingan1 < 1
 MOUSE ON 
 CALL DFile(3,"KVERTRAG" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"SPARTEN" + _fpw$)
 CALL DFile(3,"MAADR" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 IF GAFSK$ LIKE "TRUE" THEN 
   CALL DFile(3,"afsksut" + _fpw$)
   CALL DFile(3,"kvpsp" + _fpw$)
   CALL DFile(3,"afspsp" + _fpw$)
 END IF 
 FILE "ZEINGAN1"
 INDEX codeaz.zeingan1
 SELECT FIRST 
 _formend% = 0
 IF codevt% = 0 THEN maske$ = "EINGANG2"
 IF codevt% > 0 THEN maske$ = "EINGANGK"
 IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
    IF codevt% = 0 THEN maske$ = "EINGFP2"
    IF codevt% > 0 THEN maske$ = "EINGFP1"
 END IF 
 IF GAFSK$ LIKE "TRUE" THEN 
    IF codevt% = 0 THEN maske$ = "EINGAFS2"
    IF codevt% > 0 THEN maske$ = "EINGAFS1"
 END IF 
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   MOUSE OFF 
   IF UCASE$ ( FORM ) <> maske$ THEN 
     SET HEADING title$ + " - ZahlungseingÑnge"
     OPEN FORM GPrjForm$ + maske$
     SET f = Superbase.Form
     GAppName$ = _netpath$ + "DOC\gze.pdf"
     IF maske$ <> "EINGANGK" AND maske$ <> "EINGAFS1" AND maske$ <> "EINGFP1" THEN SET FORM OFF Uebers$
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     lAussenstand$ = ""
     lKuendAG$ = ""
     eingbei$ = ""
     CALL ZEINIntro1(codevt%)
     CALL MNEINGANG1()
     SET STATUS "ZahlungseingÑnge"
     IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1(codevt%)
   END IF 
   FORM 
   MENU ON 
   MOUSE ON 
   ZEINsub% = 0
   IF GZEDat% < 1 THEN 
      GZEDat% = TODAY 
   END IF 
   bbudat$ = "eingestelltes Erfassungsdatum: " + DATE$ (GZEDat%,"0d.mm.yyyy") + " / FÑlligkeitsdatum: " + DATE$ (GZEDatF%,"0d.mm.yyyy")
   REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
   CALL ClearKBDBuffer()
   FORM 
   f.suchen.visible = - 1
   f.suchen.enabled = - 1
   IF maske$ <> "EINGANGK" AND maske$ <> "EINGAFS1" AND maske$ <> "EINGFP1" THEN f.uebersicht.enabled = - 1
   f.abbruch.visible = 0
   f.abbruch.enabled = 0
   IF FORM LIKE "EINGANG2" OR FORM LIKE "EINGANGK" THEN 
     ZEBRUTYES$ = UCASE$ (ReadConfig$("PROVIS","ZEBRUTYES"))
     ON ERROR GOTO w130120051
     IF ZEBRUTYES$ = "TRUE" THEN 
       f.Labzebrut.visible = - 1
       f.Labzebrut1.visible = - 1
       f.Labzebrut2.visible = - 1
       f.Feldzebrut.visible = - 1
       f.Feldzebrut.enabled = - 1
       f.Fmwstze.enabled = - 1
       f.Fmwstze.visible = - 1
     ELSE 
       f.Labzebrut.visible = 0
       f.Labzebrut1.visible = 0
       f.Labzebrut2.visible = 0
       f.Feldzebrut.visible = 0
       f.Feldzebrut.enabled = 0
       f.Fmwstze.enabled = 0
       f.Fmwstze.visible = 0
     END IF 
w130120051: 
   END IF 
   ON ERROR GOTO e151120053
   f.zebuch.enabled = 0
e151120053: 
   
   ON ERROR GOTO ErrorHandler
   IF ZEINsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL ZEINPrev1()
   CASE CrsRight%,PgDn%
     CALL ZEINNext1()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZEINsub%
   CASE 1
     REM PrÅfung der Daten
     MOUSE OFF 
     CALL DFile(3,"buchung1" + _fpw$)
     CALL DFile(3,"KVERTRAG" + _fpw$)
     FILE "zeingan1"
     INDEX codevt.zeingan1
     SELECT FIRST LOCK 
     ok% = - 1
     WHILE NOT EOF ("zeingan1")
       codevt% = Codevt.zeingan1
       IF EXISTS (codevt,lfdnr.kvertrag) THEN 
         SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
           pool% = (pool.kvertrag * 100)
           pool1$ = STR$ (pool%,"999999999999")
           poolges% = ( VAL (pool1$)) / 100
           pool.kvertrag = poolges%
           CALL QuickStore("KVERTRAG")
           SELECT KEY codevt% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
           IF pool.kvertrag >= 0 AND UCASE$ (Mahnung.KVERTRAG) LIKE "J" THEN 
             Mahnung.KVERTRAG = "n"
             CALL QuickStore("KVERTRAG")
             UPDATE Mahnung.buchung1 = "n" WHERE CodeVT.buchung1 = codevt% AND Mahnung.buchung1 LIKE "j"
             END UPDATE 
             CLOSE FILE "buchung1"
             CALL DFile(3,"buchung1" + _fpw$)
             CALL Info("Alle buchungen des Vertrages " + VS_NR.KVERTRAG + " konnten aus der Mahnliste entfernt werden.","")
           END IF 
         END IF 
         vs$ = VS_NR.kvertrag
         codege% = Codege.kvertrag
         IF vs$ <> VS_NR.zeingan1 THEN ok% = 0
         IF vS$ = "" THEN 
           vs$ = "*FEHLER keine Policenr*"
           CALL Fehler("Es wurde ein Zahlungseingang zu einem Vertrag ohne Policenr gefunden!","Er ehÑlt die Policenr:*FEHLER keine Policenr*")
           ok% = 0
         END IF 
         VS_NR.zeingan1 = vs$
         CodeGE.zeingan1 = codege%
         CALL QuickStore("zeingan1")
         ok% = 0
       ELSE 
         CALL Fehler ("Der Kundenvertrag zu einem Zahlungseingang konnte nicht gefunden werden!","Er wurde wahrscheinlich gelîscht! Die ZahlungseingÑnge zu diesem Vertrag werden jetzt ebenfalls gelîscht!")
         REMOVE FROM FILE "zeingan1" WHERE Codevt.zeingan1 = codevt%
       END IF 
       SELECT NEXT LOCK FILE "zeingan1"
     WEND 
     IF ok% = - 1 THEN 
       CALL Fehler("Es wurden keine Fehler gefunden!","")
     ELSE 
       CALL Fehler("Es wurden Fehler gefunden und beseitigt!","")
     END IF 
     MOUSE ON 
     IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1(codevt%)
   CASE 2
     REM zum Vertrag springen
     CALL DFile(3,"buchung1" + _fpw$)
     CALL DFile(3,"KVERTRAG" + _fpw$)
     CALL DFile(3,"VORGANG" + _fpw$)
         codeaz% = codeaz.zeingan1
         GetVertrag% = codevt.zeingan1
         IF EXISTS (GetVertrag%,lfdnr.kvertrag) THEN 
           SELECT KEY GetVertrag% FILE "Kvertrag" INDEX lfdnr.kvertrag
           cuvt% = GetVertrag%
           knr% = Codeku.kvertrag
           SELECT KEY knr% FILE GAdrDat$ INDEX codeku.GAdrDat$
           CALL KVERTRAG()
           OPEN FORM GPrjForm$ + "EINGANG2"
           SET f = Superbase.Form
           SET STATUS "ZahlungseingÑnge"
           SELECT FORM KEY GetVertrag% FILE "zeingan1" INDEX codevt.zeingan1
           SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
           FORM 
           CALL ZEINIntro1(codevt.zeingan1)
           CALL MNEINGANG1()
           CALL ZEINUpdate1(codevt.zeingan1)
         ELSE 
           CALL Fehler("Vertrag wurde nicht gefunden!","")
         END IF 
         IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1(codevt%)
         SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
         SELECT FORM KEY codeaz% FILE "zeingan1" INDEX codeaz.zeingan1
         Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
         kondart% = kondart.zeingan1
         FORM 
     CASE 3
       REM Zahlungseingang lîschen
       codevt% = codevt.zeingan1
       CALL ZEINLoesch1()
       
       IF maske$ = "EINGANGK" OR maske$ = "EINGAFS1" OR maske$ = "EINGFP1" THEN 
         IF EXISTS (codevt%,codevt.zeingan1) THEN 
           SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
           SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
 
           CALL ZEINUpdate1(codevt%)
           CALL ZEINIntro1(codevt%)
         ELSE 
           CALL Fehler("Es existieren keine weiteren ZahlungseingÑnge!","")
           _formend% = 1
         END IF 
       END IF 
     CASE 4
       REM Konditionen einsehen
       IF proviab.kvertrag > 0 THEN 
         CALL ZEKondShow()
       ELSE 
         CALL Fehler("Der Vertrag wurde noch nicht an die Provisionsabrechnung Åbergeben, deshalb kînnen auch keine Konditionen angezeigt werden!","")
       END IF 
     CASE 5
       IF NOT disabled%("ZEDRU") THEN 
         IF maske$ = "EINGANGK" OR maske$ = "EINGAFS1" THEN 
           IF PrvVerfahr$ LIKE "Zahlungseingang" THEN 
             CALL ZEDruck(codevt.zeingan1)
           END IF 
         ELSE 
           IF PrvVerfahr$ LIKE "Zahlungseingang" THEN 
             CALL ZEDruck(0)
           END IF 
         END IF 
       END IF 
     CASE 6
       REM Duplizeiren von ZahlungseingÑngen
       REQUEST "Zahlungseingang kopieren?","",130,req%
       IF req% = 1 THEN 
         BLANK DUPLICATE FILE "zeingan1"
         CodeAZ% = SER ("zeingan1",1)
         CodeAZ.zeingan1 = CodeAZ%
         gebuchtJN.zeingan1 = "N"
         Buchungstext.zeingan1 = Buchungstext.zeingan1 + " @"
         CALL QuickStore("Zeingan1")
         CALL EinZein1()
         REQUEST "ZE wurde kopiert","Kopie wurde mit @ gekennzeichnet!",0
       END IF 
     CASE 7
       REQUEST "Mîchten Sie den akt.Zahlungseingang des","Vertrages gleich verrechnen lassen?",130,req%
       IF req% = 1 THEN 
         IF ProvSperreJN.kvertrag LIKE "j" THEN 
           CALL Fehler("Die ZE kînnen nicht gebucht werden, da der Vertrag eine Provisionssperre enthÑlt","")
         ELSE 
           IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
             REQUEST "Sollen Fîrderkonditionen einbezogen werden?","",130,req%
           ELSE 
             REQUEST "Sollen Fîrderkonditionen einbezogen werden?","",130,req%
           END IF 
           IF req% <> 1 THEN 
             GFoerdVerr% = - 1
           ELSE 
             GFoerdVerr% = 0
           END IF 
           GVertrID% = lfdnr.kvertrag
           GZEID% = CodeAZ.zeingan1
           CALL PROVBUZEIN()
           GZEID% = 0
         END IF 
       END IF 
       SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
       SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
       CALL ZEINIntro1(GVertrID%)
       FORM 
     CASE 8
       REM Splitten von ZahlungseingÑngen
       GVertrID% = lfdnr.kvertrag
       GZEID% = CodeAZ.zeingan1
       IF gebuchtJN.zeingan1 LIKE "J" THEN 
         CALL Fehler("Dieser ZE kann nicht gesplittet werden, da er schon gebucht wurde!","")
       ELSE 
         REQUEST "Soll der vorhandene ZE in mehrere ZE gesplittet werden?","Es wird pro Monat ein Betrag erzeugt!",130,req%
         IF req% = 1 THEN 
           CALL Fehler("Der ZE wird in soviele Teile gesplittet, wie Sie im nachfolgenden Dialog angeben!","Dabei wird pro Monat ein Splitteil erzeugt und das Buchungsdatum entsprechend gesetzt, das FÑlligkeitsdatum bleibt unverÑndert.")
a220220051: 
           ON ERROR GOTO ErrorHandler
           CREATE DIALOG "ANPASSUNG",0,0,177,94,"ZE Splittung","MS Sans Serif",8
           ADD DIALOG "ANPASSUNG",5,6,6,116,10,0,"Splittung des ZE:"
           ADD DIALOG "ANPASSUNG",5,6,20,159,8,0,"Bitte geben Sie ein, in wieviele Teile"
           ADD DIALOG "ANPASSUNG",5,6,30,150,8,0,"der ZE gesplittet werden soll."
           ADD DIALOG "ANPASSUNG",6,46,49,59,13,0,0,anp$,3
           ADD DIALOG "ANPASSUNG",5,6,49,38,11,0,"Teile:"
           ADD DIALOG "ANPASSUNG",1,34,70,50,16,1,"&OK",1,1
           ADD DIALOG "ANPASSUNG",1,86,70,50,16,0,"&Abbruch",0,0
           DIALOG "ANPASSUNG",req%
           REMOVE DIALOG "ANPASSUNG"
           IF req% = 1 THEN 
             ON ERROR GOTO a220220051
             anp% = VAL (anp$)
             ON ERROR GOTO ErrorHandler
             
             IF anp% > 1 THEN 
               SELECT FIRST FILE "zeingan1" INDEX codeaz.zeingan1
               SELECT KEY GZEID% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
               tag% = DAY (BuchungsDatum.zeingan1)
               monat% = MONTH (BuchungsDatum.zeingan1)
               jahr% = YEAR (BuchungsDatum.zeingan1)
               oldw$ = LTRIM$ ( STR$ (Bewertung.zeingan1,",999999999.00"))
               splitbetrag% = Bewertung.zeingan1 / anp%
               splitbetrag$ = STR$ (splitbetrag%,"999999999.00")
               splitbetrag% = VAL (splitbetrag$)
               REM SELECT CURRENT LOCK FILE "zeingan1"
               Bewertung.zeingan1 = splitbetrag%
               ausZESplitt.zeingan1 = 1
               IF znotiz.zeingan1 <> "" THEN 
                 znotiz.zeingan1 = znotiz.zeingan1 + CHR$ (13) + CHR$ (10) + "Ges.betr.:" + oldw$ + " wurde in " + LTRIM$ ( STR$ (anp%,"999999")) + " Teile gesplittet am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " von " + GMAName$
               ELSE 
                 znotiz.zeingan1 = "Ges.betr.:" + oldw$ + " wurde in " + LTRIM$ ( STR$ (anp%,"999999")) + " Teile gesplittet am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " von " + GMAName$
               END IF 
               CALL BetrNett()
               CALL QuickStore("zeingan1")
               FOR i% = 1 TO anp% - 1
                 monat% = monat% + 1
                 IF monat% > 12 THEN 
                   monat% = 1
                   jahr% = jahr% + 1
                 END IF 
                 IF tag% > 28 THEN tag% = 28
                 datum$ = STR$ (tag%,"00") + "." + STR$ (monat%,"00") + "." + STR$ (jahr%,"0000")
                 BLANK DUPLICATE FILE "zeingan1"
                 codeaz.zeingan1 = SER ("zeingan1",1)
                 BuchungsDatum.zeingan1 = DAYS (datum$)
                 REM Bewertung.zeingan1 = splitbetrag%
                 REM CALL BetrNett()
                 CALL QuickStore("zeingan1")
               NEXT i%
               CALL Fehler("Es wurden alle SplittbetrÑge erzeugt!","")
             END IF 
           END IF 
         END IF 
       END IF 
       SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
       SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
       CALL ZEINIntro1(GVertrID%)
       FORM 
     CASE 9
       codevt% = lfdnr.kvertrag
       GVertrID% = lfdnr.kvertrag
       Date1$ = DATE$ ( TODAY ,"0d.mm.yyyy")
  aa12$ = "falls Sie einen Vertrag auf Provisionsperre gelegt hatten und diese jetzt aufgehoben ist." + " Hierbei ist es jetzt notwendig bei den ZE das Datum neu zu setzen,damit die Provisionen beim aktuellen Monat auf der Provisionsliste erscheinen!"
       CALL Fehler("Sie erhalten jetzt die Mîglichkeit, bei allen noch nicht gebuchten ZE dieses Vertrages das Buchungsdatum zu setzen.","Dies ist normalerweise notwendig, " + aa12$)
a230220051: 
       CREATE DIALOG "ANSCHLUSS",0,0,191,92,"ZE Datum","MS Sans Serif",8
       ADD DIALOG "ANSCHLUSS",4,0,0,191,68,0,""
       ADD DIALOG "ANSCHLUSS",9,9,12,21,23,2
       ADD DIALOG "ANSCHLUSS",5,38,12,144,20,0,"Bitte geben Sie ein, auf welches Datum die ZE gesetzt werden sollen:"
       ADD DIALOG "ANSCHLUSS",5,38,42,33,10,0,"Datum:"
       ADD DIALOG "ANSCHLUSS",6,73,41,51,11,0,0,Date1$,10
       ADD DIALOG "ANSCHLUSS",1,4,72,55,14,1,"&OK",1,1
       ADD DIALOG "ANSCHLUSS",1,68,72,55,14,1,"&Abbruch",0,0
       DIALOG "ANSCHLUSS",req%
       REMOVE DIALOG "ANSCHLUSS"
       IF req% = 1 THEN 
         IF DateOK%(Date1$) THEN 
           Date1% = DAYS (Date1$)
         ELSE 
           CALL Fehler("Datum ist fehlerhaft!","")
           GOTO a230220051
         END IF 
         REQUEST "Soll bei allen nichtgebuchten ZE des Vertrages das Datum auf den ",Date1$ + "  geÑndert werden?",130,req%
         IF req% = 1 THEN 
           SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
           SELECT KEY codevt% LOCK FILE "zeingan1" INDEX codevt.zeingan1
           WHILE NOT EOF ("zeingan1") AND codevt.zeingan1 = codevt%
             IF gebuchtJN.zeingan1 LIKE "j" THEN 
             ELSE 
               buold$ = DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy")
               BuchungsDatum.zeingan1 = date1%
               IF znotiz.zeingan1 <> "" THEN 
                 znotiz.zeingan1 = znotiz.zeingan1 + CHR$ (13) + CHR$ (10) + "Buchungsdatum vom: " + buold$ + " in " + DATE$ (date1%,"0d.mm.yyyy") + " geÑndert am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " von " + GMAName$
               ELSE 
                 znotiz.zeingan1 = "Buchungsdatum vom: " + buold$ + " in " + DATE$ (date1%,"0d.mm.yyyy") + " geÑndert am " + DATE$ ( TODAY ,"0d.mm.yyyy") + " von " + GMAName$
               END IF 
               CALL QuickStore("zeingan1")
             END IF 
             SELECT NEXT LOCK FILE "zeingan1" INDEX codevt.zeingan1
           WEND 
           REQUEST "Verarbeitung beendet!","",2
         END IF 
       END IF 
       SELECT FIRST FILE "zeingan1" INDEX codevt.zeingan1
       SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
       CALL ZEINIntro1(GVertrID%)
       FORM 
     CASE 99
     MENU OFF 
     IF RECCOUNT ("zeingan1") = 0 THEN CALL ZEINNeu1()
      IF PAGE = 1 THEN 
       IF gebuchtJN.zeingan1 <> "J" THEN 
         f.neu.enabled = 0
         f.bearb.enabled = 0
         f.abbruch.enabled = - 1
         f.abbruch.visible = - 1
         f.suchen.visible = 0
         f.suchen.enabled = 0
         f.zurueck.enabled = 0
         f.loeschen.enabled = 0
         f.druck.enabled = 0
         f.kopie.enabled = 0
         IF maske$ <> "EINGANGK" AND maske$ <> "EINGAFS1" AND maske$ <> "EINGFP1" THEN f.uebersicht.enabled = 0
         ON ERROR GOTO e151120051
         f.zebuch.enabled = - 1
e151120051: 
         ON ERROR GOTO ErrorHandler
         zbetragold% = bewertung.zeingan1
         IF maske$ = "EINGANGK" OR maske$ = "EINGAFS1" THEN 
           IF maske$ = "EINGANGK" THEN ENTER BetragBrut.zeingan1,0
           IF maske$ = "EINGAFS1" THEN ENTER Bewertung.zeingan1,0
         ELSE 
           ENTER VS_Nr.zeingan1,0
         END IF 
         ON ERROR GOTO e151120052
         f.zebuch.enabled = 0
e151120052: 
         ON ERROR GOTO ErrorHandler 
         f.neu.enabled = - 1
         f.druck.enabled = - 1
         f.bearb.enabled = - 1
         f.abbruch.enabled = 0
         f.abbruch.visible = 0
         f.suchen.visible = - 1
         f.suchen.enabled = - 1
         f.zurueck.enabled = - 1
         f.loeschen.enabled = - 1
         f.kopie.enabled = - 1
         IF maske$ <> "EINGANGK" AND maske$ <> "EINGAFS1" AND maske$ <> "EINGFP1" THEN f.uebersicht.enabled = - 1
       ELSE 
         REM 14.05.99
         CALL Fehler("Satz kann normalerweise nicht bearbeitet werden, da er schon gebucht wurde!!!","")
         REQUEST "Wollen Sie den Satz trotzdem bearbeiten?","Es werden dann zunÑchst die zugehîrigen BuchungssÑtze gelîscht!!!",130,req2%
         IF req2% = 1 THEN 
           IF disabled%("ZEINLoeschen") THEN 
           ELSE 
             CALL DFile(3,"kvertrag" + _fpw$)
             SELECT KEY CodeVT.zeingan1 LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
             pool% = (Pool.KVERTRAG - bewertung.zeingan1) * 100
             pool1$ = STR$ (pool%,"999999999999")
             poolges% = ( VAL (pool1$)) / 100
             pool.kvertrag = poolges%
             CALL QuickStore("KVERTRAG")
             CALL DFile(3,"buchung1" + _fpw$)
             FILE "Buchung1"
             INDEX CodeVT.buchung1
             SELECT FIRST 
             cuaz% = CodeAZ.zeingan1
             codevt% = CodeVT.zeingan1
             SET STATUS "Bitte warten, es werden die zugehîrigen Buchungen gelîscht!"
             FILE "Buchung1"
             buchalt% = 0
             IF EXISTS (cuaz%,codeaz.buchung1) THEN 
               REM 19042001
               SELECT KEY cuaz% FILE "Buchung1" INDEX codeaz.buchung1
               WHILE NOT EOF ("Buchung1") AND codeaz.buchung1 = cuaz%
                 srb% = sr.buchung1
                 einheit% = einheiten.buchung1
                 volumen% = Volumen.buchung1
                 ma% = Codema.buchung1
                 IF srb% <> 0 OR einheit% <> 0 OR volumen% <> 0 THEN 
                   ma% = Codema.buchung1
                   vcodema% = vtcodema.buchung1
                   FILE "maadr"
                   INDEX codema.maadr
                   SELECT FIRST 
                   SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
                   IF srb% <> 0 THEN 
                     Stornoreserve.maadr = stornoreserve.maadr - srb%
                     StornoreserveEu.maadr = VAL ( STR$ (stornoreserve.maadr / umrechnung.buchung1,"999999999.00"))
                   END IF 
                   IF einheit% <> 0 THEN 
                     Einheiten.maadr = einheiten.maadr - einheit%
                     IF ma% = vcodema% THEN 
                       EigEinheiten.maadr = Eigeinheiten.maadr - einheit%
                       EinheitGes.maadr = EinheitGes.maadr - einheit%
                     ELSE 
                       sEinheitGes.maadr = sEinheitGes.maadr - einheit%
                     END IF 
                   END IF 
                   IF volumen% <> 0 THEN 
                     gesvolumen.maadr = Gesvolumen.maadr - volumen%
                     IF ma% = vcodema% THEN 
                       eigvolumen.maadr = eigvolumen.maadr - volumen%
                     END IF 
                   END IF 
                   REM Workstation.maadr = Workstation%
                   REM QWoNo.maadr = STR$ (Workstation%,"000000") + STR$ (codema.maadr,"000000")
                   RecStatus.maadr = "c"
                   STORE FILE "maadr"
                   UNLOCK CURRENT FILE "maadr"
                 END IF 
                 ma% = codema.buchung1
                 SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
                 betr% = Betrag.buchung1 * - 1
                 IF Provision.buchung1 = "j" THEN 
                   zusatz% = 0
                 ELSE 
                   zusatz% = 1
                 END IF 
                 IF vtcodema.buchung1 = codema.buchung1 THEN 
                   eigen% = 1
                 ELSE 
                   eigen% = 0
                 END IF 
                 PSpAll$ = ""
                 PSpAllSeit% = 0
                 PROVSpEig$ = ""
                 PSpESeit% = 0
                 datumz% = Datum.buchung1
                 codew1% = codew.buchung1
                 waehrung1$ = waehrung.buchung1
                 euro1% = umrechnung.buchung1
                 srb% = srb% * - 1
 
                 IF einheiten.buchung1 > 0 THEN 
                   einheit% = einheiten.buchung1 * - 1
                 ELSE 
                   einheit% = einheiten.buchung1
                 END IF 
                 CALL ZentrKTO(ma%,datumz%,betr%,srb%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,einheit%)
                 SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
                 IF zusatz% = 0 THEN 
                   AuszahlAB.maadr = AuszahlAB.maadr + betr%
                   AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
                   AuszProvABGes.maadr = AuszProvABGes.maadr + betr%
                   AuszProvABGesEU.maadr = VAL ( STR$ (AuszProvABGes.maadr / euro1%,"999999999.00"))
                 ELSE 
                   AuszahlAB.maadr = AuszahlAB.maadr + betr%
                   AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
                   zusAuszahl.maadr = zusAuszahl.maadr + betr%
                   zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
                   aktZusB.maadr = aktZusB.maadr + betr%
                   aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
                 END IF 
                 STORE FILE "maadr"
                 UNLOCK CURRENT FILE "maadr"
       
                 FILE "Buchung1"
                 SELECT NEXT FILE "Buchung1" INDEX codeaz.buchung1
               WEND 

               REM 20032003

               FILE "Buchung1"
               INDEX codeaz.buchung1
               SELECT FIRST 
loebu20030301: 
               ErrZAB% = 0
               IF EXISTS (cuaz%,codeaz.buchung1) THEN 
                 SET STATUS "in buchung1"
                 SELECT KEY cuaz% LOCK FILE "Buchung1" INDEX codeaz.buchung1
                 SELECT REMOVE FILE "Buchung1"
                 SELECT FIRST FILE "Buchung1"
                 GOTO loebu20030301
               END IF 

               REM REMOVE FROM FILE "Buchung1" WHERE CodeAZ.Buchung1 = Cuaz%
               REM SELECT REMOVE 
             ELSE 
               buchalt% = - 1
               IF EXISTS (codevt%,CodeVT.buchung1) THEN 
                 REMOVE FROM FILE "Buchung1" WHERE CodeVT.buchung1 = Codevt%
               END IF 
             END IF 
             SET STATUS ""
             FILE "zeingan1"
             
             IF buchalt% = 0 THEN 
               SELECT KEY cuaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
               gebuchtJN.zeingan1 = "N"
               gebuchtJNT.zeingan1 = "N"
             ELSE 
               SELECT KEY codevt% LOCK FILE "zeingan1" INDEX codevt.zeingan1
               WHILE NOT EOF ("zeingan1") AND codevt.zeingan1 = codevt%
                 gebuchtJN.zeingan1 = "N"
                 gebuchtJNT.zeingan1 = "N"
                 STORE FILE "zeingan1"
                 SELECT NEXT LOCK FILE "zeingan1" INDEX codevt.zeingan1
               WEND 
             END IF 
 
             CALL QuickStore("zeingan1")
             SELECT KEY cuaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
             f.neu.enabled = 0
             f.bearb.enabled = 0
             f.abbruch.enabled = - 1
             f.abbruch.visible = - 1
             f.suchen.visible = 0
             f.suchen.enabled = 0
             f.zurueck.enabled = 0
             f.loeschen.enabled = 0
             IF maske$ <> "EINGANGK" AND maske$ <> "EINGAFS1" AND maske$ <> "EINGFP1" THEN f.uebersicht.enabled = 0
       
             zbetragold% = bewertung.zeingan1
             ENTER VS_Nr.zeingan1,0
             f.neu.enabled = - 1
             f.bearb.enabled = - 1
             f.abbruch.enabled = 0
             f.abbruch.visible = 0
             f.suchen.visible = - 1
             f.suchen.enabled = - 1
             f.zurueck.enabled = - 1
             f.loeschen.enabled = - 1
             IF maske$ <> "EINGANGK" AND maske$ <> "EINGAFS1" AND maske$ <> "EINGFP1" THEN f.uebersicht.enabled = - 1
           END IF 
         END IF 
       END IF 
       REM IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1()
     END IF 
   END SELECT 
   MENU ON 
 WEND 
 GCodeVP% = 0
 GsVSNR$ = ""
 GCodege% = 0
 
 REM CALL ZEINbuchung1( - 1)
 REM 110397 CALL ZEINbuchung1(0)
 _formend% = 0
 END SUB 
  
 
SUB ZEINIntro1(codevt%)
 MOUSE OFF 
 FILE "zeingan1"
 IF codevt% = 0 THEN 
   INDEX CodeAZ.zeingan1
   codevt% = Codevt.zeingan1
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT FORM KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
 ELSE 
   INDEX codevt.zeingan1
   SELECT FORM KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
   SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
   IF codeko.kvertrag > 0 THEN Kondition$ = ZwFirmKond$(codeko.kvertrag)
   waehr$ = "WÑhrung: " + waehrung.zeingan1
 END IF 
 REM 020798 SELECT FORM LAST 
 FORM 
 END SUB 
 
SUB EinZein1()
 codeaz% = codeaz.zeingan1
 SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
 SELECT FORM KEY codeaz% FILE "zeingan1" INDEX codeaz.zeingan1
 Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 kondart% = kondart.zeingan1
 waehr$ = "WÑhrung: " + waehrung.zeingan1
 FORM 
 END SUB 
 
SUB ZEINUpdate1(codevt%)
 REM 25012000
 REM codeaz% = codeaz.zeingan1
 codevt% = codevt.zeingan1
 IF codeaz% > 0 AND codevt.zeingan1 > 0 THEN 
   SELECT FORM KEY CodeVT.zeingan1 FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
   REM SELECT FORM KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
   SELECT FORM KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
 END IF 
 kondart% = kondart.zeingan1
 SELECT FIRST FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY CodeVT% FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SELECT KEY codevt% FILE "zeingan1" INDEX codevt.zeingan1
 SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
 SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
 SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
 SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 lGesellschaft$ = Gesellschaft.GEADR
 lAgentur$ = Nachname.MAADR + ", " + Vorname.MAADR + ", " + Agenturnr.maadr
 lSparte$ = Sparte.SPARTEN
 lKunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
 lAussenstand$ = STR$ (pool.kvertrag,"999999999.00")
 IF pool.kvertrag < 0 THEN 
   vausgut$ = "Aussenstand:"
 ELSE 
   vausgut$ = "Guthaben:"
 END IF 
 waehr$ = "WÑhrung: " + waehrung.zeingan1
 Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
 IF kÅndigung.maadr > 0 THEN 
   lKuendAG$ = DATE$ (kÅndigung.maadr,"0d.mm.yyyy")
 ELSE 
   lKuendAG$ = ""
 END IF 
 eingbei$ = EingereichtBei.kvertrag
 IF eingbei$ = "" THEN 
   eingbei$ = "eingereicht Åber"
 END IF 
 IF MNdisabled%("SEEEINGBEI") THEN 
     eingbei$ = "wurde ausgeblendet"
 END IF 
 REM CALL Fehler("","")
 Kondition$ = ZwFirmKond$(codeko.kvertrag)
 FORM 
 END SUB 
 
 
SUB ZEINNeu1()
 REM IF NEW ("zeingan1") OR MOD ("zeingan1") THEN CALL FStore("zeingan1")
 FILE "Zeingan1"
 lVSNR$ = VS_Nr.zeingan1 + " (" + DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy") + "/" + LTRIM$ ( STR$ (Bewertung.zeingan1,",999999999.00")) + ")"
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 CodeAZ% = SER ("zeingan1",1)
 CodeAZ.zeingan1 = CodeAZ%
 gebuchtJN.zeingan1 = "N"
 gebuchtJNT.zeingan1 = "N"
 IF GZEDat% > 0 THEN 
   BuchungsDatum.zeingan1 = DATE$ (GZEDat%,"0d.mm.yyyy")
 ELSE 
   BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
 END IF 
 IF GZEDatF% > 0 THEN 
   FÑlligkeit.zeingan1 = DATE$ (GZEDatF%,"0d.mm.yyyy")
 END IF 
 REM Codew.zeingan1 = ZWCodew%
 REM waehrung.zeingan1 = zweitwaehr$
 REM umrechnung.zeingan1 = euro%
 zweitwaehr$ = waehrung.stamm
 euro% = umrechnung.stamm
 ZWCodew% = codew.stamm
 Codew.zeingan1 = ZWCodew%
 waehrung.zeingan1 = zweitwaehr$
 umrechnung.zeingan1 = euro%
 kondart.zeingan1 = 1
 CALL QuickStore("zeingan1")
 waehr$ = "WÑhrung: " + waehrung.zeingan1
 SELECT KEY codeaz% FILE "zeingan1" INDEX codeaz.zeingan1
 lKunde$ = ""
 lGesellschaft$ = ""
 lSparte$ = ""
 lAgentur$ = ""
 eingbei$ = ""
 REM SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
 REM FORM 
 ZEINsub% = 99
 END SUB 
 
 
SUB ZEINNeu2()
 REM IF NEW ("zeingan1") OR MOD ("zeingan1") THEN CALL FStore("zeingan1")
 FILE "Zeingan1"
    opt1% = 0
    DIM dlg AS Dialog
    DIM control AS DialogControl
    IF FirmaEinhTab.stamm = "j" AND PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
      Superbase.Dialogs.Add("SELZIEL")
      SET dlg = Superbase.Dialogs.SELZIEL
      dlg.Move(0,0,122,130)
      dlg.Caption = "ZE wÑhlen"
      dlg.FontName = "MS Sans Serif"
      dlg.FontSize = 8
 
      SET control = dlg.Add("DialogFrame1","DialogFrame")
      control.Move(0,1,123,105)
      control.Caption = "Art des Zahlungseinganges"
 
      SET control = dlg.Add("DialogIcon1","DialogIcon")
      control.Move(2,16,20,22)
      control.Icon = 2
 
      SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
      control.Move(30,19,86,11)
      control.Caption = "AP"
      control.Bind("opt1%")
      control.ValueOn = 0
 
      SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
      control.Move(30,33,86,11)
      control.Caption = "Courtage"
      control.Bind("opt1%")
      control.ValueOn = 1
 
      SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
      control.Move(30,47,86,11)
      control.Caption = "Pflege"
      control.Bind("opt1%")
      control.ValueOn = 2
 
      SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
      control.Move(36,109,64,16)
      control.Default = 1
      control.Caption = "&OK"
      control.ReturnValue = 1
      DIALOG "SELZIEL",req%
      REMOVE DIALOG ALL 
    ELSE 
      Superbase.Dialogs.Add("SELZIEL")
      SET dlg = Superbase.Dialogs.SELZIEL
      dlg.Move(0,0,122,130)
      dlg.Caption = "ZE wÑhlen"
      dlg.FontName = "MS Sans Serif"
      dlg.FontSize = 8
 
      SET control = dlg.Add("DialogFrame1","DialogFrame")
      control.Move(0,1,123,105)
      control.Caption = "Art des Zahlungseinganges"
 
      SET control = dlg.Add("DialogIcon1","DialogIcon")
      control.Move(2,16,20,22)
      control.Icon = 2
 
      SET control = dlg.Add("DialogOptionButton1","DialogOptionButton")
      control.Move(30,19,86,11)
      control.Caption = "AP"
      control.Bind("opt1%")
      control.ValueOn = 0
 
      SET control = dlg.Add("DialogOptionButton2","DialogOptionButton")
      control.Move(30,33,86,11)
      control.Caption = "Courtage"
      control.Bind("opt1%")
      control.ValueOn = 1

      SET control = dlg.Add("DialogOptionButton3","DialogOptionButton")
      control.Move(30,47,86,11)
      control.Caption = "Pflege"
      control.Bind("opt1%")
      control.ValueOn = 2

      SET control = dlg.Add("DialogOptionButton4","DialogOptionButton")
      control.Move(30,61,86,11)
      control.Caption = "Ersatz-AP"
      control.Bind("opt1%")
      control.ValueOn = 3

      SET control = dlg.Add("DialogOptionButton5","DialogOptionButton")
      control.Move(30,75,86,11)
      control.Caption = "Dynamik AP"
      control.Bind("opt1%")
      control.ValueOn = 4

      SET control = dlg.Add("DialogOptionButton6","DialogOptionButton")
      control.Move(30,89,86,11)
      control.Caption = "Betreuung"
      control.Bind("opt1%")
      control.ValueOn = 5


      SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
      control.Move(36,109,64,16)
      control.Default = 1
      control.Caption = "&OK"
      control.ReturnValue = 1
      DIALOG "SELZIEL",req%
      REMOVE DIALOG ALL 
    END IF 
 SELECT FIRST FILE "VPRODUKT" INDEX codevp.vprodukt
 SELECT KEY codevp.kvertrag FILE "VPRODUKT" INDEX codevp.vprodukt
 IF ZahlBertrMin.vprodukt <> 0 OR ZahlBertrMax.vprodukt <> 0 THEN 
   zmin% = ZahlBertrMin.vprodukt
   zmax% = ZahlBertrMax.vprodukt
 ELSE 
   SELECT FIRST FILE "sparten" INDEX codeva.sparten
   SELECT KEY codeva.kvertrag FILE "sparten" INDEX codeva.sparten
   zmin% = ZahlBertrMin.sparten
   zmax% = ZahlBertrMax.sparten
 END IF 
 REM CALL Fehler("ZE","")
 BLANK FILE "Zeingan1"
 SET STATUS "Datensatz neu angelegt..."
 CodeAZ% = SER ("zeingan1",1)
 CodeAZ.zeingan1 = CodeAZ%
 gebuchtJN.zeingan1 = "N"
 gebuchtJNT.zeingan1 = "N"
 REM BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
 IF GZEDat% > 0 THEN 
   BuchungsDatum.zeingan1 = DATE$ (GZEDat%,"0d.mm.yyyy")
 ELSE 
   BuchungsDatum.zeingan1 = DATE$ ( TODAY ,"0d.mm.yyyy")
 END IF 
 IF GZEDatF% > 0 THEN 
   FÑlligkeit.zeingan1 = DATE$ (GZEDatF%,"0d.mm.yyyy")
 END IF 
 codege.zeingan1 = codege.kvertrag
 Codew.zeingan1 = codew.kvertrag
 BewertKV.zeingan1 = Bewertungssumme.kvertrag
 codevt% = lfdnr.kvertrag
 CodeEingGE.zeingan1 = CodeEingGE.kvertrag
 EingereichtBei.zeingan1 = EingereichtBei.kvertrag
 IF opt1% = 2 THEN 
   IF EXISTS (codevt%,codevt.kvskond) THEN 
     SELECT FIRST FILE "kvskond" INDEX codevt.kvskond
     SELECT KEY codevt% FILE "kvskond" INDEX codevt.kvskond
     codeko% = codeko.kvskond
     IF EXISTS (codeko%,codekey.vpgekond) THEN 
       SELECT FIRST FILE "vpgekond" INDEX codekey.vpgekond
       SELECT KEY codeko% FILE "vpgekond" INDEX codekey.vpgekond
       IF PflegevomNetto.stamm = "j" OR PflegevomNetto.vpgekond = "j" THEN 
         BewertKV.zeingan1 = NettoBeitrag.kvertrag
       ELSE 
         BewertKV.zeingan1 = Beitrag.kvertrag
       END IF 
     END IF 
   END IF 
 END IF 
 waehrung.zeingan1 = waehrung.kvertrag
 umrechnung.zeingan1 = umrechnung.kvertrag
 kondart.zeingan1 = opt1%
 codevt.zeingan1 = lfdnr.kvertrag
 codevt% = lfdnr.kvertrag
 VS_Nr.zeingan1 = VS_Nr.kvertrag
 AntragsNr.zeingan1 = AntragsNr.kvertrag
 workstation.zeingan1 = workstation.kvertrag
 mwst.zeingan1 = mwst.vprodukt
 ZahlBertrMin.zeingan1 = zmin%
 ZahlBertrMax.zeingan1 = zmax%

 CALL QuickStore("zeingan1")
 lVSNR$ = VS_Nr.zeingan1 + " (" + DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy") + "/" + LTRIM$ ( STR$ (Bewertung.zeingan1,",999999999.00")) + ")"
 waehr$ = "WÑhrung: " + waehrung.zeingan1
 lKunde$ = ""
 lGesellschaft$ = ""
 lSparte$ = ""
 lAgentur$ = ""
 eingbei$ = ""
 CALL ZEINIntro1(codevt%)
 CALL ZEINUpdate1(codevt%)
 SELECT KEY codeaz% FILE "zeingan1" INDEX codeaz.zeingan1
 MOUSE ON 
 FORM 
 REM SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
 IF UCASE$ ( FORM ) LIKE "EINGANGK" OR UCASE$ ( FORM ) LIKE "EINGAFS1" THEN ZEINsub% = 99
 
 END SUB 
 
SUB ZEINNeu2N()
 REM IF NEW ("zeingan1") OR MOD ("zeingan1") THEN CALL FStore("zeingan1")
 FILE "Zeingang"
 BLANK 
 SET STATUS "Datensatz neu angelegt..."
 CodeAZ% = SER ("zeingang",1)
 CodeAZ.zeingang = CodeAZ%
 Codew.zeingang = codew.kvertrag
 waehrung.zeingang = waehrung.kvertrag
 umrechnung.zeingang = umrechnung.kvertrag
 REM kondart.zeingang = 1
 codevt.zeingang = lfdnr.kvertrag
 VS_Nr.zeingang = VS_Nr.kvertrag
 gebucht.zeingang = "n"
 Datum.zeingang = TODAY 
 CALL QuickStore("zeingang")
 waehr$ = "WÑhrung: " + waehrung.zeingang
 SELECT KEY codeaz% FILE "zeingang" INDEX codeaz.zeingang
 lKunde$ = ""
 lGesellschaft$ = ""
 lSparte$ = ""
 lAgentur$ = ""
 eingbei$ = ""
 REM SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
 IF UCASE$ ( FORM ) LIKE "EINGANGN" THEN ZEINsub% = 99
 FORM 
 END SUB 
 
 
 
 ' Zahlungseingang sichern
 ' =======================================================================
 ' 19.09.95  automatischer Abglich mit Mahnliste
 
SUB ZEINSich1()
 IF NEW ("zeingan1") OR MOD ("zeingan1") THEN 
 ELSE 
   GOTO end290920032
 END IF 
 cuzein% = CodeAZ.zeingan1
 cuvnr% = CodeVT.zeingan1
 betrag% = bewertung.zeingan1
 CALL BetrNett()
 CALL ZEINTest2()
 CALL QuickStore("zeingan1")
 differenz% = betrag% - zbetragold%
 REM FILE "zeingan1"
 REM INDEX CodeVT.zeingan1
 REM SELECT FIRST 
 REM SELECT KEY cuvnr% FILE "zeingan1" INDEX CodeVT.zeingan1
 REM gezahlt% = 0
 REM WHILE NOT EOF ("zeingan1") AND CodeVT.zeingan1 = cuvt%
   REM gezahlt% = gezahlt% + betrag.zeingan1
 REM SELECT NEXT 
 REM WEND 
 
 SELECT KEY cuvnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 SET STATUS "Abgleich mit Mahnliste..."
 pool% = (Pool.KVERTRAG + differenz%) * 100
 pool1$ = STR$ (pool%,"999999999999")
 poolges% = ( VAL (pool1$)) / 100
 pool.kvertrag = 0
 gebucht.zeingan1 = "j"
 IF Poolges% < 0 THEN Mahnung.KVERTRAG = "j"
 CALL QuickStore("KVERTRAG")
 IF Mahnung.KVERTRAG LIKE "j" THEN 
   MOUSE OFF 
   IF Pool.KVERTRAG >= 0 THEN 
     SELECT KEY cuvnr% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     Mahnung.KVERTRAG = "n"
     CALL QuickStore("KVERTRAG")
     CALL DFile(3,"buchung1" + _fpw$)
     UPDATE Mahnung.buchung1 = "n" WHERE CodeVT.buchung1 = cuvnr% AND Mahnung.buchung1 LIKE "j"
     END UPDATE 
     CLOSE FILE "buchung1"
     CALL DFile(3,"buchung1" + _fpw$)
     REM CALL Info("Alle Buchungen des Vertrages " + VS_NR.KVERTRAG + " konnten aus der Mahnliste entfernt werden.","")
   ELSE 
     REM CALL Info("Zur Information:","Es fehlen noch " + LTRIM$ ( STR$ (0 - Pool.KVERTRAG,",9999999.00")) + " DM zur Auszahlung der in der Mahnliste enthaltenen Provisionen!")
   END IF 
   MOUSE ON 
 ELSE 
   REM CALL FStore("zeingan1")
 END IF 
 SELECT FORM KEY cuvnr% FILE "zeingan1" INDEX codevt.zeingan1
 SELECT KEY cuzein% LOCK FILE "zeingan1" INDEX CodeAZ.zeingan1
 IF bewertung.zeingan1 > 49999 THEN CALL Fehler("Achtung Sie haben eine Bewertungssumme > 49999 eingegeben!","")
end290920032: 
 FORM 
 END SUB 
    
 
 
 
 
SUB ZEINTest1(codevt%)
 MOUSE OFF 
 REM CALL Fehler("ZEINTest","")
 codeaz% = codeaz.zeingan1
 SET STATUS "PrÅfung..."
 REM DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   IF RECCOUNT ("KVERTRAG") > 10000 THEN 
     DIM Vertraege$(20000)
   ELSE 
     DIM Vertraege$( RECCOUNT ("KVERTRAG"))
   END IF 
 DIM Auswahl$(1)
 cfile$ = FILE 
 VSNR$ = VS_Nr.zeingan1
 FILE "KVERTRAG"
 REM INDEX QuickVSNR.KVERTRAG
   IF VAL ( LEFT$ (VSNR$,1)) > 0 THEN 
     INDEX QNumVSNR.kvertrag
     KVIndexName$ = "QNumVSNR.kvertrag"
     tVSNR$ = VSNRPackNum$(VSNR$)
   ELSE 
     INDEX QuickVSNR.kvertrag
     KVIndexName$ = "QuickVSNR.kvertrag"
     tVSNR$ = VSNRPack$(VSNR$)
   END IF 
   KVIndex$ = INDEX + ".kvertrag"
 
vsuch031120022: 
 FILE "maadr"
 INDEX codema.maadr
 FILE "KVERTRAG"
 INDEX KVIndex$$
 SELECT FIRST 
 REM VSNR$ = VS_Nr.zeingan1
 REM tVSNR$ = VSNRPack$(VSNR$)
 SELECT KEY tVSNR$ FILE "KVERTRAG" INDEX KVIndex$$
 a% = 0
 WHILE KVIndexName$$ LIKE tVSNR$ + "*" AND NOT EOF ("KVERTRAG")
   name2$ = ""
   name1$ = ""
   sok% = - 1
   IF inhaus.kvertrag = 1 THEN sok% = 0
   IF sok% THEN 
     IF VS_Beginn.KVERTRAG < 1 THEN von$ = "__.__.____" ELSE von$ = DATE$ (VS_Beginn.KVERTRAG,"0d.mm.yyyy")
     IF KÅndigung.KVERTRAG < 1 THEN bis$ = "__.__.____" ELSE bis$ = DATE$ (KÅndigung.KVERTRAG,"0d.mm.yyyy")
     IF proviab.kvertrag > 0 THEN 
       SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
       name2$ = LTRIM$ (nachname.maadr) + "," + LTRIM$ (vorname.maadr)
       REM CALL Fehler(name2$,"")
       name1$ = PAD$ (name2$,20)
       Vertraege$(a%) = PAD$ (VS_Nr.KVERTRAG,38) + "/" + name1$ + "    " + von$ + " - " + bis$ + "  VN: " + vnehmer.kvertrag + STR$ (lfdnr.KVERTRAG,"000000")
       IF a% = 0 THEN prompt$ = Vertraege$(0)
       a% = a% + 1
     END IF 
   END IF 
   SELECT NEXT 
 WEND 
   IF a% = 0 AND suchanzahl% = 0 THEN 
     suchanzahl% = 1
     IF KVIndex$ LIKE "QNumVSNR.kvertrag" THEN 
       KVIndexName$ = "QuickVSNR.kvertrag"
       tVSNR$ = VSNRPack$(VSNR$)
     ELSE 
       KVIndexName$ = "QNumVSNR.kvertrag"
       tVSNR$ = VSNRPackNum$(VSNR$)
     END IF 
     KVIndex$ = KVIndexName$
     GOTO vsuch031120022
   END IF 
 IF a% = 0 THEN 
   sel% = 0
 ELSE 
   IF a% > 1 THEN 
     MOUSE ON 
     CREATE DIALOG "ZEINLIST",0,0,570,348,title$,"Courier New",9
     ADD DIALOG "ZEINLIST",4,0,0,570,332,0,""
     ADD DIALOG "ZEINLIST",9,8,11,25,24,2
     ADD DIALOG "ZEINLIST",5,35,11,168,20,0,"Es wurden mehrere VertrÑge mit gleicher oder Ñhnlicher Nummer gefunden."
     ADD DIALOG "ZEINLIST",5,35,31,168,20,0,"Bitte wÑhlen Sie den Vertrag aus, fÅr den diese Zahlung gilt."
     ADD DIALOG "ZEINLIST",5,35,58,198,10,0,"Vertrags-/Policennummer                       von          bis"
     ADD DIALOG "ZEINLIST",7,5,68,555,255,2 + 128,1,Vertraege$,Auswahl$,prompt$
     ADD DIALOG "ZEINLIST",1,173,332,55,15,1,"&OK",1,1
     ADD DIALOG "ZEINLIST",1,260,332,55,15,0,"&Abbrechen",0,0
     DIALOG "ZEINLIST",req%
     REMOVE DIALOG "ZEINLIST"
     IF req% = 1 THEN 
       sel% = VAL ( RIGHT$ (Auswahl$(0),6))
     ELSE 
       sel% = 0
     END IF 
   ELSE 
     sel% = VAL ( RIGHT$ (Vertraege$(0),6))
   END IF 
 END IF 
 IF sel% <> 0 THEN 
   SELECT KEY sel% FILE "Kvertrag" INDEX lfdnr.kvertrag
   checked% = 0
   IF check.KVERTRAG <> "j" THEN 
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       SELECT KEY sel% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
       checked% = - 1
       check.KVERTRAG = "j"
       CALL QuickStore("KVERTRAG")
     ELSE 
       SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
       SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
       VertrInfo$ = gesellschaft.GEADR + "/" + Sparte.Sparten
       SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX COdeKU.GAdrDat$
       Kunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
       CREATE DIALOG "CHECKEIN",0,0,222,155,title$,"MS Sans Serif",8
       ADD DIALOG "CHECKEIN",4,0,0,222,100,0,""
       ADD DIALOG "CHECKEIN",9,7,12,22,22,2
       ADD DIALOG "CHECKEIN",5,34,13,180,22,0,"Der ausgewÑhlte Vertrag wurde noch nicht fÅr die Zahlungseingangskontrolle aktiviert."
       ADD DIALOG "CHECKEIN",5,34,36,28,12,0,"Vertrag:"
       ADD DIALOG "CHECKEIN",5,66,36,149,11,0,VS_NR.KVERTRAG
       ADD DIALOG "CHECKEIN",5,66,46,149,11,0,Kunde$
       ADD DIALOG "CHECKEIN",5,66,56,147,33,0,VertrInfo$
       ADD DIALOG "CHECKEIN",5,34,100,180,29,0,"Mîchten Sie, da· alle berechneten Provisionen dieses Vertrages mit dem Zahlungseingang der Gesellschaft abgeglichen werden?"
       ADD DIALOG "CHECKEIN",1,48,134,55,15,1,"&Ja",1,1
       ADD DIALOG "CHECKEIN",1,107,134,55,15,0,"&Nein",0,0
       DIALOG "CHECKEIN",req%
       REMOVE DIALOG "CHECKEIN"
       SELECT KEY sel% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
       IF req% = 1 THEN 
         checked% = - 1
         check.KVERTRAG = "j"
       ELSE 
         check.KVERTRAG = "n"
         checked% = 0
       END IF 
       CALL QuickStore("KVERTRAG")
     END IF 
   ELSE 
     checked% = - 1
   END IF 
   IF checked% THEN 
     SELECT FIRST FILE "VPRODUKT" INDEX codevp.vprodukt
     SELECT KEY codevp.kvertrag FILE "VPRODUKT" INDEX codevp.vprodukt
     SELECT FIRST FILE "zeingan1" INDEX codeaz.zeingan1
     SELECT KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
     IF ZahlBertrMin.vprodukt <> 0 OR ZahlBertrMax.vprodukt <> 0 THEN 
       zmin% = ZahlBertrMin.vprodukt
       zmax% = ZahlBertrMax.vprodukt
     ELSE 
       SELECT FIRST FILE "sparten" INDEX codeva.sparten
       SELECT KEY codeva.kvertrag FILE "sparten" INDEX codeva.sparten
       zmin% = ZahlBertrMin.sparten
       zmax% = ZahlBertrMax.sparten
     END IF 
     VS_NR.zeingan1 = VS_Nr.KVERTRAG
     BewertKV.zeingan1 = Bewertungssumme.kvertrag
     CodeVT.zeingan1 = sel%
     REM 25012000
     CodeGE.zeingan1 = CodeGE.KVERTRAG
     CodeMA.zeingan1 = CodeMA.kvertrag
     mwst.zeingan1 = mwst.vprodukt
     ZahlBertrMin.zeingan1 = zmin%
     ZahlBertrMax.zeingan1 = zmax%
     CALL QuickStore("zeingan1")
     GAdrDat$ = "ADRESSEN"
     SELECT FORM KEY sel% FILE "zeingan1" INDEX codevt.zeingan1
     SELECT FORM KEY codeaz% LOCK FILE "zeingan1" INDEX codeaz.zeingan1
     SELECT FIRST FILE "GEADR" INDEX codege.geadr
     SELECT KEY codege.kvertrag FILE "geadr" INDEX codege.geadr
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY codema.kvertrag FILE "maadr" INDEX codema.maadr
     SELECT FIRST FILE "sparten" INDEX codeva.sparten
     SELECT KEY codeva.kvertrag FILE "sparten" INDEX codeva.sparten
     SELECT FIRST FILE "Adressen" INDEX codeku.adressen
     SELECT KEY codeku.kvertrag FILE "Adressen" INDEX codeku.adressen
     IF FORM LIKE "EINGANGK" OR UCASE$ ( FORM ) LIKE "EINGAFS1" THEN 
       CALL ZEINUpdate1(codevt.zeingan1)
     ELSE 
       REM CALL ZEINUpdate1(0)
     END IF 
     lKuendAG$ = ""
     IF kÅndigung.maadr > 0 THEN 
       lKuendAG$ = DATE$ (kÅndigung.maadr,"0d.mm.yyyy")
     END IF 
     lGesellschaft$ = Gesellschaft.GEADR
     lAgentur$ = Nachname.MAADR + ", " + Vorname.MAADR + ", " + Agenturnr.maadr
     lSparte$ = Sparte.SPARTEN
     lKunde$ = Nachname.GAdrDat$ + ", " + Vorname.GAdrDat$
     lAussenstand$ = STR$ (pool.kvertrag,"999999999.00")
     IF pool.kvertrag < 0 THEN 
       vausgut$ = "Aussenstand:"
     ELSE 
       vausgut$ = "Guthaben:"
     END IF 
     eingbei$ = EingereichtBei.kvertrag
     IF eingbei$ = "" THEN 
       eingbei$ = "eingereicht Åber"
     END IF 
     IF MNdisabled%("SEEEINGBEI") THEN 
       eingbei$ = "wurde ausgeblendet"
       f.eingbei.enabled = 0
     END IF 
     waehr$ = "WÑhrung: " + waehrung.zeingan1
     Zahlweise$ = ZW2Str$(ZW.KVERTRAG)
     IF kÅndigung.maadr > 0 THEN lKuendAG$ = DATE$ (kÅndigung.maadr,"0d.mm.yyyy")
     REM CALL Fehler("","")
     Kondition$ = ZwFirmKond$(codeko.kvertrag)
     FORM 
     IF FORM LIKE "EINGANG2" OR FORM LIKE "EINGANGK" THEN 
       ZEBRUTYES$ = UCASE$ (ReadConfig$("PROVIS","ZEBRUTYES"))
       IF ZEBRUTYES$ LIKE "TRUE" THEN 
         ENTER BetragBrut.zeingan1,0
       ELSE 
         ENTER Bewertung.zeingan1,0
       END IF 
     ELSE 
       ENTER Bewertung.zeingan1,0
     END IF 
     FORM 
   ELSE 
     VS_NR.zeingan1 = ""
     lGesellschaft$ = ""
     lAgentur$ = ""
     lSparte$ = ""
     lKunde$ = ""
     eingbei$ = ""
   END IF 
   
 ELSE 
 
   CALL Fehler("Es konnte kein Vertrag mit dieser Nummer gefunden werden, der an die Provisionsabrechnung Åbergeben wurde!","Bitte prÅfen Sie die Vertragsnummer und prÅfen Sie ob der Vertrag an die Provisionsabrechnung Åbergeben wurde.")
 END IF 
 FORM 
 SET STATUS "Bereit"
 MOUSE ON 
 FILE cfile$
 END SUB 
  
 
 
      
 ' zeingan1 Eintrag zurÅck
 ' =======================================================================
 
SUB ZEINPrev1()
 IF RECCOUNT ("zeingan1") > 0 THEN 
   IF MOD ("zeingan1") OR NEW ("zeingan1") THEN CALL FStore("zeingan1")
   cuaz% = CodeAZ.zeingan1
   codevtold% = codevt.zeingan1
   SELECT FORM PREVIOUS 
   IF EOF ("zeingan1") THEN 
     REQUEST "Dateianfang erreicht!","",2
     IF FORM LIKE "EINGANG2" OR UCASE$ ( FORM ) LIKE "EINGAFS2" THEN SELECT FORM KEY cuaz% INDEX CodeAZ.zeingan1
     IF FORM LIKE "EINGANGK" OR UCASE$ ( FORM ) LIKE "EINGAFS1" THEN SELECT FORM KEY codevtold% INDEX CodeVT.zeingan1
   END IF 
 END IF 
 IF FORM LIKE "EINGANGK" OR UCASE$ ( FORM ) LIKE "EINGAFS1" THEN 
   codevt% = codevt.zeingan1
   IF codevt% <> codevtold% THEN SELECT FORM NEXT 
 ELSE 
   codevt% = 0
 END IF 
 IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1(codevt%)
 FORM 
 END SUB 
 
 
 ' zeingan1 vor
 ' =======================================================================
 
SUB ZEINNext1()
 IF RECCOUNT ("zeingan1") > 0 THEN 
   IF MOD ("zeingan1") OR NEW ("zeingan1") THEN CALL FStore("zeingan1")
   cuaz% = CodeAZ.zeingan1
   codevtold% = codevt.zeingan1
   SELECT FORM NEXT 
   IF EOF ("zeingan1") THEN 
     REQUEST "Dateiende erreicht!","",2
     IF FORM LIKE "EINGANG2" OR UCASE$ ( FORM ) LIKE "EINGAFS2" THEN SELECT FORM KEY cuaz% INDEX CodeAZ.zeingan1
     IF FORM LIKE "EINGANGK" OR UCASE$ ( FORM ) LIKE "EINGAFS1" THEN SELECT FORM KEY codevtold% INDEX CodeVT.zeingan1
   END IF 
 END IF 
 IF FORM LIKE "EINGANGK" OR UCASE$ ( FORM ) LIKE "EINGAFS1" THEN 
   codevt% = codevt.zeingan1
   IF codevt% <> codevtold% THEN SELECT FORM NEXT 
 ELSE 
   codevt% = 0
 END IF 
 IF RECCOUNT ("zeingan1") > 0 THEN CALL ZEINUpdate1(codevt%)
 FORM 
 END SUB 
  
 
 ' zeingan1 lîschen
 ' =======================================================================
 ' 05.09.95  - Korrektur des Vertragspools beim Lîschen gebuchter
 '               ZahlungseingÑnge
 
SUB ZEINLoesch1()
 codevt1% = codevt.zeingan1
 IF disabled%("ZEINLoeschen") THEN END SUB 
 CALL DFile(3,"buchung1" + _fpw$)
 FILE "Buchung1"
 INDEX CodeVT.buchung1
 SELECT FIRST 
 cuaz% = CodeAZ.zeingan1
 IF gebuchtJN.zeingan1 = "J" THEN 
   CALL Fehler ("Der Zahlungseingang wurde bereits verbucht!","Er kann nur mit Passwort gelîscht werden! Denken Sie daran, da· Sie nachfolgend eine Korrekturbuchung durchfÅhren mÅssen!!!")
   REM 270897
    CREATE DIALOG "LOGIN",0,0,193,79,title$,"MS Sans Serif",8
    ADD DIALOG "LOGIN",4,0,0,193,58,0,""
    ADD DIALOG "LOGIN",9,5,11,20,22,2
    ADD DIALOG "LOGIN",5,33,11,139,9,0,"Das Lîschen ist durch "
    ADD DIALOG "LOGIN",5,33,20,68,10,0,"Passwort geschÅtzt."
    ADD DIALOG "LOGIN",5,33,31,32,12,0,"&Passwort:"
    ADD DIALOG "LOGIN",6,33,41,149,11,32,0,pw$,10
    ADD DIALOG "LOGIN",1,38,61,50,15,1,"&OK",1,1
    ADD DIALOG "LOGIN",1,89,61,50,15,0,"&Abbruch",0,0
    DIALOG "LOGIN",req%
    REMOVE DIALOG ALL 
    IF req% = 1 THEN 
      IF pw$ = "ab1958" THEN 
        REQUEST "Datensatz wirklich lîschen?","",135,req%
      ELSE 
        req% = 0
      END IF 
    END IF 
 ELSE 
   REQUEST "Datensatz wirklich lîschen?","",135,req%
 END IF 
 MOUSE OFF 
 IF req% = 1 THEN 
   SELECT FIRST FILE "zeingan1" INDEX codeaz.zeingan1
   SELECT KEY cuaz% FILE "zeingan1" INDEX CodeAZ.zeingan1
   REM -- Vertragspool anpassen --
   IF UCASE$ (gebuchtJN.zeingan1) = "J" THEN 
     SELECT FIRST FILE "zeingan1" INDEX codeaz.zeingan1
     SELECT KEY CodeVT.zeingan1 LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     pool% = (Pool.KVERTRAG - bewertung.zeingan1) * 100
     pool1$ = STR$ (pool%,"999999999999")
     poolges% = ( VAL (pool1$)) / 100
     pool.kvertrag = poolges%
     CALL QuickStore("KVERTRAG")
     REQUEST "Wollen Sie die zugehîrigen DatensÑtze aus ","der Buchungsdatei ebenfalls lîschen?",135,req1%
     IF req1% = 1 THEN 
       SET STATUS "Bitte warten, es werden die zugehîrigen Buchungen gelîscht!"
       codevt% = CodeVT.zeingan1
       REMOVE FROM FILE "Buchung1" WHERE CodeVT.Buchung1 = Codevt%
       SET STATUS ""
     END IF 
   END IF 
   SELECT FIRST FILE "zeingan1" INDEX codeaz.zeingan1
   SELECT KEY cuaz% LOCK FILE "zeingan1" INDEX CodeAZ.zeingan1
   SELECT REMOVE FILE "zeingan1"
 ELSE 
   SELECT FIRST FILE "zeingan1" INDEX codeaz.zeingan1
   SELECT FORM KEY cuaz% FILE "zeingan1" INDEX CodeAZ.zeingan1
 END IF 
 SELECT LAST FILE "zeingan1" INDEX codeaz.zeingan1
 REM SELECT KEY codevt1% FILE "zeingan1" INDEX codevt.zeingan1
 REM CALL ZEINUpdate1(codevt1%)
 FORM 
 MOUSE ON 
 END SUB 
 
 
 ' Zahlungseingang suchen
 ' =======================================================================
 ' par%=0 neue Suche, 1= letztes Suchergebnis
SUB ZEINSuch1(par%)
 cfile$ = FILE 
 FILE "kvertrag"
 INDEX lfdnr.kvertrag
 cuzein% = CodeAZ.zeingan1
 IF GCODie% AND par% = 1 THEN GOTO endw270120051
 opt&% = VAL (ReadConfig$("PROVIS","ZEINopt"))
 von$ = ReadConfig$("PROVIS","ZEINvon")
 IF von$ = "leer" THEN von$ = ""
 bis$ = ReadConfig$("PROVIS","ZEINbis")
 IF bis$ = "leer" THEN bis$ = ""
 opt1ab&% = 1
 ok% = - 1
 IF par% = 1 THEN 
   IF GsVSNR$ <> "" THEN VSNR$ = GsVSNR$
   opt&% = Gopt&%
   GOTO z101120032a
 END IF 
 a% = 0
 opt2ab&% = 0
w270120052: 
 CREATE DIALOG "ZEINSUCH",0,0,228,234,"ZahlungseingÑnge","MS Sans Serif",8
 ADD DIALOG "ZEINSUCH",4,0,0,228,169,0,""
 ADD DIALOG "ZEINSUCH",9,9,11,23,22,2
 ADD DIALOG "ZEINSUCH",5,38,10,182,22,0,"Bitte wÑhlen Sie aus, mit welcher Methode Sie den gewÅnschten Buchungssatz suchen mîchten."
 ADD DIALOG "ZEINSUCH",5,38,30,184,24,0,"Sie kînnen die zu durchsuchende Datenmenge durch die wahlfreie Angabe des Buchungsdatums einschrÑnken."
 ADD DIALOG "ZEINSUCH",5,38,54,76,10,0,"Suche Åber..."
 ADD DIALOG "ZEINSUCH",3,58,62,149,12,0,"keine EinschrÑnkung",0,opt&%
 ADD DIALOG "ZEINSUCH",3,58,73,149,12,0,"Vertrags-/Policennummer",1,opt&%
 ADD DIALOG "ZEINSUCH",3,58,84,148,12,0,"Gesellschaft",2,opt&%
 ADD DIALOG "ZEINSUCH",3,58,95,148,12,0,"Produkt",3,opt&%
 IF MNdisabled%("SEEEINGBEI") THEN 
 ELSE 
   ADD DIALOG "ZEINSUCH",3,58,106,149,12,0,"eingereicht Åber",4,opt&%
 END IF 

 ADD DIALOG "ZEINSUCH",5,38,119,96,9,0,"Buchungszeitraum (optional):"
 ADD DIALOG "ZEINSUCH",5,58,131,17,11,0,"vom"
 ADD DIALOG "ZEINSUCH",6,78,132,41,11,0,0,von$,20
 ADD DIALOG "ZEINSUCH",5,130,131,13,10,0,"bis"
 ADD DIALOG "ZEINSUCH",6,144,132,41,11,0,0,bis$,20
 ADD DIALOG "ZEINSUCH",3,58,141,149,12,0,"Buchungsdatum",1,opt1ab&%
 ADD DIALOG "ZEINSUCH",3,58,151,148,12,0,"FÑlligkeit",2,opt1ab&%

 ADD DIALOG "ZEINSUCH",4,0,165,228,45,0,""
 ADD DIALOG "ZEINSUCH",3,58,170,149,12,0,"gebuchte+nichtgebuchte  ZE",0,opt2ab&%
 ADD DIALOG "ZEINSUCH",3,58,182,148,12,0,"gebuchte ZE",1,opt2ab&%
 ADD DIALOG "ZEINSUCH",3,58,194,148,12,0,"nichtgebuchte ZE",2,opt2ab&%

 ADD DIALOG "ZEINSUCH",1,54,213,55,15,1,"&OK",1,1
 ADD DIALOG "ZEINSUCH",1,112,213,55,15,0,"&Abbrechen",0,0
 DIALOG "ZEINSUCH",req%
 REMOVE DIALOG "ZEINSUCH"
 IF req% = 1 THEN 
   
   IF von$ = "" THEN von$ = "1.1.0001"
   IF bis$ = "" THEN bis$ = "31.12.2999"
   IF DateOK%(von$) THEN 
   ELSE 
     CALL Fehler("Datum VOM ist falsch!","")
     GOTO w270120052
   END IF 
   IF DateOK%(bis$) THEN 
   ELSE 
     CALL Fehler("Datum BIS ist falsch!","")
     GOTO w270120052
   END IF 
   von% = DAYS (von$)
   bis% = DAYS (bis$)
   CALL WriteConfig("PROVIS","ZEINvon", DATE$ ( DAYS (von$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINbis", DATE$ ( DAYS (bis$),"0d.mm.yyyy"))
   CALL WriteConfig("PROVIS","ZEINopt", LTRIM$ ( STR$ (opt&%)))
   ok% = - 1
   IF opt&% = 1 THEN 
     CREATE DIALOG "DZ2",0,0,191,87,"ZahlungseingÑnge","MS Sans Serif",8
     ADD DIALOG "DZ2",4,0,0,191,63,0,""
     ADD DIALOG "DZ2",9,5,10,21,22,2
     ADD DIALOG "DZ2",5,34,9,147,20,0,"Bitte geben Sie die Vertrags-/Policennummer der gesuchten BuchungssÑtze ein:"
     ADD DIALOG "DZ2",5,34,33,87,10,0,"Vertrags-/Policennummer:"
     ADD DIALOG "DZ2",6,34,44,148,12,0,0,VSNR$,50
     ADD DIALOG "DZ2",1,36,67,55,15,1,"&OK",1,1
     ADD DIALOG "DZ2",1,94,67,55,15,0,"&Abbrechen",0,0
     DIALOG "DZ2",req2%
     REMOVE DIALOG "DZ2"
     IF req2% = 0 OR VSNR$ = "" THEN 
        ok% = 0
     ELSE 
       GsVSNR$ = vsnr$
     END IF 
   END IF 
   IF opt&% = 2 THEN 
     REM IF GCodeGE% <> 0 OR GCodeVP% <> 0 OR LTRIM$ (GsVSNR$) <> "" THEN 
     GCodeGE% = GetCodeGE%(0)
     IF GCodeGE% = 0 THEN ok% = 0
   END IF 
   IF opt&% = 3 THEN 
     GCodeVP% = GetVprodukt%(0,0, - 1)
     IF GCodeVP% = 0 THEN ok% = 0
   END IF 
   IF opt&% = 4 THEN 
     eingueber% = 0
     eingueber% = GetCodeGEE%(0)
     IF eingueber% = 0 THEN ok% = 0
   END IF 
   REM SearchInitZE1(datsu$)
   GCODieRuf% = - 1
z101120032a: 
   IF ok% THEN 
     IF GCODie% THEN CALL SearchInitZE1("zeingan1")
     REM -- Suche durchfÅhren
     cfile$ = FILE 
     DIM Auswahl$(1)
     IF RECCOUNT ("zeingan1") > 30000 THEN 
       DIM Buchungen$(30000)
     ELSE 
       DIM Buchungen$( RECCOUNT ("zeingan1"))
     END IF 
     FILE "zeingan1"
     MOUSE OFF 
     vs% = RECCOUNT ("zeingan1")


     REM ***********************************************************Anfang Suche ohne EinschrÑnkung*********************************************

     IF opt&% = 0 THEN 
       suchanzahl% = 0
       IF opt1ab&% = 1 THEN 
         INDEX BuchungsDatum.zeingan1
         KVIndexName$ = "BuchungsDatum.zeingan1"
       ELSE 
         INDEX FÑlligkeit.zeingan1
         KVIndexName$ = "FÑlligkeit.zeingan1"
       END IF 
       KVIndex$ = INDEX + ".zeingan1"
zsuch270120051: 
       FILE "zeingan1"
       INDEX KVIndex$$
       SELECT FIRST 
       REM sVSNR$ = VSNRPack$(VSNR$)
       SELECT KEY von% FILE "zeingan1" INDEX KVIndex$$
       a% = 0
       iii% = 0
       jjj% = RECCOUNT ("zeingan1")
       WHILE KVIndexName$$ >= von% AND KVIndexName$$ <= bis% AND NOT EOF ("zeingan1")
         iii% = iii% + 1
         IF opt1ab&% = 1 THEN 
           IF BuchungsDatum.zeingan1 >= von% AND BuchungsDatum.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           SET STATUS STR$ (iii%,",99999999") + "/" + STR$ (jjj%,",99999999") + "/" + STR$ (a%,",999999") + " gefunden"
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX KVIndexName$$
           END IF 
         ELSE 
           IF FÑlligkeit.zeingan1 >= von% AND FÑlligkeit.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           SET STATUS STR$ (iii%,",99999999") + "/" + STR$ (jjj%,",99999999") + "/" + STR$ (a%,",999999") + " gefunden"
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX KVIndexName$$
           END IF 
         END IF 
       WEND 
       IF a% = 0 AND suchanzahl% = 0 THEN 
         CALL Fehler("Es wurden keine ZahlungseingÑnge gefunden, die den Bedingungen " + KVIndexName$ + " >= " + von$ + " und " + KVIndexName$ + " <= " + bis$ + " entsprachen!","")
       END IF 
     END IF 


     REM************************************************************
     IF opt&% = 1 THEN 
       suchanzahl% = 0
       IF VAL ( LEFT$ (VSNR$,1)) > 0 THEN 
         INDEX QNumVSNR.zeingan1
         KVIndexName$ = "QNumVSNR.zeingan1"
         sVSNR$ = VSNRPackNum$(VSNR$)
       ELSE 
         INDEX QuickVSNR.zeingan1
         KVIndexName$ = "QuickVSNR.zeingan1"
         sVSNR$ = VSNRPack$(VSNR$)
       END IF 
       KVIndex$ = INDEX + ".zeingan1"
zsuch031120021: 
       FILE "zeingan1"
       INDEX KVIndex$$
       SELECT FIRST 
       REM sVSNR$ = VSNRPack$(VSNR$)
       SELECT KEY sVSNR$ FILE "zeingan1" INDEX KVIndex$$
       a% = 0
       
       WHILE KVIndexName$$ LIKE sVSNR$ + "*" AND NOT EOF ("zeingan1")
         IF opt1ab&% = 1 THEN 
           IF BuchungsDatum.zeingan1 >= von% AND BuchungsDatum.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX KVIndexName$$
           END IF 
         ELSE 
           IF FÑlligkeit.zeingan1 >= von% AND FÑlligkeit.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX KVIndexName$$
           END IF 
         END IF 
       WEND 
       IF a% = 0 AND suchanzahl% = 0 THEN 
         suchanzahl% = 1
         IF KVIndex$ LIKE "QNumVSNR.zeingan1" THEN 
           KVIndexName$ = "QuickVSNR.zeingan1"
           sVSNR$ = VSNRPack$(VSNR$)
         ELSE 
           KVIndexName$ = "QNumVSNR.zeingan1"
           sVSNR$ = VSNRPackNum$(VSNR$)
         END IF 
         KVIndex$ = KVIndexName$
         GOTO zsuch031120021
       END IF 
     END IF 

     REM Suche Gesellschaft
     IF opt&% = 2 THEN 
       FILE "zeingan1"
       INDEX CodeGE.zeingan1
       SELECT FIRST FILE "zeingan1" INDEX CodeGE.zeingan1
       SELECT KEY GCodeGE% FILE "zeingan1" INDEX CodeGE.zeingan1
       a% = 0
       WHILE CodeGE.zeingan1 = GCodeGE% AND NOT EOF ("zeingan1")
         IF opt1ab&% = 1 THEN 
           IF BuchungsDatum.zeingan1 >= von% AND BuchungsDatum.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX CodeGE.zeingan1
          END IF 
        ELSE 
           IF FÑlligkeit.zeingan1 >= von% AND FÑlligkeit.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX CodeGE.zeingan1
          END IF 
        END IF 
       WEND 
     END IF 
     IF opt&% = 3 THEN 
       INDEX CodeGE.zeingan1
       SELECT FIRST FILE "zeingan1" INDEX CodeGE.zeingan1
       SELECT FIRST FILE "vprodukt" INDEX CodeVP.vprodukt
       SELECT KEY GCodeVP% FILE "vprodukt" INDEX CodeVP.vprodukt
       codege% = codege.vprodukt
       codeva% = codeva.vprodukt
       SELECT KEY codege% FILE "zeingan1" INDEX CodeGE.zeingan1
       a% = 0
       WHILE CodeGE.zeingan1 = codege% AND NOT EOF ("zeingan1")
         IF opt1ab&% = 1 THEN 
          SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
          SELECT KEY codevt.zeingan1 FILE "kvertrag" INDEX lfdnr.kvertrag
          IF codeva.kvertrag = codeva% THEN 
            IF BuchungsDatum.zeingan1 >= von% AND BuchungsDatum.zeingan1 <= bis% THEN 
               x$ = gebuchtJN.zeingan1
               REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
               yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
               IF opt2ab&% < 1 THEN 
                 Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                 a% = a% + 1
                 IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
               ELSE 
                 IF opt2ab&% = 1 THEN 
                   IF gebuchtJN.zeingan1 LIKE "J" THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                     a% = a% + 1
                     IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                   END IF 
                 END IF 
                 IF opt2ab&% = 2 THEN 
                   IF gebuchtJN.zeingan1 <> "J" THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                     a% = a% + 1
                     IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                   END IF 
                 END IF 
               END IF 
             END IF 
             IF a% > 29998 THEN 
               CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
               SELECT LAST FILE "zeingan1"
             ELSE 
               SELECT NEXT FILE "zeingan1" INDEX CodeGE.zeingan1
            END IF 
          ELSE 
            SELECT NEXT FILE "zeingan1" INDEX CodeGE.zeingan1
          END IF 
         ELSE 
           SELECT FIRST FILE "kvertrag" INDEX lfdnr.kvertrag
           SELECT KEY codevt.zeingan1 FILE "kvertrag" INDEX lfdnr.kvertrag
           IF codeva.kvertrag = codeva% THEN 
             IF FÑlligkeit.zeingan1 >= von% AND FÑlligkeit.zeingan1 <= bis% THEN 
               x$ = gebuchtJN.zeingan1
               REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
               yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
               IF opt2ab&% < 1 THEN 
                 Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                 a% = a% + 1
                 IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                 SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
               ELSE 
                 IF opt2ab&% = 1 THEN 
                   IF gebuchtJN.zeingan1 LIKE "J" THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                     a% = a% + 1
                     IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                   END IF 
                 END IF 
                 IF opt2ab&% = 2 THEN 
                   IF gebuchtJN.zeingan1 <> "J" THEN 
                     Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                     a% = a% + 1
                     IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                     SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                   END IF 
                 END IF 
               END IF 
             END IF 
             IF a% > 29998 THEN 
               CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
               SELECT LAST FILE "zeingan1"
             ELSE 
               SELECT NEXT FILE "zeingan1" INDEX CodeGE.zeingan1
             END IF 
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX CodeGE.zeingan1
           END IF 
         END IF 
       WEND 
     END IF 
     REM Suche eingereicht Åber
     IF opt&% = 4 THEN 
       FILE "zeingan1"
       INDEX CodeEingGE.zeingan1
       SELECT FIRST FILE "zeingan1" INDEX CodeEingGE.zeingan1
       SELECT KEY eingueber% FILE "zeingan1" INDEX CodeEingGE.zeingan1
       a% = 0
       WHILE CodeEingGE.zeingan1 = eingueber% AND NOT EOF ("zeingan1")
         IF opt1ab&% = 1 THEN 
           IF BuchungsDatum.zeingan1 >= von% AND BuchungsDatum.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX CodeEingGE.zeingan1
          END IF 
        ELSE 
           IF FÑlligkeit.zeingan1 >= von% AND FÑlligkeit.zeingan1 <= bis% THEN 
             x$ = gebuchtJN.zeingan1
             REM yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")),15)
             yy$ = PAD$ ( LTRIM$ ( STR$ (bewertung.zeingan1,",99999999.00")) + "/" + LTRIM$ ( STR$ (BetragBrut.zeingan1,",99999999.00")),19)
             IF opt2ab&% < 1 THEN 
               Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (FÑlligkeit.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "  " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
               a% = a% + 1
               IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
               SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
             ELSE 
               IF opt2ab&% = 1 THEN 
                 IF gebuchtJN.zeingan1 LIKE "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
               IF opt2ab&% = 2 THEN 
                 IF gebuchtJN.zeingan1 <> "J" THEN 
                   Buchungen$(a%) = PAD$ (VS_Nr.zeingan1,30) + CHR$ (9) + PAD$ ( DATE$ (BuchungsDatum.zeingan1,"0d.mm.yyyy"),10) + CHR$ (9) + SPACE$ (5) + yy$ + "    " + x$ + SPACE$ (40) + STR$ (CodeAZ.zeingan1,"000000")
                   a% = a% + 1
                   IF GCODie% THEN CALL SearchVorbZE1("ZEINGAN1")
                   SET STATUS "DatensÑtze gefunden: " + STR$ (a%,",99999999") + " von " + STR$ (vs%,",9999999")
                 END IF 
               END IF 
             END IF 
           END IF 
           IF a% > 29998 THEN 
             CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
             SELECT LAST FILE "zeingan1"
           ELSE 
             SELECT NEXT FILE "zeingan1" INDEX CodeEingGE.zeingan1
          END IF 
        END IF 
       WEND 
     END IF 
     REM Ende Suche eingereicht Åber
     IF a% <> 0 THEN 
endw270120051: 
       IF GCODie% THEN 
         c$ = "aa"
         REM CALL Fehler("","")
         IF par% = 0 THEN req3% = CALL ("_SearchShow",c$)
         IF par% = 1 THEN req3% = CALL ("_SearchReShow",c$)
         IF VAL (c$) > 0 THEN 
           cuzein% = VAL (c$)
         END IF 
       ELSE 
         REM -- Prompt ermitteln
         prompt$ = Buchungen$(0)
         FOR b% = 1 TO a% - 1
           IF Buchungen$(b%) < prompt$ THEN prompt$ = Buchungen$(b%)
         NEXT b%
         IF opt&% = 1 THEN 
           caption$ = "Suche Åber Vertrags-/Policennummer..."
         ELSE 
           caption$ = "Suche Åber Gesellschaft..."
         END IF 
         MOUSE ON 
         CREATE DIALOG "DZ3",0,0,400,300,caption$,"MS Sans Serif",8
         ADD DIALOG "DZ3",4,0,0,399,35,0,""
         ADD DIALOG "DZ3",5,36,11,179,9,0,"Bitte wÑhlen Sie den gesuchten Zahlungseingang aus:"
         ADD DIALOG "DZ3",9,8,12,21,23,2
         ADD DIALOG "DZ3",5,36,27,270,9,0,"Vertragsnummer                       Datum               Bewertung Net/Brut   gebucht?"
         ADD DIALOG "DZ3",7,36,40,340,240,130,2,Buchungen$,Auswahl$,prompt$
         ADD DIALOG "DZ3",1,88,280,55,15,1,"&OK",1,1
         ADD DIALOG "DZ3",1,146,280,55,15,0,"&Abbrechen",0,0
         DIALOG "DZ3",req3%
         REMOVE DIALOG "DZ3"
         IF req3% = 1 THEN 
           cuzein% = VAL ( RIGHT$ (Auswahl$(0),6))
         END IF 
       END IF 
     ELSE 
       CALL Fehler("Es konnten keine entsprechenden ZahlungseingÑnge gefunden werden!","")
     END IF 
     FILE cfile$
   END IF 
 END IF 
 
 IF cuzein% > 0 THEN 
   SELECT FIRST FILE "zeingan1" INDEX CodeAZ.zeingan1
   SELECT FORM KEY cuzein% FILE "zeingan1" INDEX CodeAZ.zeingan1
   SELECT KEY codevt.zeingan1 FILE "kvertrag" INDEX lfdnr.kvertrag
   CALL ZEINUpdate1(codevt.zeingan1)
   SELECT FIRST FILE "zeingan1" INDEX CodeAZ.zeingan1
   SELECT FORM KEY cuzein% FILE "zeingan1" INDEX CodeAZ.zeingan1
 ELSE 
   CALL ZEINUpdate1(codevt.zeingan1)
 END IF 
 Gopt&% = opt&%
 FORM 
 MOUSE ON 
 END SUB 
  
SUB ZEINTest2()
 IF kondart% = 0 THEN 
   REM AP.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "AP: " + VS_Nr.zeingan1
   ELSE 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "AP"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 1 THEN 
   REM CP.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Courtage: " + VS_Nr.zeingan1
   ELSE 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Courtage"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 2 THEN 
   REM Pf.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Pflege: " + VS_Nr.zeingan1
   ELSE 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Pflege"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 3 THEN 
   REM Ersatz.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Ersatz: " + VS_Nr.zeingan1
   ELSE 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Ersatz"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 4 THEN 
   REM Dynamisierung
   IF GAFSK$ <> "TRUE" THEN 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Dynamisierung: " + VS_Nr.zeingan1
   ELSE 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Dynamisierung"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 5 THEN 
   REM Betreuung
   IF GAFSK$ <> "TRUE" THEN 
     IF FirmaEinhTab.stamm = "j" THEN 
       IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Folge: " + VS_Nr.zeingan1
     ELSE 
       IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Betreuung: " + VS_Nr.zeingan1
     END IF 
   ELSE 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Betreuung"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF StornoJN.zeingan1 = "J" THEN 
   IF GAFSK$ <> "TRUE" THEN 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Stornierung: " + VS_Nr.zeingan1
   ELSE 
     IF Buchungstext.zeingan1 = "" THEN Buchungstext.zeingan1 = "Stornierung"
   END IF 
   kondart.zeingan1 = 9
 END IF 
 
 
 END SUB 
 
SUB ZEINTest3()
 IF kondart% = 0 THEN 
   REM AP.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     Buchungstext.zeingan1 = "AP: " + VS_Nr.zeingan1
   ELSE 
     Buchungstext.zeingan1 = "AP"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 1 THEN 
   REM CP.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     Buchungstext.zeingan1 = "Courtage: " + VS_Nr.zeingan1
   ELSE 
     Buchungstext.zeingan1 = "Courtage"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 2 THEN 
   REM Pf.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     Buchungstext.zeingan1 = "Pflege: " + VS_Nr.zeingan1
   ELSE 
     Buchungstext.zeingan1 = "Pflege"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 3 THEN 
   REM Ersatz.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     Buchungstext.zeingan1 = "Ersatz: " + VS_Nr.zeingan1
   ELSE 
     Buchungstext.zeingan1 = "Ersatz"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 4 THEN 
   REM Dynamik.zeingan1 = "j"
   IF GAFSK$ <> "TRUE" THEN 
     Buchungstext.zeingan1 = "Dynamik: " + VS_Nr.zeingan1
   ELSE 
     Buchungstext.zeingan1 = "Dynamik"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 
 IF kondart% = 5 THEN 
   REM Betreuung
   IF GAFSK$ <> "TRUE" THEN 
     Buchungstext.zeingan1 = "Betreuung: " + VS_Nr.zeingan1
   ELSE 
     Buchungstext.zeingan1 = "Betreuung"
   END IF 
   kondart.zeingan1 = kondart%
 END IF 

 IF StornoJN.zeingan1 = "J" THEN 
   IF GAFSK$ <> "TRUE" THEN 
     Buchungstext.zeingan1 = "Stornierung: " + VS_Nr.zeingan1
   ELSE 
     Buchungstext.zeingan1 = "Stornierung"
   END IF 
   kondart.zeingan1 = 9
 END IF 
 
 
 END SUB 
 
 
 
 
SUB ZEINList2()
 FILE "zeingan1"
 opt% = 1
 GOTO azeli1211962
azeli1211961: 
   CALL Fehler("Ein Datum ist nicht richtig eingegeben worden!","Geben Sie das Datum in der Form dd.mm.jjjj ein!")
azeli1211962: 
 ON ERROR GOTO ErrorHandler
 CREATE DIALOG "UEBERNAHME",0,0,250,132,"öbersicht","MS Sans Serif",8
 ADD DIALOG "UEBERNAHME",4,0,0,250,111,0,""
 ADD DIALOG "UEBERNAHME",9,6,14,22,22,2
 ADD DIALOG "UEBERNAHME",5,37,14,141,10,0,"Bitte wÑhlen Sie die öbersicht aus"
 ADD DIALOG "UEBERNAHME",3,37,27,193,11,0,"Liste der nicht gebuchten EingÑnge",4,opt%
 ADD DIALOG "UEBERNAHME",3,37,57,137,9,0,"sortiert nach Policenummer",1,opt%
 ADD DIALOG "UEBERNAHME",3,37,68,137,11,0,"sortiert nach Eingangsdatum",2,opt%
 ADD DIALOG "UEBERNAHME",3,37,81,193,11,0,"sortiert nach Eingangsdatum mit Datumseingrenzung",3,opt%
 ADD DIALOG "UEBERNAHME",6,119,94,41,12,0,0,von$,10
 ADD DIALOG "UEBERNAHME",6,180,94,41,12,0,0,bis$,10
 ADD DIALOG "UEBERNAHME",5,46,94,70,10,0,"Eingangsdatum von:"
 ADD DIALOG "UEBERNAHME",5,162,95,17,10,0,"&bis:"
 ADD DIALOG "UEBERNAHME",1,59,114,55,15,1,"&OK",1,1
 ADD DIALOG "UEBERNAHME",1,117,114,55,15,0,"&Abbrechen",0,0
 DIALOG "UEBERNAHME",reqa%
 REMOVE DIALOG ALL 
 IF reqa% = 1 AND opt% = 4 THEN 
   CALL ZLIREP()
   reqa% = 0
 END IF 
 IF reqa% = 1 AND opt% <> 4 THEN 
   MOUSE OFF 
   
     ON ERROR GOTO azeli1211961
     IF von$ <> "" THEN 
       von1% = DAYS (von$)
     ELSE 
       von1% = DAYS ("01.01.1980")
     END IF 
     IF bis$ <> "" THEN 
       bis1% = DAYS (bis$)
     ELSE 
       bis1% = DAYS ("30.12.2199")
     END IF 
     ON ERROR GOTO ErrorHandler
   
   IF opt% = 1 THEN 
     INDEX VS_NR.zeingan1
   ELSE 
     INDEX BuchungsDatum.zeingan1
   END IF 
   SELECT FIRST 
   IF RECCOUNT ("zeingan1") > 10000 THEN 
     REDIM AdrFound$(30000)
   ELSE 
     REDIM AdrFound$( RECCOUNT ("zeingan1"))
   END IF 
   IF opt% < 3 THEN 
     WHILE NOT EOF ("zeingan1")
      IF BuchungsDatum.zeingan1 >= von1% AND BuchungsDatum.zeingan1 <= bis1% THEN 
       SELECT KEY CodeVT.zeingan1 FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
       SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
       SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
       SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
       SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
       lGes$ = TRIM$ (Gesellschaft.GEADR)
       lAgentur$ = TRIM$ (Nachname.MAADR) + ", " + TRIM$ (Vorname.MAADR) + ", " + Agenturnr.maadr
       lSp$ = TRIM$ (Sparte.SPARTEN)
       lK$ = TRIM$ (Nachname.GAdrDat$) + ", " + TRIM$ (Vorname.GAdrDat$)
       l% = LEN (VS_NR)
       IF opt% = 1 THEN 
       
         REM nach Policenr. sortiert 070897
         ab% = 30 - l%
         aaa$ = DATE$ (Buchungsdatum,"0d.mm.yyyy")
         bbb$ = DATE$ (FÑlligkeit,"0d.mm.yyyy")
         ccc$ = aaa$ + "/" + bbb$
 AdrFound$(a%) = VS_NR + SPACE$ (ab%) + "/" + ccc$ + "*" + STR$ (bewertung,"99999999999.00") + "*" + lk$ + "  " + lGes$ + "  " + lsp$ + "   " + lagentur$ + SPACE$ (80) + STR$ (codeaz.zeingan1,"000000")
       
       ELSE 
       
         REM nach Datum sortiert
         aaa$ = DATE$ (Buchungsdatum,"0d.mm.yyyy")
         bbb$ = DATE$ (FÑlligkeit,"0d.mm.yyyy")
         ccc$ = aaa$ + "/" + bbb$
 AdrFound$(a%) = ccc$ + "/" + VS_NR + "*" + STR$ (Bewertung.zeingan1,"99999999999.00") + "*" + lk$ + "  " + lGes$ + "  " + lsp$ + "   " + lagentur$ + SPACE$ (80) + STR$ (codeaz.zeingan1,"000000")
       
       END IF 
       a% = a% + 1
       SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
      END IF 
     IF a% > 29998 THEN 
       CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
       SELECT LAST FILE "zeingan1"
     ELSE 
       SELECT NEXT FILE "zeingan1"
     END IF 
     WEND 
   ELSE 
     SELECT KEY von1% FILE "zeingan1" INDEX BuchungsDatum.zeingan1
     IF von1% <> bis1% THEN WHILE NOT EOF ("zeingan1") AND BuchungsDatum.zeingan1 >= von1% AND BuchungsDatum.zeingan1 <= bis1%
     IF von1% = bis1% THEN WHILE NOT EOF ("zeingan1") AND BuchungsDatum.zeingan1 = von1%
         SELECT KEY CodeVT.zeingan1 FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
         SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
         SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
         SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
         SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
         lGes$ = TRIM$ (Gesellschaft.GEADR)
         lAgentur$ = TRIM$ (Nachname.MAADR) + ", " + TRIM$ (Vorname.MAADR) + ", " + Agenturnr.maadr
         lSp$ = TRIM$ (Sparte.SPARTEN)
         lK$ = TRIM$ (Nachname.GAdrDat$) + ", " + TRIM$ (Vorname.GAdrDat$)
         l% = LEN (VS_NR)
         aaa$ = DATE$ (Buchungsdatum,"0d.mm.yyyy")
         bbb$ = DATE$ (FÑlligkeit,"0d.mm.yyyy")
         ccc$ = aaa$ + "/" + bbb$
 AdrFound$(a%) = ccc$ + "/" + VS_NR + "*" + STR$ (Bewertung.zeingan1,"99999999999.00") + "*" + lk$ + "  " + lGes$ + "  " + lsp$ + "   " + lagentur$ + SPACE$ (80) + STR$ (codeaz.zeingan1,"000000")
         a% = a% + 1
         SET STATUS "DatensÑtze gefunden: " + STR$ (a%,"9999999")
       IF a% > 29998 THEN 
         CALL Fehler ("Die Zahlungseingangsdatei enthÑlt mehr als 30000 DatensÑtze, es kînnen aber nur maximal 30000 DatesÑtze angezeigt werden!","Bitte grenzen Sie die Auswahl Åber das Datum ein!")
         SELECT LAST FILE "zeingan1"
       ELSE 
         SELECT NEXT FILE "zeingan1"
       END IF 
       WEND 
   END IF 
   AdrFound$(a%) = ""
   LAuswahl$ = AdrFound$(0)
   LAuswahl1$(0) = LAuswahl$
   SET STATUS ""
   CREATE DIALOG "ADRSTICHW",0,0,454,262,"ZahlungseingÑnge","MS Sans Serif",8
   ADD DIALOG "ADRSTICHW",7,2,6,449,234,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
   ADD DIALOG "ADRSTICHW",1,152,243,55,16,1,"&OK",1,1
   ADD DIALOG "ADRSTICHW",1,212,243,55,16,0,"&Abbrechen",0,0
   DIALOG "ADRSTICHW",req5%
   MOUSE ON 
   REMOVE DIALOG "ADRSTICHW"
   IF req5% = 1 THEN 
     LAuswahl$ = LAuswahl1$(0)
     scodema% = VAL ( RIGHT$ (LAuswahl$,6))
     SELECT FIRST 
     SELECT FORM KEY scodema% FILE "zeingan1" INDEX codeaz.zeingan1
     SELECT KEY CodeVT.zeingan1 FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     SELECT KEY CodeMA.KVERTRAG FILE "MAADR" INDEX CodeMA.MAADR
     SELECT KEY CodeGE.KVERTRAG FILE "GEADR" INDEX CodeGE.GEADR
     SELECT KEY CodeVA.KVERTRAG FILE "SPARTEN" INDEX CodeVA.SPARTEN
     SELECT KEY CodeKU.KVERTRAG FILE GAdrDat$ INDEX CodeKU.GAdrDat$
     lGesellschaft$ = TRIM$ (Gesellschaft.GEADR)
     lAgentur$ = TRIM$ (Nachname.MAADR) + ", " + TRIM$ (Vorname.MAADR) + ", " + Agenturnr.maadr
     lSparte$ = TRIM$ (Sparte.SPARTEN)
     lKunde$ = TRIM$ (Nachname.GAdrDat$) + ", " + TRIM$ (Vorname.GAdrDat$)
     eingbei$ = EingereichtBei.kvertrag
     IF eingbei$ = "" THEN 
       eingbei$ = "eingereicht Åber"
     END IF 
     IF MNdisabled%("SEEEINGBEI") THEN 
       eingbei$ = "wurde ausgeblendet"
     END IF 
   END IF 
 END IF 
 FORM 
 END SUB 
 
 
 '      *****************************************
 '      ** Routinen fÅr Programmteil "BUCHUNG" **
 '      *****************************************
 
SUB BUCHUNGZE()
 GVertrID% = 0
 CALL DFile(3,"AUMSKTO" + _fpw$)
 CALL DFile(3,"VPGEKOND" + _fpw$)
 GAppName$ = _netpath$ + "DOC\buchung.pdf"
 IF disabled%("BUCHUNG") THEN END SUB 
 IF title$ LIKE "*Agentur*" THEN 
   CALL Fehler("Diese Funktion kann in der Agenturvariante nicht genutzt werden!","")
   END SUB 
 END IF 
 SET STATUS "Buchungen/Provisionierung"
 opt% = 1
 IF MAKLER$ = "TRUE" THEN 
   CALL DFile(3,"STAMM" + _fpw$)
   CALL DFile(3,"INKSTAMM" + _fpw$)
   CALL DFile(3,"KUKTO" + _fpw$)
   FILE "INKSTAMM"
   INDEX InkDatum.inkstamm
   SELECT LAST 
   datlastink$ = DATE$ (inkDatum,"0d.mm.yyyy")
   IF LTRIM$ (datlastink$) = "" THEN datlastink$ = "keine Angaben"
 END IF 
 IF GAFSK$ LIKE "TRUE" THEN 
   CREATE DIALOG "BUCHUNG",0,0,289,248,"Buchungsdatei/Provisionsrechnung","MS Sans Serif",8
   ADD DIALOG "BUCHUNG",9,8,8,22,22,2
   ADD DIALOG "BUCHUNG",5,35,9,124,10,0,"Bitte wÑhlen Sie die Funktion, die Sie"
   ADD DIALOG "BUCHUNG",5,35,19,73,9,0,"durchfÅhren mîchten:"
   ADD DIALOG "BUCHUNG",4,35,29,168,82,0,""
   ADD DIALOG "BUCHUNG",5,39,39,70,9,0,"Buchungsfunktionen:"
   
   
   ADD DIALOG "BUCHUNG",3,39,49,153,10,0,"monatliche Provisionsbuchung",1,opt%
   ADD DIALOG "BUCHUNG",3,39,63,153,10,0,"Abrechnung FixvergÅtung Maklerbetreuer",102,opt%
   ADD DIALOG "BUCHUNG",3,39,73,153,10,0,"Liste FixvergÅtung",105,opt%
 
   REM ADD DIALOG "BUCHUNG",3,39,79,153,10,0,"Korrektur Provisionsrechnung",2,opt%
   ADD DIALOG "BUCHUNG",3,39,89,153,10,0,"Erfassung von zusÑtzlichen Buchungen",5,opt%
   ADD DIALOG "BUCHUNG",3,39,99,155,10,0,"Nachbearbeitung von BuchungssÑtzen",9,opt%
 
   ADD DIALOG "BUCHUNG",4,35,109,168,132,0,""
   ADD DIALOG "BUCHUNG",5,39,119,67,10,0,"Listen/öbersichten:"
   ADD DIALOG "BUCHUNG",3,39,129,153,10,0,"Ausgabe der Provisionsliste",6,opt%
   ADD DIALOG "BUCHUNG",3,39,139,153,10,0,"Provisionsliste fÅr eine einzelne Agentur",3,opt%
   ADD DIALOG "BUCHUNG",3,39,149,153,10,0,"Sutor+PSP-Vertragsliste fÅr Agenturen",100,opt%
   ADD DIALOG "BUCHUNG",3,39,163,153,10,0,"Abrechnung Sutor-Pauschale",103,opt%
   ADD DIALOG "BUCHUNG",3,39,173,153,10,0,"Liste Sutor-Pauschale",104,opt%
   ADD DIALOG "BUCHUNG",3,39,196,153,10,0,"Statistik neu hochrechnen",200,opt%
   IF GUeberweislist$ LIKE "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,216,153,10,0,"ProvisionsÅberweisungsliste",206,opt%

   ADD DIALOG "BUCHUNG",1,208,55,75,16,0,"&Kopf-/Fu·zeile",2,0
   ADD DIALOG "BUCHUNG",1,208,75,74,15,0,"&Fehlerprotokoll",3,0
   ADD DIALOG "BUCHUNG",1,208,125,75,16,1,"&OK",1,1
   ADD DIALOG "BUCHUNG",1,208,145,74,15,0,"&Abbrechen",0,0
   DIALOG "BUCHUNG",req%
   REMOVE DIALOG "BUCHUNG"
 ELSE 
   CREATE DIALOG "BUCHUNG",0,0,289,269,"Buchungsdatei/Provisionsrechnung","MS Sans Serif",8
   ADD DIALOG "BUCHUNG",9,8,8,22,22,2
   ADD DIALOG "BUCHUNG",5,35,9,124,10,0,"Bitte wÑhlen Sie die Funktion, die Sie"
   ADD DIALOG "BUCHUNG",5,35,19,73,9,0,"durchfÅhren mîchten:"
   ADD DIALOG "BUCHUNG",4,35,29,168,62,0,""
   ADD DIALOG "BUCHUNG",5,39,39,70,9,0,"Buchungsfunktionen:"
   ADD DIALOG "BUCHUNG",4,35,89,168,178,0,""
   ADD DIALOG "BUCHUNG",5,39,99,67,10,0,"Listen/öbersichten:"
   IF GASP% THEN 
     REM ADD DIALOG "BUCHUNG",3,39,119,153,10,0,"KontenÅbersicht fÅr eine einzelne Agentur",3,opt%
     IF workstation% = 0 THEN 
       ADD DIALOG "BUCHUNG",1,208,75,74,15,0,"&Fehlerprotokoll",3,0
       ADD DIALOG "BUCHUNG",3,39,49,153,10,0,"monatliche Provisionsbuchung",1,opt%
       ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrektur Provisionsrechnung",2,opt%
       ADD DIALOG "BUCHUNG",3,39,69,153,10,0,"Erfassung von zusÑtzlichen Buchungen",5,opt%
       ADD DIALOG "BUCHUNG",3,39,79,155,10,0,"Nachbearbeitung von BuchungssÑtzen",9,opt%

       ADD DIALOG "BUCHUNG",3,39,109,153,10,0,"Ausgabe der Provisionsliste",6,opt%
       ADD DIALOG "BUCHUNG",3,39,119,153,10,0,"Provisionsliste fÅr eine einzelne Agentur",3,opt%
       ADD DIALOG "BUCHUNG",3,39,129,153,10,0,"Summenliste Eigenproduktion Agenturen",100,opt%
       ADD DIALOG "BUCHUNG",3,39,139,153,10,0,"Einheitenliste (Vertragsdatei) Agenturen",99,opt%
       
       IF MAKLER$ = "TRUE" THEN 
         ADD DIALOG "BUCHUNG",1,208,5,75,16,0,"Inkasso durchfÅhren",4,0
         ADD DIALOG "BUCHUNG",5,215,23,70,9,0,"letztes Inkasso:"
         ADD DIALOG "BUCHUNG",5,215,33,70,9,0,datlastink$
       END IF 
       IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
         REM ADD DIALOG "BUCHUNG",4,35,153,168,62,0,""
         IF GAFSK$ = "TRUE" THEN 
           REM ADD DIALOG "BUCHUNG",3,39,150,153,10,0,"Sollstellung berechnen",101,opt%
         ELSE 
           ADD DIALOG "BUCHUNG",3,39,160,153,10,0,"Sollstellung berechnen",101,opt%
         END IF 
       END IF 
       ADD DIALOG "BUCHUNG",3,39,172,153,10,0,"Statistik neu hochrechnen",200,opt%
       ADD DIALOG "BUCHUNG",3,39,184,153,10,0,"Produktionsstatistiken gesamt",204,opt%
       ADD DIALOG "BUCHUNG",3,39,196,153,10,0,"Produktionsstatistiken monatlich",205,opt%
       ADD DIALOG "BUCHUNG",3,39,208,153,10,0,"Export Provisionslisten nach MS Excel",202,opt%
     ELSE 
       opt% = 3
       ADD DIALOG "BUCHUNG",3,39,119,153,10,0,"Provisionsliste fÅr eine einzelne Agentur",3,opt%
       IF GBVF$ LIKE "TRUE" THEN 
       ELSE 
         ADD DIALOG "BUCHUNG",3,39,129,153,10,0,"Summenliste Eigenproduktion Agenturen",100,opt%
         ADD DIALOG "BUCHUNG",3,39,139,153,10,0,"Einheitenliste (Vertragsdatei) Agenturen",99,opt%
       END IF 
     END IF 
   ELSE 
     IF verwaltung.config <> - 1 AND ag$ <> "j" THEN 
       ADD DIALOG "BUCHUNG",1,208,75,74,15,0,"&Fehlerprotokoll",3,0
       ADD DIALOG "BUCHUNG",3,39,49,153,10,0,"monatliche Provisionsbuchung",1,opt%
       REM ADD DIALOG "BUCHUNG",3,39,59,153,10,0,"Korrektur Provisionsrechnung",2,opt%
       ADD DIALOG "BUCHUNG",3,39,69,153,10,0,"Erfassung von zusÑtzlichen Buchungen",5,opt%
       ADD DIALOG "BUCHUNG",3,39,79,155,10,0,"Nachbearbeitung von BuchungssÑtzen",9,opt%
       ADD DIALOG "BUCHUNG",3,39,109,153,10,0,"Ausgabe der Provisionsliste-alle Agenturen",6,opt%
       ADD DIALOG "BUCHUNG",3,39,119,153,10,0,"Provisionsliste fÅr eine einzelne Agentur",3,opt%
       ADD DIALOG "BUCHUNG",3,39,129,153,10,0,"Summenliste Eigenproduktion Agenturen",100,opt%
       ADD DIALOG "BUCHUNG",3,39,139,163,10,0,"Eigen-Einheitenliste(Vertragsdatei) Agenturen",99,opt%
     END IF 
     IF MAKLER$ = "TRUE" THEN 
       ADD DIALOG "BUCHUNG",1,208,5,75,16,0,"Inkasso durchfÅhren",4,0
       ADD DIALOG "BUCHUNG",5,215,23,70,9,0,"letztes Inkasso:"
       ADD DIALOG "BUCHUNG",5,215,33,70,9,0,datlastink$
     END IF 
     IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
       REM ADD DIALOG "BUCHUNG",4,35,153,168,68,0,""
       IF GAFSK$ = "TRUE" THEN 
       ELSE 
         ADD DIALOG "BUCHUNG",3,39,160,153,10,0,"Sollstellung berechnen",101,opt%
       END IF 
     END IF 
     ADD DIALOG "BUCHUNG",3,39,172,153,10,0,"Statistik neu hochrechnen",200,opt%
     IF gfsc% = - 1 THEN 
       ADD DIALOG "BUCHUNG",3,39,184,153,10,0,"Vorschuss hochrechnen",201,opt%
       IF GKredit% = - 1 THEN 
         ADD DIALOG "BUCHUNG",3,39,196,153,10,0,"Kredite hochrechnen",203,opt%
       END IF 
     END IF 
     IF GKredit% = - 1 THEN 
       ADD DIALOG "BUCHUNG",3,39,196,153,10,0,"Kredite hochrechnen",203,opt%
     END IF 
     ADD DIALOG "BUCHUNG",3,39,208,153,10,0,"Produktionsstatistiken gesamt",204,opt%
     ADD DIALOG "BUCHUNG",3,39,220,153,10,0,"Produktionsstatistiken monatlich",205,opt%
     ADD DIALOG "BUCHUNG",3,39,232,153,10,0,"Export Provision nach MS Excel",202,opt%
     IF GUeberweislist$ LIKE "TRUE" THEN ADD DIALOG "BUCHUNG",3,39,248,153,10,0,"ProvisionsÅberweisungsliste",206,opt%
     REM StatistMen()
   END IF 
   IF verwaltung.config <> - 1 AND ag$ <> "j" THEN 
     ADD DIALOG "BUCHUNG",1,208,55,75,16,0,"&Kopf-/Fu·zeile",2,0
     
   END IF 
   ADD DIALOG "BUCHUNG",1,208,125,75,16,1,"&OK",1,1
   ADD DIALOG "BUCHUNG",1,208,145,74,15,0,"&Abbrechen",0,0
   DIALOG "BUCHUNG",req%
   REMOVE DIALOG "BUCHUNG"
 END IF 
 IF req% = 1 THEN 
   SELECT CASE opt%
   CASE 206
     CALL CreBuMaMon()
   CASE 205
     REM Produktionsstatistiken gesamt
     CALL SUFP4mon()
   CASE 204
     REM Produktionsstatistiken gesamt
     CALL SUFP1()

   CASE 203
     REM Kredite hochrechnen
     CALL Kredit()
   CASE 202
     REM Export der Provisionsliste nach
     calcdate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
     CALL ExpProvli()
   CASE 201
     calcdate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
     IF Gfsc% <> - 1 THEN 
       CALL Vorschuss()
     ELSE 
       CALL Vorschuss1()
     END IF 
   CASE 200
     CALL StatistMen()
   CASE 1
     REM 170897
       IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
         REQUEST "Soll im Anschlu· and die Provisionsberechnung","die Statistik neu hochgerechnet werden?",130,Greqstati%
         CALL PROVBUCHUNG(0)
         IF Greqstati% = 1 THEN 
           CALL StatistRefr(0)
           CREATE DIALOG "PROT",0,0,244,154,title$,"MS Sans Serif",8
           ADD DIALOG "PROT",4,0,0,244,130,0,""
           ADD DIALOG "PROT",9,6,9,22,22,2
           ADD DIALOG "PROT",5,35,13,194,10,0,"WÑhrend der zuletzt durchgefÅhrten Aktion wurde eine"
           ADD DIALOG "PROT",5,35,23,194,10,0,"Protokolldatei erstellt, in der eventuelle Fehler und Zusatz-"
           ADD DIALOG "PROT",5,35,33,194,10,0,"information gespeichert wurden."
           ADD DIALOG "PROT",5,35,53,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Ja" + CHR$ (34) + ", wenn Sie das Protokoll einsehen und"
           ADD DIALOG "PROT",5,35,63,194,10,0,"eventuell drucken wollen."
           ADD DIALOG "PROT",5,35,83,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Nein" + CHR$ (34) + ", wenn Sie das Protokoll nicht"
           ADD DIALOG "PROT",5,35,93,194,10,0,"einsehen mîchten."
           ADD DIALOG "PROT",5,35,113,194,10,0,"Wollen Sie das Protokoll einsehen?"
           ADD DIALOG "PROT",1,118,134,55,15,0,"&Nein",0,0
           ADD DIALOG "PROT",1,62,134,55,15,1,"&Ja",1,1
           DIALOG "PROT",req%
           REMOVE DIALOG "PROT"
           IF req% = 1 THEN CALL ShowLog()
         END IF 
       ELSE 
         REQUEST "Wollen Sie wirklich die monatliche Provisionsabrechnung starten?","",130,req%
         IF req% = 1 THEN 
           REQUEST "Soll im Anschlu· an die Provisionsberechnung","die Statistik neu hochgerechnet werden?",135,Greqstati%
           CALL PROVBUZEIN()
           IF Greqstati% = 1 THEN 
             CALL StatistRefr(0)
             CALL Fehler("nicht verarbeitete ZahlungseingÑnge " + STR$ (GnoverZein%,"99999999"),"Siehe dazu Protokolldatei!")
             CREATE DIALOG "PROT",0,0,244,154,title$,"MS Sans Serif",8
             ADD DIALOG "PROT",4,0,0,244,130,0,""
             ADD DIALOG "PROT",9,6,9,22,22,2
             ADD DIALOG "PROT",5,35,13,194,10,0,"WÑhrend der zuletzt durchgefÅhrten Aktion wurde eine"
             ADD DIALOG "PROT",5,35,23,194,10,0,"Protokolldatei erstellt, in der eventuelle Fehler und Zusatz-"
             ADD DIALOG "PROT",5,35,33,194,10,0,"information gespeichert wurden."
             ADD DIALOG "PROT",5,35,53,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Ja" + CHR$ (34) + ", wenn Sie das Protokoll einsehen und"
             ADD DIALOG "PROT",5,35,63,194,10,0,"eventuell drucken wollen."
             ADD DIALOG "PROT",5,35,83,194,10,0,"WÑhlen Sie " + CHR$ (34) + "Nein" + CHR$ (34) + ", wenn Sie das Protokoll nicht"
             ADD DIALOG "PROT",5,35,93,194,10,0,"einsehen mîchten."
             ADD DIALOG "PROT",5,35,113,194,10,0,"Wollen Sie das Protokoll einsehen?"
             ADD DIALOG "PROT",1,118,134,55,15,0,"&Nein",0,0
             ADD DIALOG "PROT",1,62,134,55,15,1,"&Ja",1,1
             DIALOG "PROT",req%
             REMOVE DIALOG "PROT"
             IF req% = 1 THEN CALL ShowLog()
             
           END IF 
         END IF 
       END IF 
   CASE 2
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       REQUEST "Soll im Anschlu· and die Provisionsberechnung","die Statistik neu hochgerechnet werden?",130,Greqstati%
       CALL BUKORREKTUR()
       IF Greqstati% = 1 THEN CALL StatistRefr(0)
     ELSE 
       REQUEST "Wollen Sie wirklich die Korrekturabrechnung starten?","",130,req%
       IF req% = 1 THEN 
         REQUEST "Soll im Anschlu· and die Provisionsberechnung","die Statistik neu hochgerechnet werden?",130,Greqstati%
         CALL BUKORREKZE()
         IF Greqstati% = 1 THEN CALL StatistRefr(0)
       END IF 
     END IF 
   CASE 3
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL UEBERSAG1()
     ELSE 
       CALL UEBERSAG1Z()
     END IF 
   CASE 4
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL UEBERSAG2()
     ELSE 
       CALL UEBERSAG2Z()
     END IF 
   CASE 5
 
     CALL ZUSATZBUZE()
   CASE 6
     IF PrvVerfahr$ <> "ZAHLUNGSEINGANG" THEN 
       CALL PROVILIST()
     ELSE 
       IF GASP% THEN 
         IF workstation% = 0 THEN 
           CALL PROVILISTZ()
         ELSE 
           CALL Fehler("Die Gesamtprovisionsliste kann nur von der Zentrale aus gedruckt werden!","")
         END IF 
       ELSE 
         CALL PROVILISTZ()
       END IF 
     END IF 
   CASE 7
     CALL DRCONFIG()
   CASE 8
     CALL ShowLog()
   CASE 9
     REM IF GAgentDetail$ LIKE "TRUE" THEN 
      REM CALL Fehler("Diese Funktion ist in der Programmversion, die das Drucken von KontostÑnden erlaubt, nicht gestattet!","Zum Wiederuf einer von Hand getÑtigten Zusatzbuchung erfassen Sie bitte eine Buchung mit umgekehrten Vorzeichen.")
     REM ELSE 
       CALL ZBUCHUNGZE()
     REM END IF 
   CASE 99
     REM Einheitenliste nach Vertrag
     CALL SummEinhAgent()
   CASE 100
     REM Summenliste alle Agenturen
     IF GAFSK$ LIKE "TRUE" THEN 
       REM Sutor-Vertragsliste fÅr Agenturen
       REQUEST "Wollen Sie die Sutor-PSP-Vertragsliste drucken?","",130,req%
       IF req% = 1 THEN 
         CALL DFile(3,"FOERKOND" + _fpw$)
         CALL DFile(3,"AFSKSUT" + _fpw$)
         CALL DFile(3,"AFSPSP" + _fpw$)
         REM CALL DFile(3,"AFSKL1" + _fpw$)
         CALL DFile(3,"sparten" + _fpw$)
         CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
         CALL DFile(3,"maadr" + _fpw$)
         CALL DFile(3,"maadrgru" + _fpw$)
         CALL DFile(3,"kvertrag" + _fpw$)
         CALL DFile(3,"vpspezko" + _fpw$)
         CALL DFile(3,"spezkond" + _fpw$)
         CALL DFile(3,"vprodukt" + _fpw$)
         CALL DFile(3,"maadrag" + _fpw$)
         CALL DFile(3,"kvfael" + _fpw$)
         IF GAFSK$ LIKE "TRUE" THEN 
           CALL DFile(3,"kvpsp" + _fpw$)
         END IF 
         CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
         opt% = 1
         CREATE DIALOG "ADRLIST",0,0,150,100,"WÑhlen Sie den Ausdruck","MS Sans Serif",8
         ADD DIALOG "ADRLIST",4,0,0,150,80,0,""
         ADD DIALOG "ADRLIST",9,4,5,15,21,2
         ADD DIALOG "ADRLIST",5,30,10,238,14,0,"WÑhlen Sie eine Option aus!"
         ADD DIALOG "ADRLIST",3,10,44,236,10,0,"Sutor-PSP-VertrÑge eines Mitarbeiters",1,opt%
         ADD DIALOG "ADRLIST",3,10,55,234,10,0,"Sutor-PSP-VertrÑge aller Mitarbeiter",2,opt%
         ADD DIALOG "ADRLIST",1,27,83,45,14,1,"&Weiter",1,1
         ADD DIALOG "ADRLIST",1,72,83,45,14,0,"&Abbruch",0,0
         DIALOG "ADRLIST",req1%
         REMOVE DIALOG "ADRLIST"
         IF req1% <> 0 THEN 
           Wks1% = 0
           _cuma% = 0
           IF opt% = 1 THEN 
             ma% = GetCodeMA%(_cuma%,Wks1%)
           ELSE 
             ma% = 0
           END IF 
           CALL SutorVli1(ma%)
         END IF 
       ELSE 
         REQUEST "Ausdruck wurde durch Benutzer abgebrochen!","",2
       END IF 
     ELSE 
       CALL SummAlleAgent()
     END IF 
   CASE 101
     REM Sollstellung berechnen
     IF GSoll$ LIKE "j" THEN 
       REQUEST "Wollen Sie wirklich die Sollstellung berechnen?","",130,req%
       IF req% = 1 THEN 
         CALL DFile(3,"ZEINVOR" + _fpw$)
         CALL Sollstellung(0,2,"0")
         CALL Fehler("Die Sollstellungberechnung ist beendet!!!","")
       END IF 
     ELSE 
       CALL Fehler("Diese Funktion ist nur nutzbar, wenn Sie das Sollstellungsmodul erworben haben!","")
     END IF 
   CASE 102
     CALL DFile(3,"VProdukt" + _fpw$)
     CALL DFile(3,"KVERTRAG" + _fpw$)
     CALL DFile(3,"GEKOND" + _fpw$)
     CALL DFile(3,"VKOND" + _fpw$)
     CALL DFile(3,"MAADR" + _fpw$)
     CALL DFile(3,"GEKONDM" + _fpw$)
     CALL DFile(3,"Sparten" + _fpw$)
     CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
     CALL DFile(3,"VPSPEZKO" + _fpw$)
     CALL DFile(3,"VPGEKOND" + _fpw$)
     CALL DFile(3,"FOERKOND" + _fpw$)
     CALL DFile(3,"BUCHUNG1" + _fpw$)
     REM Abrechnung Maklerbetreuer
     REM Der Maklerbetreuer soll fÅr die UmsÑtze der betreuten Agenturen
     REM eine FixvergÅtung pro Vertrag erhalten. DieVergÅtung soll
     REM unabhÑngig von der Vertragssumme sein. DieHîhe der FixvergÅtung
     REM soll aber pro Agentur und pro Produkt festgelegt werden kînnen:
     REM Unter Konditionen sollte fÅr jede Agentur die Maklerbetreuer - FixvergÅtung
     REM je Produkt festgelegt werden kînnen.
     REM Diese FixvergÅtung soll pro Vertrag einmalig sein,dass hei·t
     REM bei Nachzahlungen,Vertragserhîhungen etc. sollkeine
     REM erneute FixvergÅtung fÑllig werden.
     REM Nach meinem VerstÑndnis mÅ·te im Abrechnungslauf folgendes passieren:
     REM - prÅfen,zu welchen VertrÑge eine Provisionsbuchung erfolgt ist
     REM - prÅfen ob bereits eine FixvergÅtung abgerechnet wurde
     REM - erstellen einer Abrechnungsliste
     REM - Markierung der VertrÑge als abgerechnet
 
     REM Vertragsdatei durchsuchen auf codeko>0 und AFSKPauschJN<>j und ob der Vertrag lebend ist und ob Provisionsbuchung erfolgt ist, 
     REM d.h. lfdnr.kvertrag existiert in codevt.buchung1, dann alle Buchungen des Mitarbeiters abgrasen nach dem ersten erzeugten Buchungssatz,
     REM also mit Ñltesten Datum, wenn der Datensatz in das Buchungsdatum fÑllt, dann soll der Vertrag berÅcksichtigt werden

     REM dann mit Codeko.kvertrag in VKOND auf CodeVK.vkond gehen, dort die CodeKO.vkond auslesen
     REM und mit codeko.vkond auf lfdnr.gekond gehen dort gucken, ob AFSKPauschJN=j und AFSKPausch<>0
     CalcDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
     CalcMon% = MONTH ( TODAY )
     CalcJahr% = VAL ( LEFT$ ( DATE$ ( TODAY ,"yyyy.mm.0d"),4))
AFABR010920031: 
     CREATE DIALOG "STICHTAG",0,0,222,114,"Abrechnung FixvergÅtung","MS Sans Serif",8
     ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
     ADD DIALOG "STICHTAG",9,6,9,23,24,2
     ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, mit welchem Datum"
     ADD DIALOG "STICHTAG",5,31,25,183,10,0,"die FixvergÅtung ausgewiesen werden sollen:"
     ADD DIALOG "STICHTAG",6,104,42,42,12,0,0,CalcDate$,10
     ADD DIALOG "STICHTAG",5,30,44,68,10,0,"Buchungs-Datum:"
     ADD DIALOG "STICHTAG",6,104,58,24,12,0,0,CALCJahr%,4
     ADD DIALOG "STICHTAG",5,30,60,68,10,0,"Abrechnungs-Jahr:"
     ADD DIALOG "STICHTAG",6,104,74,12,12,0,0,CalcMon%,2
     ADD DIALOG "STICHTAG",5,30,76,68,10,0,"Abrechnungs-Monat:"
     ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
     ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
     DIALOG "STICHTAG",req%
     REMOVE DIALOG "STICHTAG"
     IF req% = 1 THEN 
       IF NOT DateOK%(CalcDate$) THEN 
         CALL Fehler ("Datum falsch","")
         GOTO AFABR010920031
       END IF 
       IF CalcMon% < 1 OR CalcMon% > 12 THEN 
         CALL Fehler("Der Monat mu· grî·er 0 und kleiner 13 sein!","Bitte korrigieren!")
         GOTO AFABR01090031
       END IF 
     ELSE 
       GOTO endaf070420032
     END IF 
     FILE "KVERTRAG"
     INDEX QAFSKPAUMADAT.kvertrag
     SELECT FIRST FILE "KVERTRAG" INDEX QAFSKPAUMADAT.kvertrag
     SELECT KEY "j00000000" LOCK FILE "KVERTRAG" INDEX QAFSKPAUMADAT.kvertrag
     ok% = 1
     i% = 0
     j% = 0
     fixver% = 0
     berech% = 0
     WHILE NOT EOF ("KVERTRAG") AND QAFSKPAUMADAT.kvertrag = "j00000000"
       j% = j% + 1
       weiter% = - 1
       SET STATUS LTRIM$ ( STR$ (j%,",99999999")) + " VertrÑge getestet / fÅr FixvergÅtung gefunden " + LTRIM$ ( STR$ (fixver%,",99999999"))
       IF QAFSKPAUMADAT.kvertrag = "j00000000" THEN 
         codevt% = lfdnr.kvertrag
         codema% = codema.kvertrag
         ok% = - 1
         IF codema% < 1 THEN ok% = 0
         REM Feststellen, ob ein Maklerbetreuer eingetragen ist
         SELECT FIRST FILE "MAADR" INDEX codema.maadr
         SELECT KEY codema% FILE "MAADR" INDEX codema.maadr
         fixCodeMa% = CodeMABetreu.maadr
         IF fixCodeMa% < 1 THEN ok% = 0
         IF CodeVStatus.kvertrag <> 1 THEN ok% = 0
         IF codeko.kvertrag < 1 THEN ok% = 0
         IF AFSKPauschDat.kvertrag < 1 THEN AFSKPauschDat.kvertrag = 0
         IF AFSKPauschDat.kvertrag > 0 THEN ok% = 0
         IF CodeVStatus.kvertrag = 1 AND ok% = - 1 THEN 
           IF EXISTS (codeko.kvertrag,codevk.vkond) THEN 
             SELECT FIRST FILE "vkond" INDEX codevk.vkond
             SELECT KEY codeko.kvertrag FILE "vkond" INDEX codevk.vkond
             IF EXISTS (codeko.vkond,lfdnr.gekond) THEN 
               SELECT FIRST FILE "GEKOND" INDEX lfdnr.gekond
               SELECT KEY codeko.vkond FILE "GEKOND" INDEX lfdnr.gekond
               FixvergÅtung% = 0
               IF AFSKPauschJN.gekond <> "j" THEN 
                 ok% = 0
                 FixvergÅtung% = 0
               ELSE 
                 REM FixvergÅtung
                 REM FixvergÅtung% = AFSKPausch.gekond
                 FixvergÅtung% = AFSKPausch.kvertrag
               END IF 
             ELSE 
               ok% = 0
             END IF 
           ELSE 
             ok% = 0
           END IF 
         END IF 
         IF ok% = - 1 THEN 
           REM jetzt irgendwie nach Buchungen suchen
           IF EXISTS (codevt%,codevt.buchung1) THEN 
             SELECT FIRST FILE "Buchung1" INDEX codevt.buchung1
             SELECT KEY codevt% FILE "Buchung1" INDEX codevt.buchung1
             datumzw% = TODAY + 100
             nurplus% = - 1
             WHILE NOT EOF ("Buchung1") AND codevt.buchung1 = codevt%
               IF codema.buchung1 = codema% THEN 
                 IF Datum.buchung1 < datumzw% THEN 
                   datumzw% = Datum.buchung1
                   IF betrag.buchung1 < 0 THEN 
                     IF Buchungstext.buchung1 LIKE "Storno*" OR Buchungstext.buchung1 LIKE "*Storno*" OR Buchungstext.buchung1 LIKE "Stor.*" OR Buchungstext.buchung1 LIKE "*Stor.*" THEN 
                       nurplus% = 0
                     END IF 
                   END IF 
                 END IF 
               END IF 
               SELECT NEXT FILE "Buchung1" INDEX codevt.buchung1
             WEND 
             REM jetzt mÅsste er rausgekriegt haben, das erste Buchungsdatum und ob Stornos dawaren
             datbutest$ = DATE$ (datumzw%,"0d.mm.yyyy")
             montest% = MONTH (datumzw%)
             jahrtest% = YEAR (datumzw%)
             REM IF CALCJahr% = jahrtest% AND CalcMon% = montest% AND nurplus% = - 1 THEN 
             IF nurplus% = - 1 AND AFSKPauschDat.kvertrag < 1 THEN 
               REM Erstbuchungsdatum entspricht Abrechnungsmonat und Abrechnungsjahr, also alle Infos setzen
               REM CALL Fehler(VS_NR.kvertrag,"FixvergÅtung wird gezahlt")
               AFSKPausch.kvertrag = FixvergÅtung%
               AFSKPauschDat.kvertrag = DAYS (CalcDate$)
               t1% = DAYS (CalcDate$)
               QAFSKPAUMADAT.kvertrag = "j" + DATE$ (t1%,"yyyymm0d")
               REM der codema des Maklerbetreuers
               fixCodeMa.kvertrag = fixCodeMa%
               CALL QuickStore("KVERTRAG")
               fixver% = fixver% + 1
               weiter% = 0
               SELECT FIRST FILE "KVERTRAG" INDEX QAFSKPAUMADAT.kvertrag
               SELECT KEY "j00000000" LOCK FILE "KVERTRAG" INDEX QAFSKPAUMADAT.kvertrag
             END IF 
           END IF 
         END IF 
       END IF 
       IF weiter% = - 1 THEN SELECT NEXT LOCK FILE "KVERTRAG" INDEX QAFSKPAUMADAT.kvertrag
     WEND 
     CALL Fehler("FixvergÅtungsfeststellung beendet!","")
   CASE 103
     CALL DFile(3,"KVERTRAG" + _fpw$)
     CALL DFile(3,"KVFAEL" + _fpw$)
     REM Abrechnung 10 EUR VergÅtung
     REM - prÅfen welche VertrÑge aus der öberwachung sind (4MonatsbeitrÑge sind
     REM eingegangen)
     REM - prÅfen,zu welchen dieser VertrÑge eine Pauschalabrechnung fÑllig ist und
     REM noch nicht ausgefÅhrt wurde
     REM - eine Abrechnungsliste der fÑlligen VertrÑge mit dem im Produkt
     REM hinterlegten Pauschalbetrag erstellen
     REM - Markierung der VertrÑge als abgerechnet
AFABR070420031: 
     CalcDate$ = DATE$ ( TODAY ,"0d.mm.yyyy")
     CREATE DIALOG "STICHTAG",0,0,222,114,"Abrechnung Sutor-Pauschale","MS Sans Serif",8
     ADD DIALOG "STICHTAG",4,0,0,222,91,0,""
     ADD DIALOG "STICHTAG",9,6,9,23,24,2
     ADD DIALOG "STICHTAG",5,31,15,183,10,0,"Bitte geben Sie an, mit welchem Datum"
     ADD DIALOG "STICHTAG",5,31,25,183,10,0,"die Sutor-Pauschale ausgewiesen werden sollen:"
     ADD DIALOG "STICHTAG",6,94,72,42,12,0,0,CalcDate$,10
     ADD DIALOG "STICHTAG",5,30,74,58,10,0,"Datum:"
     ADD DIALOG "STICHTAG",1,52,94,54,14,1,"&OK",1,1
     ADD DIALOG "STICHTAG",1,109,94,54,14,0,"&Abbrechen",0,0
     DIALOG "STICHTAG",req%
     REMOVE DIALOG "STICHTAG"
     IF req% = 1 THEN 
       IF NOT DateOK%(CalcDate$) THEN 
         CALL Fehler ("Datum falsch","")
         GOTO AFABR070420031
       END IF 
     ELSE 
       GOTO endaf070420032
     END IF 
     FILE "KVERTRAG"
     INDEX QAFSKPAUDAT.kvertrag
     SELECT FIRST FILE "KVERTRAG" INDEX QAFSKPAUDAT.kvertrag
     SELECT KEY "j00000000" LOCK FILE "KVERTRAG" INDEX QAFSKPAUDAT.kvertrag
     ok% = 1
     i% = 0
     j% = 0
     WHILE NOT EOF ("KVERTRAG") AND ok% = 1
       j% = j% + 1
       IF QAFSKPAUDAT.kvertrag = "j00000000" THEN 
         codevt% = lfdnr.kvertrag
         IF EXISTS (codevt%,codevt.kvfael) THEN 
           REM jetzt prÅfen, ob 4 ZE, wenn ja dann verarbeiten
           SELECT KEY codevt% FILE "KVFAEL" INDEX codevt.kvfael
           erwpr% = erwProvAnz.kvfael
           ABSwer$ = abserledigt.kvfael
           IF gezProvAnz.kvfael >= erwProvAnz.kvfael AND abserledigt.kvfael LIKE "j" THEN 
             i% = i% + 1
             AFSKPAUDAT.kvertrag = TODAY 
             QAFSKPAUDAT.kvertrag = "j" + DATE$ (AFSKPAUDAT.kvertrag,"yyyymm0d")
             STORE FILE "KVERTRAG"
             UNLOCK CURRENT FILE "KVERTRAG"
             SELECT FIRST FILE "KVERTRAG" INDEX QAFSKPAUDAT.kvertrag
             SELECT KEY "j00000000" LOCK FILE "KVERTRAG" INDEX QAFSKPAUDAT.kvertrag
           ELSE 
             SELECT NEXT LOCK FILE "KVERTRAG" INDEX QAFSKPAUDAT.kvertrag
           END IF 
         ELSE 
           SELECT NEXT LOCK FILE "KVERTRAG" INDEX QAFSKPAUDAT.kvertrag
         END IF 
       ELSE 
         ok% = 0
       END IF 
       SET STATUS LTRIM$ ( STR$ (i%)) + " verarbeitet / " + LTRIM$ ( STR$ (j%)) + " geprÅft"
     WEND 
     CALL Fehler( LTRIM$ ( STR$ (i%)) + " verarbeitet / " + LTRIM$ ( STR$ (j%)) + " geprÅft","")
   CASE 104
     CALL Sutor10Eu()
   CASE 105
     CALL ListeFix()
 END SELECT 
 END IF 
 _formend% = 0
 IF req% = 2 THEN CALL DRCONFIG()
 IF req% = 3 THEN CALL ShowLog()
 IF req% = 4 THEN CALL Inkasso()
endaf070420032: 
 ON ERROR GOTO ErrorHandler
 SET HEADING title$ + " - HauptÅbersicht"
 SET STATUS "Bereit"
 GAppName$ = _netpath$ + "DOC\provis.pdf"
 GVertrID% = 0
 END SUB 
 
 
SUB Sutor10Eu()
     REM Liste der Sutor 10 EUR Liste
     CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
     CALL DFile(3,"KVERTRAG" + _fpw$)
     CALL DFile(3,"MAADR" + _fpw$)
AFABR090420031: 
     CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
     ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     MOUSE ON 
     IF req% = 1 THEN 
       MOUSE OFF 
       IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
       IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
       IF NOT DateOK%(vondat$) THEN 
         CALL Fehler ("Datum falsch",vondat$)
         GOTO AFABR090420031
       END IF 
       IF NOT DateOK%(bisdat$) THEN 
         CALL Fehler ("Datum falsch",vondat$)
         GOTO AFABR090420031
       END IF 
       von% = DAYS (vondat$)
       bis% = DAYS (bisdat$)
 
       CALL PRep("AFSLIST1")
       Ueberschr$ = "AFSK - Pauschalabrechnung"
       REPORT ON AFSKPAUEUR.KVERTRAG AS "SumAgentur%"
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
 
       HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
       END HEADING 
 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
 
       SET QUERY OFF 
       SET QUERY LOCK OFF 
       ON ERROR GOTO endaf070420032
       SET LAST PAGE FOOTING OFF 
       SELECT ;
       WHERE Codeku.kvertrag = CodeKU.Adressen AND CodeMA.KVERTRAG = CodeMA.MAADR AND AFSKPAUDAT.KVERTRAG >= von% AND AFSKPAUDAT.KVERTRAG <= bis%
       ORDER AFSKPAUDAT.KVERTRAG,Kunde$
       TO ASK 
       END SELECT 
     END IF 
endaf070420032: 
   ON ERROR GOTO ErrorHandler
 END SUB 
 
 
SUB ListeFix()
     REM Liste der Sutor 10 EUR Liste
     CALL DFile(2,"OFFICE\" + "ADRESSEN" + _fpw$)
     CALL DFile(3,"KVERTRAG" + _fpw$)
     CALL DFile(3,"MAADR" + _fpw$)
     ma% = MakGetCodeMA%(ma%,Wks1%)
     FILE "MAADR"
     INDEX codema.maadr
     SELECT FIRST FILE "MAADR" INDEX codema.maadr
     SELECT KEY ma% FILE "MAADR" INDEX codema.maadr

AFABR310820031: 
     CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
     ADD DIALOG "Konto1",9,6,7,24,22,2
     ADD DIALOG "Konto1",5,34,8,170,9,0,"FixvergÅtungsliste:"
     ADD DIALOG "Konto1",4,34,14,176,5,0,""
     ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
     ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
     ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
     ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
     ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
     ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
     ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
     ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
     DIALOG "Konto1",req%
     REMOVE DIALOG "Konto1"
     MOUSE ON 
     IF req% = 1 THEN 
       MOUSE OFF 
       IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
       IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
       IF NOT DateOK%(vondat$) THEN 
         CALL Fehler ("Datum falsch",vondat$)
         GOTO AFABR310820031
       END IF 
       IF NOT DateOK%(bisdat$) THEN 
         CALL Fehler ("Datum falsch",vondat$)
         GOTO AFABR310820031
       END IF 
       von% = DAYS (vondat$)
       bis% = DAYS (bisdat$)
 
       CALL PRep("AFSLIST2")
       Ueberschr$ = Nachname.maadr + ", " + vorname.maadr + CHR$ (13) + CHR$ (10)
       Ueberschr$ = Ueberschr$ + plz.maadr + " " + ort.maadr + ", " + stra·e.maadr
       REPORT ON AFSKPAUSCH.KVERTRAG AS "SumAgentur%"
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
 
       HEADING 
       SET REPORT PAGE "H_PAGE"
       OUTPUT REPORT PAGE 
       END HEADING 
 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
 
       SET QUERY OFF 
       SET QUERY LOCK OFF 
       ON ERROR GOTO endaf310820032
       SET LAST PAGE FOOTING OFF 
       SELECT ;
       WHERE Codeku.kvertrag = CodeKU.Adressen AND CodeMA.KVERTRAG = CodeMA.MAADR AND AFSKPAUSCHDAT.KVERTRAG >= von% AND AFSKPAUSCHDAT.KVERTRAG <= bis% AND FixCodeMA.KVERTRAG = ma%
       ORDER AFSKPAUSCHDAT.KVERTRAG,Kunde$
       TO ASK 
       END SELECT 
     END IF 
endaf310820032: 
 ON ERROR GOTO ErrorHandler
 END SUB 
 
  REM alle FixvergÅtungen in Vertragsdatei fÅr diese Produkt zurÅcksetzen
SUB FixReset(codevp%)
  CALL DFile(3,"KVERTRAG" + _fpw$)
  CALL DFile(3,"MAADR" + _fpw$)
  CALL DFile(3,"VKOND" + _fpw$)
  CALL DFile(3,"GEKOND" + _fpw$)
  CALL DFile(3,"BUCHUNG1" + _fpw$)
  CALL Fehler("Diese Operation kann etwas dauern, bitte nicht ungeduldig werden!","Hierdurch werden in allen VertrÑgen diese Produktes die Angaben zur FixvergÅtung komplett zurÅckgesetzt!")
  REQUEST "Soll das RÅcksetzen wirklich erfolgen?","",130,req%
  IF req% <> 1 THEN GOTO rueck010920031
  MOUSE OFF 
  FILE "KVERTRAG"
  INDEX lfdnr.kvertrag
  SELECT FIRST 
  UPDATE AFSKPausch.kvertrag = 0:AFSKPAUSCHDAT.KVERTRAG = 0:QAFSKPAUMADAT.kvertrag = "" WHERE codevp.Kvertrag = codevp%
  END UPDATE 
  CLOSE FILE "KVERTRAG"
  CALL DFile(3,"KVERTRAG" + _fpw$)
  MOUSE ON 
   REM jetzt die Anpassungen fÅr Maklerbetreuungspauschale
   REM  QAFSKPAUMADAT
   FILE "KVERTRAG"
   INDEX lfdnr.kvertrag
   SELECT FIRST LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
   ii% = 0
   jj% = RECCOUNT ("KVERTRAG")
   kk% = 0
   WHILE NOT EOF ("KVERTRAG")

     ii% = ii% + 1
     SET STATUS LTRIM$ ( STR$ (ii%,",99999999")) + " in KVERTRAG geprÅft auf Fixverg. von " + LTRIM$ ( STR$ (jj%,",99999999")) + " neu gefunden " + LTRIM$ ( STR$ (kk%,",99999999"))
     ok% = - 1
     IF LTRIM$ (QAFSKPAUMADAT.kvertrag) <> "" THEN ok% = 0
     IF CodeVStatus.kvertrag <> 1 THEN ok% = 0
     IF codeko.kvertrag < 1 THEN ok% = 0
     IF AFSKPauschDat.kvertrag < 1 THEN AFSKPauschDat.kvertrag = 0
     IF AFSKPauschDat.kvertrag > 0 THEN ok% = 0
     IF CodeVStatus.kvertrag = 1 AND ok% = - 1 THEN 
       IF EXISTS (codeko.kvertrag,codevk.vkond) THEN 
         SELECT FIRST FILE "vkond" INDEX codevk.vkond
         SELECT KEY codeko.kvertrag FILE "vkond" INDEX codevk.vkond
         IF EXISTS (codeko.vkond,lfdnr.gekond) THEN 
           SELECT FIRST FILE "GEKOND" INDEX lfdnr.gekond
           SELECT KEY codeko.vkond FILE "GEKOND" INDEX lfdnr.gekond
           IF AFSKPauschJN.gekond <> "j" THEN ok% = 0
         ELSE 
           ok% = 0
         END IF 
       ELSE 
         ok% = 0
       END IF 
     END IF 
 
     IF ok% = - 1 THEN 
       kk% = kk% + 1
       QAFSKPAUMADAT.kvertrag = "j00000000"
       AFSKPauschJN.kvertrag = "j"
       STORE FILE "kvertrag"
       UNLOCK CURRENT FILE "kvertrag"
     END IF 
     SELECT NEXT LOCK FILE "KVERTRAG" INDEX lfdnr.kvertrag
   WEND 
  CALL Fehler("RÅcksetzen ist erfolgt!", LTRIM$ ( STR$ (ii%,",99999999")) + " in KVERTRAG geprÅft auf Fixverg. von " + LTRIM$ ( STR$ (jj%,",99999999")) + " neu gefunden " + LTRIM$ ( STR$ (kk%,",99999999")))
rueck010920031: 
 END SUB 


 
SUB ZUSATZBUZE()
 IF disabled%("BUCHUNGBEARB") THEN END SUB 
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 MOUSE OFF 
 DIM LAgenturen$( RECCOUNT ("MAADR"))
    DIM dlg AS Dialog
    DIM control AS DialogControl 
 FILE "MAADR"
 INDEX CodeMA.MAADR
 SELECT FIRST 
 a% = 0
 fprompt$ = "ZZZZZZZZZZZZZZ"
 aprompt$ = ""
 MOUSE OFF 
 SELECT FIRST FILE "stamm"
 waehr$ = "WÑhrung: " + waehrung.stamm
 codew1% = codew.stamm
 Waehrung1$ = waehrung.stamm
 euro1% = umrechnung.stamm
 WHILE NOT EOF ("MAADR")
   LAgenturen$(a%) = Nachname.MAADR + ", " + Vorname.MAADR + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
   IF CodeMA.MAADR = _ma% THEN aprompt$ = LAgenturen$(a%)
   IF LAgenturen$(a%) < fprompt$ THEN fprompt$ = LAgenturen$(a%)
   a% = a% + 1
   SELECT NEXT FILE "MAADR" INDEX CodeMA.MAADR
 WEND 
 IF aprompt$ = "" THEN Auswahl$ = fprompt$ ELSE Auswahl$ = aprompt$
 ok% = 1
 WHILE ok% = 1
   SELECT FIRST FILE "stamm"
   waehr$ = "WÑhrung: " + waehrung.stamm
   codew1% = codew.stamm
   Waehrung1$ = waehrung.stamm
   euro1% = umrechnung.stamm
   SET STATUS "Zusatzbuchungen"
   MOUSE ON 
   BLANK FILE "buchung1"
   SET STATUS "Datensatz neu angelegt..."
   Datum.buchung1 = TODAY 
   Buchungstext.buchung1 = "Zusatzbuchung:"
    Superbase.Dialogs.Add("ZBUCHUNG")
    SET dlg = Superbase.Dialogs.ZBUCHUNG
    dlg.Move(0,0,225,209)
    dlg.Caption = "Zusatzbuchung"
    dlg.FontName = "MS Sans Serif"
    dlg.FontSize = 8
 
    SET control = dlg.Add("DialogFrame1","DialogFrame")
    control.Move(0,0,225,182)
    control.Caption = ""
 
    SET control = dlg.Add("DialogIcon1","DialogIcon")
    control.Move(6,12,20,23)
    control.Icon = 2
 
    SET control = dlg.Add("DialogLabel1","DialogLabel")
    control.Move(40,14,176,22)
    control.Caption = "Bitte wÑhlen Sie eine Agentur und fÅllen Sie die Felder Buchungstext und Betrag aus:"
 
    SET control = dlg.Add("DialogLabel6","DialogLabel")
    control.Move(74,41,139,10)
    control.CaptionBinding = "waehr$"
 
    SET control = dlg.Add("DialogLabel2","DialogLabel")
    control.Move(40,41,29,10)
    control.Caption = "Agentur:"
 
    SET control = dlg.Add("DialogComboBox1","DialogComboBox")
    control.Move(40,52,174,195)
    control.Style = 2
    control.Sorted = 1
    control.ScrollBars = 2
    control.Bind("LAgenturen$","Auswahl$")
 
    SET control = dlg.Add("DialogTextBox1","DialogTextBox")
    control.Move(82,72,42,12)
    control.MaxLength = 10
    control.TextBinding = "Datum.buchung1"
 
    SET control = dlg.Add("DialogLabel3","DialogLabel")
    control.Move(20,73,25,13)
    control.Caption = "Datum"
 
    SET control = dlg.Add("DialogTextBox2","DialogTextBox")
    control.Move(82,86,60,11)
    control.MaxLength = 20
    control.TextBinding = "Betrag.buchung1"
 
    SET control = dlg.Add("DialogLabel4","DialogLabel")
    control.Move(20,85,52,9)
    control.Caption = "Brutto - Betrag"




    SET control = dlg.Add("DialogTextBox6","DialogTextBox")
    control.Move(82,100,60,11)
    control.MaxLength = 20
    control.TextBinding = "MWSTBetragEU.buchung1"
 
    SET control = dlg.Add("DialogLabel10","DialogLabel")
    control.Move(20,100,52,11)
    control.Caption = "MWSt - Betrag"

 
 
    SET control = dlg.Add("DialogTextBox7","DialogTextBox")
    control.Move(162,100,40,11)
    control.MaxLength = 7
    control.TextBinding = "MWSTProz.buchung1"
 
    SET control = dlg.Add("DialogLabel11","DialogLabel")
    control.Move(145,100,17,11)
    control.Caption = "in % "
 




    SET control = dlg.Add("DialogTextBox8","DialogTextBox")
    control.Move(82,114,60,11)
    control.MaxLength = 20
    control.TextBinding = "NettoEU.buchung1"
 
    SET control = dlg.Add("DialogLabel12","DialogLabel")
    control.Move(20,114,52,9)
    control.Caption = "Netto - Betrag"
 
 
    SET control = dlg.Add("DialogTextBox3","DialogTextBox")
    control.Move(82,130,132,40)
    control.MultiLine = 1
    control.ScrollBars = 2
    control.MaxLength = 4000
    control.TextBinding = "Buchungstext.buchung1"
 
    SET control = dlg.Add("DialogLabel5","DialogLabel")
    control.Move(20,132,52,9)
    control.Caption = "Buchungstext"
 
    SET control = dlg.Add("DialogCommandButton1","DialogCommandButton")
    control.Move(50,186,55,15)
    control.Caption = "&Buchen"
    control.ReturnValue = 1
 
    SET control = dlg.Add("DialogCommandButton2","DialogCommandButton")
    control.Move(108,186,54,15)
    control.Caption = "&Abbrechen"
    control.ReturnValue = 0
    control.Cancel = 1
 
 
 
 
   DIALOG "ZBUCHUNG",req%
   REMOVE DIALOG "ZBUCHUNG"
   MOUSE OFF 
   ma1% = VAL ( RIGHT$ (Auswahl$,6))
 
   IF req% = 1 AND ma1% <> 0 THEN 
     SET STATUS "Buchung wird gespeichert"
     CodeBU.buchung1 = SER ("buchung1",1)
     CodeMA.buchung1 = VAL ( RIGHT$ (Auswahl$,6))
     ma% = CodeMA.buchung1
     SELECT FIRST FILE "maadr" INDEX codema.maadr
     SELECT KEY ma% FILE "maadr" INDEX codema.maadr
     VTAgentur.buchung1 = LEFT$ (Nachname.maadr + "," + vorname.maadr,100)
     datumz% = Datum.buchung1
     betr% = Betrag.buchung1
     VTCodema.buchung1 = ma%
     Codew.buchung1 = codew1%
     umrechnung.buchung1 = euro1%
     waehrung.buchung1 = waehrung1$
     BetragEU.buchung1 = VAL ( STR$ (Betrag.buchung1 / umrechnung.buchung1,"99999999.00"))
     IF BetragEU.buchung1 = 0 AND NettoEU.buchung1 <> 0 THEN 
       IF MWSTBetragEU.buchung1 = 0 THEN 
         BetragEU.buchung1 = NettoEU.buchung1
       END IF 
     END IF 
     IF MWSTBetragEU.buchung1 = 0 AND NettoEu.buchung1 = 0 THEN 
       NettoEu.buchung1 = BetragEU.buchung1
     END IF 
     IF Betrag.buchung1 = 0 THEN Betrag.buchung1 = VAL ( STR$ (BetragEU.buchung1 * umrechnung.buchung1,"99999999.00"))
     CALL FStore("buchung1")
     zusatz% = 1
     eigen% = 1
     PSpAll$ = ""
     PSpAllSeit% = 0
     PROVSpEig$ = ""
     PSpESeit% = 0
     CALL ZentrKTO(ma%,datumz%,betr%,0,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
     SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
     AuszahlAB.maadr = AuszahlAB.maadr + betr%
     AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
     zusAuszahl.maadr = zusAuszahl.maadr + betr%
     zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
     aktZusB.maadr = aktZusB.maadr + betr%
     aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
     STORE FILE "maadr"
     UNLOCK CURRENT FILE "maadr"
   ELSE 
     ok% = 0
   END IF 
   MOUSE ON 
 WEND 
 END SUB 
  
 
 '      **************************************
 '      ** Routinen fÅr Formular "BUCHUNG"  **
 '      ** (Zusatzbuchungen/Kontenkorrektur **
 '      **************************************
 '      13.10.94 
 
SUB ZBUCHUNGZE()
 IF disabled%("ZBUCHUNG") THEN END SUB 
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 _formend% = 0
 SELECT FIRST FILE "stamm"
 euro1% = umrechnung.stamm
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   ZBsub% = 0
   IF UCASE$ ( FORM ) <> "BUCHUNG1" THEN 
     SET HEADING title$ + " - Buchungsdatei"
     OPEN FORM GPrjForm$ + "BUCHUNG1"
     SET f = Superbase.Form
     FILE "BUCHUNG1"
     INDEX CodeBU.BUCHUNG1
     SELECT FORM LAST 
     CALL MNZBUCHUNG1()
     MENU ON 
     SET STATUS "Buchungsdatei"
   END IF 
   REM CALL ZBUpdate()
   MOUSE ON 
   SELECT KEY CodeMA.buchung1 FILE "MAADR" INDEX CodeMA.maadr
   IF FOUND ("MAADR") THEN maadr$ = Nachname.maadr + "," + Vorname.maadr + "," + Agenturnr.maadr ELSE maadr$ = "<keine Zuordnung>"
   FORM 
   CALL ClearKBDBuffer()
   f.abbruch.enabled = 0
   f.abbruch.visible = 0
   f.neu.enabled = - 1
   f.neu.visible = - 1
   f.bearb.enabled = - 1
   f.bearb.visible = - 1
   f.sich.enabled = 0
   f.sich.visible = 0
   f.links1.enabled = - 1
   f.links1.visible = - 1
   f.rechts.enabled = - 1
   f.rechts.visible = - 1
   f.zur.enabled = - 1
   f.zur.visible = - 1
   f.such.enabled = - 1
   f.such.visible = - 1
   IF GAgentDetail$ LIKE "TRUE" THEN 
     f.ma.enabled = 0
     f.ma.visible = 0
   ELSE 
     f.ma.enabled = - 1
     f.ma.visible = - 1
   END IF 
   IF GAgentDetail$ = "TRUE" THEN 
     IF Betrag.buchung1 = - 123123123.33 THEN 
       f.betrag.BackColor = 0
       f.betrag.BorderColor = 1
       f.betrag.ForeColor = 1
       f.betrag.ReadOnly = - 1
 
       f.sr.BackColor = 0
       f.sr.BorderColor = 1
       f.sr.ForeColor = 1
       f.sr.ReadOnly = - 1
 
       f.sra.BackColor = 195
       f.sra.BorderColor = 8
       f.sra.ForeColor = 1
       f.sra.ReadOnly = 0
 
       f.aa.BackColor = 195
       f.aa.BorderColor = 8
       f.aa.ForeColor = 1
       f.aa.ReadOnly = 0
     ELSE 
       f.betrag.BackColor = 195
       f.betrag.BorderColor = 8
       f.betrag.ForeColor = 1
       f.betrag.ReadOnly = 0
 
       f.sr.BackColor = 195
       f.sr.BorderColor = 8
       f.sr.ForeColor = 1
       f.sr.ReadOnly = 0
 
       f.sra.BackColor = 195
       f.sra.BorderColor = 8
       f.sra.ForeColor = 1
       f.sra.ReadOnly = 0
 
       f.aa.BackColor = 195
       f.aa.BorderColor = 8
       f.aa.ForeColor = 1
       f.aa.ReadOnly = 0
     END IF 
   END IF 
   IF ZBsub% <> 99 THEN WAIT MOUSE OR KEY OR MENU 
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL BUPrev1()
   CASE CrsRight%,PgDn%
     CALL BUNext1()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE ZBsub%
   CASE 99
     
     betrag% = betrag.buchung1
     MENU OFF 
     IF GAgentdeTail$ = "TRUE" THEN 
       f.ma.enabled = 0
       f.ma.visible = 0
       f.such.enabled = 0
       f.such.visible = 0
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       f.neu.enabled = 0
       f.neu.visible = 0
       f.bearb.enabled = 0
       f.bearb.visible = 0
       f.sich.enabled = - 1
       f.sich.visible = - 1
       f.links1.enabled = 0
       f.links1.visible = 0
       f.rechts.enabled = 0
       f.rechts.visible = 0
       f.zur.enabled = 0
       f.zur.visible = 0
     ELSE 
       f.ma.enabled = - 1
       f.ma.visible = - 1
       f.such.enabled = 0
       f.such.visible = 0
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       f.neu.enabled = 0
       f.neu.visible = 0
       f.bearb.enabled = 0
       f.bearb.visible = 0
       f.sich.enabled = - 1
       f.sich.visible = - 1
       f.links1.enabled = 0
       f.links1.visible = 0
       f.rechts.enabled = 0
       f.rechts.visible = 0
       f.zur.enabled = 0
       f.zur.visible = 0
     END IF 
     ENTER Datum.BUCHUNG1,0
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     f.such.enabled = - 1
     f.such.visible = - 1
     f.neu.enabled = - 1
     f.neu.visible = - 1
     f.bearb.enabled = - 1
     f.bearb.visible = - 1
     f.sich.enabled = 0
     f.sich.visible = 0
     f.links1.enabled = - 1
     f.links1.visible = - 1
     f.rechts.enabled = - 1
     f.rechts.visible = - 1
     f.zur.enabled = - 1
     f.zur.visible = - 1
     IF GAgentdeTail$ = "TRUE" THEN 
       f.ma.enabled = 0
       f.ma.visible = 0
     ELSE 
       f.ma.enabled = - 1
       f.ma.visible = - 1
     END IF 
     IF MOD ("Buchung1") THEN CALL QuickStore("BUCHUNG1")
     IF betrag% = 0 AND betrag.buchung1 <> 0 THEN 
       ma% = CodeMA.buchung1
       datumz% = Datum.buchung1
       betr% = Betrag.buchung1
       codew1% = Codew.buchung1
       euro1% = umrechnung.buchung1
       waehrung1$ = waehrung.buchung1
       sr% = sr.buchung1
       zusatz% = 1
       eigen% = 1
       PSpAll$ = ""
       PSpAllSeit% = 0
       PROVSpEig$ = ""
       PSpESeit% = 0
       CALL ZentrKTO(ma%,datumz%,betr%,sr%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       Stornoreserve.maadr = Stornoreserve.maadr + sr%
       StornoreserveEu.maadr = VAL ( STR$ (Stornoreserve.maadr / euro1%,"999999999.00"))
       AuszahlAB.maadr = AuszahlAB.maadr + betr%
       AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
       zusAuszahl.maadr = zusAuszahl.maadr + betr%
       zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
       aktZusB.maadr = aktZusB.maadr + betr%
       aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
       STORE FILE "maadr"
       UNLOCK CURRENT FILE "maadr"
     END IF 
     MENU ON 
   CASE 199
     MENU OFF 
       f.ma.enabled = 0
       f.ma.visible = 0
       f.such.enabled = 0
       f.such.visible = 0
       f.abbruch.enabled = - 1
       f.abbruch.visible = - 1
       f.neu.enabled = 0
       f.neu.visible = 0
       f.bearb.enabled = 0
       f.bearb.visible = 0
       f.sich.enabled = - 1
       f.sich.visible = - 1
       f.links1.enabled = 0
       f.links1.visible = 0
       f.rechts.enabled = 0
       f.rechts.visible = 0
       f.zur.enabled = 0
       f.zur.visible = 0
       f.betrag.BackColor = 195
       f.betrag.BorderColor = 8
       f.betrag.ForeColor = 1
       f.betrag.ReadOnly = 0
 
       f.sr.BackColor = 195
       f.sr.BorderColor = 8
       f.sr.ForeColor = 1
       f.sr.ReadOnly = 0
 
       f.sra.BackColor = 195
       f.sra.BorderColor = 8
       f.sra.ForeColor = 1
       f.sra.ReadOnly = 0
 
       f.aa.BackColor = 195
       f.aa.BorderColor = 8
       f.aa.ForeColor = 1
       f.aa.ReadOnly = 0
     ENTER Datum.BUCHUNG1,0
     MENU ON 
     IF betrag.buchung1 <> 0 THEN 
       ma% = CodeMA.buchung1
       datumz% = Datum.buchung1
       betr% = Betrag.buchung1
       codew1% = Codew.buchung1
       euro1% = umrechnung.buchung1
       waehrung1$ = waehrung.buchung1
       sr% = sr.buchung1
       zusatz% = 1
       eigen% = 1
       PSpAll$ = ""
       PSpAllSeit% = 0
       PROVSpEig$ = ""
       PSpESeit% = 0
       CALL ZentrKTO(ma%,datumz%,betr%,sr%,codew1%,euro1%,waehrung1$,PSpAll$,PSpAllSeit%,PROVSpEig$,PSpESeit%,eigen%,zusatz%,0)
       SELECT KEY ma% LOCK FILE "maadr" INDEX codema.maadr
       Stornoreserve.maadr = Stornoreserve.maadr + sr%
       StornoreserveEu.maadr = VAL ( STR$ (Stornoreserve.maadr / euro1%,"999999999.00"))
       AuszahlAB.maadr = AuszahlAB.maadr + betr%
       AuszahlEUAB.maadr = VAL ( STR$ (AuszahlAB.maadr / euro1%,"999999999.00"))
       zusAuszahl.maadr = zusAuszahl.maadr + betr%
       zusAuszahlEU.maadr = VAL ( STR$ (zusAuszahl.maadr / euro1%,"999999999.00"))
       aktZusB.maadr = aktZusB.maadr + betr%
       aktZusBEU.maadr = VAL ( STR$ (aktZusB.maadr / euro1%,"999999999.00"))
       STORE FILE "maadr"
       UNLOCK CURRENT FILE "maadr"
     END IF 
     f.abbruch.enabled = 0
     f.abbruch.visible = 0
     f.such.enabled = - 1
     f.such.visible = - 1
     f.neu.enabled = - 1
     f.neu.visible = - 1
     f.bearb.enabled = - 1
     f.bearb.visible = - 1
     f.sich.enabled = 0
     f.sich.visible = 0
     f.links1.enabled = - 1
     f.links1.visible = - 1
     f.rechts.enabled = - 1
     f.rechts.visible = - 1
     f.zur.enabled = - 1
     f.zur.visible = - 1
     IF GAgentdeTail$ = "TRUE" THEN 
       f.ma.enabled = 0
       f.ma.visible = 0
     ELSE 
       f.ma.enabled = - 1
       f.ma.visible = - 1
     END IF 
   END SELECT 
   ZBsub% = 0
 WEND 
 _formend% = 0
 END SUB 
 
SUB BUNeu1()
 FILE "BUCHUNG1"
 _cma% = CodeMA.BUCHUNG1
 IF Buchungstext.BUCHUNG1 <> "" THEN 
   IF NEW ("BUCHUNG1") OR MOD ("BUCHUNG1") THEN CALL FStore("BUCHUNG1")
 END IF 
 _cma% = GetCodeMA%(_cma%,Workstation%)
 IF _cma% <> 0 THEN 
   BLANK 
   SET STATUS "Datensatz neu angelegt..."
   Buchungstext.BUCHUNG1 = "Zusatzbuchung:"
   CodeMA.BUCHUNG1 = _cma%
   CodeBU.buchung1 = SER ("buchung1",1)
   datum.buchung1 = TODAY 
   CALL FStore("BUCHUNG1")
   ZBsub% = 199
 END IF 
 FORM 
 END SUB 
  
SUB BUNext1()
 IF FileChanged%("BUCHUNG1") = 1 THEN CALL FStore("BUCHUNG1")
 SET INDEX CodeBU.BUCHUNG1
 INDEX CodeBU.BUCHUNG1
 CALL PSelectNext()
 FORM 
 END SUB 
 
SUB BUPrev1()
 IF FileChanged%("BUCHUNG1") = 1 THEN CALL FStore("BUCHUNG1")
 SET INDEX CodeBU.BUCHUNG1
 INDEX CodeBU.BUCHUNG1
 CALL PSelectPrev()
 FORM 
 END SUB 
 
SUB BUSichern1()
 CALL FStore("BUCHUNG1")
 END SUB 
 
SUB BULoesch1()
 IF disabled%("BULoeschen") THEN END SUB 
 cubu% = CodeBU.BUCHUNG1
 REQUEST "Buchungssatz wirklich lîschen?","",135,req%
 IF req% = 1 THEN 
   SELECT KEY cubu% LOCK FILE "BUCHUNG1" INDEX CodeBU.BUCHUNG1
   SELECT REMOVE FILE "Buchung1"
   SELECT NEXT FILE "Buchung1"
   FORM 
 END IF 
 FORM 
 END SUB 
 
SUB BUSuchen1()
 _cubu% = CodeBU.BUCHUNG1
 bu% = FindBuchung1%(CodeMA.BUCHUNG1)
 IF bu% <> 0 THEN 
   SELECT KEY bu% FILE "BUCHUNG1" INDEX CodeBU.BUCHUNG1
 END IF 
 END SUB 
 
 ' Buchungen in Buchungsdatei suchen
 ' =======================================================================
 ' 11.09.95  - Umstellung auf QuickCode
 
FUNCTION FindBuchung1%(_ma%)
 cuge% = CodeMA.BUCHUNG1
 cubu% = CodeBU.BUCHUNG1
 von% = 0
 bis% = 0
 DIM LAgenturen$( RECCOUNT ("MAADR"))
 FILE "MAADR"
 INDEX CodeMA.MAADR
 SELECT FIRST 
 a% = 0
 fprompt$ = "ZZZZZZZZZZZZZZ"
 aprompt$ = ""
 MOUSE OFF 
 WHILE NOT EOF ("MAADR")
   LAgenturen$(a%) = Nachname.MAADR + ", " + Vorname.MAADR + SPACE$ (120) + STR$ (CodeMA.MAADR,"000000")
   IF CodeMA.MAADR = _ma% THEN aprompt$ = LAgenturen$(a%)
   IF LAgenturen$(a%) < fprompt$ THEN fprompt$ = LAgenturen$(a%)
   a% = a% + 1
   SELECT NEXT FILE "MAADR" INDEX CodeMA.MAADR
 WEND 
 MOUSE ON 
 IF aprompt$ = "" THEN Auswahl$ = fprompt$ ELSE Auswahl$ = aprompt$
 CREATE DIALOG "BUSU",0,0,248,173,"Buchungssatz suchen","MS Sans Serif",8
 ADD DIALOG "BUSU",4,0,0,248,148,0,""
 ADD DIALOG "BUSU",9,10,16,21,21,2
 ADD DIALOG "BUSU",5,43,16,194,10,0,"Bitte wÑhlen Sie die Agentur und weitere Optionen aus:"
 ADD DIALOG "BUSU",5,43,30,194,24,0,"Mit der SchaltflÑche " + CHR$ (34) + "Liste" + CHR$ (34) + " kînnen Sie einen Buchungssatz aus der letzten Ergebnisliste auswÑhlen."
 ADD DIALOG "BUSU",5,43,59,29,10,0,"Agentur:"
 ADD DIALOG "BUSU",8,43,71,142,198,256 + 3,2,Auswahl$,LAgenturen$
 ADD DIALOG "BUSU",2,43,95,173,11,0,"nur Zusatzbuchungen suchen",1,0,opt%
 ADD DIALOG "BUSU",5,43,113,63,10,0,"Buchungszeitraum:"
 ADD DIALOG "BUSU",6,61,126,41,12,0,0,von$,10
 ADD DIALOG "BUSU",6,130,126,41,12,0,0,bis$,10
 ADD DIALOG "BUSU",5,43,128,17,10,0,"von:"
 ADD DIALOG "BUSU",5,115,128,14,10,0,"bis:"
 REM ADD DIALOG "BUSU",1,33,153,55,15,0,"&Liste",2,1
 ADD DIALOG "BUSU",1,50,153,55,15,1,"&OK",1,1
 ADD DIALOG "BUSU",1,107,153,55,15,0,"&Abbrechen",0,0
 DIALOG "BUSU",req%
 REMOVE DIALOG "BUSU"
 IF req% = 1 THEN 
   MOUSE OFF 
   SET STATUS "Suche BuchungssÑtze..."
   IF RECCOUNT ("buchung1") < 10000 THEN 
     REDIM BSatz$( RECCOUNT ("buchung1"))
     anz% = RECCOUNT ("buchung1")
   ELSE 
     anz% = 10000
     REDIM BSatz$(10000)
   END IF 
   FOR a% = 0 TO anz% - 1:BSatz$(a%) = "":NEXT a%
   IF von$ = "" THEN von% = DAYS ("1.1.1980") ELSE von% = DAYS (von$)
   IF bis$ = "" THEN bis% = DAYS ( TODAY ) ELSE bis% = DAYS (bis$)
   _ma% = VAL ( RIGHT$ (Auswahl$,6))
   SELECT KEY _ma% FILE "MAADR" INDEX CodeMA.MAADR
   caption$ = "BuchungssÑtze von " + Nachname.MAADR + ", " + Vorname.MAADR
   FILE "buchung1"
   INDEX QuickCode.buchung1
   SELECT FIRST 
   qc$ = STR$ (_ma%,"000000") + DATE$ (von%,"yyyymmdd")
   SELECT KEY qc$ FILE "buchung1" INDEX QuickCode.buchung1
   a% = 0
   MOUSE OFF 
   abbruch% = 0
   WHILE CodeMA.buchung1 = _ma% AND Datum.buchung1 <= bis% AND NOT EOF ("buchung1")
     ok% = 1
     IF opt% = 1 AND Provision.buchung1 LIKE "j" THEN ok% = 0
     IF ok% = 1 THEN 
       IF a% < anz% THEN 
         SET STATUS "Suche BuchungssÑtze...(" + LTRIM$ ( STR$ (a%,"99999999")) + " gefunden)"
         BSatz$(a%) = DATE$ (Datum.buchung1,"0d.mm.yyyy") + "   " + LTRIM$ ( STR$ (Betrag.buchung1,"-,99999999.00")) + "   " + Buchungstext.buchung1 + SPACE$ (120) + STR$ (CodeBU.buchung1,"00000000")
         a% = a% + 1
       ELSE 
         SET STATUS "Suche BuchungssÑtze...(" + LTRIM$ ( STR$ (a%,"99999999")) + " gefunden)/Es kînnen aber nur maximal 10.000 gleichzeitig angezeigt werden!"
         a% = a% + 1
         IF abbruch% = 0 THEN 
           REQUEST "Wollen Sie die Suche abbrechen?","Es wurden mehr als 10.000 DatensÑtze gefunden!",130,req%
           MOUSE OFF 
           MOUSE OFF 
           FORM 
           abbruch% = 1
           IF req% = 1 THEN 
             SELECT LAST FILE "buchung1" INDEX QuickCode.buchung1
           END IF 
         END IF 
       END IF 
     END IF 
     SELECT NEXT FILE "buchung1" INDEX QuickCode.buchung1
   WEND 
   IF a% = 0 THEN 
     CALL Fehler("Keine BuchungssÑtze gefunden!","")
   ELSE 
     MOUSE ON 
     CREATE DIALOG "BUliste",0,0,346,293,caption$,"MS Sans Serif",8
     ADD DIALOG "BUliste",4,0,0,344,268,0,""
     ADD DIALOG "BUliste",9,6,9,20,21,2
     ADD DIALOG "BUliste",5,33,11,219,9,0,"Bitte wÑhlen Sie den gewÅnschen Buchungssatz aus der Liste aus:"
     ADD DIALOG "BULISTe",7,33,24,303,237,0,2,BSatz$,Auswahl$,BSatz$(0)
     ADD DIALOG "BUliste",1,113,273,54,14,1,"&OK",1,1
     ADD DIALOG "BUliste",1,172,273,55,14,0,"&Abbrechen",0,0
     DIALOG "BUListe",req%
     REMOVE DIALOG "BULISTE"
     IF req% = 1 THEN 
       _cubu% = VAL ( RIGHT$ (Auswahl$(0),8))
       FindBuchung1% = _cubu%
     ELSE 
       FindBuchung1% = 0
     END IF 
   END IF 
 END IF 
 IF req% = 2 THEN 
   IF BSatz$(0) = "" THEN 
     CALL Fehler("Keine BuchungssÑtze in Ergebnisliste!","")
   ELSE 
     CREATE DIALOG "BUliste",0,0,366,293,"Auswahl Buchungssatz","MS Sans Serif",8
     ADD DIALOG "BUliste",4,0,0,364,268,0,""
     ADD DIALOG "BUliste",9,6,9,20,21,2
     ADD DIALOG "BUliste",5,33,11,219,9,0,"Bitte wÑhlen Sie den gewÅnschen Buchungssatz aus der Liste aus:"
     ADD DIALOG "BULISTe",7,33,24,323,37,2,2,BSatz$,Auswahl$,BSatz$(0)
     ADD DIALOG "BUliste",1,123,273,54,14,1,"&OK",1,1
     ADD DIALOG "BUliste",1,182,273,55,14,0,"&Abbrechen",0,0
     DIALOG "BUListe",req%
     REMOVE DIALOG "BULISTE"
     IF req% = 1 THEN 
       _cubu% = VAL ( RIGHT$ (Auswahl$(0),8))
       FindBuchung1% = _cubu%
     ELSE 
       FindBuchung1% = 0
     END IF 
   END IF 
 END IF 
 FILE "BUCHUNG1"
 INDEX CodeBU.BUCHUNG1
 SELECT KEY cubu% FILE "BUCHUNG1" INDEX CodeBU.BUCHUNG1
 MOUSE ON 
 END FUNCTION 
 
 
 
SUB BAMASuchen():REM Agentur suchen
 ma% = CodeMA.buchung1
 cuma% = GetCodeMA%(ma%,Workstation%)
 IF cuma% <> 0 THEN 
   codema.buchung1 = cuma%
   SELECT KEY cuma% FILE "maadr" INDEX codema.maadr
   agentur.buchung1 = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
   FORM 
 END IF 
 END SUB 
 
SUB BAMASuchS()
 codebu% = codebu.buchung
 ma% = CodeMA.buchung
 cuma% = GetCodeMA%(ma%,Workstation%)
 IF cuma% <> 0 THEN 
   SELECT FIRST FILE "buchung" INDEX codebu.buchung
   SELECT KEY codebu% LOCK FILE "buchung" INDEX codebu.buchung
   codema.buchung = cuma%
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY cuma% FILE "maadr" INDEX codema.maadr
   agentur.buchung = LEFT$ ( LTRIM$ (nachname.maadr) + ", " + LTRIM$ (vorname.maadr) + ", " + LTRIM$ (Agenturnr.maadr) + " , Stufe:" + STR$ (stufe.maadr,"000"),100)
   STORE FILE "buchung"
   FORM 
 END IF 
 END SUB 
 
 
 ' Ausgabe Provisionsliste *** Andi Mai 2001
 ' =======================================================================
 
SUB PROVILISTZ()
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF disabled%("PROVISIONSLISTE") THEN END SUB 
 MOUSE OFF 
 SET STATUS "Ausgabe wird vorbereitet..."
 Kopfzeile$ = ""
 IF RECCOUNT ("buchung1") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 FOR z% = 1 TO 10
   in$ = ReadConfig$("PROVIS","Header" + LTRIM$ ( STR$ (z%,"99")))
   IF in$ <> "" AND in$ <> "leer" THEN 
     IF Kopfzeile$ = "" THEN 
       Kopfzeile$ = in$
     ELSE 
       Kopfzeile$ = Kopfzeile$ + CHR$ (13) + CHR$ (10) + in$
     END IF 
   END IF 
 NEXT z%
 Fu·zeile$ = ""
 FOR z% = 1 TO 10
   in$ = ReadConfig$("PROVIS","Footer" + LTRIM$ ( STR$ (z%,"99")))
   IF in$ <> "" AND in$ <> "leer" THEN 
     IF Fu·zeile$ = "" THEN 
       Fu·zeile$ = in$
     ELSE 
       Fu·zeile$ = Fu·zeile$ + CHR$ (13) + CHR$ (10) + in$
     END IF 
   END IF 
 NEXT z%
 FILE "buchung1"
 INDEX CodeBU.buchung1
 SELECT LAST 
 WHILE NOT EOF ("buchung1") AND Provision.buchung1 <> "j"
   SELECT PREVIOUS 
 WEND 
 IF datum.buchung1 > 20 THEN cdat$ = DATE$ (Datum.buchung1)
 von$ = ""
 bis$ = TODAY 
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 IF GAFSK$ LIKE "TRUE" THEN 
 ELSE 
   ADD DIALOG "Konto1",2,34,97,148,11,0,"Liste mit Volumen ausgeben","j","n",volumen$
 END IF 
 REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 MOUSE ON 
 IF req% = 1 THEN 
   IF volumen$ = "j" THEN Reptype% = 1
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = "31.12.2199" ELSE bisdat$ = bis$
   IF eurosupport$ = "TRUE" THEN 
     t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
     t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
     IF GAFSK$ LIKE "TRUE" OR DruInEur.stamm = 1 THEN 
       req1% = 1
     ELSE 
       CALL Fehler(t1$,t2$)
       REQUEST "öbersicht in EURO drucken?","",130,req1%
     END IF 
     IF req1% = 1 THEN 
       eu% = 1
       drwaehr$ = ""
     ELSE 
       eu% = 0
       drwaehr$ = " in allen WÑhrungen"
     END IF 
   END IF 
   
    IF RepType% = 0 THEN 
     i% = 0
     DIM Keyword$(50)
     IF GAFSK$ LIKE "TRUE" THEN 
       Keyword$(i%) = "Liste01 - AFSK - Provisionsliste"
       i% = i% + 1
     ELSE 
       Keyword$(i%) = "Liste01 - Kurzliste mit FÑlligkeit,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR)"
       i% = i% + 1
       Keyword$(i%) = "Liste02 - Kurzliste mit VS-Beginn,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR)"
       i% = i% + 1
       Keyword$(i%) = "Liste03 - Langliste mit VS-Beginn,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR)"
       i% = i% + 1
       Keyword$(i%) = "Liste04 - Langliste mit Vertrags-Bewertungssumme und dem Ausgabeaufschlag"
       i% = i% + 1
       Keyword$(i%) = "Liste05 - Langliste mit Kundeneinzahlungsbetrag(Fonds) oder Vertrags-Bewertungssumme und dem Ausgabeaufschlag"
       i% = i% + 1
       Keyword$(i%) = "Liste06 - Langliste mit Volumen pro Vertrag"
       i% = i% + 1
       Keyword$(i%) = "Liste07 - Provisionsliste nach Produkten sortiert und innerhalb nach Datum gruppiert"
       i% = i% + 1
       Keyword$(i%) = "Liste08 - Standardliste"
       i% = i% + 1
       Keyword$(i%) = "Liste09 - Langliste mit Kundeneinzahlungsbetrag(Fonds) oder Vertrags-Bewertungssumme und Einheiten"
       i% = i% + 1
       Keyword$(i%) = "Liste10 - Kurzliste mit VS-Beginn,(Bewertung aus Vertrag, Einheiten, Provision, SR)"
       i% = i% + 1
       Keyword$(i%) = "Liste11 - Provisionsliste nach Produkten sortiert"
       i% = i% + 1
       Keyword$(i%) = "Liste12 - Kurzliste mit FÑlligkeit,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR, Buchungstag-Text)"
       i% = i% + 1
         IF Gfsc% = - 1 THEN 
           Keyword$(i%) = "Liste13 - FS24-Standardliste"
           i% = i% + 1
         ELSE 
           Keyword$(i%) = "------------Liste13---nicht-belegt--------------------------------------------------------------------------------"
           i% = i% + 1
         END IF 
       Keyword$(i%) = "Liste14 - wie LISTE07 mit MWST, Netto, Brutto"
       i% = i% + 1
       Keyword$(i%) = "Liste15 - wie LISTE08 mit MWST, Netto, Brutto"
       i% = i% + 1
       Keyword$(i%) = "Liste16 - wie LISTE08 mit Zahlweise, ohne Betrag (ohne AbzÅge)"
       i% = i% + 1
       Keyword$(i%) = "Liste17 - wie LISTE11 ohne Einheiten, mit FÑlligkeit und ZW"
       i% = i% + 1
       Keyword$(i%) = "Liste18 - Provisionsliste nach Sparten sortiert, ohne Einheiten"
       i% = i% + 1
       Keyword$(i%) = "Liste19 - wie LISTE07 mit MWST, Netto, Brutto, VSV, ohne Einheiten"
       i% = i% + 1
       Keyword$(i%) = "Liste20 - wie LISTE02 mit Gesellschaften, ohne Einheiten"
       i% = i% + 1
       Keyword$(i%) = "Liste21 - Liste nach Produkt sortiert, ohne EH, ohne Buch.dat., mit VSV, MWST,BW, Beitrag und VS-Beginn"
       i% = i% + 1
       Keyword$(i%) = "Liste22 - wie LISTE17 ohne Kunden, mit FÑlligkeit und ZW"
       i% = i% + 1
     END IF 
     Keyword$(i%) = ""
     i% = i% + 1
     IF GAFSK$ LIKE "TRUE" THEN 
       req% = 1
     ELSE 
       CREATE DIALOG "KEYWORD",0,0,433,250,"Wahl der Listenart","MS Sans Serif",8
       ADD DIALOG "KEYWORD",4,0,1,433,226,0,""
       ADD DIALOG "KEYWORD",9,4,12,21,24,2
       ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie die Provisionslistenart aus:"
       ADD DIALOG "KEYWORD",7,31,31,388,190,2,2,Keyword$,Auswahl$,prompt$
       ADD DIALOG "KEYWORD",1,170,232,55,15,1,"&OK",1,1
       ADD DIALOG "KEYWORD",1,226,232,55,15,0,"&Abbrechen",0,0
       DIALOG "KEYWORD",req%
       REMOVE DIALOG "KEYWORD"
       IF req% = 0 THEN END SUB 
       reqli1% = 0
       reqli2% = 0
       reqli3% = 0
       reqli4% = 0
       reqli5% = 0
       reqli6% = 0
     END IF 
     IF req% = 1 THEN 
       IF GAFSK$ LIKE "TRUE" THEN 
         a$ = "LISTE01"
       ELSE 
         a$ = LEFT$ (Auswahl$(0),7)
       END IF 
       SELECT CASE UCASE$ (a$)
         CASE "LISTE21"
             CALL L9ERFT1(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982 
         CASE "LISTE20"
           reqli2% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTPRX1")
           ELSE 
             CALL LISTPRX1(vondat$,bisdat$,allprov$,0)
             GOTO EndDMLi1911982 
           END IF 
         CASE "LISTE19"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL L9STBVF3(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE18"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL LISTUF1(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE17"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL LIBVF3A(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE22"
           IF eu% = 0 THEN 
             REM GBVF$ = "TRUE"
           ELSE 
             CALL LIBVF3A1(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE16"
           IF eu% = 0 THEN 
             CALL PRep("LISTPRZB")
           ELSE 
             CALL LISTPZBE(vondat$,bisdat$,allprov$,"LISTPZE1")
             GOTO EndDMLi1911982 
           END IF 
 
         CASE "LISTE13"
           CALL FS24LI1(vondat$,bisdat$,allprov$,ma%)
           GOTO EndDMLi1911982 
         CASE "LISTE01"
           reqli1% = 1
           IF GAFSK$ LIKE "TRUE" THEN 
             CALL AFSKPLI1(vondat$,bisdat$,allprov$,ma%)
             GOTO EndDMLi1911982 
           ELSE 
             IF eu% = 0 THEN 
               CALL PRep("LISTPROY")
               CALL LISTPROYNeu(vondat$,bisdat$,allprov$,0)
               GOTO EndDMLi1911982
             ELSE 
               CALL LISTPRYENeu(vondat$,bisdat$,allprov$,ma%,"LISTPRYE")
               GOTO EndDMLi1911982 
             END IF 
           END IF 
         CASE "LISTE02"
           reqli2% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTPROX")
           ELSE 
             REM 221198
             CALL LISTPRYE(vondat$,bisdat$,allprov$,"LISTPRXE")
             GOTO EndDMLi1911982 
           END IF 
         CASE "LISTE03"
           reqli3% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTPROZ")
           ELSE 
             CALL LISTPZBE(vondat$,bisdat$,allprov$,"LISTPZBE")
             GOTO EndDMLi1911982 
           END IF 
         CASE "LISTE04"
           reqli4% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTMAUF")
           ELSE 
             CALL LISTPZBE(vondat$,bisdat$,allprov$,"LISTMAUE")
             GOTO EndDMLi1911982 
           END IF 
         CASE "LISTE05"
           reqli5% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTMAUS")
           ELSE 
             CALL LISTPZBE(vondat$,bisdat$,allprov$,"LISTMAUR")
             GOTO EndDMLi1911982 
           END IF 
         CASE "LISTE06"
           reqli6% = 1
           IF eu% = 0 THEN 
             CALL LISTPRZV(vondat$,bisdat$,allprov$)
             GOTO EndDMLi1911982
           ELSE 
             CALL LISTPRZX(vondat$,bisdat$,allprov$,0,"LISTPRZX")
             REM CALL Fehler("Diese Liste ist zur Zeit noch nicht implementiert","")
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE14"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL L9STBVF2(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE07"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL LISTBVF2(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE15"
             CALL L9STPZBE(vondat$,bisdat$,allprov$,"L9STPZE")
             GOTO EndDMLi1911982 
         CASE "LISTE08"
           IF eu% = 0 THEN 
             CALL PRep("LISTPRZB")
           ELSE 
             CALL LISTPZBE(vondat$,bisdat$,allprov$,"LISTPZE")
             GOTO EndDMLi1911982 
           END IF 
         CASE "LISTE09"
           reqli5% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTMAUT")
           ELSE 
             CALL LISTPZBE(vondat$,bisdat$,allprov$,"LISTMAUR")
             GOTO EndDMLi1911982 
           END IF 
         CASE "LISTE10"
           reqli2% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTPROX")
           ELSE 
             REM 221198
             CALL LISTPRYE(vondat$,bisdat$,allprov$,"LIS1PRXE")
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE11"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL LISTBVF3(euro%,0,vondat$,bisdat$)
             GOTO EndDMLi1911982
           END IF 
         CASE "LISTE12"
           reqli1% = 1
           IF GAFSK$ LIKE "TRUE" THEN 
             CALL AFSKPLI1(vondat$,bisdat$,allprov$,ma%)
             GOTO EndDMLi1911982 
           ELSE 
             IF eu% = 0 THEN 
               CALL PRep("LISTPROY")
               CALL LISTPROYNeu(vondat$,bisdat$,allprov$,0)
               GOTO EndDMLi1911982
             ELSE 
               CALL LISTPRYENeu(vondat$,bisdat$,allprov$,ma%,"LPRYEBDE")
               GOTO EndDMLi1911982 
             END IF 
           END IF 
         CASE ELSE 
           IF eu% = 0 THEN 
             CALL PRep("LISTPRZB")
           ELSE 
             CALL LISTPZBE(vondat$,bisdat$,allprov$,"LISTPZE")
             GOTO EndDMLi1911982 
           END IF 
 
           reqli1% = 0
           reqli2% = 0
           reqli3% = 0
           reqli4% = 0
           reqli5% = 0
           reqli6% = 0
       END SELECT 
     END IF 
     IF GBVF$ = "TRUE" THEN GOTO ProvisionslisteBVF
     
     REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     REM andi 2.11.95
     REM Header$ = "KontoÅbersicht " + nachname.maadr
     Header$ = "Provisionsabrechnung in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP QNameCodema.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
     BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
  
 
     GROUP Datum.BUCHUNG1
     BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
 
   ELSE 
     REM reptype = 1 -> Listen mit Volumen
     CALL PRep("LIPRO2")
     REPORT ON Volumen.buchung1 AS "SSumVol%",Betrag.buchung1 AS "SSumAgentur%",SR.buchung1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
     GROUP CodeMA.MAADR,Betrag.buchung1 AS "SumAgentur%",SR.buchung1 AS "SumStorno%",Volumen.buchung1 AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
     BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
     GROUP Datum.buchung1
     BEFORE GROUP Datum.buchung1
     SET REPORT PAGE "H_Datum.BUCH003"
     OUTPUT REPORT PAGE 
     END GROUP 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
   END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrPROV2208
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT QNameCodema.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT QNameCodema.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   END IF 
ErrPROV2208: 
   ON ERROR GOTO ErrorHandler
 END IF 
 GOTO EndDMLi1911982
ProvisionslisteBVF: 
 IF GBVF$ = "TRUE" THEN 
   REM ProvisionslisteBVF
   CALL LISTBVF1(euro%,0,vondat$,bisdat$)
 END IF 
EndDMLi1911982: 
 MOUSE ON 
 END SUB 
  
 
 
SUB UEBERSAG1Z()
 IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF RECCOUNT ("Buchung1") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 REM SET MENU OFF 
 IF _help% = 1 THEN CALL DemoInfo(9)
 ma% = GetCodeMA%(cuma%,Workstation%)

 IF ma% <> 0 THEN 
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name$ = vorname.maadr + " " + nachname.maadr
   FILE "buchung1"
   allProv$ = "n"
   bis$ = TODAY 
   CREATE DIALOG "Konto1",0,0,221,145,title$,"MS Sans Serif",8
   ADD DIALOG "Konto1",9,6,7,24,22,2
   ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
   ADD DIALOG "Konto1",4,34,14,176,5,0,""
   ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
   ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
   ADD DIALOG "Konto1",5,34,80,13,8,0,"vom"
   ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
   ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
   ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
   REM ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
   REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
   IF GAFSK$ LIKE "TRUE" THEN 
   ELSE 
     ADD DIALOG "Konto1",2,10,100,194,11,0,"nur BuchungssÑtze einer vertragsabschlie·enen Agentur","j","n",incAg$
   END IF 
   ADD DIALOG "Konto1",1,50,124,55,15,1,"&Weiter",1,1
   ADD DIALOG "Konto1",1,110,124,55,15,0,"&Abbruch",0,0
   DIALOG "Konto1",req%
   REMOVE DIALOG "Konto1"
 
     IF req% <> 1 THEN GOTO ErrUEBER2208
     Gdruvonma% = 0
     IF incAg$ = "j" THEN 
       a$ = "Sie erhalten jetzt die Mîglichkeit, diejenige vertragsabschlie·ende Agentur auszuwÑhlen von der Sie die BuchungssÑtze fÅr " + name$
       CALL Fehler(a$,"angezeigt bekommen wollen, um festzustellen, was " + name$ + " an der vertragsabschlie·enden Agentur verdient hat.")
       ma1% = GetCodeMA%(cuma%,Workstation%)
       IF ma1% <> 0 THEN 
         Gdruvonma% = ma1%
         SELECT FIRST FILE "maadr" INDEX codema.maadr
         SELECT KEY ma1% FILE "maadr" INDEX codema.maadr
         name1$ = vorname.maadr + " " + nachname.maadr
         REM CALL Fehler("Provisionsliste ","")
       ELSE 
         Gdruvonma% = 0
       END IF 
     END IF 
     DIRECTORY _ppath$
     IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
     IF bis$ = "" THEN bisdat$ = "31.12.2199" ELSE bisdat$ = bis$
     IF eurosupport$ = "TRUE" THEN 
       t1$ = "Wenn Sie in unterschiedlichen WÑhrungen erfa·t haben, sollten Sie die öbersicht in EURO ausgeben lassen,"
       t2$ = "da bei der Ausgabe der Belege in der OriginalwÑhrung zwar die einzelnen BetrÑge stimmen, aber keine der errechnten Summen richtig sein wird(z.B. DM+US$=?)!"
       IF GAFSK$ LIKE "TRUE" OR DruInEur.stamm = 1 THEN 
         req1% = 1
       ELSE 
         CALL Fehler(t1$,t2$)
         REQUEST "öbersicht in EURO drucken?","",130,req1%
       END IF 
       IF req1% = 1 THEN 
         eu% = 1
         drwaehr$ = " in Euro"
       ELSE 
         eu% = 0
         drwaehr$ = " in allen WÑhrungen"
       END IF 
     END IF 
 
  IF RepType% = 0 THEN 
     i% = 0
     DIM Keyword$(50)
     IF GAFSK$ LIKE "TRUE" THEN 
       Keyword$(i%) = "Liste01 - AFSK - Provisionsliste"
       i% = i% + 1
     ELSE 
       IF GBVF$ = "TRUE" THEN 
         IF workstation% <> 0 THEN 
           Keyword$(i%) = "Liste07 - Mitarbeiterprovisionsliste BVF"
           i% = i% + 1
           Keyword$(i%) = "Liste13 - Mitarbeiterprovisionsliste BVF mit MWST,Netto,Brutto"
           i% = i% + 1
         ELSE 
           IF Gdruvonma% = 0 THEN 
             Keyword$(i%) = "Liste01 - Kurzliste mit FÑlligkeit,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR"
             i% = i% + 1
             Keyword$(i%) = "Liste02 - Kurzliste mit VS-Beginn,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR"
             i% = i% + 1
             Keyword$(i%) = "Liste03 - Langliste mit VS-Beginn,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR"
             i% = i% + 1
             Keyword$(i%) = "Liste04 - Langliste mit Vertrags-Bewertungssumme und dem Ausgabeaufschlag"
             i% = i% + 1
             Keyword$(i%) = "Liste05 - Langliste mit Kundeneinzahlungsbetrag(Fonds) oder Vertrags-Bewertungssumme und dem Ausgabeaufschlag"
             i% = i% + 1
             Keyword$(i%) = "Liste06 - Langliste mit Volumen pro Vertrag"
             i% = i% + 1
             Keyword$(i%) = "Liste07 - Provisionsliste nach Produkten sortiert und nach Datum gruppiert"
             i% = i% + 1
             Keyword$(i%) = "Liste08 - Standardliste"
             i% = i% + 1
             Keyword$(i%) = "Liste09 - Kurzliste mit VS-Beginn,(Bewertung aus Vertrag, Einheiten, Provision, SR"
             i% = i% + 1
             Keyword$(i%) = "Liste10 - Provisionsliste nach Produkten sortiert"
             i% = i% + 1
             Keyword$(i%) = "Liste11 - Kurzliste mit FÑlligkeit,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR, Buchungsdatum-Text"
             i% = i% + 1
             Keyword$(i%) = "Liste13 - wie Liste07 mit MwSt, Netto, Brutto"
             i% = i% + 1
             Keyword$(i%) = "Liste14 - wie Liste08 mit MwSt, Netto, Brutto"
             i% = i% + 1
           ELSE 
             Keyword$(i%) = "Liste08 - Standardliste"
             i% = i% + 1
             Keyword$(i%) = "Liste14 - wie Liste08 mit MwSt, Netto, Brutto"
             i% = i% + 1
           END IF 
         END IF 
       ELSE 
         IF Gdruvonma% = 0 THEN 
           Keyword$(i%) = "Liste01 - Kurzliste mit FÑlligkeit,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR"
           i% = i% + 1
           Keyword$(i%) = "Liste02 - Kurzliste mit VS-Beginn,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR"
           i% = i% + 1
           Keyword$(i%) = "Liste03 - Langliste mit VS-Beginn,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR"
           i% = i% + 1
           Keyword$(i%) = "Liste04 - Langliste mit Vertrags-Bewertungssumme und dem Ausgabeaufschlag"
           i% = i% + 1
           Keyword$(i%) = "Liste05 - Langliste mit Kundeneinzahlungsbetrag(Fonds) oder Vertrags-Bewertungssumme und dem Ausgabeaufschlag"
           i% = i% + 1
           Keyword$(i%) = "Liste06 - Langliste mit Volumen pro Vertrag"
           i% = i% + 1
           Keyword$(i%) = "Liste07 - Provisionsliste nach Produkten sortiert und nach Datum gruppiert"
           i% = i% + 1
           Keyword$(i%) = "Liste08 - Standardliste"
           i% = i% + 1
           Keyword$(i%) = "Liste09 - Kurzliste mit VS-Beginn,(Bewertung aus Vertrag, Einheiten, Provision, SR"
           i% = i% + 1
           Keyword$(i%) = "Liste10 - Provisionsliste nach Produkten sortiert"
           i% = i% + 1
           Keyword$(i%) = "Liste11 - Kurzliste mit FÑlligkeit,(Bewertung aus Zahlungseingang, Einheiten, Provision, SR, Buchungsdatum-Text"
           i% = i% + 1
           IF Gfsc% = - 1 THEN 
             Keyword$(i%) = "Liste12 - FS24-Standardliste"
             i% = i% + 1
           ELSE 
             Keyword$(i%) = "----Liste12--------nicht-belegt----------------------------------------------------------------------------------------------------------"
             i% = i% + 1
           END IF 
           Keyword$(i%) = "Liste13 - wie Liste07 mit MwSt, Netto, Brutto"
           i% = i% + 1
           Keyword$(i%) = "Liste14 - wie Liste08 mit MwSt, Netto, Brutto"
           i% = i% + 1
           Keyword$(i%) = "Liste15 - wie Liste08 mit Zahlweise, ohne Betrag (ohne AbzÅge)"
           i% = i% + 1
           Keyword$(i%) = "Liste16 - wie Liste10 ohne Einheiten, mit FÑlligkeit und ZW"
           i% = i% + 1
           Keyword$(i%) = "Liste17 - Provisionsliste nach Sparten sortiert, ohne Einheiten"
           i% = i% + 1
           Keyword$(i%) = "Liste18 - wie Liste13 mit MwSt, Netto, Brutto, VSV, ohne Einheiten"
           i% = i% + 1
           Keyword$(i%) = "Liste19 - wie LISTE02 mit Gesellschaften, ohne Einheiten"
           i% = i% + 1
           Keyword$(i%) = "Liste20 - Liste nach Produkt sortiert, ohne EH, ohne Buch.dat., mit VSV, MWST,BW, Beitrag und VS-Beginn"
           i% = i% + 1
           Keyword$(i%) = "Liste21 - wie Liste 8 aber ohne Kundendaten"
           i% = i% + 1
           Keyword$(i%) = "Liste22 - wie Liste16 ohne Kunden, mit FÑlligkeit und ZW"
           i% = i% + 1
         ELSE 
           Keyword$(i%) = "Liste08 - Standardliste"
           i% = i% + 1
           Keyword$(i%) = "Liste14 - wie Liste08 mit MwSt, Netto, Brutto, Beitrag und VS-Beginn"
           i% = i% + 1
         END IF 
       END IF 
     END IF 
     Keyword$(i%) = ""
     i% = i% + 1
     IF GAFSK$ LIKE "TRUE" THEN 
       req% = 1
     ELSE 
       DIM Lisaus$(1)

        
       CREATE DIALOG "KEYWORD",0,0,433,230,"Wahl der Listenart","MS Sans Serif",8
       ADD DIALOG "KEYWORD",4,0,1,433,209,0,""
       ADD DIALOG "KEYWORD",9,4,12,21,24,2
       ADD DIALOG "KEYWORD",5,31,14,189,19,0,"Bitte wÑhlen Sie die Provisionslistenart aus:"
       ADD DIALOG "KEYWORD",7,31,30,388,176,2,2,Keyword$,Lisaus$,prompt$
       ADD DIALOG "KEYWORD",1,57,212,55,15,1,"&OK",1,1
       ADD DIALOG "KEYWORD",1,113,212,55,15,0,"&Abbrechen",0,0
       DIALOG "KEYWORD",req%
       REMOVE DIALOG "KEYWORD"
       IF req% = 0 THEN END SUB 
     END IF 
     reqli1% = 0
     reqli2% = 0
     reqli3% = 0
     reqli4% = 0
     reqli5% = 0
     reqli6% = 0
     IF req% = 1 THEN 
       IF GAFSK$ LIKE "TRUE" THEN 
         a$ = "LISTE01"
       ELSE 
         a$ = LEFT$ (Lisaus$(0),7)
       END IF 
       SELECT CASE UCASE$ (a$)
         CASE "LISTE22"
           IF eu% = 0 THEN 
             REM GBVF$ = "TRUE"
           ELSE 
             CALL LIBVF3A1(euro%,ma%,vondat$,bisdat$)
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE20"
           CALL L9ERFT1(euro%,ma%,vondat$,bisdat$)
           GOTO EndAgKi1811983

         CASE "LISTE19"
           CALL LISTPRX1(vondat$,bisdat$,allprov$,ma%)
           GOTO EndAgKi1811983
         CASE "LISTE18"
           CALL L9STBVF3(euro%,ma%,vondat$,bisdat$)
           GOTO EndAgKi1811983 
         CASE "LISTE17"
           CALL LISTUF1(euro%,ma%,vondat$,bisdat$)
           GOTO EndAgKi1811983
         CASE "LISTE12"
           CALL FS24LI1(vondat$,bisdat$,allprov$,ma%)
           GOTO EndDMLi1911982 
         CASE "LISTE01"
           reqli1% = 1
           IF GAFSK$ LIKE "TRUE" THEN 
             CALL AFSKPLI1(vondat$,bisdat$,allprov$,ma%)
             GOTO EndAgKi1811983
           ELSE 
             IF eu% = 0 THEN 
               CALL PRep("LISTPROY")
               CALL LISTPROYNeu(vondat$,bisdat$,allprov$,ma%)
               GOTO EndAgKi1811983
             ELSE 
               CALL LISTPRYENeu(von$,bis$,allProv$,ma%,"LISTPRYE")
               GOTO EndAgKi1811983
             END IF 
           END IF 
         CASE "LISTE02"
           reqli2% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTPROX")
           ELSE 
             REM 221198
             CALL LISTPRYE1(von$,bis$,allProv$,ma%,"LISTPRXE")
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE03"
           reqli3% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTPROZ")
           ELSE 
             CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZBE")
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE04"
           reqli4% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTMAUF")
           ELSE 
             CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTMAUE")
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE05"
           reqli5% = 1
           IF eu% = 0 THEN 
             CALL PRep("LISTMAUS")
           ELSE 
             CALL LISTPZBE1(vondat$,bisdat$,allprov$,ma%,"LISTMAUR")
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE06"
           reqli6% = 1
           IF eu% = 0 THEN 
             CALL LISTPRZV(vondat$,bisdat$,allprov$)
             GOTO EndAgKi1811983
           ELSE 
             CALL LISTPRZX(vondat$,bisdat$,allprov$,ma%,"LISTPRZX")
             REM CALL Fehler("Diese Liste ist zur Zeit noch nicht implementiert","")
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE13"
             CALL L9STBVF2(euro%,ma%,vondat$,bisdat$)
             GOTO EndAgKi1811983
         CASE "LISTE07"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL LISTBVF2(euro%,ma%,vondat$,bisdat$)
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE14"
             CALL L9STPZBE1(von$,bis$,allProv$,ma%,"L9STPZE")
             GOTO EndAgKi1811983
         CASE "LISTE08"
         IF gfsc% = - 1 THEN 
           IF eu% = 0 THEN 
             CALL PRep("LISTPRZB")
           ELSE 
             i% = 1
             GdruckAG% = 0
             GPdf% = 0
             ok% = - 1
             WHILE Auswahl$(i%) > "" AND ok% = - 1
               IF Auswahl$(i%) > "" THEN 
                 i% = i% + 1
                 GdruckAG% = 1
                 ok% = 0
               END IF 
             WEND 
             REM Ausgabe fÅr mehrere Agenturen
             i% = 0
             GDruckPr% = 0
             REQUEST "Soll die Ausgabe gleich auf Ihren PDF-Drucker erfolgen?","",130,GDruckPr%
             IF GDruckPr% THEN 
               SET PRINTER 
             END IF 
             REQUEST "Geben Sie nach PDF aus?","",130,GPdf%
             IF GPdf% = 1 THEN 
               CREATE DIALOG "LOGIN",0,0,193,79,"Eingabe","MS Sans Serif",8
               ADD DIALOG "LOGIN",4,0,0,193,58,0,""
               ADD DIALOG "LOGIN",9,5,11,20,22,2
               ADD DIALOG "LOGIN",5,33,11,139,9,0,"Bitte geben Sie den"
               ADD DIALOG "LOGIN",5,33,20,88,10,0,"Abrechnungstag ein ddmm."
               ADD DIALOG "LOGIN",5,33,31,42,12,0,"&Tag+Monat:"
               ADD DIALOG "LOGIN",6,33,43,39,11,20,0,datno$,4
               ADD DIALOG "LOGIN",1,38,61,50,15,1,"&OK",1,1
               ADD DIALOG "LOGIN",1,89,61,50,15,0,"&Abbruch",0,0
               DIALOG "LOGIN",reqno%
               REMOVE DIALOG ALL 
             END IF 
             IF GDruckPr% = 1 THEN 
               dpfad$ = _netpath$ + "0-Export\ProvAbr\" + DATE$ ( TODAY ,"yymm0d")
               datnr$ = DATE$ ( TODAY ,"yymm0d")
               i% = 0
               ok% = 0
               WHILE ok% = 0
                 i% = i% + 1
                 IF i% > 99 THEN 
                   ON ERROR GOTO karb2306042
                   REMOVE DIRECTORY dpfad$ + "01"
karb2306042: 
                   i% = 1
                 END IF 
                 ON ERROR GOTO karb2306041
                 tpfad$ = dpfad$ + STR$ (i%,"00")
                 MAKE DIRECTORY dpfad$ + STR$ (i%,"00")
                 dpfad$ = dpfad$ + STR$ (i%,"00")
                 ok% = - 1
karb2306041: 
                 ON ERROR GOTO ErrorHandler
               WEND 
 
               textdo1$ = tpfad$
               CALL Fehler("Wechseln Sie per Hand in dem ersten Speicherdialog in das Verzeichnis: ",tpfad$)
               DIRECTORY tpfad$
             END IF 
             ok1% = - 1
             i% = 0
             WHILE Auswahl$(i%) > "" AND ok1% = - 1
               req% = 0
               REQUEST "Ausgabe fortsetzen?","",130,req%
               IF req% = 1 THEN 
                 ok2% = - 1
                 WHILE ok2% = - 1
                   GDruckName$ = ""
                   REM fn
                   ma% = VAL ( RIGHT$ (Auswahl$(i%),6))
                   IF EXISTS (ma%,codema.buchung1) THEN 
                     SELECT FIRST FILE "maadr" INDEX codema.maadr
                     SELECT KEY ma% FILE "maadr" INDEX codema.maadr
                     GDruckName$ = Agenturnr.maadr + "_" + nachname.maadr
                     IF LTRIM$ (datno$) <> "" THEN 
                       GDruckName$ = GDruckName$ + "_" + datno$ + "_PROVIS"
                     END IF 
                     DruckName$ = VSNRPackFS$(GDruckName$)
                     GDruckName$ = DruckName$
                     COPY FROM GDruckName$
                     CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZE")
                     ok2% = 0
                   END IF 
                   IF Auswahl$(i%) <> "" THEN 
                     i% = i% + 1
                   ELSE 
                     ok2% = 0
                   END IF 
                 WEND 
               ELSE 
                 ok1% = 0
               END IF 
             WEND 
             GOTO EndAgKi1811983
           END IF 
         ELSE 

           IF eu% = 0 THEN 
             CALL PRep("LIS1PROX")
           ELSE 
             REM 221198
             CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZE")
             GOTO EndAgKi1811983
           END IF 
         END IF 
         CASE "LISTE21"
             CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZE2")
             GOTO EndAgKi1811983 
         CASE "LISTE09"
           reqli2% = 1
           IF eu% = 0 THEN 
             CALL PRep("LIS1PROX")
           ELSE 
             REM 221198
             CALL LISTPRYE1(von$,bis$,allProv$,ma%,"LIS1PRXE")
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE10"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL LISTBVF3(euro%,ma%,vondat$,bisdat$)
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE16"
           IF eu% = 0 THEN 
             GBVF$ = "TRUE"
           ELSE 
             CALL LIBVF3A(euro%,ma%,vondat$,bisdat$)
             GOTO EndAgKi1811983
           END IF 
         CASE "LISTE11"
           reqli1% = 1
           IF GAFSK$ LIKE "TRUE" THEN 
             CALL AFSKPLI1(vondat$,bisdat$,allprov$,ma%)
             GOTO EndAgKi1811983
           ELSE 
             IF eu% = 0 THEN 
               CALL PRep("LISTPROY")
               CALL LISTPROYNeu(vondat$,bisdat$,allprov$,ma%)
               GOTO EndAgKi1811983
             ELSE 
               CALL LISTPRYENeu(von$,bis$,allProv$,ma%,"LPRYEBDE")
               GOTO EndAgKi1811983
             END IF 
           END IF 
         CASE "LISTE15"
           reqli2% = 1
           IF eu% = 0 THEN 
             CALL Fehler("Diese Liste kann nur in EURO gedruckt werden!","")
           ELSE 
             REM 221198
             CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZE1")
             GOTO EndAgKi1811983
           END IF 
         CASE ELSE 
           IF eu% = 0 THEN 
             CALL PRep("LISTPRZB")
           ELSE 
             CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZE")
             GOTO EndAgKi1811983
           END IF 
 
           reqli1% = 0
           reqli2% = 0
           reqli3% = 0
           reqli4% = 0
           reqli5% = 0
           reqli6% = 0
       END SELECT 
     END IF 
     IF GBVF$ = "TRUE" THEN GOTO ProvisionslistABVF 
     GOTO weeeeiiiittterr
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
       REQUEST "Soll die Kurzliste mit FÑlligkeit ausgegeben werden?","",130,reqli2%
       IF reqli2% = 1 THEN 
         IF eu% = 0 THEN 
           CALL PRep("LISTPROY")
         ELSE 
           CALL LISTPRYE1(von$,bis$,allProv$,ma%,"LISTPRYE")
           GOTO EndAgKi1811983
         END IF 
       ELSE 
         REQUEST "Soll die Kurzliste mit VS-Beginn ausgegeben werden?","",130,reqli1%
         IF reqli1% = 1 THEN 
           IF eu% = 0 THEN 
             CALL PRep("LISTPROX")
           ELSE 
             CALL LISTPRYE1(von$,bis$,allProv$,ma%,"LISTPRXE")
             GOTO EndAgKi1811983
           END IF 
         ELSE 
           REQUEST "Soll die Bewertungssumme pro Vertrag mit ausgegeben werden?","",130,reqli%
           IF reqli% = 1 THEN 
             IF eu% = 0 THEN 
               CALL PRep("LISTPROZ")
             ELSE 
               CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZBE")
               GOTO EndAgKi1811983
             END IF 
           ELSE 
            REQUEST "Soll die Bewertungssumme und der Ausgabeaufschlag mit ausgegeben werden?","",130,reqli%
            IF reqli% = 1 THEN 
              IF eu% = 0 THEN 
                CALL PRep("LISTMAUF")
              ELSE 
                CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTMAUE")
                GOTO EndAgKi1811983
              END IF 
             ELSE 
             REQUEST "Soll das Volumen pro Vertrag mit ausgegeben werden?","",130,reqli%
             IF reqli% = 1 THEN 
               IF eu% = 0 THEN 
                 CALL LISTPRZV1(von$,bis$,allprov$,ma%)
                 GOTO EndAgKi1811983
               ELSE 
                 REM CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZE")
                 CALL Fehler("Diese Liste ist zur Zeit nicht implementiert!,"")
                 GOTO EndAgKi1811983
               END IF 
             ELSE 
               IF eu% = 0 THEN 
                 CALL PRep("LISTPRZB")
               ELSE 
                 CALL LISTPZBE1(von$,bis$,allProv$,ma%,"LISTPZE")
                 GOTO EndAgKi1811983
               END IF 
             END IF 
            END IF 
           END IF 
         END IF 
       END IF 
 
weeeeiiiittterr: 
 
     REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
     AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
     END REPORT 
     REM andi 2.11.95
     REM Header$ = "KontoÅbersicht " + nachname.maadr
     Header$ = "Provisionsabrechnung " + "in " + Waehrung.stamm
     IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
     IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
     IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
     IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP QNameCodema.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
     BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
 
     GROUP Datum.BUCHUNG1
     BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
  ELSE 
       CALL PRep("LISTPRO2")
       REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
         SET REPORT PAGE "F_REPORT"
         OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
         SET REPORT PAGE "H_PAGE"
         OUTPUT REPORT PAGE 
       END HEADING 
       GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.MAADR
         SET REPORT PAGE "H_CodeMA.MAA002"
         OUTPUT REPORT PAGE 
       END GROUP 
       AFTER GROUP CodeMA.MAADR
        SET REPORT PAGE "F_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
        EJECT REPORT 
       END GROUP 
       GROUP Datum.BUCHUNG
         BEFORE GROUP Datum.BUCHUNG
         SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
         SET REPORT PAGE "F_SELECT"
         OUTPUT REPORT PAGE 
       END SELECT 
     END IF 
     SET QUERY OFF 
     SET QUERY LOCK OFF 
     vondat% = DAYS (vondat$)
     bisdat% = DAYS (bisdat$)
     MOUSE OFF 
     ON ERROR GOTO ErrUEBER2208
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$)
         ORDER REPORT Datum.buchung1,Kunde$
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (vondat$) AND Datum.buchung1 <= DAYS (bisdat$) AND mahnung.buchung1 <> "j"
         ORDER REPORT Datum.buchung1,Kunde$
         TO ASK 
     END IF 
 END IF 
 GOTO EndAgKi1811983
ProvisionslistABVF: 
 IF GBVF$ = "TRUE" THEN 
   REM BVF Provisionsliste aufrufen
   CALL LISTBVF1(euro%,ma%,vondat$,bisdat$)
 END IF 
EndAgKi1811983: 
ErrUEBER2208: 
    ON ERROR GOTO ErrorHandler
 
 MOUSE ON 
 END SUB 
 
SUB UEBERSAG2Z()
 IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF RECCOUNT ("Buchung1") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 REM ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 
 IF req% = 1 THEN 
   DIRECTORY _ppath$
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
     IF RepType% = 0 THEN 
 
       REQUEST "Soll die Bewertungssumme pro Vertrag mit ausgegeben werden?","",130,reqli%
       IF reqli% = 1 THEN 
         CALL PRep("LISTPROZ")
       ELSE 
         CALL PRep("LISTPRZB")
       END IF 
       REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP CodeMA.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
     BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
 
     GROUP Datum.BUCHUNG1
     BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
 
 
     ELSE 
       CALL PRep("LISTPRO2")
       REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
         SET REPORT PAGE "F_REPORT"
         OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
         SET REPORT PAGE "H_PAGE"
         OUTPUT REPORT PAGE 
       END HEADING 
       GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.MAADR
         SET REPORT PAGE "H_CodeMA.MAA002"
         OUTPUT REPORT PAGE 
       END GROUP 
       AFTER GROUP CodeMA.MAADR
        SET REPORT PAGE "F_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
        EJECT REPORT 
       END GROUP 
       GROUP Datum.BUCHUNG
         BEFORE GROUP Datum.BUCHUNG
         SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
         SET REPORT PAGE "F_SELECT"
         OUTPUT REPORT PAGE 
       END SELECT 
     END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   MOUSE OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrUEBER2308
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
   END IF 
ErrUEBER2308: 
   ON ERROR GOTO ErrorHandler 
 END IF 
 MOUSE ON 
 END SUB 
 
 
SUB VLIST3Z(eu%)
  IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF RECCOUNT ("Buchung1") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 ku% = CodeKU.GAdrDat$
 allProv$ = "j"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 REM ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 cfile$ = FILE 
 IF req% = 1 THEN 
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
     IF RepType% = 0 THEN 
       
       dir1$ = DIRECTORY 
       DIRECTORY _ppath$
       CALL PRep("LISTPROZ")
       REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP QNameCodema.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
     BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
 
     GROUP Datum.BUCHUNG1
     BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
     END GROUP 
 
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
 
 
     ELSE 
       CALL PRep("LISTPRO2")
       REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
         SET REPORT PAGE "F_REPORT"
         OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
         SET REPORT PAGE "H_PAGE"
         OUTPUT REPORT PAGE 
       END HEADING 
       GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.MAADR
         SET REPORT PAGE "H_CodeMA.MAA002"
         OUTPUT REPORT PAGE 
       END GROUP 
       AFTER GROUP CodeMA.MAADR
        SET REPORT PAGE "F_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
        EJECT REPORT 
       END GROUP 
       GROUP Datum.BUCHUNG
         BEFORE GROUP Datum.BUCHUNG
         SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
         SET REPORT PAGE "F_SELECT"
         OUTPUT REPORT PAGE 
       END SELECT 
     END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   MOUSE OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrUEBER2408
   IF gasp% AND workstation% <> 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND codeku.buchung1 = ku%
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND mahnung.buchung1 <> "j" AND codeku.buchung1 = ku%
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
     END IF 
   ELSE 
     IF allProv$ = "j" THEN 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND codeku.buchung1 = ku%
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND mahnung.buchung1 <> "j" AND codeku.buchung1 = ku%
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
     END IF 
   END IF 
ErrUEBER2408: 
   ON ERROR GOTO ErrorHandler 
 END IF 
 MOUSE ON 
 FILE cfile$
 END SUB 
 
 
SUB VLIST3az(codevt%,eu%)
  IF disabled%("KONTOUEBERSICHT") THEN END SUB 
 CALL DFile(3,"buchung1" + _fpw$)
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 IF RECCOUNT ("Buchung1") = 0 THEN 
  CALL Fehler("In der Buchungsdatei sind noch keine Eintragungen vorhanden! PrÅfen Sie, ob Sie VertrÑge zur Abrechnung freigegeben haben!","WÑhlen Sie Korrekturbuchung und berechnen Sie die Provisionen. Danach kînnen Sie erneut die Ausgabe starten!")
 END IF 
 ku% = CodeKU.GAdrDat$
 allProv$ = "n"
 CREATE DIALOG "Konto1",0,0,221,165,title$,"MS Sans Serif",8
 ADD DIALOG "Konto1",9,6,7,24,22,2
 ADD DIALOG "Konto1",5,34,8,170,9,0,"Provisionsliste:"
 ADD DIALOG "Konto1",4,34,14,176,5,0,""
 ADD DIALOG "Konto1",5,34,22,175,16,0,"Bitte geben Sie ein, fÅr welchen Buchungszeitraum Sie eine öbersicht wÅnschen."
 ADD DIALOG "Konto1",5,34,40,175,32,0,"Wenn Sie keine Angaben zum Buchungszeitraum eintragen, werden alle Provisionen bzw. die Provisionen des vorgegebenen Zeitraumes aufgelistet."
 ADD DIALOG "Konto1",5,34,80,12,8,0,"von"
 ADD DIALOG "Konto1",6,53,79,45,11,0,0,von$,10
 ADD DIALOG "Konto1",5,102,80,12,8,0,"bis"
 ADD DIALOG "Konto1",6,116,79,45,11,0,0,bis$,10
 REM ADD DIALOG "Konto1",2,34,97,148,11,0,"alle berechneten Provisionen einbeziehen","j","n",allProv$
 REM ADD DIALOG "Konto1",5,44,108,167,25,0,"(es werden auch die Provisionen angezeigt, die wegen fehlender ZahlungsbeitrÑge in der Mahnlist sind)"
 ADD DIALOG "Konto1",1,50,144,55,15,1,"&Weiter",1,1
 ADD DIALOG "Konto1",1,110,144,55,15,0,"&Abbruch",0,0
 DIALOG "Konto1",req%
 REMOVE DIALOG "Konto1"
 cfile$ = FILE 
 IF req% = 1 THEN 
   MOUSE OFF 
   IF von$ = "" THEN vondat$ = "01.01.1980" ELSE vondat$ = von$
   IF bis$ = "" THEN bisdat$ = DATE$ ( TODAY ) ELSE bisdat$ = bis$
     IF RepType% = 0 THEN 
       
       dir1$ = DIRECTORY 
       DIRECTORY _ppath$
       CALL PRep("LISTPROZ")
       REPORT ON Betrag.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
       SET REPORT PAGE "F_REPORT"
       OUTPUT REPORT PAGE 
       END REPORT 
       IF eu% = 0 THEN 
         Header$ = "KontoÅbersicht " + " in allen WÑhrungen"
       ELSE 
         Header$ = "KontoÅbersicht " + " in Euro"
       END IF 
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
     HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
     END HEADING 
 
     GROUP QNameCodema.MAADR,Betrag.BUCHUNG1 AS "SumAgentur%",SR.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
     BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
     END GROUP 
 
     AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
     END GROUP 
 
     GROUP Datum.BUCHUNG1
     BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
     END GROUP 
  
 
     AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
     END SELECT 
 
 
     ELSE 
       CALL PRep("LISTPRO2")
       REPORT ON Volumen.BUCHUNG AS "SSumVol%",Betrag.BUCHUNG AS "SSumAgentur%",SR.BUCHUNG AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
         SET REPORT PAGE "F_REPORT"
         OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "KontoÅbersicht " + nachname.maadr + " in " + Waehrung.stamm
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       HEADING 
         SET REPORT PAGE "H_PAGE"
         OUTPUT REPORT PAGE 
       END HEADING 
       GROUP CodeMA.MAADR,Betrag.BUCHUNG AS "SumAgentur%",SR.BUCHUNG AS "SumStorno%",Volumen.BUCHUNG AS "SumVol%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
       BEFORE GROUP CodeMA.MAADR
         SET REPORT PAGE "H_CodeMA.MAA002"
         OUTPUT REPORT PAGE 
       END GROUP 
       AFTER GROUP CodeMA.MAADR
        SET REPORT PAGE "F_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
        EJECT REPORT 
       END GROUP 
       GROUP Datum.BUCHUNG
         BEFORE GROUP Datum.BUCHUNG
         SET REPORT PAGE "H_Datum.BUCH003"
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
         SET REPORT PAGE "F_SELECT"
         OUTPUT REPORT PAGE 
       END SELECT 
     END IF 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   MOUSE OFF 
   vondat% = DAYS (vondat$)
   bisdat% = DAYS (bisdat$)
   ON ERROR GOTO ErrUEBER2408
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND codevt.buchung1 = codevt%
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND mahnung.buchung1 <> "j" AND codevt.buchung1 = codevt%
       ORDER REPORT Nachname.MAADR,Nachname.buchung1
       TO ASK 
   END IF 
ErrUEBER2408: 
   ON ERROR GOTO ErrorHandler 
 END IF 
 MOUSE ON 
 FILE cfile$
 END SUB 
 
 ' Umschaltung Provisionierungsverfahren
 
SUB PROVVERFA()
 IF disabled%("PROVISVERFAHREN") THEN END SUB 
  REM **** Monatsabschlu· testen *****
 
 REM **** Monatsabschlu· testen *****  
 IF prv$ LIKE "STANDARD" THEN 
   PrvVerfahr$ = "ZAHLUNGSEINGANG"
   CALL WriteConfig("PROVIS","PROVISVERFAHREN","ZAHLUNGSEINGANG")
   prv$ = "Real Cash"
 ELSE 
   CALL WriteConfig("PROVIS","PROVISVERFAHREN","STANDARD")
   PrvVerfahr$ = "STANDARD"
   prv$ = "STANDARD"
 END IF 
 END SUB 
 
 
 'Vertragsabgleichsliste fÅr EinfÅhrung von RealCash
 
SUB VertrAbgleich()
 MOUSE OFF 
 CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"maadr" + _fpw$)
 CALL DFile(3,"maadrgru" + _fpw$)
 CALL DFile(3,"kvertrag" + _fpw$)
 CALL DFile(3,"buchung" + _fpw$)
 CALL DFile(2,"OFFICE\" + GADRDat$ + _fpw$)
 FILE "Buchung"
 INDEX codevt.buchung
 FILE "kvertrag"
 INDEX lfdnr.kvertrag
 IF RECCOUNT ("KVERTRAG") > 0 THEN 
   SELECT FIRST LOCK 
 ELSE 
   SELECT LAST 
 END IF 
 SET STATUS VS_Nr.kvertrag
 datletztZahln% = 0
 WHILE NOT EOF ("KVERTRAG")
   lfd% = lfdnr.kvertrag
   SET STATUS VS_Nr.kvertrag
   IF EXISTS (lfd%,CodeVT.Buchung) THEN 
     sumgesplus% = 0
     sumgesminus% = 0
     FILE "Buchung"
     SELECT FIRST 
     SELECT KEY lfd% FILE "Buchung" INDEX Codevt.buchung
     WHILE NOT EOF ("Buchung") AND codevt.buchung = lfd%
       IF Betrag.Buchung > 0 THEN 
         sumgesplus% = sumgesplus% + Betrag.buchung
       ELSE 
         sumgesminus% = sumgesminus% + Betrag.buchung
       END IF 
       datletztZahl% = Datum.buchung
       IF datletztZahl% > datletztZahln% THEN datletztZahln% = datletztZahl%
     SELECT NEXT FILE "Buchung"
     WEND 
     FILE "Kvertrag"
     VGezGesamtPlus.kvertrag = sumgesplus%
     VGezGesamtMinus.kvertrag = sumgesminus%
     VGezLetzt.kvertrag = datletztZahln%
     STORE FILE "Kvertrag"
 
   END IF 
 FILE "KVERTRAG"
 SELECT NEXT LOCK FILE "Kvertrag"
 WEND 
 REM Listenausdruck aufrufen
 CALL RealAbgleich()
 MOUSE ON 
 SET STATUS ""
 CALL WriteConfig("PROVIS","REALLISTE","TRUE")
 END SUB 
 
 
 ' Liste Åber Summen zu Vertragszahlungen
SUB RealAbgleich()
 CALL PRep("ABGREAL")
 REM REPORT USING "ABGREAL"
 BEFORE REPORT 
     SET REPORT PAGE "H_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
 SET FIRST PAGE HEADING OFF 
 SELECT ;
     WHERE CodeGE.KVERTRAG = CodeGE.GEADR AND CodeVA.KVERTRAG = codeva.SPARTEN AND CodeKU.KVERTRAG = CodeKU.GAdrDat$ AND CodeMA.KVERTRAG = CodeMA.MAADR AND VGezLetzt.kvertrag <> 0
     ORDER kunde$,Gesellschaft.GEADR
     TO ASK 
 END SUB 
 
  
 
SUB Dynamisier(lfdnr%)
 CALL Fehler("Achtung es wird jetzt zunÑchst eine Kopie des ursprÅnglichen Vertrages erstellt!","Anschlie·end wird der Originalvertrag automatisch storniert und mit dem Kennzeichen DYN in der Policenummer versehen!")
 REQUEST "Wollen Sie den Vorgang wirklich fortsetzen?","",130,req%
 IF req% <> 1 THEN 
   GOTO dynend100998
   vstatus% = 2
 END IF 
 lfdnrold% = lfdnr.kvertrag
 CALL VERTRKopdyn()
 lfdnrneu% = lfdnr.kvertrag
 SELECT KEY lfdnrneu% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
 begmon% = MONTH ( TODAY )
 begmon% = begmon% - 1
 begjahr% = YEAR ( TODAY )
 begtag% = DAY ( TODAY )
 begtag% = begtag% - 1
 IF begmon% = 0 THEN 
   begmon% = 12
   begjahr% = begjahr% - 1
 END IF 
 begtag% = 27
 beg$ = STR$ (begtag%,"00") + "." + STR$ (begmon%,"00") + "." + STR$ (begjahr%,"0000")
 beg% = DAYS (beg$)
 VS_Beginn.kvertrag = TODAY 
 von$ = DATE$ (beg%,"0d.mm.yyyy")
 bis$ = von$
 laufzeit$ = STR$ (vs_dauer.kvertrag,"99999")
dyn190398:  
  IF vform% = 26 THEN 
    CREATE DIALOG "vsuch",0,0,317,244,"KV Vertrag dynamisieren","MS Sans Serif",8
    ADD DIALOG "vsuch",9,6,6,24,22,2
    ADD DIALOG "vsuch",5,34,6,132,10,0,"Vertrag dynamisieren"
    ADD DIALOG "vsuch",4,34,14,222,5,0,""
    ADD DIALOG "vsuch",5,4,32,222,13,0,"Bitte geben Sie die geÑnderten Eckwerte fÅr den neuen Vertrag ein"
    ADD DIALOG "vsuch",5,4,51,102,10,0,"Policenr.:"
    ADD DIALOG "vsuch",5,4,64,101,11,0,"Tarifinfo:"
    ADD DIALOG "vsuch",5,4,78,102,11,0,"Vertragssumme:"
    ADD DIALOG "vsuch",5,4,91,104,10,0,"Bewertung:"
    ADD DIALOG "vsuch",5,4,104,102,9,0,"Volumen:"
    ADD DIALOG "vsuch",5,4,116,102,11,0,"KV Netto:"
    ADD DIALOG "vsuch",5,4,130,102,11,0,"Risikozuschlag:"
    ADD DIALOG "vsuch",5,4,144,102,11,0,"Pflegepflicht:"
    ADD DIALOG "vsuch",5,4,158,101,10,0,"Vertragsbeginn neuer Vertrag:"
    ADD DIALOG "vsuch",5,4,172,128,10,0,"Provisionierungsbeginn neuer Vertrag:"
    ADD DIALOG "vsuch",5,4,186,98,10,0,"Ablaufdatum alter Vertrag:"
    ADD DIALOG "vsuch",5,4,200,117,10,0,"Provisionszahlung alter Vertrag bis:"
    ADD DIALOG "vsuch",5,4,214,117,10,0,"Laufzeit:"
    ADD DIALOG "vsuch",5,200,214,117,10,0,"Dauer BZ:"
    ADD DIALOG "vsuch",6,135,51,132,12,0,0,VS_Nr.kvertrag,30
    ADD DIALOG "vsuch",6,135,65,132,12,0,0,tarif.kvertrag,40
    ADD DIALOG "vsuch",6,135,78,132,12,0,0,VSumme.kvertrag,20
    ADD DIALOG "vsuch",6,135,91,132,12,0,0,Bewertungssumme.kvertrag,20
    ADD DIALOG "vsuch",6,135,104,132,12,0,0,Volumen.kvertrag,20
    ADD DIALOG "vsuch",6,135,117,132,12,0,0,NettoBeitrag.kvertrag,20
    ADD DIALOG "vsuch",6,135,130,132,12,0,0,kvrisikozu.kvertrag,20
    ADD DIALOG "vsuch",6,135,144,132,12,0,0,pflegepflicht.kvertrag,20
 
    ADD DIALOG "vsuch",6,135,158,40,12,0,0,VS_Beginn.kvertrag,10
    ADD DIALOG "vsuch",6,135,172,40,12,0,0,ProviAb$,10
    ADD DIALOG "vsuch",6,135,186,40,12,0,0,von$,10
    ADD DIALOG "vsuch",6,135,200,40,13,0,0,bis$,10
    ADD DIALOG "vsuch",6,135,214,40,13,0,0,laufzeit$,10
    ADD DIALOG "vsuch",6,250,214,40,13,0,0,DBeitrZahlung.kvertrag,10
    ADD DIALOG "vsuch",1,202,220,55,14,0,"&Weiter",1,1
  ELSE 
    CREATE DIALOG "vsuch",0,0,317,224,"Vertrag dynamisieren","MS Sans Serif",8
    ADD DIALOG "vsuch",9,6,6,24,22,2
    ADD DIALOG "vsuch",5,34,6,132,10,0,"Vertrag dynamisieren"
    ADD DIALOG "vsuch",4,34,14,222,5,0,""
    ADD DIALOG "vsuch",5,4,32,222,13,0,"Bitte geben Sie die geÑnderten Eckwerte fÅr den neuen Vertrag ein"
    ADD DIALOG "vsuch",5,4,51,102,10,0,"Policenr.:"
    ADD DIALOG "vsuch",5,4,64,101,11,0,"Tarifinfo:"
    ADD DIALOG "vsuch",5,4,78,102,11,0,"Vertragssumme:"
    ADD DIALOG "vsuch",5,4,91,104,10,0,"Bewertung:"
    ADD DIALOG "vsuch",5,4,104,102,9,0,"Volumen:"
    ADD DIALOG "vsuch",5,4,116,102,11,0,"Beitrag:"
    ADD DIALOG "vsuch",5,4,130,101,10,0,"Vertragsbeginn neuer Vertrag:"
    ADD DIALOG "vsuch",5,4,144,128,10,0,"Provisionierungsbeginn neuer Vertrag:"
    ADD DIALOG "vsuch",5,4,159,98,10,0,"Ablaufdatum alter Vertrag:"
    ADD DIALOG "vsuch",5,4,172,117,10,0,"Provisionszahlung alter Vertrag bis:"
    ADD DIALOG "vsuch",5,4,186,117,10,0,"Laufzeit:"
    ADD DIALOG "vsuch",5,200,186,117,10,0,"Dauer BZ:"
    ADD DIALOG "vsuch",6,135,51,132,12,0,0,VS_Nr.kvertrag,30
    ADD DIALOG "vsuch",6,135,65,132,12,0,0,tarif.kvertrag,40
    ADD DIALOG "vsuch",6,135,78,132,12,0,0,VSumme.kvertrag,20
    ADD DIALOG "vsuch",6,135,91,132,12,0,0,Bewertungssumme.kvertrag,20
    ADD DIALOG "vsuch",6,135,104,132,12,0,0,Volumen.kvertrag,20
    ADD DIALOG "vsuch",6,135,117,132,12,0,0,Beitrag.kvertrag,20
    ADD DIALOG "vsuch",6,135,130,40,12,0,0,VS_Beginn.kvertrag,10
    ADD DIALOG "vsuch",6,135,144,40,12,0,0,ProviAb$,10
    ADD DIALOG "vsuch",6,135,157,40,12,0,0,von$,10
    ADD DIALOG "vsuch",6,135,171,40,13,0,0,bis$,10
    ADD DIALOG "vsuch",6,135,184,40,13,0,0,laufzeit$,10
    ADD DIALOG "vsuch",6,250,184,40,13,0,0,DBeitrZahlung.kvertrag,10
    ADD DIALOG "vsuch",1,202,200,55,14,0,"&Weiter",1,1
    REM ADD DIALOG "vsuch",1,260,200,55,14,0,"&Abbruch",0,0
  END IF 
 DIALOG "vsuch",req%
  
 
 
 
 REMOVE DIALOG "vsuch"
 beg$ = DATE$ (VS_Beginn.kvertrag,"0d.mm.yyyy")
 
 IF proviab$ = "" THEN proviab$ = beg$
 
 letzteBearb.KVERTRAG = TODAY 
 IF NOT DateOK%(proviab$) THEN 
   CALL Fehler("Falsches Datum fÅr Versicherungsbeginn","")
   GOTO dyn190398
 END IF 
 IF NOT DateOK%(beg$) THEN 
   CALL Fehler("Falsches Datum fÅr Versicherungsbeginn","")
   GOTO dyn190398
 END IF 
 IF NOT DateOK%(von$) THEN 
   CALL Fehler("Falsches Datum fÅr Ablaufdatum","")
   GOTO dyn190398
 END IF 
 IF NOT DateOK%(bis$) THEN 
   CALL Fehler("Falsches Datum fÅr Ablaufdatum","")
   GOTO dyn190398
 END IF 
 ON ERROR GOTO dyn190398
 IF laufzeit$ <> "" THEN 
   lz% = VAL (laufzeit$)
 ELSE 
   lz% = 0
 END IF 
 ON ERROR GOTO ErrorHandler
 IF vform% = 26 THEN CALL KVNetzuBrutKV()
 CALL QuickStore("Kvertrag")
 
 SELECT KEY lfdnr% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
 storno.kvertrag = 3
 vorzeitig.kvertrag = "j"
 kÅndigung.kvertrag = DAYS (von$)
 TatsKuenDat.KVERTRAG = DAYS (bis$)
 letzteBearb.KVERTRAG = TODAY 
 DynJN.kvertrag = "J"
 REM 201299
 CodeVStatus.kvertrag = 13
 VStatusTxT.kvertrag = "storniert durch Dynamisierung"
 CALL QuickStore("Kvertrag")
 SELECT KEY lfdnrneu% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
 CALL PROVIDyn(proviab$,lz%)
 MOUSE OFF 
 REQUEST "Es werden jetzt alle Nachbearbeitungen/Schadensmeldungen","dem neuen Vertrag zugewiesen!"
 UPDATE codevt.vorgang = lfdnrneu% WHERE codevt.vorgang = lfdnrold%
 END UPDATE 
 REQUEST "Es werden jetzt alle Vertragsdokumente","dem neuen Vertrag zugewiesen!"
 UPDATE codeku.dokkv = lfdnrneu% WHERE codeku.dokkv = lfdnrold%
 END UPDATE 
 UNLOCK FILE "vkond"
 UNLOCK FILE "dokkv"
 UNLOCK FILE "vorgang"
 CLOSE FILE "vkond"
 CLOSE FILE "dokkv"
 CLOSE FILE "vorgang"
 CALL DFile(3,"Vorgang" + _fpw$)
 CALL DFile(3,"Vkond" + _fpw$)
 CALL DFile(2,"OFFICE\" + "dokkv" + _fpw$)
 REM UNLOCK FILE ""
 cuvt% = lfdnrneu%
 REM CALL VERTRUpdate()
 SELECT KEY lfdnrneu% FILE "kvertrag" INDEX lfdnr.kvertrag
 FORM 
dynend100998: 
 END SUB 
 
 
  
 
 
 






 REM Berechnung in der Fondsdatei 
SUB AftAnteileFonds(v%)
   cv% = lfdnr.kvertrag
   fo% = codefo.fonds
   zweitwaehr$ = waehrung.stamm
   euro% = umrechnung.stamm
   ZWCodew% = codew.stamm
   DIM Waehrung$( RECCOUNT ("waehrung"))
   IF NEW ("Fonds") OR MOD ("Fonds") THEN CALL QuickStore("Fonds")
   IF anteile.fonds <> 0 THEN 
     SELECT KEY fo% LOCK FILE "Fonds" INDEX CodeFo.Fonds
     IF v% = 0 THEN 
       IF preisEuro.fonds = 0 THEN preisEuro.fonds = (preis.fonds / KursEuro.Fonds)
       IF AnteilspreisEur.fonds = 0 THEN AnteilspreisEur.fonds = preiseuro.fonds / Anteile.fonds
       IF UmrechUSTag.fonds = 0 AND PreisDollar = 0 THEN 
         Anteilspreis.fonds = AnteilspreisEur.fonds * UmrechUSTag.fonds
         PreisDollar.fonds = Anteile.fonds * Anteilspreis.fonds
       END IF 
       REM IF Anteilspreis.fonds = 0 THEN Anteilspreis.fonds = preisdollar.fonds / Anteile.fonds
     ELSE 
       preisEuro.fonds = (preis.fonds / KursEuro.Fonds)
       AnteilspreisEur.fonds = preiseuro.fonds / Anteile.fonds
       Anteilspreis.fonds = AnteilspreisEur.fonds * UmrechUSTag.fonds
       PreisDollar.fonds = Anteile.fonds * Anteilspreis.fonds
       REM Anteilspreis.fonds = preisdollar.fonds / Anteile.fonds
     END IF 
     IF Bkurstag.fonds < 1 THEN Bkurstag.fonds = datum.fonds
     BAntPreisinWaeh.fonds = Preis.fonds / Anteile.fonds
     IF BKursEuro.fonds <= 0 THEN BKursEuro.fonds = KursEuro.fonds
     IF BKursUS.fonds <= 0 THEN BKursUS.fonds = UmrechUSTag.fonds
     
     IF BAntPreisinWaeh.fonds <> 0 THEN 
       BAnlageWaehr.fonds = Anteile.fonds * BAntPreisinWaeh.fonds
       BBestandWaehr.fonds = Anteile.fonds * BRÅckkaufWaehr.fonds
     END IF 
     IF BKursEuro.fonds <> 0 THEN 
       BAntPreisinEuro.fonds = BAntPreisinWaeh.fonds / BKursEuro.fonds
       BAntPreisinDM.fonds = BAntPreisinEuro.fonds * euro%
 
       BRÅckkaufEuro.fonds = BRÅckkaufWaehr.fonds / BKursEuro.fonds
       BRÅckkaufDM.fonds = BRÅckkaufEuro.fonds * euro%
       
       BAnlageEURO.fonds = Anteile.fonds * BAntPreisinEuro.fonds
       BAnlageDM.fonds = anteile.fonds * BAntPreisinDM.fonds
 
       BBestandEURO.fonds = Anteile.fonds * BRÅckkaufEuro.fonds
       BBestandDM.fonds = BBestandEURO.fonds * euro%
 
     END IF 
     IF BKursUS.fonds <> 0 THEN 
       BAntPreisinUS.fonds = BAntPreisinEuro.fonds * BKursUS.fonds
       BAnlageUS.fonds = Anteile.fonds * BAntPreisinUS.fonds
 
       BRÅckkaufUS.fonds = BRÅckkaufEuro.fonds * BKursUS.fonds
       BBestandUS.fonds = Anteile.fonds * BRÅckkaufUS.fonds
     END IF 
     CALL QuickStore("Fonds")
     SELECT FORM KEY fo% FILE "fonds" INDEX codefo.fonds
     waehr1$ = wÑhrung.fonds
   ELSE 
     SELECT KEY fo% LOCK FILE "Fonds" INDEX CodeFo.Fonds
     IF Bkurstag.fonds < 1 THEN Bkurstag.fonds = datum.fonds
     IF BAntPreisinWaeh.fonds <= 0 THEN BAntPreisinWaeh.fonds = Preis.fonds / Anteile.fonds
     IF BKursEuro.fonds <= 0 THEN BKursEuro.fonds = KursEuro.fonds
     IF BKursUS.fonds <= 0 THEN BKursUS.fonds = UmrechUSTag.fonds
     IF v% = 0 THEN 
       IF preisEuro.fonds = 0 THEN preisEuro.fonds = (preis.fonds / KursEuro.Fonds)
       AnteilspreisEur.fonds = 0
       Anteilspreis.fonds = 0
     ELSE 
       preisEuro.fonds = (preis.fonds / KursEuro.Fonds)
       AnteilspreisEur.fonds = 0
       Anteilspreis.fonds = 0
     END IF 
 
     IF BAntPreisinWaeh.fonds <> 0 THEN 
       BAnlageWaehr.fonds = Anteile.fonds * BAntPreisinWaeh.fonds
       BBestandWaehr.fonds = Anteile.fonds * BRÅckkaufWaehr.fonds
     END IF 
     IF BKursEuro.fonds <> 0 THEN 
       BAntPreisinEuro.fonds = BAntPreisinWaeh.fonds / BKursEuro.fonds
       BAnlageEURO.fonds = Anteile.fonds * BAntPreisinEuro.fonds
       BAntPreisinDM.fonds = BAntPreisinEuro.fonds * euro%
       BAnlageDM.fonds = anteile.fonds * BAntPreisinDM.fonds
       BRÅckkaufEuro.fonds = BRÅckkaufWaehr.fonds / BKursEuro.fonds
       BRÅckkaufDM.fonds = BRÅckkaufEuro.fonds * euro%
       BBestandEURO.fonds = Anteile.fonds * BRÅckkaufEuro.fonds
       BBestandDM.fonds = BBestandEURO.fonds * euro%
     END IF 
     IF BKursUS.fonds <> 0 THEN 
       BAntPreisinUS.fonds = BAntPreisinEuro.fonds * BKursUS.fonds
       BAnlageUS.fonds = Anteile.fonds * BAntPreisinUS.fonds
       BRÅckkaufUS.fonds = BRÅckkaufEuro.fonds * BKursUS.fonds
       BBestandUS.fonds = Anteile.fonds * BRÅckkaufUS.fonds
     END IF 
     CALL QuickStore("Fonds")
     SELECT FORM KEY fo% FILE "fonds" INDEX codefo.fonds
     waehr1$ = wÑhrung.fonds
   END IF 
 END SUB 
 
 
 'WÑhrungsauswahl fÅr Fondsdatei
 
SUB FondsWaehrung()
   cv% = lfdnr.kvertrag
   fo% = codefo.fonds
   DIM Waehrung$( RECCOUNT ("waehrung"))
   IF NEW ("Fonds") OR MOD ("Fonds") THEN CALL QuickStore("Fonds")
     FILE "waehrung"
     DIM Auswahl1$(1)
     INDEX Codew.waehrung
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("waehrung")
       Waehrung$(a%) = waehrung.waehrung + " (1Euro = " + STR$ (umrechnung.waehrung,",999999.000000") + " " + waehrung.waehrung + ")" + SPACE$ (120) + STR$ (CodeW.waehrung,"000000")
       a% = a% + 1
       SELECT NEXT 
     WEND 
     FILE "Fonds"
     CREATE DIALOG "PREISLIS",0,0,190,164,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl WÑhrung"
      ADD DIALOG "PREISLIS",7,5,14,139,125,2,2,Waehrung$,Auswahl1$,Waehrung$(0)
      ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        _cuwaehr% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY _cuwaehr% FILE "waehrung" INDEX codew.waehrung
        _cuwaehr% = CodeW.waehrung
        IF _cuwaehr% > 0 THEN cuwaehr% = _cuwaehr%
        
        SELECT KEY fo% LOCK FILE "Fonds" INDEX CodeFo.Fonds
        REM CodeW.kvertrag = _cuwaehr%
        
        NUMBASE "z99999999.000000"
        euro% = umrechnung.waehrung
        WÑhrung.Fonds = waehrung.waehrung
        KursEuro.Fonds = umrechnung.waehrung
        BKursEuro.fonds = umrechnung.waehrung
        BKursTag.fonds = datum.fonds
        CALL QuickStore("Fonds")
        SELECT FORM KEY fo% FILE "fonds" INDEX codefo.fonds
        waehr1$ = wÑhrung.fonds
      END IF 
 
 MOUSE ON 
 FORM 
 
 END SUB 
 
 'WÑhrungsauswahl fÅr Vertragsdatei
 
SUB VertrWaehrung()
  IF ag$ = "j" THEN 
    CALL Fehler("Diese Funktion wird in der Agenturvariante nicht unterstÅtzt!","")
    GOTO end300520051
  END IF 
  IF disabled%("VERTRBEARB") THEN END SUB 
  IF workstation% > 0 AND proviab.kvertrag > 0 THEN 
    CALL Fehler("Diese Funktion steht externen Filialen nicht zur VerfÅgung!","")
    GOTO end300520051
  END IF 
  IF proviab.kvertrag > 0 THEN 
    IF GBVF$ LIKE "TRUE" THEN 
      t1$ = "ÅberprÅfen Sie gegebenfalls die Felder in der Vertragsdatei, in ZahlungseingÑnge und Buchungen auf ihre Richtigkeit! "
      CALL Fehler("Der Vertrag wurde bereits an die Abrechnung Åbergeben. Wenn Sie jetzt die WÑhrung Ñndern wollen,",t1$)
    ELSE 
      t1$ = "Bitte deaktivieren Sie zuerst den Vertrag,"
      t1$ = t1$ + " dann kînnen Sie die WÑhrung Ñndern! öberprÅfen Sie gegebenfalls die ZahlungseingÑnge auf ihre Richtigkeit! Zur generellen Umstellung der VertrÑge auf den EURO nutzen Sie die Option <Eurumstellung> unter Firmenstammdaten!"
      CALL Fehler("Der Vertrag wurde bereits an die Abrechnung Åbergeben. Wenn Sie jetzt die WÑhrung Ñndern wollen, hei·t das, das der Vertrag bis jetzt in der falschen WÑhrung abgerechnet wurde.",t1$)
      GOTO end300520051
    END IF 
  END IF 
   _cuwaehr% = CodeW.kvertrag
   cv% = lfdnr.kvertrag
   DIM Waehrung$( RECCOUNT ("waehrung"))
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
     FILE "waehrung"
     DIM Auswahl1$(1)
     INDEX Codew.waehrung
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("waehrung")
       Waehrung$(a%) = waehrung.waehrung + " (1Euro = " + STR$ (umrechnung.waehrung,",999999.000000") + " " + waehrung.waehrung + ")" + SPACE$ (120) + STR$ (CodeW.waehrung,"000000")
       a% = a% + 1
       SELECT NEXT 
     WEND 
     FILE "kvertrag"
     prompt$ = Waehrung$(0)
     CREATE DIALOG "PREISLIS",0,0,190,164,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl WÑhrung"
      ADD DIALOG "PREISLIS",7,5,14,139,125,2,2,Waehrung$,Auswahl1$,prompt$
      ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        _cuwaehr% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY _cuwaehr% FILE "waehrung" INDEX codew.waehrung
        _cuwaehr% = CodeW.waehrung
        IF _cuwaehr% > 0 THEN cuwaehr% = _cuwaehr%
        
        SELECT KEY cv% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
        CodeW.kvertrag = _cuwaehr%
        NUMBASE "z99999999.000000"
        euro% = umrechnung.waehrung
        Waehrung.kvertrag = waehrung.waehrung
        umrechnung.kvertrag = euro%
        CALL FStore("kvertrag")
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
        waehr$ = "WÑhrung: " + waehrung.kvertrag
        IF PrvVerfahr$ = "ZAHLUNGSEINGANG" THEN 
          zedat$ = "zeingan1"
          budat$ = "buchung1"
        ELSE 
          zedat$ = "zeingang"
          budat$ = "buchung"
        END IF 
        IF EXISTS (cv%,codevt.zedat$) AND GBVF$ LIKE "TRUE" THEN 
          SELECT FIRST FILE zedat$ INDEX codevt.zedat$
          SELECT KEY cv% LOCK FILE zedat$ INDEX codevt.zedat$
          WHILE NOT EOF (zedat$) AND codevt.zedat$ = cv%
            IF codew.zedat$ <> _cuwaehr% THEN 
              IF codew.zedat$ = 3 AND _cuwaehr% = 1 THEN 
                REM Umwandlung von EUR ind DM
                umrech% = 1.9558300
                Betrag.zedat$ = BetragEU.zedat$ * umrech%
                Betrag_gezahlt.zedat$ = BetraggezEU.zedat$ * umrech%
                gezahlt.zedat$ = gezahlteu.zedat$ * umrech%
                sr.zedat$ = sreu.zedat$ * umrech%
                SRAuszahlung.zedat$ = SRAuszahlungEU.zedat$ * umrech%
                Bewertung.zedat$ = BewertungEU.zedat$ * umrech%
                umrechnung.zedat$ = 1.9558300
                codew.zedat$ = 1
                waehrung.zedat$ = "DM"
                Kundeinzahlung.zedat$ = KundeinzahluEU.zedat$ * umrech%

              END IF 
              IF codew.zedat$ = 1 AND _cuwaehr% = 3 THEN 
                REM Umwandlung von DM in EUR
                umrech% = 1.9558300
                Betrag.zedat$ = Betrag.zedat$ / umrech%
                BetragEU.zedat$ = Betrag.zedat$

                Betrag_gezahlt.zedat$ = Betrag_gezahlt.zedat$ / umrech%
                BetraggezEU.zedat$ = Betrag_gezahlt.zedat$

                gezahlt.zedat$ = gezahlt.zedat$ / umrech%
                gezahlteu.zedat$ = gezahlt.zedat$

                sr.zedat$ = sr.zedat$ / umrech%
                sreu.zedat$ = sr.zedat$

                SRAuszahlung.zedat$ = SRAuszahlung.zedat$ / umrech%
                SRAuszahlungEU.zedat$ = SRAuszahlung.zedat$

                Bewertung.zedat$ = Bewertung.zedat$ / umrech%
                BewertungEU.zedat$ = Bewertung.zedat$

                Kundeinzahlung.zedat$ = Kundeinzahlung.zedat$ / umrech%
                KundeinzahluEU.zedat$ = Kundeinzahlung.zedat$

                umrechnung.zedat$ = 1.00
                codew.zedat$ = 3
                waehrung.zedat$ = "EUR"
                
              END IF 
            END IF 
            CALL QuickStore(zedat$)
            SELECT NEXT LOCK FILE zedat$ INDEX codevt.zedat$
          WEND 
        END IF 
        IF EXISTS (cv%,codevt.budat$) AND GBVF$ LIKE "TRUE" THEN 
          SELECT FIRST FILE budat$ INDEX codevt.budat$
          SELECT KEY cv% LOCK FILE budat$ INDEX codevt.budat$
          WHILE NOT EOF (budat$) AND codevt.budat$ = cv%
            IF codew.budat$ <> _cuwaehr% THEN 
              IF codew.budat$ = 3 AND _cuwaehr% = 1 THEN 
                REM Umwandlung von EUR ind DM
                umrech% = 1.9558300
                umrechnung.budat$ = 1.9558300
                codew.budat$ = 1
                waehrung.budat$ = "DM"
                Gesamtbetrag.budat$ = GesamtbetragEU.budat$ * umrech%
                Betrag.budat$ = betragEU.budat$ * umrech%
                SR.budat$ = SREU.budat$ * umrech%
                Bewertungssumme.budat$ = BewertungssumEU.budat$ * umrech%
                gezahlt.budat$ = gezahltEU.budat$ * umrech%
                Bewertung2.budat$ = Bewertung2EU.budat$ * umrech%
                VSUmme.budat$ = VsummeEU.budat$ * umrech%
                BeitragBrut.budat$ = BeitragBrutEU.budat$ * umrech%
                BeitragNET.budat$ = BeitragNetEU.budat$ * umrech%
                JahresBBrut.budat$ = JahresBBrutEU.budat$ * umrech%
                JahresBNET.budat$ = JahresBNetEU.budat$ * umrech%
                Kundeinzahlung.budat$ = KundeinzahluEU.budat$ * umrech%
                
              END IF 
              IF codew.budat$ = 1 AND _cuwaehr% = 3 THEN 
                REM Umwandlung von DM in EUR
                umrech% = 1.9558300
                umrechnung.budat$ = 1.00
                codew.budat$ = 3
                waehrung.budat$ = "EUR"
                Gesamtbetrag.budat$ = Gesamtbetrag.budat$ / umrech%
                GesamtbetragEU.budat$ = Gesamtbetrag.budat$

                Betrag.budat$ = Betrag.budat$ / umrech%
                betragEU.budat$ = Betrag.budat$

                SR.budat$ = SR.budat$ / umrech%
                SREU.budat$ = SR.budat$

                Bewertungssumme.budat$ = Bewertungssumme.budat$ / umrech%
                BewertungssumEU.budat$ = Bewertungssumme.budat$

                gezahlt.budat$ = gezahlt.budat$ / umrech%
                gezahltEU.budat$ = gezahlt.budat$

                Bewertung2.budat$ = Bewertung2.budat$ / umrech%
                Bewertung2EU.budat$ = Bewertung2.budat$

                VSUmme.budat$ = VSUmme.budat$ / umrech%
                VsummeEU.budat$ = VSUmme.budat$

                BeitragBrut.budat$ = BeitragBrut.budat$ / umrech%
                BeitragBrutEU.budat$ = BeitragBrut.budat$

                BeitragNET.budat$ = BeitragNET.budat$ / umrech%
                BeitragNetEU.budat$ = BeitragNET.budat$

                JahresBBrut.budat$ = JahresBBrut.budat$ / umrech%
                JahresBBrutEU.budat$ = JahresBBrut.budat$

                JahresBNET.budat$ = JahresBNET.budat$ / umrech%
                JahresBNetEU.budat$ = JahresBNET.budat$

                Kundeinzahlung.budat$ = Kundeinzahlung.budat$ / umrech%
                KundeinzahluEU.budat$ = Kundeinzahlung.budat$
 
              END IF 
            END IF 
            CALL QuickStore(budat$)
            SELECT NEXT LOCK FILE budat$ INDEX codevt.budat$
          WEND 
 
        END IF 
      END IF 
 
 MOUSE ON 
 CALL Fehler("WÑhrung zuweisen beendet!","")
 FORM 
end300520051: 
 END SUB 
 
 'WÑhrungsauswahl fÅr Zahlungseingang
 
SUB ZEingWaehrung(dateiab$)
   _cuwaehr% = CodeW.dateiab$
   cv% = codeaz.dateiab$
   DIM Waehrung$( RECCOUNT ("waehrung"))
   IF NEW (dateiab$) OR MOD (dateiab$) THEN CALL FStore(dateiab$)
     FILE "waehrung"
     DIM Auswahl1$(1)
     INDEX Codew.waehrung
     SELECT FIRST 
     a% = 0
     WHILE NOT EOF ("waehrung")
       Waehrung$(a%) = waehrung.waehrung + " (1Euro = " + STR$ (umrechnung.waehrung,",999999.000000") + " " + waehrung.waehrung + ")" + SPACE$ (120) + STR$ (CodeW.waehrung,"000000")
       a% = a% + 1
       SELECT NEXT 
     WEND 
     FILE "kvertrag"
     CREATE DIALOG "PREISLIS",0,0,190,164,title$,"MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,137,0," Auswahl WÑhrung"
      ADD DIALOG "PREISLIS",7,5,14,139,125,2,2,Waehrung$,Auswahl1$,Waehrung$(0)
      ADD DIALOG "PREISLIS",1,37,145,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,145,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        _cuwaehr% = VAL ( RIGHT$ (Auswahl1$(0),6))
        SELECT KEY _cuwaehr% FILE "waehrung" INDEX codew.waehrung
        _cuwaehr% = CodeW.waehrung
        IF _cuwaehr% > 0 THEN cuwaehr% = _cuwaehr%
        
        SELECT KEY cv% LOCK FILE dateiab$ INDEX codeaz.dateiab$
        CodeW.dateiab$ = _cuwaehr%
        NUMBASE "z99999999.000000"
        euro% = umrechnung.waehrung
        Waehrung.dateiab$ = waehrung.waehrung
        umrechnung.dateiab$ = euro%
        CALL FStore(dateiab$)
        SELECT FORM KEY cv% FILE dateiab$ INDEX codeaz.dateiab$
        waehr$ = "WÑhrung: " + waehrung.dateiab$
      END IF 
 
 MOUSE ON 
 FORM 
 
 END SUB 
 
 
 
 
SUB BU1DMEuro(euro1%)
 euro1% = 1
 IF Gesamtbetrag <> 0 THEN GesamtbetragEU = VAL ( STR$ (Gesamtbetrag / euro1%,"999999999.00")) ELSE GesamtbetragEU = 0
 IF Betrag <> 0 THEN BetragEU = VAL ( STR$ (Betrag / euro1%,"999999999.00")) ELSE BetragEU = 0
 IF SR <> 0 THEN SREU = VAL ( STR$ (SR / euro1%,"999999999.00")) ELSE SREU = 0
 IF Bewertungssumme <> 0 THEN BewertungssumEU = VAL ( STR$ (Bewertungssumme / euro1%,"999999999.00")) ELSE BewertungssumEU = 0
 IF Bewertung2 <> 0 THEN Bewertung2Eu = VAL ( STR$ (Bewertung2 / euro1%,"999999999.00")) ELSE Bewertung2Eu = 0
 IF gezahlt <> 0 THEN gezahltEU = VAL ( STR$ (gezahlt / euro1%,"999999999.00")) ELSE gezahltEU = 0
 IF MWSTBetragEU = 0 AND NettoEu = 0 THEN NettoEu = BetragEU
 END SUB 
 
SUB BUDMEuro(euro1%)
 euro1% = 1
 IF Gesamtbetrag <> 0 THEN GesamtbetragEU = VAL ( STR$ (Gesamtbetrag / euro1%,"999999999.00")) ELSE GesamtbetragEU = 0
 IF Betrag <> 0 THEN BetragEU = VAL ( STR$ (Betrag / euro1%,"999999999.00")) ELSE BetragEU = 0
 IF SR <> 0 THEN SREU = VAL ( STR$ (SR / euro1%,"999999999.00")) ELSE SREU = 0
 IF Bewertungssumme <> 0 THEN BewertungssumEU = VAL ( STR$ (Bewertungssumme,"999999999.00")) / euro1% ELSE BewertungssumEU = 0
 IF Bewertung2 <> 0 THEN Bewertung2Eu = VAL ( STR$ (Bewertung2 / euro1%,"999999999.00")) ELSE Bewertung2Eu = 0
 IF gezahlt <> 0 THEN gezahltEU = VAL ( STR$ (gezahlt / euro1%,"999999999.00")) ELSE gezahltEU = 0
 IF MWSTBetragEU = 0 AND NettoEu = 0 THEN NettoEu = BetragEU
 END SUB 
 
 
 
 'Ausgabe Provisionsliste fÅr alle Agenturen mit Euro und Bewertungssumme
SUB LISTPRVE(von$,bis$,allprov$,bewert%,repname$,reqtdru%)
 IF reqtdru% = 0 THEN 
   dat$ = "Buchung"
   CALL PRep(repname$)
 ELSE 
   dat$ = "B1"
   repname1$ = LEFT$ (repname$,1) + "1" + MID$ (repname$,3)
   CALL PRep(repname1$)
 END IF 
 FILE dat$
 REM CALL PRep(repname$)
 REPORT ON BetragEU.dat$ AS "SSumAgentur%",SREU.dat$ AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%",BewertungssumEU.dat$ AS "SSumBEW%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung in EURO "
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.dat$ AS "SumAgentur%",SREU.dat$ AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.dat$ AS "SumEinh%",BewertungssumEU.dat$ AS "SumBEW%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.dat$
 BEFORE GROUP Datum.dat$
   IF reqtdru% = 0 THEN 
     SET REPORT PAGE "H_Datum.BUCH003"
   ELSE 
     SET REPORT PAGE "H_Datum.B1003"
   END IF 
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPROVL1811981
   IF allProv$ = "j" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
   IF allProv$ = "n" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Mahnung.dat$ <> "j"
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Mahnung.dat$ <> "j" AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
   REM 21082003
   IF allProv$ = "c" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Buchungstext.dat$ LIKE "Storno*"
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND Buchungstext.dat$ LIKE "Storno*"
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
ErrPROVL1811981: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 
 

 'Ausgabe Provisionsliste fÅr alle Agenturen mit Euro und Bewertungssumme,MWST,Netto,Brutto
SUB L9STPRVE(von$,bis$,allprov$,bewert%,repname$,reqtdru%)
 CALL PRep(repname$)
 dat$ = "B1"
 FILE dat$
 REPORT ON BetragEU.B1 AS "SSumAgentur%",SREU.B1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%",BewertungssumEU.B1 AS "SSumBEW%",NettoEU.B1 AS "SSumAgenturN%",BetnGezahltN% AS "SSumNBezN%",BetnDiffN% AS "SGesSumN%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 
 
 Header$ = "Provisionsabrechnung in EURO "
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.B1 AS "SumAgentur%",SREU.B1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.B1 AS "SumEinh%",BewertungssumEU.B1 AS "SumBEW%",NettoEU.B1 AS "SumAgenturN%",BetnGezahltN% AS "SumNBezN%"
 GROUP CodeMA.MAADR,BetnDiffN% AS "GesSumN%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.B1
 BEFORE GROUP Datum.B1
     SET REPORT PAGE "H_Datum.B1003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
  
 

 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPROVL2609041
   IF allProv$ = "j" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
   IF allProv$ = "n" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Mahnung.dat$ <> "j"
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Mahnung.dat$ <> "j" AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
   REM 21082003
   IF allProv$ = "c" THEN 
     REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
     IF req1d% <> 1 THEN 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Buchungstext.dat$ LIKE "Storno*"
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.dat$ = CodeMA.MAADR AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND Buchungstext.dat$ LIKE "Storno*"
       ORDER REPORT Nachname.MAADR,Datum.dat$,Kunde$
       TO ASK 
     END IF 
   END IF 
ErrPROVL2609041: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 

 'Ausgabe Provisionsliste fÅr eine Agentur mit Euro und Bewertungssumme,MWST
SUB L9STPRVE1(von$,bis$,allprov$,bewert%,ma%,repname$,reqtdru%)
   dat$ = "B1"
   CALL PRep(repname$)
 FILE dat$
 
 REPORT ON BetragEU.B1 AS "SSumAgentur%",SREU.B1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%",BewertungssumEU.B1 AS "SSumBEW%",NettoEU.B1 AS "SSumAgenturN%",BetnGezahltN% AS "SSumNBezN%",BetnDiffN% AS "SGesSumN%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 

       Header$ = "Provisionsabrechnung in EURO " + nachname.maadr
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       Header$ = Header$ + ""
       IF von$ = "" THEN von$ = "1.1.1980"
       IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 
 IF Gdruvonma% > 0 THEN 
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name1$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY Gdruvonma% FILE "maadr" INDEX codema.maadr
   name2$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   Header$ = "Provisionsliste fÅr " + name1$ + " aber nur die Provisionen, die durch Vermittler " + name2$ + " erwirtschaftet wurden "
   IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
   IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
   IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
   IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
   Header$ = Header$ + ""
   IF von$ = "" THEN von$ = "1.1.1980"
   IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 END IF 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.B1 AS "SumAgentur%",SREU.B1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.B1 AS "SumEinh%",BewertungssumEU.B1 AS "SumBEW%",NettoEU.B1 AS "SumAgenturN%",BetnGezahltN% AS "SumNBezN%"
 GROUP CodeMA.MAADR,BetnDiffN% AS "GesSumN%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.B1
 BEFORE GROUP Datum.B1
     SET REPORT PAGE "H_Datum.B1003"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
  


 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPROVL2609042
   IF Gdruvonma% = 0 THEN 
      IF allProv$ = "j" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "n" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j"
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j" AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "c" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Buchungstext.dat$ LIKE "Storno*"
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND Buchungstext.dat$ LIKE "Storno*"
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
     END IF 
   ELSE 
      IF allProv$ = "j" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "n" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j" AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j" AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "c" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Buchungstext.dat$ LIKE "Storno*" AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND Buchungstext.dat$ LIKE "Storno*" AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
     END IF 
   END IF 
ErrPROVL2609042: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 
 
 'Ausgabe Provisionsliste fÅr eine Agentur mit Euro und Bewertungssumme
SUB LISTPRVE1(von$,bis$,allprov$,bewert%,ma%,repname$,reqtdru%)
 IF reqtdru% = 0 THEN 
   dat$ = "Buchung"
   CALL PRep(repname$)
 ELSE 
   dat$ = "B1"
   repname1$ = LEFT$ (repname$,1) + "1" + MID$ (repname$,3)
   CALL PRep(repname1$)
 END IF 
 FILE dat$
 
        REPORT ON BetragEU.dat$ AS "SSumAgentur%",SREU.dat$ AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
       AFTER REPORT 
        SET REPORT PAGE "F_REPORT"
        OUTPUT REPORT PAGE 
       END REPORT 
       Header$ = "Provisionsabrechnung in EURO " + nachname.maadr
       IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
       IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
       IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
       IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
       Header$ = Header$ + ""
       IF von$ = "" THEN von$ = "1.1.1980"
       IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")

 IF Gdruvonma% > 0 THEN 
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name1$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY Gdruvonma% FILE "maadr" INDEX codema.maadr
   name2$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   Header$ = "Provisionsliste fÅr " + name1$ + " aber nur die Provisionen, die durch Vermittler " + name2$ + " erwirtschaftet wurden "
   IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
   IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
   IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
   IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
   Header$ = Header$ + ""
   IF von$ = "" THEN von$ = "1.1.1980"
   IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 END IF 

       HEADING 
        SET REPORT PAGE "H_PAGE"
        OUTPUT REPORT PAGE 
       END HEADING 
       GROUP CodeMA.MAADR,BetragEU.dat$ AS "SumAgentur%",SREU.dat$ AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.dat$ AS "SumEinh%"
       BEFORE GROUP CodeMA.MAADR
        SET REPORT PAGE "H_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
       END GROUP 
       AFTER GROUP CodeMA.MAADR
        SET REPORT PAGE "F_CodeMA.MAA002"
        OUTPUT REPORT PAGE 
        EJECT REPORT 
       END GROUP 
       GROUP Datum.dat$
       BEFORE GROUP Datum.dat$
       IF reqtdru% = 0 THEN 
         SET REPORT PAGE "H_Datum.BUCH003"
       ELSE 
         SET REPORT PAGE "H_Datum.B1003"
       END IF 
       OUTPUT REPORT PAGE 
       END GROUP 
       AFTER SELECT 
       SET REPORT PAGE "F_SELECT"
       OUTPUT REPORT PAGE 
       END SELECT 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPROVL1811985
   IF Gdruvonma% = 0 THEN 
      IF allProv$ = "j" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "n" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j"
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j" AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0)
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "c" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Buchungstext.dat$ LIKE "Storno*"
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND Buchungstext.dat$ LIKE "Storno*"
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
     END IF 
   ELSE 
      IF allProv$ = "j" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "n" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j" AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND mahnung.dat$ <> "j" AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
      END IF 
      IF allProv$ = "c" THEN 
        REQUEST "DatensÑtze mitt NULL-Werten unterdrÅcken?","",130,req1d%
        IF req1d% <> 1 THEN 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND Buchungstext.dat$ LIKE "Storno*" AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        ELSE 
          SELECT ;
          WHERE CodeMA.dat$ = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.dat$ >= vondat% AND Datum.dat$ <= bisdat% AND (Betrag.dat$ <> 0 OR sr.dat$ <> 0) AND Buchungstext.dat$ LIKE "Storno*" AND vtcodema.dat$ = Gdruvonma%
          ORDER REPORT nachname.maadr,Datum.dat$,kunde$
          TO ASK 
        END IF 
     END IF 
   END IF 
ErrPROVL1811985: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 
 
SUB LISTPRYE(von$,bis$,allprov$,reportv$)
 CALL PRep(reportv$)
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + " "
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
    vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPRye1911981
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   END IF 
ErrPRye1911981: 
   ON ERROR GOTO ErrorHandler 
 END SUB 


 REM 11052006 
SUB LISTPRX1(von$,bis$,allprov$,codema%)
 CALL PRep("LISTPRX1")
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SR.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + " "
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
    vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPRye1911981
   IF codema% = 0 THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND CodeMA.buchung1 = CodeMA%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   END IF 
ErrPRye1911981: 
   ON ERROR GOTO ErrorHandler 
 END SUB 




 
SUB LISTPRYENeu(von$,bis$,allprov$,ma%,reportv$)
 IF reportv$ LIKE "LPRYEBDE" THEN 
   CALL DFile(3,"BUDAY" + _fpw$)
 END IF 
 CALL PRep(reportv$)

 IF reportv$ LIKE "LPRYEBDE" THEN 
   REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
   AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
   END REPORT 
   Header$ = "Provisionsabrechnung in Euro"
   IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
   IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
   IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
   IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
   Header$ = Header$ + ""
   IF von$ = "" THEN von$ = "1.1.1980"
   IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
 
   GROUP QNameCodema.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
   BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
   END GROUP 
 
   GROUP Datum.BUCHUNG1,BetragEU.BUCHUNG1 AS "BAgentur%",SREU.BUCHUNG1 AS "SumBStorno%",BetnGezahlt% AS "SumBNBez%",BetnDiff% AS "BGesSum%",Einheiten.BUCHUNG1 AS "BSumEinh%"
   BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP Datum.BUCHUNG1
     SET REPORT PAGE "F_Datum.BUCH003"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPRye1911981 
   IF ma% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND BUDAY.BUCHUNG1 = Buday.BUDAY
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j" AND BUDAY.BUCHUNG1 = Buday.BUDAY
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     END IF 
   END IF 
   IF ma% > 0 THEN 
     IF Gdruvonma% = 0 THEN 
       IF allProv$ = "j" THEN 
         SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND BUDAY.BUCHUNG1 = Buday.BUDAY
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
       ELSE 
         SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j" AND BUDAY.BUCHUNG1 = Buday.BUDAY
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
       END IF 
     ELSE 
       IF allProv$ = "j" THEN 
         SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND BUDAY.BUCHUNG1 = Buday.BUDAY AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
       ELSE 
         SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j" AND BUDAY.BUCHUNG1 = Buday.BUDAY AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
         TO ASK 
       END IF 
     END IF 
   END IF 
   END SELECT 
 ELSE 
   REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
   AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
   END REPORT 
   Header$ = "Provisionsabrechnung in Euro"
   IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
   IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
   IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
   IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
   Header$ = Header$ + ""
   IF von$ = "" THEN von$ = "1.1.1980"
   IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 
   HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
   END HEADING 
 
   GROUP QNameCodema.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
   BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem002"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
   END GROUP 
 
   GROUP Datum.BUCHUNG1,BetragEU.BUCHUNG1 AS "BAgentur%",SREU.BUCHUNG1 AS "SumBStorno%",BetnGezahlt% AS "SumBNBez%",BetnDiff% AS "BGesSum%",Einheiten.BUCHUNG1 AS "BSumEinh%"
   BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP Datum.BUCHUNG1
     SET REPORT PAGE "F_Datum.BUCH003"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
 
   SET QUERY OFF 
   SET QUERY LOCK OFF 
    vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPRye1911981
   IF ma% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     END IF 
   END IF 
   IF ma% > 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     ELSE 
       SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.buchung1 = ma% AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
     END IF 
   END IF 
 END IF 
ErrPRye1911981: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 
 ' alle Agenturen in Euro / mit und ohne Bewertungssumme
SUB LISTPZBE(von$,bis$,allprov$,reportv$)
 CALL PRep(reportv$)
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 IF reportv$ LIKE "LISTMAUE" THEN 
   GROUP QNameCodema.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
   BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem003"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem003"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
   END GROUP 
 
   GROUP Datum.BUCHUNG1
   BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
 ELSE 
   GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 
   BEFORE GROUP CodeMA.MAADR
       SET REPORT PAGE "H_CodeMA.MAA002"
       OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
   END GROUP 
 
   GROUP Datum.BUCHUNG1
   BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
 END IF 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPZBE2211
   ON ERROR GOTO ErrorHandler
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   END IF 
ErrPZBE2211: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 
 
 ' alle Agenturen in Euro / mit und ohne Bewertungssumme
SUB L9STPZBE(von$,bis$,allprov$,reportv$)
 CALL PRep(reportv$)
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",MWSTBetragEU.BUCHUNG1 AS "SSumAgenturM%",NettoEU.BUCHUNG1 AS "SSumAgenturN%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 

 Header$ = "Provisionsabrechnung in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",Einheiten.BUCHUNG1 AS "SumEinh%",MWSTBetragEU.BUCHUNG1 AS "SumAgenturM%",NettoEU.BUCHUNG1 AS "SumAgenturN%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 

 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPZBE2609044
   IF allProv$ = "j" THEN 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat%
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   ELSE 
     SELECT ;
       WHERE CodeMA.buchung1 = CodeMA.MAADR AND Datum.buchung1 >= vondat% AND Datum.buchung1 <= bisdat% AND Mahnung.buchung1 <> "j"
       ORDER REPORT Nachname.MAADR,Datum.buchung1,Kunde$
       TO ASK 
   END IF 
ErrPZBE2609044: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 



 
 
 ' eine Agenturen in Euro / mit und ohne Bewertungssumme 
SUB LISTPRYE1(von$,bis$,allprov$,ma%,reportv$)
 CALL PRep(reportv$)
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
    vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPRye19119812
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$)
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j"
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
ErrPRye19119812: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 
 
 
 ' eine Agenturen in Euro / mit und ohne Bewertungssumme
SUB LISTPZBE1(von$,bis$,allprov$,ma%,reportv$)
 REM CALL Fehler("LISTE","")
 CALL PRep(reportv$)
 nonull% = 0
 IF UCASE$ (reportv$) LIKE "LISTMAUF" OR UCASE$ (reportv$) LIKE "LISTMAUE" THEN nonull% = - 1
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",BetnGezahlt% AS "SSumNBez%",BetnDiff% AS "SGesSum%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")

 IF ma% > 0 THEN 
   REM SELECT FIRST FILE "maadr" INDEX codema.maadr
   REM SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   REM Agenturnr$ = Agenturnr.maadr
   REM COPY FROM Agenturnr$
 END IF 
 IF Gdruvonma% > 0 THEN 
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name1$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY Gdruvonma% FILE "maadr" INDEX codema.maadr
   name2$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   Header$ = "Provisionsliste fÅr " + name1$ + " aber nur die Provisionen, die durch Vermittler " + name2$ + " erwirtschaftet wurden "
   IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
   IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
   IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
   IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
   Header$ = Header$ + ""
   IF von$ = "" THEN von$ = "1.1.1980"
   IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 END IF 


 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 IF reportv$ LIKE "LISTMAUE" THEN 
   GROUP QNameCodema.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
   BEFORE GROUP QNameCodema.MAADR
     SET REPORT PAGE "H_QNameCodem003"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP QNameCodema.MAADR
     SET REPORT PAGE "F_QNameCodem003"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   GROUP Datum.BUCHUNG1
   BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
 ELSE 
   GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",BetnGezahlt% AS "SumNBez%",BetnDiff% AS "GesSum%",Einheiten.BUCHUNG1 AS "SumEinh%"
   BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
   END GROUP 
 
   GROUP Datum.BUCHUNG1
   BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
   END GROUP 
 
   AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
   END SELECT 
 END IF 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPZBE22111
 IF Gdruvonma% = 0 THEN 
   IF nonull% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$)
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       IF GDruckPr% < 1 THEN 
         SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j"
         ORDER REPORT Datum.buchung1
         TO ASK 
       ELSE 
         SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j"
         ORDER REPORT Datum.buchung1
         TO PRINTER 
         REM APPACTIVATE "PDF*"
         REM SENDKEYS GDruckName$
         REM 16122004 
       END IF 
     END IF 
   ELSE 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0)
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j" AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0)
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
   END IF 
 ELSE 
   IF nonull% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j" AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
   ELSE 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0) AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j" AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0) AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
   END IF 
 END IF 
ErrPZBE22111: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 




 ' eine Agenturen in Euro / mit und ohne Bewertungssumme
SUB L9STPZBE1(von$,bis$,allprov$,ma%,reportv$)
 CALL PRep(reportv$)
 nonull% = 0
 REPORT ON BetragEU.BUCHUNG1 AS "SSumAgentur%",SREU.BUCHUNG1 AS "SSumStorno%",MWSTBetragEU.BUCHUNG1 AS "SSumAgenturM%",NettoEU.BUCHUNG1 AS "SSumAgenturN%"
 AFTER REPORT 
     SET REPORT PAGE "F_REPORT"
     OUTPUT REPORT PAGE 
 END REPORT 
 Header$ = "Provisionsabrechnung in Euro"
 IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
 IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
 IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
 IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
 Header$ = Header$ + ""
 IF von$ = "" THEN von$ = "1.1.1980"
 IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 
 IF Gdruvonma% > 0 THEN 
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY ma% FILE "maadr" INDEX codema.maadr
   name1$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   SELECT FIRST FILE "maadr" INDEX codema.maadr
   SELECT KEY Gdruvonma% FILE "maadr" INDEX codema.maadr
   name2$ = Nachname.maadr + "," + vorname.maadr + "," + Agenturnr.maadr
   Header$ = "Provisionsliste fÅr " + name1$ + " aber nur die Provisionen, die durch Vermittler " + name2$ + " erwirtschaftet wurden "
   IF von$ = "" AND bis$ <> "" THEN Header$ = Header$ + " (bis " + DATE$ ( TODAY ,"0d.mm.yyyy") + ")"
   IF von$ <> "" AND bis$ = "" THEN Header$ = Header$ + " (ab " + von$ + ")"
   IF von$ <> "" AND bis$ <> "" THEN Header$ = Header$ + " (vom " + von$ + " bis " + bis$ + ")"
   IF von$ = "" AND bis$ = "" THEN Header$ = Header$ + " (GesamtÅbersicht)"
   Header$ = Header$ + ""
   IF von$ = "" THEN von$ = "1.1.1980"
   IF bis$ = "" THEN bis$ = DATE$ ( TODAY ,"0d.mm.yyyy")
 END IF 
 
 HEADING 
     SET REPORT PAGE "H_PAGE"
     OUTPUT REPORT PAGE 
 END HEADING 
 
 GROUP CodeMA.MAADR,BetragEU.BUCHUNG1 AS "SumAgentur%",SREU.BUCHUNG1 AS "SumStorno%",Einheiten.BUCHUNG1 AS "SumEinh%",MWSTBetragEU.BUCHUNG1 AS "SumAgenturM%",NettoEU.BUCHUNG1 AS "SumAgenturN%"
 BEFORE GROUP CodeMA.MAADR
     SET REPORT PAGE "H_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER GROUP CodeMA.MAADR
     SET REPORT PAGE "F_CodeMA.MAA002"
     OUTPUT REPORT PAGE 
     EJECT REPORT 
 END GROUP 
 
 GROUP Datum.BUCHUNG1
 BEFORE GROUP Datum.BUCHUNG1
     SET REPORT PAGE "H_Datum.BUCH004"
     OUTPUT REPORT PAGE 
 END GROUP 
 
 AFTER SELECT 
     SET REPORT PAGE "F_SELECT"
     OUTPUT REPORT PAGE 
 END SELECT 
 
 SET QUERY OFF 
 SET QUERY LOCK OFF 
   vondat% = DAYS (von$)
   bisdat% = DAYS (bis$)
   ON ERROR GOTO ErrPZB2609045 

 IF Gdruvonma% = 0 THEN 
   IF nonull% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$)
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j"
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
   ELSE 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0)
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j" AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0)
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
   END IF 
 ELSE 
   IF nonull% = 0 THEN 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j" AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
   ELSE 
     IF allProv$ = "j" THEN 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0) AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     ELSE 
       SELECT ;
         WHERE CodeMA.buchung1 = CodeMA.MAADR AND CodeMA.MAADR = ma% AND Datum.buchung1 >= DAYS (von$) AND Datum.buchung1 <= DAYS (bis$) AND mahnung.buchung1 <> "j" AND (betrag.buchung1 <> 0 OR sr.buchung1 <> 0) AND vtcodema.buchung1 = Gdruvonma%
         ORDER REPORT Datum.buchung1
         TO ASK 
     END IF 
   END IF 
 END IF 
ErrPZB2609045: 
   ON ERROR GOTO ErrorHandler 
 END SUB 
 





 
 
 REM Berechnung KFZ-BeitrÑge
SUB KFZBeitr()
 IF zw.kvertrag = 55 THEN 
   CALL Fehler("BetÑtigen Sie bitte den Button Sichern und anschlie·end den Button Zahlweise, um diese zu definieren!","")
   GOTO KFZN130199
 END IF 
 RateHalb% = 3
 RateMon% = 5
 NUMBASE "9999999.00"
 zw% = zw.kvertrag
   IF zw.kvertrag = 2 THEN 
     KFZ_VSBH% = (KFZ_VSBH.kvertrag * 100) / (RateHalb% + 100)
     KFZ_VSBK% = (KFZ_VSBK.kvertrag * 100) / (RateHalb% + 100)
     KFZ_VSBU% = (KFZ_VSBU.kvertrag * 100) / (RateHalb% + 100)
   END IF 
   IF zw.kvertrag > 2 THEN 
     KFZ_VSBH% = (KFZ_VSBH.kvertrag * 100) / (RateMon% + 100)
     KFZ_VSBK% = (KFZ_VSBK.kvertrag * 100) / (RateMon% + 100)
     KFZ_VSBU% = (KFZ_VSBU.kvertrag * 100) / (RateMon% + 100)
   END IF 
   IF zw.kvertrag = 1 OR zw.kvertrag = 0 THEN 
     IF zw.kvertrag = 0 THEN zw% = 1
     KFZ_VSBH% = KFZ_VSBH.kvertrag
     KFZ_VSBK% = KFZ_VSBK.kvertrag
     KFZ_VSBU% = KFZ_VSBU.kvertrag
   END IF 
 KFZ_VSBH1% = (KFZ_VSBH% * 100 * zw% / HV_SFR.kvertrag)
 KFZ_VSBK1% = (KFZ_VSBK% * zw% * 100 / VK_SFR.kvertrag)
 KFZ_VSBU1% = (KFZ_VSBU% * zw% * 100 / Unf_SFR.kvertrag)
 
 KFZ_VSBH1$ = STR$ (KFZ_VSBH1% + 0.005,"9999999.0")
 KFZ_VSBK1$ = STR$ (KFZ_VSBK1% + 0.005,"9999999.0")
 KFZ_VSBU1$ = STR$ (KFZ_VSBU1% + 0.005,"9999999.0")
 
 KFZ_VSBH1% = VAL (KFZ_VSBH1$)
 KFZ_VSBK1% = VAL (KFZ_VSBK1$)
 KFZ_VSBU1% = VAL (KFZ_VSBU1$)
 
 
 REM KFZ_VSBH2% = KFZ_VSBH1% + ((KFZ_VSBH1% / 100) * (100 - HV_SFR.kvertrag))
 REM KFZ_VSBK2% = KFZ_VSBK1% + ((KFZ_VSBK1% / 100) * (100 - VK_SFR.kvertrag))
 REM KFZ_VSBU2% = KFZ_VSBU1% + ((KFZ_VSBU1% / 100) * (100 - Unf_SFR.kvertrag))
 
 KFZ_BTGES.kvertrag = KFZ_VSBH.kvertrag + KFZ_VSBK.kvertrag + KFZ_VSBU.kvertrag
  
 KFZHaftBeitrag.kvertrag = KFZ_VSBH1%
 KFZVollkBeitrag.kvertrag = KFZ_VSBK1%
 KFZ_UnfJBeitr.kvertrag = KFZ_VSBU1%
 KFZGesBeitrag.kvertrag = KFZ_VSBH1% + KFZ_VSBK1% + KFZ_VSBU1%
KFZN130199: 
 END SUB 
 
 
 
 
SUB KondTestKo()
  CALL DFile(3,"sparten" + _fpw$)
 CALL DFile(3,"geadr" + _fpw$):CALL DFile(3,"geadr2" + _fpw$)
 CALL DFile(3,"gekond" + _fpw$)
       REM PlausibilitÑtsprÅfungen
       CALL DeleteLog1()
       CALL CreateLog1()
       MOUSE OFF 
       codemaakt% = codema.gekond
       quickcode1$ = Quickcode.gekond
       codema1ab% = codema.gekond
       quickcode1ab$ = Quickcode.gekond
       SELECT KEY codemaakt% FILE "maadr" INDEX codema.maadr
       codemavor% = vorgÑnger.maadr
       IF codemavor% > 0 AND codemavor% <> codemaakt% THEN 
         MOUSE OFF 
         SELECT KEY codemavor% FILE "maadr" INDEX codema.maadr
         namevor$ = Nachname.maadr + "," + LEFT$ (vorname.maadr,1) + "."
         SELECT KEY codemaakt% FILE "maadr" INDEX codema.maadr
         FILE "gekond"
         INDEX codema.gekond
         SELECT FIRST 
         SELECT KEY codemavor% FILE "gekond" INDEX codema.gekond
         IF RECCOUNT ("gekond") < 10000 THEN 
           REDIM AdrFound$(3 * RECCOUNT ("gekond"))
         ELSE 
           REDIM AdrFound$(30000)
         END IF 
         tsfound% = 0
         CALL WriteLog1("PrÅfung, ob der VorgÑnger Konditionen besitzt, die der Nachfolger nicht hat")
         CALL WriteLog1("***************************************************************************")
         CALL WriteLog1("")
         WHILE NOT EOF ("gekond")
         REM PrÅfung, ob der VorgÑnger Konditionen besitzt, die der Nachfolger nicht hat
         SET STATUS "PrÅfung, ob der VorgÑnger Konditionen besitzt, die die Agentur nicht hat"
         IF codema.gekond = codemavor% THEN 
           quickvor$ = quickcode.gekond
           quickakt$ = STR$ (codemaakt%,"000000") + RIGHT$ (quickvor$,12)
           BWvonVor% = BWvon.gekond
           IF NOT EXISTS (quickakt$,quickcode.gekond) THEN 
             codege% = VAL ( MID$ (quickvor$,7,6))
             codeva% = VAL ( RIGHT$ (quickvor$,6))
             SELECT KEY codege% FILE "geadr" INDEX codege.geadr
             ges$ = Gesellschaft.geadr
             SELECT KEY codeva% FILE "sparten" INDEX codeva.sparten
             spar$ = Sparte.sparten
             AdrFound$(tsfound%) = "WARNUNG VG " + namevor$ + " besitzt Kondition " + ges$ + "," + spar$ + SPACE$ (100) + quickcode.gekond
             CALL WriteLog1("WARNUNG VG- Der VîrgÑnger: " + namevor$ + " besitzt die Kondition -  " + ges$ + "," + spar$ + " -  die die akt. Agentur noch nicht besitzt")
             tsfound% = tsfound% + 1
           ELSE 
             REM Bewertungszeitraum prÅfen
             SELECT KEY quickakt$ FILE "gekond" INDEX quickcode.gekond
             IF BWbis.gekond < 1 AND BWvon.gekond < BWvonVor% THEN 
               codege% = VAL ( MID$ (quickvor$,7,6))
               codeva% = VAL ( RIGHT$ (quickvor$,6))
               SELECT KEY codege% FILE "geadr" INDEX codege.geadr
               ges$ = Gesellschaft.geadr
               SELECT KEY codeva% FILE "sparten" INDEX codeva.sparten
               spar$ = Sparte.sparten
               AdrFound$(tsfound%) = "FEHLER BWVON " + namevor$ + " ist spÑter! " + ges$ + "," + spar$ + SPACE$ (100) + quickcode.gekond
               cc$ = " (VorgÑnger) fÑngt spÑter an, als bei der akt. Agentur, es ist aber auch mîglich, da· bei der VorgÑngeragentur auch noch Konditionen bestehen, die fÅr diesen Zeitraum gÅltig sind! "
               CALL WriteLog1("FEHLER/WARNUNG BWVON (Bewertungszeitraum) " + namevor$ + cc$ + " - Gesellschaft: " + ges$ + " - Sparte: " + spar$)
               tsfound% = tsfound% + 1
             END IF 
           END IF 
         END IF 
         FILE "gekond"
         SELECT NEXT 
         WEND 
         FILE "gekond"
         INDEX codema.gekond
         SELECT FIRST 
         SELECT KEY codemaakt% FILE "gekond" INDEX codema.gekond
         REM CALL Fehler("TESTKondition","")
         CALL WriteLog1("")
         CALL WriteLog1("PrÅfung, ob die aktuelle Agentur Konditionen besitzt, die der VorgÑnger nicht hat")
         CALL WriteLog1("*********************************************************************************")
         CALL WriteLog1("")
         WHILE NOT EOF ("gekond")
         REM IF codema.gekond = codemavor% THEN 
         IF codema.gekond = codemaakt% THEN 
           REM PrÅfung, ob die aktuelle Agentur Konditionen besitzt, die der VorgÑnger nicht hat
           SET STATUS "PrÅfung, ob die Agentur Konditionen besitzt, die der VorgÑnger nicht hat"
           quickakt$ = quickcode.gekond
           REM CALL Fehler("TESTKondition","")
           IF MID$ (quickakt$,7,6) = "000168" THEN 
             REM CALL Fehler("TESTKondition","Gesellsch")
           END IF 
 
           REM quickvor$ = STR$ (codemavor%,"000000") + RIGHT$ (quickvor$,12)
           quickvor$ = STR$ (codemavor%,"000000") + RIGHT$ (quickakt$,12)
 
           IF NOT EXISTS (quickvor$,quickcode.gekond) THEN 
             codege% = VAL ( MID$ (quickvor$,7,6))
             codeva% = VAL ( RIGHT$ (quickvor$,6))
             SELECT KEY codege% FILE "geadr" INDEX codege.geadr
             ges$ = Gesellschaft.geadr
             SELECT KEY codeva% FILE "sparten" INDEX codeva.sparten
             spar$ = Sparte.sparten
             AdrFound$(tsfound%) = "FEHLER VG " + namevor$ + " besitzt Kondition NICHT-> " + ges$ + "," + spar$ + SPACE$ (100) + quickcode.gekond
             CALL WriteLog1("FEHLER VG - Der VorgÑnger: " + namevor$ + " besitzt diese Kondition NICHT-> " + ges$ + "," + spar$)
             tsfound% = tsfound% + 1
           END IF 
         END IF 
         SELECT NEXT 
         WEND 
         CALL WriteLog1("")
         FILE "gekond"
         INDEX codema.gekond
         SELECT FIRST 
         REM PrÅfung auf Gesellschaft und Sparte
         SET STATUS "PrÅfung auf Gesellschaft und Sparte"
         CALL WriteLog1("PrÅfung auf Gesellschaft und Sparte")
         CALL WriteLog1("***********************************")
         WHILE NOT EOF ("gekond")
         
           quickakt$ = quickcode.gekond
           codege% = codege.gekond
           codema% = codema.gekond
           codeva% = codeva.gekond
           SELECT KEY codege% FILE "geadr" INDEX codege.geadr
           ges$ = Gesellschaft.geadr
           SELECT KEY codeva% FILE "sparten" INDEX codeva.sparten
           spar$ = Sparte.sparten
           SELECT KEY codema% FILE "maadr" INDEX codema.maadr
           mitarb$ = TRIM$ (Nachname.maadr) + "," + TRIM$ (vorname.maadr)
           IF NOT EXISTS (codege%,codege.geadr) THEN 
             AdrFound$(tsfound%) = "keine Gesellschaft definiert " + ", " + spar$ + ", " + mitarb$ + SPACE$ (100) + quickcode.gekond
             CALL WriteLog1("keine Gesellschaft definiert " + ", " + spar$ + ", " + mitarb$)
             tsfound% = tsfound% + 1
           END IF 
           IF NOT EXISTS (codema%,codema.maadr) THEN 
             REMOVE FROM FILE "gekond" WHERE codema.gekond = codema%
           END IF 
           IF NOT EXISTS (codeva%,codeva.sparten) THEN 
             AdrFound$(tsfound%) = "keine Sparte definiert " + "," + ges$ + ", " + spar$ + ", " + mitarb$ + SPACE$ (100) + quickcode.gekond
             CALL WriteLog1("keine Sparte definiert " + "," + ges$ + ", " + spar$ + ", " + mitarb$)
             tsfound% = tsfound% + 1
           END IF 
           SELECT NEXT FILE "gekond"
         WEND 
         AdrFound$(tsfound%) = ""
         SET STATUS ""
         CALL WriteLog1("")
         CALL WriteLog1("")
         cfile$ = FILE 
         CALL CloseLog1()
         FILE cfile$
         IF tsfound% > 0 THEN 
           LAuswahl$ = AdrFound$(0)
           LAuswahl1$(0) = LAuswahl$
           REM CREATE DIALOG "ADRSTICHW",0,0,380,260,"Fehlerliste","MS Sans Serif",8
           REM ADD DIALOG "ADRSTICHW",7,5,6,370,235,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
           REM ADD DIALOG "ADRSTICHW",1,60,242,55,16,1,"&OK",1,1
           REM ADD DIALOG "ADRSTICHW",1,120,242,55,60,0,"&Fehlerprotokoll",0,0
           REM DIALOG "ADRSTICHW",req5%
           MOUSE ON 
           REM REMOVE DIALOG "ADRSTICHW"
            req5% = 0
           IF req5% = 1 THEN 
             LAuswahl$ = LAuswahl1$(0)
             quickcode1$ = RIGHT$ (LAuswahl$,18)
             SELECT FIRST 
             SELECT FORM KEY quickcode1$ FILE "gekond" INDEX quickcode.gekond
             FORM 
           END IF 
         ELSE 
           REQUEST "Keine Fehler gefunden !","",2
         END IF 
       ELSE 
         REM PrÅfung wenn kein VorgÑnger existiert
         REDIM AdrFound$(3 * RECCOUNT ("gekond"))
         tsfound% = 0
         FILE "gekond"
         INDEX codema.gekond
         SELECT FIRST 
         REM PrÅfung auf Gesellschaft und Sparte
         WHILE NOT EOF ("gekond")
         REM PrÅfung, ob aktuell Konditionen besitzt, die der VorgÑnger nicht hat
           quickakt$ = quickcode.gekond
           codege% = codege.gekond
           codema% = codema.gekond
           codeva% = codeva.gekond
           SELECT KEY codege% FILE "geadr" INDEX codege.geadr
           ges$ = Gesellschaft.geadr
           SELECT KEY codeva% FILE "sparten" INDEX codeva.sparten
           spar$ = Sparte.sparten
           SELECT KEY codema% FILE "maadr" INDEX codema.maadr
           mitarb$ = TRIM$ (Nachname.maadr) + "," + TRIM$ (vorname.maadr)
           IF NOT EXISTS (codege%,codege.geadr) THEN 
             AdrFound$(tsfound%) = "keine Gesellschaft definiert " + ", " + spar$ + ", " + mitarb$ + SPACE$ (100) + quickcode.gekond
             tsfound% = tsfound% + 1
           END IF 
           IF NOT EXISTS (codema%,codema.maadr) THEN 
             REMOVE FROM FILE "gekond" WHERE codema.gekond = codema%
           END IF 
           IF NOT EXISTS (codeva%,codeva.sparten) THEN 
             AdrFound$(tsfound%) = "keine Sparte definiert " + "," + ges$ + ", " + spar$ + ", " + mitarb$ + SPACE$ (100) + quickcode.gekond
             tsfound% = tsfound% + 1
           END IF 
         SELECT NEXT 
         WEND 
         AdrFound$(tsfound%) = ""
         IF tsfound% > 0 THEN 
           LAuswahl$ = AdrFound$(0)
           LAuswahl1$(0) = LAuswahl$
           CREATE DIALOG "ADRSTICHW",0,0,380,260,"Fehlerliste","MS Sans Serif",8
           ADD DIALOG "ADRSTICHW",7,5,6,370,235,2,2,AdrFound$,Lauswahl1$,AdrFound$(0)
           ADD DIALOG "ADRSTICHW",1,163,242,55,16,1,"&OK",1,1
           REM ADD DIALOG "ADRSTICHW",1,103,242,55,16,0,"&Abbrechen",0,0
           DIALOG "ADRSTICHW",req5%
           MOUSE ON 
           REMOVE DIALOG "ADRSTICHW"
           IF req5% = 1 THEN 
             LAuswahl$ = LAuswahl1$(0)
             quickcode1$ = RIGHT$ (LAuswahl$,18)
             SELECT FIRST 
             SELECT FORM KEY quickcode1$ FILE "gekond" INDEX quickcode.gekond
             FORM 
           END IF 
         ELSE 
           REQUEST "Keine Fehler gefunden !","",2
         END IF 
       END IF 
       SELECT FORM KEY codema1ab% FILE "maadr" INDEX codema.maadr
       SELECT FORM KEY quickcode1ab$ FILE "gekond" INDEX Quickcode.gekond
       MOUSE ON 
 END SUB 
 
 
 
 REM Vertrag einer anderen Adresse zuweisen 10.03.99
 
SUB VERTRUmw()
 IF disabled%("VERTRBEARB") THEN END SUB 
 REQUEST "Wollen Sie den Vertrag wirklich einer anderen Adresse zuweisen?","",130,req%
 IF req% = 0 THEN GOTO endumw990310
 IF ProviAb.KVERTRAG <> 0 THEN 
   REM CALL Fehler("Vertrag mu· erst DEAKTIVIERT werden bevor er einer anderen Adresse zugewiesen werden kann!","")
   REM GOTO endumw990310
 END IF 
 IF ( MOD ("KVERTRAG") OR NEW ("KVERTRAG")) THEN CALL FStore("KVERTRAG")
 SET STATUS "Adresse suchen"
 cuknr% = codeku.KVERTRAG
 lfdnr% = lfdnr.kvertrag
 FILE GAdrDat$
 
 adr% = ADRSuche%(0)
 IF adr% <> 0 THEN 
   cuknr% = adr%
   adrglob% = adr%
   SELECT KEY lfdnr% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
   codeku.kvertrag = adrglob%
   vnehmer.kvertrag = ""
   CALL QuickStore("KVERTRAG")
   SELECT FORM KEY lfdnr% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
   FORM 
 END IF 
 IF adrglob% <> 0 THEN cuknr% = adrglob%
 
 SELECT FORM KEY cuknr% FILE GAdrDat$ INDEX CodeKU.GAdrDat$
 SET HEADING title$ + " - VertrÑge von: " + nachname.GAdrDat$ + IF (Vorname.GAdrDat$ <> "",", " + LEFT$ (Vorname.GAdrDat$,1) + ".","")
 SELECT FORM KEY cuknr% FILE GTelDat$ INDEX CodeKU.GTelDat$
 SELECT FORM KEY lfdnr% FILE "Kvertrag" INDEX lfdnr.kvertrag
 adrglob% = 0
 knr% = cuknr%
 SET INDEX INDEX 
 REM CALL ADRFeldnamen()
 FORM 
endumw990310: 
 REM CALL BMCheckMail()
 MOUSE ON 
 END SUB 
 
 REM ***************************************************************************************************************
 REM am Vertrag beteiligte Gesellschaften
 REM ***************************************************************************************************************
SUB Beteiligung1()
 IF disabled%("VERTRBEARB") THEN END SUB 
 cuvt% = lfdnr.kvertrag
 IF ag$ LIKE "j" THEN 
   
   CALL Fehler("Diese Funktion steht in der Agenturversion nicht zur VerfÅgung","")
   GOTO endbet070320021
 END IF 
 knr% = codeku.kvertrag
 CALL DFile(3,"Kgeadr" + _fpw$)
 BGEADRsub% = 0
 FILE "KGEADR"
 _formend% = 0
 WHILE _formend% = 0
   ON ERROR GOTO ErrorHandler
   IF UCASE$ ( FORM ) <> "BGEADR" THEN 
     SET HEADING title$ + " -Beteiligte Gesellschaften"
     OPEN FORM GPrjForm$ + "BGEADR"
     SET f = Superbase.Form
     CALL BGEADRIntro()
     CALL MNBGEADR()
     SET STATUS "Beteiligte Gesellschaften"
   END IF 
   MENU ON 
   MOUSE ON 
   BGEADRsub% = 0
   CALL ClearKBDBuffer()
   FORM 
   f.sich.visible = 0
   f.abbruch.visible = 0
   f.loe.visible = - 1
   f.bearb.visible = - 1
   f.zur.visible = - 1
   FILE "Kgeadr"
   IF BGEADRsub% <> 99 THEN WAIT KEY OR MENU OR MOUSE 
   REM ** Tastaturabfrage
   GET k$
   SELECT CASE ASC (k$)
   CASE CrsLeft%,PgUp%
     CALL PSelectPrev()
   CASE CrsRight%,PgDn%
     CALL PSelectNext()
   END SELECT 
   IF k$ = CHR$ (27) THEN _formend% = 1
   SELECT CASE BGEADRsub%
   CASE 1
     REM CALL VertrUniRep(0,0,0,codege.geadr,0,0,0,0,1, - 1)
     REM CALL LIST4()
   CASE 99
     REM 110197
     IF disabled%("GEADRBEARB") THEN 
     ELSE 
       MOUSE ON 
       MENU OFF 
       REM IF RECCOUNT ("geadr") = 0 THEN CALL GEADRNeu()
     
         REM 101296
         REM _gesold$ = Gesellschaft.geadr
         REM CALL ButDesabled()
         REM f.notiz.enabled = 0
         REM f.vertragsuebersicht.enabled = 0
         f.sich.visible = - 1
         f.abbruch.visible = - 1
         f.loe.visible = 0
         f.bearb.visible = 0
         f.zur.visible = 0
         ENTER Beteiligung.kgeadr,0
         f.sich.visible = 0
         f.abbruch.visible = 0
         f.loe.visible = - 1
         f.bearb.visible = - 1
         f.zur.visible = - 1
         REM CALL ButEnabled()
         REM f.notiz.enabled = - 1
         REM f.vertragsuebersicht.enabled = - 1
     
     END IF 
   END SELECT 
   IF abbruch% = - 1 THEN 
     SELECT KEY codebge.kgeadr FILE "kgeadr" INDEX codebge.kgeadr
     FORM 
     abbruch% = 0
   END IF 
   MENU ON 
 WEND 
 _formend% = 0
 FILE "KVERTRAG"
 MOUSE ON 
 CALL VERTRIntro(1)
endbet070320021: 
 END SUB 
 
 
SUB KGEADRNeu()
 IF disabled%("GEADRNEU") THEN END SUB 
 FILE "Kgeadr"
 IF gesellschaft.Kgeadr <> "" THEN CALL FStore( FILE )
 _cuge% = GetCodeGE%(cuge%)
 IF _cuge% > 0 THEN 
   BLANK FILE "kgeadr"
   SET STATUS "Datensatz neu angelegt..."
   CodeBGE% = SER ("kgeadr",1)
   CodeBGE.kgeadr = CodeBGE%
   codevt.kgeadr = cuvt%
   codege.kgeadr = _cuge%
   Gesellschaft.kgeadr = Gesellschaft.geadr
   REM QVTGE.KGeadr = STR$ (lfdnr.kvertrag,"000000") + STR$ (codege.kgeadr,"000000")
   REM gesellschaft.kgeadr = "NEU"
   CALL QuickStore("kgeadr")
   FORM 2
   SELECT FORM KEY codeBge% FILE "kgeadr" INDEX codeBge.kgeadr
   FORM 
   BGEADRsub% = 99
 END IF 
 MOUSE ON 
 END SUB 
 
SUB BGEADRSich()
   QVTGE.KGeadr = STR$ (codevt.kgeadr,"000000") + STR$ (codege.kgeadr,"000000")
   ges$ = ""
   IF EXISTS (codege.kgeadr,codege.geadr) THEN 
     SELECT KEY codege.kgeadr FILE "Geadr" INDEX codege.geadr
     ges$ = Gesellschaft.geadr
   END IF 
   Gesellschaft.kgeadr = ges$
   REQUEST "Mîchten Sie den Namen, Stra·e,Ort und Telefon aus der"," Hauptgesellschaft Åbernehmen?",130,req%
   IF (req% = 1) THEN 
     anrede.kgeadr = anrede.geadr
     nachname.kgeadr = nachname.geadr
     vorname.kgeadr = vorname.geadr
     stra·e.kgeadr = stra·e.geadr
     ort.kgeadr = ort.geadr
     plz.kgeadr = plz.geadr
     telefon1.kgeadr = telefon1.geadr
     telefon2.kgeadr = telefon2.geadr
     telefax.kgeadr = telefax.geadr
     btx.kgeadr = btx.geadr
   END IF 
 CALL QuickStore("KGEADR")
 END SUB 
 
 
 
 
 ' Korrekturbuchung einzelner Vertrag
 ' =======================================================================
 ' 23.06.99 
  
SUB BUKOREinz()
 IF disabled%("BUCHUNG6") THEN END SUB 
 codevt% = cuvt%
 SELECT FIRST FILE "KVERTRAG" INDEX lfdnr.kvertrag
 SELECT KEY codevt% FILE "KVERTRAG" INDEX lfdnr.kvertrag
 Anschluss% = 1
 REM REQUEST "Die Korrekturbuchung lîscht alle Buchungen des Vertrages und setzt","den Vertrag zurÅck! Fortfahren?",135,req%
 req% = 1
 CalcDate$ = ""
 aaaa% = ProviAB.KVERTRAG
 IF req% = 1 THEN 
   IF BewertEinmDat.kvertrag < ProviAB.KVERTRAG AND BewertEinmDat.kvertrag > 0 THEN 
     IF BewertEinmDat.kvertrag > 0 THEN CalcDate$ = DATE$ (BewertEinmDat.kvertrag,"0d.mm.yyyy")
   ELSE 
     IF ProviAB.KVERTRAG > 0 THEN CalcDate$ = DATE$ (ProviAB.KVERTRAG,"0d.mm.yyyy")
   END IF 
   IF CalcDate$ = "leer" THEN CalcDate$ = ""
   CREATE DIALOG "ANSCHLUSS",0,0,191,92,"Buchungskorrektur Vertrag","MS Sans Serif",8
   ADD DIALOG "ANSCHLUSS",4,0,0,191,68,0,""
   ADD DIALOG "ANSCHLUSS",9,9,12,21,23,2
   ADD DIALOG "ANSCHLUSS",5,38,12,144,20,0,"Bitte geben Sie ein, ab welchem Stichtag die Provisionen berechnet werden sollen:"
   ADD DIALOG "ANSCHLUSS",5,38,42,33,10,0,"Stich&tag:"
   ADD DIALOG "ANSCHLUSS",6,73,41,51,11,0,0,CalcDate$,20
   ADD DIALOG "ANSCHLUSS",1,34,72,55,14,1,"&OK",1,1
   DIALOG "ANSCHLUSS",req%
   REMOVE DIALOG "ANSCHLUSS"
   IF CalcDateTo$ = "" THEN 
     CalcDateTo$ = DATE$ ( TODAY ,"0d.mm.yyyy")
   END IF 
   IF DAYS (CalcDateTo$) < DAYS (CalcDate$) THEN CalcDateTo$ = CalcDate$
   IF req% = 1 THEN 
     IF DateOK%(CalcDate$) AND DateOK%(CalcDateTo$) THEN 
       CALL CreateLog()
       MOUSE OFF 
       CALL Server("LOADMESSAGE","")
       CALL Server("MESSAGE","Bitte warten... ")
       CALL DFile(3,"buchung" + _fpw$)
       CALL DFile(3,"ZEINGANG" + _fpw$)
       CALL DFile(3,"gekond" + _fpw$)
       CALL DFile(3,"maadr" + _fpw$)
       CALL DFile(3,"maadrgru" + _fpw$)
       CALL DFile(3,"kvertrag" + _fpw$)
       CALL DFile(3,"vkond" + _fpw$)
       REM CALL Fehler("KorrekturAB3",CalcDate$)
       REM CALL WriteConfig("PROVIS","KorrekturAb",CalcDate$)
       SET STATUS "Buchungsdatei wird gelîscht..."
       FILE "KVERTRAG"
       
       startprovi% = ProviAB.KVERTRAG
       REM 220897 REMOVE FROM FILE "BUCHUNG" WHERE Provision.BUCHUNG LIKE "j"
   REM ** CALL Server("MESSAGE","Bitte warten..." + CHR$ (10) + CHR$ (13) + "Zahlungseingang wird gelîscht.")
       REM ** REMOVE FROM FILE "ZEINGANG"
       CALL Server("MESSAGE","Bitte warten..." + CHR$ (13) + CHR$ (10) + "Die Vertragsdatei wird zurÅckgesetzt.")
       SET STATUS "Vertragsdatei wird zurÅckgesetzt..."
       FILE "KVERTRAG"
       SELECT KEY codevt% LOCK FILE "Kvertrag" INDEX lfdnr.kvertrag
       BewertcalcDat.kvertrag = 0:letzteProvi.kvertrag = 0:gez_Abschlu·.KVERTRAG = "":gez_Pauschale.KVERTRAG = ""
       TZRate.KVERTRAG = 0:letztePflege.KVERTRAG = 0:Mahnung.KVERTRAG = "n":KuenCourt1.kvertrag = ""
       REM Pool.KVERTRAG = 0
       CALL QuickStore("Kvertrag")
       FILE "Buchung"
       INDEX codema.buchung
       SELECT FIRST 
       FILE "Kvertrag"
       CALL BUKOPrepEinz(codevt%)
       CALL Server("UNLOADMESSAGE","")
       CALL WriteLog(">>Korrekturbuchung ab Stichtag " + CalcDate$)
       REM SET TODAY StartDatum$
       cmonat% = MONTH (CalcDate$)
       cjahr% = YEAR (CalcDate$)
       ctag% = DAY (CalcDate$)
       REM VertrÑge bis zum heutigen Tag hochrechnen
       REM 150697 ctag% = DAY ( TODAY )
       
       WHILE DAYS (CalcDate$) < DAYS (CalcDateTo$) + 1
         REM CALL Fehler(CalcDate$,CalcDateTo$)
         CALL PROVBUCHUNG(codevt%)
         IF codevt% > 0 AND GBewEinm% = - 1 THEN 
           cmonat% = cmonat% - 1
           GBewEinm% = 0
         END IF 
         cmonat% = cmonat% + 1
         IF cmonat% = 13 THEN 
           cmonat% = 1
           cjahr% = cjahr% + 1
         END IF 
         CalcDate$ = STR$ (ctag%,"00") + "." + STR$ (cmonat%,"00") + "." + STR$ (cjahr%,"0000")
       WEND 
       MOUSE ON 
       SET DISPLAY RESTORE 
       SET STATUS "Bereit"
       CALL CloseLog()
       MOUSE OFF 
       fo1$ = FORM 
       CLOSE FILE "BUCHUNG"
       CLOSE FILE "VORGANG"
       CLOSE FILE "KVERTRAG"
       CALL DFile(3,"KVERTRAG" + _fpw$)
       CALL DFile(3,"VORGANG" + _fpw$)
       CALL DFile(3,"BUCHUNG" + _fpw$)
       OPEN FORM GPrjForm$ + fo1$
       SET f = Superbase.Form
       MOUSE ON 
     ELSE 
       CALL Fehler("Falsches Datumsformat!","Das Datum mu· in der Form 'tt.mm.jj' eingegeben werden.")
     END IF 
   END IF 
 END IF 
 Anschluss% = 0
 END SUB 
 
 
 ' Vorbereitung der Buchungskorrektur
 ' Aufbau der Vertragspools fÅr Zahlungseingangskontrolle
 ' =======================================================================
  
SUB BUKOPrepEinz(codevt%)
 IF RECCOUNT ("ZEINGANG") < 1 THEN END SUB 
 MOUSE OFF 
 SET STATUS "Aufbau der Eingangskonten..."
 CALL Server("MESSAGE","Bitte warten..." + CHR$ (13) + CHR$ (10) + "Die Eingangskonten werden neu aufgebaut.")
 FILE "ZEINGANG"
 INDEX CodeVT.ZEINGANG
 SELECT FIRST 
 SELECT KEY CodeVT% LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
 lv% = 0
 WHILE NOT EOF ("ZEINGANG") AND codevt.zeingang = codevt%
   IF CodeVT.ZEINGANG <> lv% THEN 
     SET STATUS "Aufbau der Eingangskonten...(Vertrag " + VS_NR.KVERTRAG + ")"
     IF lv% <> 0 THEN CALL QuickStore("KVERTRAG")
     SELECT KEY CodeVT.ZEINGANG LOCK FILE "KVERTRAG" INDEX lfdnr.KVERTRAG
     lv% = CodeVT.ZEINGANG
   END IF 
 
   Pool% = (Pool.KVERTRAG + Betrag.ZEINGANG) * 100
   pool1$ = STR$ (pool%,"999999999999")
   poolges% = ( VAL (pool1$)) / 100
   pool.kvertrag = poolges%
   SELECT NEXT FILE "ZEINGANG" INDEX CodeVT.ZEINGANG
 WEND 
 CALL QuickStore("KVERTRAG")
 MOUSE ON 
 END SUB 
 
 
 
 REM ************************************************************************************
 REM 270799 Vertragsstatus zuweisen                                                     *
 REM ************************************************************************************
 
SUB VStatusAnzeig()
   IF disabled%("VERTRBEARB") THEN END SUB 
   IF ag$ = "j" THEN 
     CALL Fehler("Diese Funktion ist in SmartPROVIS Agentur gesperrt!","")
     END SUB 
   END IF 
   REQUEST "Wollen Sie den Vertragsstatus wirklich Ñndern?","",130,req%
   IF req% <> 1 THEN END SUB 
   IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
     CALL DFile(3,"BUCHUNG" + _fpw$)
   ELSE 
     CALL DFile(3,"BUCHUNG1" + _fpw$)
   END IF 
   cv% = lfdnr.kvertrag
   vstatus% = 0
   vstatusnr% = CodeVStatus.kvertrag
   vstatustxt$ = VStatusTxT.kvertrag
   DIM Waehrung$(25,1)
   REDIM Waehrung$(25)
   REM FOR i% = 1 TO 20
     REM Waehrung$(i%) = ""
   REM NEXT i%
   IF NEW ("kvertrag") OR MOD ("kvertrag") THEN CALL FStore("kvertrag")
   a% = 0
   Waehrung$(a%) = "Bitte wÑhlen Sie einen Vertragsstatus"
   a% = a% + 1
   Waehrung$(a%) = "lebend" + SPACE$ (90) + "01"
   a% = a% + 1
   Waehrung$(a%) = "leben/kurzfristig/unterjÑhrig" + SPACE$ (90) + "02"
   a% = a% + 1
   Waehrung$(a%) = "ruhend/Anwartschaft" + SPACE$ (90) + "03"
   a% = a% + 1
   Waehrung$(a%) = "storniert" + SPACE$ (90) + "04"
   a% = a% + 1
   Waehrung$(a%) = "ruhend/beitragsfrei" + SPACE$ (90) + "05"
   a% = a% + 1
   Waehrung$(a%) = "beitragsfrei" + SPACE$ (90) + "06"
   a% = a% + 1
   Waehrung$(a%) = "beitragsfrei durch Leistung" + SPACE$ (90) + "07"
   a% = a% + 1
   Waehrung$(a%) = "Beitragsstundung" + SPACE$ (90) + "08"
   a% = a% + 1
   Waehrung$(a%) = "Sonstiges" + SPACE$ (90) + "09"
   a% = a% + 1
   Waehrung$(a%) = "Altvertrag" + SPACE$ (90) + "10"
   a% = a% + 1
   IF inhaus.kvertrag <> 1 THEN 
     Waehrung$(a%) = "Fremdvertrag" + SPACE$ (90) + "11"
     a% = a% + 1
   END IF 
   Waehrung$(a%) = "Antrag" + SPACE$ (90) + "12"
   a% = a% + 1
   Waehrung$(a%) = "storniert durch Dynamisierung" + SPACE$ (90) + "13"
   a% = a% + 1
   Waehrung$(a%) = "Bestandteil eines BÅndelungsvertrages" + SPACE$ (90) + "14"
   a% = a% + 1
   Waehrung$(a%) = "Antragswiderruf" + SPACE$ (90) + "15"
   a% = a% + 1
   Waehrung$(a%) = "Policenwiderspruch" + SPACE$ (90) + "16"
   a% = a% + 1
   Waehrung$(a%) = "Antragsablehnung" + SPACE$ (90) + "20"
   a% = a% + 1
   Waehrung$(a%) = "KÅnd.wg.Nichtzahlung" + SPACE$ (90) + "21"
   a% = 0
   REM 1=lebend
   REM 2=leben/kurzfristig/unterjÑhrig
   REM 3=ruhend/Anwartschaft
   REM 4=storniert
   REM 5=ruhend/beitragsfrei
   REM 6=beitragsfrei
   REM 7=beitragsfrei durch Leistung
   REM 8=Beitragsstundung
   REM 9=Sonstiges 
   REM 10=Altvertrag
   REM 11=Fremdvertrag
   REM 12=Antrag
   REM 13=storniert durch Dynamisierung 
   REM 14=Bestandteil eines BÅndelungsvertrages 
   REM 15=Antragswiderruf
   REM 16=Policenwiderspruch
   REM 20=Antragsablehnung
   REM 21=KÅnd.wg.Nichtzahlung

       a% = 14
     DIM Auswahl1$(1)
     FILE "kvertrag"
gueltEintr1507991: 
     CREATE DIALOG "PREISLIS",0,0,190,204,"Vertragsstatus","MS Sans Serif",8
      ADD DIALOG "PREISLIS",4,0,0,189,177,0," Auswahl Vertragsstatus"
      ADD DIALOG "PREISLIS",7,5,14,169,160,0,2,Waehrung$,Auswahl1$," "
      ADD DIALOG "PREISLIS",1,37,185,55,16,1,"&OK",1,1
      ADD DIALOG "PREISLIS",1,107,185,55,16,0,"&Abbrechen",0,0
      DIALOG "PREISLIS",req%
      REMOVE DIALOG "PREISLIS"
      IF req% = 1 THEN 
        vstatus% = 2
        CodeVStatus% = VAL ( RIGHT$ (Auswahl1$(0),2))
        IF CodeVStatus% = 4 AND vstatusnr% <> 4 THEN 
          CALL VERTRStorno()
          GOTO endvstanz16010101
        END IF 
        SELECT KEY cv% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
        IF CodeVStatus% > 0 THEN 
          storno.kvertrag = 0
          IF proviab.kvertrag < 1 THEN 
            lfdnr% = lfdnr.kvertrag
            IF UCASE$ (PrvVerfahr$) <> "ZAHLUNGSEINGANG" THEN 
              IF EXISTS (lfdnr%,codevt.buchung) AND maaa$ = "xxyy" THEN 
                CALL Fehler("Es werden jetzt die zu diesem Vertrag gefundenen Buchungen gelîscht!","Einen Moment bitte!")
                MOUSE OFF 
                REMOVE FROM FILE "Buchung" WHERE codevt.buchung = lfdnr%
                MOUSE ON 
              END IF 
            ELSE 
              IF EXISTS (lfdnr%,codevt.buchung1) AND maaa$ = "xxyy" THEN 
                CALL Fehler("Es werden jetzt die zu diesem Vertrag gefundenen Buchungen gelîscht!","Einen Moment bitte!")
                MOUSE OFF 
                REMOVE FROM FILE "Buchung1" WHERE codevt.buchung1 = lfdnr%
                MOUSE ON 
              END IF 
            END IF 
 
 
          END IF 
          CodeVStatusOld.kvertrag = CodeVStatus.kvertrag
          VStatusTxTOld.kvertrag = VStatusTxT.kvertrag
          IF CodeVStatus% = 23 AND VStatusnr% > 3 THEN 
          REM IF CodeVStatus% = 13 AND VStatusnr% > 3 THEN 
            CALL Fehler("Es kann nur ein provisionspflichtiger Vertrag dynamisiert werden!","")
          ELSE 
            CodeVStatus.kvertrag = CodeVStatus%
            stxt$ = TRIM$ ( LEFT$ (Waehrung$(CodeVStatus%),50))
            IF CodeVStatus% = 20 THEN stxt$ = "Antragsablehnung"
            IF CodeVStatus% = 21 THEN stxt$ = "KÅnd.wg.Nichtzahlung"
            IF CodeVStatus% = 13 THEN 
              stxt$ = "Storno durch DYN"
            END IF 
            IF stxt$ LIKE "Fremd*" THEN 
              fremdvertrag.kvertrag = "j"
            ELSE 
              fremdvertrag.kvertrag = "n"
            END IF 
            IF stxt$ LIKE "Altver*" OR CodeVStatus% = 20 OR CodeVStatus% = 21 THEN 
              Altvertrag.kvertrag = "j"
            ELSE 
              Altvertrag.kvertrag = "n"
            END IF 
            REM VStatusTxT.kvertrag = TRIM$ ( LEFT$ (Waehrung$(CodeVStatus%),50))
            VStatusTxT.kvertrag = stxt$
            IF CodeVStatus% = 20 THEN VStatusTxT.kvertrag = stxt$
            IF CodeVStatus% = 21 THEN VStatusTxT.kvertrag = stxt$
            IF CodeVStatus% <> 4 AND CodeVStatus% <> 13 THEN 
              IF proviab.kvertrag > 0 THEN 
                IF Altvertrag.kvertrag <> "j" THEN 
                  TatsKuenDat.Kvertrag = 0
                  vorzeitig.kvertrag = "n"
                END IF 
              ELSE 
                TatsKuenDat.Kvertrag = 0
                vorzeitig.kvertrag = "n"
              END IF 
            END IF 
            CALL MATimeStamp("KVERTRAG")
            CALL FStore("kvertrag")
          END IF 
          REM wenn Vertrag als "lebend" gekennzeichnet wird 
          REM IF CodeVStatus% = 1 OR CodeVStatus% = 2 THEN CALL PROVISION()
          REM IF VStatusnr% < 5 AND codevstatus% <> 13 THEN CALL PROVISION()
          IF CodeVStatus% = 23 AND (VStatusnr% = 1 OR VStatusnr% = 2 OR VStatusnr% = 3) THEN 
          REM IF CodeVStatus% = 13 AND (VStatusnr% = 1 OR VStatusnr% = 2 OR VStatusnr% = 3) THEN 
            IF NOT disabled%("VERTRNeu") THEN 
              REQUEST "Mîchten Sie den Vertrag dynamisieren?","",130,req%
              IF req% = 1 THEN 
                IF ProviAb.kvertrag < 1 OR Fremdvertrag.KVERTRAG LIKE "j" OR Altvertrag.KVERTRAG LIKE "j" THEN 
                  CALL Fehler("Vertrag kann nicht dynamisiert werden, da er entweder ein Altvertrag, Fremdvertrag","ist oder noch nicht an die Provisionsabrechnung Åbergeben wurde!")
                  vstatus% = 2
                ELSE 
                  IF ProviAb.kvertrag > 1 AND storno.kvertrag > 0 THEN 
                    CALL Fehler("Vertrag kann nicht dynamisiert werden, da er bereits storniert wurde!","")
                    vstatus% = 2
                  ELSE 
                    vstatus% = 0
                    CALL Dynamisier(lfdnr.kvertrag)
                    lfdnr% = lfdnr.kvertrag
                  END IF 
                END IF 
              ELSE 
                vstatus% = 2
              END IF 
            END IF 
            IF vstatus% = 2 THEN 
              vstatus% = 0
              SELECT KEY cv% LOCK FILE "kvertrag" INDEX lfdnr.kvertrag
              CodeVStatus.kvertrag = vstatusnr%
              VStatusTxT.kvertrag = vstatustxt$
              CALL QuickStore("KVERTRAG")
            END IF 
          END IF 
        ELSE 
          CALL Fehler("Bitte wÑhlen Sie einen gÅltigen Eintrag!","")
          GOTO gueltEintr1507991
        END IF 
        SELECT FORM KEY cv% FILE "kvertrag" INDEX lfdnr.kvertrag
        vstatus$ = VStatusTxT.kvertrag
        REM CALL VertrUpdate()
      END IF 
endvstanz16010101: 
 MOUSE ON 
 FORM 
 
 END SUB 
 
 
 
  

